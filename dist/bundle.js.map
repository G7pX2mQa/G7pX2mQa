{
  "version": 3,
  "sources": ["../js/util/bigNum.js", "../js/util/numFormat.js", "../js/util/storage.js", "../js/util/slotsManager.js", "../js/util/slots.js", "../js/util/audioCache.js", "../js/ui/hudLayout.js", "../js/game/xpSystem.js", "../js/ui/merchantDelve/resetTab.js", "../js/game/upgrades.js", "../js/misc/merchantDialogues.js", "../js/util/ghostTapGuard.js", "../js/ui/merchantDelve/dlgTab.js", "../js/ui/shopOverlay.js", "../js/ui/hudButtons.js", "../js/util/debugPanel.js", "../js/game/mutationSystem.js", "../js/game/spawner.js", "../js/game/coinPickup.js", "../js/util/saveIntegrity.js", "../js/ui/popups.js", "../js/util/suspendSafeguard.js", "../js/main.js"],
  "sourcesContent": ["// js/util/bigNum.js\r\nexport class BigNum {\r\n  static DEFAULT_PRECISION = 18;\r\n  static MAX_E = 1.7976931348623157e+308; // Number.MAX_VALUE\r\n  static MAX_PLAIN_DIGITS = 1_000_000;    // safety cap for plain integer strings\r\n\r\n  constructor(sig, e, p = BigNum.DEFAULT_PRECISION) {\r\n    this.p = p | 0;\r\n    this.sig = BigInt(sig);\r\n    this._eOffset = 0n;\r\n\r\n    if (e && typeof e === 'object' && ('base' in e || 'offset' in e || 'inf' in e)) {\r\n      const base = Number(e.base ?? 0);\r\n      const inf = !!e.inf;\r\n      if (inf || !Number.isFinite(base) || base >= BigNum.MAX_E) {\r\n        this.e = BigNum.MAX_E;\r\n        this.inf = true;\r\n        this._eOffset = 0n;\r\n      } else {\r\n        this.e = Math.trunc(base);\r\n        this.inf = false;\r\n        const off = e.offset ?? 0;\r\n        this._eOffset = typeof off === 'bigint' ? off : BigInt(off);\r\n      }\r\n    } else {\r\n      const ee = Number(e);\r\n      if (!Number.isFinite(ee) || ee >= BigNum.MAX_E) {\r\n        this.e = BigNum.MAX_E;\r\n        this.inf = true;\r\n      } else {\r\n        this.e = Math.trunc(ee);\r\n        this.inf = false;\r\n      }\r\n    }\r\n    this.#normalize();\r\n  }\r\n\r\n  // ---------------------- FACTORIES ----------------------\r\n  static zero(p = BigNum.DEFAULT_PRECISION) { return new BigNum(0n, 0, p); }\r\n\r\n  static fromInt(n, p = BigNum.DEFAULT_PRECISION) {\r\n    return new BigNum(BigInt(n), 0, p);\r\n  }\r\n\r\n  static fromScientific(str, p = BigNum.DEFAULT_PRECISION) {\r\n    const s = String(str ?? '').trim();\r\n    if (!s) throw new TypeError('Invalid BigNum input: ' + str);\r\n\r\n    if (/^inf(?:inity)?$/i.test(s)) {\r\n      return new BigNum(1n, BigNum.MAX_E, p);\r\n    }\r\n\r\n    const match = s.match(/^(\\d+)(?:\\.(\\d+))?(?:e([+-]?\\d+))?$/i);\r\n    if (!match) {\r\n      return new BigNum(BigInt(s), 0, p);\r\n    }\r\n\r\n    let [, intPart, fracPart = '', expPart] = match;\r\n    let exponent = expPart ? parseInt(expPart, 10) : 0;\r\n    exponent -= fracPart.length;\r\n\r\n    const digits = (intPart + fracPart).replace(/^0+/, '') || '0';\r\n    const sig = BigInt(digits);\r\n    return new BigNum(sig, exponent, p);\r\n  }\r\n\r\n  static fromStorage(str, p = BigNum.DEFAULT_PRECISION) {\r\n    if (!str) return null;\r\n    if (typeof str !== 'string') str = String(str);\r\n    if (str.startsWith('BN:')) {\r\n      const [, pStr, sigStr, eStr] = str.split(':');\r\n      const pp = parseInt(pStr, 10) || p;\r\n      let baseStr = eStr;\r\n      let offset = 0n;\r\n      const caret = eStr.indexOf('^');\r\n      if (caret >= 0) {\r\n        baseStr = eStr.slice(0, caret);\r\n        const offStr = eStr.slice(caret + 1) || '0';\r\n        try { offset = BigInt(offStr); }\r\n        catch { offset = 0n; }\r\n      }\r\n      let eNum = Number(baseStr);\r\n      if (!Number.isFinite(eNum)) eNum = BigNum.MAX_E;\r\n      return new BigNum(BigInt(sigStr), { base: eNum, offset }, pp);\r\n    }\r\n    return BigNum.fromScientific(str, p);\r\n  }\r\n\r\n  // Accepts: BigNum | \"BN:...\" | scientific string | number | bigint\r\n  static fromAny(input, p = BigNum.DEFAULT_PRECISION) {\r\n    if (input instanceof BigNum) return input;\r\n    if (typeof input === 'string') {\r\n      const trimmed = input.trim();\r\n      if (trimmed.startsWith('BN:')) return BigNum.fromStorage(trimmed, p);\r\n      if (/^inf(?:inity)?$/i.test(trimmed)) return new BigNum(1n, BigNum.MAX_E, p);\r\n      if (/^\\d+(?:\\.\\d+)?(?:e[+-]?\\d+)?$/i.test(trimmed)) return BigNum.fromScientific(trimmed, p);\r\n    }\r\n    if (typeof input === 'number') {\r\n      if (!Number.isFinite(input)) return new BigNum(1n, BigNum.MAX_E, p);\r\n      return BigNum.fromScientific(input.toString(), p);\r\n    }\r\n    if (typeof input === 'bigint') return BigNum.fromInt(input, p);\r\n    throw new TypeError('Unsupported BigNum input: ' + input);\r\n    }\r\n\r\n  // ---------------------- PERSISTENCE ----------------------\r\n  toStorage() {\r\n    if (this.inf) return `BN:${this.p}:${this.sig.toString()}:${BigNum.MAX_E}`;\r\n    const offsetSuffix = this._eOffset !== 0n ? `^${this._eOffset.toString()}` : '';\r\n    return `BN:${this.p}:${this.sig.toString()}:${this.e}${offsetSuffix}`;\r\n  }\r\n\r\n  clone() {\r\n    return new BigNum(this.sig, { base: this.e, offset: this._eOffset, inf: this.inf }, this.p);\r\n  }\r\n\r\n  // ---------------------- STATE QUERIES ----------------------\r\n  isZero() { return !this.inf && this.sig === 0n; }\r\n  isInfinite() { return !!this.inf; }\r\n  isNegative() { return false; }\r\n\r\n  sub(b) {\r\n    b = BigNum.fromAny(b, this.p);\r\n\r\n    if (this.inf) {\r\n      if (b.inf) return BigNum.zero(this.p);\r\n      return this.clone();\r\n    }\r\n    if (b.inf) return BigNum.zero(this.p);\r\n\r\n    if (this.cmp(b) <= 0) return BigNum.zero(this.p);\r\n\r\n    const expCmp = this.#compareExponent(b);\r\n    if (expCmp >= 0) {\r\n      const aligned = expCmp === 0 ? b.sig : this.#alignSig(b);\r\n      const diffSig = this.sig - aligned;\r\n      if (diffSig > 0n) {\r\n        return new BigNum(diffSig, this.#expObj(), this.p);\r\n      }\r\n    }\r\n\r\n    try {\r\n      const aPlain = this.toPlainIntegerString();\r\n      const bPlain = b.toPlainIntegerString();\r\n      if (aPlain === 'Infinity') return this.clone();\r\n      if (bPlain === 'Infinity') return BigNum.zero(this.p);\r\n      const diff = BigInt(aPlain) - BigInt(bPlain);\r\n      if (diff <= 0n) return BigNum.zero(this.p);\r\n      return BigNum.fromInt(diff, this.p);\r\n    } catch {\r\n      return BigNum.zero(this.p);\r\n    }\r\n  }\r\n\r\n  // ---------------------- PRIVATE HELPERS ----------------------\r\n  #pow10(k) { return k <= 0 ? 1n : 10n ** BigInt(k); }\r\n\r\n  #expObj() {\r\n    return { base: this.e, offset: this._eOffset, inf: this.inf };\r\n  }\r\n\r\n  #adjustExponent(delta) {\r\n    if (this.inf || !delta) return;\r\n    const prev = this.e;\r\n    const next = prev + delta;\r\n    this.e = Math.trunc(next);\r\n    const applied = this.e - prev;\r\n    const leftover = BigInt(delta - applied);\r\n    if (leftover) this._eOffset += leftover;\r\n  }\r\n\r\n  #totalExponentBigInt() {\r\n    if (this.inf) return this._eOffset >= 0n ? BigInt(Number.MAX_SAFE_INTEGER) : -BigInt(Number.MAX_SAFE_INTEGER);\r\n    const base = BigInt(Math.trunc(this.e));\r\n    return base + this._eOffset;\r\n  }\r\n\r\n  #compareExponent(other) {\r\n    if (this.inf || other.inf) {\r\n      if (this.inf && other.inf) return 0;\r\n      return this.inf ? 1 : -1;\r\n    }\r\n    const a = this.#totalExponentBigInt();\r\n    const b = other.#totalExponentBigInt();\r\n    if (a > b) return 1;\r\n    if (a < b) return -1;\r\n    return 0;\r\n  }\r\n\r\n  #expDiff(other) {\r\n    if (this.inf || other.inf) {\r\n      if (this.inf && other.inf) return 0n;\r\n      return this.inf ? BigInt(this.p + 3) : -BigInt(this.p + 3);\r\n    }\r\n    const diff = this.#totalExponentBigInt() - other.#totalExponentBigInt();\r\n    const absDiff = diff < 0n ? -diff : diff;\r\n    const limit = BigInt(this.p + 2);\r\n    if (absDiff > limit) {\r\n      return diff > 0n ? BigInt(this.p + 3) : -BigInt(this.p + 3);\r\n    }\r\n    return diff;\r\n  }\r\n\r\n  #offsetAsNumber() {\r\n    if (this._eOffset === 0n) return 0;\r\n    const offNum = Number(this._eOffset);\r\n    if (!Number.isFinite(offNum) || !Number.isSafeInteger(offNum)) {\r\n      return offNum > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\r\n    }\r\n    return offNum;\r\n  }\r\n\r\n  #effectiveExponentNumber() {\r\n    if (this.inf) return Number.POSITIVE_INFINITY;\r\n    const offset = this.#offsetAsNumber();\r\n    if (!Number.isFinite(offset)) return this.e;\r\n    return this.e + offset;\r\n  }\r\n\r\n  #normalize() {\r\n    if (this.inf) return;\r\n    if (this.sig === 0n) { this.e = 0; return; }\r\n\r\n    let s = this.sig;\r\n    const p = this.p;\r\n    const d = s.toString().length;\r\n    const shift = d - p;\r\n\r\n    if (shift > 0) {\r\n      const base = this.#pow10(shift);\r\n      let q = s / base;\r\n      const r = s % base;\r\n      if (r * 2n >= base) q += 1n; // round half up\r\n      s = q;\r\n      this.#adjustExponent(shift);\r\n      if (this.e >= BigNum.MAX_E) { this.e = BigNum.MAX_E; this.inf = true; return; }\r\n      if (s.toString().length > p) { // carry overflow\r\n        s = s / 10n;\r\n        this.#adjustExponent(1);\r\n        if (this.e >= BigNum.MAX_E) { this.e = BigNum.MAX_E; this.inf = true; return; }\r\n      }\r\n    } else if (shift < 0) {\r\n      const k = -shift;\r\n      s = s * this.#pow10(k);\r\n      this.#adjustExponent(-k);\r\n    }\r\n\r\n    this.sig = s;\r\n  }\r\n\r\n  #alignSig(other) {\r\n    const diff = this.#expDiff(other);\r\n    const absDiff = diff < 0n ? -diff : diff;\r\n    if (absDiff === 0n) return other.sig;\r\n    if (absDiff > BigInt(this.p + 2)) return 0n; // negligible\r\n    const diffNum = Number(absDiff);\r\n    const base = this.#pow10(diffNum);\r\n    let q = other.sig / base;\r\n    const r = other.sig % base;\r\n    if (r * 2n >= base) q += 1n;\r\n    return q;\r\n  }\r\n\r\n  // ---------------------- ARITHMETIC ----------------------\r\n   add(b) {\r\n    b = BigNum.fromAny(b, this.p);\r\n    if (this.inf || b.inf) {\r\n      const out = this.clone(); out.inf = this.inf || b.inf; out.e = BigNum.MAX_E; return out;\r\n    }\r\n    if (this.isZero()) return b.clone();\r\n    if (b.isZero()) return this.clone();\r\n    if (this.#compareExponent(b) >= 0) {\r\n      return new BigNum(this.sig + this.#alignSig(b), this.#expObj(), this.p);\r\n    }\r\n    return b.add(this);\r\n  }\r\n\r\n  iadd(b) { const r = this.add(b); this.sig = r.sig; this.e = r.e; this._eOffset = r._eOffset; this.inf = r.inf; return this; }\r\n\r\n  mulSmall(k) {\r\n    if (k < 0) throw new Error('BigNum only supports non-negative values');\r\n    if (this.inf) return this.clone();\r\n    if (k === 0) return BigNum.zero(this.p);\r\n    if (k === 1) return this.clone();\r\n    const out = new BigNum(this.sig * BigInt(k), this.#expObj(), this.p);\r\n    return out;\r\n  }\r\n\r\n  imulSmall(k) { const r = this.mulSmall(k); this.sig = r.sig; this.e = r.e; this._eOffset = r._eOffset; this.inf = r.inf; return this; }\r\n\r\n  // Multiply by another non-negative integer BigNum (exact).\r\n  mulBigNumInteger(other) {\r\n    const b = BigNum.fromAny(other, this.p);\r\n    if (this.inf || b.inf) {\r\n      const out = this.clone();\r\n      out.inf = this.inf || b.inf;\r\n      out.e = BigNum.MAX_E;\r\n      return out;\r\n    }\r\n    if (this.isZero() || b.isZero()) return BigNum.zero(this.p);\r\n    const baseSum = this.e + b.e;\r\n    const offsetSum = this._eOffset + b._eOffset;\r\n    return new BigNum(this.sig * b.sig, { base: baseSum, offset: offsetSum }, this.p);\r\n  }\r\n\r\n  imulBigNumInteger(other) {\r\n    const r = this.mulBigNumInteger(other);\r\n    this.sig = r.sig; this.e = r.e; this._eOffset = r._eOffset; this.inf = r.inf;\r\n    return this;\r\n  }\r\n\r\n  cmp(b) {\r\n    b = BigNum.fromAny(b, this.p);\r\n    if (this.inf || b.inf) return this.inf === b.inf ? 0 : this.inf ? 1 : -1;\r\n    const thisIsZero = this.isZero();\r\n    const otherIsZero = typeof b.isZero === 'function' ? b.isZero() : false;\r\n    if (thisIsZero || otherIsZero) {\r\n      if (thisIsZero && otherIsZero) return 0;\r\n      return thisIsZero ? -1 : 1;\r\n    }\r\n    const expCmp = this.#compareExponent(b);\r\n    if (expCmp !== 0) return expCmp;\r\n    if (this.sig === b.sig) return 0;\r\n    return this.sig > b.sig ? 1 : -1;\r\n  }\r\n  // ----- Decimal multiply (exact, integer-safe) & flooring -----\r\n\r\n  // Parse decimal like \"2.345\" (or number) into { numer: BigInt, scale: int } with up to maxScale frac digits.\r\n  static _parseDecimalMultiplier(x, maxScale = BigNum.DEFAULT_PRECISION) {\r\n    let s = (typeof x === 'number') ? String(x) : String(x ?? '').trim();\r\n    if (!s || s === '0') return { numer: 0n, scale: 0 };\r\n\r\n    // normalize scientific like \"1e3\" to fixed decimal string\r\n    if (/e/i.test(s)) {\r\n      const n = Number(s);\r\n      if (!Number.isFinite(n) || n < 0) throw new TypeError('Invalid multiplier: ' + s);\r\n      const digits = Math.min(maxScale, 18);\r\n      s = n.toFixed(digits).replace(/\\.?0+$/, ''); // strip trailing zeros\r\n    }\r\n\r\n    if (!/^\\d+(\\.\\d+)?$/.test(s)) throw new TypeError('Invalid multiplier: ' + s);\r\n\r\n    const [intPart, fracRaw = ''] = s.split('.');\r\n    const frac = fracRaw.slice(0, maxScale); // clamp fractional length\r\n    const scale = frac.length;\r\n    const numer = BigInt(intPart + frac);\r\n    return { numer, scale };\r\n  }\r\n\r\n  // Multiply by decimal multiplier given as number/string with up to 18 fractional digits (returns new BigNum).\r\n  mulDecimal(mult, maxScale = BigNum.DEFAULT_PRECISION) {\r\n    if (this.inf || this.isZero()) return this.clone();\r\n    const { numer, scale } = BigNum._parseDecimalMultiplier(mult, maxScale);\r\n    if (numer === 0n) return BigNum.zero(this.p);\r\n    return this.mulScaledInt(numer, scale);\r\n  }\r\n\r\n  // Floor to integer value by dropping fractional digits.\r\n  floorToInteger() {\r\n    if (this.inf) return this.clone();\r\n    if (this.isZero()) return this.clone();\r\n    const exp = this.#effectiveExponentNumber();\r\n    if (!Number.isFinite(exp)) return this.clone();\r\n    const intDigits = exp + this.p; // integer digits in the value\r\n    if (intDigits <= 0) return BigNum.zero(this.p); // < 1\r\n    if (intDigits >= this.p) return this.clone();   // already integral\r\n    const drop = this.p - intDigits;                // digits to truncate\r\n    const base = 10n ** BigInt(drop);\r\n    const newSig = (this.sig / base) * base;        // drop fractional digits\r\n    return new BigNum(newSig, this.#expObj(), this.p);\r\n  }\r\n\r\n  // Convenience: multiply by decimal and floor to integer immediately.\r\n  mulDecimalFloor(mult, maxScale = BigNum.DEFAULT_PRECISION) {\r\n    return this.mulDecimal(mult, maxScale).floorToInteger();\r\n  }\r\n\r\n  mulScaledInt(numerBigInt, scale) {\r\n    if (this.inf || this.isZero()) return this.clone();\r\n    const nb = BigInt(numerBigInt);\r\n    if (nb === 0n) return BigNum.zero(this.p);\r\n    return new BigNum(this.sig * nb, this.e - (scale | 0), this.p);\r\n  }\r\n\r\n  // Same as above but floors to an integer.\r\n  mulScaledIntFloor(numerBigInt, scale) {\r\n    return this.mulScaledInt(numerBigInt, scale).floorToInteger();\r\n  }\r\n\r\n  // ---------------------- FORMATTING ----------------------\r\n  get decExp() {\r\n    if (this.inf) return Number.POSITIVE_INFINITY;\r\n    const exp = this.#effectiveExponentNumber();\r\n    if (!Number.isFinite(exp)) return this.e + (this.p - 1);\r\n    return exp + (this.p - 1);\r\n  }\r\n\r\n  toScientific(digits = 3) {\r\n    if (this.inf) return 'Infinity';\r\n    if (this.isZero()) return '0';\r\n    const s = this.sig.toString().padStart(this.p, '0');\r\n    const head = s[0];\r\n    const tail = s.slice(1, 1 + digits).replace(/0+$/g, '');\r\n    const mant = tail ? `${head}.${tail}` : head;\r\n    const exp = this.#effectiveExponentNumber();\r\n    const E = Number.isFinite(exp) ? (exp + (this.p - 1)) : (this.e + (this.p - 1));\r\n    return `${mant}e${E}`;\r\n  }\r\n\r\n  toPlainIntegerString() {\r\n    if (this.inf) return 'Infinity';\r\n    if (this.isZero()) return '0';\r\n    const exp = this.#effectiveExponentNumber();\r\n    if (!Number.isFinite(exp)) return 'Infinity';\r\n    const intDigits = exp + this.p;\r\n    if (intDigits <= 0) return '0';\r\n    if (intDigits > BigNum.MAX_PLAIN_DIGITS) return 'Infinity';\r\n\r\n    const s = this.sig.toString().padStart(this.p, '0');\r\n    if (intDigits <= this.p) {\r\n      return s.slice(0, intDigits).replace(/^0+/, '') || '0';\r\n    }\r\n\r\n    const extraZeros = intDigits - this.p;\r\n    return (s + '0'.repeat(extraZeros)).replace(/^0+/, '') || '0';\r\n  }\r\n\r\n  toString() {\r\n    return this.toPlainIntegerString();\r\n  }\r\n}", "// js/util/numFormat.js\r\n// Policy:\r\n//  - < 1e6: plain integer using the user's locale (grouping)\r\n//  - 1e6 .. < 1e303: suffix table (\"M,B,T,Qd,...\") with FOUR visible digits\r\n//  - >= 1e303: scientific, but with a pretty *recursive* exponent\r\n//\r\n// Also prettifies the exponent itself (e.g., 1.000e1,000 / 1.000e1.000Qd / 1.000e1.000e308)\r\n\r\nimport { BigNum } from './bigNum.js';\r\n\r\n// Suffixes copied from CCC (descending exponents).\r\nconst SUFFIX_ENTRIES = [\r\n  [300,'NoNg'],[297,'OcNg'],[294,'SpNg'],[291,'SxNg'],[288,'QnNg'],[285,'QdNg'],[282,'TNg'],[279,'DNg'],[276,'UNg'],[273,'Ng'],\r\n  [270,'NoOg'],[267,'OcOg'],[264,'SpOg'],[261,'SxOg'],[258,'QnOg'],[255,'QdOg'],[252,'TOg'],[249,'DOg'],[246,'UOg'],[243,'Og'],\r\n  [240,'NoSg'],[237,'OcSg'],[234,'SpSg'],[231,'SxSg'],[228,'QnSg'],[225,'QdSg'],[222,'TSg'],[219,'DSg'],[216,'USg'],[213,'Sg'],\r\n  [210,'Nosg'],[207,'Ocsg'],[204,'Spsg'],[201,'Sxsg'],[198,'Qnsg'],[195,'Qdsg'],[192,'Tsg'],[189,'Dsg'],[186,'Usg'],[183,'sg'],\r\n  [180,'NoQg'],[177,'OcQg'],[174,'SpQg'],[171,'SxQg'],[168,'QnQg'],[165,'QdQg'],[162,'TQg'],[159,'DQg'],[156,'UQg'],[153,'Qg'],\r\n  [150,'Noqg'],[147,'Ocqg'],[144,'Spqg'],[141,'Sxqg'],[138,'Qnqg'],[135,'Qdqg'],[132,'Tqg'],[129,'Dqg'],[126,'Uqg'],[123,'qg'],\r\n  [120,'NoTg'],[117,'OcTg'],[114,'SpTg'],[111,'SxTg'],[108,'QnTg'],[105,'QdTg'],[102,'TTg'],[99,'DTg'],[96,'UTg'],[93,'Tg'],\r\n  [90,'NoVt'],[87,'OcVt'],[84,'SpVt'],[81,'SxVt'],[78,'QnVt'],[75,'QdVt'],[72,'TVt'],[69,'DVt'],[66,'UVt'],[63,'Vt'],\r\n  [60,'NoDe'],[57,'OcDe'],[54,'SpDe'],[51,'SxDe'],[48,'QnDe'],[45,'QdDe'],[42,'TDe'],[39,'DDe'],[36,'UDe'],[33,'De'],\r\n  [30,'No'],[27,'Oc'],[24,'Sp'],[21,'Sx'],[18,'Qn'],[15,'Qd'],[12,'T'],[9,'B'],[6,'M']\r\n];\r\nconst SUFFIX_BY_EXP = new Map(SUFFIX_ENTRIES);\r\n\r\nconst NF_INT = new Intl.NumberFormat(undefined, { maximumFractionDigits: 0, useGrouping: true });\r\nfunction localeInt(s) {\r\n  const num = Number(s);\r\n\r\n  // Safari throws a RangeError when formatting non-finite values via Intl.NumberFormat;\r\n  // treat them as plain strings instead so the UI doesn't silently break on mobile.\r\n  if (!Number.isFinite(num)) return String(s);\r\n\r\n  try { return NF_INT.format(num); }\r\n  catch { return String(s); }\r\n}\r\n\r\n// --- add 1 to a decimal digit-string (for rounding) ---\r\nfunction addOneDigitString(str){\r\n  let carry = 1, a = str.split('');\r\n  for (let i = a.length - 1; i >= 0 && carry; i--) {\r\n    let d = a[i].charCodeAt(0) - 48 + carry;\r\n    carry = d >= 10 ? 1 : 0;\r\n    a[i] = String.fromCharCode(48 + (d % 10));\r\n  }\r\n  if (carry) a.unshift('1');\r\n  return a.join('');\r\n}\r\n\r\nfunction formatExponentString(rawDigits, sign = '') {\r\n  let ds = (rawDigits || '').replace(/^0+/, '') || '0';\r\n\r\n  if (ds.length < 4) return sign + localeInt(ds);          // < 1,000\r\n  if (ds.length <= 7) {                                     // 1,000 .. 1,000,000\r\n    const n = Number(ds);\r\n    if (Number.isFinite(n) && n <= 1_000_000) return sign + NF_INT.format(n);\r\n  }\r\n\r\n  const E = ds.length - 1;\r\n\r\n  if (E <= 300) {\r\n    const exp = Math.floor(E / 3) * 3;\r\n    const suffix = SUFFIX_BY_EXP.get(exp) || '';\r\n    const d = E - exp;              // 0..2\r\n    const intDigits = d + 1;        // 1..3\r\n    const decimals = 4 - intDigits; // to keep FOUR visible digits\r\n    const totalDigits = intDigits + decimals;\r\n\r\n    if (ds.length < totalDigits + 1) ds += '0'.repeat(totalDigits + 1 - ds.length);\r\n    let head = ds.slice(0, totalDigits);\r\n    const nextDigit = ds.charCodeAt(totalDigits) || 48;\r\n    if (nextDigit >= 53) head = addOneDigitString(head);\r\n\r\n    let intStr, fracStr;\r\n    if (head.length > totalDigits) { intStr = head.slice(0, intDigits + 1); fracStr = '0'.repeat(decimals); }\r\n    else { intStr = head.slice(0, intDigits); fracStr = head.slice(intDigits); }\r\n\r\n    return sign + `${intStr}${decimals ? '.' + fracStr : ''}${suffix}`;\r\n  }\r\n\r\n  // Beyond our table: show scientific-within-exponent with FOUR-digit mantissa\r\n  const totalDigits = 4; // 1 integer + 3 decimals\r\n  if (ds.length < totalDigits + 1) ds += '0'.repeat(totalDigits + 1 - ds.length);\r\n  let head = ds.slice(0, totalDigits);\r\n  const nextDigit = ds.charCodeAt(totalDigits) || 48;\r\n  if (nextDigit >= 53) head = addOneDigitString(head);\r\n\r\n  const mantInt  = head.slice(0, 1);\r\n  const mantFrac = head.slice(1);\r\n  return sign + `${mantInt}.${mantFrac}e` + formatExponentString(String(E));\r\n}\r\n\r\nfunction formatPowerOf10Exponent(kDigits, sign = '') {\r\n  // Fast path to detect k \u2265 303 without bigints\r\n  let ge303 = false, k = 0;\r\n  if (kDigits.length > 3) ge303 = true;\r\n  else { k = parseInt(kDigits || '0', 10) || 0; ge303 = (k >= 303); }\r\n\r\n  if (ge303) {\r\n    // Scientific inside exponent; pretty-format k itself (locale + suffix rules)\r\n    return sign + '1.000e' + formatExponentString(kDigits);\r\n  }\r\n\r\n  // 0..302 \u2192 suffix tier plus remainder-driven mantissa\r\n  const exp = Math.floor(k / 3) * 3;          // 0,3,6,...,300\r\n  const suffix = SUFFIX_BY_EXP.get(exp) || '';\r\n\r\n  const remainder = k - exp;                   // 0,1,2\r\n  // FOUR visible digits before the suffix:\r\n  //  r=0 \u2192 \"1.000\", r=1 \u2192 \"10.00\", r=2 \u2192 \"100.0\"\r\n  const intPart   = (remainder === 0) ? '1' : (remainder === 1) ? '10' : '100';\r\n  const decimals  = 4 - (remainder + 1);      // 3,2,1\r\n  const fracPart  = decimals ? ('.' + '0'.repeat(decimals)) : '';\r\n\r\n  return sign + intPart + fracPart + suffix;\r\n}\r\n\r\nfunction formatExponentChain(expRaw) {\r\n  expRaw = String(expRaw).trim();\r\n\r\n  // Optional leading sign on the whole exponent; suppress '+'\r\n  let topSign = '';\r\n  if (expRaw[0] === '+' || expRaw[0] === '-') {\r\n    topSign = (expRaw[0] === '-') ? '-' : '';\r\n    expRaw = expRaw.slice(1);\r\n  }\r\n\r\n  // Case A: pure digits (e.g., \"...e305\") \u2192 delegate to our big-int pretty printer\r\n  if (/^\\d+$/.test(expRaw)) return topSign + formatExponentString(expRaw);\r\n\r\n  // Case B: scientific inside the exponent: \"m e \u00B1 k\"\r\n  const m = expRaw.match(/^(\\d+)(?:\\.(\\d+))?e([+-]?)(\\d+)$/i);\r\n  if (!m) return topSign + expRaw; // unknown form \u2192 keep as-is\r\n\r\n  const [, int, frac = '', sign2, kDigits] = m;\r\n\r\n  // Is k >= 303? (length check avoids unsafe parse)\r\n  let kGe303 = false, k = 0;\r\n  if (kDigits.length > 3) kGe303 = true;\r\n  else { k = parseInt(kDigits || '0', 10) || 0; kGe303 = (k >= 303); }\r\n\r\n  // First, compute a FOUR-digit mantissa from m (rounded)\r\n  // We'll shift the decimal by (k % 3) for suffix-tiers.\r\n  let ds = (int + frac).replace(/^0+/, '') || '0';\r\n  if (ds.length < 5) ds += '0'.repeat(5 - ds.length);\r\n  let four = ds.slice(0, 4);\r\n  const next = ds.charCodeAt(4) || 48;\r\n  if (next >= 53) four = addOneDigitString(four); // handle rounding carry later\r\n\r\n  if (kGe303) {\r\n    // Beyond our suffix table inside the exponent \u2192 scientific-of-exponent\r\n    // Keep the (rounded) exponent mantissa (\"3.617\") and pretty-format k itself.\r\n    const mant = four.slice(0,1) + '.' + four.slice(1);\r\n    const sign2Prefix = (sign2 === '-') ? '-' : '';\r\n    return topSign + mant + 'e' + formatExponentString(kDigits, sign2Prefix);\r\n  }\r\n\r\n  // Within our suffix table: choose suffix and place the decimal based on remainder\r\n  const exp = Math.floor(k / 3) * 3;          // 0,3,6,...,300\r\n  const suffix = SUFFIX_BY_EXP.get(exp) || '';\r\n  const remainder = k - exp;                   // 0,1,2\r\n\r\n  // Shift decimal: r=0 \u2192 \"1.234\", r=1 \u2192 \"12.34\", r=2 \u2192 \"123.4\"\r\n  const intDigits = remainder + 1;             // 1..3\r\n  const decimals  = 4 - intDigits;             // 3..1\r\n  let intStr, fracStr;\r\n  if (four.length > 4) { // carry overflow \u2192 one extra int digit, pad decimals with zeros\r\n    intStr = four.slice(0, intDigits + 1);\r\n    fracStr = '0'.repeat(decimals);\r\n  } else {\r\n    intStr = four.slice(0, intDigits);\r\n    fracStr = four.slice(intDigits);\r\n  }\r\n\r\n  const sign2Prefix = (sign2 === '-') ? '-' : '';\r\n  return topSign + sign2Prefix + intStr + (decimals ? ('.' + fracStr) : '') + suffix;\r\n}\r\n\r\n /* Ensures the mantissa is always  4 digits */\r\nfunction mantissaFourDigits(sci) {\r\n  const i = sci.toLowerCase().indexOf('e');\r\n  if (i < 0) return sci;\r\n\r\n  // --- Normalize mantissa to exactly 4 significant digits (1.xxx) with rounding ---\r\n  const rawMant = sci.slice(0, i);           // e.g., \"3.2\", \"12.34\" (should be 1.x form from toScientific)\r\n  // Build digit string (no dot)\r\n  let ds = rawMant.replace('.', '');\r\n  if (!/^\\d+$/.test(ds)) return sci;         // safety: if parsing failed, bail out\r\n\r\n  // Pad to at least 5 digits (4 kept + 1 for rounding)\r\n  if (ds.length < 5) ds += '0'.repeat(5 - ds.length);\r\n\r\n  // First 4 digits are kept (rounded by the 5th)\r\n  let head = ds.slice(0, 4);\r\n  const next = ds.charCodeAt(4) || 48;       // '0' if missing\r\n  if (next >= 53) head = addOneDigitString(head);\r\n\r\n  // If carry overflow happened (e.g., 9.999 -> 10.00), re-normalize to 1.xxx by shifting\r\n  if (head.length > 4) head = head.slice(0, 4); // head is now \"1000\" after carry; that still prints as \"1.000\" below\r\n\r\n  const mantissa = head.slice(0,1) + '.' + head.slice(1); // \"1.234\" style with trailing zeros preserved\r\n\r\n  // --- Pretty-format the exponent tail (can be \"305\" or \"1e+100\" etc.) ---\r\n  const rawExp = sci.slice(i + 1);\r\n  return mantissa + 'e' + formatExponentChain(rawExp);\r\n}\r\n\r\n// Public API\r\nexport function formatNumber(bn){\r\n  if (!(bn instanceof BigNum)) return String(bn);\r\n  if (bn.isInfinite && bn.isInfinite()) return '<span class=\"infinity-symbol\">\u221E</span>';\r\n  if (bn.isZero()) return '0';\r\n\r\n  const E = bn.decExp ?? (bn.e + (bn.p - 1)); // decimal exponent\r\n\r\n  // Scientific for >= 1e303 (but pretty-print the exponent chain)\r\n  if (E >= 303) {\r\n    return mantissaFourDigits(bn.toScientific(3));\r\n  }\r\n\r\n  // Plain integers < 1e6 \u2192 locale grouping\r\n  if (E < 6) {\r\n    return localeInt(bn.toPlainIntegerString());\r\n  }\r\n\r\n  // Suffix formatting using the legacy table\r\n  const exp = Math.floor(E / 3) * 3;\r\n  const suffix = SUFFIX_BY_EXP.get(exp);\r\n  if (!suffix) return mantissaFourDigits(bn.toScientific(3));\r\n\r\n  const d = E - exp;                 // 0..2\r\n  const intDigits = d + 1;           // 1..3\r\n  const decimals  = 4 - intDigits;   // make FOUR visible digits\r\n  const totalDigits = intDigits + decimals;\r\n\r\n  let s = bn.sig.toString().padStart(bn.p, '0');\r\n  if (s.length < totalDigits + 1) s += '0'.repeat(totalDigits + 1 - s.length);\r\n\r\n  let head = s.slice(0, totalDigits);\r\n  const nextDigit = s.charCodeAt(totalDigits) || 48;\r\n  if (nextDigit >= 53) head = addOneDigitString(head);\r\n\r\n  let intStr, fracStr;\r\n  if (head.length > totalDigits) { intStr = head.slice(0, intDigits + 1); fracStr = '0'.repeat(decimals); }\r\n  else { intStr = head.slice(0, intDigits); fracStr = head.slice(intDigits); }\r\n\r\n  return `${intStr}${decimals ? '.' + fracStr : ''}${suffix}`;\r\n}", "// js/util/storage.js\r\nimport { BigNum } from '../util/bigNum.js';\r\nimport { formatNumber } from '../util/numFormat.js';\r\n\r\nconst PREFIX = 'ccc:';\r\nexport const STORAGE_PREFIX = PREFIX;\r\n\r\nconst SLOT_SIGNATURE_PREFIX = `${PREFIX}slotSig`;\r\nconst SLOT_MODIFIED_PREFIX = `${PREFIX}slotMod`;\r\n\r\nconst MULT_SCALE = 18;\r\nconst MULT_SCALE_TAG = 'XM:';\r\n\r\nconst STORAGE_WATCH_INTERVAL_MS = 140;\r\n\r\nconst storageWatchers = new Map();\r\nlet storageWatcherTimer = null;\r\n\r\nconst currencyChangeSubscribers = new Set();\r\n\r\nfunction normalizeSlotValue(slot) {\r\n  const n = parseInt(slot, 10);\r\n  return Number.isFinite(n) && n > 0 ? n : null;\r\n}\r\n\r\nfunction slotSignatureKey(slot) {\r\n  const normalized = normalizeSlotValue(slot);\r\n  if (normalized == null) return null;\r\n  return `${SLOT_SIGNATURE_PREFIX}:${normalized}`;\r\n}\r\n\r\nfunction slotModifiedKey(slot) {\r\n  const normalized = normalizeSlotValue(slot);\r\n  if (normalized == null) return null;\r\n  return `${SLOT_MODIFIED_PREFIX}:${normalized}`;\r\n}\r\n\r\nfunction notifyCurrencySubscribers(detail = {}) {\r\n  if (currencyChangeSubscribers.size === 0) return;\r\n  currencyChangeSubscribers.forEach((entry) => {\r\n    if (!entry || typeof entry.handler !== 'function') return;\r\n    if (entry.key && detail.key && entry.key !== detail.key) return;\r\n    if (entry.slot != null && detail.slot != null && entry.slot !== detail.slot) return;\r\n    try { entry.handler(detail); }\r\n    catch {}\r\n  });\r\n}\r\n\r\nexport function onCurrencyChange(handler, { key = null, slot = null } = {}) {\r\n  if (typeof handler !== 'function') {\r\n    return () => {};\r\n  }\r\n  const entry = {\r\n    handler,\r\n    key: key ?? null,\r\n    slot: slot ?? null,\r\n  };\r\n  currencyChangeSubscribers.add(entry);\r\n  return () => {\r\n    currencyChangeSubscribers.delete(entry);\r\n  };\r\n}\r\n\r\nfunction ensureStorageWatcherTimer() {\r\n  if (storageWatcherTimer != null || storageWatchers.size === 0) return;\r\n  const root = typeof window !== 'undefined' ? window : globalThis;\r\n  storageWatcherTimer = root.setInterval(runStorageWatchers, STORAGE_WATCH_INTERVAL_MS);\r\n}\r\n\r\nfunction stopStorageWatcherTimerIfIdle() {\r\n  if (storageWatchers.size !== 0 || storageWatcherTimer == null) return;\r\n  const root = typeof window !== 'undefined' ? window : globalThis;\r\n  root.clearInterval(storageWatcherTimer);\r\n  storageWatcherTimer = null;\r\n}\r\n\r\nfunction parseWith(entry, raw) {\r\n  if (!entry || typeof entry.parse !== 'function') return raw;\r\n  try {\r\n    return entry.parse(raw);\r\n  } catch {\r\n    return raw;\r\n  }\r\n}\r\n\r\nfunction valuesEqual(entry, a, b) {\r\n  if (!entry || typeof entry.equals !== 'function') {\r\n    return Object.is(a, b);\r\n  }\r\n  try {\r\n    return entry.equals(a, b);\r\n  } catch {\r\n    return Object.is(a, b);\r\n  }\r\n}\r\n\r\nfunction runStorageWatchers() {\r\n  if (storageWatchers.size === 0) {\r\n    stopStorageWatcherTimerIfIdle();\r\n    return;\r\n  }\r\n  storageWatchers.forEach((entries, key) => {\r\n    if (!entries || entries.size === 0) return;\r\n    let raw;\r\n    try {\r\n      raw = localStorage.getItem(key);\r\n    } catch {\r\n      raw = null;\r\n    }\r\n    entries.forEach((entry) => {\r\n      if (!entry) return;\r\n      const parsed = parseWith(entry, raw);\r\n      if (!entry.initialized) {\r\n        entry.lastRaw = raw;\r\n        entry.lastValue = parsed;\r\n        entry.initialized = true;\r\n        if (entry.emitCurrentValue) {\r\n          try {\r\n            entry.onChange?.(parsed, {\r\n              key,\r\n              raw,\r\n              previous: undefined,\r\n              previousRaw: undefined,\r\n              initial: true,\r\n              rawChanged: true,\r\n              valueChanged: true,\r\n            });\r\n          } catch {}\r\n        }\r\n        return;\r\n      }\r\n      const rawChanged = raw !== entry.lastRaw;\r\n      const valueChanged = !valuesEqual(entry, entry.lastValue, parsed);\r\n      if (!rawChanged && !valueChanged) return;\r\n      const previousValue = entry.lastValue;\r\n      const previousRaw = entry.lastRaw;\r\n      entry.lastRaw = raw;\r\n      entry.lastValue = parsed;\r\n      try {\r\n        entry.onChange?.(parsed, {\r\n          key,\r\n          raw,\r\n          previous: previousValue,\r\n          previousRaw,\r\n          rawChanged,\r\n          valueChanged,\r\n        });\r\n      } catch {}\r\n    });\r\n  });\r\n}\r\n\r\nexport function watchStorageKey(key, {\r\n  parse,\r\n  equals,\r\n  onChange,\r\n  emitCurrentValue = false,\r\n} = {}) {\r\n  if (!key || typeof localStorage === 'undefined') {\r\n    return () => {};\r\n  }\r\n  const entry = {\r\n    parse,\r\n    equals,\r\n    onChange,\r\n    emitCurrentValue,\r\n    lastRaw: undefined,\r\n    lastValue: undefined,\r\n    initialized: false,\r\n  };\r\n  let set = storageWatchers.get(key);\r\n  if (!set) {\r\n    set = new Set();\r\n    storageWatchers.set(key, set);\r\n  }\r\n  set.add(entry);\r\n  ensureStorageWatcherTimer();\r\n  return () => {\r\n    const entries = storageWatchers.get(key);\r\n    if (!entries) return;\r\n    entries.delete(entry);\r\n    if (entries.size === 0) {\r\n      storageWatchers.delete(key);\r\n      stopStorageWatcherTimerIfIdle();\r\n    }\r\n  };\r\n}\r\n\r\nexport function primeStorageWatcherSnapshot(key, rawValue) {\r\n  if (!key) return;\r\n  const entries = storageWatchers.get(key);\r\n  if (!entries || entries.size === 0) return;\r\n  let raw = rawValue;\r\n  if (raw === undefined) {\r\n    try {\r\n      raw = localStorage.getItem(key);\r\n    } catch {\r\n      raw = null;\r\n    }\r\n  }\r\n  entries.forEach((entry) => {\r\n    if (!entry) return;\r\n    entry.lastRaw = raw;\r\n    entry.lastValue = parseWith(entry, raw);\r\n    entry.initialized = true;\r\n  });\r\n}\r\n\r\nfunction bigNumEquals(a, b) {\r\n  if (a === b) return true;\r\n  if (a == null || b == null) return a == null && b == null;\r\n  if (a instanceof BigNum && typeof a.cmp === 'function') {\r\n    try { return a.cmp(b) === 0; } catch {}\r\n  }\r\n  if (b instanceof BigNum && typeof b.cmp === 'function') {\r\n    try { return b.cmp(a) === 0; } catch {}\r\n  }\r\n  if (typeof a?.cmp === 'function') {\r\n    try { return a.cmp(b) === 0; } catch {}\r\n  }\r\n  if (typeof b?.cmp === 'function') {\r\n    try { return b.cmp(a) === 0; } catch {}\r\n  }\r\n  try {\r\n    return Object.is(String(a), String(b));\r\n  } catch {\r\n    return Object.is(a, b);\r\n  }\r\n}\r\n\r\nfunction parseBigNumOrZero(raw) {\r\n  if (raw == null) return BigNum.fromInt(0);\r\n  try {\r\n    return BigNum.fromAny(raw);\r\n  } catch {\r\n    return BigNum.fromInt(0);\r\n  }\r\n}\r\n\r\nconst currencyWatcherCleanup = new Map();\r\nlet currencyWatcherBoundSlot = null;\r\n\r\nfunction cleanupCurrencyWatchers() {\r\n  currencyWatcherCleanup.forEach((stop) => {\r\n    try { stop?.(); } catch {}\r\n  });\r\n  currencyWatcherCleanup.clear();\r\n}\r\n\r\nfunction bindCurrencyWatchersForSlot(slot) {\r\n  if (slot === currencyWatcherBoundSlot) return;\r\n  cleanupCurrencyWatchers();\r\n  currencyWatcherBoundSlot = slot ?? null;\r\n  if (slot == null) return;\r\n  for (const currencyKey of Object.values(CURRENCIES)) {\r\n    const storageKey = `${KEYS.CURRENCY[currencyKey]}:${slot}`;\r\n    const stop = watchStorageKey(storageKey, {\r\n      parse: parseBigNumOrZero,\r\n      equals: bigNumEquals,\r\n      onChange: (value, meta) => {\r\n        if (!meta?.valueChanged) return;\r\n        if (typeof window === 'undefined') return;\r\n        const detail = { key: currencyKey, value, slot };\r\n        notifyCurrencySubscribers(detail);\r\n        try {\r\n          window.dispatchEvent(new CustomEvent('currency:change', { detail }));\r\n        } catch {}\r\n      },\r\n    });\r\n    currencyWatcherCleanup.set(storageKey, stop);\r\n  }\r\n}\r\n\r\nfunction initCurrencyStorageWatchers() {\r\n  if (typeof window === 'undefined') return;\r\n  bindCurrencyWatchersForSlot(getActiveSlot());\r\n  window.addEventListener('saveSlot:change', () => {\r\n    bindCurrencyWatchersForSlot(getActiveSlot());\r\n  });\r\n}\r\n\r\n// -------------------- KEYS --------------------\r\nexport const KEYS = {\r\n  HAS_OPENED_SAVE_SLOT: `${PREFIX}hasOpenedSaveSlot`,\r\n  SAVE_SLOT:            `${PREFIX}saveSlot`,\r\n  CURRENCY:   {},\r\n  MULTIPLIER: {},\r\n};\r\n\r\n// -------------------- CURRENCIES --------------------\r\nexport const CURRENCIES = {\r\n  COINS: 'coins',\r\n  BOOKS: 'books',\r\n  GOLD: 'gold',\r\n};\r\n\r\nexport function getActiveSlot() {\r\n  const raw = localStorage.getItem(KEYS.SAVE_SLOT);\r\n  const n = parseInt(raw, 10);\r\n  return Number.isFinite(n) && n > 0 ? n : null;\r\n}\r\nexport function setActiveSlot(n) {\r\n  const v = Math.max(1, parseInt(n, 10) || 1);\r\n  localStorage.setItem(KEYS.SAVE_SLOT, String(v));\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('saveSlot:change', { detail: { slot: v } }));\r\n  } catch {}\r\n}\r\n\r\nfunction keyFor(base, slot = getActiveSlot()) {\r\n  if (slot == null) return null;\r\n  return `${base}:${slot}`;\r\n}\r\n\r\nfunction isDebugLocked(key) {\r\n  try {\r\n    const lockedKeys = globalThis?.__cccLockedStorageKeys;\r\n    return lockedKeys?.has?.(key) ?? false;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function getSlotSignatureKey(slot = getActiveSlot()) {\r\n  return slotSignatureKey(slot);\r\n}\r\n\r\nexport function getSlotModifiedFlagKey(slot = getActiveSlot()) {\r\n  return slotModifiedKey(slot);\r\n}\r\n\r\nexport function getSlotSignature(slot = getActiveSlot()) {\r\n  if (typeof localStorage === 'undefined') return null;\r\n  const key = slotSignatureKey(slot);\r\n  if (!key) return null;\r\n  try { return localStorage.getItem(key); }\r\n  catch { return null; }\r\n}\r\n\r\nexport function setSlotSignature(slot, signature) {\r\n  if (typeof localStorage === 'undefined') return;\r\n  const key = slotSignatureKey(slot);\r\n  if (!key) return;\r\n  try {\r\n    if (signature == null) {\r\n      localStorage.removeItem(key);\r\n    } else {\r\n      localStorage.setItem(key, String(signature));\r\n    }\r\n  } catch {}\r\n}\r\n\r\nexport function hasModifiedSave(slot = getActiveSlot()) {\r\n  if (typeof localStorage === 'undefined') return false;\r\n  const key = slotModifiedKey(slot);\r\n  if (!key) return false;\r\n  try { return localStorage.getItem(key) === '1'; }\r\n  catch { return false; }\r\n}\r\n\r\nexport function markSaveSlotModified(slot = getActiveSlot()) {\r\n  if (typeof localStorage === 'undefined') return;\r\n  const normalized = normalizeSlotValue(slot);\r\n  if (normalized == null) return;\r\n  if (hasModifiedSave(normalized)) return;\r\n  const key = slotModifiedKey(normalized);\r\n  if (!key) return;\r\n  try {\r\n    localStorage.setItem(key, '1');\r\n  } catch { return; }\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('saveSlot:modified', { detail: { slot: normalized } }));\r\n  } catch {}\r\n}\r\n\r\n\r\nfor (const key of Object.values(CURRENCIES)) {\r\n  KEYS.CURRENCY[key]   = `${PREFIX}${key}`;\r\n  KEYS.MULTIPLIER[key] = `${PREFIX}mult:${key}`; // one key only\r\n}\r\n\r\ninitCurrencyStorageWatchers();\r\n\r\n// -------------------- SAVE-SLOT HELPERS --------------------\r\nexport function getHasOpenedSaveSlot() {\r\n  return localStorage.getItem(KEYS.HAS_OPENED_SAVE_SLOT) === 'true';\r\n}\r\nexport function setHasOpenedSaveSlot(value) {\r\n  localStorage.setItem(KEYS.HAS_OPENED_SAVE_SLOT, value ? 'true' : 'false');\r\n}\r\n\r\n// -------------------- DEFAULTS --------------------\r\nexport function ensureStorageDefaults() {\r\n  if (localStorage.getItem(KEYS.HAS_OPENED_SAVE_SLOT) === null) {\r\n    setHasOpenedSaveSlot(false);\r\n  }\r\n}\r\n\r\nexport function ensureCurrencyDefaults() {\r\n  const slot = getActiveSlot();\r\n  if (slot == null) return; // only seed AFTER a slot is chosen\r\n  for (const key of Object.values(CURRENCIES)) {\r\n    const k = `${KEYS.CURRENCY[key]}:${slot}`;\r\n    if (!localStorage.getItem(k)) localStorage.setItem(k, '0');\r\n  }\r\n}\r\n\r\nexport function ensureMultiplierDefaults() {\r\n  const slot = getActiveSlot();\r\n  if (slot == null) return; // only seed AFTER a slot is chosen\r\n  for (const key of Object.values(CURRENCIES)) {\r\n    const km = `${KEYS.MULTIPLIER[key]}:${slot}`;\r\n    if (!localStorage.getItem(km)) {\r\n      const theor = scaledFromIntBN(BigNum.fromInt(1));\r\n      setMultiplierScaled(key, theor);\r\n    } else {\r\n      getMultiplierScaled(key);\r\n    }\r\n  }\r\n}\r\n\r\n// -------------------- AMOUNTS (BN) --------------------\r\nexport function getCurrency(key) {\r\n  const k = keyFor(KEYS.CURRENCY[key]);\r\n  if (!k) return BigNum.fromInt(0);\r\n  const raw = localStorage.getItem(k);\r\n  if (!raw) return BigNum.fromInt(0);\r\n  try { return BigNum.fromAny(raw); } catch { return BigNum.fromInt(0); }\r\n}\r\n\r\nexport function setCurrency(key, value, { delta = null, previous = null } = {}) {\r\n  const slot = getActiveSlot();\r\n  const k = keyFor(KEYS.CURRENCY[key], slot);\r\n  const prev = previous ?? getCurrency(key);\r\n  if (!k) return prev;\r\n  if (isCurrencyLocked(key, slot)) {\r\n    let deltaBn = null;\r\n    if (delta) {\r\n      try {\r\n        deltaBn = delta instanceof BigNum ? delta.clone?.() ?? delta : BigNum.fromAny(delta);\r\n      } catch { deltaBn = null; }\r\n    }\r\n    const detail = { key, value: prev, slot, delta: deltaBn ?? undefined };\r\n    notifyCurrencySubscribers(detail);\r\n    try { window.dispatchEvent(new CustomEvent('currency:change', { detail })); } catch {}\r\n    return prev;\r\n  } // Respect debug-panel storage locks\r\n\r\n  let bn;\r\n  try { bn = BigNum.fromAny(value); }\r\n  catch { bn = BigNum.fromInt(0); }\r\n  if (bn.isNegative?.()) bn = BigNum.fromInt(0);\r\n\r\n  const expectedRaw = bn.toStorage();\r\n\r\n  try { localStorage.setItem(k, expectedRaw); }\r\n  catch {}\r\n\r\n  let persistedRaw = null;\r\n  try { persistedRaw = localStorage.getItem(k); }\r\n  catch {}\r\n\r\n  const effectiveRaw = persistedRaw ?? expectedRaw;\r\n  let effective = bn;\r\n  try {\r\n    if (persistedRaw != null) {\r\n      effective = BigNum.fromAny(persistedRaw);\r\n      if (effective.isNegative?.()) effective = BigNum.fromInt(0);\r\n    }\r\n  } catch {}\r\n\r\n  primeStorageWatcherSnapshot(k, effectiveRaw);\r\n\r\n  const changed = !bigNumEquals(prev, effective);\r\n  if (changed) {\r\n    let deltaBn = null;\r\n    try { deltaBn = effective.sub?.(prev); }\r\n    catch {}\r\n    if (!deltaBn && delta) {\r\n      try { deltaBn = delta instanceof BigNum ? delta : BigNum.fromAny(delta); }\r\n      catch { deltaBn = null; }\r\n    }\r\n    const detail = { key, value: effective, slot, delta: deltaBn ?? undefined };\r\n    notifyCurrencySubscribers(detail);\r\n    try { window.dispatchEvent(new CustomEvent('currency:change', { detail })); } catch {}\r\n  }\r\n\r\n  return effective;\r\n}\r\n\r\nfunction scaledFromIntBN(intBN) {\r\n  return intBN.mulScaledIntFloor(1n, -MULT_SCALE);\r\n}\r\n\r\n// theoretical (\u00D710^MULT_SCALE) \u2192 integer BN multiplier (floor), min 1\r\nfunction intFromScaled(theorBN) {\r\n  const bn = BigNum.fromAny(theorBN);\r\n  if (bn.isInfinite()) return bn.clone();\r\n  const scaled = bn.mulScaledIntFloor(1n, MULT_SCALE);\r\n  if (scaled.isZero()) return BigNum.fromInt(1);\r\n  return scaled;\r\n}\r\n\r\nfunction getMultiplierScaled(key) {\r\n  const k = keyFor(KEYS.MULTIPLIER[key]);\r\n  if (!k) return scaledFromIntBN(BigNum.fromInt(1));\r\n  const raw = localStorage.getItem(k);\r\n  if (!raw || !raw.startsWith(MULT_SCALE_TAG)) {\r\n    const theor = scaledFromIntBN(BigNum.fromInt(1));\r\n    setMultiplierScaled(key, theor);\r\n    return theor;\r\n  }\r\n  const payload = raw.slice(MULT_SCALE_TAG.length);\r\n  try { return BigNum.fromAny(payload); } catch {\r\n    const theor = scaledFromIntBN(BigNum.fromInt(1));\r\n    setMultiplierScaled(key, theor);\r\n    return theor;\r\n  }\r\n}\r\n\r\nfunction setMultiplierScaled(key, theoreticalBN, slot = getActiveSlot()) {\r\n  const k = keyFor(KEYS.MULTIPLIER[key], slot);\r\n  if (!k) return;\r\n  if (isCurrencyLocked(key, slot)) return; // Respect debug-panel storage locks\r\n  let prev = scaledFromIntBN(BigNum.fromInt(1));\r\n  const existingRaw = localStorage.getItem(k);\r\n  if (existingRaw?.startsWith?.(MULT_SCALE_TAG)) {\r\n    try {\r\n      prev = BigNum.fromAny(existingRaw.slice(MULT_SCALE_TAG.length));\r\n    } catch {}\r\n  }\r\n  const bn = BigNum.fromAny(theoreticalBN);\r\n  const raw = MULT_SCALE_TAG + bn.toStorage();\r\n  try { localStorage.setItem(k, raw); }\r\n  catch {}\r\n\r\n  let persistedRaw = null;\r\n  try { persistedRaw = localStorage.getItem(k); }\r\n  catch {}\r\n\r\n  const effectiveRaw = persistedRaw ?? raw;\r\n  let effective = bn;\r\n  try {\r\n    const payload = effectiveRaw?.startsWith?.(MULT_SCALE_TAG)\r\n      ? effectiveRaw.slice(MULT_SCALE_TAG.length)\r\n      : null;\r\n    if (payload != null) effective = BigNum.fromAny(payload);\r\n  } catch {}\r\n  // Keep any live storage watchers (and save-integrity snapshots) aligned with the\r\n  // freshly-written multiplier so follow-up writes don't look like manual tampering.\r\n  try { primeStorageWatcherSnapshot(k, effectiveRaw); } catch {}\r\n  if (!bigNumEquals(prev, effective)) {\r\n    try {\r\n      window.dispatchEvent(new CustomEvent('currency:multiplier', {\r\n        detail: { key, mult: intFromScaled(effective), slot }\r\n      }));\r\n    } catch {}\r\n  }\r\n}\r\n\r\nexport function getCurrencyMultiplierBN(key) {\r\n  return intFromScaled(getMultiplierScaled(key));\r\n}\r\n\r\nexport function isCurrencyLocked(key, slot = getActiveSlot()) {\r\n  const k = keyFor(KEYS.CURRENCY[key], slot);\r\n  return isDebugLocked(k);\r\n}\r\n\r\n// public set integer BN multiplier (stored as scaled theoretical)\r\nexport function setCurrencyMultiplierBN(key, intBNValue) {\r\n  const v = BigNum.fromAny(intBNValue);\r\n  const theor = scaledFromIntBN(v);\r\n  setMultiplierScaled(key, theor, getActiveSlot());\r\n  return v;\r\n}\r\n\r\nexport function peekCurrency(slot, key) {\r\n  const raw = localStorage.getItem(`${KEYS.CURRENCY[key]}:${slot}`);\r\n  if (!raw) return BigNum.fromInt(0);\r\n  try { return BigNum.fromAny(raw); } catch { return BigNum.fromInt(0); }\r\n}\r\n\r\n// -------------------- UTILITIES --------------------\r\nexport function clearAllStorage() {\r\n  Object.values(KEYS).forEach((v) => {\r\n    if (typeof v === 'string') {\r\n      localStorage.removeItem(v);\r\n    } else if (typeof v === 'object') {\r\n      Object.values(v).forEach((sub) => localStorage.removeItem(sub));\r\n    }\r\n  });\r\n}\r\n\r\n// -------------------- BANK FACADE --------------------\r\nfunction makeCurrencyHandle(key) {\r\n  // callable preview: bank.coins(\"1e3\")\r\n  const fn = (x) => {\r\n    try {\r\n      const bn = BigNum.fromAny(x);\r\n      return typeof formatNumber === 'function' ? formatNumber(bn) : bn.toString();\r\n    } catch {\r\n      return 'NaN';\r\n    }\r\n  };\r\n\r\n  Object.defineProperty(fn, 'value', {\r\n    get() { return getCurrency(key); }\r\n  });\r\n\r\n  fn.toString = function toString() {\r\n    return this.value.toString();\r\n  };\r\n\r\n  // amount mutations\r\n  fn.add = function add(x) {\r\n    const amt  = BigNum.fromAny(x);\r\n    const next = this.value.add(amt);\r\n    const effective = setCurrency(key, next, { delta: amt, previous: this.value });\r\n    return effective;\r\n  };\r\n\r\nfn.sub = function sub(x) {\r\n  const amt = BigNum.fromAny(x);\r\n  const cur = this.value;\r\n\r\n  let next = cur.sub(amt);\r\n  if (next.isNegative?.()) next = BigNum.fromInt(0);\r\n\r\n  setCurrency(key, next);\r\n  return next;\r\n};\r\n\r\n  fn.set = function set(x) {\r\n    const val = BigNum.fromAny(x);\r\n    let delta = null;\r\n    let current;\r\n    try {\r\n      current = this.value;\r\n      if (current && typeof current.sub === 'function') {\r\n        delta = val.sub(current);\r\n      }\r\n    } catch {}\r\n    const effective = setCurrency(key, val, { delta, previous: current });\r\n    return effective;\r\n  };\r\n\r\n  fn.fmt = function fmt(x) {\r\n    const bn = BigNum.fromAny(x);\r\n    return typeof formatNumber === 'function' ? formatNumber(bn) : bn.toString();\r\n  };\r\n\r\n  // multiplier API (single-key theoretical + floor)\r\n  fn.mult = {\r\n    get() {\r\n      return getCurrencyMultiplierBN(key);\r\n    },\r\n    set(x) {\r\n      return setCurrencyMultiplierBN(key, x);\r\n    },\r\n    multiplyByInt(x) {\r\n      const factor = BigNum.fromAny(x).floorToInteger();\r\n      let theor = getMultiplierScaled(key).mulBigNumInteger(factor);\r\n      if (theor.isZero()) theor = scaledFromIntBN(BigNum.fromInt(1));\r\n      setMultiplierScaled(key, theor);\r\n      return intFromScaled(theor);\r\n    },\r\n    multiplyByDecimal(x) {\r\n      // parse \"1.2\" \u2192 { numer, scale }\r\n      let parsed;\r\n      try { parsed = BigNum._parseDecimalMultiplier(String(x), MULT_SCALE); }\r\n      catch { parsed = { numer: 1n, scale: 0 }; }\r\n      let theor = getMultiplierScaled(key).mulScaledIntFloor(parsed.numer, parsed.scale);\r\n      if (theor.isZero()) theor = scaledFromIntBN(BigNum.fromInt(1));\r\n      setMultiplierScaled(key, theor);\r\n      const next = intFromScaled(theor);\r\n      return next.isZero() ? BigNum.fromInt(1) : next;\r\n    },\r\n    multiplyByPercent(pct) {\r\n      const factor = (Number(pct) / 100) + 1;\r\n      return this.multiplyByDecimal(String(factor));\r\n    },\r\n    applyTo(amount) {\r\n      const mult = this.get();\r\n      if (mult.isInfinite()) {\r\n        return BigNum.fromAny('Infinity');\r\n      }\r\n      const amt = BigNum.fromAny(amount, mult.p);\r\n      if (amt.isZero() || mult.isZero()) return amt.clone();\r\n      return amt.mulBigNumInteger(mult);\r\n    }\r\n  };\r\n\r\n  fn.addWithMultiplier = function addWithMultiplier(baseAmount) {\r\n    const inc = fn.mult.applyTo(baseAmount);\r\n    return fn.add(inc);\r\n  };\r\n\r\n  return fn;\r\n}\r\n\r\nexport const bank = new Proxy({}, {\r\n  get(_, prop) {\r\n    if (Object.values(CURRENCIES).includes(prop)) return makeCurrencyHandle(prop);\r\n    if (typeof prop === 'string' && CURRENCIES[prop.toUpperCase?.()]) {\r\n      return makeCurrencyHandle(CURRENCIES[prop.toUpperCase()]);\r\n    }\r\n    return undefined;\r\n  }\r\n});\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.bank = bank;\r\n  window.coins = bank.coins;\r\n  window.books = bank.books;\r\n}", "// js/util/slotsManager.js\r\nimport { KEYS, getActiveSlot } from './storage.js';\r\nimport { refreshSlotsView } from './slots.js';\r\n\r\nlet deleteMode = false;\r\nlet initialized = false;\r\n\r\nexport function isDeleteMode() { return deleteMode; }\r\n\r\nfunction setDeleteMode(on) {\r\n  deleteMode = !!on;\r\n  document.body.classList.toggle('slots-delete-mode', deleteMode);\r\n\r\n  const btn = document.getElementById('manage-saves');\r\n  if (btn) btn.textContent = deleteMode ? 'Done' : 'Manage save slots';\r\n\r\n  document.querySelectorAll('.slot-card').forEach((card) => {\r\n    card.classList.toggle('is-deleting', deleteMode);\r\n    card.setAttribute('aria-pressed', deleteMode ? 'true' : 'false');\r\n  });\r\n}\r\n\r\nfunction removeAllKeysForSlot(slot) {\r\n  const re = new RegExp(`^ccc:.*:${slot}$`);\r\n  const toRemove = [];\r\n  for (let i = 0; i < localStorage.length; i++) {\r\n    const k = localStorage.key(i);\r\n    if (re.test(k)) toRemove.push(k);\r\n  }\r\n  toRemove.forEach((k) => localStorage.removeItem(k));\r\n}\r\n\r\nexport function initSlotsManager() {\r\n  if (initialized) return;\r\n  initialized = true;\r\n\r\n  const manageBtn = document.getElementById('manage-saves');\r\n  const grid = document.querySelector('.slots-grid');\r\n  if (!manageBtn || !grid) return;\r\n\r\n  manageBtn.addEventListener('click', (e) => {\r\n    e.preventDefault();\r\n    setDeleteMode(!deleteMode);\r\n  });\r\n\r\n  window.addEventListener('keydown', (e) => {\r\n    if (deleteMode && e.key === 'Escape') setDeleteMode(false);\r\n  });\r\n\r\n  // Capture early to block the regular slot click handler\r\n  const onPointerDownCapture = (e) => {\r\n    if (!deleteMode) return;\r\n    const card = e.target.closest('.slot-card');\r\n    if (!card) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  const onClickCapture = (e) => {\r\n    if (!deleteMode) return;\r\n    const card = e.target.closest('.slot-card');\r\n    if (!card) return;\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    // Figure out slot number\r\n    let slot = parseInt(card.dataset.slot, 10);\r\n    if (!Number.isFinite(slot) || slot <= 0) {\r\n      const cards = Array.from(document.querySelectorAll('.slot-card'));\r\n      slot = cards.indexOf(card) + 1;\r\n    }\r\n\r\n    // Only delete if slot has data\r\n    const hasData = localStorage.getItem(`ccc:coins:${slot}`) !== null;\r\n    if (!hasData) {\r\n      alert(`Slot ${slot} has no save data.`);\r\n      return;\r\n    }\r\n\r\n    if (!confirm(`Delete save data in Slot ${slot}? This cannot be undone.`)) return;\r\n\r\n    removeAllKeysForSlot(slot);\r\n\r\n    if (getActiveSlot() === slot) {\r\n      try { localStorage.removeItem(KEYS.SAVE_SLOT); } catch {}\r\n    }\r\n\r\n    refreshSlotsView();\r\n    setDeleteMode(false);\r\n  };\r\n\r\n  grid.addEventListener('pointerdown', onPointerDownCapture, true); // capture\r\n  grid.addEventListener('click', onClickCapture, true);             // capture\r\n\r\n  setDeleteMode(false);\r\n}\r\n\r\n// Auto-init in case nothing imports us explicitly\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  try { initSlotsManager(); } catch {}\r\n});\r\n", "import { BigNum } from './bigNum.js';\r\nimport './slotsManager.js';\r\nimport {\r\n  setHasOpenedSaveSlot,\r\n  ensureCurrencyDefaults,\r\n  ensureMultiplierDefaults,\r\n  setActiveSlot,\r\n  peekCurrency,\r\n} from './storage.js';\r\n\r\n// A slot is considered \"used\" once it has a coins key at all (even if 0)\r\nfunction hasSlotData(slot) {\r\n  return localStorage.getItem(`ccc:coins:${slot}`) !== null;\r\n}\r\n\r\nfunction coinsTextFor(slot) {\r\n  if (!hasSlotData(slot)) return 'No save data';\r\n  try {\r\n    const bn = peekCurrency(slot, 'coins'); // BigNum\r\n    return `Coins: ${bn.toString()}`;\r\n  } catch {\r\n    return 'Coins: 0';\r\n  }\r\n}\r\n\r\nfunction renderSlotCards() {\r\n  const cards = document.querySelectorAll('.slot-card');\r\n  cards.forEach((btn, idx) => {\r\n    const slot = idx + 1;\r\n    const titleEl = btn.querySelector('.slot-title');\r\n\r\n    if (titleEl) titleEl.textContent = coinsTextFor(slot);\r\n\r\n    btn.dataset.slot = String(slot);\r\n  });\r\n}\r\n\r\nexport function initSlots(onSelect) {\r\n  const cards = document.querySelectorAll('.slot-card');\r\n\r\n  // Initial paint\r\n  renderSlotCards();\r\n\r\n  cards.forEach((btn, idx) => {\r\n    const slotNum = idx + 1;\r\n    btn.addEventListener('click', (ev) => {\r\n      ev.preventDefault();\r\n\r\n      // Switch to this slot and seed its defaults the first time it\u2019s opened\r\n      setActiveSlot(slotNum);\r\n      ensureCurrencyDefaults();\r\n      ensureMultiplierDefaults();\r\n\r\n      setHasOpenedSaveSlot(true);\r\n      if (typeof onSelect === 'function') onSelect(slotNum, ev);\r\n\r\n      // Repaint card titles after seeding\r\n      renderSlotCards();\r\n    });\r\n  });\r\n}\r\n\r\nexport function refreshSlotsView() { renderSlotCards(); }\r\n", "// js/util/audioCache.js\r\n\r\nconst cache = new Map();\r\n\r\nconst normalize = (src) => {\r\n  try {\r\n    return new URL(src, document.baseURI).href;\r\n  } catch (_) {\r\n    return src;\r\n  }\r\n};\r\n\r\nexport function registerPreloadedAudio(src, element) {\r\n  const key = normalize(src);\r\n  if (!key || !element) return;\r\n  element.pause?.();\r\n  try { element.currentTime = 0; } catch (_) {}\r\n  cache.set(key, element);\r\n}\r\n\r\nexport function takePreloadedAudio(src) {\r\n  const key = normalize(src);\r\n  if (!cache.has(key)) return null;\r\n  const el = cache.get(key);\r\n  cache.delete(key);\r\n  return el;\r\n}", "// js/ui/hudLayout.js\r\n\r\nexport function syncXpMpHudLayout() {\r\n  if (typeof document === 'undefined') return;\r\n  const hud = document.querySelector('.hud-top');\r\n  if (!hud) return;\r\n\r\n  const xpEl = document.querySelector('[data-xp-hud]');\r\n  const mpEl = document.querySelector('[data-mp-hud]');\r\n  const xpVisible = !!(xpEl && !xpEl.hasAttribute('hidden'));\r\n  const mpVisible = !!(mpEl && !mpEl.hasAttribute('hidden'));\r\n\r\n  hud.classList.toggle('hud-top--xp-only', xpVisible && !mpVisible);\r\n  hud.classList.toggle('hud-top--xp-mp', xpVisible && mpVisible);\r\n\r\n  if (!xpVisible && !mpVisible) {\r\n    hud.classList.remove('hud-top--xp-only', 'hud-top--xp-mp');\r\n  }\r\n}", "// js/game/xpSystem.js\r\n\r\nimport { BigNum } from '../util/bigNum.js';\r\nimport { bank, getActiveSlot, watchStorageKey, primeStorageWatcherSnapshot } from '../util/storage.js';\r\nimport { applyStatMultiplierOverride } from '../util/debugPanel.js';\r\nimport { formatNumber } from '../util/numFormat.js';\r\nimport { syncXpMpHudLayout } from '../ui/hudLayout.js';\r\n\r\nconst KEY_PREFIX = 'ccc:xp';\r\nconst KEY_UNLOCK = (slot) => `${KEY_PREFIX}:unlocked:${slot}`;\r\nconst KEY_XP_LEVEL = (slot) => `${KEY_PREFIX}:level:${slot}`;\r\nconst KEY_PROGRESS = (slot) => `${KEY_PREFIX}:progress:${slot}`;\r\n\r\nexport function getXpLevelStorageKey(slot = getActiveSlot()) {\r\n  const resolvedSlot = slot ?? getActiveSlot();\r\n  return resolvedSlot == null ? null : KEY_XP_LEVEL(resolvedSlot);\r\n}\r\n\r\nlet lastSlot = null;\r\nlet stateLoaded = false;\r\nlet requirementBn = BigNum.fromInt(10);\r\nconst xpRequirementCache = new Map();\r\nxpRequirementCache.set('0', requirementBn);\r\nlet highestCachedExactLevel = 0n;\r\nconst infinityRequirementBn = BigNum.fromAny('Infinity');\r\n\r\nlet lastSyncedCoinLevel = null;\r\nlet lastSyncedCoinLevelWasInfinite = false;\r\nlet lastSyncedCoinUsedApproximation = false;\r\nlet lastSyncedCoinApproxKey = null;\r\nlet externalCoinMultiplierProvider = null;\r\nlet externalXpGainMultiplierProvider = null;\r\nconst coinMultiplierProviders = new Set();\r\nconst xpGainMultiplierProviders = new Set();\r\nlet externalBookRewardProvider = null;\r\n\r\nconst EXACT_REQUIREMENT_CACHE_LEVEL = 5000n;\r\nconst LOG_STEP = Math.log10(11 / 10);\r\nconst LOG_DECADE_BONUS = Math.log10(5 / 2);\r\nconst EXACT_COIN_LEVEL_LIMIT = 200n;\r\nconst LOG_STEP_DECIMAL = '0.04139268515822507';\r\nconst LOG_DECADE_BONUS_DECIMAL = '0.3979400086720376';\r\nconst TEN_DIVISOR_DECIMAL = '0.1';\r\nconst maxLog10Bn = BigNum.fromScientific(String(BigNum.MAX_E));\r\n\r\nfunction bigIntToFloatApprox(value) {\r\n  if (value === 0n) return 0;\r\n  const str = value.toString();\r\n  const len = str.length;\r\n  const headDigits = Math.min(len, 15);\r\n  const head = Number(str.slice(0, headDigits));\r\n  const exponent = len - headDigits;\r\n  if (!Number.isFinite(head)) return Number.POSITIVE_INFINITY;\r\n  const scaled = head * Math.pow(10, exponent);\r\n  return Number.isFinite(scaled) ? scaled : Number.POSITIVE_INFINITY;\r\n}\r\n\r\nfunction bigNumIsInfinite(bn) {\r\n  return !!(bn && typeof bn === 'object' && (bn.isInfinite?.() || (typeof bn.isInfinite === 'function' && bn.isInfinite())));\r\n}\r\n\r\nfunction bigNumIsZero(bn) {\r\n  return !bn || typeof bn !== 'object' || (bn.isZero?.() || (typeof bn.isZero === 'function' && bn.isZero()));\r\n}\r\n\r\nfunction bigNumToFiniteNumber(bn) {\r\n  if (!bn || typeof bn !== 'object') return 0;\r\n  if (bigNumIsInfinite(bn)) return Number.POSITIVE_INFINITY;\r\n  const sci = typeof bn.toScientific === 'function' ? bn.toScientific(18) : String(bn);\r\n  if (!sci || sci === 'Infinity') return Number.POSITIVE_INFINITY;\r\n  const match = sci.match(/^([0-9]+(?:\\.[0-9]+)?)e([+-]?\\d+)$/i);\r\n  if (match) {\r\n    const mant = parseFloat(match[1]);\r\n    const exp = parseInt(match[2], 10);\r\n    if (!Number.isFinite(mant) || !Number.isFinite(exp)) return Number.POSITIVE_INFINITY;\r\n    if (exp >= 309) return Number.POSITIVE_INFINITY;\r\n    return mant * Math.pow(10, exp);\r\n  }\r\n  const num = Number(sci);\r\n  return Number.isFinite(num) ? num : Number.POSITIVE_INFINITY;\r\n}\r\n\r\nfunction logBigNumToNumber(bn) {\r\n  if (!bn || typeof bn !== 'object') return 0;\r\n  if (bigNumIsInfinite(bn)) return Number.POSITIVE_INFINITY;\r\n  if (typeof bn.cmp === 'function' && bn.cmp(maxLog10Bn) >= 0) {\r\n    return Number.POSITIVE_INFINITY;\r\n  }\r\n  return bigNumToFiniteNumber(bn);\r\n}\r\n\r\nfunction computeBonusCountBn(levelBn) {\r\n  if (!levelBn || typeof levelBn !== 'object') return BigNum.fromInt(0);\r\n  const divided = levelBn.mulDecimal(TEN_DIVISOR_DECIMAL, 1);\r\n  const floored = divided.floorToInteger();\r\n  if (typeof divided.cmp === 'function' && divided.cmp(floored) === 0) {\r\n    if (floored.isZero?.() || (typeof floored.isZero === 'function' && floored.isZero())) {\r\n      return floored;\r\n    }\r\n    return floored.sub?.(bnOne()) ?? BigNum.fromInt(0);\r\n  }\r\n  return floored;\r\n}\r\n\r\nfunction computeLevelLogTerm(levelBn) {\r\n  if (!levelBn || typeof levelBn !== 'object') return BigNum.fromInt(0);\r\n  return levelBn.mulDecimal(LOG_STEP_DECIMAL, 18);\r\n}\r\n\r\nfunction computeBonusLogTerm(levelBn) {\r\n  const bonusCount = computeBonusCountBn(levelBn);\r\n  if (bigNumIsZero(bonusCount)) return null;\r\n  return bonusCount.mulDecimal(LOG_DECADE_BONUS_DECIMAL, 18);\r\n}\r\n\r\nfunction approximateCoinMultiplierFromBigNum(levelBn) {\r\n  if (!levelBn || typeof levelBn !== 'object') {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n  const levelLog = computeLevelLogTerm(levelBn);\r\n  let totalLog = levelLog;\r\n  const bonusLog = computeBonusLogTerm(levelBn);\r\n  if (bonusLog) {\r\n    totalLog = totalLog.add?.(bonusLog) ?? totalLog;\r\n  }\r\n  const logNumber = logBigNumToNumber(totalLog);\r\n  if (!Number.isFinite(logNumber)) {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n  const approx = bigNumFromLog10(logNumber);\r\n  const approxIsInf = approx.isInfinite?.() || (typeof approx.isInfinite === 'function' && approx.isInfinite());\r\n  if (approxIsInf) {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n  const levelTerm = levelBn.clone?.() ?? (() => {\r\n    try { return BigNum.fromAny(levelBn ?? 0); }\r\n    catch { return BigNum.fromInt(0); }\r\n  })();\r\n  let combined = approx.clone?.() ?? approx;\r\n  if (typeof combined.add === 'function') {\r\n    combined = combined.add(levelTerm);\r\n  } else if (typeof levelTerm.add === 'function') {\r\n    combined = levelTerm.add(combined);\r\n  }\r\n  return combined;\r\n}\r\n\r\nconst xpState = {\r\n  unlocked: false,\r\n  xpLevel: BigNum.fromInt(0),\r\n  progress: BigNum.fromInt(0),\r\n};\r\n\r\nfunction enforceXpInfinityInvariant() {\r\n  const levelIsInf = bigNumIsInfinite(xpState.xpLevel);\r\n  const progIsInf = bigNumIsInfinite(xpState.progress);\r\n  if (!levelIsInf && !progIsInf) return false;\r\n\r\n  const inf = infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  xpState.xpLevel = inf.clone?.() ?? inf;\r\n  xpState.progress = inf.clone?.() ?? inf;\r\n  requirementBn = inf.clone?.() ?? inf;\r\n\r\n  if (bank?.books) {\r\n    try {\r\n      if (typeof bank.books.set === 'function') {\r\n        bank.books.set(inf.clone?.() ?? inf);\r\n      } else if (typeof bank.books.add === 'function') {\r\n        bank.books.add(inf.clone?.() ?? inf);\r\n      }\r\n    } catch {\r\n    }\r\n  }\r\n  \r\n  return true;\r\n}\r\n\r\n\r\nconst xpChangeSubscribers = new Set();\r\n\r\nfunction notifyXpSubscribers(detail = {}) {\r\n  if (xpChangeSubscribers.size === 0) return;\r\n  xpChangeSubscribers.forEach((entry) => {\r\n    if (!entry || typeof entry.handler !== 'function') return;\r\n    if (entry.slot != null && detail.slot != null && entry.slot !== detail.slot) return;\r\n    try { entry.handler(detail); }\r\n    catch {}\r\n  });\r\n}\r\n\r\nexport function onXpChange(handler, { slot = null } = {}) {\r\n  if (typeof handler !== 'function') {\r\n    return () => {};\r\n  }\r\n  const entry = { handler, slot: slot ?? null };\r\n  xpChangeSubscribers.add(entry);\r\n  return () => {\r\n    xpChangeSubscribers.delete(entry);\r\n  };\r\n}\r\n\r\nconst hudRefs = {\r\n  container: null,\r\n  bar: null,\r\n  fill: null,\r\n  xpLevelValue: null,\r\n  progress: null,\r\n};\r\n\r\nfunction bnZero() {\r\n  return BigNum.fromInt(0);\r\n}\r\n\r\nfunction bnOne() {\r\n  return BigNum.fromInt(1);\r\n}\r\n\r\nconst xpStorageWatcherCleanups = [];\r\nlet xpStorageWatchersInitialized = false;\r\nlet xpStorageWatcherSlot = null;\r\nlet handlingExternalXpStorage = false;\r\n\r\nfunction cloneBigNumSafe(value) {\r\n  if (!value) return bnZero();\r\n  if (typeof value.clone === 'function') {\r\n    try { return value.clone(); } catch {}\r\n  }\r\n  try { return BigNum.fromAny(value); } catch { return bnZero(); }\r\n}\r\n\r\nfunction bigNumEqualsSafe(a, b) {\r\n  if (a === b) return true;\r\n  if (a == null || b == null) return a == null && b == null;\r\n  if (typeof a?.cmp === 'function') {\r\n    try { return a.cmp(b) === 0; } catch {}\r\n  }\r\n  if (typeof b?.cmp === 'function') {\r\n    try { return b.cmp(a) === 0; } catch {}\r\n  }\r\n  try { return Object.is(String(a), String(b)); }\r\n  catch { return false; }\r\n}\r\n\r\nfunction cleanupXpStorageWatchers() {\r\n  while (xpStorageWatcherCleanups.length > 0) {\r\n    const stop = xpStorageWatcherCleanups.pop();\r\n    try { stop?.(); } catch {}\r\n  }\r\n}\r\n\r\nfunction parseBigNumOrZero(raw) {\r\n  if (raw == null) return bnZero();\r\n  try { return BigNum.fromAny(raw); }\r\n  catch { return bnZero(); }\r\n}\r\n\r\nfunction handleExternalXpStorageChange(reason) {\r\n  if (handlingExternalXpStorage) return;\r\n  handlingExternalXpStorage = true;\r\n  try {\r\n    const slot = xpStorageWatcherSlot ?? getActiveSlot();\r\n    const prev = {\r\n      unlocked: xpState.unlocked,\r\n      xpLevel: cloneBigNumSafe(xpState.xpLevel),\r\n      progress: cloneBigNumSafe(xpState.progress),\r\n      requirement: cloneBigNumSafe(requirementBn),\r\n    };\r\n    ensureStateLoaded(true);\r\n    updateHud();\r\n    syncCoinMultiplierWithXpLevel(true);\r\n    const current = {\r\n      unlocked: xpState.unlocked,\r\n      xpLevel: cloneBigNumSafe(xpState.xpLevel),\r\n      progress: cloneBigNumSafe(xpState.progress),\r\n      requirement: cloneBigNumSafe(requirementBn),\r\n    };\r\n    const unlockedChanged = prev.unlocked !== current.unlocked;\r\n    const levelChanged = !bigNumEqualsSafe(prev.xpLevel, current.xpLevel);\r\n    const progressChanged = !bigNumEqualsSafe(prev.progress, current.progress);\r\n    if (!unlockedChanged && !levelChanged && !progressChanged) {\r\n      return;\r\n    }\r\n    let xpLevelsGained = bnZero();\r\n    if (levelChanged) {\r\n      try { xpLevelsGained = current.xpLevel.sub?.(prev.xpLevel) ?? bnZero(); }\r\n      catch { xpLevelsGained = bnZero(); }\r\n    }\r\n    let xpAdded = null;\r\n    if (!levelChanged && progressChanged) {\r\n      try { xpAdded = current.progress.sub?.(prev.progress) ?? null; }\r\n      catch { xpAdded = null; }\r\n    }\r\n    if (typeof window !== 'undefined' || xpChangeSubscribers.size > 0) {\r\n      const detail = {\r\n        unlocked: current.unlocked,\r\n        xpLevelsGained: xpLevelsGained?.clone?.() ?? xpLevelsGained,\r\n        xpAdded: xpAdded?.clone?.() ?? xpAdded,\r\n        xpLevel: current.xpLevel?.clone?.() ?? current.xpLevel,\r\n        progress: current.progress?.clone?.() ?? current.progress,\r\n        requirement: current.requirement?.clone?.() ?? current.requirement,\r\n        source: 'storage',\r\n        changeType: reason,\r\n        slot,\r\n      };\r\n      notifyXpSubscribers(detail);\r\n      if (typeof window !== 'undefined') {\r\n        try { window.dispatchEvent(new CustomEvent('xp:change', { detail })); } catch {}\r\n      }\r\n    }\r\n  } finally {\r\n    handlingExternalXpStorage = false;\r\n  }\r\n}\r\n\r\nfunction bindXpStorageWatchersForSlot(slot) {\r\n  if (slot === xpStorageWatcherSlot) return;\r\n  cleanupXpStorageWatchers();\r\n  xpStorageWatcherSlot = slot ?? null;\r\n  if (slot == null) return;\r\n  const watch = (key, options) => {\r\n    const stop = watchStorageKey(key, options);\r\n    if (typeof stop === 'function') {\r\n      xpStorageWatcherCleanups.push(stop);\r\n    }\r\n  };\r\n  watch(KEY_UNLOCK(slot), {\r\n    parse: (raw) => raw === '1',\r\n    equals: (a, b) => a === b,\r\n    onChange: () => handleExternalXpStorageChange('unlock'),\r\n  });\r\n  watch(KEY_XP_LEVEL(slot), {\r\n    parse: parseBigNumOrZero,\r\n    equals: bigNumEqualsSafe,\r\n    onChange: () => handleExternalXpStorageChange('xpLevel'),\r\n  });\r\n  watch(KEY_PROGRESS(slot), {\r\n    parse: parseBigNumOrZero,\r\n    equals: bigNumEqualsSafe,\r\n    onChange: () => handleExternalXpStorageChange('progress'),\r\n  });\r\n}\r\n\r\nfunction ensureXpStorageWatchers() {\r\n  if (xpStorageWatchersInitialized) {\r\n    bindXpStorageWatchersForSlot(getActiveSlot());\r\n    return;\r\n  }\r\n  xpStorageWatchersInitialized = true;\r\n  bindXpStorageWatchersForSlot(getActiveSlot());\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('saveSlot:change', () => {\r\n      bindXpStorageWatchersForSlot(getActiveSlot());\r\n      ensureStateLoaded(true);\r\n      updateHud();\r\n      syncCoinMultiplierWithXpLevel(true);\r\n    });\r\n  }\r\n}\r\n\r\nfunction stripHtml(value) {\r\n  if (typeof value !== 'string') return '';\r\n  return value.replace(/<[^>]*>/g, '');\r\n}\r\n\r\nfunction approxLog10(bn) {\r\n  if (!bn || typeof bn !== 'object') return Number.NEGATIVE_INFINITY;\r\n  if (bn.isInfinite?.() || (typeof bn.isInfinite === 'function' && bn.isInfinite())) {\r\n    return Number.POSITIVE_INFINITY;\r\n  }\r\n  if (bn.isZero?.() || (typeof bn.isZero === 'function' && bn.isZero())) {\r\n    return Number.NEGATIVE_INFINITY;\r\n  }\r\n\r\n  // Prefer the BigNum internal representation so we can handle chained-exponent\r\n  // values (e.g. 1e8.11e21) without going through lossy string parsing.\r\n  const sig = bn.sig;\r\n  const expBase = typeof bn.e === 'number' ? bn.e : Number(bn.e ?? 0);\r\n  const expOffset = typeof bn._eOffset === 'bigint'\r\n    ? bigIntToFloatApprox(bn._eOffset)\r\n    : Number(bn._eOffset ?? 0);\r\n\r\n  if (!Number.isFinite(expBase)) {\r\n    return expBase > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\r\n  }\r\n  if (!Number.isFinite(expOffset)) {\r\n    return expOffset > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\r\n  }\r\n\r\n  const totalExponent = expBase + expOffset;\r\n  if (!Number.isFinite(totalExponent)) {\r\n    return totalExponent > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\r\n  }\r\n\r\n  let mantissaLog = 0;\r\n  if (typeof sig === 'bigint') {\r\n    const sigStr = sig.toString();\r\n    const trimmed = sigStr.replace(/^0+/, '');\r\n    if (!trimmed) return Number.NEGATIVE_INFINITY;\r\n    const digits = trimmed.length;\r\n    const headDigits = Math.min(digits, 15);\r\n    const headSlice = trimmed.slice(0, headDigits);\r\n    const head = Number.parseFloat(headSlice);\r\n    if (Number.isFinite(head) && head > 0) {\r\n      mantissaLog = Math.log10(head) + (digits - headDigits);\r\n    } else {\r\n      mantissaLog = digits - 1;\r\n    }\r\n  } else {\r\n    try {\r\n      const sci = typeof bn.toScientific === 'function' ? bn.toScientific(12) : String(bn);\r\n      if (!sci || sci === '0') return Number.NEGATIVE_INFINITY;\r\n      if (sci === 'Infinity') return Number.POSITIVE_INFINITY;\r\n      const match = sci.match(/^([0-9]+(?:\\.[0-9]+)?)e([+-]?\\d+)$/i);\r\n      if (match) {\r\n        const mant = parseFloat(match[1]);\r\n        const exp = parseInt(match[2], 10) || 0;\r\n        if (!(mant > 0) || !Number.isFinite(mant)) return Number.NEGATIVE_INFINITY;\r\n        mantissaLog = Math.log10(mant) + exp;\r\n      } else {\r\n        const num = Number(sci);\r\n        if (!Number.isFinite(num) || num <= 0) return Number.NEGATIVE_INFINITY;\r\n        mantissaLog = Math.log10(num);\r\n      }\r\n    } catch {\r\n      return Number.NEGATIVE_INFINITY;\r\n    }\r\n  }\r\n\r\n  return totalExponent + mantissaLog;\r\n}\r\n\r\nfunction bonusMultipliersCount(levelBigInt) {\r\n  if (levelBigInt <= 1n) return 0n;\r\n  return (levelBigInt - 1n) / 10n;\r\n}\r\n\r\nfunction ensureExactRequirementCacheUpTo(levelBigInt) {\r\n  const target = levelBigInt < EXACT_REQUIREMENT_CACHE_LEVEL ? levelBigInt : EXACT_REQUIREMENT_CACHE_LEVEL;\r\n  if (target <= highestCachedExactLevel) return;\r\n\r\n  let currentLevel = highestCachedExactLevel;\r\n  let currentRequirement = xpRequirementCache.get(currentLevel.toString());\r\n  if (!currentRequirement) {\r\n    currentRequirement = BigNum.fromInt(10);\r\n    xpRequirementCache.set(currentLevel.toString(), currentRequirement);\r\n  }\r\n\r\n  while (currentLevel < target) {\r\n    const nextLevel = currentLevel + 1n;\r\n    let nextRequirement = currentRequirement.mulScaledIntFloor(11n, 1);\r\n    if (nextLevel > 1n && ((nextLevel - 1n) % 10n === 0n)) {\r\n      nextRequirement = nextRequirement.mulScaledIntFloor(25n, 1);\r\n    }\r\n    xpRequirementCache.set(nextLevel.toString(), nextRequirement);\r\n    currentRequirement = nextRequirement;\r\n    currentLevel = nextLevel;\r\n    const isInfinite = currentRequirement.isInfinite?.() || (typeof currentRequirement.isInfinite === 'function' && currentRequirement.isInfinite());\r\n    if (isInfinite) {\r\n      highestCachedExactLevel = currentLevel;\r\n      return;\r\n    }\r\n  }\r\n\r\n  highestCachedExactLevel = currentLevel;\r\n}\r\n\r\nfunction bigNumFromLog10(log10Value) {\r\n  if (!Number.isFinite(log10Value) || log10Value >= BigNum.MAX_E) {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n\r\n  let exponent = Math.floor(log10Value);\r\n  let fractional = log10Value - exponent;\r\n  if (!Number.isFinite(fractional)) {\r\n    fractional = 0;\r\n  }\r\n\r\n  let mantissa = Math.pow(10, fractional);\r\n  if (!Number.isFinite(mantissa) || mantissa <= 0) {\r\n    mantissa = 1;\r\n  }\r\n\r\n  if (mantissa >= 10) {\r\n    mantissa /= 10;\r\n    exponent += 1;\r\n  }\r\n\r\n  let exponentStr;\r\n  try {\r\n    exponentStr = Number.isFinite(exponent)\r\n      ? exponent.toLocaleString('en', { useGrouping: false })\r\n      : String(exponent);\r\n  } catch {\r\n    exponentStr = String(exponent);\r\n  }\r\n\r\n  const sci = `${mantissa.toPrecision(18)}e${exponentStr}`;\r\n  try {\r\n    return BigNum.fromScientific(sci).floorToInteger();\r\n  } catch {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n}\r\n\r\nfunction approximateRequirementFromLevel(levelBn) {\r\n  const baseLevel = highestCachedExactLevel > 0n ? highestCachedExactLevel : 0n;\r\n  const baseRequirement = xpRequirementCache.get(baseLevel.toString());\r\n  if (!baseRequirement || bigNumIsInfinite(baseRequirement)) {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n\r\n  const baseLevelBn = BigNum.fromAny(baseLevel.toString());\r\n  const baseLog = approxLog10(baseRequirement);\r\n  let totalLog = BigNum.fromInt(0);\r\n  if (Number.isFinite(baseLog) && baseLog > 0) {\r\n    try {\r\n      totalLog = BigNum.fromScientific(baseLog.toString());\r\n    } catch {\r\n      totalLog = BigNum.fromInt(0);\r\n    }\r\n  }\r\n\r\n  const deltaLevel = levelBn.sub?.(baseLevelBn) ?? BigNum.fromInt(0);\r\n  if (!bigNumIsZero(deltaLevel)) {\r\n    totalLog = totalLog.add?.(deltaLevel.mulDecimal(LOG_STEP_DECIMAL, 18)) ?? totalLog;\r\n  }\r\n\r\n  const targetBonus = computeBonusCountBn(levelBn);\r\n  const baseBonus = computeBonusCountBn(baseLevelBn);\r\n  const deltaBonus = targetBonus.sub?.(baseBonus) ?? BigNum.fromInt(0);\r\n  if (!bigNumIsZero(deltaBonus)) {\r\n    totalLog = totalLog.add?.(deltaBonus.mulDecimal(LOG_DECADE_BONUS_DECIMAL, 18)) ?? totalLog;\r\n  }\r\n\r\n  const logNumber = logBigNumToNumber(totalLog);\r\n  if (!Number.isFinite(logNumber)) {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n\r\n  return bigNumFromLog10(logNumber);\r\n}\r\n\r\nfunction progressRatio(progressBn, requirement) {\r\n  if (!requirement || typeof requirement !== 'object') return 0;\r\n  if (!progressBn || typeof progressBn !== 'object') return 0;\r\n\r\n  const reqIsInf = bigNumIsInfinite(requirement);\r\n  const progIsInf = bigNumIsInfinite(progressBn);\r\n\r\n  // If both are infinite, treat as a full bar.\r\n  if (reqIsInf) {\r\n    return progIsInf ? 1 : 0;\r\n  }\r\n\r\n  const reqIsZero = bigNumIsZero(requirement);\r\n  if (reqIsZero) return 0;\r\n\r\n  const progIsZero = bigNumIsZero(progressBn);\r\n  if (progIsZero) return 0;\r\n\r\n  const logProg = approxLog10(progressBn);\r\n  const logReq  = approxLog10(requirement);\r\n  if (!Number.isFinite(logProg) || !Number.isFinite(logReq)) {\r\n    return logProg >= logReq ? 1 : 0;\r\n  }\r\n  const diff = logProg - logReq;\r\n  const ratio = Math.pow(10, diff);\r\n  if (!Number.isFinite(ratio)) {\r\n    return diff >= 0 ? 1 : 0;\r\n  }\r\n  if (ratio <= 0) return 0;\r\n  if (ratio >= 1) return 1;\r\n  return ratio;\r\n}\r\n\r\nfunction ensureHudRefs() {\r\n  if (hudRefs.container && hudRefs.container.isConnected) return true;\r\n  hudRefs.container = document.querySelector('.xp-counter[data-xp-hud]');\r\n  if (!hudRefs.container) return false;\r\n  hudRefs.bar = hudRefs.container.querySelector('.xp-bar');\r\n  hudRefs.fill = hudRefs.container.querySelector('.xp-bar__fill');\r\n  hudRefs.xpLevelValue = hudRefs.container.querySelector('.xp-level-value');\r\n  hudRefs.progress = hudRefs.container.querySelector('[data-xp-progress]');\r\n  return true;\r\n}\r\n\r\nfunction xpRequirementForXpLevel(xpLevelInput) {\r\n  let xpLvlBn;\r\n  try {\r\n    xpLvlBn = xpLevelInput instanceof BigNum\r\n      ? (xpLevelInput.clone?.() ?? xpLevelInput)\r\n      : BigNum.fromAny(xpLevelInput ?? 0);\r\n  } catch {\r\n    xpLvlBn = BigNum.fromInt(0);\r\n  }\r\n\r\n  const lvlIsInf = xpLvlBn.isInfinite?.() || (typeof xpLvlBn.isInfinite === 'function' && xpLvlBn.isInfinite());\r\n  if (lvlIsInf) {\r\n    return BigNum.fromAny('Infinity');\r\n  }\r\n\r\n  let levelPlain = '0';\r\n  try {\r\n    levelPlain = xpLvlBn.toPlainIntegerString?.() ?? xpLvlBn.toString?.() ?? '0';\r\n  } catch {\r\n    levelPlain = '0';\r\n  }\r\n\r\n  let targetLevelInfo = { bigInt: null, finite: true };\r\n  if (levelPlain && levelPlain !== 'Infinity') {\r\n    try {\r\n      targetLevelInfo = { bigInt: BigInt(levelPlain), finite: true };\r\n    } catch {\r\n      targetLevelInfo = { bigInt: null, finite: true };\r\n    }\r\n  } else {\r\n    targetLevelInfo = { bigInt: null, finite: true };\r\n  }\r\n\r\n  const targetLevel = targetLevelInfo.bigInt ?? 0n;\r\n\r\n  if (targetLevelInfo.bigInt != null && targetLevel <= 0n) {\r\n    const baseRequirement = xpRequirementCache.get('0');\r\n    return baseRequirement.clone?.() ?? baseRequirement;\r\n  }\r\n\r\n  if (targetLevelInfo.bigInt != null) {\r\n    ensureExactRequirementCacheUpTo(targetLevel);\r\n    const targetKey = targetLevel.toString();\r\n    const cachedExact = xpRequirementCache.get(targetKey);\r\n    if (cachedExact) {\r\n      return cachedExact.clone?.() ?? cachedExact;\r\n    }\r\n  }\r\n\r\n  const approximate = approximateRequirementFromLevel(xpLvlBn);\r\n  const approxIsInf = approximate.isInfinite?.() || (typeof approximate.isInfinite === 'function' && approximate.isInfinite());\r\n  if (approxIsInf) {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n\r\n  if (targetLevelInfo.bigInt != null) {\r\n    xpRequirementCache.set(targetLevelInfo.bigInt.toString(), approximate);\r\n  }\r\n  return approximate.clone?.() ?? approximate;\r\n}\r\n\r\nfunction updateXpRequirement() {\r\n  requirementBn = xpRequirementForXpLevel(xpState.xpLevel);\r\n}\r\n\r\nfunction resetLockedXpState() {\r\n  xpState.xpLevel = bnZero();\r\n  xpState.progress = bnZero();\r\n  updateXpRequirement();\r\n  syncCoinMultiplierWithXpLevel(true);\r\n}\r\n\r\nfunction normalizeProgress(applyRewards = false) {\r\n  // If either level or progress is already \u221E, enforce the invariant and bail.\r\n  if (enforceXpInfinityInvariant()) {\r\n    return;\r\n  }\r\n\r\n  updateXpRequirement();\r\n\r\n  // If the requirement is infinite, there is nothing meaningful to normalize.\r\n  if (bigNumIsInfinite(requirementBn)) {\r\n    return;\r\n  }\r\n\r\n  let guard = 0;\r\n  const limit = 10000;\r\n  while (xpState.progress.cmp?.(requirementBn) >= 0 && guard < limit) {\r\n    try { xpState.progress = xpState.progress.sub(requirementBn); }\r\n    catch { xpState.progress = bnZero(); }\r\n\r\n    try { xpState.xpLevel = xpState.xpLevel.add(bnOne()); }\r\n    catch { xpState.xpLevel = bnZero(); }\r\n\r\n    if (applyRewards) handleXpLevelUpRewards();\r\n    updateXpRequirement();\r\n\r\n    if (bigNumIsInfinite(requirementBn)) {\r\n      break;\r\n    }\r\n    guard += 1;\r\n  }\r\n\r\n  if (guard >= limit) {\r\n    xpState.progress = bnZero();\r\n  }\r\n}\r\n\r\nfunction xpLevelBigIntInfo(xpLevelValue) {\r\n  if (!xpLevelValue || typeof xpLevelValue !== 'object') {\r\n    return { bigInt: 0n, finite: false };\r\n  }\r\n  const levelIsInfinite = xpLevelValue.isInfinite?.() || (typeof xpLevelValue.isInfinite === 'function' && xpLevelValue.isInfinite());\r\n  if (levelIsInfinite) {\r\n    return { bigInt: null, finite: false };\r\n  }\r\n  let plain = '0';\r\n  try {\r\n    plain = xpLevelValue.toPlainIntegerString?.() ?? xpLevelValue.toString?.() ?? '0';\r\n  } catch {\r\n    plain = '0';\r\n  }\r\n  if (!plain || plain === 'Infinity') {\r\n    return { bigInt: null, finite: true };\r\n  }\r\n  try {\r\n    return { bigInt: BigInt(plain), finite: true };\r\n  } catch {\r\n    return { bigInt: null, finite: true };\r\n  }\r\n}\r\n\r\nfunction syncCoinMultiplierWithXpLevel(force = false) {\r\n  const multApi = bank?.coins?.mult;\r\n  if (!multApi || typeof multApi.set !== 'function' || typeof multApi.multiplyByDecimal !== 'function') {\r\n    return;\r\n  }\r\n\r\n  const levelInfo = xpLevelBigIntInfo(xpState.xpLevel);\r\n  const levelBigInt = levelInfo.bigInt;\r\n  const levelIsInfinite = !levelInfo.finite;\r\n  const levelStorageKey = typeof xpState.xpLevel?.toStorage === 'function' ? xpState.xpLevel.toStorage() : null;\r\n\r\n  if (!force) {\r\n    if (levelIsInfinite && lastSyncedCoinLevelWasInfinite) {\r\n      return;\r\n    }\r\n    if (!levelIsInfinite && levelBigInt != null && !lastSyncedCoinLevelWasInfinite && !lastSyncedCoinUsedApproximation && lastSyncedCoinLevel != null && levelBigInt === lastSyncedCoinLevel) {\r\n      return;\r\n    }\r\n    if (!levelIsInfinite && levelBigInt == null && lastSyncedCoinUsedApproximation && levelStorageKey && lastSyncedCoinApproxKey && levelStorageKey === lastSyncedCoinApproxKey) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (levelIsInfinite) {\r\n    try { multApi.set(infinityRequirementBn); } catch {}\r\n    lastSyncedCoinLevel = null;\r\n    lastSyncedCoinLevelWasInfinite = true;\r\n    lastSyncedCoinUsedApproximation = false;\r\n    lastSyncedCoinApproxKey = null;\r\n    return;\r\n  }\r\n\r\n  let multiplierBn;\r\n  if (levelBigInt != null && levelBigInt <= EXACT_COIN_LEVEL_LIMIT) {\r\n    let working = BigNum.fromInt(1);\r\n    const iterations = Number(levelBigInt);\r\n    for (let i = 0; i < iterations; i += 1) {\r\n      working = working.mulDecimal('1.1', 18);\r\n    }\r\n    let levelAdd;\r\n    try { levelAdd = BigNum.fromAny(levelBigInt.toString()); }\r\n    catch { levelAdd = BigNum.fromInt(iterations); }\r\n    if (typeof working.add === 'function') {\r\n      working = working.add(levelAdd);\r\n    } else if (typeof levelAdd.add === 'function') {\r\n      working = levelAdd.add(working);\r\n    }\r\n    multiplierBn = working.clone?.() ?? working;\r\n  } else {\r\n    multiplierBn = approximateCoinMultiplierFromBigNum(xpState.xpLevel);\r\n  }\r\n\r\n  let finalMultiplier = multiplierBn.clone?.() ?? multiplierBn;\r\n  const providers = coinMultiplierProviders.size > 0\r\n    ? Array.from(coinMultiplierProviders)\r\n    : (typeof externalCoinMultiplierProvider === 'function' ? [externalCoinMultiplierProvider] : []);\r\n  for (const provider of providers) {\r\n    if (typeof provider !== 'function') continue;\r\n    try {\r\n      const maybe = provider({\r\n        baseMultiplier: finalMultiplier.clone?.() ?? finalMultiplier,\r\n        xpLevel: xpState.xpLevel.clone?.() ?? xpState.xpLevel,\r\n        xpUnlocked: xpState.unlocked,\r\n      });\r\n      if (maybe instanceof BigNum) {\r\n        finalMultiplier = maybe.clone?.() ?? maybe;\r\n      } else if (maybe != null) {\r\n        finalMultiplier = BigNum.fromAny(maybe);\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  const multIsInf = finalMultiplier.isInfinite?.() || (typeof finalMultiplier.isInfinite === 'function' && finalMultiplier.isInfinite());\r\n  try { multApi.set(finalMultiplier.clone?.() ?? finalMultiplier); } catch {}\r\n  if (multIsInf) {\r\n    lastSyncedCoinLevel = null;\r\n    lastSyncedCoinLevelWasInfinite = true;\r\n    lastSyncedCoinUsedApproximation = false;\r\n    lastSyncedCoinApproxKey = null;\r\n  } else if (levelBigInt != null && levelBigInt <= EXACT_COIN_LEVEL_LIMIT) {\r\n    lastSyncedCoinLevel = levelBigInt;\r\n    lastSyncedCoinLevelWasInfinite = false;\r\n    lastSyncedCoinUsedApproximation = false;\r\n    lastSyncedCoinApproxKey = null;\r\n  } else {\r\n    lastSyncedCoinLevel = null;\r\n    lastSyncedCoinLevelWasInfinite = false;\r\n    lastSyncedCoinUsedApproximation = true;\r\n    lastSyncedCoinApproxKey = levelStorageKey;\r\n  }\r\n}\r\n\r\nfunction ensureStateLoaded(force = false) {\r\n  const slot = getActiveSlot();\r\n  if (slot == null) {\r\n    lastSlot = null;\r\n    stateLoaded = false;\r\n    xpState.unlocked = false;\r\n    resetLockedXpState();\r\n    return xpState;\r\n  }\r\n  if (!force && stateLoaded && slot === lastSlot) return xpState;\r\n  lastSlot = slot;\r\n  stateLoaded = true;\r\n  try {\r\n    const unlockedRaw = localStorage.getItem(KEY_UNLOCK(slot));\r\n    xpState.unlocked = unlockedRaw === '1';\r\n  } catch {\r\n    xpState.unlocked = false;\r\n  }\r\n  try {\r\n    xpState.xpLevel = BigNum.fromAny(localStorage.getItem(KEY_XP_LEVEL(slot)) ?? '0');\r\n  } catch {\r\n    xpState.xpLevel = bnZero();\r\n  }\r\n  try {\r\n    xpState.progress = BigNum.fromAny(localStorage.getItem(KEY_PROGRESS(slot)) ?? '0');\r\n  } catch {\r\n    xpState.progress = bnZero();\r\n  }\r\n  if (!xpState.unlocked) {\r\n    resetLockedXpState();\r\n    return xpState;\r\n  }\r\n\r\n  enforceXpInfinityInvariant();\r\n\r\n  updateXpRequirement();\r\n  syncCoinMultiplierWithXpLevel(true);\r\n  ensureXpStorageWatchers();\r\n  return xpState;\r\n}\r\n\r\nfunction persistState() {\r\n  const slot = getActiveSlot();\r\n  if (slot == null) return;\r\n\r\n  const expected = {\r\n    unlocked: xpState.unlocked ? '1' : '0',\r\n    level: xpState.xpLevel.toStorage(),\r\n    progress: xpState.progress.toStorage(),\r\n  };\r\n\r\n  try { localStorage.setItem(KEY_UNLOCK(slot), expected.unlocked); }\r\n  catch {}\r\n  try { localStorage.setItem(KEY_XP_LEVEL(slot), expected.level); }\r\n  catch {}\r\n  try { localStorage.setItem(KEY_PROGRESS(slot), expected.progress); }\r\n  catch {}\r\n\r\n  const persisted = (() => {\r\n    let unlocked = xpState.unlocked;\r\n    let level = xpState.xpLevel;\r\n    let progress = xpState.progress;\r\n    try { unlocked = localStorage.getItem(KEY_UNLOCK(slot)) === '1'; }\r\n    catch {}\r\n    try {\r\n      const rawLevel = localStorage.getItem(KEY_XP_LEVEL(slot));\r\n      if (rawLevel) level = BigNum.fromAny(rawLevel);\r\n    } catch {}\r\n    try {\r\n      const rawProgress = localStorage.getItem(KEY_PROGRESS(slot));\r\n      if (rawProgress) progress = BigNum.fromAny(rawProgress);\r\n    } catch {}\r\n    return { unlocked, level, progress };\r\n  })();\r\n\r\n  primeStorageWatcherSnapshot(KEY_UNLOCK(slot), persisted.unlocked ? '1' : '0');\r\n  primeStorageWatcherSnapshot(KEY_XP_LEVEL(slot), persisted.level?.toStorage?.() ?? expected.level);\r\n  primeStorageWatcherSnapshot(KEY_PROGRESS(slot), persisted.progress?.toStorage?.() ?? expected.progress);\r\n\r\n  const mismatch =\r\n    persisted.unlocked !== xpState.unlocked ||\r\n    (persisted.level?.toStorage?.() ?? null) !== expected.level ||\r\n    (persisted.progress?.toStorage?.() ?? null) !== expected.progress;\r\n\r\n  if (mismatch) {\r\n    xpState.unlocked = persisted.unlocked;\r\n    xpState.xpLevel = persisted.level;\r\n    xpState.progress = persisted.progress;\r\n    updateXpRequirement();\r\n    syncCoinMultiplierWithXpLevel(true);\r\n    updateHud();\r\n  }\r\n}\r\n\r\nfunction handleXpLevelUpRewards() {\r\n  syncCoinMultiplierWithXpLevel(true);\r\n\r\n  let reward = bnOne();\r\n  if (typeof externalBookRewardProvider === 'function') {\r\n    try {\r\n      const maybe = externalBookRewardProvider({\r\n        baseReward: reward.clone?.() ?? reward,\r\n        xpLevel: xpState.xpLevel.clone?.() ?? xpState.xpLevel,\r\n        xpUnlocked: xpState.unlocked,\r\n      });\r\n      if (maybe instanceof BigNum) {\r\n        reward = maybe.clone?.() ?? maybe;\r\n      } else if (maybe != null) {\r\n        reward = BigNum.fromAny(maybe);\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  try {\r\n    if (bank?.books?.addWithMultiplier) {\r\n      bank.books.addWithMultiplier(reward);\r\n    } else if (bank?.books?.add) {\r\n      bank.books.add(reward);\r\n    }\r\n  } catch {}\r\n  const syncedLevelInfo = xpLevelBigIntInfo(xpState.xpLevel);\r\n  if (!syncedLevelInfo.finite) {\r\n    lastSyncedCoinLevel = null;\r\n    lastSyncedCoinLevelWasInfinite = true;\r\n    lastSyncedCoinUsedApproximation = false;\r\n    lastSyncedCoinApproxKey = null;\r\n  } else if (syncedLevelInfo.bigInt != null) {\r\n    lastSyncedCoinLevel = syncedLevelInfo.bigInt;\r\n    lastSyncedCoinLevelWasInfinite = false;\r\n    lastSyncedCoinUsedApproximation = false;\r\n    lastSyncedCoinApproxKey = null;\r\n  } else {\r\n    lastSyncedCoinLevel = null;\r\n    lastSyncedCoinLevelWasInfinite = false;\r\n    lastSyncedCoinUsedApproximation = true;\r\n    lastSyncedCoinApproxKey = typeof xpState.xpLevel?.toStorage === 'function' ? xpState.xpLevel.toStorage() : null;\r\n  }\r\n}\r\n\r\nfunction updateHud() {\r\n  if (!ensureHudRefs()) return;\r\n  const { container, bar, fill, xpLevelValue, progress } = hudRefs;\r\n  if (!container) return;\r\n  if (!xpState.unlocked) {\r\n    container.setAttribute('hidden', '');\r\n    if (fill) {\r\n      fill.style.setProperty('--xp-fill', '0%');\r\n      fill.style.width = '0%';\r\n    }\r\n    if (xpLevelValue) xpLevelValue.textContent = '0';\r\n    if (progress) {\r\n      const reqHtml = formatNumber(requirementBn);\r\n      progress.innerHTML = `<span class=\"xp-progress-current\">0</span><span class=\"xp-progress-separator\">/</span><span class=\"xp-progress-required\">${reqHtml}</span><span class=\"xp-progress-suffix\">XP</span>`;\r\n    }\r\n    if (bar) {\r\n      bar.setAttribute('aria-valuenow', '0');\r\n      const reqPlain = stripHtml(formatNumber(requirementBn));\r\n      bar.setAttribute('aria-valuetext', `0 / ${reqPlain || '10'} XP`);\r\n    }\r\n    syncXpMpHudLayout();\r\n    return;\r\n  }\r\n\r\n  container.removeAttribute('hidden');\r\n  const requirement = requirementBn;\r\n  const ratio = progressRatio(xpState.progress, requirement);\r\n  const pct = `${(ratio * 100).toFixed(2)}%`;\r\n  if (fill) {\r\n    fill.style.setProperty('--xp-fill', pct);\r\n    fill.style.width = pct;\r\n  }\r\n  if (xpLevelValue) {\r\n    xpLevelValue.innerHTML = formatNumber(xpState.xpLevel);\r\n  }\r\n  if (progress) {\r\n    const currentHtml = formatNumber(xpState.progress);\r\n    const reqHtml = formatNumber(requirement);\r\n    progress.innerHTML = `<span class=\"xp-progress-current\">${currentHtml}</span><span class=\"xp-progress-separator\">/</span><span class=\"xp-progress-required\">${reqHtml}</span><span class=\"xp-progress-suffix\">XP</span>`;\r\n  }\r\n  if (bar) {\r\n    bar.setAttribute('aria-valuenow', (ratio * 100).toFixed(2));\r\n    const currPlain = stripHtml(formatNumber(xpState.progress));\r\n    const reqPlain = stripHtml(formatNumber(requirement));\r\n    bar.setAttribute('aria-valuetext', `${currPlain} / ${reqPlain} XP`);\r\n  }\r\n  syncXpMpHudLayout();\r\n}\r\n\r\nexport function initXpSystem({ forceReload = false } = {}) {\r\n  ensureHudRefs();\r\n  ensureStateLoaded(forceReload);\r\n  updateXpRequirement();\r\n  updateHud();\r\n  ensureXpStorageWatchers();\r\n  return getXpState();\r\n}\r\n\r\nexport function unlockXpSystem() {\r\n  ensureStateLoaded();\r\n  if (xpState.unlocked) {\r\n    updateHud();\r\n    return false;\r\n  }\r\n  resetLockedXpState();\r\n  xpState.unlocked = true;\r\n  persistState();\r\n  updateHud();\r\n  syncCoinMultiplierWithXpLevel(true);\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('xp:unlock', { detail: getXpState() }));\r\n  } catch {}\r\n  return true;\r\n}\r\n\r\nexport function resetXpProgress({ keepUnlock = true } = {}) {\r\n  ensureStateLoaded();\r\n  const wasUnlocked = xpState.unlocked;\r\n  resetLockedXpState();\r\n  xpState.unlocked = keepUnlock ? (wasUnlocked || xpState.unlocked) : false;\r\n  persistState();\r\n  updateHud();\r\n  syncCoinMultiplierWithXpLevel(true);\r\n  return getXpState();\r\n}\r\n\r\nexport function addXp(amount, { silent = false } = {}) {\r\n  ensureStateLoaded();\r\n  const slot = lastSlot ?? getActiveSlot();\r\n  if (!xpState.unlocked) {\r\n    return {\r\n      unlocked: false,\r\n      xpLevelsGained: bnZero(),\r\n      xpAdded: bnZero(),\r\n      xpLevel: xpState.xpLevel,\r\n      requirement: requirementBn\r\n    };\r\n  }\r\n\r\n  let inc;\r\n  try {\r\n    if (amount instanceof BigNum) {\r\n      inc = amount.clone?.() ?? BigNum.fromAny(amount ?? 0);\r\n    } else {\r\n      inc = BigNum.fromAny(amount ?? 0);\r\n    }\r\n  } catch {\r\n    inc = bnZero();\r\n  }\r\n\r\n  // External XP gain multipliers\r\n  if (!inc.isZero?.()) {\r\n    const providers = xpGainMultiplierProviders.size > 0\r\n      ? Array.from(xpGainMultiplierProviders)\r\n      : (typeof externalXpGainMultiplierProvider === 'function' ? [externalXpGainMultiplierProvider] : []);\r\n    for (const provider of providers) {\r\n      if (typeof provider !== 'function') continue;\r\n      try {\r\n        const maybe = provider({\r\n          baseGain: inc.clone?.() ?? inc,\r\n          xpLevel: xpState.xpLevel.clone?.() ?? xpState.xpLevel,\r\n          xpUnlocked: xpState.unlocked,\r\n        });\r\n        if (maybe instanceof BigNum) {\r\n          inc = maybe.clone?.() ?? maybe;\r\n        } else if (maybe != null) {\r\n          inc = BigNum.fromAny(maybe);\r\n        }\r\n      } catch {}\r\n    }\r\n  }\r\n\r\n  inc = applyStatMultiplierOverride('xp', inc);\r\n\r\n  if (inc.isZero?.() || (typeof inc.isZero === 'function' && inc.isZero())) {\r\n    updateHud();\r\n    return {\r\n      unlocked: true,\r\n      xpLevelsGained: bnZero(),\r\n      xpAdded: inc,\r\n      xpLevel: xpState.xpLevel,\r\n      requirement: requirementBn\r\n    };\r\n  }\r\n\r\n  // Apply gain\r\n  xpState.progress = xpState.progress.add(inc);\r\n  updateXpRequirement();\r\n\r\n  // If the gain, the current progress, or the current level is infinite,\r\n  // snap the entire XP system (level, progress, requirement, and coin multiplier) to \u221E.\r\n  const progressIsInf = xpState.progress?.isInfinite?.()\r\n    || (typeof xpState.progress?.isInfinite === 'function' && xpState.progress.isInfinite());\r\n  const levelIsInf = xpState.xpLevel?.isInfinite?.()\r\n    || (typeof xpState.xpLevel?.isInfinite === 'function' && xpState.xpLevel.isInfinite());\r\n  const gainIsInf = inc?.isInfinite?.()\r\n    || (typeof inc?.isInfinite === 'function' && inc.isInfinite());\r\n\r\n  if (progressIsInf || levelIsInf || gainIsInf) {\r\n    const inf = infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n\r\n    xpState.xpLevel = inf.clone?.() ?? inf;\r\n    xpState.progress = inf.clone?.() ?? inf;\r\n    requirementBn = inf.clone?.() ?? inf;\r\n\r\n    // NEW: also enforce the Books = \u221E rule\r\n    enforceXpInfinityInvariant();\r\n\r\n    persistState();\r\n    updateHud();\r\n    // Make sure the coin multiplier from XP is also locked to \u221E.\r\n    syncCoinMultiplierWithXpLevel(true);\r\n\r\n    const detail = {\r\n      unlocked: true,\r\n      xpLevelsGained: bnZero(),\r\n      xpAdded: inc.clone?.() ?? inc,\r\n      xpLevel: xpState.xpLevel.clone?.() ?? xpState.xpLevel,\r\n      progress: xpState.progress.clone?.() ?? xpState.progress,\r\n      requirement: requirementBn.clone?.() ?? requirementBn,\r\n      slot,\r\n    };\r\n    notifyXpSubscribers(detail);\r\n    if (!silent && typeof window !== 'undefined') {\r\n      try { window.dispatchEvent(new CustomEvent('xp:change', { detail })); } catch {}\r\n    }\r\n    return detail;\r\n  }\r\n\r\n  // Normal finite-path level up loop\r\n  let xpLevelsGained = bnZero();\r\n  let guard = 0;\r\n  const limit = 100000;\r\n  while (xpState.progress.cmp?.(requirementBn) >= 0 && guard < limit) {\r\n    xpState.progress = xpState.progress.sub(requirementBn);\r\n    xpState.xpLevel = xpState.xpLevel.add(bnOne());\r\n    xpLevelsGained = xpLevelsGained.add(bnOne());\r\n    handleXpLevelUpRewards();\r\n    updateXpRequirement();\r\n    const reqIsInf = requirementBn.isInfinite?.()\r\n      || (typeof requirementBn.isInfinite === 'function' && requirementBn.isInfinite());\r\n    if (reqIsInf) {\r\n      break;\r\n    }\r\n    guard += 1;\r\n  }\r\n  if (guard >= limit) {\r\n    // Only clamp finite progress if we truly hit the guard.\r\n    xpState.progress = bnZero();\r\n  }\r\n\r\n  persistState();\r\n  updateHud();\r\n\r\n  // Maintain sync flags\r\n  const syncedLevelAfterAdd = xpLevelBigIntInfo(xpState.xpLevel);\r\n  if (!syncedLevelAfterAdd.finite) {\r\n    lastSyncedCoinLevel = null;\r\n    lastSyncedCoinLevelWasInfinite = true;\r\n    lastSyncedCoinUsedApproximation = false;\r\n    lastSyncedCoinApproxKey = null;\r\n  } else if (syncedLevelAfterAdd.bigInt != null) {\r\n    lastSyncedCoinLevel = syncedLevelAfterAdd.bigInt;\r\n    lastSyncedCoinLevelWasInfinite = false;\r\n    lastSyncedCoinUsedApproximation = false;\r\n    lastSyncedCoinApproxKey = null;\r\n  } else {\r\n    lastSyncedCoinLevel = null;\r\n    lastSyncedCoinLevelWasInfinite = false;\r\n    lastSyncedCoinUsedApproximation = true;\r\n    lastSyncedCoinApproxKey = typeof xpState.xpLevel?.toStorage === 'function'\r\n      ? xpState.xpLevel.toStorage()\r\n      : null;\r\n  }\r\n\r\n  const detail = {\r\n    unlocked: true,\r\n    xpLevelsGained: xpLevelsGained.clone?.() ?? xpLevelsGained,\r\n    xpAdded: inc.clone?.() ?? inc,\r\n    xpLevel: xpState.xpLevel.clone?.() ?? xpState.xpLevel,\r\n    progress: xpState.progress.clone?.() ?? xpState.progress,\r\n    requirement: requirementBn.clone?.() ?? requirementBn,\r\n    slot,\r\n  };\r\n  notifyXpSubscribers(detail);\r\n  if (!silent && typeof window !== 'undefined') {\r\n    try { window.dispatchEvent(new CustomEvent('xp:change', { detail })); } catch {}\r\n  }\r\n  return detail;\r\n}\r\n\r\nexport function getXpState() {\r\n  ensureStateLoaded();\r\n  return {\r\n    unlocked: xpState.unlocked,\r\n    xpLevel: xpState.xpLevel.clone?.() ?? xpState.xpLevel,\r\n    progress: xpState.progress.clone?.() ?? xpState.progress,\r\n    requirement: requirementBn.clone?.() ?? requirementBn,\r\n  };\r\n}\r\n\r\nexport function broadcastXpChange(detailOverrides = {}) {\r\n  ensureStateLoaded();\r\n  const slot = lastSlot ?? getActiveSlot();\r\n  const detail = {\r\n    ...getXpState(),\r\n    slot,\r\n    ...detailOverrides,\r\n  };\r\n\r\n  notifyXpSubscribers(detail);\r\n  if (typeof window !== 'undefined') {\r\n    try { window.dispatchEvent(new CustomEvent('xp:change', { detail })); } catch {}\r\n  }\r\n\r\n  return detail;\r\n}\r\n\r\nexport function isXpSystemUnlocked() {\r\n  ensureStateLoaded();\r\n  return !!xpState.unlocked;\r\n}\r\n\r\nexport function getXpRequirementForXpLevel(xpLevel) {\r\n  return xpRequirementForXpLevel(xpLevel);\r\n}\r\n\r\nexport function computeCoinMultiplierForXpLevel(levelValue) {\r\n  let xpLevelBn;\r\n  try {\r\n    xpLevelBn = levelValue instanceof BigNum ? levelValue : BigNum.fromAny(levelValue ?? 0);\r\n  } catch {\r\n    xpLevelBn = BigNum.fromInt(0);\r\n  }\r\n\r\n  const levelInfo = xpLevelBigIntInfo(xpLevelBn);\r\n  const levelBigInt = levelInfo.bigInt;\r\n  const levelIsInfinite = !levelInfo.finite;\r\n\r\n  if (levelIsInfinite) {\r\n    return infinityRequirementBn.clone?.() ?? infinityRequirementBn;\r\n  }\r\n\r\n  let multiplierBn;\r\n  if (levelBigInt != null && levelBigInt <= EXACT_COIN_LEVEL_LIMIT) {\r\n    let working = BigNum.fromInt(1);\r\n    const iterations = Number(levelBigInt);\r\n    for (let i = 0; i < iterations; i += 1) {\r\n      working = working.mulDecimal('1.1', 18);\r\n    }\r\n    let levelAdd;\r\n    try { levelAdd = BigNum.fromAny(levelBigInt.toString()); }\r\n    catch { levelAdd = BigNum.fromInt(iterations); }\r\n    if (typeof working.add === 'function') {\r\n      working = working.add(levelAdd);\r\n    } else if (typeof levelAdd.add === 'function') {\r\n      working = levelAdd.add(working);\r\n    }\r\n    multiplierBn = working.clone?.() ?? working;\r\n  } else {\r\n    multiplierBn = approximateCoinMultiplierFromBigNum(xpLevelBn);\r\n  }\r\n\r\n  let finalMultiplier = multiplierBn.clone?.() ?? multiplierBn;\r\n  const providers = coinMultiplierProviders.size > 0\r\n    ? Array.from(coinMultiplierProviders)\r\n    : (typeof externalCoinMultiplierProvider === 'function' ? [externalCoinMultiplierProvider] : []);\r\n  for (const provider of providers) {\r\n    if (typeof provider !== 'function') continue;\r\n    try {\r\n      const maybe = provider({\r\n        baseMultiplier: finalMultiplier.clone?.() ?? finalMultiplier,\r\n        xpLevel: xpLevelBn.clone?.() ?? xpLevelBn,\r\n        xpUnlocked: !!xpState.unlocked,\r\n      });\r\n      if (maybe instanceof BigNum) {\r\n        finalMultiplier = maybe.clone?.() ?? maybe;\r\n      } else if (maybe != null) {\r\n        finalMultiplier = BigNum.fromAny(maybe);\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  return finalMultiplier.clone?.() ?? finalMultiplier;\r\n}\r\n\r\nexport function setExternalCoinMultiplierProvider(fn) {\r\n  externalCoinMultiplierProvider = typeof fn === 'function' ? fn : null;\r\n  coinMultiplierProviders.clear();\r\n  if (externalCoinMultiplierProvider) {\r\n    coinMultiplierProviders.add(externalCoinMultiplierProvider);\r\n  }\r\n  ensureStateLoaded();\r\n  syncCoinMultiplierWithXpLevel(true);\r\n}\r\n\r\nexport function refreshCoinMultiplierFromXpLevel() {\r\n  ensureStateLoaded();\r\n  syncCoinMultiplierWithXpLevel(true);\r\n}\r\n\r\nexport function setExternalXpGainMultiplierProvider(fn) {\r\n  externalXpGainMultiplierProvider = typeof fn === 'function' ? fn : null;\r\n  xpGainMultiplierProviders.clear();\r\n  if (externalXpGainMultiplierProvider) {\r\n    xpGainMultiplierProviders.add(externalXpGainMultiplierProvider);\r\n  }\r\n}\r\n\r\nexport function addExternalCoinMultiplierProvider(fn) {\r\n  if (typeof fn !== 'function') return () => {};\r\n  coinMultiplierProviders.add(fn);\r\n  ensureStateLoaded();\r\n  syncCoinMultiplierWithXpLevel(true);\r\n  return () => {\r\n    coinMultiplierProviders.delete(fn);\r\n    ensureStateLoaded();\r\n    syncCoinMultiplierWithXpLevel(true);\r\n  };\r\n}\r\n\r\nexport function addExternalXpGainMultiplierProvider(fn) {\r\n  if (typeof fn !== 'function') return () => {};\r\n  xpGainMultiplierProviders.add(fn);\r\n  ensureStateLoaded();\r\n  return () => {\r\n    xpGainMultiplierProviders.delete(fn);\r\n  };\r\n}\r\n\r\nexport function setExternalBookRewardProvider(fn) {\r\n  externalBookRewardProvider = typeof fn === 'function' ? fn : null;\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.xpSystem = window.xpSystem || {};\r\n  Object.assign(window.xpSystem, {\r\n    initXpSystem,\r\n    unlockXpSystem,\r\n    addXp,\r\n    getXpState,\r\n    isXpSystemUnlocked,\r\n    getXpRequirementForXpLevel,\r\n    setExternalCoinMultiplierProvider,\r\n    addExternalCoinMultiplierProvider,\r\n    refreshCoinMultiplierFromXpLevel,\r\n    setExternalXpGainMultiplierProvider,\r\n    addExternalXpGainMultiplierProvider,\r\n    setExternalBookRewardProvider,\r\n    resetXpProgress,\r\n  });\r\n}", "// js/ui/merchantDelve/resetTab.js\r\nimport { BigNum } from '../../util/bigNum.js';\r\nimport {\r\n  bank,\r\n  getActiveSlot,\r\n  watchStorageKey,\r\n  primeStorageWatcherSnapshot,\r\n  onCurrencyChange,\r\n  CURRENCIES,\r\n} from '../../util/storage.js';\r\nimport { formatNumber } from '../../util/numFormat.js';\r\nimport {\r\n  getXpState,\r\n  resetXpProgress,\r\n  onXpChange,\r\n} from '../../game/xpSystem.js';\r\nimport {\r\n  AREA_KEYS,\r\n  UPGRADE_TIES,\r\n  getUpgradesForArea,\r\n  getLevelNumber,\r\n  setLevel,\r\n  approxLog10BigNum,\r\n  bigNumFromLog10,\r\n} from '../../game/upgrades.js';\r\nimport {\r\n  initMutationSystem,\r\n  unlockMutationSystem,\r\n  isMutationUnlocked,\r\n  getMutationCoinSprite,\r\n  onMutationChange,\r\n} from '../../game/mutationSystem.js';\r\n\r\nconst BN = BigNum;\r\nconst bnZero = () => BN.fromInt(0);\r\nconst bnOne = () => BN.fromInt(1);\r\n\r\nconst GOLD_ICON_SRC = 'img/currencies/gold/gold.png';\r\nconst RESET_ICON_SRC = 'img/misc/forge.png';\r\nconst FORGE_RESET_SOUND_SRC = 'sounds/forge_reset.mp3';\r\n\r\nlet forgeResetAudio = null;\r\nfunction playForgeResetSound() {\r\n  try {\r\n    if (!forgeResetAudio) {\r\n      forgeResetAudio = new Audio(FORGE_RESET_SOUND_SRC);\r\n    } else {\r\n      forgeResetAudio.currentTime = 0;\r\n    }\r\n    forgeResetAudio.play().catch(() => {});\r\n  } catch {}\r\n}\r\n\r\nconst FORGE_UNLOCK_KEY = (slot) => `ccc:reset:forge:${slot}`;\r\nconst FORGE_COMPLETED_KEY = (slot) => `ccc:reset:forge:completed:${slot}`;\r\nconst FORGE_DEBUG_OVERRIDE_KEY = (slot) => `ccc:debug:forgeUnlocked:${slot}`;\r\n\r\nconst MIN_FORGE_LEVEL = BN.fromInt(31);\r\n\r\nconst resetState = {\r\n  slot: null,\r\n  forgeUnlocked: false,\r\n  hasDoneForgeReset: false,\r\n  pendingGold: bnZero(),\r\n  panel: null,\r\n  pendingEl: null,\r\n  requirementEl: null,\r\n  actionBtn: null,\r\n  statusEl: null,\r\n  layerButtons: {},\r\n  flagsPrimed: false,\r\n};\r\n\r\nconst watchers = [];\r\nlet watchersBoundSlot = null;\r\nlet initialized = false;\r\nlet mutationUnsub = null;\r\nlet pendingGoldInputSignature = null;\r\nlet coinChangeUnsub = null;\r\nlet xpChangeUnsub = null;\r\n\r\nfunction resetPendingGoldSignature() {\r\n  pendingGoldInputSignature = null;\r\n}\r\n\r\nfunction getPendingGoldWithMultiplier() {\r\n  try {\r\n    return bank.gold?.mult?.applyTo?.(resetState.pendingGold) ?? resetState.pendingGold;\r\n  } catch {\r\n    return resetState.pendingGold;\r\n  }\r\n}\r\n\r\nfunction cleanupWatchers() {\r\n  while (watchers.length) {\r\n    const stop = watchers.pop();\r\n    try { stop?.(); } catch {}\r\n  }\r\n}\r\n\r\nfunction ensureValueListeners() {\r\n  if (!coinChangeUnsub && typeof onCurrencyChange === 'function') {\r\n    coinChangeUnsub = onCurrencyChange((detail = {}) => {\r\n      if (detail?.key && detail.key !== CURRENCIES.COINS) return;\r\n      if (detail?.slot != null && resetState.slot != null && detail.slot !== resetState.slot) return;\r\n      recomputePendingGold();\r\n    });\r\n  }\r\n  if (!xpChangeUnsub && typeof onXpChange === 'function') {\r\n    xpChangeUnsub = onXpChange((detail = {}) => {\r\n      if (detail?.slot != null && resetState.slot != null && detail.slot !== resetState.slot) return;\r\n      recomputePendingGold();\r\n      updateResetPanel();\r\n    });\r\n  }\r\n}\r\n\r\nfunction levelToNumber(levelBn) {\r\n  if (!levelBn || typeof levelBn !== 'object') return 0;\r\n  if (levelBn.isInfinite?.()) return Number.POSITIVE_INFINITY;\r\n  try {\r\n    const plain = levelBn.toPlainIntegerString?.();\r\n    if (plain && plain !== 'Infinity' && plain.length <= 15) {\r\n      const num = Number(plain);\r\n      if (Number.isFinite(num)) return num;\r\n    }\r\n  } catch {}\r\n  const approx = approxLog10BigNum(levelBn);\r\n  if (!Number.isFinite(approx)) return Number.POSITIVE_INFINITY;\r\n  if (approx > 308) return Number.POSITIVE_INFINITY;\r\n  return Math.pow(10, approx);\r\n}\r\n\r\nfunction getXpLevelBn() {\r\n  try {\r\n    const state = getXpState();\r\n    if (state && state.xpLevel) return state.xpLevel;\r\n  } catch {}\r\n  return bnZero();\r\n}\r\n\r\nfunction computeForgeGold(coinsBn, levelBn) {\r\n  if (!coinsBn || typeof coinsBn !== 'object') return bnZero();\r\n  if (coinsBn.isZero?.()) return bnZero();\r\n  const logCoins = approxLog10BigNum(coinsBn);\r\n  if (!Number.isFinite(logCoins)) {\r\n    return logCoins > 0 ? BN.fromAny('Infinity') : bnZero();\r\n  }\r\n  const logScaled = logCoins - 5;\r\n  if (!Number.isFinite(logScaled)) return bnZero();\r\n  const pow2 = bigNumFromLog10(logScaled * Math.log10(2));\r\n  const levelNum = Math.max(0, levelToNumber(levelBn));\r\n  const levelFactor = Math.max(0, (levelNum - 30) / 5);\r\n  const pow14 = levelFactor <= 0\r\n    ? bnOne()\r\n    : bigNumFromLog10(levelFactor * Math.log10(1.4));\r\n  const floorLog = Math.floor(logScaled);\r\n  const pow115 = floorLog <= 0\r\n    ? bnOne()\r\n    : bigNumFromLog10(floorLog * Math.log10(1.15));\r\n  let total = BN.fromInt(10);\r\n  total = total.mulBigNumInteger(pow2);\r\n  total = total.mulBigNumInteger(pow14);\r\n  total = total.mulBigNumInteger(pow115);\r\n  const floored = total.floorToInteger();\r\n  return floored.isZero?.() ? bnZero() : floored;\r\n}\r\n\r\nexport function computeForgeGoldFromInputs(coinsBn, levelBn) {\r\n  return computeForgeGold(coinsBn, levelBn);\r\n}\r\n\r\nfunction getXpLevelNumber() {\r\n  return Math.max(0, levelToNumber(getXpLevelBn()));\r\n}\r\n\r\nfunction ensureResetSlot() {\r\n  if (resetState.slot != null) return resetState.slot;\r\n  const slot = getActiveSlot();\r\n  resetState.slot = slot;\r\n  return slot;\r\n}\r\n\r\nexport function setForgeResetCompleted(value) {\r\n  const slot = ensureResetSlot();\r\n  if (slot == null) return;\r\n  resetState.hasDoneForgeReset = !!value;\r\n  try { localStorage.setItem(FORGE_COMPLETED_KEY(slot), resetState.hasDoneForgeReset ? '1' : '0'); }\r\n  catch {}\r\n  primeStorageWatcherSnapshot(FORGE_COMPLETED_KEY(slot));\r\n}\r\n\r\nfunction getForgeDebugOverride(slot = getActiveSlot()) {\r\n  if (slot == null) return null;\r\n  try {\r\n    const raw = localStorage.getItem(FORGE_DEBUG_OVERRIDE_KEY(slot));\r\n    if (raw === '1') return true;\r\n    if (raw === '0') return false;\r\n  } catch {}\r\n  return null;\r\n}\r\n\r\nexport function getForgeDebugOverrideState(slot = getActiveSlot()) {\r\n  return getForgeDebugOverride(slot);\r\n}\r\n\r\nexport function setForgeDebugOverride(value, slot = getActiveSlot()) {\r\n  if (slot == null) return;\r\n  if (value == null) {\r\n    try { localStorage.removeItem(FORGE_DEBUG_OVERRIDE_KEY(slot)); } catch {}\r\n    primeStorageWatcherSnapshot(FORGE_DEBUG_OVERRIDE_KEY(slot));\r\n    return;\r\n  }\r\n  const normalized = !!value;\r\n  try { localStorage.setItem(FORGE_DEBUG_OVERRIDE_KEY(slot), normalized ? '1' : '0'); }\r\n  catch {}\r\n  primeStorageWatcherSnapshot(FORGE_DEBUG_OVERRIDE_KEY(slot));\r\n}\r\n\r\nfunction setForgeUnlocked(value) {\r\n  const slot = ensureResetSlot();\r\n  if (slot == null) return;\r\n  resetState.forgeUnlocked = !!value;\r\n  try { localStorage.setItem(FORGE_UNLOCK_KEY(slot), resetState.forgeUnlocked ? '1' : '0'); }\r\n  catch {}\r\n  primeStorageWatcherSnapshot(FORGE_UNLOCK_KEY(slot));\r\n}\r\n\r\nfunction readPersistentFlags(slot) {\r\n  if (slot == null) {\r\n    resetState.forgeUnlocked = false;\r\n    resetState.hasDoneForgeReset = false;\r\n    resetState.flagsPrimed = false;\r\n    return;\r\n  }\r\n  try {\r\n    resetState.forgeUnlocked = localStorage.getItem(FORGE_UNLOCK_KEY(slot)) === '1';\r\n  } catch {\r\n    resetState.forgeUnlocked = false;\r\n  }\r\n  try {\r\n    resetState.hasDoneForgeReset = localStorage.getItem(FORGE_COMPLETED_KEY(slot)) === '1';\r\n  } catch {\r\n    resetState.hasDoneForgeReset = false;\r\n  }\r\n  resetState.flagsPrimed = true;\r\n}\r\n\r\nfunction ensurePersistentFlagsPrimed() {\r\n  const slot = getActiveSlot();\r\n  if (slot == null) {\r\n    resetState.flagsPrimed = false;\r\n    return;\r\n  }\r\n  if (resetState.slot !== slot) {\r\n    resetState.slot = slot;\r\n    resetPendingGoldSignature();\r\n    resetState.flagsPrimed = false;\r\n  }\r\n  if (!resetState.flagsPrimed) {\r\n    readPersistentFlags(slot);\r\n  }\r\n}\r\n\r\nfunction bindStorageWatchers(slot) {\r\n  if (watchersBoundSlot === slot) return;\r\n  cleanupWatchers();\r\n  watchersBoundSlot = slot;\r\n  if (slot == null) return;\r\n  watchers.push(watchStorageKey(FORGE_UNLOCK_KEY(slot), {\r\n    onChange(value) {\r\n      const next = value === '1';\r\n      if (resetState.forgeUnlocked !== next) {\r\n        resetState.forgeUnlocked = next;\r\n        updateResetPanel();\r\n      }\r\n    },\r\n  }));\r\n  watchers.push(watchStorageKey(FORGE_COMPLETED_KEY(slot), {\r\n    onChange(value) {\r\n      const next = value === '1';\r\n      if (resetState.hasDoneForgeReset !== next) {\r\n        resetState.hasDoneForgeReset = next;\r\n        updateResetPanel();\r\n      }\r\n    },\r\n  }));\r\n}\r\n\r\nfunction getPendingInputSignature(coins, level) {\r\n  const coinSig = coins?.toStorage?.()\r\n    ?? coins?.toString?.()\r\n    ?? String(coins ?? '');\r\n  const levelSig = level?.toStorage?.()\r\n    ?? level?.toString?.()\r\n    ?? String(level ?? '');\r\n  return `${coinSig}|${levelSig}`;\r\n}\r\n\r\nfunction recomputePendingGold(force = false) {\r\n  const coins = bank.coins?.value ?? bnZero();\r\n  const level = getXpLevelBn();\r\n  const signature = getPendingInputSignature(coins, level);\r\n  if (!force && pendingGoldInputSignature === signature) {\r\n    return;\r\n  }\r\n  pendingGoldInputSignature = signature;\r\n\r\n  if (!meetsLevelRequirement()) {\r\n    resetState.pendingGold = bnZero();\r\n  } else {\r\n    resetState.pendingGold = computeForgeGold(coins, level);\r\n  }\r\n\r\n  updateResetPanel();\r\n}\r\n\r\n\r\nfunction canAccessForgeTab() {\r\n  const override = getForgeDebugOverride();\r\n  if (override != null) return !!override;\r\n  return resetState.forgeUnlocked || getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.UNLOCK_FORGE) >= 1;\r\n}\r\n\r\nfunction meetsLevelRequirement() {\r\n  try {\r\n    const levelBn = getXpLevelBn();\r\n    if (levelBn && typeof levelBn.cmp === 'function') {\r\n      return levelBn.cmp(MIN_FORGE_LEVEL) >= 0;\r\n    }\r\n  } catch {}\r\n  return false;\r\n}\r\n\r\nexport function isForgeUnlocked() {\r\n  ensurePersistentFlagsPrimed();\r\n  const override = getForgeDebugOverride();\r\n  if (override != null) return !!override;\r\n  return !!resetState.forgeUnlocked || canAccessForgeTab();\r\n}\r\n\r\nexport function hasDoneForgeReset() {\r\n  ensurePersistentFlagsPrimed();\r\n  return !!resetState.hasDoneForgeReset;\r\n}\r\n\r\n\r\nexport function computePendingForgeGold() {\r\n  recomputePendingGold();\r\n  return resetState.pendingGold.clone?.() ?? resetState.pendingGold;\r\n}\r\n\r\nexport function canPerformForgeReset() {\r\n  if (!isForgeUnlocked()) return false;\r\n  if (!meetsLevelRequirement()) return false;\r\n  if (resetState.pendingGold.isZero?.()) return false;\r\n  const coins = bank.coins?.value;\r\n  if (!coins || coins.isZero?.()) return false;\r\n  return true;\r\n}\r\n\r\nfunction resetUpgrades() {\r\n  const upgrades = getUpgradesForArea(AREA_KEYS.STARTER_COVE);\r\n  for (const upg of upgrades) {\r\n    if (!upg) continue;\r\n    const tieKey = upg.tieKey || upg.tie;\r\n    if (tieKey === UPGRADE_TIES.UNLOCK_XP || tieKey === UPGRADE_TIES.UNLOCK_FORGE) continue;\r\n    if (upg.costType === 'gold') continue;\r\n    setLevel(AREA_KEYS.STARTER_COVE, upg.id, 0, true, { resetHmEvolutions: true });\r\n  }\r\n}\r\n\r\nexport function performForgeReset() {\r\n  if (!canPerformForgeReset()) return false;\r\n  const reward = resetState.pendingGold.clone?.() ?? resetState.pendingGold;\r\n  try {\r\n    const withMultiplier = bank.gold?.mult?.applyTo?.(reward) ?? reward;\r\n    if (bank.gold?.add) {\r\n      bank.gold.add(withMultiplier);\r\n    }\r\n  } catch {}\r\n  try { bank.coins.set(0); } catch {}\r\n  try { bank.books.set(0); } catch {}\r\n  try { resetXpProgress({ keepUnlock: true }); } catch {}\r\n  resetUpgrades();\r\n  recomputePendingGold();\r\n  setForgeUnlocked(true);\r\n  if (!resetState.hasDoneForgeReset) {\r\n    setForgeResetCompleted(true);\r\n  }\r\n  initMutationSystem();\r\n  unlockMutationSystem();\r\n  updateResetPanel();\r\n  return true;\r\n}\r\n\r\nfunction formatBn(value) {\r\n  try { return formatNumber(value); }\r\n  catch { return value?.toString?.() ?? '0'; }\r\n}\r\n\r\nfunction setLayerActive(layer) {\r\n  for (const key in resetState.layerButtons) {\r\n    resetState.layerButtons[key].classList.toggle('is-active', key === layer);\r\n  }\r\n}\r\n\r\nfunction buildPanel(panelEl) {\r\n  panelEl.innerHTML = `\r\n    <div class=\"merchant-reset\">\r\n      <aside class=\"merchant-reset__sidebar\">\r\n        <button type=\"button\" class=\"merchant-reset__layer is-active\" data-reset-layer=\"forge\">\r\n          <img src=\"${RESET_ICON_SRC}\" alt=\"\">\r\n          <span>Forge</span>\r\n        </button>\r\n      </aside>\r\n      <div class=\"merchant-reset__main\">\r\n        <div class=\"merchant-reset__layout\">\r\n          <header class=\"merchant-reset__header\">\r\n            <div class=\"merchant-reset__titles\">\r\n              <h3>Forge</h3>\r\n            </div>\r\n          </header>\r\n\r\n          <div class=\"merchant-reset__content\">\r\n            <div class=\"merchant-reset__titles\">\r\n              <p>\r\n                Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br>\r\n                Increase pending Gold amount by increasing Coins and XP Level<br>\r\n                The button below shows how much Gold you will get upon reset\r\n              </p>\r\n            </div>\r\n            <div class=\"merchant-reset__status\" data-reset-status></div>\r\n          </div>\r\n\r\n          <div class=\"merchant-reset__actions\">\r\n            <button type=\"button\" class=\"merchant-reset__action\" data-reset-action>\r\n              <span class=\"merchant-reset__action-plus\">+</span>\r\n              <span class=\"merchant-reset__action-icon\">\r\n                <img src=\"${GOLD_ICON_SRC}\" alt=\"\">\r\n              </span>\r\n              <span class=\"merchant-reset__action-amount\" data-reset-pending>0</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n  resetState.panel = panelEl;\r\n  resetState.pendingEl = panelEl.querySelector('[data-reset-pending]');\r\n  resetState.statusEl = panelEl.querySelector('[data-reset-status]');\r\n  resetState.actionBtn = panelEl.querySelector('[data-reset-action]');\r\n  resetState.mainEl = panelEl.querySelector('.merchant-reset__main');\r\n  resetState.layerButtons = {\r\n    forge: panelEl.querySelector('[data-reset-layer=\"forge\"]'),\r\n  };\r\n  Object.entries(resetState.layerButtons).forEach(([key, btn]) => {\r\n    if (!btn) return;\r\n    btn.addEventListener('click', () => {\r\n      setLayerActive(key);\r\n      updateResetPanel();\r\n    });\r\n  });\r\n  if (resetState.actionBtn) {\r\n  resetState.actionBtn.addEventListener('click', () => {\r\n    if (performForgeReset()) {\r\n      playForgeResetSound();\r\n      updateResetPanel();\r\n    }\r\n  });\r\n}\r\n  updateResetPanel();\r\n}\r\n\r\nexport function initResetPanel(panelEl) {\r\n  if (!panelEl || panelEl.__resetInit) return;\r\n  panelEl.__resetInit = true;\r\n  buildPanel(panelEl);\r\n}\r\n\r\nfunction updatePendingDisplay() {\r\n  if (!resetState.actionBtn) return;\r\n  const amountEl = resetState.actionBtn.querySelector('[data-reset-pending]');\r\n  if (amountEl) {\r\n    amountEl.innerHTML = formatBn(getPendingGoldWithMultiplier());\r\n  }\r\n}\r\n\r\nfunction updateStatusDisplay() {\r\n  if (!resetState.statusEl) return;\r\n  const el = resetState.statusEl;\r\n  el.innerHTML = '';\r\n\r\n  // Make sure we know if the player has already forged\r\n  ensurePersistentFlagsPrimed();\r\n  resetState.mainEl?.classList.toggle('is-forge-complete', !!resetState.hasDoneForgeReset);\r\n  if (resetState.hasDoneForgeReset) {\r\n    return; // no extra text after the first Forge\r\n  }\r\n\r\n  el.innerHTML = `\r\n  <span style=\"color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);\">\r\n    Forging for the first time will unlock\r\n    <span style=\"color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55);\r\n    \">Mutations</span> and a new Merchant dialogue<br>\r\n    Mutated Coins will yield more Coin and XP value than normal\r\n  </span>\r\n`;\r\n}\r\n\r\nfunction updateActionState() {\r\n  if (!resetState.actionBtn) return;\r\n\r\n  const btn = resetState.actionBtn;\r\n\r\n  // Requirement failures redirect message to the button itself:\r\n  if (!isForgeUnlocked()) {\r\n    btn.disabled = true;\r\n    btn.innerHTML = '<span class=\"merchant-reset__req-msg\">Unlock the Forge upgrade to access resets</span>';\r\n    return;\r\n  }\r\n\r\n  if (!meetsLevelRequirement()) {\r\n    btn.disabled = true;\r\n    btn.innerHTML = '<span class=\"merchant-reset__req-msg\">Reach XP Level 31 to perform a Forge reset</span>';\r\n    return;\r\n  }\r\n\r\n  if (resetState.pendingGold.isZero?.()) {\r\n    btn.disabled = true;\r\n    btn.innerHTML = '<span class=\"merchant-reset__req-msg\">Collect more coins to earn Gold from a Forge reset</span>';\r\n    return;\r\n  }\r\n\r\n  // When requirements are met: restore the normal + icon amount layout\r\n  btn.disabled = false;\r\n  btn.innerHTML = `\r\n    <span class=\"merchant-reset__action-plus\">+</span>\r\n    <span class=\"merchant-reset__action-icon\"><img src=\"${GOLD_ICON_SRC}\" alt=\"\"></span>\r\n    <span class=\"merchant-reset__action-amount\" data-reset-pending>${formatBn(getPendingGoldWithMultiplier())}</span>\r\n  `;\r\n}\r\n\r\nexport function updateResetPanel() {\r\n  if (!resetState.panel) return;\r\n  updatePendingDisplay();\r\n  updateStatusDisplay();\r\n  updateActionState();\r\n}\r\n\r\nexport function onForgeUpgradeUnlocked() {\r\n  initResetSystem();\r\n  setForgeUnlocked(true);\r\n  updateResetPanel();\r\n}\r\n\r\nfunction bindGlobalEvents() {\r\n  if (typeof window === 'undefined') return;\r\n  window.addEventListener('currency:change', (e) => {\r\n    if (e.detail?.key === 'coins') {\r\n      recomputePendingGold();\r\n    }\r\n  });\r\n  window.addEventListener('currency:multiplier', (e) => {\r\n    const detail = e?.detail;\r\n    if (!detail || detail.key !== CURRENCIES.GOLD) return;\r\n    if (detail.slot != null && resetState.slot != null && detail.slot !== resetState.slot) return;\r\n    updateResetPanel();\r\n  });\r\n  window.addEventListener('xp:change', () => {\r\n    recomputePendingGold();\r\n    updateResetPanel();\r\n  });\r\n  window.addEventListener('debug:change', (e) => {\r\n    if (e?.detail?.slot != null && resetState.slot != null && e.detail.slot !== resetState.slot) return;\r\n    resetPendingGoldSignature();\r\n    recomputePendingGold(true);\r\n    updateResetPanel();\r\n  });\r\n}\r\n\r\nexport function initResetSystem() {\r\n  if (initialized) {\r\n    resetState.slot = getActiveSlot();\r\n    resetPendingGoldSignature();\r\n    ensureValueListeners();\r\n    recomputePendingGold(true);\r\n    return;\r\n  }\r\n  initialized = true;\r\n  initMutationSystem();\r\n  const slot = getActiveSlot();\r\n  resetState.slot = slot;\r\n  resetPendingGoldSignature();\r\n  readPersistentFlags(slot);\r\n  if (resetState.hasDoneForgeReset && !isMutationUnlocked()) {\r\n    try { unlockMutationSystem(); } catch {}\r\n  }\r\n  if (!resetState.forgeUnlocked && canAccessForgeTab()) {\r\n    setForgeUnlocked(true);\r\n  }\r\n  bindStorageWatchers(slot);\r\n  ensureValueListeners();\r\n  bindGlobalEvents();\r\n  recomputePendingGold(true);\r\n  if (mutationUnsub) {\r\n    try { mutationUnsub(); } catch {}\r\n    mutationUnsub = null;\r\n  }\r\n  mutationUnsub = onMutationChange(() => {\r\n    const sprite = getMutationCoinSprite();\r\n    if (typeof window !== 'undefined' && window.spawner && typeof window.spawner.setCoinSprite === 'function') {\r\n      try { window.spawner.setCoinSprite(sprite); } catch {}\r\n    }\r\n  });\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('saveSlot:change', () => {\r\n      const nextSlot = getActiveSlot();\r\n      resetState.slot = nextSlot;\r\n      resetPendingGoldSignature();\r\n      readPersistentFlags(nextSlot);\r\n      if (resetState.hasDoneForgeReset && !isMutationUnlocked()) {\r\n        try { unlockMutationSystem(); } catch {}\r\n      }\r\n      if (!resetState.forgeUnlocked && canAccessForgeTab()) {\r\n        setForgeUnlocked(true);\r\n      }\r\n      bindStorageWatchers(nextSlot);\r\n      ensureValueListeners();\r\n      recomputePendingGold(true);\r\n      updateResetPanel();\r\n    });\r\n  }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.resetSystem = window.resetSystem || {};\r\n  Object.assign(window.resetSystem, {\r\n    initResetSystem,\r\n    performForgeReset,\r\n    computePendingForgeGold,\r\n  });\r\n}", "// js/game/upgrades.js\r\nimport { bank, getActiveSlot, watchStorageKey, primeStorageWatcherSnapshot } from '../util/storage.js';\r\nimport { BigNum } from '../util/bigNum.js';\r\nimport { formatNumber } from '../util/numFormat.js';\r\nimport {\r\n  unlockXpSystem,\r\n  isXpSystemUnlocked,\r\n  getXpState,\r\n  addExternalCoinMultiplierProvider,\r\n  setExternalBookRewardProvider,\r\n  addExternalXpGainMultiplierProvider,\r\n  refreshCoinMultiplierFromXpLevel,\r\n} from './xpSystem.js';\r\nimport { getMutationMultiplier } from './mutationSystem.js';\r\nimport {\r\n  initResetSystem,\r\n  onForgeUpgradeUnlocked,\r\n  isForgeUnlocked,\r\n  hasDoneForgeReset,\r\n} from '../ui/merchantDelve/resetTab.js';\r\n\r\nexport const MAX_LEVEL_DELTA = BigNum.fromAny('Infinity');\r\n\r\nexport const HM_EVOLUTION_INTERVAL = 1000;\r\nconst HM_EVOLUTION_EFFECT_MULT_BN = BigNum.fromInt(1000);\r\nconst DEFAULT_AREA_KEY = '';\r\n\r\nfunction hasScaling(upg) {\r\n  try {\r\n    const scaling = ensureUpgradeScaling(upg);\r\n    if (!scaling) return false;\r\n    if (scaling.ratioMinus1 > 0) return true;\r\n\r\n    const c0 = BigNum.fromAny(upg.costAtLevel?.(0) ?? 0);\r\n    const c1 = BigNum.fromAny(upg.costAtLevel?.(1) ?? 0);\r\n    const cF = BigNum.fromAny(upg.costAtLevel?.(32) ?? 0);\r\n    return !(c0.cmp(c1) === 0 && c0.cmp(cF) === 0);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst SCALED_INFINITY_LVL_LOG10 = 308;\r\nfunction isInfinityLevelForScaled(upg, lvlBn) {\r\n  if (!hasScaling(upg)) return false;\r\n  try {\r\n    const bn = lvlBn?.clone ? lvlBn : BigNum.fromAny(lvlBn ?? 0);\r\n    if (bn.isInfinite?.()) return true;\r\n    const log10 = approxLog10BigNum(bn);\r\n    return Number.isFinite(log10) && log10 >= SCALED_INFINITY_LVL_LOG10;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function approxLog10BigNum(value) {\r\n  if (!(value instanceof BigNum)) {\r\n    try {\r\n      value = BigNum.fromAny(value ?? 0);\r\n    } catch {\r\n      return Number.NEGATIVE_INFINITY;\r\n    }\r\n  }\r\n  if (!value) return Number.NEGATIVE_INFINITY;\r\n  if (value.isZero?.()) return Number.NEGATIVE_INFINITY;\r\n  if (value.isInfinite?.()) return Number.POSITIVE_INFINITY;\r\n  let storage;\r\n  try {\r\n    storage = value.toStorage();\r\n  } catch {\r\n    return Number.NEGATIVE_INFINITY;\r\n  }\r\n  const parts = storage.split(':');\r\n  const sigStr = parts[2] ?? '0';\r\n  let expPart = parts[3] ?? '0';\r\n  let offsetStr = '0';\r\n  const caret = expPart.indexOf('^');\r\n  if (caret >= 0) {\r\n    offsetStr = expPart.slice(caret + 1) || '0';\r\n    expPart = expPart.slice(0, caret) || '0';\r\n  }\r\n  const baseExp = Number(expPart || '0');\r\n  const offset = Number(offsetStr || '0');\r\n  const sigNum = Number(sigStr || '0');\r\n  if (!Number.isFinite(sigNum) || sigNum <= 0) return Number.NEGATIVE_INFINITY;\r\n  const expSum = (Number.isFinite(baseExp) ? baseExp : 0) + (Number.isFinite(offset) ? offset : 0);\r\n  return Math.log10(sigNum) + expSum;\r\n}\r\n\r\nexport function bigNumFromLog10(log10Value) {\r\n  if (!Number.isFinite(log10Value)) {\r\n    return log10Value > 0 ? BigNum.fromAny('Infinity') : BigNum.fromInt(0);\r\n  }\r\n  \r\n  if (log10Value <= -1e12) return BigNum.fromInt(0);\r\n  const p = BigNum.DEFAULT_PRECISION;\r\n  let intPart = Math.floor(log10Value);\r\n  let frac = log10Value - intPart;\r\n  if (frac < 0) {\r\n    frac += 1;\r\n    intPart -= 1;\r\n  }\r\n  const mantissa = Math.pow(10, frac + (p - 1));\r\n  const sig = BigInt(Math.max(1, Math.round(mantissa)));\r\n  const exp = intPart - (p - 1);\r\n  return new BigNum(sig, exp, p);\r\n}\r\n\r\nexport const UPGRADE_TIES = {\r\n  FASTER_COINS: 'coin_1',\r\n  UNLOCK_XP: 'none_1',\r\n  FASTER_COINS_II: 'book_1',\r\n  COIN_VALUE_I: 'book_2',\r\n  BOOK_VALUE_I: 'book_3',\r\n  XP_VALUE_I: 'coin_2',\r\n  UNLOCK_FORGE: 'none_2',\r\n  COIN_VALUE_II: 'gold_1',\r\n  XP_VALUE_II: 'gold_2',\r\n  MP_VALUE_I: 'gold_3',\r\n  MAGNET: 'gold_4',\r\n  ENDLESS_XP: 'coin_3',\r\n};\r\n\r\nconst LOCKED_UPGRADE_ICON_DATA_URL = 'img/misc/locked.png';\r\nconst MYSTERIOUS_UPGRADE_ICON_DATA_URL = 'img/misc/mysterious.png';\r\nconst HIDDEN_UPGRADE_TITLE = 'Hidden Upgrade';\r\nconst LOCKED_UPGRADE_TITLE = 'Locked Upgrade';\r\nconst FORGE_PLACEHOLDER_TIES = new Set([\r\n  UPGRADE_TIES.COIN_VALUE_II,\r\n  UPGRADE_TIES.XP_VALUE_II,\r\n  UPGRADE_TIES.MP_VALUE_I,\r\n  UPGRADE_TIES.MAGNET,\r\n  UPGRADE_TIES.ENDLESS_XP,\r\n]);\r\nconst SPECIAL_LOCK_STATE_TIES = new Set([\r\n  UPGRADE_TIES.UNLOCK_XP,\r\n  UPGRADE_TIES.UNLOCK_FORGE,\r\n  ...FORGE_PLACEHOLDER_TIES,\r\n]);\r\nconst XP_MYSTERY_UPGRADE_TIES = new Set([\r\n  UPGRADE_TIES.FASTER_COINS_II,\r\n  UPGRADE_TIES.COIN_VALUE_I,\r\n  UPGRADE_TIES.BOOK_VALUE_I,\r\n  UPGRADE_TIES.XP_VALUE_I,\r\n]);\r\nconst XP_MYSTERY_LEGACY_KEYS = new Set([\r\n  'starter_cove:3',\r\n  'starter_cove:4',\r\n  'starter_cove:5',\r\n  'starter_cove:6',\r\n]);\r\nconst MERCHANT_MET_KEY_BASE = 'ccc:merchantMet';\r\nconst SHOP_REVEAL_STATE_KEY_BASE = 'ccc:shop:reveals';\r\nconst SHOP_PERMA_UNLOCK_KEY_BASE = 'ccc:shop:permaUnlocks';\r\nconst SHOP_PERMA_MYST_KEY_BASE   = 'ccc:shop:permaMyst';\r\nconst SHOP_REVEAL_STATUS_ORDER = { locked: 0, mysterious: 1, unlocked: 2 };\r\nconst shopRevealStateCache = new Map();\r\nconst shopPermaUnlockStateCache = new Map();\r\nconst shopPermaMystStateCache   = new Map();\r\nconst upgradeTieLookup = new Map();\r\nconst BOOK_VALUE_TIE_KEY = normalizeUpgradeTie(UPGRADE_TIES.BOOK_VALUE_I);\r\n\r\nconst BN = BigNum;\r\nconst toBn = (x) => BN.fromAny(x ?? 0);\r\n\r\nfunction effectBN(fn) {\r\n  return (level) => {\r\n    const L = toBn(level);\r\n    let out;\r\n    try { out = fn({ L, BN }); } catch { out = 1; }\r\n    if (out instanceof BN) return out;\r\n    const n = Number(out);\r\n    if (Number.isFinite(n)) return n;\r\n    try { return BN.fromAny(out ?? 1); } catch { return BN.fromInt(1); }\r\n  };\r\n}\r\n\r\nconst E = {\r\n  addPctPerLevel(p) {\r\n    const pNum = Number(p);\r\n    const pStr = String(pNum);\r\n    return (level) => {\r\n      const L = toBn(level);\r\n      try {\r\n        const plain = L.toPlainIntegerString?.();\r\n        if (plain && plain !== 'Infinity' && plain.length <= 15) {\r\n          const lvl = Math.max(0, Number(plain));\r\n          return 1 + pNum * lvl;\r\n        }\r\n      } catch {}\r\n      try { return BN.fromInt(1).add(L.mulDecimal(pStr)); }\r\ncatch {\r\n  const logL = approxLog10BigNum(L);\r\n  if (Number.isFinite(logL)) {\r\n    const logTerm = logL + Math.log10(Math.abs(pNum || 0));\r\n    return bigNumFromLog10(logTerm);\r\n  }\r\n  return BigNum.fromAny('Infinity');\r\n}\r\n\r\n    };\r\n  },\r\n\r\n  addFlatPerLevel(x) {\r\n    const xNum = Number(x);\r\n    const xStr = String(xNum);\r\n    return (level) => {\r\n      const L = toBn(level);\r\n      try {\r\n        const plain = L.toPlainIntegerString?.();\r\n        if (plain && plain !== 'Infinity' && plain.length <= 15) {\r\n          const lvl = Math.max(0, Number(plain));\r\n          return 1 + xNum * lvl;\r\n        }\r\n      } catch {}\r\n      try { return BN.fromInt(1).add(L.mulDecimal(xStr)); } catch { return 1; }\r\n    };\r\n  },\r\n  \r\n  powPerLevel(base) {\r\n  const baseNum = Number(base);\r\n  const b = Number.isFinite(baseNum) ? baseNum : Number(toBn(base).toScientific(6));\r\n  const log10b = Math.log10(b);\r\n\r\n  return (level) => {\r\n    const L = toBn(level);\r\n\r\n    try {\r\n      const plain = L.toPlainIntegerString?.();\r\n      if (plain && plain !== 'Infinity' && plain.length <= 7) {\r\n        const lvl = Math.max(0, Number(plain));\r\n        const log10 = log10b * lvl;\r\n\r\n        if (log10 < 308) {\r\n          const val = Math.pow(b, lvl);\r\n          if (Number.isFinite(val)) return val;\r\n        }\r\n        return bigNumFromLog10(log10);\r\n      }\r\n    } catch {}\r\n\t\r\n      try {\r\n      const approxLvl = levelBigNumToNumber(L);\r\n      const log10 = log10b * approxLvl;\r\n      return bigNumFromLog10(log10);\r\n      } catch {\r\n      return BigNum.fromInt(1);\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\nfunction shopStatusRank(status) {\r\n  return SHOP_REVEAL_STATUS_ORDER[status] ?? 0;\r\n}\r\n\r\nfunction classifyUpgradeStatus(lockState) {\r\n  if (!lockState || lockState.locked === false) return 'unlocked';\r\n  if (lockState.hidden) return 'mysterious';\r\n  return 'locked';\r\n}\r\n\r\nfunction upgradeRevealKey(areaKey, upg) {\r\n  const normArea = normalizeAreaKey(areaKey || upg?.area);\r\n  if (!normArea) return null;\r\n  const tieKey = normalizeUpgradeTie(upg?.tie ?? upg?.tieKey);\r\n  if (tieKey) {\r\n    return `${normArea}:${tieKey}`;\r\n  }\r\n  const rawId = normalizeUpgradeId(upg?.id);\r\n  let idStr = '';\r\n  if (typeof rawId === 'number') {\r\n    if (!Number.isFinite(rawId)) return null;\r\n    idStr = String(Math.trunc(rawId));\r\n  } else if (typeof rawId === 'string') {\r\n    const trimmed = rawId.trim();\r\n    if (!trimmed) return null;\r\n    idStr = trimmed;\r\n  } else {\r\n    return null;\r\n  }\r\n  return `${normArea}:${idStr}`;\r\n}\r\n\r\nfunction upgradeLegacyRevealKey(areaKey, upg) {\r\n  const normArea = normalizeAreaKey(areaKey || upg?.area);\r\n  if (!normArea) return null;\r\n  const rawId = normalizeUpgradeId(upg?.id);\r\n  if (rawId == null) return null;\r\n  if (typeof rawId === 'number') {\r\n    if (!Number.isFinite(rawId)) return null;\r\n    return `${normArea}:${Math.trunc(rawId)}`;\r\n  }\r\n  const trimmed = String(rawId).trim();\r\n  return trimmed ? `${normArea}:${trimmed}` : null;\r\n}\r\n\r\nfunction migrateUpgradeStateKey(state, fromKey, toKey) {\r\n  if (!state || !state.upgrades || typeof state.upgrades !== 'object') return false;\r\n  if (!fromKey || !toKey || fromKey === toKey) return false;\r\n  if (state.upgrades[toKey]) return false;\r\n  if (!state.upgrades[fromKey]) return false;\r\n  state.upgrades[toKey] = state.upgrades[fromKey];\r\n  delete state.upgrades[fromKey];\r\n  return true;\r\n}\r\n\r\nfunction ensureShopRevealState(slot = getActiveSlot()) {\r\n  const slotKey = String(slot ?? 'default');\r\n  if (shopRevealStateCache.has(slotKey)) {\r\n    return shopRevealStateCache.get(slotKey);\r\n  }\r\n\r\n  let parsed = { upgrades: {} };\r\n  if (typeof localStorage !== 'undefined') {\r\n    try {\r\n      const raw = localStorage.getItem(`${SHOP_REVEAL_STATE_KEY_BASE}:${slotKey}`);\r\n      if (raw) {\r\n        const obj = JSON.parse(raw);\r\n        if (obj && typeof obj === 'object') {\r\n          const upgrades = (obj.upgrades && typeof obj.upgrades === 'object') ? obj.upgrades : {};\r\n          parsed = { upgrades };\r\n        }\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  if (!parsed || typeof parsed !== 'object') parsed = { upgrades: {} };\r\n  if (!parsed.upgrades || typeof parsed.upgrades !== 'object') parsed.upgrades = {};\r\n\r\n  shopRevealStateCache.set(slotKey, parsed);\r\n  return parsed;\r\n}\r\n\r\nfunction saveShopRevealState(state, slot = getActiveSlot()) {\r\n  const slotKey = String(slot ?? 'default');\r\n  if (!state || typeof state !== 'object') {\r\n    state = { upgrades: {} };\r\n  }\r\n  if (!state.upgrades || typeof state.upgrades !== 'object') {\r\n    state.upgrades = {};\r\n  }\r\n  shopRevealStateCache.set(slotKey, state);\r\n  if (typeof localStorage === 'undefined') return;\r\n  try {\r\n    localStorage.setItem(`${SHOP_REVEAL_STATE_KEY_BASE}:${slotKey}`, JSON.stringify(state));\r\n  } catch {}\r\n}\r\n\r\nfunction ensureShopPermaUnlockState(slot = getActiveSlot()) {\r\n  const slotKey = String(slot ?? 'default');\r\n  if (shopPermaUnlockStateCache.has(slotKey)) {\r\n    return shopPermaUnlockStateCache.get(slotKey);\r\n  }\r\n\r\n  let parsed = { upgrades: {} };\r\n  if (typeof localStorage !== 'undefined') {\r\n    try {\r\n      const raw = localStorage.getItem(`${SHOP_PERMA_UNLOCK_KEY_BASE}:${slotKey}`);\r\n      if (raw) {\r\n        const obj = JSON.parse(raw);\r\n        if (obj && typeof obj === 'object') {\r\n          const upgrades = (obj.upgrades && typeof obj.upgrades === 'object') ? obj.upgrades : {};\r\n          parsed = { upgrades };\r\n        }\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  if (!parsed || typeof parsed !== 'object') parsed = { upgrades: {} };\r\n  if (!parsed.upgrades || typeof parsed.upgrades !== 'object') parsed.upgrades = {};\r\n\r\n  shopPermaUnlockStateCache.set(slotKey, parsed);\r\n  return parsed;\r\n}\r\n\r\nfunction saveShopPermaUnlockState(state, slot = getActiveSlot()) {\r\n  const slotKey = String(slot ?? 'default');\r\n  if (!state || typeof state !== 'object') {\r\n    state = { upgrades: {} };\r\n  }\r\n  if (!state.upgrades || typeof state.upgrades !== 'object') {\r\n    state.upgrades = {};\r\n  }\r\n  shopPermaUnlockStateCache.set(slotKey, state);\r\n  if (typeof localStorage === 'undefined') return;\r\n  try {\r\n    localStorage.setItem(`${SHOP_PERMA_UNLOCK_KEY_BASE}:${slotKey}`, JSON.stringify(state));\r\n  } catch {}\r\n}\r\n\r\nfunction ensureShopPermaMystState(slot = getActiveSlot()) {\r\n  const slotKey = String(slot ?? 'default');\r\n  if (shopPermaMystStateCache.has(slotKey)) {\r\n    return shopPermaMystStateCache.get(slotKey);\r\n  }\r\n  let parsed = { upgrades: {} };\r\n  if (typeof localStorage !== 'undefined') {\r\n    try {\r\n      const raw = localStorage.getItem(`${SHOP_PERMA_MYST_KEY_BASE}:${slotKey}`);\r\n      if (raw) {\r\n        const obj = JSON.parse(raw);\r\n        if (obj && typeof obj === 'object') {\r\n          const upgrades = (obj.upgrades && typeof obj.upgrades === 'object') ? obj.upgrades : {};\r\n          parsed = { upgrades };\r\n        }\r\n      }\r\n    } catch {}\r\n  }\r\n  if (!parsed || typeof parsed !== 'object') parsed = { upgrades: {} };\r\n  if (!parsed.upgrades || typeof parsed.upgrades !== 'object') parsed.upgrades = {};\r\n  shopPermaMystStateCache.set(slotKey, parsed);\r\n  return parsed;\r\n}\r\n\r\nfunction saveShopPermaMystState(state, slot = getActiveSlot()) {\r\n  const slotKey = String(slot ?? 'default');\r\n  if (!state || typeof state !== 'object') state = { upgrades: {} };\r\n  if (!state.upgrades || typeof state.upgrades !== 'object') state.upgrades = {};\r\n  shopPermaMystStateCache.set(slotKey, state);\r\n  if (typeof localStorage === 'undefined') return;\r\n  try {\r\n    localStorage.setItem(`${SHOP_PERMA_MYST_KEY_BASE}:${slotKey}`, JSON.stringify(state));\r\n  } catch {}\r\n}\r\n\r\nfunction markUpgradePermanentlyMysterious(areaKey, upg, slot = getActiveSlot()) {\r\n  const key = upgradeRevealKey(areaKey, upg);\r\n  if (!key) return;\r\n  const legacyKey = upgradeLegacyRevealKey(areaKey, upg);\r\n  const state = ensureShopPermaMystState(slot);\r\n  if (state.upgrades[key]) return;\r\n  state.upgrades[key] = true;\r\n  if (legacyKey && state.upgrades[legacyKey]) {\r\n    delete state.upgrades[legacyKey];\r\n  }\r\n  saveShopPermaMystState(state, slot);\r\n}\r\n\r\nfunction isUpgradePermanentlyMysterious(areaKey, upg, slot = getActiveSlot()) {\r\n  const key = upgradeRevealKey(areaKey, upg);\r\n  if (!key) return false;\r\n  const legacyKey = upgradeLegacyRevealKey(areaKey, upg);\r\n  const state = ensureShopPermaMystState(slot);\r\n  if (state.upgrades[key]) return true;\r\n  if (legacyKey && state.upgrades[legacyKey]) {\r\n    state.upgrades[key] = state.upgrades[legacyKey];\r\n    delete state.upgrades[legacyKey];\r\n    saveShopPermaMystState(state, slot);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function markUpgradePermanentlyUnlocked(areaKey, upg, slot = getActiveSlot()) {\r\n  const key = upgradeRevealKey(areaKey, upg);\r\n  if (!key) return;\r\n  const legacyKey = upgradeLegacyRevealKey(areaKey, upg);\r\n  const state = ensureShopPermaUnlockState(slot);\r\n  if (state.upgrades[key]) return;\r\n  state.upgrades[key] = true;\r\n  if (legacyKey && state.upgrades[legacyKey]) {\r\n    delete state.upgrades[legacyKey];\r\n  }\r\n  saveShopPermaUnlockState(state, slot);\r\n}\r\n\r\nexport function clearPermanentUpgradeUnlock(areaKey, upg, slot = getActiveSlot()) {\r\n  const key = upgradeRevealKey(areaKey, upg);\r\n  if (!key) return;\r\n\r\n  const permaState = ensureShopPermaUnlockState(slot);\r\n  if (permaState.upgrades[key]) {\r\n    delete permaState.upgrades[key];\r\n    saveShopPermaUnlockState(permaState, slot);\r\n  }\r\n\r\n  const revealState = ensureShopRevealState(slot);\r\n  if (!revealState.upgrades[key] || revealState.upgrades[key].status !== 'locked') {\r\n    revealState.upgrades[key] = { status: 'locked' };\r\n    saveShopRevealState(revealState, slot);\r\n  }\r\n\r\n  const upgId = typeof upg?.id !== 'undefined' ? upg.id : upg;\r\n  if (upgId != null) {\r\n    invalidateUpgradeState(areaKey, upgId, slot);\r\n  }\r\n  notifyChanged();\r\n}\r\n\r\nfunction isUpgradePermanentlyUnlocked(areaKey, upg, slot = getActiveSlot()) {\r\n  const key = upgradeRevealKey(areaKey, upg);\r\n  if (!key) return false;\r\n  const legacyKey = upgradeLegacyRevealKey(areaKey, upg);\r\n  const state = ensureShopPermaUnlockState(slot);\r\n  if (state.upgrades[key]) return true;\r\n  if (legacyKey && state.upgrades[legacyKey]) {\r\n    state.upgrades[key] = state.upgrades[legacyKey];\r\n    delete state.upgrades[legacyKey];\r\n    saveShopPermaUnlockState(state, slot);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction determineLockState(ctx) {\r\n  // Be robust if called unbound or without ctx.upg\r\n  const upgRef = (ctx && ctx.upg) ? ctx.upg : (this && typeof this === 'object' ? this : null);\r\n  const tieKey = normalizeUpgradeTie(upgRef?.tie ?? upgRef?.tieKey);\r\n  const area = ctx?.areaKey || AREA_KEYS.STARTER_COVE;\r\n\r\n  if (!tieKey || !SPECIAL_LOCK_STATE_TIES.has(tieKey)) {\r\n    return { locked: true, iconOverride: LOCKED_UPGRADE_ICON_DATA_URL, useLockedBase: true };\r\n  }\r\n\r\n  // If any level has already been bought, it\u2019s unlocked.\r\n  let currentLevel = 0;\r\n  try {\r\n    currentLevel = (upgRef && typeof upgRef.id !== 'undefined') ? getLevelNumber(area, upgRef.id) : 0;\r\n  } catch {}\r\n  if (currentLevel >= 1) {\r\n    return { locked: false, hidden: false, useLockedBase: false };\r\n  }\r\n\r\n  // XPs unlocked?\r\n  let xpUnlocked = false;\r\n  try {\r\n    xpUnlocked = (ctx && typeof ctx.xpUnlocked !== 'undefined')\r\n      ? !!ctx.xpUnlocked\r\n      : safeIsXpUnlocked();\r\n  } catch {}\r\n\r\n  function determineUnlockXpLockState() {\r\n    if (safeHasMetMerchant()) {\r\n      // Merchant met -> upgrade is fully visible and purchasable\r\n      return {\r\n        locked: false,\r\n        hidden: false,\r\n        hideCost: false,\r\n        hideEffect: false,\r\n        useLockedBase: false,\r\n      };\r\n    }\r\n\r\n    // Merchant not met -> mysterious placeholder\r\n    const revealText = 'Explore the Delve menu to reveal this upgrade';\r\n    return {\r\n      locked: true,\r\n      iconOverride: MYSTERIOUS_UPGRADE_ICON_DATA_URL,\r\n      titleOverride: HIDDEN_UPGRADE_TITLE,\r\n      descOverride: revealText,\r\n      reason: revealText,\r\n      hidden: true,\r\n      hideCost: true,\r\n      hideEffect: true,\r\n      useLockedBase: true,\r\n    };\r\n  }\r\n\r\n  // ==== Unlock XP ====\r\n  if (tieKey === UPGRADE_TIES.UNLOCK_XP) {\r\n    return determineUnlockXpLockState();\r\n  }\r\n\r\n  // ==== Unlock Forge ====\r\n  if (tieKey === UPGRADE_TIES.UNLOCK_FORGE) {\r\n    // No XP system -> LOCKED padlock\r\n    if (!xpUnlocked) {\r\n      return { locked: true, iconOverride: LOCKED_UPGRADE_ICON_DATA_URL, useLockedBase: true };\r\n    }\r\n    // Before 31 -> show same requirement text as mysterious, but without generic \"hidden\" line\r\n    let xp31 = false;\r\n    try { const xpBn = currentXpLevelBigNum(); xp31 = levelBigNumToNumber(xpBn) >= 31; } catch {}\r\n    if (!xp31) {\r\n      const revealText = (upgRef?.revealRequirement) || 'Reach XP Level 31 to reveal this upgrade';\r\n      return {\r\n        locked: true,\r\n        iconOverride: MYSTERIOUS_UPGRADE_ICON_DATA_URL,\r\n        hidden: true,\r\n        hideCost: true, hideEffect: true, useLockedBase: true,\r\n        titleOverride: HIDDEN_UPGRADE_TITLE,\r\n        descOverride: revealText,\r\n        reason: revealText,\r\n      };\r\n    }\r\n    // XP \u2265 31 -> visible/unlocked\r\n    return { locked: false };\r\n  }\r\n\r\n  if (hasDoneForgeReset() || isUpgradePermanentlyUnlocked(area, upgRef)) {\r\n    try { markUpgradePermanentlyUnlocked(area, upgRef); } catch {}\r\n    return { locked: false, hidden: false, useLockedBase: false };\r\n  }\r\n\r\n  // No XP system -> LOCKED padlock\r\n  if (!xpUnlocked) {\r\n    return { locked: true, iconOverride: LOCKED_UPGRADE_ICON_DATA_URL, useLockedBase: true };\r\n  }\r\n\r\n  if (isUpgradePermanentlyMysterious(area, upgRef)) {\r\n    const revealText = 'Do a Forge reset to reveal this upgrade';\r\n    return {\r\n      locked: true,\r\n      iconOverride: MYSTERIOUS_UPGRADE_ICON_DATA_URL,\r\n      hidden: true, hideCost: true, hideEffect: true, useLockedBase: true,\r\n      titleOverride: HIDDEN_UPGRADE_TITLE,\r\n      descOverride: revealText,\r\n      reason: revealText,\r\n    };\r\n  }\r\n\r\n  // Compute XP \u2265 31 once (for the *first-time* reveal/burn)\r\n  let xp31 = false;\r\n  try { const xpBn = currentXpLevelBigNum(); xp31 = levelBigNumToNumber(xpBn) >= 31; } catch {}\r\n\r\n// Before 31 -> hard LOCKED (not mysterious, not clickable)\r\nif (!xp31) {\r\n  const revealText = 'Do a Forge reset to reveal this upgrade';\r\n  return {\r\n    locked: true,\r\n    iconOverride: LOCKED_UPGRADE_ICON_DATA_URL,\r\n    useLockedBase: true,\r\n    titleOverride: LOCKED_UPGRADE_TITLE,\r\n    descOverride: revealText,\r\n    reason: revealText,\r\n    hidden: false,\r\n    hideCost: false,\r\n    hideEffect: false,\r\n  };\r\n}\r\n\r\n  // First time hitting 31 -> burn perma-mysterious and show MYSTERIOUS\r\n  try { markUpgradePermanentlyMysterious(area, upgRef); } catch {}\r\n  return {\r\n    locked: true,\r\n    iconOverride: MYSTERIOUS_UPGRADE_ICON_DATA_URL,\r\n    hidden: true, hideCost: true, hideEffect: true, useLockedBase: true,\r\n  };\r\n}\r\n\r\nfunction snapshotUpgradeLockState(lockState) {\r\n  if (!lockState || typeof lockState !== 'object') return null;\r\n  const snapshot = {};\r\n  const keys = [\r\n    'iconOverride',\r\n    'titleOverride',\r\n    'descOverride',\r\n    'reason',\r\n    'hideCost',\r\n    'hideEffect',\r\n    'hidden',\r\n    'useLockedBase',\r\n  ];\r\n  for (const key of keys) {\r\n    if (lockState[key] !== undefined) snapshot[key] = lockState[key];\r\n  }\r\n  return snapshot;\r\n}\r\n\r\nfunction normalizeAreaKey(areaKey) {\r\n  if (typeof areaKey === 'string') {\r\n    const trimmed = areaKey.trim();\r\n    if (trimmed) {\r\n      return trimmed.toLowerCase().replace(/[^a-z0-9]+/g, '_');\r\n    }\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction normalizeUpgradeTie(tieValue) {\r\n  if (typeof tieValue === 'string') {\r\n    const trimmed = tieValue.trim();\r\n    if (trimmed) {\r\n      return trimmed.toLowerCase().replace(/[^a-z0-9]+/g, '_');\r\n    }\r\n  }\r\n  return '';\r\n}\r\n\r\n\r\nfunction isXpAdjacentUpgrade(areaKey, upg) {\r\n  const tieKey = normalizeUpgradeTie(upg?.tie ?? upg?.tieKey);\r\n  if (tieKey && XP_MYSTERY_UPGRADE_TIES.has(tieKey)) {\r\n    return true;\r\n  }\r\n  const normalizedId = normalizeUpgradeId(upg?.id);\r\n  const numericId = typeof normalizedId === 'number'\r\n    ? normalizedId\r\n    : Number.parseInt(normalizedId, 10);\r\n  const idKey = Number.isFinite(numericId)\r\n    ? String(numericId)\r\n    : (normalizedId != null ? String(normalizedId) : '');\r\n  if (!idKey) return false;\r\n\r\n  const areaCandidates = [];\r\n  if (areaKey != null) areaCandidates.push(areaKey);\r\n  if (upg?.area != null) areaCandidates.push(upg.area);\r\n\r\n  for (const candidate of areaCandidates) {\r\n    const normArea = normalizeAreaKey(candidate);\r\n    if (!normArea) continue;\r\n    if (XP_MYSTERY_LEGACY_KEYS.has(`${normArea}:${idKey}`)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction safeIsXpUnlocked() {\r\n  try {\r\n    return !!isXpSystemUnlocked();\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction safeHasMetMerchant(slot = getActiveSlot()) {\r\n  const slotKey = String(slot ?? 'default');\r\n  if (typeof localStorage === 'undefined') return false;\r\n  try {\r\n    return localStorage.getItem(`${MERCHANT_MET_KEY_BASE}:${slotKey}`) === '1';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction currentXpLevelBigNum() {\r\n  try {\r\n    const state = typeof getXpState === 'function' ? getXpState() : null;\r\n    if (state?.xpLevel instanceof BigNum) {\r\n      return state.xpLevel.clone?.() ?? state.xpLevel;\r\n    }\r\n    if (state?.xpLevel != null) {\r\n      return BigNum.fromAny(state.xpLevel);\r\n    }\r\n  } catch {}\r\n  return BigNum.fromInt(0);\r\n}\r\n\r\nfunction bookValueMultiplierBn(level) {\r\n  const L = ensureLevelBigNum(level);\r\n  try {\r\n    const plain = L.toPlainIntegerString?.();\r\n    if (plain && plain !== 'Infinity' && plain.length <= 15) {\r\n      const lvl = Math.max(0, Number(plain));\r\n      return bigNumFromLog10(lvl * Math.log10(2)).floorToInteger();\r\n    }\r\n  } catch {}\r\n\r\n  return BigNum.fromAny('Infinity');\r\n}\r\n\r\nfunction normalizedUpgradeLevel(levelValue) {\r\n  if (typeof levelValue === 'number' && Number.isFinite(levelValue)) {\r\n    return Math.max(0, Math.floor(levelValue));\r\n  }\r\n  if (typeof levelValue === 'bigint') {\r\n    if (levelValue < 0n) return 0;\r\n    const maxSafe = BigInt(Number.MAX_SAFE_INTEGER);\r\n    const clamped = levelValue > maxSafe ? maxSafe : levelValue;\r\n    return Number(clamped);\r\n  }\r\n  if (levelValue instanceof BigNum) {\r\n    try {\r\n      const plain = levelValue.toPlainIntegerString?.();\r\n      if (plain && plain !== 'Infinity') {\r\n        const parsed = Number.parseInt(plain, 10);\r\n        if (Number.isFinite(parsed)) {\r\n          return Math.max(0, parsed);\r\n        }\r\n      }\r\n    } catch {}\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction hundredPercentPerLevelMultiplier(levelValue) {\r\n  const lvl = normalizedUpgradeLevel(levelValue);\r\n  if (lvl <= 0) {\r\n    return BigNum.fromInt(1);\r\n  }\r\n  try {\r\n    const asBigInt = BigInt(lvl) + 1n;\r\n    return BigNum.fromAny(asBigInt.toString());\r\n  } catch {\r\n    try {\r\n      return BigNum.fromAny(String(lvl + 1));\r\n    } catch {\r\n      return BigNum.fromInt(1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction mergeLockStates(base, override) {\r\n  const merged = Object.assign({ locked: false }, base || {});\r\n  if (!override || typeof override !== 'object') return merged;\r\n  const keys = [\r\n    'locked',\r\n    'iconOverride',\r\n    'titleOverride',\r\n    'descOverride',\r\n    'reason',\r\n    'hideCost',\r\n    'hideEffect',\r\n    'hidden',\r\n    'useLockedBase',\r\n  ];\r\n  for (const key of keys) {\r\n    if (override[key] !== undefined) merged[key] = override[key];\r\n  }\r\n  return merged;\r\n}\r\n\r\nfunction normalizeUpgradeId(upgId) {\r\n  if (typeof upgId === 'number') {\r\n    if (!Number.isFinite(upgId)) return upgId;\r\n    return Math.trunc(upgId);\r\n  }\r\n  if (typeof upgId === 'string') {\r\n    const trimmed = upgId.trim();\r\n    if (!trimmed) return trimmed;\r\n    if (/^[+-]?\\d+$/.test(trimmed)) {\r\n      const parsed = Number.parseInt(trimmed, 10);\r\n      if (Number.isFinite(parsed)) return parsed;\r\n    }\r\n    return trimmed;\r\n  }\r\n  return upgId;\r\n}\r\n\r\nfunction ensureLevelBigNum(value) {\r\n  try {\r\n    const bn = value instanceof BigNum ? value : BigNum.fromAny(value ?? 0);\r\n    if (bn.isInfinite?.()) return bn.clone?.() ?? bn;\r\n    const plain = bn.toPlainIntegerString?.();\r\n    if (plain === 'Infinity') return BigNum.fromAny('Infinity');\r\n    if (!plain) return BigNum.fromInt(0);\r\n    const normalized = plain.replace(/^0+(?=\\d)/, '');\r\n    if (!normalized) return BigNum.fromInt(0);\r\n    return BigNum.fromAny(normalized);\r\n  } catch {\r\n    const num = Math.max(0, Math.floor(Number(value) || 0));\r\n    return BigNum.fromInt(num);\r\n  }\r\n}\r\n\r\nfunction levelBigNumToNumber(value) {\r\n  let bn;\r\n  try {\r\n    bn = value instanceof BigNum ? value : BigNum.fromAny(value ?? 0);\r\n  } catch {\r\n    return 0;\r\n  }\r\n\r\n  if (bn.isInfinite?.()) {\r\n    return Number.POSITIVE_INFINITY;\r\n  }\r\n\r\n  try {\r\n    const plain = bn.toPlainIntegerString?.();\r\n    if (!plain || plain === 'Infinity') {\r\n      return plain === 'Infinity' ? Number.MAX_VALUE : 0;\r\n    }\r\n\r\n    const digits = plain.replace(/^0+/, '');\r\n    if (!digits) return 0;\r\n\r\n    if (digits.length <= 15) {\r\n      const num = Number(digits);\r\n      return Number.isFinite(num) ? num : 0;\r\n    }\r\n\r\n    const lead = digits.slice(0, 15);\r\n    const leadNum = Number(lead);\r\n    const leadLen = lead.length;\r\n    if (!Number.isFinite(leadNum) || leadNum <= 0) return 0;\r\n\r\n    let mantissa = leadNum / Math.pow(10, leadLen - 1);\r\n    let exponent = digits.length - 1;\r\n\r\n    if (mantissa <= 0 || !Number.isFinite(mantissa)) return 0;\r\n\r\n    if (mantissa >= 10) {\r\n      const shift = Math.floor(Math.log10(mantissa));\r\n      if (Number.isFinite(shift) && shift > 0) {\r\n        mantissa /= Math.pow(10, shift);\r\n        exponent += shift;\r\n      }\r\n    } else if (mantissa < 1) {\r\n      const shift = Math.ceil(Math.log10(1 / mantissa));\r\n      if (Number.isFinite(shift) && shift > 0) {\r\n        mantissa *= Math.pow(10, shift);\r\n        exponent -= shift;\r\n      }\r\n    }\r\n\r\n    if (exponent > 308) {\r\n      return Number.MAX_VALUE;\r\n    }\r\n    if (exponent < -324) {\r\n      return 0;\r\n    }\r\n\r\n    const approx = mantissa * Math.pow(10, exponent);\r\n    if (!Number.isFinite(approx)) {\r\n      return exponent > 0 ? Number.MAX_VALUE : 0;\r\n    }\r\n    return approx;\r\n  } catch {\r\n    const approx = approxLog10BigNum(bn);\r\n    if (!Number.isFinite(approx)) return Number.MAX_VALUE;\r\n    if (approx > 308) return Number.MAX_VALUE;\r\n    if (approx < -324) return 0;\r\n    const value = Math.pow(10, approx);\r\n    return Number.isFinite(value) ? value : Number.MAX_VALUE;\r\n  }\r\n}\r\n\r\nconst LN10 = Math.log(10);\r\n\r\nfunction plainLevelDelta(nextLevelBn, prevLevelBn) {\r\n  const next = ensureLevelBigNum(nextLevelBn);\r\n  const prev = ensureLevelBigNum(prevLevelBn);\r\n\r\n  if (next.isInfinite?.()) {\r\n    return prev.isInfinite?.() ? BigNum.fromInt(0) : BigNum.fromAny('Infinity');\r\n  }\r\n  if (prev.isInfinite?.()) {\r\n    return BigNum.fromInt(0);\r\n  }\r\n\r\n  try {\r\n    const nextPlain = next.toPlainIntegerString?.();\r\n    const prevPlain = prev.toPlainIntegerString?.();\r\n    if (!nextPlain || !prevPlain) return BigNum.fromInt(0);\r\n    if (nextPlain === 'Infinity') return BigNum.fromAny('Infinity');\r\n    if (prevPlain === 'Infinity') return BigNum.fromInt(0);\r\n    if (nextPlain === prevPlain) return BigNum.fromInt(0);\r\n    const diff = BigInt(nextPlain) - BigInt(prevPlain);\r\n    if (diff <= 0n) return BigNum.fromInt(0);\r\n    return BigNum.fromAny(diff.toString());\r\n  } catch {\r\n    return BigNum.fromInt(0);\r\n  }\r\n}\r\n\r\nfunction decimalMultiplierString(value) {\r\n  if (!Number.isFinite(value) || value <= 0) return '1';\r\n  let out = value.toFixed(12);\r\n  out = out.replace(/0+$/, '');\r\n  if (out.endsWith('.')) out += '0';\r\n  return out;\r\n}\r\n\r\nexport function computeDefaultUpgradeCost(baseCost, level, upgType = 'NM') {\r\n  let baseBn;\r\n  try { baseBn = BigNum.fromAny(baseCost ?? 0); }\r\n  catch { baseBn = BigNum.fromInt(0); }\r\n\r\n  let levelNumber = 0;\r\n  try {\r\n    if (level instanceof BigNum) {\r\n      const plain = level.toPlainIntegerString?.();\r\n      if (plain && plain !== 'Infinity') {\r\n        levelNumber = Number.parseInt(plain, 10);\r\n      }\r\n    } else {\r\n      levelNumber = Number(level) || 0;\r\n    }\r\n  } catch {\r\n    levelNumber = 0;\r\n  }\r\n\r\n  const upg = { upgType, numUpgEvolutions: 0 };\r\n  if (`${upgType ?? ''}`.toUpperCase() === 'HM') {\r\n    const evolutions = Math.max(0, Math.floor(levelNumber / HM_EVOLUTION_INTERVAL));\r\n    if (Number.isFinite(evolutions)) {\r\n      upg.numUpgEvolutions = evolutions;\r\n    }\r\n  }\r\n\r\n  const preset = resolveDefaultScalingRatio(upg);\r\n  const ratio = Number.isFinite(preset?.ratio) ? preset.ratio : 1;\r\n  const scaling = {\r\n    baseBn,\r\n    baseLog10: approxLog10BigNum(baseBn),\r\n    ratio,\r\n    ratioMinus1: Math.max(0, ratio - 1),\r\n    ratioLog10: Math.log10(Math.max(ratio, 1)),\r\n    ratioLn: Math.log(Math.max(ratio, 1)),\r\n    ratioStr: decimalMultiplierString(Math.max(ratio, 1)),\r\n    defaultPreset: preset?.preset,\r\n  };\r\n\r\n  upg.scaling = scaling;\r\n\r\n  return costAtLevelUsingScaling(upg, levelNumber);\r\n}\r\n\r\nconst DEFAULT_SCALING_PRESETS = {\r\n  STANDARD(upg) {\r\n    const upgType = `${upg?.upgType ?? ''}`.toUpperCase();\r\n    if (upgType === 'HM') {\r\n      const evol = activeEvolutionsForUpgrade(upg);\r\n      return 1.50 + (0.10 * evol);\r\n    }\r\n    return 1.20;\r\n  },\r\n  HM(upg) {\r\n    return DEFAULT_SCALING_PRESETS.STANDARD(upg);\r\n  },\r\n  NM() {\r\n    return 1.20;\r\n  },\r\n};\r\n\r\nfunction normalizeHmEvolutionCount(value) {\r\n  const n = Number(value);\r\n  if (Number.isFinite(n) && n > 0) return Math.max(0, Math.floor(n));\r\n  return 0;\r\n}\r\n\r\nfunction activeEvolutionsForUpgrade(upg) {\r\n  if (!upg) return 0;\r\n  const active = Number(upg.activeEvolutions);\r\n  if (Number.isFinite(active) && active >= 0) return active;\r\n  return normalizeHmEvolutionCount(upg.numUpgEvolutions);\r\n}\r\n\r\nfunction hmLevelCapForEvolutions(evolutions) {\r\n  const cycles = normalizeHmEvolutionCount(evolutions);\r\n  const cap = HM_EVOLUTION_INTERVAL * (cycles + 1);\r\n  const capBn = BigNum.fromAny(cap);\r\n  return {\r\n    cap,\r\n    capBn,\r\n    capFmtHtml: formatBigNumAsHtml(capBn),\r\n    capFmtText: formatBigNumAsPlain(capBn),\r\n  };\r\n}\r\n\r\nfunction hmMilestoneHits(levelBn, milestoneLevel) {\r\n  if (!levelBn || typeof milestoneLevel !== 'number') return 0;\r\n  try {\r\n    const plain = levelBn.toPlainIntegerString?.();\r\n    if (!plain || plain === 'Infinity') return 0;\r\n    const lvl = BigInt(plain);\r\n    const base = BigInt(Math.max(0, Math.floor(milestoneLevel)));\r\n    const interval = BigInt(HM_EVOLUTION_INTERVAL);\r\n    if (lvl < base) return 0;\r\n    const delta = lvl - base;\r\n    const cycles = delta / interval;\r\n    return Number(cycles + 1n);\r\n  } catch {\r\n    const approx = levelBigNumToNumber(levelBn);\r\n    if (!Number.isFinite(approx) || approx < milestoneLevel) return 0;\r\n    const delta = approx - milestoneLevel;\r\n    return Math.max(0, Math.floor(delta / HM_EVOLUTION_INTERVAL) + 1);\r\n  }\r\n}\r\n\r\nfunction hmMilestoneMultiplier(multiplier, hits) {\r\n  if (!(hits > 0)) return BigNum.fromInt(1);\r\n  let out;\r\n  try { out = BigNum.fromAny(multiplier ?? 1); }\r\n  catch { out = BigNum.fromInt(1); }\r\n  let result = out.clone?.() ?? out;\r\n  for (let i = 1; i < hits; i += 1) {\r\n    try { result = result.mulBigNumInteger(out); }\r\n    catch {\r\n      try { result = result.mulDecimal(String(out), 18); }\r\n      catch { return BigNum.fromAny('Infinity'); }\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction resolveHmMilestones(upg, areaKey = DEFAULT_AREA_KEY) {\r\n  const milestones = upg?.hmMilestones;\r\n  if (Array.isArray(milestones)) return milestones;\r\n  if (!milestones || typeof milestones !== 'object') return [];\r\n\r\n  const normalizedArea = normalizeAreaKey(areaKey || upg?.area || DEFAULT_AREA_KEY);\r\n\r\n  if (normalizedArea) {\r\n    if (Array.isArray(milestones[normalizedArea])) return milestones[normalizedArea];\r\n    if (Array.isArray(milestones[areaKey])) return milestones[areaKey];\r\n  }\r\n\r\n  if (Array.isArray(milestones.default)) return milestones.default;\r\n  return [];\r\n}\r\n\r\nfunction safeMultiplyBigNum(base, factor) {\r\n  let out = base instanceof BigNum ? base : BigNum.fromAny(base ?? 1);\r\n  let f = factor instanceof BigNum ? factor : null;\r\n  if (!f) {\r\n    try { f = BigNum.fromAny(factor ?? 1); }\r\n    catch { return out; }\r\n  }\r\n  try { return out.mulBigNumInteger(f); }\r\n  catch {}\r\n  try { return out.mulDecimal(f.toScientific?.(12) ?? String(factor ?? '1'), 18); }\r\n  catch {}\r\n  return out;\r\n}\r\n\r\nfunction applyHmEvolutionMeta(upg, evolutions = 0) {\r\n  if (!upg || upg.upgType !== 'HM') return;\r\n  delete upg.scaling;\r\n  const { cap, capBn, capFmtHtml, capFmtText } = hmLevelCapForEvolutions(evolutions);\r\n  upg.activeEvolutions = evolutions;\r\n  upg.lvlCap = cap;\r\n  upg.lvlCapBn = capBn;\r\n  upg.lvlCapFmtHtml = capFmtHtml;\r\n  upg.lvlCapFmtText = capFmtText;\r\n}\r\n\r\nfunction computeHmMultipliers(upg, levelBn, areaKey = DEFAULT_AREA_KEY) {\r\n  if (!upg || upg.upgType !== 'HM') {\r\n    return {\r\n      selfMult: BigNum.fromInt(1),\r\n      xpMult: BigNum.fromInt(1),\r\n      coinMult: BigNum.fromInt(1),\r\n      mpMult: BigNum.fromInt(1),\r\n    };\r\n  }\r\n\r\n  const milestones = resolveHmMilestones(upg, areaKey);\r\n  let selfMult = BigNum.fromInt(1);\r\n  let xpMult = BigNum.fromInt(1);\r\n  let coinMult = BigNum.fromInt(1);\r\n  let mpMult = BigNum.fromInt(1);\r\n\r\n  for (const m of milestones) {\r\n    const hits = hmMilestoneHits(levelBn, Number(m?.level ?? m?.lvl ?? 0));\r\n    if (!(hits > 0)) continue;\r\n    const mult = hmMilestoneMultiplier(m.multiplier ?? m.mult ?? m.value ?? 1, hits);\r\n    const target = `${m.target ?? m.type ?? 'self'}`.toLowerCase();\r\n    if (target === 'xp') {\r\n      xpMult = safeMultiplyBigNum(xpMult, mult);\r\n    } else if (target === 'coin' || target === 'coins') {\r\n      coinMult = safeMultiplyBigNum(coinMult, mult);\r\n    } else if (target === 'mp') {\r\n      mpMult = safeMultiplyBigNum(mpMult, mult);\r\n    } else {\r\n      selfMult = safeMultiplyBigNum(selfMult, mult);\r\n    }\r\n  }\r\n\r\n  const evolutions = activeEvolutionsForUpgrade(upg);\r\n  for (let i = 0; i < evolutions; i += 1) {\r\n    selfMult = safeMultiplyBigNum(selfMult, HM_EVOLUTION_EFFECT_MULT_BN);\r\n  }\r\n\r\n  return { selfMult, xpMult, coinMult, mpMult };\r\n}\r\n\r\nfunction hmNextMilestoneLevel(upg, levelBn, areaKey = DEFAULT_AREA_KEY) {\r\n  if (!upg || upg.upgType !== 'HM') return null;\r\n  if (levelBn?.isInfinite?.()) return BigNum.fromAny('Infinity');\r\n  const milestones = resolveHmMilestones(upg, areaKey);\r\n  if (!milestones.length) return null;\r\n\r\n  let best = null;\r\n  for (const m of milestones) {\r\n    const lvl = Math.max(0, Math.floor(Number(m?.level ?? m?.lvl ?? 0)));\r\n    const hits = hmMilestoneHits(levelBn, lvl);\r\n    let candidate = null;\r\n    try {\r\n      const base = BigInt(lvl);\r\n      const nextHits = BigInt(Math.max(0, hits));\r\n      const targetBi = base + (BigInt(HM_EVOLUTION_INTERVAL) * nextHits);\r\n      if (targetBi > 0n) {\r\n        candidate = BigNum.fromAny(targetBi.toString());\r\n      }\r\n    } catch {}\r\n    if (!candidate) {\r\n      const increment = BigNum.fromAny(HM_EVOLUTION_INTERVAL * Math.max(0, hits));\r\n      try { candidate = increment.add(BigNum.fromAny(lvl)); }\r\n      catch { candidate = BigNum.fromAny(lvl + HM_EVOLUTION_INTERVAL * hits); }\r\n    }\r\n    if (!candidate) continue;\r\n    if (levelBn?.cmp?.(candidate) >= 0) {\r\n      try { candidate = candidate.add(BigNum.fromAny(HM_EVOLUTION_INTERVAL)); }\r\n      catch {}\r\n    }\r\n    if (!best || best.cmp(candidate) > 0) {\r\n      best = candidate;\r\n    }\r\n  }\r\n  return best;\r\n}\r\n\r\nfunction resolveDefaultScalingRatio(upg) {\r\n  if (!upg) return null;\r\n\r\n  const tryPreset = (name) => {\r\n    const presetName = `${name ?? ''}`.toUpperCase();\r\n    if (!presetName) return null;\r\n    const presetFn = DEFAULT_SCALING_PRESETS[presetName];\r\n    if (typeof presetFn !== 'function') return null;\r\n    const ratio = presetFn(upg);\r\n    if (!Number.isFinite(ratio) || ratio <= 0) return null;\r\n    return { ratio, preset: presetName };\r\n  };\r\n\r\n  return (\r\n    tryPreset(upg.scalingPreset)\r\n    || tryPreset(upg.upgType)\r\n    || tryPreset('STANDARD')\r\n  );\r\n}\r\n\r\nfunction ensureUpgradeScaling(upg) {\r\n  if (!upg) return null;\r\n  if (upg.scaling && upg.scaling.baseBn) return upg.scaling;\r\n  try {\r\n    const baseBn = BigNum.fromAny(upg.baseCost ?? upg.baseCostBn ?? 0);\r\n\r\n    const providedScaling = upg.scaling ?? {};\r\n    let ratio = Number(providedScaling.ratio);\r\n    if (!(ratio > 0) || !Number.isFinite(ratio)) ratio = null;\r\n\r\n    let ratioStr = typeof providedScaling.ratioStr === 'string'\r\n      ? providedScaling.ratioStr.trim()\r\n      : '';\r\n    if (!ratio && ratioStr) {\r\n      const parsed = Number(ratioStr);\r\n      if (Number.isFinite(parsed) && parsed > 0) {\r\n        ratio = parsed;\r\n      }\r\n    }\r\n\r\n    let ratioLog10 = Number(providedScaling.ratioLog10);\r\n    if (!Number.isFinite(ratioLog10)) ratioLog10 = null;\r\n    if (!ratio && ratioLog10 != null) {\r\n      const pow = Math.pow(10, ratioLog10);\r\n      if (Number.isFinite(pow) && pow > 0) ratio = pow;\r\n    }\r\n\r\n    let ratioLn = Number(providedScaling.ratioLn);\r\n    if (!Number.isFinite(ratioLn)) ratioLn = null;\r\n    if (!ratio && ratioLn != null) {\r\n      const exp = Math.exp(ratioLn);\r\n      if (Number.isFinite(exp) && exp > 0) ratio = exp;\r\n    }\r\n\r\n    if (!ratio) {\r\n      const ratioMinus1 = Number(providedScaling.ratioMinus1);\r\n      if (Number.isFinite(ratioMinus1) && ratioMinus1 > 0) {\r\n        ratio = ratioMinus1 + 1;\r\n      }\r\n    }\r\n\r\n    let defaultPreset = null;\r\n    if (!ratio) {\r\n      const resolved = resolveDefaultScalingRatio(upg);\r\n      if (resolved) {\r\n        ratio = resolved.ratio;\r\n        defaultPreset = resolved.preset;\r\n      }\r\n    }\r\n\r\n    if (!(ratio > 1)) {\r\n      ratio = 1;\r\n      ratioStr = '1';\r\n      ratioLog10 = 0;\r\n      ratioLn = 0;\r\n      var ratioMinus1 = 0;\r\n    } else {\r\n      ratio = Number(ratio);\r\n      ratioStr = decimalMultiplierString(ratio);\r\n      ratioLog10 = Math.log10(ratio);\r\n      ratioLn = Math.log(ratio);\r\n      var ratioMinus1 = Math.max(1e-12, ratio - 1);\r\n    }\r\n\r\n    const baseLog10 = approxLog10BigNum(baseBn);\r\n\r\n    const scaling = Object.assign({}, providedScaling, {\r\n      baseBn,\r\n      baseLog10,\r\n      ratio,\r\n      ratioMinus1,\r\n      ratioLog10,\r\n      ratioLn,\r\n      ratioStr,\r\n      defaultPreset: defaultPreset ?? providedScaling.defaultPreset,\r\n    });\r\n\r\n    // Expose the in-progress scaling so recursive cost checks can use it\r\n    upg.scaling = scaling;\r\n\r\n    try {\r\n      const c0 = BigNum.fromAny(upg.costAtLevel?.(0) ?? 0);\r\n      const c1 = BigNum.fromAny(upg.costAtLevel?.(1) ?? 0);\r\n      const cF = BigNum.fromAny(upg.costAtLevel?.(32) ?? 0);\r\n      if (c0.cmp(c1) === 0 && c0.cmp(cF) === 0) {\r\n        scaling.ratio = 1;\r\n        scaling.ratioMinus1 = 0;\r\n        scaling.ratioLog10 = 0;\r\n        scaling.ratioLn = 0;\r\n        scaling.ratioStr = '1';\r\n      }\r\n    } catch {}\r\n\r\n    return scaling;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction costAtLevelUsingScaling(upg, level) {\r\n  const scaling = ensureUpgradeScaling(upg);\r\n  if (!scaling) return BigNum.fromInt(0);\r\n  const lvl = Math.max(0, Math.floor(Number(level) || 0));\r\n  if (lvl === 0) return BigNum.fromAny(scaling.baseBn);\r\n\r\n  // Approach A (robust & simple): multiply without flooring, floor once at end\r\n  if (lvl <= 100) {\r\n    let price = BigNum.fromAny(scaling.baseBn);\r\n    for (let i = 0; i < lvl; i += 1) {\r\n      // precise decimal multiply (no truncation each step)\r\n      price = price.mulDecimal(scaling.ratioStr);\r\n    }\r\n    return price.floorToInteger();\r\n  }\r\n\r\n  // Existing mid-range anchor + tail (kept as-is)\r\n  if (lvl < 10000) {\r\n    const anchor = Math.max(0, lvl - 10);\r\n    let price = bigNumFromLog10(scaling.baseLog10 + anchor * scaling.ratioLog10);\r\n    for (let step = anchor; step < lvl; step += 1) {\r\n      price = price.mulDecimal(scaling.ratioStr);\r\n    }\r\n    return price.floorToInteger();\r\n  }\r\n\r\n  // Very large levels: closed form via logs\r\n  return bigNumFromLog10(scaling.baseLog10 + lvl * scaling.ratioLog10).floorToInteger();\r\n}\r\n\r\n\r\nfunction logExpMinus1(x) {\r\n  if (!Number.isFinite(x)) return x;\r\n  if (x < 1e-6) {\r\n    return Math.log(Math.expm1(x));\r\n  }\r\n  if (x < 50) {\r\n    return Math.log(Math.expm1(x));\r\n  }\r\n  const negExp = Math.exp(-x);\r\n  return x + Math.log1p(-negExp);\r\n}\r\n\r\nfunction logSeriesTotal(upg, startLevel, count) {\r\n  if (!(count > 0)) return Number.NEGATIVE_INFINITY;\r\n  const scaling = ensureUpgradeScaling(upg);\r\n  if (!scaling) return Number.NEGATIVE_INFINITY;\r\n  if (!(scaling.ratioMinus1 > 0) || !Number.isFinite(scaling.ratioLn)) {\r\n    return Number.POSITIVE_INFINITY;\r\n  }\r\n\r\n  const startLn = (scaling.baseLog10 * LN10) + (startLevel * scaling.ratioLn);\r\n  const growth = scaling.ratioLn * count;\r\n  const numerLn = logExpMinus1(growth);\r\n  if (!Number.isFinite(numerLn)) return Number.POSITIVE_INFINITY;\r\n  const denomLn = Math.log(scaling.ratioMinus1);\r\n  const totalLn = startLn + numerLn - denomLn;\r\n  return totalLn / LN10;\r\n}\r\n\r\nfunction totalCostBigNum(upg, startLevel, count) {\r\n  if (!(count > 0)) return BigNum.fromInt(0);\r\n  const scaling = ensureUpgradeScaling(upg);\r\n  if (!scaling) return BigNum.fromInt(0);\r\n  const targetLevel = startLevel + count;\r\n\r\n  if (targetLevel <= 100) {\r\n    let price = BigNum.fromAny(upg.costAtLevel(startLevel));\r\n    let total = BigNum.fromInt(0);\r\n    for (let i = 0; i < count; i += 1) {\r\n      total = total.add(price);\r\n      if (i + 1 < count) price = price.mulDecimalFloor(scaling.ratioStr);\r\n    }\r\n    return total;\r\n  }\r\n\r\n  if (targetLevel < 10000) {\r\n    const tailCount = Math.min(10, count);\r\n    const headCount = count - tailCount;\r\n    let total = BigNum.fromInt(0);\r\n    if (headCount > 0) {\r\n      const headLog = logSeriesTotal(upg, startLevel, headCount);\r\n      total = total.add(bigNumFromLog10(headLog));\r\n    }\r\n    if (tailCount > 0) {\r\n      const tailStart = startLevel + headCount;\r\n      let price = BigNum.fromAny(upg.costAtLevel(tailStart));\r\n      for (let i = 0; i < tailCount; i += 1) {\r\n        total = total.add(price);\r\n        if (i + 1 < tailCount) price = price.mulDecimalFloor(scaling.ratioStr);\r\n      }\r\n    }\r\n    return total;\r\n  }\r\n\r\n  const totalLog = logSeriesTotal(upg, startLevel, count);\r\n  return bigNumFromLog10(totalLog);\r\n}\r\n\r\nfunction log10OnePlusPow10(exponent) {\r\n  if (!Number.isFinite(exponent)) {\r\n    if (exponent > 0) return exponent;\r\n    if (exponent === 0) return Math.log10(2);\r\n    return 0;\r\n  }\r\n  if (exponent > 308) return exponent;\r\n  if (exponent < -20) {\r\n    const pow = Math.pow(10, exponent);\r\n    return pow / LN10;\r\n  }\r\n  const pow = Math.pow(10, exponent);\r\n  if (!Number.isFinite(pow)) return exponent > 0 ? exponent : 0;\r\n  return Math.log1p(pow) / LN10;\r\n}\r\n\r\nconst MAX_LEVEL_DELTA_LIMIT = (() => {\r\n  try {\r\n    const approx = levelBigNumToNumber(MAX_LEVEL_DELTA);\r\n    if (!Number.isFinite(approx)) return Number.POSITIVE_INFINITY;\r\n    if (approx <= 0) return 0;\r\n    return Math.floor(approx);\r\n  } catch {\r\n    return Number.MAX_SAFE_INTEGER;\r\n  }\r\n})();\r\n\r\nconst FLOAT64_BUFFER = new ArrayBuffer(8);\r\nconst FLOAT64_VIEW = new Float64Array(FLOAT64_BUFFER);\r\nconst INT64_VIEW = new BigInt64Array(FLOAT64_BUFFER);\r\n\r\nfunction nextDownPositive(value) {\r\n  if (!(value > 0) || !Number.isFinite(value)) return value;\r\n  FLOAT64_VIEW[0] = value;\r\n  if (FLOAT64_VIEW[0] <= 0) return 0;\r\n  INT64_VIEW[0] -= 1n;\r\n  const next = FLOAT64_VIEW[0];\r\n  return next > 0 ? next : 0;\r\n}\r\n\r\nfunction nextUpPositive(value) {\r\n  if (!(value >= 0) || !Number.isFinite(value)) return value;\r\n  FLOAT64_VIEW[0] = value;\r\n  INT64_VIEW[0] += 1n;\r\n  const next = FLOAT64_VIEW[0];\r\n  return next > value ? next : value;\r\n}\r\n\r\nfunction safeDecrementCount(value) {\r\n  if (!(value > 0)) return 0;\r\n  const dec = Math.floor(value - 1);\r\n  if (dec < value) return dec;\r\n  const next = nextDownPositive(value);\r\n  if (next < value) return next;\r\n  return value > 1 ? value / 2 : 0;\r\n}\r\n\r\nfunction countToBigNum(count) {\r\n  if (!(count > 0) || !Number.isFinite(count)) return BigNum.fromInt(0);\r\n  const floored = Math.floor(count);\r\n  if (!(floored > 0)) return BigNum.fromInt(0);\r\n  if (floored <= Number.MAX_SAFE_INTEGER) {\r\n    return BigNum.fromInt(floored);\r\n  }\r\n  let str;\r\n  try {\r\n    str = floored.toLocaleString('fullwide', { useGrouping: false, maximumFractionDigits: 0 });\r\n  } catch {\r\n    str = floored.toString();\r\n  }\r\n  if (!str || !/\\d/.test(str)) return BigNum.fromInt(0);\r\n  return BigNum.fromAny(str);\r\n}\r\n\r\nfunction calculateBulkPurchase(upg, startLevel, walletBn, maxLevels = MAX_LEVEL_DELTA, options = {}) {\r\n  const scaling = ensureUpgradeScaling(upg);\r\n  const zero = BigNum.fromInt(0);\r\n  const opts = options || {};\r\n  const fastOnly = !!opts.fastOnly;\r\n  walletBn = walletBn instanceof BigNum ? walletBn : BigNum.fromAny(walletBn ?? 0);\r\n  if (!scaling) {\r\n    return { count: zero, spent: zero, nextPrice: zero, numericCount: 0 };\r\n  }\r\n\r\n  const startLevelNum = Math.max(0, Math.floor(levelBigNumToNumber(startLevel)));\r\n\r\n  const cap = Number.isFinite(upg.lvlCap)\r\n    ? Math.max(0, Math.floor(upg.lvlCap))\r\n    : Number.POSITIVE_INFINITY;\r\n  const maxLevelsNum = typeof maxLevels === 'number'\r\n    ? maxLevels\r\n    : levelBigNumToNumber(maxLevels);\r\n  const capRoom = Number.isFinite(cap)\r\n    ? Math.max(0, cap - startLevelNum)\r\n    : MAX_LEVEL_DELTA_LIMIT;\r\n  let room = Number.isFinite(maxLevelsNum)\r\n    ? Math.max(0, Math.floor(maxLevelsNum))\r\n    : MAX_LEVEL_DELTA_LIMIT;\r\n  room = Math.min(room, MAX_LEVEL_DELTA_LIMIT, capRoom);\r\n  if (!(room > 0)) {\r\n    const nextPrice = capRoom <= 0 ? zero : BigNum.fromAny(upg.costAtLevel(startLevelNum));\r\n    return { count: zero, spent: zero, nextPrice, numericCount: 0 };\r\n  }\r\n\r\n  // For small levels we can cheaply compute an exact floored progression, which\r\n  // avoids undercounting caused by geometric approximations that ignore per-step\r\n  // flooring (e.g., costs like 3 \u2192 3 \u2192 4 instead of 3 \u2192 3.6 \u2192 4.32).\r\n  const remainingToHundred = 100 - startLevelNum;\r\n  if (Number.isFinite(startLevelNum) && remainingToHundred > 0) {\r\n    const limit = Math.min(room, remainingToHundred);\r\n    let price = BigNum.fromAny(upg.costAtLevel(startLevelNum));\r\n    let spent = zero;\r\n    let count = 0;\r\n\r\n    while (count < limit) {\r\n      // Use the exact per-level cost function (with its own flooring logic)\r\n      // instead of multiplying by ratio, so we don't drift when costs change\r\n      // non-geometrically around low levels.\r\n      price = BigNum.fromAny(upg.costAtLevel(startLevelNum + count));\r\n      const newSpent = spent.add(price);\r\n      if (newSpent.cmp(walletBn) > 0) break;\r\n      spent = newSpent;\r\n      count += 1;\r\n    }\r\n\r\n    const nextLevel = startLevelNum + count;\r\n    const reachedCap = Number.isFinite(cap) && nextLevel >= cap;\r\n    const countBn = countToBigNum(count);\r\n\r\n    if (count < limit || reachedCap || room <= count) {\r\n      const nextPrice = reachedCap\r\n        ? zero\r\n        : BigNum.fromAny(upg.costAtLevel(nextLevel));\r\n      return { count: countBn, spent, nextPrice, numericCount: count };\r\n    }\r\n\r\n    const nextStartLevel = (() => {\r\n      try { return toUpgradeBigNum(startLevel ?? startLevelNum, startLevelNum).add(countBn); }\r\n      catch { return startLevelNum + count; }\r\n    })();\r\n    const tail = calculateBulkPurchase(\r\n      upg,\r\n      nextStartLevel,\r\n      walletBn.sub(spent),\r\n      room - count,\r\n      options,\r\n    );\r\n\r\n    const tailCount = tail?.count instanceof BigNum ? tail.count : countToBigNum(tail?.numericCount ?? 0);\r\n    const totalCount = countBn.add(tailCount);\r\n    const totalSpent = (tail?.spent ?? zero).add(spent);\r\n\r\n    return {\r\n      count: totalCount,\r\n      spent: totalSpent,\r\n      nextPrice: tail?.nextPrice ?? zero,\r\n      numericCount: count + (tail?.numericCount ?? 0),\r\n    };\r\n  }\r\n\r\nlet walletLog = approxLog10BigNum(walletBn);\r\n\r\nconst ratioLog10 = scaling.ratioLog10;\r\nconst ratioMinus1 = scaling.ratioMinus1;\r\nconst firstPrice = BigNum.fromAny(upg.costAtLevel(startLevelNum));\r\n\r\n\r\nconst startPriceLog = scaling.baseLog10 + (startLevelNum * ratioLog10);\r\n\r\n// Fallback: if walletLog isn't finite *or* magnitudes are so huge that\r\n// double-precision subtraction will be meaningless, do a pure-BigNum search.\r\nconst needBnSearch =\r\n  (ratioMinus1 > 0) && (\r\n    !Number.isFinite(walletLog) ||\r\n    (Math.abs(walletLog) > 1e6 && Math.abs(startPriceLog) > 1e6)\r\n  );\r\n\r\nif (needBnSearch) {\r\n  // Quick \"can't even buy 1\" check\r\n  const firstPrice = BigNum.fromAny(upg.costAtLevel(startLevelNum));\r\n  if (walletBn.cmp(firstPrice) < 0) {\r\n    return { count: zero, spent: zero, nextPrice: firstPrice, numericCount: 0 };\r\n  }\r\n\r\n  // Bound the affordable count using only BigNum compares\r\n  const hardLimit = Number.isFinite(room) ? Math.max(1, Math.floor(room)) : Number.MAX_VALUE;\r\n  let lo = 1;\r\n  let hi = 1;\r\n\r\nwhile (hi < hardLimit) {\r\n  const spentLog = logSeriesTotal(upg, startLevelNum, hi);\r\n  const spentBn  = bigNumFromLog10(spentLog);\r\n  if (spentBn.cmp(walletBn) <= 0) {\r\n    const doubled = hi * 2;\r\n    if (!Number.isFinite(doubled) || doubled <= hi) { hi = hardLimit; break; }\r\n    lo = hi;\r\n    hi = Math.min(doubled, hardLimit);\r\n  } else {\r\n    break;\r\n  }\r\n}\r\n\r\n  let steps = 0;\r\n  while (lo < hi && steps < 256) {\r\n    const mid = Math.max(lo + 1, Math.floor((lo + hi + 1) / 2));\r\n    const spentLog = logSeriesTotal(upg, startLevelNum, mid);\r\n    const spentBn  = bigNumFromLog10(spentLog);\r\n    if (spentBn.cmp(walletBn) <= 0) {\r\n      lo = mid;\r\n    } else {\r\n      hi = mid - 1;\r\n    }\r\n    steps++;\r\n  }\r\n\r\n  const count = Math.max(1, lo);\r\n  const countBn = countToBigNum(count);\r\n\r\n  // In fastOnly mode we can skip exact 'spent'; otherwise compute precisely.\r\n  let spent = zero;\r\n  let nextPrice = zero;\r\n  if (!fastOnly) {\r\n    spent = totalCostBigNum(upg, startLevelNum, count);\r\n    if (Number.isFinite(cap)) {\r\n      const capRoom = Math.max(0, Math.floor(cap - Math.min(startLevelNum, cap)));\r\n      if (count >= capRoom) {\r\n        nextPrice = zero;\r\n      } else {\r\n        nextPrice = bigNumFromLog10(startPriceLog + count * ratioLog10);\r\n      }\r\n    } else {\r\n      nextPrice = bigNumFromLog10(startPriceLog + count * ratioLog10);\r\n    }\r\n  }\r\n\r\n  return {\r\n    count: countBn,\r\n    spent,\r\n    nextPrice,\r\n    numericCount: count,\r\n  };\r\n}\r\n\r\n  if (walletBn.cmp(firstPrice) < 0) {\r\n    return { count: zero, spent: zero, nextPrice: firstPrice, numericCount: 0 };\r\n  }\r\n\r\nlet isConstantCost = false;\r\nlet secondPrice = null, farPrice = null;\r\n\r\ntry { secondPrice = BigNum.fromAny(upg.costAtLevel(startLevelNum + 1)); } catch {}\r\ntry {\r\n  const farProbe = Math.min(\r\n    Number.isFinite(cap) ? Math.max(startLevelNum + 1, Math.floor(cap)) : startLevelNum + 32,\r\n    startLevelNum + 32\r\n  );\r\n  farPrice = BigNum.fromAny(upg.costAtLevel(farProbe));\r\n} catch {}\r\nif (!isConstantCost && !(scaling.ratioMinus1 > 0)) {\r\n  isConstantCost = true;\r\n}\r\n\r\nif (secondPrice && farPrice) {\r\n  isConstantCost =\r\n    secondPrice.cmp(firstPrice) === 0 &&\r\n    farPrice.cmp(firstPrice) === 0;\r\n}\r\n\r\nif (!isConstantCost && !(scaling.ratioMinus1 > 0)) {\r\n  isConstantCost = true;\r\n}\r\n\r\n  const limit = Number.isFinite(room)\r\n    ? Math.max(0, Math.floor(room))\r\n    : Number.MAX_VALUE;\r\n\r\n  if (isConstantCost) {\r\n  const capBn = toUpgradeBigNum(upg.lvlCapBn ?? 'Infinity', 'Infinity');\r\n  const lvlBn = toUpgradeBigNum(startLevel ?? 0, 0);\r\n  const roomBn = capBn.isInfinite?.()\r\n    ? BigNum.fromAny('Infinity')\r\n    : capBn.sub(lvlBn).floorToInteger();\r\n\r\n  const { count, countBn, spent, nextPrice } = estimateFlatBulk(\r\n    firstPrice,\r\n    walletBn,\r\n    roomBn\r\n  );\r\n\r\n  return {\r\n    count: countBn,\r\n    spent,\r\n    nextPrice,\r\n    numericCount: count,\r\n  };\r\n}\r\n\r\nif (!(ratioLog10 > 0) || !(ratioMinus1 > 0)) {\r\n  const capBn = toUpgradeBigNum(upg.lvlCapBn ?? 'Infinity', 'Infinity');\r\n  const lvlBn = toUpgradeBigNum(startLevel ?? 0, 0);\r\n  const roomBn = capBn.isInfinite?.()\r\n    ? BigNum.fromAny('Infinity')\r\n    : capBn.sub(lvlBn).floorToInteger();\r\n\r\n  const { count, countBn, spent, nextPrice } =\r\n    estimateFlatBulk(firstPrice, walletBn, roomBn);\r\n\r\n  return { count: countBn, spent, nextPrice, numericCount: count };\r\n}\r\n\r\n  const ratioMinus1Log = Math.log10(ratioMinus1);\r\n  if (!Number.isFinite(ratioMinus1Log)) {\r\n    return { count: zero, spent: zero, nextPrice: firstPrice, numericCount: 0 };\r\n  }\r\n\r\n  const logTarget = log10OnePlusPow10(walletLog + ratioMinus1Log - startPriceLog);\r\n  let approxCount = logTarget / ratioLog10;\r\n  if (!Number.isFinite(approxCount) || approxCount < 0) approxCount = 0;\r\n\r\n  let count = Math.floor(Math.min(limit, approxCount));\r\n  if (!Number.isFinite(count)) count = limit;\r\n  if (count <= 0) count = 1;\r\n\r\n  const EPS = 1e-7;\r\n  let spentLog = logSeriesTotal(upg, startLevelNum, count);\r\n  let tuneSteps = 0;\r\n  const MAX_TUNE_STEPS = 2048;\r\n\r\n  while (count > 0 && (!Number.isFinite(spentLog) || spentLog > walletLog + EPS) && tuneSteps < MAX_TUNE_STEPS) {\r\n    const overshoot = Number.isFinite(spentLog)\r\n      ? Math.max(1, Math.ceil((spentLog - walletLog) / Math.max(ratioLog10, 1e-12)))\r\n      : Math.max(1, Math.floor(count / 2));\r\n    const reduced = Math.max(0, Math.floor(count - overshoot));\r\n    if (reduced < count) {\r\n      count = reduced;\r\n    } else {\r\n      const next = nextDownPositive(count);\r\n      if (!(next < count)) break;\r\n      count = next;\r\n    }\r\n    spentLog = count > 0 ? logSeriesTotal(upg, startLevelNum, count) : Number.NEGATIVE_INFINITY;\r\n    tuneSteps += 1;\r\n  }\r\n\r\n  if (count <= 0 || !Number.isFinite(count)) {\r\n    if (walletBn.cmp(firstPrice) >= 0) {\r\n      count = 1;\r\n      spentLog = approxLog10BigNum(firstPrice);\r\n    } else {\r\n      return { count: zero, spent: zero, nextPrice: firstPrice, numericCount: 0 };\r\n    }\r\n  }\r\n\r\n  if (count < limit) {\r\n  const safeTimes2 = (x) => {\r\n    const y = x * 2;\r\n    return Number.isFinite(y) ? y : Number.MAX_VALUE;\r\n  };\r\n\r\n  let lo = count;\r\n  let hi = Math.min(limit, Math.max(count + 1, safeTimes2(count)));\r\n  let hiLog = logSeriesTotal(upg, startLevelNum, hi);\r\n\r\n  while (lo < hi && Number.isFinite(hiLog) && hiLog <= walletLog + EPS && hi < limit) {\r\n    lo = hi;\r\n    hi = Math.min(limit, safeTimes2(hi));\r\n    hiLog = logSeriesTotal(upg, startLevelNum, hi);\r\n  }\r\n\r\n  let left = lo, right = hi;\r\n  for (let i = 0; i < 256 && left < right; i += 1) {\r\n    const mid = Math.floor((left + right + 1) / 2);\r\n    const midLog = logSeriesTotal(upg, startLevelNum, mid);\r\n    if (Number.isFinite(midLog) && midLog <= walletLog + EPS) {\r\n      left = mid;\r\n      spentLog = midLog;\r\n    } else {\r\n      right = mid - 1;\r\n    }\r\n  }\r\n  count = left;\r\n}\r\n\r\n  let spent = null;\r\n  if (!fastOnly) {\r\n    spent = totalCostBigNum(upg, startLevelNum, count);\r\n    let guard = 0;\r\n    while (spent.cmp(walletBn) > 0 && count > 0 && guard < MAX_TUNE_STEPS) {\r\n      const decremented = safeDecrementCount(count);\r\n      if (!(decremented < count)) break;\r\n      count = decremented;\r\n      spent = totalCostBigNum(upg, startLevelNum, count);\r\n      guard += 1;\r\n    }\r\n    if (count <= 0) {\r\n      return { count: zero, spent: zero, nextPrice: firstPrice, numericCount: 0 };\r\n    }\r\n\r\n    if (count < limit && guard < MAX_TUNE_STEPS) {\r\n      while (count < limit && guard < MAX_TUNE_STEPS) {\r\n        const nextLevel = startLevelNum + count;\r\n        let nextCost;\r\n\r\n        try {\r\n          if (Number.isFinite(nextLevel) && nextLevel < Number.MAX_SAFE_INTEGER / 2) {\r\n            nextCost = BigNum.fromAny(upg.costAtLevel(nextLevel));\r\n          } else {\r\n            const nextLog = startPriceLog + (count * ratioLog10);\r\n            nextCost = bigNumFromLog10(nextLog).floorToInteger();\r\n          }\r\n        } catch {\r\n          break;\r\n        }\r\n\r\n        const newSpent = spent.add(nextCost);\r\n        if (newSpent.cmp(walletBn) > 0) {\r\n          break;\r\n        }\r\n\r\n        spent = newSpent;\r\n        count += 1;\r\n        guard += 1;\r\n      }\r\n    }\r\n  }\r\n\r\nlet nextPrice = zero;\r\n\r\nconst canUseNumericFinal =\r\n  !fastOnly &&\r\n  Number.isFinite(startLevelNum) &&\r\n  Number.isFinite(count) &&\r\n  startLevelNum < Number.MAX_SAFE_INTEGER / 2 &&\r\n  count < Number.MAX_SAFE_INTEGER / 2;\r\n\r\nif (!fastOnly) {\r\n  if (Number.isFinite(cap)) {\r\n    const capRoom = Math.max(0, Math.floor(cap - Math.min(startLevelNum, cap)));\r\n    if (count >= capRoom) {\r\n      nextPrice = zero;\r\n    } else if (canUseNumericFinal) {\r\n      const finalLevel = Math.floor(startLevelNum + count);\r\n      nextPrice = BigNum.fromAny(upg.costAtLevel(finalLevel));\r\n    } else {\r\n      // Fallback: compute via logs to avoid unsafe integer math\r\n      const nextLog = startPriceLog + count * ratioLog10;\r\n      nextPrice = bigNumFromLog10(nextLog);\r\n    }\r\n  } else {\r\n    if (canUseNumericFinal) {\r\n      const finalLevel = Math.floor(startLevelNum + count);\r\n      nextPrice = BigNum.fromAny(upg.costAtLevel(finalLevel));\r\n    } else {\r\n      const nextLog = startPriceLog + count * ratioLog10;\r\n      nextPrice = bigNumFromLog10(nextLog);\r\n    }\r\n  }\r\n}\r\n\r\n  const countBn = countToBigNum(count);\r\n  return {\r\n    count: countBn,\r\n    spent,\r\n    nextPrice,\r\n    numericCount: count,\r\n  };\r\n}\r\n\r\nfunction computeBulkMeta(upg) {\r\n  try {\r\n    const basePrice = BigNum.fromAny(upg.costAtLevel(0));\r\n    const nextPrice = BigNum.fromAny(\r\n      typeof upg.nextCostAfter === 'function'\r\n        ? upg.nextCostAfter(basePrice, 1)\r\n        : upg.costAtLevel(1)\r\n    );\r\n    const logBase = approxLog10BigNum(basePrice);\r\n    const logNext = approxLog10BigNum(nextPrice);\r\n    if (!Number.isFinite(logBase) || !Number.isFinite(logNext)) return null;\r\n    const ratioLog = logNext - logBase;\r\n    if (!Number.isFinite(ratioLog) || ratioLog <= 0) return null;\r\n    const ratio = Math.pow(10, ratioLog);\r\n    if (!Number.isFinite(ratio) || ratio <= 1) return null;\r\n    const denom = ratio - 1;\r\n    if (!(denom > 0) || !Number.isFinite(denom)) return null;\r\n    return {\r\n      ratio,\r\n      ratioLog,\r\n      logDenom: Math.log10(denom),\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function estimateFlatBulk(priceBn, walletBn, roomBn) {\r\n  // Guardrails\r\n  if (!(priceBn instanceof BigNum)) priceBn = BigNum.fromAny(priceBn ?? 0);\r\n  if (!(walletBn instanceof BigNum)) walletBn = BigNum.fromAny(walletBn ?? 0);\r\n  if (!(roomBn instanceof BigNum)) roomBn = BigNum.fromAny(roomBn ?? 0);\r\n  if (priceBn.isZero?.()) return { count: 0 };\r\n  if (walletBn.isZero?.()) return { count: 0 };\r\n\r\nconst wPlain = walletBn.toPlainIntegerString?.();\r\nconst pPlain = priceBn.toPlainIntegerString?.();\r\nif (wPlain && wPlain !== 'Infinity' && pPlain && pPlain !== 'Infinity') {\r\n  const q = BigInt(wPlain) / BigInt(pPlain);\r\n  let countBn = BigNum.fromAny(q.toString());\r\n  if (!roomBn.isInfinite?.() && countBn.cmp(roomBn) > 0) countBn = roomBn;\r\n  const spent = priceBn.mulBigNumInteger(countBn);\r\n  return { count: levelCapToNumber(countBn), countBn, spent, nextPrice: priceBn };\r\n}\r\n\r\nconst wl = approxLog10BigNum(walletBn);\r\nconst pl = approxLog10BigNum(priceBn);\r\nif (!Number.isFinite(wl) || !Number.isFinite(pl) || wl < pl) return { count: 0 };\r\nlet countBn = bigNumFromLog10(wl - pl).floorToInteger();\r\n  \r\n  if (!roomBn.isInfinite?.() && countBn.cmp(roomBn) > 0) countBn = roomBn;\r\n  \r\n  const spent = priceBn.mulBigNumInteger(countBn);\r\n  const nextPrice = priceBn;\r\n  \r\n  return { count: levelCapToNumber(countBn), countBn, spent, nextPrice };\r\n}\r\n\r\nexport function estimateGeometricBulk(priceBn, walletBn, meta, maxLevels) {\r\n  if (!meta || maxLevels <= 0) return { count: 0 };\r\n  const walletLog = approxLog10BigNum(walletBn);\r\n  const priceLog = approxLog10BigNum(priceBn);\r\n  if (!Number.isFinite(walletLog) || !Number.isFinite(priceLog)) return { count: 0 };\r\n  if (walletLog < priceLog) return { count: 0 };\r\n\r\n  const numerator = walletLog - priceLog + meta.logDenom;\r\n  if (!Number.isFinite(numerator) || numerator <= 0) return { count: 0 };\r\n\r\n  let hi = Math.floor(numerator / meta.ratioLog);\r\n  if (!Number.isFinite(hi) || hi <= 0) return { count: 0 };\r\n  hi = Math.min(hi, maxLevels);\r\n  if (hi <= 0) return { count: 0 };\r\n\r\n  let lo = 0;\r\n  let hiBound = hi;\r\n  for (let iter = 0; iter < 64 && lo < hiBound; iter += 1) {\r\n    const mid = Math.max(0, Math.floor((lo + hiBound + 1) / 2));\r\n    const spentLog = priceLog + mid * meta.ratioLog - meta.logDenom;\r\n    if (spentLog <= walletLog) {\r\n      lo = mid;\r\n    } else {\r\n      hiBound = mid - 1;\r\n    }\r\n  }\r\n\r\n  const best = Math.min(lo, maxLevels);\r\n  if (best <= 0) return { count: 0 };\r\n  const spentLog = priceLog + best * meta.ratioLog - meta.logDenom;\r\n  if (spentLog > walletLog) return { count: 0 };\r\n  const nextPriceLog = priceLog + best * meta.ratioLog;\r\n  const spent = bigNumFromLog10(spentLog);\r\n  const nextPrice = bigNumFromLog10(nextPriceLog);\r\n  return {\r\n    count: best,\r\n    spent,\r\n    nextPrice,\r\n    spentLog,\r\n    nextPriceLog,\r\n  };\r\n}\r\n\r\nfunction toUpgradeBigNum(value, fallback) {\r\n  try {\r\n    return BigNum.fromAny(value ?? fallback ?? 0);\r\n  } catch {\r\n    return BigNum.fromAny(fallback ?? 0);\r\n  }\r\n}\r\n\r\nfunction levelCapToNumber(bn) {\r\n  if (!(bn instanceof BigNum)) return Infinity;\r\n  if (bn.isInfinite?.()) return Infinity;\r\n  try {\r\n    const plain = bn.toPlainIntegerString();\r\n    if (plain === 'Infinity') return Infinity;\r\n    if (!plain) return 0;\r\n    if (plain.length > 15) return Number.MAX_SAFE_INTEGER;\r\n    const num = Number(plain);\r\n    if (!Number.isFinite(num)) return Number.MAX_SAFE_INTEGER;\r\n    return Math.max(0, Math.floor(num));\r\n  } catch {\r\n    return Number.MAX_SAFE_INTEGER;\r\n  }\r\n}\r\n\r\nfunction formatBigNumAsHtml(bn) {\r\n  return formatNumber(bn instanceof BigNum ? bn : BigNum.fromAny(bn ?? 0));\r\n}\r\n\r\nexport function formatMultForUi(value) {\r\n  try {\r\n    if (value && (value instanceof BigNum || value.toPlainIntegerString)) {\r\n      const log10 = approxLog10BigNum(value);\r\n      if (Number.isFinite(log10) && log10 < 3) {\r\n        const approx = Math.pow(10, log10);\r\n        return String(approx.toFixed(3))\r\n          .replace(/\\.0+$/, '')\r\n          .replace(/(\\.\\d*?)0+$/, '$1');\r\n      }\r\n      return formatNumber(value);\r\n    }\r\n\r\n    const n = Number(value) || 0;\r\n    if (Math.abs(n) < 1000) {\r\n      return String(n.toFixed(3))\r\n        .replace(/\\.0+$/, '')\r\n        .replace(/(\\.\\d*?)0+$/, '$1');\r\n    }\r\n    return formatNumber(n);\r\n  } catch {\r\n    return '1';\r\n  }\r\n}\r\n\r\n\r\nfunction formatBigNumAsPlain(bn) {\r\n  return formatBigNumAsHtml(bn).replace(/<[^>]*>/g, '');\r\n}\r\n\r\nfunction safeCloneBigNum(value) {\r\n  if (value instanceof BigNum) {\r\n    try { return value.clone?.() ?? BigNum.fromAny(value); }\r\n    catch { return BigNum.fromInt(0); }\r\n  }\r\n  try {\r\n    return BigNum.fromAny(value ?? 0);\r\n  } catch {\r\n    return BigNum.fromInt(0);\r\n  }\r\n}\r\n\r\nfunction emitUpgradeLevelChange(upg, prevLevelNum, prevLevelBn, nextLevelNum, nextLevelBn) {\r\n  if (!upg || typeof upg.onLevelChange !== 'function') return;\r\n\r\n  const oldBn = safeCloneBigNum(prevLevelBn ?? prevLevelNum ?? 0);\r\n  const newBn = safeCloneBigNum(nextLevelBn ?? nextLevelNum ?? 0);\r\n  const payload = {\r\n    upgrade: upg,\r\n    oldLevel: Number.isFinite(prevLevelNum)\r\n      ? prevLevelNum\r\n      : levelBigNumToNumber(oldBn),\r\n    newLevel: Number.isFinite(nextLevelNum)\r\n      ? nextLevelNum\r\n      : levelBigNumToNumber(newBn),\r\n    oldLevelBn: oldBn,\r\n    newLevelBn: newBn,\r\n  };\r\n\r\n  try {\r\n    upg.onLevelChange(payload);\r\n  } catch {}\r\n}\r\n\r\nfunction nmCostBN(upg, level) {\r\n  return costAtLevelUsingScaling(upg, level);\r\n}\r\n\r\nexport const AREA_KEYS = {\r\n  STARTER_COVE: 'starter_cove',\r\n};\r\n\r\nfunction syncBookCurrencyMultiplierFromUpgrade(levelOverride) {\r\n  const multHandle = bank?.books?.mult;\r\n  if (!multHandle || typeof multHandle.set !== 'function') return;\r\n\r\n  let resolvedLevel = 0;\r\n  const xpUnlocked = safeIsXpUnlocked();\r\n  if (xpUnlocked) {\r\n    if (Number.isFinite(levelOverride)) {\r\n      resolvedLevel = Math.max(0, Math.floor(levelOverride));\r\n    } else {\r\n      const storedLevel = getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.BOOK_VALUE_I);\r\n      resolvedLevel = Math.max(0, Number.isFinite(storedLevel) ? storedLevel : 0);\r\n    }\r\n  }\r\n\r\n  let multiplier;\r\n  try {\r\n    multiplier = bookValueMultiplierBn(resolvedLevel);\r\n  } catch {\r\n    multiplier = BigNum.fromInt(1);\r\n  }\r\n\r\n  try {\r\n    multHandle.set(multiplier.clone?.() ?? multiplier);\r\n  } catch {}\r\n}\r\n\r\n/**\r\n * upgType:\r\n *  - \"NM\" = No Milestones\r\n *  - \"HM\" = Has Milestones\r\n *\r\n * Optional field:\r\n *  - scaling: Manually change the multiplicative scaling ratio of an upgrade; not necessary for upgrades that have no scaling\r\n */\r\nconst REGISTRY = [\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 1,\r\n    tie: UPGRADE_TIES.FASTER_COINS,\r\n    title: \"Faster Coins\",\r\n    desc: \"Increases coin spawn rate by +10% per level\",\r\n    lvlCap: 10,\r\n    baseCost: 10,\r\n    costType: \"coins\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/faster_coins.png\",\r\n    costAtLevel(level) { return nmCostBN(this, level); },\r\n    nextCostAfter(_, nextLevel) { return nmCostBN(this, nextLevel); },\r\n    effectSummary(level) {\r\n      const mult = this.effectMultiplier(level);\r\n      return `Coin spawn rate bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    effectMultiplier: E.addPctPerLevel(0.10),\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 2,\r\n    tie: UPGRADE_TIES.UNLOCK_XP,\r\n    title: \"Unlock XP\",\r\n    desc: \"Unlocks the XP system and a new Merchant dialogue\\nXP system: Collect Coins for XP to level up and gain Books\\nEach XP Level also boosts Coin value by a decent amount\",\r\n    lvlCap: 1,\r\n    upgType: \"NM\",\r\n    icon: \"stats/xp/xp.png\",\r\n    baseIconOverride: \"img/stats/xp/xp_base.png\",\r\n    unlockUpgrade: true,\r\n    costAtLevel() { return BigNum.fromInt(0); },\r\n    nextCostAfter() { return BigNum.fromInt(0); },\r\n    computeLockState: determineLockState,\r\n    effectSummary() { return \"\"; },\r\n    onLevelChange({ newLevel, newLevelBn }) {\r\n      const reached = Number.isFinite(newLevel)\r\n        ? newLevel >= 1\r\n        : (newLevelBn?.cmp?.(BigNum.fromInt(1)) ?? -1) >= 0;\r\n      if (reached) { try { unlockXpSystem(); } catch {} }\r\n    },\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 3,\r\n    tie: UPGRADE_TIES.FASTER_COINS_II,\r\n    title: \"Faster Coins II\",\r\n    desc: \"Increases Coin spawn rate by +10% per level\",\r\n    lvlCap: 15,\r\n    baseCost: 1,\r\n    costType: \"books\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/faster_coins2.png\",\r\n    requiresUnlockXp: true,\r\n    costAtLevel() { return this.baseCostBn?.clone?.() ?? BigNum.fromInt(1); },\r\n    nextCostAfter() { return this.costAtLevel(); },\r\n    effectSummary(level) {\r\n      const mult = this.effectMultiplier(level);\r\n      return `Coin spawn rate bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    effectMultiplier: E.addPctPerLevel(0.10),\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 4,\r\n    tie: UPGRADE_TIES.COIN_VALUE_I,\r\n    title: \"Coin Value\",\r\n    desc: \"Increases Coin value by +50% per level\",\r\n    lvlCap: 100,\r\n    baseCost: 1,\r\n    costType: \"books\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/coin_val1.png\",\r\n    requiresUnlockXp: true,\r\n    costAtLevel() { return this.baseCostBn?.clone?.() ?? BigNum.fromInt(1); },\r\n    nextCostAfter() { return this.costAtLevel(); },\r\n    effectSummary(level) {\r\n      const mult = this.effectMultiplier(level);\r\n      return `Coin value bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    effectMultiplier: E.addPctPerLevel(0.50),\r\n    onLevelChange() { try { refreshCoinMultiplierFromXpLevel(); } catch {} },\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 5,\r\n    tie: UPGRADE_TIES.BOOK_VALUE_I,\r\n    title: \"Book Value\",\r\n    desc: \"Doubles Books gained when increasing XP Level\",\r\n    lvlCap: 1,\r\n    baseCost: 10,\r\n    costType: \"books\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/book_val1.png\",\r\n    requiresUnlockXp: true,\r\n    costAtLevel() { return this.baseCostBn?.clone?.() ?? BigNum.fromInt(1); },\r\n    nextCostAfter() { return this.costAtLevel(); },\r\n    effectSummary(level) {\r\n      const mult = bookValueMultiplierBn(level);\r\n      return `Book value bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    onLevelChange({ newLevel }) { syncBookCurrencyMultiplierFromUpgrade(newLevel); },\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 6,\r\n    tie: UPGRADE_TIES.XP_VALUE_I,\r\n    title: \"XP Value\",\r\n    desc: \"Increases XP value by +200% per level\",\r\n    lvlCap: 10,\r\n    baseCost: 1000,\r\n    costType: \"coins\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/xp_val1.png\",\r\n    requiresUnlockXp: true,\r\n    costAtLevel(level) { return nmCostBN(this, level); },\r\n    nextCostAfter(_, nextLevel) { return nmCostBN(this, nextLevel); },\r\n    effectSummary(level) {\r\n      const mult = this.effectMultiplier(level);\r\n      return `XP value bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    effectMultiplier: E.addFlatPerLevel(2),\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 7,\r\n    tie: UPGRADE_TIES.UNLOCK_FORGE,\r\n    title: \"Unlock Forge\",\r\n    desc: \"Unlocks the Reset tab and the Forge reset in the Delve menu\",\r\n    lvlCap: 1,\r\n    upgType: \"NM\",\r\n    icon: \"misc/forge.png\",\r\n    baseIconOverride: \"img/stats/mp/mp_base.png\",\r\n    requiresUnlockXp: true,\r\n    revealRequirement: 'Reach XP Level 31 to reveal this upgrade',\r\n    unlockUpgrade: true,\r\n    costAtLevel() { return BigNum.fromInt(0); },\r\n    nextCostAfter() { return BigNum.fromInt(0); },\r\n    computeLockState: determineLockState,\r\n    onLevelChange({ newLevel }) {\r\n      if ((newLevel ?? 0) >= 1) {\r\n        try { onForgeUpgradeUnlocked(); } catch {}\r\n      }\r\n    },\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 8,\r\n    tie: UPGRADE_TIES.COIN_VALUE_II,\r\n    title: \"Coin Value II\",\r\n    desc: \"Increases Coin value by +100% per level\",\r\n    lvlCap: 100,\r\n    baseCost: 1,\r\n    costType: \"gold\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/coin_val2.png\",\r\n    requiresUnlockXp: true,\r\n    costAtLevel(level) { return nmCostBN(this, level); },\r\n    nextCostAfter(_, nextLevel) { return nmCostBN(this, nextLevel); },\r\n    computeLockState: determineLockState,\r\n    effectSummary(level) {\r\n      const mult = this.effectMultiplier(level);\r\n      return `Coin value bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    effectMultiplier: E.addPctPerLevel(1),\r\n    onLevelChange() { try { refreshCoinMultiplierFromXpLevel(); } catch {} },\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 9,\r\n    tie: UPGRADE_TIES.XP_VALUE_II,\r\n    title: \"XP Value II\",\r\n    desc: \"Increases XP value by +100% per level\",\r\n    lvlCap: 100,\r\n    baseCost: 3,\r\n    costType: \"gold\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/xp_val2.png\",\r\n    requiresUnlockXp: true,\r\n    costAtLevel(level) { return nmCostBN(this, level); },\r\n    nextCostAfter(_, nextLevel) { return nmCostBN(this, nextLevel); },\r\n    computeLockState: determineLockState,\r\n    effectSummary(level) {\r\n      const mult = this.effectMultiplier(level);\r\n      return `XP value bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    effectMultiplier: E.addPctPerLevel(1),\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 10,\r\n    tie: UPGRADE_TIES.MP_VALUE_I,\r\n    title: \"MP Value\",\r\n    desc: \"Increases MP value by +100% per level\",\r\n    lvlCap: 100,\r\n    baseCost: 25,\r\n    costType: \"gold\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/mp_val1.png\",\r\n    requiresUnlockXp: true,\r\n    costAtLevel(level) { return nmCostBN(this, level); },\r\n    nextCostAfter(_, nextLevel) { return nmCostBN(this, nextLevel); },\r\n    computeLockState: determineLockState,\r\n    effectSummary(level) {\r\n      const mult = this.effectMultiplier(level);\r\n      return `MP value bonus: ${formatMultForUi(mult)}x`;\r\n    },\r\n    effectMultiplier: E.addPctPerLevel(1),\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 11,\r\n    tie: UPGRADE_TIES.MAGNET,\r\n    title: \"Magnet\",\r\n    desc: \"Increases Magnet radius by +1 Unit per level\\nMagnet: Increases the distance from which you can collect Coins\",\r\n    lvlCap: 10,\r\n    baseCost: 100,\r\n    costType: \"gold\",\r\n    upgType: \"NM\",\r\n    icon: \"sc_upgrade_icons/magnet.png\",\r\n    requiresUnlockXp: true,\r\n    scaling: { ratio: 2 },\r\n    costAtLevel(level) { return nmCostBN(this, level); },\r\n    nextCostAfter(_, nextLevel) { return nmCostBN(this, nextLevel); },\r\n    computeLockState: determineLockState,\r\n    effectSummary(level) {\r\n      const units = normalizedUpgradeLevel(level); // zero-based (+0 units at level 0)\r\n      const unitsText = formatMultForUi(units);\r\n      const suffix = (unitsText === '1') ? 'Unit' : 'Units';\r\n      return `Magnet radius: ${unitsText} ${suffix}`;\r\n    },\r\n    effectMultiplier: E.addPctPerLevel(1),\r\n  },\r\n  {\r\n    area: AREA_KEYS.STARTER_COVE,\r\n    id: 12,\r\n    tie: UPGRADE_TIES.ENDLESS_XP,\r\n    title: \"Endless XP\",\r\n    desc: \"The first Milestone-type upgrade\\nMilestones: Reach a certain upgrade level for powerful buffs\\nMultiplies XP value by 1.1x per level\",\r\n    lvlCap: HM_EVOLUTION_INTERVAL,\r\n    baseCost: 1_000_000,\r\n    costType: \"coins\",\r\n    upgType: \"HM\",\r\n    icon: \"sc_upg_icons/xp_val_hm.png\",\r\n    requiresUnlockXp: true,\r\n    scalingPreset: 'HM',\r\n    hmMilestones: [\r\n      { level: 10, multiplier: 1.5, target: 'self' },\r\n      { level: 25, multiplier: 2, target: 'self' },\r\n      { level: 50, multiplier: 5, target: 'mp' },\r\n      { level: 100, multiplier: 10, target: 'xp' },\r\n      { level: 200, multiplier: 15, target: 'coin' },\r\n      { level: 400, multiplier: 25, target: 'self' },\r\n      { level: 800, multiplier: 100, target: 'self' },\r\n    ],\r\n    costAtLevel(level) { return costAtLevelUsingScaling(this, level); },\r\n    nextCostAfter(_, nextLevel) { return costAtLevelUsingScaling(this, nextLevel); },\r\n    computeLockState: determineLockState,\r\n    effectSummary(level) {\r\n      const lvlBn = ensureLevelBigNum(level);\r\n      let baseMult;\r\n      try { baseMult = this.effectMultiplier(lvlBn); }\r\n      catch { baseMult = 1; }\r\n      const { selfMult } = computeHmMultipliers(this, lvlBn, this.area);\r\n      const total = safeMultiplyBigNum(baseMult, selfMult);\r\n      return `XP value bonus: ${formatMultForUi(total)}x`;\r\n    },\r\n    effectMultiplier: E.powPerLevel(1.1),\r\n  },\r\n];\r\n\r\nfor (const upg of REGISTRY) {\r\n  const tieKey = normalizeUpgradeTie(upg.tie ?? upg.tieKey);\r\n  upg.tieKey = tieKey;\r\n  if (tieKey && !upgradeTieLookup.has(tieKey)) {\r\n    upgradeTieLookup.set(tieKey, upg);\r\n  }\r\n  upg.baseCost = toUpgradeBigNum(upg.baseCost ?? 0, 0);\r\n  upg.baseCostBn = upg.baseCost;\r\n  upg.numUpgEvolutions = normalizeHmEvolutionCount(upg.numUpgEvolutions);\r\n  if (upg.upgType === 'HM') {\r\n    applyHmEvolutionMeta(upg, upg.numUpgEvolutions);\r\n  } else {\r\n    upg.lvlCapBn = toUpgradeBigNum(upg.lvlCap ?? Infinity, Infinity);\r\n    upg.lvlCap = levelCapToNumber(upg.lvlCapBn);\r\n    upg.lvlCapFmtHtml = formatBigNumAsHtml(upg.lvlCapBn);\r\n    upg.lvlCapFmtText = formatBigNumAsPlain(upg.lvlCapBn);\r\n  }\r\n\r\n  const isSingleLevelCap = Number.isFinite(upg.lvlCap) && Math.max(0, Math.floor(upg.lvlCap)) === 1;\r\n  const isBookValueUpgrade = tieKey === BOOK_VALUE_TIE_KEY;\r\n  if (isSingleLevelCap && !isBookValueUpgrade) {\r\n    upg.unlockUpgrade = true;\r\n    upg.baseCost = BigNum.fromInt(0);\r\n    upg.baseCostBn = upg.baseCost;\r\n    upg.costAtLevel = () => BigNum.fromInt(0);\r\n    upg.nextCostAfter = () => BigNum.fromInt(0);\r\n  }\r\n\r\n  upg.bulkMeta = computeBulkMeta(upg);\r\n  ensureUpgradeScaling(upg);\r\n}\r\n\r\n/* ----------------------- Storage (per slot, per area) ---------------------- */\r\n\r\nconst areaStatePayloadCache = new Map(); // key \u2192 last serialized payload\r\nconst areaStateMemoryCache = new Map(); // key \u2192 last parsed array reference\r\nconst upgradeStateCache = new Map(); // key \u2192 { areaKey, upgId, upg, rec, arr, lvl, nextCostBn }\r\nconst areaUpgradeOrderCache = new Map();\r\n\r\nfunction getAreaUpgradeOrder(areaKey) {\r\n  const normalizedArea = normalizeAreaKey(areaKey);\r\n  if (!normalizedArea) return null;\r\n\r\n  if (areaUpgradeOrderCache.has(normalizedArea)) {\r\n    return areaUpgradeOrderCache.get(normalizedArea);\r\n  }\r\n\r\n  const order = new Map();\r\n  let rank = 0;\r\n  for (const upg of REGISTRY) {\r\n    if (normalizeAreaKey(upg?.area) !== normalizedArea) continue;\r\n    const normalizedId = normalizeUpgradeId(upg?.id);\r\n    if (normalizedId == null || order.has(normalizedId)) continue;\r\n    order.set(normalizedId, rank);\r\n    rank += 1;\r\n  }\r\n\r\n  areaUpgradeOrderCache.set(normalizedArea, order);\r\n  return order;\r\n}\r\n\r\nfunction normalizeAreaStateRecordOrder(areaKey, arr) {\r\n  if (!Array.isArray(arr) || arr.length <= 1) return false;\r\n  const order = getAreaUpgradeOrder(areaKey);\r\n  if (!(order?.size)) return false;\r\n\r\n  const baseRank = order.size;\r\n  const entries = arr.map((rec, idx) => {\r\n    const normalizedId = normalizeUpgradeId(rec?.id);\r\n    const rank = order.has(normalizedId)\r\n      ? order.get(normalizedId)\r\n      : baseRank + idx;\r\n    return { rec, rank, idx };\r\n  });\r\n\r\n  let needsSort = false;\r\n  for (let i = 1; i < entries.length; i += 1) {\r\n    const prev = entries[i - 1];\r\n    const curr = entries[i];\r\n    if (curr.rank < prev.rank || (curr.rank === prev.rank && curr.idx < prev.idx)) {\r\n      needsSort = true;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (!needsSort) return false;\r\n\r\n  entries.sort((a, b) => (a.rank - b.rank) || (a.idx - b.idx));\r\n  arr.length = 0;\r\n  for (const entry of entries) arr.push(entry.rec);\r\n  return true;\r\n}\r\n\r\nfunction parseUpgradeStateArray(raw) {\r\n  if (typeof raw !== 'string' || !raw) return null;\r\n  try {\r\n    const parsed = JSON.parse(raw);\r\n    return Array.isArray(parsed) ? parsed : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction readStateFromAvailableStorage(key, options = {}) {\r\n  const {\r\n    includeLocal = true,\r\n  } = options || {};\r\n\r\n  const result = {\r\n    data: null,\r\n    raw: null,\r\n    storageChecked: false,\r\n    storageFound: false,\r\n    checkedLocal: false,\r\n    foundLocal: false,\r\n    sourceType: null,\r\n  };\r\n\r\n  if (!key) return result;\r\n\r\n  const storages = [];\r\n  try {\r\n    if (includeLocal && typeof localStorage !== 'undefined') {\r\n      storages.push({ storage: localStorage, type: 'local' });\r\n      result.storageChecked = true;\r\n      result.checkedLocal = true;\r\n    }\r\n  } catch {}\r\n\r\n  for (const entry of storages) {\r\n    const { storage, type } = entry || {};\r\n    const getItem = storage?.getItem;\r\n    if (typeof getItem !== 'function') continue;\r\n    let raw;\r\n    try { raw = getItem.call(storage, key); }\r\n    catch { raw = null; }\r\n    if (raw != null) {\r\n      result.storageFound = true;\r\n      if (type === 'local') result.foundLocal = true;\r\n    }\r\n    const parsed = parseUpgradeStateArray(raw);\r\n    if (parsed) {\r\n      const payload = typeof raw === 'string' && raw ? raw : (() => {\r\n        try { return JSON.stringify(parsed); } catch { return null; }\r\n      })();\r\n      result.data = parsed;\r\n      result.raw = payload;\r\n      result.sourceType = type;\r\n      return result;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction cacheAreaState(key, arr, raw) {\r\n  if (!key) return;\r\n  if (Array.isArray(arr)) {\r\n    areaStateMemoryCache.set(key, arr);\r\n  }\r\n  if (typeof raw === 'string') {\r\n    areaStatePayloadCache.set(key, raw);\r\n  }\r\n}\r\n\r\nfunction clearCachedAreaState(storageKey) {\r\n  if (!storageKey) return;\r\n  areaStateMemoryCache.delete(storageKey);\r\n  areaStatePayloadCache.delete(storageKey);\r\n}\r\n\r\nfunction clearCachedUpgradeStates(areaKey, slot) {\r\n  const slotKey = slot == null ? 'null' : String(slot);\r\n  const prefix = `${slotKey}:${areaKey}:`;\r\n  for (const key of upgradeStateCache.keys()) {\r\n    if (key.startsWith(prefix)) {\r\n      upgradeStateCache.delete(key);\r\n    }\r\n  }\r\n}\r\n\r\nfunction keyForArea(areaKey, slot = getActiveSlot()) {\r\n  if (slot == null) return null;\r\n  return `ccc:upgrades:${areaKey}:${slot}`;\r\n}\r\n\r\nconst upgradeStorageWatcherCleanup = new Map();\r\nlet upgradeStorageWatcherBoundSlot = null;\r\n\r\nfunction cleanupUpgradeStorageWatchers() {\r\n  upgradeStorageWatcherCleanup.forEach((stop) => {\r\n    try { stop?.(); } catch {}\r\n  });\r\n  upgradeStorageWatcherCleanup.clear();\r\n}\r\n\r\nfunction handleUpgradeStorageChange(areaKey, slot, storageKey, rawPayload, meta = {}) {\r\n  if (!storageKey) return;\r\n  const { rawChanged, valueChanged } = meta;\r\n  if (!rawChanged && !valueChanged) return;\r\n\r\n  try {\r\n    if (typeof rawPayload === 'string') {\r\n      const arr = parseUpgradeStateArray(rawPayload);\r\n      if (arr) {\r\n        cacheAreaState(storageKey, arr, rawPayload);\r\n      } else {\r\n        clearCachedAreaState(storageKey);\r\n      }\r\n    } else {\r\n      clearCachedAreaState(storageKey);\r\n    }\r\n  } catch {\r\n    clearCachedAreaState(storageKey);\r\n  }\r\n\r\n  clearCachedUpgradeStates(areaKey, slot);\r\n  notifyChanged();\r\n}\r\n\r\nfunction bindUpgradeStorageWatchersForSlot(slot) {\r\n  if (slot === upgradeStorageWatcherBoundSlot) return;\r\n  cleanupUpgradeStorageWatchers();\r\n  upgradeStorageWatcherBoundSlot = slot ?? null;\r\n  if (slot == null) return;\r\n\r\n  for (const areaKey of Object.values(AREA_KEYS)) {\r\n    const storageKey = keyForArea(areaKey, slot);\r\n    if (!storageKey) continue;\r\n    const stop = watchStorageKey(storageKey, {\r\n      parse: (raw) => (typeof raw === 'string' ? raw : null),\r\n      onChange: (rawPayload, meta) => {\r\n        if (!meta?.rawChanged && !meta?.valueChanged) return;\r\n        handleUpgradeStorageChange(areaKey, slot, storageKey, rawPayload, meta);\r\n      },\r\n    });\r\n    upgradeStorageWatcherCleanup.set(storageKey, stop);\r\n  }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  bindUpgradeStorageWatchersForSlot(getActiveSlot());\r\n  window.addEventListener('saveSlot:change', () => {\r\n    bindUpgradeStorageWatchersForSlot(getActiveSlot());\r\n  });\r\n}\r\n\r\nfunction loadAreaState(areaKey, slot = getActiveSlot(), options = {}) {\r\n  const { forceReload = false } = options || {};\r\n  const storageKey = keyForArea(areaKey, slot);\r\n  if (!storageKey) return [];\r\n\r\n  const backupKey = `${storageKey}:backup`;\r\n  const primary = readStateFromAvailableStorage(storageKey, {\r\n    includeLocal: true,\r\n  });\r\n  const backup = readStateFromAvailableStorage(backupKey, {\r\n    includeLocal: true,\r\n  });\r\n\r\n  if (primary.storageChecked && !primary.storageFound && backup.data) {\r\n    try {\r\n      if (typeof localStorage !== 'undefined') {\r\n        localStorage.removeItem(backupKey);\r\n      }\r\n    } catch {}\r\n\r\n    clearCachedAreaState(storageKey);\r\n    clearCachedUpgradeStates(areaKey, slot);\r\n    return [];\r\n  }\r\n  \r\n  if (primary.data) {\r\n    const normalized = normalizeAreaStateRecordOrder(areaKey, primary.data);\r\n    if (normalized) {\r\n      saveAreaState(areaKey, primary.data, slot);\r\n    } else {\r\n      cacheAreaState(storageKey, primary.data, primary.raw);\r\n    }\r\n    if (backup.storageFound) {\r\n      try {\r\n        if (typeof localStorage !== 'undefined') {\r\n          localStorage.removeItem(backupKey);\r\n        }\r\n      } catch {}\r\n    }\r\n    return primary.data;\r\n  }\r\n\r\n  if (backup.data) {\r\n    const normalized = normalizeAreaStateRecordOrder(areaKey, backup.data);\r\n    if (normalized) {\r\n      saveAreaState(areaKey, backup.data, slot);\r\n    } else {\r\n      cacheAreaState(storageKey, backup.data, backup.raw);\r\n    }\r\n    try {\r\n      if (typeof localStorage !== 'undefined') {\r\n        const backupPayload = backup.raw ?? JSON.stringify(backup.data);\r\n        localStorage.setItem(storageKey, backupPayload);\r\n        localStorage.removeItem(backupKey);\r\n      }\r\n    } catch {}\r\n    return backup.data;\r\n  }\r\n\r\n  try {\r\n    if (typeof localStorage !== 'undefined') {\r\n      localStorage.removeItem(backupKey);\r\n    }\r\n  } catch {}\r\n\r\n  const storagesChecked = primary.storageChecked || backup.storageChecked;\r\n  const storageHadValue = primary.storageFound || backup.storageFound;\r\n\r\n  if (!forceReload && !storagesChecked) {\r\n    const cached = areaStateMemoryCache.get(storageKey);\r\n    if (Array.isArray(cached)) {\r\n      normalizeAreaStateRecordOrder(areaKey, cached);\r\n      return cached;\r\n    }\r\n\r\n    const cachedPayload = areaStatePayloadCache.get(storageKey);\r\n    const parsed = parseUpgradeStateArray(cachedPayload);\r\n    if (parsed) {\r\n      const normalized = normalizeAreaStateRecordOrder(areaKey, parsed);\r\n      if (normalized) {\r\n        saveAreaState(areaKey, parsed, slot);\r\n      } else {\r\n        cacheAreaState(storageKey, parsed, cachedPayload);\r\n      }\r\n      return parsed;\r\n    }\r\n  }\r\n\r\n  if (!storageHadValue) {\r\n    clearCachedAreaState(storageKey);\r\n    clearCachedUpgradeStates(areaKey, slot);\r\n  }\r\n\r\n  return [];\r\n}\r\n\r\nfunction saveAreaState(areaKey, stateArr, slot = getActiveSlot()) {\r\n  const storageKey = keyForArea(areaKey, slot);\r\n  if (!storageKey) return;\r\n\r\n  const arr = Array.isArray(stateArr) ? stateArr : [];\r\n  normalizeAreaStateRecordOrder(areaKey, arr);\r\n  let payload = null;\r\n  try {\r\n    payload = JSON.stringify(arr);\r\n  } catch {\r\n    try { payload = JSON.stringify([]); }\r\n    catch { payload = '[]'; }\r\n  }\r\n\r\n  cacheAreaState(storageKey, arr, payload);\r\n\r\n  try {\r\n    if (typeof localStorage !== 'undefined') {\r\n      localStorage.setItem(storageKey, payload);\r\n      try { primeStorageWatcherSnapshot(storageKey, payload); } catch {}\r\n    }\r\n  } catch {}\r\n\r\n  try {\r\n    const verify = localStorage.getItem(storageKey);\r\n    if (verify !== payload) {\r\n      localStorage.setItem(storageKey, payload);\r\n      try { primeStorageWatcherSnapshot(storageKey, payload); } catch {}\r\n    }\r\n  } catch {}\r\n\r\n  try {\r\n    if (typeof localStorage !== 'undefined') {\r\n      localStorage.removeItem(`${storageKey}:backup`);\r\n    }\r\n  } catch {}\r\n}\r\n\r\nfunction resolveUpgradeIdentifier(areaKey, upgId) {\r\n  if (upgId && typeof upgId === 'object' && typeof upgId.id !== 'undefined') {\r\n    return normalizeUpgradeId(upgId.id);\r\n  }\r\n  const normalized = normalizeUpgradeId(upgId);\r\n  if (typeof normalized === 'number' || normalized == null) {\r\n    return normalized;\r\n  }\r\n  if (typeof normalized === 'string') {\r\n    const tieKey = normalizeUpgradeTie(normalized);\r\n    if (tieKey) {\r\n      const upg = upgradeTieLookup.get(tieKey);\r\n      if (upg) {\r\n        const requestedArea = normalizeAreaKey(areaKey);\r\n        if (!requestedArea || normalizeAreaKey(upg.area) === requestedArea) {\r\n          return normalizeUpgradeId(upg.id);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return normalized;\r\n}\r\n\r\nfunction upgradeCacheKey(areaKey, upgId, slot = getActiveSlot()) {\r\n  const slotKey = slot == null ? 'null' : String(slot);\r\n  const resolvedId = resolveUpgradeIdentifier(areaKey, upgId);\r\n  return `${slotKey}:${areaKey}:${normalizeUpgradeId(resolvedId)}`;\r\n}\r\n\r\nfunction ensureUpgradeState(areaKey, upgId) {\r\n  const resolvedId = resolveUpgradeIdentifier(areaKey, upgId);\r\n  const normalizedId = normalizeUpgradeId(resolvedId);\r\n  const slot = getActiveSlot();\r\n  const key = upgradeCacheKey(areaKey, normalizedId, slot);\r\n  let state = upgradeStateCache.get(key);\r\n  if (state) return state;\r\n\r\n  const upg = getUpgrade(areaKey, normalizedId);\r\n  const arr = loadAreaState(areaKey, slot);\r\n  let rec = arr.find(u => u && normalizeUpgradeId(u.id) === normalizedId);\r\n  let recNeedsSave = false;\r\n  if (!rec) {\r\n    rec = { id: normalizedId, lvl: BigNum.fromInt(0).toStorage() };\r\n    if (upg) {\r\n      try {\r\n        rec.nextCost = BigNum.fromAny(upg.costAtLevel(0)).toStorage();\r\n      } catch {\r\n        rec.nextCost = BigNum.fromInt(0).toStorage();\r\n      }\r\n    }\r\n    rec.nextCostLvl = rec.lvl;\r\n    arr.push(rec);\r\n    saveAreaState(areaKey, arr, slot);\r\n  } else if (rec.id !== normalizedId) {\r\n    rec.id = normalizedId;\r\n    recNeedsSave = true;\r\n  }\r\n\r\n  let hmEvolutions = 0;\r\n  if (upg?.upgType === 'HM') {\r\n    hmEvolutions = normalizeHmEvolutionCount(\r\n      rec.hmEvolutions ?? rec.evolutions ?? rec.evol ?? upg.numUpgEvolutions\r\n    );\r\n    applyHmEvolutionMeta(upg, hmEvolutions);\r\n  }\r\n\r\n  const lvlBn = ensureLevelBigNum(rec.lvl);\r\n  let lvl = levelBigNumToNumber(lvlBn);\r\ntry {\r\n  const capBn = upg?.lvlCapBn ?? BigNum.fromAny('Infinity');\r\n  if (!(capBn.isInfinite?.()) && lvlBn.cmp(capBn) > 0) {\r\n    const clamped = capBn.clone?.() ?? capBn;\r\n    lvl = levelBigNumToNumber(clamped);\r\n    const clampedStorage = clamped.toStorage();\r\n    rec.lvl = clampedStorage;\r\n    rec.nextCost = BigNum.fromInt(0).toStorage();\r\n    rec.nextCostLvl = clampedStorage;\r\n    saveAreaState(areaKey, arr, slot);\r\n  }\r\n} catch {}\r\n\r\n  let normalizedLvlStorage = null;\r\n  try {\r\n    normalizedLvlStorage = lvlBn?.toStorage?.() ?? ensureLevelBigNum(lvl).toStorage();\r\n  } catch {}\r\n  if (normalizedLvlStorage && rec.lvl !== normalizedLvlStorage) {\r\n    rec.lvl = normalizedLvlStorage;\r\n    recNeedsSave = true;\r\n  }\r\n\r\n  const costLevelStorage = typeof rec.nextCostLvl === 'string' ? rec.nextCostLvl : null;\r\n  let nextCostStale = !costLevelStorage || costLevelStorage !== normalizedLvlStorage;\r\n\r\n  let nextCostBn = null;\r\n  if (!nextCostStale && rec.nextCost != null) {\r\n    try {\r\n      nextCostBn = BigNum.fromAny(rec.nextCost);\r\n    } catch {\r\n      nextCostBn = null;\r\n      nextCostStale = true;\r\n    }\r\n  }\r\n\r\n  if (!nextCostBn || nextCostStale) {\r\n    if (upg) {\r\n      try {\r\n        nextCostBn = BigNum.fromAny(upg.costAtLevel(lvl));\r\n      } catch {\r\n        nextCostBn = BigNum.fromInt(0);\r\n      }\r\n    } else {\r\n      nextCostBn = BigNum.fromInt(0);\r\n    }\r\n    try {\r\n      rec.nextCost = nextCostBn.toStorage();\r\n      if (normalizedLvlStorage) {\r\n        rec.nextCostLvl = normalizedLvlStorage;\r\n      } else {\r\n        delete rec.nextCostLvl;\r\n      }\r\n      recNeedsSave = true;\r\n    } catch {}\r\n  }\r\n\r\n  if (recNeedsSave) {\r\n    try { saveAreaState(areaKey, arr, slot); }\r\n    catch {}\r\n  }\r\n\r\n  if (upg?.upgType === 'HM' && lvlBn?.isInfinite?.()) {\r\n    if (!upg.lvlCapBn?.isInfinite?.()) {\r\n      const infCap = BigNum.fromAny('Infinity');\r\n      upg.lvlCapBn = infCap;\r\n      upg.lvlCap = Number.POSITIVE_INFINITY;\r\n      upg.lvlCapFmtHtml = formatBigNumAsHtml(infCap);\r\n      upg.lvlCapFmtText = formatBigNumAsPlain(infCap);\r\n    }\r\n  }\r\n\r\n  state = { areaKey, upgId: normalizedId, upg, rec, arr, lvl, lvlBn, nextCostBn, slot, hmEvolutions };\r\n  upgradeStateCache.set(key, state);\r\n  return state;\r\n}\r\n\r\nfunction commitUpgradeState(state) {\r\n  if (!state) return;\r\n  const { areaKey } = state;\r\n  const slot = state.slot ?? getActiveSlot();\r\n  if (!areaKey || slot == null) return;\r\n\r\n  const normalizedId = normalizeUpgradeId(state.upgId ?? state.rec?.id);\r\n  let arr = loadAreaState(areaKey, slot, { forceReload: true });\r\n  if (!Array.isArray(arr)) arr = [];\r\n\r\n  let rec = arr.find(u => u && normalizeUpgradeId(u.id) === normalizedId);\r\n  if (!rec) {\r\n    rec = { id: normalizedId };\r\n    arr.push(rec);\r\n  } else if (rec.id !== normalizedId) {\r\n    rec.id = normalizedId;\r\n  }\r\n\r\ntry {\r\n  const capBn = state.upg?.lvlCapBn ?? BigNum.fromAny('Infinity');\r\n  let inBn = state.lvlBn?.clone?.() ?? ensureLevelBigNum(state.lvlBn ?? state.lvl);\r\n  if (!(capBn.isInfinite?.()) && inBn.cmp(capBn) > 0) {\r\n    inBn = capBn.clone?.() ?? capBn;\r\n    state.lvlBn = inBn;\r\n    state.lvl = levelBigNumToNumber(inBn);\r\n  }\r\n} catch {}\r\n\r\n  try {\r\n    rec.lvl = state.lvlBn?.toStorage?.() ?? ensureLevelBigNum(state.lvlBn ?? state.lvl).toStorage();\r\n  } catch {\r\n    rec.lvl = ensureLevelBigNum(state.lvl ?? 0).toStorage();\r\n  }\r\n  const currentLvlStorage = rec.lvl;\r\n\r\n  if (state.nextCostBn != null) {\r\n    try {\r\n      rec.nextCost = BigNum.fromAny(state.nextCostBn).toStorage();\r\n    } catch {\r\n      try { rec.nextCost = BigNum.fromAny(state.nextCostBn ?? 0).toStorage(); }\r\n      catch { rec.nextCost = BigNum.fromInt(0).toStorage(); }\r\n    }\r\n    rec.nextCostLvl = currentLvlStorage;\r\n  } else {\r\n    delete rec.nextCostLvl;\r\n  }\r\n\r\n  if (state.hmEvolutions != null) {\r\n    rec.hmEvolutions = normalizeHmEvolutionCount(state.hmEvolutions);\r\n  }\r\n\r\n  saveAreaState(areaKey, arr, slot);\r\n  state.rec = rec;\r\n  state.arr = arr;\r\n  state.slot = slot;\r\n}\r\n\r\nfunction invalidateUpgradeState(areaKey, upgId, slot = getActiveSlot()) {\r\n  upgradeStateCache.delete(upgradeCacheKey(areaKey, upgId, slot));\r\n}\r\n\r\nexport function getLevelNumber(areaKey, upgId) {\r\n  return ensureUpgradeState(areaKey, upgId).lvl;\r\n}\r\n\r\nexport function getHmEvolutions(areaKey, upgId) {\r\n  return ensureUpgradeState(areaKey, upgId).hmEvolutions ?? 0;\r\n}\r\n\r\nexport function getMpValueMultiplierBn() {\r\n  let mult = hundredPercentPerLevelMultiplier(\r\n    getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.MP_VALUE_I)\r\n  );\r\n  try {\r\n    const hmUpg = getUpgrade(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.ENDLESS_XP);\r\n    const hmLvl = getLevel(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.ENDLESS_XP);\r\n    const { mpMult } = computeHmMultipliers(hmUpg, hmLvl, AREA_KEYS.STARTER_COVE);\r\n    mult = safeMultiplyBigNum(mult, mpMult);\r\n  } catch {}\r\n  return mult;\r\n}\r\n\r\nexport function getMagnetLevel() {\r\n  const lvl = getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.MAGNET);\r\n  if (!Number.isFinite(lvl)) {\r\n    return 0;\r\n  }\r\n  return Math.max(0, Math.floor(lvl));\r\n}\r\n\r\nfunction computeUpgradeLockStateFor(areaKey, upg) {\r\n  if (!upg) return { locked: false };\r\n\r\n  const xpUnlocked = safeIsXpUnlocked();\r\n  const xpLevelBn = xpUnlocked ? currentXpLevelBigNum() : BigNum.fromInt(0);\r\n  const xpLevel = xpUnlocked ? levelBigNumToNumber(xpLevelBn) : 0;\r\n\r\n  let baseState = { locked: false };\r\nif (upg.requiresUnlockXp && !xpUnlocked) {\r\n  const isXpAdj = isXpAdjacentUpgrade(areaKey, upg);\r\n  const xpRevealText = 'Unlock the XP system to reveal this upgrade';\r\n  const unlockXpVisible = safeHasMetMerchant();\r\n\r\n  if (isXpAdj) {\r\n    if (!unlockXpVisible) {\r\n      const meetText = 'Meet the Merchant to reveal \"Unlock XP\"';\r\n      baseState = {\r\n        locked: true,\r\n        iconOverride: LOCKED_UPGRADE_ICON_DATA_URL,\r\n        titleOverride: LOCKED_UPGRADE_TITLE,\r\n        descOverride: meetText,\r\n        reason: meetText,\r\n        hidden: false,\r\n        hideCost: false,\r\n        hideEffect: false,\r\n        useLockedBase: true,\r\n      };\r\n    } else {\r\n      // XP-adjacent tiles show as mysterious (\u201C?\u201D)\r\n      baseState = {\r\n        locked: true,\r\n        iconOverride: MYSTERIOUS_UPGRADE_ICON_DATA_URL,\r\n        titleOverride: HIDDEN_UPGRADE_TITLE,\r\n        descOverride: xpRevealText,\r\n        reason: xpRevealText,\r\n        hidden: true,\r\n        hideCost: true,\r\n        hideEffect: true,\r\n        useLockedBase: true,\r\n      };\r\n    }\r\n  } else {\r\n    // Everyone else is a plain locked padlock (not mysterious / not clickable)\r\n    baseState = {\r\n      locked: true,\r\n      iconOverride: LOCKED_UPGRADE_ICON_DATA_URL,\r\n      titleOverride: LOCKED_UPGRADE_TITLE,\r\n      descOverride: xpRevealText,\r\n      reason: 'Purchase \"Unlock XP\" to reveal this upgrade',\r\n      hidden: false,\r\n      hideCost: false,\r\n      hideEffect: false,\r\n      useLockedBase: true,\r\n    };\r\n  }\r\n}\r\n\r\n  let state = mergeLockStates({ locked: false }, baseState);\r\n  if (typeof upg.computeLockState === 'function') {\r\n    try {\r\n      const ctx = {\r\n        areaKey,\r\n        upg,\r\n        xpUnlocked,\r\n        xpLevelBn,\r\n        xpLevel,\r\n        baseLocked: state.locked,\r\n        getUpgradeLevel(targetId) { return getLevelNumber(areaKey, targetId); },\r\n      };\r\n      const custom = upg.computeLockState(ctx);\r\n      state = mergeLockStates(state, custom);\r\n    } catch {}\r\n  }\r\n\r\n  const slot = getActiveSlot();\r\n  const revealKey = upgradeRevealKey(areaKey, upg);\r\n  const permaUnlocked = revealKey ? isUpgradePermanentlyUnlocked(areaKey, upg, slot) : false;\r\n  if (revealKey) {\r\n    const revealState = ensureShopRevealState(slot);\r\n    const permaState  = ensureShopPermaUnlockState(slot);\r\n    const permaMystState = ensureShopPermaMystState(slot);\r\n    const hyphenKey   = revealKey.replace(/_/g, '-');\r\n    const legacyKey   = upgradeLegacyRevealKey(areaKey, upg);\r\n\r\n    let needsRevealSave = false;\r\n    if (migrateUpgradeStateKey(revealState, hyphenKey, revealKey)) {\r\n      needsRevealSave = true;\r\n    }\r\n    if (legacyKey && migrateUpgradeStateKey(revealState, legacyKey, revealKey)) {\r\n      needsRevealSave = true;\r\n    }\r\n    if (needsRevealSave) {\r\n      saveShopRevealState(revealState, slot);\r\n    }\r\n\r\n    let needsPermaSave = false;\r\n    if (migrateUpgradeStateKey(permaState, hyphenKey, revealKey)) {\r\n      needsPermaSave = true;\r\n    }\r\n    if (legacyKey && migrateUpgradeStateKey(permaState, legacyKey, revealKey)) {\r\n      needsPermaSave = true;\r\n    }\r\n    if (needsPermaSave) {\r\n      saveShopPermaUnlockState(permaState, slot);\r\n    }\r\n\r\n    let needsPermaMystSave = false;\r\n    if (migrateUpgradeStateKey(permaMystState, hyphenKey, revealKey)) {\r\n      needsPermaMystSave = true;\r\n    }\r\n    if (legacyKey && migrateUpgradeStateKey(permaMystState, legacyKey, revealKey)) {\r\n      needsPermaMystSave = true;\r\n    }\r\n    if (needsPermaMystSave) {\r\n      saveShopPermaMystState(permaMystState, slot);\r\n    }\r\n  }\r\n\r\n  if (state.locked) {\r\n    const hiddenState = !!state.hidden;\r\n    if (!state.iconOverride) state.iconOverride = LOCKED_UPGRADE_ICON_DATA_URL;\r\n\r\n    if (hiddenState) {\r\n      if (!state.titleOverride) state.titleOverride = HIDDEN_UPGRADE_TITLE;\r\n    } else if (!state.titleOverride || state.titleOverride === HIDDEN_UPGRADE_TITLE) {\r\n      state.titleOverride = LOCKED_UPGRADE_TITLE;\r\n    }\r\n\r\n    if (state.useLockedBase == null) state.useLockedBase = true;\r\n    if (!state.reason && upg?.revealRequirement) state.reason = upg.revealRequirement;\r\n\r\n    if (!state.descOverride) {\r\n      if (state.reason) {\r\n        state.descOverride = `${state.reason}`;\r\n      } else if (upg?.revealRequirement) {\r\n        state.descOverride = upg.revealRequirement;\r\n      } else if (hiddenState) {\r\n        state.descOverride = 'This upgrade is currently hidden.';\r\n      }\r\n    }\r\n  } else {\r\n    state.hidden = false;\r\n    state.hideCost = false;\r\n    state.hideEffect = false;\r\n    state.useLockedBase = false;\r\n    if (state.iconOverride === LOCKED_UPGRADE_ICON_DATA_URL ||\r\n        state.iconOverride === MYSTERIOUS_UPGRADE_ICON_DATA_URL) {\r\n      delete state.iconOverride;\r\n    }\r\n    if (state.titleOverride === HIDDEN_UPGRADE_TITLE ||\r\n        state.titleOverride === LOCKED_UPGRADE_TITLE) {\r\n      delete state.titleOverride;\r\n    }\r\n    delete state.descOverride;\r\n    delete state.reason;\r\n  }\r\n\r\n  if (state.locked && upg.requiresUnlockXp && !xpUnlocked && !state.iconOverride) {\r\n    state.iconOverride = LOCKED_UPGRADE_ICON_DATA_URL;\r\n  }\r\n\r\n  if (revealKey) {\r\n    const revealState = ensureShopRevealState(slot);\r\n    const rec = revealState.upgrades[revealKey] || {};\r\n    const tieKey = normalizeUpgradeTie(upg?.tie ?? upg?.tieKey);\r\n    const isForgePlaceholder = tieKey && FORGE_PLACEHOLDER_TIES.has(tieKey);\r\n\r\n    let storedStatus = rec.status || 'locked';\r\n\r\n    if (isUpgradePermanentlyUnlocked(areaKey, upg, slot)) {\r\n      storedStatus = 'unlocked';\r\n    } else if (\r\n      isUpgradePermanentlyMysterious(areaKey, upg, slot) &&\r\n      storedStatus === 'locked'\r\n    ) {\r\n      let xpReached31 = false;\r\n      try { xpReached31 = levelBigNumToNumber(currentXpLevelBigNum()) >= 31; } catch {}\r\n\r\n      storedStatus = (isForgePlaceholder && !xpReached31) ? 'locked' : 'mysterious';\r\n    }\r\n\r\n    let storedRank = shopStatusRank(storedStatus);\r\n\r\n    let currentStatus = classifyUpgradeStatus(state);\r\n    let currentRank = shopStatusRank(currentStatus);\r\n\r\n    const applyStoredMysterious = () => {\r\n      state.locked = true;\r\n\r\n      const snap = rec.snapshot;\r\n      if (snap && typeof snap === 'object') {\r\n        state = mergeLockStates(state, snap);\r\n      }\r\n\r\n      state.iconOverride  = MYSTERIOUS_UPGRADE_ICON_DATA_URL;\r\n      state.titleOverride = HIDDEN_UPGRADE_TITLE;\r\n\r\n      const reasonText =\r\n        upg?.revealRequirement ||\r\n        state.reason ||\r\n        state.descOverride ||\r\n        'This upgrade is currently hidden.';\r\n      state.descOverride = reasonText;\r\n      if (!state.reason && upg?.revealRequirement) state.reason = upg.revealRequirement;\r\n\r\n      state.hidden      = true;\r\n      state.hideCost    = true;\r\n      state.hideEffect  = true;\r\n      state.useLockedBase = true;\r\n    };\r\n\r\n    if (storedRank > currentRank) {\r\n      if (storedStatus === 'unlocked') {\r\n        state.locked = false;\r\n        state.hidden = false;\r\n        state.hideCost = false;\r\n        state.hideEffect = false;\r\n        state.useLockedBase = false;\r\n      } else if (storedStatus === 'mysterious') {\r\n        applyStoredMysterious();\r\n      }\r\n      currentStatus = classifyUpgradeStatus(state);\r\n      currentRank = shopStatusRank(currentStatus);\r\n    }\r\n\r\n    let shouldSave = false;\r\n    let normalizedStatus = (rec && typeof rec === 'object' && typeof rec.status === 'string')\r\n      ? rec.status\r\n      : 'locked';\r\n\r\n    const isForgePlaceholderForSave = isForgePlaceholder;\r\n\r\n    let xpReached31Now = false;\r\n    try { xpReached31Now = levelBigNumToNumber(currentXpLevelBigNum()) >= 31; } catch {}\r\n\r\n    if (isForgePlaceholderForSave && !xpReached31Now && normalizedStatus === 'mysterious') {\r\n      normalizedStatus = 'locked';\r\n    }\r\n\r\n    if (!rec || typeof rec !== 'object' || Object.keys(rec).length !== 1 || rec.status !== normalizedStatus) {\r\n      revealState.upgrades[revealKey] = { status: normalizedStatus };\r\n      shouldSave = true;\r\n    }\r\n\r\n    if (currentRank > storedRank) {\r\n      rec.status = currentStatus;\r\n      revealState.upgrades[revealKey] = { status: rec.status };\r\n      shouldSave = true;\r\n\r\n      storedStatus = currentStatus;\r\n      storedRank   = currentRank;\r\n\r\n      if (currentStatus === 'unlocked') {\r\n        markUpgradePermanentlyUnlocked(areaKey, upg, slot);\r\n      } else if (currentStatus === 'mysterious') {\r\n        let xpReached31 = false;\r\n        try { xpReached31 = levelBigNumToNumber(currentXpLevelBigNum()) >= 31; } catch {}\r\n\r\n        if (!isForgePlaceholder || xpReached31) {\r\n          markUpgradePermanentlyMysterious(areaKey, upg, slot);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (storedStatus === 'unlocked') {\r\n      state.locked = false;\r\n      state.hidden = false;\r\n      state.hideCost = false;\r\n      state.hideEffect = false;\r\n      state.useLockedBase = false;\r\n\r\n      if (state.iconOverride === LOCKED_UPGRADE_ICON_DATA_URL ||\r\n          state.iconOverride === MYSTERIOUS_UPGRADE_ICON_DATA_URL) {\r\n        delete state.iconOverride;\r\n      }\r\n      if (state.titleOverride === HIDDEN_UPGRADE_TITLE ||\r\n          state.titleOverride === LOCKED_UPGRADE_TITLE) {\r\n        delete state.titleOverride;\r\n      }\r\n      delete state.descOverride;\r\n      delete state.reason;\r\n\r\n      if (rec.status !== 'unlocked') {\r\n        revealState.upgrades[revealKey] = { status: 'unlocked' };\r\n        shouldSave = true;\r\n      }\r\n      markUpgradePermanentlyUnlocked(areaKey, upg, slot);\r\n\r\n    } else if (storedStatus === 'mysterious' && currentStatus !== 'mysterious') {\r\n      applyStoredMysterious();\r\n      currentStatus = classifyUpgradeStatus(state);\r\n      currentRank = shopStatusRank(currentStatus);\r\n    }\r\n\r\n    if (shouldSave) saveShopRevealState(revealState, slot);\r\n  }\r\n  \r\n  return state;\r\n}\r\n\r\nfunction isUpgradeLocked(areaKey, upg) {\r\n  return !!computeUpgradeLockStateFor(areaKey, upg).locked;\r\n}\r\n\r\nfunction isHmReadyToEvolve(upg, lvlBn, evolutions = null) {\r\n  if (!upg || upg.upgType !== 'HM') return false;\r\n\r\n  // Once an HM upgrade reaches BN Infinity, treat it as permanently maxed\r\n  // and suppress further evolutions so the UI can show the maxed frame.\r\n  if (lvlBn?.isInfinite?.()) return false;\r\n  const safeEvol = Number.isFinite(evolutions)\r\n    ? evolutions\r\n    : activeEvolutionsForUpgrade(upg);\r\n  const { capBn, cap } = hmLevelCapForEvolutions(safeEvol);\r\n  try { return lvlBn?.cmp?.(capBn) >= 0; }\r\n  catch {}\r\n  const lvlNum = levelBigNumToNumber(lvlBn);\r\n  return Number.isFinite(lvlNum) && lvlNum >= cap;\r\n}\r\n\r\nexport function getLevel(areaKey, upgId) {\r\n  const state = ensureUpgradeState(areaKey, upgId);\r\n  if (state.lvlBn?.clone) return state.lvlBn.clone();\r\n  return ensureLevelBigNum(state.lvl ?? 0);\r\n}\r\n\r\nexport function peekNextPrice(areaKey, upgId) {\r\n  const state = ensureUpgradeState(areaKey, upgId);\r\n  const upg = state.upg;\r\n  if (!upg) return BigNum.fromInt(0);\r\n\r\n  if (state.nextCostBn && !state.nextCostBn.isZero?.()) {\r\n    return state.nextCostBn.clone?.() ?? BigNum.fromAny(state.nextCostBn);\r\n  }\r\n\r\n  const lvlBn  = state.lvlBn ?? ensureLevelBigNum(state.lvl ?? 0);\r\n  const nextBn = lvlBn.add(BigNum.fromInt(1));\r\n  const nextNum = levelBigNumToNumber(nextBn);\r\n  try {\r\n    return BigNum.fromAny(upg.costAtLevel(nextNum));\r\n  } catch {\r\n    return BigNum.fromInt(0);\r\n  }\r\n}\r\n\r\n\r\nexport function setLevel(areaKey, upgId, lvl, clampToCap = true, options = {}) {\r\n  const state = ensureUpgradeState(areaKey, upgId);\r\n  const upg = state.upg;\r\n  const { resetHmEvolutions = false } = options ?? {};\r\n\r\n  if (resetHmEvolutions && upg?.upgType === 'HM') {\r\n    state.hmEvolutions = 0;\r\n    applyHmEvolutionMeta(upg, 0);\r\n  }\r\n  const cap = upg?.lvlCap ?? Infinity;\r\n  const prevLevelNum = state.lvl;\r\n  const prevLevelBn = safeCloneBigNum(state.lvlBn ?? ensureLevelBigNum(state.lvl ?? 0));\r\n  let desiredBn = ensureLevelBigNum(lvl);\r\n  if (desiredBn.isInfinite?.()) {\r\n    desiredBn = BigNum.fromAny('Infinity');\r\n  }\r\n   let nextBn = desiredBn;\r\n  try {\r\n    if (upg && isInfinityLevelForScaled(upg, nextBn)) {\r\n      nextBn = BigNum.fromAny('Infinity');\r\n    }\r\n  } catch {}\r\n  if (clampToCap && Number.isFinite(cap)) {\r\n    const capBn = ensureLevelBigNum(cap);\r\n    if (nextBn.cmp(capBn) > 0) nextBn = capBn;\r\n  }\r\n  if (clampToCap && Number.isFinite(cap)) {\r\n    const capBn = ensureLevelBigNum(cap);\r\n    if (nextBn.cmp(capBn) > 0) nextBn = capBn;\r\n  }\r\n\r\n  if (state.lvlBn?.cmp && state.lvlBn.cmp(nextBn) === 0) return state.lvl;\r\n  const nextNum = levelBigNumToNumber(nextBn);\r\n\r\n  if (!upg) {\r\n    state.lvl = nextNum;\r\n    state.lvlBn = nextBn;\r\n    state.nextCostBn = BigNum.fromInt(0);\r\n    commitUpgradeState(state);\r\n    invalidateUpgradeState(areaKey, upgId);\r\n    notifyChanged();\r\n    return state.lvl;\r\n  }\r\n\r\n  state.lvl = nextNum;\r\n  state.lvlBn = nextBn;\r\n  try {\r\n    state.nextCostBn = BigNum.fromAny(upg.costAtLevel(nextNum));\r\n  } catch {\r\n    state.nextCostBn = BigNum.fromInt(0);\r\n  }\r\n\r\n  commitUpgradeState(state);\r\n  invalidateUpgradeState(areaKey, upgId);\r\n  emitUpgradeLevelChange(upg, prevLevelNum, prevLevelBn, state.lvl, state.lvlBn);\r\n  notifyChanged();\r\n  return state.lvl;\r\n}\r\n\r\n/* ---------------------------- Registry helpers ---------------------------- */\r\n\r\nexport function getUpgradesForArea(areaKey) {\r\n  return REGISTRY.filter(u => u.area === areaKey);\r\n}\r\n\r\nexport function getUpgrade(areaKey, upgId) {\r\n  const normalizedArea = normalizeAreaKey(areaKey);\r\n  const normalizedId = normalizeUpgradeId(upgId);\r\n  const tieKey = (typeof normalizedId === 'string')\r\n    ? normalizeUpgradeTie(normalizedId)\r\n    : normalizeUpgradeTie(upgId);\r\n  return REGISTRY.find((u) => {\r\n    if (normalizedArea && normalizeAreaKey(u.area) !== normalizedArea) return false;\r\n    if (normalizeUpgradeId(u.id) === normalizedId) return true;\r\n    if (tieKey && u.tieKey === tieKey) return true;\r\n    return false;\r\n  }) || null;\r\n}\r\n\r\nexport function getUpgradeLockState(areaKey, upgId) {\r\n  const upg = typeof upgId === 'object' && upgId ? upgId : getUpgrade(areaKey, upgId);\r\n  return computeUpgradeLockStateFor(areaKey, upg);\r\n}\r\n\r\nfunction normalizeUpgradeIconPath(iconPath) {\r\n  const raw = String(iconPath ?? '').trim();\r\n  if (!raw) return '';\r\n\r\n  if (/^(?:https?:|data:|blob:)/i.test(raw)) return raw;\r\n  if (raw.startsWith('//')) return raw;\r\n\r\n  const replaceSlashes = (value) => value.replace(/\\\\+/g, '/');\r\n  let path = replaceSlashes(raw);\r\n\r\n  if (path.startsWith('/')) {\r\n    return path.replace(/\\/{2,}/g, '/');\r\n  }\r\n\r\n  path = path.replace(/^\\.\\/+/u, '');\r\n  while (path.startsWith('../')) {\r\n    path = path.slice(3);\r\n  }\r\n\r\n  const segments = path\r\n    .split('/')\r\n    .map(seg => seg.trim())\r\n    .filter(seg => seg && seg !== '.');\r\n\r\n  if (!segments.length) return '';\r\n\r\n  const normalized = [];\r\n  for (const segment of segments) {\r\n    if (segment === '..') {\r\n      normalized.pop();\r\n      continue;\r\n    }\r\n    normalized.push(segment);\r\n  }\r\n\r\n  if (!normalized.length) return '';\r\n\r\n  const SHARED_ROOTS = new Set(['stats', 'currencies', 'misc']);\r\n\r\n  for (let i = 0; i < normalized.length; i += 1) {\r\n    const lower = normalized[i].toLowerCase();\r\n    if (lower === 'img') {\r\n      normalized.splice(i, 1);\r\n      i -= 1;\r\n      continue;\r\n    }\r\n\r\n    if (lower === 'sc_upgrade_icons' || lower === 'sc_upg_icons') {\r\n      normalized[i] = 'sc_upg_icons';\r\n      while (normalized[i + 1] && /^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(normalized[i + 1])) {\r\n        normalized.splice(i + 1, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!normalized.length) return '';\r\n\r\n  if (\r\n    normalized.length > 1\r\n    && normalized[0].toLowerCase() === 'sc_upg_icons'\r\n    && SHARED_ROOTS.has(normalized[1].toLowerCase())\r\n  ) {\r\n    normalized.shift();\r\n  }\r\n\r\n  if (normalized.length === 1) {\r\n    normalized.unshift('sc_upg_icons');\r\n  }\r\n\r\n  const result = normalized.join('/');\r\n  if (!result) return '';\r\n\r\n  return `img/${result}`;\r\n}\r\n\r\nexport function getIconUrl(upg) {\r\n  if (!upg) return '';\r\n  return normalizeUpgradeIconPath(upg.icon);\r\n}\r\n\r\n/* ------------------------------ Cost helpers ------------------------------ */\r\n\r\nfunction sumNextNLevelsCost(upg, currentLevel, n) {\r\n  let total = 0;\r\n  for (let i = 0; i < n; i++) {\r\n    total += upg.costAtLevel(currentLevel + i);\r\n  }\r\n  return total;\r\n}\r\n\r\nexport function costToBuyOne(areaKey, upgId) {\r\n  const upg = getUpgrade(areaKey, upgId);\r\n  const lvlBn = getLevel(areaKey, upgId);\r\n  const lvl = levelBigNumToNumber(lvlBn);\r\n  if (!upg) return 0;\r\n  if (lvl >= upg.lvlCap) return 0;\r\n  return upg.costAtLevel(lvl);\r\n}\r\n\r\nexport function buyOne(areaKey, upgId) {\r\n  const state = ensureUpgradeState(areaKey, upgId);\r\n  const upg = state.upg;\r\n  if (!upg) return { bought: 0, spent: 0 };\r\n\r\n  if (isUpgradeLocked(areaKey, upg)) {\r\n    return { bought: 0, spent: 0 };\r\n  }\r\n\r\n  const lvlNum = state.lvl;\r\n  const lvlBn = state.lvlBn ?? ensureLevelBigNum(lvlNum);\r\n  const prevLevelBn = safeCloneBigNum(lvlBn);\r\n\r\n  if (lvlNum >= upg.lvlCap) return { bought: 0, spent: 0 };\r\n\r\n  if (isInfinityLevelForScaled(upg, lvlBn)) {\r\n    state.lvlBn = BigNum.fromAny('Infinity');\r\n    state.lvl = levelBigNumToNumber(state.lvlBn);\r\n    state.nextCostBn = BigNum.fromAny('Infinity');\r\n    commitUpgradeState(state);\r\n    invalidateUpgradeState(areaKey, upgId);\r\n    notifyChanged();\r\n    return { bought: 0, spent: 0 };\r\n  }\r\n\r\n  const rawPrice = state.nextCostBn ?? BigNum.fromAny(upg.costAtLevel(lvlNum));\r\n  const priceBn = rawPrice instanceof BigNum\r\n    ? rawPrice\r\n    : BigNum.fromAny(rawPrice ?? 0);\r\n\r\n  const costType = upg.costType;\r\n  const walletEntry = costType ? bank[costType] : null;\r\n\r\n  let spent = BigNum.fromInt(0);\r\n\r\n  if (walletEntry && !priceBn.isZero?.()) {\r\n    const haveRaw = walletEntry.value;\r\n    const have = haveRaw instanceof BigNum\r\n      ? haveRaw\r\n      : BigNum.fromAny(haveRaw ?? 0);\r\n\r\n    if (have.cmp(priceBn) < 0) {\r\n      return { bought: 0, spent: 0 };\r\n    }\r\n\r\n    spent = priceBn.clone?.() ?? BigNum.fromAny(priceBn);\r\n    walletEntry.sub(spent);\r\n  } else {\r\n    if (!priceBn.isZero?.()) {\r\n      return { bought: 0, spent: 0 };\r\n    }\r\n    spent = BigNum.fromInt(0);\r\n  }\r\n\r\n  const nextLevelBn = lvlBn.add(BigNum.fromInt(1));\r\n  state.lvlBn = nextLevelBn;\r\n  state.lvl = levelBigNumToNumber(nextLevelBn);\r\n  state.nextCostBn = BigNum.fromAny(\r\n    typeof upg.nextCostAfter === 'function'\r\n      ? upg.nextCostAfter(spent, state.lvl)\r\n      : upg.costAtLevel(state.lvl)\r\n  );\r\n\r\n  commitUpgradeState(state);\r\n  invalidateUpgradeState(areaKey, upgId);\r\n  emitUpgradeLevelChange(upg, lvlNum, prevLevelBn, state.lvl, state.lvlBn);\r\n  notifyChanged();\r\n\r\n  return { bought: 1, spent };\r\n}\r\n\r\nexport function evolveUpgrade(areaKey, upgId) {\r\n  const state = ensureUpgradeState(areaKey, upgId);\r\n  const upg = state.upg;\r\n  if (!upg || upg.upgType !== 'HM') return { evolved: false };\r\n\r\n  const lvlBn = state.lvlBn ?? ensureLevelBigNum(state.lvl);\r\n  if (!isHmReadyToEvolve(upg, lvlBn, state.hmEvolutions)) {\r\n    return { evolved: false };\r\n  }\r\n\r\n  const nextEvol = normalizeHmEvolutionCount(state.hmEvolutions) + 1;\r\n  state.hmEvolutions = nextEvol;\r\n  applyHmEvolutionMeta(upg, nextEvol);\r\n\r\n  try { state.nextCostBn = BigNum.fromAny(upg.costAtLevel(state.lvl)); }\r\n  catch { state.nextCostBn = BigNum.fromAny('Infinity'); }\r\n\r\n  commitUpgradeState(state);\r\n  invalidateUpgradeState(areaKey, upgId);\r\n  emitUpgradeLevelChange(upg, state.lvl, lvlBn, state.lvl, lvlBn);\r\n  notifyChanged();\r\n\r\n  return { evolved: true };\r\n}\r\n\r\nexport function buyMax(areaKey, upgId) {\r\n  const state = ensureUpgradeState(areaKey, upgId);\r\n  const upg = state.upg;\r\n  if (!upg) return { bought: 0, spent: BigNum.fromInt(0) };\r\n\r\n  if (isUpgradeLocked(areaKey, upg)) {\r\n    return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n  }\r\n\r\n  const lvlNum = state.lvl;\r\n  const lvlBn = state.lvlBn ?? ensureLevelBigNum(lvlNum);\r\n  const cap = Number.isFinite(upg.lvlCap)\r\n    ? Math.max(0, Math.floor(upg.lvlCap))\r\n    : Infinity;\r\n  if (Number.isFinite(cap) && lvlNum >= cap) return { bought: 0, spent: BigNum.fromInt(0) };\r\n\r\n  const walletHandle = bank[upg.costType];\r\n  const walletValue = walletHandle?.value;\r\n  const wallet = walletValue instanceof BigNum\r\n    ? walletValue.clone?.() ?? BigNum.fromAny(walletValue)\r\n    : BigNum.fromAny(walletValue ?? 0);\r\n\r\n  if (upg.unlockUpgrade) {\r\n    const nextCost = state.nextCostBn?.clone?.() ?? BigNum.fromInt(0);\r\n    if (nextCost.isZero?.()) {\r\n      return buyOne(areaKey, upgId);\r\n    }\r\n  }\r\n\r\n  if (wallet.isZero?.()) return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n\r\n  if (wallet.isInfinite?.()) {\r\n    const prevLevel = lvlBn.clone?.() ?? ensureLevelBigNum(lvlBn);\r\n    const prevLevelNum = levelBigNumToNumber(prevLevel);\r\n    const prevLevelStorage = prevLevel.toStorage?.();\r\n    let targetLevelBn;\r\n\r\n    if (upg.upgType === 'HM') {\r\n      targetLevelBn = BigNum.fromAny('Infinity');\r\n\r\n      if (!upg.lvlCapBn?.isInfinite?.()) {\r\n        const infCap = BigNum.fromAny('Infinity');\r\n        upg.lvlCapBn = infCap;\r\n        upg.lvlCap = Number.POSITIVE_INFINITY;\r\n        upg.lvlCapFmtHtml = formatBigNumAsHtml(infCap);\r\n        upg.lvlCapFmtText = formatBigNumAsPlain(infCap);\r\n      }\r\n    } else {\r\n      const capBn = upg.lvlCapBn?.clone?.() ?? toUpgradeBigNum(upg.lvlCap ?? Infinity, Infinity);\r\n      targetLevelBn = capBn?.clone?.() ?? capBn;\r\n    }\r\n\r\n    let purchased = targetLevelBn.sub(prevLevel);\r\n    if (purchased.isZero?.()) {\r\n      const plainDelta = plainLevelDelta(targetLevelBn, prevLevel);\r\n      if (!plainDelta.isZero?.()) {\r\n        purchased = plainDelta;\r\n      }\r\n    }\r\n    if (purchased.isZero?.()) {\r\n      const nextStorage = targetLevelBn.toStorage?.();\r\n      if (prevLevelStorage && nextStorage && prevLevelStorage !== nextStorage) {\r\n        if (targetLevelBn.isInfinite?.()) {\r\n          try { purchased = BigNum.fromAny('Infinity'); }\r\n          catch { purchased = BigNum.fromInt(1); }\r\n        } else {\r\n          purchased = BigNum.fromInt(1);\r\n        }\r\n      }\r\n    }\r\n    state.lvlBn = targetLevelBn.clone?.() ?? targetLevelBn;\r\n    if (upg.upgType === 'NM' && Number.isFinite(upg.lvlCap)) {\r\n      state.lvl = upg.lvlCap;\r\n    } else {\r\n      state.lvl = levelBigNumToNumber(state.lvlBn);\r\n    }\r\n    state.nextCostBn = BigNum.fromAny('Infinity');\r\n\r\n    bank[upg.costType].set(wallet);\r\n\r\n    commitUpgradeState(state);\r\n    invalidateUpgradeState(areaKey, upgId);\r\n    emitUpgradeLevelChange(\r\n      upg,\r\n      prevLevelNum,\r\n      prevLevel,\r\n      state.lvl,\r\n      state.lvlBn,\r\n    );\r\n    notifyChanged();\r\n\r\n    return { bought: purchased, spent: BigNum.fromInt(0) };\r\n  }\r\n\r\n  const nextCost = state.nextCostBn?.clone?.() ?? BigNum.fromAny(upg.costAtLevel(lvlNum));\r\n  if (wallet.cmp(nextCost) < 0) {\r\n    return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n  }\r\n\r\n  const room = Number.isFinite(cap) ? Math.max(0, cap - lvlNum) : MAX_LEVEL_DELTA;\r\n  if (!(room > 0)) {\r\n    return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n  }\r\n\r\n  const outcome = calculateBulkPurchase(upg, lvlBn, wallet, room);\r\n  const countBn = outcome.count instanceof BigNum\r\n    ? outcome.count\r\n    : BigNum.fromAny(outcome.count ?? 0);\r\n  if (countBn.isZero?.()) {\r\n    return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n  }\r\n\r\n  const spent = outcome.spent ?? BigNum.fromInt(0);\r\n  const remaining = wallet.sub(spent);\r\n  bank[upg.costType].set(remaining);\r\n\r\n  const nextLevelBn = lvlBn.add(countBn);\r\n  state.lvlBn = nextLevelBn;\r\n  state.lvl = levelBigNumToNumber(nextLevelBn);\r\n  if (outcome.nextPrice) {\r\n    state.nextCostBn = outcome.nextPrice;\r\n  } else if (Number.isFinite(state.lvl)) {\r\n    state.nextCostBn = BigNum.fromAny(upg.costAtLevel(state.lvl));\r\n  } else {\r\n    state.nextCostBn = BigNum.fromAny('Infinity');\r\n  }\r\n  commitUpgradeState(state);\r\n  invalidateUpgradeState(areaKey, upgId);\r\n  emitUpgradeLevelChange(upg, lvlNum, lvlBn, state.lvl, state.lvlBn);\r\n  notifyChanged();\r\n\r\n  return { bought: countBn, spent };\r\n}\r\n\r\nexport function buyTowards(areaKey, upgId, maxLevels) {\r\n  const state = ensureUpgradeState(areaKey, upgId);\r\n  const upg = state.upg;\r\n  if (!upg) return { bought: 0, spent: BigNum.fromInt(0) };\r\n\r\n  if (isUpgradeLocked(areaKey, upg)) {\r\n    return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n  }\r\n\r\n  const lvlNum = state.lvl;\r\n  const lvlBn = state.lvlBn ?? ensureLevelBigNum(lvlNum);\r\n  const cap = Number.isFinite(upg.lvlCap)\r\n    ? Math.max(0, Math.floor(upg.lvlCap))\r\n    : Infinity;\r\n  if (Number.isFinite(cap) && lvlNum >= cap) return { bought: 0, spent: BigNum.fromInt(0) };\r\n\r\n  const walletHandle = bank[upg.costType];\r\n  const walletValue = walletHandle?.value;\r\n  const wallet = walletValue instanceof BigNum\r\n    ? walletValue.clone?.() ?? BigNum.fromAny(walletValue)\r\n    : BigNum.fromAny(walletValue ?? 0);\r\n\r\n  if (wallet.isZero?.()) return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n\r\n  const capRoom = Number.isFinite(cap) ? Math.max(0, cap - lvlNum) : undefined;\r\n  const maxRoom = Number.isFinite(maxLevels)\r\n    ? Math.max(0, Math.floor(maxLevels))\r\n    : (maxLevels instanceof BigNum ? levelBigNumToNumber(maxLevels) : undefined);\r\n  const room = Number.isFinite(capRoom)\r\n    ? (Number.isFinite(maxRoom) ? Math.min(capRoom, maxRoom) : capRoom)\r\n    : maxRoom;\r\n\r\n  const outcome = calculateBulkPurchase(upg, lvlBn, wallet, room);\r\n  const countBn = outcome.count instanceof BigNum\r\n    ? outcome.count\r\n    : BigNum.fromAny(outcome.count ?? 0);\r\n  if (countBn.isZero?.()) {\r\n    return { bought: BigNum.fromInt(0), spent: BigNum.fromInt(0) };\r\n  }\r\n\r\n  const spent = outcome.spent ?? BigNum.fromInt(0);\r\n  const remaining = wallet.sub(spent);\r\n  bank[upg.costType].set(remaining);\r\n\r\n  const nextLevelBn = lvlBn.add(countBn);\r\n  state.lvlBn = nextLevelBn;\r\n  state.lvl = levelBigNumToNumber(nextLevelBn);\r\n  if (outcome.nextPrice) {\r\n    state.nextCostBn = outcome.nextPrice;\r\n  } else if (Number.isFinite(state.lvl)) {\r\n    state.nextCostBn = BigNum.fromAny(upg.costAtLevel(state.lvl));\r\n  } else {\r\n    state.nextCostBn = BigNum.fromAny('Infinity');\r\n  }\r\n  commitUpgradeState(state);\r\n  invalidateUpgradeState(areaKey, upgId);\r\n  emitUpgradeLevelChange(upg, lvlNum, lvlBn, state.lvl, state.lvlBn);\r\n  notifyChanged();\r\n\r\n  return { bought: countBn, spent };\r\n}\r\n\r\nexport function evaluateBulkPurchase(upg, startLevel, walletBn, maxLevels = MAX_LEVEL_DELTA, options = {}) {\r\n  const wallet = walletBn instanceof BigNum ? walletBn : BigNum.fromAny(walletBn ?? 0);\r\n  const outcome = calculateBulkPurchase(upg, startLevel, wallet, maxLevels, options);\r\n  return {\r\n    count: outcome.count,\r\n    spent: outcome.spent ?? BigNum.fromInt(0),\r\n    nextPrice: outcome.nextPrice ?? BigNum.fromInt(0),\r\n    numericCount: outcome.numericCount ?? 0,\r\n  };\r\n}\r\n\r\n/* ------------------------------ Effects wiring ---------------------------- */\r\n\r\nconst BASE_CPS = 1;\r\n\r\nexport function computeUpgradeEffects(areaKey) {\r\n  const ups = getUpgradesForArea(areaKey);\r\n  let cpsMult = 1.0;\r\n  let coinValueMultBn = BigNum.fromInt(1);\r\n  let xpGainMultBn = BigNum.fromInt(1);\r\n  let bookRewardMultBn = BigNum.fromInt(1);\r\n\r\n  for (const u of ups) {\r\n    const lvlBn = getLevel(areaKey, u.id);\r\n    const lvlNum = levelBigNumToNumber(lvlBn);\r\n    const tieKey = u.tieKey || normalizeUpgradeTie(u.tie);\r\n    if (tieKey === UPGRADE_TIES.FASTER_COINS) {\r\n      // Faster Coins\r\n      cpsMult *= u.effectMultiplier(lvlNum);\r\n    } else if (tieKey === UPGRADE_TIES.FASTER_COINS_II) {\r\n      cpsMult *= u.effectMultiplier(lvlNum);\r\n    } else if (tieKey === UPGRADE_TIES.COIN_VALUE_I) {\r\n      const lvl = Math.max(0, Number.isFinite(lvlNum) ? lvlNum : 0);\r\n      if (lvl > 0) {\r\n        const factor = 1 + (0.5 * lvl);\r\n        let str = factor.toFixed(6);\r\n        str = str.replace(/\\.0+$/, '').replace(/(\\.\\d*?)0+$/, '$1');\r\n        coinValueMultBn = coinValueMultBn.mulDecimal(str, 18);\r\n      }\r\n    } else if (tieKey === UPGRADE_TIES.COIN_VALUE_II) {\r\n      const lvl = normalizedUpgradeLevel(lvlNum);\r\n      if (lvl > 0) {\r\n        try {\r\n          const bonus = hundredPercentPerLevelMultiplier(lvl);\r\n          coinValueMultBn = coinValueMultBn.mulBigNumInteger(bonus);\r\n        } catch {}\r\n      }\r\n    } else if (tieKey === UPGRADE_TIES.BOOK_VALUE_I) {\r\n      bookRewardMultBn = bookValueMultiplierBn(lvlNum);\r\n    } else if (tieKey === UPGRADE_TIES.XP_VALUE_I) {\r\n      const lvl = Math.max(0, Number.isFinite(lvlNum) ? lvlNum : 0);\r\n      xpGainMultBn = BigNum.fromAny(1 + lvl * 2);\r\n    } else if (tieKey === UPGRADE_TIES.XP_VALUE_II) {\r\n      const lvl = normalizedUpgradeLevel(lvlNum);\r\n      if (lvl > 0) {\r\n        try {\r\n          const bonus = hundredPercentPerLevelMultiplier(lvl);\r\n          xpGainMultBn = xpGainMultBn.mulBigNumInteger(bonus);\r\n        } catch {}\r\n      }\r\n    }\r\n    // future upgrades here...\r\n  }\r\n\r\n  return {\r\n    coinsPerSecondMult: cpsMult,\r\n    coinsPerSecondAbsolute: BASE_CPS * cpsMult,\r\n    coinValueMultiplier: coinValueMultBn,\r\n    xpGainMultiplier: xpGainMultBn,\r\n    bookRewardMultiplier: bookRewardMultBn,\r\n  };\r\n}\r\n\r\nfunction registerXpUpgradeEffects() {\r\n  try { initResetSystem(); } catch {}\r\n\r\n  // ----- Coin value (Coin Value I + Coin Value II) -----\r\n  try {\r\n    addExternalCoinMultiplierProvider(({ baseMultiplier, xpUnlocked }) => {\r\n      if (!xpUnlocked) return baseMultiplier;\r\n\r\n      let result;\r\n      try {\r\n        result = baseMultiplier instanceof BigNum\r\n          ? baseMultiplier.clone?.() ?? baseMultiplier\r\n          : BigNum.fromAny(baseMultiplier ?? 0);\r\n      } catch {\r\n        result = BigNum.fromInt(0);\r\n      }\r\n\r\n      // Coin Value I: +50% per level\r\n      try {\r\n        const lvl1 = getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.COIN_VALUE_I);\r\n        const safeLvl1 = Math.max(0, Number.isFinite(lvl1) ? lvl1 : 0);\r\n        if (safeLvl1 > 0) {\r\n          let str = (1 + 0.5 * safeLvl1).toFixed(6);\r\n          str = str.replace(/\\.0+$/, '').replace(/(\\.\\d*?)0+$/, '$1');\r\n          try {\r\n            result = result.mulDecimal(str, 18);\r\n          } catch {}\r\n        }\r\n      } catch {}\r\n\r\n      // Coin Value II (gold_0): +100% per level (independent of I)\r\n      try {\r\n        const lvl2 = normalizedUpgradeLevel(\r\n          getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.COIN_VALUE_II)\r\n        );\r\n        if (lvl2 > 0) {\r\n          const bonus = hundredPercentPerLevelMultiplier(lvl2);\r\n          try {\r\n            result = result.mulBigNumInteger(bonus);\r\n          } catch {}\r\n        }\r\n      } catch {}\r\n\r\n      // Endless XP (HM): milestone bonuses to coin value\r\n      try {\r\n        const hmUpg = getUpgrade(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.ENDLESS_XP);\r\n        const hmLvl = getLevel(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.ENDLESS_XP);\r\n        const { coinMult } = computeHmMultipliers(hmUpg, hmLvl, AREA_KEYS.STARTER_COVE);\r\n        result = safeMultiplyBigNum(result, coinMult);\r\n      } catch {}\r\n\r\n      return result;\r\n    });\r\n  } catch {}\r\n\r\n  // ----- XP value (XP Value I + XP Value II) -----\r\n  try {\r\n    addExternalXpGainMultiplierProvider(({ baseGain, xpUnlocked }) => {\r\n      if (!xpUnlocked) return baseGain;\r\n\r\n      let gain;\r\n      try {\r\n        gain = baseGain instanceof BigNum\r\n          ? baseGain.clone?.() ?? baseGain\r\n          : BigNum.fromAny(baseGain ?? 0);\r\n      } catch {\r\n        gain = BigNum.fromInt(0);\r\n      }\r\n\r\n      // XP Value I: +200% per level (1 + 2*lvl)\r\n      try {\r\n        const lvl1 = getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.XP_VALUE_I);\r\n        const safeLvl1 = Math.max(0, Number.isFinite(lvl1) ? lvl1 : 0);\r\n        if (safeLvl1 > 0) {\r\n          try {\r\n            gain = gain.mulBigNumInteger(BigNum.fromAny(1 + safeLvl1 * 2));\r\n          } catch {}\r\n        }\r\n      } catch {}\r\n\r\n      // XP Value II (gold_1): +100% per level (independent of I)\r\n      try {\r\n        const lvl2 = normalizedUpgradeLevel(\r\n          getLevelNumber(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.XP_VALUE_II)\r\n        );\r\n        if (lvl2 > 0) {\r\n          const bonus = hundredPercentPerLevelMultiplier(lvl2);\r\n          try {\r\n            gain = gain.mulBigNumInteger(bonus);\r\n          } catch {}\r\n        }\r\n      } catch {}\r\n\r\n      // Endless XP (HM): core effect + milestones\r\n      try {\r\n        const hmUpg = getUpgrade(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.ENDLESS_XP);\r\n        const hmLvl = getLevel(AREA_KEYS.STARTER_COVE, UPGRADE_TIES.ENDLESS_XP);\r\n        let base = 1;\r\n        try { base = hmUpg?.effectMultiplier?.(hmLvl) ?? 1; } catch {}\r\n        const { selfMult, xpMult } = computeHmMultipliers(hmUpg, hmLvl, AREA_KEYS.STARTER_COVE);\r\n        gain = safeMultiplyBigNum(gain, safeMultiplyBigNum(base, selfMult));\r\n        gain = safeMultiplyBigNum(gain, xpMult);\r\n      } catch {}\r\n\r\n      return gain;\r\n    });\r\n  } catch {}\r\n\r\n  try {\r\n    setExternalBookRewardProvider(({ baseReward, xpUnlocked }) => {\r\n      if (!xpUnlocked) return baseReward;\r\n\r\n      try {\r\n        return baseReward instanceof BigNum\r\n          ? baseReward.clone?.() ?? baseReward\r\n          : BigNum.fromAny(baseReward ?? 0);\r\n      } catch {\r\n        return BigNum.fromInt(0);\r\n      }\r\n    });\r\n  } catch {}\r\n\r\n  syncBookCurrencyMultiplierFromUpgrade();\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('saveSlot:change', () => {\r\n      try { syncBookCurrencyMultiplierFromUpgrade(); } catch {}\r\n      try { refreshCoinMultiplierFromXpLevel(); } catch {}\r\n    });\r\n  }\r\n}\r\n\r\nregisterXpUpgradeEffects();\r\n\r\nlet listeners = [];\r\nexport function onUpgradesChanged(cb) {\r\n  if (typeof cb === 'function') listeners.push(cb);\r\n  return () => { listeners = listeners.filter(x => x !== cb); };\r\n}\r\nfunction notifyChanged() {\r\n  try { listeners.forEach(cb => cb()); } catch {}\r\n  try { document.dispatchEvent(new CustomEvent('ccc:upgrades:changed')); } catch {}\r\n  try { refreshCoinMultiplierFromXpLevel(); } catch {}\r\n}\r\n\r\n/* ----------------------- Area detection (DOM mapping) ---------------------- */\r\n\r\nexport function getCurrentAreaKey() {\r\n  const gameRoot = document.getElementById('game-root');\r\n  if (gameRoot?.classList?.contains('area-cove')) return AREA_KEYS.STARTER_COVE;\r\n  return AREA_KEYS.STARTER_COVE;\r\n}\r\n\r\n/* ------------------------------ UI helpers -------------------------------- */\r\n\r\nexport function upgradeUiModel(areaKey, upgId) {\r\n  const upg = getUpgrade(areaKey, upgId);\r\n  if (!upg) return null;\r\n  const lvlBn = getLevel(areaKey, upgId);\r\n  const lvl = levelBigNumToNumber(lvlBn);\r\n  const lvlFmtHtml = formatBigNumAsHtml(lvlBn);\r\n  const lvlFmtText = formatBigNumAsPlain(lvlBn);\r\n  const lvlCapBn = upg.lvlCapBn ?? toUpgradeBigNum(upg.lvlCap ?? Infinity, Infinity);\r\n  const lvlCapFmtHtml = upg.lvlCapFmtHtml ?? formatBigNumAsHtml(lvlCapBn);\r\n  const lvlCapFmtText = upg.lvlCapFmtText ?? formatBigNumAsPlain(lvlCapBn);\r\n  const nextPrice = lvl < upg.lvlCap ? peekNextPrice(areaKey, upgId) : BigNum.fromInt(0);\r\n  const nextPriceFmt = formatBigNumAsHtml(nextPrice);\r\n  const haveRaw = bank[upg.costType]?.value;\r\n  const have = haveRaw instanceof BigNum\r\n    ? haveRaw\r\n    : BigNum.fromAny(haveRaw ?? 0);\r\n  const lockState = getUpgradeLockState(areaKey, upgId);\r\n  const locked = !!lockState.locked;\r\n  const displayTitle = lockState.titleOverride ?? upg.title;\r\n  const displayDesc = lockState.descOverride ?? upg.desc;\r\n  const hmMilestones = resolveHmMilestones(upg, areaKey);\r\n  let effect = '';\r\n  if (typeof upg.effectSummary === 'function' && !(locked && lockState.hideEffect)) {\r\n    effect = upg.effectSummary(lvl);\r\n    if (typeof effect === 'string') effect = effect.trim();\r\n  }\r\n  const iconUrl = lockState.iconOverride ?? getIconUrl(upg);\r\n  return {\r\n    upg,\r\n    lvl,\r\n    lvlBn,\r\n    lvlFmtHtml,\r\n    lvlFmtText,\r\n    lvlCapBn,\r\n    lvlCapFmtHtml,\r\n    lvlCapFmtText,\r\n    nextPrice,\r\n    nextPriceFmt,\r\n    have,\r\n    haveFmt: bank[upg.costType]?.fmt(have) ?? String(have),\r\n    effect,\r\n    iconUrl,\r\n    lockState,\r\n    locked,\r\n    areaKey,\r\n    hmMilestones,\r\n    displayTitle,\r\n    displayDesc,\r\n    unlockUpgrade: !!upg.unlockUpgrade,\r\n    hmEvolutions: upg.upgType === 'HM' ? getHmEvolutions(areaKey, upgId) : 0,\r\n    hmReadyToEvolve: upg.upgType === 'HM' ? isHmReadyToEvolve(upg, lvlBn, getHmEvolutions(areaKey, upgId)) : false,\r\n    hmNextMilestone: upg.upgType === 'HM' ? hmNextMilestoneLevel(upg, lvlBn, areaKey) : null,\r\n  };\r\n}\r\n\r\nexport function getHmNextMilestoneLevel(areaKey, upgId) {\r\n  const upg = getUpgrade(areaKey, upgId);\r\n  if (!upg || upg.upgType !== 'HM') return null;\r\n  const lvlBn = getLevel(areaKey, upgId);\r\n  return hmNextMilestoneLevel(upg, lvlBn, areaKey);\r\n}\r\n\r\nexport function normalizeBigNum(value) {\r\n  return bigNumFromLog10(approxLog10BigNum(value ?? 0));\r\n}", "export const MERCHANT_DIALOGUES = {\r\n  0: {\r\n    start: 'n0',\r\n    nodes: {\r\n      n0: { type: 'line', say: 'So you want to delve deeper within my shop, do you?', next: 'c1' },\r\n\r\n      r_who: { type: 'line', say: 'I am the Merchant.', next: 'c2' },\r\n      r_where: { type: 'line', say: 'The cove.',          next: 'c2' },\r\n      r_confused: { type: 'line', say: 'Okay.',                next: 'c2' },\r\n\r\n      c1: { type: 'choice', options: [\r\n        { label: 'Who are you?', to: 'r_who' },\r\n        { label: 'Where am I?', to: 'r_where' },\r\n        { label: 'I just clicked on this green button and now I\u2019m confused.', to: 'r_confused' },\r\n      ]},\r\n\r\n      c2: { type: 'choice', options: [\r\n        { label: 'What?', to: 'r2_what' }, \r\n        { label: 'That\u2019s not helpful.', to: 'r2_okay' }, \r\n        { label: 'Okay.', to: 'r2_okay' }, \r\n      ]},\r\n\r\n      r2_what: { type: 'line', say: 'What?', next: 'c3' },\r\n      r2_okay:   { type: 'line', say: 'Okay.',   next: 'c3' },\r\n\r\n      c3: { type: 'choice', options: [\r\n        { label: 'What?', to: 'r2_what' },\r\n        { label: 'That\u2019s not helpful.', to: 'r2_okay' },\r\n        { label: 'Goodbye.', to: 'end' },\r\n      ]},\r\n    }\r\n  },\r\n\r\n  1: {\r\n    start: 'n0',\r\n    nodes: {\r\n      n0: { type: 'line', say: 'Hello again.', next: 'c0' },\r\n\r\n      c0: { type: 'choice', options: [\r\n        { label: 'You never answered my questions.', to: 'm1a' },\r\n        { label: 'Hello.', to: 'm1b' },\r\n        { label: 'I am still very confused.', to: 'm1c' },\r\n      ]},\r\n\r\n      m1a: { type: 'line', say: 'Yes I did.', next: 'c1a' },\r\n      m1b: { type: 'line', say: 'Hello.',    next: 'c1b' },\r\n      m1c: { type: 'line', say: 'Okay.',       next: 'c1c' },\r\n\r\n      c1a: { type: 'choice', options: [\r\n        { label: 'No you didn\u2019t.', to: 'm1a' },\r\n        { label: 'Liar.',          to: 'm2a' },\r\n        { label: 'Okay I guess you\u2019re right.', to: 'm2b' },\r\n      ]},\r\n\r\n      c1b: { type: 'choice', options: [\r\n        { label: 'You never answered my questions.', to: 'm1a' },\r\n        { label: 'That does not help.',              to: 'm1c' },\r\n        { label: 'Okay.',                              to: 'm2b' },\r\n      ]},\r\n\r\n      c1c: { type: 'choice', options: [\r\n        { label: 'Yes.',  to: 'm2a' },\r\n        { label: 'Hmm\u2026',  to: 'm1c' },\r\n        { label: 'Okay.',   to: 'm2b' },\r\n      ]},\r\n\r\n      m2a: { type: 'line', say: 'No.', next: 'c1c' },\r\n      m2b: { type: 'line', say: 'Would you like some Coins? Free of charge. You look like you could use some right now.', next: 'c2a' },\r\n\r\n      c2a: { type: 'choice', options: [\r\n        { label: 'What?',                to: 'm3a' },\r\n        { label: 'No.',        to: 'm3b' },\r\n        { label: 'Give me the coins now.', to: 'end' },\r\n      ]},\r\n\r\n      m3a: { type: 'line', say: 'What?', next: 'c2a' },\r\n      m3b: { type: 'line', say: 'Okay, no Coins for you then.', next: 'c2b' },\r\n\r\n      c2b: { type: 'choice', options: [\r\n        { label: 'No wait, actually I want the coins. Give them to me now.', to: 'end' },\r\n        { label: 'On second thought, maybe I do want the coins. Give them to me now.', to: 'end' },\r\n        { label: 'Okay, bye, I don\u2019t need your filthy coins anyway.', to: 'end_nr' },\r\n      ]},\r\n    }\r\n  },\r\n  2: {\r\n    start: 'n0',\r\n    nodes: {\r\n      n0: { type: 'line', say: 'I see you\u2019ve unlocked the XP system.', next: 'c0' },\r\n\r\n      c0: { type: 'choice', options: [\r\n        { label: 'What does it do?',      to: 'm1a' },\r\n        { label: 'What does that mean?',  to: 'm1b' },\r\n        { label: 'Yes I did that.',       to: 'm1c' },\r\n      ]},\r\n\r\n      m1a: { type: 'line', say: 'The XP system is a powerful ancient mechanism, designed to allow rapid influx of coin-collecting power. Increasing your XP Level grants you Books infused with my power, capable of great things.', next: 'c1a' },\r\n      m1b: { type: 'line', say: 'It means you can grow passively stronger by collecting coins.', next: 'c1b' },\r\n      m1c: { type: 'line', say: 'And do you know how the XP system works?', next: 'c1c' },\r\n\r\n      c1a: { type: 'choice', options: [\r\n        { label: 'This XP system, by whom was it designed, exactly?', to: 'm2b' },\r\n        { label: 'What does that mean?',                               to: 'm1b' },\r\n        { label: 'Okay.',                                              to: 'm2a' },\r\n      ]},\r\n      c1b: { type: 'choice', options: [\r\n        { label: 'Can you explain in more detail?', to: 'm1a' },\r\n        { label: 'Why?',                           to: 'm2c' },\r\n        { label: 'Okay.',                          to: 'm2a' },\r\n      ]},\r\n      c1c: { type: 'choice', options: [\r\n        { label: 'I have no idea.',              to: 'm1a' },\r\n        { label: 'I don\u2019t know the full details.', to: 'm1a' },\r\n        { label: 'Yes.',                         to: 'm2a' },\r\n      ]},\r\n\r\n      m2a: { type: 'line', say: 'Would you like some Books, free of charge? They will help you accelerate your coin-collecting power.', next: 'c2a' },\r\n      m2b: { type: 'line', say: 'I dunno.', next: 'c2b' },\r\n      m2c: { type: 'line', say: 'Because I dunno.', next: 'c2c' },\r\n      m2d: { type: 'line', say: 'What?',    next: 'c2c' },\r\n      m2e: { type: 'line', say: 'I\u2019ve already told you, so you can increase your coin-collecting power.', next: 'c2d' },\r\n      m2f: { type: 'line', say: 'Are you sure you don\u2019t want free Books?', next: 'c3a' },\r\n\r\n      c2a: { type: 'choice', options: [\r\n        { label: 'No.',                               to: 'm2f' },\r\n        { label: 'Why are you giving me all this free stuff?', to: 'm2e' },\r\n        { label: 'Yeah, sure.',                       to: 'end' },\r\n      ]},\r\n      c2b: { type: 'choice', options: [\r\n        { label: 'What?', to: 'm2d' },\r\n        { label: 'Why not?',  to: 'm2c' },\r\n        { label: '\u2026',     to: 'm2a' },\r\n      ]},\r\n      c2c: { type: 'choice', options: [\r\n        { label: '\u2026', to: 'm2a' },\r\n        { label: '\u2026', to: 'm2a' },\r\n        { label: '\u2026', to: 'm2a' },\r\n      ]},\r\n      c2d: { type: 'choice', options: [\r\n        { label: 'But why does that matter?',   to: 'm3a' },\r\n        { label: 'But what does that mean?',    to: 'm3a' },\r\n        { label: '\u2026',                           to: 'm3a' },\r\n      ]},\r\n\r\n      m3a: { type: 'line', say: 'If you want free Books, then don\u2019t ask further questions.', next: 'c3a' },\r\n\r\n      c3a: { type: 'choice', options: [\r\n        { label: 'Okay, actually give me the free stuff.',        to: 'end' },\r\n        { label: 'Okay fine, I\u2019ll take those books off your hands.', to: 'end' },\r\n        { label: 'I don\u2019t need your charity.',                    to: 'end_nr' },\r\n      ]},\r\n    }\r\n  },\r\n  3: {\r\n    start: 'n0',\r\n    nodes: {\r\n      n0: { type: 'line', say: 'Level 999. I hoped to see it one day. Placeholder admiration intensifies.', next: 'c0' },\r\n\r\n      c0: { type: 'choice', options: [\r\n        { label: 'Was it worth it?', to: 'q0' },\r\n        { label: 'What happens next?', to: 'q1' },\r\n        { label: 'I need a break.', to: 'end' },\r\n      ]},\r\n\r\n      q0: { type: 'line', say: 'Only you can decide that. But the data you gathered will fuel upcoming secrets.', next: 'c1' },\r\n      q1: { type: 'line', say: 'Beyond this? More systems, more bargains, and more reasons to climb. Placeholder, of course.', next: 'c1' },\r\n\r\n      c1: { type: 'choice', options: [\r\n        { label: 'Where are the rewards?', to: 'q2' },\r\n        { label: 'I\u2019ll keep going.', to: 'end' },\r\n        { label: 'I need another hint.', to: 'q3' },\r\n      ]},\r\n\r\n      q2: { type: 'line', say: 'For now, take pride. The tangible prizes arrive in a future update.', next: 'c1' },\r\n      q3: { type: 'line', say: 'Watch the Merchant tab. New dialogues will appear at milestones beyond this.', next: 'c1' },\r\n    }\r\n  },\r\n};", "// js/util/ghostTapGuard.js\r\n// Fixes issue with buttons on mobile that prevents them from being spam clicked; it is important this is applied to every clickable button in the game\r\n\r\nconst DEFAULT_TIMEOUT_MS = 0;\r\nconst ELEMENT_SKIP_PROP = Symbol('ccc:ghostTap:skipUntil');\r\nconst GLOBAL_SKIP_PROP = '__cccGhostTapSkipUntil';\r\nconst TARGET_SELECTOR = '[data-ghost-tap-target], button, [role=\"button\"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary';\r\nconst DEFAULT_LONG_PRESS_MS = 80;\r\n\r\nlet guardInstalled = false;\r\nlet selector = TARGET_SELECTOR;\r\nlet hasPointerEvents = false;\r\nlet hasTouchEvents = false;\r\nlet lastMarkedTarget = null;\r\nlet lastTouchMs = 0;\r\nlet lastTouchStartMs = 0;\r\nlet lastTouchDurationMs = 0;\r\nlet longPressMs = DEFAULT_LONG_PRESS_MS;\r\n\r\nfunction nowMs() {\r\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\r\n    return performance.now();\r\n  }\r\n  return Date.now();\r\n}\r\n\r\nfunction getDocument() {\r\n  if (typeof document === 'undefined') return null;\r\n  return document;\r\n}\r\n\r\nfunction findTapTarget(node) {\r\n  const doc = getDocument();\r\n  if (!doc) return null;\r\n  const ElementCtor = typeof Element !== 'undefined' ? Element : null;\r\n  if (!node || !ElementCtor) return null;\r\n  if (!(node instanceof ElementCtor)) {\r\n    node = node.parentElement;\r\n  }\r\n  if (!node || !node.closest) return null;\r\n  return node.closest(selector);\r\n}\r\n\r\nfunction clearGhostTapTarget(el) {\r\n  if (!el) return;\r\n  el[ELEMENT_SKIP_PROP] = 0;\r\n}\r\n\r\nfunction markGhostTapTarget(el, timeout = DEFAULT_TIMEOUT_MS) {\r\n  if (!el) return;\r\n  const now = nowMs();\r\n  const delay = Number.isFinite(timeout) ? Math.max(0, Number(timeout)) : DEFAULT_TIMEOUT_MS;\r\n  if (delay > 0) {\r\n    el[ELEMENT_SKIP_PROP] = now + delay;\r\n  } else {\r\n    el[ELEMENT_SKIP_PROP] = 0;\r\n  }\r\n  lastMarkedTarget = el;\r\n  if (delay > 0) suppressNextGhostTap(delay);\r\n}\r\n\r\nfunction consumeGhostTapGuard(target) {\r\n  if (typeof window === 'undefined') return false;\r\n  const until = window[GLOBAL_SKIP_PROP];\r\n  if (typeof until !== 'number') return false;\r\n\r\n  const now = nowMs();\r\n  if (now <= until) {\r\n    window[GLOBAL_SKIP_PROP] = null;\r\n    if (target && lastMarkedTarget && target === lastMarkedTarget) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  window[GLOBAL_SKIP_PROP] = null;\r\n  return false;\r\n}\r\n\r\nfunction shouldSkipGhostTap(el) {\r\n  if (!el) return false;\r\n  const until = Number(el[ELEMENT_SKIP_PROP] || 0);\r\n  if (!Number.isFinite(until) || until <= 0) return false;\r\n  const now = nowMs();\r\n  if (now <= until) {\r\n    if (lastMarkedTarget && el === lastMarkedTarget) {\r\n      clearGhostTapTarget(el);\r\n      return false;\r\n    }\r\n    clearGhostTapTarget(el);\r\n    return true;\r\n  }\r\n  clearGhostTapTarget(el);\r\n  return false;\r\n}\r\n\r\nfunction suppressNextGhostTap(timeout = DEFAULT_TIMEOUT_MS) {\r\n  if (typeof window === 'undefined') return;\r\n  const now = nowMs();\r\n  const targetDelay = Math.max(0, Number.isFinite(timeout) ? timeout : DEFAULT_TIMEOUT_MS);\r\n  if (targetDelay <= 0) {\r\n    window[GLOBAL_SKIP_PROP] = null;\r\n    return;\r\n  }\r\n  const target = now + targetDelay;\r\n  const current = typeof window[GLOBAL_SKIP_PROP] === 'number'\r\n    ? window[GLOBAL_SKIP_PROP]\r\n    : 0;\r\n  window[GLOBAL_SKIP_PROP] = Math.max(current, target);\r\n}\r\n\r\nfunction onPointerStart(event) {\r\n  if (event.pointerType === 'mouse') return;\r\n  if (typeof event.button === 'number' && event.button !== 0) return;\r\n  lastTouchMs = lastTouchStartMs = nowMs();\r\n  lastTouchDurationMs = 0;\r\n  const target = findTapTarget(event.target);\r\n  if (!target) return;\r\n  if (consumeGhostTapGuard(target)) {\r\n    clearGhostTapTarget(target);\r\n    event.preventDefault();\r\n    event.stopImmediatePropagation();\r\n  }\r\n}\r\n\r\nfunction onTouchStart(event) {\r\n  lastTouchMs = lastTouchStartMs = nowMs();\r\n  lastTouchDurationMs = 0;\r\n  const target = findTapTarget(event.target);\r\n  if (!target) return;\r\n  if (consumeGhostTapGuard(target)) {\r\n    clearGhostTapTarget(target);\r\n    event.preventDefault();\r\n    event.stopImmediatePropagation();\r\n  }\r\n}\r\n\r\nfunction onPointerEnd(event) {\r\n  if (event.pointerType === 'mouse') return;\r\n  if (typeof event.button === 'number' && event.button !== 0) return;\r\n  const now = nowMs();\r\n  if (lastTouchStartMs > 0) {\r\n    lastTouchDurationMs = now - lastTouchStartMs;\r\n  }\r\n  lastTouchMs = now;\r\n}\r\n\r\nfunction onTouchEnd() {\r\n  const now = nowMs();\r\n  if (lastTouchStartMs > 0) {\r\n    lastTouchDurationMs = now - lastTouchStartMs;\r\n  }\r\n  lastTouchMs = now;\r\n}\r\n\r\nfunction onClickCapture(event) {\r\n  const now = nowMs();\r\n  const sinceTouchStart = lastTouchStartMs > 0 ? now - lastTouchStartMs : -1;\r\n  if (sinceTouchStart < 0) return;\r\n\r\n  const target = findTapTarget(event.target);\r\n  if (!target) return;\r\n\r\n  const effectiveDuration = lastTouchDurationMs || sinceTouchStart;\r\n\r\n  if (effectiveDuration >= longPressMs) {\r\n    clearGhostTapTarget(target);\r\n    lastTouchDurationMs = 0;\r\n    event.preventDefault();\r\n    event.stopImmediatePropagation();\r\n    return;\r\n  }\r\n  if (consumeGhostTapGuard(target)) {\r\n    clearGhostTapTarget(target);\r\n    lastTouchDurationMs = 0;\r\n    event.preventDefault();\r\n    event.stopImmediatePropagation();\r\n  }\r\n  lastTouchDurationMs = 0;\r\n}\r\n\r\n\r\nexport function installGhostTapGuard(options = {}) {\r\n  if (guardInstalled) return;\r\n  const doc = getDocument();\r\n  if (!doc || typeof window === 'undefined') return;\r\n\r\n  guardInstalled = true;\r\n  hasPointerEvents = 'PointerEvent' in window;\r\n  hasTouchEvents = !hasPointerEvents && 'ontouchstart' in window;\r\n  if (options.selector) {\r\n    selector = `${options.selector}, ${TARGET_SELECTOR}`;\r\n  }\r\n\r\n  if (Number.isFinite(options.longPressMs) && options.longPressMs >= 0) {\r\n    longPressMs = options.longPressMs;\r\n  }\r\n\r\n  doc.addEventListener('click', onClickCapture, true);\r\n\r\n  if (hasPointerEvents) {\r\n    doc.addEventListener('pointerdown', onPointerStart, { capture: true, passive: false });\r\n    doc.addEventListener('pointerup', onPointerEnd, { capture: true, passive: true });\r\n  } else if (hasTouchEvents) {\r\n    doc.addEventListener('touchstart', onTouchStart, { capture: true, passive: false });\r\n    doc.addEventListener('touchend', onTouchEnd, { capture: true, passive: true });\r\n  }\r\n}\r\n\r\nexport {\r\n  clearGhostTapTarget,\r\n  markGhostTapTarget,\r\n  shouldSkipGhostTap,\r\n  suppressNextGhostTap,\r\n  consumeGhostTapGuard,\r\n  DEFAULT_TIMEOUT_MS as GHOST_TAP_TIMEOUT_MS,\r\n};\r\n\r\nexport function setGhostTapSelector(extraSelector) {\r\n  if (!extraSelector) return;\r\n  selector = `${extraSelector}, ${TARGET_SELECTOR}`;\r\n}", "// js/ui/merchantDelve/dlgTab.js\r\nimport {\r\n  bank,\r\n  getActiveSlot,\r\n  watchStorageKey,\r\n  primeStorageWatcherSnapshot,\r\n} from '../../util/storage.js';\r\nimport { BigNum } from '../../util/bigNum.js';\r\nimport { MERCHANT_DIALOGUES } from '../../misc/merchantDialogues.js';\r\nimport { getXpState, isXpSystemUnlocked } from '../../game/xpSystem.js';\r\nimport { initResetPanel, initResetSystem, updateResetPanel, isForgeUnlocked, hasDoneForgeReset } from './resetTab.js';\r\nimport { blockInteraction } from '../shopOverlay.js';\r\nimport {\r\n  markGhostTapTarget,\r\n  shouldSkipGhostTap,\r\n  suppressNextGhostTap,\r\n} from '../../util/ghostTapGuard.js';\r\nimport { IS_MOBILE } from '../../main.js';\r\n\r\nfunction nowMs() {\r\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\r\n    return performance.now();\r\n  }\r\n  return Date.now();\r\n}\r\n\r\nconst MERCHANT_ICON_SRC = 'img/misc/merchant.png';\r\nconst MERCHANT_MET_KEY_BASE  = 'ccc:merchantMet';\r\nconst MERCHANT_TAB_KEY_BASE  = 'ccc:merchantTab';\r\nexport const MERCHANT_DLG_STATE_KEY_BASE = 'ccc:merchant:dlgState';\r\nexport const MERCHANT_MET_EVENT = 'ccc:merchant:met';\r\nconst sk = (base) => `${base}:${getActiveSlot()}`;\r\n\r\nexport function hasMetMerchant() {\r\n  try {\r\n    return localStorage.getItem(sk(MERCHANT_MET_KEY_BASE)) === '1';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst MERCHANT_TABS_DEF = [\r\n  { key: 'dialogue',  label: 'Dialogue', unlocked: true },\r\n  { key: 'reset',     label: 'Reset',    unlocked: false, lockedLabel: '???' },\r\n  { key: 'minigames', label: '???',      unlocked: false },\r\n];\r\n\r\nconst merchantTabUnlockState = new Map([\r\n  ['dialogue', true],\r\n  ['reset', false],\r\n  ['minigames', false],\r\n]);\r\n\r\nconst MYSTERIOUS_ICON_SRC = 'img/misc/mysterious.png';\r\nconst HIDDEN_DIALOGUE_TITLE = 'Hidden Dialogue';\r\nconst LOCKED_DIALOGUE_TITLE = 'Locked Dialogue';\r\nconst DEFAULT_MYSTERIOUS_BLURB = 'Hidden Dialogue';\r\nconst DEFAULT_LOCKED_BLURB = 'Locked';\r\nconst DEFAULT_LOCK_MESSAGE = 'Locked Dialogue';\r\nconst DIALOGUE_STATUS_ORDER = { locked: 0, mysterious: 1, unlocked: 2 };\r\nconst FORGE_COMPLETED_KEY_BASE = 'ccc:reset:forge:completed';\r\n\r\nconst HAS_POINTER_EVENTS = typeof window !== 'undefined' && 'PointerEvent' in window;\r\nconst HAS_TOUCH_EVENTS = !HAS_POINTER_EVENTS && typeof window !== 'undefined' && 'ontouchstart' in window;\r\n\r\nfunction bindRapidActivation(target, handler, { once = false } = {}) {\r\n  if (!target || typeof handler !== 'function') return () => {};\r\n  let used = false;\r\n  let pointerTriggered = false;\r\n  let activePointerId = null;\r\n\r\nconst run = (event) => {\r\n  if (once && used) return;\r\n  if (event?.type === 'click' && shouldSkipGhostTap(target)) {\r\n    event.preventDefault?.();\r\n    return;\r\n  }\r\n  markGhostTapTarget(target);\r\n  used = once ? true : used;\r\n  Promise.resolve(handler(event)).catch(() => {});\r\n  if (once) cleanup();\r\n};\r\n\r\n  const resetPointerTrigger = () => {\r\n    pointerTriggered = false;\r\n    activePointerId = null;\r\n  };\r\n\r\n  const onClick = (event) => {\r\n    if (pointerTriggered) {\r\n      resetPointerTrigger();\r\n      return;\r\n    }\r\n    run(event);\r\n  };\r\n\r\nconst onPointerDown = (event) => {\r\n  if (event.pointerType === 'mouse') return;\r\n  if (typeof event.button === 'number' && event.button !== 0) return;\r\n  pointerTriggered = true;\r\n  activePointerId = typeof event.pointerId === 'number' ? event.pointerId : null;\r\n  suppressNextGhostTap(160);\r\n};\r\n\r\n  const onPointerUp = (event) => {\r\n    if (!pointerTriggered) return;\r\n    if (activePointerId != null && typeof event.pointerId === 'number' && event.pointerId !== activePointerId) {\r\n      return;\r\n    }\r\n    resetPointerTrigger();\r\n    run(event);\r\n  };\r\n\r\n  const onPointerCancel = () => {\r\n    if (!pointerTriggered) return;\r\n    resetPointerTrigger();\r\n  };\r\n\r\nconst onTouchStart = (event) => {\r\n  pointerTriggered = true;\r\n  suppressNextGhostTap(160);\r\n};\r\n\r\n  const onTouchEnd = (event) => {\r\n    if (!pointerTriggered) return;\r\n    resetPointerTrigger();\r\n    run(event);\r\n  };\r\n\r\n  const onTouchCancel = () => {\r\n    if (!pointerTriggered) return;\r\n    resetPointerTrigger();\r\n  };\r\n\r\n  const cleanup = () => {\r\n    target.removeEventListener('click', onClick);\r\n    if (HAS_POINTER_EVENTS) {\r\n      target.removeEventListener('pointerdown', onPointerDown);\r\n      window.removeEventListener('pointerup', onPointerUp);\r\n      window.removeEventListener('pointercancel', onPointerCancel);\r\n    } else if (HAS_TOUCH_EVENTS) {\r\n      target.removeEventListener('touchstart', onTouchStart);\r\n      window.removeEventListener('touchend', onTouchEnd);\r\n      window.removeEventListener('touchcancel', onTouchCancel);\r\n    }\r\n  };\r\n\r\n  target.addEventListener('click', onClick);\r\n  if (HAS_POINTER_EVENTS) {\r\n    target.addEventListener('pointerdown', onPointerDown, { passive: false });\r\n    window.addEventListener('pointerup', onPointerUp, { passive: false });\r\n    window.addEventListener('pointercancel', onPointerCancel, { passive: false });\r\n  } else if (HAS_TOUCH_EVENTS) {\r\n    target.addEventListener('touchstart', onTouchStart, { passive: false });\r\n    window.addEventListener('touchend', onTouchEnd, { passive: false });\r\n    window.addEventListener('touchcancel', onTouchCancel, { passive: false });\r\n  }\r\n\r\n  return cleanup;\r\n}\r\n\r\nfunction dialogueStatusRank(status) {\r\n  return DIALOGUE_STATUS_ORDER[status] ?? 0;\r\n}\r\n\r\nfunction snapshotLockDisplay(info) {\r\n  if (!info || typeof info !== 'object') return null;\r\n  return {\r\n    title: info.title ?? null,\r\n    blurb: info.blurb ?? null,\r\n    tooltip: info.tooltip ?? null,\r\n    message: info.message ?? null,\r\n    icon: info.icon ?? null,\r\n    headerTitle: info.headerTitle ?? null,\r\n    ariaLabel: info.ariaLabel ?? null,\r\n  };\r\n}\r\n\r\nfunction buildUnlockedDialogueInfo(meta) {\r\n  return {\r\n    status: 'unlocked',\r\n    unlocked: true,\r\n    title: meta.title,\r\n    blurb: meta.blurb,\r\n    tooltip: '',\r\n    message: '',\r\n    icon: null,\r\n    headerTitle: null,\r\n    ariaLabel: meta.title || 'Merchant dialogue',\r\n  };\r\n}\r\n\r\nlet progressEventsBound = false;\r\nlet merchantDlgWatcherInitialized = false;\r\nlet merchantDlgWatcherSlot = null;\r\nlet merchantDlgWatcherCleanup = null;\r\n\r\nfunction bigNumToSafeInteger(value) {\r\n  if (value && typeof value === 'object') {\r\n    if (typeof value.toPlainIntegerString === 'function') {\r\n      try {\r\n        const plain = value.toPlainIntegerString();\r\n        if (plain != null) {\r\n          const parsed = Number.parseInt(plain, 10);\r\n          if (Number.isFinite(parsed)) return parsed;\r\n        }\r\n      } catch {}\r\n    }\r\n    if (typeof value.toString === 'function') {\r\n      try {\r\n        const str = value.toString();\r\n        if (str != null) {\r\n          const parsed = Number.parseInt(str, 10);\r\n          if (Number.isFinite(parsed)) return parsed;\r\n        }\r\n      } catch {}\r\n    }\r\n  }\r\n\r\n  const numeric = Number(value);\r\n  if (!Number.isFinite(numeric)) return 0;\r\n  if (numeric <= 0) return 0;\r\n  return Math.floor(numeric);\r\n}\r\n\r\nfunction getPlayerProgress() {\r\n  const progress = {\r\n    xpUnlocked: false,\r\n    xpLevel: 0,\r\n    hasForgeReset: false,\r\n  };\r\n\r\n  try {\r\n    progress.xpUnlocked = typeof isXpSystemUnlocked === 'function' && isXpSystemUnlocked();\r\n  } catch {\r\n    progress.xpUnlocked = false;\r\n  }\r\n\r\n  if (progress.xpUnlocked) {\r\n    try {\r\n      const state = typeof getXpState === 'function' ? getXpState() : null;\r\n      if (state && typeof state === 'object') {\r\n        progress.xpLevel = bigNumToSafeInteger(state.xpLevel);\r\n      }\r\n    } catch {\r\n      progress.xpLevel = 0;\r\n    }\r\n  }\r\n  \r\n  try {\r\n    progress.hasForgeReset = typeof hasDoneForgeReset === 'function' && hasDoneForgeReset();\r\n  } catch {\r\n    progress.hasForgeReset = false;\r\n  }\r\n  \r\n  return progress;\r\n}\r\n\r\nfunction resolveDialogueLock(meta, progress) {\r\n  let rawState;\r\n  try {\r\n    rawState = typeof meta.unlock === 'function' ? meta.unlock(progress) : true;\r\n  } catch {\r\n    rawState = false;\r\n  }\r\n\r\n  const rawObj = (rawState && typeof rawState === 'object') ? rawState : null;\r\n  let status = 'locked';\r\n\r\n  if (rawState === true) {\r\n    status = 'unlocked';\r\n  } else if (rawObj) {\r\n    const normalized = String(rawObj.status ?? '').toLowerCase();\r\n    if (normalized === 'unlocked' || rawObj.unlocked === true) {\r\n      status = 'unlocked';\r\n    } else if (normalized === 'mysterious') {\r\n      status = 'mysterious';\r\n    } else {\r\n      status = 'locked';\r\n    }\r\n  } else if (rawState === false || rawState == null) {\r\n    status = 'locked';\r\n  }\r\n\r\n  const info = {\r\n    status,\r\n    unlocked: status === 'unlocked',\r\n    title: status === 'unlocked' ? meta.title : '???',\r\n    blurb: status === 'unlocked'\r\n      ? meta.blurb\r\n      : (status === 'mysterious' ? DEFAULT_MYSTERIOUS_BLURB : DEFAULT_LOCKED_BLURB),\r\n    tooltip: '',\r\n    message: '',\r\n    icon: null,\r\n    headerTitle: null,\r\n    ariaLabel: '',\r\n  };\r\n\r\n  if (status === 'unlocked') {\r\n    info.ariaLabel = meta.title || 'Merchant dialogue';\r\n    return info;\r\n  }\r\n\r\ninfo.title = rawObj?.title ?? '???'\r\ninfo.blurb = rawObj?.requirement\r\n  ?? rawObj?.message\r\n  ?? rawObj?.tooltip\r\n  ?? (status === 'mysterious' ? DEFAULT_MYSTERIOUS_BLURB : DEFAULT_LOCKED_BLURB)\r\ninfo.tooltip = rawObj?.tooltip\r\n  ?? (status === 'locked' ? 'Locked Dialogue' : 'Hidden Dialogue');\r\n\r\ninfo.message = rawObj?.message ?? (status === 'mysterious' ? DEFAULT_LOCK_MESSAGE : '');\r\ninfo.icon = rawObj?.icon ?? (status === 'mysterious' ? MYSTERIOUS_ICON_SRC : null);\r\ninfo.headerTitle = rawObj?.headerTitle ?? (status === 'mysterious' ? HIDDEN_DIALOGUE_TITLE : LOCKED_DIALOGUE_TITLE);\r\ninfo.ariaLabel = rawObj?.ariaLabel ?? (status === 'mysterious'\r\n  ? 'Hidden merchant dialogue'\r\n  : 'Locked merchant dialogue');\r\n\r\n\r\n  return info;\r\n}\r\n\r\nfunction ensureProgressEvents() {\r\n  if (progressEventsBound) return;\r\n  progressEventsBound = true;\r\n\r\n  const handler = onProgressChanged;\r\n\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('xp:change', handler);\r\n    window.addEventListener('xp:unlock', handler);\r\n  }\r\n\r\n  document.addEventListener('ccc:upgrades:changed', handler);\r\n\r\n  const slot = getActiveSlot();\r\n  if (slot != null) {\r\n    const key = `${FORGE_COMPLETED_KEY_BASE}:${slot}`;\r\n    watchStorageKey(key, { onChange: handler });\r\n  }\r\n}\r\n\r\nfunction onProgressChanged() {\r\n  renderDialogueList();\r\n}\r\n\r\nfunction completeDialogueOnce(id, meta) {\r\n  const state = loadDlgState();\r\n  const k = String(id);\r\n  const prev = state[k] || {};\r\n\r\n  if (meta.once && prev.claimed) return false;\r\n\r\n  prev.claimed = true;\r\n  state[k] = prev;\r\n  saveDlgState(state);\r\n\r\n  grantReward(meta.reward);\r\n  return true;\r\n}\r\n\r\n\r\nfunction grantReward(reward) {\r\n  if (!reward) return;\r\n  if (reward.type === 'coins') {\r\n    try { bank.coins.add(reward.amount); } catch (e) {\r\n      console.warn('Failed to grant coin reward:', reward, e);\r\n    }\r\n    return;\r\n  }\r\n  if (reward.type === 'books') {\r\n    try {\r\n      bank.books.addWithMultiplier?.(reward.amount) ?? bank.books.add(reward.amount);\r\n    } catch (e) {\r\n      console.warn('Failed to grant book reward:', reward, e);\r\n    }\r\n    return;\r\n  }\r\n  try { window.dispatchEvent(new CustomEvent('merchantReward', { detail: reward })); } catch {}\r\n}\r\n\r\nfunction rewardLabel(reward) {\r\n  if (!reward) return '';\r\n  if (reward.type === 'coins') return `Reward: ${reward.amount} coins`;\r\n  if (reward.type === 'books') return `Reward: ${reward.amount} Books`;\r\n  return 'Reward available';\r\n}\r\n\r\nexport const DLG_CATALOG = {\r\n  1: {\r\n    title: 'A Generous Gift',\r\n    blurb: 'The Merchant is feeling extra nice today',\r\n    scriptId: 1,\r\n    reward: { type: 'coins', amount: 100 },\r\n    unlock: (progress) => true,\r\n    once: true,\r\n  },\r\n  2: {\r\n    title: 'A New Experience',\r\n    blurb: 'Discuss the XP system with the Merchant',\r\n    scriptId: 2,\r\n    reward: { type: 'books', amount: 5 },\r\n    once: true,\r\n    unlock: (progress) => {\r\n      if (!progress?.xpUnlocked) {\r\n        return {\r\n          status: 'mysterious',\r\n          requirement: 'Unlock the XP system to reveal this dialogue',\r\n          message: 'Unlock the XP system to reveal this dialogue',\r\n          icon: MYSTERIOUS_ICON_SRC,\r\n          headerTitle: HIDDEN_DIALOGUE_TITLE,\r\n          ariaLabel: 'Hidden merchant dialogue. Unlock the XP system to reveal this dialogue',\r\n        };\r\n      }\r\n      return true;\r\n    },\r\n  },\r\n  3: {\r\n    title: 'Edge of Mastery',\r\n    blurb: 'Placeholder musings earned through the Forge.',\r\n    scriptId: 3,\r\n    unlock: (progress) => {\r\n      if (progress?.hasForgeReset) {\r\n        return true;\r\n      }\r\n      if (!progress?.xpUnlocked || (progress?.xpLevel ?? 0) < 31) {\r\n        return {\r\n          status: 'locked',\r\n          title: '???',\r\n          blurb: DEFAULT_LOCKED_BLURB,\r\n          tooltip: 'Locked Dialogue',\r\n          ariaLabel: 'Locked Dialogue.',\r\n        };\r\n      }\r\n      return {\r\n        status: 'mysterious',\r\n        requirement: 'Do a Forge reset to reveal this dialogue',\r\n        message: 'Do a Forge reset to reveal this dialogue',\r\n        icon: MYSTERIOUS_ICON_SRC,\r\n        headerTitle: HIDDEN_DIALOGUE_TITLE,\r\n        ariaLabel: 'Hidden merchant dialogue. Do a Forge reset to reveal this dialogue',\r\n      };\r\n    },\r\n    once: false,\r\n  },\r\n};\r\n\r\nexport function loadDlgState() {\r\n  try { return JSON.parse(localStorage.getItem(sk(MERCHANT_DLG_STATE_KEY_BASE)) || '{}'); } catch { return {}; }\r\n}\r\n\r\nexport function saveDlgState(s) {\r\n  const key = sk(MERCHANT_DLG_STATE_KEY_BASE);\r\n  try {\r\n    const payload = JSON.stringify(s);\r\n    localStorage.setItem(key, payload);\r\n    try { primeStorageWatcherSnapshot(key, payload); } catch {}\r\n  } catch {}\r\n}\r\n\r\nfunction parseDlgStateRaw(raw) {\r\n  if (!raw) return {};\r\n  try { return JSON.parse(raw); } catch { return {}; }\r\n}\r\n\r\nfunction cleanupMerchantDlgStateWatcher() {\r\n  const stop = merchantDlgWatcherCleanup;\r\n  merchantDlgWatcherCleanup = null;\r\n  if (typeof stop === 'function') {\r\n    try { stop(); } catch {}\r\n  }\r\n}\r\n\r\nfunction handleMerchantDlgStateChange(_, meta = {}) {\r\n  if (!meta?.rawChanged) return;\r\n  renderDialogueList();\r\n}\r\n\r\nfunction bindMerchantDlgStateWatcherForSlot(slot) {\r\n  if (slot === merchantDlgWatcherSlot) return;\r\n  cleanupMerchantDlgStateWatcher();\r\n  merchantDlgWatcherSlot = slot ?? null;\r\n  if (slot == null) {\r\n    renderDialogueList();\r\n    return;\r\n  }\r\n  const storageKey = `${MERCHANT_DLG_STATE_KEY_BASE}:${slot}`;\r\n  merchantDlgWatcherCleanup = watchStorageKey(storageKey, {\r\n    parse: parseDlgStateRaw,\r\n    onChange: handleMerchantDlgStateChange,\r\n  });\r\n  try { primeStorageWatcherSnapshot(storageKey); } catch {}\r\n  renderDialogueList();\r\n}\r\n\r\nfunction ensureMerchantDlgStateWatcher() {\r\n  if (merchantDlgWatcherInitialized) {\r\n    bindMerchantDlgStateWatcherForSlot(getActiveSlot());\r\n    return;\r\n  }\r\n  merchantDlgWatcherInitialized = true;\r\n  bindMerchantDlgStateWatcherForSlot(getActiveSlot());\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('saveSlot:change', () => {\r\n      bindMerchantDlgStateWatcherForSlot(getActiveSlot());\r\n    });\r\n  }\r\n}\r\n\r\nensureMerchantDlgStateWatcher();\r\n\r\n// ----- Module state -----\r\nlet merchantOverlayEl = null;\r\nlet merchantSheetEl   = null;\r\nlet merchantCloseBtn  = null;\r\nlet merchantOpen      = false;\r\nlet merchantDrag      = null;\r\nlet merchantLastFocus = null;\r\nlet merchantEventsBound = false;\r\nlet merchantTabs = { buttons: {}, panels: {}, tablist: null };\r\n\r\n// ========================= Typing SFX (WebAudio, zero-latency, mobile volume) =========================\r\nconst TYPING_SFX_SOURCE = ['sounds/merchant_typing.mp3']; // ensure this asset exists\r\n\r\nlet __audioCtx = null;\r\nlet __typingGain = null;\r\nlet __typingBuffer = null;     // decoded buffer (once)\r\nlet __bufferLoadPromise = null;\r\n\r\nlet __typingSfx = null;        // fallback <audio> element\r\nlet __typingSource = null;     // MediaElementSource (once)\r\nlet __bufferSource = null;     // current BufferSource (recreated each start)\r\n\r\nlet __typingSfxPrimed = false;\r\nlet __isTypingActive  = false;\r\n\r\nfunction ensureAudioCtx() {\r\n  if (!__audioCtx) {\r\n    const Ctx = window.AudioContext || window.webkitAudioContext;\r\n    __audioCtx = new Ctx();\r\n  }\r\n  if (!__typingGain) {\r\n    __typingGain = __audioCtx.createGain();\r\n    __typingGain.gain.value = IS_MOBILE ? 0.15 : 0.3;  // mobile quieter\r\n    __typingGain.connect(__audioCtx.destination);\r\n  }\r\n}\r\n\r\nfunction pickSupportedSrc() { return TYPING_SFX_SOURCE[0]; }\r\n\r\nasync function loadTypingBuffer() {\r\n  ensureAudioCtx();\r\n  if (__typingBuffer) return __typingBuffer;\r\n  if (__bufferLoadPromise) return __bufferLoadPromise;\r\n\r\n  const url = pickSupportedSrc();\r\n  __bufferLoadPromise = (async () => {\r\n    const res = await fetch(url, { cache: 'force-cache' });\r\n    const arr = await res.arrayBuffer();\r\n    return await __audioCtx.decodeAudioData(arr);\r\n  })()\r\n  .then(buf => (__typingBuffer = buf))\r\n  .catch(err => { console.warn('Typing SFX decode failed:', err); __bufferLoadPromise = null; });\r\n\r\n  return __bufferLoadPromise;\r\n}\r\n\r\nfunction ensureTypingAudioElement() {\r\n  if (__typingSfx) return __typingSfx;\r\n  const a = new Audio();\r\n  a.loop = true;\r\n  a.preload = 'auto';\r\n  a.muted = false;\r\n  a.volume = 1.0; // iOS ignores this; gain node controls volume\r\n\r\n  const url = pickSupportedSrc();\r\n  a.src = url;\r\n\r\n  __typingSfx = a;\r\n  return a;\r\n}\r\n\r\nfunction ensureElementGraph() {\r\n  ensureAudioCtx();\r\n  ensureTypingAudioElement();\r\n  if (!__typingSource) {\r\n    __typingSource = __audioCtx.createMediaElementSource(__typingSfx);\r\n    __typingSource.connect(__typingGain);\r\n  }\r\n}\r\n\r\nexport function setTypingGainForDevice() {\r\n  if (!__typingGain) return;\r\n  __typingGain.gain.value = IS_MOBILE ? 0.15 : 0.3;\r\n}\r\n\r\n// Prime from a user gesture \u2014 silent, no AbortError spam\r\nexport function primeTypingSfx() {\r\n  if (__typingSfxPrimed) return;\r\n  __typingSfxPrimed = true;\r\n\r\n  ensureAudioCtx();\r\n  __audioCtx.resume().catch(()=>{});\r\n\r\n  // Kick off buffer decode early\r\n  loadTypingBuffer();\r\n\r\n  // Satisfy autoplay policies silently via element path\r\n  const a = ensureTypingAudioElement();\r\n  ensureElementGraph();\r\n\r\n  const prevLoop = a.loop;\r\n  const prevMuted = a.muted;\r\n  a.loop = false;\r\n  a.muted = true;\r\n\r\n  a.play()\r\n    .then(() => { a.pause(); a.currentTime = 0; })\r\n    .catch((err) => {\r\n      if (err.name !== 'AbortError') {\r\n        console.warn('Typing SFX prime error:', err);\r\n        __typingSfxPrimed = false;\r\n      }\r\n    })\r\n    .finally(() => { a.loop = prevLoop; a.muted = prevMuted; });\r\n}\r\n\r\nasync function startTypingSfx() {\r\n  ensureAudioCtx();\r\n  await __audioCtx.resume().catch(()=>{});\r\n\r\n  await loadTypingBuffer();\r\n\r\n  // Prefer zero-latency buffer path\r\n  if (__isTypingActive && __typingBuffer) {\r\n    if (__bufferSource) {\r\n      try { __bufferSource.stop(0); } catch {}\r\n      try { __bufferSource.disconnect(); } catch {}\r\n      __bufferSource = null;\r\n    }\r\n    __bufferSource = __audioCtx.createBufferSource();\r\n    __bufferSource.buffer = __typingBuffer;\r\n    __bufferSource.loop = true;\r\n    __bufferSource.connect(__typingGain);\r\n    __bufferSource.start(0);\r\n    return;\r\n  }\r\n\r\n  // Fallback element path (rare first-line race)\r\n  ensureElementGraph();\r\n  if (__isTypingActive && __typingSfx) {\r\n    __typingSfx.currentTime = 0;\r\n    try { await __typingSfx.play(); }\r\n    catch {\r\n      const once = () => { if (__isTypingActive) __typingSfx.play().catch(()=>{}); document.removeEventListener('click', once); };\r\n      document.addEventListener('click', once, { once: true });\r\n    }\r\n  }\r\n}\r\n\r\nfunction stopTypingSfx() {\r\n  if (__bufferSource) {\r\n    try { __bufferSource.stop(0); } catch {}\r\n    try { __bufferSource.disconnect(); } catch {}\r\n    __bufferSource = null;\r\n  }\r\n  if (__typingSfx) {\r\n    __typingSfx.pause();\r\n    __typingSfx.currentTime = 0;\r\n  }\r\n}\r\n\r\n// Keep gain correct if device/orientation changes\r\nwindow.matchMedia?.('(any-pointer: coarse)')?.addEventListener?.('change', setTypingGainForDevice);\r\nwindow.addEventListener('orientationchange', setTypingGainForDevice);\r\n\r\n// ========================= Typewriter =========================\r\nfunction typeText(el, full, msPerChar = 22, skipTargets = []) {\r\n  return new Promise((resolve) => {\r\n    let i = 0, skipping = false;\r\n    let armed = false;\r\n\r\n    __isTypingActive = true;\r\n    startTypingSfx();\r\n\r\n    const skip = (e) => { if (!armed) return; e.preventDefault(); skipping = true; };\r\n    const onKey = (e) => { if (!armed) return; if (e.key === 'Enter' || e.key === ' ') skipping = true; };\r\n\r\n    const targets = skipTargets.length ? skipTargets : [el];\r\n\r\n    requestAnimationFrame(() => {\r\n      armed = true;\r\n      targets.forEach(t => t.addEventListener('click', skip, { once: true }));\r\n      document.addEventListener('keydown', onKey, { once: true });\r\n    });\r\n\r\n    el.classList.add('is-typing');\r\n    el.textContent = '';\r\n\r\n    const cleanup = () => {\r\n      targets.forEach(t => t.removeEventListener('click', skip));\r\n      document.removeEventListener('keydown', onKey);\r\n      el.classList.remove('is-typing');\r\n      stopTypingSfx();\r\n      __isTypingActive = false;\r\n    };\r\n\r\n    const tick = () => {\r\n      if (skipping) { el.textContent = full; cleanup(); resolve(); return; }\r\n      el.textContent = full.slice(0, i++);\r\n      if (i <= full.length) setTimeout(tick, msPerChar);\r\n      else { cleanup(); resolve(); }\r\n    };\r\n    tick();\r\n  });\r\n}\r\n\r\n// ========================= DialogueEngine =========================\r\nclass DialogueEngine {\r\n  constructor({ textEl, choicesEl, skipTargets, onEnd }) {\r\n    this.textEl = textEl;\r\n    this.choicesEl = choicesEl;\r\n    this.skipTargets = skipTargets;\r\n    this.onEnd = onEnd || (() => {});\r\n    this.nodes = {};\r\n    this.current = null;\r\n\r\n    this.deferNextChoices = false;\r\n    this._reservedH = 0;\r\n  }\r\n\r\n  load(script) {\r\n    this.nodes = script.nodes || {};\r\n    this.startId = script.start;\r\n  }\r\n\r\n  async start() {\r\n    if (!this.startId) return;\r\n    await this.goto(this.startId);\r\n  }\r\n\r\n  async goto(id) {\r\n    const node = this.nodes[id];\r\n    if (!node) return;\r\n    this.current = id;\r\n\r\n    if (node.type === 'line') {\r\n      const nextNode = this.nodes[node.next];\r\n\r\n      // Pre-render next choices invisibly to reserve height (unless deferring)\r\n      if (!this.deferNextChoices && nextNode && nextNode.type === 'choice') {\r\n        this._renderChoices(nextNode.options || [], true);\r\n      } else {\r\n        this._hideChoices();\r\n      }\r\n\r\n      await typeText(this.textEl, node.say, node.msPerChar ?? 22, this.skipTargets);\r\n\r\n      if (nextNode && nextNode.type === 'choice') {\r\n        this.current = node.next;\r\n\r\n        if (this.deferNextChoices) {\r\n          this.deferNextChoices = false;\r\n          this._renderChoices(nextNode.options || [], false); // build & reveal now\r\n          this.choicesEl.style.minHeight = '';\r\n          return;\r\n        }\r\n\r\n        this._revealPreparedChoices();\r\n        return;\r\n      }\r\n\r\n      this.choicesEl.style.minHeight = '';\r\n      if (node.next === 'end' || node.end === true) return this.onEnd();\r\n      if (node.next) return this.goto(node.next);\r\n      return;\r\n    }\r\n\r\n    if (node.type === 'choice') {\r\n      this._renderChoices(node.options || [], false);\r\n    }\r\n  }\r\n\r\n  _hideChoices() {\r\n    this.choicesEl.classList.remove('is-visible');\r\n    this._applyInlineChoiceHide();\r\n  }\r\n\r\n  _renderChoices(options, prepare = false) {\r\n    this.choicesEl.innerHTML = '';\r\n    for (const opt of options) {\r\n      const btn = document.createElement('button');\r\n      btn.type = 'button';\r\n      btn.className = 'choice';\r\n      btn.textContent = opt.label;\r\n      bindRapidActivation(btn, async (event) => {\r\n        event?.stopPropagation?.();\r\n        this._reservedH = this.choicesEl.offsetHeight | 0;\r\n        this.choicesEl.style.minHeight = this._reservedH + 'px';\r\n        this._hideChoices();\r\n        this.choicesEl.innerHTML = '';\r\n\r\n        this.deferNextChoices = true;\r\n\r\n        if (opt.to === 'end') {\r\n          return this.onEnd({ noReward: false });\r\n        }\r\n        if (opt.to === 'end_nr') {\r\n          return this.onEnd({ noReward: true });\r\n        }\r\n\r\n        await this.goto(opt.to);\r\n      }, { once: true });\r\n      this.choicesEl.appendChild(btn);\r\n    }\r\n\r\n    if (prepare) {\r\n      this.choicesEl.classList.remove('is-visible');\r\n      this._applyInlineChoiceHide();\r\n      return;\r\n    }\r\n    this._clearInlineChoiceHide();\r\n    requestAnimationFrame(() => this.choicesEl.classList.add('is-visible'));\r\n  }\r\n\r\n  _revealPreparedChoices() {\r\n    this._clearInlineChoiceHide();\r\n    requestAnimationFrame(() => this.choicesEl.classList.add('is-visible'));\r\n  }\r\n\r\n  _applyInlineChoiceHide() {\r\n    this.choicesEl.style.opacity = '0';\r\n    this.choicesEl.style.transform = 'translateY(6px)';\r\n    this.choicesEl.style.pointerEvents = 'none';\r\n  }\r\n\r\n  _clearInlineChoiceHide() {\r\n    this.choicesEl.style.opacity = '';\r\n    this.choicesEl.style.transform = '';\r\n    this.choicesEl.style.pointerEvents = '';\r\n  }\r\n}\r\n\r\nfunction openDialogueLockInfo(lockInfo = {}) {\r\n  if (!merchantOverlayEl) return;\r\n\r\n  primeTypingSfx();\r\n\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'merchant-firstchat merchant-lockinfo';\r\n  overlay.setAttribute('data-dismissible', '1');\r\n  overlay.innerHTML = `\r\n    <div class=\"merchant-firstchat__card\" role=\"dialog\" aria-label=\"${lockInfo.ariaLabel || HIDDEN_DIALOGUE_TITLE}\">\r\n      <div class=\"merchant-firstchat__header\">\r\n        <div class=\"name\"></div>\r\n        <div class=\"rule\" aria-hidden=\"true\"></div>\r\n      </div>\r\n      <div class=\"merchant-firstchat__row merchant-lockinfo__row\">\r\n        <img class=\"merchant-firstchat__icon\" src=\"${lockInfo.icon || MYSTERIOUS_ICON_SRC}\" alt=\"\">\r\n        <div class=\"merchant-firstchat__text merchant-lockinfo__message\"></div>\r\n      </div>\r\n      <div class=\"merchant-firstchat__actions merchant-lockinfo__actions\">\r\n        <button type=\"button\" class=\"merchant-firstchat__continue merchant-lockinfo__close\">Close</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  merchantOverlayEl.appendChild(overlay);\r\n\r\n  const cardEl = overlay.querySelector('.merchant-firstchat__card');\r\n  const nameEl = overlay.querySelector('.merchant-firstchat__header .name');\r\n  const messageEl = overlay.querySelector('.merchant-lockinfo__message');\r\n  const closeBtn = overlay.querySelector('.merchant-lockinfo__close');\r\n\r\n  nameEl.textContent = lockInfo.headerTitle || HIDDEN_DIALOGUE_TITLE;\r\n  messageEl.textContent = lockInfo.message || DEFAULT_LOCK_MESSAGE;\r\n\r\n  requestAnimationFrame(() => overlay.classList.add('is-visible'));\r\n  merchantOverlayEl.classList.add('firstchat-active');\r\n\r\n  let closed = false;\r\n\r\n  const close = () => {\r\n    if (closed) return;\r\n    closed = true;\r\n    overlay.classList.remove('is-visible');\r\n    merchantOverlayEl.classList.remove('firstchat-active');\r\n    stopTypingSfx();\r\n    __isTypingActive = false;\r\n    document.removeEventListener('keydown', onEsc, true);\r\n    setTimeout(() => overlay.remove(), 160);\r\n  };\r\n\r\n  const onEsc = (e) => {\r\n    if (e.key !== 'Escape') return;\r\n    e.preventDefault();\r\n    close();\r\n  };\r\n\r\n  document.addEventListener('keydown', onEsc, true);\r\n\r\noverlay.addEventListener('pointerdown', (e) => {\r\n  if (!cardEl.contains(e.target)) {\r\n    // Don\u2019t arm global ghost guard for background taps \u2014 just shield briefly\r\n    e.preventDefault();\r\n    blockInteraction(160);\r\n    close();\r\n  }\r\n});\r\n\r\nconst doCloseFromBtn = (e) => {\r\n  if (!e || e.pointerType !== 'mouse') blockInteraction(160);\r\n  close();\r\n};\r\n\r\n  bindRapidActivation(closeBtn, () => { doCloseFromBtn(); }, { once: true });\r\n\r\n  closeBtn.focus?.();\r\n}\r\n\r\nfunction openDialogueModal(id, meta) {\r\n  primeTypingSfx();\r\n\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'merchant-firstchat';\r\n  overlay.setAttribute('data-dismissible', '1');\r\n  overlay.innerHTML = `\r\n    <div class=\"merchant-firstchat__card\" role=\"dialog\" aria-label=\"${meta.title}\">\r\n      <div class=\"merchant-firstchat__header\">\r\n        <div class=\"name\">Merchant</div>\r\n        <div class=\"rule\" aria-hidden=\"true\"></div>\r\n      </div>\r\n      <div class=\"merchant-firstchat__row\">\r\n        <img class=\"merchant-firstchat__icon\" src=\"${MERCHANT_ICON_SRC}\" alt=\"\">\r\n        <div class=\"merchant-firstchat__text\">\u2026</div>\r\n      </div>\r\n      <div class=\"merchant-firstchat__choices\"></div>\r\n    </div>\r\n  `;\r\n  merchantOverlayEl.appendChild(overlay);\r\nconst onEscToCancel = (e) => {\r\n  if (e.key !== 'Escape') return;\r\n  if (!overlay.isConnected) return;\r\n  cancelWithoutReward();\r\n};\r\n\r\ndocument.addEventListener('keydown', onEscToCancel, { capture: true });\r\n\r\n\r\n  // fade/blur in (same behavior as first meet)\r\n  requestAnimationFrame(() => overlay.classList.add('is-visible'));\r\n  merchantOverlayEl.classList.add('firstchat-active');\r\n\r\n  // local refs\r\n  const textEl    = overlay.querySelector('.merchant-firstchat__text');\r\n  const rowEl     = overlay.querySelector('.merchant-firstchat__row');\r\n  const cardEl    = overlay.querySelector('.merchant-firstchat__card');\r\n  const choicesEl = overlay.querySelector('.merchant-firstchat__choices');\r\n\r\n  let ended = false;\r\n\r\n  // Close helpers \u2014 end (with reward) vs cancel (no reward)\r\n  const closeModal = () => {\r\n\tdocument.removeEventListener('keydown', onEscToCancel, { capture: true });\r\n    overlay.classList.remove('is-visible');\r\n    merchantOverlayEl.classList.remove('firstchat-active');\r\n    stopTypingSfx();\r\n    __isTypingActive = false;\r\n    // small delay to let fade finish\r\n    setTimeout(() => overlay.remove(), 160);\r\n  };\r\n\r\n  const cancelWithoutReward = () => {\r\n    if (ended) return;\r\n    ended = true;\r\n    closeModal();               // no reward\r\n    renderDialogueList();       // refresh UI state\r\n  };\r\n\r\noverlay.addEventListener('pointerdown', (e) => {\r\n  if (!cardEl.contains(e.target)) {\r\n    e.preventDefault();\r\n    if (e.pointerType !== 'mouse') blockInteraction(160);\r\n    cancelWithoutReward();\r\n  }\r\n});\r\n\r\nconst engine = new DialogueEngine({\r\n  textEl,\r\n  choicesEl,\r\n  skipTargets: [textEl, rowEl, cardEl],\r\n  onEnd: (info) => {\r\n    if (ended) return;\r\n    ended = true;\r\n\r\n    if (info && info.noReward) {\r\n      closeModal();\r\n      renderDialogueList();\r\n      return;\r\n    }\r\n\r\n    completeDialogueOnce(id, meta);\r\n    closeModal();\r\n    renderDialogueList();\r\n  }\r\n});\r\n\r\n  const state = loadDlgState();\r\n  const claimed = !!state[id]?.claimed;\r\n\r\n  const script = structuredClone(MERCHANT_DIALOGUES[meta.scriptId]);\r\n\r\n  if (claimed && script.nodes.m2b && script.nodes.c2a && meta.scriptId === 1) {\r\n    script.nodes.m2b.say = 'I\\'ve already given you Coins, goodbye.';\r\n    script.nodes.c2a.options = [\r\n      { label: 'Goodbye.', to: 'end_nr' },\r\n      { label: 'Goodbye.', to: 'end_nr' },\r\n      { label: 'Goodbye.', to: 'end_nr' },\r\n    ];\r\n  }\r\n\r\n  if (claimed && meta.scriptId === 2 && script.nodes.m2a) {\r\n    script.nodes.m2a.say = 'I\\'ve already given you Books, goodbye.';\r\n\tif (script.nodes.c2a) {\r\n      script.nodes.c2a.options = [\r\n        { label: 'Goodbye.', to: 'end_nr' },\r\n        { label: 'Goodbye.', to: 'end_nr' },\r\n        { label: 'Goodbye.', to: 'end_nr' },\r\n      ];\r\n    }\r\n  }\r\n\r\n  engine.load(script);\r\n  engine.start();\r\n}\r\n\r\n// ========================= Merchant Overlay (Delve) =========================\r\nfunction ensureMerchantScrollbar() {\r\n  const scroller = merchantOverlayEl?.querySelector('.merchant-content');\r\n  if (!scroller || scroller.__customScroll) return;\r\n  if (!merchantSheetEl) return;\r\n\r\n  const bar = document.createElement('div');\r\n  bar.className = 'merchant-scrollbar';\r\n  const thumb = document.createElement('div');\r\n  thumb.className = 'merchant-scrollbar__thumb';\r\n  bar.appendChild(thumb);\r\n  merchantSheetEl.appendChild(bar);\r\n\r\n  const isTouch = window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches;\r\n  const FADE_SCROLL_MS = 150;\r\n  const FADE_DRAG_MS = 120;\r\n  const supportsScrollEnd = 'onscrollend' in window;\r\n  let fadeTimer = null;\r\n\r\n  const syncScrollShadow = () => {\r\n    const hasShadow = (scroller.scrollTop || 0) > 0;\r\n    merchantSheetEl?.classList.toggle('has-scroll-shadow', hasShadow);\r\n  };\r\n\r\n  const updateBounds = () => {\r\n    const grabber = merchantOverlayEl.querySelector('.merchant-grabber');\r\n    const header  = merchantOverlayEl.querySelector('.merchant-header');\r\n    const actions = merchantOverlayEl.querySelector('.merchant-actions');\r\n\r\n    const top = ((grabber?.offsetHeight || 0) + (header?.offsetHeight || 0)) | 0;\r\n    const bottom = (actions?.offsetHeight || 0) | 0;\r\n\r\n    bar.style.top = top + 'px';\r\n    bar.style.bottom = bottom + 'px';\r\n  };\r\n\r\n  const updateThumb = () => {\r\n    const { scrollHeight, clientHeight, scrollTop } = scroller;\r\n    const barH = bar.clientHeight || 1;\r\n\r\n    const visibleRatio = clientHeight / Math.max(1, scrollHeight);\r\n    const thumbH = Math.max(28, Math.round(barH * visibleRatio));\r\n\r\n    const maxScroll = Math.max(1, scrollHeight - clientHeight);\r\n    const range = Math.max(0, barH - thumbH);\r\n    const y = Math.round((scrollTop / maxScroll) * range);\r\n\r\n    thumb.style.height = thumbH + 'px';\r\n    thumb.style.transform = `translateY(${y}px)`;\r\n\r\n    bar.style.display = (scrollHeight <= clientHeight + 1) ? 'none' : '';\r\n  };\r\n\r\n  const updateAll = () => {\r\n    updateBounds();\r\n    updateThumb();\r\n    syncScrollShadow();\r\n  };\r\n\r\n  const showBar = () => {\r\n    if (!isTouch) return;\r\n    merchantSheetEl.classList.add('is-scrolling');\r\n    if (fadeTimer) clearTimeout(fadeTimer);\r\n  };\r\n\r\n  const scheduleHide = (delay) => {\r\n    if (!isTouch) return;\r\n    if (fadeTimer) clearTimeout(fadeTimer);\r\n    fadeTimer = setTimeout(() => {\r\n      merchantSheetEl.classList.remove('is-scrolling');\r\n    }, delay);\r\n  };\r\n\r\n  const onScroll = () => {\r\n    updateThumb();\r\n    syncScrollShadow();\r\n    if (isTouch) showBar();\r\n    if (!supportsScrollEnd) scheduleHide(FADE_SCROLL_MS);\r\n  };\r\n\r\n  const onScrollEnd = () => scheduleHide(FADE_SCROLL_MS);\r\n\r\n  scroller.addEventListener('scroll', onScroll, { passive: true });\r\n  if (supportsScrollEnd) {\r\n    scroller.addEventListener('scrollend', onScrollEnd, { passive: true });\r\n  }\r\n\r\n  const ro = new ResizeObserver(updateAll);\r\n  ro.observe(scroller);\r\n  window.addEventListener('resize', updateAll);\r\n  requestAnimationFrame(updateAll);\r\n\r\n  // ----- Drag thumb to scroll -----\r\n  let dragging = false;\r\n  let dragStartY = 0;\r\n  let startScrollTop = 0;\r\n\r\n  const startDrag = (e) => {\r\n    dragging = true;\r\n    dragStartY = e.clientY;\r\n    startScrollTop = scroller.scrollTop;\r\n    thumb.classList.add('dragging');\r\n    showBar();\r\n    try { thumb.setPointerCapture(e.pointerId); } catch {}\r\n    e.preventDefault();\r\n  };\r\n\r\n  const onDragMove = (e) => {\r\n    if (!dragging) return;\r\n    const barH = bar.clientHeight || 1;\r\n    const thH = thumb.clientHeight || 1;\r\n    const range = Math.max(1, barH - thH);\r\n    const scrollMax = Math.max(1, scroller.scrollHeight - scroller.clientHeight);\r\n    const deltaY = e.clientY - dragStartY;\r\n    const scrollDelta = (deltaY / range) * scrollMax;\r\n    scroller.scrollTop = startScrollTop + scrollDelta;\r\n  };\r\n\r\n  const endDrag = (e) => {\r\n    if (!dragging) return;\r\n    dragging = false;\r\n    thumb.classList.remove('dragging');\r\n    scheduleHide(FADE_DRAG_MS);\r\n    try { thumb.releasePointerCapture(e.pointerId); } catch {}\r\n  };\r\n\r\n  thumb.addEventListener('pointerdown', startDrag);\r\n  window.addEventListener('pointermove', onDragMove, { passive: true });\r\n  window.addEventListener('pointerup', endDrag);\r\n  window.addEventListener('pointercancel', endDrag);\r\n\r\n  // Click track to jump\r\n  bar.addEventListener('pointerdown', (e) => {\r\n    if (e.target === thumb) return;\r\n    const rect = bar.getBoundingClientRect();\r\n    const clickY = e.clientY - rect.top;\r\n\r\n    const barH = bar.clientHeight || 1;\r\n    const thH = thumb.clientHeight || 1;\r\n    const range = Math.max(0, barH - thH);\r\n    const targetY = Math.max(0, Math.min(clickY - thH / 2, range));\r\n\r\n    const scrollMax = Math.max(1, scroller.scrollHeight - scroller.clientHeight);\r\n    scroller.scrollTop = (targetY / Math.max(1, range)) * scrollMax;\r\n\r\n    showBar();\r\n    scheduleHide(FADE_SCROLL_MS);\r\n  });\r\n\r\n  // mark so we don't double-init\r\n  scroller.__customScroll = { bar, thumb, ro, updateAll };\r\n}\r\n\r\nfunction ensureMerchantOverlay() {\r\n  if (merchantOverlayEl) return;\r\n\r\n  merchantOverlayEl = document.createElement('div');\r\n  merchantOverlayEl.className = 'merchant-overlay';\r\n  merchantOverlayEl.id = 'merchant-overlay';\r\n  merchantOverlayEl.setAttribute('inert', '');\r\n\r\n  merchantSheetEl = document.createElement('div');\r\n  merchantSheetEl.className = 'merchant-sheet';\r\n  merchantSheetEl.setAttribute('role', 'dialog');\r\n  merchantSheetEl.setAttribute('aria-modal', 'false');\r\n  merchantSheetEl.setAttribute('aria-label', 'Merchant');\r\n\r\n  const grabber = document.createElement('div');\r\n  grabber.className = 'merchant-grabber';\r\n  grabber.innerHTML = `<div class=\"grab-handle\" aria-hidden=\"true\"></div>`;\r\n\r\n  const header = document.createElement('header');\r\n  header.className = 'merchant-header';\r\n  header.innerHTML = `\r\n    <div class=\"merchant-title\">Merchant</div>\r\n    <div class=\"merchant-line\" aria-hidden=\"true\"></div>\r\n  `;\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'merchant-content';\r\n\r\n  const tabs = document.createElement('div');\r\n  tabs.className = 'merchant-tabs';\r\n  tabs.setAttribute('role', 'tablist');\r\n\r\n  const panelsWrap = document.createElement('div');\r\n  panelsWrap.className = 'merchant-panels';\r\n\r\n  const panelDialogue = document.createElement('section');\r\n  panelDialogue.className = 'merchant-panel is-active';\r\n  panelDialogue.id = 'merchant-panel-dialogue';\r\n\r\n  const panelReset = document.createElement('section');\r\n  panelReset.className = 'merchant-panel';\r\n  panelReset.id = 'merchant-panel-reset';\r\n\r\n  const panelMinigames = document.createElement('section');\r\n  panelMinigames.className = 'merchant-panel';\r\n  panelMinigames.id = 'merchant-panel-minigames';\r\n\r\n  const resetUnlocked = (() => {\r\n    try { return !!isForgeUnlocked?.(); }\r\n    catch { return false; }\r\n  })();\r\n  merchantTabUnlockState.set('reset', resetUnlocked);\r\n\r\n  MERCHANT_TABS_DEF.forEach(def => {\r\n    if (def.key === 'dialogue') merchantTabUnlockState.set('dialogue', true);\r\n    const stored = merchantTabUnlockState.get(def.key);\r\n    const unlocked = stored != null ? stored : !!def.unlocked;\r\n    const btn = document.createElement('button');\r\n    btn.type = 'button';\r\n    btn.className = 'merchant-tab';\r\n    btn.dataset.tab = def.key;\r\n    const lockedLabel = def.lockedLabel || '???';\r\n    btn.textContent = unlocked ? def.label : lockedLabel;\r\n      if (!unlocked) {\r\n        btn.classList.add('is-locked');\r\n        btn.disabled = true;\r\n        btn.title = '???';\r\n      } else {\r\n      btn.title = def.label || 'Tab';\r\n    }\r\n    def.unlocked = unlocked;\r\n    merchantTabUnlockState.set(def.key, unlocked);\r\n    bindRapidActivation(btn, (event) => {\r\n      if (btn.disabled) {\r\n        event?.preventDefault?.();\r\n        return;\r\n      }\r\n      selectMerchantTab(def.key);\r\n    });\r\n\r\n    tabs.appendChild(btn);\r\n    merchantTabs.buttons[def.key] = btn;\r\n  });\r\n\r\n  merchantTabs.panels['dialogue']  = panelDialogue;\r\n  merchantTabs.panels['reset']     = panelReset;\r\n  merchantTabs.panels['minigames'] = panelMinigames;\r\n  merchantTabs.tablist = tabs;\r\n\r\n  panelsWrap.append(panelDialogue, panelReset, panelMinigames);\r\n  content.append(tabs, panelsWrap);\r\n\r\n  try { initResetSystem(); } catch {}\r\n  try { initResetPanel(panelReset); } catch {}\r\n  try { updateResetPanel(); } catch {}\r\n  try {\r\n    if (isForgeUnlocked?.()) {\r\n      unlockMerchantTabs(['reset']);\r\n    }\r\n  } catch {}\r\n\r\n    const actions = document.createElement('div');\r\n    actions.className = 'merchant-actions';\r\n    const closeBtn = document.createElement('button');\r\n    closeBtn.type = 'button';\r\n    closeBtn.className = 'merchant-close';\r\n    closeBtn.textContent = 'Close';\r\n    merchantCloseBtn = closeBtn;\r\n    actions.appendChild(closeBtn);\r\n\r\n  // First-time chat overlay\r\n  const firstChat = document.createElement('div');\r\n  firstChat.className = 'merchant-firstchat merchant-firstchat--initial';\r\n  firstChat.innerHTML = `\r\n    <div class=\"merchant-firstchat__card\" role=\"dialog\" aria-label=\"First chat\">\r\n      <div class=\"merchant-firstchat__header\">\r\n        <div class=\"name\">Merchant</div>\r\n        <div class=\"rule\" aria-hidden=\"true\"></div>\r\n      </div>\r\n      <div class=\"merchant-firstchat__row\">\r\n        <img class=\"merchant-firstchat__icon\" src=\"${MERCHANT_ICON_SRC}\" alt=\"\">\r\n        <div class=\"merchant-firstchat__text\" id=\"merchant-first-line\">\u2026</div>\r\n      </div>\r\n      <div class=\"merchant-firstchat__choices\" id=\"merchant-first-choices\"></div>\r\n    </div>\r\n  `;\r\n\r\n  merchantSheetEl.append(grabber, header, content, actions, firstChat);\r\n  merchantOverlayEl.appendChild(merchantSheetEl);\r\n  document.body.appendChild(merchantOverlayEl);\r\n  initDialogueTab();\r\n  ensureMerchantScrollbar();\r\n\r\n  if (!merchantEventsBound) {\r\n    merchantEventsBound = true;\r\n\r\n    const onCloseClick = () => { closeMerchant(); };\r\n\r\n    bindRapidActivation(closeBtn, onCloseClick, { once: false });\r\n    document.addEventListener('keydown', onKeydownForMerchant);\r\n    grabber.addEventListener('pointerdown', onMerchantDragStart);\r\n    grabber.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });\r\n\r\n    // Allow priming via any pointer in the overlay (mobile-safe)\r\n    merchantOverlayEl.addEventListener('pointerdown', primeTypingSfx, { once: true });\r\n  }\r\n}\r\n\r\n// Called once when Merchant overlay is created\r\nfunction initDialogueTab() {\r\n  const panel = document.getElementById('merchant-panel-dialogue');\r\n  if (!panel || panel.__dlgInit) return;\r\n  panel.__dlgInit = true;\r\n\r\n  const list = document.createElement('div');\r\n  list.className = 'merchant-dialogue-list';\r\n  panel.appendChild(list);\r\n\r\n  panel.__dlgList = list;\r\n  ensureProgressEvents();\r\n  renderDialogueList();\r\n}\r\n\r\nfunction renderDialogueList() {\r\n  const panel = document.getElementById('merchant-panel-dialogue');\r\n  if (!panel) return;\r\n\r\n  const list = panel.__dlgList;\r\n  if (!list) return;\r\n\r\n  const progress = getPlayerProgress();\r\n  const state = loadDlgState();\r\n  let stateDirty = false;\r\n\r\n  list.innerHTML = '';\r\n\r\n  Object.entries(DLG_CATALOG).forEach(([id, meta]) => {\r\n    const entryState = state[id] || {};\r\n    const storedStatus = entryState.status || 'locked';\r\n    const storedRank = dialogueStatusRank(storedStatus);\r\n\r\n    let lockInfo = resolveDialogueLock(meta, progress);\r\n    let status = lockInfo.status;\r\n    let rank = dialogueStatusRank(status);\r\n\r\n    if (rank > storedRank) {\r\n      entryState.status = status;\r\n      if (status === 'mysterious') {\r\n        entryState.lockSnapshot = snapshotLockDisplay(lockInfo);\r\n      } else if (status === 'unlocked') {\r\n        delete entryState.lockSnapshot;\r\n      }\r\n      state[id] = entryState;\r\n      stateDirty = true;\r\n    } else if (rank < storedRank) {\r\n      if (storedStatus === 'unlocked') {\r\n        lockInfo = buildUnlockedDialogueInfo(meta);\r\n        status = 'unlocked';\r\n        rank = dialogueStatusRank(status);\r\n      } else if (storedStatus === 'mysterious') {\r\n        const snapshot = entryState.lockSnapshot || snapshotLockDisplay(lockInfo) || {};\r\n        lockInfo = {\r\n          status: 'mysterious',\r\n          unlocked: false,\r\n          title: snapshot.title ?? lockInfo.title ?? '???',\r\n          blurb: snapshot.blurb ?? lockInfo.blurb ?? DEFAULT_MYSTERIOUS_BLURB,\r\n          tooltip: snapshot.tooltip ?? lockInfo.tooltip ?? 'Hidden Dialogue',\r\n          message: snapshot.message ?? lockInfo.message ?? DEFAULT_LOCK_MESSAGE,\r\n          icon: snapshot.icon ?? lockInfo.icon ?? MYSTERIOUS_ICON_SRC,\r\n          headerTitle: snapshot.headerTitle ?? lockInfo.headerTitle ?? HIDDEN_DIALOGUE_TITLE,\r\n          ariaLabel: snapshot.ariaLabel ?? lockInfo.ariaLabel ?? 'Hidden merchant dialogue',\r\n        };\r\n        status = 'mysterious';\r\n        rank = dialogueStatusRank(status);\r\n      }\r\n    }\r\n\r\n    const unlocked = status === 'unlocked';\r\n    const isMysterious = status === 'mysterious';\r\n    const locked = status === 'locked';\r\n    const claimed = !!entryState.claimed;\r\n    const showComplete = unlocked && !!(meta.once && claimed);\r\n\r\n    const card = document.createElement('button');\r\n    card.type = 'button';\r\n    card.className = 'dlg-card';\r\n    card.dataset.dlgStatus = status;\r\n    card.disabled = !!locked;\r\n\r\n    if (locked) {\r\n      card.classList.add('is-locked');\r\n      card.setAttribute('aria-disabled', 'true');\r\n      card.setAttribute('tabindex', '-1');\r\n    } else {\r\n      card.removeAttribute('aria-disabled');\r\n      card.removeAttribute('tabindex');\r\n    }\r\n\r\n    if (isMysterious) {\r\n      card.classList.add('is-mysterious');\r\n    }\r\n\r\n    const title = document.createElement('div');\r\n    title.className = 'dlg-title';\r\n    title.textContent = unlocked ? meta.title : (lockInfo.title ?? '???');\r\n\r\n    const blurb = document.createElement('div');\r\n    blurb.className = 'dlg-blurb';\r\n    blurb.textContent = unlocked ? meta.blurb : (lockInfo.blurb ?? '');\r\n\r\n    const reward = document.createElement('div');\r\n    reward.className = 'dlg-reward';\r\n    if (unlocked && meta.reward) {\r\n      if (meta.reward.type === 'coins') {\r\n        reward.classList.add('has-reward');\r\n        reward.innerHTML = `\r\n          <span class=\"reward-label\">Reward:</span>\r\n          <span class=\"coin\">\r\n            <span class=\"coin-icon\" aria-hidden=\"true\"></span>\r\n            <span class=\"amt\">${meta.reward.amount}</span>\r\n          </span>\r\n        `;\r\n        reward.setAttribute('aria-label', `Reward: ${meta.reward.amount} coins`);\r\n      } else if (meta.reward.type === 'books') {\r\n        reward.classList.add('has-reward');\r\n        reward.innerHTML = `\r\n          <span class=\"reward-label\">Reward:</span>\r\n          <span class=\"book\">\r\n            <span class=\"book-icon\" aria-hidden=\"true\"></span>\r\n            <span class=\"amt\">${meta.reward.amount}</span>\r\n          </span>\r\n        `;\r\n        reward.setAttribute('aria-label', `Reward: ${meta.reward.amount} Books`);\r\n      } else {\r\n        reward.textContent = rewardLabel(meta.reward);\r\n      }\r\n    } else {\r\n      reward.textContent = '';\r\n    }\r\n\r\n    const ariaLabel = unlocked\r\n      ? `${meta.title}${showComplete ? ' (completed)' : ''}`\r\n      : (lockInfo.ariaLabel || (isMysterious ? 'Hidden merchant dialogue' : 'Locked merchant dialogue'));\r\n    card.setAttribute('aria-label', ariaLabel);\r\n\r\n    if (lockInfo.tooltip) {\r\n      card.title = lockInfo.tooltip;\r\n    } else if (unlocked) {\r\n      card.title = 'Left-click: Start Dialogue';\r\n    } else {\r\n      card.removeAttribute('title');\r\n    }\r\n\r\n    card.append(title, blurb, reward);\r\n\r\n    if (showComplete) {\r\n      card.classList.add('is-complete');\r\n      const again = document.createElement('div');\r\n      again.className = 'dlg-again';\r\n      again.textContent = 'Ask Again?';\r\n      card.classList.add('has-again');\r\n      card.append(again);\r\n    }\r\n\r\n    list.appendChild(card);\r\n\r\n    const handleCardClick = (event) => {\r\n      if (card.classList.contains('is-locked') && !isMysterious) {\r\n        event?.preventDefault?.();\r\n        return;\r\n      }\r\n      if (unlocked) {\r\n        openDialogueModal(id, meta);\r\n      } else if (isMysterious) {\r\n        openDialogueLockInfo(lockInfo);\r\n      }\r\n    };\r\n\r\n    if (unlocked || isMysterious) {\r\n      bindRapidActivation(card, handleCardClick);\r\n    }\r\n  });\r\n\r\n  if (stateDirty) {\r\n    saveDlgState(state);\r\n  }\r\n}\r\n\r\n// Runs a conversation inside the Dialogue tab (not the first-time overlay)\r\nfunction startConversation(id, meta) {\r\n  const panel = document.getElementById('merchant-panel-dialogue');\r\n  if (!panel) return;\r\n\r\n  const textEl = panel.querySelector('.merchant-text');     // from your bubble\r\n  const bubble = panel.querySelector('.merchant-bubble');\r\n  const row = panel;                                        // big tap target\r\n  let choicesEl = panel.querySelector('.merchant-choices');\r\n\r\n  // Ensure blank + hide choices before typing\r\n  choicesEl.classList.remove('is-visible');\r\n  choicesEl.innerHTML = '';\r\n\r\n  const engine = new DialogueEngine({\r\n    textEl,\r\n    choicesEl,\r\n    skipTargets: [textEl, row, bubble],\r\n    onEnd: (info) => {\r\n\t  if (info && info.noReward) {\r\n        textEl.textContent = '\u2026';\r\n        renderDialogueList();\r\n        return;\r\n      }\r\n      completeDialogueOnce(id, meta);\r\n\ttextEl.textContent = '\u2026';\r\n\trenderDialogueList();\r\n\t}\r\n  });\r\n\r\n  const script = MERCHANT_DIALOGUES[meta.scriptId];\r\n  engine.load(script);\r\n  engine.start();\r\n}\r\n\r\nfunction runFirstMeet() {\r\n  const fc = merchantOverlayEl.querySelector('.merchant-firstchat');\r\n  const textEl = fc.querySelector('#merchant-first-line');\r\n  const rowEl  = fc.querySelector('.merchant-firstchat__row');\r\n  const cardEl = fc.querySelector('.merchant-firstchat__card');\r\n  const choicesEl = fc.querySelector('#merchant-first-choices');\r\n\r\n  const engine = new DialogueEngine({\r\n    textEl,\r\n    choicesEl,\r\n    skipTargets: [textEl, rowEl, cardEl],\r\n    onEnd: () => {\r\n      try { localStorage.setItem(sk(MERCHANT_MET_KEY_BASE), '1'); } catch {}\r\n      try { window.dispatchEvent(new Event(MERCHANT_MET_EVENT)); } catch {}\r\n      fc.classList.remove('is-visible');\r\n      merchantOverlayEl.classList.remove('firstchat-active');\r\n    }\r\n  });\r\n\r\n  engine.load(MERCHANT_DIALOGUES[0]);\r\n  engine.start();\r\n}\r\n\r\nfunction resetFirstChatOverlayState() {\r\n  if (!merchantOverlayEl) return;\r\n  const fc = merchantOverlayEl.querySelector('.merchant-firstchat--initial');\r\n  if (!fc) return;\r\n\r\n  fc.classList.remove('is-visible');\r\n\r\n  const textEl = fc.querySelector('#merchant-first-line');\r\n  if (textEl) {\r\n    textEl.classList.remove('is-typing');\r\n    textEl.textContent = '\u2026';\r\n  }\r\n\r\n  const choicesEl = fc.querySelector('#merchant-first-choices');\r\n  if (choicesEl) {\r\n    choicesEl.classList.remove('is-visible');\r\n    choicesEl.style.opacity = '0';\r\n    choicesEl.style.transform = 'translateY(6px)';\r\n    choicesEl.style.pointerEvents = 'none';\r\n    choicesEl.style.minHeight = '';\r\n    choicesEl.innerHTML = '';\r\n  }\r\n\r\n  merchantOverlayEl.classList.remove('firstchat-active');\r\n}\r\n\r\nexport function openMerchant() {\r\n  ensureMerchantOverlay();\r\n  if (merchantOpen) return;\r\n\r\n  const activeEl = document.activeElement;\r\n  if (activeEl instanceof HTMLElement && !merchantOverlayEl.contains(activeEl)) {\r\n    merchantLastFocus = activeEl;\r\n  } else {\r\n    merchantLastFocus = null;\r\n  }\r\n  merchantOpen = true;\r\n\r\n  // Check whether this is the very first time we\u2019re meeting the Merchant\r\n  let met = false;\r\n  try {\r\n    met = localStorage.getItem(sk(MERCHANT_MET_KEY_BASE)) === '1';\r\n  } catch {\r\n    met = false;\r\n  }\r\n\r\n  // For the very first chat, pin the sheet in place (no slide-up animation)\r\n  if (!met) {\r\n    merchantOverlayEl.classList.add('firstchat-instant');\r\n  }\r\n\r\n  // Reset transform and transition\r\n  merchantSheetEl.style.transition = 'none';\r\n  merchantSheetEl.style.transform = '';\r\n  merchantOverlayEl.removeAttribute('inert');\r\n\r\n  // Animate in next frame\r\n  void merchantSheetEl.offsetHeight;\r\n  requestAnimationFrame(() => {\r\n    // Only restore the sheet transition for normal opens\r\n    if (!merchantOverlayEl.classList.contains('firstchat-instant')) {\r\n      merchantSheetEl.style.transition = '';\r\n    }\r\n\r\n    merchantOverlayEl.classList.add('is-open');\r\n    blockInteraction(140);\r\n\r\n    if (merchantCloseBtn && typeof merchantCloseBtn.focus === 'function') {\r\n      try { merchantCloseBtn.focus({ preventScroll: true }); } catch {}\r\n    }\r\n\r\n    // Restore last tab\r\n    let last = 'dialogue';\r\n    try { last = localStorage.getItem(sk(MERCHANT_TAB_KEY_BASE)) || 'dialogue'; } catch {}\r\n    selectMerchantTab(last);\r\n\r\n    // Ensure no orphaned audio\r\n    stopTypingSfx();\r\n\r\n    // First-time chat\r\n    if (!met) {\r\n      const fc = merchantOverlayEl.querySelector('.merchant-firstchat');\r\n      fc?.classList.add('is-visible');\r\n      merchantOverlayEl.classList.add('firstchat-active');\r\n      runFirstMeet();\r\n    }\r\n  });\r\n}\r\n\r\nexport function closeMerchant() {\r\n  if (!merchantOpen) return;\r\n  \r\n  if (IS_MOBILE) {\r\n    try { suppressNextGhostTap(100); } catch {}\r\n    try { blockInteraction(80); } catch {}\r\n  }\r\n\r\n  merchantOpen = false;\r\n  merchantSheetEl.style.transition = '';\r\n  merchantSheetEl.style.transform = '';\r\n  merchantOverlayEl.classList.remove('is-open');\r\n  merchantOverlayEl.classList.remove('firstchat-instant');\r\n  resetFirstChatOverlayState();\r\n\r\n  const activeEl = document.activeElement;\r\n  if (activeEl && merchantOverlayEl.contains(activeEl)) {\r\n    let target = merchantLastFocus;\r\n    if (!target || !target.isConnected) {\r\n      target = document.querySelector('[data-btn=\"shop\"], .btn-shop');\r\n    }\r\n    if (target && typeof target.focus === 'function') {\r\n      try { target.focus({ preventScroll: true }); } catch {}\r\n    }\r\n  }\r\n\r\n  merchantOverlayEl.setAttribute('inert', '');\r\n  merchantLastFocus = null;\r\n  stopTypingSfx();\r\n  __isTypingActive = false;\r\n}\r\n\r\nfunction onKeydownForMerchant(e) {\r\n  if (!merchantOpen) return;\r\n  if (e.key === 'Escape') {\r\n    e.preventDefault();\r\n    closeMerchant();\r\n  }\r\n}\r\n\r\n// Drag to dismiss\r\nfunction onMerchantDragStart(e) {\r\n  if (!merchantOpen) return;\r\n\r\n  const clientY = typeof e.clientY === 'number'\r\n    ? e.clientY\r\n    : (e.touches && e.touches[0] ? e.touches[0].clientY : 0);\r\n\r\n  merchantDrag = {\r\n    startY: clientY,\r\n    lastY: clientY,\r\n    startT: performance.now(),\r\n    moved: 0,\r\n    canceled: false,\r\n  };\r\n\r\n  merchantSheetEl.style.transition = 'none';\r\n\r\n  window.addEventListener('pointermove', onMerchantDragMove, { passive: true });\r\n  window.addEventListener('pointerup', onMerchantDragEnd);\r\n  window.addEventListener('pointercancel', onMerchantDragCancel);\r\n}\r\n\r\nfunction onMerchantDragMove(e) {\r\n  if (!merchantDrag || merchantDrag.canceled) return;\r\n  const y = e.clientY;\r\n  if (typeof y !== 'number') return;\r\n  const dy = Math.max(0, y - merchantDrag.startY);\r\n  merchantDrag.lastY = y;\r\n  merchantDrag.moved = dy;\r\n  merchantSheetEl.style.transform = `translateY(${dy}px)`;\r\n}\r\n\r\nfunction onMerchantDragEnd() {\r\n  if (!merchantDrag || merchantDrag.canceled) { cleanupMerchantDrag(); return; }\r\n  const dt = Math.max(1, performance.now() - merchantDrag.startT);\r\n  const dy = merchantDrag.moved;\r\n  const velocity = dy / dt;\r\n  const shouldClose = (velocity > 0.55 && dy > 40) || dy > 140;\r\n\r\n  if (shouldClose) {\r\n    suppressNextGhostTap(160);\r\n    merchantSheetEl.style.transition = 'transform 140ms ease-out';\r\n    merchantSheetEl.style.transform = 'translateY(100%)';\r\n    setTimeout(() => { closeMerchant(); }, 150);\r\n  } else {\r\n    merchantSheetEl.style.transition = 'transform 180ms ease';\r\n    merchantSheetEl.style.transform = 'translateY(0)';\r\n  }\r\n  cleanupMerchantDrag();\r\n}\r\n\r\nfunction onMerchantDragCancel() {\r\n  if (!merchantDrag) return;\r\n  merchantDrag.canceled = true;\r\n  merchantSheetEl.style.transition = 'transform 180ms ease';\r\n  merchantSheetEl.style.transform = 'translateY(0)';\r\n  cleanupMerchantDrag();\r\n}\r\n\r\nfunction cleanupMerchantDrag() {\r\n  window.removeEventListener('pointermove', onMerchantDragMove);\r\n  window.removeEventListener('pointerup', onMerchantDragEnd);\r\n  window.removeEventListener('pointercancel', onMerchantDragCancel);\r\n  merchantDrag = null;\r\n}\r\n\r\nfunction selectMerchantTab(key) {\r\n  const def = MERCHANT_TABS_DEF.find(t => t.key === key);\r\n  const unlocked = merchantTabUnlockState.get(key);\r\n  if (!def || !unlocked) key = 'dialogue';\r\n\r\n  for (const k in merchantTabs.buttons) {\r\n    merchantTabs.buttons[k].classList.toggle('is-active', k === key);\r\n  }\r\n  for (const k in merchantTabs.panels) {\r\n    merchantTabs.panels[k].classList.toggle('is-active', k === key);\r\n  }\r\n  try { localStorage.setItem(sk(MERCHANT_TAB_KEY_BASE), key); } catch {}\r\n}\r\n\r\nexport function unlockMerchantTabs(keys = []) {\r\n  keys.forEach(key => {\r\n    const def = MERCHANT_TABS_DEF.find(t => t.key === key);\r\n    if (!def) return;\r\n    merchantTabUnlockState.set(key, true);\r\n    def.unlocked = true;\r\n    const btn = merchantTabs.buttons[key];\r\n    if (btn) {\r\n      btn.disabled = false;\r\n      btn.classList.remove('is-locked');\r\n      btn.textContent = def.label;\r\n      btn.title = def.label || 'Tab';\r\n    }\r\n  });\r\n}\r\n\r\n// Expose for other modules that may build UI later\r\nexport { ensureMerchantOverlay };", "// js/ui/shopOverlay.js\r\n\r\nimport { bank, getActiveSlot } from '../util/storage.js';\r\nimport { BigNum } from '../util/bigNum.js';\r\nimport { formatNumber } from '../util/numFormat.js';\r\nimport { IS_MOBILE } from '../main.js';\r\nimport { openMerchant,\r\n    ensureMerchantOverlay,\r\n    primeTypingSfx,\r\n    unlockMerchantTabs,\r\n    hasMetMerchant,\r\n    MERCHANT_MET_EVENT\r\n} from './merchantDelve/dlgTab.js';\r\nimport { takePreloadedAudio } from '../util/audioCache.js';\r\nimport {\r\n  AREA_KEYS,\r\n  UPGRADE_TIES,\r\n  getCurrentAreaKey,\r\n  getUpgradesForArea,\r\n  getLevel,\r\n  getLevelNumber,\r\n  getIconUrl,\r\n  formatMultForUi,\r\n  upgradeUiModel,\r\n  buyOne,\r\n  buyMax,\r\n  buyTowards,\r\n  evaluateBulkPurchase,\r\n  getUpgradeLockState,\r\n  evolveUpgrade,\r\n  HM_EVOLUTION_INTERVAL,\r\n} from '../game/upgrades.js';\r\nimport {\r\n  markGhostTapTarget,\r\n  shouldSkipGhostTap,\r\n  suppressNextGhostTap,\r\n} from '../util/ghostTapGuard.js';\r\n\r\n\r\nlet shopOverlayEl = null;\r\nlet shopSheetEl = null;\r\nlet shopOpen = false;\r\nlet drag = null;\r\nlet eventsBound = false;\r\nlet delveBtnEl = null;\r\nlet updateDelveGlow = null;\r\nlet shopCloseTimer = null;\r\nlet __shopOpenStamp = 0;\r\nlet __shopPostOpenPointer = false;\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.addEventListener('debug:change', (e) => {\r\n    const activeSlot = typeof getActiveSlot === 'function' ? getActiveSlot() : null;\r\n    const targetSlot = e?.detail?.slot ?? activeSlot;\r\n    if (activeSlot != null && targetSlot != null && activeSlot !== targetSlot) return;\r\n    updateShopOverlay(true);\r\n  });\r\n}\r\n\r\nconst ICON_DIR = 'img/';\r\nconst BASE_ICON_SRC_BY_COST = {\r\n  coins: 'img/currencies/coin/coin_base.png',\r\n  books: 'img/currencies/book/book_base.png',\r\n  gold: 'img/currencies/gold/gold_base.png',\r\n};\r\nconst LOCKED_BASE_ICON_SRC = 'img/misc/locked_base.png';\r\nconst MAXED_BASE_OVERLAY_SRC = 'img/misc/maxed.png';\r\nconst CURRENCY_ICON_SRC = {\r\n  coins: 'img/currencies/coin/coin.png',\r\n  books: 'img/currencies/book/book.png',\r\n  gold: 'img/currencies/gold/gold.png',\r\n};\r\n\r\nconst FORGE_UNLOCK_UPGRADE_ID = 7;\r\n\r\nfunction resolveUpgradeId(upgLike) {\r\n  if (!upgLike) return null;\r\n  const rawId = typeof upgLike.id !== 'undefined' ? upgLike.id : upgLike;\r\n  if (typeof rawId === 'number') {\r\n    return Number.isFinite(rawId) ? Math.trunc(rawId) : null;\r\n  }\r\n  if (typeof rawId === 'string') {\r\n    const parsed = Number.parseInt(rawId.trim(), 10);\r\n    return Number.isFinite(parsed) ? parsed : null;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction isForgeUnlockUpgrade(upgLike) {\r\n  return resolveUpgradeId(upgLike) === FORGE_UNLOCK_UPGRADE_ID;\r\n}\r\n\r\nexport function blockInteraction(ms = 140) {\r\n  if (!IS_MOBILE) return;\r\n\r\n  let shield = document.getElementById('ccc-tap-shield');\r\n  if (!shield) {\r\n    shield = document.createElement('div');\r\n    shield.id = 'ccc-tap-shield';\r\n    Object.assign(shield.style, {\r\n      position: 'fixed', inset: '0', zIndex: '2147483647',\r\n      pointerEvents: 'auto', background: 'transparent'\r\n    });\r\n    const eat = (e) => { e.stopPropagation(); e.preventDefault(); };\r\n    ['pointerdown','pointerup','click','touchstart','touchend','mousedown','mouseup']\r\n      .forEach(ev => shield.addEventListener(ev, eat, { capture: true, passive: false }));\r\n  }\r\n  document.body.appendChild(shield);\r\n  clearTimeout(shield.__t);\r\n  shield.__t = setTimeout(() => shield.remove(), ms);\r\n}\r\n\r\nfunction openHmMilestoneDialog(lines) {\r\n  const existing = document.querySelector('.hm-milestones-overlay');\r\n  if (existing) existing.remove();\r\n\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'hm-milestones-overlay';\r\n  overlay.setAttribute('role', 'dialog');\r\n  overlay.setAttribute('aria-modal', 'true');\r\n  overlay.setAttribute('aria-label', 'Milestones');\r\n\r\n  const dialog = document.createElement('div');\r\n  dialog.className = 'hm-milestones-dialog';\r\n\r\n  const title = document.createElement('h3');\r\n  title.className = 'hm-milestones-title';\r\n  title.textContent = 'Milestones';\r\n\r\n  const list = document.createElement('ul');\r\n  list.className = 'hm-milestones-list';\r\n  for (const line of lines) {\r\n    const li = document.createElement('li');\r\n    const text = document.createElement('span');\r\n    text.className = 'hm-milestone-text';\r\n\r\n    if (line && typeof line === 'object') {\r\n      text.textContent = line.text ?? '';\r\n      if (line.achieved) li.classList.add('hm-milestone-achieved');\r\n    } else {\r\n      text.textContent = line;\r\n    }\r\n\r\n    li.appendChild(text);\r\n    list.appendChild(li);\r\n  }\r\n\r\n  const closeBtn = document.createElement('button');\r\n  closeBtn.type = 'button';\r\n  closeBtn.className = 'hm-milestones-close';\r\n  closeBtn.textContent = 'Close';\r\n\r\n  const close = () => {\r\n    overlay.remove();\r\n    document.removeEventListener('keydown', onKeydown);\r\n  };\r\n\r\n  const onKeydown = (event) => {\r\n    if (event.key === 'Escape') {\r\n      event.preventDefault();\r\n      close();\r\n    }\r\n  };\r\n\r\n  overlay.addEventListener('click', (event) => {\r\n    if (event.target === overlay) close();\r\n  });\r\n  closeBtn.addEventListener('click', close);\r\n  document.addEventListener('keydown', onKeydown);\r\n\r\n  dialog.appendChild(title);\r\n  dialog.appendChild(list);\r\n  dialog.appendChild(closeBtn);\r\n  overlay.appendChild(dialog);\r\n  document.body.appendChild(overlay);\r\n\r\n  if (typeof closeBtn.focus === 'function') {\r\n    closeBtn.focus({ preventScroll: true });\r\n  }\r\n}\r\n\r\nfunction stripTags(html) {\r\n  return String(html ?? '').replace(/<[^>]*>/g, '');\r\n}\r\n\r\nconst PURCHASE_SFX_SRC = 'sounds/purchase_upg.mp3';\r\nconst EVOLVE_SFX_SRC = 'sounds/evolve_upg.mp3';\r\nconst MOBILE_PURCHASE_VOLUME = 0.12;\r\nconst DESKTOP_PURCHASE_VOLUME = 0.3;\r\n\r\nfunction createSfxPlayer({ src, mobileVolume, desktopVolume }) {\r\n  let base = null;\r\n  let ac = null;\r\n  let gain = null;\r\n  let buffer = null;\r\n  let bufferPromise = null;\r\n  let bufferPromiseHandled = false;\r\n  let pendingPlays = 0;\r\n\r\n  function ensureBase() {\r\n    if (base) return base;\r\n\r\n    const preloaded = takePreloadedAudio(src);\r\n    const el = preloaded || new Audio(src);\r\n    el.preload = 'auto';\r\n    el.playsInline = true;\r\n    el.crossOrigin = 'anonymous';\r\n    el.load?.();\r\n    base = el;\r\n    return base;\r\n  }\r\n\r\n  function ensureWebAudio() {\r\n    if (!IS_MOBILE) return false;\r\n    const baseAudio = ensureBase();\r\n    if (!baseAudio) return false;\r\n\r\n    if (!('AudioContext' in window || 'webkitAudioContext' in window)) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      ac = ac || new (window.AudioContext || window.webkitAudioContext)();\r\n    } catch (_) {\r\n      ac = null;\r\n      return false;\r\n    }\r\n\r\n    if (!ac) return false;\r\n\r\n    if (ac.state === 'suspended') {\r\n      try { ac.resume(); } catch (_) {}\r\n    }\r\n\r\n    if (!gain) {\r\n      gain = ac.createGain();\r\n      gain.connect(ac.destination);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  function ensureBuffer() {\r\n    if (!ac) return null;\r\n    if (buffer) return buffer;\r\n    if (bufferPromise) return null;\r\n\r\n    const srcUrl = ensureBase()?.currentSrc || src;\r\n\r\n    try {\r\n      bufferPromise = fetch(srcUrl)\r\n        .then((resp) => (resp.ok ? resp.arrayBuffer() : Promise.reject(resp.status)))\r\n        .then((buf) => new Promise((resolve, reject) => {\r\n          let settled = false;\r\n          const onOk = (decoded) => {\r\n            if (settled) return;\r\n            settled = true;\r\n            resolve(decoded);\r\n          };\r\n          const onErr = (err) => {\r\n            if (settled) return;\r\n            settled = true;\r\n            reject(err);\r\n          };\r\n          const ret = ac.decodeAudioData(buf, onOk, onErr);\r\n          if (ret && typeof ret.then === 'function') {\r\n            ret.then(onOk, onErr);\r\n          }\r\n        }))\r\n        .then((decoded) => {\r\n          buffer = decoded;\r\n          bufferPromise = null;\r\n          bufferPromiseHandled = false;\r\n          return decoded;\r\n        })\r\n        .catch(() => {\r\n          bufferPromise = null;\r\n          bufferPromiseHandled = false;\r\n          return null;\r\n        });\r\n      bufferPromiseHandled = false;\r\n    } catch (_) {\r\n      bufferPromise = null;\r\n      bufferPromiseHandled = false;\r\n    }\r\n\r\n    return buffer || null;\r\n  }\r\n\r\n  function playMobileFallback() {\r\n    const baseAudio = ensureBase();\r\n    if (!baseAudio) return;\r\n\r\n    baseAudio.muted = false;\r\n    baseAudio.volume = mobileVolume;\r\n    try { baseAudio.currentTime = 0; } catch (_) {}\r\n    baseAudio.play().catch(() => {});\r\n  }\r\n\r\n  function playMobileWebAudio() {\r\n    if (!ensureWebAudio()) return false;\r\n\r\n    if (!ac || !gain) return false;\r\n\r\n    const playBuffer = (decoded) => {\r\n      if (!decoded) return false;\r\n      try {\r\n        const node = ac.createBufferSource();\r\n        node.buffer = decoded;\r\n        node.connect(gain);\r\n\r\n        const t = ac.currentTime;\r\n        try {\r\n          gain.gain.setValueAtTime(mobileVolume, t);\r\n        } catch (_) {\r\n          gain.gain.value = mobileVolume;\r\n        }\r\n\r\n        node.start();\r\n        return true;\r\n      } catch (_) {\r\n        return false;\r\n      }\r\n    };\r\n\r\n    if (buffer) {\r\n      return playBuffer(buffer);\r\n    }\r\n\r\n    pendingPlays += 1;\r\n\r\n    if (!bufferPromise) {\r\n      ensureBuffer();\r\n    }\r\n\r\n    if (!bufferPromise) {\r\n      const plays = Math.max(1, pendingPlays);\r\n      pendingPlays = 0;\r\n      for (let i = 0; i < plays; i += 1) {\r\n        playMobileFallback();\r\n      }\r\n      return true;\r\n    }\r\n\r\n    if (bufferPromise && !bufferPromiseHandled) {\r\n      bufferPromiseHandled = true;\r\n      bufferPromise.then((decoded) => {\r\n        const plays = Math.max(1, pendingPlays);\r\n        pendingPlays = 0;\r\n\r\n        if (!decoded) {\r\n          for (let i = 0; i < plays; i += 1) {\r\n            playMobileFallback();\r\n          }\r\n          return;\r\n        }\r\n\r\n        for (let i = 0; i < plays; i += 1) {\r\n          if (!playBuffer(decoded)) {\r\n            playMobileFallback();\r\n            break;\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  function playDesktop() {\r\n    const baseAudio = ensureBase();\r\n    if (!baseAudio) return;\r\n\r\n    baseAudio.volume = desktopVolume;\r\n    const a = baseAudio.cloneNode();\r\n    a.volume = desktopVolume;\r\n    a.play().catch(() => {});\r\n  }\r\n\r\n  return {\r\n    play() {\r\n      try {\r\n        if (IS_MOBILE) {\r\n          if (playMobileWebAudio()) return;\r\n          playMobileFallback();\r\n          return;\r\n        }\r\n\r\n        playDesktop();\r\n      } catch {}\r\n    },\r\n  };\r\n}\r\n\r\nconst purchaseSfx = createSfxPlayer({\r\n  src: PURCHASE_SFX_SRC,\r\n  mobileVolume: MOBILE_PURCHASE_VOLUME,\r\n  desktopVolume: DESKTOP_PURCHASE_VOLUME,\r\n});\r\n\r\nconst evolveSfx = createSfxPlayer({\r\n  src: EVOLVE_SFX_SRC,\r\n  mobileVolume: MOBILE_PURCHASE_VOLUME * 2,\r\n  desktopVolume: DESKTOP_PURCHASE_VOLUME * 2,\r\n});\r\n\r\nfunction playPurchaseSfx() {\r\n  purchaseSfx.play();\r\n}\r\n\r\nfunction playEvolveSfx() {\r\n  evolveSfx.play();\r\n}\r\n\r\nfunction currencyIconHTML(type) {\r\n  const src = CURRENCY_ICON_SRC[type] || CURRENCY_ICON_SRC.coins;\r\n  return `<img alt=\"\" src=\"${src}\" class=\"coin-ico\">`;\r\n}\r\n\r\n\r\n// 1\u00D71 transparent PNG (fallback when an icon is missing)\r\nconst TRANSPARENT_PX =\r\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO3x0S8AAAAASUVORK5CYII=';\r\n\r\n// Upgrades registry (minimal for now)\r\nlet upgrades = {};\r\n\r\n// ---------- Custom Scrollbar ----------\r\nfunction ensureCustomScrollbar() {\r\n  const scroller = shopOverlayEl?.querySelector('.shop-scroller');\r\n  if (!scroller || scroller.__customScroll) return;\r\n\r\n  const bar = document.createElement('div');\r\n  bar.className = 'shop-scrollbar';\r\n  const thumb = document.createElement('div');\r\n  thumb.className = 'shop-scrollbar__thumb';\r\n  bar.appendChild(thumb);\r\n  shopSheetEl.appendChild(bar);\r\n\r\n  scroller.__customScroll = { bar, thumb };\r\n\r\n  const isTouch = window.matchMedia('(hover: none) and (pointer: coarse)').matches;\r\n  const FADE_SCROLL_MS = 150;\r\n  const FADE_DRAG_MS = 120;\r\n  const supportsScrollEnd = 'onscrollend' in window;\r\n\r\n  const syncScrollShadow = () => {\r\n    const hasShadow = (scroller.scrollTop || 0) > 0;\r\n    shopSheetEl?.classList.toggle('has-scroll-shadow', hasShadow);\r\n  };\r\n\r\n\r\n  const updateBounds = () => {\r\n    const grab = shopOverlayEl.querySelector('.shop-grabber');\r\n    const header = shopOverlayEl.querySelector('.shop-header');\r\n    const actions = shopOverlayEl.querySelector('.shop-actions');\r\n\r\n    const top = ((grab?.offsetHeight || 0) + (header?.offsetHeight || 0)) | 0;\r\n    const bottom = (actions?.offsetHeight || 0) | 0;\r\n\r\n    bar.style.top = top + 'px';\r\n    bar.style.bottom = bottom + 'px';\r\n  };\r\n\r\n  const updateThumb = () => {\r\n    const { scrollHeight, clientHeight, scrollTop } = scroller;\r\n    const barH = bar.clientHeight;\r\n    const visibleRatio = clientHeight / Math.max(1, scrollHeight);\r\n    const thumbH = Math.max(28, Math.round(barH * visibleRatio));\r\n\r\n    const maxScroll = Math.max(1, scrollHeight - clientHeight);\r\n    const range = Math.max(0, barH - thumbH);\r\n    const y = Math.round((scrollTop / maxScroll) * range);\r\n\r\n    thumb.style.height = thumbH + 'px';\r\n    thumb.style.transform = `translateY(${y}px)`;\r\n    bar.style.display = (scrollHeight <= clientHeight + 1) ? 'none' : '';\r\n  };\r\n\r\n  const updateAll = () => {\r\n    updateBounds();\r\n    updateThumb();\r\n    syncScrollShadow();\r\n  };\r\n\r\n  const showBar = () => {\r\n    if (!isTouch) return;\r\n    shopSheetEl.classList.add('is-scrolling');\r\n    clearTimeout(scroller.__fadeTimer);\r\n  };\r\n  const scheduleHide = (delay) => {\r\n    if (!isTouch) return;\r\n    clearTimeout(scroller.__fadeTimer);\r\n    scroller.__fadeTimer = setTimeout(() => {\r\n      shopSheetEl.classList.remove('is-scrolling');\r\n    }, delay);\r\n  };\r\n\r\n  const onScroll = () => {\r\n    updateThumb();\r\n    syncScrollShadow();\r\n    if (isTouch) showBar();\r\n    if (!supportsScrollEnd) scheduleHide(FADE_SCROLL_MS);\r\n  };\r\n\r\n  const onScrollEnd = () => scheduleHide(FADE_SCROLL_MS);\r\n\r\n  scroller.addEventListener('scroll', onScroll, { passive: true });\r\n  if (supportsScrollEnd) {\r\n    scroller.addEventListener('scrollend', onScrollEnd, { passive: true });\r\n  }\r\n\r\n  const ro = new ResizeObserver(updateAll);\r\n  ro.observe(scroller);\r\n  window.addEventListener('resize', updateAll);\r\n  requestAnimationFrame(updateAll);\r\n\r\n  // --- Drag to scroll ---\r\n  let dragging = false;\r\n  let dragStartY = 0;\r\n  let startScrollTop = 0;\r\n\r\n  const startDrag = (e) => {\r\n    dragging = true;\r\n    dragStartY = e.clientY;\r\n    startScrollTop = scroller.scrollTop;\r\n    thumb.classList.add('dragging');\r\n    showBar();\r\n    try { thumb.setPointerCapture(e.pointerId); } catch {}\r\n    e.preventDefault();\r\n  };\r\n\r\n  const onDragMove = (e) => {\r\n    if (!dragging) return;\r\n    const barH = bar.clientHeight;\r\n    const thH = thumb.clientHeight;\r\n    const range = Math.max(1, barH - thH);\r\n    const scrollMax = Math.max(1, scroller.scrollHeight - scroller.clientHeight);\r\n    const deltaY = e.clientY - dragStartY;\r\n    const scrollDelta = (deltaY / range) * scrollMax;\r\n    scroller.scrollTop = startScrollTop + scrollDelta;\r\n  };\r\n\r\n  const endDrag = (e) => {\r\n    if (!dragging) return;\r\n    dragging = false;\r\n    thumb.classList.remove('dragging');\r\n    scheduleHide(FADE_DRAG_MS);\r\n    try { thumb.releasePointerCapture(e.pointerId); } catch {}\r\n  };\r\n\r\n  thumb.addEventListener('pointerdown', startDrag);\r\n  window.addEventListener('pointermove', onDragMove, { passive: true });\r\n  window.addEventListener('pointerup', endDrag);\r\n  window.addEventListener('pointercancel', endDrag);\r\n\r\n  // --- Click track to jump ---\r\n  bar.addEventListener('pointerdown', (e) => {\r\n    if (e.target === thumb) return;\r\n    const rect = bar.getBoundingClientRect();\r\n    const clickY = e.clientY - rect.top;\r\n\r\n    const barH = bar.clientHeight;\r\n    const thH = thumb.clientHeight;\r\n    const range = Math.max(0, barH - thH);\r\n    const targetY = Math.max(0, Math.min(clickY - thH / 2, range));\r\n\r\n    const scrollMax = Math.max(1, scroller.scrollHeight - scroller.clientHeight);\r\n    scroller.scrollTop = (targetY / Math.max(1, range)) * scrollMax;\r\n\r\n    showBar();\r\n    scheduleHide(FADE_SCROLL_MS);\r\n  });\r\n}\r\n\r\n// ---------- Upgrades ----------\r\nfunction buildUpgradesData() {\r\n  const areaKey = getCurrentAreaKey();\r\n  const defs = getUpgradesForArea(areaKey);\r\n  upgrades = {}; // reset\r\n  for (const def of defs) {\r\n    const lvlBn = getLevel(areaKey, def.id);\r\n    const lvlNum = getLevelNumber(areaKey, def.id);\r\n    const lockState = getUpgradeLockState(areaKey, def.id);\r\n    const icon = lockState.iconOverride ?? getIconUrl(def);\r\n    const title = lockState.titleOverride ?? def.title;\r\n    const desc = lockState.descOverride ?? def.desc;\r\n    const locked = !!lockState.locked;\r\n    const hmReady = (def.upgType === 'HM')\r\n      ? !!upgradeUiModel(areaKey, def.id)?.hmReadyToEvolve\r\n      : false;\r\n    upgrades[def.id] = {\r\n      id: def.id,\r\n      icon,\r\n      title,\r\n      desc,\r\n      level: lvlBn,\r\n      levelNumeric: lvlNum,\r\n      area: def.area,\r\n      meta: def,\r\n      locked,\r\n      lockState,\r\n      useLockedBase: !!lockState.useLockedBase || locked,\r\n      baseIconOverride: def.baseIconOverride || lockState.baseIconOverride || null,\r\n      hmReady,\r\n    };\r\n  }\r\n}\r\n\r\nfunction levelsRemainingToCap(upg, currentLevelBn, currentLevelNumber) {\r\n  if (!upg) return BigNum.fromInt(0);\r\n\r\n  const capBn = upg.lvlCapBn?.clone?.() ?? (Number.isFinite(upg.lvlCap)\r\n    ? BigNum.fromAny(upg.lvlCap)\r\n    : null);\r\n\r\n  if (!capBn) return BigNum.fromInt(0);\r\n  if (capBn.isInfinite?.()) return BigNum.fromAny('Infinity');\r\n\r\n  let lvlBn;\r\n  try {\r\n    lvlBn = currentLevelBn instanceof BigNum\r\n      ? currentLevelBn\r\n      : BigNum.fromAny(currentLevelBn ?? currentLevelNumber ?? 0);\r\n  } catch {\r\n    const fallback = Math.max(0, Math.floor(Number(currentLevelNumber) || 0));\r\n    lvlBn = BigNum.fromInt(fallback);\r\n  }\r\n\r\n  if (lvlBn.isInfinite?.()) return BigNum.fromInt(0);\r\n\r\n  try {\r\n    const capPlain = capBn.toPlainIntegerString?.();\r\n    const lvlPlain = lvlBn.toPlainIntegerString?.();\r\n    if (capPlain === 'Infinity') return BigNum.fromAny('Infinity');\r\n    if (capPlain && lvlPlain && capPlain !== 'Infinity' && lvlPlain !== 'Infinity') {\r\n      const capInt = BigInt(capPlain);\r\n      const lvlInt = BigInt(lvlPlain);\r\n      const delta = capInt - lvlInt;\r\n      if (delta > 0n) {\r\n        return BigNum.fromAny(delta.toString());\r\n      }\r\n      return BigNum.fromInt(0);\r\n    }\r\n  } catch {}\r\n\r\n  const capNumber = Number.isFinite(upg.lvlCap)\r\n    ? Math.max(0, Math.floor(upg.lvlCap))\r\n    : Infinity;\r\n  if (!Number.isFinite(capNumber)) return BigNum.fromAny('Infinity');\r\n\r\n  const lvlNumber = Math.max(0, Math.floor(Number(currentLevelNumber) || 0));\r\n  const room = Math.max(0, capNumber - lvlNumber);\r\n  if (room > 0) {\r\n    try { return BigNum.fromAny(room); }\r\n    catch { return BigNum.fromInt(room | 0); }\r\n  }\r\n\r\n  return BigNum.fromInt(0);\r\n}\r\n\r\nfunction computeAffordableLevels(upg, currentLevelNumeric, currentLevelBn) {\r\n  let lvlBn;\r\n  try {\r\n    lvlBn = currentLevelBn instanceof BigNum\r\n      ? currentLevelBn\r\n      : BigNum.fromAny(currentLevelBn ?? currentLevelNumeric ?? 0);\r\n  } catch {\r\n    const fallback = Math.max(0, Math.floor(Number(currentLevelNumeric) || 0));\r\n    lvlBn = BigNum.fromInt(fallback);\r\n  }\r\n  if (lvlBn.isInfinite?.()) return BigNum.fromInt(0);\r\n\r\n  const lvl = Math.max(0, Math.floor(Number(currentLevelNumeric) || 0));\r\n  const cap = Number.isFinite(upg.lvlCap)\r\n    ? Math.max(0, Math.floor(upg.lvlCap))\r\n    : Infinity;\r\n\r\n  const walletEntry = bank[upg.costType];\r\n  const walletValue = walletEntry?.value;\r\n  const walletBn = walletValue instanceof BigNum\r\n    ? walletValue\r\n    : BigNum.fromAny(walletValue ?? 0);\r\n  if (walletBn.isZero?.()) return BigNum.fromInt(0);\r\n\r\n  if (walletBn.isInfinite?.()) {\r\n    const isHmType = upg?.upgType === 'HM';\r\n    const maxed = Number.isFinite(cap) && lvl >= cap;\r\n    if ((isHmType && !maxed) || !Number.isFinite(cap)) {\r\n      return BigNum.fromAny('Infinity');\r\n    }\r\n    return levelsRemainingToCap(upg, lvlBn, currentLevelNumeric);\r\n  }\r\n\r\n  if (Number.isFinite(cap) && lvl >= cap) return BigNum.fromInt(0);\r\n\r\n  try {\r\n    const nextLvlNum = levelBigNumToNumber(lvlBn.add(BigNum.fromInt(1)));\r\n    const c0 = BigNum.fromAny(upg.costAtLevel(lvl));\r\n    const c1 = BigNum.fromAny(upg.costAtLevel(nextLvlNum));\r\n\r\n    const farProbeLevel = Math.min(\r\n      Number.isFinite(cap) ? cap : lvl + 32,\r\n      lvl + 32\r\n    );\r\n    const cFar = BigNum.fromAny(upg.costAtLevel(farProbeLevel));\r\n\r\n    const isTrulyFlat = c0.cmp(c1) === 0 && c0.cmp(cFar) === 0;\r\n\r\n    if (isTrulyFlat) {\r\n      const remainingBn = levelsRemainingToCap(upg, lvlBn, lvl);\r\n      const room = Number.isFinite(upg.lvlCap)\r\n        ? Math.min(\r\n            Math.max(0, Math.floor(levelBigNumToNumber(remainingBn))),\r\n            Number.MAX_SAFE_INTEGER - 2\r\n          )\r\n        : Number.MAX_SAFE_INTEGER;\r\n\r\n      let lo = 0;\r\n      let hi = Math.max(0, room);\r\n      while (lo < hi) {\r\n        const mid = Math.floor((lo + hi + 1) / 2);\r\n        const midBn = BigNum.fromInt(mid);\r\n        const total = typeof c0.mulBigNumInteger === 'function'\r\n          ? c0.mulBigNumInteger(midBn)\r\n          : BigNum.fromAny(c0 ?? 0).mulBigNumInteger(midBn);\r\n        if (total.cmp(walletBn) <= 0) lo = mid;\r\n        else hi = mid - 1;\r\n      }\r\n      return BigNum.fromInt(lo);\r\n    }\r\n\r\n    const room = Number.isFinite(cap) ? Math.max(0, cap - lvl) : undefined;\r\n    const { count } = evaluateBulkPurchase(upg, lvlBn, walletBn, room, { fastOnly: true });\r\n    return count ?? BigNum.fromInt(0);\r\n    } catch {\r\n  }\r\n\r\n  const room = Number.isFinite(cap) ? Math.max(0, cap - lvl) : undefined;\r\n  const { count } = evaluateBulkPurchase(upg, lvlBn, walletBn, room, { fastOnly: true });\r\n  return count ?? BigNum.fromInt(0);\r\n}\r\n\r\nfunction renderShopGrid() {\r\n  const grid = shopOverlayEl?.querySelector('#shop-grid');\r\n  if (!grid) return;\r\n  grid.innerHTML = '';\r\n\r\n  for (const key in upgrades) {\r\n    const upg = upgrades[key];\r\n\r\n    const btn = document.createElement('button');\r\n    btn.className = 'shop-upgrade';\r\n    btn.setAttribute('data-upgid', upg.id);\r\n    btn.type = 'button';\r\n    btn.setAttribute('role', 'gridcell');\r\n    btn.dataset.upgId = String(upg.id);\r\n\r\n    const locked = !!upg.locked;\r\n    const lockIcon = upg.lockState?.iconOverride;\r\n    const hasMysteriousIcon = typeof lockIcon === 'string' && lockIcon.includes('mysterious');\r\n    const isMysterious = locked && (upg.lockState?.hidden || hasMysteriousIcon);\r\n    const isPlainLocked = locked && !isMysterious;\r\n\r\n    btn.classList.toggle('is-locked', locked);\r\n    btn.classList.toggle('is-locked-plain', isPlainLocked);\r\n    btn.disabled = isPlainLocked;\r\n    if (isPlainLocked) {\r\n      btn.setAttribute('aria-disabled', 'true');\r\n      btn.setAttribute('tabindex', '-1');\r\n    } else {\r\n      btn.removeAttribute('aria-disabled');\r\n      btn.removeAttribute('tabindex');\r\n    }\r\n    btn.dataset.locked = locked ? '1' : '0';\r\n    btn.dataset.lockedPlain = isPlainLocked ? '1' : '0';\r\n    btn.dataset.mysterious = isMysterious ? '1' : '0';\r\n\r\n    const isHM = upg.meta?.upgType === 'HM';\r\n    const evolveReady = isHM && upg.hmReady;\r\n    const levelIsInfinite = isHM && upg.level?.isInfinite?.();\r\n    btn.classList.toggle('hm-evolve-ready', evolveReady);\r\n\r\n    const canPlusBn = locked\r\n      ? BigNum.fromInt(0)\r\n      : computeAffordableLevels(upg.meta, upg.levelNumeric, upg.level);\r\n    const plusBn = canPlusBn instanceof BigNum ? canPlusBn : BigNum.fromAny(canPlusBn);\r\n    const levelHtml = formatNumber(upg.level);\r\n    const levelPlain = stripTags(levelHtml);\r\n    const plusHtml = formatNumber(plusBn);\r\n    const plusPlain = stripTags(plusHtml);\r\n    const hasPlus = !plusBn.isZero?.();\r\n    const rawCap = Number.isFinite(upg.lvlCap)\r\n      ? upg.lvlCap\r\n      : (Number.isFinite(upg.meta?.lvlCap) ? upg.meta.lvlCap : Infinity);\r\n    const capNumber = Number.isFinite(rawCap)\r\n      ? Math.max(0, Math.floor(rawCap))\r\n      : Infinity;\r\n    const levelDigits = Number.parseFloat(String(levelPlain || '').replace(/,/g, ''));\r\n    const levelNumber = Number.isFinite(upg.levelNumeric)\r\n      ? upg.levelNumeric\r\n      : (Number.isFinite(levelDigits) ? levelDigits : NaN);\r\n    const hasFiniteCap = Number.isFinite(capNumber);\r\n    const capReached = evolveReady\r\n      ? false\r\n      : (levelIsInfinite\r\n        ? true\r\n        : (hasFiniteCap && Number.isFinite(levelNumber)\r\n          ? levelNumber >= capNumber\r\n          : false));\r\n    const isBookValueUpgrade = upg.meta?.tie === UPGRADE_TIES.BOOK_VALUE_I;\r\n    const isSingleLevelCap = hasFiniteCap && capNumber === 1;\r\n    const isUnlockUpgrade = !!upg.meta?.unlockUpgrade || (isSingleLevelCap && !isBookValueUpgrade);\r\n    const showUnlockableBadge = !locked && isUnlockUpgrade && !capReached;\r\n    const showUnlockedBadge = !locked && isUnlockUpgrade && !showUnlockableBadge && capReached;\r\n    let badgeHtml;\r\n    let badgePlain;\r\n        let needsTwoLines = false;\r\n    if (locked) {\r\n      badgeHtml = '';\r\n      badgePlain = '';\r\n      const reason = isMysterious ? (upg.lockState?.reason || '').trim() : '';\r\n      const ariaLabel = reason\r\n        ? `${upg.title} (Locked, ${reason})`\r\n        : `${upg.title} (Locked)`;\r\n      btn.setAttribute('aria-label', ariaLabel);\r\n    } else {\r\n  if (showUnlockableBadge || showUnlockedBadge) {\r\n    badgeHtml = showUnlockableBadge ? 'Unlockable' : 'Unlocked';\r\n    badgePlain = badgeHtml;\r\n    btn.setAttribute('aria-label', `${upg.title}, ${badgePlain}`);\r\n  } else {\r\n    const numericLevel = Number.isFinite(upg.levelNumeric) ? upg.levelNumeric : NaN;\r\n    const plainDigits  = String(levelPlain || '').replace(/,/g, '');\r\n    const isInf        = /\u221E|Infinity/i.test(plainDigits);\r\n    const over999      = Number.isFinite(numericLevel)\r\n      ? numericLevel >= 1000\r\n      : (isInf || /^\\d{4,}$/.test(plainDigits));\r\n\r\n    needsTwoLines = hasPlus && over999;\r\n\r\n    if (needsTwoLines) {\r\n      const lvlSpan  = `<span class=\"badge-lvl\">${levelHtml}</span>`;\r\n      const plusSpan = `<span class=\"badge-plus\">(+${plusHtml})</span>`;\r\n      badgeHtml  = `${lvlSpan}${plusSpan}`;\r\n      badgePlain = `${levelPlain} (+${plusPlain})`;\r\n    } else {\r\n      badgeHtml  = hasPlus ? `${levelHtml} (+${plusHtml})` : levelHtml;\r\n      badgePlain = hasPlus ? `${levelPlain} (+${plusPlain})` : levelPlain;\r\n    }\r\n    btn.setAttribute('aria-label', `${upg.title}, level ${badgePlain}`);\r\n  }\r\n}\r\n\r\n        if (locked) {\r\n          btn.title = isMysterious ? 'Hidden Upgrade' : 'Locked Upgrade';\r\n        } else if (upg.meta?.unlockUpgrade) {\r\n          btn.title = 'Left-click: Details \u2022 Right-click: Unlock';\r\n        } else {\r\n          btn.title = 'Left-click: Details \u2022 Right-click: Buy Max';\r\n        }\r\n\r\n    const tile = document.createElement('div');\r\n    tile.className = 'shop-tile';\r\n\r\n    const baseImg = document.createElement('img');\r\n    baseImg.className = 'base';\r\n    const costType = upg.meta?.costType || 'coins';\r\n    const useLockedBase = upg.useLockedBase || locked;\r\n    const fallbackBaseSrc = BASE_ICON_SRC_BY_COST[costType] || BASE_ICON_SRC_BY_COST.coins;\r\n    const resolvedBaseSrc = upg.baseIconOverride || fallbackBaseSrc;\r\n    baseImg.src = useLockedBase\r\n      ? LOCKED_BASE_ICON_SRC\r\n      : resolvedBaseSrc;\r\n    baseImg.alt = '';\r\n\r\n    const iconImg = document.createElement('img');\r\n    iconImg.className = 'icon';\r\n    iconImg.src = upg.icon || TRANSPARENT_PX;\r\n    iconImg.alt = '';\r\n    iconImg.addEventListener('error', () => { iconImg.src = TRANSPARENT_PX; });\r\n\r\n    btn.addEventListener('click', (event) => {\r\n      if (btn.disabled || isPlainLocked) {\r\n        event.preventDefault();\r\n        event.stopImmediatePropagation();\r\n        return;\r\n      }\r\n      if (shouldSkipGhostTap(btn)) {\r\n        event.preventDefault();\r\n        event.stopImmediatePropagation();\r\n        return;\r\n      }\r\n      markGhostTapTarget(btn);\r\n      openUpgradeOverlay(upg.meta);\r\n    });\r\n\r\n    btn.addEventListener('pointerdown', (event) => {\r\n      if (btn.disabled || isPlainLocked) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        event.stopImmediatePropagation?.();\r\n        return;\r\n      }\r\n      if (event.pointerType !== 'mouse') {\r\n        markGhostTapTarget(btn);\r\n      }\r\n    });\r\n\r\n    btn.addEventListener('contextmenu', (e) => {\r\n      if (IS_MOBILE) return;\r\n      if (locked) return;\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      const areaKey = getCurrentAreaKey();\r\n      const { bought } = buyMax(areaKey, upg.id);\r\n      const boughtBn = bought instanceof BigNum ? bought : BigNum.fromAny(bought ?? 0);\r\n      if (!boughtBn.isZero?.()) {\r\n        playPurchaseSfx();\r\n        if (isForgeUnlockUpgrade(upg.meta)) {\r\n          try { unlockMerchantTabs(['reset']); } catch {}\r\n        }\r\n        updateShopOverlay();\r\n      }\r\n    });\r\n\r\n    tile.appendChild(baseImg);\r\n    if (!locked && capReached) {\r\n      const maxedOverlay = document.createElement('img');\r\n      maxedOverlay.className = 'maxed-overlay';\r\n      maxedOverlay.src = MAXED_BASE_OVERLAY_SRC;\r\n      maxedOverlay.alt = '';\r\n      tile.appendChild(maxedOverlay);\r\n    }\r\n    tile.appendChild(iconImg);\r\n\r\n    if (!locked) {\r\n      const badge = document.createElement('span');\r\n      badge.className = 'level-badge';\r\n      if (needsTwoLines) badge.classList.add('two-line');\r\n\r\n      if (badgeHtml === badgePlain) {\r\n        badge.textContent = badgeHtml;\r\n      } else {\r\n        badge.innerHTML = badgeHtml;\r\n      }\r\n      if (hasPlus || showUnlockableBadge) badge.classList.add('can-buy');\r\n      if (capReached) badge.classList.add('is-maxed');\r\n      tile.appendChild(badge);\r\n    }\r\n    btn.appendChild(tile);\r\n    grid.appendChild(btn);\r\n  }\r\n}\r\n\r\n// ---------- Overlay ----------\r\nfunction ensureShopOverlay() {\r\n  if (shopOverlayEl) return;\r\n\r\n  shopOverlayEl = document.createElement('div');\r\n  shopOverlayEl.className = 'shop-overlay';\r\n  shopOverlayEl.id = 'shop-overlay';\r\n\r\n  shopSheetEl = document.createElement('div');\r\n  shopSheetEl.className = 'shop-sheet';\r\n  shopSheetEl.setAttribute('role', 'dialog');\r\n  shopSheetEl.setAttribute('aria-modal', 'false');\r\n  shopSheetEl.setAttribute('aria-label', 'Shop');\r\n\r\n  const grabber = document.createElement('div');\r\n  grabber.className = 'shop-grabber';\r\n  grabber.innerHTML = `<div class=\"grab-handle\" aria-hidden=\"true\"></div>`;\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'shop-content';\r\n\r\n  const header = document.createElement('header');\r\n  header.className = 'shop-header';\r\n  header.innerHTML = `\r\n    <div class=\"shop-title\">Shop</div>\r\n    <div class=\"shop-line\" aria-hidden=\"true\"></div>\r\n  `;\r\n\r\n  const grid = document.createElement('div');\r\n  grid.className = 'shop-grid';\r\n  grid.id = 'shop-grid';\r\n  grid.setAttribute('role', 'grid');\r\n  grid.setAttribute('aria-label', 'Shop Upgrades');\r\n\r\n  const scroller = document.createElement('div');\r\n  scroller.className = 'shop-scroller';\r\n  scroller.appendChild(grid);\r\n\r\n  content.append(header, scroller);\r\n  ensureCustomScrollbar();\r\n\r\n  const actions = document.createElement('div');\r\n  actions.className = 'shop-actions';\r\n\r\n  const closeBtn = document.createElement('button');\r\n  closeBtn.type = 'button';\r\n  closeBtn.className = 'shop-close';\r\n  closeBtn.textContent = 'Close';\r\n  \r\n  const delveBtn = document.createElement('button');\r\n  delveBtn.type = 'button';\r\n  delveBtn.className = 'shop-delve';\r\n  delveBtn.textContent = 'Delve';\r\n\r\n  const openDelveOverlay = () => {\r\n    if (shouldSkipGhostTap(delveBtn)) return;\r\n    markGhostTapTarget(delveBtn);\r\n    primeTypingSfx();\r\n    openMerchant();\r\n  };\r\n\r\n  delveBtn.addEventListener('click', openDelveOverlay);\r\n\r\n  delveBtnEl = delveBtn;\r\n  updateDelveGlow = () => {\r\n    if (!delveBtnEl) return;\r\n    const met = hasMetMerchant();\r\n    delveBtnEl.classList.toggle('is-new', !met);\r\n  };\r\n  updateDelveGlow();\r\n\r\n  actions.appendChild(closeBtn);\r\n  actions.append(delveBtn);\r\n\r\n  shopSheetEl.append(grabber, content, actions);\r\n  shopOverlayEl.appendChild(shopSheetEl);\r\n  document.body.appendChild(shopOverlayEl);\r\n\r\nshopOverlayEl.addEventListener('pointerdown', (e) => {\r\n  if (e.pointerType === 'mouse') return;\r\n  __shopPostOpenPointer = true;\r\n}, { capture: true, passive: true });\r\n\r\nshopOverlayEl.addEventListener('touchstart', () => {\r\n  __shopPostOpenPointer = true;\r\n}, { capture: true, passive: true });\r\n\r\nshopOverlayEl.addEventListener('click', (e) => {\r\n  if (!IS_MOBILE) return;\r\n  if (!__shopPostOpenPointer) {\r\n    e.preventDefault();\r\n    e.stopImmediatePropagation();\r\n    return;\r\n  }\r\n}, { capture: true });\r\n\r\n  updateShopOverlay(true);\r\n\r\n\r\n  if (!eventsBound) {\r\n    eventsBound = true;\r\n\r\nfunction onCloseClick(e) {\r\n  if (IS_MOBILE) {\r\n    blockInteraction(80);\r\n  }\r\n  closeShop();\r\n}\r\n\r\ncloseBtn.addEventListener('click', onCloseClick, { passive: true });\r\n\r\nconst hasPointerEvents = typeof window !== 'undefined' && 'PointerEvent' in window;\r\nif (hasPointerEvents) {\r\n  closeBtn.addEventListener('pointerdown', (e) => {\r\n    if (e.pointerType === 'mouse') return;\r\n    if (typeof e.button === 'number' && e.button !== 0) return;\r\n    // Keep marking for safety, but no global suppression\r\n    markGhostTapTarget(closeBtn);\r\n    blockInteraction(80);\r\n    closeShop();\r\n    e.preventDefault();\r\n  }, { passive: false });\r\n} else {\r\n  closeBtn.addEventListener('touchstart', (e) => {\r\n    markGhostTapTarget(closeBtn);\r\n    blockInteraction(80);\r\n    closeShop();\r\n    e.preventDefault();\r\n  }, { passive: false });\r\n}\r\n\t\r\n    const onDelvePointerDown = (e) => {\r\n      if (e.pointerType === 'mouse') return;\r\n      if (typeof e.button === 'number' && e.button !== 0) return;\r\n      markGhostTapTarget(delveBtn);\r\n      primeTypingSfx();\r\n      openMerchant();\r\n      e.preventDefault();\r\n    };\r\n\r\n    const onDelveTouchStart = (e) => {\r\n      markGhostTapTarget(delveBtn);\r\n      primeTypingSfx();\r\n      openMerchant();\r\n      e.preventDefault();\r\n    };\r\n\r\n    if (hasPointerEvents) {\r\n      delveBtn.addEventListener('pointerdown', onDelvePointerDown, { passive: false });\r\n    } else {\r\n      delveBtn.addEventListener('touchstart', onDelveTouchStart, { passive: false });\r\n    }\r\n\r\n    document.addEventListener('keydown', onKeydownForShop);\r\n    grabber.addEventListener('pointerdown', onDragStart);\r\n    grabber.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });\r\n\r\n    let _shopBadgeTimer = null;\r\n      const scheduleShopRerender = () => {\r\n        if (!shopOpen) return;\r\n        clearTimeout(_shopBadgeTimer);\r\n        _shopBadgeTimer = setTimeout(() => {\r\n          updateShopOverlay();\r\n        }, 60);\r\n      };\r\n\r\n      window.addEventListener('currency:change', scheduleShopRerender);\r\n      window.addEventListener('xp:change', scheduleShopRerender);\r\n      window.addEventListener('xp:unlock', scheduleShopRerender);\r\n\r\n    const onUpgradesChanged = () => {\r\n      if (!shopOpen) return;\r\n      updateShopOverlay();\r\n    };\r\n\r\n    document.addEventListener('ccc:upgrades:changed', onUpgradesChanged);\r\n\r\n    window.addEventListener(MERCHANT_MET_EVENT, () => {\r\n      if (typeof updateDelveGlow === 'function') updateDelveGlow();\r\n      if (shopOpen) updateShopOverlay();\r\n    });\r\n  }\r\n}\r\n\r\n// --- Upgrade Fullscreen Overlay ---\r\nlet upgOverlayEl = null;\r\nlet upgSheetEl = null;\r\nlet upgOpen = false;\r\nlet upgOverlayCleanup = null;\r\n\r\nfunction ensureUpgradeOverlay() {\r\n  if (upgOverlayEl) return;\r\n  upgOverlayEl = document.createElement('div');\r\n  upgOverlayEl.className = 'upg-overlay';\r\n\r\n  upgSheetEl = document.createElement('div');\r\n  upgSheetEl.className = 'upg-sheet';\r\n  upgSheetEl.setAttribute('role', 'dialog');\r\n  upgSheetEl.setAttribute('aria-modal', 'false');\r\n  upgSheetEl.setAttribute('aria-label', 'Upgrade');\r\n\r\n  const grab = document.createElement('div');\r\n  grab.className = 'upg-grabber';\r\n  grab.innerHTML = `<div class=\"grab-handle\" aria-hidden=\"true\"></div>`;\r\n\r\n  const header = document.createElement('header');\r\n  header.className = 'upg-header';\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'upg-content';\r\n\r\n  const actions = document.createElement('div');\r\n  actions.className = 'upg-actions';\r\n\r\n  upgSheetEl.append(grab, header, content, actions);\r\n  upgOverlayEl.appendChild(upgSheetEl);\r\n  document.body.appendChild(upgOverlayEl);\r\n\r\nupgOverlayEl.addEventListener('pointerdown', (e) => {\r\n  if (!IS_MOBILE) return;\r\n  if (e.pointerType === 'mouse') return;\r\n  if (e.target === upgOverlayEl) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n}, true);\r\n\r\nupgOverlayEl.addEventListener('click', (e) => {\r\n  if (!IS_MOBILE) return;\r\n  if (e.target === upgOverlayEl) {\r\n    e.preventDefault();\r\n    e.stopImmediatePropagation();\r\n  }\r\n}, true);\r\n\r\n  let drag = null;\r\n  function onDragStart(e) {\r\n    if (!upgOpen) return;\r\n    const y = typeof e.clientY === 'number' ? e.clientY : (e.touches?.[0]?.clientY || 0);\r\n    drag = { startY: y, lastY: y, moved: 0 };\r\n    upgSheetEl.style.transition = 'none';\r\n    window.addEventListener('pointermove', onDragMove);\r\n    window.addEventListener('pointerup', onDragEnd);\r\n    window.addEventListener('pointercancel', onDragEnd);\r\n  }\r\n  function onDragMove(e) {\r\n    if (!drag) return;\r\n    const y = e.clientY;\r\n    if (typeof y !== 'number') return;\r\n    const dy = Math.max(0, y - drag.startY);\r\n    drag.lastY = y;\r\n    drag.moved = dy;\r\n    upgSheetEl.style.transform = `translateY(${dy}px)`;\r\n  }\r\n  function onDragEnd(e) {\r\n    if (!drag) return;\r\n    const shouldClose = drag.moved > 140;\r\n    upgSheetEl.style.transition = 'transform 160ms ease';\r\n    upgSheetEl.style.transform = shouldClose ? 'translateY(100%)' : 'translateY(0)';\r\n    if (shouldClose) {\r\n      if (IS_MOBILE && (!e || e.pointerType !== 'mouse')) {\r\n        try { blockInteraction(120); } catch {}\r\n      }\r\n      setTimeout(closeUpgradeMenu, 160);\r\n    }\r\n    drag = null;\r\n    window.removeEventListener('pointermove', onDragMove);\r\n    window.removeEventListener('pointerup', onDragEnd);\r\n    window.removeEventListener('pointercancel', onDragEnd);\r\n  }\r\n  grab.addEventListener('pointerdown', onDragStart, { passive: true });\r\n}\r\n\r\nfunction closeUpgradeMenu() {\r\n  if (IS_MOBILE) {\r\n    try { blockInteraction(160); } catch {}\r\n  }\r\n\r\n  if (typeof upgOverlayCleanup === 'function') {\r\n    const fn = upgOverlayCleanup;\r\n    upgOverlayCleanup = null;\r\n    try { fn(); } catch {}\r\n  }\r\n\r\n  upgOpen = false;\r\n  if (!upgOverlayEl || !upgSheetEl) return;\r\n  upgSheetEl.style.transition = '';\r\n  upgSheetEl.style.transform = '';\r\n  upgOverlayEl.classList.remove('is-open');\r\n  upgOverlayEl.style.pointerEvents = 'none';\r\n}\r\n\r\nfunction formatMult(value) {\r\n  if (value instanceof BigNum) return `${formatNumber(value)}x`;\r\n\r\n  const asNum = Number(value);\r\n  if (Number.isFinite(asNum)) {\r\n    return formatFourDigitsFloorNumber(asNum) + 'x';\r\n  }\r\n\r\n  try {\r\n    const bn = BigNum.fromAny(value);\r\n    return `${formatNumber(bn)}x`;\r\n  } catch {\r\n    return '0x';\r\n  }\r\n}\r\n\r\nfunction formatFourDigitsFloorNumber(v) {\r\n  const abs = Math.abs(v);\r\n\r\n  if (abs >= 10000) {\r\n    return formatNumber(BigNum.fromAny(v));\r\n  }\r\n\r\n  const intDigits = abs >= 1 ? Math.floor(abs).toString().length : 0;\r\n  const decimals = Math.max(0, 4 - intDigits);\r\n\r\n  const groupThousands = (s) => {\r\n    let sign = '';\r\n    if (s.startsWith('-')) { sign = '-'; s = s.slice(1); }\r\n    return sign + s.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n  };\r\n\r\n  if (decimals === 0) {\r\n    const floored = (v >= 0) ? Math.floor(v) : Math.ceil(v);\r\n    let s = String(floored);\r\n    if (Math.abs(floored) >= 1000) s = groupThousands(s);\r\n    return s;\r\n  }\r\n\r\n  const factor = Math.pow(10, decimals);\r\n  const floored = (v >= 0)\r\n    ? Math.floor(v * factor) / factor\r\n    : Math.ceil(v * factor) / factor;\r\n\r\n  let s = floored.toFixed(decimals);\r\n  let [i, f = ''] = s.split('.');\r\n  if (Math.abs(floored) >= 1000) i = groupThousands(i);\r\n  f = f.replace(/0+$/, '');\r\n  return f ? `${i}.${f}` : i;\r\n}\r\n\r\nexport function openUpgradeOverlay(upgDef) {\r\n  ensureUpgradeOverlay();\r\n  upgOpen = true;\r\n  let upgOpenLocal = true;\r\n\r\n  const areaKey = getCurrentAreaKey();\r\n  const initialLockState = getUpgradeLockState(areaKey, upgDef.id) || {};\r\n  const initialLocked = !!initialLockState.locked;\r\n  const initialMysterious = initialLocked && (\r\n    initialLockState.hidden ||\r\n    initialLockState.hideEffect ||\r\n    initialLockState.hideCost ||\r\n    (typeof initialLockState.iconOverride === 'string' &&\r\n      initialLockState.iconOverride.includes('mysterious'))\r\n  );\r\n  if (initialLocked && !initialMysterious) {\r\n    upgOpen = false;\r\n    return;\r\n  }\r\n\r\n  const isHM = (upgDef.upgType === 'HM');\r\n  const isEndlessXp = (upgDef.tie === UPGRADE_TIES.ENDLESS_XP);\r\n  const ui = () => upgradeUiModel(areaKey, upgDef.id);\r\n\r\n  // small helpers\r\n  const spacer = (h) => { const s = document.createElement('div'); s.style.height = h; return s; };\r\n  const makeLine = (html) => { const d = document.createElement('div'); d.className = 'upg-line'; d.innerHTML = html; return d; };\r\n\r\n    function recenterUnlockOverlayIfNeeded(model) {\r\n    const content = upgSheetEl.querySelector('.upg-content');\r\n    if (!content) return;\r\n\r\n    // Check current lock state so we can skip hidden/mysterious sheets\r\n    const lockState = model?.lockState || getUpgradeLockState(areaKey, upgDef.id) || {};\r\n    const isHiddenUpgrade = !!(\r\n      lockState.hidden ||\r\n      lockState.hideEffect ||\r\n      lockState.hideCost\r\n    );\r\n\r\n    // Only do special layout for *visible* unlock-type upgrades.\r\n    // Hidden upgrades should use the normal hidden layout.\r\n    if (!model || !model.unlockUpgrade || isHiddenUpgrade) {\r\n      content.style.marginTop = '';\r\n      return;\r\n    }\r\n\r\n    const header  = upgSheetEl.querySelector('.upg-header');\r\n    const actions = upgSheetEl.querySelector('.upg-actions');\r\n    if (!header || !actions) return;\r\n\r\n    // Reset first so measurements are clean\r\n    content.style.marginTop = '';\r\n\r\n    const headerRect  = header.getBoundingClientRect();\r\n    const actionsRect = actions.getBoundingClientRect();\r\n    const contentRect = content.getBoundingClientRect();\r\n\r\n    const available = actionsRect.top - headerRect.bottom;\r\n    const freeSpace = available - contentRect.height;\r\n    if (freeSpace <= 0) return;\r\n\r\n    const BIAS = 0.42;\r\n    const topOffset = freeSpace * BIAS;\r\n\r\n    content.style.marginTop = `${topOffset}px`;\r\n  }\r\n\r\n  const rerender = () => {\r\n    const model = ui();\r\n    if (!model) return;\r\n\r\n    const lockState = model.lockState || getUpgradeLockState(areaKey, upgDef.id);\r\n    const locked = !!lockState?.locked;\r\n    const isHiddenUpgrade = locked && (\r\n      lockState?.hidden || lockState?.hideEffect || lockState?.hideCost\r\n    );\r\n    const lockHidden = locked && isHiddenUpgrade;\r\n\r\n    const isUnlockVisible = !!model.unlockUpgrade && !lockHidden;\r\n\r\n    upgSheetEl.classList.toggle('is-locked-hidden', lockHidden);\r\n\r\n    const header = upgSheetEl.querySelector('.upg-header');\r\n    header.innerHTML = '';\r\n\r\n    const title = document.createElement('div');\r\n    title.className = 'upg-title';\r\n    title.textContent = model.displayTitle || model.upg.title;\r\n\r\n    const evolveReady = !!model.hmReadyToEvolve;\r\n    const capReached = evolveReady\r\n      ? false\r\n      : (model.lvlBn?.isInfinite?.()\r\n        ? true\r\n        : (Number.isFinite(model.upg.lvlCap)\r\n          ? model.lvl >= model.upg.lvlCap\r\n          : false));\r\n    const level = document.createElement('div');\r\n    level.className = 'upg-level';\r\n    const capHtml = model.lvlCapFmtHtml ?? model.upg.lvlCapFmtHtml ?? formatNumber(model.lvlCapBn);\r\n    const capPlain = model.lvlCapFmtText ?? model.upg.lvlCapFmtText ?? stripTags(capHtml);\r\n    const levelHtml = evolveReady\r\n      ? `Level ${model.lvlFmtHtml} / ${capHtml} (EVOLVE READY)`\r\n      : (capReached\r\n        ? `Level ${model.lvlFmtHtml} / ${capHtml} (MAXED)`\r\n        : `Level ${model.lvlFmtHtml} / ${capHtml}`);\r\n    const levelPlain = evolveReady\r\n      ? `Level ${model.lvlFmtText} / ${capPlain} (EVOLVE READY)`\r\n      : (capReached\r\n        ? `Level ${model.lvlFmtText} / ${capPlain} (MAXED)`\r\n        : `Level ${model.lvlFmtText} / ${capPlain}`);\r\n    level.innerHTML = levelHtml;\r\n    level.setAttribute('aria-label', levelPlain);\r\n    if (isHiddenUpgrade) {\r\n      level.hidden = true;\r\n    } else {\r\n      level.hidden = false;\r\n      level.removeAttribute('aria-hidden');\r\n    }\r\n\r\n    upgSheetEl.classList.toggle('is-maxed', capReached);\r\n    upgSheetEl.classList.toggle('hm-evolve-ready', evolveReady);\r\n    upgSheetEl.classList.toggle('is-unlock-upgrade', isUnlockVisible);\r\n    header.append(title, level);\r\n\r\n    const content = upgSheetEl.querySelector('.upg-content');\r\n    content.innerHTML = '';\r\n    content.scrollTop = 0;\r\n    upgSheetEl.classList.toggle('is-hm-upgrade', isHM);\r\n    upgSheetEl.classList.toggle('is-endless-xp', isEndlessXp);\r\n\r\n    const desc = document.createElement('div');\r\n    desc.className = 'upg-desc centered';\r\n    if (lockHidden) desc.classList.add('lock-desc');\r\n    const baseDesc = (model.displayDesc || model.upg.desc || '').trim();\r\n    if (evolveReady) {\r\n      desc.classList.add('hm-evolve-note');\r\n      desc.textContent = 'Evolve this upgrade to multiply its effect by 1000x';\r\n    } else if (baseDesc) {\r\n      desc.textContent = baseDesc;\r\n    } else {\r\n      desc.hidden = true;\r\n    }\r\n    content.appendChild(desc);\r\n\r\n    const info = document.createElement('div');\r\n    info.className = 'upg-info';\r\n\r\n    info.appendChild(spacer('12px'));\r\n    if (locked && lockState?.reason && !isHiddenUpgrade) {\r\n      const descText = (model.displayDesc || '').trim();\r\n      const reasonText = String(lockState.reason ?? '').trim();\r\n      const isDuplicateNote = descText && descText === reasonText;\r\n      if (!isDuplicateNote) {\r\n        const note = document.createElement('div');\r\n        note.className = 'upg-line lock-note';\r\n        note.textContent = lockState.reason;\r\n        info.appendChild(note);\r\n        info.appendChild(spacer('12px'));\r\n      }\r\n    }\r\n    if (model.effect && !(locked && lockState?.hideEffect)) {\r\n      const effectText = model.effect;\r\n      info.appendChild(makeLine(`<span class=\"bonus-line\">${effectText}</span>`));\r\n      info.appendChild(spacer('12px'));\r\n    }\r\n\r\n    // dynamic currency icon based on costType\r\n    const iconHTML    = currencyIconHTML(model.upg.costType);\r\n    const nextPriceBn = model.nextPrice instanceof BigNum\r\n      ? model.nextPrice\r\n      : BigNum.fromAny(model.nextPrice || 0);\r\n\r\n    // costs only if not capped and not an unlock-type\r\n    const stopBuying = capReached || evolveReady;\r\n    if (!model.unlockUpgrade && !stopBuying && (!locked || !lockState?.hideCost)) {\r\n      const costs = document.createElement('div');\r\n      costs.className = 'upg-costs';\r\n\r\n      const lineCost = document.createElement('div');\r\n      lineCost.className = 'upg-line';\r\n      lineCost.innerHTML = `Cost: ${iconHTML} ${bank[model.upg.costType].fmt(nextPriceBn)}`;\r\n      costs.appendChild(lineCost);\r\n\r\n      if (isHM) {\r\n        const lineMilestone = document.createElement('div');\r\n        lineMilestone.className = 'upg-line';\r\n        let milestoneCost = '\u2014';\r\n        try {\r\n          if (model.hmNextMilestone && model.hmNextMilestone.cmp(model.lvlBn) > 0) {\r\n            const deltaBn = model.hmNextMilestone.sub(model.lvlBn);\r\n            const deltaPlain = deltaBn.toPlainIntegerString?.();\r\n            const deltaNum = Math.max(\r\n              0,\r\n              Math.floor(Number(deltaPlain && deltaPlain !== 'Infinity' ? deltaPlain : Number(deltaBn.toString() || 0)))\r\n            );\r\n            const { spent } = evaluateBulkPurchase(\r\n              model.upg,\r\n              model.lvlBn,\r\n              BigNum.fromAny('Infinity'),\r\n              deltaNum,\r\n            );\r\n            milestoneCost = bank[model.upg.costType].fmt(spent);\r\n          }\r\n        } catch {}\r\n        lineMilestone.innerHTML = `Cost to next milestone: ${iconHTML} ${milestoneCost}`;\r\n        costs.appendChild(lineMilestone);\r\n      }\r\n\r\n      const lineHave = document.createElement('div');\r\n      lineHave.className = 'upg-line';\r\n      lineHave.innerHTML = `You have: ${iconHTML} ${bank[model.upg.costType].fmt(model.have)}`;\r\n      costs.appendChild(lineHave);\r\n\r\n      info.appendChild(costs);\r\n    }\r\n\r\n    content.appendChild(info);\r\n\r\n    if (isHM) {\r\n      const milestonesRow = document.createElement('div');\r\n      milestonesRow.className = 'hm-view-milestones-row';\r\n      const viewMilestonesBtn = document.createElement('button');\r\n      viewMilestonesBtn.type = 'button';\r\n      viewMilestonesBtn.className = 'shop-delve hm-view-milestones';\r\n      viewMilestonesBtn.textContent = 'View Milestones';\r\n      viewMilestonesBtn.addEventListener('click', () => {\r\n        const milestones = Array.isArray(model.hmMilestones) ? model.hmMilestones : [];\r\n        if (!milestones.length) return;\r\n        const evolutions = Math.max(0, Math.floor(Number(model.hmEvolutions ?? 0)));\r\n        const evolutionOffset = (() => {\r\n          try { return BigInt(HM_EVOLUTION_INTERVAL) * BigInt(evolutions); }\r\n          catch { return 0n; }\r\n        })();\r\n        const formatMilestoneLevel = (levelBn) => {\r\n          if (model.lvlBn?.isInfinite?.()) return 'Infinity';\r\n          try {\r\n            const plain = levelBn?.toPlainIntegerString?.();\r\n            if (plain && plain !== 'Infinity') {\r\n              if (plain.length <= 15) {\r\n                const asNum = Number(plain);\r\n                if (Number.isFinite(asNum)) return asNum.toLocaleString();\r\n              }\r\n              return plain.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n            }\r\n          } catch {}\r\n          return formatNumber(levelBn);\r\n        };\r\n        const lines = milestones\r\n          .sort((a, b) => (Number(a?.level ?? 0) - Number(b?.level ?? 0)))\r\n          .map((m) => {\r\n            const lvl = Math.max(0, Math.floor(Number(m?.level ?? 0)));\r\n            const milestoneLevelBn = (() => {\r\n              if (model.lvlBn?.isInfinite?.()) return BigNum.fromAny('Infinity');\r\n              try { return BigNum.fromAny((BigInt(lvl) + evolutionOffset).toString()); }\r\n              catch { return BigNum.fromAny(lvl + (HM_EVOLUTION_INTERVAL * evolutions)); }\r\n            })();\r\n            const milestonePlain = milestoneLevelBn?.toPlainIntegerString?.();\r\n            const levelText = formatMilestoneLevel(milestoneLevelBn);\r\n            const mult = formatMultForUi(m?.multiplier ?? m?.mult ?? m?.value ?? 1);\r\n            const target = `${m?.target ?? m?.type ?? 'self'}`.toLowerCase();\r\n            const achieved = (() => {\r\n              if (model.lvlBn?.isInfinite?.()) return true;\r\n              try { return model.lvlBn?.cmp?.(milestoneLevelBn) >= 0; }\r\n              catch {}\r\n              if (Number.isFinite(model.lvl) && milestonePlain && milestonePlain !== 'Infinity') {\r\n                const approxTarget = Number(milestonePlain);\r\n                if (Number.isFinite(approxTarget)) return model.lvl >= approxTarget;\r\n              }\r\n              return false;\r\n            })();\r\n            if (target === 'xp') return { text: `Level ${levelText}: Multiplies XP value by ${mult}x`, achieved };\r\n            if (target === 'coin' || target === 'coins') return { text: `Level ${levelText}: Multiplies Coin value by ${mult}x`, achieved };\r\n            if (target === 'mp') return { text: `Level ${levelText}: Multiplies MP value by ${mult}x`, achieved };\r\n            return { text: `Level ${levelText}: Multiplies this upgrade\u2019s effect by ${mult}x`, achieved };\r\n          });\r\n        openHmMilestoneDialog(lines);\r\n      });\r\n      milestonesRow.appendChild(viewMilestonesBtn);\r\n      content.appendChild(milestonesRow);\r\n    }\r\n\r\n    // ---------- actions ----------\r\n    const actions = upgSheetEl.querySelector('.upg-actions');\r\n    actions.innerHTML = '';\r\n\t\r\n    const closeBtn = document.createElement('button');\r\n    closeBtn.type = 'button';\r\n    closeBtn.className = 'shop-close';\r\n    closeBtn.textContent = 'Close';\r\n    closeBtn.addEventListener('click', () => { upgOpenLocal = false; closeUpgradeMenu(); });\r\n\r\n    if ('PointerEvent' in window) {\r\n      closeBtn.addEventListener('pointerdown', (e) => {\r\n        if (e.pointerType === 'mouse') return;\r\n        if (typeof e.button === 'number' && e.button !== 0) return;\r\n        markGhostTapTarget(closeBtn);\r\n        suppressNextGhostTap(320);\r\n        blockInteraction(160);\r\n        upgOpenLocal = false;\r\n        closeUpgradeMenu();\r\n        e.preventDefault();\r\n      }, { passive: false });\r\n    } else {\r\n      closeBtn.addEventListener('touchstart', (e) => {\r\n        markGhostTapTarget(closeBtn);\r\n        suppressNextGhostTap(320);\r\n        blockInteraction(160);\r\n        upgOpenLocal = false;\r\n        closeUpgradeMenu();\r\n        e.preventDefault();\r\n      }, { passive: false });\r\n    }\r\n\t\r\n    if (locked) {\r\n      actions.append(closeBtn);\r\n      closeBtn.focus();\r\n    } else if (capReached) {\r\n      actions.append(closeBtn);\r\n      closeBtn.focus();\r\n    } else {\r\n      const canAffordNext = model.have.cmp(nextPriceBn) >= 0;\r\n\r\n      if (evolveReady) {\r\n        const evolveBtn = document.createElement('button');\r\n        evolveBtn.type = 'button';\r\n        evolveBtn.className = 'shop-delve hm-evolve-btn';\r\n        evolveBtn.textContent = 'Evolve';\r\n        evolveBtn.addEventListener('click', () => {\r\n          const { evolved } = evolveUpgrade(areaKey, upgDef.id);\r\n          if (!evolved) return;\r\n          playEvolveSfx();\r\n          updateShopOverlay();\r\n          rerender();\r\n        });\r\n        actions.append(closeBtn, evolveBtn);\r\n        evolveBtn.focus();\r\n        recenterUnlockOverlayIfNeeded(model);\r\n        return;\r\n      }\r\n\r\n      if (model.unlockUpgrade) {\r\n        const unlockBtn = document.createElement('button');\r\n        unlockBtn.type = 'button';\r\n        unlockBtn.className = 'shop-delve';\r\n        unlockBtn.textContent = 'Unlock';\r\n        unlockBtn.disabled = !canAffordNext;\r\n        unlockBtn.addEventListener('click', () => {\r\n          const { bought } = buyOne(areaKey, upgDef.id);\r\n          const boughtBn = bought instanceof BigNum ? bought : BigNum.fromAny(bought ?? 0);\r\n          if (!boughtBn.isZero?.()) {\r\n            playPurchaseSfx();\r\n            if (isForgeUnlockUpgrade(upgDef)) {\r\n              try { unlockMerchantTabs(['reset']); } catch {}\r\n            }\r\n            updateShopOverlay();\r\n            rerender();\r\n          }\r\n        });\r\n\t\t\r\n        actions.append(closeBtn, unlockBtn);\r\n        (canAffordNext ? unlockBtn : closeBtn).focus();\r\n        recenterUnlockOverlayIfNeeded(model);\r\n        return;\r\n      }\r\n\r\n      const buyBtn = document.createElement('button');\r\n      buyBtn.type = 'button';\r\n      buyBtn.className = 'shop-delve';\r\n      buyBtn.textContent = 'Buy';\r\n      buyBtn.disabled = !canAffordNext;\r\n\r\n      // Core buy logic shared by pointer/touch and click fallback\r\n      const performBuy = () => {\r\n        const fresh = upgradeUiModel(areaKey, upgDef.id);\r\n        const priceNow = fresh.nextPrice instanceof BigNum\r\n          ? fresh.nextPrice\r\n          : BigNum.fromAny(fresh.nextPrice || 0);\r\n        if (fresh.have.cmp(priceNow) < 0) return;\r\n\r\n        const { bought } = buyOne(areaKey, upgDef.id);\r\n        const boughtBn = bought instanceof BigNum ? bought : BigNum.fromAny(bought ?? 0);\r\n        if (boughtBn.isZero?.()) return;\r\n\r\n        playPurchaseSfx();\r\n        updateShopOverlay();\r\n        rerender();\r\n      };\r\n\r\n      // Mobile: drive purchase off pointer/touch so Safari's click\r\n      // cancellation doesn't limit how fast you can spam the button.\r\n      if ('PointerEvent' in window) {\r\n        buyBtn.addEventListener('pointerdown', (event) => {\r\n          // Ignore mouse here; desktop uses the click handler below\r\n          if (event.pointerType === 'mouse') return;\r\n          if (typeof event.button === 'number' && event.button !== 0) return;\r\n\r\n          if (typeof markGhostTapTarget === 'function') {\r\n            // Small window: eats ghost taps that land elsewhere,\r\n            // but repeated taps on this button are still allowed\r\n            markGhostTapTarget(buyBtn, 160);\r\n          }\r\n\r\n          performBuy();\r\n          event.preventDefault();\r\n        }, { passive: false });\r\n      } else {\r\n        // Older touch-only browsers\r\n        buyBtn.addEventListener('touchstart', (event) => {\r\n          if (typeof markGhostTapTarget === 'function') {\r\n            markGhostTapTarget(buyBtn, 160);\r\n          }\r\n\r\n          performBuy();\r\n          event.preventDefault();\r\n        }, { passive: false });\r\n      }\r\n\r\n      // Desktop / non-touch fallback \u2013 simple click is fine here.\r\n      buyBtn.addEventListener('click', (event) => {\r\n        // On mobile we already handled the tap in pointer/touch handler\r\n        if (IS_MOBILE) return;\r\n\r\n        if (typeof markGhostTapTarget === 'function') {\r\n          markGhostTapTarget(buyBtn, 160);\r\n        }\r\n\r\n        performBuy();\r\n      });\r\n\r\n\r\n      const buyMaxBtn = document.createElement('button');\r\n      buyMaxBtn.type = 'button';\r\n      buyMaxBtn.className = 'shop-delve';\r\n      buyMaxBtn.textContent = 'Buy Max';\r\n      buyMaxBtn.disabled = !canAffordNext;\r\n      const performBuyMax = () => {\r\n        if (buyMaxBtn.disabled) return;\r\n        const fresh = upgradeUiModel(areaKey, upgDef.id);\r\n        if (fresh.have.cmp(BigNum.fromInt(1)) < 0) return;\r\n        const { bought } = buyMax(areaKey, upgDef.id);\r\n        const boughtBn = bought instanceof BigNum ? bought : BigNum.fromAny(bought ?? 0);\r\n        if (!boughtBn.isZero?.()) {\r\n          playPurchaseSfx();\r\n          updateShopOverlay();\r\n          rerender();\r\n        }\r\n      };\r\n\r\n      if ('PointerEvent' in window) {\r\n        buyMaxBtn.addEventListener('pointerdown', (event) => {\r\n          if (event.pointerType === 'mouse') return;\r\n          if (typeof event.button === 'number' && event.button !== 0) return;\r\n\r\n          if (typeof markGhostTapTarget === 'function') {\r\n            markGhostTapTarget(buyMaxBtn, 160);\r\n          }\r\n\r\n          performBuyMax();\r\n          event.preventDefault();\r\n        }, { passive: false });\r\n      } else {\r\n        buyMaxBtn.addEventListener('touchstart', (event) => {\r\n          if (typeof markGhostTapTarget === 'function') {\r\n            markGhostTapTarget(buyMaxBtn, 160);\r\n          }\r\n\r\n          performBuyMax();\r\n          event.preventDefault();\r\n        }, { passive: false });\r\n      }\r\n\r\n      buyMaxBtn.addEventListener('click', (event) => {\r\n        if (IS_MOBILE) return;\r\n\r\n        if (typeof markGhostTapTarget === 'function') {\r\n          markGhostTapTarget(buyMaxBtn, 160);\r\n        }\r\n\r\n        performBuyMax();\r\n      });\r\n\r\n      actions.append(closeBtn, buyBtn, buyMaxBtn);\r\n\r\n      // Only HM gets Buy Next\r\n      if (isHM) {\r\n        const buyNextBtn = document.createElement('button');\r\n        buyNextBtn.type = 'button';\r\n        buyNextBtn.className = 'shop-delve';\r\n        buyNextBtn.textContent = 'Buy Next';\r\n        buyNextBtn.disabled = model.have.cmp(BigNum.fromInt(1)) < 0;\r\n        const performBuyNext = () => {\r\n          if (buyNextBtn.disabled) return;\r\n          const fresh = upgradeUiModel(areaKey, upgDef.id);\r\n          if (fresh.hmReadyToEvolve) return;\r\n          const target = fresh.hmNextMilestone;\r\n          if (!target || !fresh.lvlBn || target.cmp(fresh.lvlBn) <= 0) {\r\n            const { bought } = buyMax(areaKey, upgDef.id);\r\n            const boughtBn = bought instanceof BigNum ? bought : BigNum.fromAny(bought ?? 0);\r\n            if (!boughtBn.isZero?.()) {\r\n              playPurchaseSfx();\r\n              updateShopOverlay();\r\n              rerender();\r\n            }\r\n            return;\r\n          }\r\n\r\n          let deltaNum = 0;\r\n          try {\r\n            const diffPlain = target.sub(fresh.lvlBn).toPlainIntegerString?.();\r\n            if (diffPlain && diffPlain !== 'Infinity') deltaNum = Number(diffPlain);\r\n            else deltaNum = Number(target.sub(fresh.lvlBn).toString());\r\n          } catch {}\r\n          deltaNum = Math.max(0, Math.floor(deltaNum));\r\n\r\n          const walletRaw = bank[fresh.upg.costType]?.value;\r\n          const walletBn = walletRaw instanceof BigNum\r\n            ? walletRaw\r\n            : BigNum.fromAny(walletRaw ?? 0);\r\n          const evalResult = evaluateBulkPurchase(fresh.upg, fresh.lvlBn, walletBn, deltaNum);\r\n          const count = evalResult.count;\r\n          let reachable = false;\r\n          try {\r\n            const plain = count?.toPlainIntegerString?.();\r\n            if (plain && plain !== 'Infinity') reachable = Number(plain) >= deltaNum;\r\n            else reachable = Number(count ?? 0) >= deltaNum;\r\n          } catch {}\r\n\r\n          const purchase = reachable\r\n            ? buyTowards(areaKey, upgDef.id, deltaNum)\r\n            : buyMax(areaKey, upgDef.id);\r\n          const boughtBn = purchase.bought instanceof BigNum\r\n            ? purchase.bought\r\n            : BigNum.fromAny(purchase.bought ?? 0);\r\n          if (!boughtBn.isZero?.()) {\r\n            playPurchaseSfx();\r\n            updateShopOverlay();\r\n            rerender();\r\n          }\r\n        };\r\n\r\n        if ('PointerEvent' in window) {\r\n          buyNextBtn.addEventListener('pointerdown', (event) => {\r\n            if (event.pointerType === 'mouse') return;\r\n            if (typeof event.button === 'number' && event.button !== 0) return;\r\n\r\n            if (typeof markGhostTapTarget === 'function') {\r\n              markGhostTapTarget(buyNextBtn, 160);\r\n            }\r\n\r\n            performBuyNext();\r\n            event.preventDefault();\r\n          }, { passive: false });\r\n        } else {\r\n          buyNextBtn.addEventListener('touchstart', (event) => {\r\n            if (typeof markGhostTapTarget === 'function') {\r\n              markGhostTapTarget(buyNextBtn, 160);\r\n            }\r\n\r\n            performBuyNext();\r\n            event.preventDefault();\r\n          }, { passive: false });\r\n        }\r\n\r\n        buyNextBtn.addEventListener('click', (event) => {\r\n          if (IS_MOBILE) return;\r\n\r\n          if (typeof markGhostTapTarget === 'function') {\r\n            markGhostTapTarget(buyNextBtn, 160);\r\n          }\r\n\r\n          performBuyNext();\r\n        });\r\n        actions.appendChild(buyNextBtn);\r\n      }\r\n\r\n      (canAffordNext ? buyBtn : closeBtn).focus();\r\n    }\r\n\t\r\n\trecenterUnlockOverlayIfNeeded(model);\r\n  };\r\n\r\n  const onCurrencyChange = () => {\r\n    if (!upgOpenLocal) return;\r\n    rerender();\r\n  };\r\n\r\n  const onUpgradesChanged = () => {\r\n    if (!upgOpenLocal) return;\r\n    rerender();\r\n  };\r\n\r\n    window.addEventListener('currency:change', onCurrencyChange);\r\n    window.addEventListener('xp:change', onCurrencyChange);\r\n    window.addEventListener('xp:unlock', onCurrencyChange);\r\n    document.addEventListener('ccc:upgrades:changed', onUpgradesChanged);\r\n\r\n  // open + animate\r\n  rerender();\r\n  upgOverlayEl.classList.add('is-open');\r\n  upgOverlayEl.style.pointerEvents = 'auto';\r\n  blockInteraction(140);\r\n  upgSheetEl.style.transition = 'none';\r\n  upgSheetEl.style.transform = 'translateY(100%)';\r\n  void upgSheetEl.offsetHeight;\r\n  requestAnimationFrame(() => {\r\n    upgSheetEl.style.transition = '';\r\n    upgSheetEl.style.transform = '';\r\n  });\r\n\r\n  // ESC to close\r\n  const onKey = (e) => {\r\n    if (!upgOpenLocal) return;\r\n    if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      upgOpenLocal = false;\r\n      closeUpgradeMenu();\r\n    }\r\n  };\r\n  window.addEventListener('keydown', onKey, true);\r\n\r\n  upgOverlayCleanup = () => {\r\n    upgOpenLocal = false;\r\n      window.removeEventListener('currency:change', onCurrencyChange);\r\n      window.removeEventListener('xp:change', onCurrencyChange);\r\n      window.removeEventListener('xp:unlock', onCurrencyChange);\r\n\t  document.removeEventListener('ccc:upgrades:changed', onUpgradesChanged);\r\n      window.removeEventListener('keydown', onKey, true);\r\n  };\r\n}\r\n\r\n// ---------- Controls ----------\r\nfunction onKeydownForShop(e) {\r\n  if (!shopOpen) return;\r\n  if (e.key === 'Escape') {\r\n    e.preventDefault();\r\n    closeShop();\r\n  }\r\n}\r\n\r\nexport function openShop() {\r\n  ensureShopOverlay();\r\n\r\n  if (shopCloseTimer) {\r\n    clearTimeout(shopCloseTimer);\r\n    shopCloseTimer = null;\r\n  }\r\n\r\n  if (typeof updateDelveGlow === 'function') updateDelveGlow();\r\n  updateShopOverlay(true);\r\n\r\n  if (shopOpen) return;\r\n\r\n  shopOpen = true;\r\n  shopSheetEl.style.transition = 'none';\r\n  shopSheetEl.style.transform = '';\r\n  shopOverlayEl.style.pointerEvents = 'auto';\r\n\r\n  void shopSheetEl.offsetHeight;\r\nrequestAnimationFrame(() => {\r\nshopSheetEl.style.transition = '';\r\nshopOverlayEl.classList.add('is-open');\r\n\r\n__shopOpenStamp = performance.now(); // harmless to keep\r\n__shopPostOpenPointer = false;\r\n\r\n// Optional now; can keep or delete\r\nif (IS_MOBILE) {\r\n  try {\r\n    setTimeout(() => suppressNextGhostTap(240), 120);\r\n  } catch {}\r\n}\r\n\r\n  blockInteraction(10);\r\n  ensureCustomScrollbar();\r\n  const focusable =\r\n    shopOverlayEl.querySelector('#shop-grid .shop-upgrade') ||\r\n    shopOverlayEl.querySelector('#shop-grid');\r\n  if (focusable) focusable.focus();\r\n});\r\n}\r\n\r\nexport function closeShop(force = false) {\r\n  const forceClose = force === true;\r\n  const overlayOpen = shopOverlayEl?.classList?.contains('is-open');\r\n\r\n  if (!forceClose && !shopOpen && !overlayOpen) {\r\n    if (shopCloseTimer) {\r\n      clearTimeout(shopCloseTimer);\r\n      shopCloseTimer = null;\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (shopCloseTimer) {\r\n    clearTimeout(shopCloseTimer);\r\n    shopCloseTimer = null;\r\n  }\r\n\r\n  shopOpen = false;\r\n  if (shopSheetEl) {\r\n    shopSheetEl.style.transition = '';\r\n    shopSheetEl.style.transform = '';\r\n  }\r\n  shopOverlayEl.classList.remove('is-open');\r\n  shopOverlayEl.style.pointerEvents = 'none';\r\n  __shopPostOpenPointer = false;\r\n}\r\n\r\n// ---------- Drag ----------\r\nfunction onDragStart(e) {\r\n  if (!shopOpen) return;\r\n\r\n  const clientY = typeof e.clientY === 'number'\r\n    ? e.clientY\r\n    : (e.touches && e.touches[0] ? e.touches[0].clientY : 0);\r\n\r\n  drag = { startY: clientY, lastY: clientY, startT: performance.now(), moved: 0, canceled: false };\r\n  shopSheetEl.style.transition = 'none';\r\n\r\n  window.addEventListener('pointermove', onDragMove);\r\n  window.addEventListener('pointerup', onDragEnd);\r\n  window.addEventListener('pointercancel', onDragCancel);\r\n}\r\n\r\nfunction onDragMove(e) {\r\n  if (!drag || drag.canceled) return;\r\n  const y = e.clientY;\r\n  if (typeof y !== 'number') return;\r\n\r\n  const dy = Math.max(0, y - drag.startY);\r\n  drag.lastY = y;\r\n  drag.moved = dy;\r\n  shopSheetEl.style.transform = `translateY(${dy}px)`;\r\n}\r\n\r\nfunction onDragEnd() {\r\n  if (!drag || drag.canceled) return cleanupDrag();\r\n\r\n  const dt = Math.max(1, performance.now() - drag.startT);\r\n  const dy = drag.moved;\r\n  const velocity = dy / dt;\r\n  const shouldClose = (velocity > 0.55 && dy > 40) || dy > 140;\r\n\r\n  if (shouldClose) {\r\n    suppressNextGhostTap(100);\r\n    blockInteraction(80);\r\n    shopSheetEl.style.transition = 'transform 140ms ease-out';\r\n    shopSheetEl.style.transform = 'translateY(100%)';\r\n    shopOpen = false;\r\n\r\n    shopCloseTimer = setTimeout(() => {\r\n      shopCloseTimer = null;\r\n      closeShop(true);\r\n    }, 150);\r\n  } else {\r\n    shopSheetEl.style.transition = 'transform 180ms ease';\r\n    shopSheetEl.style.transform = 'translateY(0)';\r\n  }\r\n\r\n  cleanupDrag();\r\n}\r\n\r\nfunction onDragCancel() {\r\n  if (!drag) return;\r\n  drag.canceled = true;\r\n  shopSheetEl.style.transition = 'transform 180ms ease';\r\n  shopSheetEl.style.transform = 'translateY(0)';\r\n  cleanupDrag();\r\n}\r\n\r\nfunction cleanupDrag() {\r\n  window.removeEventListener('pointermove', onDragMove);\r\n  window.removeEventListener('pointerup', onDragEnd);\r\n  window.removeEventListener('pointercancel', onDragCancel);\r\n  drag = null;\r\n}\r\n\r\nexport function updateShopOverlay(force = false) {\r\n  if (!force && !shopOpen) return;\r\n  buildUpgradesData();\r\n  renderShopGrid();\r\n}\r\n\r\nexport function setUpgradeCount() { updateShopOverlay(true); }\r\n\r\nexport function getUpgrades() { return upgrades; }", "// js/ui/hudButtons.js\r\n\r\nimport { openShop } from './shopOverlay.js';\r\nimport { getActiveSlot, hasModifiedSave } from '../util/storage.js';\r\nimport {\r\n  markGhostTapTarget,\r\n  shouldSkipGhostTap,\r\n} from '../util/ghostTapGuard.js';\r\n\r\nconst BASE_KEYS = {\r\n  SHOP: 'ccc:unlock:shop',\r\n  MAP:  'ccc:unlock:map',\r\n};\r\n\r\nfunction slotKey(base) {\r\n  const slot = getActiveSlot();\r\n  return slot == null ? base : `${base}:${slot}`;\r\n}\r\n\r\nfunction isUnlocked(base) {\r\n  const key = slotKey(base);\r\n  const slotRaw = localStorage.getItem(key);\r\n  if (slotRaw != null) return slotRaw === '1';\r\n  return localStorage.getItem(base) === '1';\r\n}\r\n\r\nexport function isShopUnlocked() {\r\n  ensureUnlockDefaults();\r\n  return isUnlocked(BASE_KEYS.SHOP);\r\n}\r\n\r\nexport function isMapUnlocked() {\r\n  ensureUnlockDefaults();\r\n  return isUnlocked(BASE_KEYS.MAP);\r\n}\r\n\r\nfunction setUnlocked(base, v) {\r\n  const val = v ? '1' : '0';\r\n  const key = slotKey(base);\r\n  localStorage.setItem(key, val);\r\n  if (key !== base && localStorage.getItem(base) != null) {\r\n    localStorage.setItem(base, val);\r\n  }\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('unlock:change', {\r\n      detail: { key: base, slot: getActiveSlot() },\r\n    }));\r\n  } catch {}\r\n}\r\n\r\nfunction ensureUnlockDefaults() {\r\n  for (const key of Object.values(BASE_KEYS)) {\r\n    const sk = slotKey(key);\r\n    const hasSlot = localStorage.getItem(sk) != null;\r\n    if (!hasSlot) localStorage.setItem(sk, '0');\r\n  }\r\n}\r\n\r\nfunction setButtonVisible(key, visible) {\r\n  const el = document.querySelector(`.hud-bottom [data-btn=\"${key}\"]`);\r\n  if (el) el.hidden = !visible;\r\n}\r\n\r\nfunction updateShopButtonTamperState() {\r\n  const btn = document.querySelector('.hud-bottom [data-btn=\"shop\"]');\r\n  if (!btn) return;\r\n  btn.classList.toggle('btn-shop--modified', hasModifiedSave());\r\n}\r\n\r\nfunction phonePortrait() {\r\n  const isCoarse = window.matchMedia('(pointer: coarse)').matches;\r\n  const isPortrait = window.innerHeight >= window.innerWidth;\r\n  return isCoarse && isPortrait;\r\n}\r\n\r\nlet listenersBound = false;\r\nlet actionsBound = false;\r\n\r\n// ===============================\r\n// HUD layout\r\n// ===============================\r\nexport function applyHudLayout() {\r\n  const hud = document.querySelector('.hud-bottom');\r\n  if (!hud) return;\r\n\r\n  const mapBtn = hud.querySelector('[data-btn=\"map\"]');\r\n  const isMapVisible = !!(mapBtn && !mapBtn.hidden);\r\n  const isPhonePortrait = phonePortrait();\r\n  const baseOrder = ['help', 'shop', 'stats', 'map'];\r\n  const mobileMapOrder = ['help', 'stats', 'shop', 'map'];\r\n\r\n  const desiredOrder = isPhonePortrait && isMapVisible ? mobileMapOrder : baseOrder;\r\n\r\n  const desiredNodes = desiredOrder\r\n    .map(key => hud.querySelector(`.game-btn[data-btn=\"${key}\"]`))\r\n    .filter(Boolean);\r\n  const remainingNodes = [...hud.children].filter(el => !desiredNodes.includes(el));\r\n  const finalOrder = [...desiredNodes, ...remainingNodes];\r\n\r\n  const needsReorder = finalOrder.length && finalOrder.some((el, idx) => hud.children[idx] !== el);\r\n  if (needsReorder) {\r\n    const frag = document.createDocumentFragment();\r\n    finalOrder.forEach(node => frag.appendChild(node));\r\n    hud.appendChild(frag);\r\n  }\r\n\r\n  const all = [...hud.querySelectorAll('.game-btn')];\r\n  const visible = all.filter(el => !el.hidden);\r\n\r\n  // Reset previous hints\r\n  hud.classList.remove('is-2','is-3','is-4');\r\n  visible.forEach(el => {\r\n    el.style.gridColumn = '';\r\n    el.style.gridRow = '';\r\n    el.classList.remove('span-2');\r\n    el.style.order = '';\r\n  });\r\n  hud.style.gridTemplateColumns = '';\r\n  hud.classList.add(`is-${visible.length}`);\r\n\r\n  // Desktop centering\r\n  if (!isPhonePortrait) {\r\n    const cs  = getComputedStyle(hud);\r\n    const gap = parseFloat(cs.columnGap || cs.gap || '0') || 0;\r\n    const cw  = hud.clientWidth;\r\n    const per = Math.max(180, Math.floor((cw - 3 * gap) / 4));\r\n\r\n    if (visible.length === 2) {\r\n      hud.style.gridTemplateColumns = `1fr ${per}px ${per}px 1fr`;\r\n      visible[0].style.gridColumn = '2';\r\n      visible[1].style.gridColumn = '3';\r\n      return;\r\n    }\r\n    if (visible.length === 3) {\r\n      hud.style.gridTemplateColumns = `1fr ${per}px ${per}px ${per}px 1fr`;\r\n      visible[0].style.gridColumn = '2';\r\n      visible[1].style.gridColumn = '3';\r\n      visible[2].style.gridColumn = '4';\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Mobile portrait (2\u00D72): Help & Stats top; Shop full width bottom\r\n  if (isPhonePortrait && visible.length === 3) {\r\n    const help  = hud.querySelector('[data-btn=\"help\"]:not([hidden])');\r\n    const stats = hud.querySelector('[data-btn=\"stats\"]:not([hidden])');\r\n    const shop  = hud.querySelector('[data-btn=\"shop\"]:not([hidden])');\r\n\r\n    if (help && stats && shop) {\r\n      help.style.gridColumn  = '1'; help.style.gridRow  = '1';\r\n      stats.style.gridColumn = '2'; stats.style.gridRow = '1';\r\n      shop.style.gridColumn  = '1 / -1'; shop.style.gridRow = '2';\r\n    }\r\n  }\r\n}\r\n\r\nexport function initHudButtons() {\r\n  ensureUnlockDefaults();\r\n\r\n  // Always-on buttons\r\n  setButtonVisible('help',  true);\r\n  setButtonVisible('stats', true);\r\n\r\n  setButtonVisible('shop', isUnlocked(BASE_KEYS.SHOP));\r\n  setButtonVisible('map',  isUnlocked(BASE_KEYS.MAP));\r\n  updateShopButtonTamperState();\r\n\r\n  applyHudLayout();\r\n\r\n  if (!listenersBound) {\r\n    listenersBound = true;\r\n    window.addEventListener('resize', applyHudLayout);\r\n    window.addEventListener('orientationchange', applyHudLayout);\r\n    window.addEventListener('saveSlot:change', () => {\r\n      setButtonVisible('shop', isUnlocked(BASE_KEYS.SHOP));\r\n      setButtonVisible('map',  isUnlocked(BASE_KEYS.MAP));\r\n      updateShopButtonTamperState();\r\n      applyHudLayout();\r\n    });\r\n    window.addEventListener('saveSlot:modified', (event) => {\r\n      const active = getActiveSlot();\r\n      const slot = event?.detail?.slot;\r\n      if (slot != null && active != null && slot !== active) return;\r\n      updateShopButtonTamperState();\r\n    });\r\n  }\r\n\r\n  // Bind actions once (click \u2192 open shop)\r\n  if (!actionsBound) {\r\n    actionsBound = true;\r\n    const hud = document.querySelector('.hud-bottom');\r\n    if (hud) {\r\n      const activate = (btn) => {\r\n        if (!btn) return;\r\n        const key = btn.getAttribute('data-btn');\r\n        if (key === 'shop') {\r\n          openShop();\r\n        }\r\n        // future: help/settings/map can import their own modules, too\r\n      };\r\n\r\n      const onClick = (e) => {\r\n        const btn = e.target.closest('.game-btn');\r\n        if (!btn) return;\r\n        const key = btn.getAttribute('data-btn');\r\n        if (key !== 'shop') return;\r\n        if (shouldSkipGhostTap(btn)) return;\r\n        markGhostTapTarget(btn);\r\n        activate(btn);\r\n      };\r\n\r\n      const hasPointerEvents = typeof window !== 'undefined' && 'PointerEvent' in window;\r\n\t  \r\n      const onPointerDown = (e) => {\r\n        if (e.pointerType === 'mouse') return;\r\n        if (typeof e.button === 'number' && e.button !== 0) return;\r\n        const btn = e.target.closest('.game-btn');\r\n        if (!btn) return;\r\n        const key = btn.getAttribute('data-btn');\r\n        if (key !== 'shop') return;\r\n        markGhostTapTarget(btn);\r\n        activate(btn);\r\n        e.preventDefault();\r\n      };\r\n\r\n      const onTouchStart = (e) => {\r\n        const btn = e.target.closest('.game-btn');\r\n        if (!btn) return;\r\n        const key = btn.getAttribute('data-btn');\r\n        if (key !== 'shop') return;\r\n        markGhostTapTarget(btn);\r\n        activate(btn);\r\n        e.preventDefault();\r\n      };\r\n\r\n      hud.addEventListener('click', onClick, { passive: true });\r\n      if (hasPointerEvents) {\r\n        hud.addEventListener('pointerdown', onPointerDown, { passive: false });\r\n      } else {\r\n        hud.addEventListener('touchstart', onTouchStart, { passive: false });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Convenience helpers (write both keys)\r\nexport function unlockShop() { setUnlocked(BASE_KEYS.SHOP, true);  setButtonVisible('shop', true); applyHudLayout(); }\r\nexport function unlockMap()  { setUnlocked(BASE_KEYS.MAP,  true);  setButtonVisible('map',  true); applyHudLayout(); }\r\nexport function lockShop()   { setUnlocked(BASE_KEYS.SHOP, false); setButtonVisible('shop', false); applyHudLayout(); }\r\nexport function lockMap()    { setUnlocked(BASE_KEYS.MAP,  false); setButtonVisible('map',  false); applyHudLayout(); }", "// js/util/debugPanel.js\r\n// Using a debug panel is much faster and more convenient than\r\n// Editing local storage every time I want to change something.\r\n\r\nimport { BigNum } from './bigNum.js';\r\nimport { formatNumber } from './numFormat.js';\r\nimport {\r\n    bank,\r\n    CURRENCIES,\r\n    KEYS,\r\n    getActiveSlot,\r\n    markSaveSlotModified,\r\n    peekCurrency,\r\n    primeStorageWatcherSnapshot,\r\n    setCurrency,\r\n    setCurrencyMultiplierBN,\r\n} from './storage.js';\r\nimport { broadcastXpChange, computeCoinMultiplierForXpLevel, getXpRequirementForXpLevel, getXpState, initXpSystem, resetXpProgress, unlockXpSystem } from '../game/xpSystem.js';\r\nimport { broadcastMutationChange, computeMutationMultiplierForLevel, computeMutationRequirementForLevel, getMutationMultiplier, getMutationState, initMutationSystem, setMutationUnlockedForDebug, unlockMutationSystem } from '../game/mutationSystem.js';\r\nimport { IS_MOBILE } from '../main.js';\r\nimport {\r\n    AREA_KEYS,\r\n    computeDefaultUpgradeCost,\r\n    computeUpgradeEffects,\r\n    getLevel,\r\n    getMpValueMultiplierBn,\r\n    getUpgradesForArea,\r\n    markUpgradePermanentlyUnlocked,\r\n    clearPermanentUpgradeUnlock,\r\n    setLevel,\r\n} from '../game/upgrades.js';\r\nimport { computeForgeGoldFromInputs, getForgeDebugOverrideState, hasDoneForgeReset, isForgeUnlocked, setForgeDebugOverride, setForgeResetCompleted, updateResetPanel } from '../ui/merchantDelve/resetTab.js';\r\nimport { isMapUnlocked, isShopUnlocked, lockMap, lockShop, unlockMap, unlockShop } from '../ui/hudButtons.js';\r\nimport { DLG_CATALOG, MERCHANT_DLG_STATE_KEY_BASE } from '../ui/merchantDelve/dlgTab.js';\r\nimport { markGhostTapTarget, shouldSkipGhostTap } from './ghostTapGuard.js';\r\n\r\nconst DEBUG_PANEL_STYLE_ID = 'debug-panel-style';\r\nconst DEBUG_PANEL_ID = 'debug-panel';\r\nconst DEBUG_PANEL_TOGGLE_ID = 'debug-panel-toggle';\r\nlet debugPanelOpen = false;\r\nlet debugPanelAccess = false;\r\nlet debugPanelCleanups = [];\r\nlet debugPanelExpansionState = createEmptyExpansionState();\r\nlet debugPanelScrollTop = 0;\r\nlet sectionKeyCounter = 0;\r\nlet subsectionKeyCounter = 0;\r\nconst liveBindings = [];\r\nlet actionLogContainer = null;\r\n\r\nconst currencyOverrides = new Map();\r\nconst currencyOverrideBaselines = new Map();\r\nconst currencyOverrideApplications = new Set();\r\nconst statOverrides = new Map();\r\nconst statOverrideBaselines = new Map();\r\nconst lockedStorageKeys = new Set();\r\nif (typeof window !== 'undefined') {\r\n    window.__cccLockedStorageKeys = lockedStorageKeys;\r\n}\r\nlet storageLockPatched = false;\r\nlet originalSetItem = null;\r\nlet originalRemoveItem = null;\r\n\r\nconst STAT_MULTIPLIER_STORAGE_PREFIX = 'ccc:debug:stat-mult';\r\nconst ACTION_LOG_STORAGE_PREFIX = 'ccc:actionLog';\r\nconst MAX_ACTION_LOG_ENTRIES = 100;\r\n\r\nfunction isOnMenu() {\r\n    const menuRoot = document.querySelector('.menu-root');\r\n    if (!menuRoot) return false;\r\n\r\n    const style = window.getComputedStyle?.(menuRoot);\r\n    if (!style) return menuRoot.style.display !== 'none';\r\n\r\n    return style.display !== 'none' && style.visibility !== 'hidden' && !menuRoot.hidden;\r\n}\r\n\r\nfunction isGameVisible() {\r\n    const gameRoot = document.getElementById('game-root');\r\n    if (!gameRoot) return false;\r\n\r\n    const style = window.getComputedStyle?.(gameRoot);\r\n    if (!style) {\r\n        return gameRoot.style.display !== 'none'\r\n            && gameRoot.style.visibility !== 'hidden'\r\n            && !gameRoot.hidden;\r\n    }\r\n\r\n    return style.display !== 'none' && style.visibility !== 'hidden' && !gameRoot.hidden;\r\n}\r\n\r\nfunction addDebugPanelCleanup(fn) {\r\n    if (typeof fn === 'function') {\r\n        debugPanelCleanups.push(fn);\r\n    }\r\n}\r\n\r\nfunction createEmptyExpansionState() {\r\n    return { sections: new Set(), subsections: new Set() };\r\n}\r\n\r\nfunction captureDebugPanelExpansionState() {\r\n    const panel = document.getElementById(DEBUG_PANEL_ID);\r\n    if (!panel) return createEmptyExpansionState();\r\n\r\n    const sections = new Set();\r\n    panel.querySelectorAll('.debug-panel-section-toggle').forEach((toggle) => {\r\n        const key = toggle.dataset.sectionKey ?? toggle.textContent;\r\n        if (toggle.classList.contains('expanded')) {\r\n            sections.add(key);\r\n        }\r\n    });\r\n\r\n    const subsections = new Set();\r\n    panel.querySelectorAll('.debug-panel-subsection-toggle').forEach((toggle) => {\r\n        const key = toggle.dataset.subsectionKey ?? toggle.textContent;\r\n        if (toggle.classList.contains('expanded')) {\r\n            subsections.add(key);\r\n        }\r\n    });\r\n\r\n    return { sections, subsections };\r\n}\r\n\r\nfunction applyDebugPanelExpansionState(panel) {\r\n    const { sections, subsections } = debugPanelExpansionState ?? createEmptyExpansionState();\r\n\r\n    panel.querySelectorAll('.debug-panel-section-toggle').forEach((toggle) => {\r\n        const key = toggle.dataset.sectionKey ?? toggle.textContent;\r\n        if (!sections.has(key)) return;\r\n        const content = toggle.nextElementSibling;\r\n        toggle.classList.add('expanded');\r\n        if (content) content.classList.add('active');\r\n    });\r\n\r\n    panel.querySelectorAll('.debug-panel-subsection-toggle').forEach((toggle) => {\r\n        const key = toggle.dataset.subsectionKey ?? toggle.textContent;\r\n        if (!subsections.has(key)) return;\r\n        const content = toggle.nextElementSibling;\r\n        toggle.classList.add('expanded');\r\n        if (content) content.classList.add('active');\r\n    });\r\n}\r\n\r\nfunction cleanupDebugPanelResources() {\r\n    debugPanelCleanups.forEach((fn) => {\r\n        try { fn?.(); } catch {}\r\n    });\r\n    debugPanelCleanups = [];\r\n    liveBindings.length = 0;\r\n}\r\n\r\nfunction registerLiveBinding(binding) {\r\n    if (!binding || typeof binding.refresh !== 'function') return;\r\n    liveBindings.push(binding);\r\n}\r\n\r\nfunction refreshLiveBindings(predicate) {\r\n    liveBindings.forEach((binding) => {\r\n        if (typeof predicate === 'function' && !predicate(binding)) return;\r\n        try { binding.refresh(); } catch {}\r\n    });\r\n}\r\n\r\nfunction setupLiveBindingListeners() {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const currencyHandler = (event) => {\r\n        const { key, slot } = event?.detail ?? {};\r\n        const targetSlot = slot ?? getActiveSlot();\r\n        refreshLiveBindings((binding) => binding.type === 'currency'\r\n            && binding.key === key\r\n            && binding.slot === targetSlot);\r\n    };\r\n    window.addEventListener('currency:change', currencyHandler, { passive: true });\r\n    addDebugPanelCleanup(() => window.removeEventListener('currency:change', currencyHandler));\r\n\r\n    const currencyMultiplierHandler = (event) => {\r\n        const { key, slot } = event?.detail ?? {};\r\n        const targetSlot = slot ?? getActiveSlot();\r\n        refreshLiveBindings((binding) => binding.type === 'currency-mult'\r\n            && binding.key === key\r\n            && binding.slot === targetSlot);\r\n    };\r\n    window.addEventListener('currency:multiplier', currencyMultiplierHandler, { passive: true });\r\n    addDebugPanelCleanup(() => window.removeEventListener('currency:multiplier', currencyMultiplierHandler));\r\n\r\n    const xpHandler = (event) => {\r\n        const { slot } = event?.detail ?? {};\r\n        const targetSlot = slot ?? getActiveSlot();\r\n        refreshLiveBindings((binding) => binding.type === 'xp'\r\n            && binding.slot === targetSlot);\r\n    };\r\n    window.addEventListener('xp:change', xpHandler, { passive: true });\r\n    addDebugPanelCleanup(() => window.removeEventListener('xp:change', xpHandler));\r\n\r\n    const mutationHandler = () => {\r\n        const targetSlot = getActiveSlot();\r\n        refreshLiveBindings((binding) => binding.type === 'mutation'\r\n            && binding.slot === targetSlot);\r\n        refreshLiveBindings((binding) => binding.type === 'stat-mult'\r\n            && binding.key === 'mutation'\r\n            && binding.slot === targetSlot);\r\n    };\r\n    window.addEventListener('mutation:change', mutationHandler, { passive: true });\r\n    addDebugPanelCleanup(() => window.removeEventListener('mutation:change', mutationHandler));\r\n\r\n    const upgradeHandler = () => {\r\n        const targetSlot = getActiveSlot();\r\n        refreshLiveBindings((binding) => binding.type === 'upgrade'\r\n            && binding.slot === targetSlot);\r\n        refreshLiveBindings((binding) => binding.type === 'currency-mult'\r\n            && binding.slot === targetSlot);\r\n        refreshLiveBindings((binding) => binding.type === 'stat-mult'\r\n            && binding.slot === targetSlot);\r\n    };\r\n    document.addEventListener('ccc:upgrades:changed', upgradeHandler, { passive: true });\r\n    addDebugPanelCleanup(() => document.removeEventListener('ccc:upgrades:changed', upgradeHandler));\r\n\r\n    const slotHandler = () => {\r\n        const targetSlot = getActiveSlot();\r\n        refreshLiveBindings((binding) => binding.slot === targetSlot);\r\n    };\r\n    window.addEventListener('saveSlot:change', slotHandler, { passive: true });\r\n    addDebugPanelCleanup(() => window.removeEventListener('saveSlot:change', slotHandler));\r\n\r\n    const unlockHandler = (event) => {\r\n        const { slot, key } = event?.detail ?? {};\r\n        const targetSlot = slot ?? getActiveSlot();\r\n        refreshLiveBindings((binding) => binding.type === 'unlock'\r\n            && (binding.slot == null || binding.slot === targetSlot)\r\n            && (binding.key == null || binding.key === key));\r\n    };\r\n    window.addEventListener('unlock:change', unlockHandler, { passive: true });\r\n    addDebugPanelCleanup(() => window.removeEventListener('unlock:change', unlockHandler));\r\n}\r\n\r\nconst XP_KEY_PREFIX = 'ccc:xp';\r\nconst XP_KEYS = {\r\n    unlock: (slot) => `${XP_KEY_PREFIX}:unlocked:${slot}`,\r\n    level:  (slot) => `${XP_KEY_PREFIX}:level:${slot}`,\r\n    progress: (slot) => `${XP_KEY_PREFIX}:progress:${slot}`,\r\n};\r\n\r\nconst MUTATION_KEY_PREFIX = 'ccc:mutation';\r\nconst MUTATION_KEYS = {\r\n    unlock: (slot) => `${MUTATION_KEY_PREFIX}:unlocked:${slot}`,\r\n    level:  (slot) => `${MUTATION_KEY_PREFIX}:level:${slot}`,\r\n    progress: (slot) => `${MUTATION_KEY_PREFIX}:progress:${slot}`,\r\n};\r\n\r\nconst STAT_MULTIPLIERS = [\r\n    { key: 'xp', label: 'XP' },\r\n    { key: 'mutation', label: 'MP' },\r\n];\r\n\r\nfunction getAreas() {\r\n    return [\r\n        {\r\n            key: AREA_KEYS.STARTER_COVE,\r\n            title: 'The Cove',\r\n            currencies: [\r\n                { key: CURRENCIES.COINS, label: 'Coins' },\r\n                { key: CURRENCIES.BOOKS, label: 'Books' },\r\n                { key: CURRENCIES.GOLD,  label: 'Gold'  },\r\n            ],\r\n            stats: [\r\n                { key: 'xp', label: 'XP' },\r\n                { key: 'mutation', label: 'MP' },\r\n            ],\r\n        },\r\n    ];\r\n}\r\n\r\nfunction ensureDebugPanelStyles() {\r\n    let style = document.getElementById(DEBUG_PANEL_STYLE_ID);\r\n    if (style) return;\r\n\r\n    style = document.createElement('style');\r\n    style.id = DEBUG_PANEL_STYLE_ID;\r\n    style.textContent = `\r\n        .debug-panel {\r\n            position: fixed;\r\n            top: 50%;\r\n            right: 0;\r\n            transform: translateY(-50%);\r\n            width: 600px;\r\n            max-height: 100vh;\r\n            overflow-y: auto;\r\n            background: rgb(0, 0, 0);\r\n            color: #fff;\r\n            font-family: Arial, sans-serif;\r\n            padding: 12px;\r\n            border-radius: 6px 0 0 6px;\r\n            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.6);\r\n            z-index: 2147483646;\r\n            scrollbar-width: thin;\r\n            scrollbar-color: rgba(255, 255, 255, 0.22) rgba(0, 0, 0, 0.5);\r\n\t\t\tborder: 1px solid white;\r\n        }\r\n\r\n        .debug-panel::-webkit-scrollbar,\r\n        .debug-panel-section-content::-webkit-scrollbar,\r\n        .debug-panel-subsection-content::-webkit-scrollbar {\r\n            width: 10px;\r\n        }\r\n\r\n        .debug-panel::-webkit-scrollbar-track,\r\n        .debug-panel-section-content::-webkit-scrollbar-track,\r\n        .debug-panel-subsection-content::-webkit-scrollbar-track {\r\n            background: rgba(0, 0, 0, 0.35);\r\n            border-radius: 6px;\r\n        }\r\n\r\n        .debug-panel::-webkit-scrollbar-thumb,\r\n        .debug-panel-section-content::-webkit-scrollbar-thumb,\r\n        .debug-panel-subsection-content::-webkit-scrollbar-thumb {\r\n            background: rgba(255, 255, 255, 0.22);\r\n            border-radius: 10px;\r\n            border: 1px solid rgba(255, 255, 255, 0.1);\r\n        }\r\n\r\n        .debug-panel::-webkit-scrollbar-thumb:hover,\r\n        .debug-panel-section-content::-webkit-scrollbar-thumb:hover,\r\n        .debug-panel-subsection-content::-webkit-scrollbar-thumb:hover {\r\n            background: rgba(255, 255, 255, 0.3);\r\n        }\r\n\r\n        .debug-panel-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: flex-start;\r\n            margin-bottom: 10px;\r\n        }\r\n\r\n        .debug-panel-title {\r\n            font-size: 1.2em;\r\n            font-weight: bold;\r\n        }\r\n\r\n        .debug-panel-info {\r\n            font-size: 0.95em;\r\n            color: #ccc;\r\n        }\r\n\r\n        .debug-panel-info-line + .debug-panel-info-line {\r\n            margin-top: 2px;\r\n        }\r\n\r\n        @media (pointer: coarse) {\r\n            .debug-panel-info-mobile-hidden {\r\n                display: none;\r\n            }\r\n        }\r\n\r\n        @media (max-width: 600px) {\r\n            .debug-panel {\r\n                left: 0;\r\n                right: 0;\r\n                top: 0;\r\n                transform: none;\r\n                width: auto;\r\n                max-width: none;\r\n                max-height: calc(90vh - 12px);\r\n                padding: 8px;\r\n                margin: 6px;\r\n                border-radius: 8px;\r\n            }\r\n\r\n            .debug-panel-header {\r\n                flex-direction: column;\r\n                align-items: flex-start;\r\n                gap: 6px;\r\n            }\r\n\r\n            .debug-panel-title {\r\n                font-size: 1.05em;\r\n            }\r\n\r\n            .debug-panel-info {\r\n                font-size: 0.85em;\r\n            }\r\n\r\n            .debug-panel-section-toggle,\r\n            .debug-panel-subsection-toggle {\r\n                align-items: flex-start;\r\n                gap: 6px;\r\n            }\r\n\r\n            .debug-panel-row {\r\n                flex-direction: column;\r\n                align-items: stretch;\r\n            }\r\n\r\n            .debug-panel-toggle,\r\n            .debug-misc-button {\r\n                width: 100%;\r\n            }\r\n\r\n            .debug-misc-button-list {\r\n                justify-content: flex-start;\r\n            }\r\n\r\n            .debug-panel-close-buttons {\r\n                display: flex;\r\n                flex-direction: column;\r\n                align-items: stretch;\r\n                width: 100%;\r\n            }\r\n\r\n            .debug-panel-close {\r\n                width: 100%;\r\n                font-size: 1em;\r\n                padding: 10px 14px;\r\n                border-radius: 6px;\r\n                background: hsla(0, 80%, 40%, 0.15);\r\n                border: 1px solid hsla(0, 80%, 40%, 0.45);\r\n                color: #fff;\r\n                text-align: center;\r\n            }\r\n\r\n            .debug-panel-close + .debug-panel-close {\r\n                margin-top: 6px;\r\n            }\r\n        }\r\n\r\n        .debug-panel-close-buttons {\r\n            display: none;\r\n            gap: 8px;\r\n        }\r\n\r\n        .debug-panel-close {\r\n            background: hsla(0, 80%, 40%, 0.15);\r\n            border: 1px solid hsla(0, 80%, 40%, 0.45);\r\n            color: #fff;\r\n            font-size: 1.05em;\r\n            cursor: pointer;\r\n            border-radius: 4px;\r\n            padding: 6px 10px;\r\n            transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;\r\n        }\r\n\r\n        .debug-panel-close:hover {\r\n            background: hsla(0, 80%, 40%, 0.22);\r\n        }\r\n\r\n        .debug-panel-close:active {\r\n            transform: translateY(1px);\r\n            background: hsla(0, 80%, 40%, 0.28);\r\n        }\r\n\r\n        .debug-panel-close.debug-panel-close-collapse {\r\n            font-size: 1em;\r\n        }\r\n\r\n        .debug-panel-section {\r\n            border: 1px solid #444;\r\n            border-radius: 4px;\r\n            margin-bottom: 10px;\r\n            background: rgba(255, 255, 255, 0.05);\r\n        }\r\n\r\n        .debug-panel-section-toggle {\r\n            width: 100%;\r\n            text-align: left;\r\n            background: rgba(255, 255, 255, 0.08);\r\n            border: none;\r\n            color: #fff;\r\n            padding: 8px 10px;\r\n            font-weight: bold;\r\n            cursor: pointer;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 8px;\r\n        }\r\n\r\n        .debug-panel-section-toggle::before {\r\n            content: '\u25B6';\r\n            font-size: 1em;\r\n            width: 1em;\r\n            display: inline-flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n        }\r\n\r\n        .debug-panel-section-toggle.expanded::before {\r\n            content: '\u25BC';\r\n        }\r\n\r\n        .debug-panel-section-content {\r\n            padding: 8px 10px;\r\n            border-top: 1px solid #444;\r\n            display: none;\r\n        }\r\n\r\n        .debug-panel-section-content.active {\r\n            display: block;\r\n        }\r\n\r\n        .debug-panel-empty {\r\n            color: #aaa;\r\n            font-style: italic;\r\n        }\r\n\r\n        .action-log-entry {\r\n            display: flex;\r\n            gap: 6px;\r\n            padding: 4px 0;\r\n            border-bottom: 1px solid rgba(255, 255, 255, 0.08);\r\n        }\r\n\r\n        .action-log-entry:last-child {\r\n            border-bottom: none;\r\n        }\r\n\r\n        .action-log-time {\r\n            color: #7bc0ff;\r\n            font-weight: bold;\r\n            min-width: 60px;\r\n        }\r\n\r\n        .action-log-message {\r\n            flex: 1;\r\n        }\r\n\r\n        .action-log-empty {\r\n            color: #aaa;\r\n            font-style: italic;\r\n            padding: 6px 0;\r\n        }\r\n\r\n        .action-log-number {\r\n            color: #ffd54f;\r\n            font-weight: bold;\r\n        }\r\n\r\n        .action-log-number::after {\r\n            content: attr(data-unit);\r\n            color: #ffa726;\r\n            font-weight: normal;\r\n            margin-left: 0;\r\n        }\r\n\r\n        .action-log-number[data-unit]:not([data-unit=\"\"])::after {\r\n            margin-left: 2px;\r\n        }\r\n\r\n        .action-log-level {\r\n            color: #ffd700;\r\n            font-weight: bold;\r\n            text-shadow: 0 0 2px rgba(0,0,0,0.5);\r\n            border-radius: 3px;\r\n            padding: 0 2px;\r\n        }\r\n\r\n        .action-log-level span {\r\n            color: #ffd700;\r\n        }\r\n\r\n        .action-log-gold {\r\n            color: #ffd700;\r\n            font-weight: bold;\r\n            text-shadow: 0 0 2px rgba(0,0,0,0.5);\r\n            border-radius: 3px;\r\n            padding: 0;\r\n        }\r\n\r\n        .debug-panel-subsection {\r\n            margin: 8px 0 12px;\r\n            border: 1px solid #333;\r\n            border-radius: 4px;\r\n            background: rgba(255, 255, 255, 0.03);\r\n        }\r\n\r\n        .debug-panel-subsection-toggle {\r\n            width: 100%;\r\n            text-align: left;\r\n            background: rgba(255, 255, 255, 0.06);\r\n            border: none;\r\n            color: #fff;\r\n            padding: 6px 8px;\r\n            font-weight: bold;\r\n            cursor: pointer;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 8px;\r\n            font-size: 0.95em;\r\n        }\r\n\r\n        .debug-panel-subsection-toggle::before {\r\n            content: '\u25B6';\r\n            font-size: 1em;\r\n            width: 1em;\r\n            display: inline-flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n        }\r\n\r\n        .debug-panel-subsection-toggle.expanded::before {\r\n            content: '\u25BC';\r\n        }\r\n\r\n        .debug-panel-subsection-content {\r\n            display: none;\r\n            padding: 8px 10px;\r\n            border-top: 1px solid #333;\r\n        }\r\n\r\n        .debug-panel-subsection-content.active {\r\n            display: block;\r\n        }\r\n\r\n        .debug-panel-row {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: space-between;\r\n            gap: 12px;\r\n            padding: 4px 0;\r\n        }\r\n\r\n        .debug-panel-toggle {\r\n            background: rgba(255, 255, 255, 0.08);\r\n            border: 1px solid #555;\r\n            color: #fff;\r\n            padding: 8px 12px;\r\n            border-radius: 6px;\r\n            cursor: pointer;\r\n            transition: background 0.12s ease, transform 0.12s ease;\r\n        }\r\n\r\n        .debug-panel-toggle:hover {\r\n            background: rgba(255, 255, 255, 0.12);\r\n            transform: translateY(-1px);\r\n        }\r\n\r\n        .debug-panel-toggle.debug-danger-button {\r\n            border-color: hsla(0, 80%, 40%, 0.45);\r\n            background: hsla(0, 80%, 40%, 0.15);\r\n            color: #fff;\r\n            font-weight: 700;\r\n            letter-spacing: 0.2px;\r\n        }\r\n\r\n        .debug-panel-toggle.debug-danger-button:hover {\r\n            background: hsla(0, 80%, 40%, 0.22);\r\n        }\r\n\r\n        .debug-panel-toggle.debug-danger-button:active {\r\n            background: hsla(0, 80%, 40%, 0.28);\r\n            transform: translateY(1px);\r\n        }\r\n\r\n        .debug-misc-button-list {\r\n            display: flex;\r\n            flex-wrap: wrap;\r\n            gap: 10px;\r\n            justify-content: center;\r\n        }\r\n\r\n        .debug-misc-button {\r\n            flex: 0 1 170px;\r\n            min-width: 150px;\r\n            max-width: 190px;\r\n            padding: 6px 10px;\r\n            text-align: center;\r\n            font-weight: 600;\r\n            font-size: 0.95em;\r\n        }\r\n\r\n        .debug-misc-button:hover {\r\n            background: rgba(255, 255, 255, 0.14);\r\n        }\r\n\r\n        .debug-unlock-row {\r\n            align-items: flex-start;\r\n            justify-content: flex-start;\r\n        }\r\n\t\t\r\n\t\t.debug-unlock-row,\r\n\t\t.debug-unlock-row * {\r\n\t\t\tuser-select: none;\r\n\t\t}\r\n\r\n        .debug-unlock-row .flag-toggle {\r\n            flex: 0 0 auto;\r\n        }\r\n\r\n        .debug-unlock-text {\r\n            flex: 1;\r\n            display: flex;\r\n            flex-wrap: wrap;\r\n            gap: 6px;\r\n            align-items: center;\r\n        }\r\n\r\n        .debug-unlock-title {\r\n            font-weight: 600;\r\n        }\r\n\r\n        .debug-unlock-desc {\r\n            color: #aaa;\r\n            font-size: 0.9em;\r\n        }\r\n\r\n        .debug-calculator-inputs {\r\n            display: flex;\r\n            flex: 0 0 245px;\r\n            gap: 8px;\r\n            flex-wrap: wrap;\r\n        }\r\n\r\n        .debug-calculator-output {\r\n            min-width: 120px;\r\n            text-align: right;\r\n            font-family: Consolas, 'Courier New', monospace;\r\n        }\r\n\r\n        .debug-panel .infinity-symbol {\r\n            font-size: 1.5em;\r\n            line-height: 1.05;\r\n        }\r\n\r\n        .debug-panel-row label {\r\n            flex: 1;\r\n            font-size: 0.95em;\r\n        }\r\n\r\n        .debug-panel-input {\r\n            flex: 0 0 245px;\r\n            max-width: 100%;\r\n            background: #111;\r\n            color: #fff;\r\n            border: 1px solid #555;\r\n            padding: 6px 8px;\r\n            border-radius: 4px;\r\n            font-family: Consolas, 'Courier New', monospace;\r\n        }\r\n\r\n        .debug-lock-button {\r\n            flex: 0 0 50px;\r\n            max-width: 60px;\r\n            padding: 6px 8px;\r\n            border-radius: 4px;\r\n            border: 1px solid #555;\r\n            background: #111;\r\n            color: #fff;\r\n            font-weight: bold;\r\n            cursor: pointer;\r\n        }\r\n\r\n        .debug-lock-button.locked {\r\n            background: #440000;\r\n            border-color: #aa0000;\r\n            color: #ff6666;\r\n        }\r\n\r\n        .debug-panel-input.debug-invalid {\r\n            border-color: #e66;\r\n            box-shadow: 0 0 0 1px #e66;\r\n        }\r\n\r\n        .debug-panel-id {\r\n            font-size: 0.8em;\r\n            color: #aaa;\r\n            margin-left: 6px;\r\n            position: relative;\r\n            top: -2px;\r\n        }\r\n\r\n        .debug-panel-toggle-button {\r\n            position: fixed;\r\n            top: 10px;\r\n            left: 10px;\r\n            z-index: 2147483647;\r\n            background: rgba(0, 0, 0, 0.85);\r\n            color: #fff;\r\n            border: 1px solid #666;\r\n            border-radius: 4px;\r\n            padding: 8px 12px;\r\n            cursor: pointer;\r\n            font-size: 0.9em;\r\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);\r\n        }\r\n\r\n        .debug-panel-toggle-button:hover {\r\n            background: rgba(0, 0, 0, 0.95);\r\n        }\r\n\r\n        .flag-toggle {\r\n            position: relative;\r\n            display: inline-block;\r\n            width: 50px;\r\n            height: 24px;\r\n        }\r\n\r\n        .flag-toggle input {\r\n            opacity: 0;\r\n            width: 0;\r\n            height: 0;\r\n        }\r\n\r\n        .flag-slider {\r\n            position: absolute;\r\n            cursor: pointer;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background-color: #555;\r\n            transition: .2s;\r\n            border-radius: 12px;\r\n        }\r\n\r\n        .flag-slider:before {\r\n            position: absolute;\r\n            content: \"\";\r\n            height: 18px;\r\n            width: 18px;\r\n            left: 3px;\r\n            bottom: 3px;\r\n            background-color: white;\r\n            transition: .2s;\r\n            border-radius: 50%;\r\n        }\r\n\r\n        .flag-toggle input:checked + .flag-slider {\r\n            background-color: #2196F3;\r\n        }\r\n\r\n        .flag-toggle input:checked + .flag-slider:before {\r\n            transform: translateX(26px);\r\n        }\r\n\t\t\r\n\t\t.debug-unlock-row:hover {\r\n\t\t\tcursor: pointer;\r\n\t\t}\r\n    `;\r\n\r\n    document.head.appendChild(style);\r\n}\r\n\r\nfunction removeDebugPanelToggleButton() {\r\n    const existingButton = document.getElementById(DEBUG_PANEL_TOGGLE_ID);\r\n    if (existingButton) existingButton.remove();\r\n}\r\n\r\nfunction shouldShowDebugPanelToggleButton() {\r\n    return debugPanelAccess\r\n        && IS_MOBILE\r\n        && getActiveSlot() != null\r\n        && !isOnMenu()\r\n        && isGameVisible();\r\n}\r\n\r\nfunction onMenuVisibilityChange(event) {\r\n    if (event?.detail?.visible) {\r\n        closeDebugPanel();\r\n    }\r\n    createDebugPanelToggleButton();\r\n}\r\n\r\nfunction createSection(title, contentId, contentBuilder) {\r\n    const section = document.createElement('div');\r\n    section.className = 'debug-panel-section';\r\n\r\n    const toggle = document.createElement('button');\r\n    toggle.className = 'debug-panel-section-toggle';\r\n    toggle.type = 'button';\r\n    toggle.textContent = title;\r\n    const stateKey = contentId || `${title}-${sectionKeyCounter++}`;\r\n    toggle.dataset.sectionKey = stateKey;\r\n    section.appendChild(toggle);\r\n\r\n    const content = document.createElement('div');\r\n    content.className = 'debug-panel-section-content';\r\n    content.id = contentId;\r\n    content.dataset.sectionKey = stateKey;\r\n    contentBuilder(content);\r\n    section.appendChild(content);\r\n\r\n    toggle.addEventListener('click', () => {\r\n        const expanded = toggle.classList.toggle('expanded');\r\n        content.classList.toggle('active', expanded);\r\n    });\r\n\r\n\r\n    return section;\r\n}\r\n\r\nfunction createSubsection(title, contentBuilder, { defaultExpanded = false } = {}) {\r\n    const container = document.createElement('div');\r\n    container.className = 'debug-panel-subsection';\r\n\r\n    const toggle = document.createElement('button');\r\n    toggle.type = 'button';\r\n    toggle.className = 'debug-panel-subsection-toggle';\r\n    toggle.textContent = title;\r\n    const stateKey = `${title}-${subsectionKeyCounter++}`;\r\n    toggle.dataset.subsectionKey = stateKey;\r\n    container.appendChild(toggle);\r\n\r\n    const content = document.createElement('div');\r\n    content.className = 'debug-panel-subsection-content';\r\n    content.dataset.subsectionKey = stateKey;\r\n    contentBuilder(content);\r\n    container.appendChild(content);\r\n\r\n    toggle.addEventListener('click', () => {\r\n        const expanded = toggle.classList.toggle('expanded');\r\n        content.classList.toggle('active', expanded);\r\n    });\r\n\r\n    if (defaultExpanded) {\r\n        toggle.classList.add('expanded');\r\n        content.classList.add('active');\r\n    }\r\n\r\n    return container;\r\n}\r\n\r\nfunction bigNumEquals(a, b) {\r\n    if (a === b) return true;\r\n    if (a == null || b == null) return a == null && b == null;\r\n    if (typeof a?.cmp === 'function') {\r\n        try { return a.cmp(b) === 0; } catch {}\r\n    }\r\n    if (typeof b?.cmp === 'function') {\r\n        try { return b.cmp(a) === 0; } catch {}\r\n    }\r\n    try { return Object.is(String(a), String(b)); }\r\n    catch { return false; }\r\n}\r\n\r\nfunction bigNumToFiniteNumber(value) {\r\n    try {\r\n        const fromScientific = value?.toScientific?.(18);\r\n        const num = Number.parseFloat(fromScientific ?? value);\r\n        return Number.isFinite(num) ? num : Number.NaN;\r\n    } catch {\r\n        return Number.NaN;\r\n    }\r\n}\r\n\r\nfunction getCurrencyStorageKey(currencyKey, slot = getActiveSlot()) {\r\n    const resolvedSlot = slot ?? getActiveSlot();\r\n    if (resolvedSlot == null) return null;\r\n    return `${KEYS.CURRENCY[currencyKey]}:${resolvedSlot}`;\r\n}\r\n\r\nfunction getCurrencyValueForSlot(currencyKey, slot = getActiveSlot()) {\r\n    const resolvedSlot = slot ?? getActiveSlot();\r\n    if (resolvedSlot == null) return BigNum.fromInt(0);\r\n\r\n    const handle = bank?.[currencyKey];\r\n    if (handle) {\r\n        try { return handle.value ?? BigNum.fromInt(0); }\r\n        catch {}\r\n    }\r\n\r\n    try { return peekCurrency(resolvedSlot, currencyKey); }\r\n    catch { return BigNum.fromInt(0); }\r\n}\r\n\r\nfunction applyCurrencyState(currencyKey, value, slot = getActiveSlot()) {\r\n    const resolvedSlot = slot ?? getActiveSlot();\r\n    const previous = getCurrencyValueForSlot(currencyKey, resolvedSlot);\r\n    if (resolvedSlot == null || resolvedSlot !== getActiveSlot()) {\r\n        return { previous, next: previous };\r\n    }\r\n\r\n    const storageKey = getCurrencyStorageKey(currencyKey, resolvedSlot);\r\n    const wasLocked = storageKey && isStorageKeyLocked(storageKey);\r\n\r\n    if (wasLocked) unlockStorageKey(storageKey);\r\n\r\n    let next = previous;\r\n    try {\r\n        markSaveSlotModified(resolvedSlot);\r\n        const effective = setCurrency(currencyKey, value, { previous });\r\n        next = effective ?? previous;\r\n        if (storageKey) primeStorageWatcherSnapshot(storageKey);\r\n    } catch {}\r\n    finally {\r\n        if (wasLocked) lockStorageKey(storageKey);\r\n    }\r\n\r\n    refreshLiveBindings((binding) => binding.type === 'currency'\r\n        && binding.key === currencyKey\r\n        && binding.slot === resolvedSlot);\r\n\r\n    return { previous, next };\r\n}\r\n\r\nfunction buildOverrideKey(slot, key) {\r\n    return `${slot ?? 'null'}::${key}`;\r\n}\r\n\r\nfunction getCurrencyOverride(slot, key) {\r\n    return currencyOverrides.get(buildOverrideKey(slot, key)) ?? null;\r\n}\r\n\r\nfunction getCurrencyMultiplierStorageKey(currencyKey, slot = getActiveSlot()) {\r\n    const resolvedSlot = slot ?? getActiveSlot();\r\n    if (!currencyKey || resolvedSlot == null) return null;\r\n    return `${KEYS.MULTIPLIER[currencyKey]}:${resolvedSlot}`;\r\n}\r\n\r\nfunction isCurrencyMultiplierLocked(currencyKey, slot = getActiveSlot()) {\r\n    return isStorageKeyLocked(getCurrencyMultiplierStorageKey(currencyKey, slot));\r\n}\r\n\r\nfunction clearCurrencyMultiplierOverride(currencyKey, slot = getActiveSlot()) {\r\n    const cacheKey = buildOverrideKey(slot, currencyKey);\r\n    currencyOverrides.delete(cacheKey);\r\n    currencyOverrideBaselines.delete(cacheKey);\r\n    refreshLiveBindings((binding) => binding.type === 'currency-mult'\r\n        && binding.key === currencyKey\r\n        && binding.slot === slot);\r\n}\r\n\r\nfunction getStatOverride(slot, key) {\r\n    const lockAwareRefresh = !isStatMultiplierLocked(key, slot);\r\n    const cacheKey = buildOverrideKey(slot, key);\r\n    const cached = statOverrides.get(cacheKey);\r\n    if (!lockAwareRefresh && cached) return cached;\r\n\r\n    const fromStorage = loadStatMultiplierOverrideFromStorage(key, slot);\r\n    if (!fromStorage) {\r\n        if (lockAwareRefresh) statOverrides.delete(cacheKey);\r\n        return null;\r\n    }\r\n\r\n    statOverrides.set(cacheKey, fromStorage);\r\n    return fromStorage;\r\n}\r\n\r\nfunction notifyStatMultiplierChange(statKey, slot) {\r\n    refreshLiveBindings((binding) => binding.type === 'stat-mult'\r\n        && binding.key === statKey\r\n        && binding.slot === slot);\r\n}\r\n\r\nfunction clearStatMultiplierOverride(statKey, slot = getActiveSlot()) {\r\n    const storageKey = getStatMultiplierStorageKey(statKey, slot);\r\n    statOverrides.delete(buildOverrideKey(slot, statKey));\r\n    statOverrideBaselines.delete(buildOverrideKey(slot, statKey));\r\n    if (!storageKey || typeof localStorage === 'undefined') return;\r\n    if (isStorageKeyLocked(storageKey)) return;\r\n    try { localStorage.removeItem(storageKey); } catch {}\r\n    notifyStatMultiplierChange(statKey, slot);\r\n}\r\n\r\nfunction isStatMultiplierLocked(statKey, slot = getActiveSlot()) {\r\n    return isStorageKeyLocked(getStatMultiplierStorageKey(statKey, slot));\r\n}\r\n\r\nfunction getLockedStatOverride(slot, statKey) {\r\n    if (!isStatMultiplierLocked(statKey, slot)) return null;\r\n    return getStatOverride(slot, statKey);\r\n}\r\n\r\nfunction getStatMultiplierDisplayValue(statKey, slot = getActiveSlot()) {\r\n    const gameValue = getGameStatMultiplier(statKey);\r\n    const effectiveOverride = getEffectiveStatMultiplierOverride(statKey, slot, gameValue);\r\n    return effectiveOverride ?? gameValue;\r\n}\r\n\r\nfunction getStatMultiplierStorageKey(statKey, slot = getActiveSlot()) {\r\n    if (!statKey) return null;\r\n    const resolvedSlot = slot ?? getActiveSlot();\r\n    if (resolvedSlot == null) return null;\r\n    return `${STAT_MULTIPLIER_STORAGE_PREFIX}:${statKey}:${resolvedSlot}`;\r\n}\r\n\r\nfunction getGameStatMultiplier(statKey) {\r\n    try {\r\n        if (statKey === 'xp') {\r\n            const { xpGainMultiplier } = computeUpgradeEffects(AREA_KEYS.STARTER_COVE) ?? {};\r\n            if (xpGainMultiplier) return xpGainMultiplier;\r\n        } else if (statKey === 'mutation') {\r\n            const valueMult = getMpValueMultiplierBn?.();\r\n            if (valueMult) return valueMult;\r\n\r\n            const mult = getMutationMultiplier();\r\n            if (mult) return mult;\r\n        }\r\n    } catch {}\r\n\r\n    return BigNum.fromInt(1);\r\n}\r\n\r\nfunction loadStatMultiplierOverrideFromStorage(statKey, slot = getActiveSlot()) {\r\n    const storageKey = getStatMultiplierStorageKey(statKey, slot);\r\n    if (!storageKey || typeof localStorage === 'undefined') return null;\r\n    const raw = localStorage.getItem(storageKey);\r\n    if (!raw) return null;\r\n    try { return BigNum.fromAny(raw); }\r\n    catch { return null; }\r\n}\r\n\r\nfunction storeStatMultiplierOverride(statKey, slot, value) {\r\n    const storageKey = getStatMultiplierStorageKey(statKey, slot);\r\n    if (!storageKey || typeof localStorage === 'undefined') return;\r\n    try {\r\n        const bn = value instanceof BigNum ? value : BigNum.fromAny(value ?? 1);\r\n        const locked = isStorageKeyLocked(storageKey);\r\n        const setter = locked && originalSetItem ? originalSetItem : localStorage.setItem.bind(localStorage);\r\n        if (locked && !originalSetItem) unlockStorageKey(storageKey);\r\n        setter(storageKey, bn.toStorage?.() ?? String(bn));\r\n        if (locked && !originalSetItem) lockStorageKey(storageKey);\r\n    } catch {}\r\n}\r\n\r\nfunction applyCurrencyOverrideForSlot(currencyKey, slot = getActiveSlot()) {\r\n    if (slot == null) return;\r\n    const override = getCurrencyOverride(slot, currencyKey);\r\n    if (!override) return;\r\n    if (slot !== getActiveSlot()) return;\r\n\r\n    const cacheKey = buildOverrideKey(slot, currencyKey);\r\n    if (currencyOverrideApplications.has(cacheKey)) return;\r\n\r\n    currencyOverrideApplications.add(cacheKey);\r\n    try {\r\n        const current = bank?.[currencyKey]?.mult?.get?.();\r\n        if (!bigNumEquals(current, override)) {\r\n            bank?.[currencyKey]?.mult?.set?.(override);\r\n        }\r\n    } catch {} finally {\r\n        currencyOverrideApplications.delete(cacheKey);\r\n    }\r\n}\r\n\r\nlet currencyListenerAttached = false;\r\nfunction ensureCurrencyOverrideListener() {\r\n    if (currencyListenerAttached || typeof window === 'undefined') return;\r\n    currencyListenerAttached = true;\r\n    try {\r\n        window.addEventListener('currency:multiplier', (event) => {\r\n            const { key, slot, mult } = event?.detail ?? {};\r\n            const targetSlot = slot ?? getActiveSlot();\r\n            const cacheKey = buildOverrideKey(targetSlot, key);\r\n            if (!targetSlot || !currencyOverrides.has(cacheKey)) return;\r\n            if (currencyOverrideApplications.has(cacheKey)) return;\r\n\r\n            const baseline = currencyOverrideBaselines.get(cacheKey);\r\n            const override = getCurrencyOverride(targetSlot, key);\r\n\r\n            if (baseline && override && mult) {\r\n                const baselineNum = bigNumToFiniteNumber(baseline);\r\n                const nextNum = bigNumToFiniteNumber(mult);\r\n\r\n                if (\r\n                    Number.isFinite(baselineNum)\r\n                    && Number.isFinite(nextNum)\r\n                    && baselineNum !== 0\r\n                ) {\r\n                    const ratio = nextNum / baselineNum;\r\n                    if (ratio && ratio !== 1) {\r\n                        try {\r\n                            const scaledOverride = override.mulDecimal?.(ratio) ?? override;\r\n                            currencyOverrides.set(cacheKey, scaledOverride);\r\n                        } catch {}\r\n                    }\r\n                }\r\n\r\n                currencyOverrideBaselines.set(cacheKey, mult);\r\n            } else if (mult) {\r\n                currencyOverrideBaselines.set(cacheKey, mult);\r\n            }\r\n\r\n            applyCurrencyOverrideForSlot(key, targetSlot);\r\n        }, { passive: true });\r\n        window.addEventListener('saveSlot:change', () => {\r\n            applyAllCurrencyOverridesForActiveSlot();\r\n        }, { passive: true });\r\n    } catch {}\r\n}\r\n\r\nexport function applyAllCurrencyOverridesForActiveSlot() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return;\r\n    Object.values(CURRENCIES).forEach((key) => {\r\n        applyCurrencyOverrideForSlot(key, slot);\r\n    });\r\n}\r\n\r\nexport function setDebugCurrencyMultiplierOverride(currencyKey, value, slot = getActiveSlot()) {\r\n    if (!currencyKey || slot == null) return null;\r\n    ensureCurrencyOverrideListener();\r\n    let bn;\r\n    try { bn = value instanceof BigNum ? value.clone?.() ?? value : BigNum.fromAny(value ?? 1); }\r\n    catch { bn = BigNum.fromInt(1); }\r\n    const cacheKey = buildOverrideKey(slot, currencyKey);\r\n    currencyOverrides.set(cacheKey, bn);\r\n    const gameValue = bank?.[currencyKey]?.mult?.get?.();\r\n    currencyOverrideBaselines.set(cacheKey, gameValue);\r\n    applyCurrencyOverrideForSlot(currencyKey, slot);\r\n    return bn;\r\n}\r\n\r\n\r\nexport function getDebugCurrencyMultiplierOverride(currencyKey, slot = getActiveSlot()) {\r\n    if (!currencyKey || slot == null) return null;\r\n    return getCurrencyOverride(slot, currencyKey);\r\n}\r\n\r\nexport function setDebugStatMultiplierOverride(statKey, value, slot = getActiveSlot()) {\r\n    if (!statKey || slot == null) return null;\r\n    let bn;\r\n    try { bn = value instanceof BigNum ? value.clone?.() ?? value : BigNum.fromAny(value ?? 1); }\r\n    catch { bn = BigNum.fromInt(1); }\r\n    statOverrides.set(buildOverrideKey(slot, statKey), bn);\r\n    statOverrideBaselines.set(buildOverrideKey(slot, statKey), getGameStatMultiplier(statKey));\r\n    storeStatMultiplierOverride(statKey, slot, bn);\r\n    notifyStatMultiplierChange(statKey, slot);\r\n    return bn;\r\n}\r\n\r\nexport function getDebugStatMultiplierOverride(statKey, slot = getActiveSlot()) {\r\n    if (!statKey || slot == null) return null;\r\n    return getStatOverride(slot, statKey);\r\n}\r\n\r\nexport function applyStatMultiplierOverride(statKey, amount, slot = getActiveSlot()) {\r\n    const gameValue = getGameStatMultiplier(statKey);\r\n    const override = getEffectiveStatMultiplierOverride(statKey, slot, gameValue);\r\n    if (!override) return amount;\r\n\r\n    let base;\r\n    try {\r\n        base = amount instanceof BigNum ? amount.clone?.() ?? amount : BigNum.fromAny(amount ?? 0);\r\n    } catch {\r\n        return amount;\r\n    }\r\n\r\n    // If the caller is passing the raw in-game multiplier itself (e.g. XP Value,\r\n    // MP Value, etc.), avoid ratio math and just return the override directly.\r\n    // This prevents weird cases like 0.999... when we conceptually want 1.000...\r\n    try {\r\n        if (bigNumEquals(base, gameValue)) {\r\n            return override;\r\n        }\r\n    } catch {\r\n        // fall through and apply ratio logic below\r\n    }\r\n\r\n    try {\r\n        if (base.isZero?.()) return base;\r\n    } catch {\r\n        return base;\r\n    }\r\n\r\n    const cacheKey = buildOverrideKey(slot, statKey);\r\n    const baseline = statOverrideBaselines.get(cacheKey);\r\n    const multiplierForRatio =\r\n        (isStatMultiplierLocked(statKey, slot) && baseline) ? baseline : gameValue;\r\n\r\n    const overrideNum = bigNumToFiniteNumber(override);\r\n    const gameValueNum = bigNumToFiniteNumber(multiplierForRatio);\r\n    const ratio =\r\n        Number.isFinite(overrideNum) &&\r\n        Number.isFinite(gameValueNum) &&\r\n        gameValueNum !== 0\r\n            ? overrideNum / gameValueNum\r\n            : Number.NaN;\r\n\r\n    if (Number.isFinite(ratio) && ratio !== 1) {\r\n        try { return base.mulDecimal?.(ratio) ?? base; }\r\n        catch {}\r\n    }\r\n\r\n    return base;\r\n}\r\n\r\nfunction getEffectiveStatMultiplierOverride(statKey, slot, gameValue) {\r\n    const override = getStatOverride(slot, statKey);\r\n    const cacheKey = buildOverrideKey(slot, statKey);\r\n    if (!override) {\r\n        statOverrideBaselines.delete(cacheKey);\r\n        return null;\r\n    }\r\n\r\n    const baseline = statOverrideBaselines.get(cacheKey);\r\n    const locked = isStatMultiplierLocked(statKey, slot);\r\n\r\n    if (!baseline) {\r\n        statOverrideBaselines.set(cacheKey, gameValue);\r\n    } else if (!bigNumEquals(baseline, gameValue)) {\r\n        statOverrideBaselines.set(cacheKey, gameValue);\r\n        if (locked) {\r\n            return override;\r\n        }\r\n        statOverrideBaselines.set(cacheKey, gameValue);\r\n        clearStatMultiplierOverride(statKey, slot);\r\n        return null;\r\n    }\r\n\r\n    return override;\r\n}\r\n\r\nfunction ensureStorageLockPatch() {\r\n    if (storageLockPatched || typeof localStorage === 'undefined') return;\r\n    storageLockPatched = true;\r\n    try {\r\n        originalSetItem = localStorage.setItem.bind(localStorage);\r\n        originalRemoveItem = localStorage.removeItem.bind(localStorage);\r\n        localStorage.setItem = (key, value) => {\r\n            if (lockedStorageKeys.has(key)) return;\r\n            return originalSetItem(key, value);\r\n        };\r\n        localStorage.removeItem = (key) => {\r\n            if (lockedStorageKeys.has(key)) return;\r\n            return originalRemoveItem(key);\r\n        };\r\n    } catch {}\r\n}\r\n\r\nfunction isStorageKeyLocked(key) {\r\n    return key != null && lockedStorageKeys.has(key);\r\n}\r\n\r\nfunction lockStorageKey(key) {\r\n    if (!key) return;\r\n    ensureStorageLockPatch();\r\n    lockedStorageKeys.add(key);\r\n}\r\n\r\nfunction unlockStorageKey(key) {\r\n    if (!key) return;\r\n    lockedStorageKeys.delete(key);\r\n}\r\n\r\nfunction toggleStorageLock(key) {\r\n    if (!key) return false;\r\n    if (isStorageKeyLocked(key)) {\r\n        unlockStorageKey(key);\r\n        return false;\r\n    }\r\n    lockStorageKey(key);\r\n    return true;\r\n}\r\n\r\nfunction createLockToggle(storageKey, { onToggle } = {}) {\r\n    const button = document.createElement('button');\r\n    button.type = 'button';\r\n    button.className = 'debug-lock-button';\r\n\r\n    const refresh = () => {\r\n        const locked = isStorageKeyLocked(storageKey);\r\n        button.textContent = locked ? 'L' : 'UL';\r\n        button.classList.toggle('locked', locked);\r\n    };\r\n\r\n    button.addEventListener('click', () => {\r\n        toggleStorageLock(storageKey);\r\n        if (typeof onToggle === 'function') {\r\n            try { onToggle(isStorageKeyLocked(storageKey)); }\r\n            catch {}\r\n        }\r\n        refresh();\r\n    });\r\n\r\n    refresh();\r\n    return { button, refresh };\r\n}\r\n\r\napplyAllCurrencyOverridesForActiveSlot();\r\nensureCurrencyOverrideListener();\r\n\r\nfunction collapseAllDebugCategories() {\r\n    const panel = document.getElementById(DEBUG_PANEL_ID);\r\n    if (!panel) return;\r\n\r\n    panel.querySelectorAll('.debug-panel-section-toggle').forEach((toggle) => {\r\n        toggle.classList.remove('expanded');\r\n        const content = toggle.nextElementSibling;\r\n        if (content) content.classList.remove('active');\r\n    });\r\n\r\n    panel.querySelectorAll('.debug-panel-subsection-toggle').forEach((toggle) => {\r\n        toggle.classList.remove('expanded');\r\n        const content = toggle.nextElementSibling;\r\n        if (content) content.classList.remove('active');\r\n    });\r\n}\r\n\r\nfunction formatBigNumForInput(value) {\r\n    try {\r\n        const bn = value instanceof BigNum ? value : BigNum.fromAny(value ?? 0);\r\n        if (bn.isInfinite?.()) {\r\n            const precision = Number.parseInt(bn?.p, 10) || BigNum.DEFAULT_PRECISION;\r\n            return `BN:${precision}:1:${BigNum.MAX_E}`;\r\n        }\r\n        const storage = bn.toStorage?.();\r\n        const [, pStr = `${BigNum.DEFAULT_PRECISION}`, sigPart = '0', expPart = '0'] = (storage || '').split(':');\r\n        const precision = Number.parseInt(pStr, 10) || BigNum.DEFAULT_PRECISION;\r\n        if (bn.isZero?.()) {\r\n            return `BN:${precision}:${'0'.repeat(precision)}:-17`;\r\n        }\r\n        const paddedSig = sigPart.padStart(precision, '0');\r\n        return `BN:${precision}:${paddedSig}:${expPart}`;\r\n    } catch {\r\n        return String(value ?? '');\r\n    }\r\n}\r\n\r\nfunction parseBigNumInput(raw) {\r\n    const trimmed = String(raw ?? '').trim();\r\n    if (!trimmed) return BigNum.fromInt(0);\r\n    try {\r\n        if (/^inf(?:inity)?$/i.test(trimmed)) {\r\n            return BigNum.fromAny('Infinity');\r\n        }\r\n        return BigNum.fromAny(trimmed);\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction setInputValidity(input, valid) {\r\n    input.classList.toggle('debug-invalid', !valid);\r\n}\r\n\r\nfunction flagDebugUsage() {\r\n    const slot = getActiveSlot();\r\n    try { markSaveSlotModified(slot); }\r\n    catch {}\r\n    try { window.dispatchEvent(new CustomEvent('debug:change', { detail: { slot } })); }\r\n    catch {}\r\n}\r\n\r\nfunction getActionLogKey(slot = getActiveSlot()) {\r\n    if (slot == null) return null;\r\n    return `${ACTION_LOG_STORAGE_PREFIX}:${slot}`;\r\n}\r\n\r\nfunction getCurrentActionLog(slot = getActiveSlot()) {\r\n    const key = getActionLogKey(slot);\r\n    if (!key) return [];\r\n\r\n    let raw = null;\r\n    try { raw = localStorage.getItem(key); }\r\n    catch {}\r\n    if (!raw) return [];\r\n\r\n    try {\r\n        const parsed = JSON.parse(raw);\r\n        return Array.isArray(parsed) ? parsed : [];\r\n    } catch {\r\n        return [];\r\n    }\r\n}\r\n\r\nfunction persistActionLog(entries, slot = getActiveSlot()) {\r\n    const key = getActionLogKey(slot);\r\n    if (!key || typeof localStorage === 'undefined') return;\r\n\r\n    const trimmed = (Array.isArray(entries) ? entries : []).slice(0, MAX_ACTION_LOG_ENTRIES);\r\n    try { localStorage.setItem(key, JSON.stringify(trimmed)); }\r\n    catch {}\r\n}\r\n\r\nfunction appendActionLogEntry(entry, slot = getActiveSlot()) {\r\n    const log = getCurrentActionLog(slot);\r\n    log.unshift(entry);\r\n    if (log.length > MAX_ACTION_LOG_ENTRIES) {\r\n        log.length = MAX_ACTION_LOG_ENTRIES;\r\n    }\r\n    persistActionLog(log, slot);\r\n    return log;\r\n}\r\n\r\nfunction logAction(message) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return;\r\n\r\n    const now = new Date();\r\n    const entry = {\r\n        time: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n        message,\r\n        timestamp: now.getTime(),\r\n    };\r\n    appendActionLogEntry(entry, slot);\r\n    updateActionLogDisplay();\r\n}\r\n\r\nfunction updateActionLogDisplay() {\r\n    if (!actionLogContainer) return;\r\n\r\n    const actionLog = getCurrentActionLog();\r\n    if (actionLog.length === 0) {\r\n        actionLogContainer.innerHTML = '';\r\n        const msg = document.createElement('div');\r\n        msg.className = 'action-log-empty';\r\n        msg.textContent = 'Actions you perform in the Debug Panel will be logged permanently in this action log.';\r\n        actionLogContainer.appendChild(msg);\r\n        return;\r\n    }\r\n\r\n    actionLogContainer.innerHTML = actionLog.map((entry) => {\r\n        let formattedMessage = entry.message?.replace?.(/\\[GOLD\\](.*?)\\[\\/GOLD\\]/g, '<span class=\"action-log-gold\">$1</span>') ?? '';\r\n\t\tformattedMessage = formattedMessage.replace(/\\b(?:Level|Lv)\\s?(\\d+)\\b/g, '<span class=\"action-log-level\">Lv$1</span>');\r\n        formattedMessage = formattedMessage.replace(/(\\d[\\d,.]*(?:e[+-]?\\d+)*(?:[KMBTQa-zA-Z]*))/g, (match) => /\\d/.test(match) ? `<span class=\"action-log-number\">${match}</span>` : match);\r\n\t\tformattedMessage = formattedMessage.replace(/<span[^>]*class=\"[^\"]*infinity-symbol[^\"]*\"[^>]*>\u221E<\\/span>/g, '<span class=\"action-log-number\">inf</span>');\r\n\t\tformattedMessage = formattedMessage.replace(/\u221E/g,'<span class=\"action-log-number\">inf</span>');\r\n\r\n\r\n        return `\r\n            <div class=\"action-log-entry\">\r\n                <span class=\"action-log-time\">${entry.time}:</span>\r\n                <span class=\"action-log-message\">${formattedMessage}</span>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\nfunction dialogueStateStorageKey(slot = getActiveSlot()) {\r\n    if (slot == null) return null;\r\n    return `${MERCHANT_DLG_STATE_KEY_BASE}:${slot}`;\r\n}\r\n\r\nfunction persistDialogueState(state, slot = getActiveSlot()) {\r\n    const key = dialogueStateStorageKey(slot);\r\n    if (!key) return;\r\n    try {\r\n        const payload = JSON.stringify(state || {});\r\n        localStorage.setItem(key, payload);\r\n    } catch {}\r\n}\r\n\r\nfunction loadDialogueState(slot = getActiveSlot()) {\r\n    const key = dialogueStateStorageKey(slot);\r\n    if (!key) return {};\r\n    try {\r\n        const raw = localStorage.getItem(key);\r\n        return raw ? JSON.parse(raw) : {};\r\n    } catch {\r\n        return {};\r\n    }\r\n}\r\n\r\nfunction grantDialogueReward(reward) {\r\n    if (!reward) return;\r\n    if (reward.type === 'coins') {\r\n        try { bank.coins.add(reward.amount); }\r\n        catch (e) { console.warn('Failed to grant coin reward:', reward, e); }\r\n        return;\r\n    }\r\n    if (reward.type === 'books') {\r\n        try {\r\n            bank.books.addWithMultiplier?.(reward.amount) ?? bank.books.add(reward.amount);\r\n        } catch (e) {\r\n            console.warn('Failed to grant book reward:', reward, e);\r\n        }\r\n        return;\r\n    }\r\n    try { window.dispatchEvent(new CustomEvent('merchantReward', { detail: reward })); }\r\n    catch {}\r\n}\r\n\r\nfunction completeAllDialoguesForDebug() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return { completed: 0 };\r\n\r\n    const state = loadDialogueState(slot);\r\n    let completed = 0;\r\n\r\n    Object.entries(DLG_CATALOG).forEach(([id, meta]) => {\r\n        const key = String(id);\r\n        const prev = state[key] || {};\r\n        const alreadyClaimed = !!prev.claimed;\r\n        const next = Object.assign({}, prev, { status: 'unlocked', claimed: true });\r\n        state[key] = next;\r\n        if (!alreadyClaimed) {\r\n            completed += 1;\r\n            grantDialogueReward(meta.reward);\r\n        }\r\n    });\r\n\r\n    persistDialogueState(state, slot);\r\n    return { completed };\r\n}\r\n\r\nfunction restoreAllDialoguesForDebug() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return { restored: 0 };\r\n\r\n    const state = loadDialogueState(slot);\r\n    let restored = 0;\r\n\r\n    Object.entries(DLG_CATALOG).forEach(([id]) => {\r\n        const key = String(id);\r\n        const prev = state[key] || {};\r\n        if (prev.claimed) restored += 1;\r\n        state[key] = Object.assign({}, prev, { claimed: false });\r\n    });\r\n\r\n    persistDialogueState(state, slot);\r\n    return { restored };\r\n}\r\n\r\nfunction createInputRow(labelText, initialValue, onCommit, { idLabel, storageKey, onLockChange } = {}) {\r\n    const row = document.createElement('div');\r\n    row.className = 'debug-panel-row';\r\n\r\n    const label = document.createElement('label');\r\n    label.textContent = labelText;\r\n    if (idLabel != null) {\r\n        label.append(' ');\r\n        const idSpan = document.createElement('span');\r\n        idSpan.className = 'debug-panel-id';\r\n        idSpan.textContent = `(ID: ${idLabel})`;\r\n        label.appendChild(idSpan);\r\n    }\r\n    row.appendChild(label);\r\n\r\n    const input = document.createElement('input');\r\n    input.type = 'text';\r\n    input.className = 'debug-panel-input';\r\n    let editing = false;\r\n    let pendingValue = null;\r\n    let skipBlurCommit = false;\r\n    const lockToggle = storageKey ? createLockToggle(storageKey, { onToggle: onLockChange }) : null;\r\n\r\n    const setValue = (value) => {\r\n        if (editing) {\r\n            pendingValue = value;\r\n            return;\r\n        }\r\n        pendingValue = null;\r\n        input.value = formatBigNumForInput(value);\r\n    };\r\n\r\n    row.appendChild(input);\r\n    if (lockToggle) {\r\n        row.appendChild(lockToggle.button);\r\n    }\r\n\r\n    const commitValue = () => {\r\n        const parsed = parseBigNumInput(input.value);\r\n        if (!parsed) {\r\n            setInputValidity(input, false);\r\n            return;\r\n        }\r\n        setInputValidity(input, true);\r\n\r\n        const wasLocked = storageKey && isStorageKeyLocked(storageKey);\r\n        if (wasLocked) unlockStorageKey(storageKey);\r\n        try {\r\n            onCommit(parsed, { input, setValue });\r\n        } finally {\r\n            if (wasLocked) lockStorageKey(storageKey);\r\n            if (lockToggle) lockToggle.refresh();\r\n        }\r\n    };\r\n\r\n    input.addEventListener('focus', () => { editing = true; });\r\n    input.addEventListener('change', commitValue);\r\n    input.addEventListener('keydown', (event) => {\r\n        if (event.key === 'Enter') {\r\n            event.preventDefault();\r\n            skipBlurCommit = true;\r\n            commitValue();\r\n            input.blur();\r\n        }\r\n    });\r\n    input.addEventListener('blur', () => {\r\n        editing = false;\r\n        if (!skipBlurCommit) {\r\n            commitValue();\r\n        }\r\n        skipBlurCommit = false;\r\n        if (pendingValue != null) {\r\n            const next = pendingValue;\r\n            pendingValue = null;\r\n            setValue(next);\r\n        }\r\n    });\r\n\r\n    setValue(initialValue);\r\n    if (lockToggle) lockToggle.refresh();\r\n\r\n    return { row, input, setValue, isEditing: () => editing };\r\n}\r\n\r\nfunction createUnlockToggleRow({ labelText, description, isUnlocked, onEnable, onDisable, slot }) {\r\n    const row = document.createElement('div');\r\n    row.className = 'debug-panel-row debug-unlock-row';\r\n\r\n    const toggle = document.createElement('label');\r\n    toggle.className = 'flag-toggle';\r\n    toggle.setAttribute('aria-label', labelText);\r\n\r\n    const input = document.createElement('input');\r\n    input.type = 'checkbox';\r\n\r\n    const slider = document.createElement('span');\r\n    slider.className = 'flag-slider';\r\n\r\n    toggle.appendChild(input);\r\n    toggle.appendChild(slider);\r\n\r\n    const textContainer = document.createElement('div');\r\n    textContainer.className = 'debug-unlock-text';\r\n\r\n    const title = document.createElement('span');\r\n    title.className = 'debug-unlock-title';\r\n    title.textContent = labelText;\r\n    textContainer.appendChild(title);\r\n\r\n    if (description) {\r\n        const desc = document.createElement('span');\r\n        desc.className = 'debug-unlock-desc';\r\n        desc.textContent = `- ${description}`;\r\n        textContainer.appendChild(desc);\r\n    }\r\n\r\n    row.appendChild(toggle);\r\n    row.appendChild(textContainer);\r\n\r\n    const toggleRow = () => {\r\n        input.checked = !input.checked;\r\n        input.dispatchEvent(new Event('change', { bubbles: true }));\r\n    };\r\n\r\n    row.addEventListener('click', (event) => {\r\n        if (toggle.contains(event.target)) return;\r\n        toggleRow();\r\n    });\r\n\r\n    let lastKnown = false;\r\n\r\n    const refresh = () => {\r\n        let unlocked = false;\r\n        try { unlocked = typeof isUnlocked === 'function' ? !!isUnlocked() : false; }\r\n        catch {}\r\n        input.checked = unlocked;\r\n        lastKnown = unlocked;\r\n        return unlocked;\r\n    };\r\n\r\n    input.addEventListener('change', () => {\r\n        const previous = lastKnown;\r\n        const unlocked = input.checked;\r\n        try {\r\n            if (unlocked) {\r\n                onEnable?.();\r\n            } else {\r\n                onDisable?.();\r\n            }\r\n        } catch {}\r\n        flagDebugUsage();\r\n        const refreshed = refresh();\r\n        if (previous !== refreshed) {\r\n            logAction(`Toggled ${labelText} [GOLD]${previous ? 'True' : 'False'}[/GOLD] \u2192 [GOLD]${refreshed ? 'True' : 'False'}[/GOLD]`);\r\n        }\r\n    });\r\n\r\n    refresh();\r\n    registerLiveBinding({ type: 'unlock', slot, refresh });\r\n    return row;\r\n}\r\n\r\nfunction formatCalculatorResult(value) {\r\n    try {\r\n        if (value instanceof BigNum || typeof value?.toScientific === 'function') {\r\n            return formatNumber(value);\r\n        }\r\n        const num = Number(value);\r\n        if (Number.isFinite(num)) {\r\n            return formatNumber(num);\r\n        }\r\n        return String(value ?? '\u2014');\r\n    } catch {\r\n        return '\u2014';\r\n    }\r\n}\r\n\r\nfunction createCalculatorRow({ labelText, inputs = [], compute }) {\r\n    const row = document.createElement('div');\r\n    row.className = 'debug-panel-row debug-calculator-row';\r\n\r\n    const label = document.createElement('label');\r\n    label.textContent = labelText;\r\n    row.appendChild(label);\r\n\r\n    const controls = document.createElement('div');\r\n    controls.className = 'debug-calculator-inputs';\r\n    row.appendChild(controls);\r\n\r\n    const output = document.createElement('div');\r\n    output.className = 'debug-calculator-output';\r\n    output.textContent = '\u2014';\r\n    row.appendChild(output);\r\n\r\n    const fieldEls = [];\r\n\r\n    const recompute = () => {\r\n        const values = {};\r\n        let hasError = false;\r\n\r\n        fieldEls.forEach(({ config, el }) => {\r\n            if (config.type === 'select') {\r\n                values[config.key] = el.value;\r\n                return;\r\n            }\r\n\r\n            const parsed = parseBigNumInput(el.value);\r\n            const valid = parsed instanceof BigNum;\r\n            setInputValidity(el, valid);\r\n            if (!valid) {\r\n                hasError = true;\r\n                return;\r\n            }\r\n            values[config.key] = parsed;\r\n        });\r\n\r\n        if (hasError || typeof compute !== 'function') {\r\n            output.textContent = '\u2014';\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const result = compute(values);\r\n            output.innerHTML = formatCalculatorResult(result);\r\n        } catch {\r\n            output.textContent = '\u2014';\r\n        }\r\n    };\r\n\r\n    inputs.forEach((inputConfig) => {\r\n        const config = Object.assign({ type: 'text', defaultValue: '' }, inputConfig);\r\n        if (!config.key) return;\r\n\r\n        if (config.type === 'select') {\r\n            const select = document.createElement('select');\r\n            select.className = 'debug-panel-input';\r\n            (config.options || []).forEach(({ value, label: optLabel }) => {\r\n                const option = document.createElement('option');\r\n                option.value = value;\r\n                option.textContent = optLabel ?? value;\r\n                if (config.defaultValue != null && config.defaultValue === value) {\r\n                    option.selected = true;\r\n                }\r\n                select.appendChild(option);\r\n            });\r\n            select.addEventListener('change', recompute);\r\n            controls.appendChild(select);\r\n            fieldEls.push({ config, el: select });\r\n        } else {\r\n            const input = document.createElement('input');\r\n            input.type = 'text';\r\n            input.className = 'debug-panel-input';\r\n            input.placeholder = config.label || '';\r\n            input.value = config.defaultValue ?? '';\r\n            input.addEventListener('input', recompute);\r\n            input.addEventListener('keydown', (event) => {\r\n                if (event.key === 'Enter') {\r\n                    event.preventDefault();\r\n                    recompute();\r\n                }\r\n            });\r\n            controls.appendChild(input);\r\n            fieldEls.push({ config, el: input });\r\n        }\r\n    });\r\n\r\n    recompute();\r\n\r\n    return row;\r\n}\r\n\r\nfunction applyXpState({ level, progress }) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return;\r\n\r\n    // If we're manually editing XP stats from the debug panel, the XP system\r\n    // should be treated as unlocked.\r\n    try { unlockXpSystem(); } catch {}\r\n\r\n    const unlockKey = XP_KEYS.unlock(slot);\r\n    try { localStorage.setItem(unlockKey, '1'); } catch {}\r\n    primeStorageWatcherSnapshot(unlockKey, '1');\r\n\r\n    if (level != null) {\r\n        try {\r\n            const raw = level.toStorage?.() ?? BigNum.fromAny(level).toStorage();\r\n            const key = XP_KEYS.level(slot);\r\n            localStorage.setItem(key, raw);\r\n            primeStorageWatcherSnapshot(key, raw);\r\n        } catch {}\r\n    }\r\n\r\n    if (progress != null) {\r\n        try {\r\n            const raw = progress.toStorage?.() ?? BigNum.fromAny(progress).toStorage();\r\n            const key = XP_KEYS.progress(slot);\r\n            localStorage.setItem(key, raw);\r\n            primeStorageWatcherSnapshot(key, raw);\r\n        } catch {}\r\n    }\r\n\r\n    try {\r\n        initXpSystem({ forceReload: true });\r\n    } catch {}\r\n\r\n    // Let any XP listeners know we've made a manual change so dependent UI (like\r\n    // the Forge reset panel) can refresh immediately without waiting for normal\r\n    // gameplay hooks to fire.\r\n    try {\r\n        broadcastXpChange({ changeType: 'debug-panel', slot });\r\n    } catch {}\r\n\r\n    // Also keep ALL debug live bindings in sync (including the Unlocks tab\r\n    // \"Unlock XP\" flag, which reads getXpState().unlocked).\r\n    try {\r\n        refreshLiveBindings();\r\n    } catch {}\r\n}\r\n\r\nfunction applyMutationState({ level, progress }) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return;\r\n\r\n    // If the MP system isn't unlocked yet, setting its level/progress should\r\n    // auto-enable the relevant unlock flags so the UI and systems stay in\r\n    // sync.\r\n    try {\r\n        const forgeUnlocked = typeof isForgeUnlocked === 'function' ? isForgeUnlocked() : false;\r\n        const forgeOverride = typeof getForgeDebugOverrideState === 'function'\r\n            ? getForgeDebugOverrideState()\r\n            : null;\r\n        if (!forgeUnlocked && forgeOverride !== true) {\r\n            setForgeDebugOverride?.(true);\r\n        }\r\n    } catch {}\r\n\r\n    try {\r\n        if (typeof hasDoneForgeReset === 'function' && !hasDoneForgeReset()) {\r\n            setForgeResetCompleted?.(true);\r\n        }\r\n    } catch {}\r\n\r\n    try { setMutationUnlockedForDebug(true); } catch {}\r\n\r\n    try { updateResetPanel?.(); } catch {}\r\n\r\n    // Make sure the mutation / MP system is treated as unlocked if we're\r\n    // manually editing its stats from the debug panel.\r\n    try { initMutationSystem(); } catch {}\r\n    try { unlockMutationSystem(); } catch {}\r\n\r\n    const unlockKey = MUTATION_KEYS.unlock(slot);\r\n    try { localStorage.setItem(unlockKey, '1'); } catch {}\r\n    primeStorageWatcherSnapshot(unlockKey, '1');\r\n\r\n    if (level != null) {\r\n        try {\r\n            const raw = level.toStorage?.() ?? BigNum.fromAny(level).toStorage();\r\n            const key = MUTATION_KEYS.level(slot);\r\n            localStorage.setItem(key, raw);\r\n            primeStorageWatcherSnapshot(key, raw);\r\n        } catch {}\r\n    }\r\n\r\n    if (progress != null) {\r\n        try {\r\n            const raw = progress.toStorage?.() ?? BigNum.fromAny(progress).toStorage();\r\n            const key = MUTATION_KEYS.progress(slot);\r\n            localStorage.setItem(key, raw);\r\n            primeStorageWatcherSnapshot(key, raw);\r\n        } catch {}\r\n    }\r\n\r\n    try {\r\n        initMutationSystem({ forceReload: true });\r\n    } catch {}\r\n\r\n    try {\r\n        broadcastMutationChange({ changeType: 'debug-panel', slot });\r\n    } catch {}\r\n\r\n    // Keep all debug rows that depend on mutation / MP state in sync.\r\n    try {\r\n        refreshLiveBindings();\r\n    } catch {}\r\n}\r\n\r\nfunction buildAreaCurrencies(container, area) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const msg = document.createElement('div');\r\n        msg.className = 'debug-panel-empty';\r\n        msg.textContent = 'Select a save slot to edit currency values.';\r\n        container.appendChild(msg);\r\n        return;\r\n    }\r\n\r\n    const areaLabel = area?.title ?? area?.key ?? 'Unknown Area';\r\n\r\n    area.currencies.forEach((currency) => {\r\n        const storageKey = getCurrencyStorageKey(currency.key, slot);\r\n        const current = getCurrencyValueForSlot(currency.key, slot);\r\n        const currencyRow = createInputRow(currency.label, current, (value, { setValue }) => {\r\n            const latestSlot = getActiveSlot();\r\n            if (latestSlot == null) return;\r\n            if (latestSlot !== slot) return;\r\n\r\n            const { previous, next } = applyCurrencyState(currency.key, value, latestSlot);\r\n            setValue(next);\r\n            if (!bigNumEquals(previous, next)) {\r\n                flagDebugUsage();\r\n                logAction(`Modified ${currency.label} (${areaLabel}) ${formatNumber(previous)} \u2192 ${formatNumber(next)}`);\r\n            }\r\n        }, {\r\n            storageKey,\r\n            onLockChange: () => currencyRow.setValue(getCurrencyValueForSlot(currency.key, getActiveSlot())),\r\n        });\r\n        registerLiveBinding({\r\n            type: 'currency',\r\n            key: currency.key,\r\n            slot,\r\n            refresh: () => {\r\n                if (slot !== getActiveSlot()) return;\r\n                const latest = getCurrencyValueForSlot(currency.key, slot);\r\n                currencyRow.setValue(latest);\r\n            },\r\n        });\r\n        container.appendChild(currencyRow.row);\r\n    });\r\n}\r\n\r\nfunction buildAreaStats(container, area) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const msg = document.createElement('div');\r\n        msg.className = 'debug-panel-empty';\r\n        msg.textContent = 'Select a save slot to edit stats.';\r\n        container.appendChild(msg);\r\n        return;\r\n    }\r\n\r\n    const xp = getXpState();\r\n    const mutation = getMutationState();\r\n    const areaLabel = area?.title ?? area?.key ?? 'Unknown Area';\r\n\r\n    const xpLevelKey = XP_KEYS.level(slot);\r\n    const xpLevelRow = createInputRow('XP Level', xp.xpLevel, (value, { setValue }) => {\r\n        const prev = getXpState().xpLevel;\r\n        applyXpState({ level: value });\r\n        const latest = getXpState();\r\n        setValue(latest.xpLevel);\r\n        if (!bigNumEquals(prev, latest.xpLevel)) {\r\n            flagDebugUsage();\r\n            logAction(`Modified XP Level (${areaLabel}) ${formatNumber(prev)} \u2192 ${formatNumber(latest.xpLevel)}`);\r\n        }\r\n    }, { storageKey: xpLevelKey });\r\n    registerLiveBinding({\r\n        type: 'xp',\r\n        slot,\r\n        refresh: () => {\r\n            if (slot !== getActiveSlot()) return;\r\n            xpLevelRow.setValue(getXpState().xpLevel);\r\n        },\r\n    });\r\n    container.appendChild(xpLevelRow.row);\r\n\r\n    const xpProgressKey = XP_KEYS.progress(slot);\r\n    const xpProgressRow = createInputRow('XP Progress', xp.progress, (value, { setValue }) => {\r\n        const prev = getXpState();\r\n        const prevLevel = prev?.xpLevel?.clone?.() ?? prev?.xpLevel;\r\n        const prevProgress = prev?.progress?.clone?.() ?? prev?.progress;\r\n        applyXpState({ progress: value });\r\n        const latest = getXpState();\r\n        setValue(latest.progress);\r\n        xpLevelRow.setValue(latest.xpLevel);\r\n        if (!bigNumEquals(prevProgress, latest.progress) || !bigNumEquals(prevLevel, latest.xpLevel)) {\r\n            flagDebugUsage();\r\n            logAction(`Modified XP Progress (${areaLabel}) ${formatNumber(prevProgress)} \u2192 ${formatNumber(latest.progress)}`);\r\n        }\r\n    }, { storageKey: xpProgressKey });\r\n    registerLiveBinding({\r\n        type: 'xp',\r\n        slot,\r\n        refresh: () => {\r\n            if (slot !== getActiveSlot()) return;\r\n            xpProgressRow.setValue(getXpState().progress);\r\n        },\r\n    });\r\n    container.appendChild(xpProgressRow.row);\r\n\r\n    const mpLevelKey = MUTATION_KEYS.level(slot);\r\n    const mpLevelRow = createInputRow('MP Level', mutation.level, (value, { setValue }) => {\r\n        const prev = getMutationState().level;\r\n        applyMutationState({ level: value });\r\n        const latest = getMutationState();\r\n        setValue(latest.level);\r\n        if (!bigNumEquals(prev, latest.level)) {\r\n            flagDebugUsage();\r\n            logAction(`Modified MP Level (${areaLabel}) ${formatNumber(prev)} \u2192 ${formatNumber(latest.level)}`);\r\n        }\r\n    }, { storageKey: mpLevelKey });\r\n    registerLiveBinding({\r\n        type: 'mutation',\r\n        slot,\r\n        refresh: () => {\r\n            if (slot !== getActiveSlot()) return;\r\n            mpLevelRow.setValue(getMutationState().level);\r\n        },\r\n    });\r\n    container.appendChild(mpLevelRow.row);\r\n\r\n    const mpProgressKey = MUTATION_KEYS.progress(slot);\r\n    const mpProgressRow = createInputRow('MP Progress', mutation.progress, (value, { setValue }) => {\r\n        const prev = getMutationState();\r\n        const prevLevel = prev?.level?.clone?.() ?? prev?.level;\r\n        const prevProgress = prev?.progress?.clone?.() ?? prev?.progress;\r\n        applyMutationState({ progress: value });\r\n        const latest = getMutationState();\r\n        setValue(latest.progress);\r\n        mpLevelRow.setValue(latest.level);\r\n        if (!bigNumEquals(prevProgress, latest.progress) || !bigNumEquals(prevLevel, latest.level)) {\r\n            flagDebugUsage();\r\n            logAction(`Modified MP Progress (${areaLabel}) ${formatNumber(prevProgress)} \u2192 ${formatNumber(latest.progress)}`);\r\n        }\r\n    }, { storageKey: mpProgressKey });\r\n    registerLiveBinding({\r\n        type: 'mutation',\r\n        slot,\r\n        refresh: () => {\r\n            if (slot !== getActiveSlot()) return;\r\n            mpProgressRow.setValue(getMutationState().progress);\r\n        },\r\n    });\r\n    container.appendChild(mpProgressRow.row);\r\n}\r\n\r\nfunction buildAreaUpgrades(container, area) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const msg = document.createElement('div');\r\n        msg.className = 'debug-panel-empty';\r\n        msg.textContent = 'Select a save slot to edit upgrades.';\r\n        container.appendChild(msg);\r\n        return;\r\n    }\r\n\r\n    const upgrades = getUpgradesForArea(area.key);\r\n    if (!upgrades || upgrades.length === 0) {\r\n        const msg = document.createElement('div');\r\n        msg.className = 'debug-panel-empty';\r\n        msg.textContent = 'No upgrades found for this area yet.';\r\n        container.appendChild(msg);\r\n        return;\r\n    }\r\n\r\n    const areaLabel = area?.title ?? area?.key ?? 'Unknown Area';\r\n\r\n    upgrades.forEach((upg) => {\r\n        const idLabel = upg.id ?? upg.tie ?? upg.tieKey;\r\n        const title = upg.title || `Upgrade ${idLabel ?? ''}`.trim();\r\n        const current = getLevel(area.key, upg.id ?? upg.tie);\r\n        const upgradeRow = createInputRow(title, current, (value, { setValue }) => {\r\n            const latestSlot = getActiveSlot();\r\n            if (latestSlot == null) return;\r\n            const previous = getLevel(area.key, upg.id ?? upg.tie);\r\n            try { setLevel(area.key, upg.id ?? upg.tie, value, false); } catch {}\r\n            const refreshed = getLevel(area.key, upg.id ?? upg.tie);\r\n            setValue(refreshed);\r\n            if (!bigNumEquals(previous, refreshed)) {\r\n                flagDebugUsage();\r\n                logAction(`Modified ${title} (${areaLabel} - ID: ${idLabel ?? 'Unknown'}) Lv${formatNumber(previous)} \u2192 Lv${formatNumber(refreshed)}`);\r\n            }\r\n        }, { idLabel });\r\n        registerLiveBinding({\r\n            type: 'upgrade',\r\n            slot,\r\n            refresh: () => {\r\n                if (slot !== getActiveSlot()) return;\r\n                const refreshed = getLevel(area.key, upg.id ?? upg.tie);\r\n                upgradeRow.setValue(refreshed);\r\n            },\r\n        });\r\n        container.appendChild(upgradeRow.row);\r\n    });\r\n}\r\n\r\nfunction buildAreaCurrencyMultipliers(container, area) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const msg = document.createElement('div');\r\n        msg.className = 'debug-panel-empty';\r\n        msg.textContent = 'Select a save slot to edit currency multipliers.';\r\n        container.appendChild(msg);\r\n        return;\r\n    }\r\n\r\n    const areaLabel = area?.title ?? area?.key ?? 'Unknown Area';\r\n\r\n    area.currencies.forEach((currency) => {\r\n        const handle = bank?.[currency.key]?.mult;\r\n        const currentOverride = getDebugCurrencyMultiplierOverride(currency.key, slot);\r\n        const current = currentOverride ?? handle?.get?.() ?? BigNum.fromInt(1);\r\n        const storageKey = `${KEYS.MULTIPLIER[currency.key]}:${slot}`;\r\n        const row = createInputRow(`${currency.label} Multiplier`, current, (value, { setValue }) => {\r\n            const latestSlot = getActiveSlot();\r\n            if (latestSlot == null) return;\r\n            const previous = getDebugCurrencyMultiplierOverride(currency.key, latestSlot)\r\n                ?? handle?.get?.()\r\n                ?? BigNum.fromInt(1);\r\n            try { setDebugCurrencyMultiplierOverride(currency.key, value, latestSlot); } catch {}\r\n            applyAllCurrencyOverridesForActiveSlot();\r\n            const refreshedOverride = getDebugCurrencyMultiplierOverride(currency.key, latestSlot);\r\n            const refreshed = refreshedOverride ?? handle?.get?.() ?? BigNum.fromInt(1);\r\n            setValue(refreshed);\r\n            if (!bigNumEquals(previous, refreshed)) {\r\n                flagDebugUsage();\r\n                logAction(`Modified ${currency.label} Multiplier (${areaLabel}) ${formatNumber(previous)} \u2192 ${formatNumber(refreshed)}`);\r\n            }\r\n        }, { storageKey });\r\n        registerLiveBinding({\r\n            type: 'currency-mult',\r\n            key: currency.key,\r\n            slot,\r\n            refresh: () => {\r\n                if (slot !== getActiveSlot()) return;\r\n                const latestOverride = getDebugCurrencyMultiplierOverride(currency.key, slot);\r\n                const latest = latestOverride ?? handle?.get?.() ?? BigNum.fromInt(1);\r\n                row.setValue(latest);\r\n            },\r\n        });\r\n        container.appendChild(row.row);\r\n    });\r\n}\r\n\r\nfunction setAllCurrenciesToInfinity() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return 0;\r\n\r\n    const inf = BigNum.fromAny('Infinity');\r\n    let updated = 0;\r\n\r\n    Object.values(CURRENCIES).forEach((key) => {\r\n        const handle = bank?.[key];\r\n        if (!handle) return;\r\n        try {\r\n            const current = handle.value ?? handle.get?.();\r\n            const isAlreadyInf =\r\n                current?.isInfinite?.() ||\r\n                bigNumEquals(current, inf);\r\n\r\n            if (isAlreadyInf) return;\r\n\r\n            handle.set(inf);\r\n            updated += 1;\r\n        } catch {}\r\n    });\r\n\r\n    return updated;\r\n}\r\n\r\nfunction setAllCurrenciesToZero() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return 0;\r\n\r\n    const zero = BigNum.fromInt(0);\r\n    let updated = 0;\r\n\r\n    Object.values(CURRENCIES).forEach((key) => {\r\n        const handle = bank?.[key];\r\n        if (!handle) return;\r\n        try {\r\n            handle.set?.(zero);\r\n            updated += 1;\r\n        } catch {}\r\n    });\r\n\r\n    return updated;\r\n}\r\n\r\nfunction setAllStatsToInfinity() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return 0;\r\n\r\n    const inf = BigNum.fromAny('Infinity');\r\n    let touched = 0;\r\n\r\n    let xpState;\r\n    let mutationState;\r\n\r\n    try { xpState = getXpState(); } catch {}\r\n    try { mutationState = getMutationState(); } catch {}\r\n\r\n    // XP: only touch if unlocked and level/progress aren\u2019t already infinite\r\n    try {\r\n        if (xpState?.unlocked) {\r\n            const levelInf =\r\n                xpState?.xpLevel?.isInfinite?.() ||\r\n                bigNumEquals(xpState?.xpLevel, inf);\r\n            const progInf =\r\n                xpState?.progress?.isInfinite?.() ||\r\n                bigNumEquals(xpState?.progress, inf);\r\n\r\n            if (!levelInf || !progInf) {\r\n                applyXpState({ level: inf, progress: inf });\r\n                touched += 1; // count \"XP\" as one stat block\r\n            }\r\n        }\r\n    } catch {}\r\n\r\n    // MP / Mutation: only if unlocked\r\n    try {\r\n        if (mutationState?.unlocked) {\r\n            const levelInf =\r\n                mutationState?.level?.isInfinite?.() ||\r\n                bigNumEquals(mutationState?.level, inf);\r\n            const progInf =\r\n                mutationState?.progress?.isInfinite?.() ||\r\n                bigNumEquals(mutationState?.progress, inf);\r\n\r\n            if (!levelInf || !progInf) {\r\n                applyMutationState({ level: inf, progress: inf });\r\n                touched += 1; // count \"MP\" as one stat block\r\n            }\r\n        }\r\n    } catch {}\r\n\r\n    const isStatUnlocked = (statKey) => {\r\n        if (statKey === 'xp') return !!xpState?.unlocked;\r\n        if (statKey === 'mutation') return !!mutationState?.unlocked;\r\n        return true;\r\n    };\r\n\r\n    // Stat multipliers (XP, MP, etc.)\r\n    STAT_MULTIPLIERS.forEach(({ key }) => {\r\n        try {\r\n            if (!isStatUnlocked(key)) return;\r\n\r\n            const current = getStatMultiplierDisplayValue(key, slot);\r\n            const isAlreadyInf =\r\n                current?.isInfinite?.() ||\r\n                bigNumEquals(current, inf);\r\n\r\n            if (isAlreadyInf) return;\r\n\r\n            setDebugStatMultiplierOverride(key, inf, slot);\r\n            touched += 1;\r\n        } catch {}\r\n    });\r\n\r\n    return touched;\r\n}\r\n\r\nfunction setAllStatsToZero() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return 0;\r\n\r\n    const zero = BigNum.fromInt(0);\r\n    let touched = 0;\r\n\r\n    let xpState;\r\n    let mutationState;\r\n\r\n    try { xpState = getXpState(); } catch {}\r\n    try { mutationState = getMutationState(); } catch {}\r\n\r\n    try {\r\n        if (xpState?.unlocked) {\r\n            applyXpState({ level: zero, progress: zero });\r\n            touched += 1;\r\n        }\r\n    } catch {}\r\n\r\n    try {\r\n        if (mutationState?.unlocked) {\r\n            applyMutationState({ level: zero, progress: zero });\r\n            touched += 1;\r\n        }\r\n    } catch {}\r\n\r\n    const isStatUnlocked = (statKey) => {\r\n        if (statKey === 'xp') return !!xpState?.unlocked;\r\n        if (statKey === 'mutation') return !!mutationState?.unlocked;\r\n        return true;\r\n    };\r\n\r\n    STAT_MULTIPLIERS.forEach(({ key }) => {\r\n        try {\r\n            if (!isStatUnlocked(key)) return;\r\n\r\n            setDebugStatMultiplierOverride(key, zero, slot);\r\n            touched += 1;\r\n        } catch {}\r\n    });\r\n\r\n    return touched;\r\n}\r\n\r\nfunction getUnlockRowDefinitions(slot) {\r\n    return [\r\n        {\r\n            labelText: 'Unlock XP',\r\n            description: 'If true, unlocks the XP system',\r\n            isUnlocked: () => {\r\n                try { return !!getXpState()?.unlocked; }\r\n                catch { return false; }\r\n            },\r\n            onEnable: () => {\r\n                try { unlockXpSystem(); }\r\n                catch {}\r\n                try { initXpSystem({ forceReload: true }); }\r\n                catch {}\r\n            },\r\n            onDisable: () => {\r\n                try { resetXpProgress({ keepUnlock: false }); }\r\n                catch {}\r\n                try { setForgeDebugOverride(false); }\r\n                catch {}\r\n                try { updateResetPanel(); }\r\n                catch {}\r\n            },\r\n            slot,\r\n        },\r\n        {\r\n            labelText: 'Unlock MP',\r\n            description: 'If true, unlocks the MP system',\r\n            isUnlocked: () => {\r\n                try {\r\n                    const override = getForgeDebugOverrideState();\r\n                    if (override != null) return override;\r\n                } catch {}\r\n                try { return !!isForgeUnlocked(); }\r\n                catch { return false; }\r\n                return false;\r\n            },\r\n            onEnable: () => {\r\n                try { setForgeDebugOverride(true); }\r\n                catch {}\r\n                try { updateResetPanel(); }\r\n                catch {}\r\n            },\r\n            onDisable: () => {\r\n                try { setForgeDebugOverride(false); }\r\n                catch {}\r\n                try { updateResetPanel(); }\r\n                catch {}\r\n            },\r\n        },\r\n        {\r\n            labelText: 'Unlock MP',\r\n            description: 'If true, unlocks the MP system',\r\n            isUnlocked: () => {\r\n                try { return hasDoneForgeReset(); }\r\n                catch { return false; }\r\n            },\r\n            onEnable: () => {\r\n                try { setForgeResetCompleted(true); }\r\n                catch {}\r\n                try { setMutationUnlockedForDebug(true); }\r\n                catch {}\r\n                try { updateResetPanel(); }\r\n                catch {}\r\n            },\r\n            onDisable: () => {\r\n                try { setForgeResetCompleted(false); }\r\n                catch {}\r\n                try { setMutationUnlockedForDebug(false); }\r\n                catch {}\r\n                try { updateResetPanel(); }\r\n                catch {}\r\n            },\r\n            slot,\r\n        },\r\n        {\r\n            labelText: 'Unlock Shop',\r\n            description: 'If true, makes the Shop button visible',\r\n            isUnlocked: () => {\r\n                try { return isShopUnlocked(); }\r\n                catch { return false; }\r\n            },\r\n            onEnable: () => {\r\n                try { unlockShop(); }\r\n                catch {}\r\n            },\r\n            onDisable: () => {\r\n                try { lockShop(); }\r\n                catch {}\r\n            },\r\n            slot,\r\n        },\r\n        {\r\n            labelText: 'Unlock Map',\r\n            description: 'If true, makes the Map button visible',\r\n            isUnlocked: () => {\r\n                try { return isMapUnlocked(); }\r\n                catch { return false; }\r\n            },\r\n            onEnable: () => {\r\n                try { unlockMap(); }\r\n                catch {}\r\n            },\r\n            onDisable: () => {\r\n                try { lockMap(); }\r\n                catch {}\r\n            },\r\n            slot,\r\n        },\r\n    ];\r\n}\r\n\r\nfunction setAllUnlockToggles(targetState) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return 0;\r\n\r\n    let toggled = 0;\r\n    getUnlockRowDefinitions(slot).forEach((rowDef) => {\r\n        let unlocked = false;\r\n        try { unlocked = typeof rowDef.isUnlocked === 'function' ? !!rowDef.isUnlocked() : false; }\r\n        catch {}\r\n\r\n        if (unlocked === targetState) return;\r\n\r\n        try {\r\n            if (targetState) {\r\n                rowDef.onEnable?.();\r\n            } else {\r\n                rowDef.onDisable?.();\r\n            }\r\n            toggled += 1;\r\n        } catch {}\r\n    });\r\n\r\n    try { refreshLiveBindings(); } catch {}\r\n\r\n    return toggled;\r\n}\r\n\r\nfunction unlockAllUnlockUpgrades() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return { unlocks: 0, toggles: 0 };\r\n    let unlocked = 0;\r\n    getAreas().forEach((area) => {\r\n        getUpgradesForArea(area.key).forEach((upg) => {\r\n            if (!upg?.unlockUpgrade) return;\r\n            try { markUpgradePermanentlyUnlocked(area.key, upg, slot); unlocked += 1; }\r\n            catch {}\r\n        });\r\n    });\r\n    try { unlockShop(); } catch {}\r\n    try { unlockMap(); } catch {}\r\n    const toggled = setAllUnlockToggles(true);\r\n    return { unlocks: unlocked, toggles: toggled };\r\n}\r\n\r\nfunction lockAllUnlockUpgrades() {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) return { locks: 0, toggles: 0 };\r\n    let locked = 0;\r\n    getAreas().forEach((area) => {\r\n        getUpgradesForArea(area.key).forEach((upg) => {\r\n            if (!upg?.unlockUpgrade) return;\r\n            try { clearPermanentUpgradeUnlock(area.key, upg, slot); locked += 1; }\r\n            catch {}\r\n        });\r\n    });\r\n    try { lockShop(); } catch {}\r\n    try { lockMap(); } catch {}\r\n    const toggled = setAllUnlockToggles(false);\r\n    return { locks: locked, toggles: toggled };\r\n}\r\n\r\nfunction resetCurrencyAndMultiplier(currencyKey) {\r\n    try {\r\n        // Reset the banked amount\r\n        bank?.[currencyKey]?.set?.(BigNum.fromInt(0));\r\n    } catch {}\r\n\r\n    try {\r\n        // Clear any debug override for this currency\r\n        clearCurrencyMultiplierOverride(currencyKey);\r\n    } catch {}\r\n\r\n    try {\r\n        // Put the actual in-game multiplier back to 1x\r\n        setCurrencyMultiplierBN(currencyKey, BigNum.fromInt(1));\r\n    } catch {}\r\n}\r\n\r\nfunction resetStatsAndMultipliers(target) {\r\n    if (target === 'all') {\r\n        // All currencies + multipliers: clear overrides and put real multipliers back to 1x\r\n        Object.values(CURRENCIES).forEach((key) => resetCurrencyAndMultiplier(key));\r\n\r\n        const zero = BigNum.fromInt(0);\r\n\r\n        // XP + MP (mutation) state \u2192 0\r\n        applyXpState({ level: zero, progress: zero });\r\n        applyMutationState({ level: zero, progress: zero });\r\n\r\n        // For stats, behave like the stat multiplier debug field:\r\n        // create a temporary 1x override that will be auto-cleared on the next\r\n        // normal game multiplier update (XP Value, MP Value, etc.).\r\n        STAT_MULTIPLIERS.forEach(({ key }) => {\r\n            try { setDebugStatMultiplierOverride(key, BigNum.fromInt(1)); } catch {}\r\n        });\r\n\r\n        const totalCount = Object.values(CURRENCIES).length + STAT_MULTIPLIERS.length + 2; // XP + MP\r\n        return { label: '[GOLD]all[/GOLD] currency/stats', count: totalCount };\r\n    }\r\n\r\n    if (target === 'allCurrencies') {\r\n        let currencyCount = 0;\r\n        Object.values(CURRENCIES).forEach((key) => {\r\n            resetCurrencyAndMultiplier(key);\r\n            currencyCount += 1;\r\n        });\r\n\r\n        const label = currencyCount === 1 ? '1 currency' : `${currencyCount} currencies`;\r\n        return { label, count: currencyCount };\r\n    }\r\n\r\n    if (target === 'allUnlockedStats') {\r\n        const zero = BigNum.fromInt(0);\r\n        let resetCount = 0;\r\n\r\n        try {\r\n            if (getXpState()?.unlocked) {\r\n                applyXpState({ level: zero, progress: zero });\r\n                try { setDebugStatMultiplierOverride('xp', BigNum.fromInt(1)); } catch {}\r\n                resetCount += 1;\r\n            }\r\n        } catch {}\r\n\r\n        try {\r\n            if (getMutationState()?.unlocked) {\r\n                applyMutationState({ level: zero, progress: zero });\r\n                try { setDebugStatMultiplierOverride('mutation', BigNum.fromInt(1)); } catch {}\r\n                resetCount += 1;\r\n            }\r\n        } catch {}\r\n\r\n        const label = resetCount === 1 ? '1 unlocked stat' : `${resetCount} unlocked stats`;\r\n        return { label, count: resetCount };\r\n    }\r\n\r\n    if (target === 'allUnlocked') {\r\n        let currencyCount = 0;\r\n        Object.values(CURRENCIES).forEach((key) => {\r\n            resetCurrencyAndMultiplier(key);\r\n            currencyCount += 1;\r\n        });\r\n\r\n        const zero = BigNum.fromInt(0);\r\n        let resetCount = 0;\r\n\r\n        try {\r\n            if (getXpState()?.unlocked) {\r\n                applyXpState({ level: zero, progress: zero });\r\n                try { setDebugStatMultiplierOverride('xp', BigNum.fromInt(1)); } catch {}\r\n                resetCount += 1;\r\n            }\r\n        } catch {}\r\n\r\n        try {\r\n            if (getMutationState()?.unlocked) {\r\n                applyMutationState({ level: zero, progress: zero });\r\n                try { setDebugStatMultiplierOverride('mutation', BigNum.fromInt(1)); } catch {}\r\n                resetCount += 1;\r\n            }\r\n        } catch {}\r\n\r\n        const parts = [];\r\n\r\n        if (resetCount === 1) parts.push('1 unlocked stat');\r\n        else parts.push(`${resetCount} unlocked stats`);\r\n\r\n        parts.push(currencyCount === 1 ? '1 currency' : `${currencyCount} currencies`);\r\n\r\n        return { label: parts.join(' and '), count: resetCount + currencyCount };\r\n    }\r\n\r\n    if (target.startsWith('currency:')) {\r\n        const currencyKey = target.slice('currency:'.length);\r\n        resetCurrencyAndMultiplier(currencyKey);\r\n        return { label: `${currencyKey}`, count: 1 };\r\n    }\r\n\r\n    if (target.startsWith('statmult:')) {\r\n        const statKey = target.slice('statmult:'.length);\r\n        // \"Reset this stat multiplier\" = remove any debug override,\r\n        // let the game recalculate the multiplier normally.\r\n        try { clearStatMultiplierOverride(statKey); } catch {}\r\n        return { label: `${statKey} multiplier`, count: 1 };\r\n    }\r\n\r\n    if (!target.startsWith('stat:')) {\r\n        return { label: `unknown target ${target}`, count: 0 };\r\n    }\r\n\r\n    const statKey = target.slice('stat:'.length);\r\n    const zero = BigNum.fromInt(0);\r\n\r\n    // Treat any XP-related key as \"XP\": level + progress + multiplier.\r\n    if (statKey === 'xp' || statKey === 'xpLevel' || statKey === 'xpProgress') {\r\n        applyXpState({ level: zero, progress: zero });\r\n        // Temporarily force XP multiplier to 1x (override cleared on next real update)\r\n        try { setDebugStatMultiplierOverride('xp', BigNum.fromInt(1)); } catch {}\r\n        return { label: 'XP', count: 1 };\r\n    }\r\n\r\n    // Treat any MP / mutation key as \"MP\": level + progress + multiplier.\r\n    if (\r\n        statKey === 'mutation' ||\r\n        statKey === 'mp' ||\r\n        statKey === 'mpLevel' ||\r\n        statKey === 'mpProgress'\r\n    ) {\r\n        applyMutationState({ level: zero, progress: zero });\r\n        // Temporarily force MP multiplier to 1x, same semantics as XP\r\n        try { setDebugStatMultiplierOverride('mutation', BigNum.fromInt(1)); } catch {}\r\n        return 'MP';\r\n    }\r\n\r\n    // Fallback: generic stat multiplier reset -> same semantics as the debug stat input\r\n    try { setDebugStatMultiplierOverride(statKey, BigNum.fromInt(1)); } catch {}\r\n    return `stat ${statKey}`;\r\n}\r\n\r\nfunction buildAreaStatMultipliers(container, area) {\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const msg = document.createElement('div');\r\n        msg.className = 'debug-panel-empty';\r\n        msg.textContent = 'Select a save slot to edit stat multipliers.';\r\n        container.appendChild(msg);\r\n        return;\r\n    }\r\n\r\n    const areaLabel = area?.title ?? area?.key ?? 'Unknown Area';\r\n\r\n    STAT_MULTIPLIERS.forEach((stat) => {\r\n        const storageKey = getStatMultiplierStorageKey(stat.key, slot);\r\n        const row = createInputRow(\r\n            `${stat.label} Multiplier`,\r\n            getStatMultiplierDisplayValue(stat.key, slot),\r\n            (value, { setValue }) => {\r\n                const latestSlot = getActiveSlot();\r\n                if (latestSlot == null) return;\r\n                const previous = getStatMultiplierDisplayValue(stat.key, latestSlot);\r\n                try { setDebugStatMultiplierOverride(stat.key, value, latestSlot); } catch {}\r\n                const refreshed = getStatMultiplierDisplayValue(stat.key, latestSlot);\r\n                setValue(refreshed);\r\n                if (!bigNumEquals(previous, refreshed)) {\r\n                    flagDebugUsage();\r\n                    logAction(\r\n                        `Modified ${stat.label} Multiplier (${areaLabel}) ${formatNumber(previous)} \u2192 ${formatNumber(refreshed)}`\r\n                    );\r\n                }\r\n            },\r\n            {\r\n                storageKey,\r\n                onLockChange: (locked) => {\r\n                    const latestSlot = getActiveSlot();\r\n                    if (latestSlot == null) return;\r\n                    if (locked) {\r\n                        const existingOverride = getLockedStatOverride(latestSlot, stat.key);\r\n                        if (existingOverride) return;\r\n                        try {\r\n                            setDebugStatMultiplierOverride(\r\n                                stat.key,\r\n                                getGameStatMultiplier(stat.key),\r\n                                latestSlot\r\n                            );\r\n                        } catch {}\r\n                    } else {\r\n                        getEffectiveStatMultiplierOverride(\r\n                            stat.key,\r\n                            latestSlot,\r\n                            getGameStatMultiplier(stat.key)\r\n                        );\r\n                    }\r\n                    row.setValue(getStatMultiplierDisplayValue(stat.key, latestSlot));\r\n                },\r\n            }\r\n        );\r\n\r\n        registerLiveBinding({\r\n            type: 'stat-mult',\r\n            key: stat.key,\r\n            slot,\r\n            refresh: () => {\r\n                if (slot !== getActiveSlot()) return;\r\n                const latest = getStatMultiplierDisplayValue(stat.key, slot);\r\n                row.setValue(latest);\r\n            },\r\n        });\r\n\r\n        registerLiveBinding({\r\n            type: 'upgrade',\r\n            key: stat.key,\r\n            slot,\r\n            refresh: () => {\r\n                if (slot !== getActiveSlot()) return;\r\n                const latest = getStatMultiplierDisplayValue(stat.key, slot);\r\n                row.setValue(latest);\r\n            },\r\n        });\r\n\r\n        if (stat.key === 'mutation') {\r\n            registerLiveBinding({\r\n                type: 'mutation',\r\n                key: stat.key,\r\n                slot,\r\n                refresh: () => {\r\n                    if (slot !== getActiveSlot()) return;\r\n                    const latest = getStatMultiplierDisplayValue(stat.key, slot);\r\n                    row.setValue(latest);\r\n                },\r\n            });\r\n        }\r\n\r\n        container.appendChild(row.row);\r\n    });\r\n}\r\n\r\nfunction buildAreaCalculators(container) {\r\n    const calculators = [\r\n        {\r\n            title: 'Currencies',\r\n            rows: [\r\n                {\r\n                    label: 'Pending Gold (Forge)',\r\n                    inputs: [\r\n                        { key: 'coins', label: 'Coins' },\r\n                        { key: 'xpLevel', label: 'XP Level' },\r\n                    ],\r\n                    compute: ({ coins, xpLevel }) => computeForgeGoldFromInputs(coins, xpLevel),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            title: 'Stats',\r\n            rows: [\r\n                {\r\n                    label: 'XP Requirement',\r\n                    inputs: [\r\n                        { key: 'xpLevel', label: 'XP Level' },\r\n                    ],\r\n                    compute: ({ xpLevel }) => getXpRequirementForXpLevel(xpLevel),\r\n                },\r\n                {\r\n                    label: 'XP Level Coin Multiplier',\r\n                    inputs: [\r\n                        { key: 'xpLevel', label: 'XP Level' },\r\n                    ],\r\n                    compute: ({ xpLevel }) => computeCoinMultiplierForXpLevel(xpLevel),\r\n                },\r\n                {\r\n                    label: 'MP Requirement',\r\n                    inputs: [\r\n                        { key: 'mpLevel', label: 'MP Level' },\r\n                    ],\r\n                    compute: ({ mpLevel }) => computeMutationRequirementForLevel(mpLevel),\r\n                },\r\n                {\r\n                    label: 'MP Level Coin/XP Multiplier',\r\n                    inputs: [\r\n                        { key: 'mpLevel', label: 'MP Level' },\r\n                    ],\r\n                    compute: ({ mpLevel }) => computeMutationMultiplierForLevel(mpLevel),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            title: 'Other',\r\n            rows: [\r\n                {\r\n                    label: 'Default Upgrade Level Cost',\r\n                    inputs: [\r\n                        { key: 'baseCost', label: 'Base Cost' },\r\n                        { key: 'level', label: 'Current Upgrade Level' },\r\n                        {\r\n                            key: 'mode',\r\n                            type: 'select',\r\n                            defaultValue: 'NM',\r\n                            options: [\r\n                                { value: 'NM', label: 'No Milestones' },\r\n                                { value: 'HM', label: 'Has Milestones' },\r\n                            ],\r\n                        },\r\n                    ],\r\n                    compute: ({ baseCost, level, mode }) => computeDefaultUpgradeCost(baseCost, level, mode),\r\n                },\r\n            ],\r\n        },\r\n    ];\r\n\r\n    calculators.forEach((group) => {\r\n        const subsection = createSubsection(group.title, (sub) => {\r\n            if (!group.rows || group.rows.length === 0) {\r\n                const msg = document.createElement('div');\r\n                msg.className = 'debug-panel-empty';\r\n                msg.textContent = 'No calculators available yet.';\r\n                sub.appendChild(msg);\r\n                return;\r\n            }\r\n\r\n            group.rows.forEach((row) => {\r\n                const calculatorRow = createCalculatorRow({\r\n                    labelText: row.label,\r\n                    inputs: row.inputs,\r\n                    compute: row.compute,\r\n                });\r\n                sub.appendChild(calculatorRow);\r\n            });\r\n        });\r\n\r\n        container.appendChild(subsection);\r\n    });\r\n}\r\n\r\nfunction buildAreasContent(content) {\r\n    content.innerHTML = '';\r\n\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const placeholder = document.createElement('div');\r\n        placeholder.className = 'debug-panel-empty';\r\n        placeholder.textContent = 'Areas are available once a save slot is selected.';\r\n        content.appendChild(placeholder);\r\n        return;\r\n    }\r\n\r\n    applyAllCurrencyOverridesForActiveSlot();\r\n\r\n    const areas = getAreas();\r\n\r\n    areas.forEach((area) => {\r\n        const areaContainer = createSubsection(area.title, (areaContent) => {\r\n            const currencies = createSubsection('Currencies', (sub) => {\r\n                buildAreaCurrencies(sub, area);\r\n            });\r\n            const stats = createSubsection('Stats', (sub) => {\r\n                buildAreaStats(sub, area);\r\n            });\r\n            const multipliers = createSubsection('Multipliers', (sub) => {\r\n                const currencyMultipliers = createSubsection('Currencies', (subsection) => {\r\n                    buildAreaCurrencyMultipliers(subsection, area);\r\n                });\r\n                const statMultipliers = createSubsection('Stats', (subsection) => {\r\n                    buildAreaStatMultipliers(subsection, area);\r\n                });\r\n\r\n                sub.appendChild(currencyMultipliers);\r\n                sub.appendChild(statMultipliers);\r\n            });\r\n            const upgrades = createSubsection('Upgrades', (sub) => {\r\n                buildAreaUpgrades(sub, area);\r\n            });\r\n            const calculators = createSubsection('Calculators', (sub) => {\r\n                buildAreaCalculators(sub);\r\n            });\r\n\t\t\t\r\n            areaContent.appendChild(currencies);\r\n            areaContent.appendChild(stats);\r\n            areaContent.appendChild(multipliers);\r\n            areaContent.appendChild(upgrades);\r\n            areaContent.appendChild(calculators);\r\n        });\r\n        areaContainer.classList.add('debug-panel-area');\r\n\r\n        content.appendChild(areaContainer);\r\n    });\r\n}\r\n\r\nfunction buildMiscContent(content) {\r\n    content.innerHTML = '';\r\n\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const placeholder = document.createElement('div');\r\n        placeholder.className = 'debug-panel-empty';\r\n        placeholder.textContent = 'Miscellaneous tools are available once a save slot is selected.';\r\n        content.appendChild(placeholder);\r\n        return;\r\n    }\r\n\r\n    const buttons = [\r\n        {\r\n            label: 'Complete Dialogues',\r\n            onClick: () => {\r\n                const { completed } = completeAllDialoguesForDebug();\r\n                flagDebugUsage();\r\n                logAction(`Completed all dialogues (${completed} newly claimed).`);\r\n            },\r\n        },\r\n        {\r\n            label: 'Restore Dialogues',\r\n            onClick: () => {\r\n                const { restored } = restoreAllDialoguesForDebug();\r\n                flagDebugUsage();\r\n                const entryLabel = restored === 1 ? 'entry' : 'entries';\r\n                logAction(`Restored dialogues to unclaimed state (${restored} ${entryLabel} reset).`);\r\n            },\r\n        },\r\n        {\r\n            label: 'All Currencies Inf',\r\n            onClick: () => {\r\n                const touched = setAllCurrenciesToInfinity();\r\n                flagDebugUsage();\r\n                logAction(`Set all currencies to Infinity (${touched} ${touched === 1 ? 'currency' : 'currencies'} updated).`);\r\n            },\r\n        },\r\n        {\r\n            label: 'All Stats Inf',\r\n            onClick: () => {\r\n                                const touched = setAllStatsToInfinity();\r\n                flagDebugUsage();\r\n                logAction(`Set all stats to Infinity (${touched} ${touched === 1 ? 'stat' : 'stats'} updated).`);\r\n            },\r\n        },\r\n\t\t{\r\n            label: 'All Currencies 0',\r\n            onClick: () => {\r\n                const touched = setAllCurrenciesToZero();\r\n                flagDebugUsage();\r\n                logAction(`Set all currencies to 0 (${touched} ${touched === 1 ? 'currency' : 'currencies'} updated).`);\r\n            },\r\n        },\r\n        {\r\n            label: 'All Stats 0',\r\n            onClick: () => {\r\n                const touched = setAllStatsToZero();\r\n                flagDebugUsage();\r\n                logAction(`Set all unlocked stats to 0 (${touched} ${touched === 1 ? 'stat' : 'stats'} updated).`);\r\n            },\r\n        },\r\n        {\r\n            label: 'Unlock All Unlocks',\r\n            onClick: () => {\r\n                const { unlocks, toggles } = unlockAllUnlockUpgrades();\r\n                flagDebugUsage();\r\n                logAction(`Unlocked all unlock-type upgrades (${unlocks} entries) and unlock flags (${toggles} toggled).`);\r\n            },\r\n        },\r\n        {\r\n            label: 'Lock All Unlocks',\r\n            onClick: () => {\r\n                const { locks, toggles } = lockAllUnlockUpgrades();\r\n                flagDebugUsage();\r\n                logAction(`Locked all unlock-type upgrades (${locks} entries) and unlock flags (${toggles} toggled).`);\r\n            },\r\n        },\r\n        {\r\n            label: 'Wipe Action Log',\r\n            onClick: () => {\r\n                persistActionLog([], slot);\r\n                updateActionLogDisplay();\r\n                flagDebugUsage();\r\n                logAction('Action log wiped and reset.');\r\n            },\r\n        },\r\n    ];\r\n\r\n    const buttonGrid = document.createElement('div');\r\n    buttonGrid.className = 'debug-misc-button-list';\r\n    buttons.forEach((cfg) => {\r\n        const btn = document.createElement('button');\r\n        btn.type = 'button';\r\n        btn.className = 'debug-panel-toggle debug-misc-button';\r\n        btn.textContent = cfg.label;\r\n        btn.addEventListener('click', cfg.onClick);\r\n        buttonGrid.appendChild(btn);\r\n    });\r\n    content.appendChild(buttonGrid);\r\n\r\n    const resetRow = document.createElement('div');\r\n    resetRow.className = 'debug-panel-row';\r\n    const resetLabel = document.createElement('label');\r\n    resetLabel.textContent = 'Reset Values & Multis For';\r\n    resetRow.appendChild(resetLabel);\r\n\r\n    const resetSelect = document.createElement('select');\r\n    resetSelect.className = 'debug-panel-input';\r\n\r\n    getAreas().forEach((area) => {\r\n        const group = document.createElement('optgroup');\r\n        group.label = area.title || area.key;\r\n        area.currencies.forEach((currency) => {\r\n            const opt = document.createElement('option');\r\n            opt.value = `currency:${currency.key}`;\r\n            opt.textContent = `${area.title || area.key} \u2192 ${currency.label}`;\r\n            group.appendChild(opt);\r\n        });\r\n        area.stats.forEach((stat) => {\r\n            const opt = document.createElement('option');\r\n            opt.value = `stat:${stat.key}`;\r\n            opt.textContent = `${area.title || area.key} \u2192 ${stat.label}`;\r\n            group.appendChild(opt);\r\n        });\r\n        resetSelect.appendChild(group);\r\n    });\r\n\r\n    const allCurrenciesOption = document.createElement('option');\r\n    allCurrenciesOption.value = 'allCurrencies';\r\n    allCurrenciesOption.textContent = 'All Currencies';\r\n    resetSelect.appendChild(allCurrenciesOption);\r\n\r\n    const allUnlockedStatsOption = document.createElement('option');\r\n    allUnlockedStatsOption.value = 'allUnlockedStats';\r\n    allUnlockedStatsOption.textContent = 'All Unlocked Stats';\r\n    resetSelect.appendChild(allUnlockedStatsOption);\r\n\t\r\n\tconst allUnlockedOption = document.createElement('option');\r\n    allUnlockedOption.value = 'allUnlocked';\r\n    allUnlockedOption.textContent = 'All Unlocked Stats & Currs';\r\n    resetSelect.appendChild(allUnlockedOption);\r\n\r\n    const allOption = document.createElement('option');\r\n    allOption.value = 'all';\r\n    allOption.textContent = 'All';\r\n    resetSelect.appendChild(allOption);\r\n\r\n    resetRow.appendChild(resetSelect);\r\n\r\n    const resetBtn = document.createElement('button');\r\n    resetBtn.type = 'button';\r\n    resetBtn.className = 'debug-panel-toggle';\r\n    resetBtn.textContent = 'Reset';\r\n    resetBtn.addEventListener('click', () => {\r\n        const target = resetSelect.value || 'all';\r\n        const { label, count } = resetStatsAndMultipliers(target) ?? { label: target, count: 0 };\r\n        const nounPhrase = count === 1 ? 'value and multiplier' : 'values and multipliers';\r\n        flagDebugUsage();\r\n        logAction(`Reset ${nounPhrase} for ${label} to defaults.`);\r\n    });\r\n    resetRow.appendChild(resetBtn);\r\n    content.appendChild(resetRow);\r\n\r\n    const actionLogRow = document.createElement('div');\r\n    actionLogRow.className = 'debug-panel-row';\r\n\r\n    const wipeSlotBtn = document.createElement('button');\r\n    wipeSlotBtn.type = 'button';\r\n    wipeSlotBtn.className = 'debug-panel-toggle debug-danger-button';\r\n    wipeSlotBtn.textContent = 'Wipe Slot & Refresh';\r\n    wipeSlotBtn.addEventListener('click', () => {\r\n        const confirmWipe = window.confirm?.('Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.');\r\n        if (!confirmWipe) return;\r\n\r\n        const suffix = `:${slot}`;\r\n        const suffixPattern = new RegExp(`:${slot}(?::|$)`);\r\n        const PASS_COUNT = 5;\r\n        const PASS_DELAY_MS = 60;\r\n        let totalKeysRemoved = 0;\r\n        let blockedWrites = 0;\r\n\r\n        const isSlotStorageKey = (key) => typeof key === 'string' && suffixPattern.test(key);\r\n\r\n        const stopSlotStorageWrites = () => {\r\n            if (typeof localStorage === 'undefined') return () => {};\r\n            const previousSetter = typeof localStorage.setItem === 'function'\r\n                ? localStorage.setItem.bind(localStorage)\r\n                : null;\r\n\r\n            if (!previousSetter) return () => {};\r\n\r\n            localStorage.setItem = (key, value) => {\r\n                if (isSlotStorageKey(key)) {\r\n                    blockedWrites += 1;\r\n                    return;\r\n                }\r\n                return previousSetter(key, value);\r\n            };\r\n\r\n            return () => {\r\n                try { localStorage.setItem = previousSetter; } catch {}\r\n            };\r\n        };\r\n\r\n        const wipePass = () => {\r\n            let removedThisPass = 0;\r\n            try {\r\n                const keysToRemove = [];\r\n                for (let i = 0; i < localStorage.length; i += 1) {\r\n                    const key = localStorage.key(i);\r\n                    if (isSlotStorageKey(key)) {\r\n                        keysToRemove.push(key);\r\n                    }\r\n                }\r\n                keysToRemove.forEach((key) => localStorage.removeItem(key));\r\n                removedThisPass = keysToRemove.length;\r\n            } catch {}\r\n\r\n            totalKeysRemoved += removedThisPass;\r\n            return removedThisPass;\r\n        };\r\n\r\n        const showMenuAndHideGame = () => {\r\n            const menuRoot = document.querySelector('.menu-root');\r\n            if (menuRoot) {\r\n                menuRoot.style.display = '';\r\n                menuRoot.removeAttribute('aria-hidden');\r\n            }\r\n            const gameRoot = document.getElementById('game-root');\r\n            if (gameRoot) gameRoot.hidden = true;\r\n\r\n            try {\r\n                window.dispatchEvent(new CustomEvent('menu:visibilitychange', { detail: { visible: true } }));\r\n            } catch {}\r\n        };\r\n\r\n        const restoreStorageSetter = stopSlotStorageWrites();\r\n\r\n        wipePass();\r\n        showMenuAndHideGame();\r\n\r\n        setTimeout(() => {\r\n            wipePass();\r\n            restoreStorageSetter?.();\r\n            flagDebugUsage();\r\n            logAction(\r\n                `Wiped ${totalKeysRemoved} storage keys for slot ${slot} across 2 passes `\r\n                + `(blocked ${blockedWrites} writes), returned to menu, and refreshed.`,\r\n            );\r\n            try { window.location.reload(); } catch {}\r\n        }, PASS_DELAY_MS);\r\n    });\r\n    actionLogRow.appendChild(wipeSlotBtn);\r\n    actionLogRow.appendChild(wipeSlotBtn);\r\n\r\n    content.appendChild(actionLogRow);\r\n}\r\n\r\nfunction buildUnlocksContent(content) {\r\n    content.innerHTML = '';\r\n\r\n    const slot = getActiveSlot();\r\n    if (slot == null) {\r\n        const placeholder = document.createElement('div');\r\n        placeholder.className = 'debug-panel-empty';\r\n        placeholder.textContent = 'Unlocks are available once a save slot is selected.';\r\n        content.appendChild(placeholder);\r\n        return;\r\n    }\r\n\r\n    try { initXpSystem(); }\r\n    catch {}\r\n\r\n    const rows = getUnlockRowDefinitions(slot);\r\n\r\n    rows.forEach((rowDef) => {\r\n        content.appendChild(createUnlockToggleRow(rowDef));\r\n    });\r\n}\r\n\r\nfunction buildDebugPanel() {\r\n    if (!debugPanelAccess || isOnMenu()) return;\r\n    cleanupDebugPanelResources();\r\n    ensureDebugPanelStyles();\r\n    sectionKeyCounter = 0;\r\n    subsectionKeyCounter = 0;\r\n\r\n    const existingPanel = document.getElementById(DEBUG_PANEL_ID);\r\n    if (existingPanel) existingPanel.remove();\r\n\r\n    const panel = document.createElement('div');\r\n    panel.id = DEBUG_PANEL_ID;\r\n    panel.className = 'debug-panel';\r\n\r\n    const header = document.createElement('div');\r\n    header.className = 'debug-panel-header';\r\n\r\n    const titleContainer = document.createElement('div');\r\n\r\n    const title = document.createElement('div');\r\n    title.className = 'debug-panel-title';\r\n    title.textContent = 'Debug Panel';\r\n\r\n    const closeButtonContainer = document.createElement('div');\r\n    closeButtonContainer.className = 'debug-panel-close-buttons';\r\n\r\n    const closeButton = document.createElement('button');\r\n    closeButton.className = 'debug-panel-close';\r\n    closeButton.type = 'button';\r\n    closeButton.setAttribute('aria-label', 'Close Debug Panel');\r\n    closeButton.textContent = 'Close';\r\n    closeButton.addEventListener('click', () => closeDebugPanel({ preserveExpansionState: true }));\r\n\r\n    const collapseCloseButton = document.createElement('button');\r\n    collapseCloseButton.className = 'debug-panel-close debug-panel-close-collapse';\r\n    collapseCloseButton.type = 'button';\r\n    collapseCloseButton.setAttribute('aria-label', 'Close Debug Panel and Collapse Sections');\r\n    collapseCloseButton.textContent = 'Close & Collapse';\r\n    collapseCloseButton.addEventListener('click', () => closeDebugPanel());\r\n\r\n    closeButtonContainer.appendChild(closeButton);\r\n    closeButtonContainer.appendChild(collapseCloseButton);\r\n\r\n    titleContainer.appendChild(title);\r\n    const info = document.createElement('div');\r\n    info.className = 'debug-panel-info';\r\n\r\n    const infoLines = [\r\n        { text: 'C: Close and preserve panels', hideOnMobile: true },\r\n        { text: 'Shift+C: Close and collapse panels', hideOnMobile: true },\r\n        { text: 'Input fields can take a normal, scientific, or BN number as input' },\r\n        { text: 'Input value \"inf\" sets a value to infinity or an upgrade to its level cap' },\r\n        { text: 'Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally' },\r\n    ];\r\n\r\n    infoLines.forEach(({ text, hideOnMobile }) => {\r\n        const infoLine = document.createElement('div');\r\n        infoLine.className = 'debug-panel-info-line';\r\n        if (hideOnMobile) infoLine.classList.add('debug-panel-info-mobile-hidden');\r\n        infoLine.textContent = text;\r\n        info.appendChild(infoLine);\r\n    });\r\n\r\n    titleContainer.appendChild(info);\r\n\r\n    header.appendChild(titleContainer);\r\n    header.appendChild(closeButtonContainer);\r\n    panel.appendChild(header);\r\n\r\n    panel.appendChild(createSection('Areas: main currency/stat/upgrade management for each area', 'debug-areas', content => {\r\n        buildAreasContent(content);\r\n    }));\r\n\r\n    panel.appendChild(createSection('Unlocks: modify specific unlock flags', 'debug-unlocks', content => {\r\n        buildUnlocksContent(content);\r\n    }));\r\n\r\n    panel.appendChild(createSection('Action Log: keep track of everything you do', 'debug-action-log', content => {\r\n        const container = document.createElement('div');\r\n        container.id = 'action-log-entries';\r\n        container.className = 'debug-panel-action-log';\r\n        container.style.maxHeight = '240px';\r\n        container.style.overflowY = 'auto';\r\n        content.appendChild(container);\r\n        actionLogContainer = container;\r\n        updateActionLogDisplay();\r\n        addDebugPanelCleanup(() => { actionLogContainer = null; });\r\n    }));\r\n\t\r\n    panel.appendChild(createSection('Miscellaneous: helpful miscellaneous functions', 'debug-misc', content => {\r\n        buildMiscContent(content);\r\n    }));\r\n\r\n    applyDebugPanelExpansionState(panel);\r\n\r\n    document.body.appendChild(panel);\r\n\r\n    if (debugPanelScrollTop > 0) {\r\n        try { panel.scrollTop = debugPanelScrollTop; }\r\n        catch {}\r\n    }\r\n    setupLiveBindingListeners();\r\n    debugPanelOpen = true;\r\n}\r\n\r\nfunction openDebugPanel() {\r\n    if (!debugPanelAccess || isOnMenu()) return;\r\n    if (getActiveSlot() == null) {\r\n        closeDebugPanel();\r\n        return;\r\n    }\r\n    if (debugPanelOpen) return;\r\n    buildDebugPanel();\r\n}\r\n\r\nfunction closeDebugPanel({ preserveExpansionState = false } = {}) {\r\n    debugPanelExpansionState = preserveExpansionState\r\n        ? captureDebugPanelExpansionState()\r\n        : createEmptyExpansionState();\r\n    const panel = document.getElementById(DEBUG_PANEL_ID);\r\n    if (panel) {\r\n        try { debugPanelScrollTop = panel.scrollTop ?? 0; }\r\n        catch { debugPanelScrollTop = 0; }\r\n        panel.remove();\r\n    }\r\n    cleanupDebugPanelResources();\r\n    debugPanelOpen = false;\r\n}\r\n\r\nfunction toggleDebugPanel() {\r\n    if (!debugPanelAccess || isOnMenu() || getActiveSlot() == null) {\r\n        closeDebugPanel();\r\n        return;\r\n    }\r\n    if (debugPanelOpen) {\r\n        closeDebugPanel({ preserveExpansionState: true });\r\n    } else {\r\n        openDebugPanel();\r\n    }\r\n}\r\n\r\nfunction teardownDebugPanel() {\r\n    closeDebugPanel();\r\n    removeDebugPanelToggleButton();\r\n}\r\n\r\nfunction createDebugPanelToggleButton() {\r\n    if (!shouldShowDebugPanelToggleButton()) {\r\n        removeDebugPanelToggleButton();\r\n        closeDebugPanel();\r\n        return;\r\n    }\r\n    ensureDebugPanelStyles();\r\n\r\n    removeDebugPanelToggleButton();\r\n\r\n    const button = document.createElement('button');\r\n    button.id = DEBUG_PANEL_TOGGLE_ID;\r\n    button.className = 'debug-panel-toggle-button';\r\n    button.type = 'button';\r\n    button.textContent = 'Debug Panel';\r\n    let lastPointerType = null;\r\n\r\n    const handleToggle = (event) => {\r\n        if (event.isTrusted && shouldSkipGhostTap(button)) return;\r\n        markGhostTapTarget(button);\r\n        toggleDebugPanel();\r\n    };\r\n\r\n    button.addEventListener('pointerdown', (event) => {\r\n        lastPointerType = event.pointerType || null;\r\n        if (event.pointerType === 'mouse') return;\r\n        event.preventDefault();\r\n        handleToggle(event);\r\n    });\r\n\r\n    button.addEventListener('click', (event) => {\r\n        if (lastPointerType && lastPointerType !== 'mouse') {\r\n            lastPointerType = null;\r\n            return;\r\n        }\r\n        lastPointerType = null;\r\n        handleToggle(event);\r\n    });\r\n\r\n    document.body.appendChild(button);\r\n}\r\n\r\nfunction applyDebugPanelAccess(enabled) {\r\n    debugPanelAccess = !!enabled;\r\n    if (!debugPanelAccess) {\r\n        teardownDebugPanel();\r\n        return;\r\n    }\r\n    createDebugPanelToggleButton();\r\n}\r\n\r\napplyDebugPanelAccess(false);\r\n\r\ndocument.addEventListener('keydown', event => {\r\n    if (!debugPanelAccess || isOnMenu()) return;\r\n    if (event.key?.toLowerCase() !== 'c') return;\r\n    if (event.ctrlKey) return;\r\n\r\n    if (getActiveSlot() == null) return;\r\n\r\n    if (event.shiftKey) {\r\n        if (debugPanelOpen) {\r\n            collapseAllDebugCategories();\r\n            closeDebugPanel();\r\n        } else {\r\n            openDebugPanel();\r\n        }\r\n        event.preventDefault();\r\n        return;\r\n    }\r\n\r\n    if (!debugPanelOpen) {\r\n        openDebugPanel();\r\n    } else {\r\n        closeDebugPanel({ preserveExpansionState: true });\r\n    }\r\n\t\r\n    event.preventDefault();\r\n});\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    createDebugPanelToggleButton();\r\n});\r\n\r\nwindow.addEventListener('menu:visibilitychange', onMenuVisibilityChange);\r\n\r\nwindow.addEventListener('saveSlot:change', () => {\r\n    createDebugPanelToggleButton();\r\n    if (debugPanelOpen) {\r\n        buildDebugPanel();\r\n    }\r\n});\r\n\r\nexport function setDebugPanelAccess(enabled) {\r\n    applyDebugPanelAccess(enabled);\r\n}", "// js/game/mutationSystem.js\r\n\r\nimport { BigNum } from '../util/bigNum.js';\r\nimport { getActiveSlot, watchStorageKey, primeStorageWatcherSnapshot } from '../util/storage.js';\r\nimport { applyStatMultiplierOverride } from '../util/debugPanel.js';\r\nimport { formatNumber } from '../util/numFormat.js';\r\nimport { approxLog10BigNum, bigNumFromLog10 } from './upgrades.js';\r\nimport { syncXpMpHudLayout } from '../ui/hudLayout.js';\r\nimport { refreshCoinMultiplierFromXpLevel } from './xpSystem.js';\r\n\r\nconst KEY_PREFIX = 'ccc:mutation';\r\nconst KEY_UNLOCK = (slot) => `${KEY_PREFIX}:unlocked:${slot}`;\r\nconst KEY_LEVEL = (slot) => `${KEY_PREFIX}:level:${slot}`;\r\nconst KEY_PROGRESS = (slot) => `${KEY_PREFIX}:progress:${slot}`;\r\n\r\nconst BN = BigNum;\r\nconst bnZero = () => BN.fromInt(0);\r\nconst bnOne = () => BN.fromInt(1);\r\n\r\nconst MP_LOG10_BASE = Math.log10(2);\r\nconst CONST_RATIO = (10 - 1) / (Math.pow(1.12, 50) - 1);\r\n\r\nfunction toStorageSafe(value) {\r\n  try { return value?.toStorage?.(); }\r\n  catch { return null; }\r\n}\r\n\r\nconst mutationState = {\r\n  unlocked: false,\r\n  level: bnZero(),\r\n  progress: bnZero(),\r\n  requirement: bnZero(),\r\n  slot: null,\r\n};\r\n\r\nconst hudRefs = {\r\n  container: null,\r\n  bar: null,\r\n  fill: null,\r\n  levelValue: null,\r\n  progress: null,\r\n};\r\n\r\nconst listeners = new Set();\r\nconst watcherCleanups = [];\r\nlet watchersBoundSlot = null;\r\nlet initialized = false;\r\nlet unregisterCoinMultiplierProvider = null;\r\nlet unregisterXpGainMultiplierProvider = null;\r\n\r\nfunction scheduleCoinMultiplierRefresh() {\r\n  try { refreshCoinMultiplierFromXpLevel(); } catch {}\r\n}\r\n\r\nfunction ensureExternalMultiplierProviders() {\r\n  if (typeof unregisterCoinMultiplierProvider === 'function') {\r\n    try { unregisterCoinMultiplierProvider(); } catch {}\r\n    unregisterCoinMultiplierProvider = null;\r\n  }\r\n  if (typeof unregisterXpGainMultiplierProvider === 'function') {\r\n    try { unregisterXpGainMultiplierProvider(); } catch {}\r\n    unregisterXpGainMultiplierProvider = null;\r\n  }\r\n}\r\n\r\nfunction cloneBigNum(value) {\r\n  if (value instanceof BN) {\r\n    try { return value.clone?.() ?? BN.fromAny(value); }\r\n    catch { return bnZero(); }\r\n  }\r\n  try { return BN.fromAny(value ?? 0); }\r\n  catch { return bnZero(); }\r\n}\r\n\r\nfunction quantizeRequirement(value) {\r\n  if (!value || typeof value !== 'object') return bnZero();\r\n  if (value.isInfinite?.()) return value.clone?.() ?? value;\r\n  const sci = typeof value.toScientific === 'function' ? value.toScientific(18) : '';\r\n  if (!sci || sci === 'Infinity') return value.clone?.() ?? value;\r\n  const match = sci.match(/^(\\d+(?:\\.\\d+)?)e([+-]?\\d+)$/i);\r\n  if (!match) return value.clone?.() ?? value;\r\n  const exp = parseInt(match[2], 10);\r\n  const digits = exp + 1;\r\n  if (digits <= 18) {\r\n    const floored = value.floorToInteger?.() ?? value.clone?.() ?? value;\r\n    const plain = floored.toPlainIntegerString?.();\r\n    if (!plain || plain === 'Infinity') return floored;\r\n    try {\r\n      const quant = (BigInt(plain) / 100n) * 100n;\r\n      if (quant <= 0n) return BN.fromInt(100);\r\n      return BN.fromAny(quant.toString());\r\n    } catch {\r\n      return floored;\r\n    }\r\n  }\r\n  return value.clone?.() ?? value;\r\n}\r\n\r\nfunction levelToNumber(level) {\r\n  if (!level || typeof level !== 'object') return 0;\r\n  if (level.isInfinite?.()) return Number.POSITIVE_INFINITY;\r\n  try {\r\n    const plain = level.toPlainIntegerString?.();\r\n    if (plain && plain !== 'Infinity' && plain.length <= 15) {\r\n      const num = Number(plain);\r\n      if (Number.isFinite(num)) return num;\r\n    }\r\n  } catch {}\r\n  const approxLog = approxLog10BigNum(level);\r\n  if (!Number.isFinite(approxLog)) return Number.POSITIVE_INFINITY;\r\n  if (approxLog > 308) return Number.POSITIVE_INFINITY;\r\n  return Math.pow(10, approxLog);\r\n}\r\n\r\nfunction computeRequirement(levelBn) {\r\n  // Original requirement curve, returning log10(requirement)\r\n  function baseRequirementLog10(baseLevel) {\r\n    const m = Math.max(0, baseLevel + 1);\r\n    const tail = Math.max(0, m - 10);\r\n\r\n    const poly = -0.0022175354763501742 * m * m\r\n      + 0.20449967884058884 * m\r\n      + 2.016778189084622\r\n      + 0.20418426693226513 * Math.pow(tail, 1.6418337930413576);\r\n    if (!Number.isFinite(poly)) {\r\n      return Number.POSITIVE_INFINITY;\r\n    }\r\n\r\n    let factor = 1;\r\n    if (m > 10) {\r\n      const powTerm = Math.pow(1.12, m - 10);\r\n      if (!Number.isFinite(powTerm)) {\r\n        return Number.POSITIVE_INFINITY;\r\n      }\r\n      factor += CONST_RATIO * (powTerm - 1);\r\n      if (!Number.isFinite(factor)) {\r\n        return Number.POSITIVE_INFINITY;\r\n      }\r\n    }\r\n\r\n    const totalLog10 = poly * factor;\r\n    if (!Number.isFinite(totalLog10)) {\r\n      return Number.POSITIVE_INFINITY;\r\n    }\r\n    return totalLog10;\r\n  }\r\n\r\n  const levelNum = levelToNumber(levelBn);\r\n  if (!Number.isFinite(levelNum)) {\r\n    // Infinite / NaN level \u2192 infinite requirement\r\n    return BN.fromAny('Infinity');\r\n  }\r\n\r\n  const baseLevel = Math.max(0, levelNum);\r\n\r\n  // Hard wall: mutation 100+ is impossible\r\n  if (baseLevel >= 100) {\r\n    return BN.fromAny('Infinity');\r\n  }\r\n\r\n  let totalLog10;\r\n\r\n  if (baseLevel <= 49) {\r\n    // 0\u201349: original scaling\r\n    totalLog10 = baseRequirementLog10(baseLevel);\r\n  } else {\r\n    // 50\u201399: double-exponential insanity zone.\r\n    //\r\n    // Define x so:\r\n    //   level 50 \u2192 x = 1\r\n    //   level 99 \u2192 x = 50\r\n    const x = baseLevel - 49; // 1..50\r\n\r\n    // We work in \"second exponent\" space:\r\n    //   secondExp = log10( log10(requirement) )\r\n    //\r\n    // Targets:\r\n    //   level 50 (x=1)  \u2192 secondExp \u2248 3    \u2192 log10 \u2248 1e3   \u2192 ~1e1000 MP\r\n    //   level 99 (x=50) \u2192 secondExp \u2248 303  \u2192 log10 \u2248 1e303 \u2192 ~1e1e303 MP\r\n    //\r\n    // Use quadratic: secondExp(x) = A * x^2 + B\r\n    // Solve:\r\n    //   A + B        = 3\r\n    //   2500*A + B   = 303\r\n    // \u21D2 A = 300 / 2499, B = 3 - A\r\n    const A = 300 / (50 * 50 - 1); // 300 / 2499\r\n    const B = 3 - A;\r\n\r\n    const secondExp = A * x * x + B;\r\n    if (!Number.isFinite(secondExp)) {\r\n      return BN.fromAny('Infinity');\r\n    }\r\n\r\n    // log10(requirement) = 10 ^ secondExp\r\n    totalLog10 = Math.pow(10, secondExp);\r\n  }\r\n\r\n  if (!Number.isFinite(totalLog10) || totalLog10 <= 0) {\r\n    return BN.fromAny('Infinity');\r\n  }\r\n\r\n  const raw = bigNumFromLog10(totalLog10);\r\n  return quantizeRequirement(raw);\r\n}\r\n\r\nfunction ensureRequirement() {\r\n  const lvl = mutationState.level;\r\n\r\n  const levelIsInf = !!(\r\n    lvl &&\r\n    typeof lvl === 'object' &&\r\n    (lvl.isInfinite?.() || (typeof lvl.isInfinite === 'function' && lvl.isInfinite()))\r\n  );\r\n\r\n  if (levelIsInf) {\r\n    try {\r\n      const inf = BigNum.fromAny('Infinity');\r\n      mutationState.requirement = inf.clone?.() ?? inf;\r\n      mutationState.progress = inf.clone?.() ?? inf;\r\n    } catch {\r\n      if (!mutationState.requirement || typeof mutationState.requirement !== 'object') {\r\n        mutationState.requirement = BigNum.fromInt(0);\r\n      }\r\n      if (!mutationState.progress || typeof mutationState.progress !== 'object') {\r\n        mutationState.progress = BigNum.fromInt(0);\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  const req = computeRequirement(mutationState.level);\r\n  mutationState.requirement = req;\r\n}\r\n\r\n\r\nfunction progressRatio(progressBn, requirement) {\r\n  if (!requirement || typeof requirement !== 'object') return 0;\r\n  if (!progressBn || typeof progressBn !== 'object') return 0;\r\n\r\n  const reqInf = requirement.isInfinite?.();\r\n  const progInf = progressBn.isInfinite?.();\r\n\r\n  // If both are infinite, treat the bar as \"full\".\r\n  if (reqInf) {\r\n    if (progInf) return 1;\r\n    return 0;\r\n  }\r\n\r\n  const reqZero = requirement.isZero?.();\r\n  if (reqZero) return 0;\r\n\r\n  const progZero = progressBn.isZero?.();\r\n  if (progZero) return 0;\r\n\r\n  const logProg = approxLog10BigNum(progressBn);\r\n  const logReq = approxLog10BigNum(requirement);\r\n  if (!Number.isFinite(logProg) || !Number.isFinite(logReq)) {\r\n    return logProg >= logReq ? 1 : 0;\r\n  }\r\n\r\n  const diff = logProg - logReq;\r\n  const ratio = Math.pow(10, diff);\r\n  if (!Number.isFinite(ratio)) {\r\n    return diff >= 0 ? 1 : 0;\r\n  }\r\n  if (ratio <= 0) return 0;\r\n  if (ratio >= 1) return 1;\r\n  return ratio;\r\n}\r\n\r\nfunction ensureHudRefs() {\r\n  if (hudRefs.container && hudRefs.container.isConnected) return true;\r\n  hudRefs.container = document.querySelector('[data-mp-hud].mp-counter');\r\n  if (!hudRefs.container) return false;\r\n  hudRefs.bar = hudRefs.container.querySelector('.mp-bar');\r\n  hudRefs.fill = hudRefs.container.querySelector('.mp-bar__fill');\r\n  hudRefs.levelValue = hudRefs.container.querySelector('.mp-level-value');\r\n  hudRefs.progress = hudRefs.container.querySelector('[data-mp-progress]');\r\n  return true;\r\n}\r\n\r\nfunction formatBn(bn) {\r\n  try { return formatNumber(bn); }\r\n  catch {\r\n    try { return bn.toPlainIntegerString?.() ?? String(bn); }\r\n    catch { return '0'; }\r\n  }\r\n}\r\n\r\nfunction updateHud() {\r\n  if (!ensureHudRefs()) return;\r\n  const { container, bar, fill, levelValue, progress } = hudRefs;\r\n  if (!container) return;\r\n  if (!mutationState.unlocked) {\r\n    container.setAttribute('hidden', '');\r\n    if (fill) {\r\n      fill.style.setProperty('--mp-fill', '0%');\r\n      fill.style.width = '0%';\r\n    }\r\n    if (levelValue) levelValue.textContent = '0';\r\n    if (progress) {\r\n      const reqHtml = formatBn(mutationState.requirement);\r\n      progress.innerHTML = `0<span class=\"mp-progress-separator\">/</span><span class=\"mp-progress-required\">${reqHtml}</span><span class=\"mp-progress-suffix\">MP</span>`;\r\n    }\r\n    if (bar) {\r\n      bar.setAttribute('aria-valuenow', '0');\r\n      const reqPlain = formatBn(mutationState.requirement).replace(/<[^>]*>/g, '');\r\n      bar.setAttribute('aria-valuetext', `0 / ${reqPlain || '10'} MP`);\r\n    }\r\n    syncXpMpHudLayout();\r\n    return;\r\n  }\r\n\r\n  container.removeAttribute('hidden');\r\n  const req = mutationState.requirement;\r\n  const ratio = progressRatio(mutationState.progress, req);\r\n  const pct = `${(ratio * 100).toFixed(2)}%`;\r\n  if (fill) {\r\n    fill.style.setProperty('--mp-fill', pct);\r\n    fill.style.width = pct;\r\n  }\r\n  if (levelValue) {\r\n    levelValue.innerHTML = formatBn(mutationState.level);\r\n  }\r\n  if (progress) {\r\n    const currentHtml = formatBn(mutationState.progress);\r\n    const reqHtml = formatBn(req);\r\n    progress.innerHTML = `<span class=\"mp-progress-current\">${currentHtml}</span><span class=\"mp-progress-separator\">/</span><span class=\"mp-progress-required\">${reqHtml}</span><span class=\"mp-progress-suffix\">MP</span>`;\r\n  }\r\n  if (bar) {\r\n    bar.setAttribute('aria-valuenow', (ratio * 100).toFixed(2));\r\n    const currPlain = formatBn(mutationState.progress).replace(/<[^>]*>/g, '');\r\n    const reqPlain = formatBn(req).replace(/<[^>]*>/g, '');\r\n    bar.setAttribute('aria-valuetext', `${currPlain} / ${reqPlain} MP`);\r\n  }\r\n  syncXpMpHudLayout();\r\n}\r\n\r\nfunction emitChange(reason = 'update', extraDetail = {}) {\r\n  const snapshot = getMutationState();\r\n  const detail = {\r\n    ...snapshot,\r\n    slot: mutationState.slot ?? getActiveSlot(),\r\n    changeType: reason,\r\n    ...extraDetail,\r\n  };\r\n\r\n  listeners.forEach((cb) => {\r\n    try { cb(snapshot, reason); } catch {}\r\n  });\r\n\r\n  if (typeof window !== 'undefined') {\r\n    try { window.dispatchEvent(new CustomEvent('mutation:change', { detail })); } catch {}\r\n  }\r\n\r\n  return detail;\r\n}\r\n\r\nfunction persistState() {\r\n  let slot = mutationState.slot;\r\n  if (slot == null) {\r\n    slot = getActiveSlot();\r\n    if (slot != null) {\r\n      mutationState.slot = slot;\r\n    }\r\n  }\r\n  if (slot == null) return;\r\n  try { localStorage.setItem(KEY_UNLOCK(slot), mutationState.unlocked ? '1' : '0'); }\r\n  catch {}\r\n  try { localStorage.setItem(KEY_LEVEL(slot), mutationState.level.toStorage()); }\r\n  catch {}\r\n  try { localStorage.setItem(KEY_PROGRESS(slot), mutationState.progress.toStorage()); }\r\n  catch {}\r\n  primeStorageWatcherSnapshot(KEY_UNLOCK(slot));\r\n  primeStorageWatcherSnapshot(KEY_LEVEL(slot));\r\n  primeStorageWatcherSnapshot(KEY_PROGRESS(slot));\r\n\r\n  // If storage writes are being blocked (e.g., via the Debug Panel lock toggle),\r\n  // fall back to the persisted values so in-memory state doesn't keep drifting\r\n  // away from the locked snapshot during gameplay.\r\n  const persisted = (() => {\r\n    let unlocked = mutationState.unlocked;\r\n    let level = mutationState.level;\r\n    let progress = mutationState.progress;\r\n    try { unlocked = localStorage.getItem(KEY_UNLOCK(slot)) === '1'; }\r\n    catch {}\r\n    try {\r\n      const rawLevel = localStorage.getItem(KEY_LEVEL(slot));\r\n      if (rawLevel) level = BN.fromAny(rawLevel);\r\n    } catch {}\r\n    try {\r\n      const rawProgress = localStorage.getItem(KEY_PROGRESS(slot));\r\n      if (rawProgress) progress = BN.fromAny(rawProgress);\r\n    } catch {}\r\n    return { unlocked, level, progress };\r\n  })();\r\n\r\n  const persistedLevelRaw = toStorageSafe(persisted.level);\r\n  const persistedProgressRaw = toStorageSafe(persisted.progress);\r\n  const expectedLevelRaw = toStorageSafe(mutationState.level);\r\n  const expectedProgressRaw = toStorageSafe(mutationState.progress);\r\n\r\n  const unlockMismatch = persisted.unlocked !== mutationState.unlocked;\r\n  const levelMismatch = persistedLevelRaw != null && expectedLevelRaw != null && persistedLevelRaw !== expectedLevelRaw;\r\n  const progressMismatch = persistedProgressRaw != null && expectedProgressRaw != null && persistedProgressRaw !== expectedProgressRaw;\r\n\r\n  if (unlockMismatch || levelMismatch || progressMismatch) {\r\n    applyState(persisted, { skipPersist: true });\r\n  }\r\n}\r\n\r\nfunction normalizeProgress() {\r\n  if (!mutationState.unlocked) return;\r\n\r\n  ensureRequirement();\r\n  let currentReq = mutationState.requirement;\r\n  if (!currentReq || typeof currentReq !== 'object') return;\r\n\r\n  // If the requirement is infinite, you can keep stacking MP forever,\r\n  // but you'll never spend it to gain more levels.\r\n  if (currentReq.isInfinite?.()) {\r\n    return;\r\n  }\r\n\r\n  let guard = 0;\r\n  const limit = 100000;\r\n\r\n  while (mutationState.progress.cmp?.(currentReq) >= 0 && guard < limit) {\r\n    // Spend MP to gain a level\r\n    mutationState.progress = mutationState.progress.sub(currentReq);\r\n    mutationState.level = mutationState.level.add(bnOne());\r\n\r\n    // Recompute requirement for the new level\r\n    ensureRequirement();\r\n    currentReq = mutationState.requirement;\r\n\r\n    if (!currentReq || typeof currentReq !== 'object') {\r\n      mutationState.progress = bnZero();\r\n      break;\r\n    }\r\n\r\n    // If the requirement becomes infinite while levelling up,\r\n    // stop levelling, but KEEP the leftover progress instead of nuking it.\r\n    if (currentReq.isInfinite?.()) {\r\n      break;\r\n    }\r\n\r\n    guard += 1;\r\n  }\r\n\r\n  // Safety: if we somehow loop too much, just bail and zero progress\r\n  if (guard >= limit) {\r\n    mutationState.progress = bnZero();\r\n  }\r\n}\r\n\r\nfunction applyState(newState, { skipPersist = false } = {}) {\r\n  mutationState.unlocked = !!newState.unlocked;\r\n  mutationState.level = cloneBigNum(newState.level);\r\n  mutationState.progress = cloneBigNum(newState.progress);\r\n  if (!mutationState.unlocked) {\r\n    mutationState.level = bnZero();\r\n    mutationState.progress = bnZero();\r\n  }\r\n  ensureRequirement();\r\n  if (!skipPersist) persistState();\r\n  updateHud();\r\n  emitChange('load');\r\n  scheduleCoinMultiplierRefresh();\r\n}\r\n\r\nfunction readStateFromStorage(slot) {\r\n  const targetSlot = slot ?? getActiveSlot();\r\n  if (targetSlot == null) {\r\n    applyState({ unlocked: false, level: bnZero(), progress: bnZero() }, { skipPersist: true });\r\n    mutationState.slot = null;\r\n    return;\r\n  }\r\n  let unlocked = false;\r\n  let level = bnZero();\r\n  let progress = bnZero();\r\n  try { unlocked = localStorage.getItem(KEY_UNLOCK(targetSlot)) === '1'; }\r\n  catch {}\r\n  try {\r\n    const rawLvl = localStorage.getItem(KEY_LEVEL(targetSlot));\r\n    if (rawLvl) level = BN.fromAny(rawLvl);\r\n  } catch {}\r\n  try {\r\n    const rawProg = localStorage.getItem(KEY_PROGRESS(targetSlot));\r\n    if (rawProg) progress = BN.fromAny(rawProg);\r\n  } catch {}\r\n  applyState({ unlocked, level, progress }, { skipPersist: true });\r\n  mutationState.slot = targetSlot;\r\n}\r\n\r\nfunction cleanupWatchers() {\r\n  while (watcherCleanups.length) {\r\n    const stop = watcherCleanups.pop();\r\n    try { stop?.(); } catch {}\r\n  }\r\n}\r\n\r\nfunction bindStorageWatchers(slot) {\r\n  if (watchersBoundSlot === slot) return;\r\n  cleanupWatchers();\r\n  watchersBoundSlot = slot;\r\n  if (slot == null) return;\r\n  watcherCleanups.push(watchStorageKey(KEY_UNLOCK(slot), {\r\n    onChange(value) {\r\n      const nextUnlocked = value === '1';\r\n      if (mutationState.unlocked !== nextUnlocked) {\r\n        mutationState.unlocked = nextUnlocked;\r\n        if (!nextUnlocked) {\r\n          mutationState.level = bnZero();\r\n          mutationState.progress = bnZero();\r\n        }\r\n        ensureRequirement();\r\n        updateHud();\r\n        emitChange('storage');\r\n        scheduleCoinMultiplierRefresh();\r\n      }\r\n    },\r\n  }));\r\n  watcherCleanups.push(watchStorageKey(KEY_LEVEL(slot), {\r\n    onChange(value) {\r\n      if (!value) return;\r\n      try {\r\n        const next = BN.fromAny(value);\r\n        if (mutationState.level.cmp?.(next) !== 0) {\r\n          mutationState.level = next;\r\n          ensureRequirement();\r\n          updateHud();\r\n          emitChange('storage');\r\n          scheduleCoinMultiplierRefresh();\r\n        }\r\n      } catch {}\r\n    },\r\n  }));\r\n  watcherCleanups.push(watchStorageKey(KEY_PROGRESS(slot), {\r\n    onChange(value) {\r\n      if (!value) return;\r\n      try {\r\n        const next = BN.fromAny(value);\r\n        if (mutationState.progress.cmp?.(next) !== 0) {\r\n          mutationState.progress = next;\r\n          ensureRequirement();\r\n          updateHud();\r\n          emitChange('storage');\r\n        }\r\n      } catch {}\r\n    },\r\n  }));\r\n}\r\n\r\nexport function initMutationSystem({ forceReload = false } = {}) {\r\n  ensureExternalMultiplierProviders();\r\n  if (initialized) {\r\n    const activeSlot = getActiveSlot();\r\n    const slotChanged = activeSlot !== mutationState.slot;\r\n    if (slotChanged || forceReload) {\r\n      readStateFromStorage(activeSlot);\r\n    }\r\n    bindStorageWatchers(activeSlot);\r\n    ensureHudRefs();\r\n    updateHud();\r\n    return getMutationState();\r\n  }\r\n  initialized = true;\r\n  ensureHudRefs();\r\n  const slot = getActiveSlot();\r\n  mutationState.slot = slot;\r\n  readStateFromStorage(slot);\r\n  bindStorageWatchers(slot);\r\n  updateHud();\r\n  scheduleCoinMultiplierRefresh();\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('saveSlot:change', () => {\r\n      const nextSlot = getActiveSlot();\r\n      mutationState.slot = nextSlot;\r\n      readStateFromStorage(nextSlot);\r\n      bindStorageWatchers(nextSlot);\r\n      updateHud();\r\n      scheduleCoinMultiplierRefresh();\r\n      emitChange('slot');\r\n    });\r\n  }\r\n  return getMutationState();\r\n}\r\n\r\nexport function getMutationState() {\r\n  return {\r\n    unlocked: mutationState.unlocked,\r\n    level: cloneBigNum(mutationState.level),\r\n    progress: cloneBigNum(mutationState.progress),\r\n    requirement: cloneBigNum(mutationState.requirement),\r\n  };\r\n}\r\n\r\nexport function isMutationUnlocked() {\r\n  return !!mutationState.unlocked;\r\n}\r\n\r\nexport function unlockMutationSystem() {\r\n  initMutationSystem();\r\n  if (mutationState.unlocked) return false;\r\n  mutationState.unlocked = true;\r\n  ensureRequirement();\r\n  persistState();\r\n  updateHud();\r\n  emitChange('unlock');\r\n  scheduleCoinMultiplierRefresh();\r\n  return true;\r\n}\r\n\r\nexport function setMutationUnlockedForDebug(unlocked) {\r\n  initMutationSystem();\r\n  const nextUnlocked = !!unlocked;\r\n  applyState({\r\n    unlocked: nextUnlocked,\r\n    level: nextUnlocked ? mutationState.level : bnZero(),\r\n    progress: nextUnlocked ? mutationState.progress : bnZero(),\r\n  });\r\n}\r\n\r\nexport function addMutationPower(amount) {\r\n  initMutationSystem();\r\n  if (!mutationState.unlocked) return getMutationState();\r\n\r\n  if (mutationState.level && mutationState.level.isInfinite?.()) {\r\n    if (!mutationState.progress?.isInfinite?.()) {\r\n      try { mutationState.progress = BN.fromAny('Infinity'); } catch {}\r\n    }\r\n    if (!mutationState.requirement?.isInfinite?.()) {\r\n      try { mutationState.requirement = BN.fromAny('Infinity'); } catch {}\r\n    }\r\n    return getMutationState();\r\n  }\r\n\r\n  let inc;\r\n  try {\r\n    inc = amount instanceof BN ? amount : BN.fromAny(amount ?? 0);\r\n  } catch {\r\n    inc = bnZero();\r\n  }\r\n\r\n  inc = applyStatMultiplierOverride('mutation', inc);\r\n\r\n  if (inc.isZero?.()) return getMutationState();\r\n\r\n  const incClone = inc.clone?.() ?? inc;\r\n  const prevLevel = mutationState.level.clone?.() ?? mutationState.level;\r\n  const prevProgress = mutationState.progress.clone?.() ?? mutationState.progress;\r\n\r\n  // Add MP\r\n  mutationState.progress = mutationState.progress.add(incClone);\r\n\r\n  // If MP overflows to BigNum Infinity, treat that as reaching mutation Infinity.\r\n  const progInf = mutationState.progress.isInfinite?.();\r\n  if (progInf) {\r\n    try {\r\n      mutationState.level = BN.fromAny('Infinity');\r\n    } catch {}\r\n\r\n    // Keep progress locked at Infinity once we reach mutation \u221E\r\n    try {\r\n      mutationState.progress = BN.fromAny('Infinity');\r\n    } catch {\r\n      mutationState.progress = bnZero();\r\n    }\r\n\r\n    try {\r\n      mutationState.requirement = BN.fromAny('Infinity');\r\n    } catch {}\r\n  } else {\r\n    // Normal levelling logic (now friendly to \u221E requirements)\r\n    normalizeProgress();\r\n  }\r\n\r\n  persistState();\r\n  updateHud();\r\n\r\n  const levelsGained = mutationState.level.sub(prevLevel);\r\n  if (!levelsGained.isZero?.()) {\r\n    scheduleCoinMultiplierRefresh();\r\n  }\r\n\r\n  const detail = emitChange('progress', {\r\n    delta: incClone.clone?.() ?? incClone,\r\n    levelsGained: levelsGained.clone?.() ?? levelsGained,\r\n    level: mutationState.level.clone?.() ?? mutationState.level,\r\n    progress: mutationState.progress.clone?.() ?? mutationState.progress,\r\n    requirement: mutationState.requirement.clone?.() ?? mutationState.requirement,\r\n    previousLevel: prevLevel.clone?.() ?? prevLevel,\r\n    previousProgress: prevProgress.clone?.() ?? prevProgress,\r\n  });\r\n\r\n  return detail;\r\n}\r\n\r\nexport function broadcastMutationChange(detailOverrides = {}) {\r\n  initMutationSystem();\r\n  const reason = detailOverrides.changeType ?? 'manual';\r\n  return emitChange(reason, detailOverrides);\r\n}\r\n\r\nexport function computeMutationMultiplierForLevel(levelValue) {\r\n  let levelBn;\r\n  if (levelValue instanceof BN) {\r\n    try { levelBn = levelValue.clone?.() ?? levelValue; }\r\n    catch { levelBn = bnZero(); }\r\n  } else if (typeof levelValue === 'bigint') {\r\n    try { levelBn = BigNum.fromAny(levelValue.toString()); }\r\n    catch { levelBn = bnZero(); }\r\n  } else {\r\n    try { levelBn = BigNum.fromAny(levelValue ?? 0); }\r\n    catch { levelBn = bnZero(); }\r\n  }\r\n\r\n  // If the stored mutation level itself is infinite, every multiplier that\r\n  // depends on it becomes infinite as well.\r\n  if (levelBn && levelBn.isInfinite?.()) {\r\n    try { return BN.fromAny('Infinity'); }\r\n    catch { return bnOne(); }\r\n  }\r\n\r\n  const levelNum = levelToNumber(levelBn);\r\n\r\n  // If levelToNumber can't represent this cleanly (NaN / Infinity), also\r\n  // treat that as infinite multiplier.\r\n  if (!Number.isFinite(levelNum)) {\r\n    try { return BN.fromAny('Infinity'); }\r\n    catch { return bnOne(); }\r\n  }\r\n\r\n  if (levelNum <= 0) return bnOne();\r\n\r\n  const log10 = levelNum * MP_LOG10_BASE;\r\n  return bigNumFromLog10(log10);\r\n}\r\n\r\nexport function computeMutationRequirementForLevel(levelValue) {\r\n  let levelBn;\r\n  try { levelBn = levelValue instanceof BN ? levelValue : BN.fromAny(levelValue ?? 0); }\r\n  catch { levelBn = bnZero(); }\r\n  try { return computeRequirement(levelBn); }\r\n  catch { return bnZero(); }\r\n}\r\n\r\nexport function getMutationMultiplier() {\r\n  initMutationSystem();\r\n  if (!mutationState.unlocked) return bnOne();\r\n  try { return computeMutationMultiplierForLevel(mutationState.level); }\r\n  catch { return bnOne(); }\r\n}\r\n\r\nexport function getMutationCoinSprite() {\r\n  if (!mutationState.unlocked || mutationState.level.isZero?.()) {\r\n    return 'img/currencies/coin/coin.png';\r\n  }\r\n\r\n  const levelNum = levelToNumber(mutationState.level);\r\n  if (!Number.isFinite(levelNum)) {\r\n    return 'img/mutations/m25.png';\r\n  }\r\n  const idx = Math.max(1, Math.min(25, Math.floor(levelNum)));\r\n\r\n  return `img/mutations/m${idx}.png`;\r\n}\r\n\r\n\r\nexport function onMutationChange(callback) {\r\n  if (typeof callback !== 'function') return () => {};\r\n  listeners.add(callback);\r\n  return () => { listeners.delete(callback); };\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.mutationSystem = window.mutationSystem || {};\r\n  Object.assign(window.mutationSystem, {\r\n    initMutationSystem,\r\n    unlockMutationSystem,\r\n    addMutationPower,\r\n    getMutationState,\r\n    getMutationMultiplier,\r\n    isMutationUnlocked,\r\n  });\r\n}", "// spawner.js\r\n\r\nimport { takePreloadedAudio } from '../util/audioCache.js';\r\nimport { getMutationState, onMutationChange } from './mutationSystem.js';\r\nimport { IS_MOBILE } from '../main.js';\r\n\r\nlet mutationUnlockedSnapshot = false;\r\nlet mutationLevelSnapshot = 0n;\r\n\r\nfunction updateMutationSnapshot(state) {\r\n  if (!state || typeof state !== 'object') {\r\n    mutationUnlockedSnapshot = false;\r\n    mutationLevelSnapshot = 0n;\r\n    return;\r\n  }\r\n  mutationUnlockedSnapshot = !!state.unlocked;\r\n  try {\r\n    const level = state.level;\r\n    const plain = typeof level?.toPlainIntegerString === 'function'\r\n      ? level.toPlainIntegerString()\r\n      : null;\r\n    mutationLevelSnapshot = plain && plain !== 'Infinity' ? BigInt(plain) : 0n;\r\n  } catch {\r\n    mutationLevelSnapshot = 0n;\r\n  }\r\n}\r\n\r\ntry {\r\n  updateMutationSnapshot(getMutationState());\r\n} catch {\r\n  mutationUnlockedSnapshot = false;\r\n  mutationLevelSnapshot = 0n;\r\n}\r\n\r\ntry {\r\n  onMutationChange((snapshot) => { updateMutationSnapshot(snapshot); });\r\n} catch {}\r\n\r\nexport function createSpawner({\r\n    playfieldSelector = '.area-cove .playfield',\r\n    waterSelector = '.water-base',\r\n    surgesHost = '.surges',\r\n    coinsHost = '.coins-layer',\r\n    coinSrc = 'img/coin/coin.png',\r\n    coinSize = 40,\r\n    animationName = 'coin-from-wave',\r\n    animationDurationMs = 1500,\r\n    surgeLifetimeMs = 1400,\r\n    surgeWidthVw = 22,\r\n    coinsPerSecond = 1,\r\n    perFrameBudget = 24,\r\n    backlogCap = 600,\r\n    maxActiveCoins = 1500,\r\n    initialBurst = 1,\r\n\tcoinTtlMs = 60000,\r\n\twaveSoundSrc = 'sounds/wave_spawn.mp3',\r\n    waveSoundDesktopVolume = 0.40,\r\n    waveSoundMobileVolume  = 0.16,\r\n    waveSoundMinIntervalMs = 160,\r\n    enableDropShadow = false,\r\n} = {}) {\r\n\r\n    let currentCoinSrc = coinSrc;\r\n    const isTouch = window.matchMedia('(hover: none) and (pointer: coarse)').matches;\r\n\tconst MOBILE_BACKLOG_CAP = 50;\r\n\tlet burstUntil = 0;\r\n\r\n\tconst BURST_WINDOW_MS        = 120;\r\n\tconst BURST_TIME_BUDGET_MS   = 10.0;\r\n\tconst BURST_HARD_CAP         = 400;\r\n\tconst ONE_SHOT_THRESHOLD     = 180;\r\n\tconst NORMAL_TIME_BUDGET_MS  = 2.0;\r\n\r\n\r\n    // ---------- resolve and keep DOM references ----------\r\n    const refs = {\r\n        pf: document.querySelector(playfieldSelector),\r\n        w: document.querySelector(waterSelector),\r\n        s: document.querySelector(surgesHost),\r\n        c: document.querySelector(coinsHost),\r\n        hud: document.getElementById('hud-bottom'),\r\n    };\r\n\r\n    function validRefs() {\r\n        return !!(refs.pf && refs.w && refs.s && refs.c);\r\n    }\r\n\r\n    if (!validRefs()) {\r\n        console.warn('[Spawner] Missing required nodes. Check your selectors:', {\r\n            playfieldSelector,\r\n            waterSelector,\r\n            surgesHost,\r\n            coinsHost\r\n        });\r\n    }\r\n\r\n    // ---------- cached layout metrics (refreshed on resize/visibility) ----------\r\n    let M = {\r\n        pfRect: null,\r\n        wRect: null,\r\n        safeBottom: 0,\r\n        pfW: 0\r\n    };\r\n\r\n    function computeMetrics() {\r\n        if (!validRefs())\r\n            return false;\r\n        const pfRect = refs.pf.getBoundingClientRect();\r\n        const wRect = refs.w.getBoundingClientRect();\r\n        const hudH = refs.hud ? refs.hud.getBoundingClientRect().height : 0;\r\n\r\n        M = {\r\n            pfRect,\r\n            wRect,\r\n            safeBottom: pfRect.height - hudH,\r\n            pfW: pfRect.width\r\n        };\r\n        return true;\r\n    }\r\n\r\n    computeMetrics();\r\n\r\n    const ro = 'ResizeObserver' in window ? new ResizeObserver(() => computeMetrics()) : null;\r\n    if (ro && refs.pf)\r\n        ro.observe(refs.pf);\r\n    document.addEventListener('visibilitychange', () => {\r\n        if (!document.hidden)\r\n            computeMetrics();\r\n    });\r\n\r\n    // ---------- small utilities ----------\r\n    const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));\r\n\r\n    // ---------- pools ----------\r\n    const COIN_POOL_MAX = Math.max(2000, maxActiveCoins * 3);\r\n    const SURGE_POOL_MAX = 800;\r\n    const COIN_MARGIN = 12;\r\n\r\n    const coinPool = [];\r\n    const surgePool = [];\r\n\r\n    function makeCoin() {\r\n        const el = document.createElement('div');\r\n        el.className = 'coin';\r\n        el.style.position = 'absolute';\r\n        el.style.width = `${coinSize}px`;\r\n        el.style.height = `${coinSize}px`;\r\n        el.style.background = `url(${currentCoinSrc}) center/contain no-repeat`;\r\n        el.style.borderRadius = '50%';\r\n        el.style.pointerEvents = 'none';\r\n        el.style.willChange = 'transform, opacity';\r\n        el.style.contain = 'layout paint style size';\r\n        if (enableDropShadow)\r\n            el.style.filter = 'drop-shadow(0 2px 2px rgba(0,0,0,.35))';\r\n        return el;\r\n    }\r\n    const getCoin = () => (coinPool.length ? coinPool.pop() : makeCoin());\r\n     function releaseCoin(el) {\r\n   el.style.animation = 'none';\r\n   el.style.transform = '';\r\n   el.style.opacity = '1';\r\n    delete el.dataset.dieAt;\r\n    delete el.dataset.jitter;\r\n    delete el.dataset.collected;\r\n\r\n   if (el.parentNode)\r\n     el.remove();\r\n   if (coinPool.length < COIN_POOL_MAX)\r\n     coinPool.push(el);\r\n }\r\n\r\n    function makeSurge() {\r\n        const el = document.createElement('div');\r\n        el.className = 'wave-surge';\r\n        el.style.willChange = 'transform, opacity';\r\n        return el;\r\n    }\r\n    const getSurge = () => (surgePool.length ? surgePool.pop() : makeSurge());\r\n    function releaseSurge(el) {\r\n        el.classList.remove('run');\r\n        if (el.parentNode)\r\n            el.remove();\r\n        if (surgePool.length < SURGE_POOL_MAX)\r\n            surgePool.push(el);\r\n    }\r\n\t\r\n\t  // ---- Wave spawn SFX ----\r\nconst waveURL = new URL(waveSoundSrc, document.baseURI).href;\r\nlet waveHtmlEl = null;       // single HTMLAudio element for mobile fallback\r\nlet waveHtmlSource = null;   // MediaElementSourceNode connected to WA gain\r\n\r\nlet waveLastAt = 0;\r\n// Desktop/mobile-aware HTMLAudio play \u2014 on mobile, pipe through WebAudio gain\r\nlet wavePool = null, waveIdx = 0;\r\n\r\nfunction ensureWavePool() {\r\n  if (wavePool)\r\n    return wavePool;\r\n\r\n  const preloaded = takePreloadedAudio(waveSoundSrc);\r\n  const poolSize = 4;\r\n  wavePool = Array.from({ length: poolSize }, (_, idx) => {\r\n    if (idx === 0 && preloaded) {\r\n      preloaded.preload = 'auto';\r\n      try { preloaded.currentTime = 0; } catch (_) {}\r\n      preloaded.volume = 1;\r\n      return preloaded;\r\n    }\r\n    const a = new Audio(waveURL);\r\n    a.preload = 'auto';\r\n    a.load?.();\r\n    return a;\r\n  });\r\n\r\n  if (preloaded) {\r\n    for (let i = 1; i < wavePool.length; i++) {\r\n      wavePool[i].load?.();\r\n    }\r\n  }\r\n\r\n  return wavePool;\r\n}\r\n\r\nfunction playWaveHtmlVolume(vol) {\r\n  if (IS_MOBILE) {\r\n    try {\r\n      // Ensure WA context & gain (uses your mobile volume)\r\n      ac = ac || new (window.AudioContext || window.webkitAudioContext)();\r\n      if (ac.state === 'suspended') ac.resume();\r\n      gain = gain || ac.createGain();\r\n      gain.gain.value = waveSoundMobileVolume;\r\n      gain.connect(ac.destination);\r\n\r\n      // Reuse one <audio> element and feed it into WA (so gain controls loudness)\r\n      if (!waveHtmlEl) {\r\n        waveHtmlEl = new Audio(waveURL);\r\n        waveHtmlEl.preload = 'auto';\r\n        waveHtmlEl.playsInline = true;\r\n        waveHtmlEl.crossOrigin = 'anonymous';\r\n      }\r\n      if (!waveHtmlSource) {\r\n        waveHtmlSource = ac.createMediaElementSource(waveHtmlEl);\r\n        waveHtmlSource.connect(gain);\r\n      }\r\n\r\n      waveHtmlEl.muted = false;   // final volume is controlled by WA gain\r\n      waveHtmlEl.volume = 1.0;    // keep element at 1.0; WA gain applies mobile volume\r\n      waveHtmlEl.currentTime = 0;\r\n      waveHtmlEl.play().catch(() => {});\r\n      return; // \u2190 mobile path handled here\r\n    } catch (e) {\r\n      // If WA couldn\u2019t initialize (very rare after a gesture), avoid a loud blast:\r\n      try { const a = new Audio(waveURL); a.muted = true; a.play().catch(() => {}); } catch {}\r\n      return;\r\n    }\r\n  }\r\n\r\n  const pool = ensureWavePool();\r\n  const a = pool[waveIdx++ % pool.length];\r\n  a.volume = vol;\r\n  try { a.currentTime = 0; a.play(); } catch {}\r\n}\r\n\r\n// Mobile: WebAudio (with HTML fallback if WA isn\u2019t ready)\r\nlet ac = null, gain = null, waveBuf = null, waveLoading = false;\r\nasync function ensureWaveWA() {\r\n  if (waveBuf || waveLoading) return;\r\n  waveLoading = true;\r\n  try {\r\n    ac = ac || new (window.AudioContext || window.webkitAudioContext)();\r\n    gain = gain || ac.createGain();\r\n    gain.gain.value = waveSoundMobileVolume;   // <-- mobile gain\r\n    gain.connect(ac.destination);\r\n\r\n    const res = await fetch(waveURL, { cache: 'force-cache' });\r\n    const arr = await res.arrayBuffer();\r\n    waveBuf = await new Promise((ok, err) =>\r\n      ac.decodeAudioData ? ac.decodeAudioData(arr, ok, err) : ok(null)\r\n    );\r\n    if (ac.state === 'suspended') { try { await ac.resume(); } catch {} }\r\n  } catch (_) {} finally { waveLoading = false; }\r\n}\r\n\r\nfunction playWaveMobile() {\r\n  try { if (ac && ac.state === 'suspended') ac.resume(); } catch {}\r\n  if (waveBuf && ac && gain) {\r\n    try {\r\n      const src = ac.createBufferSource();\r\n      src.buffer = waveBuf;\r\n      src.connect(gain);\r\n      src.start();\r\n      return;\r\n    } catch {}\r\n  }\r\n  // WA not ready yet \u2192 use HTML fallback at MOBILE volume (fix for \"first wave too loud\")\r\n  playWaveHtmlVolume(waveSoundMobileVolume);\r\n  ensureWaveWA();\r\n}\r\n\r\n// Gesture warm (iOS Safari)\r\nconst warmWave = () => { if (IS_MOBILE) ensureWaveWA(); };\r\n['pointerdown','touchstart'].forEach(evt =>\r\n  window.addEventListener(evt, warmWave, { once: true, passive: true, capture: true })\r\n);\r\n\r\nensureWavePool();\r\n\r\ndocument.addEventListener('visibilitychange', () => {\r\n  if (!document.hidden && IS_MOBILE && ac && ac.state === 'suspended') {\r\n    try { ac.resume(); } catch {}\r\n  }\r\n});\r\n\r\nfunction playWaveOncePerBurst() {\r\n  const now = performance.now();\r\n  if (now - waveLastAt < waveSoundMinIntervalMs) return; // rate-limit\r\n  waveLastAt = now;\r\n  if (IS_MOBILE) playWaveMobile();\r\n  else          playWaveHtmlVolume(waveSoundDesktopVolume);\r\n}\r\n\r\n\r\n\r\n    // ---------- spawn planning ----------\r\n    function planCoinFromWave(wave) {\r\n        if (!wave) return null;\r\n        const { x: waveX, y: waveTop, w: waveW } = wave;\r\n\r\n        const crestCenter = waveX + waveW / 2 + (Math.random() * 60 - 30);\r\n        const startX = crestCenter - coinSize / 2;\r\n        const startY = waveTop + 10 - coinSize / 2;\r\n\r\n        const drift = Math.random() * 100 - 50;\r\n        const endX = clamp(startX + drift, COIN_MARGIN, M.pfW - coinSize - COIN_MARGIN);\r\n        const minY = Math.max(M.wRect.height + 80, 120);\r\n        const maxY = Math.max(minY + 40, M.safeBottom - coinSize - 6);\r\n        const endY = clamp(minY + Math.random() * (maxY - minY), minY, maxY);\r\n\r\n        const midX = startX + (endX - startX) * 0.66;\r\n        const jitterMs = Math.random() * 100;\r\n\r\n        return {\r\n            x0: startX,\r\n            y0: startY,\r\n            xMid: midX,\r\n            y1: endY,\r\n            x1: endX,\r\n            jitterMs,\r\n        };\r\n    }\r\n\r\n    function planSpawn() {\r\n        if (!validRefs())\r\n            return null;\r\n        if (!M.pfRect || !M.wRect)\r\n            computeMetrics();\r\n\r\n        if (maxActiveCoins !== Infinity && refs.c.childElementCount >= maxActiveCoins) {\r\n            const oldest = refs.c.firstElementChild;\r\n            if (oldest)\r\n                releaseCoin(oldest);\r\n        }\r\n\r\n        const pfW = M.pfW;\r\n        const waveW = clamp(pfW * (surgeWidthVw / 100), 220, 520);\r\n        const leftMax = Math.max(1, pfW - waveW - COIN_MARGIN * 2);\r\n        const waveX = Math.random() * leftMax + COIN_MARGIN;\r\n\r\n        const waterToPfTop = M.wRect.top - M.pfRect.top;\r\n        const waveTop = Math.max(0, waterToPfTop + M.wRect.height * 0.05);\r\n\r\n        const wave = {\r\n            x: waveX,\r\n            y: waveTop,\r\n            w: waveW\r\n        };\r\n\r\n        const coinPlan = planCoinFromWave(wave);\r\n        if (!coinPlan) return null;\r\n\r\n    return {\r\n        wave,\r\n        coin: coinPlan\r\n    };\r\n}\r\n\r\nfunction commitBatch(batch) {\r\n  if (!batch.length || !validRefs()) return;\r\n\r\n  const wavesFrag = document.createDocumentFragment();\r\n  const coinsFrag = document.createDocumentFragment();\r\n  const newCoins = [];\r\n  const newSurges = [];\r\n\r\n  for (const { wave, coin } of batch) {\r\n    if (wave) {\r\n      const surge = getSurge();\r\n      surge.style.left = `${wave.x}px`;\r\n      surge.style.top = `${wave.y}px`;\r\n      surge.style.width = `${wave.w}px`;\r\n      wavesFrag.appendChild(surge);\r\n      newSurges.push(surge);\r\n    }\r\n\r\n    const el = getCoin();\r\n    el.style.background = `url(${currentCoinSrc}) center/contain no-repeat`;\r\n    el.style.setProperty('--x0', `${coin.x0}px`);\r\n    el.style.setProperty('--y0', `${coin.y0}px`);\r\n    el.style.setProperty('--xmid', `${coin.xMid}px`);\r\n    el.style.setProperty('--y1', `${coin.y1}px`);\r\n    el.style.setProperty('--x1', `${coin.x1}px`);\r\n    el.style.transform = `translate3d(${coin.x0}px, ${coin.y0}px, 0)`;\r\n    el.dataset.jitter = String(coin.jitterMs);\r\n    const animMs = Number(coin.durationMs);\r\n    if (Number.isFinite(animMs) && animMs > 0) {\r\n      el.dataset.animMs = String(Math.max(300, animMs));\r\n    } else if (el.dataset.animMs) {\r\n      delete el.dataset.animMs;\r\n    }\r\n    el.dataset.dieAt = String(performance.now() + coinTtlMs);\r\n    if (mutationUnlockedSnapshot) {\r\n      el.dataset.mutationLevel = mutationLevelSnapshot.toString();\r\n    } else {\r\n      el.dataset.mutationLevel = '0';\r\n    }\r\n\r\n    coinsFrag.appendChild(el);\r\n    newCoins.push(el);\r\n  }\r\n\r\n  refs.s.appendChild(wavesFrag);\r\n  refs.c.appendChild(coinsFrag);\r\n\r\n  requestAnimationFrame(() => {\r\n    if (newSurges.length) playWaveOncePerBurst();\r\n\r\n    for (const surge of newSurges) {\r\n      surge.classList.remove('run');\r\n      void surge.offsetWidth;\r\n      surge.classList.add('run');\r\n      const onEnd = (e) => {\r\n        if (e.target === surge) releaseSurge(surge);\r\n      };\r\n      surge.addEventListener('animationend', onEnd, { once: true });\r\n    }\r\n      for (const el of newCoins) {\r\n        const jitter = Number(el.dataset.jitter) || 0;\r\n        const animMs = Number(el.dataset.animMs);\r\n        const duration = Number.isFinite(animMs) && animMs > 0 ? Math.max(300, animMs) : animationDurationMs;\r\n        el.style.animation = 'none';\r\n        void el.offsetWidth;\r\n        el.style.animation = `${animationName} ${duration}ms ease-out ${jitter}ms 1 both`;\r\n      }\r\n  });\r\n}\r\n\r\n    function spawnBurst(n = 1) {\r\n        if (!validRefs())\r\n            return;\r\n        if (!M.pfRect || !M.wRect)\r\n            computeMetrics();\r\n        const batch = [];\r\n        for (let i = 0; i < n; i++) {\r\n            const plan = planSpawn();\r\n            if (plan) {\r\n                batch.push(plan);\r\n            }\r\n        }\r\n        if (batch.length)\r\n            commitBatch(batch);\r\n    }\r\n\r\n    // ---------- RAF loop with accumulator + micro-batching + backpressure ----------\r\n    let rate = coinsPerSecond;\r\n    let rafId = null;\r\n    let last = performance.now();\r\n    let carry = 0; // fractional coins\r\n    let queued = 0; // whole coins awaiting spawn\r\n\tlet ttlCursor = null;\r\n\tconst ttlChecksPerFrame = 200;\r\n\r\n   function loop(now) {\r\n  if (!M.pfRect || !M.wRect) computeMetrics();\r\n\r\n  const dt = (now - last) / 1000;  // keep backlog intact on resume\r\n  last = now;\r\n\r\n  // ---- TTL cleanup (pool-friendly) ----\r\n  {\r\n    let checked = 0;\r\n    let node = ttlCursor || (refs.c && refs.c.firstElementChild);\r\n    while (node && checked < ttlChecksPerFrame) {\r\n      const next = node.nextElementSibling;\r\n      const dieAt = Number((node.dataset && node.dataset.dieAt) || 0);\r\n      if (dieAt && now >= dieAt) {\r\n        releaseCoin(node);\r\n      }\r\n      node = next;\r\n      checked++;\r\n    }\r\n    ttlCursor = node || null;\r\n  }\r\n\r\n  // ---- Backlog accumulation (mobile cap = 100) ----\r\n  carry += rate * dt;\r\n  const due = carry | 0;\r\n const cap = isTouch ? MOBILE_BACKLOG_CAP : backlogCap;\r\n\r\n  // keep any existing queued clamped to the active cap\r\n  if (queued > cap) queued = cap;\r\n\r\nif (due > 0) {\r\n  queued = Math.min(cap, queued + due);\r\n  carry -= due;\r\n}\r\n\r\n\r\n  // ---- Spawn targets & time budgets ----\r\n  let spawnTarget = Math.min(queued, perFrameBudget);\r\n  let timeBudgetMs = NORMAL_TIME_BUDGET_MS;\r\n\r\n  // Mobile burst window: make it feel \"all at once\" but cap work per frame\r\n  if (isTouch && now < burstUntil && queued > 0) {\r\n    // If backlog is modest, allow a one-shot flush (within a higher time budget)\r\n    if (queued <= ONE_SHOT_THRESHOLD) {\r\n      spawnTarget  = queued;\r\n      timeBudgetMs = BURST_TIME_BUDGET_MS;\r\n    } else {\r\n      // Large backlog: aggressive but capped\r\n      spawnTarget  = Math.min(queued, BURST_HARD_CAP);\r\n      timeBudgetMs = BURST_TIME_BUDGET_MS;\r\n    }\r\n  }\r\n\r\n  // ---- Build batch under time budget ----\r\n  if (spawnTarget > 0) {\r\n    const t0 = performance.now();\r\n    const batch = [];\r\n    let baseSpawned = 0;\r\n    for (let i = 0; i < spawnTarget; i++) {\r\n      if (performance.now() - t0 > timeBudgetMs) break;\r\n      const plan = planSpawn();\r\n      if (plan) {\r\n        batch.push(plan);\r\n        baseSpawned += 1;\r\n      }\r\n    }\r\n    if (batch.length) {\r\n      commitBatch(batch);\r\n      if (baseSpawned > 0) {\r\n        queued = Math.max(0, queued - baseSpawned);\r\n      }\r\n    }\r\n  }\r\n\r\n  rafId = requestAnimationFrame(loop);\r\n}\r\n\r\n\r\n\r\n\r\n    function start() {\r\n      if (rafId) return;\r\n      if (!validRefs()) {\r\n        console.warn('[Spawner] start() called but required nodes are missing.');\r\n        return;\r\n      }\r\n      computeMetrics();\r\n\r\n    if (initialBurst > 0 && rafId === null) {\r\n      spawnBurst(initialBurst);\r\n\t}\r\n\r\n    last = performance.now();\r\n    rafId = requestAnimationFrame(loop);\r\n  }\r\n\r\n\r\n    function stop() {\r\n        if (!rafId)\r\n            return;\r\n        cancelAnimationFrame(rafId);\r\n        rafId = null;\r\n    }\r\n\r\n    function setRate(n) {\r\n        rate = Math.max(0, Number(n) || 0);\r\n    }\r\n\r\n    function setCoinSprite(src) {\r\n      if (!src) return;\r\n      currentCoinSrc = src;\r\n    }\r\n\r\n    // Resume clean when tab is visible again\r\n   document.addEventListener('visibilitychange', () => {\r\n    if (!document.hidden) {\r\n      if (isTouch) burstUntil = performance.now() + BURST_WINDOW_MS;\r\n      if (!rafId) start();\r\n    }\r\n  });\r\n\r\n    return {\r\n        start,\r\n        stop,\r\n        setRate,\r\n        setCoinSprite,\r\n    };\r\n}", "// js/game/coinPickup.js\r\n\r\nimport { bank, CURRENCIES, getActiveSlot, isCurrencyLocked } from '../util/storage.js';\r\nimport { BigNum } from '../util/bigNum.js';\r\nimport { formatNumber } from '../util/numFormat.js';\r\nimport { unlockShop } from '../ui/hudButtons.js';\r\nimport { addXp, isXpSystemUnlocked } from './xpSystem.js';\r\nimport { IS_MOBILE } from '../main.js';\r\nimport {\r\n  addMutationPower,\r\n  isMutationUnlocked,\r\n  getMutationState,\r\n  onMutationChange,\r\n  computeMutationMultiplierForLevel,\r\n} from './mutationSystem.js';\r\nimport { getMpValueMultiplierBn, getMagnetLevel } from './upgrades.js';\r\n\r\nlet mutationUnlockedSnapshot = false;\r\nlet mutationLevelIsInfiniteSnapshot = false;\r\nlet mutationUnsub = null;\r\n\r\nfunction updateMutationSnapshot(state) {\r\n  if (!state || typeof state !== 'object') {\r\n    mutationUnlockedSnapshot = false;\r\n    mutationLevelIsInfiniteSnapshot = false;\r\n    mutationMultiplierCache.clear();\r\n    return;\r\n  }\r\n\r\n  mutationUnlockedSnapshot = !!state.unlocked;\r\n  mutationLevelIsInfiniteSnapshot = !!state.level?.isInfinite?.();\r\n\r\n  if (!mutationUnlockedSnapshot) {\r\n    mutationMultiplierCache.clear();\r\n  } else if (mutationLevelIsInfiniteSnapshot) {\r\n    mutationMultiplierCache.clear();\r\n  }\r\n}\r\n\r\nfunction initMutationSnapshot() {\r\n  if (typeof mutationUnsub === 'function') {\r\n    try { mutationUnsub(); } catch {}\r\n  }\r\n  try {\r\n    updateMutationSnapshot(getMutationState());\r\n  } catch {\r\n    mutationUnlockedSnapshot = false;\r\n    mutationMultiplierCache.clear();\r\n  }\r\n  try {\r\n    mutationUnsub = onMutationChange((snapshot) => { updateMutationSnapshot(snapshot); });\r\n  } catch {\r\n    mutationUnsub = null;\r\n  }\r\n}\r\n\r\nlet coinPickup = null;\r\n\r\nconst XP_PER_COIN = BigNum.fromInt(1);\r\nconst BASE_COIN_VALUE = BigNum.fromInt(1);\r\nconst BN_ONE = BigNum.fromInt(1);\r\n\r\nlet BN_INF;\r\ntry {\r\n  BN_INF = BigNum.fromAny('Infinity');\r\n} catch {\r\n  BN_INF = null;\r\n}\r\n\r\nconst mutationMultiplierCache = new Map();\r\nlet COIN_MULTIPLIER = '1';\r\nlet mpValueMultiplierBn = BigNum.fromInt(1);\r\nlet mpMultiplierListenersBound = false;\r\n\r\nexport function setCoinMultiplier(x) {\r\n  COIN_MULTIPLIER = x;\r\n  try {\r\n    if (bank.coins?.mult?.set) {\r\n      bank.coins.mult.set(x);\r\n    }\r\n  } catch {}\r\n}\r\n\r\nfunction refreshMpValueMultiplierCache() {\r\n  try {\r\n    const next = getMpValueMultiplierBn();\r\n    if (next instanceof BigNum) {\r\n      mpValueMultiplierBn = next.clone?.() ?? next;\r\n    } else if (next != null) {\r\n      mpValueMultiplierBn = BigNum.fromAny(next);\r\n    } else {\r\n      mpValueMultiplierBn = BigNum.fromInt(1);\r\n    }\r\n  } catch {\r\n    mpValueMultiplierBn = BigNum.fromInt(1);\r\n  }\r\n}\r\n\r\nfunction ensureMpValueMultiplierSync() {\r\n  if (mpMultiplierListenersBound) return;\r\n  mpMultiplierListenersBound = true;\r\n  refreshMpValueMultiplierCache();\r\n  if (typeof document !== 'undefined') {\r\n    document.addEventListener('ccc:upgrades:changed', refreshMpValueMultiplierCache);\r\n  }\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('saveSlot:change', refreshMpValueMultiplierCache);\r\n  }\r\n}\r\n\r\nfunction resolveCoinBase(el) {\r\n  if (el?.dataset?.bn) {\r\n    try { return BigNum.fromAny(el.dataset.bn); } catch {}\r\n  }\r\n  if (el?.dataset?.value) {\r\n    try { return BigNum.fromAny(el.dataset.value); } catch {}\r\n  }\r\n  try { return BASE_COIN_VALUE.clone?.() ?? BigNum.fromInt(1); }\r\n  catch { return BigNum.fromInt(1); }\r\n}\r\n\r\nconst MAGNET_UNIT_RATIO = 0.03;\r\nconst MAGNET_COLLECTION_BUFFER = 8;\r\n\r\nfunction computeMagnetUnitPx() {\r\n  if (typeof window === 'undefined' || typeof document === 'undefined') return 0;\r\n  const root = document.documentElement;\r\n  const vw = Math.max(0, window.innerWidth || root?.clientWidth || 0);\r\n  const vh = Math.max(0, window.innerHeight || root?.clientHeight || 0);\r\n  if (!(vw > 0 && vh > 0)) return 0;\r\n  const minDim = Math.min(vw, vh);\r\n  return minDim * MAGNET_UNIT_RATIO;\r\n}\r\n\r\nfunction createMagnetController({ playfield, coinsLayer, coinSelector, collectFn }) {\r\n  if (!playfield || !coinsLayer || typeof collectFn !== 'function') {\r\n    return { destroy() {} };\r\n  }\r\n  if (typeof window === 'undefined' || typeof document === 'undefined') {\r\n    return { destroy() {} };\r\n  }\r\n\r\n  const indicator = document.createElement('div');\r\n  indicator.className = 'magnet-indicator';\r\n  indicator.setAttribute('aria-hidden', 'true');\r\n  playfield.appendChild(indicator);\r\n\r\n  let pointerInside = false;\r\n  let pointerClientX = 0;\r\n  let pointerClientY = 0;\r\n  let localX = 0;\r\n  let localY = 0;\r\n  let unitPx = computeMagnetUnitPx();\r\n  let magnetLevel = 0;\r\n  let radiusPx = 0;\r\n  let rafId = 0;\r\n  let destroyed = false;\r\n\r\n  const hideIndicator = () => {\r\n    indicator.classList.remove('is-visible');\r\n    indicator.style.transform = 'translate3d(-9999px, -9999px, 0)';\r\n  };\r\n\r\n  const updateIndicator = () => {\r\n    if (!pointerInside || radiusPx <= 0) {\r\n      hideIndicator();\r\n      return;\r\n    }\r\n    const diameter = radiusPx * 2;\r\n    indicator.style.width = `${diameter}px`;\r\n    indicator.style.height = `${diameter}px`;\r\n    indicator.style.transform = `translate3d(${localX - radiusPx}px, ${localY - radiusPx}px, 0)`;\r\n    indicator.classList.add('is-visible');\r\n  };\r\n\r\n  const sweepCoins = () => {\r\n    if (!pointerInside || radiusPx <= 0) return;\r\n    const coins = coinsLayer.querySelectorAll(coinSelector);\r\n    const radiusWithBuffer = radiusPx + MAGNET_COLLECTION_BUFFER;\r\n    for (let i = 0; i < coins.length; i += 1) {\r\n      const coin = coins[i];\r\n      if (!(coin instanceof HTMLElement) || coin.dataset.collected === '1') continue;\r\n      const rect = coin.getBoundingClientRect();\r\n      const coinX = rect.left + rect.width / 2;\r\n      const coinY = rect.top + rect.height / 2;\r\n      const dx = coinX - pointerClientX;\r\n      const dy = coinY - pointerClientY;\r\n      if (Math.hypot(dx, dy) <= radiusWithBuffer) {\r\n        collectFn(coin);\r\n      }\r\n    }\r\n  };\r\n\r\n  const runSweep = () => {\r\n    rafId = 0;\r\n    if (!pointerInside || radiusPx <= 0 || destroyed) return;\r\n    sweepCoins();\r\n    ensureSweepLoop();\r\n  };\r\n\r\n  const ensureSweepLoop = () => {\r\n    if (!pointerInside || radiusPx <= 0 || rafId || destroyed) return;\r\n    rafId = requestAnimationFrame(runSweep);\r\n  };\r\n\r\n  const updatePointerFromEvent = (e) => {\r\n    if (!e || destroyed) return;\r\n    if (typeof e.clientX !== 'number' || typeof e.clientY !== 'number') return;\r\n    pointerClientX = e.clientX;\r\n    pointerClientY = e.clientY;\r\n    const rect = playfield.getBoundingClientRect();\r\n    localX = pointerClientX - rect.left;\r\n    localY = pointerClientY - rect.top;\r\n    pointerInside = localX >= 0 && localX <= rect.width && localY >= 0 && localY <= rect.height;\r\n    updateIndicator();\r\n    ensureSweepLoop();\r\n  };\r\n\r\n  const handlePointerLeave = () => {\r\n    pointerInside = false;\r\n    hideIndicator();\r\n  };\r\n\r\n  const refreshMagnetLevel = () => {\r\n    const nextLevel = getMagnetLevel();\r\n    magnetLevel = nextLevel;\r\n    radiusPx = magnetLevel * unitPx;\r\n    updateIndicator();\r\n    ensureSweepLoop();\r\n  };\r\n\r\n  const handleResize = () => {\r\n    unitPx = computeMagnetUnitPx();\r\n    radiusPx = magnetLevel * unitPx;\r\n    updateIndicator();\r\n    ensureSweepLoop();\r\n  };\r\n\r\n  const destroy = () => {\r\n    destroyed = true;\r\n    if (rafId) {\r\n      cancelAnimationFrame(rafId);\r\n      rafId = 0;\r\n    }\r\n    try { window.removeEventListener('resize', handleResize); } catch {}\r\n    try { window.removeEventListener('saveSlot:change', refreshMagnetLevel); } catch {}\r\n    try { document.removeEventListener('ccc:upgrades:changed', refreshMagnetLevel); } catch {}\r\n    try { playfield.removeEventListener('pointermove', updatePointerFromEvent); } catch {}\r\n    try { playfield.removeEventListener('pointerdown', updatePointerFromEvent); } catch {}\r\n    try { playfield.removeEventListener('pointerenter', updatePointerFromEvent); } catch {}\r\n    try { playfield.removeEventListener('pointerleave', handlePointerLeave); } catch {}\r\n    try { playfield.removeEventListener('pointercancel', handlePointerLeave); } catch {}\r\n    try { indicator.remove(); } catch {}\r\n  };\r\n\r\n  const pointerOpts = { passive: true };\r\n  playfield.addEventListener('pointermove', updatePointerFromEvent, pointerOpts);\r\n  playfield.addEventListener('pointerdown', updatePointerFromEvent, pointerOpts);\r\n  playfield.addEventListener('pointerenter', updatePointerFromEvent, pointerOpts);\r\n  playfield.addEventListener('pointerleave', handlePointerLeave, pointerOpts);\r\n  playfield.addEventListener('pointercancel', handlePointerLeave, pointerOpts);\r\n  window.addEventListener('resize', handleResize);\r\n  window.addEventListener('saveSlot:change', refreshMagnetLevel);\r\n  document.addEventListener('ccc:upgrades:changed', refreshMagnetLevel);\r\n\r\n  refreshMagnetLevel();\r\n\r\n  return { destroy };\r\n}\r\n\r\nexport function initCoinPickup({\r\n  playfieldSelector   = '.area-cove .playfield',\r\n  coinsLayerSelector  = '.area-cove .coins-layer',\r\n  hudAmountSelector   = '.hud-top .coin-amount',\r\n  coinSelector        = '.coin, [data-coin], .coin-sprite',\r\n  soundSrc            = 'sounds/coin_pickup.mp3',\r\n  storageKey          = 'ccc:coins',\r\n  disableAnimation    = IS_MOBILE,\r\n} = {}) {\r\n  if (coinPickup?.destroy) {\r\n    coinPickup.destroy();\r\n  }\r\n  \r\n  const pf  = document.querySelector(playfieldSelector);\r\n  const cl  = document.querySelector(coinsLayerSelector);\r\n  const amt = document.querySelector(hudAmountSelector);\r\n  if (!pf || !cl || !amt) {\r\n    console.warn('[coinPickup] missing required nodes', { pf: !!pf, cl: !!cl, amt: !!amt });\r\n    return { destroy(){} };\r\n  }\r\n\r\n  initMutationSnapshot();\r\n  ensureMpValueMultiplierSync();\r\n\r\n  pf.style.touchAction = 'none';\r\n\r\n  let magnetController = null;\r\n  let coins = bank.coins.value;\r\n  let coinMultiplierBn = null;\r\n  let coinMultiplierIsInfinite = false;\r\n\r\n  const refreshCoinMultiplierCache = () => {\r\n    try {\r\n      const multHandle = bank?.coins?.mult;\r\n      if (!multHandle || typeof multHandle.get !== 'function') {\r\n        coinMultiplierBn = null;\r\n        coinMultiplierIsInfinite = false;\r\n        return;\r\n      }\r\n      const next = multHandle.get();\r\n      if (!next) {\r\n        coinMultiplierBn = BigNum.fromInt(1);\r\n        coinMultiplierIsInfinite = false;\r\n        return;\r\n      }\r\n      coinMultiplierBn = next.clone?.() ?? BigNum.fromAny(next);\r\n      coinMultiplierIsInfinite = !!coinMultiplierBn?.isInfinite?.();\r\n    } catch {\r\n      coinMultiplierBn = null;\r\n      coinMultiplierIsInfinite = false;\r\n    }\r\n  };\r\n\r\n  const applyCoinMultiplier = (value) => {\r\n    let base;\r\n    try {\r\n      base = value instanceof BigNum\r\n        ? (value.clone?.() ?? value)\r\n        : BigNum.fromAny(value ?? 0);\r\n    } catch {\r\n      try {\r\n        return bank?.coins?.mult?.applyTo ? bank.coins.mult.applyTo(value) : BigNum.fromInt(0);\r\n      } catch {\r\n        return BigNum.fromInt(0);\r\n      }\r\n    }\r\n\r\n    if (!coinMultiplierBn) refreshCoinMultiplierCache();\r\n    const mult = coinMultiplierBn;\r\n    if (!mult) {\r\n      try { return bank?.coins?.mult?.applyTo ? bank.coins.mult.applyTo(base) : base.clone?.() ?? base; }\r\n      catch { return base.clone?.() ?? base; }\r\n    }\r\n    const multIsInf = coinMultiplierIsInfinite || mult.isInfinite?.();\r\n    if (multIsInf) {\r\n      try { return BigNum.fromAny('Infinity'); }\r\n      catch { return base.clone?.() ?? base; }\r\n    }\r\n    if (base.isZero?.()) {\r\n      return base.clone?.() ?? base;\r\n    }\r\n    try {\r\n      return base.mulBigNumInteger(mult);\r\n    } catch {\r\n      try { return bank?.coins?.mult?.applyTo ? bank.coins.mult.applyTo(base) : base.clone?.() ?? base; }\r\n      catch { return base.clone?.() ?? base; }\r\n    }\r\n  };\r\n  const updateHud = () => {\r\n    const formatted = formatNumber(coins);\r\n    if (formatted.includes('<span')) {\r\n      amt.innerHTML = formatted;\r\n    } else {\r\n      amt.textContent = formatted;\r\n    }\r\n  };\r\n  refreshCoinMultiplierCache();\r\n  updateHud();\r\n\r\n  const cloneBn = (value) => {\r\n    if (!value) return BigNum.fromInt(0);\r\n    if (typeof value.clone === 'function') {\r\n      try { return value.clone(); } catch {}\r\n    }\r\n    try { return BigNum.fromAny(value); } catch { return BigNum.fromInt(0); }\r\n  };\r\n\r\nconst computeMutationMultiplier = (spawnLevelStr) => {\r\n  if (!mutationUnlockedSnapshot) return null;\r\n\r\n  // Global override: once mutation level itself is \u221E,\r\n  // every coin gets an \u221E multiplier regardless of its spawn level.\r\n  if (mutationLevelIsInfiniteSnapshot) {\r\n    if (BN_INF) {\r\n      try { return BN_INF.clone?.() ?? BN_INF; }\r\n      catch { return BN_INF; }\r\n    }\r\n    // Fallback if Infinity construction failed for some reason\r\n    return null;\r\n  }\r\n\r\n  if (!spawnLevelStr) return null;\r\n  const key = String(spawnLevelStr).trim();\r\n  if (!key) return null;\r\n\r\n  const cached = mutationMultiplierCache.get(key);\r\n  if (cached) {\r\n    try { return cached.clone?.() ?? BigNum.fromAny(cached); }\r\n    catch { mutationMultiplierCache.delete(key); }\r\n  }\r\n\r\n  let levelBn;\r\n  try {\r\n    levelBn = BigNum.fromAny(key);\r\n  } catch {\r\n    return null;\r\n  }\r\n\r\n  let multiplier;\r\n  try {\r\n    multiplier = computeMutationMultiplierForLevel(levelBn);\r\n  } catch {\r\n    multiplier = null;\r\n  }\r\n\r\n  if (!multiplier) return null;\r\n  const isIdentity = multiplier.cmp?.(BN_ONE) === 0;\r\n  const stored = multiplier.clone?.() ?? multiplier;\r\n  mutationMultiplierCache.set(key, stored);\r\n  if (isIdentity) return null;\r\n  try { return stored.clone?.() ?? stored; }\r\n  catch { return stored; }\r\n};\r\n\r\n  let pendingCoinGain = null;\r\n  let pendingXpGain = null;\r\n  let pendingMutGain = null;\r\n  let flushScheduled = false;\r\n\r\n  const mergeGain = (current, gain) => {\r\n    if (!gain) return current;\r\n    if (!current) return cloneBn(gain);\r\n    try { return current.add(gain); }\r\n    catch {\r\n      try {\r\n        const base = cloneBn(current);\r\n        return base.add(gain);\r\n      } catch {\r\n        return cloneBn(gain);\r\n      }\r\n    }\r\n  };\r\n\r\n  const flushPendingGains = () => {\r\n    const coinGain = pendingCoinGain;\r\n    pendingCoinGain = null;\r\n    if (coinGain && !coinGain.isZero?.()) {\r\n      try { bank.coins.add(coinGain); } catch {}\r\n    }\r\n\r\n    const xpGain = pendingXpGain;\r\n    pendingXpGain = null;\r\n    if (xpGain && !xpGain.isZero?.()) {\r\n      try { addXp(xpGain); } catch {}\r\n    }\r\n\r\n    const mutGain = pendingMutGain;\r\n    pendingMutGain = null;\r\n    if (mutGain && !mutGain.isZero?.()) {\r\n      try { addMutationPower(mutGain); } catch {}\r\n    }\r\n  };\r\n\r\n  const scheduleFlush = () => {\r\n    if (flushScheduled) return;\r\n    flushScheduled = true;\r\n    requestAnimationFrame(() => {\r\n      flushScheduled = false;\r\n      flushPendingGains();\r\n    });\r\n  };\r\n\r\n  const queueCoinGain = (gain) => {\r\n    pendingCoinGain = mergeGain(pendingCoinGain, gain);\r\n    scheduleFlush();\r\n  };\r\n\r\n  const queueXpGain = (gain) => {\r\n    pendingXpGain = mergeGain(pendingXpGain, gain);\r\n    scheduleFlush();\r\n  };\r\n\r\n  const queueMutationGain = (gain) => {\r\n    pendingMutGain = mergeGain(pendingMutGain, gain);\r\n    scheduleFlush();\r\n  };\r\n\r\n  if (typeof window !== 'undefined') {\r\n    window.addEventListener('beforeunload', flushPendingGains, { passive: true });\r\n  }\r\n\r\n  try {\r\n    if (bank.coins?.mult?.get && bank.coins?.mult?.set) {\r\n      const curr = bank.coins.mult.get(); // BN\r\n      if (curr.toPlainIntegerString() === '1' && COIN_MULTIPLIER && COIN_MULTIPLIER !== '1') {\r\n        bank.coins.mult.set(COIN_MULTIPLIER);\r\n      }\r\n    }\r\n  } catch {}\r\n\r\n  const onCurrencyChange = (e) => {\r\n    if (!e?.detail) return;\r\n    if (e.detail.key === 'coins') {\r\n      coins = e.detail.value;\r\n      updateHud();\r\n    }\r\n  };\r\n  window.addEventListener('currency:change', onCurrencyChange);\r\n\r\n  const onCoinMultiplierChange = (event) => {\r\n    if (!event?.detail || event.detail.key !== 'coins') return;\r\n    try {\r\n      const { mult } = event.detail;\r\n      if (mult instanceof BigNum) {\r\n        coinMultiplierBn = mult.clone?.() ?? mult;\r\n      } else if (mult != null) {\r\n        coinMultiplierBn = BigNum.fromAny(mult);\r\n      } else {\r\n        coinMultiplierBn = BigNum.fromInt(1);\r\n      }\r\n      coinMultiplierIsInfinite = !!coinMultiplierBn?.isInfinite?.();\r\n    } catch {\r\n      coinMultiplierBn = null;\r\n      coinMultiplierIsInfinite = false;\r\n    }\r\n  };\r\n  window.addEventListener('currency:multiplier', onCoinMultiplierChange);\r\n\r\n  // ----- Slot-scoped shop unlock/progress keys -----\r\n  const slot = getActiveSlot();\r\n  if (slot == null) {\r\n    console.warn('[coinPickup] init called before a save slot is selected.');\r\n    return { destroy(){} };\r\n  }\r\n  const SHOP_UNLOCK_KEY   = `ccc:unlock:shop:${slot}`;\r\n  const SHOP_PROGRESS_KEY = `ccc:unlock:shop:progress:${slot}`;\r\n  // const MAP_UNLOCK_KEY = `ccc:unlock:map:${slot}`; // (future)\r\n\r\n  // (optional) migrate any legacy unsuffixed keys once\r\n  const legacyP = localStorage.getItem('ccc:unlock:shop:progress');\r\n  const legacyU = localStorage.getItem('ccc:unlock:shop');\r\n  if (legacyP != null && localStorage.getItem(SHOP_PROGRESS_KEY) == null) {\r\n    localStorage.setItem(SHOP_PROGRESS_KEY, legacyP);\r\n  }\r\n  if (legacyU != null && localStorage.getItem(SHOP_UNLOCK_KEY) == null) {\r\n    localStorage.setItem(SHOP_UNLOCK_KEY, legacyU);\r\n  }\r\n  localStorage.removeItem('ccc:unlock:shop:progress');\r\n  localStorage.removeItem('ccc:unlock:shop');\r\n\r\n  // normalize existing progress for this slot\r\n  {\r\n    const p = parseInt(localStorage.getItem(SHOP_PROGRESS_KEY) || '0', 10);\r\n    localStorage.setItem(SHOP_PROGRESS_KEY, String(p));\r\n    if (p >= 10 && localStorage.getItem(SHOP_UNLOCK_KEY) !== '1') {\r\n      try { unlockShop(); } catch {}\r\n      localStorage.setItem(SHOP_UNLOCK_KEY, '1');\r\n    }\r\n  }\r\n\r\n  // ----- Helpers -----\r\n  const DESKTOP_VOLUME = 0.3;\r\n  const MOBILE_VOLUME  = 0.12;\r\n  const resolvedSrc = new URL(soundSrc, document.baseURI).href;\r\n\r\n  // coins test\r\n  const isCoin = (el) => el instanceof HTMLElement && el.dataset.collected !== '1' && el.matches(coinSelector);\r\n\r\n  // Make current & future coins receptive to events even if CSS had pointer-events:none\r\n  function ensureInteractive(el){ try { el.style.pointerEvents = 'auto'; } catch {} }\r\n  cl.querySelectorAll(coinSelector).forEach(ensureInteractive);\r\n  const mo = new MutationObserver((recs) => {\r\n    for (const r of recs){\r\n      r.addedNodes.forEach(n => { if (n instanceof HTMLElement && n.matches(coinSelector)) { ensureInteractive(n); bindCoinDirect(n); } });\r\n    }\r\n  });\r\n  mo.observe(cl, { childList: true, subtree: true });\r\n\r\n  // ----- Audio (Mobile: WebAudio + fallback) -----\r\n  let ac = null, masterGain = null, buffer = null;\r\n  let webAudioReady = false, webAudioLoading = false, webAudioAttempted = false;\r\n  let queuedPlays = 0;\r\n\r\n  let mobileFallback = null;\r\n  function playCoinMobileFallback(){\r\n    if (!mobileFallback){\r\n      mobileFallback = new Audio(resolvedSrc);\r\n      mobileFallback.preload = 'auto';\r\n    }\r\n    // Re-apply the intended volume on every play (guards against drift)\r\n    mobileFallback.muted = false;\r\n    mobileFallback.volume = MOBILE_VOLUME;\r\n    try {\r\n      mobileFallback.currentTime = 0;\r\n      mobileFallback.play();\r\n    } catch {}\r\n  }\r\n\r\n  async function initWebAudioOnce(){\r\n    if (webAudioReady || webAudioLoading) return;\r\n    if (!('AudioContext' in window || 'webkitAudioContext' in window)) return;\r\n\r\n    webAudioLoading = true; webAudioAttempted = true;\r\n    ac = new (window.AudioContext || window.webkitAudioContext)();\r\n    masterGain = ac.createGain();\r\n    masterGain.gain.value = MOBILE_VOLUME;\r\n    masterGain.connect(ac.destination);\r\n\r\n    try {\r\n      const res = await fetch(resolvedSrc, { cache: 'force-cache' });\r\n      const arr = await res.arrayBuffer();\r\n      buffer = await new Promise((ok, err) => ac.decodeAudioData(arr, ok, err));\r\n      if (ac.state === 'suspended') { try { await ac.resume(); } catch {} }\r\n      webAudioReady = true;\r\n    } catch (e) {\r\n      console.warn('[coinPickup] WebAudio init failed:', e);\r\n    } finally {\r\n      webAudioLoading = false;\r\n    }\r\n  }\r\n\r\n  function playCoinWebAudio(){\r\n    if (ac && ac.state === 'suspended'){ try { ac.resume(); } catch {} }\r\n\r\n    if (IS_MOBILE && (!webAudioReady || !ac || !buffer || !masterGain || (ac && ac.state !== 'running'))) {\r\n      if (!webAudioLoading) initWebAudioOnce();\r\n      playCoinMobileFallback();   // respects MOBILE_VOLUME\r\n      return true;\r\n    }\r\n\r\n    // Desktop: if this ever happens (unlikely), let WA path return to caller\r\n    if (!webAudioReady || !ac || !buffer || !masterGain) {\r\n      if (!webAudioLoading) initWebAudioOnce();\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      const src = ac.createBufferSource();\r\n      src.buffer = buffer;\r\n      try { src.detune = 0; } catch {}\r\n\r\n      // Re-assert the correct volume on every play\r\n      masterGain.gain.setValueAtTime(MOBILE_VOLUME, ac.currentTime);\r\n\r\n      src.connect(masterGain);\r\n      const t = ac.currentTime + Math.random()*0.006; // avoid phasing when many play\r\n      src.start(t);\r\n      return true;\r\n    } catch (e){\r\n      console.warn('[coinPickup] playCoinWebAudio error:', e);\r\n      if (IS_MOBILE) playCoinMobileFallback();\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function playSound(){\r\n    if (IS_MOBILE) return playCoinWebAudio();\r\n    return playCoinHtmlAudio();\r\n  }\r\n\r\n  // Warm WebAudio eager on any gesture (window + playfield), capture=true so overlays don\u2019t block\r\n  const warm = () => { if (IS_MOBILE) initWebAudioOnce(); };\r\n  ['pointerdown', 'touchstart', 'click'].forEach(evt => {\r\n    window.addEventListener(evt, warm, { once: true, passive: true, capture: true });\r\n    pf.addEventListener(evt, warm, { once: true, passive: true, capture: true });\r\n  });\r\n\r\n  // ----- Desktop audio pool -----\r\n  let pool = null, pIdx = 0, lastAt = 0;\r\n  if (!IS_MOBILE){\r\n    pool = Array.from({ length: 8 }, () => { const a = new Audio(resolvedSrc); a.preload = 'auto'; a.volume = 0.3; return a; });\r\n  }\r\n  function playCoinHtmlAudio(){\r\n    const now = performance.now(); if ((now - lastAt) < 40) return; lastAt = now;\r\n    const a = pool[pIdx++ % pool.length];\r\n    try { a.currentTime = 0; a.play(); } catch {}\r\n  }\r\n\r\n  // ----- Collecting -----\r\n  function animateAndRemove(el){\r\n    if (disableAnimation) { el.remove(); return; }\r\n    const cs = getComputedStyle(el);\r\n    const start = cs.transform && cs.transform !== 'none' ? cs.transform : 'translate3d(0,0,0)';\r\n    el.style.setProperty('--ccc-start', start);\r\n    el.classList.add('coin--collected');\r\n    const done = () => { el.removeEventListener('animationend', done); el.remove(); };\r\n    el.addEventListener('animationend', done);\r\n    setTimeout(done, 600);\r\n  }\r\n\r\nfunction collect(el) {\r\n  if (!isCoin(el)) return false;\r\n  el.dataset.collected = '1';\r\n\r\n  playSound();\r\n  animateAndRemove(el);\r\n\r\n  const base = resolveCoinBase(el);\r\n  const coinsLocked = isCurrencyLocked(CURRENCIES.COINS);\r\n\r\n  let inc = applyCoinMultiplier(base);\r\n  let xpInc = cloneBn(XP_PER_COIN);\r\n\r\n  const spawnLevelStr = el.dataset.mutationLevel || null;\r\n  const mutationMultiplier = computeMutationMultiplier(spawnLevelStr);\r\n  if (mutationMultiplier) {\r\n    try { inc = inc.mulBigNumInteger(mutationMultiplier); } catch {}\r\n    try { xpInc = xpInc.mulBigNumInteger(mutationMultiplier); } catch {}\r\n  }\r\n\r\n  const incIsZero = typeof inc?.isZero === 'function' ? inc.isZero() : false;\r\n  if (!incIsZero && !coinsLocked) {\r\n    try {\r\n      coins = coins?.add ? coins.add(inc) : cloneBn(inc);\r\n    } catch {\r\n      coins = cloneBn(inc);\r\n    }\r\n  }\r\n  updateHud();\r\n  if (!incIsZero) {\r\n    queueCoinGain(inc);\r\n  }\r\n\r\n  const xpEnabled = typeof isXpSystemUnlocked === 'function' ? isXpSystemUnlocked() : true;\r\n  const xpIsZero = typeof xpInc?.isZero === 'function' ? xpInc.isZero() : false;\r\n  if (xpEnabled && !xpIsZero) {\r\n    queueXpGain(xpInc);\r\n  }\r\n\r\n  if (typeof isMutationUnlocked === 'function' && isMutationUnlocked()) {\r\n    const mpGain = cloneBn(mpValueMultiplierBn);\r\n    if (!mpGain.isZero?.()) {\r\n      queueMutationGain(mpGain);\r\n    }\r\n  }\r\n\r\n  if (localStorage.getItem(SHOP_UNLOCK_KEY) !== '1') {\r\n    const next = parseInt(localStorage.getItem(SHOP_PROGRESS_KEY) || '0', 10) + 1;\r\n    localStorage.setItem(SHOP_PROGRESS_KEY, String(next));\r\n    if (next >= 10) {\r\n      try { unlockShop(); } catch {}\r\n      localStorage.setItem(SHOP_UNLOCK_KEY, '1');\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n  magnetController = createMagnetController({\r\n    playfield: pf,\r\n    coinsLayer: cl,\r\n    coinSelector,\r\n    collectFn: collect,\r\n  });\r\n\r\n  // direct coin events as a safety net (helps if elementsFromPoint misses due to CSS)\r\n  function bindCoinDirect(coin){\r\n    coin.addEventListener('pointerdown', (e) => { collect(coin); }, { passive: true });\r\n    coin.addEventListener('mouseenter', () => { if (!IS_MOBILE) collect(coin); }, { passive: true });\r\n  }\r\n  cl.querySelectorAll(coinSelector).forEach(bindCoinDirect);\r\n\r\n  // Brush sweep \u2014 checks several offsets so you can \u201Cgraze\u201D coins while swiping\r\n  const BRUSH_R = 18; // px\r\n  const OFF = [[0,0],[BRUSH_R,0],[-BRUSH_R,0],[0,BRUSH_R],[0,-BRUSH_R]];\r\n  function brushAt(x,y){\r\n    // Primary: use hit-test stack\r\n    for (let k=0;k<OFF.length;k++){\r\n      const px = x + OFF[k][0], py = y + OFF[k][1];\r\n      const stack = document.elementsFromPoint(px, py);\r\n      for (let i=0;i<stack.length;i++){\r\n        const el = stack[i];\r\n        if (isCoin(el)) { collect(el); }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Schedule brush per frame for performance\r\n  let pending = null, brushScheduled = false;\r\n  function scheduleBrush(x,y){\r\n    pending = {x,y};\r\n    if (!brushScheduled){\r\n      brushScheduled = true;\r\n      requestAnimationFrame(() => {\r\n        if (pending){ brushAt(pending.x, pending.y); pending = null; }\r\n        brushScheduled = false;\r\n      });\r\n    }\r\n  }\r\n\r\n  // Touch / pen\r\n  pf.addEventListener('pointerdown', (e) => { if (e.pointerType !== 'mouse') scheduleBrush(e.clientX, e.clientY); }, { passive: true });\r\n  pf.addEventListener('pointermove', (e) => { if (e.pointerType !== 'mouse') scheduleBrush(e.clientX, e.clientY); }, { passive: true });\r\n  pf.addEventListener('pointerup',   (e) => { if (e.pointerType !== 'mouse') scheduleBrush(e.clientX, e.clientY); }, { passive: true });\r\n\r\n  // Desktop mouse hover sweep (lightly throttled by rAF above)\r\n  pf.addEventListener('mousemove', (e) => { scheduleBrush(e.clientX, e.clientY); }, { passive: true });\r\n\r\n  // Public API + cleanup\r\n  function setMobileVolume(v){\r\n    const vol = Math.max(0, Math.min(1, Number(v) || 0));\r\n    if (masterGain && ac) masterGain.gain.setValueAtTime(vol, ac.currentTime);\r\n    if (mobileFallback) mobileFallback.volume = vol;\r\n  }\r\n\r\n  const destroy = () => {\r\n    flushPendingGains();\r\n    if (typeof window !== 'undefined') {\r\n      window.removeEventListener('beforeunload', flushPendingGains);\r\n      window.removeEventListener('currency:multiplier', onCoinMultiplierChange);\r\n      window.removeEventListener('currency:change', onCurrencyChange);\r\n    }\r\n    if (typeof mutationUnsub === 'function') {\r\n      try { mutationUnsub(); } catch {}\r\n      mutationUnsub = null;\r\n    }\r\n    if (magnetController?.destroy) {\r\n      try { magnetController.destroy(); } catch {}\r\n      magnetController = null;\r\n    }\r\n    try { mo.disconnect(); } catch {}\r\n    try { ['pointerdown','pointermove','pointerup','mousemove'].forEach(evt => pf.replaceWith(pf.cloneNode(true))); } catch {}\r\n  };\r\n\r\n  coinPickup = { destroy };\r\n\r\n  return {\r\n    get count(){ return coins; },\r\n    set count(v){\r\n      coins = BigNum.fromAny ? BigNum.fromAny(v) : BigNum.fromInt(Number(v) || 0);\r\n      updateHud();\r\n      // Note: saving is handled via bank.set inside bank.coins.add in storage\r\n    },\r\n    setMobileVolume,\r\n    destroy,\r\n  };\r\n}", "// js/util/saveIntegrity.js\r\n// If a player modifies their save file manually (e.g., console commands, local storage editing, JSON tampering),\r\n// A one-way flag, `hasModifiedSave`, will become true and turn the shop button's color brown,\r\n// Which I like to call the poop-shop of shame.\r\n// Used to detect cheaters.\r\n\r\nimport {\r\n  STORAGE_PREFIX,\r\n  getActiveSlot,\r\n  getSlotSignature,\r\n  setSlotSignature,\r\n  markSaveSlotModified,\r\n  getSlotSignatureKey,\r\n  hasModifiedSave,\r\n} from './storage.js';\r\n\r\nconst SIGNATURE_POLL_INTERVAL_MS = 10000;\r\nconst TRUSTED_MUTATION_GRACE_MS = 750;\r\nconst TRUSTED_SWEEP_DELAY_MS = 50;\r\nlet watcherId = null;\r\nlet trustedSweepTimer = null;\r\n\r\nconst trustedSlotsUntil = new Map();\r\n\r\nfunction nowMs() {\r\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\r\n    return performance.now();\r\n  }\r\n  return Date.now();\r\n}\r\n\r\nfunction noteTrustedSlot(slot, ttl = TRUSTED_MUTATION_GRACE_MS) {\r\n  if (!slot || slot <= 0) return;\r\n  trustedSlotsUntil.set(slot, nowMs() + ttl);\r\n}\r\n\r\nfunction slotRecentlyTrusted(slot) {\r\n  if (!slot || slot <= 0) return false;\r\n  const expiry = trustedSlotsUntil.get(slot);\r\n  if (expiry == null) return false;\r\n  if (expiry <= nowMs()) {\r\n    trustedSlotsUntil.delete(slot);\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction resetTrustedSlots() {\r\n  trustedSlotsUntil.clear();\r\n}\r\n\r\nfunction hasLocalStorage() {\r\n  try {\r\n    return typeof localStorage !== 'undefined';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// In-memory snapshot of expected localStorage state per slot.\r\n// This lets us detect manual/out-of-band changes while the game is running.\r\nconst expectedStateBySlot = new Map();\r\nlet integrityInternalWriteDepth = 0;\r\n\r\nfunction parseSlotFromKey(key) {\r\n  if (!key) return null;\r\n  const match = /:(\\d+)$/.exec(String(key));\r\n  if (!match) return null;\r\n  const slot = Number.parseInt(match[1], 10);\r\n  return Number.isFinite(slot) && slot > 0 ? slot : null;\r\n}\r\n\r\nfunction rebuildExpectedStateForSlot(slot) {\r\n  const snapshot = new Map();\r\n  if (!hasLocalStorage()) {\r\n    expectedStateBySlot.set(slot, snapshot);\r\n    return snapshot;\r\n  }\r\n  try {\r\n    for (let i = 0; i < localStorage.length; i += 1) {\r\n      const key = localStorage.key(i);\r\n      if (!key || !key.startsWith(STORAGE_PREFIX)) continue;\r\n      const keySlot = parseSlotFromKey(key);\r\n      if (keySlot == null || keySlot !== slot) continue;\r\n      let value = '';\r\n      try {\r\n        value = localStorage.getItem(key) ?? '';\r\n      } catch {\r\n        value = '';\r\n      }\r\n      snapshot.set(key, value);\r\n    }\r\n  } catch {}\r\n  expectedStateBySlot.set(slot, snapshot);\r\n  return snapshot;\r\n}\r\n\r\nfunction ensureExpectedStateForSlot(slot) {\r\n  if (!Number.isFinite(slot) || slot <= 0) return null;\r\n  if (expectedStateBySlot.has(slot)) return expectedStateBySlot.get(slot);\r\n  return rebuildExpectedStateForSlot(slot);\r\n}\r\n\r\nexport function beforeSlotWrite(key) {\r\n  if (!hasLocalStorage()) return;\r\n  if (integrityInternalWriteDepth > 0) return;\r\n\r\n  const strKey = String(key);\r\n  if (!strKey.startsWith(STORAGE_PREFIX)) return;\r\n\r\n  const slot = parseSlotFromKey(strKey);\r\n\r\n  if (slot == null) return;\r\n\r\n  const snapshot = ensureExpectedStateForSlot(slot);\r\n  if (!snapshot) return;\r\n\r\n  try {\r\n    for (const [snapKey, expectedValue] of snapshot.entries()) {\r\n      let actualValue = '';\r\n      try {\r\n        actualValue = localStorage.getItem(snapKey) ?? '';\r\n      } catch {\r\n        actualValue = '';\r\n      }\r\n      if (actualValue !== expectedValue) {\r\n        if (integrityInternalWriteDepth === 0) {\r\n          integrityInternalWriteDepth += 1;\r\n          try {\r\n            markSaveSlotModified(slot);\r\n          } finally {\r\n            integrityInternalWriteDepth -= 1;\r\n          }\r\n        }\r\n        rebuildExpectedStateForSlot(slot);\r\n        return;\r\n      }\r\n    }\r\n  } catch {}\r\n}\r\n\r\nexport function afterSlotWrite(key, value) {\r\n  const strKey = String(key);\r\n  if (!strKey.startsWith(STORAGE_PREFIX)) return;\r\n  const slot = parseSlotFromKey(strKey);\r\n  if (slot == null) return;\r\n\r\n  const snapshot = ensureExpectedStateForSlot(slot) || new Map();\r\n  snapshot.set(strKey, String(value ?? ''));\r\n  expectedStateBySlot.set(slot, snapshot);\r\n}\r\n\r\nfunction computeSignature(entries = []) {\r\n  let hash = 0;\r\n  for (const entry of entries) {\r\n    for (let i = 0; i < entry.length; i += 1) {\r\n      hash = ((hash << 5) - hash + entry.charCodeAt(i)) >>> 0;\r\n    }\r\n    hash = (hash + 0x9e3779b1) >>> 0;\r\n  }\r\n  return `${entries.length}|${hash.toString(16)}`;\r\n}\r\n\r\nfunction collectEntriesBySlot() {\r\n  const map = new Map();\r\n  if (!hasLocalStorage()) return map;\r\n  try {\r\n    for (let i = 0; i < localStorage.length; i += 1) {\r\n      const key = localStorage.key(i);\r\n      if (!key || !key.startsWith(STORAGE_PREFIX)) continue;\r\n      const slotMatch = key.match(/:(\\d+)$/);\r\n      if (!slotMatch) continue;\r\n      const slot = parseInt(slotMatch[1], 10);\r\n      if (!Number.isFinite(slot) || slot <= 0) continue;\r\n      const sigKey = getSlotSignatureKey(slot);\r\n      if (key === sigKey) {\r\n        if (!map.has(slot)) map.set(slot, []);\r\n        continue;\r\n      }\r\n      let value = '';\r\n      try { value = localStorage.getItem(key) ?? ''; }\r\n      catch {}\r\n      if (!map.has(slot)) map.set(slot, []);\r\n      map.get(slot).push(`${key}=${value}`);\r\n    }\r\n  } catch {}\r\n  map.forEach((entries) => entries.sort());\r\n  return map;\r\n}\r\n\r\nfunction getCandidateSlots(entriesBySlot) {\r\n  const slots = new Set();\r\n  if (entriesBySlot) {\r\n    entriesBySlot.forEach((_, slot) => slots.add(slot));\r\n  }\r\n  const active = getActiveSlot();\r\n  if (Number.isFinite(active) && active > 0) slots.add(active);\r\n  if (typeof document !== 'undefined') {\r\n    document.querySelectorAll('.slot-card').forEach((_, idx) => slots.add(idx + 1));\r\n  }\r\n  return [...slots].filter((slot) => Number.isFinite(slot) && slot > 0);\r\n}\r\n\r\nfunction verifySlotIntegrity(slot, entries) {\r\n  if (!slot || slot <= 0) return;\r\n  const list = Array.isArray(entries) ? entries : [];\r\n  const stored = getSlotSignature(slot);\r\n  if (list.length === 0) {\r\n    if (stored) {\r\n      if (!slotRecentlyTrusted(slot)) {\r\n        markSaveSlotModified(slot);\r\n      }\r\n      setSlotSignature(slot, null);\r\n    }\r\n    return;\r\n  }\r\n  const signature = computeSignature(list);\r\n  const mismatch = signature !== stored;\r\n  if (stored && mismatch && !slotRecentlyTrusted(slot)) {\r\n    markSaveSlotModified(slot);\r\n  }\r\n  if (signature !== stored) {\r\n    setSlotSignature(slot, signature);\r\n  }\r\n}\r\n\r\nfunction runIntegrityCheck() {\r\n  if (!hasLocalStorage()) return;\r\n  const entriesBySlot = collectEntriesBySlot();\r\n  const slots = getCandidateSlots(entriesBySlot);\r\n  slots.forEach((slot) => {\r\n    const entries = entriesBySlot.get(slot) ?? [];\r\n    verifySlotIntegrity(slot, entries);\r\n  });\r\n}\r\n\r\nfunction scheduleTrustedMutationSweep() {\r\n  if (trustedSweepTimer != null) return;\r\n  const root = typeof window !== 'undefined' ? window : globalThis;\r\n  trustedSweepTimer = root.setTimeout(() => {\r\n    trustedSweepTimer = null;\r\n    runIntegrityCheck();\r\n  }, TRUSTED_SWEEP_DELAY_MS);\r\n}\r\n\r\nfunction handleStorageMutationEvent(event) {\r\n  const detail = event?.detail;\r\n  if (!detail) return;\r\n  const rawSlot = typeof detail.slot === 'number' ? detail.slot : Number.parseInt(detail.slot, 10);\r\n  const slot = Number.isFinite(rawSlot) ? rawSlot : null;\r\n  if (!Number.isFinite(slot) || slot <= 0) return;\r\n  if (detail.trusted) {\r\n    noteTrustedSlot(slot);\r\n    scheduleTrustedMutationSweep();\r\n    return;\r\n  }\r\n  trustedSlotsUntil.delete(slot);\r\n  runIntegrityCheck();\r\n}\r\n\r\nfunction ensureWatcher() {\r\n  if (typeof window === 'undefined') return;\r\n  if (watcherId != null) return;\r\n  watcherId = window.setInterval(runIntegrityCheck, SIGNATURE_POLL_INTERVAL_MS);\r\n}\r\n\r\nconst POOP_SHOP_BG  = 'linear-gradient(180deg,#a9793d,#7b5534)';\r\nconst POOP_SHOP_FLAG = '1';\r\n\r\nlet poopShopTimer = null;\r\n\r\nfunction getShopButtonElement() {\r\n  if (typeof document === 'undefined') return null;\r\n  return document.querySelector('.hud-bottom .game-btn[data-btn=\"shop\"]');\r\n}\r\n\r\nfunction enforcePoopShopStyle() {\r\n  const btn = getShopButtonElement();\r\n  if (!btn) return;\r\n\r\n  const isModded = hasModifiedSave();\r\n\r\n  if (!isModded) {\r\n    if (btn.dataset.poopShopApplied === POOP_SHOP_FLAG || btn.style.backgroundImage || btn.style.background) {\r\n      btn.style.backgroundImage = '';\r\n      btn.style.background = '';\r\n      delete btn.dataset.poopShopApplied;\r\n    }\r\n    return;\r\n  }\r\n\r\n  const current = btn.style.backgroundImage || btn.style.background;\r\n  if (current !== POOP_SHOP_BG || btn.dataset.poopShopApplied !== POOP_SHOP_FLAG) {\r\n    btn.style.backgroundImage = POOP_SHOP_BG;\r\n    btn.dataset.poopShopApplied = POOP_SHOP_FLAG;\r\n  }\r\n}\r\n\r\nfunction startPoopShopEnforcer() {\r\n  if (typeof window === 'undefined') return;\r\n  if (poopShopTimer != null) return;\r\n\r\n  enforcePoopShopStyle();\r\n  poopShopTimer = window.setInterval(enforcePoopShopStyle, 50);\r\n\r\n  window.addEventListener('saveSlot:change', enforcePoopShopStyle);\r\n  window.addEventListener('saveSlot:modified', (ev) => {\r\n    try {\r\n      const active = getActiveSlot();\r\n      if (ev?.detail?.slot === active) {\r\n        enforcePoopShopStyle();\r\n      }\r\n    } catch {\r\n      enforcePoopShopStyle();\r\n    }\r\n  });\r\n}\r\n\r\nfunction init() {\r\n  if (typeof window === 'undefined') return;\r\n  runIntegrityCheck();\r\n  ensureWatcher();\r\n  startPoopShopEnforcer();\r\n  window.addEventListener('saveSlot:change', () => runIntegrityCheck());\r\n  window.addEventListener('saveIntegrity:storageMutation', handleStorageMutationEvent, { passive: true });\r\n  if (typeof document !== 'undefined') {\r\n    document.addEventListener('visibilitychange', () => {\r\n      if (!document.hidden) {\r\n        resetTrustedSlots();\r\n        runIntegrityCheck();\r\n        enforcePoopShopStyle();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\ninit();", "// js/ui/popups.js\r\n\r\nimport { BigNum } from '../util/bigNum.js';\r\nimport { formatNumber } from '../util/numFormat.js';\r\nimport { CURRENCIES } from '../util/storage.js';\r\n\r\nconst DEFAULT_DURATION = 3200;\r\n\r\nconst POPUP_ORDER = ['coins', 'xp', 'books', 'gold', 'mp'];\r\n\r\nconst POPUP_META = {\r\n  [CURRENCIES.COINS]: {\r\n    icon: 'img/currencies/coin/coin.png',\r\n    iconAlt: 'Coin',\r\n  },\r\n  xp: {\r\n    icon: 'img/stats/xp/xp.png',\r\n    iconAlt: 'XP',\r\n  },\r\n  [CURRENCIES.BOOKS]: {\r\n    icon: 'img/currencies/book/book.png',\r\n    iconAlt: 'Book',\r\n  },\r\n  [CURRENCIES.GOLD]: {\r\n    icon: 'img/currencies/gold/gold.png',\r\n    iconAlt: 'Gold',\r\n  },\r\n  mp: {\r\n    icon: 'img/stats/mp/mp.png',\r\n    iconAlt: 'Mutation Power',\r\n  },\r\n};\r\n\r\nlet container = null;\r\nlet initialized = false;\r\nconst lastKnownAmounts = new Map();\r\nconst activePopups = new Map();\r\n\r\nfunction ensureContainer() {\r\n  if (container) return container;\r\n  container = document.createElement('div');\r\n  container.className = 'currency-popups';\r\n  container.setAttribute('aria-live', 'polite');\r\n  container.setAttribute('aria-atomic', 'false');\r\n  document.body.appendChild(container);\r\n  return container;\r\n}\r\n\r\nfunction bnFromAny(value) {\r\n  if (value == null) return null;\r\n  if (value instanceof BigNum) return value.clone?.() ?? value;\r\n  if (typeof value.clone === 'function' && value.sig != null) {\r\n    try { return value.clone(); } catch {}\r\n  }\r\n  try { return BigNum.fromAny(value); } catch { return null; }\r\n}\r\n\r\nfunction isZero(bn) {\r\n  if (!bn) return true;\r\n  if (typeof bn.isZero === 'function') {\r\n    try { return bn.isZero(); } catch { return false; }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction updateEntry(entry) {\r\n  if (!entry) return;\r\n  const { amountEl, amount, meta } = entry;\r\n  const formatted = meta.formatAmount ? meta.formatAmount(amount) : formatNumber(amount);\r\n  if (amountEl) amountEl.innerHTML = formatted;\r\n}\r\n\r\nfunction scheduleRemoval(entry, duration = DEFAULT_DURATION) {\r\n  if (!entry) return;\r\n  if (entry.timeoutId) return; // already scheduled; do NOT reset\r\n  entry.timeoutId = window.setTimeout(() => {\r\n    activePopups.delete(entry.type);\r\n    entry.element.classList.remove('is-visible');\r\n    entry.element.classList.add('is-leaving');\r\n    const remove = () => {\r\n      entry.element.removeEventListener('transitionend', remove);\r\n      entry.element.remove();\r\n    };\r\n    entry.element.addEventListener('transitionend', remove, { once: true });\r\n    window.setTimeout(remove, 480);\r\n  }, duration);\r\n}\r\n\r\nfunction createPopupEntry(type, meta, amount) {\r\n  ensureContainer();\r\n  const element = document.createElement('div');\r\n  element.className = 'currency-popup';\r\n  element.setAttribute('role', 'status');\r\n\r\n  const plus = document.createElement('span');\r\n  plus.className = 'currency-popup__plus';\r\n  plus.textContent = '+';\r\n\r\n  const icon = document.createElement('img');\r\n  icon.className = 'currency-popup__icon';\r\n  icon.src = meta.icon;\r\n  icon.alt = meta.iconAlt || '';\r\n\r\n  const text = document.createElement('span');\r\n  text.className = 'currency-popup__text';\r\n\r\n  const amountEl = document.createElement('span');\r\n  amountEl.className = 'currency-popup__amount';\r\n\r\n  text.append(amountEl);\r\n  element.append(plus, icon, text);\r\n\r\n  return {\r\n    type,\r\n    meta,\r\n    element,\r\n    amountEl,\r\n    amount: amount.clone?.() ?? amount,\r\n    timeoutId: null,\r\n  };\r\n}\r\n\r\nfunction showPopup(type, amount, overrides = {}) {\r\n  const baseMeta = POPUP_META[type];\r\n  const meta = Object.assign({ duration: DEFAULT_DURATION, accumulate: true }, baseMeta || {}, overrides);\r\n  if (!meta.icon) return;\r\n\r\n  const bnAmount = bnFromAny(amount);\r\n  if (!bnAmount || isZero(bnAmount)) return;\r\n\r\n  const existing = meta.accumulate !== false ? activePopups.get(type) : null;\r\n\r\n  if (existing) {\r\n    // Update the number but DO NOT reset its lifetime or animations.\r\n    existing.amount = existing.amount.add(bnAmount);\r\n    existing.meta = meta;\r\n    updateEntry(existing);\r\n    return;\r\n  }\r\n\r\n  const entry = createPopupEntry(type, meta, bnAmount);\r\n  entry.meta = meta;\r\n  updateEntry(entry);\r\n  activePopups.set(type, entry);\r\n\r\n  const host = ensureContainer();\r\n\r\n  // Insert based on order (coins first, xp second, books last)\r\n  const index = POPUP_ORDER.indexOf(type);\r\n  let insertBefore = null;\r\n  if (index >= 0) {\r\n    for (let i = index + 1; i < POPUP_ORDER.length; i++) {\r\n      const next = activePopups.get(POPUP_ORDER[i]);\r\n      if (next?.element?.parentNode === host) {\r\n        insertBefore = next.element;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (insertBefore) host.insertBefore(entry.element, insertBefore);\r\n  else host.appendChild(entry.element);\r\n\r\n  requestAnimationFrame(() => entry.element.classList.add('is-visible'));\r\n  scheduleRemoval(entry, meta.duration); // scheduled ONCE at creation\r\n}\r\n\r\nfunction syncLastKnown() {\r\n  try {\r\n    const all = getAllCurrencies();\r\n    Object.entries(all).forEach(([key, value]) => {\r\n      const bn = bnFromAny(value) || BigNum.fromInt(0);\r\n      lastKnownAmounts.set(key, bn.clone?.() ?? bn);\r\n    });\r\n    if (!lastKnownAmounts.has('mp')) {\r\n      lastKnownAmounts.set('mp', BigNum.fromInt(0));\r\n    }\r\n  } catch {\r\n    lastKnownAmounts.clear();\r\n  }\r\n}\r\n\r\nfunction clearActivePopups() {\r\n  activePopups.forEach((entry) => {\r\n    if (entry.timeoutId) clearTimeout(entry.timeoutId);\r\n    entry.element.remove();\r\n  });\r\n  activePopups.clear();\r\n}\r\n\r\nfunction handleCurrencyChange(event) {\r\n  const detail = event?.detail;\r\n  if (!detail?.key) return;\r\n  const key = detail.key;\r\n  const current = bnFromAny(detail.value) || BigNum.fromInt(0);\r\n  const prev = lastKnownAmounts.get(key) || BigNum.fromInt(0);\r\n  const zero = BigNum.fromInt(0);\r\n  let delta = null;\r\n  const detailDelta = detail.delta != null ? bnFromAny(detail.delta) : null;\r\n  if (detailDelta && typeof detailDelta.cmp === 'function' && detailDelta.cmp(zero) > 0) {\r\n    delta = detailDelta;\r\n  } else if (typeof current.cmp === 'function' && current.cmp(prev) > 0) {\r\n    delta = current.sub(prev);\r\n  }\r\n  if (delta && !(typeof delta.isZero === 'function' && delta.isZero())) {\r\n    showPopup(key, delta);\r\n  }\r\n  lastKnownAmounts.set(key, current.clone?.() ?? current);\r\n}\r\n\r\nfunction handleXpChange(event) {\r\n  const detail = event?.detail;\r\n  if (!detail) return;\r\n  const xpAdded = bnFromAny(detail.xpAdded);\r\n  if (xpAdded && !isZero(xpAdded)) showPopup('xp', xpAdded);\r\n}\r\n\r\nfunction handleMutationChange(event) {\r\n  const detail = event?.detail;\r\n  if (!detail) return;\r\n  const delta = bnFromAny(detail.delta);\r\n  if (delta && !isZero(delta)) {\r\n    showPopup('mp', delta);\r\n  }\r\n  const nextProgress = bnFromAny(detail.progress);\r\n  if (nextProgress) {\r\n    lastKnownAmounts.set('mp', nextProgress.clone?.() ?? nextProgress);\r\n  }\r\n}\r\n\r\nfunction handleSlotChange() {\r\n  clearActivePopups();\r\n  syncLastKnown();\r\n}\r\n\r\nexport function initPopups() {\r\n  if (initialized) return;\r\n  initialized = true;\r\n  ensureContainer();\r\n  syncLastKnown();\r\n  window.addEventListener('currency:change', handleCurrencyChange);\r\n  window.addEventListener('xp:change', handleXpChange);\r\n  window.addEventListener('mutation:change', handleMutationChange);\r\n  window.addEventListener('saveSlot:change', handleSlotChange);\r\n}\r\n\r\nexport function teardownpopups() {\r\n  if (!initialized) return;\r\n  window.removeEventListener('currency:change', handleCurrencyChange);\r\n  window.removeEventListener('xp:change', handleXpChange);\r\n  window.removeEventListener('mutation:change', handleMutationChange);\r\n  window.removeEventListener('saveSlot:change', handleSlotChange);\r\n  clearActivePopups();\r\n  lastKnownAmounts.clear();\r\n  if (container) container.remove();\r\n  container = null;\r\n  initialized = false;\r\n}", "// js/util/suspendSafeguard.js\r\n// Improves local storage tracking by supplying helper functions for saveIntegrity.js,\r\n// And also supplies frequent IndexedDB snapshots to back up progress if\r\n// Local storage ever becomes corrupted (safeguard against abrupt page suspensions)\r\nimport { beforeSlotWrite, afterSlotWrite } from './saveIntegrity.js';\r\n\r\nconst STORAGE_PREFIX = 'ccc:';\r\nconst DB_NAME = 'ccc:safety';\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'snapshots';\r\nconst SNAPSHOT_KEY = 'latest';\r\nconst SLOT_SIGNATURE_PREFIX = `${STORAGE_PREFIX}slotSig`;\r\nconst SLOT_MOD_FLAG_PREFIX = `${STORAGE_PREFIX}slotMod`;\r\nconst FLUSH_DEBOUNCE_MS = 1000;\r\n\r\nlet dbPromise = null;\r\nlet flushTimer = null;\r\nlet dirty = false;\r\nlet lastDirtyReason = 'init';\r\nlet installAttempted = false;\r\nlet restoreAttempted = false;\r\nlet pendingImmediateFlush = false;\r\n\r\nfunction canUseIndexedDb() {\r\n  if (typeof indexedDB === 'undefined') return false;\r\n  try {\r\n    return typeof indexedDB.open === 'function';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction canUseLocalStorage() {\r\n  if (typeof localStorage === 'undefined') return false;\r\n  try {\r\n    const testKey = `${STORAGE_PREFIX}__test__`;\r\n    localStorage.setItem(testKey, '1');\r\n    localStorage.removeItem(testKey);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function openDatabase() {\r\n  if (!canUseIndexedDb()) throw new Error('IndexedDB unavailable');\r\n  if (dbPromise) return dbPromise;\r\n\r\n  dbPromise = new Promise((resolve, reject) => {\r\n    let resolved = false;\r\n    try {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n      request.onupgradeneeded = () => {\r\n        try {\r\n          const db = request.result;\r\n          if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n            db.createObjectStore(STORE_NAME);\r\n          }\r\n        } catch (err) {\r\n          console.warn('Failed to upgrade suspend safeguard DB', err);\r\n        }\r\n      };\r\n      request.onsuccess = () => {\r\n        resolved = true;\r\n        const db = request.result;\r\n        db.onversionchange = () => {\r\n          try { db.close(); } catch {}\r\n          dbPromise = null;\r\n        };\r\n        resolve(db);\r\n      };\r\n      request.onerror = () => {\r\n        if (!resolved) {\r\n          reject(request.error || new Error('Failed to open suspend safeguard DB'));\r\n        }\r\n      };\r\n      request.onblocked = () => {\r\n        // Nothing special, but ensure promise settles eventually\r\n      };\r\n    } catch (err) {\r\n      reject(err);\r\n    }\r\n  }).catch((err) => {\r\n    dbPromise = null;\r\n    throw err;\r\n  });\r\n\r\n  return dbPromise;\r\n}\r\n\r\nfunction captureSnapshot() {\r\n  if (!canUseLocalStorage()) return null;\r\n  const data = {};\r\n  let captured = false;\r\n  try {\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n      const key = localStorage.key(i);\r\n      if (!key || !key.startsWith(STORAGE_PREFIX)) continue;\r\n      let value = null;\r\n      try {\r\n        value = localStorage.getItem(key);\r\n      } catch {\r\n        value = null;\r\n      }\r\n      if (value == null) continue;\r\n      data[key] = value;\r\n      captured = true;\r\n    }\r\n  } catch (err) {\r\n    console.warn('Failed to read localStorage for snapshot', err);\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    data,\r\n    savedAt: Date.now(),\r\n    hasData: captured,\r\n  };\r\n}\r\n\r\nasync function putSnapshot(snapshot) {\r\n  try {\r\n    const db = await openDatabase();\r\n    await new Promise((resolve, reject) => {\r\n      let settled = false;\r\n      const tx = db.transaction(STORE_NAME, 'readwrite');\r\n      tx.oncomplete = () => { if (!settled) { settled = true; resolve(true); } };\r\n      tx.onabort = () => { if (!settled) { settled = true; reject(tx.error || new Error('Snapshot transaction aborted')); } };\r\n      tx.onerror = () => { if (!settled) { settled = true; reject(tx.error || new Error('Snapshot transaction error')); } };\r\n      const store = tx.objectStore(STORE_NAME);\r\n      const request = store.put(snapshot, SNAPSHOT_KEY);\r\n      request.onerror = () => {\r\n        if (!settled) {\r\n          settled = true;\r\n          reject(request.error || new Error('Snapshot write failed'));\r\n        }\r\n      };\r\n    });\r\n    return true;\r\n  } catch (err) {\r\n    console.warn('Failed to persist suspend snapshot', err);\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function readSnapshot() {\r\n  try {\r\n    const db = await openDatabase();\r\n    return await new Promise((resolve, reject) => {\r\n      let settled = false;\r\n      const tx = db.transaction(STORE_NAME, 'readonly');\r\n      tx.oncomplete = () => { if (!settled) { settled = true; resolve(null); } };\r\n      tx.onabort = () => { if (!settled) { settled = true; reject(tx.error || new Error('Snapshot read aborted')); } };\r\n      tx.onerror = () => { if (!settled) { settled = true; reject(tx.error || new Error('Snapshot read error')); } };\r\n      const store = tx.objectStore(STORE_NAME);\r\n      const request = store.get(SNAPSHOT_KEY);\r\n      request.onsuccess = () => {\r\n        if (settled) return;\r\n        settled = true;\r\n        resolve(request.result || null);\r\n      };\r\n      request.onerror = () => {\r\n        if (!settled) {\r\n          settled = true;\r\n          reject(request.error || new Error('Snapshot get failed'));\r\n        }\r\n      };\r\n    });\r\n  } catch (err) {\r\n    console.warn('Failed to load suspend snapshot', err);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction requestPersistentStorage() {\r\n  try {\r\n    if (navigator?.storage?.persist) {\r\n      navigator.storage.persist().catch(() => {});\r\n    }\r\n  } catch {}\r\n}\r\n\r\nfunction captureStackTrace() {\r\n  try {\r\n    throw new Error('ccc-storage-write');\r\n  } catch (err) {\r\n    return err?.stack || '';\r\n  }\r\n}\r\n\r\nfunction parseSlotFromKey(key) {\r\n  if (!key) return null;\r\n  const match = /:(\\d+)$/.exec(String(key));\r\n  if (!match) return null;\r\n  const slot = parseInt(match[1], 10);\r\n  return Number.isFinite(slot) && slot > 0 ? slot : null;\r\n}\r\n\r\nconst DEVTOOLS_CONSOLE_FRAME_RE = /\\bat <anonymous>:\\d+:\\d+\\b/;\r\n\r\nfunction isTrustedStorageStack(stack) {\r\n  if (typeof stack !== 'string' || stack.length === 0) return false;\r\n  \r\n  if (DEVTOOLS_CONSOLE_FRAME_RE.test(stack)) return false;\r\n\r\n  return true;\r\n}\r\n\r\nfunction notifySaveIntegrityOfStorageMutation(key, stack) {\r\n  if (typeof window === 'undefined') return;\r\n  if (!key) return;\r\n  const strKey = String(key);\r\n  if (!strKey.startsWith(STORAGE_PREFIX)) return;\r\n  if (strKey.startsWith(SLOT_SIGNATURE_PREFIX) || strKey.startsWith(SLOT_MOD_FLAG_PREFIX)) return;\r\n  const slot = parseSlotFromKey(strKey);\r\n  if (slot == null) return;\r\n  try {\r\n    const detail = {\r\n      key: strKey,\r\n      slot,\r\n      trusted: isTrustedStorageStack(stack),\r\n    };\r\n    window.dispatchEvent(new CustomEvent('saveIntegrity:storageMutation', { detail }));\r\n  } catch {}\r\n}\r\n\r\nfunction installStorageHooks() {\r\n  if (typeof localStorage === 'undefined') return;\r\n  try {\r\n    const proto = Object.getPrototypeOf(localStorage);\r\n    if (!proto || proto.__cccStoragePatched) return;\r\n\r\n    const originalSet = proto.setItem;\r\n    const originalRemove = proto.removeItem;\r\n    const originalClear = proto.clear;\r\n\r\nif (typeof originalSet === 'function') {\r\n  proto.setItem = function patchedSetItem(key, value) {\r\n    const stack = captureStackTrace();\r\n    const strKey = String(key);\r\n\r\n\tconst isTrackedGameKey =\r\n      this === localStorage &&\r\n      strKey.startsWith(STORAGE_PREFIX);\r\n\r\n\r\n    // Before we write, verify nothing in this slot changed behind our back.\r\n    if (isTrackedGameKey) {\r\n      try {\r\n        beforeSlotWrite(strKey);\r\n      } catch {}\r\n    }\r\n\r\n    let result;\r\n    try {\r\n      result = originalSet.apply(this, arguments);\r\n    } finally {\r\n      try {\r\n        if (isTrackedGameKey) {\r\n          markProgressDirty('setItem');\r\n          // Keep the in-memory expected state in sync with what we just wrote.\r\n          try {\r\n            afterSlotWrite(strKey, value);\r\n          } catch {}\r\n        }\r\n\r\n        // We still want integrity events for game keys, but we've already\r\n        // excluded slotSig/slotMod inside notifySaveIntegrityOfStorageMutation.\r\n        if (this === localStorage && strKey.startsWith(STORAGE_PREFIX)) {\r\n          notifySaveIntegrityOfStorageMutation(strKey, stack);\r\n        }\r\n      } catch {}\r\n    }\r\n    return result;\r\n  };\r\n}\r\n\r\n    if (typeof originalRemove === 'function') {\r\n      proto.removeItem = function patchedRemoveItem(key) {\r\n        const stack = captureStackTrace();\r\n        let result;\r\n        try {\r\n          result = originalRemove.apply(this, arguments);\r\n        } finally {\r\n          try {\r\n            if (this === localStorage && String(key).startsWith(STORAGE_PREFIX)) {\r\n              markProgressDirty('removeItem');\r\n              notifySaveIntegrityOfStorageMutation(key, stack);\r\n            }\r\n          } catch {}\r\n        }\r\n        return result;\r\n      };\r\n    }\r\n\r\n    if (typeof originalClear === 'function') {\r\n      proto.clear = function patchedClear() {\r\n        const stack = captureStackTrace();\r\n        let result;\r\n        try {\r\n          result = originalClear.apply(this, arguments);\r\n        } finally {\r\n          try {\r\n            if (this === localStorage) {\r\n              markProgressDirty('clear');\r\n              notifySaveIntegrityOfStorageMutation(null, stack);\r\n            }\r\n          } catch {}\r\n        }\r\n        return result;\r\n      };\r\n    }\r\n\r\n    Object.defineProperty(proto, '__cccStoragePatched', {\r\n      value: true,\r\n      enumerable: false,\r\n      configurable: false,\r\n      writable: false,\r\n    });\r\n  } catch (err) {\r\n    console.warn('Failed to patch Storage prototype for suspend safeguards', err);\r\n  }\r\n}\r\n\r\nfunction scheduleFlush(reason = 'idle') {\r\n  lastDirtyReason = reason || lastDirtyReason;\r\n  dirty = true;\r\n  if (flushTimer) return;\r\n  flushTimer = setTimeout(() => {\r\n    flushTimer = null;\r\n    if (!dirty) return;\r\n    const reasonToUse = lastDirtyReason;\r\n    dirty = false;\r\n    void flushBackupSnapshot(reasonToUse);\r\n  }, FLUSH_DEBOUNCE_MS);\r\n}\r\n\r\nfunction cancelFlushTimer() {\r\n  if (!flushTimer) return;\r\n  clearTimeout(flushTimer);\r\n  flushTimer = null;\r\n}\r\n\r\nexport function markProgressDirty(reason = 'dirty') {\r\n  try {\r\n    scheduleFlush(reason);\r\n  } catch {}\r\n}\r\n\r\nasync function performFlush(reason = 'manual') {\r\n  if (!canUseLocalStorage() || !canUseIndexedDb()) return false;\r\n  const snapshot = captureSnapshot();\r\n  if (!snapshot) return false;\r\n  snapshot.reason = reason;\r\n  pendingImmediateFlush = false;\r\n  const ok = await putSnapshot(snapshot);\r\n  if (!ok) {\r\n    // Keep dirty flag so another attempt can happen later\r\n    dirty = true;\r\n    scheduleFlush('retry');\r\n  }\r\n  return ok;\r\n}\r\n\r\nexport async function flushBackupSnapshot(reason = 'manual', { immediate = false } = {}) {\r\n  if (!canUseLocalStorage() || !canUseIndexedDb()) return false;\r\n  if (immediate) {\r\n    cancelFlushTimer();\r\n    dirty = false;\r\n    pendingImmediateFlush = true;\r\n    return performFlush(reason);\r\n  }\r\n  dirty = true;\r\n  lastDirtyReason = reason || lastDirtyReason;\r\n  return performFlush(reason);\r\n}\r\n\r\nfunction flushBeforeSuspend(reason) {\r\n  if (!canUseIndexedDb() || !canUseLocalStorage()) return;\r\n  cancelFlushTimer();\r\n  dirty = false;\r\n  pendingImmediateFlush = true;\r\n  void performFlush(reason);\r\n}\r\n\r\nfunction hasAnyPrefixedKeys() {\r\n  if (!canUseLocalStorage()) return false;\r\n  try {\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n      const key = localStorage.key(i);\r\n      if (key && key.startsWith(STORAGE_PREFIX)) return true;\r\n    }\r\n  } catch {}\r\n  return false;\r\n}\r\n\r\nexport async function restoreFromBackupIfNeeded() {\r\n  if (restoreAttempted) return false;\r\n  restoreAttempted = true;\r\n  if (!canUseLocalStorage() || !canUseIndexedDb()) return false;\r\n\r\n  let shouldRestore = false;\r\n  try {\r\n    if (!hasAnyPrefixedKeys()) {\r\n      shouldRestore = true;\r\n    } else {\r\n      const activeSlot = localStorage.getItem(`${STORAGE_PREFIX}saveSlot`);\r\n      if (activeSlot) {\r\n        const coinKey = `${STORAGE_PREFIX}coins:${activeSlot}`;\r\n        if (localStorage.getItem(coinKey) == null) {\r\n          shouldRestore = true;\r\n        }\r\n      }\r\n    }\r\n  } catch {\r\n    shouldRestore = false;\r\n  }\r\n\r\n  if (!shouldRestore) return false;\r\n\r\n  const snapshot = await readSnapshot();\r\n  if (!snapshot?.data) return false;\r\n\r\n  let restored = false;\r\n  try {\r\n    for (const [key, value] of Object.entries(snapshot.data)) {\r\n      if (value == null) continue;\r\n      if (localStorage.getItem(key) === null) {\r\n        localStorage.setItem(key, value);\r\n        restored = true;\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.warn('Failed to restore snapshot into localStorage', err);\r\n  }\r\n\r\n  if (restored) {\r\n    markProgressDirty('restored');\r\n  }\r\n\r\n  return restored;\r\n}\r\n\r\nexport function installSuspendSafeguards() {\r\n  if (installAttempted) return;\r\n  installAttempted = true;\r\n  if (typeof window === 'undefined') return;\r\n\r\n  requestPersistentStorage();\r\n  installStorageHooks();\r\n\r\n  const onVisibilityChange = () => {\r\n    if (document.hidden) {\r\n      flushBeforeSuspend('visibility-hidden');\r\n    } else {\r\n      markProgressDirty('visibility-visible');\r\n    }\r\n  };\r\n\r\n  try { document.addEventListener('visibilitychange', onVisibilityChange, { passive: true }); } catch {}\r\n  try { window.addEventListener('pagehide', () => flushBeforeSuspend('pagehide'), { capture: true }); } catch {}\r\n  try { window.addEventListener('beforeunload', () => flushBeforeSuspend('beforeunload')); } catch {}\r\n  try { document.addEventListener('freeze', () => flushBeforeSuspend('freeze')); } catch {}\r\n  try { window.addEventListener('pageshow', () => markProgressDirty('pageshow')); } catch {}\r\n  try { window.addEventListener('focus', () => markProgressDirty('focus')); } catch {}\r\n  try { window.addEventListener('storage', (event) => {\r\n    if (!event) return;\r\n    if (event.storageArea !== localStorage) return;\r\n    if (event.key && !String(event.key).startsWith(STORAGE_PREFIX)) return;\r\n    markProgressDirty('storage-event');\r\n  }); } catch {}\r\n\r\n  markProgressDirty('boot');\r\n}\r\n\r\nexport function getSuspendMetadata() {\r\n  return {\r\n    pendingImmediateFlush,\r\n    dirty,\r\n    lastDirtyReason,\r\n  };\r\n}", "// js/main.js\r\n\r\nexport const DEBUG_PANEL_ACCESS = true; // I will change this to false for prod so the message below makes sense\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Debug Panel Access\r\n// To enable the in-game debug panel, open your browser console and run:\r\n//\r\n//     setDebugPanelAccess(true)\r\n//\r\n// This will allow you to view and modify game values for testing.\r\n//\r\n// \u26A0\uFE0F Note:\r\n// ANY modification of stats, currencies, upgrade levels, or other\r\n// save data through the debug panel will permanently flag your save slot\r\n// as modified. If a slot is marked as modified, its shop button will permanently\r\n// turn from a fresh green to a poopy brown, which I like to call the poop-shop of shame.\r\n//\r\n// Normal gameplay is unaffected unless you choose to modify values.\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nexport const IS_MOBILE = (() => {\r\n  if (typeof window === 'undefined') return false;\r\n\r\n  if (typeof window.IS_MOBILE !== 'undefined') {\r\n    return !!window.IS_MOBILE;\r\n  }\r\n\r\n  const detected = (window.matchMedia?.('(any-pointer: coarse)')?.matches) || ('ontouchstart' in window);\r\n  window.IS_MOBILE = detected;\r\n  return detected;\r\n})();\r\n\r\nlet initSlots;\r\nlet createSpawner;\r\nlet initCoinPickup;\r\nlet initHudButtons;\r\nlet installGhostTapGuard;\r\nlet bank;\r\nlet getHasOpenedSaveSlot;\r\nlet setHasOpenedSaveSlot;\r\nlet ensureStorageDefaults;\r\nlet getUpgAreaKey;\r\nlet computeUpgradeEffects;\r\nlet initXpSystem;\r\nlet onUpgradesChanged;\r\nlet registerPreloadedAudio;\r\nlet initPopups;\r\nlet installSuspendSafeguards;\r\nlet restoreSuspendBackup;\r\nlet markProgressDirty;\r\nlet flushBackupSnapshot;\r\nlet initResetSystemGame;\r\nlet initMutationSystem;\r\nlet getMutationCoinSprite;\r\nlet onMutationChangeGame;\r\nlet setDebugPanelAccess;\r\n\r\nconst pendingPreloadedAudio = [];\r\n\r\nfunction disableMobileZoomGestures() {\r\n  if (!IS_MOBILE) return;\r\n\r\n  let lastTouchEnd = 0;\r\n  const TOUCH_DELAY_MS = 350;\r\n\r\n  document.addEventListener('touchend', (event) => {\r\n    const now = performance.now();\r\n    if (now - lastTouchEnd <= TOUCH_DELAY_MS) {\r\n      event.preventDefault();\r\n    }\r\n    lastTouchEnd = now;\r\n  }, { passive: false });\r\n\r\n  document.addEventListener('gesturestart', (event) => {\r\n    event.preventDefault();\r\n  }, { passive: false });\r\n\r\n  document.addEventListener('dblclick', (event) => {\r\n    event.preventDefault();\r\n  }, { passive: false });\r\n}\r\n\r\ndisableMobileZoomGestures();\r\n\r\nexport const AREAS = {\r\n  MENU: 0,\r\n  STARTER_COVE: 1,\r\n};\r\n\r\nlet currentArea = AREAS.MENU;\r\nlet spawner = null;\r\n\r\n/* ---------------------------\r\n   LOADER UI (immediate black + progress)\r\n----------------------------*/\r\nconst nextFrame = () => new Promise(r => requestAnimationFrame(r));\r\nconst twoFrames = async () => { await nextFrame(); await nextFrame(); };\r\nfunction showLoader(text = 'Loading assets...') {\r\n  let root = document.getElementById('boot-loader');\r\n  if (!root) {\r\n    root = document.createElement('div');\r\n    root.id = 'boot-loader';\r\n    root.className = 'loading-screen';\r\n    document.body.appendChild(root);\r\n  }\r\n\r\n  root.innerHTML = '';\r\n  Object.assign(root.style, {\r\n    position: 'fixed',\r\n    inset: '0',\r\n    background: '#000',\r\n    color: '#fff',\r\n    display: 'grid',\r\n    placeItems: 'center',\r\n    zIndex: '2147483647',\r\n    opacity: '1', \r\n    transition: 'opacity 0.4s ease',\r\n  });\r\n\r\n  const wrap = document.createElement('div');\r\n  wrap.style.textAlign = 'center';\r\n  wrap.style.fontFamily = 'system-ui, -apple-system, Segoe UI, Roboto, sans-serif';\r\n\r\n  const label = document.createElement('div');\r\n  label.textContent = text;\r\n  Object.assign(label.style, {\r\n    fontSize: 'clamp(16px, 2.4vw, 22px)',\r\n    letterSpacing: '.04em',\r\n    opacity: '.92',\r\n  });\r\n\r\n  const bar = document.createElement('div');\r\n  Object.assign(bar.style, {\r\n    width: 'min(420px, 70vw)',\r\n    height: '10px',\r\n    background: 'rgba(255,255,255,.15)',\r\n    borderRadius: '999px',\r\n    margin: '12px auto 6px',\r\n    overflow: 'hidden',\r\n  });\r\n\r\n  const fill = document.createElement('div');\r\n  Object.assign(fill.style, {\r\n    width: '0%',\r\n    height: '100%',\r\n    background: '#fff',\r\n    transform: 'translateZ(0)',\r\n    transition: 'width .15s linear',\r\n  });\r\n\r\n  const pct = document.createElement('div');\r\n  pct.textContent = '0%';\r\n  Object.assign(pct.style, { fontSize: '12px', opacity: '.85' });\r\n\r\n  bar.appendChild(fill);\r\n  wrap.append(label, bar, pct);\r\n  root.appendChild(wrap);\r\n\r\n  const stuckMsg = document.createElement('div');\r\n  stuckMsg.textContent = 'If progress bar is stuck, try reloading the page.';\r\n  Object.assign(stuckMsg.style, {\r\n    marginTop: '16px',\r\n    fontSize: '14px',\r\n    opacity: '0',\r\n    transition: 'opacity 0.5s ease',\r\n    color: 'rgba(255,255,255,0.65)',\r\n  });\r\n  wrap.appendChild(stuckMsg);\r\n\r\n  const stuckTimeout = setTimeout(() => {\r\n    if (!root.__done) stuckMsg.style.opacity = '1';\r\n  }, 25000);\r\n\r\n  root.__mountedAt = performance.now();\r\n  root.__done = false;\r\n  root.__wrap = wrap;\r\n  root.__bar = bar;\r\n  root.__fill = fill;\r\n  root.__pct = pct;\r\n  root.__label = label;\r\n  root.__stuckMsg = stuckMsg;\r\n  root.__stuckTimeout = stuckTimeout;\r\n  return root;\r\n}\r\n\r\nfunction setLoaderProgress(loaderEl, fraction) {\r\n  if (!loaderEl || !loaderEl.__fill || !loaderEl.__pct) return;\r\n  const f = Math.max(0, Math.min(1, fraction || 0));\r\n  const pct = Math.round(f * 100);\r\n  loaderEl.__fill.style.width = pct + '%';\r\n  loaderEl.__pct.textContent = pct + '%';\r\n}\r\n\r\nfunction finishAndHideLoader(loaderEl) {\r\n  if (!loaderEl || loaderEl.__done) return;\r\n  loaderEl.__done = true;\r\n\r\n  const MIN_FINISHED_DWELL_MS = 500;\r\n  if (loaderEl.__label) loaderEl.__label.textContent = 'Finished loading assets';\r\n  loaderEl.offsetHeight;\r\n\r\n  setTimeout(() => {\r\n    loaderEl.style.opacity = '0';\r\n    const onEnd = () => {\r\n      loaderEl.remove();\r\n      document.documentElement.classList.remove('booting');\r\n    };\r\n    loaderEl.addEventListener('transitionend', onEnd, { once: true });\r\n    setTimeout(onEnd, 450);\r\n  }, MIN_FINISHED_DWELL_MS);\r\n}\r\n\r\n/* ---------------------------\r\n   PRELOADERS\r\n----------------------------*/\r\nasync function warmImage(url) {\r\n  const img = new Image();\r\n  img.src = url;\r\n\r\n  try {\r\n    if (img.decode) await img.decode();\r\n  } catch (_) {\r\n  }\r\n\r\n  await new Promise((resolve) => {\r\n    const ghost = document.createElement('img');\r\n    ghost.src = url;\r\n    ghost.alt = '';\r\n    ghost.style.cssText =\r\n      'position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';\r\n    document.body.appendChild(ghost);\r\n    requestAnimationFrame(() => { ghost.remove(); resolve(); });\r\n  });\r\n}\r\n\r\nfunction preloadImages(sources, onEach) {\r\n  return sources.map(src => new Promise(resolve => {\r\n    const img = new Image();\r\n    const done = () => { try { onEach?.(src); } catch {} resolve(src); };\r\n    img.onload = done;\r\n    img.onerror = done;\r\n    img.src = src;\r\n  }));\r\n}\r\n\r\nfunction preloadAudio(sources, onEach) {\r\n  return sources.map(url => new Promise(resolve => {\r\n    const a = new Audio();\r\n    const done = () => { try { onEach?.(url); } catch {} resolve(url); };\r\n    a.addEventListener('canplaythrough', () => {\r\n      if (typeof registerPreloadedAudio === 'function') {\r\n        registerPreloadedAudio(url, a);\r\n      } else {\r\n        pendingPreloadedAudio.push({ url, audio: a });\r\n      }\r\n      done();\r\n    }, { once: true });\r\n    a.addEventListener('error', done, { once: true });\r\n    a.preload = 'auto';\r\n    a.src = url;\r\n    a.load?.();\r\n  }));\r\n}\r\n\r\nfunction preloadFonts(onEach) {\r\n  if (document.fonts && document.fonts.ready) {\r\n    return [document.fonts.ready.then(() => { try { onEach?.('fonts'); } catch {} })];\r\n  }\r\n  return [Promise.resolve().then(() => { try { onEach?.('fonts'); } catch {} })];\r\n}\r\n\r\nasync function preloadAssetsWithProgress({ images = [], audio = [], fonts = true }, onProgress) {\r\n  const total = images.length + audio.length + (fonts ? 1 : 0);\r\n  if (total === 0) { onProgress?.(1); return; }\r\n  let done = 0;\r\n  const bump = () => { done++; onProgress?.(done / total); };\r\n\r\n  const tasks = [\r\n    ...preloadImages(images, bump),\r\n    ...preloadAudio(audio, bump),\r\n    ...(fonts ? preloadFonts(bump) : []),\r\n  ];\r\n\r\n  await Promise.all(tasks.map(p => p.catch(() => null)));\r\n}\r\n\r\n/* ---------------------------\r\n   GAME AREA CONTROL\r\n----------------------------*/\r\nfunction enterArea(areaID) {\r\n  if (currentArea === areaID) return;\r\n  currentArea = areaID;\r\n\r\n  const menuRoot = document.querySelector('.menu-root');\r\n  switch (areaID) {\r\n    case AREAS.STARTER_COVE: {\r\n      if (menuRoot) {\r\n        menuRoot.style.display = 'none';\r\n      }\r\n      document.body.classList.remove('menu-bg');\r\n      const gameRoot = document.getElementById('game-root');\r\n      if (gameRoot) {\r\n        gameRoot.hidden = false;\r\n        initHudButtons();\r\n      }\r\n\r\n      if (typeof initResetSystemGame === 'function') {\r\n        try { initResetSystemGame(); } catch {}\r\n      }\r\n\r\n      if (typeof initMutationSystem === 'function') {\r\n        try { initMutationSystem(); } catch {}\r\n      }\r\n\r\n      if (!spawner) {\r\n        spawner = createSpawner({\r\n          coinSrc: 'img/currencies/coin/coin.png',\r\n          coinSize: 40,\r\n          initialRate: 1,\r\n          surgeLifetimeMs: 1800,\r\n          surgeWidthVw: 22,\r\n        });\r\n        window.spawner = spawner;\r\n        const applyMutationSprite = () => {\r\n          if (!spawner || typeof spawner.setCoinSprite !== 'function') return;\r\n          try { spawner.setCoinSprite(getMutationCoinSprite?.()); } catch {}\r\n        };\r\n        applyMutationSprite();\r\n        onMutationChangeGame?.(applyMutationSprite);\r\n        initCoinPickup();\r\n                const applyUpgradesToSpawner = () => {\r\n                try {\r\n                        const areaKey = getUpgAreaKey();\r\n                        const eff = computeUpgradeEffects(areaKey);\r\n                        if (spawner && eff?.coinsPerSecondMult) {\r\n                          spawner.setRate(1 * eff.coinsPerSecondMult);\r\n                        }\r\n                  } catch {}\r\n                };\r\n                applyUpgradesToSpawner();\r\n                onUpgradesChanged(applyUpgradesToSpawner);\r\n\r\n      }\r\n      if (typeof initXpSystem === 'function') {\r\n        try { initXpSystem(); } catch {}\r\n      }\r\n      spawner.start();\r\n      if (spawner && typeof spawner.playEntranceWave === 'function') {\r\n        spawner.playEntranceWave();\r\n      }\r\n      break;\r\n    }\r\n\r\n    case AREAS.MENU: {\r\n      if (menuRoot) {\r\n        menuRoot.style.display = '';\r\n        menuRoot.removeAttribute('aria-hidden');\r\n      }\r\n      const gameRoot = document.getElementById('game-root');\r\n      if (gameRoot) gameRoot.hidden = true;\r\n\r\n      if (spawner) spawner.stop();\r\n      break;\r\n    }\r\n  }\r\n\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('menu:visibilitychange', {\r\n      detail: { visible: areaID === AREAS.MENU },\r\n    }));\r\n  } catch {}\r\n}\r\n\r\n/* ---------------------------\r\n   BOOT FLOW\r\n----------------------------*/\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n  const loader = showLoader('Loading assets...');\r\n\r\n  if (window.__MAINTENANCE__) {\r\n    const message = window.__MAINTENANCE_MESSAGE || 'Update in progress. Please wait a few minutes.';\r\n    if (loader?.__label) {\r\n      loader.__label.textContent = message;\r\n    }\r\n    if (loader?.__stuckTimeout) {\r\n      clearTimeout(loader.__stuckTimeout);\r\n      loader.__stuckTimeout = null;\r\n    }\r\n    if (loader?.__pct) {\r\n      loader.__pct.remove();\r\n      loader.__pct = null;\r\n    }\r\n    if (loader?.__bar) {\r\n      loader.__bar.remove();\r\n      loader.__bar = null;\r\n    }\r\n    if (loader?.__fill) {\r\n      loader.__fill = null;\r\n    }\r\n    if (loader?.__stuckMsg) {\r\n      loader.__stuckMsg.remove();\r\n      loader.__stuckMsg = null;\r\n    }\r\n    if (loader?.__wrap) {\r\n      loader.__wrap.style.display = 'grid';\r\n      loader.__wrap.style.gap = '18px';\r\n    }\r\n    document.documentElement.classList.remove('booting');\r\n    return;\r\n  }\r\n\r\n  await nextFrame();\r\n\r\n  const modulePromise = Promise.all([\r\n    import('./util/slots.js'),\r\n    import('./game/spawner.js'),\r\n    import('./game/coinPickup.js'),\r\n    import('./ui/hudButtons.js'),\r\n    import('./util/storage.js'),\r\n    import('./util/saveIntegrity.js'),\r\n    import('./game/upgrades.js'),\r\n    import('./util/audioCache.js'),\r\n    import('./game/xpSystem.js'),\r\n    import('./ui/merchantDelve/resetTab.js'),\r\n    import('./game/mutationSystem.js'),\r\n    import('./ui/popups.js'),\r\n    import('./util/suspendSafeguard.js'),\r\n    import('./util/ghostTapGuard.js'),\r\n    import('./util/debugPanel.js'),\r\n  ]);\r\n\r\n  const ASSET_MANIFEST = {\r\n    images: [\r\n      'img/currencies/coin/coin.png',\r\n      'img/currencies/coin/coin_base.png',\r\n      'img/currencies/coin/coin_plus_base.png',\r\n      'img/currencies/book/book.png',\r\n      'img/currencies/book/book_base.png',\r\n      'img/currencies/book/book_plus_base.png',\r\n\t  'img/currencies/gold/gold.png',\r\n      'img/currencies/gold/gold_base.png',\r\n      'img/currencies/gold/gold_plus_base.png',\r\n      'img/sc_upg_icons/faster_coins.png',\r\n      'img/sc_upg_icons/book_val1.png',\r\n      'img/sc_upg_icons/coin_val1.png',\r\n      'img/sc_upg_icons/xp_val1.png',\r\n\t  'img/sc_upg_icons/faster_coins2.png',\r\n      'img/sc_upg_icons/coin_val2.png',\r\n      'img/sc_upg_icons/xp_val2.png',\r\n\t  'img/sc_upg_icons/mp_val1.png',\r\n\t  'img/sc_upg_icons/magnet.png',\r\n\t  'img/sc_upg_icons/xp_val_hm.png',\r\n      'img/stats/xp/xp.png',\r\n      'img/stats/xp/xp_base.png',\r\n      'img/stats/xp/xp_plus_base.png',\r\n\t  'img/stats/mp/mp.png',\r\n      'img/stats/mp/mp_base.png',\r\n      'img/stats/mp/mp_plus_base.png',\r\n\t  'img/misc/forge.png',\r\n      'img/misc/locked.png',\r\n      'img/misc/locked_base.png',\r\n      'img/misc/maxed.png',\r\n\t  'img/misc/merchant.png',\r\n      'img/misc/mysterious.png',\r\n      ...Array.from({ length: 25 }, (_, i) => `img/mutations/m${i + 1}.png`),\r\n    ],\r\n    audio: [\r\n      'sounds/coin_pickup.mp3',\r\n      'sounds/wave_spawn.mp3',\r\n      'sounds/merchant_typing.mp3',\r\n      'sounds/purchase_upg.mp3',\r\n\t  'sounds/forge_reset.mp3',\r\n\t  'sounds/evolve_upg.mp3',\r\n    ],\r\n    fonts: true,\r\n  };\r\n\r\n  let progress = 0;\r\n  const assetsPromise = preloadAssetsWithProgress(ASSET_MANIFEST, f => {\r\n    progress = f;\r\n    setLoaderProgress(loader, f);\r\n  });\r\n\r\n  const [\r\n    slotsModule,\r\n    spawnerModule,\r\n    coinPickupModule,\r\n    hudButtonsModule,\r\n    storageModule,\r\n    saveIntegrityModule,\r\n    upgradesModule,\r\n    audioCacheModule,\r\n    xpModule,\r\n    resetModule,\r\n    mutationModule,\r\n    popupModule,\r\n    safetyModule,\r\n    guardModule,\r\n    debugPanelModule,\r\n  ] = await modulePromise;\r\n\r\n  ({ initSlots } = slotsModule);\r\n  ({ createSpawner } = spawnerModule);\r\n  ({ initCoinPickup } = coinPickupModule);\r\n  ({ initHudButtons } = hudButtonsModule);\r\n  ({ bank, getHasOpenedSaveSlot, setHasOpenedSaveSlot, ensureStorageDefaults } = storageModule);\r\n  void saveIntegrityModule;\r\n  ({ getCurrentAreaKey: getUpgAreaKey, computeUpgradeEffects, onUpgradesChanged } = upgradesModule);\r\n  ({ registerPreloadedAudio } = audioCacheModule);\r\n  ({ initXpSystem } = xpModule);\r\n  ({ initResetSystem: initResetSystemGame } = resetModule);\r\n  ({ initMutationSystem, getMutationCoinSprite, onMutationChange: onMutationChangeGame } = mutationModule);\r\n  ({ initPopups } = popupModule);\r\n  ({ installSuspendSafeguards, restoreFromBackupIfNeeded: restoreSuspendBackup, markProgressDirty, flushBackupSnapshot } = safetyModule);\r\n  ({ installGhostTapGuard } = guardModule);\r\n  ({ setDebugPanelAccess } = debugPanelModule);\r\n\r\n  window.bank = bank;\r\n\r\n  if (typeof registerPreloadedAudio === 'function' && pendingPreloadedAudio.length) {\r\n    while (pendingPreloadedAudio.length) {\r\n      const entry = pendingPreloadedAudio.shift();\r\n      if (!entry) continue;\r\n      try { registerPreloadedAudio(entry.url, entry.audio); }\r\n      catch {}\r\n    }\r\n  }\r\n\r\n  installGhostTapGuard?.();\r\n  installSuspendSafeguards?.();\r\n  if (typeof setDebugPanelAccess === 'function') {\r\n    setDebugPanelAccess(DEBUG_PANEL_ACCESS);\r\n    window.setDebugPanelAccess = setDebugPanelAccess;\r\n  }\r\n\r\n  try {\r\n    await restoreSuspendBackup?.();\r\n  } catch {}\r\n\r\n  await assetsPromise;\r\n\r\n  await twoFrames();\r\n  document.documentElement.classList.remove('booting');\r\n\r\n  await nextFrame();\r\n\r\n  finishAndHideLoader(loader);\r\n\r\n  await Promise.all([ // fixes some image preload issue on mobile\r\n    warmImage('img/currencies/coin/coin_plus_base.png'),\r\n    warmImage('img/stats/xp/xp_plus_base.png'),\r\n\twarmImage('img/stats/mp/mp_plus_base.png'),\r\n  ]);\r\n\r\n  ensureStorageDefaults();\r\n  markProgressDirty?.('ensure-defaults');\r\n  initPopups();\r\n\r\n  const titleEl = document.getElementById('panel-title');\r\n  if (getHasOpenedSaveSlot()) {\r\n    document.body.classList.add('has-opened');\r\n    if (titleEl) titleEl.style.opacity = '0';\r\n  } else {\r\n    if (titleEl) titleEl.style.opacity = '1';\r\n  }\r\n\r\n  initSlots(() => {\r\n    setHasOpenedSaveSlot(true);\r\n    document.body.classList.add('has-opened');\r\n    if (titleEl) titleEl.style.opacity = '0';\r\n    enterArea(AREAS.STARTER_COVE);\r\n    markProgressDirty?.('slot-entered');\r\n  });\r\n\r\n  if (typeof window !== 'undefined' && flushBackupSnapshot) {\r\n    try {\r\n      window.cccRequestBackup = () => flushBackupSnapshot('manual', { immediate: true });\r\n    } catch {}\r\n  }\r\n});"],
  "mappings": "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QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,IAAI;AAAA,QAC3H,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,IAAI;AAAA,QAC3H,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,IAAI;AAAA,QAC3H,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,IAAI;AAAA,QAC3H,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,MAAM;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,KAAK;AAAA,QAAE,CAAC,KAAI,IAAI;A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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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",
  "names": ["E", "E", "totalDigits", "head", "nextDigit", "sign2Prefix", "onClickCapture", "parseBigNumOrZero", "container", "detail", "bnZero", "bigNumFromLog10", "bnOne", "upgrades", "initialized", "bigNumFromLog10", "slotKey", "upgrades", "xp31", "levelBigNumToNumber", "value", "ratioMinus1", "pow", "nextPrice", "limit", "spent", "count", "countBn", "firstPrice", "spentLog", "capRoom", "nextCost", "BN", "MERCHANT_MET_KEY_BASE", "onTouchStart", "onTouchEnd", "onDragMove", "onDragMove", "room", "count", "hasPointerEvents", "onUpgradesChanged", "drag", "onDragStart", "onDragEnd", "boughtBn", "onCurrencyChange", "sk", "hasPointerEvents", "onTouchStart", "container", "bigNumEquals", "bigNumToFiniteNumber", "precision", "isUnlocked", "upgrades", "xpState", "mutationState", "zero", "statKey", "BN", "bnZero", "levelToNumber", "baseLevel", "totalLog10", "bigNumFromLog10", "progressRatio", "ensureHudRefs", "hudRefs", "formatBn", "updateHud", "container", "listeners", "persistState", "KEY_UNLOCK", "KEY_PROGRESS", "bnOne", "cleanupWatchers", "bindStorageWatchers", "watchersBoundSlot", "initialized", "KEY_PREFIX", "_", "a", "updateMutationSnapshot", "mutationUnlockedSnapshot", "mutationUnsub", "updateHud", "scheduleFlush", "onCurrencyChange", "nowMs", "initialized", "STORAGE_PREFIX", "parseSlotFromKey", "SLOT_SIGNATURE_PREFIX", "registerPreloadedAudio", "initHudButtons", "initMutationSystem", "createSpawner", "getMutationCoinSprite", "initCoinPickup", "computeUpgradeEffects", "onUpgradesChanged", "initXpSystem", "initSlots", "installGhostTapGuard", "bank", "getHasOpenedSaveSlot", "setHasOpenedSaveSlot", "ensureStorageDefaults", "initPopups", "installSuspendSafeguards", "markProgressDirty", "flushBackupSnapshot", "setDebugPanelAccess"]
}
