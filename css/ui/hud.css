/* css/ui/hud.css */

/* Bottom HUD */
.hud-bottom {
position: absolute;
left: 0;
right: 0;
bottom: 0;
z-index: 999;
display: grid;
gap: 10px;
padding: 10px;
padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
grid-template-columns: repeat(4, 1fr);
grid-auto-rows: clamp(64px, 10svh, 110px);
align-items: end;
align-content: end;
background: none;
}

/* Base button appearance: rectangular w/ black outline, slight rounding */
.game-btn {
  -webkit-tap-highlight-color: transparent;
  appearance: none;
  border: 4px solid #000;
  border-radius: 8px;
  padding: 0;
  margin: 0;
  width: 100%;
  height: 100%;
  display: grid;
  place-items: center;
  cursor: pointer;
  touch-action: manipulation;
  outline: none;
  font-weight: 900;
  font-size: clamp(18px, 3.5vw, 32px);
  color: #fff;
  transition: transform 120ms ease, filter 120ms ease;
  user-select: none;
}

.game-btn:active {
transform: translateY(1px) scale(0.997);
}

/* Hide via attribute */
.game-btn[hidden] { display: none !important; }

/* Theme colors (vertical-ish gradient per button) */
.btn-help  { background: linear-gradient(180deg,#f7d64b,#e8b800); }  /* yellow */
.btn-shop  { background: linear-gradient(180deg,#62b447,#2a8a2b); }  /* green  */
.btn-stats { background: linear-gradient(180deg,#e04a3f,#b92b20); }  /* red    */
.btn-map   { background: linear-gradient(180deg,#39e6df,#00aabb); }  /* cyan   */

/* Desktop: crisp 1px stroke for text (where supported), plus light shadow */
.game-btn {
-webkit-text-stroke: 1px #000; /* desktop outline */
text-stroke: 1px #000;
text-shadow: 0 1px 0 rgba(0,0,0,0.35); /* small helper shadow for browsers without stroke */
}

/* Touch devices: smoother fake stroke for the coin counter only */
@media (pointer: coarse) {
   .coin-amount, .game-btn {
    -webkit-text-stroke: 0 !important;
    text-stroke: 0 !important;
    -webkit-text-fill-color: #fff;
    text-shadow:
      0 0.5px 0 #000, 0 -0.5px 0 #000,
      0.5px 0 0 #000, -0.5px 0 0 #000,
      0.5px 0.5px 0 #000, 0.5px -0.5px 0 #000,
      -0.5px 0.5px 0 #000, -0.5px -0.5px 0 #000,
      0 1px 0 rgba(0,0,0,0.28);
  }
}



/* Portrait / phone: 2x2 layout, keep gaps, adjust sizes */
@media (hover: none) and (pointer: coarse) and (max-aspect-ratio: 1/1) {
.hud-bottom {
grid-template-columns: repeat(2, 1fr);
grid-auto-rows: minmax(72px, 1fr);
gap: 8px;
padding: 8px;
padding-bottom: calc(env(safe-area-inset-bottom) + 8px);
height: min(40svh, 360px);
}
.game-btn {
font-size: clamp(16px, 6.4vw, 30px);
}
}

/* Corner rounding: keep outermost corners rounded, inner seams remain sharp */
.hud-bottom > .game-btn:first-child  { border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
.hud-bottom > .game-btn:last-child   { border-top-right-radius: 10px; border-bottom-right-radius: 10px; }

@media (max-aspect-ratio: 1/1) {
/* 2x2 layout corners */
.hud-bottom > .game-btn:nth-child(1) { border-top-left-radius: 10px; }
.hud-bottom > .game-btn:nth-child(2) { border-top-right-radius: 10px; }
.hud-bottom > .game-btn:nth-child(3) { border-bottom-left-radius: 10px; }
.hud-bottom > .game-btn:nth-child(4) { border-bottom-right-radius: 10px; }
}

/* Portrait fine-tuning */
@media (pointer: coarse) and (max-aspect-ratio: 1/1) {
.hud-bottom {
height: min(20svh, 160px);
grid-auto-rows: minmax(48px, 1fr);
gap: 6px;
padding: 6px;
padding-bottom: calc(env(safe-area-inset-bottom) + 6px);
}

.game-btn {
font-size: clamp(15px, 4.8vw, 24px);
line-height: 1.1;
}
}

.hud-bottom { container-type: inline-size; }
.hud-bottom .game-btn { white-space: nowrap; }
.hud-bottom .game-btn[data-btn="stats"] {
  font-size: clamp(18px, 2.5cqw, 32px);
}

/* ===== Layout helpers driven by JS ===== */

/* Mobile portrait 2x2: when 3 buttons (Help, Settings, Shop), let Shop span full width */
@media (max-aspect-ratio: 1/1) {
.hud-bottom .game-btn[data-btn="shop"].span-2 {
grid-column: 1 / -1; /* takes both columns */
}
}

/* (No extra CSS needed for the desktop 2-button centering;
  JS sets grid-template-columns inline and positions the two items.) */

/* Landscape fine-tuning for small-height devices */
@media (pointer: coarse) and (orientation: landscape) and (max-height: 480px) {
.hud-bottom {
height: auto;
grid-template-columns: repeat(4, 1fr);
grid-auto-rows: clamp(44px, 12vh, 60px);
gap: 8px;
padding: 8px;
padding-bottom: calc(env(safe-area-inset-bottom) + 6px);
}
.game-btn {
font-size: clamp(14px, 2.2vw, 22px);
white-space: nowrap;
-webkit-text-stroke: 0;
text-stroke: 0;
text-shadow:
1px 0   0 #000,
-1px 0   0 #000,
0   1px 0 #000,
0  -1px 0 #000,
0   0.5px 0 rgba(0,0,0,0.2);
}
.hud-bottom [data-btn="stats"] {
font-size: clamp(13px, 2.0vw, 20px);
}
}

/* ===== Top HUD: Coin Counter + Other stuff ===== */
.hud-top{
position: fixed;
top: calc(env(safe-area-inset-top) + 12px);
left: 0;
right: 0;
z-index: 1000;
display: flex;
justify-content: center;
align-items: center;
flex-direction: column;
gap: clamp(4px, 0.9svh, 10px);
pointer-events: none;
}

/* ===== Defaults (desktop / general) ===== */
:root{
--coin-h: clamp(48px, 6svh, 72px);
--coin-plus-extra: 20px;
--coin-plus-size: calc(var(--coin-h) + var(--coin-plus-extra));

--coin-bar-w: clamp(200px, 36vw, 520px);
--coin-outline: 4px;

--bar-underlap: 0.50;
--hud-x-nudge: 0px;

--bar-y-nudge: 9px;
}

.coin-counter{
position: relative;
width: var(--coin-bar-w);
height: max(var(--coin-plus-size), var(--coin-h));
pointer-events: auto;
filter: drop-shadow(0 6px 10px rgba(0,0,0,.18));
}

.coin-plus{
position:absolute;
top:50%;
left: calc((var(--bar-underlap) - 1) * var(--coin-plus-size));
transform: translateY(-50%);
z-index:2;
height: var(--coin-plus-size);
width:  var(--coin-plus-size);
object-fit: contain;
border: none;
pointer-events: none;
user-select: none;
}

.coin-bar{
position:relative;
z-index:1;
height: var(--coin-h);
width: 100%;
border: var(--coin-outline) solid #000;
border-radius: 0;
background: linear-gradient(180deg,#ffd34c,#ffb800);

display:flex;
align-items:center;
justify-content:center;
padding: 0 16px;
box-sizing: border-box;
overflow: hidden;

transform: translateY(var(--bar-y-nudge));
}

.coin-bar::after{
content:"";
position:absolute;
inset:2px;
border-radius:0;
box-shadow:
inset 0 6px 10px rgba(255,255,255,.18),
inset 0 -6px 10px rgba(0,0,0,.15);
pointer-events:none;
}

.coin-amount{
position: relative;
z-index: 1;
font-weight: 900;
font-size: clamp(18px, 3.6vw, 32px);
color: #fff;
letter-spacing: .5px;
-webkit-text-stroke: 1px #000; text-stroke: 1px #000;
text-shadow: 0 1px 0 rgba(0,0,0,.35);
line-height: 1;
font-variant-numeric: tabular-nums lining-nums;
font-feature-settings: "tnum" 1, "lnum" 1;
}

@media (hover: none) and (pointer: coarse) {
  .coin-counter, .coin-plus, .xp-counter, .xp-plus {
    filter: none !important;
  }
}

@media (pointer: coarse) and (orientation: portrait) and (max-width: 600px){
.hud-top{
--pp-gutter: max(7vw, 24px);
--pp-reserve: max(
var(--pp-gutter),
calc((1 - var(--bar-underlap)) * var(--coin-plus-size) + 10px)
);
padding-left:  max(env(safe-area-inset-left),  var(--pp-reserve));
padding-right: max(env(safe-area-inset-right), var(--pp-reserve));
}
:root{
--coin-bar-w: clamp(240px, 65vw, 320px);
--coin-plus-extra: 4px;
--bar-underlap: 0.48;
--bar-y-nudge: 2px; 
}
}

@media (pointer: coarse) and (orientation: landscape){
:root{
--coin-bar-w: clamp(220px, 38vw, 560px);
}
}

@media (pointer: coarse) and (orientation: portrait) and (min-width: 768px) and (max-width: 1024px){
:root{
--coin-bar-w: min(72vw, 560px);
}
}

@media (pointer: coarse){
  .hud-top .coin-amount{
    -webkit-text-stroke: 0 !important;
    text-stroke: 0 !important;
    -webkit-text-fill-color: #fff;
    text-shadow:
      0   0.5px 0 #000,  0  -0.5px 0 #000,
      0.5px 0   0 #000, -0.5px 0   0 #000,
      0.5px 0.5px 0 #000,  0.5px -0.5px 0 #000,
     -0.5px 0.5px 0 #000, -0.5px -0.5px 0 #000,
      0 1px 0 rgba(0,0,0,0.28) !important;
  }
}

/* ===== XP HUD ===== */
.xp-counter{
  position: relative;
  --xp-bar-h: clamp(34px, 5.2svh, 46px);
  --xp-plus-size: clamp(52px, 7.4svh, 76px);
  --xp-bar-outline: 3px;
  --xp-bar-underlap: 0.44;
  width: min(var(--coin-bar-w), clamp(200px, 44vw, 440px));
  height: max(var(--xp-plus-size), var(--xp-bar-h));
  display: flex;
  align-items: center;
  justify-content: flex-end;
  margin-top: -2px;
  pointer-events: none;
  filter: drop-shadow(0 5px 8px rgba(0,0,0,.18));
}

.xp-counter[hidden]{
  display: none !important;
}

.xp-plus{
  position: absolute;
  top: 50%;
  left: calc((var(--xp-bar-underlap) - 1) * var(--xp-plus-size));
  transform: translateY(-50%);
  width: var(--xp-plus-size);
  height: auto;
  object-fit: contain;
  pointer-events: none;
  z-index: 2;
  filter: drop-shadow(0 5px 8px rgba(0,0,0,.18));
}

.xp-bar{
  position: relative;
  z-index: 1;
  flex: 1;
  width: 100%;
  height: var(--xp-bar-h);
  border: var(--xp-bar-outline) solid #01060f;
  border-radius: 0;
  background: linear-gradient(180deg, rgba(12,26,46,0.92), rgba(16,32,58,0.78));
  box-shadow:
    inset 0 6px 10px rgba(255,255,255,0.14),
    inset 0 -6px 14px rgba(0,0,0,0.45);
  overflow: hidden;
  pointer-events: none;
}

.xp-bar__fill{
  position: absolute;
  inset: 0;
  width: var(--xp-fill, 0%);
background: linear-gradient(90deg,
  rgba(0,240,255,1) 0%,
  rgba(0,150,255,1) 50%,
  rgba(0,70,210,1) 100%
);

  transition: width 160ms ease-out;
}

.xp-bar__fill::after{
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.52), rgba(255,255,255,0));
  opacity: 0.6;
  mix-blend-mode: screen;
}

.xp-bar__frame{
  position: relative;
  z-index: 1;
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: clamp(4px, 0.5svh, 6px);
  padding: clamp(3px, 0.9svh, 5px) clamp(10px, 2.4vw, 16px);
  font-size: clamp(10px, 1.6vw, 14px);
  font-weight: 700;
  color: #f2f7ff;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0,0,0,0.75);
  pointer-events: none;
  box-sizing: border-box;
}

@media (pointer: fine) {
  .xp-counter,
  .xp-bar,
  .xp-bar__frame {
    pointer-events: auto;
  }

  .xp-bar__frame,
  .xp-bar__frame *,
  .xp-bar__progress,
  .xp-bar__progress *,
  .xp-bar__level,
  .xp-bar__level * {
    user-select: text;
  }
  
  .xp-plus {
	  user-select: none;
  }
}

.xp-bar__level{
  display: inline-flex;
  align-items: baseline;
  gap: 0.3em;
  letter-spacing: 0;
  line-height: 0.75;
}

.xp-level-label,
.xp-level-value{
  font-size: clamp(12px, 2.0vw, 15px);
}

.xp-bar__divider{
  display: none;
}

.xp-bar__progress{
  display: inline-flex;
  align-items: baseline;
  justify-content: center;
  gap: 3px;
  font-size: clamp(12px, 2.0vw, 15px);
  white-space: nowrap;
  letter-spacing: 0.02em;
  line-height: 0.75;
}

.xp-progress-suffix{
  font-weight: 600;
  letter-spacing: 0.08em;
}

.xp-progress-separator{
  opacity: 0.8;
}

@media (pointer: coarse) and (orientation: portrait){
  .xp-counter{
    --xp-bar-h: clamp(32px, 8vw, 44px);
    --xp-plus-size: clamp(48px, 15vw, 70px);
    --xp-bar-underlap: 0.46;
    width: min(var(--coin-bar-w), clamp(200px, 82vw, 360px));
  }
}

@media (pointer: coarse) and (orientation: portrait) and (max-width: 600px) {
  .xp-counter {
    --xp-plus-size: var(--coin-plus-size);
  }
  .xp-plus {
    transform: translateY(-50%);
    left: calc((var(--xp-bar-underlap) - 1) * var(--xp-plus-size));
  }
}


/* Endgame nonsense */
.infinity-symbol {
  position: relative;
  color: #fff200;
  font-weight: 900;
  -webkit-text-fill-color: currentColor;
}

.coin-amount .infinity-symbol {
  top: -0.11em;
}
