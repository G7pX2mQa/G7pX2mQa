(()=>{var H0=Object.defineProperty;var qe=(e,t)=>()=>(e&&(t=e(e=0)),t);var yt=(e,t)=>{for(var n in t)H0(e,n,{get:t[n],enumerable:!0})};var cl={};yt(cl,{initAudio:()=>X0,loadAudio:()=>wm,playAudio:()=>ut,registerPreloadedBuffer:()=>W0,setAudioSuspended:()=>Au,setMusicUnderwater:()=>Mr});function Tu(){if(qt)return qt;let e=window.AudioContext||window.webkitAudioContext;return e?(qt=new e,Bs=qt.createGain(),Bs.connect(qt.destination),Bs.gain.value=1,al=qt.createGain(),al.gain.value=1,al.connect(Bs),lo=qt.createBiquadFilter(),lo.type="lowpass",lo.frequency.value=22050,lo.Q.value=1,lo.connect(al),qt):null}function X0(){Tu()}function V0(){qt&&qt.state==="suspended"&&qt.resume().catch(()=>{})}async function wm(e){let t=Tu();if(!t)return null;let n=new URL(e,document.baseURI).href;if(Fs.has(n))return Fs.get(n);if(ll.has(n))return ll.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return Fs.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{ll.delete(n)}})();return ll.set(n,o),o}function ut(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=Tu(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=Fs.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let d=s.createGain();return d.gain.value=t,u.connect(d),i==="music"?d.connect(lo):d.connect(Bs),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:d,element:null}}else wm(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function W0(e,t){let n=new URL(e,document.baseURI).href;Fs.set(n,t)}function Au(e){qt&&(e?qt.state==="running"&&qt.suspend().catch(()=>{}):qt.state==="suspended"&&qt.resume().catch(()=>{}))}function Mr(e){if(!lo)return;let t=e?600:22050;try{let n=qt.currentTime;lo.frequency.cancelScheduledValues(n),lo.frequency.setValueAtTime(t,n)}catch{lo.frequency.value=t}}var qt,Bs,al,lo,Fs,ll,kn=qe(()=>{qt=null,Bs=null,al=null,lo=null,Fs=new Map,ll=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,V0,{capture:!0,passive:!0})})});var c,Nt=qe(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",d=i+s;d.startsWith("-")?(u="-",d=d.slice(1)):d.startsWith("+")&&(d=d.slice(1));let f=d.replace(/^0+/,"")||"0",p=BigInt(u+f);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let f=i.slice(u+1)||"0";try{a=BigInt(f)}catch{a=0n}}let d=Number(l);return Number.isFinite(d)||(d=e.MAX_E),new e(BigInt(r),{base:d,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,d=Number(u),f=l;return Number.isSafeInteger(d)||(f+=u,d=0),new e(i,{base:d,offset:f},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let d=Math.min(n,18);o=u.toFixed(d).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}}});function Lm(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return xm.format(t)}catch{return String(e)}}function Us(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function Nu(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Lm(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+xm.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,d=Ru.get(u)||"",p=o-u+1,y=4-p,m=p+y;n.length<m+1&&(n+="0".repeat(m+1-n.length));let h=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(h=Us(h));let S,L;return h.length>m?(S=h.slice(0,p+1),L="0".repeat(y)):(S=h.slice(0,p),L=h.slice(p)),t+`${S}${y?"."+L:""}${d}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Us(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+Nu(String(o))}function z0(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Nu(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let d=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(d=Us(d)),l){let N=d.slice(0,1)+"."+d.slice(1),T=i==="-"?"-":"";return t+N+"e"+Nu(s,T)}let p=Math.floor(a/3)*3,y=Ru.get(p)||"",h=a-p+1,g=4-h,S,L;return d.length>4?(S=d.slice(0,h+1),L="0".repeat(g)):(S=d.slice(0,h),L=d.slice(h)),t+(i==="-"?"-":"")+S+(g?"."+L:"")+y}function Em(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Us(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+z0(l)}function ne(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Em(e.toScientific(3));if(t<6)return Lm(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=Ru.get(n);if(!o)return Em(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Us(u));let f,p;return u.length>l?(f=u.slice(0,i+1),p="0".repeat(s)):(f=u.slice(0,i),p=u.slice(i)),`${f}${s?"."+p:""}${o}`}var Y0,Ru,xm,Wt=qe(()=>{Nt();Y0=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],Ru=new Map(Y0),xm=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var Bm={};yt(Bm,{CURRENCIES:()=>Me,KEYS:()=>mt,STORAGE_PREFIX:()=>bi,bank:()=>O,clearActiveSlot:()=>sb,clearAllStorage:()=>ub,ensureCurrencyDefaults:()=>Vu,ensureMultiplierDefaults:()=>Wu,ensureStorageDefaults:()=>cb,getActiveSlot:()=>v,getCurrency:()=>Gs,getCurrencyMultiplierBN:()=>Pm,getHasOpenedSaveSlot:()=>lb,getLastSaveTime:()=>Gu,getLastSaveTimeKey:()=>ml,getSlotModifiedFlagKey:()=>ab,getSlotSignature:()=>Xu,getSlotSignatureKey:()=>Hu,hasModifiedSave:()=>Si,isCurrencyLocked:()=>Tn,isStorageKeyLocked:()=>nn,markSaveSlotModified:()=>un,notifyGameSessionStarted:()=>rb,onCurrencyChange:()=>pl,peekCurrency:()=>qs,primeStorageWatcherSnapshot:()=>rt,setActiveSlot:()=>qu,setCurrency:()=>yi,setCurrencyMultiplierBN:()=>yl,setHasOpenedSaveSlot:()=>gl,setSlotSignature:()=>hl,updateLastSaveTime:()=>Rm,watchStorageKey:()=>Lt});function Bu(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Fu(e){let t=Bu(e);return t==null?null:`${K0}:${t}`}function Uu(e){let t=Bu(e);return t==null?null:`${j0}:${t}`}function Tm(e={}){ul.size!==0&&ul.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function pl(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return ul.add(o),()=>{ul.delete(o)}}function J0(){if(Ds!=null||xo.size===0)return;Ds=(typeof window<"u"?window:globalThis).setInterval(eb,Z0)}function Am(){if(xo.size!==0||Ds==null)return;(typeof window<"u"?window:globalThis).clearInterval(Ds),Ds=null}function Nm(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function Q0(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function eb(){if(xo.size===0){Am();return}xo.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=Nm(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!Q0(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function Lt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=xo.get(e);return s||(s=new Set,xo.set(e,s)),s.add(i),J0(),()=>{let l=xo.get(e);l&&(l.delete(i),l.size===0&&(xo.delete(e),Am()))}}function rt(e,t){if(!e)return;let n=xo.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=Nm(r,o),r.initialized=!0)})}function Du(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function tb(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function nb(){Ou.forEach(e=>{try{e?.()}catch{}}),Ou.clear()}function Cm(e){if(e!==_m&&(nb(),_m=e??null,e!=null))for(let t of Object.values(Me)){let n=`${mt.CURRENCY[t]}:${e}`,o=Lt(n,{parse:tb,equals:Du,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};Tm(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Ou.set(n,o)}}function ob(){typeof window>"u"||(Cm(v()),window.addEventListener("saveSlot:change",()=>{Cm(v())}))}function rb(){$u=!0}function ml(e=v()){return e==null?null:`${Qo}lastSaveTime:${e}`}function Rm(){if(!$u||document.hidden)return;let e=v();if(e==null)return;let t=Date.now();try{localStorage.setItem(ml(e),String(t))}catch{}}function Gu(){let e=v();if(e==null)return 0;try{let t=localStorage.getItem(ml(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function ib(){typeof window>"u"||(Mm||(Mm=setInterval(Rm,1e3)),window.addEventListener("beforeunload",()=>{if(!$u)return;let e=v();if(e!=null)try{localStorage.setItem(ml(e),String(Date.now()))}catch{}}))}function v(){if(Zo!==void 0)return Zo;let e=localStorage.getItem(mt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return Zo=n,n}function qu(e){let t=Math.max(1,parseInt(e,10)||1);Zo=t,localStorage.setItem(mt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function sb(){Zo=null,localStorage.removeItem(mt.SAVE_SLOT)}function $s(e,t=v()){return t==null?null:`${e}:${t}`}function Om(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function nn(e){return Om(e)}function Hu(e=v()){return Fu(e)}function ab(e=v()){return Uu(e)}function Xu(e=v()){if(typeof localStorage>"u")return null;let t=Fu(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function hl(e,t){if(typeof localStorage>"u")return;let n=Fu(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function Si(e=v()){if(typeof localStorage>"u")return!1;let t=Uu(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function un(e=v()){if(typeof localStorage>"u")return;let t=Bu(e);if(t==null||Si(t))return;let n=Uu(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function lb(){return localStorage.getItem(mt.HAS_OPENED_SAVE_SLOT)==="true"}function gl(e){localStorage.setItem(mt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function cb(){localStorage.getItem(mt.HAS_OPENED_SAVE_SLOT)===null&&gl(!1)}function Vu(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${mt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function Wu(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${mt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))dl(t);else{let o=Jo(c.fromInt(1));vi(t,o)}}}function Gs(e){let t=$s(mt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function yi(e,t,{delta:n=null,previous:o=null}={}){let r=v(),i=$s(mt.CURRENCY[e],r),s=o??Gs(e),l=c.fromInt(0);if(!i||Tn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let d=null;try{d=localStorage.getItem(i)}catch{}let f=d??u,p=a;try{d!=null&&(p=c.fromAny(d),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}rt(i,f);let y=!Du(s,p),h=(S=>{if(S==null)return null;try{let L=S instanceof c?S.clone?.()??S:c.fromAny(S);if(typeof L.cmp=="function")return L.cmp(l)>0?L:null;if(!L.isZero?.())return L}catch{}return null})(n),g=null;if(y)try{g=p.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=h),y||g){let S={key:e,value:p,slot:r,delta:g??void 0};Tm(S);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:S}))}catch{}}return p}function Jo(e){return e.mulScaledIntFloor(1n,-Pu)}function fl(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,Pu)}function dl(e){let t=$s(mt.MULTIPLIER[e]);if(!t)return Jo(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(kr)){let r=Jo(c.fromInt(1));return vi(e,r),r}let o=n.slice(kr.length);try{return c.fromAny(o)}catch{let r=Jo(c.fromInt(1));return vi(e,r),r}}function vi(e,t,n=v()){let o=$s(mt.MULTIPLIER[e],n);if(!o||Tn(e,n))return;let r=Jo(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(kr))try{r=c.fromAny(i.slice(kr.length))}catch{}let s=c.fromAny(t),l=kr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,d=s;try{let f=u?.startsWith?.(kr)?u.slice(kr.length):null;f!=null&&(d=c.fromAny(f))}catch{}try{rt(o,u)}catch{}if(!Du(r,d))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:fl(d),slot:n}}))}catch{}}function Pm(e){return fl(dl(e))}function Tn(e,t=v()){let n=$s(mt.CURRENCY[e],t);return Om(n)}function yl(e,t){let n=c.fromAny(t),o=Jo(n);return vi(e,o,v()),n}function qs(e,t){let n=localStorage.getItem(`${mt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function ub(){Object.values(mt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function km(e){let t=n=>{try{let o=c.fromAny(n);return typeof ne=="function"?ne(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return Gs(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return yi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),yi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return yi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof ne=="function"?ne(r):r.toString()},t.mult={get(){return Pm(e)},set(n){return yl(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=dl(e).mulBigNumInteger(o);return r.isZero()&&(r=Jo(c.fromInt(1))),vi(e,r),fl(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),Pu)}catch{o={numer:1n,scale:0}}let r=dl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=Jo(c.fromInt(1))),vi(e,r);let i=fl(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var Qo,bi,K0,j0,Pu,kr,Z0,xo,Ds,ul,Ou,_m,Mm,$u,mt,Me,Zo,O,bt=qe(()=>{Nt();Wt();Qo="ccc:",bi=Qo,K0=`${Qo}slotSig`,j0=`${Qo}slotMod`,Pu=18,kr="XM:",Z0=140,xo=new Map,Ds=null,ul=new Set;Ou=new Map,_m=null;Mm=null,$u=!1;ib();mt={HAS_OPENED_SAVE_SLOT:`${Qo}hasOpenedSaveSlot`,SAVE_SLOT:`${Qo}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Me={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===mt.SAVE_SLOT){if(e.newValue===null)Zo=null;else{let t=parseInt(e.newValue,10);Zo=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:Zo}}))}catch{}}});for(let e of Object.values(Me))mt.CURRENCY[e]=`${Qo}${e}`,mt.MULTIPLIER[e]=`${Qo}mult:${e}`;ob();O=new Proxy({},{get(e,t){if(Object.values(Me).includes(t))return km(t);if(typeof t=="string"&&Me[t.toUpperCase?.()])return km(Me[t.toUpperCase()])}});if(typeof window<"u"){window.bank=O;for(let e of Object.values(Me))window[e]=O[e]}});function Um(){return co}function vl(e){co=!!e,document.body.classList.toggle("slots-delete-mode",co);let t=document.getElementById("manage-saves");t&&(t.textContent=co?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",co),n.setAttribute("aria-pressed",co?"true":"false")})}function fb(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function db(){if(Fm)return;Fm=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),vl(!co)}),window.addEventListener("keydown",r=>{co&&r.key==="Escape"&&vl(!1)});let n=r=>{!co||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!co)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(fb(s),v()===s)try{localStorage.removeItem(mt.SAVE_SLOT)}catch{}Yu(),vl(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),vl(!1)}var co,Fm,Dm=qe(()=>{bt();zu();co=!1,Fm=!1;document.addEventListener("DOMContentLoaded",()=>{try{db()}catch{}})});var $m={};yt($m,{initSlots:()=>hb,refreshSlotsView:()=>Yu});function pb(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function mb(e){if(!pb(e))return"No Save Data";try{let t=qs(e,"coins");return ne(t)}catch{return"0"}}function Ku(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=mb(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function hb(e){let t=document.querySelectorAll(".slot-card");Ku(),t.forEach((n,o)=>{let r=o+1,i=s=>{qu(r),Vu(),Wu(),gl(!0),typeof e=="function"&&e(r,s),Ku()};n.addEventListener("click",s=>{Um()||(s.preventDefault(),i(s))})})}function Yu(){Ku()}var zu=qe(()=>{Nt();Wt();Dm();bt()});var qm={};yt(qm,{registerPreloadedAudio:()=>gb,takePreloadedAudio:()=>yb});function gb(e,t){let n=Gm(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}bl.set(n,t)}}function yb(e){let t=Gm(e);if(!bl.has(t))return null;let n=bl.get(t);return bl.delete(t),n}var bl,Gm,Sl=qe(()=>{bl=new Map,Gm=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Ii(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var ju=qe(()=>{});var rh={};yt(rh,{addExternalCoinMultiplierProvider:()=>Or,addExternalXpGainMultiplierProvider:()=>Mi,addXp:()=>Ci,broadcastXpChange:()=>_l,computeCoinMultiplierForXpLevel:()=>lf,getXpGainMultiplier:()=>Ml,getXpLevelStorageKey:()=>vb,getXpRequirementForXpLevel:()=>Cl,getXpState:()=>Ze,initXpSystem:()=>Li,isXpSystemUnlocked:()=>rn,onXpChange:()=>xl,refreshCoinMultiplierFromXpLevel:()=>pn,resetXpProgress:()=>_i,setExternalBookRewardProvider:()=>kl,setExternalCoinMultiplierProvider:()=>nh,setExternalXpGainMultiplierProvider:()=>oh,unlockXpSystem:()=>Rr});function vb(e=v()){let t=e??v();return t==null?null:Tr(t)}function Ib(e){if(e===0n)return 0;let t=e.toString(),n=t.length,o=Math.min(n,15),r=Number(t.slice(0,o)),i=n-o;if(!Number.isFinite(r))return Number.POSITIVE_INFINITY;let s=r*Math.pow(10,i);return Number.isFinite(s)?s:Number.POSITIVE_INFINITY}function on(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function Il(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function jm(e){if(!e||typeof e!="object")return 0;if(on(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function wb(e){return!e||typeof e!="object"?0:on(e)||typeof e.cmp=="function"&&e.cmp(Km)>=0?Number.POSITIVE_INFINITY:jm(e)}function Xm(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(Sb,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(zs())??c.fromInt(0):n}function Eb(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(zm,18)}function xb(e){if(on(e)||typeof e.cmp=="function"&&e.cmp(Km)>=0)return ft.clone?.()??ft;let t=e.floorToInteger(),n=e.sub(t),o=jm(n);if(!Number.isFinite(o))return ft.clone?.()??ft;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return ft.clone?.()??ft;let f=BigInt(u)+l-BigInt(i),y=f%BigInt(250),m=Number(y),h=f-y;return new c(a,{base:m,offset:h})}function Zm(e){if(!e||typeof e!="object")return ft.clone?.()??ft;let n=Eb(e),o=xb(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return ft.clone?.()??ft;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function Jm(){let e=on(q.xpLevel),t=on(q.progress);if(!e&&!t)return!1;let n=ft.clone?.()??ft;if(q.xpLevel=n.clone?.()??n,q.progress=n.clone?.()??n,St=n.clone?.()??n,O?.books)try{typeof O.books.set=="function"?O.books.set(n.clone?.()??n):typeof O.books.add=="function"&&O.books.add(n.clone?.()??n)}catch{}return!0}function Vs(e={}){Ys.size!==0&&Ys.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function xl(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return Ys.add(n),()=>{Ys.delete(n)}}function Rt(){return c.fromInt(0)}function zs(){return c.fromInt(1)}function wi(e){if(!e)return Rt();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Rt()}}function wl(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Lb(){for(;rf.length>0;){let e=rf.pop();try{e?.()}catch{}}}function Wm(e){if(e==null)return Rt();try{return c.fromAny(e)}catch{return Rt()}}function Qu(e){if(!Ju){Ju=!0;try{let t=sf??v(),n={unlocked:q.unlocked,xpLevel:wi(q.xpLevel),progress:wi(q.progress),requirement:wi(St)};Yt(!0),Wn(),dn(!0);let o={unlocked:q.unlocked,xpLevel:wi(q.xpLevel),progress:wi(q.progress),requirement:wi(St)},r=n.unlocked!==o.unlocked,i=!wl(n.xpLevel,o.xpLevel),s=!wl(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Rt();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Rt()}catch{l=Rt()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||Ys.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(Vs(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{Ju=!1}}}function ef(e){if(e===sf||(Lb(),sf=e??null,e==null))return;let t=(n,o)=>{let r=Lt(n,o);typeof r=="function"&&rf.push(r)};t(Hs(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>Qu("unlock")}),t(Tr(e),{parse:Wm,equals:wl,onChange:()=>Qu("xpLevel")}),t(xi(e),{parse:Wm,equals:wl,onChange:()=>Qu("progress")})}function Qm(){if(Vm){ef(v());return}Vm=!0,ef(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{ef(v()),Yt(!0),Wn(),dn(!0)})}function tf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function Ks(e){if(!e||typeof e!="object")return Number.NEGATIVE_INFINITY;if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return Number.POSITIVE_INFINITY;if(e.isZero?.()||typeof e.isZero=="function"&&e.isZero())return Number.NEGATIVE_INFINITY;let t=e.sig,n=typeof e.e=="number"?e.e:Number(e.e??0),o=typeof e._eOffset=="bigint"?Ib(e._eOffset):Number(e._eOffset??0);if(!Number.isFinite(n))return n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(!Number.isFinite(o))return o>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let r=n+o;if(!Number.isFinite(r))return r>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let i=0;if(typeof t=="bigint"){let l=t.toString().replace(/^0+/,"");if(!l)return Number.NEGATIVE_INFINITY;let a=l.length,u=Math.min(a,15),d=l.slice(0,u),f=Number.parseFloat(d);Number.isFinite(f)&&f>0?i=Math.log10(f)+(a-u):i=a-1}else try{let s=typeof e.toScientific=="function"?e.toScientific(12):String(e);if(!s||s==="0")return Number.NEGATIVE_INFINITY;if(s==="Infinity")return Number.POSITIVE_INFINITY;let l=s.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(l){let a=parseFloat(l[1]),u=parseInt(l[2],10)||0;if(!(a>0)||!Number.isFinite(a))return Number.NEGATIVE_INFINITY;i=Math.log10(a)+u}else{let a=Number(s);if(!Number.isFinite(a)||a<=0)return Number.NEGATIVE_INFINITY;i=Math.log10(a)}}catch{return Number.NEGATIVE_INFINITY}return r+i}function _b(e){let t=e<Hm?e:Hm;if(t<=Ei)return;let n=Ei,o=er.get(n.toString());for(o||(o=c.fromInt(10),er.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),er.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Ei=n;return}}Ei=n}function Cb(e){if(!Number.isFinite(e)||e>=c.MAX_E)return ft.clone?.()??ft;let t=Math.floor(e),n=e-t;Number.isFinite(n)||(n=0);let o=Math.pow(10,n);(!Number.isFinite(o)||o<=0)&&(o=1),o>=10&&(o/=10,t+=1);let r;try{r=Number.isFinite(t)?t.toLocaleString("en",{useGrouping:!1}):String(t)}catch{r=String(t)}let i=`${o.toPrecision(18)}e${r}`;try{return c.fromScientific(i).floorToInteger()}catch{return ft.clone?.()??ft}}function Mb(e){let t=Ei>0n?Ei:0n,n=er.get(t.toString());if(!n||on(n))return ft.clone?.()??ft;let o=c.fromAny(t.toString()),r=Ks(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);Il(s)||(i=i.add?.(s.mulDecimal(zm,18))??i);let l=Xm(e),a=Xm(o),u=l.sub?.(a)??c.fromInt(0);Il(u)||(i=i.add?.(u.mulDecimal(bb,18))??i);let d=wb(i);return Number.isFinite(d)?Cb(d):ft.clone?.()??ft}function kb(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=on(t),o=on(e);if(n)return o?1:0;if(Il(t)||Il(e))return 0;let s=Ks(e),l=Ks(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function eh(){return fn.container&&fn.container.isConnected?!0:(fn.container=document.querySelector(".xp-counter[data-xp-hud]"),fn.container?(fn.bar=fn.container.querySelector(".xp-bar"),fn.fill=fn.container.querySelector(".xp-bar__fill"),fn.xpLevelValue=fn.container.querySelector(".xp-level-value"),fn.progress=fn.container.querySelector("[data-xp-progress]"),!0):!1)}function th(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=er.get("0");return a.clone?.()??a}if(r.bigInt!=null){_b(i);let a=i.toString(),u=er.get(a);if(u)return u.clone?.()??u}let s=Mb(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?ft.clone?.()??ft:(r.bigInt!=null&&er.set(r.bigInt.toString(),s),s.clone?.()??s)}function Lo(){St=th(q.xpLevel)}function El(){q.xpLevel=Rt(),q.progress=Rt(),Lo(),dn(!0)}function Ym(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function Ll(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function dn(e=!1){let t=O?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=Ll(q.xpLevel),o=n.bigInt,r=!n.finite,i=typeof q.xpLevel?.toStorage=="function"?q.xpLevel.toStorage():null;if(!e&&(r&&Nn||!r&&o!=null&&!Nn&&!Rn&&An!=null&&o===An||!r&&o==null&&Rn&&i&&On&&i===On))return;if(r){try{t.set(ft)}catch{}An=null,Nn=!0,Rn=!1,On=null;return}let s;if(o!=null&&o<=of){let d=c.fromInt(1),f=Number(o);for(let y=0;y<f;y+=1)d=d.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(f)}typeof d.add=="function"?d=d.add(p):typeof p.add=="function"&&(d=p.add(d)),s=d.clone?.()??d}else s=Zm(q.xpLevel);let l=s.clone?.()??s,a=tr.size>0?Array.from(tr):typeof Ar=="function"?[Ar]:[];for(let d of a)if(typeof d=="function")try{let f=d({baseMultiplier:l.clone?.()??l,xpLevel:q.xpLevel.clone?.()??q.xpLevel,xpUnlocked:q.unlocked});f instanceof c?l=f.clone?.()??f:f!=null&&(l=c.fromAny(f))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(An=null,Nn=!0,Rn=!1,On=null):o!=null&&o<=of?(An=o,Nn=!1,Rn=!1,On=null):(An=null,Nn=!1,Rn=!0,On=i)}function Yt(e=!1){let t=v();if(t==null)return Xs=null,Zu=!1,q.unlocked=!1,El(),q;if(!e&&Zu&&t===Xs)return q;Xs=t,Zu=!0;try{let n=localStorage.getItem(Hs(t));q.unlocked=n==="1"}catch{q.unlocked=!1}try{q.xpLevel=c.fromAny(localStorage.getItem(Tr(t))??"0")}catch{q.xpLevel=Rt()}try{q.progress=c.fromAny(localStorage.getItem(xi(t))??"0")}catch{q.progress=Rt()}return(on(q.xpLevel)||on(q.progress))&&(q.unlocked=!0),q.unlocked?(Jm(),Lo(),dn(!0),Qm(),q):(El(),q)}function Ws(){let e=v();if(e==null)return;let t={unlocked:q.unlocked?"1":"0",level:q.xpLevel.toStorage(),progress:q.progress.toStorage()};try{localStorage.setItem(Hs(e),t.unlocked)}catch{}try{localStorage.setItem(Tr(e),t.level)}catch{}try{localStorage.setItem(xi(e),t.progress)}catch{}let n=(()=>{let r=q.unlocked,i=q.xpLevel,s=q.progress;try{r=localStorage.getItem(Hs(e))==="1"}catch{}try{let l=localStorage.getItem(Tr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(xi(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();rt(Hs(e),n.unlocked?"1":"0"),rt(Tr(e),n.level?.toStorage?.()??t.level),rt(xi(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==q.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(q.unlocked=n.unlocked,q.xpLevel=n.level,q.progress=n.progress,Lo(),dn(!0),Wn())}function Tb(){dn(!0);let e=zs();if(typeof nf=="function")try{let n=nf({baseReward:e.clone?.()??e,xpLevel:q.xpLevel.clone?.()??q.xpLevel,xpUnlocked:q.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{O?.books?.addWithMultiplier?O.books.addWithMultiplier(e):O?.books?.add&&O.books.add(e)}catch{}let t=Ll(q.xpLevel);t.finite?t.bigInt!=null?(An=t.bigInt,Nn=!1,Rn=!1,On=null):(An=null,Nn=!1,Rn=!0,On=typeof q.xpLevel?.toStorage=="function"?q.xpLevel.toStorage():null):(An=null,Nn=!0,Rn=!1,On=null)}function Wn(){if(!eh())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=fn;if(!e)return;if(!q.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=ne(St);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=tf(ne(St));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Ii();return}e.removeAttribute("hidden");let i=St,s=kb(q.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=ne(q.xpLevel)),r){let a=ne(q.progress),u=ne(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=tf(ne(q.progress)),u=tf(ne(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Ii()}function Li({forceReload:e=!1}={}){return eh(),Yt(e),Lo(),Wn(),Qm(),Ze()}function Rr(){if(Yt(),q.unlocked)return Wn(),!1;El(),q.unlocked=!0,Ws(),Wn(),dn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Ze()}))}catch{}return!0}function _i({keepUnlock:e=!0}={}){Yt();let t=q.unlocked;return El(),q.unlocked=e?t||q.unlocked:!1,Ws(),Wn(),dn(!0),Ze()}function Ci(e,{silent:t=!1}={}){Yt();let n=Xs??v();if(n!=null&&Ym(xi(n)))return{unlocked:q.unlocked,xpLevelsGained:Rt(),xpAdded:Rt(),xpLevel:q.xpLevel,progress:q.progress,requirement:St,slot:n};if(!q.unlocked)return{unlocked:!1,xpLevelsGained:Rt(),xpAdded:Rt(),xpLevel:q.xpLevel,requirement:St};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Rt()}if(!o.isZero?.()){let f=nr.size>0?Array.from(nr):typeof Nr=="function"?[Nr]:[];for(let p of f)if(typeof p=="function")try{let y=p({baseGain:o.clone?.()??o,xpLevel:q.xpLevel.clone?.()??q.xpLevel,xpUnlocked:q.unlocked});y instanceof c?o=y.clone?.()??y:y!=null&&(o=c.fromAny(y))}catch{}}if(o=_o("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return Wn(),{unlocked:!0,xpLevelsGained:Rt(),xpAdded:o,xpLevel:q.xpLevel,requirement:St};q.progress=q.progress.add(o),Lo();let r=n!=null&&Ym(Tr(n)),i=on(q.progress),s=on(q.xpLevel),l=on(o);if(i||s||l){let f=ft.clone?.()??ft;r||(q.xpLevel=f.clone?.()??f),q.progress=f.clone?.()??f,Lo(),Jm(),Ws(),Wn(),dn(!0);let p={unlocked:!0,xpLevelsGained:Rt(),xpAdded:o.clone?.()??o,xpLevel:q.xpLevel.clone?.()??q.xpLevel,progress:q.progress.clone?.()??q.progress,requirement:St.clone?.()??St,slot:n};if(Vs(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Rt();if(q.progress.cmp(St)<0){Ws(),Wn();let f={unlocked:!0,xpLevelsGained:Rt(),xpAdded:o,xpLevel:q.xpLevel,progress:q.progress,requirement:St,slot:n};if(Vs(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}if(!r){let f=Ks(q.progress),p=.08118668602542883,y=Ks(St);if(f-y>2){let g=q.xpLevel,S=f-y,L=Math.floor(S/p);if(L>500){let w=BigInt(Math.max(0,L-5));if(w>0n){let N=c.fromAny(w.toString());if(q.xpLevel=q.xpLevel.add(N),a=a.add(N),Lo(),O?.books?.add)try{let T=N.clone();O.books.add(T)}catch{}}}}let m=0,h=500;for(;q.progress.cmp?.(St)>=0&&m<h&&(q.progress=q.progress.sub(St),q.xpLevel=q.xpLevel.add(zs()),a=a.add(zs()),Tb(),Lo(),!on(St));)m+=1;m>=h&&q.progress.cmp(St)>=0&&Lo()}Ws(),Wn();let u=Ll(q.xpLevel);u.finite?u.bigInt!=null?(An=u.bigInt,Nn=!1,Rn=!1,On=null):(An=null,Nn=!1,Rn=!0,On=typeof q.xpLevel?.toStorage=="function"?q.xpLevel.toStorage():null):(An=null,Nn=!0,Rn=!1,On=null);let d={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:q.xpLevel.clone?.()??q.xpLevel,progress:q.progress.clone?.()??q.progress,requirement:St.clone?.()??St,slot:n};if(Vs(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}function Ze(){return Yt(),{unlocked:q.unlocked,xpLevel:q.xpLevel.clone?.()??q.xpLevel,progress:q.progress.clone?.()??q.progress,requirement:St.clone?.()??St}}function _l(e={}){Yt();let t=Xs??v(),n={...Ze(),slot:t,...e};if(Vs(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function rn(){return Yt(),!!q.unlocked}function Cl(e){return th(e)}function Ml(){Yt();let e=zs(),t=nr.size>0?Array.from(nr):typeof Nr=="function"?[Nr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:q.xpLevel.clone?.()??q.xpLevel,xpUnlocked:q.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function lf(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=Ll(t),o=n.bigInt;if(!n.finite)return ft.clone?.()??ft;let i;if(o!=null&&o<=of){let a=c.fromInt(1),u=Number(o);for(let f=0;f<u;f+=1)a=a.mulDecimal("1.1",18);let d;try{d=c.fromAny(o.toString())}catch{d=c.fromInt(u)}typeof a.add=="function"?a=a.add(d):typeof d.add=="function"&&(a=d.add(a)),i=a.clone?.()??a}else i=Zm(t);let s=i.clone?.()??i,l=tr.size>0?Array.from(tr):typeof Ar=="function"?[Ar]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!q.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function nh(e){Ar=typeof e=="function"?e:null,tr.clear(),Ar&&tr.add(Ar),Yt(),dn(!0)}function pn(){Yt(),dn(!0)}function oh(e){Nr=typeof e=="function"?e:null,nr.clear(),Nr&&nr.add(Nr)}function Or(e){return typeof e!="function"?()=>{}:(tr.add(e),Yt(),dn(!0),()=>{tr.delete(e),Yt(),dn(!0)})}function Mi(e){return typeof e!="function"?()=>{}:(nr.add(e),Yt(),()=>{nr.delete(e)})}function kl(e){nf=typeof e=="function"?e:null}var af,Hs,Tr,xi,Xs,Zu,St,er,Ei,ft,An,Nn,Rn,On,Ar,Nr,tr,nr,nf,Hm,fL,dL,of,zm,bb,Sb,Km,q,Ys,fn,rf,Vm,sf,Ju,Yn=qe(()=>{Nt();bt();js();Wt();ju();af="ccc:xp",Hs=e=>`${af}:unlocked:${e}`,Tr=e=>`${af}:level:${e}`,xi=e=>`${af}:progress:${e}`;Xs=null,Zu=!1,St=c.fromInt(10),er=new Map;er.set("0",St);Ei=0n,ft=c.fromAny("Infinity"),An=null,Nn=!1,Rn=!1,On=null,Ar=null,Nr=null,tr=new Set,nr=new Set,nf=null,Hm=5000n,fL=Math.log10(11/10),dL=Math.log10(5/2),of=200n,zm="0.04139268515822507",bb="0.3979400086720376",Sb="0.1",Km=c.fromScientific(String(c.MAX_E));q={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};Ys=new Set;fn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};rf=[],Vm=!1,sf=null,Ju=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Li,unlockXpSystem:Rr,addXp:Ci,getXpState:Ze,broadcastXpChange:_l,isXpSystemUnlocked:rn,getXpRequirementForXpLevel:Cl,getXpGainMultiplier:Ml,setExternalCoinMultiplierProvider:nh,addExternalCoinMultiplierProvider:Or,refreshCoinMultiplierFromXpLevel:pn,setExternalXpGainMultiplierProvider:oh,addExternalXpGainMultiplierProvider:Mi,setExternalBookRewardProvider:kl,resetXpProgress:_i}))});var fh={};yt(fh,{GHOST_TAP_TIMEOUT_MS:()=>Ab,clearGhostTapTarget:()=>Zs,consumeGhostTapGuard:()=>uh,initGlobalGhostTap:()=>Gb,installGhostTapGuard:()=>$b,markGhostTapTarget:()=>ch,setGhostTapSelector:()=>qb,shouldSkipGhostTap:()=>zn,suppressNextGhostTap:()=>uo});function Mo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function ff(){return typeof document>"u"?null:document}function Ob(e){if(!ff())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(uf)}function Zs(e){e&&(e[Tl]=0)}function ch(e,t=0,n=null){if(!e)return;let o=Mo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[Tl]=o+r:e[Tl]=0,Rb=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&uo(i)}function uh(e){if(typeof window>"u")return!1;let t=window[ki];return typeof t!="number"?!1:Mo()<=t?!0:(window[ki]=null,!1)}function zn(e){if(!e)return!1;let t=Number(e[Tl]||0);return!Number.isFinite(t)||t<=0?!1:Mo()<=t?(Zs(e),!0):(Zs(e),!1)}function uo(e=0){if(typeof window>"u")return;let t=Mo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[ki]=null;return}let o=t+n,r=typeof window[ki]=="number"?window[ki]:0;window[ki]=Math.max(r,o)}function Pb(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Nl=or=Mo(),Co=0))}function Bb(e){Nl=or=Mo(),Co=0}function Fb(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Mo();or>0&&(Co=t-or),Nl=t}function Ub(){let e=Mo();or>0&&(Co=e-or),Nl=e}function Db(e){if(!e.isTrusted)return;let t=Mo(),n=or>0?t-or:-1,o=Ob(e.target);if(zn(o)){Co=0,e.preventDefault(),e.stopImmediatePropagation();return}if(uh(o)){o&&Zs(o),Co=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Co||n)>=lh){Zs(o),Co=0,e.preventDefault(),e.stopImmediatePropagation();return}Co=0}function $b(e={}){if(ih)return;let t=ff();!t||typeof window>"u"||(ih=!0,cf="PointerEvent"in window,sh=!cf&&"ontouchstart"in window,e.selector&&(uf=`${e.selector}, ${Al}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(lh=e.longPressMs),t.addEventListener("click",Db,!0),cf?(t.addEventListener("pointerdown",Pb,{capture:!0,passive:!1}),t.addEventListener("pointerup",Fb,{capture:!0,passive:!0})):sh&&(t.addEventListener("touchstart",Bb,{capture:!0,passive:!1}),t.addEventListener("touchend",Ub,{capture:!0,passive:!0})))}function ah(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Al);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(ch(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function Gb(){let e=ff();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",ah,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",ah,{capture:!1,passive:!1})}function qb(e){e&&(uf=`${e}, ${Al}`)}var Ab,Tl,ki,Al,Nb,ih,uf,cf,sh,Rb,Nl,or,Co,lh,Ti=qe(()=>{Ab=0,Tl=Symbol("ccc:ghostTap:skipUntil"),ki="__cccGhostTapSkipUntil",Al='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',Nb=80,ih=!1,uf=Al,cf=!1,sh=!1,Rb=null,Nl=0,or=0,Co=0,lh=Nb});var df,dh=qe(()=>{df={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var ph={};yt(ph,{RateAccumulator:()=>Qs,pauseGameLoop:()=>yf,registerFrame:()=>Yb,registerTick:()=>ko,resumeGameLoop:()=>vf,startGameLoop:()=>Vb,stopGameLoop:()=>Wb});function hf(e){e||(e=performance.now());let t=e;if(gf){Pr=t,Fr=requestAnimationFrame(hf);return}Pr||(Pr=t);let n=(t-Pr)/1e3;Pr=t,n>60&&(n=60),n<0&&(n=0),Br+=n;let o=0,r=250;for(;Br>=Js;){if(o>=r){Br=Br%Js;break}pf.forEach(i=>{try{i(Js)}catch(s){console.error("Error in game tick listener:",s)}}),Br-=Js,o++}if(mf.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),Ai===0||Ni===0)Ai=Date.now(),Ni=t;else{let i=t-Ni;if(i>Xb){let s=Date.now(),l=s-Ai;l<-1e3?un():l>i+1e4&&un(),Ai=s,Ni=t}}Fr=requestAnimationFrame(hf)}function yf(){gf=!0}function vf(){gf=!1,Pr=performance.now(),Br=0,Ai=0,Ni=0}function Vb(){Fr||(Pr=performance.now(),Br=0,Ai=0,Ni=0,Fr=requestAnimationFrame(hf))}function Wb(){Fr&&(cancelAnimationFrame(Fr),Fr=null)}function ko(e){return typeof e!="function"?()=>{}:(pf.add(e),()=>{pf.delete(e)})}function Yb(e){return typeof e!="function"?()=>{}:(mf.add(e),()=>{mf.delete(e)})}var Hb,Js,pf,mf,Fr,gf,Pr,Br,Ai,Ni,Xb,Qs,Ur=qe(()=>{bt();Hb=20,Js=1/Hb,pf=new Set,mf=new Set,Fr=null,gf=!1,Pr=0,Br=0,Ai=0,Ni=0,Xb=2e3;Qs=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Js;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ke,Dr,ea,ta,na,oa,Kn,Ri,zb,mh,$r=qe(()=>{Nt();Ke="automation",Dr=1,ea=2,ta=3,na=4,oa=5,Kn=6,Ri={[ea]:"coins",[ta]:"books",[na]:"gold",[oa]:"magic"},zb=[{area:Ke,id:Dr,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ke,id:ea,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ke,id:ta,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ke,id:na,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ke,id:oa,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ke,id:Kn,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],mh=zb.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var wh={};yt(wh,{getGearsProductionRate:()=>Bl,getGenerationLevelKey:()=>Hr,getGenerationUpgradeCost:()=>rr,initWorkshopSystem:()=>Ih,initWorkshopTab:()=>_f,performFreeGenerationUpgrade:()=>Fl,updateWorkshopTab:()=>jn});function Pi(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*tS}function Hr(e){return`ccc:workshop:genLevel:${e}`}function sa(){let e=v();if(!e)return c.zero();let t=localStorage.getItem(Hr(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function la(e){let t=v();if(!t)return!1;let n=Hr(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function ca(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let f=e.toPlainIntegerString();t=parseFloat(f)}catch{return 1/0}if(t<=0)return Sf;if(t<=Gr)return Sf+t*gh;Ol===null&&(Ol=Sf+Gr*gh);let n=t-Gr;if(t<=ra)return Ol+n+Pi(n,Oi);if(Pl===null){let f=ra-Gr;Pl=Ol+f+Pi(f,Oi)}let o=t-ra,r=t-Gr,i=ra-Gr,s=o+(Pi(r,Oi)-Pi(i,Oi)),l=Jb/Zb,a=.5*l*o*o;if(t<=Rl)return Pl+s+a;if(wf===null){let f=Rl-ra,p=Rl-Gr,y=f+(Pi(p,Oi)-Pi(i,Oi)),m=.5*l*f*f;wf=Pl+y+m}let u=Qb*(t-Rl);if(u>709)return 1/0;let d=wf*Math.exp(u);return!Number.isFinite(d)||d>179e306?1/0:d}function rr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=ca(t);return Ne(n)}function Lf(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(If);if(n.cmp(9e15)<=0){let s=Number(n.toString())*If;t=Ne(s)}else{let i=n.mulDecimal(If);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Ne(s)}catch{t=c.fromAny("Infinity")}}}let o=O?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function rS(){let e=rr(Je);if(O.coins.value.cmp(e)<0)return;let t=Je.add(1);la(t)&&(Je=t,O.coins.sub(e),jn(),Kt())}function iS(){if(!Ft())return;let n=Lf(Je).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&O.gears&&O.gears.add(n),Je.cmp(20)<0){let r=Number(Je.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(qr+=a,qr>=1){let u=Math.floor(qr);qr-=u,O.gears&&O.gears.add(u)}}else qr=0}function xf(){O.gears&&O.gears.set(0),la(c.zero())&&(Je=c.zero()),qr=0,jn()}function vh(e){if(!e)return;let t=aa.get(e);if(!t){let s=e.getBoundingClientRect();t={gears:[],width:s.width,height:s.height,needsDistribution:!s.width||!s.height},aa.set(e,t)}let n=e.getBoundingClientRect();n.width>0&&n.height>0&&(t.width=n.width,t.height=n.height);let o=0;Je.cmp(bf)>0?o=bf:o=Number(Je.toPlainIntegerString());let r=Math.min(Math.floor(o),bf),i=t.gears;for(;i.length<r;){let s=document.createElement("img");s.src=bh,s.classList.add("workshop-bg-gear"),s.alt="",s.setAttribute("aria-hidden","true");let l=32+Math.random()*48,a=0,u=0;t.width>0&&t.height>0?(a=Math.random()*(t.width-l),u=Math.random()*(t.height-l),a<0&&(a=0),u<0&&(u=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,f=Math.cos(d)*yh,p=Math.sin(d)*yh,y=Math.random()*360,m=(Math.random()<.5?-1:1)*(nS+Math.random()*oS);s.style.width=`${l}px`,s.style.transform=`translate3d(${a}px, ${u}px, 0) rotate(${y}deg)`,s.style.willChange="transform",e.appendChild(s),i.push({element:s,x:a,y:u,dx:f,dy:p,rotation:y,rotationSpeed:m,size:l})}for(;i.length>r;){let s=i.pop();s.element.parentNode&&s.element.parentNode.removeChild(s.element)}}function sS(e){let t="Click the big red button below to open the Automation Shop";je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${Kb}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${bh}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${jb}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{rS()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),lS()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{Ul("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(zt&&zt.isConnected){let a=zt.querySelector(".workshop-side-left"),u=zt.querySelector(".workshop-side-right"),d=f=>{if(!f)return;let p=aa.get(f);if(p){let y=f.getBoundingClientRect();if(p.width=y.width,p.height=y.height,p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let m of p.gears)m.x=Math.random()*(p.width-m.size),m.x<0&&(m.x=0),m.y=Math.random()*(p.height-m.size),m.y<0&&(m.y=0),m.element.style.transform=`translate3d(${m.x}px, ${m.y}px, 0) rotate(${m.rotation}deg)`}}};d(a),d(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Sh():aS()},{root:null,threshold:0}).observe(e),zt=e}function jn(){if(!zt)return;let e=zt.querySelector('[data-workshop="gears-amount"]'),t=zt.querySelector('[data-workshop="gears-rate"]'),n=zt.querySelector('[data-workshop="upgrade-cost"]'),o=zt.querySelector('[data-workshop="upgrade-gen"]'),r=Lf(Je),i=rr(Je);if(e&&(e.innerHTML=O.gears.fmt(O.gears.value)),t&&(t.innerHTML=ne(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${ne(i)} ${l}`}if(o){let l=O.coins.value.cmp(i)>=0;o.disabled=!l;let a=_t(Ke,Kn),u=!1;if(a>0){let d=v(),f=d!=null?`:${d}`:"",p=`ccc:autobuy:${Ke}:${Kn}${f}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(Je.isInfinite()?s="Infinity":s=Je.floorToInteger().toStorage(),s!==Ef){Ef=s;let l=zt.querySelector(".workshop-side-left"),a=zt.querySelector(".workshop-side-right");l&&vh(l),a&&vh(a)}}function aS(){Bi&&(cancelAnimationFrame(Bi),Bi=null)}function Sh(){if(Bi)return;ia=0;let e=t=>{if(zt&&zt.isConnected){let n=zt.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=O.gears.fmt(O.gears.value)),ia||(ia=t);let o=(t-ia)/1e3;ia=t,o>.1&&(o=.1);for(let[r,i]of aa){if(!r.isConnected)continue;let{gears:s,width:l,height:a}=i;if(!(!l||!a))for(let u of s)u.x+=u.dx*o,u.y+=u.dy*o,u.x<0?(u.x=0,u.dx=-u.dx):u.x+u.size>l&&(u.x=l-u.size,u.dx=-u.dx),u.y<0?(u.y=0,u.dy=-u.dy):u.y+u.size>a&&(u.y=a-u.size,u.dy=-u.dy),u.rotation+=u.rotationSpeed*o,u.element.style.transform=`translate3d(${u.x}px, ${u.y}px, 0) rotate(${u.rotation}deg)`}}Bi=requestAnimationFrame(e)};Bi=requestAnimationFrame(e)}function Ih(){hh||(hh=!0,Je=sa(),ko(iS),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{Je=sa(),qr=0,Ft()||xf(),jn()}),window.addEventListener("currency:change",e=>{e.detail.key===Me.COINS&&jn()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Me.GEARS&&jn()}),window.addEventListener("debug:change",()=>{Je=sa(),jn()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Ft()||xf())})))}function _f(e){Ih(),!e.__workshopInit&&(e.__workshopInit=!0,Je=sa(),aa.clear(),Ef=-1,sS(e),typeof IntersectionObserver>"u"&&Sh(),Ft()||xf(),jn())}function Bl(){let e=sa();return Lf(e)}function Fl(){let e=O.coins.value.isInfinite(),n=rr(Je).isInfinite();if(e&&n&&!Je.isInfinite())return Je=c.fromAny("Infinity"),la(Je),jn(),!0;if(O.coins.value.isZero())return!1;let o=De(O.coins.value);if(!Number.isFinite(o))if(O.coins.value.inf)o=1/0;else return!1;if(ca(Je)>o||Je.cmp(9e15)>0)return!1;let r=Number(Je.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);ca(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(Je)>0&&la(a)?(Je=a,jn(),!0):!1}function lS(){if(O.coins.value.isInfinite()){Fl()&&Kt();return}let e=De(O.coins.value);if(!Number.isFinite(e)&&O.coins.value.isZero()||ca(Je)>e||Je.cmp(9e15)>0)return;let t=Number(Je.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);ca(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(Je.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(rr(c.fromInt(u)));if(l.cmp(O.coins.value)>0){let u=rr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(Je)>0&&la(a)&&(Je=a,O.coins.sub(l),jn(),Kt())}var bh,Kb,jb,bf,zt,hh,qr,Je,Ef,Bi,Sf,If,Gr,ra,Rl,gh,Oi,Zb,Jb,Qb,eS,tS,Ol,Pl,wf,aa,yh,nS,oS,ia,Fi=qe(()=>{Nt();Wt();bt();Ur();Ui();fo();mn();po();$r();bh="img/currencies/gear/gear.webp",Kb="img/currencies/gear/gear_plus_base.webp",jb="img/currencies/coin/coin.webp",bf=100,zt=null,hh=!1,qr=0,Je=c.zero(),Ef=-1,Bi=null,Sf=12,If=.3010299956639812,Gr=1e6,ra=1e9,Rl=1e12,gh=1,Oi=.001,Zb=1e3,Jb=Math.log10(1.00001),Qb=23e-11,eS=Math.log(10),tS=1/eS;Ol=null,Pl=null,wf=null;aa=new Map,yh=67,nS=67,oS=67;ia=0});var Mh={};yt(Mh,{getBookProductionRate:()=>ar,getSurge6WealthMultipliers:()=>Dl,getTsunamiNerf:()=>xt,getTsunamiNerfKey:()=>Mf,getTsunamiSequenceSeen:()=>hn,initSurgeEffects:()=>fS,isSurgeActive:()=>dt,setTsunamiNerf:()=>Di,setTsunamiSequenceSeen:()=>sr});function Mf(e){return Cf(e)}function hn(){let e=v();if(e==null)return!1;try{return localStorage.getItem(Ch(e))==="1"}catch{return!1}}function sr(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(Ch(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function xt(){return ir}function Di(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=v();if(n!=null){let o=Cf(n);if(nn(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}ir=t,fa();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function dt(e){return Zn===1/0||typeof Zn=="string"&&Zn==="Infinity"||Zn===Number.POSITIVE_INFINITY?!0:typeof Zn=="bigint"?Zn>=BigInt(e):typeof Zn=="number"?Zn>=e:!1}function ua(e){if(!dt(8))return e;let t=De(e);if(!Number.isFinite(t))return e;let n=xt();return Ne(t*n)}function fa(){let e=gn();Zn=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(dt(8)){let n=xt(),o=Math.log10(Eh);To=Ne(o*n)}else To=c.fromInt(Eh);else To=c.fromInt(1)}function Dl(){if(!dt(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,y=0)=>{if(!p){if(y<=0)return c.fromInt(1);let w=Math.log10(y)/3;if(w<=0)return c.fromInt(1);let N=w*Math.log10(2);return Ne(N)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=De(p),h=m;if(Number.isFinite(m)){if(m<15&&y>0)try{let L=Number(p.toPlainIntegerString());if(Number.isFinite(L)){let w=L+y;w>0&&(h=Math.log10(w))}}catch{}}else if(y>0)h=Math.log10(y);else return c.fromInt(1);let g=h/6;if(g<=0)return c.fromInt(1);let S=g*Math.log10(2);return Ne(S)},t=e(O.coins?.value),n=O.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(O.gold?.value),s=e(O.magic?.value),l=t,a=r,u=i,d=s;dt(8)&&(l=ua(t),a=ua(r),u=ua(i),d=ua(s));let f=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return f=f.mulBigNumInteger?f.mulBigNumInteger(u):f,f=f.mulBigNumInteger?f.mulBigNumInteger(d):f,{coins:l,books:a,gold:u,magic:d,total:f}}function ar(){if(!dt(3))return c.fromInt(0);let t=Ze().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(xh),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Ne(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*xh;n=Ne(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),O.books?.mult){let o=O.books.mult.get();n=n.mulBigNumInteger(o)}return dt(8)&&(n=ua(n)),n}function cS(e){if(!dt(3))return;Lh||(Lh=new Qs("books",O));let t=ar();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);O.books&&O.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,O.books&&O.books.add(c.fromInt(o))}}}function _h(e){if(e==null)return;let t=localStorage.getItem(Cf(e));t!==null?(ir=Number(t),(Number.isNaN(ir)||!Number.isFinite(ir))&&(ir=dt(8)?0:1)):dt(8)?ir=0:ir=1}function uS(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function fS(){let e=v();fa(),_h(e),fa(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=Zn,n=dt(8);fa();let o=Zn,r=dt(8);!n&&r?(Di(0),hn()||sr(!0)):r?uS(t,o)>0&&(Di(0),hn()||sr(!0)):n&&!r&&Di(1)}),window.addEventListener("saveSlot:change",()=>{_h(v()),fa()})),Or(({baseMultiplier:t})=>To.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(To)),Mi(({baseGain:t})=>To.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(To)),Xr(({baseGain:t})=>To.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(To)),Xr(({baseGain:t})=>{if(!dt(4))return t;let n=c.fromInt(4444e9);if(dt(8)){let o=xt(),r=Math.log10(4444e9);n=Ne(r*o)}return t.mulBigNumInteger(n)}),Or(({baseMultiplier:t})=>{if(!dt(6))return t;let n=Dl();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),kl(({baseReward:t})=>dt(3)?c.fromInt(0):t),ko(cS)}var Eh,xh,Cf,Ch,To,Zn,Lh,ir,Jn=qe(()=>{Nt();bt();Yn();mo();fo();Ur();mn();Eh=10,xh=.08685889638,Cf=e=>`ccc:surge:tsunamiNerf:${e}`,Ch=e=>`ccc:unlock:tsunami:${e}`;To=c.fromInt(1),Zn=0n,Lh=null,ir=0});var Ah={};yt(Ah,{calculateOfflineRewards:()=>$i,calculatePreAutomationRewards:()=>Gl,formatTimeCompact:()=>$l,grantOfflineRewards:()=>Vr,initOfflineTracker:()=>pS,processOfflineProgress:()=>Th,showOfflinePanel:()=>lr});function $l(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),S=g.mulBigNumInteger(l),L=t.sub(S),w=0;try{let N=L.div(c.fromInt(i)).floorToInteger();w=Number(N.toPlainIntegerString())}catch{w=0}return w===0?`${ne(g)}y`:`${ne(g)}y ${w}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let d=Math.floor(u/60),f=u%60;if(d<60)return f===0?`${d}m`:`${d}m ${f}s`;let p=Math.floor(d/60),y=d%60;if(p<24)return y===0?`${p}h`:`${p}h ${y}m`;let m=Math.floor(p/24),h=p%24;return h===0?`${m}d`:`${m}d ${h}h`}function lr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${$l(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let d=document.createElement("div");d.className="offline-list",dS.forEach(m=>{let h=m.key,g=e[h];if(!g||g.isZero())return;let S=document.createElement("div");S.className="offline-row";let L=document.createElement("span");L.className="offline-plus",L.classList.add(`text-${h}`),L.textContent="+";let w=document.createElement("img");w.className="offline-icon",w.src=m.icon,w.alt=h;let N=document.createElement("span");N.className="offline-text",N.classList.add(`text-${h}`);let T=!1;g instanceof c?T=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:T=Number(g)===1;let Y=T?m.singular:m.plural;N.innerHTML=`${ne(g)} ${Y}`,S.appendChild(L),S.appendChild(w),S.appendChild(N),d.appendChild(S)}),u.appendChild(d),a.appendChild(u);let f=document.createElement("div");f.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let y=()=>{r.remove()};return p.addEventListener("click",y),r.addEventListener("click",m=>{m.target===r&&y()}),f.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(f),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{Gi(i,a,".offline-scroll-container")}),r}function $i(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},i=(Bl?Bl():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();i.isZero()||Tn("gears",t)||(o.gears=i);let s=ar?ar():c.fromInt(0);if(!s.isZero()){let a=s.mulBigNumInteger(n).floorToInteger();a.isZero()||Tn("books",t)||(o.books=a)}let l=_t(Ke,Dr)||0;if(l>0){let a=1;dt(2)&&(a=10);let u=c.fromInt(l).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(a)).floorToInteger();if(!u.isZero()){let d=Hl(),f=d.coins.mulBigNumInteger(u),p=d.xp.mulBigNumInteger(u),y=d.mp.mulBigNumInteger(u);f.isZero()||Tn("coins",t)||(o.coins=f),p.isZero()||nn(`ccc:xp:progress:${t}`)||(o.xp=p),y.isZero()||nn(`ccc:mutation:progress:${t}`)||(o.mp=y)}}return o}function Vr(e){if(v()!=null){if(e.xp)try{let n=Ci(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Hi(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||O[n]&&typeof O[n].add=="function"&&O[n].add(e[n])}}function Gl(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=Pn(),i=c.fromInt(1);try{let l=qi(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof _o=="function"){let l=_o("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=Hl(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),d=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||nn(`ccc:xp:progress:${t}`)||(o.xp=u),d.isZero()||nn(`ccc:mutation:progress:${t}`)||(o.mp=d)}return o}function Th(){let e=v();if(e==null)return;let t=Gu(),n=Date.now();if(t<=0)return;if(n<t-1e4){un(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Ft()){let l=Gl(r),a=Object.keys(l).length>0;return a&&(Vr(l),lr(l,o,!0)),a}let i=$i(r),s=Object.keys(i).length>0;return s&&(Vr(i),lr(i,o)),s}function pS(e,t){kh||(kh=!0,document.addEventListener("visibilitychange",()=>{v()!=null&&(e&&!e()||(document.hidden?yf():(vf(),Th()&&typeof t=="function"&&t())))}))}var kh,dS,ql=qe(()=>{bt();Fi();fo();Ur();bt();Nt();Wt();Ui();po();mn();$r();da();Yn();mo();Jn();js();kh=!1;dS=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"}];window.createOfflinePanel=lr});function Af(e){let t=24,n=Date.now();try{let o=localStorage.getItem(kf(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Tf(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(kf(e),"24"),localStorage.setItem(Tf(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function Rh(e,t,n){try{localStorage.setItem(kf(e),String(t)),localStorage.setItem(Tf(e),String(n))}catch{}}function Oh(){let e=v();if(e==null)return;let{charges:t,lastCharge:n}=Af(e);if(t>=Xi)return;let o=Date.now(),r=o-n;if(r>=Xl){let i=Math.floor(r/Xl);t+=i,t>=Xi?(t=Xi,n=o):n+=i*Xl,Rh(e,t,n),cr&&cr.classList.contains("is-active")&&Ao(!0)}}function hS(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function gS(){let e=v();if(e==null)return;Oh();let{charges:t,lastCharge:n}=Af(e);t<=0||(t>=Xi&&(n=Date.now()-50),t--,Rh(e,t,n),Ao(!0),pa&&clearInterval(pa),pa=setInterval(()=>{Ao()},1e3),ut(mS,{volume:.5}),hS(),setTimeout(()=>{let o=$i(Nh);Vr(o),lr(o,Nh*1e3)},7250))}function Ao(e=!1){if(!cr||!cr.classList.contains("is-active"))return;let t=v();if(t==null)return;e||Oh();let{charges:n,lastCharge:o}=Af(t),r=cr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${Xi}</span>`);let i=cr.querySelector(".warp-timer");if(i)if(n>=Xi)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+Xl,u=Math.max(0,a-l);i.textContent=`Next warp in ${$l(u)}`}let s=cr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function Ph(e){if(!e||e.__warpInit)return;e.__warpInit=!0,cr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",gS),pa||(pa=setInterval(()=>{Ao()},1e3)),Ao()}var kf,Tf,Xi,Xl,Nh,mS,cr,pa,Nf=qe(()=>{bt();ql();kn();kf=e=>`ccc:warp:charges:${e}`,Tf=e=>`ccc:warp:lastCharge:${e}`,Xi=24,Xl=3600*1e3,Nh=150,mS="sounds/warp.ogg",cr=null,pa=null});var $h={};yt($h,{getLabCost:()=>Uh,getLabLevel:()=>ho,getLabLevelFromCoins:()=>Dh,getLabLevelKey:()=>Of,hasVisitedLab:()=>Vi,initLabLogic:()=>yS,initLabTab:()=>Bf,setLabLevel:()=>ha,setLabVisited:()=>Fh,updateLabLevel:()=>Pf,updateLabTab:()=>Ff});function Vi(){let e=v();if(e==null)return!1;try{return localStorage.getItem(Bh(e))==="1"}catch{return!1}}function Fh(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(Bh(t),n?"1":"0")}catch{}}function ho(){let e=v();if(e==null)return c.fromInt(0);if(O.coins.value.isInfinite())return c.fromAny("Infinity");try{let t=localStorage.getItem(Vl(e));return t?c.fromAny(t):c.fromInt(0)}catch{return c.fromInt(0)}}function ha(e){let t=v();if(t!=null)try{let n=c.fromAny(e),o=ho();if(n.cmp(o)===0)return;localStorage.setItem(Vl(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function Uh(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=29+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=29n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Dh(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),d=s-29n+BigInt(u);return d<0n?c.fromInt(0):c.fromInt(d)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-29;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Pf(){let e=v();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Vl(e)))return;let t=O.coins.value,n=ho();if(t.isInfinite()){n.isInfinite()||ha(c.fromAny("Infinity"));return}let o=Dh(t);o.cmp(n)>0&&ha(o)}function yS(){ko(Pf)}function Bf(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",ma&&ma.destroy(),ma=new Rf(e))}function Ff(){Fh(!0),ma&&ma.resize()}var Bh,Vl,Of,ma,Rf,Wl=qe(()=>{bt();po();Nt();Wt();Jn();Ur();Bh=e=>`ccc:lab:visited:${e}`,Vl=e=>`ccc:lab:level:${e}`;Of=e=>Vl(e);ma=null;Rf=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${ne(ho())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Pf()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami nerf exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#222",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #555",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.25,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.25,this.bursts=[],this.isDragging=!1,this.lastMouse={x:0,y:0},this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect();this.width=t.width,this.height=t.height,this.canvas.width=this.width,this.canvas.height=this.height,this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none"}update(t){this.checkBounds();let n=ho(),o=Uh(n.add(1)),r=xt();(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${ne(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${ne(o)}`,this.lastRenderedLevel=n,this.lastCost=o),r!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami nerf exponent: ^${r.toFixed(2)}`,this.lastRenderedNerf=r),this.coinsBar.style.borderColor="#000";for(let u=this.bursts.length-1;u>=0;u--){let d=this.bursts[u];d.time+=t;for(let f of d.particles)f.x+=f.vx*t,f.y+=f.vy*t,f.vx*=.95,f.vy*=.95;d.time>=d.life&&this.bursts.splice(u,1)}let s=500/this.zoom,l=0,a=0;if(this.keys.KeyW&&(a-=1),this.keys.KeyS&&(a+=1),this.keys.KeyA&&(l-=1),this.keys.KeyD&&(l+=1),l!==0||a!==0){let u=Math.sqrt(l*l+a*a);l/=u,a/=u,this.camX+=l*s*t,this.camY+=a*s*t}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),a=i*Math.pow(10,l),d=100/r,f=Math.floor(Math.log10(d)),p=Math.pow(10,f),y=(B,C)=>{if(C<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*C})`,t.lineWidth=1,t.beginPath();let U=Math.floor((this.camX-n/2/r)/B)*B,R=Math.ceil((this.camX+n/2/r)/B)*B;if((R-U)/B>1e3)return;for(let J=U;J<=R;J+=B){let ye=(J-this.camX)*r+n/2;t.moveTo(ye,0),t.lineTo(ye,o)}let _=Math.floor((this.camY-o/2/r)/B)*B,X=Math.ceil((this.camY+o/2/r)/B)*B;for(let J=_;J<=X;J+=B){let ye=(J-this.camY)*r+o/2;t.moveTo(0,ye),t.lineTo(n,ye)}t.stroke()},m=p*r,h=Math.max(0,Math.min(1,(m-15)/25));y(p,h),y(p*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let g=(0-this.camY)*r+o/2;g>=-10&&g<=o+10&&(t.moveTo(0,g),t.lineTo(n,g));let S=(0-this.camX)*r+n/2;S>=-10&&S<=n+10&&(t.moveTo(S,0),t.lineTo(S,o)),t.stroke();let w=50*r,N=(0-this.camX)*r+n/2-w/2,T=(0-this.camY)*r+o/2-w/2;t.fillStyle="#000000",t.fillRect(N,T,w,w),t.strokeStyle="#FFFFFF",t.lineWidth=1,t.strokeRect(N,T,w,w);let Y=35,D=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let B of this.bursts){let C=(B.x-this.camX)*this.zoom+n/2,U=(B.y-this.camY)*this.zoom+o/2;for(let R=0;R<D.length;R++){let _=D[R],X=B.time-_.delay;if(X>0&&X<_.dur){let J=X/_.dur,ye=1-Math.pow(1-J,3),j=Y*ye,ae=Math.max(0,1-Math.pow(J,2)),xe=1+R*.5,we=t.createRadialGradient(C,U,j*.6,C,U,j);we.addColorStop(0,"rgba(255, 200, 50, 0)"),we.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,ae*.15*xe)})`),we.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,ae*.2*xe)})`),we.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=we,t.beginPath(),t.arc(C,U,j,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let R of B.particles)if(B.time<R.life){let _=1-B.time/R.life,X=C+R.x,J=U+R.y;t.fillStyle=`rgba(255, 255, 150, ${_})`,t.beginPath(),t.arc(X,J,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}onMouseDown(t){t.button===0&&(this.isDragging=!0,this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(!this.isDragging)return;let n=t.clientX-this.lastMouse.x,o=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}onMouseUp(t){this.isDragging=!1}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<Number.MIN_VALUE&&(i=Number.MIN_VALUE),i>Number.MAX_VALUE&&(i=Number.MAX_VALUE);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,d=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=d-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY}):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches));for(let n=0;n<t.changedTouches.length;n++){let o=t.changedTouches[n];this.addBurstFromScreen(o.clientX,o.clientY)}}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<Number.MIN_VALUE&&(i=Number.MIN_VALUE),i>Number.MAX_VALUE&&(i=Number.MAX_VALUE);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,d=this.camX+(a-this.width/2)/r,f=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=d-(a-this.width/2)/i,this.camY=f-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?this.isDragging=!1:t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});function jh(){try{return localStorage.getItem(fr(Wf))==="1"}catch{return!1}}function zf(){try{return localStorage.getItem(fr(Zh))==="1"}catch{return!1}}function jl(e){let t=v();if(t==null)return;let n=`${Zh}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),vS()}catch{}}function Zl(){return zf()?"Jeff":"Merchant"}function vS(){let e=Zl();Ve&&Ve.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function ga(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&zn(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(S=>console.error(S)),n&&h()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,uo(160)))},d=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},f=()=>{r&&l()},p=g=>{r=!0,uo(160)},y=g=>{r&&l()},m=()=>{r&&l()},h=()=>{e.removeEventListener("click",a),Jh?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",f)):ES&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function Yl(e){return IS[e]??0}function Gh(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function xS(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function va(e,t){let n=Wr.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;Yi.set(e,r),n.unlocked=r;let i=yn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&yn.buttons[e]?.classList.contains("is-active")&&ec("dialogue")}function Uf(){let e=!1;try{e=!!ji?.()}catch{}va("reset",e)}function Df(){let e=!1;try{e=!!Ft?.()}catch{}va("workshop",e)}function Vh(){let e=!1;try{typeof go=="function"&&(e=go())}catch{}va("warp",e)}function LS(){let e=v();if(e==null)return!1;try{return typeof hn=="function"&&hn()?!0:localStorage.getItem(Qh(e))==="1"}catch{return!1}}function Hf(){va("lab",LS())}function _S(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function CS(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof rn=="function"&&rn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Ze=="function"?Ze():null;t&&typeof t=="object"&&(e.xpLevel=_S(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof pr=="function"&&pr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Ft=="function"&&Ft()}catch{e.hasInfuseReset=!1}return e}function MS(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?Gf:qf,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?Gf:qf),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Kf:""),i.icon=o?.icon??(r==="mysterious"?ur:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?No:SS),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function kS(){if(qh)return;qh=!0;let e=TS;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==v()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=v();if(t!=null){let n=`${wS}:${t}`;Lt(n,{onChange:e})}}function TS(){Ro()}function AS(e,t){let n=jf(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,eg(n),NS(t.reward),!0)}function NS(e){if(e){if(e.type==="coins"){try{O.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{O.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{O.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function RS(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function jf(){try{return JSON.parse(localStorage.getItem(fr(ya))||"{}")}catch{return{}}}function eg(e){let t=fr(ya);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{rt(t,n)}catch{}}catch{}}function OS(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function PS(){let e=Xf;if(Xf=null,typeof e=="function")try{e()}catch{}}function BS(e,t={}){t?.rawChanged&&Ro()}function $f(e){if(e===Wh)return;if(PS(),Wh=e??null,e==null){Ro();return}let t=`${ya}:${e}`;Xf=Lt(t,{parse:OS,onChange:BS});try{rt(t)}catch{}Ro()}function FS(){if(Hh){$f(v());return}Hh=!0,$f(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{$f(v())})}function mr(){Promise.resolve().then(()=>(kn(),cl)).then(({loadAudio:e})=>{e(tg)})}function US(){if(Wi)return;Wi=ut(tg,{volume:je?.15:.3,loop:!0})}function Po(){Wi&&(Wi.stop&&Wi.stop(),Wi=null)}function DS(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let L=0;L<t.length;L++){let w=t[L];w==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=w):w===">"&&l?(s+=w,i.push({type:"tag",content:s}),s="",l=!1):s+=w}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,d=!1,f=!1,p="";Oo=!0,US();let y=L=>{f&&(L.preventDefault(),d=!0)},m=L=>{f&&(L.key==="Enter"||L.key===" ")&&(d=!0)},h=o.length?o:[e];requestAnimationFrame(()=>{f=!0,h.forEach(L=>L.addEventListener("click",y,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{h.forEach(L=>L.removeEventListener("click",y)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),Po(),Oo=!1},S=()=>{if(d){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let L=i[a];L.type==="tag"?(p+=L.content,e.innerHTML=p,a++,S()):(p+=L.content[u],e.innerHTML=p,u++,u>=L.content.length&&(a++,u=0),setTimeout(S,n))};S()})}function $S(e={}){if(!Ve)return;mr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||No}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||ur}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,Ve.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||No,r.textContent=e.message||Kf,requestAnimationFrame(()=>t.classList.add("is-visible")),Ve.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),Po(),Oo=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=d=>{d.key==="Escape"&&(d.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",d=>{n.contains(d.target)||(d.preventDefault(),bn(160),l())});let u=d=>{(!d||d.pointerType!=="mouse")&&bn(160),l()};ga(i,()=>{u()},{once:!0}),i.focus?.()}function GS(e,t){mr();let n=t.scriptId;String(e)==="6"&&typeof Vi=="function"&&!Vi()&&(n=7),Mr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Zl()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${zi}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,Ve.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&f()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),Ve.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,d=()=>{Mr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),Po(),Oo=!1,o.remove()},f=()=>{u||(u=!0,d(),Ro())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&bn(160),f())});let p=new dr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,S)=>{t.scriptId===4&&g==="c4b"&&jl(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){Ro(),d();return}AS(e,t),Ro(),d()}}}),m=!!jf()[e]?.claimed,h=structuredClone(df[n]);m&&h.nodes.m2b&&h.nodes.c2a&&t.scriptId===1&&(h.nodes.m2b.say="I've already given you Coins, goodbye.",h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&h.nodes.m3a&&(h.nodes.m3a.say="I've already given you Books, goodbye.",h.nodes.c2a&&(h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&h.nodes.m5a&&(h.nodes.m5a.say="I've already given you Gold, goodbye.",h.nodes.c5a&&(h.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&h.nodes.m7a&&(h.nodes.m7a.say="I've already given you Magic, goodbye.",h.nodes.c7a&&(h.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(h),p.start()}function qS(){if(document.getElementById(zh))return;let e=document.createElement("style");e.id=zh,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function HS(){let e=Ve?.querySelector(".merchant-content");if(!e||e.__customScroll||!pt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),pt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){qS();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;pt.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let d=null,f=()=>{let R=(e.scrollTop||0)>0;d!==R&&(d=R,pt?.classList.toggle("has-scroll-shadow",R))},p=()=>{let R=Ve.querySelector(".merchant-grabber"),_=Ve.querySelector(".merchant-header"),X=Ve.querySelector(".merchant-actions"),J=(R?.offsetHeight||0)+(_?.offsetHeight||0)|0,ye=(X?.offsetHeight||0)|0;t.style.top=J+"px",t.style.bottom=ye+"px"},y={},m=()=>{let{scrollHeight:R,clientHeight:_,scrollTop:X}=e,J=t.clientHeight||e.clientHeight||1;if(y.scrollHeight===R&&y.clientHeight===_&&y.barH===J&&(u||y.scrollTop===X))return;y={scrollHeight:R,clientHeight:_,scrollTop:X,barH:J};let ye=_/Math.max(1,R),j=Math.max(28,Math.round(J*ye)),ae=Math.max(1,R-_),xe=Math.max(0,J-j);if(n.style.height=j+"px",u)n.style.setProperty("--thumb-y",`${xe}px`),n.style.setProperty("--thumb-x","0px");else{let we=Math.round(X/ae*xe);n.style.transform=`translateY(${we}px)`}t.style.display=R<=_+1?"none":""},h=()=>{p(),m(),f()},g=()=>{o&&(pt.classList.add("is-scrolling"),l&&clearTimeout(l))},S=R=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{pt.classList.remove("is-scrolling")},R))},L=()=>{m(),f(),o&&g(),s||S(r)},w=()=>S(r);e.addEventListener("scroll",L,{passive:!0}),s&&e.addEventListener("scrollend",w,{passive:!0});let N=new ResizeObserver(h);N.observe(e),window.addEventListener("resize",h),requestAnimationFrame(h);let T=!1,Y=0,D=0,B=R=>{T=!0,Y=R.clientY,D=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(R.pointerId)}catch{}R.preventDefault()},C=R=>{if(!T)return;let _=t.clientHeight||1,X=n.clientHeight||1,J=Math.max(1,_-X),ye=Math.max(1,e.scrollHeight-e.clientHeight),ae=(R.clientY-Y)/J*ye;e.scrollTop=D+ae},U=R=>{if(T){T=!1,n.classList.remove("dragging"),S(i);try{n.releasePointerCapture(R.pointerId)}catch{}}};n.addEventListener("pointerdown",B),window.addEventListener("pointermove",C,{passive:!0}),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),t.addEventListener("pointerdown",R=>{if(R.target===n)return;let _=t.getBoundingClientRect(),X=R.clientY-_.top,J=t.clientHeight||1,ye=n.clientHeight||1,j=Math.max(0,J-ye),ae=Math.max(0,Math.min(X-ye/2,j)),xe=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ae/Math.max(1,j)*xe,g(),S(r)}),e.__customScroll={bar:t,thumb:n,ro:N,updateAll:h},h()}function XS(){if(Ve)return;Ve=document.createElement("div"),Ve.className="merchant-overlay",Ve.id="merchant-overlay",Ve.setAttribute("inert",""),pt=document.createElement("div"),pt.className="merchant-sheet",pt.setAttribute("role","dialog"),pt.setAttribute("aria-modal","false"),pt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",Uf(),Df(),Vh(),Hf(),Wr.forEach(y=>{y.key==="dialogue"&&Yi.set("dialogue",!0);let m=Yi.get(y.key),h=m??!!y.unlocked,g=document.createElement("button");g.type="button",g.className="merchant-tab",g.dataset.tab=y.key;let S=y.lockedLabel||"???";g.textContent=h?y.label:S,h?g.title=y.label||"Tab":(g.classList.add("is-locked"),g.disabled=!0,g.title="???"),y.unlocked=h,Yi.set(y.key,h),ga(g,L=>{if(g.disabled){L?.preventDefault?.();return}ec(y.key)}),o.appendChild(g),yn.buttons[y.key]=g}),yn.panels.dialogue=i,yn.panels.reset=s,yn.panels.workshop=l,yn.panels.warp=a,yn.panels.lab=u,yn.tablist=o,r.append(i,s,l,a,u),n.append(o,r),Uf(),Df();try{Bo()}catch{}try{Zf(s)}catch{}try{We()}catch{}try{_f(l)}catch{}try{Ph(a)}catch{}try{Bf(u)}catch{}if(!Xh&&typeof window<"u"){let y=m=>{let{key:h,slot:g}=m?.detail??{};g!=null&&g!==v()||((h==="forge"||!h)&&Uf(),(h==="infuse"||!h)&&Df(),(h==="surge_completed"||!h)&&Vh(),(h==="lab"||h==="tsunami"||!h)&&Hf())};window.addEventListener("unlock:change",y,{passive:!0}),window.addEventListener("saveSlot:change",y,{passive:!0}),Xh=!0}let d=document.createElement("div");d.className="merchant-actions";let f=document.createElement("button");f.type="button",f.className="merchant-close",f.textContent="Close",zl=f,d.appendChild(f);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${zi}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,pt.append(e,t,n,d,p),Ve.appendChild(pt),document.body.appendChild(Ve),VS(),HS(),Yh||(Yh=!0,ga(f,()=>{Ql()},{once:!1}),document.addEventListener("keydown",KS),e.addEventListener("pointerdown",jS),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),Ve.addEventListener("pointerdown",mr,{once:!0}))}function VS(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,kS(),Ro()}function WS(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?GS(n.id,n.meta):n.isMysterious&&$S(n.lockInfo)}}function Ro(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=CS(),o=jf(),r=!1,i=new Set;Object.entries(Jl).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",d=Yl(u),f=MS(l,n),p=f.status,y=Yl(p);if(y>d)a.status=p,p==="mysterious"?a.lockSnapshot=Gh(f):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(y<d){if(u==="unlocked")f=xS(l),p="unlocked",y=Yl(p);else if(u==="mysterious"){let R=a.lockSnapshot||Gh(f)||{};f={status:"mysterious",unlocked:!1,title:R.title??f.title??"???",blurb:R.blurb??f.blurb??Gf,tooltip:R.tooltip??f.tooltip??"Hidden Dialogue",message:R.message??f.message??Kf,icon:R.icon??f.icon??ur,headerTitle:R.headerTitle??f.headerTitle??No,ariaLabel:R.ariaLabel??f.ariaLabel??"Hidden merchant dialogue"},p="mysterious",y=Yl(p)}}let m=p==="unlocked",h=p==="mysterious",g=p==="locked",S=!!a.claimed,L=m&&!!(l.once&&S),w=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!w){w=document.createElement("button"),w.type="button",w.className="dlg-card",w.dataset.dlgId=String(s);let R=document.createElement("div");R.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let X=document.createElement("div");X.className="dlg-reward",w.append(R,_,X),t.appendChild(w),ga(w,WS)}w._dlgCtx={id:s,meta:l,lockInfo:f,unlocked:m,isMysterious:h},w.dataset.dlgStatus=p,w.disabled!==!!g&&(w.disabled=!!g),w.classList.toggle("is-locked",g),w.classList.toggle("is-mysterious",h),w.classList.toggle("is-complete",!!L),w.classList.toggle("has-again",!!L),g?(w.getAttribute("aria-disabled")!=="true"&&w.setAttribute("aria-disabled","true"),w.getAttribute("tabindex")!=="-1"&&w.setAttribute("tabindex","-1")):(w.hasAttribute("aria-disabled")&&w.removeAttribute("aria-disabled"),w.hasAttribute("tabindex")&&w.removeAttribute("tabindex"));let N=w.querySelector(".dlg-title"),T=m?l.title:f.title??"???";N.textContent!==T&&(N.textContent=T);let Y=w.querySelector(".dlg-blurb"),D=m?l.blurb:f.blurb??"";Y.textContent!==D&&(Y.textContent=D);let B=w.querySelector(".dlg-reward");if(m&&l.reward){let R=bS[l.reward.type];if(R){B.classList.contains("has-reward")||(B.classList.add("has-reward"),B.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),B.style.getPropertyValue("--reward-icon")!==`url('${R}')`&&B.style.setProperty("--reward-icon",`url('${R}')`);let _=B.querySelector(".amt"),X=String(l.reward.amount);_&&_.textContent!==X&&(_.textContent=X);let J=B.querySelector(".currency-name");if(J){let j=String(l.reward.type||""),ae=j.charAt(0).toUpperCase()+j.slice(1);J.textContent!==ae&&(J.textContent=ae)}let ye=`Reward: ${l.reward.amount} ${l.reward.type}`;B.getAttribute("aria-label")!==ye&&B.setAttribute("aria-label",ye)}else{B.classList.remove("has-reward");let _=RS(l.reward);B.textContent!==_&&(B.textContent=_),B.style.display!==""&&(B.style.display=""),B.removeAttribute("aria-label")}B.style.display==="none"&&(B.style.display="")}else B.textContent!==""&&(B.textContent=""),B.style.display!=="none"&&(B.style.display="none");let C=m?`${l.title}${L?" (completed)":""}`:f.ariaLabel||(h?"Hidden merchant dialogue":"Locked merchant dialogue");if(w.getAttribute("aria-label")!==C&&w.setAttribute("aria-label",C),f.tooltip)w.title!==f.tooltip&&(w.title=f.tooltip);else if(m){let R="Left-click: Start Dialogue";w.title!==R&&(w.title=R)}else w.hasAttribute("title")&&w.removeAttribute("title");let U=w.querySelector(".dlg-again");L?U||(U=document.createElement("div"),U.className="dlg-again",U.textContent="Ask Again?",w.appendChild(U)):U&&U.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&eg(o)}function YS(){let e=Ve.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Mr(!0);let i=new dr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Mr(!1);try{localStorage.setItem(fr(Wf),"1")}catch{}try{window.dispatchEvent(new Event(Yf))}catch{}e.classList.remove("is-visible"),Ve.classList.remove("firstchat-active")}});i.load(df[0]),i.start()}function zS(){if(!Ve)return;let e=Ve.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),Ve.classList.remove("firstchat-active")}function ng(){if(XS(),Ki)return;let e=document.activeElement;e instanceof HTMLElement&&!Ve.contains(e)?Kl=e:Kl=null,Ki=!0;let t=v(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(Qh(t),"1")}catch{}Hf();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(fr(Wf))==="1"}catch{o=!1}o||Ve.classList.add("firstchat-instant"),pt.style.transition="none",pt.style.transform="",Ve.removeAttribute("inert"),pt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ve.classList.contains("firstchat-instant")||(pt.style.transition=""),Ve.classList.add("is-open"),bn(140),zl&&typeof zl.focus=="function")try{zl.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(fr(Kh))||"dialogue"}catch{}n&&(r="dialogue"),ec(r),Po(),o||(Ve.querySelector(".merchant-firstchat")?.classList.add("is-visible"),Ve.classList.add("firstchat-active"),YS())})})}function Ql(){if(!Ki)return;if(Mr(!1),je){try{uo(100)}catch{}try{bn(80)}catch{}}Ki=!1,pt.style.transition="",pt.style.transform="",Ve.classList.remove("is-open"),Ve.classList.remove("firstchat-instant"),zS();let e=document.activeElement;if(e&&Ve.contains(e)){let t=Kl;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}Ve.setAttribute("inert",""),Kl=null,Po(),Oo=!1}function KS(e){if(Ki&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<Wr.length;i++)Yi.get(Wr[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<Wr.length&&(e.preventDefault(),ec(Wr[r].key))}}function jS(e){if(!Ki)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;vn={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},pt.style.transition="none",window.addEventListener("pointermove",og,{passive:!0}),window.addEventListener("pointerup",rg),window.addEventListener("pointercancel",ig)}function og(e){if(!vn||vn.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-vn.startY);vn.lastY=t,vn.moved=n,pt.style.transform=`translateY(${n}px)`}function rg(){if(!vn||vn.canceled){Vf();return}let e=Math.max(1,performance.now()-vn.startT),t=vn.moved;t/e>.55&&t>40||t>140?(uo(160),pt.style.transition="transform 140ms ease-out",pt.style.transform="translateY(100%)",setTimeout(()=>{Ql()},150)):(pt.style.transition="transform 180ms ease",pt.style.transform="translateY(0)"),Vf()}function ig(){vn&&(vn.canceled=!0,pt.style.transition="transform 180ms ease",pt.style.transform="translateY(0)",Vf())}function Vf(){window.removeEventListener("pointermove",og),window.removeEventListener("pointerup",rg),window.removeEventListener("pointercancel",ig),vn=null}function ec(e){let t=Wr.find(o=>o.key===e),n=Yi.get(e);(!t||!n)&&(e="dialogue");for(let o in yn.buttons)yn.buttons[o].classList.toggle("is-active",o===e);for(let o in yn.panels)yn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Ro()}catch{}if(e==="warp")try{Ao()}catch{}if(e==="lab"){typeof Vi=="function"&&!Vi()&&ZS();try{Ff()}catch{}}try{localStorage.setItem(fr(Kh),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=Ve?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function ba(e=[]){e.forEach(t=>va(t,!0))}function sg(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${zi}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");mr();let u=y=>{y.key==="Escape"&&(y.stopImmediatePropagation(),y.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let d=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{f()},5e3)},15e3)},1e3)},f=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${zi}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let y=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),h=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),S={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},L=new dr({textEl:y,choicesEl:m,skipTargets:[y,h,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),Po(),Oo=!1,r.remove(),t&&t()},5e3)}});L.load(S),L.start()},p=new dr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",Po(),Oo=!1,n&&n.hideCursor&&n.hideCursor(),d()}});p.load(o),p.start()}function ZS(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Zl()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${zi}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");mr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"What???",to:"end_nr"},{label:"Tsunami sacrifice???",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new dr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{Po(),Oo=!1,e.remove()}});s.load(i),s.start()}function ag(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Zl()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${zi}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");mr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new dr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{Po(),Oo=!1,t.remove(),e&&e()}});l.load(s),l.start()}var zi,Wf,Kh,ya,Yf,fr,Zh,Wr,Yi,bS,ur,No,SS,Gf,qf,Kf,IS,wS,Jh,ES,qh,Hh,Xh,Qh,Wh,Xf,Jl,Ve,pt,zl,Ki,vn,Kl,Yh,yn,tg,Wi,Oo,dr,zh,tc=qe(()=>{bt();Nt();dh();Yn();fo();Fi();Nf();Wl();Jn();Ui();Ti();po();kn();zi="img/misc/merchant.webp",Wf="ccc:merchantMet",Kh="ccc:merchantTab",ya="ccc:merchant:dlgState",Yf="ccc:merchant:met",fr=e=>`${e}:${v()}`;Zh="ccc:unlock:jeff";Wr=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],Yi=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),bS={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},ur="img/misc/mysterious.webp",No="Hidden Dialogue",SS="Locked Dialogue",Gf="Hidden Dialogue",qf="Locked",Kf="Locked Dialogue",IS={locked:0,mysterious:1,unlocked:2},wS="ccc:reset:forge:completed",Jh=typeof window<"u"&&"PointerEvent"in window,ES=!Jh&&typeof window<"u"&&"ontouchstart"in window;qh=!1,Hh=!1,Xh=!1;Qh=e=>`ccc:unlock:lab:${e}`;Wh=null,Xf=null;Jl={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:ur,headerTitle:No,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:qf,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:ur,headerTitle:No,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof go=="function"&&go()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:ur,headerTitle:No,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof hn=="function"&&hn())return!0;let t=typeof gn=="function"?gn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof go=="function"&&go()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:ur,headerTitle:No,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:ur,headerTitle:No,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};FS();Ve=null,pt=null,zl=null,Ki=!1,vn=null,Kl=null,Yh=!1,yn={buttons:{},panels:{},tablist:null},tg="sounds/merchant_typing.ogg",Wi=null,Oo=!1;dr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await DS(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=ga(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};zh="ccc-scroll-timeline-styles"});var cg={};yt(cg,{getAutobuyerToggle:()=>Yr,initAutomationEffects:()=>nI,setAutobuyerToggle:()=>hr,updateAutomation:()=>lg});function Qf(e){oc!==e&&(Zi.clear(),oc=e)}function Yr(e,t){let n=v();Qf(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(Zi.has(r))return Zi.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return Zi.set(r,i),i}function hr(e,t,n){let o=v();Qf(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);Zi.set(i,s);try{localStorage.setItem(i,s)}catch{}}function JS(e){lg(e),tI(e)}function QS(){if(nc)return nc;let e=Bt(Ee.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return nc=t,nc}function eI(e){if(!(!e||e.length===0)){for(let t of e)if(Yr(Ee.STARTER_COVE,t.id)!=="0"){let o=_t(Ee.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&td(Ee.STARTER_COVE,t.id)}}}function tI(e){let t=v();Qf(t);let n=QS();for(let[r,i]of Object.entries(Ri)){let s=Number(r);_t(Ke,s)>0&&n[i]&&eI(n[i])}_t(Ke,Kn)>0&&(Jf++,Jf>=5&&(Jf=0,Yr(Ke,Kn)!=="0"&&Fl()))}function lg(e){let n=_t(Ke,Dr);if(n<=0){Sa=0;return}Sa+=e;let o=1/n;if(Sa>=o){let r=Math.floor(Sa/o);if(r>0){let i=r;if(dt(2))if(dt(8)){let s=xt();i*=Math.pow(10,s)}else i*=10;ed(i),Sa-=r*o}}}function nI(){ko(JS),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==oc&&(Zi.clear(),oc=t)})}var Sa,Jf,Zi,oc,nc,rc=qe(()=>{Ur();mn();da();$r();Fi();bt();Jn();Sa=0,Jf=0,Zi=new Map,oc=null;nc=null});function gg(e){if(!e||!e.costType)return!1;let t=aI[e.costType];return!t||_t(Ke,t)<=0?!1:Yr(e.area,e.id)!=="0"}function nd(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function sc(e,t){return t==="standard"&&nd(e)===sI}function dg(e){let t=Bt(e),n={};for(let o of t){let r=Sn(e,o.id),i=_t(e,o.id),s=Fo(e,o.id),l=s.iconOverride??pc(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,d=!!s.locked,f=o.upgType==="HM"?!!Ea(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:d,lockState:s,useLockedBase:!!s.useLockedBase||d,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:f}}return n}function yg(e){return pg[e]||pg.standard}function bn(e=140){if(!je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function lc(e){return String(e??"").replace(/<[^>]*>/g,"")}function ic(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function Kt(){ut(cI,{volume:je?vg:bg})}function Sg(){let e=je?vg*2:bg*2;ut(uI,{volume:e})}function fI(e){return`<img alt="" src="${fg[e]||fg.coins}" class="currency-ico">`}function pI(){if(document.getElementById(mg))return;let e=document.createElement("style");e.id=mg,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function Gi(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,d=150,f=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){pI();let ae=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=ae,s.style.scrollTimelineName=ae,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=ae,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let h=null,g=()=>{let ae=((i?s.scrollTop:s.scrollLeft)||0)>0;h!==ae&&(h=ae,t?.classList.toggle("has-scroll-shadow",ae))},S=()=>{if(!s.isConnected||!t.isConnected)return;let j=s.getBoundingClientRect(),ae=t.getBoundingClientRect();if(i){let xe=Math.max(0,j.top-ae.top),we=Math.max(0,ae.bottom-j.bottom);l.style.top=xe+"px",l.style.bottom=we+"px",l.style.left="",l.style.right=""}else{let xe=Math.max(0,j.left-ae.left),we=Math.max(0,ae.right-j.right);l.style.left=xe+"px",l.style.right=we+"px",l.style.top="",l.style.bottom="",l.style.height=""}},L={},w=()=>{let j=i?s.scrollHeight:s.scrollWidth,ae=i?s.clientHeight:s.clientWidth,xe=i?s.scrollTop:s.scrollLeft,we=i?l.clientHeight||ae:l.clientWidth||ae;if(L.scrollSize===j&&L.clientSize===ae&&L.barSize===we&&(m||L.scrollPos===xe))return;L={scrollSize:j,clientSize:ae,scrollPos:xe,barSize:we};let z=ae/Math.max(1,j),oe=Math.max(28,Math.round(we*z)),$=Math.max(1,j-ae),G=Math.max(0,we-oe);if(i?(a.style.height=oe+"px",a.style.width="100%"):(a.style.width=oe+"px",a.style.height="100%"),m)i?(a.style.setProperty("--thumb-y",`${G}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${G}px`),a.style.setProperty("--thumb-y","0px"));else{let ue=Math.round(xe/$*G);i?a.style.transform=`translateY(${ue}px)`:a.style.transform=`translateX(${ue}px)`}let Z=j>ae+1;l.style.display=Z?"":"none",t?.classList.toggle("has-active-scrollbar",Z)},N=()=>{S(),w(),g()};typeof MutationObserver<"u"&&new MutationObserver(()=>N()).observe(s,{childList:!0,subtree:!0,characterData:!0});let T=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},Y=j=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},j))},D=()=>{w(),g(),u&&T(),p||Y(d)},B=()=>Y(d);s.addEventListener("scroll",D,{passive:!0}),p&&s.addEventListener("scrollend",B,{passive:!0}),new ResizeObserver(N).observe(s),window.addEventListener("resize",N),requestAnimationFrame(N);let U=!1,R=0,_=0,X=j=>{U=!0,R=i?j.clientY:j.clientX,_=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),T();try{a.setPointerCapture(j.pointerId)}catch{}j.preventDefault()},J=j=>{if(!U)return;let ae=i?l.clientHeight:l.clientWidth,xe=i?a.clientHeight:a.clientWidth,we=Math.max(1,ae-xe),z=i?s.scrollHeight:s.scrollWidth,oe=i?s.clientHeight:s.clientWidth,$=Math.max(1,z-oe),Z=(i?j.clientY:j.clientX)-R,ue=_+Z/we*$;i?s.scrollTop=ue:s.scrollLeft=ue},ye=j=>{if(U){U=!1,a.classList.remove("dragging"),Y(f);try{a.releasePointerCapture(j.pointerId)}catch{}}};a.addEventListener("pointerdown",X),window.addEventListener("pointermove",J,{passive:!0}),window.addEventListener("pointerup",ye),window.addEventListener("pointercancel",ye),l.addEventListener("pointerdown",j=>{if(j.target===a)return;let ae=l.getBoundingClientRect(),xe=i?j.clientY-ae.top:j.clientX-ae.left,we=i?a.clientHeight:a.clientWidth,z=i?l.clientHeight:l.clientWidth,oe=Math.max(0,z-we),$=Math.max(0,Math.min(xe-we/2,oe)),G=i?s.scrollHeight:s.scrollWidth,Z=i?s.clientHeight:s.clientWidth,ue=Math.max(1,G-Z),fe=$/Math.max(1,oe)*ue;i?s.scrollTop=fe:s.scrollLeft=fe,T(),Y(d)}),N()}function hg(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let d=BigInt(a)-BigInt(u);return d>0n?c.fromAny(d.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function mI(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let f=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(f)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=O[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let f=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return f&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):hg(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let f=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),y=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(y));if(f.cmp(p)===0&&f.cmp(m)===0){let g=hg(e,o,r),S=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,L=0,w=Math.max(0,S);for(;L<w;){let N=Math.floor((L+w+1)/2),T=c.fromInt(N);(typeof f.mulBigNumInteger=="function"?f.mulBigNumInteger(T):c.fromAny(f??0).mulBigNumInteger(T)).cmp(a)<=0?L=N:w=N-1}return c.fromInt(L)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:d}=zr(e,o,a,u,{fastOnly:!0});return d??c.fromInt(0)}function Ul(e="standard"){(uc[e]||uc.standard).open()}function Ig(e=!1){Object.values(uc).forEach(t=>t.close(e))}function gr(e=!1){Object.values(uc).forEach(t=>t.update(e))}function hI(){if(jt)return;jt=document.createElement("div"),jt.className="upg-overlay",it=document.createElement("div"),it.className="upg-sheet",it.setAttribute("role","dialog"),it.setAttribute("aria-modal","false"),it.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",it.append(e,t,n,o,r),jt.appendChild(it),document.body.appendChild(jt),jt.addEventListener("pointerdown",u=>{je&&u.pointerType!=="mouse"&&u.target===jt&&(u.preventDefault(),u.stopPropagation())},!0),jt.addEventListener("click",u=>{je&&u.target===jt&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!fc)return;let d=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:d,lastY:d,moved:0},it.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let d=u.clientY;if(typeof d!="number")return;let f=Math.max(0,d-i.startY);i.lastY=d,i.moved=f,it.style.transform=`translateY(${f}px)`}function a(u){if(!i)return;let d=i.moved>140;if(it.style.transition="transform 160ms ease",it.style.transform=d?"translateY(100%)":"translateY(0)",d){if(je&&(!u||u.pointerType!=="mouse"))try{bn(120)}catch{}setTimeout(wg,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function wg(){if(je)try{bn(160)}catch{}if(typeof ac=="function"){let e=ac;ac=null;try{e()}catch{}}fc=!1,!(!jt||!it)&&(it.style.transition="",it.style.transform="",jt.classList.remove("is-open"),jt.style.pointerEvents="none")}function gI(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let d=document.createElement("li"),f=document.createElement("span");f.className="hm-milestone-text",u&&typeof u=="object"?(f.textContent=u.text??"",u.achieved&&d.classList.add("hm-milestone-achieved")):f.textContent=u,d.appendChild(f),i.appendChild(d)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function yI(e,t="standard"){hI(),fc=!0;let n=!0,o=yg(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){fc=!1;return}let l=e.upgType==="HM",a=e.tie===Se.ENDLESS_XP;function u(m,h,g="div"){let S=h.split(" ").filter(N=>N.length>0),L=null,w=[];for(let N=0;N<m.children.length;N++){let T=m.children[N];g&&T.tagName.toLowerCase()!==g.toLowerCase()||S.every(Y=>T.classList.contains(Y))&&(L?w.push(T):L=T)}return w.forEach(N=>N.remove()),L||(L=document.createElement(g),L.className=h,m.appendChild(L)),L}let d=m=>{let h=document.createElement("div");return h.className="upg-line",h.innerHTML=m,h},f=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let h=m.lockState||o.getLockState(e.id),g=!!h?.locked,S=g&&(h?.hidden||h?.hideEffect||h?.hideCost),L=!!m.unlockUpgrade&&!S;it.classList.toggle("is-locked-hidden",S);let w=it.querySelector(".upg-header"),N=u(w,"upg-title");N.textContent!==(m.displayTitle||m.upg.title)&&(N.textContent=m.displayTitle||m.upg.title);let T=!!m.hmReadyToEvolve,Y=T?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,D=u(w,"upg-level"),B=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??ne(m.lvlCapBn),C=m.lvlCapFmtText??m.upg.lvlCapFmtText??lc(B),U=T?`Level ${m.lvlFmtHtml} / ${B} (EVOLVE READY)`:Y?`Level ${m.lvlFmtHtml} / ${B} (MAXED)`:`Level ${m.lvlFmtHtml} / ${B}`,R=lc(U);D.innerHTML!==U&&(D.innerHTML=U),D.getAttribute("aria-label")!==R&&D.setAttribute("aria-label",R),D.hidden=S,S||D.removeAttribute("aria-hidden"),it.classList.toggle("is-maxed",Y),it.classList.toggle("hm-evolve-ready",T),it.classList.toggle("is-unlock-upgrade",L),it.classList.toggle("is-hm-upgrade",l&&!S),it.classList.toggle("is-endless-xp",a),it.classList.toggle("is-magnet-upgrade",e.tie===Se.MAGNET),it.classList.toggle("is-no-effect",!m.effect);let _=w.querySelector(".auto-toggle-wrapper"),X=t==="automation"?Ri[e.id]:null,J=t==="automation"&&e.id===Kn,ye=!!X,j=t==="standard"?lI[e.costType]:null,ae=0;j?ae=_t(Ke,j):(ye||J)&&(ae=_t(Ke,e.id));let we=ae>0&&(ye||j||J)&&!S;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",w.appendChild(_));let z=_.querySelector("button");if(z||(z=document.createElement("button"),z.type="button",z.style.padding="10px 14px",z.style.fontSize="16px",z.style.width="auto",z.style.minWidth="180px",z.addEventListener("click",re=>{typeof z._onClick=="function"&&z._onClick(re)}),_.appendChild(z)),we){z.style.visibility="",z.style.pointerEvents="auto";let re=v(),ve=re!=null?`:${re}`:"",Ae=!0;if(ye){let _e=`ccc:autobuy:master:${X}${ve}`,Re=Bt(Ee.STARTER_COVE),ie=!1;for(let Q of Re)if(Q.costType===X){let be=`ccc:autobuy:${Q.area}:${Q.id}${ve}`;if(Yr(Q.area,Q.id)!=="0"){ie=!0;break}}Ae=ie}else Ae=Yr(e.area,e.id)!=="0";Ae?(z.className="shop-delve",z.textContent="Automation: ON",z.style.backgroundColor=""):(z.className="shop-close",z.textContent="Automation: OFF",z.style.backgroundColor=""),z._onClick=_e=>{_e.preventDefault(),_e.stopPropagation(),je&&bn(50);let ie=!Ae?"1":"0";ye?(localStorage.setItem(`ccc:autobuy:master:${X}${ve}`,ie),Bt(Ee.STARTER_COVE).forEach(be=>{be.costType===X&&hr(be.area,be.id,ie)})):hr(e.area,e.id,ie),p()}}else z.style.visibility="hidden",z.style.pointerEvents="none",z.className="shop-delve",z.textContent="Automation: ON",z._onClick=null;let oe=it.querySelector(".upg-content");f&&(oe.scrollTop=0,f=!1);let $=u(oe,"upg-desc centered");$.classList.toggle("lock-desc",S);let G=(m.displayDesc||m.upg.desc||"").trim();T?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):G?($.classList.remove("hm-evolve-note"),$.textContent!==G&&($.textContent=G),$.hidden=!1):$.hidden=!0;let Z=u(oe,"upg-info"),ue=null,fe=re=>{ue?ue.nextElementSibling!==re&&Z.insertBefore(re,ue.nextSibling):Z.firstElementChild!==re&&Z.prepend(re),ue=re};if(g&&h?.reason&&!S){let re=(m.displayDesc||"").trim(),ve=String(h.reason??"").trim();if(re!==ve){let Ae=Z.querySelector(".lock-wrapper");if(!Ae){Ae=document.createElement("div"),Ae.className="lock-wrapper";let ie=document.createElement("div");ie.className="upg-line lock-note",Ae.append(ie)}let _e=Array.from(Ae.children);for(let ie of _e)ie.tagName==="DIV"&&!ie.className&&ie.style.height==="12px"&&ie.remove();let Re=Ae.querySelector(".lock-note");Re.textContent!==h.reason&&(Re.textContent=h.reason),fe(Ae)}else{let Ae=Z.querySelector(".lock-wrapper");Ae&&Ae.remove()}}else{let re=Z.querySelector(".lock-wrapper");re&&re.remove()}if(m.effect&&!(g&&h?.hideEffect)){let re=Z.querySelector(".effect-wrapper");if(!re){re=document.createElement("div"),re.className="effect-wrapper";let Re=document.createElement("div");Re.className="upg-line",re.append(Re)}let ve=Array.from(re.children);for(let Re of ve)Re.tagName==="DIV"&&!Re.className&&Re.style.height==="12px"&&Re.remove();let Ae=re.querySelector(".upg-line"),_e=`<span class="bonus-line">${m.effect}</span>`;Ae.innerHTML!==_e&&(Ae.innerHTML=_e),fe(re)}else{let re=Z.querySelector(".effect-wrapper");re&&re.remove()}let x=fI(m.upg.costType),V=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),le=Y||T;if(!m.unlockUpgrade&&!le&&(!g||!h?.hideCost)){let re=u(Z,"upg-costs");fe(re);let ve=ic(m.upg.costType,V),Ae=`Cost: ${x} ${O[m.upg.costType].fmt(V)} ${ve}`,_e=u(re,"cost-line","div");if(_e.className.includes("upg-line")||(_e.className="upg-line cost-line"),_e.innerHTML!==Ae&&(_e.innerHTML=Ae),l){let be=u(re,"milestone-line","div");be.className.includes("upg-line")||(be.className="upg-line milestone-line");let I="\u2014",H="",W=gg(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(W){let se=m.hmNextMilestone.sub(c.fromInt(1)),$e=0;try{let ge=se.toPlainIntegerString?.();ge&&ge!=="Infinity"?$e=Number(ge):$e=Number(se.toString())}catch{$e=0}let tt=c.fromInt(0);try{tt=c.fromAny(m.upg.costAtLevel($e))}catch{}I=O[m.upg.costType].fmt(tt),H=ic(m.upg.costType,tt)}else{let se=m.hmNextMilestone.sub(m.lvlBn),$e=se.toPlainIntegerString?.(),tt=Math.max(0,Math.floor(Number($e&&$e!=="Infinity"?$e:Number(se.toString()||0)))),{spent:ge}=zr(m.upg,m.lvlBn,c.fromAny("Infinity"),tt);I=O[m.upg.costType].fmt(ge),H=ic(m.upg.costType,ge)}}catch{}let pe=`${W?"Cost at next milestone:":"Cost to next milestone:"} ${x} ${I} ${H}`;be.innerHTML!==pe&&(be.innerHTML=pe)}else{let be=re.querySelector(".milestone-line");be&&be.remove()}let Re=ic(m.upg.costType,m.have),ie=`You have: ${x} ${O[m.upg.costType].fmt(m.have)} ${Re}`,Q=u(re,"have-line","div");Q.className.includes("upg-line")||(Q.className="upg-line have-line"),Q.innerHTML!==ie&&(Q.innerHTML=ie)}else{let re=Z.querySelector(".upg-costs");re&&re.remove()}let me=it.querySelector(".upg-milestones"),K=me.querySelector(".hm-view-milestones-row");if(!K){K=document.createElement("div"),K.className="hm-view-milestones-row";let re=document.createElement("button");re.type="button",re.className="shop-delve hm-view-milestones",re.textContent="View Milestones",re.addEventListener("click",ve=>{re._onClick&&re._onClick(ve)}),K.appendChild(re),me.appendChild(K)}let te=K.querySelector("button");l&&!S?(te.style.visibility="",te.style.pointerEvents="auto",te._onClick=()=>{let re=Array.isArray(m.hmMilestones)?m.hmMilestones:[],ve=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Ae=(()=>{try{return BigInt(Ut)*BigInt(ve)}catch{return 0n}})(),_e=re.sort((Re,ie)=>Number(Re?.level||0)-Number(ie?.level||0)).map(Re=>{let ie=Math.max(0,Math.floor(Number(Re?.level||0))),Q=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ie)+Ae).toString())}catch{return c.fromAny(ie+Ut*ve)}})(),be=Q?.isInfinite?.()?"Infinity":ne(Q),I=ht(Re?.multiplier??Re?.mult??Re?.value??1),H=`${Re?.target??Re?.type??"self"}`.toLowerCase(),W=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(Q)>=0}catch{}return!1})(),ee=`Level ${be}: Multiplies this upgrade\u2019s effect by ${I}x`;return H==="xp"&&(ee=`Level ${be}: Multiplies XP value by ${I}x`),(H==="coin"||H==="coins")&&(ee=`Level ${be}: Multiplies Coin value by ${I}x`),H==="mp"&&(ee=`Level ${be}: Multiplies MP value by ${I}x`),{text:ee,achieved:W}});gI(_e)}):(te.style.visibility="hidden",te.style.pointerEvents="none",te._onClick=null);let he=it.querySelector(".upg-actions"),Le=he.querySelector(".shop-close");if(Le||(Le=document.createElement("button"),Le.type="button",Le.className="shop-close",Le.textContent="Close",Le.addEventListener("click",()=>{n=!1,wg()}),he.appendChild(Le)),g||Y)he.querySelectorAll("button:not(.shop-close)").forEach(re=>re.remove()),document.activeElement&&document.activeElement!==Le&&!he.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Le.focus();else{let re=m.have.cmp(V)>=0,ve=(ie,Q,be,I,H=!1)=>{let W=he.querySelector(`.${ie.split(" ").join(".")}`);if(!W){W=document.createElement("button"),W.type="button",W.className=ie,W.textContent=Q;let ee=()=>{typeof W._onClick=="function"&&W._onClick()};"PointerEvent"in window?W.addEventListener("pointerdown",se=>{se.pointerType==="mouse"||typeof se.button=="number"&&se.button!==0||(ee(),se.preventDefault())},{passive:!1}):W.addEventListener("touchstart",se=>{ee(),se.preventDefault()},{passive:!1}),W.addEventListener("click",()=>{je||ee()});let pe=he.children;I>=pe.length?he.appendChild(W):he.insertBefore(W,pe[I])}return W._onClick=be,W.textContent!==Q&&(W.textContent=Q),W.disabled!==H&&(W.disabled=H),W};if(T){he.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ie=>ie.remove()),ve("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ie}=o.evolve(e.id);ie&&(Sg(),gr(),p())},1,!1);return}if(m.unlockUpgrade){he.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ie=>ie.remove()),ve("shop-delve btn-unlock","Unlock",()=>{let{bought:ie}=o.buyOne(e.id);if(!(ie instanceof c?ie:c.fromAny(ie??0)).isZero?.()){if(Kt(),sc(e,t))try{ba(["reset"])}catch{}gr(),p()}},1,!re);return}if(he.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ie=>ie.remove()),ve("shop-delve btn-buy-one","Buy",()=>{let ie=o.getUiModel(e.id);if(ie.have.cmp(ie.nextPrice instanceof c?ie.nextPrice:c.fromAny(ie.nextPrice||0))<0)return;let{bought:Q}=o.buyOne(e.id);(Q instanceof c?Q:c.fromAny(Q??0)).isZero?.()||(Kt(),gr(),p())},1,!re),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let ie=he.querySelector(".btn-buy-max");ie&&ie.remove();let Q=he.querySelector(".btn-buy-cheap");Q&&Q.remove()}else{ve("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:I}=o.buyMax(e.id);(I instanceof c?I:c.fromAny(I??0)).isZero?.()||(Kt(),gr(),p())},2,!re);let Q=[1,3,4,5,6].includes(nd(m.upg));if(!l&&!Q)ve("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let H=o.buyCheap;if(!H)return;let{bought:W}=H(e.id);(W instanceof c?W:c.fromAny(W??0)).isZero?.()||(Kt(),gr(),p())},3,!re);else{let be=he.querySelector(".btn-buy-cheap");be&&be.remove()}}if(l)ve("shop-delve btn-buy-next","Buy Next",()=>{let Q=o.getUiModel(e.id);if(Q.hmReadyToEvolve)return;let be=Q.hmNextMilestone;if(!be||!Q.lvlBn||be.cmp(Q.lvlBn)<=0){let{bought:ge}=o.buyMax(e.id);if((ge instanceof c?ge:c.fromAny(ge??0)).isZero?.())return;Kt(),gr(),p();return}let I=0;try{let ge=be.sub(Q.lvlBn).toPlainIntegerString?.();I=Math.max(0,Math.floor(Number(ge&&ge!=="Infinity"?ge:be.sub(Q.lvlBn).toString())))}catch{}let H=O[Q.upg.costType]?.value,W=H instanceof c?H:c.fromAny(H??0),pe=zr(Q.upg,Q.lvlBn,W,I).count,se=!1;try{let ge=pe?.toPlainIntegerString?.();se=ge&&ge!=="Infinity"?Number(ge)>=I:Number(pe??0)>=I}catch{}let $e=se?o.buyNext(e.id,I):o.buyMax(e.id);($e.bought instanceof c?$e.bought:c.fromAny($e.bought??0)).isZero?.()||(Kt(),gr(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let ie=he.querySelector(".btn-buy-next");ie&&ie.remove()}}},y=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,y)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",y),p(),jt.classList.add("is-open"),jt.classList.toggle("is-automation-upgrade",t==="automation"),jt.style.pointerEvents="auto",bn(140),it.style.transition="none",it.style.transform="translateY(100%)",it.offsetHeight,requestAnimationFrame(()=>{it.style.transition="",it.style.transform=""}),ac=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,y)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",y)}}function vI(e,t,n,o){let r=null;function i(d){if(!n())return;let f=typeof d.clientY=="number"?d.clientY:d.touches?.[0]?.clientY||0;r={startY:f,lastY:f,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(d){if(!r||r.canceled)return;let f=d.clientY;if(typeof f!="number")return;let p=Math.max(0,f-r.startY);r.lastY=f,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let d=Math.max(1,performance.now()-r.startT),f=r.moved;f/d>.55&&f>40||f>140?(uo(100),bn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",d=>d.preventDefault(),{passive:!1})}var ug,oI,rI,iI,fg,sI,aI,lI,pg,cI,uI,vg,bg,dI,mg,cc,uc,jt,it,fc,ac,Ui=qe(()=>{bt();Nt();Wt();po();tc();Sl();kn();mn();Ti();$r();rc();ug={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp"},oI="img/misc/locked_base.webp",rI="img/misc/maxed.webp",iI="img/misc/green_border.webp",fg={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp"},sI=7,aI={coins:ea,books:ta,gold:na,magic:oa};lI={coins:ea,books:ta,gold:na,magic:oa};pg={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>dg(Pn()),getUiModel:e=>Ea(Pn(),e),buyOne:e=>Ia(Pn(),e),buyMax:e=>dc(Pn(),e),buyCheap:e=>rd(Pn(),e),buyNext:(e,t)=>wa(Pn(),e,t),getLockState:e=>Fo(Pn(),e),evolve:e=>od(Pn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",Yf,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>dg(Ke),getUiModel:e=>Ea(Ke,e),buyOne:e=>Ia(Ke,e),buyMax:e=>dc(Ke,e),buyNext:(e,t)=>wa(Ke,e,t),getLockState:e=>Fo(Ke,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof v=="function"?v():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||gr(!0)});cI="sounds/purchase_upg.ogg",uI="sounds/evolve_upg.ogg",vg=.12,bg=.3;dI="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",mg="ccc-scroll-timeline-styles";cc=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return yg(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!jh(),o=v();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let V=document.createElement("div");V.className="shop-tile";let le=document.createElement("img");le.className="base",le.alt="";let me=document.createElement("img");me.className="icon",me.alt="",me.addEventListener("error",()=>{me.src=dI}),V.appendChild(le),V.appendChild(me),i.appendChild(V),t.appendChild(i),i.addEventListener("click",K=>{let te=K.currentTarget;if(te.disabled||te.dataset.lockedPlain==="1"){K.preventDefault(),K.stopImmediatePropagation();return}if(zn(te)){K.preventDefault(),K.stopImmediatePropagation();return}if(K.shiftKey||K.ctrlKey){if(K.preventDefault(),K.stopImmediatePropagation(),!te.upgMeta)return;let he=te.upgMeta.id,Le=te.upgMeta.upgType==="HM",re=[1,3,4,5,6].includes(nd(te.upgMeta));if(K.shiftKey){if(!re&&this.adapter.buyCheap){let{bought:_e}=this.adapter.buyCheap(he);(_e instanceof c?_e:c.fromAny(_e??0)).isZero?.()||(Kt(),this.update());return}let{bought:ve}=this.adapter.buyMax(he);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(Kt(),sc(te.upgMeta,this.mode))try{ba(["reset"])}catch{}this.update()}return}if(K.ctrlKey){if(Le){let _e=this.adapter.getUiModel(he);if(_e&&!_e.hmReadyToEvolve){let Re=_e.hmNextMilestone;if(Re&&_e.lvlBn&&Re.cmp(_e.lvlBn)>0){let ie=0;try{let ee=Re.sub(_e.lvlBn).toPlainIntegerString?.();ie=Math.max(0,Math.floor(Number(ee&&ee!=="Infinity"?ee:Re.sub(_e.lvlBn).toString())))}catch{}let Q=O[_e.upg.costType]?.value,be=Q instanceof c?Q:c.fromAny(Q??0),H=zr(_e.upg,_e.lvlBn,be,ie).count,W=!1;try{let ee=H?.toPlainIntegerString?.();W=ee&&ee!=="Infinity"?Number(ee)>=ie:Number(H??0)>=ie}catch{}if(W){let ee=this.adapter.buyNext(he,ie);(ee.bought instanceof c?ee.bought:c.fromAny(ee.bought??0)).isZero?.()||(Kt(),this.update());return}}}}let{bought:ve}=this.adapter.buyMax(he);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(Kt(),sc(te.upgMeta,this.mode))try{ba(["reset"])}catch{}this.update()}return}}te.upgMeta&&yI(te.upgMeta,this.mode)}),i.addEventListener("contextmenu",K=>{if(je)return;let te=K.currentTarget;if(te.dataset.locked==="1"||(K.preventDefault(),K.stopPropagation(),!te.upgMeta))return;if(this.adapter.getUiModel(te.upgMeta.id)?.hmReadyToEvolve){let{evolved:ve}=this.adapter.evolve(te.upgMeta.id);ve&&(Sg(),this.update());return}let{bought:Le}=this.adapter.buyMax(te.upgMeta.id);if(!(Le instanceof c?Le:c.fromAny(Le??0)).isZero?.()){if(Kt(),sc(te.upgMeta,this.mode))try{ba(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),d=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",d),i.disabled=d,d?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=d?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let y=s?c.fromInt(0):mI(r.meta,r.levelNumeric,r.level),m=y instanceof c?y:c.fromAny(y),h=ne(r.level),g=lc(h),S=ne(m),L=lc(S),w=!m.isZero?.(),N=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,T=Number.isFinite(N)?Math.max(0,Math.floor(N)):1/0,Y=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,D=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(T)&&Number.isFinite(Y)?Y>=T:!1,B=Number.isFinite(T)&&T===1,C=!!r.meta?.unlockUpgrade,U=!s&&C&&!D,R=!s&&C&&!U&&D,_,X,J=!1,ye=!1;if(s){_="",X="";let V=u?(r.lockState?.reason||"").trim():"",le=V?`${r.title} (Locked, ${V})`:`${r.title} (Locked)`;i.setAttribute("aria-label",le)}else{if(U||R)_=U?"Unlockable":"Unlocked",X=_,ye=!0;else if(!s&&B&&!C)D?(_="Owned",X="Owned"):w?(_="Purchasable",X="Purchasable"):(_="Not Owned",X="Not Owned"),ye=!0;else{let V=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,le=String(g||"").replace(/,/g,""),me=/|Infinity/i.test(le),K=Number.isFinite(V)?V>=1e3:me||/^\d{4,}$/.test(le);J=w&&K,J?(_=`<span class="badge-lvl">${h}</span><span class="badge-plus">(+${S})</span>`,X=`${g} (+${L})`):(_=w?`${h} (+${S})`:h,X=w?`${g} (+${L})`:g)}i.setAttribute("aria-label",`${r.title}, ${X}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let j=i.firstElementChild,ae=j.querySelector(".base"),xe=j.querySelector(".icon"),we=r.meta?.costType||"coins",oe=r.useLockedBase||s?oI:r.baseIconOverride||ug[we]||ug.coins;ae.src!==oe&&(ae.src=oe);let $=r.icon;if(!$)xe.hidden||(xe.hidden=!0);else{xe.hidden&&(xe.hidden=!1);let V=$;xe._lastSrc!==V&&(xe.src=V,xe._lastSrc=V)}let G=j.querySelector(".maxed-overlay"),Z=!s&&gg(r.meta),ue=!s&&D;if(ue||!s&&!D&&!p&&Z){G||(G=document.createElement("img"),G.className="maxed-overlay",G.alt="",j.insertBefore(G,xe));let V=ue?rI:iI;G.src!==V&&(G.src=V)}else G&&G.remove();let x=j.querySelector(".level-badge");s?x&&x.remove():(x||(x=document.createElement("span"),x.className="level-badge",j.appendChild(x)),x.className="level-badge",ye&&x.classList.add("text-badge"),J&&x.classList.add("two-line"),(w||U)&&x.classList.add("can-buy"),D&&x.classList.add("is-maxed"),_===X?x.textContent!==_&&(x.textContent=_):x.innerHTML!==_&&(x.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),Gi(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&zn(a)||(mr(),ng())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{je&&bn(80),this.close()},{passive:!0}),vI(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=v();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&ag(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,je)try{setTimeout(()=>uo(240),120)}catch{}bn(10),Gi(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},uc={standard:new cc("standard"),automation:new cc("automation")};jt=null,it=null,fc=!1,ac=null});var Lg={};yt(Lg,{applyHudLayout:()=>Uo,initHudButtons:()=>SI,isMapUnlocked:()=>ld,isShopUnlocked:()=>ad,lockMap:()=>yc,lockShop:()=>gc,unlockMap:()=>hc,unlockShop:()=>Kr});function sd(e){let t=v();return t==null?e:`${e}:${t}`}function Ji(e){let t=sd(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function ad(){return cd(),Ji(Qn.SHOP)}function ld(){return cd(),Ji(Qn.MAP)}function mc(e,t){let n=t?"1":"0",o=sd(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:v()}}))}catch{}}function cd(){for(let e of Object.values(Qn)){let t=sd(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function yo(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function id(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",Si())}function bI(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function Uo(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=bI(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(y=>e.querySelector(`.game-btn[data-btn="${y}"]`)).filter(Boolean),a=[...e.children].filter(y=>!l.includes(y)),u=[...l,...a];if(u.length&&u.some((y,m)=>e.children[m]!==y)){let y=document.createDocumentFragment();u.forEach(m=>y.appendChild(m)),e.appendChild(y)}let p=[...e.querySelectorAll(".game-btn")].filter(y=>!y.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(y=>{y.style.gridColumn="",y.style.gridRow="",y.classList.remove("span-2"),y.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let y=getComputedStyle(e),m=parseFloat(y.columnGap||y.gap||"0")||0,h=e.clientWidth,g=Math.max(180,Math.floor((h-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let y=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),h=e.querySelector('[data-btn="shop"]:not([hidden])');y&&m&&h&&(y.style.gridColumn="1",y.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",h.style.gridColumn="1 / -1",h.style.gridRow="2")}}function SI(){if(cd(),yo("help",!0),yo("stats",!0),yo("shop",Ji(Qn.SHOP)),yo("map",Ji(Qn.MAP)),id(),Uo(),Eg||(Eg=!0,window.addEventListener("resize",Uo),window.addEventListener("orientationchange",Uo),window.addEventListener("saveSlot:change",()=>{yo("shop",Ji(Qn.SHOP)),yo("map",Ji(Qn.MAP)),id(),Uo()}),window.addEventListener("saveSlot:modified",e=>{let t=v(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||id()})),!xg){xg=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&Ul()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&zn(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function Kr(){mc(Qn.SHOP,!0),yo("shop",!0),Uo()}function hc(){mc(Qn.MAP,!0),yo("map",!0),Uo()}function gc(){mc(Qn.SHOP,!1),yo("shop",!1),Uo()}function yc(){mc(Qn.MAP,!1),yo("map",!1),Uo()}var Qn,Eg,xg,vc=qe(()=>{Ui();bt();Ti();Qn={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Eg=!1,xg=!1});function _g(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(V=>V.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,d=4,f=new Float32Array(t*d);for(let x=0;x<t;x++)f[x*d+2]=1/0;let p=new Int16Array(t),y=t;for(let x=0;x<t;x++)p[x]=t-1-x;let m=-1,h=document.createElement("canvas");h.className="cursor-trail-canvas",Object.assign(h.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(h);let g=h.getContext("2d",{alpha:!0,desynchronized:!0}),S=document.createElement("canvas");S.width=a,S.height=a;let L=S.getContext("2d");L.shadowColor="#FFEB3B",L.shadowBlur=l,L.fillStyle="#FFEB3B",L.beginPath(),L.arc(u,u,s,0,Math.PI*2),L.fill();let w=!1,N=null,T=null,Y={left:0,top:0,width:0,height:0},D=1,B=!1,C=0,U=0,R=!1,_=null,X=[],J=()=>{if(B)return;let x=document.documentElement.clientWidth,V=document.documentElement.clientHeight;Y={left:0,top:0,width:x,height:V,right:x,bottom:V,x:0,y:0}},ye=()=>{if(B)return;J();let x=Math.min(window.devicePixelRatio||1,2);D=Y.width>0?Math.min(x,512/Y.width):x,h.width=Y.width*D,h.height=Y.height*D,g.scale(D,D),_=null},j=null;typeof ResizeObserver<"u"&&(j=new ResizeObserver(()=>{ye()}),j.observe(e));let ae=(x,V)=>{if(y<=0)return;let le=p[--y];le>m&&(m=le);let me=le*d;f[me]=x,f[me+1]=V,f[me+2]=0,f[me+3]=n},xe=(x,V,le)=>{if(N===null||T===null)le.count<r&&(ae(x,V),le.count++);else{let me=x-N,K=V-T,te=Math.hypot(me,K);if(te>=o){let he=Math.floor(te/o);for(let Le=1;Le<=he&&!(le.count>=r);Le++){let re=Le*o/te;ae(N+me*re,T+K*re),le.count++}}le.count<r&&(ae(x,V),le.count++)}N=x,T=V},we=x=>{if(B)return;C||(U=0,C=requestAnimationFrame(oe)),Y.width||J();let V=0,le=0,me=(K,te)=>K>=0&&K<=Y.width&&te>=0&&te<=Y.height;if(x.getCoalescedEvents){let K=x.getCoalescedEvents();if(K.length>0)for(let te of K){let he=te.clientX-V,Le=te.clientY-le;X.push({x:he,y:Le,inside:me(he,Le)})}else{let te=x.clientX-V,he=x.clientY-le;X.push({x:te,y:he,inside:me(te,he)})}}else{let K=x.clientX-V,te=x.clientY-le;X.push({x:K,y:te,inside:me(K,te)})}},z=()=>{w=!1,N=null,T=null,X.length=0},oe=()=>{if(B)return;let x=performance.now();U||(U=x);let V=x-U;U=x,V>100&&(V=100);let le={count:0};if(X.length>0){for(let Ae of X)Ae.inside?(w=!0,xe(Ae.x,Ae.y,le)):(w=!1,N=null,T=null);let ve=X[X.length-1];ve.inside&&(N!==ve.x||T!==ve.y)&&(ae(ve.x,ve.y),N=ve.x,T=ve.y),X.length=0}else w&&N!==null&&T!==null&&ae(N,T);let me=t-y;if(me===0&&!R){C=0;return}_?g.clearRect(_.x,_.y,_.w,_.h):g.clearRect(0,0,Y.width,Y.height),R=!1;let K=1/0,te=1/0,he=-1/0,Le=-1/0,re=-1;if(me>0)for(let ve=0;ve<=m;ve++){let Ae=ve*d,_e=f[Ae+2];if(_e>=f[Ae+3])continue;if(_e+=V,f[Ae+2]=_e,_e>=f[Ae+3]){p[y++]=ve;continue}re=ve;let Re=f[Ae+3],ie=_e/Re,Q=1-ie,be=1-.4*ie;R=!0,g.globalAlpha=Q;let I=a*be,H=I/2,W=f[Ae],ee=f[Ae+1],pe=Math.round(W-H),se=Math.round(ee-H),$e=Math.round(I);g.drawImage(S,pe,se,$e,$e),pe<K&&(K=pe),se<te&&(te=se);let tt=pe+$e,ge=se+$e;tt>he&&(he=tt),ge>Le&&(Le=ge)}m=re,K!==1/0?(K-=2,te-=2,he+=2,Le+=2,_={x:K,y:te,w:he-K,h:Le-te}):_=null,C=requestAnimationFrame(oe)};window.addEventListener("resize",ye),window.addEventListener("scroll",J,{passive:!0}),window.addEventListener("focus",J,{passive:!0}),document.addEventListener("visibilitychange",J,{passive:!0});let $={passive:!0},G=x=>{J(),we(x)},Z=x=>{J(),we(x)};e.addEventListener("pointermove",we,$),e.addEventListener("pointerdown",Z,$),e.addEventListener("pointerenter",G,$),e.addEventListener("pointerleave",z,$),e.addEventListener("pointercancel",z,$),ye(),C=requestAnimationFrame(oe);let ue=setInterval(J,1e3);return{destroy:()=>{B=!0,C&&cancelAnimationFrame(C),ue&&clearInterval(ue),j&&(j.disconnect(),j=null);try{window.removeEventListener("resize",ye)}catch{}try{window.removeEventListener("scroll",J)}catch{}try{window.removeEventListener("focus",J)}catch{}try{document.removeEventListener("visibilitychange",J)}catch{}try{e.removeEventListener("pointermove",we),e.removeEventListener("pointerdown",Z),e.removeEventListener("pointerenter",G),e.removeEventListener("pointerleave",z),e.removeEventListener("pointercancel",z)}catch{}h.remove()}}}var Cg=qe(()=>{});var Ug={};yt(Ug,{clearPendingGains:()=>bd,getPassiveCoinReward:()=>Hl,initCoinPickup:()=>kI,setCoinMultiplier:()=>xI,triggerPassiveCollect:()=>ed});function Mg(e){if(!e||typeof e!="object"){La=!1,bc=!1,Sc="0",Jr.clear();return}La=!!e.unlocked,bc=!!e.level?.isInfinite?.();try{Sc=e.level?.toPlainIntegerString?.()??"0"}catch{Sc="0"}La?bc&&Jr.clear():Jr.clear()}function II(){if(typeof jr=="function")try{jr()}catch{}try{Mg(at())}catch{La=!1,Jr.clear()}try{jr=Qr(e=>{Mg(e)})}catch{jr=null}}function xI(e){EI=e;try{O.coins?.mult?.set&&O.coins.mult.set(e)}catch{}}function pd(){try{let e=wc();e instanceof c?es=e.clone?.()??e:e!=null?es=c.fromAny(e):es=c.fromInt(1)}catch{es=c.fromInt(1)}}function LI(){kg||(kg=!0,pd(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",pd),typeof window<"u"&&window.addEventListener("saveSlot:change",pd))}function _I(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return yd.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function gd(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*CI:0}function MI({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,d=0,f=0,p=0,y=null,m=null,h=gd(),g=0,S=0,L=0,w=!1,N=null,T=null,Y=()=>{if(w)return;let $=document.documentElement.clientWidth,G=document.documentElement.clientHeight;N={left:0,top:0,width:$,height:G,right:$,bottom:G,x:0,y:0}},D=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",y=null,m=null},B=()=>{if(!l||S<=0){D();return}let $=S*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${f-S}px, ${p-S}px, 0)`,s.classList.add("is-visible")},C=()=>{if(!(!l||S<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=S+md,G=[];if(typeof i.findCoinTargetsInPath=="function"&&y!==null&&m!==null?G=i.findCoinTargetsInPath(y,m,f,p,$):G=i.findCoinTargetsInRadius(f,p,$),y=f,m=p,G&&G.length>0)if(typeof r=="function"){let Z=[];for(let ue=0;ue<G.length;ue++){let fe=G[ue],x={coin:fe};fe.el&&i.getCoinTransform&&(x.opts={transform:i.getCoinTransform(fe.el)}),Z.push(x)}r(Z)}else for(let Z=0;Z<G.length;Z++){let ue=G[Z],fe=i.ensureCoinVisual?i.ensureCoinVisual(ue):ue.el;if(fe){let x=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform||"";o(fe,{transform:x})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=S+md,G=i.findCoinsInRadius(f,p,$);if(y=f,m=p,G&&G.length>0){let Z=[];for(let ue=0;ue<G.length;ue++){let fe=G[ue],x=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform;Z.push({el:fe,opts:{transform:x}})}typeof r=="function"&&r(Z)}}else{let $=t.children,G=S+md,Z=[];for(let ue=$.length-1;ue>=0;ue--){let fe=$[ue];if(fe.dataset.collected==="1"||!fe.matches(n))continue;let x=fe.getBoundingClientRect(),V=x.left+x.width/2,le=x.top+x.height/2,me=V-u,K=le-d;Math.hypot(me,K)<=G&&Z.push(fe)}if(!Z.length)return;if(typeof r=="function"){let ue=[];for(let fe=0;fe<Z.length;fe++){let x=Z[fe],V=window.getComputedStyle(x);ue.push({el:x,opts:{transform:V.transform}})}r(ue)}else{let ue=[];for(let fe=0;fe<Z.length;fe++){let x=Z[fe],V=window.getComputedStyle(x);ue.push(V.transform)}for(let fe=0;fe<Z.length;fe++)o(Z[fe],{transform:ue[fe]})}}},U=()=>{L=0,B(),!(!l||S<=0||w)&&(C(),R())},R=()=>{!l||S<=0||L||w||(L=requestAnimationFrame(U))},_=$=>{if(!$||w||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,d=$.clientY,N||Y();let G=N;f=u,p=d,l=f>=0&&f<=G.width&&p>=0&&p<=G.height,R()},X=()=>{l=!1,D(),y=null,m=null},J=()=>{y=null,m=null},ye=()=>{g=Ec(),S=g*h,B(),R()},j=()=>{if(!(w||!a)){if(Y(),N){let $=N;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}R()}},ae=()=>{if(h=gd(),S=g*h,Y(),a&&N){let $=N;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}R()},xe=$=>{Y(),_($)},we=$=>{J(),xe($)},z=()=>{w=!0,L&&(cancelAnimationFrame(L),L=0),T&&clearInterval(T);try{window.removeEventListener("scroll",j)}catch{}try{window.removeEventListener("resize",ae)}catch{}try{window.removeEventListener("saveSlot:change",ye)}catch{}try{document.removeEventListener("ccc:upgrades:changed",ye)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",xe)}catch{}try{e.removeEventListener("pointerenter",we)}catch{}try{e.removeEventListener("pointerleave",X)}catch{}try{e.removeEventListener("pointercancel",X)}catch{}try{window.removeEventListener("blur",J)}catch{}try{s.remove()}catch{}},oe={passive:!0};return e.addEventListener("pointermove",_,oe),e.addEventListener("pointerdown",xe,oe),e.addEventListener("pointerenter",we,oe),e.addEventListener("pointerleave",X,oe),e.addEventListener("pointercancel",X,oe),window.addEventListener("resize",ae),window.addEventListener("scroll",j,{passive:!0}),window.addEventListener("focus",Y,{passive:!0}),window.addEventListener("blur",J,{passive:!0}),document.addEventListener("visibilitychange",()=>{Y(),document.hidden&&J()},{passive:!0}),window.addEventListener("saveSlot:change",ye),document.addEventListener("ccc:upgrades:changed",ye),T=setInterval(Y,1e3),ye(),{destroy:z}}function bd(){_a=null,Ca=null,Ma=null}function Fg(e){let t=yd.clone?.()??c.fromInt(1),n=Pg(t),o=eo(Tg),i=Bg(e??Sc);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof vo=="function"&&vo()?eo(es):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function Hl(){let{coinGain:e,xpGain:t,mpGain:n}=Fg(null);return{coins:e,xp:t,mp:n}}function ed(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=Fg(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=Tn(Me.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{In=In?.add?In.add(r):eo(r)}catch{In=eo(r)}xa(),a||Ag(r);let u=typeof rn=="function"?rn():!0,d=typeof i?.isZero=="function"?i.isZero():!1;u&&!d&&Ng(i),s.isZero?.()||Rg(s)}function kI({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){ud?.destroy&&ud.destroy();let a=document.querySelector(t),u=document.querySelector(n),d=document.querySelector(o);if(!a||!u||!d)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!d}),{destroy(){}};II(),LI(),a.style.touchAction="none";let f=null,p=null;In=O.coins.value,hd=()=>{let x=ne(In);x.includes("<span")?d.innerHTML=x:d.textContent=x},Og(),xa();let y=x=>{x?.detail&&x.detail.key==="coins"&&(In=x.detail.value,xa())};window.addEventListener("currency:change",y);let m=x=>{if(!(!x?.detail||x.detail.key!=="coins"))try{let{mult:V}=x.detail;V instanceof c?Bn=V.clone?.()??V:V!=null?Bn=c.fromAny(V):Bn=c.fromInt(1),Zr=!!Bn?.isInfinite?.()}catch{Bn=null,Zr=!1}};window.addEventListener("currency:multiplier",m);let h=v();if(h==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${h}`,S=`ccc:unlock:shop:progress:${h}`,L=localStorage.getItem("ccc:unlock:shop:progress"),w=localStorage.getItem("ccc:unlock:shop");L!=null&&localStorage.getItem(S)==null&&localStorage.setItem(S,L),w!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,w),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let x=parseInt(localStorage.getItem(S)||"0",10);if(localStorage.setItem(S,String(x)),x>=10&&localStorage.getItem(g)!=="1"){try{Kr()}catch{}localStorage.setItem(g,"1")}}let N=new URL(i,document.baseURI).href,T=x=>x instanceof HTMLElement?x._coinObj?!x._coinObj.isRemoved&&x.dataset.collected!=="1":x.dataset.collected!=="1"&&x.matches(r):!1;function Y(x){try{x.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(Y);let D=je?.12:.3,B=0;function C(x=N){if(x===N){let V=performance.now();if(V-B<40)return;B=V}ut(x,{volume:D})}function U(x,V={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(x);let le=()=>{x&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(x):x.remove())};if(l||je){le();return}let me="translate3d(0,0,0)";V.transform?V.transform!=="none"&&(me=V.transform):me=x.style.transform||"translate3d(0,0,0)",x.style.setProperty("--ccc-start",me),x.classList.add("coin--collected");let K=!1,te=()=>{K||(K=!0,x.removeEventListener("animationend",te),le())};x.addEventListener("animationend",te),setTimeout(te,600)}function R(x){if(!x||!x.length)return;let V=N,le=-1,me=!1;for(let ie of x){let Q=ie.coin||ie.el&&ie.el._coinObj;Q&&(Q.sizeIndex!==void 0?Q.sizeIndex>le&&(le=Q.sizeIndex,Q.soundSrc&&(V=Q.soundSrc,me=!0)):Q.soundSrc&&!me&&(V=Q.soundSrc,me=!0))}C(V);let K=null,te=null,he=null,Le=0,re=Tn(Me.COINS),ve=typeof rn=="function"?rn():!0,Ae=typeof vo=="function"&&vo(),_e=15,Re=0;for(let ie of x){let Q=ie.el,be=ie.coin;if(!be&&Q&&Q._coinObj&&(be=Q._coinObj),Q&&!T(Q)||be&&be.isRemoved)continue;Le++,Q&&(Q.dataset.collected="1"),Re<_e?(!Q&&be&&e&&e.ensureCoinVisual&&(Q=e.ensureCoinVisual(be),Q&&(Q.dataset.collected="1")),Q?(U(Q,ie.opts||{}),Re++):be&&e&&e.removeCoinTarget&&e.removeCoinTarget(be)):be&&e&&e.removeCoinTarget?e.removeCoinTarget(be):Q&&(e&&e.detachCoin&&e.detachCoin(Q),e&&e.recycleCoin?e.recycleCoin(Q):Q.remove());let I=Q?_I(Q):yd,H=be?.mutationLevel??(Q?.dataset?.mutationLevel||null),W=Pg(I),ee=eo(Tg),pe=eo(es);if(be&&be.valueMultiplier&&be.valueMultiplier>1){try{W=W.mulDecimalFloor(be.valueMultiplier)}catch{}try{ee=ee.mulDecimalFloor(be.valueMultiplier)}catch{}try{pe=pe.mulDecimalFloor(be.valueMultiplier)}catch{}}let se=Bg(H);if(se){try{W=W.mulBigNumInteger(se)}catch{}try{ee=ee.mulBigNumInteger(se)}catch{}}re||(K=ts(K,W)),ve&&(te=ts(te,ee)),Ae&&(he=ts(he,pe))}if(Le!==0){if(K&&!K.isZero?.()){try{In=In?.add?In.add(K):eo(K)}catch{In=eo(K)}Ag(K),xa()}if(te&&!te.isZero?.()&&Ng(te),he&&!he.isZero?.()&&Rg(he),localStorage.getItem(g)!=="1"){let Q=parseInt(localStorage.getItem(S)||"0",10)+Le;if(localStorage.setItem(S,String(Q)),Q>=10){try{Kr()}catch{}localStorage.setItem(g,"1")}}}}function _(x,V={}){return R([{el:x,opts:V}]),!0}f=MI({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:R,spawner:e}),p=_g(a);let X=x=>{if(x.target===u)return;let V=x.target.closest(r);if(V&&T(V)){let le={};e&&typeof e.getCoinTransform=="function"&&(le.transform=e.getCoinTransform(V)),_(V,le)}};u.addEventListener("pointerdown",X,{passive:!0}),je||u.addEventListener("mouseover",X,{passive:!0});let J=25,ye=null,j=()=>{let x=document.documentElement.clientWidth,V=document.documentElement.clientHeight;ye={left:0,top:0,width:x,height:V,right:x,bottom:V,x:0,y:0}};window.addEventListener("resize",j),window.addEventListener("scroll",j,{passive:!0}),j();let ae=null,xe=null,we=()=>{ae=null,xe=null};a.addEventListener("pointerleave",we,{passive:!0}),a.addEventListener("pointerenter",we,{passive:!0}),window.addEventListener("blur",we,{passive:!0});function z(x,V){if(e&&typeof e.findCoinTargetsInRadius=="function"){ye||j();let le=x,me=V,K=[];if(typeof e.findCoinTargetsInPath=="function"&&ae!==null&&xe!==null?K=e.findCoinTargetsInPath(ae,xe,le,me,J,!0):K=e.findCoinTargetsInRadius(le,me,J,!0),ae=le,xe=me,K&&K.length>0){let te=[];for(let he=0;he<K.length;he++){let Le=K[he],re={coin:Le};Le.el&&e.getCoinTransform&&(re.opts={transform:e.getCoinTransform(Le.el)}),te.push(re)}R(te)}}else if(e&&typeof e.findCoinsInRadius=="function"){ye||j();let le=x,me=V,K=e.findCoinsInRadius(le,me,J);if(ae=le,xe=me,K&&K.length>0){let te=[];for(let he of K){let Le=e.getCoinTransform?e.getCoinTransform(he):he.style.transform;te.push({el:he,opts:{transform:Le}})}R(te)}}else{let le=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],me=new Set;for(let K=0;K<le.length;K++){let te=x+le[K][0],he=V+le[K][1],Le=document.elementsFromPoint(te,he);for(let re=0;re<Le.length;re++){let ve=Le[re];T(ve)&&!me.has(ve)&&me.add(ve)}}if(me.size>0){let K=[];me.forEach(te=>K.push({el:te})),R(K)}}}let oe=null,$=!1;function G(x,V){oe={x,y:V},$||($=!0,requestAnimationFrame(()=>{oe&&(z(oe.x,oe.y),oe=null),$=!1}))}a.addEventListener("pointerdown",x=>{G(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointermove",x=>{x.pointerType!=="mouse"&&G(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointerup",x=>{x.pointerType!=="mouse"&&G(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("mousemove",x=>{G(x.clientX,x.clientY)},{passive:!0});function Z(x){}let ue=setInterval(j,1e3),fe=()=>{if(clearInterval(ue),Ic(),hd=()=>{},typeof window<"u"&&(window.removeEventListener("resize",j),window.removeEventListener("beforeunload",Ic),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",y),window.removeEventListener("blur",we)),typeof jr=="function"){try{jr()}catch{}jr=null}if(f?.destroy){try{f.destroy()}catch{}f=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",X),je||u.removeEventListener("mouseover",X)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(x=>a.replaceWith(a.cloneNode(!0)))}catch{}};return ud={destroy:fe},{get count(){return In},set count(x){In=c.fromAny?c.fromAny(x):c.fromInt(Number(x)||0),xa()},setMobileVolume:Z,destroy:fe,collectBatch:R,getMagnetUnitPx:gd}}var La,bc,Sc,jr,ud,Tg,yd,wI,Qi,Jr,EI,es,kg,_a,Ca,Ma,fd,In,hd,dd,xa,CI,md,eo,ts,Ic,vd,Ag,Ng,Rg,Bn,Zr,Og,Pg,Bg,da=qe(()=>{bt();Nt();Wt();vc();Yn();po();mo();mn();Cg();kn();La=!1,bc=!1,Sc="0",jr=null;ud=null,Tg=c.fromInt(1),yd=c.fromInt(1),wI=c.fromInt(1);try{Qi=c.fromAny("Infinity")}catch{Qi=null}Jr=new Map,EI="1",es=c.fromInt(1),kg=!1,_a=null,Ca=null,Ma=null,fd=!1,In=null,hd=()=>{},dd=!1,xa=()=>{dd||(dd=!0,requestAnimationFrame(()=>{dd=!1,hd()}))};CI=.05,md=8;eo=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},ts=(e,t)=>{if(!t)return e;if(!e)return eo(t);try{return e.add(t)}catch{try{return eo(e).add(t)}catch{return eo(t)}}},Ic=()=>{let e=_a;if(_a=null,e&&!e.isZero?.())try{O.coins.add(e)}catch{}let t=Ca;if(Ca=null,t&&!t.isZero?.())try{Ci(t)}catch{}let n=Ma;if(Ma=null,n&&!n.isZero?.())try{Hi(n)}catch{}},vd=()=>{fd||(fd=!0,requestAnimationFrame(()=>{fd=!1,Ic()}))},Ag=e=>{_a=ts(_a,e),vd()},Ng=e=>{Ca=ts(Ca,e),vd()},Rg=e=>{Ma=ts(Ma,e),vd()};typeof window<"u"&&window.addEventListener("beforeunload",Ic,{passive:!0});Bn=null,Zr=!1,Og=()=>{try{let e=O?.coins?.mult;if(!e||typeof e.get!="function"){Bn=null,Zr=!1;return}let t=e.get();if(!t){Bn=c.fromInt(1),Zr=!1;return}Bn=t.clone?.()??c.fromAny(t),Zr=!!Bn?.isInfinite?.()}catch{Bn=null,Zr=!1}},Pg=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Bn||Og();let n=Bn;if(!n)try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(Zr||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},Bg=e=>{if(!La)return null;if(bc){if(Qi)try{return Qi.clone?.()??Qi}catch{return Qi}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=Jr.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{Jr.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=ns(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(wI)===0,s=r.clone?.()??r;if(Jr.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function $g(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let i=Number(e.toString());isNaN(i)||(t=i),(e==="Infinity"||i===1/0)&&(n=!0)}catch{}let o=[],r=[];for(let i of Dg){let s=i;if(n){s={...i,description:[...i.description]};let l=xt();if(i.id===1){let a=Math.pow(10,l),u=ne(c.fromAny(a));Math.abs(a-Math.round(a))>.001?(u=a.toFixed(2),u.endsWith(".00")&&(u=u.slice(0,-3))):a<1e3&&(u=String(Math.round(a))),s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${u}x</span>`)}else if(i.id===2){let a=Math.pow(10,l),u=ne(c.fromAny(a));Math.abs(a-Math.round(a))>.001?(u=a.toFixed(2),u.endsWith(".00")&&(u=u.slice(0,-3))):a<1e3&&(u=String(Math.round(a))),s.description[1]=s.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${u}x</span>`)}else if(i.id===4){let a=Math.log10(4444e9),u=Ne(a*l),d=ne(u);s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${d}x</span>`)}}i.surgeLevel<=t?o.push(s):r.push(s)}return[...o,...r.slice(0,2)]}var Dg,Sd,Gg=qe(()=>{Wt();Nt();mn();Jn();Dg=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${ne(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]}],Sd=Dg.filter(e=>e.affectedByTsunami).map(e=>e.id)});function qg(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ut("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function d(I,H){I.style.position="absolute",I.style.left="50%";let W="perspective(600px) rotateX(50deg) rotateZ(180deg)",ee=!!o.xpHTML,pe=!!o.mpHTML;H==="coin"?(I.style.top="77%",I.style.transform=`translateX(-50%) ${W}`):ee&&pe?(I.style.top="72.5%",H==="mp"?I.style.transform=`translateX(calc(-100% - 44px)) ${W}`:I.style.transform=`translateX(44px) ${W}`):(H==="mp"?I.style.top="66%":H==="xp"&&(I.style.top="72%"),I.style.transform=`translateX(-50%) ${W}`),I.style.transformOrigin="center center";let se=I.firstElementChild;se&&(se.removeAttribute("hidden"),se.style.display="flex")}if(o.coinHTML){let I=document.createElement("div");I.innerHTML=o.coinHTML,d(I,"coin"),u.appendChild(I)}if(o.xpHTML){let I=document.createElement("div");I.innerHTML=o.xpHTML,d(I,"xp"),u.appendChild(I)}if(o.mpHTML){let I=document.createElement("div");I.innerHTML=o.mpHTML,d(I,"mp"),u.appendChild(I)}e.appendChild(u);let f=document.createElement("canvas");f.id="tsunami-fg-canvas",f.style.position="absolute",f.style.inset="0",f.style.width="100%",f.style.height="100%",f.style.zIndex="2147483646",f.style.pointerEvents="none",e.appendChild(f);let p=new Image;p.src="img/misc/merchant.webp";let y=!1;p.onload=()=>{y=!0},p.onerror=I=>{console.error("Tsunami: Merchant load failed",I)};let m,h,g=[],S=[],L=0;function w(){g=[],S=[];let I=h*.65,H=I+h*.15,ee=300*(Math.min(m,h)*5e-4),pe=m*.8,se=pe-ee*.6,$e=pe+ee*.6;for(let st=0;st<100;st++){let en=Math.random()*m,Mt=H+Math.random()*(h-H);S.push({x:en,y:Mt})}let tt=(st,en,Mt)=>{if(st>m*.1&&st<m*.9){let cn=h-I,so=I+cn*.15;if(en>so)return!1}else if(Mt==="tree"){let cn=h-I,so=I+cn*.5;if(en>so)return!1}return!(Mt==="tree"&&st>se&&st<$e)},ge=(st,en,Mt,cn,so)=>{for(let Ko=0;Ko<en;Ko++){let wo,Eo,jo=!1,b=0;for(;!jo&&b<50;){so?wo=so():wo=Math.random()*m;let M=h,P=Math.random();if(Eo=I+20+P*P*(M-I-20),tt(wo,Eo,st)&&(jo=!0,st==="tree")){for(let k of g)if(k.type==="tree"){let A=k.x-wo,de=k.y-Eo;if(Math.sqrt(A*A+de*de)<Math.max(m*.08,100)){jo=!1;break}}}b++}if(jo){let P=.6+(Eo-I)/(h-I)*.6,k=(Mt+Math.random()*cn)*P;g.push({type:st,x:wo,y:Eo,scale:k})}}},Be=3+Math.floor(Math.random()*3);ge("tree",Be,.8,.4,()=>Math.random()*(m*.1)),ge("tree",Be,.8,.4,()=>m*.9+Math.random()*(m*.1));let Dt=5+Math.floor(Math.random()*3);ge("tree",Dt,.8,.4,()=>m*.1+Math.random()*(m*.8)),ge("rock",20,.6,.4),ge("shell",30,.3,.3),g.sort((st,en)=>st.y-en.y)}let N=a.getContext("2d",{alpha:!1}),T=f.getContext("2d",{alpha:!0});function Y(){let I=window.devicePixelRatio||1;m=window.innerWidth,h=window.innerHeight,a.width=m*I,a.height=h*I,a.style.width=m+"px",a.style.height=h+"px",f.width=m*I,f.height=h*I,f.style.width=m+"px",f.style.height=h+"px",N.scale(I,I),T.scale(I,I),w(),L=-50}window.addEventListener("resize",Y),Y();let D=Date.now(),B=!0,C,U=!1,R={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},X=!1,J=[],ye=0,j=!1,ae=0,xe=5e3,we=!1,z=0,oe=[],$=6;for(let I=0;I<$;I++)oe.push({offset:Math.random()*1e3,speedBase:.001+I*5e-4,amplitudeBase:10+I*5});let G=[],Z=400;function ue(I,H,W){return I*(1-W)+H*W}function fe(I){let H=parseInt(I.slice(1),16);return{r:H>>16&255,g:H>>8&255,b:H&255}}function x(I,H,W){let ee=fe(I),pe=fe(H),se=Math.round(ue(ee.r,pe.r,W)),$e=Math.round(ue(ee.g,pe.g,W)),tt=Math.round(ue(ee.b,pe.b,W));return`rgb(${se},${$e},${tt})`}function V(I,H,W){let ee=[],pe=I,se=H,$e=20;for(;se<W;){let tt=pe+(Math.random()-.5)*60,ge=se+$e+Math.random()*30;ee.push({x1:pe,y1:se,x2:tt,y2:ge}),pe=tt,se=ge}return ee}function le(I,H,W,ee,pe,se){I.beginPath(),I.moveTo(H+se,W),I.lineTo(H+ee-se,W),I.quadraticCurveTo(H+ee,W,H+ee,W+se),I.lineTo(H+ee,W+pe-se),I.quadraticCurveTo(H+ee,W+pe,H+ee-se,W+pe),I.lineTo(H+se,W+pe),I.quadraticCurveTo(H,W+pe,H,W+pe-se),I.lineTo(H,W+se),I.quadraticCurveTo(H,W,H+se,W),I.closePath()}function me(I,H,W,ee,pe){I.save(),I.translate(H,W),I.scale(ee,ee),I.beginPath(),I.moveTo(0,0),I.quadraticCurveTo(10,-40,-5,-80),I.lineTo(5,-80),I.quadraticCurveTo(20,-40,10,0),I.fillStyle=pe.rock,I.fill(),I.translate(0,-80),I.fillStyle=pe.leaf;for(let se=0;se<7;se++)I.save(),I.rotate(se/7*Math.PI*2-Math.PI/2),I.beginPath(),I.moveTo(0,0),I.quadraticCurveTo(30,-10,60,0),I.quadraticCurveTo(30,10,0,0),I.fill(),I.restore();I.restore()}function K(I,H,W,ee,pe){I.save(),I.translate(H,W),I.scale(ee,ee),I.fillStyle=pe.rock,I.beginPath(),I.moveTo(-20,0),I.bezierCurveTo(-20,-15,-10,-25,0,-25),I.bezierCurveTo(10,-25,20,-15,20,0),I.fill(),I.fillStyle="rgba(0,0,0,0.2)",I.beginPath(),I.ellipse(0,0,20,5,0,0,Math.PI*2),I.fill(),I.restore()}function te(I,H,W,ee,pe){I.save(),I.translate(H,W),I.scale(ee,ee),I.fillStyle=pe.shell,I.beginPath(),I.arc(0,0,10,Math.PI,0),I.lineTo(0,0),I.fill(),I.strokeStyle=pe.sandDark,I.lineWidth=1,I.beginPath();for(let se=1;se<5;se++){let $e=Math.PI+se/5*Math.PI;I.moveTo(0,0),I.lineTo(Math.cos($e)*10,Math.sin($e)*10)}I.stroke(),I.restore()}function he(I,H,W,ee,pe){I.fillStyle=pe.sandDark,I.fillRect(-50,ee,H+100,W-ee),I.fillStyle=pe.sandDark,I.save(),I.fillStyle=pe.sandLight,I.globalAlpha=.3,I.beginPath(),I.moveTo(-50,W+100),I.lineTo(-50,ee),I.bezierCurveTo(H*.3,ee-20,H*.7,ee+20,H+50,ee),I.lineTo(H+50,W+100),I.fill(),I.globalAlpha=.6;let se=ee+W*.05;I.beginPath(),I.moveTo(-50,W+100),I.lineTo(-50,se),I.bezierCurveTo(H*.4,se+40,H*.6,se-10,H+50,se+20),I.lineTo(H+50,W+100),I.fill(),I.globalAlpha=1;let $e=ee+W*.15;I.beginPath(),I.moveTo(-50,W+100),I.lineTo(-50,$e),I.bezierCurveTo(H*.2,$e-10,H*.8,$e+30,H+50,$e+10),I.lineTo(H+50,W+100),I.fill(),I.fillStyle=pe.sandDark,I.globalAlpha=.1,S.forEach(tt=>{I.fillRect(tt.x,tt.y,2,2)}),I.restore()}function Le(I,H,W,ee=null){let pe=ee||1,se=!!ee&&ee>5;X&&!se&&!we&&ut("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),J.push({x:se?H/2:Math.random()*H,y:se?W/2:Math.random()*W,radius:0,maxRadius:se?Math.max(H,W)*1.5:(100+Math.random()*400)*pe,speed:se?40:(5+Math.random()*15)*pe,opacity:1,hue:225+Math.random()*15,life:1})}function re(I,H,W,ee=.5,pe=!0){let se=.1+ee*.7,$e=Math.floor(1+ee*4);if(pe&&!we){for(let tt=0;tt<$e;tt++)if(J.length<50&&Math.random()<se){let ge=1+ee*2;Le(I,H,W,ge)}}I.save(),I.globalCompositeOperation="lighter";for(let tt=J.length-1;tt>=0;tt--){let ge=J[tt];if(ge.radius+=ge.speed,ge.opacity-=.015,ge.life-=.015,ge.opacity<=0||ge.radius>ge.maxRadius){J.splice(tt,1);continue}let Be=I.createRadialGradient(ge.x,ge.y,0,ge.x,ge.y,ge.radius),Dt=ge.opacity;Be.addColorStop(0,`hsla(${ge.hue}, 100%, 80%, ${Dt})`),Be.addColorStop(.3,`hsla(${ge.hue}, 100%, 40%, ${Dt*.9})`),Be.addColorStop(.7,`hsla(${ge.hue}, 100%, 15%, ${Dt*.6})`),Be.addColorStop(1,`hsla(${ge.hue}, 100%, 5%, 0)`),I.fillStyle=Be,I.beginPath(),I.arc(ge.x,ge.y,ge.radius,0,Math.PI*2),I.fill()}I.restore()}function ve(){if(!B)return;let I=Date.now(),H=I-D;Math.min(H/t,1)>=1&&!U&&(U=!0,r&&r.stop(),i&&i.stop(),n&&n());let ee=5e3,pe=6e3,se=5e4,$e=5e4,tt=5e3,ge=4e4,Be=0;H<pe?Be=0:H<se?Be=(H-pe)/(se-pe):Be=1;let Dt=0;H>ge&&(Dt=Math.max(0,(H-ge)/(se-ge))),H>se&&(Dt=1),Dt>.1&&!i&&(i=ut("sounds/tsu_rumble.ogg",{volume:.8}));let st={skyTop:x(R.skyTop,_.skyTop,Be),skyBottom:x(R.skyBottom,_.skyBottom,Be),sun:x(R.sun,_.sun,Be),waterDeep:x(R.waterDeep,_.waterDeep,Be),waterMid:x(R.waterMid,_.waterMid,Be),waterPeak:x(R.waterPeak,_.waterPeak,Be),foam:x(R.foam,_.foam,Be),sandLight:x(R.sandLight,_.sandLight,Be),sandDark:x(R.sandDark,_.sandDark,Be),rock:x(R.rock,_.rock,Be),leaf:x(R.leaf,_.leaf,Be),shell:x(R.shell,_.shell,Be)},en=0,Mt=0;if(Be>.5||we){let b=(Be-.5)*2*5+Dt*25;z>0&&(b+=50),en=(Math.random()-.5)*b,Mt=(Math.random()-.5)*b}T.clearRect(0,0,m,h),N.save(),N.translate(en,Mt),T.save(),T.translate(en,Mt);let cn=N.createLinearGradient(0,0,0,h);if(cn.addColorStop(0,st.skyTop),cn.addColorStop(1,st.skyBottom),N.fillStyle=cn,N.fillRect(-50,-50,m+100,h+100),Be<1){let b=h*.15+Be*50;N.beginPath(),N.arc(m*.7,b,40,0,Math.PI*2),N.fillStyle=st.sun,N.globalAlpha=1-Be,N.shadowColor=st.sun,N.shadowBlur=20,N.fill(),N.globalAlpha=1,N.shadowBlur=0}let so=h*.65;if(y&&Be<1){N.save();let b=Math.min(m,h)*5e-4,M=300*b,P=300*b,k=m*.8,A=P*.15,de=so-P/2+A;N.translate(k,de),N.rotate(.1),N.drawImage(p,-M/2,-P/2,M,P),N.restore()}if(he(N,m,h,so,st),g.forEach(b=>{b.type==="tree"?me(N,b.x,b.y,b.scale,st):b.type==="rock"?K(N,b.x,b.y,b.scale,st):b.type==="shell"&&te(N,b.x,b.y,b.scale,st)}),Be>.3){let b=(Be-.3)/.7,M=Math.floor(Z*b);if(T.strokeStyle=`rgba(120, 180, 255, ${.1+b*.3})`,T.lineWidth=1+b,T.beginPath(),G.length<M)for(let k=0;k<10;k++)G.push({x:Math.random()*m*1.5,y:L,speed:20+Math.random()*20,len:10+Math.random()*20});let P=10+b*20;for(let k=0;k<G.length;k++){let A=G[k];A.y+=A.speed,A.x-=P,T.moveTo(A.x,A.y),T.lineTo(A.x-P*.5,A.y+A.len),(A.y>h||A.x<-100)&&(k<M?(A.x=Math.random()*m*1.5,A.y=L):(G.splice(k,1),k--))}T.stroke()}let Ko=.3;if(Be>Ko){let b=(Be-Ko)/(1-Ko),M=ue(0,h*1.5,b*b);T.fillStyle=st.waterDeep,T.beginPath(),T.moveTo(-50,h+100),T.lineTo(-50,h-M*.3),T.bezierCurveTo(m*.3,h-M*.4,m*.6,h-M*1.2,m+50,h-M*.8),T.lineTo(m+50,h+100),T.fill()}let wo=ue(0,h*.5,Be),Eo=ue(0,h*1.5,Dt*Dt),jo=h*.85-wo-Eo;if(oe.forEach((b,M)=>{let P;M===$-1?P=st.waterPeak:M%2===0?P=st.waterDeep:P=st.waterMid,T.fillStyle=P,T.beginPath();let k=b.amplitudeBase*(1+Be*2+Dt*5),A=.003+Be*.005,de=b.speedBase*(1+Be*5+Dt*10),ce=H*de+b.offset,ke=M*15*(1-Dt),Oe=jo+ke;T.moveTo(-50,h+100),T.lineTo(-50,Oe);for(let Pe=-50;Pe<=m+50;Pe+=15){let Te=Oe+Math.sin(Pe*A+ce)*k+Math.cos(Pe*A*2.3+ce)*(k*.5);T.lineTo(Pe,Te)}if(T.lineTo(m+50,h+100),T.fill(),M===$-1||Be>.6&&M>$-3){T.save(),T.globalAlpha=.1+Be*.3,T.fillStyle=st.foam,T.beginPath();for(let Pe=-50;Pe<=m+50;Pe+=10){let Te=Oe+Math.sin(Pe*A+ce)*k+Math.cos(Pe*A*2.3+ce)*(k*.5);Math.random()>.5&&(Te-=5),Pe===-50?T.moveTo(Pe,Te):T.lineTo(Pe,Te)}T.lineTo(m+50,h+100),T.lineTo(-50,h+100),T.fill(),T.restore()}}),H<ee){let b=1;H>1e3&&(b=1-(H-1e3)/(ee-1e3)),T.fillStyle=`rgba(0, 0, 0, ${b})`,T.fillRect(-50,-50,m+100,h+100)}if(H>$e){let b=Math.min(1,(H-$e)/tt);T.fillStyle=`rgba(0, 0, 0, ${b})`,T.fillRect(-50,-50,m+100,h+100)}if(X){let b=I-ye,M=12e3,P=0,k=!0;b<M?P=b/M:(P=1,we||(we=!0,Le(T,m,h,25),z=60,l||(l=!0,ut("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),j&&(k=!1),re(T,m,h,P,k)}if(j){let b=I-ae,M=Math.min(1,b/xe);T.fillStyle=`rgba(0, 0, 0, ${M})`,T.fillRect(-50,-50,m+100,h+100)}if(z>0){let b=z/60,M=b*b;T.fillStyle=`rgba(255, 255, 255, ${M})`,T.fillRect(-50,-50,m+100,h+100),z--}N.restore(),T.restore(),C=requestAnimationFrame(ve)}function Ae(){B=!1,e.style.cursor="",C&&cancelAnimationFrame(C),window.removeEventListener("resize",Y),a.parentNode&&a.parentNode.removeChild(a),f.parentNode&&f.parentNode.removeChild(f),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function _e(){X=!0,ye=Date.now(),we=!1,z=0,s||(s=ut("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Re(){j=!0,ae=Date.now(),s&&s.stop()}function ie(){e.style.cursor=""}function Q(){e.style.cursor="none"}function be(){s&&(s.stop(),s=null)}return ve(),{cleanup:Ae,triggerBeacons:_e,triggerFinalFade:Re,showCursor:ie,hideCursor:Q,stopHumLoop:be}}var Hg=qe(()=>{kn()});var wy={};yt(wy,{canPerformForgeReset:()=>yy,canPerformInfuseReset:()=>vy,computeForgeGoldFromInputs:()=>ry,computeInfuseMagicFromInputs:()=>iy,computePendingForgeGold:()=>gy,computeSurgeWavesFromInputs:()=>sy,getCurrentSurgeLevel:()=>gn,getForgeDebugOverrideState:()=>cy,getInfuseDebugOverrideState:()=>fy,getSurgeBarLevelKey:()=>os,getSurgeDebugOverrideState:()=>my,hasDoneForgeReset:()=>pr,hasDoneInfuseReset:()=>Ft,hasDoneSurgeReset:()=>go,initResetPanel:()=>Zf,initResetSystem:()=>Bo,isForgeUnlocked:()=>ji,isInfuseUnlocked:()=>Bc,isSurgeUnlocked:()=>rs,onForgeUpgradeUnlocked:()=>Kd,onInfuseUpgradeUnlocked:()=>jd,onSurgeUpgradeUnlocked:()=>Zd,performForgeReset:()=>Vd,performInfuseReset:()=>Wd,performSurgeReset:()=>Yd,recomputePendingMagic:()=>Un,setForgeDebugOverride:()=>uy,setForgeResetCompleted:()=>Pd,setInfuseDebugOverride:()=>py,setInfuseResetCompleted:()=>Bd,setInfuseUnlockedForDebug:()=>dy,setSurgeResetCompleted:()=>Fd,setSurgeUnlockedForDebug:()=>hy,shouldBlockBigCoins:()=>Ra,updateResetPanel:()=>We});function kd(e){return!BI.includes(e)}function FI(){ut(RI,{volume:.4})}function UI(){ut(OI,{volume:.45})}function DI(){ut(PI,{volume:.5})}function Ra(){return ey}function ty(){let e=Dn(),t=O.waves?.value??Ct(),n=0n;try{n=Oa(e)}catch{}let o=E.pendingWaves,r=zd(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),ey=i&&!hn()}function Na(){Ed=null}function Ac(){let e=E.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function Nc(){let e=E.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function xd(){let e=E.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function qI(e=null){try{if(e){let t=e instanceof wt?e:wt.fromAny(e??1);return t.isInfinite?.()?wt.fromAny("Infinity"):E.pendingGold.mulBigNumInteger(t)}return O.gold?.mult?.applyTo?.(E.pendingGold)??E.pendingGold}catch{return E.pendingGold}}function HI(){for(;to.length;){let e=to.pop();try{e?.()}catch{}}}function wd(){!Yg&&typeof pl=="function"&&(Yg=pl((e={})=>{e?.key&&e.key!==Me.COINS&&e.key!==Me.WAVES||e?.slot!=null&&E.slot!=null&&e.slot!==E.slot||(e?.key===Me.WAVES?(Fc(),We()):(wn(),Un(),Fn()))})),!zg&&typeof xl=="function"&&(zg=xl((e={})=>{e?.slot!=null&&E.slot!=null&&e.slot!==E.slot||(wn(),Fn(),We())}))}function Od(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=De(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Oc(){try{let e=Ze();if(e&&e.xpLevel)return e.xpLevel}catch{}return Ct()}function ny(e,t){if(!e||typeof e!="object")return Ct();let n=De(e);if(!Number.isFinite(n)&&n>0)return wt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return Ct();let r=Ne(o*Math.log10(2)),i=Math.max(0,Od(t)),s=Math.max(0,(i-30)/5),l=s<=0?Xg():Ne(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?Xg():Ne(a*Math.log10(1.15)),d=wt.fromInt(10);d=d.mulBigNumInteger(r),d=d.mulBigNumInteger(l),d=d.mulBigNumInteger(u);let f=d.floorToInteger();return f.isZero?.()?Ct():f}function XI(e,t){if(!e)return Ct();let n=De(e);if(!Number.isFinite(n)&&n>0)return wt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let y=De(t);Number.isFinite(y)&&(a=Math.max(0,y-4))}let u=o*i,d=Math.floor(o)*s,f=a*l,p=r+u+d+f;return Number.isFinite(p)?Ne(p).floorToInteger():wt.fromAny("Infinity")}function oy(e,t,n=null){let o=XI(e,t);if(n){let r=n instanceof wt?n:wt.fromAny(n??1);return r.isInfinite?.()?wt.fromAny("Infinity"):o.mulBigNumInteger(r)}return O.magic?.mult?.applyTo?.(o)??o}function ry(e,t){return ny(e,t)}function iy(e,t){return oy(e,t)}function sy(e,t,n,o,r){return ay(e,t,n,o,r)}function ay(e,t,n,o,r){let i=Od(e);if(i<201)return Ct();let s=(i-201)/35,l=De(t),a=De(n),u=De(o),d=De(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||d===Number.POSITIVE_INFINITY)return wt.fromAny("Infinity");let f=0;Number.isFinite(l)&&l>24&&(f+=(l-24)*xc),Number.isFinite(a)&&a>13&&(f+=(a-13)*xc),Number.isFinite(u)&&u>5&&(f+=(u-5)*xc),Number.isFinite(d)&&d>12&&(f+=(d-12)*xc);let p=1+f+s;return Number.isFinite(p)?Ne(p).floorToInteger():wt.fromAny("Infinity")}function ly(){return Math.max(0,Od(Oc()))}function Dn(){if(E.slot!=null)return E.slot;let e=v();return E.slot=e,e}function Pd(e){let t=Dn();if(t!=null){E.hasDoneForgeReset=!!e;try{localStorage.setItem(Td(t),E.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function Bd(e){let t=Dn();if(t!=null){E.hasDoneInfuseReset=!!e;try{localStorage.setItem(Ad(t),E.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function Fd(e){let t=Dn();if(t!=null){E.hasDoneSurgeReset=!!e;try{localStorage.setItem(Nd(t),E.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Pc(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Ta(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function cy(e=v()){return Pc(e)}function uy(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(E.forgeDebugOverride!==n){if(E.forgeDebugOverride=n,n==null)try{localStorage.removeItem(Ta(t))}catch{}else try{localStorage.setItem(Ta(t),n?"1":"0")}catch{}rt(Ta(t)),Ac(),We()}}function Ud(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Aa(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function fy(e=v()){return Ud(e)}function dy(e){Dd(e)}function py(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(E.infuseDebugOverride!==n){if(E.infuseDebugOverride=n,n==null)try{localStorage.removeItem(Aa(t))}catch{}else try{localStorage.setItem(Aa(t),n?"1":"0")}catch{}rt(Aa(t)),Nc(),We()}}function Dd(e){let t=Dn();if(t==null)return;let n=!!e;if(E.infuseUnlocked!==n){E.infuseUnlocked=n;try{localStorage.setItem(kc(t),E.infuseUnlocked?"1":"0")}catch{}rt(kc(t)),Nc()}}function Rc(e){let t=Dn();if(t==null)return;let n=!!e;if(E.forgeUnlocked!==n){E.forgeUnlocked=n;try{localStorage.setItem(Mc(t),E.forgeUnlocked?"1":"0")}catch{}rt(Mc(t)),Ac()}}function $d(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Qg(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function my(e=v()){return $d(e)}function hy(e){Gd(e)}function Gd(e){let t=Dn();if(t==null)return;let n=!!e;if(E.surgeUnlocked!==n){E.surgeUnlocked=n;try{localStorage.setItem(Tc(t),E.surgeUnlocked?"1":"0")}catch{}rt(Tc(t)),xd()}}function Ld(e){if(e==null){E.forgeUnlocked=!1,E.forgeDebugOverride=null,E.hasDoneForgeReset=!1,E.infuseUnlocked=!1,E.infuseDebugOverride=null,E.hasDoneInfuseReset=!1,E.surgeUnlocked=!1,E.surgeDebugOverride=null,E.hasDoneSurgeReset=!1,E.flagsPrimed=!1;return}try{E.forgeUnlocked=localStorage.getItem(Mc(e))==="1"}catch{E.forgeUnlocked=!1}E.forgeDebugOverride=Pc(e);try{E.hasDoneForgeReset=localStorage.getItem(Td(e))==="1"}catch{E.hasDoneForgeReset=!1}try{E.infuseUnlocked=localStorage.getItem(kc(e))==="1"}catch{E.infuseUnlocked=!1}try{E.hasDoneInfuseReset=localStorage.getItem(Ad(e))==="1"}catch{E.hasDoneInfuseReset=!1}E.infuseDebugOverride=Ud(e);try{E.surgeUnlocked=localStorage.getItem(Tc(e))==="1"}catch{E.surgeUnlocked=!1}E.surgeDebugOverride=$d(e);try{E.hasDoneSurgeReset=localStorage.getItem(Nd(e))==="1"}catch{E.hasDoneSurgeReset=!1}E.flagsPrimed=!0}function Do(){let e=v();if(e==null){E.flagsPrimed=!1;return}E.slot!==e&&(E.slot=e,Na(),E.flagsPrimed=!1),E.flagsPrimed||Ld(e)}function Kg(e){Vg!==e&&(HI(),Vg=e,e!=null&&(to.push(Lt(Mc(e),{onChange(t){let n=t==="1";E.forgeUnlocked!==n&&(E.forgeUnlocked=n,Ac(),We())}})),to.push(Lt(Td(e),{onChange(t){let n=t==="1";E.hasDoneForgeReset!==n&&(E.hasDoneForgeReset=n,We())}})),to.push(Lt(Ta(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),E.forgeDebugOverride!==n&&(E.forgeDebugOverride=n,Ac(),We())}})),to.push(Lt(kc(e),{onChange(t){let n=t==="1";E.infuseUnlocked!==n&&(E.infuseUnlocked=n,Nc(),We())}})),to.push(Lt(Ad(e),{onChange(t){let n=t==="1";E.hasDoneInfuseReset!==n&&(E.hasDoneInfuseReset=n,We())}})),to.push(Lt(Aa(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),E.infuseDebugOverride!==n&&(E.infuseDebugOverride=n,Nc(),We())}})),to.push(Lt(Tc(e),{onChange(t){let n=t==="1";E.surgeUnlocked!==n&&(E.surgeUnlocked=n,xd(),We())}})),to.push(Lt(Qg(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),E.surgeDebugOverride!==n&&(E.surgeDebugOverride=n,xd(),We())}})),to.push(Lt(Nd(e),{onChange(t){let n=t==="1";E.hasDoneSurgeReset!==n&&(E.hasDoneSurgeReset=n,We())}}))))}function VI(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function wn(e=!1){let t=O.coins?.value??Ct(),n=Oc(),o=VI(t,n);!e&&Ed===o||(Ed=o,qd()?E.pendingGold=ny(t,n):E.pendingGold=Ct(),We())}function Un(e=null){let t=O.coins?.value??Ct(),n=Pa();Hd()?E.pendingMagic=oy(t,n,e):E.pendingMagic=Ct(),Fn(),We()}function Fn(){if(!rs()){E.pendingWaves=Ct();return}let e=Oc(),t=O.coins?.value??Ct(),n=O.gold?.value??Ct(),o=O.magic?.value??Ct(),r=Pa();E.pendingWaves=ay(e,t,n,o,r),go()||E.pendingWaves.cmp(wt.fromInt(10))>0&&(E.pendingWaves=wt.fromInt(10)),ty()}function _d(){let e=Pc();return e!=null?!!e:E.forgeUnlocked||_t(Ee.STARTER_COVE,Se.UNLOCK_FORGE)>=1}function qd(){try{let e=Oc();if(e&&typeof e.cmp=="function")return e.cmp($I)>=0}catch{}return!1}function Hd(){try{let e=at();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(GI)>=0}catch{}return!1}function ji(){Do();let e=Pc();return e!=null?!!e:!!E.forgeUnlocked||_d()}function Bc(){Do();let e=Ud();return e!=null?!!e:!!E.infuseUnlocked}function rs(){Do();let e=$d();return e!=null?!!e:!!E.surgeUnlocked}function gn(){let e=Dn();return e==null?0n:Oa(e)}function pr(){return Do(),!!E.hasDoneForgeReset}function Ft(){return Do(),!!E.hasDoneInfuseReset}function go(){return Do(),!!E.hasDoneSurgeReset}function gy(){return wn(),E.pendingGold.clone?.()??E.pendingGold}function yy(){return!(!ji()||!qd()||E.pendingGold.isZero?.())}function vy(){return!(!Bc()||!Hd()||E.pendingMagic.isZero?.())}function WI({resetGold:e=!1,resetMagic:t=!1}={}){let n=Bt(Ee.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===Se.UNLOCK_XP||r===Se.UNLOCK_FORGE||r===Se.UNLOCK_INFUSE||r===Se.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||$o(Ee.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Xd({resetGold:e=!1,resetMagic:t=!1}={}){try{O.coins.set(0)}catch{}try{O.books.set(0)}catch{}try{_i({keepUnlock:!0})}catch{}try{bd()}catch{}WI({resetGold:e,resetMagic:t})}function Vd(){if(!yy())return!1;let e=E.pendingGold.clone?.()??E.pendingGold;try{let t=O.gold?.mult?.applyTo?.(e)??e;O.gold?.add&&O.gold.add(t)}catch{}if(Xd({resetGold:!1}),wn(),Rc(!0),E.hasDoneForgeReset||Pd(!0),Xt(),vr(),kd("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return We(),!0}function Wd(){if(!vy())return!1;let e=E.pendingMagic.clone?.()??E.pendingMagic;try{O.magic?.add&&O.magic.add(e)}catch{}Xd({resetGold:!0});try{O.gold.set(0)}catch{}try{let t=v(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Xt({forceReload:!0})}catch{}if(wn(),Un(),kd("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return Dd(!0),E.hasDoneInfuseReset||Bd(!0),We(),!0}function Cd(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Dn();try{O.waves?.add&&e&&!e.isZero?.()&&O.waves.add(e)}catch{}Xd({resetGold:!0,resetMagic:!0});try{O.gold.set(0)}catch{}try{O.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Xt({forceReload:!0})}catch{}if(Fc(),Gd(!0),E.hasDoneSurgeReset||Fd(!0),wn(),Un(),Fn(),t&&(n||DI(),n||KI()),kd("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}We()}function YI(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{Ig(!0)}catch{}try{Ql()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,sr(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=qg(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),sg(e,()=>{setTimeout(zI,0)},i)},r);Cc=i.cleanup}function zI(){Cc&&(Cc(),Cc=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Cd(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=v();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function Yd(){if(!rs()||ly()<201)return!1;let e=E.pendingWaves.clone?.()??E.pendingWaves;if(e.isZero?.())return!1;let t=Dn(),n=O.waves?.value??Ct(),o=Oa(t),r=zd(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!hn()?(YI(),Cd(e,{playEffects:!1}),!0):(Cd(e,{playEffects:!0}),!0)}function KI(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function Oa(e){let t=0n;try{let n=localStorage.getItem(Rd(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function jI(e){let t=Rd(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function jg(e){if(!(e instanceof wt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function by(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=jg(n),l=jg(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let d=new c(10n,{base:0,offset:u}),f=d.sub(r).div(c.fromInt(9));n.cmp(f)>=0&&(n=n.sub(f),o=u,i=!0,r=d)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function Fc(){let e=Dn();if(e==null||!rs()||Id||jI(e))return;let t=O.waves?.value??Ct(),n=Oa(e);if(n===1/0)return;let o=by(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Rd(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}Id=!0;try{O.waves.set(o.remainingWaves)}finally{Id=!1}We(),o.safety>=100&&setTimeout(Fc,0)}ty()}function ka(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=wt.fromInt(e)}catch{}try{return ne(t)}catch{return e?.toString?.()??"0"}}function ZI(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${TI}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${AI}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${NI}" alt=""><span>Surge</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Zg}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Jg}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${_c}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,E.panel=e,E.elements.forge.card=e.querySelector("#reset-card-forge"),E.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),E.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),E.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),E.elements.infuse.card=e.querySelector("#reset-card-infuse"),E.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),E.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),E.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),E.elements.surge.card=e.querySelector("#reset-card-surge"),E.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),E.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),E.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),E.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),E.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),E.elements.surge.headerVal=e.querySelector("[data-surge-level]"),E.elements.surge.header=e.querySelector(".surge-header");let t=e.querySelector(".surge-milestone-wrapper");E.elements.surge.milestones&&t&&Gi(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),E.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]')},Object.entries(E.layerButtons).forEach(([n,o])=>{if(!o)return;let r=null,i=s=>{if(s&&s.isTrusted&&zn(o))return;let l=E.elements[n]?.card;if(l){let a=l.closest(".merchant-content");n==="forge"&&a?a.scrollTo({top:0,behavior:"smooth"}):l.scrollIntoView({behavior:"smooth",block:"start"})}};o.addEventListener("click",s=>{if(r&&r!=="mouse"){r=null;return}r=null,i(s)})}),E.elements.forge.btn&&E.elements.forge.btn.addEventListener("click",()=>{Vd()&&(FI(),We())}),E.elements.infuse.btn&&E.elements.infuse.btn.addEventListener("click",()=>{Wd()&&(UI(),We())}),E.elements.surge.btn&&E.elements.surge.btn.addEventListener("click",()=>{Yd()&&We()}),We()}function Zf(e){!e||e.__resetInit||(e.__resetInit=!0,ZI(e))}function yr(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=ka(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let d=e.querySelector(".merchant-reset__action-icon img");d&&!d.src.includes(n)&&(d.src=n)}}function Sy({goldMult:e=null}={}){let t=E.elements.forge;if(!(!t.card||!t.btn)){if(!ji()){yr(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(Do(),t.card.classList.toggle("is-forge-complete",!!E.hasDoneForgeReset),t.status)if(E.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!qd()){yr(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}yr(t.btn,{disabled:!1},Zg,qI(e))}}function Iy(){let e=E.elements.infuse;if(!(!e.card||!e.btn)){if(!Bc()){e.card.style.display!=="none"&&(e.card.style.display="none"),E.layerButtons.infuse&&E.layerButtons.infuse.style.display!=="none"&&(E.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),E.layerButtons.infuse&&E.layerButtons.infuse.style.display!=="flex"&&(E.layerButtons.infuse.style.display="flex"),Do(),e.card.classList.toggle("is-complete",!!E.hasDoneInfuseReset),e.status)if(E.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!Hd()){yr(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}yr(e.btn,{disabled:!1},Jg,E.pendingMagic)}}function zd(e,t,n){let o=t.add(n);return by(e,o).level}function Md(){let e=E.elements.surge;if(!e.card||!e.btn)return;if(!rs()){e.card.style.display!=="none"&&(e.card.style.display="none"),E.layerButtons.surge&&E.layerButtons.surge.style.display!=="none"&&(E.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),E.layerButtons.surge&&E.layerButtons.surge.style.display!=="flex"&&(E.layerButtons.surge.style.display="flex"),Do();let t=Dn(),n=O.waves?.value??Ct(),o=0n;try{o=Oa(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':ka(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=E.pendingWaves;if(u&&!u.isZero?.()){let d=zd(o,n,u),f=!1;if(d===1/0)f=!0;else try{f=d>o}catch{}if(f){let p=d===1/0?'<span class="surge-infinity-symbol">\u221E</span>':ka(d);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${_c}">${ka(n)} / <img src="${_c}">${ka(r)}</span>`),e.milestones){let s=$g(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let d=BigInt(a.surgeLevel)<=o,f=d?"is-reached":"",p=a.description.map(w=>w.includes("Invokes the Tsunami")&&!d?`<div class="tsunami-text">- ${w}</div>`:`<div>- ${w}</div>`).join("");if(d&&a.surgeLevel===3){let w=ar?ar():wt.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${ne(w)}</div>`}if(d&&a.surgeLevel===6){let w=Dl();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${ht(w.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${ht(w.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${ht(w.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${ht(w.magic)}x</span></div>`}let y=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(y=!0);let m=!1;d&&y&&xt()<1&&Sd.includes(a.id)&&(m=!0);let h=m?" is-nerfed":"",g=l[u];if(!g)g=document.createElement("div"),g.className=`surge-milestone-item ${f}${h}`,g.dataset.isReached=String(d),g.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(g);else{g.className!==`surge-milestone-item ${f}${h}`&&(g.className=`surge-milestone-item ${f}${h}`);let w=String(d);g.dataset.isReached!==w&&(g.dataset.isReached=w)}let S=g.querySelector(".surge-milestone-desc");S&&S.innerHTML!==p&&(S.innerHTML=p);let L=g.querySelector(".surge-milestone-nerf-arrow");if(L){let w=!1;y&&xt()!==1&&Sd.includes(a.id)&&(w=!0);let N=w?"":"none";L.style.display!==N&&(L.style.display=N)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();E.lastRenderedSurgeLevel!==o&&(E.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],d=e.milestones.children;u===d[d.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!E.hasDoneSurgeReset),e.status)if(E.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(ly()<201){yr(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(E.pendingWaves.isZero?.()){yr(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}yr(e.btn,{disabled:!1},_c,E.pendingWaves)}function We({goldMult:e=null}={}){E.panel&&(Sy({goldMult:e}),Iy(),Md())}function Kd(){Bo(),Rc(!0),We()}function jd(){Bo(),Dd(!0),We()}function Zd(){Bo(),Gd(!0),We()}function JI(){if(!E.panel)return;let e=E.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!E.panel.classList.contains("is-active")||!E.elements.surge.barFill)return;let t=E.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Md(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Md()},{once:!0}))}function QI(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{JI()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(wn(),Un(),Fn()),e.detail?.key==="waves"&&(Fc(),We()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Fn(),We())}),window.addEventListener("surge:bookResidue",()=>{if(E.panel&&E.panel.offsetParent!==null){let e=E.elements.surge.card;e&&e.style.display!=="none"&&We()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Me.GOLD){if(t.slot!=null&&E.slot!=null&&t.slot!==E.slot)return;wn(!0);let n=t.mult instanceof c?t.mult:wt.fromAny(t.mult??1);E.panel&&Sy({goldMult:n});return}if(t.key===Me.MAGIC){if(t.slot!=null&&E.slot!=null&&t.slot!==E.slot)return;let n=t.mult instanceof c?t.mult:wt.fromAny(t.mult??1);Un(n),E.panel&&Iy();return}}}),window.addEventListener("xp:change",()=>{wn(),Fn(),We()}),window.addEventListener("mutation:change",()=>{Un(),Fn(),We()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&E.slot!=null&&e.detail.slot!==E.slot||(Na(),wn(!0),Un(),Fn(),We())}))}function Bo(){if(Wg){E.slot=v(),Na(),wd(),wn(!0),Un(),Fn();return}try{Xt()}catch{return}Wg=!0;let e=v();if(E.slot=e,Na(),Ld(e),E.hasDoneForgeReset&&!vo())try{vr()}catch{}if(!E.forgeUnlocked&&_d()&&Rc(!0),Kg(e),wd(),QI(),wn(!0),Un(),Fn(),Lc){try{Lc()}catch{}Lc=null}Lc=Qr(()=>{let t=Jd();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=v();if(E.slot=t,Na(),Ld(t),E.hasDoneForgeReset&&!vo())try{vr()}catch{}!E.forgeUnlocked&&_d()&&Rc(!0),Kg(t),wd(),wn(!0),Un(),Fn(),We()})}var wt,xc,Ct,Xg,Zg,Jg,TI,AI,NI,_c,RI,OI,PI,BI,Mc,Td,Ta,kc,Ad,Aa,Tc,Qg,Nd,os,Rd,$I,GI,Id,ey,E,to,Vg,Wg,Lc,Ed,Yg,zg,Cc,fo=qe(()=>{Nt();bt();Wt();Yn();mn();mo();Ti();da();Gg();Ui();kn();Jn();tc();Hg();wt=c,xc=Math.log10(1.1),Ct=()=>wt.fromInt(0),Xg=()=>wt.fromInt(1),Zg="img/currencies/gold/gold.webp",Jg="img/currencies/magic/magic.webp",TI="img/misc/forge.webp",AI="img/misc/infuse.webp",NI="img/misc/surge.webp",_c="img/currencies/wave/wave.webp",RI="sounds/forge_reset.ogg",OI="sounds/infuse_reset.ogg",PI="sounds/surge_reset.ogg",BI=[];Mc=e=>`ccc:reset:forge:${e}`,Td=e=>`ccc:reset:forge:completed:${e}`,Ta=e=>`ccc:debug:forgeUnlocked:${e}`,kc=e=>`ccc:reset:infuse:${e}`,Ad=e=>`ccc:reset:infuse:completed:${e}`,Aa=e=>`ccc:debug:infuseUnlocked:${e}`,Tc=e=>`ccc:reset:surge:${e}`,Qg=e=>`ccc:debug:surgeUnlocked:${e}`,Nd=e=>`ccc:reset:surge:completed:${e}`,os=e=>`ccc:reset:surge:barLevel:${e}`,Rd=os,$I=wt.fromInt(31),GI=wt.fromInt(7),Id=!1,ey=!1;E={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,pendingGold:Ct(),pendingMagic:Ct(),pendingWaves:Ct(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},to=[],Vg=null,Wg=!1,Lc=null,Ed=null,Yg=null,zg=null;Cc=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Bo,performForgeReset:Vd,performInfuseReset:Wd,performSurgeReset:Yd,computePendingForgeGold:gy,computeForgeGoldFromInputs:ry,computeInfuseMagicFromInputs:iy,computeSurgeWavesFromInputs:sy,getForgeDebugOverrideState:cy,hasDoneForgeReset:pr,isForgeUnlocked:ji,setForgeDebugOverride:uy,setForgeResetCompleted:Pd,updateResetPanel:We,isInfuseUnlocked:Bc,setInfuseDebugOverride:py,getInfuseDebugOverrideState:fy,recomputePendingMagic:Un,setInfuseUnlockedForDebug:dy,setInfuseResetCompleted:Bd,hasDoneInfuseReset:Ft,isSurgeUnlocked:rs,setSurgeUnlockedForDebug:hy,getSurgeDebugOverrideState:my,setSurgeResetCompleted:Fd,hasDoneSurgeReset:go,getCurrentSurgeLevel:gn,shouldBlockBigCoins:Ra}))});function Qd(){Ba=null}function Ey(){Ba=null;try{Uc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{pn()}catch{}}function xy(e){return typeof e=="function"&&Uc.push(e),()=>{Uc=Uc.filter(t=>t!==e)}}function tw(e){let t=lt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Ne(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function nw(){try{return!!rn()}catch{return!1}}function Fa(e){let t=O?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(nw())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=_t(Ee.STARTER_COVE,Se.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=tw(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function is(e=Ee.STARTER_COVE){if(Ba)return Ba;let t=Bt(e),n={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let o of t){if(!o.effectType)continue;let r=Sn(e,o.id),i=Fe(r),s=null;if(typeof o.effectMultiplier=="function"?(s=o.effectMultiplier(i),!(s instanceof c)&&typeof s!="number"&&(s=c.fromAny(s??1))):s=c.fromInt(1),o.upgType==="HM"){let{selfMult:l,xpMult:a,coinMult:u,mpMult:d}=br(o,r,e);n.xpValue=Et(n.xpValue,a),n.coinValue=Et(n.coinValue,u),n.mpValue=Et(n.mpValue,d),s=Et(s,l)}if(o.effectType==="coin_spawn"){let l=1;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=1}else l=Number(s);n.coinSpawn*=l}else if(o.effectType==="coin_value")n.coinValue=Et(n.coinValue,s);else if(o.effectType==="xp_value")n.xpValue=Et(n.xpValue,s);else if(o.effectType==="mp_value")n.mpValue=Et(n.mpValue,s);else if(o.effectType==="book_value")n.bookValue=Et(n.bookValue,s);else if(o.effectType==="magnet_radius"){let l=0;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=0}else l=Number(s);Number.isFinite(l)&&(n.magnetRadius+=l)}}return Ba=n,n}function qi(e){let t=is(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:ew*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue}}function wc(){try{let{mpValue:e}=is(Ee.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Ec(){try{let{magnetRadius:e}=is(Ee.STARTER_COVE);return e||0}catch{return 0}}function Ly(){try{Bo()}catch{}try{Or(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=is(Ee.STARTER_COVE);return Et(n,o)})}catch{}try{Mi(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=is(Ee.STARTER_COVE);return Et(n,o)})}catch{}try{Xr(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=is(Ee.STARTER_COVE);return Et(n,o)})}catch{}Fa(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{Fa()}catch{}try{pn()}catch{}})}var ew,Ba,Uc,_y=qe(()=>{Nt();bt();fo();Yn();mo();mn();ew=1,Ba=null,Uc=[]});var Zy={};yt(Zy,{AREA_KEYS:()=>Ee,HM_EVOLUTION_INTERVAL:()=>Ut,MAX_LEVEL_DELTA:()=>ps,REGISTRY:()=>tu,UPGRADE_TIES:()=>Se,approxLog10BigNum:()=>De,batchUpgradeOperations:()=>Da,bigNumFromLog10:()=>Ne,buyCheap:()=>rd,buyMax:()=>dc,buyOne:()=>Ia,buyTowards:()=>wa,clearPermanentUpgradeUnlock:()=>vp,computeDefaultUpgradeCost:()=>bp,computeHmMultipliers:()=>br,computeUpgradeEffects:()=>qi,costToBuyOne:()=>Mw,ensureLevelBigNum:()=>lt,estimateFlatBulk:()=>fp,estimateGeometricBulk:()=>ww,evaluateBulkPurchase:()=>zr,evolveUpgrade:()=>od,formatMultForUi:()=>ht,getCurrentAreaKey:()=>Pn,getHmEvolutions:()=>mp,getHmNextMilestoneLevel:()=>kw,getIconUrl:()=>pc,getLevel:()=>Sn,getLevelNumber:()=>_t,getMagnetLevel:()=>Ec,getMpValueMultiplierBn:()=>wc,getUpgrade:()=>ys,getUpgradeLockState:()=>Fo,getUpgradeStorageKey:()=>ti,getUpgradesForArea:()=>Bt,levelBigNumToNumber:()=>Fe,markUpgradePermanentlyUnlocked:()=>ei,normalizeBigNum:()=>Tw,normalizedUpgradeLevel:()=>Wc,onUpgradesChanged:()=>xy,peekNextPrice:()=>jy,performFreeAutobuy:()=>td,safeMultiplyBigNum:()=>Et,setLevel:()=>$o,syncBookCurrencyMultiplierFromUpgrade:()=>Fa,upgradeUiModel:()=>Ea});function Dc(){Sr.size!==0&&(Sr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{rt(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Sr.clear())}function rw(){if(!(typeof window>"u")&&!My){My=setInterval(Dc,2e3);try{window.addEventListener("beforeunload",Dc)}catch{}try{window.addEventListener("pagehide",Dc)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&Dc()})}catch{}}}function Da(e){if(ls)return e();ls=!0;try{return e()}finally{ls=!1,Ua.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{us(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),Ua.clear(),Cy.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{_w(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),Cy.clear(),ip&&(ip=!1,no())}}function iw(e){try{let t=gs(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function Ay(e,t){if(!iw(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=De(n);return Number.isFinite(o)&&o>=sw}catch{return!1}}function cs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>ep)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>ep/2||i.length>ep/2)return"Infinity"}return n}function De(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let y=Math.log10(p),m=e.e||0,h=Number(e._eOffset||0n);return y+m+h}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let d;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)+(u.length-15)}let f=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return d+f}function Ne(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function Gc(e){return dw[e]??0}function tp(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function ms(e,t){let n=Ho(e||t?.area);if(!n)return null;let o=Xo(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=qn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function $a(e,t){let n=Ho(e||t?.area);if(!n)return null;let o=qn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function ss(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function lp(e=v()){let t=String(e??"default");if(Hc.has(t))return Hc.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Oy}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Hc.set(t,n),n}function cp(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Hc.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Oy}:${n}`,JSON.stringify(e))}catch{}}function Jc(e=v()){let t=String(e??"default");if(Xc.has(t))return Xc.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Py}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Xc.set(t,n),n}function Qc(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Xc.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Py}:${n}`,JSON.stringify(e))}catch{}}function gp(e=v()){let t=String(e??"default");if(Vc.has(t))return Vc.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${By}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Vc.set(t,n),n}function yp(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Vc.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${By}:${n}`,JSON.stringify(e))}catch{}}function up(e,t,n=v()){let o=ms(e,t);if(!o)return;let r=$a(e,t),i=gp(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],yp(i,n))}function Fy(e,t,n=v()){let o=ms(e,t);if(!o)return!1;let r=$a(e,t),i=gp(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],yp(i,n),!0):!1}function ei(e,t,n=v()){let o=ms(e,t);if(!o)return;let r=$a(e,t),i=Jc(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Qc(i,n))}function vp(e,t,n=v()){let o=ms(e,t);if(!o)return;let r=Jc(n);r.upgrades[o]&&(delete r.upgrades[o],Qc(r,n));let i=lp(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},cp(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&Vo(e,s,n),no()}function Kc(e,t,n=v()){let o=ms(e,t);if(!o)return!1;let r=$a(e,t),i=Jc(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Qc(i,n),!0):!1}function sn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=Xo(t?.tie??t?.tieKey),o=e?.areaKey||Ee.STARTER_COVE;if(!n||!lw.has(n))return{locked:!0,iconOverride:En,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?_t(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:Uy()}catch{}function s(){if(Dy())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:an,titleOverride:Zt,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===Se.UNLOCK_XP)return s();if(n===Se.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:En,useLockedBase:!0};let a=!1;try{let u=ln();a=Fe(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:an,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Zt,descOverride:u,reason:u}}return{locked:!1}}if(n===Se.UNLOCK_INFUSE){if(!pr())return{locked:!0,iconOverride:En,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Gn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=ln();a=Fe(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:an,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Zt,descOverride:u,reason:u}}return{locked:!1}}if(n===Se.UNLOCK_SURGE){if(!Ft())return{locked:!0,iconOverride:En,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Gn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=ln();a=Fe(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:an,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Zt,descOverride:u,reason:u}}return{locked:!1}}if(hp.has(n)){if(Ft()||Kc(o,t)){try{ei(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let d=ln();a=Fe(d)>=101}catch{}if(!a)return{locked:!0,iconOverride:En,useLockedBase:!0,titleOverride:Gn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{up(o,t)}catch{}return{locked:!0,iconOverride:an,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Zt,descOverride:u,reason:u}}if(pr()||Kc(o,t)){try{ei(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:En,useLockedBase:!0};if(Fy(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:an,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Zt,descOverride:a,reason:a}}let l=!1;try{let a=ln();l=Fe(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:En,useLockedBase:!0,titleOverride:Gn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{up(o,t)}catch{}return{locked:!0,iconOverride:an,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function Ho(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function Xo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function pw(e,t){let n=Xo(t?.tie??t?.tieKey);if(n&&cw.has(n))return!0;let o=qn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=Ho(l);if(a&&uw.has(`${a}:${i}`))return!0}return!1}function Uy(){try{return!!rn()}catch{return!1}}function Dy(e=v()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${fw}:${t}`)==="1"}catch{return!1}}function ln(){try{let e=typeof Ze=="function"?Ze():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function Wc(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function np(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function qn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function lt(e){try{if(e=cs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Ne(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=De(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Fe(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=De(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let f=Number(r);return Number.isFinite(f)?f:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let f=Math.floor(Math.log10(a));Number.isFinite(f)&&f>0&&(a/=Math.pow(10,f),u+=f)}else if(a<1){let f=Math.ceil(Math.log10(1/a));Number.isFinite(f)&&f>0&&(a*=Math.pow(10,f),u-=f)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let d=a*Math.pow(10,u);return Number.isFinite(d)?d:u>0?Number.MAX_VALUE:0}catch{let o=De(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function mw(e,t){let n=lt(e),o=lt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(De(n))+1,i=Math.floor(De(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function $y(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function hs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function jc(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:hs(e.numUpgEvolutions)}function bp(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Fe(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let d=Math.max(0,Math.floor(r/Ut));Number.isFinite(d)&&(i.numUpgEvolutions=d)}let s=Xy(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:De(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:$y(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,$n(i,r)}function Gy(e){let t=hs(e),n=Ut*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Ir(o),capFmtText:fs(o)}}function qy(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(De(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Ut)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Ut);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Ut)+1)}}function gw(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Sp(e,t=zc){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=Ho(t||e?.area||zc);return aw[n]||Ny}function Et(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function eu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=Gy(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function br(e,t,n=zc){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Sp(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let d=qy(t,Number(u?.level??u?.lvl??0));if(!(d>0))continue;let f=gw(u.multiplier??u.mult??u.value??1,d),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=Et(i,f):p==="coin"||p==="coins"?s=Et(s,f):p==="mp"?l=Et(l,f):r=Et(r,f)}let a=jc(e);for(let u=0;u<a;u+=1)r=Et(r,ow);return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function Hy(e,t,n=zc){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Sp(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=qy(t,s),a=null;try{let u=BigInt(s),d=BigInt(Math.max(0,l)),f=u+BigInt(Ut)*d;f>0n&&(a=c.fromAny(f.toString()))}catch{}if(!a){let u=c.fromAny(Ut*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Ut*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Ut))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function Xy(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=hw[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function gs(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let f=Number(i);Number.isFinite(f)&&f>0&&(r=f)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let f=Math.pow(10,s);Number.isFinite(f)&&f>0&&(r=f)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let f=Math.exp(l);Number.isFinite(f)&&f>0&&(r=f)}if(!r){let f=Number(o.ratioMinus1);Number.isFinite(f)&&f>0&&(r=f+1)}let a=null;if(!r){let f=Xy(e);f&&(r=f.ratio,f.ratioLog10!=null&&(s=f.ratioLog10),a=f.preset)}if(r>1){r=Number(r),i=$y(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=De(n),d=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=d;try{let f=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),y=c.fromAny(e.costAtLevel?.(32)??0);f.cmp(p)===0&&f.cmp(y)===0&&(d.ratio=1,d.ratioMinus1=0,d.ratioLog10=0,d.ratioLn=0,d.ratioStr="1")}catch{}return d}catch{return null}}function $n(e,t){let n=gs(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Ne(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Ne(n.baseLog10+o*n.ratioLog10).floorToInteger()}function yw(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function Go(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=gs(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*as+t*o.ratioLn)/as;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*as+t*o.ratioLn,i=o.ratioLn*n,s=yw(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/as}function Yc(e,t,n){if(!(n>0))return c.fromInt(0);let o=gs(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=Go(e,t,l);a=a.add(Ne(u))}if(s>0){let u=t+l,d=c.fromAny(e.costAtLevel(u));for(let f=0;f<s;f+=1)a=a.add(d),f+1<s&&(d=d.mulDecimalFloor(o.ratioStr))}return a}let i=Go(e,t,n);return Ne(i)}function vw(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/as;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/as:e>0?e:0}function Wy(e){if(!(e>0)||!Number.isFinite(e))return e;if(rp[0]=e,rp[0]<=0)return 0;bw[0]-=1n;let t=rp[0];return t>0?t:0}function Sw(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=Wy(e);return n<e?n:e>1?e/2:0}function qc(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function Ga(e,t,n,o=ps,r={}){let i=gs(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Fe(t))),d=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,f=typeof o=="number"?o:Fe(o),p=Number.isFinite(d)?Math.max(0,d-u):op,y=Number.isFinite(f)?Math.max(0,Math.floor(f)):op;if(y=Math.min(y,op,p),!(y>0)){let oe=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:oe,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let oe=Math.min(y,m),$=c.fromAny(e.costAtLevel(u)),G=s,Z=0;for(;Z<oe;){$=c.fromAny(e.costAtLevel(u+Z));let he=G.add($);if(he.cmp(n)>0)break;G=he,Z+=1}let ue=u+Z,fe=Number.isFinite(d)&&ue>=d,x=qc(Z);if(Z<oe||fe||y<=Z){let he=fe?s:c.fromAny(e.costAtLevel(ue));return{count:x,spent:G,nextPrice:he,numericCount:Z}}let V=(()=>{try{return qo(t??u,u).add(x)}catch{return u+Z}})(),le=Ga(e,V,n.sub(G),y-Z,r),me=le?.count instanceof c?le.count:qc(le?.numericCount??0),K=x.add(me),te=(le?.spent??s).add(G);return{count:K,spent:te,nextPrice:le?.nextPrice??s,numericCount:Z+(le?.numericCount??0)}}let h=De(n),g=i.ratioLog10,S=i.ratioMinus1,L=c.fromAny(e.costAtLevel(u)),w=i.baseLog10+u*g;if(S>0&&(!Number.isFinite(h)||Math.abs(h)>1e6&&Math.abs(w)>1e6)){let oe=c.fromAny(e.costAtLevel(u));if(n.cmp(oe)<0)return{count:s,spent:s,nextPrice:oe,numericCount:0};let $=Number.isFinite(y)?Math.max(1,Math.floor(y)):Number.MAX_VALUE,G=1,Z=1;for(;Z<$;){let me=Go(e,u,Z);if(Ne(me).cmp(n)<=0){let te=Z*2;if(!Number.isFinite(te)||te<=Z){Z=$;break}G=Z,Z=Math.min(te,$)}else break}let ue=0;for(;G<Z&&ue<256;){let me=Math.max(G+1,Math.floor((G+Z+1)/2)),K=Go(e,u,me);Ne(K).cmp(n)<=0?G=me:Z=me-1,ue++}let fe=Math.max(1,G),x=qc(fe),V=s,le=s;if(!a)if(V=Yc(e,u,fe),Number.isFinite(d)){let me=Math.max(0,Math.floor(d-Math.min(u,d)));fe>=me?le=s:le=Ne(w+fe*g)}else le=Ne(w+fe*g);return{count:x,spent:V,nextPrice:le,numericCount:fe}}if(n.cmp(L)<0)return{count:s,spent:s,nextPrice:L,numericCount:0};let T=!1,Y=null,D=null;try{Y=c.fromAny(e.costAtLevel(u+1))}catch{}try{let oe=Math.min(Number.isFinite(d)?Math.max(u+1,Math.floor(d)):u+32,u+32);D=c.fromAny(e.costAtLevel(oe))}catch{}!T&&!(i.ratioMinus1>0)&&(T=!0),Y&&D&&(T=Y.cmp(L)===0&&D.cmp(L)===0),!T&&!(i.ratioMinus1>0)&&(T=!0);let B=Number.isFinite(y)?Math.max(0,Math.floor(y)):Number.MAX_VALUE;if(T){let oe=qo(e.lvlCapBn??"Infinity","Infinity"),$=qo(t??0,0),G=oe.isInfinite?.()?c.fromAny("Infinity"):oe.sub($).floorToInteger(),{count:Z,countBn:ue,spent:fe,nextPrice:x}=fp(L,n,G);return{count:ue,spent:fe,nextPrice:x,numericCount:Z}}if(!(g>0)||!(S>0)){let oe=qo(e.lvlCapBn??"Infinity","Infinity"),$=qo(t??0,0),G=oe.isInfinite?.()?c.fromAny("Infinity"):oe.sub($).floorToInteger(),{count:Z,countBn:ue,spent:fe,nextPrice:x}=fp(L,n,G);return{count:ue,spent:fe,nextPrice:x,numericCount:Z}}let C=Math.log10(S);if(!Number.isFinite(C))return{count:s,spent:s,nextPrice:L,numericCount:0};let R=vw(h+C-w)/g;(!Number.isFinite(R)||R<0)&&(R=0);let _=Math.floor(Math.min(B,R));Number.isFinite(_)||(_=B),_<=0&&(_=1);let X=1e-7,J=Go(e,u,_),ye=0,j=2048;for(;_>0&&(!Number.isFinite(J)||J>h+X)&&ye<j;){let oe=Number.isFinite(J)?Math.max(1,Math.ceil((J-h)/Math.max(g,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-oe));if($<_)_=$;else{let G=Wy(_);if(!(G<_))break;_=G}J=_>0?Go(e,u,_):Number.NEGATIVE_INFINITY,ye+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(L)>=0)_=1,J=De(L);else return{count:s,spent:s,nextPrice:L,numericCount:0};if(_<B){let oe=x=>{let V=x*2;return Number.isFinite(V)?V:Number.MAX_VALUE},$=_,G=Math.min(B,Math.max(_+1,oe(_))),Z=Go(e,u,G);for(;$<G&&Number.isFinite(Z)&&Z<=h+X&&G<B;)$=G,G=Math.min(B,oe(G)),Z=Go(e,u,G);let ue=$,fe=G;for(let x=0;x<256&&ue<fe;x+=1){let V=Math.floor((ue+fe+1)/2),le=Go(e,u,V);Number.isFinite(le)&&le<=h+X?(ue=V,J=le):fe=V-1}_=ue}let ae=null;if(!a){ae=Yc(e,u,_);let oe=0;for(;ae.cmp(n)>0&&_>0&&oe<j;){let $=Sw(_);if(!($<_))break;_=$,ae=Yc(e,u,_),oe+=1}if(_<=0)return{count:s,spent:s,nextPrice:L,numericCount:0};if(_<B&&oe<j)for(;_<B&&oe<j;){let $=u+_,G;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)G=c.fromAny(e.costAtLevel($));else{let ue=w+_*g;G=Ne(ue).floorToInteger()}}catch{break}let Z=ae.add(G);if(Z.cmp(n)>0)break;ae=Z,_+=1,oe+=1}}let xe=s,we=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(d)){let oe=Math.max(0,Math.floor(d-Math.min(u,d)));if(_>=oe)xe=s;else if(we){let $=Math.floor(u+_);xe=c.fromAny(e.costAtLevel($))}else{let $=w+_*g;xe=Ne($)}}else if(we){let oe=Math.floor(u+_);xe=c.fromAny(e.costAtLevel(oe))}else{let oe=w+_*g;xe=Ne(oe)}return{count:qc(_),spent:ae,nextPrice:xe,numericCount:_}}function Iw(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=De(t),r=De(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function fp(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let d=BigInt(o)/BigInt(r),f=c.fromAny(d.toString());!n.isInfinite?.()&&f.cmp(n)>0&&(f=n);let p=e.mulBigNumInteger(f);return{count:dp(f),countBn:f,spent:p,nextPrice:e}}let i=De(t),s=De(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Ne(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:dp(l),countBn:l,spent:a,nextPrice:u}}function ww(e,t,n,o){if(!n||o<=0)return{count:0};let r=De(t),i=De(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let h=0;h<64&&a<u;h+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let d=Math.min(a,o);if(d<=0)return{count:0};let f=i+d*n.ratioLog-n.logDenom;if(f>r)return{count:0};let p=i+d*n.ratioLog,y=Ne(f),m=Ne(p);return{count:d,spent:y,nextPrice:m,spentLog:f,nextPriceLog:p}}function qo(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function dp(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Ir(e){return ne(e instanceof c?e:c.fromAny(e??0))}function ht(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=De(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return ne(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):ne(c.fromAny(t))}catch{return"1"}}function fs(e){return Ir(e).replace(/<[^>]*>/g,"")}function Zc(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function ds(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=Zc(n??t??0),s=Zc(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Fe(i),newLevel:Number.isFinite(o)?o:Fe(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Ot(e,t){return $n(e,t)}function Yy(e,t=v()){return t==null?null:`ccc:upgrades:${e}:${t}`}function ti(e,t,n=v()){if(n==null)return null;let o=Ho(e),r=Ip(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function Ew(){ky.forEach(e=>{try{e?.()}catch{}}),ky.clear()}function Ty(e){Ew()}function xw(e,t){if(typeof localStorage>"u")return;let n=Yy(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=ti(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}}),console.log(`[UpgradeMigration] Migrated ${i} upgrades for area ${e} slot ${t}`)}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function Lw(e,t,n){xw(e,n);let o=ti(e,t,n);if(!o)return null;if(ls&&Ua.has(o))try{let r=Ua.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Sr.has(o))try{let r=Sr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function us(e,t,n,o=v(),r={}){let i=ti(e,t,o);if(i){if(ls){Ua.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Sr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Sr.has(i)&&Sr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{rt(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function _w(e,t,n=v()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&us(e,o.id,o,n)})}function Ip(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return qn(t.id);let n=qn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=Xo(n);if(o){let r=sp.get(o);if(r){let i=Ho(e);if(!i||Ho(r.area)===i)return qn(r.id)}}}return n}function zy(e,t,n=v()){let o=n==null?"null":String(n),r=Ip(e,t);return`${o}:${e}:${qn(r)}`}function oo(e,t){let n=Ip(e,t),o=qn(n),r=v(),i=zy(e,o,r),s=pp.get(i);if(s)return s;let l=ys(e,o),a=Lw(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,us(e,o,a,r)}let d=a.lvl,f=a.nextCost,p=a.nextCostLvl;a.lvl=cs(a.lvl),a.nextCost=cs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=cs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==d||a.nextCost!==f||a.nextCostLvl!==p)&&(u=!0);let y=0;l?.upgType==="HM"&&(y=hs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),eu(l,y));let m=lt(a.lvl),h=Fe(m);try{let N=l?.lvlCapBn??c.fromAny("Infinity");if(!N.isInfinite?.()&&m.cmp(N)>0){let T=N.clone?.()??N;h=Fe(T);let Y=T.toStorage();a.lvl=Y,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=Y,us(e,o,a,r)}}catch{}let g=null;try{g=m?.toStorage?.()??lt(h).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let S=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,L=!S||S!==g,w=null;if(!L&&a.nextCost!=null)try{w=c.fromAny(a.nextCost)}catch{w=null,L=!0}if(!w||L){if(l)try{w=c.fromAny(l.costAtLevel(h))}catch{w=c.fromInt(0)}else w=c.fromInt(0);try{a.nextCost=w.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{us(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let N=c.fromAny("Infinity");l.lvlCapBn=N,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Ir(N),l.lvlCapFmtText=fs(N)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:h,lvlBn:m,nextCostBn:w,slot:r,hmEvolutions:y},pp.set(i,s),s}function wr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??v();if(!n||o==null)return;let r=qn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??lt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Fe(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??lt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=lt(e.lvl??0).toStorage()}i.lvl=cs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=cs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=hs(e.hmEvolutions)),us(n,r,i,o,t),e.slot=o}function Vo(e,t,n=v()){pp.delete(zy(e,t,n))}function _t(e,t){return oo(e,t).lvl}function mp(e,t){return oo(e,t).hmEvolutions??0}function Ky(e,t){if(!t)return{locked:!1};let n=Uy(),o=n?ln():c.fromInt(0),r=n?Fe(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let d=pw(e,t),f="Unlock the XP system to reveal this upgrade",p=Dy();if(d)if(p)i={locked:!0,iconOverride:an,titleOverride:Zt,descOverride:f,reason:f,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let y='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:En,titleOverride:Gn,descOverride:y,reason:y,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:En,titleOverride:Gn,descOverride:f,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=np({locked:!1},i);if(typeof t.computeLockState=="function")try{let d={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,baseLocked:s.locked,getUpgradeLevel(p){return _t(e,p)}},f=t.computeLockState(d);s=np(s,f)}catch{}let l=v(),a=ms(e,t),u=a?Kc(e,t,l):!1;if(a){let d=lp(l),f=Jc(l),p=gp(l),y=a.replace(/_/g,"-"),m=$a(e,t),h=!1;ss(d,y,a)&&(h=!0),m&&ss(d,m,a)&&(h=!0),h&&cp(d,l);let g=!1;ss(f,y,a)&&(g=!0),m&&ss(f,m,a)&&(g=!0),g&&Qc(f,l);let S=!1;ss(p,y,a)&&(S=!0),m&&ss(p,m,a)&&(S=!0),S&&yp(p,l)}if(s.locked){let d=!!s.hidden;s.iconOverride||(s.iconOverride=En),d?s.titleOverride||(s.titleOverride=Zt):(!s.titleOverride||s.titleOverride===Zt)&&(s.titleOverride=Gn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:d&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===En||s.iconOverride===an)&&delete s.iconOverride,(s.titleOverride===Zt||s.titleOverride===Gn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=En),a){let d=lp(l),f=d.upgrades[a]||{},p=Xo(t?.tie??t?.tieKey),y=p&&Ry.has(p),m=p&&hp.has(p),h=f.status||"locked";if(Kc(e,t,l))h="unlocked";else if(Fy(e,t,l)&&h==="locked"){let C=!1;try{C=Fe(ln())>=31}catch{}let U=!1;try{U=Fe(ln())>=101}catch{}y&&!C||m&&!U?h="locked":h="mysterious"}let g=Gc(h),S=tp(s),L=Gc(S),w=()=>{s.locked=!0;let C=f.snapshot;C&&typeof C=="object"&&(s=np(s,C)),s.iconOverride=an,s.titleOverride=Zt;let U=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=U,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>L&&(h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):h==="mysterious"&&w(),S=tp(s),L=Gc(S));let N=!1,T=f&&typeof f=="object"&&typeof f.status=="string"?f.status:"locked",Y=y,D=!1;try{D=Fe(ln())>=31}catch{}let B=!1;try{B=Fe(ln())>=101}catch{}if((Y&&!D&&T==="mysterious"||m&&!B&&T==="mysterious")&&(T="locked"),(!f||typeof f!="object"||Object.keys(f).length!==1||f.status!==T)&&(d.upgrades[a]={status:T},N=!0),L>g){if(f.status=S,d.upgrades[a]={status:f.status},N=!0,h=S,g=L,S==="unlocked")ei(e,t,l);else if(S==="mysterious"){let C=!1;try{C=Fe(ln())>=31}catch{}(!y||C)&&up(e,t,l)}}h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===En||s.iconOverride===an)&&delete s.iconOverride,(s.titleOverride===Zt||s.titleOverride===Gn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,f.status!=="unlocked"&&(d.upgrades[a]={status:"unlocked"},N=!0),ei(e,t,l)):h==="mysterious"&&S!=="mysterious"&&(w(),S=tp(s),L=Gc(S)),N&&cp(d,l)}return s}function qa(e,t){return!!Ky(e,t).locked}function wp(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:jc(e),{capBn:r,cap:i}=Gy(o);try{return t?.cmp?.(r)>=0}catch{}let s=Fe(t);return Number.isFinite(s)&&s>=i}function Sn(e,t){let n=oo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():lt(n.lvl??0)}function jy(e,t){let n=oo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??lt(n.lvl??0),i=Fe(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function $o(e,t,n,o=!0,r={}){let i=oo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,eu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,d=Zc(i.lvlBn??lt(i.lvl??0)),f=lt(n);f.isInfinite?.()&&(f=c.fromAny("Infinity"));let p=f;try{s&&Ay(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=lt(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=lt(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let y=Fe(p);if(!s)return i.lvl=y,i.lvlBn=p,i.nextCostBn=c.fromInt(0),wr(i),Vo(e,t),no(),i.lvl;i.lvl=y,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(y))}catch{i.nextCostBn=c.fromInt(0)}return wr(i,{deferSave:r?.deferSave}),Vo(e,t),ds(s,u,d,i.lvl,i.lvlBn),no(),i.lvl}function Bt(e){return tu.filter(t=>t.area===e)}function ys(e,t){let n=Ho(e),o=qn(t),r=Xo(typeof o=="string"?o:t);return tu.find(i=>n&&Ho(i.area)!==n?!1:!!(qn(i.id)===o||r&&i.tieKey===r))||null}function Fo(e,t){let n=typeof t=="object"&&t?t:ys(e,t);return Ky(e,n)}function Cw(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function pc(e){return e?Cw(e.icon):""}function Mw(e,t){let n=ys(e,t),o=Sn(e,t),r=Fe(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Ia(e,t){let n=oo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(qa(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??lt(r),s=Zc(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(Ay(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),wr(n),Vo(e,t),no(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,d=u?O[u]:null,f=c.fromInt(0);if(d&&!a.isZero?.()){let y=d.value;if((y instanceof c?y:c.fromAny(y??0)).cmp(a)<0)return{bought:0,spent:0};f=a.clone?.()??c.fromAny(a),d.sub(f)}else{if(!a.isZero?.())return{bought:0,spent:0};f=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=Fe(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(f,n.lvl):o.costAtLevel(n.lvl)),wr(n),Vo(e,t),ds(o,r,s,n.lvl,n.lvlBn),no(),{bought:1,spent:f}}function od(e,t){let n=oo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??lt(n.lvl);if(!wp(o,r,n.hmEvolutions))return{evolved:!1};let i=hs(n.hmEvolutions)+1;n.hmEvolutions=i,eu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return wr(n),Vo(e,t),ds(o,n.lvl,r,n.lvl,r),no(),{evolved:!0}}function dc(e,t){let n=oo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(qa(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??lt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=O[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Ia(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let S=i.clone?.()??lt(i),L=Fe(S),w=S.toStorage?.(),N;if(o.upgType==="HM"){if(N=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let Y=c.fromAny("Infinity");o.lvlCapBn=Y,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Ir(Y),o.lvlCapFmtText=fs(Y)}}else{let Y=o.lvlCapBn?.clone?.()??qo(o.lvlCap??1/0,1/0);N=Y?.clone?.()??Y}let T=N.sub(S);if(T.isZero?.()){let Y=mw(N,S);Y.isZero?.()||(T=Y)}if(T.isZero?.()){let Y=N.toStorage?.();if(w&&Y&&w!==Y)if(N.isInfinite?.())try{T=c.fromAny("Infinity")}catch{T=c.fromInt(1)}else T=c.fromInt(1)}return n.lvlBn=N.clone?.()??N,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),O[o.costType].set(u),wr(n),Vo(e,t),ds(o,L,S,n.lvl,n.lvlBn),no(),{bought:T,spent:c.fromInt(0)}}let d=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(d)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(s)?Math.max(0,s-r):ps;if(!(f>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=Ga(o,i,u,f),y=p.count instanceof c?p.count:c.fromAny(p.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),h=u.sub(m);O[o.costType].set(h);let g=i.add(y);return n.lvlBn=g,n.lvl=Fe(g),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),wr(n),Vo(e,t),ds(o,r,i,n.lvl,n.lvlBn),no(),{bought:y,spent:m}}function wa(e,t,n){let o=oo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(qa(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??lt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=O[r.costType]?.value,d=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(d.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Fe(n):void 0,y=Number.isFinite(f)?Number.isFinite(p)?Math.min(f,p):f:p,m=Ga(r,s,d,y),h=m.count instanceof c?m.count:c.fromAny(m.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=m.spent??c.fromInt(0),S=d.sub(g);O[r.costType].set(S);let L=s.add(h);return o.lvlBn=L,o.lvl=Fe(L),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),wr(o),Vo(e,t),ds(r,i,s,o.lvl,o.lvlBn),no(),{bought:h,spent:g}}function zr(e,t,n,o=ps,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=Ga(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function no(){if(ls){ip=!0,Qd();return}Qd(),Ey()}function Pn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Ee.STARTER_COVE}function Ea(e,t){let n=ys(e,t);if(!n)return null;let o=Sn(e,t),r=Fe(o),i=Ir(o),s=fs(o),l=n.lvlCapBn??qo(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Ir(l),u=n.lvlCapFmtText??fs(l),d=r<n.lvlCap?jy(e,t):c.fromInt(0),f=Ir(d),p=O[n.costType]?.value,y=p instanceof c?p:c.fromAny(p??0),m=Fo(e,t),h=!!m.locked,g=m.titleOverride??n.title,S=m.descOverride??n.desc;if(e===Ke&&qn(t)===Dr){let T=gn(),Y=!1;if(T===1/0||typeof T=="string"&&T==="Infinity"?Y=!0:typeof T=="bigint"?Y=T>=2n:typeof T=="number"&&(Y=T>=2),Y&&S){let D=10,B=!1,C=gn();if(C===1/0||typeof C=="string"&&C==="Infinity"||C===Number.POSITIVE_INFINITY?B=!0:typeof C=="bigint"?B=C>=8n:typeof C=="number"&&(B=C>=8),B){let U=xt();D=Math.pow(10,U)}if(Math.abs(D-1)>1e-4){let U="10";D!==10&&(U=ht(D)),S=S.replace("Generates the equivalent of picking up a Coin on an interval",`Generates the equivalent of picking up ${U} Coins (Surge 2!) on an interval`)}}}let L=Sp(n,e),w="";typeof n.effectSummary=="function"&&!(h&&m.hideEffect)&&(w=n.effectSummary(r),typeof w=="string"&&(w=w.trim()));let N=m.iconOverride??pc(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:d,nextPriceFmt:f,have:y,haveFmt:O[n.costType]?.fmt(y)??String(y),effect:w,iconUrl:N,lockState:m,locked:h,areaKey:e,hmMilestones:L,displayTitle:g,displayDesc:S,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?mp(e,t):0,hmReadyToEvolve:n.upgType==="HM"?wp(n,o,mp(e,t)):!1,hmNextMilestone:n.upgType==="HM"?Hy(n,o,e):null}}function kw(e,t){let n=ys(e,t);if(!n||n.upgType!=="HM")return null;let o=Sn(e,t);return Hy(n,o,e)}function Tw(e){return Ne(De(e??0))}function td(e,t){let n=oo(e,t),o=n.upg;if(!o)return{bought:0};let r=Yy(e,n.slot);if(nn(r))return{bought:0};let i=ti(e,t,n.slot);if(nn(i))return{bought:0};if(qa(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??lt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&wp(o,l,n.hmEvolutions))return{bought:0};let d=O[o.costType]?.value,f=d instanceof c?d.clone?.()??c.fromAny(d):c.fromAny(d??0);if(f.isZero?.())return{bought:0};let p=Ga(o,l,f,ps),y=p.count instanceof c?p.count:c.fromAny(p.count??0);if(y.isZero?.())return{bought:0};let m=l.add(y);return rw(),$o(e,t,m,!0,{deferSave:!0}),{bought:y}}function rd(e,t){let n=oo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(qa(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??lt(n.lvl),i=Fe(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=O[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=zr(o,r,a,c.fromAny("Infinity")),d=u.numericCount;if(d<=0)return{bought:0,spent:c.fromInt(0)};let f=y=>{if(y<=0)return!0;let m=Yc(o,i,y-1),h=a.sub(m),g=i+y-1,S=c.fromAny(o.costAtLevel(g)),L=h.div(10);return S.cmp(L)<=0},p=0;if(d<2e3){let y=u.spent,m=d;for(;m>0;){let h=i+m-1,g=c.fromAny(o.costAtLevel(h)),S=y.sub(g),w=a.sub(S).div(10);if(g.cmp(w)<=0){p=m;break}y=S,m--}}else{let y=0,m=d;for(;y<m;){let h=Math.ceil((y+m)/2);f(h)?y=h:m=h-1}p=y}return p<=0?{bought:0,spent:c.fromInt(0)}:wa(e,t,p)}var ps,Ut,ow,zc,Ee,ls,Cy,Ua,ip,Sr,My,sw,ep,Se,Ny,aw,En,an,Zt,Gn,Ry,hp,lw,cw,uw,fw,Oy,Py,By,dw,Hc,Xc,Vc,sp,Z_,ap,$c,Vt,as,hw,op,Vy,rp,bw,tu,pp,ky,mn=qe(()=>{bt();Nt();Wt();Yn();mo();fo();Jn();$r();_y();ps=c.fromAny("Infinity"),Ut=1e3,ow=c.fromInt(1e3),zc="",Ee={STARTER_COVE:"starter_cove",AUTOMATION:Ke},ls=!1,Cy=new Map,Ua=new Map,ip=!1,Sr=new Map,My=null;sw=308;ep=1024;Se={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},Ny=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],aw={[Ee.STARTER_COVE]:Ny},En="img/misc/locked.webp",an="img/misc/mysterious.webp",Zt="Hidden Upgrade",Gn="Locked Upgrade",Ry=new Set([Se.COIN_VALUE_II,Se.XP_VALUE_II,Se.MP_VALUE_I,Se.MAGNET,Se.ENDLESS_XP]),hp=new Set([Se.COIN_VALUE_III,Se.XP_VALUE_III,Se.MP_VALUE_II,Se.FASTER_COINS_III,Se.ENDLESS_MP]),lw=new Set([Se.UNLOCK_XP,Se.UNLOCK_FORGE,Se.UNLOCK_INFUSE,Se.UNLOCK_SURGE,...Ry,...hp]),cw=new Set([Se.FASTER_COINS_II,Se.COIN_VALUE_I,Se.BOOK_VALUE_I,Se.XP_VALUE_I]),uw=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),fw="ccc:merchantMet",Oy="ccc:shop:reveals",Py="ccc:shop:permaUnlocks",By="ccc:shop:permaMyst",dw={locked:0,mysterious:1,unlocked:2},Hc=new Map,Xc=new Map,Vc=new Map,sp=new Map,Z_=Xo(Se.BOOK_VALUE_I),ap=c,$c=e=>ap.fromAny(e??0),Vt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=$c(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return ap.fromInt(1).add(r.mulDecimal(n))}catch{let i=De(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Ne(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=$c(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return ap.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number($c(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=$c(i);if(o>0){let l=De(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let d=Math.pow(n,a);if(Number.isFinite(d))return d}return Ne(u)}}catch{}try{let l=Fe(s),a=o*l;return Ne(a)}catch{return c.fromInt(1)}}}};as=Math.log(10);hw={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=jc(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=jc(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};op=(()=>{try{let e=Fe(ps);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),Vy=new ArrayBuffer(8),rp=new Float64Array(Vy),bw=new BigInt64Array(Vy);tu=[{area:Ee.STARTER_COVE,id:1,tie:Se.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(.1)},{area:Ee.STARTER_COVE,id:2,tie:Se.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:sn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Rr()}catch{}}},{area:Ee.STARTER_COVE,id:3,tie:Se.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(.1)},{area:Ee.STARTER_COVE,id:4,tie:Se.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(.5),onLevelChange(){try{pn()}catch{}}},{area:Ee.STARTER_COVE,id:5,tie:Se.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>Wc(e)>0?2:1,onLevelChange({newLevel:e}){Fa(e)}},{area:Ee.STARTER_COVE,id:6,tie:Se.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${ht(t)}x`},effectMultiplier:Vt.addFlatPerLevel(2)},{area:Ee.STARTER_COVE,id:7,tie:Se.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:sn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Kd()}catch{}}},{area:Ee.STARTER_COVE,id:8,tie:Se.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${ne(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(10),onLevelChange(){try{pn()}catch{}}},{area:Ee.STARTER_COVE,id:9,tie:Se.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:10,tie:Se.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:11,tie:Se.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=Wc(e),n=ht(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>Wc(e)},{area:Ee.STARTER_COVE,id:12,tie:Se.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Ut,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return $n(this,e)},nextCostAfter(e,t){return $n(this,t)},computeLockState:sn,effectSummary(e){let t=lt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=br(this,t,this.area),r=Et(n,o);return`XP value bonus: ${ht(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:13,tie:Se.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:sn,onLevelChange({newLevel:e}){if((e??0)>=1)try{jd()}catch{}}},{area:Ee.STARTER_COVE,id:14,tie:Se.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${ne(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(1e3)},{area:Ee.STARTER_COVE,id:15,tie:Se.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:16,tie:Se.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:17,tie:Se.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ot(this,e)},nextCostAfter(e,t){return Ot(this,t)},computeLockState:sn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${ht(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:18,tie:Se.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Ut,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return $n(this,e)},nextCostAfter(e,t){return $n(this,t)},computeLockState:sn,effectSummary(e){let t=lt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=br(this,t,this.area),r=Et(n,o);return`MP value bonus: ${ht(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:19,tie:Se.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:sn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Zd()}catch{}}},{area:Ee.STARTER_COVE,id:20,tie:Se.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Ut,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return $n(this,e)},nextCostAfter(e,t){return $n(this,t)},computeLockState(e){let t=gn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=ln();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:an,titleOverride:Zt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Gn,descOverride:"Locked"}},onLevelChange(){try{pn()}catch{}},effectSummary(e){let t=lt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=br(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${ht(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:21,tie:Se.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Ut,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return $n(this,e)},nextCostAfter(e,t){return $n(this,t)},computeLockState(e){let t=gn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=ln();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:an,titleOverride:Zt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Gn,descOverride:"Locked"}},onLevelChange(){try{pn()}catch{}},effectSummary(e){let t=lt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=br(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${ht(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:22,tie:Se.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Ut,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return $n(this,e)},nextCostAfter(e,t){return $n(this,t)},computeLockState(e){let t=gn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=ln();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:an,titleOverride:Zt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Gn,descOverride:"Locked"}},onLevelChange(){try{pn()}catch{}},effectSummary(e){let t=lt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=br(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${ht(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},...mh];for(let e of tu){let t=Xo(e.tie??e.tieKey);t&&!sp.has(t)&&sp.set(t,e),e.baseCost=qo(e.baseCost??0,0),e.baseCostBn=e.baseCost,e.numUpgEvolutions=hs(e.numUpgEvolutions),e.upgType==="HM"?eu(e,e.numUpgEvolutions):(e.lvlCapBn=qo(e.lvlCap??1/0,1/0),e.lvlCap=dp(e.lvlCapBn),e.lvlCapFmtHtml=Ir(e.lvlCapBn),e.lvlCapFmtText=fs(e.lvlCapBn)),e.bulkMeta=Iw(e),gs(e)}pp=new Map;ky=new Map;typeof window<"u"&&(Ty(v()),window.addEventListener("saveSlot:change",()=>{Ty(v()),no()}));Ly()});var _v={};yt(_v,{applyAllCurrencyOverridesForActiveSlot:()=>Za,applyStatMultiplierOverride:()=>_o,getDebugCurrencyMultiplierOverride:()=>Va,getDebugStatMultiplierOverride:()=>Ww,setDebugCurrencyMultiplierOverride:()=>hv,setDebugPanelAccess:()=>LE,setDebugStatMultiplierOverride:()=>Ln});function ja(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function Pw(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function Hn(e){typeof e=="function"&&Lp.push(e)}function cu(){return{sections:new Set,subsections:new Set}}function Bw(){let e=document.getElementById(Ya);if(!e)return cu();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function Fw(e){let{sections:t,subsections:n}=sv??cu();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function cv(){Lp.forEach(e=>{try{e?.()}catch{}}),Lp=[],Tp.length=0}function Ht(e){!e||typeof e.refresh!="function"||Tp.push(e)}function vt(e){Tp.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function Uw(){if(typeof window>"u")return;let e=f=>{let{key:p,slot:y}=f?.detail??{},m=y??v();vt(h=>h.type==="currency"&&h.key===p&&h.slot===m)};window.addEventListener("currency:change",e,{passive:!0}),Hn(()=>window.removeEventListener("currency:change",e));let t=f=>{let{key:p,slot:y}=f?.detail??{},m=y??v();vt(h=>h.type==="currency-mult"&&h.key===p&&h.slot===m)};window.addEventListener("currency:multiplier",t,{passive:!0}),Hn(()=>window.removeEventListener("currency:multiplier",t));let n=f=>{let{slot:p,changeType:y,unlocked:m}=f?.detail??{},h=p??v();vt(g=>g.type==="xp"&&g.slot===h),vt(g=>g.type==="stat-mult"&&g.key==="xp"&&g.slot===h),(y==="unlock"||typeof m=="boolean")&&vt(g=>g.type==="unlock"&&(g.slot==null||g.slot===h))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),Hn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=f=>{let{changeType:p,slot:y}=f?.detail??{},m=y??v();vt(h=>h.type==="mutation"&&h.slot===m),vt(h=>h.type==="stat-mult"&&h.key==="mutation"&&h.slot===m),p==="unlock"&&vt(h=>h.type==="unlock"&&(h.slot==null||h.slot===m))};window.addEventListener("mutation:change",o,{passive:!0}),Hn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let f=v();vt(p=>p.type==="upgrade"&&p.slot===f),vt(p=>p.type==="currency-mult"&&p.slot===f),vt(p=>p.type==="stat-mult"&&p.slot===f)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),Hn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let f=v();vt(p=>p.slot===f)};window.addEventListener("saveSlot:change",i,{passive:!0}),Hn(()=>window.removeEventListener("saveSlot:change",i));let s=f=>{let{slot:p,key:y}=f?.detail??{},m=p??v();vt(h=>h.type==="unlock"&&(h.slot==null||h.slot===m)&&(h.key==null||h.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),Hn(()=>window.removeEventListener("unlock:change",s));let l=f=>{let{slot:p}=f?.detail??{},y=p??v();vt(m=>m.type==="workshop-level"&&m.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),Hn(()=>window.removeEventListener("workshop:change",l));let a=f=>{let{slot:p}=f?.detail??{},y=p??v();vt(m=>m.type==="surge-level"&&m.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),Hn(()=>window.removeEventListener("surge:level:change",a));let u=f=>{let{slot:p}=f?.detail??{},y=p??v();vt(m=>m.type==="tsunami-nerf"&&(m.slot==null||m.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),Hn(()=>window.removeEventListener("surge:nerf:change",u));let d=f=>{let{slot:p}=f?.detail??{},y=p??v();vt(m=>m.type==="lab-level"&&(m.slot==null||m.slot===y))};window.addEventListener("lab:level:change",d,{passive:!0}),Hn(()=>window.removeEventListener("lab:level:change",d))}function uu(){return[{key:Ee.STARTER_COVE,title:"The Cove",currencies:[{key:Me.COINS,label:"Coins"},{key:Me.BOOKS,label:"Books"},{key:Me.GOLD,label:"Gold"},{key:Me.MAGIC,label:"Magic"},{key:Me.GEARS,label:"Gears"},{key:Me.WAVES,label:"Waves"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function uv(){if(document.getElementById(nu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=nu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=nu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=nu,document.head.appendChild(n)}function Cp(){let e=document.getElementById(iv);e&&e.remove()}function Dw(){return si&&je&&v()!=null&&!ja()&&Pw()}function $w(e){e?.detail?.visible&&So(),pu()}function ru(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${av++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function bo(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${lv++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Pt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Ap(e,t=v()){let n=t??v();return n==null?null:`${mt.CURRENCY[e]}:${n}`}function Xa(e,t=v()){let n=t??v();if(n==null)return c.fromInt(0);let o=O?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return qs(n,e)}catch{return c.fromInt(0)}}function Gw(e,t,n=v()){let o=n??v(),r=Xa(e,o);if(o==null||o!==v())return{previous:r,next:r};let i=Ap(e,o),s=i&&ro(i);s&&ws(i);let l=r;try{un(o),l=yi(e,t,{previous:r})??r,i&&rt(i)}catch{}finally{s&&ci(i)}return vt(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function Xn(e,t){return`${e??"null"}::${t}`}function Np(e,t){return za.get(Xn(e,t))??null}function qw(e,t=v()){let n=t??v();return!e||n==null?null:`${mt.MULTIPLIER[e]}:${n}`}function Hw(e,t=v()){let n=Xn(t,e);za.delete(n),Ss.delete(n),vt(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function Rp(e,t){let n=!fu(t,e),o=Xn(e,t),r=Wa.get(o);if(!n&&r)return r;let i=Xw(t,e);return i?(Wa.set(o,i),i):(n&&Wa.delete(o),null)}function fv(e,t){vt(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function dv(e,t=v()){let n=li(e,t);if(Wa.delete(Xn(t,e)),ni.delete(Xn(t,e)),!(!n||typeof localStorage>"u")&&!ro(n)){try{localStorage.removeItem(n)}catch{}fv(e,t)}}function fu(e,t=v()){return ro(li(e,t))}function pv(e,t){return fu(t,e)?Rp(e,t):null}function _n(e,t=v()){let n=ai(e);return du(e,t,n)??n}function li(e,t=v()){if(!e)return null;let n=t??v();return n==null?null:`${Aw}:${e}:${n}`}function ai(e){try{if(e==="xp"){let t=Ml();if(t)return t}else if(e==="mutation"){let t=hu?.();if(t)return t;let n=mu();if(n)return n}else if(e==="spawnRate"){let t=qi(Ee.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}}catch{}return c.fromInt(1)}function Xw(e,t=v()){let n=li(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function Vw(e,t,n){let o=li(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=ro(o),s=i&&bs?bs:localStorage.setItem.bind(localStorage);i&&!bs&&ws(o),s(o,r.toStorage?.()??String(r)),i&&!bs&&ci(o)}catch{}}function Op(e,t=v()){if(t==null)return;let n=Np(t,e);if(!n||t!==v())return;let o=Xn(t,e);if(!su.has(o)){su.add(o);try{let r=O?.[e]?.mult?.get?.();Pt(r,n)||O?.[e]?.mult?.set?.(n)}catch{}finally{su.delete(o)}}}function mv(){if(!(ev||typeof window>"u")){ev=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??v(),i=Xn(r,t);if(!r||!za.has(i)||su.has(i))return;let s=Ss.get(i),l=Np(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let d=u.div(a),f=d.sig===1n&&d.e===0&&d._eOffset===0n?1:null,p=l.mulBigNumInteger(d);za.set(i,p)}}catch{}Ss.set(i,o)}else o&&Ss.set(i,o);Op(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Za()},{passive:!0})}catch{}}}function Za(){let e=v();e!=null&&Object.values(Me).forEach(t=>{Op(t,e)})}function hv(e,t,n=v()){if(!e||n==null)return null;mv();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=Xn(n,e);if(za.set(r,o),!Ss.has(r)){let i=O?.[e]?.mult?.get?.();Ss.set(r,i)}return Op(e,n),o}function Va(e,t=v()){return!e||t==null?null:Np(t,e)}function Ln(e,t,n=v()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Wa.set(Xn(n,e),o),ni.set(Xn(n,e),ai(e)),Vw(e,n,o),fv(e,n),o}function Ww(e,t=v()){return!e||t==null?null:Rp(t,e)}function _o(e,t,n=v()){let o=ai(e),r=du(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Pt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=Xn(n,e),l=ni.get(s),a=fu(e,n)&&l?l:o,u=null;try{let d=c.fromAny(r),f=c.fromAny(a);f.isZero()||(u=d.div(f))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function du(e,t,n){let o=Rp(t,e),r=Xn(t,e);if(!o)return ni.delete(r),null;let i=ni.get(r),s=fu(e,t);if(!i)ni.set(r,n);else if(!Pt(i,n))return s?(ni.set(r,n),o):(dv(e,t),null);return o}function Yw(){if(!(Jy||typeof localStorage>"u")){Jy=!0;try{bs=localStorage.setItem.bind(localStorage),Qy=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!Is.has(e))return bs(e,t)},localStorage.removeItem=e=>{if(!Is.has(e))return Qy(e)}}catch{}}}function ro(e){return e!=null&&Is.has(e)}function ci(e){e&&(Yw(),Is.add(e))}function ws(e){e&&Is.delete(e)}function zw(e){return e?ro(e)?(ws(e),!1):(ci(e),!0):!1}function Kw(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=ro(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(zw(e),typeof t=="function")try{t(ro(e))}catch{}o()}),o(),{button:n,refresh:o}}function jw(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>ro(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>ro(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?ws(u):ci(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function Zw(){let e=document.getElementById(Ya);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function Jw(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{ro(r)&&(o.push(r),ws(r))});try{return t?.()}finally{o.forEach(r=>ci(r))}}function Qw(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function Pp(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Mp(e,t){e.classList.toggle("debug-invalid",!t)}function Qe(){let e=v();try{un(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function gv(e=v()){return e==null?null:`${Nw}:${e}`}function yv(e=v()){let t=gv(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function vv(e,t=v()){let n=gv(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,_p);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function eE(e,t=v()){let n=yv(t);return n.unshift(e),n.length>_p&&(n.length=_p),vv(n,t),n}function et(e){let t=v();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};eE(o,t),Bp()}function Bp(){if(!vs)return;let e=yv();if(e.length===0){vs.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",vs.appendChild(t);return}vs.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function bv(e=v()){return e==null?null:`${ya}:${e}`}function Sv(e,t=v()){let n=bv(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function Iv(e=v()){let t=bv(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function tE(e){if(e){if(Object.values(Me).includes(e.type)){try{e.type===Me.BOOKS?O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount):O[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function nE(){let e=v();if(e==null)return{completed:0};let t=Iv(e),n=0;return Object.entries(Jl).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,tE(r.reward))}),Sv(t,e),{completed:n}}function oE(){let e=v();if(e==null)return{restored:0};let t=Iv(e),n=0;return Object.entries(Jl).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),Sv(t,e),{restored:n}}function xn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let d=!1,f=null,p=!1,y=r?Kw(r,{onToggle:i}):null,m=g=>{if(d){f=g;return}f=null,u.value=typeof s=="function"?s(g):Qw(g)};l.appendChild(u),y&&l.appendChild(y.button);let h=()=>{let g=Pp(u.value);if(!g){Mp(u,!1);return}Mp(u,!0);let S=r&&ro(r);S&&ws(r);try{n(g,{input:u,setValue:m})}finally{S&&ci(r),y&&y.refresh()}};return u.addEventListener("focus",()=>{d=!0}),u.addEventListener("change",h),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),p=!0,h(),u.blur())}),u.addEventListener("blur",()=>{if(d=!1,p||h(),p=!1,f!=null){let g=f;f=null,m(g)}}),m(t),y&&y.refresh(),{row:l,input:u,setValue:m,isEditing:()=>d}}function rE({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let d=document.createElement("div");d.className="debug-unlock-text";let f=document.createElement("span");if(f.className="debug-unlock-title",f.textContent=e,d.appendChild(f),t){let h=document.createElement("span");h.className="debug-unlock-desc",h.textContent=`- ${t}`,d.appendChild(h)}s.appendChild(l),s.appendChild(d);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",h=>{l.contains(h.target)||p()});let y=!1,m=()=>{let h=!1;try{h=typeof n=="function"?!!n():!1}catch{}return a.checked=h,y=h,h};return a.addEventListener("change",()=>{let h=y,g=a.checked;try{g?o?.():r?.()}catch{}Qe();let S=m();h!==S&&et(`Toggled ${e} [GOLD]${h?"True":"False"}[/GOLD] \u2192 [GOLD]${S?"True":"False"}[/GOLD]`)}),m(),Ht({type:"unlock",slot:i,refresh:m}),s}function iE(e){try{if(e instanceof c||typeof e?.toScientific=="function")return ne(e);let t=Number(e);return Number.isFinite(t)?ne(t):String(e??"\u2014")}catch{return"\u2014"}}function sE({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},d=!1;if(l.forEach(({config:f,el:p})=>{if(f.type==="select"){u[f.key]=p.value;return}let y=Pp(p.value),m=y instanceof c;if(Mp(p,m),!m){d=!0;return}u[f.key]=y}),d||typeof n!="function"){s.textContent="\u2014";return}try{let f=n(u);s.innerHTML=iE(f)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let d=Object.assign({type:"text",defaultValue:""},u);if(d.key)if(d.type==="select"){let f=document.createElement("select");f.className="debug-panel-input",(d.options||[]).forEach(({value:p,label:y})=>{let m=document.createElement("option");m.value=p,m.textContent=y??p,d.defaultValue!=null&&d.defaultValue===p&&(m.selected=!0),f.appendChild(m)}),f.addEventListener("change",a),i.appendChild(f),l.push({config:d,el:f})}else{let f=document.createElement("input");f.type="text",f.className="debug-panel-input",f.placeholder=d.label||"",f.value=d.defaultValue??"",f.addEventListener("input",a),f.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(f),l.push({config:d,el:f})}}),a(),o}function Er({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return Ze()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Rr()}catch{}let d=oi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),s!=null)try{let f=s.toStorage?.()??c.fromAny(s).toStorage(),p=oi.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(l!=null)try{let f=l.toStorage?.()??c.fromAny(l).toStorage(),p=oi.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Li({forceReload:!0})}catch{}try{_l({changeType:"debug-panel",slot:n})}catch{}try{vt()}catch{}}function xr({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return at()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let f=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!f&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Ka(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Xt()}catch{}try{vr()}catch{}let d=ri.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),e!=null)try{let f=e.toStorage?.()??c.fromAny(e).toStorage(),p=ri.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(t!=null)try{let f=t.toStorage?.()??c.fromAny(t).toStorage(),p=ri.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Xt({forceReload:!0})}catch{}try{Fp({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{vt()}catch{}}function aE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=Ap(r.key,n),s=Xa(r.key,n),l=xn(r.label,s,(a,{setValue:u})=>{let d=v();if(d==null)return;let f=Xa(r.key,d),{next:p}=Gw(r.key,a,d);u(p),Pt(f,p)||(Qe(),et(`Modified ${r.label} (${o}) ${ne(f)} \u2192 ${ne(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(Xa(r.key,v()))});Ht({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let a=Xa(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function lE(e,t){let n=v();if(n==null){let D=document.createElement("div");D.className="debug-panel-empty",D.textContent="Select a save slot to edit stats.",e.appendChild(D);return}let o="spawnRate",r=li(o,n),i=xn("Coin Spawn Rate",_n(o,n),(D,{setValue:B})=>{let C=v();if(C==null)return;let U=_n(o,C);try{Ln(o,D,C)}catch{}let R=_n(o,C);B(R),Pt(U,R)||(Qe(),et(`Modified Spawn Rate (${a}) ${ne(U)} \u2192 ${ne(R)}`))},{storageKey:r,onLockChange:D=>{let B=v();if(B!=null){if(D){if(pv(B,o))return;try{Ln(o,ai(o),B)}catch{}}else du(o,B,ai(o));i.setValue(_n(o,B))}}});Ht({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==v())return;let D=_n(o,n);i.setValue(D)}}),Ht({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==v())return;let D=_n(o,n);i.setValue(D)}}),e.appendChild(i.row);let s=Ze(),l=at(),a=t?.title??t?.key??"Unknown Area",u=oi.level(n),d=xn("XP Level",s.xpLevel,(D,{setValue:B})=>{let C=Ze().xpLevel;Er({level:D});let U=Ze();B(U.xpLevel),Pt(C,U.xpLevel)||(Qe(),et(`Modified XP Level (${a}) ${ne(C)} \u2192 ${ne(U.xpLevel)}`))},{storageKey:u});Ht({type:"xp",slot:n,refresh:()=>{n===v()&&d.setValue(Ze().xpLevel)}}),e.appendChild(d.row);let f=oi.progress(n),p=xn("XP Progress",s.progress,(D,{setValue:B})=>{let C=Ze(),U=C?.xpLevel?.clone?.()??C?.xpLevel,R=C?.progress?.clone?.()??C?.progress;Er({progress:D});let _=Ze();B(_.progress),d.setValue(_.xpLevel),(!Pt(R,_.progress)||!Pt(U,_.xpLevel))&&(Qe(),et(`Modified XP Progress (${a}) ${ne(R)} \u2192 ${ne(_.progress)}`))},{storageKey:f});Ht({type:"xp",slot:n,refresh:()=>{n===v()&&p.setValue(Ze().progress)}}),e.appendChild(p.row);let y=ri.level(n),m=xn("MP Level",l.level,(D,{setValue:B})=>{let C=at().level;xr({level:D});let U=at();B(U.level),Pt(C,U.level)||(Qe(),et(`Modified MP Level (${a}) ${ne(C)} \u2192 ${ne(U.level)}`))},{storageKey:y});Ht({type:"mutation",slot:n,refresh:()=>{n===v()&&m.setValue(at().level)}}),e.appendChild(m.row);let h=ri.progress(n),g=xn("MP Progress",l.progress,(D,{setValue:B})=>{let C=at(),U=C?.level?.clone?.()??C?.level,R=C?.progress?.clone?.()??C?.progress;xr({progress:D});let _=at();B(_.progress),m.setValue(_.level),(!Pt(R,_.progress)||!Pt(U,_.level))&&(Qe(),et(`Modified MP Progress (${a}) ${ne(R)} \u2192 ${ne(_.progress)}`))},{storageKey:h});Ht({type:"mutation",slot:n,refresh:()=>{n===v()&&g.setValue(at().progress)}}),e.appendChild(g.row);let S=Hr(n);if(S){let D=0;try{let C=localStorage.getItem(S),U=c.fromAny(C||"0");if(U.isInfinite())D=1/0;else try{D=Number(U.toScientific(20))}catch{D=0}}catch{}let B=xn("Workshop Level",D,(C,{setValue:U})=>{let R=Number(C);if(console.log("[DebugPanel] Workshop Level Commit. Value type:",typeof C,"IsBigNum:",C instanceof c,"Value:",C),C instanceof c)if(C.isInfinite())R=1/0;else try{R=Number(C.toScientific(20))}catch{R=NaN}if(Number.isNaN(R)||R<0)return;let _=R===1/0?"Infinity":String(Math.floor(R));try{localStorage.setItem(S,_),Qe(),et(`Modified Workshop Level (The Cove) ${ne(D)} \u2192 ${_}`),D=R}catch{}U(R)},{storageKey:S,onLockChange:()=>{let C=0;try{let U=localStorage.getItem(S),R=c.fromAny(U||"0");R.isInfinite()?C=1/0:C=Number(R.toScientific(20))}catch{}B.setValue(C)}});e.appendChild(B.row),Ht({type:"workshop-level",slot:n,refresh:()=>{if(n!==v())return;let C=0;try{let U=localStorage.getItem(S),R=c.fromAny(U||"0");R.isInfinite()?C=1/0:C=Number(R.toScientific(20))}catch{}B.setValue(C)}})}let L=os(n);if(L){let D=0;try{let C=localStorage.getItem(L);C==="Infinity"?D=1/0:D=c.fromAny(C||"0")}catch{D=c.fromInt(0)}let B=xn("Surge Level",D,(C,{setValue:U})=>{let R="0",_=0;C instanceof c?C.isInfinite()?(R="Infinity",_=1/0):(R=C.toPlainIntegerString(),_=C):C===1/0||typeof C=="string"&&/infinity/i.test(C)?(R="Infinity",_=1/0):(R=String(C),_=C);try{localStorage.setItem(L,R),Qe();let X=_===1/0?"Infinity":ne(_),J=D===1/0||D instanceof c&&D.isInfinite()?"Infinity":ne(D);et(`Modified Surge Level (The Cove) ${J} \u2192 ${X}`),_===1/0?D=1/0:_ instanceof c?D=_:D=c.fromAny(_)}catch{}U(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let X=D;if(X!==1/0&&X instanceof c)try{X=BigInt(X.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:X}}))}catch{}},{storageKey:L,onLockChange:C=>{let U=c.fromInt(0);try{let R=localStorage.getItem(L);R==="Infinity"?U=1/0:U=c.fromAny(R||"0")}catch{}B.setValue(U)}});Ht({type:"surge-level",slot:n,refresh:()=>{if(n!==v())return;let C=c.fromInt(0);try{let U=localStorage.getItem(L);U==="Infinity"?C=1/0:C=c.fromAny(U||"0")}catch{}B.setValue(C)}}),e.appendChild(B.row)}let w=ho(),N=xn("Lab Level",w,(D,{setValue:B})=>{let C;try{C=D instanceof c?D:c.fromAny(D),C.isNegative&&C.isNegative()&&(C=c.fromInt(0))}catch{B(ho());return}let U=ho();ha(C),Qe(),Pt(U,C)||et(`Modified Lab Level (The Cove) ${ne(U)} \u2192 ${ne(C)}`),B(C)},{storageKey:Of(n)});Ht({type:"lab-level",slot:n,refresh:()=>{n===v()&&N.setValue(ho())}}),e.appendChild(N.row);let T=xt(),Y=xn("Tsunami Exponent",T.toFixed(2),(D,{setValue:B})=>{let C=Number(D);if(D instanceof c?D.isInfinite()?C=1/0:C=Number(D.toScientific(10)):typeof D=="string"&&/infinity/i.test(D)&&(C=1/0),Number.isNaN(C)){B(xt().toFixed(2));return}(C>1||C===1/0)&&(C=1),C<0&&(C=0),C=Math.round(C*100)/100;let U=xt();Di(C),Qe(),Math.abs(U-C)>1e-4&&et(`Modified Tsunami Exponent (The Cove) ${U.toFixed(2)} \u2192 ${C.toFixed(2)}`),B(C.toFixed(2))},{storageKey:Mf(n),format:D=>{let B=Number(D);return Number.isFinite(B)?B.toFixed(2):String(D)}});Ht({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==v())return;let D=xt();Y.setValue(D.toFixed(2))}}),e.appendChild(Y.row)}function tv(e,t){let n=v();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Bt(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=Sn(t.key,i.id??i.tie),u=ti(t.key,i.id??i.tie,n),d=xn(l,a,(f,{setValue:p})=>{if(v()==null)return;let m=Sn(t.key,i.id??i.tie);try{$o(t.key,i.id??i.tie,f,!1)}catch{}let h=Sn(t.key,i.id??i.tie);p(h),Pt(m,h)||(Qe(),et(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${ne(m)} \u2192 Lv${ne(h)}`))},{idLabel:s,storageKey:u});Ht({type:"upgrade",slot:n,refresh:()=>{if(n!==v())return;let f=Sn(t.key,i.id??i.tie);d.setValue(f)}}),e.appendChild(d.row)})}function cE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=O?.[r.key]?.mult,l=Va(r.key,n)??i?.get?.()??c.fromInt(1),a=`${mt.MULTIPLIER[r.key]}:${n}`,u=xn(`${r.label} Multiplier`,l,(d,{setValue:f})=>{let p=v();if(p==null)return;let y=Va(r.key,p)??i?.get?.()??c.fromInt(1);try{hv(r.key,d,p)}catch{}Za();let h=Va(r.key,p)??i?.get?.()??c.fromInt(1);f(h),Pt(y,h)||(Qe(),et(`Modified ${r.label} Multiplier (${o}) ${ne(y)} \u2192 ${ne(h)}`))},{storageKey:a});Ht({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let f=Va(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(f)}}),e.appendChild(u.row)})}function uE(){if(v()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Me).forEach(o=>{let r=O?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Pt(i,t))return;r.set(t),n+=1}catch{}}),n}function fE(){if(v()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Me).forEach(o=>{let r=O?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function dE(){let e=v();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=Ze()}catch{}try{r=at()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Pt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Pt(o?.progress,t);(!i||!s)&&(Er({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Pt(r?.level,t),s=r?.progress?.isInfinite?.()||Pt(r?.progress,t);(!i||!s)&&(xr({level:t,progress:t}),n+=1)}}catch{}try{let i=Hr(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=os(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{vt()}catch{}return n}function pE(){let e=v();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=Ze()}catch{}try{r=at()}catch{}try{o?.unlocked&&(Er({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(xr({level:t,progress:t}),n+=1)}catch{}try{let i=Hr(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=os(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{vt()}catch{}return n}function wv(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Ze()?.unlocked}catch{return!1}},onEnable:()=>{try{Rr()}catch{}try{Li({forceReload:!0})}catch{}},onDisable:()=>{try{_i({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Ka(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{Ka(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return ad()}catch{return!1}},onEnable:()=>{try{Kr()}catch{}},onDisable:()=>{try{gc()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return ld()}catch{return!1}},onEnable:()=>{try{hc()}catch{}},onDisable:()=>{try{yc()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return zf()}catch{return!1}},onEnable:()=>{try{jl(!0)}catch{}},onDisable:()=>{try{jl(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!hn()}catch{return!1}},onEnable:()=>{try{sr(!0)}catch{}},onDisable:()=>{try{sr(!1)}catch{}},slot:e}]}function Ev(e){let t=v();if(t==null)return 0;let n=0;wv(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{vt()}catch{}return n}function mE(){let e=v();if(e==null)return{unlocks:0,toggles:0};let t=0;uu().forEach(o=>{Bt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{ei(o.key,r,e),t+=1}catch{}})});try{Kr()}catch{}try{hc()}catch{}let n=Ev(!0);return{unlocks:t,toggles:n}}function hE(){let e=v();if(e==null)return{locks:0,toggles:0};let t=0;uu().forEach(o=>{Bt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{vp(o.key,r,e),t+=1}catch{}})});try{gc()}catch{}try{yc()}catch{}let n=Ev(!1);return{locks:t,toggles:n}}function gE(e,t=v()){let n=t??v();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(Ap(a,n)),r(qw(a,n))},s=a=>r(li(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(oi.level(n)),r(oi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(ri.level(n)),r(ri.progress(n)))};return e==="all"?(Object.values(Me).forEach(i),l("xp"),l("mutation"),lu.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Me).forEach(i),Array.from(o)):e==="allUnlockedStats"?(Ze()?.unlocked&&l("xp"),at()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Me).forEach(i),Ze()?.unlocked&&l("xp"),at()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function iu(e){try{O?.[e]?.set?.(c.fromInt(0))}catch{}try{Hw(e)}catch{}try{yl(e,c.fromInt(1))}catch{}}function yE(e){if(e==="all"){Object.values(Me).forEach(i=>iu(i));let o=c.fromInt(0);return Er({level:o,progress:o}),xr({level:o,progress:o}),lu.forEach(({key:i})=>{try{Ln(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Me).length+lu.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Me).forEach(i=>{iu(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(Ze()?.unlocked){Er({level:o,progress:o});try{Ln("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(at()?.unlocked){xr({level:o,progress:o});try{Ln("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Me).forEach(l=>{iu(l),o+=1});let r=c.fromInt(0),i=0;try{if(Ze()?.unlocked){Er({level:r,progress:r});try{Ln("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(at()?.unlocked){xr({level:r,progress:r});try{Ln("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return iu(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{dv(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Er({level:n,progress:n});try{Ln("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){xr({level:n,progress:n});try{Ln("mutation",c.fromInt(1))}catch{}return"MP"}try{Ln(t,c.fromInt(1))}catch{}return`stat ${t}`}function vE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";lu.forEach(r=>{if(r.key==="spawnRate")return;let i=li(r.key,n),s=xn(`${r.label} Multiplier`,_n(r.key,n),(l,{setValue:a})=>{let u=v();if(u==null)return;let d=_n(r.key,u);try{Ln(r.key,l,u)}catch{}let f=_n(r.key,u);a(f),Pt(d,f)||(Qe(),et(`Modified ${r.label} Multiplier (${o}) ${ne(d)} \u2192 ${ne(f)}`))},{storageKey:i,onLockChange:l=>{let a=v();if(a!=null){if(l){if(pv(a,r.key))return;try{Ln(r.key,ai(r.key),a)}catch{}}else du(r.key,a,ai(r.key));s.setValue(_n(r.key,a))}}});Ht({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=_n(r.key,n);s.setValue(l)}}),Ht({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=_n(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Ht({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=_n(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function bE(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Cl(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>lf(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Up(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>ns(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>rr(n)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>bp(n,o,r)}]}].forEach(n=>{let o=bo(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=sE({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function SE(e){if(e.innerHTML="",v()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Za(),uu().forEach(o=>{let r=bo(o.title,i=>{let s=bo("Currencies",p=>{aE(p,o)}),l=bo("Stats",p=>{lE(p,o)}),a=bo("Multipliers",p=>{let y=bo("Currencies",h=>{cE(h,o)}),m=bo("Stats",h=>{vE(h,o)});p.appendChild(y),p.appendChild(m)}),u=bo("Upgrades",p=>{tv(p,o)}),d=null;o.key===Ee.STARTER_COVE&&(d=bo("Automation Upgrades",p=>{tv(p,{key:Ee.AUTOMATION,title:"Automation"})}));let f=bo("Calculators",p=>{bE(p)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),d&&i.appendChild(d),i.appendChild(f)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function nv(e=!1){if(v()==null)return 0;let n=0,o=Object.values(Ee),r=[];return o.forEach(i=>{Bt(i).forEach(l=>{e&&Fo(i,l.id).locked||r.push({areaKey:i,upg:l})})}),Da(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;$o(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function ov(e=!1){if(v()==null)return 0;let n=0,o=Object.values(Ee),r=[];o.forEach(s=>{Bt(s).forEach(a=>{e&&Fo(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{Da(()=>{r.forEach(({areaKey:s,upg:l})=>{try{hr(s,l.id,"0"),$o(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function rv(e){let t=v();if(t==null)return 0;let n=e?"1":"0",o=0,r=Bt(Ke);Da(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;$o(Ke,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(Ri),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Ee).forEach(l=>{if(l===Ke)return;Bt(l).forEach(u=>{s.has(u.costType)&&(hr(l,u.id,n),o++)})}),hr(Ke,Kn,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function IE(e){e.innerHTML="";let t=v();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=nE();Qe(),et(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=oE();Qe(),et(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=uE();Qe(),et(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=dE();Qe(),et(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=fE();Qe(),et(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=pE();Qe(),et(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let g=nv(!0);Qe(),et(`Maxed ${g} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let g=ov(!0);Qe(),et(`Reset ${g} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let g=nv(!1);Qe(),et(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=ov(!1);Qe(),et(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=rv(!0);Qe(),et(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=rv(!1);Qe(),et(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:S}=mE();Qe(),et(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${S} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:S}=hE();Qe(),et(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${S} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{vv([],t),Bp(),Qe(),et("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=v();if(g!=null)try{localStorage.setItem(Rw(g),String(Ow)),Ao(!0),Qe(),et("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let S=Pp(g);if(!S||typeof S.isZero=="function"&&S.isZero()||typeof S.isNegative=="function"&&S.isNegative())return;let L,w=!1;Ft()?L=$i(S):(L=Gl(S),w=!0),Vr(L);let N=S.mulSmall?S.mulSmall(1e3):S.mulBigNumInteger(c.fromInt(1e3));lr(L,N,w),Qe(),et(`Performed OP Time Warp for ${ne(S)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let S=document.createElement("button");S.type="button",S.className="debug-panel-toggle debug-misc-button",S.textContent=g.label,S.addEventListener("click",g.onClick),o.appendChild(S)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",uu().forEach(g=>{let S=document.createElement("optgroup");S.label=g.title||g.key,g.currencies.forEach(L=>{let w=document.createElement("option");w.value=`currency:${L.key}`,w.textContent=`${g.title||g.key} \u2192 ${L.label}`,S.appendChild(w)}),g.stats.forEach(L=>{let w=document.createElement("option");w.value=`stat:${L.key}`,w.textContent=`${g.title||g.key} \u2192 ${L.label}`,S.appendChild(w)}),s.appendChild(S)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let d=document.createElement("option");d.value="all",d.textContent="All",s.appendChild(d),s.querySelector(`option[value="${ou}"]`)||(ou=Ha),s.value=ou;let f=()=>gE(s.value||Ha,v()),p=jw(f);s.addEventListener("change",()=>{ou=s.value||Ha,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle reset-check",y.textContent="\u2705",y.addEventListener("click",()=>{let g=s.value||Ha,S=f(),L=p.isLocked(),w=(N=!0)=>{let T=Jw(S,()=>yE(g))??{label:g,count:0};if(L&&S.forEach(Y=>ci(Y)),p.refresh(),Qe(),N){let{label:Y,count:D}=T;et(`Reset ${D===1?"value and multiplier":"values and multipliers"} for ${Y} to defaults.`)}};w(!0),setTimeout(()=>w(!1),100)}),r.appendChild(y),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle debug-danger-button",h.textContent="Wipe Slot & Refresh",h.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let S=document.querySelector(".menu-root"),L=document.getElementById("game-root");S&&(S.hidden=!1,S.style.display="",S.style.visibility=""),L&&(L.hidden=!0,L.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(h),e.appendChild(m)}function wE(e){e.innerHTML="";let t=v();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Li()}catch{}let n=wv(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(rE(o))})}function xv(){if(!si||ja())return;cv(),uv(),av=0,lv=0;let e=document.getElementById(Ya);e&&e.remove();let t=document.createElement("div");t.id=Ya,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>So({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>So()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:d,hideOnMobile:f})=>{let p=document.createElement("div");p.className="debug-panel-info-line",f&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=d,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(ru("Areas: main currency/stat/upgrade management for each area","debug-areas",d=>{SE(d)})),t.appendChild(ru("Unlocks: modify specific unlock flags","debug-unlocks",d=>{wE(d)})),t.appendChild(ru("Action Log: keep track of everything you do","debug-action-log",d=>{let f=document.createElement("div");f.id="action-log-entries",f.className="debug-panel-action-log",f.style.maxHeight="240px",f.style.overflowY="auto",d.appendChild(f),vs=f,Bp(),Hn(()=>{vs=null})})),t.appendChild(ru("Miscellaneous: helpful miscellaneous functions","debug-misc",d=>{IE(d)})),Fw(t),document.body.appendChild(t),au>0)try{t.scrollTop=au}catch{}Uw(),ii=!0}function kp(){if(!(!si||ja())){if(v()==null){So();return}ii||xv()}}function So({preserveExpansionState:e=!1}={}){sv=e?Bw():cu();let t=document.getElementById(Ya);if(t){try{au=t.scrollTop??0}catch{au=0}t.remove()}cv(),ii=!1}function EE(){if(!si||ja()||v()==null){So();return}ii?So({preserveExpansionState:!0}):kp()}function xE(){So(),Cp()}function pu(){if(!Dw()){Cp(),So();return}uv(),Cp();let e=document.createElement("button");e.id=iv,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{EE()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function Lv(e){if(si=!!e,!si){xE();return}pu()}function LE(e){Lv(e)}var nu,Ya,iv,Ha,ii,si,Lp,sv,au,ou,av,lv,Tp,vs,za,Ss,su,Wa,ni,Is,Jy,bs,Qy,Aw,Nw,_p,Rw,Ow,Ep,oi,xp,ri,lu,ev,js=qe(()=>{Nt();Wt();bt();Yn();mo();po();mn();vc();tc();Fi();fo();Jn();rc();$r();Nf();Wl();ql();nu="debug-panel-style",Ya="debug-panel",iv="debug-panel-toggle",Ha=`currency:${Me.COINS}`,ii=!1,si=!1,Lp=[],sv=cu(),au=0,ou=Ha,av=0,lv=0,Tp=[],vs=null,za=new Map,Ss=new Map,su=new Set,Wa=new Map,ni=new Map,Is=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=Is);Jy=!1,bs=null,Qy=null,Aw="ccc:debug:stat-mult",Nw="ccc:actionLog",_p=100,Rw=e=>`ccc:warp:charges:${e}`,Ow=24;Ep="ccc:xp",oi={unlock:e=>`${Ep}:unlocked:${e}`,level:e=>`${Ep}:level:${e}`,progress:e=>`${Ep}:progress:${e}`},xp="ccc:mutation",ri={unlock:e=>`${xp}:unlocked:${e}`,level:e=>`${xp}:level:${e}`,progress:e=>`${xp}:progress:${e}`},lu=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}];ev=!1;Za();mv();Lv(!1);document.addEventListener("keydown",e=>{if(!(!si||ja())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&v()!=null){if(e.shiftKey){ii?(Zw(),So()):kp(),e.preventDefault();return}ii?So({preserveExpansionState:!0}):kp(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{pu()});window.addEventListener("menu:visibilitychange",$w);window.addEventListener("saveSlot:change",()=>{pu(),ii&&xv()})});var Tv={};yt(Tv,{addExternalMutationGainMultiplierProvider:()=>Xr,addMutationPower:()=>Hi,broadcastMutationChange:()=>Fp,computeMutationMultiplierForLevel:()=>ns,computeMutationRequirementForLevel:()=>Up,getMutationCoinSprite:()=>Jd,getMutationGainMultiplier:()=>hu,getMutationMultiplier:()=>mu,getMutationState:()=>at,getTotalCumulativeMp:()=>Pa,initMutationSystem:()=>Xt,isMutationUnlocked:()=>vo,onMutationChange:()=>Qr,setMutationUnlockedForDebug:()=>Ka,unlockMutationSystem:()=>vr});function gu(e){try{return e?.toStorage?.()}catch{return null}}function pi(){try{pn()}catch{}}function kv(e){let t=e;if(!t.isZero?.()){let n=di.size>0?Array.from(di):typeof el=="function"?[el]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:F.level.clone?.()??F.level,mutationUnlocked:F.unlocked});r instanceof Ye?t=r.clone?.()??r:r!=null&&(t=Ye.fromAny(r))}catch{}}return t}function ME(){if(typeof Dp=="function"){try{Dp()}catch{}Dp=null}if(typeof $p=="function"){try{$p()}catch{}$p=null}}function tl(e){if(e instanceof Ye)try{return e.clone?.()??Ye.fromAny(e)}catch{return ct()}try{return Ye.fromAny(e??0)}catch{return ct()}}function kE(e){if(!e||typeof e!="object")return ct();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?Ye.fromInt(100):Ye.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function vu(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=De(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Yp(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let d=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(d+=CE*(p-1),!Number.isFinite(d)))return Number.POSITIVE_INFINITY}let f=u*d;return Number.isFinite(f)?f:Number.POSITIVE_INFINITY}let n=vu(e);if(!Number.isFinite(n))return Ye.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return Ye.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),d=Math.pow(l/u,1/a),f=o-9;r=u*Math.pow(d,f)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return Ye.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return Ye.fromAny("Infinity");let i=Ne(r);return kE(i)}function Lr(){let e=F.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");F.requirement=o.clone?.()??o,F.progress=o.clone?.()??o}catch{(!F.requirement||typeof F.requirement!="object")&&(F.requirement=c.fromInt(0)),(!F.progress||typeof F.progress!="object")&&(F.progress=c.fromInt(0))}return}let n=Yp(F.level);F.requirement=n}function TE(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=De(e),l=De(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Xp(){return Cn.container&&Cn.container.isConnected?!0:(Cn.container=document.querySelector("[data-mp-hud].mp-counter"),Cn.container?(Cn.bar=Cn.container.querySelector(".mp-bar"),Cn.fill=Cn.container.querySelector(".mp-bar__fill"),Cn.levelValue=Cn.container.querySelector(".mp-level-value"),Cn.progress=Cn.container.querySelector("[data-mp-progress]"),!0):!1)}function ui(e){try{return ne(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function Wo(){if(!Xp())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Cn;if(!e)return;if(!F.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=ui(F.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=ui(F.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Ii();return}e.removeAttribute("hidden");let i=F.requirement,s=TE(F.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=ui(F.level)),r){let a=ui(F.progress),u=ui(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=ui(F.progress).replace(/<[^>]*>/g,""),u=ui(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Ii()}function Yo(e="update",t={}){let n=at(),o={...n,slot:F.slot??v(),changeType:e,...t};if(Hp.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function zp(){let e=F.slot;if(e==null&&(e=v(),e!=null&&(F.slot=e)),e==null)return;try{localStorage.setItem(Ja(e),F.unlocked?"1":"0")}catch{}try{localStorage.setItem(fi(e),F.level.toStorage())}catch{}try{localStorage.setItem(Es(e),F.progress.toStorage())}catch{}rt(Ja(e)),rt(fi(e)),rt(Es(e));let t=(()=>{let u=F.unlocked,d=F.level,f=F.progress;try{u=localStorage.getItem(Ja(e))==="1"}catch{}try{let p=localStorage.getItem(fi(e));p&&(d=Ye.fromAny(p))}catch{}try{let p=localStorage.getItem(Es(e));p&&(f=Ye.fromAny(p))}catch{}return{unlocked:u,level:d,progress:f}})(),n=gu(t.level),o=gu(t.progress),r=gu(F.level),i=gu(F.progress),s=t.unlocked!==F.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&yu(t,{skipPersist:!0})}function Vp(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function AE(){if(!F.unlocked)return;let e=F.slot??v();if(e!=null&&Vp(fi(e))){Lr();return}Lr();let t=F.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;F.progress.cmp?.(t)>=0&&n<o;){if(F.progress=F.progress.sub(t),F.level=F.level.add(xs()),Lr(),t=F.requirement,!t||typeof t!="object"){F.progress=ct();break}if(t.isInfinite?.())break;n+=1}n>=o&&(F.progress=ct())}function yu(e,{skipPersist:t=!1}={}){F.unlocked=!!e.unlocked,F.level=tl(e.level),F.progress=tl(e.progress),F.unlocked||(F.level=ct(),F.progress=ct()),Lr(),t||zp(),Wo(),Yo("load"),pi()}function Gp(e){let t=e??v();if(t==null){yu({unlocked:!1,level:ct(),progress:ct()},{skipPersist:!0}),F.slot=null;return}let n=!1,o=ct(),r=ct();try{n=localStorage.getItem(Ja(t))==="1"}catch{}try{let i=localStorage.getItem(fi(t));i&&(o=Ye.fromAny(i))}catch{}try{let i=localStorage.getItem(Es(t));i&&(r=Ye.fromAny(i))}catch{}yu({unlocked:n,level:o,progress:r},{skipPersist:!0}),F.slot=t}function NE(){for(;Qa.length;){let e=Qa.pop();try{e?.()}catch{}}}function qp(e){Cv!==e&&(NE(),Cv=e,e!=null&&(Qa.push(Lt(Ja(e),{onChange(t){let n=t==="1";F.unlocked!==n&&(F.unlocked=n,n||(F.level=ct(),F.progress=ct()),Lr(),Wo(),Yo("storage"),pi())}})),Qa.push(Lt(fi(e),{onChange(t){if(t)try{let n=Ye.fromAny(t);F.level.cmp?.(n)!==0&&(F.level=n,Lr(),Wo(),Yo("storage"),pi())}catch{}}})),Qa.push(Lt(Es(e),{onChange(t){if(t)try{let n=Ye.fromAny(t);F.progress.cmp?.(n)!==0&&(F.progress=n,Lr(),Wo(),Yo("storage"))}catch{}}}))))}function Xt({forceReload:e=!1}={}){if(ME(),Mv){let n=v();return(n!==F.slot||e)&&Gp(n),qp(n),Xp(),Wo(),at()}Mv=!0,Xp();let t=v();return F.slot=t,Gp(t),qp(t),Wo(),pi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=v();F.slot=n,Gp(n),qp(n),Wo(),pi(),Yo("slot")}),at()}function at(){return{unlocked:F.unlocked,level:tl(F.level),progress:tl(F.progress),requirement:tl(F.requirement)}}function vo(){return!!F.unlocked}function vr(){return Xt(),F.unlocked?!1:(F.unlocked=!0,Lr(),zp(),Wo(),Yo("unlock"),pi(),!0)}function Ka(e){Xt();let t=!!e;yu({unlocked:t,level:t?F.level:ct(),progress:t?F.progress:ct()})}function Hi(e){Xt();let t=F.slot??v();if(t!=null&&Vp(Es(t))||!F.unlocked)return at();let n=t!=null&&Vp(fi(t));if(F.level&&F.level.isInfinite?.()){let d=F.level.clone?.()??F.level,f=F.progress.clone?.()??F.progress;if(!F.progress?.isInfinite?.())try{F.progress=Ye.fromAny("Infinity")}catch{}if(!F.requirement?.isInfinite?.())try{F.requirement=Ye.fromAny("Infinity")}catch{}let p;try{p=e instanceof Ye?e:Ye.fromAny(e??0)}catch{p=ct()}return p=kv(p),p=_o("mutation",p),Yo("progress",{delta:p.clone?.()??p,levelsGained:ct(),level:F.level.clone?.()??F.level,progress:F.progress.clone?.()??F.progress,requirement:F.requirement.clone?.()??F.requirement,previousLevel:d.clone?.()??d,previousProgress:f.clone?.()??f})}let o;try{o=e instanceof Ye?e:Ye.fromAny(e??0)}catch{o=ct()}if(o=kv(o),o=_o("mutation",o),o.isZero?.())return at();let r=o.clone?.()??o,i=F.level.clone?.()??F.level,s=F.progress.clone?.()??F.progress;if(F.progress=F.progress.add(r),F.progress.isInfinite?.()){if(!n)try{F.level=Ye.fromAny("Infinity")}catch{}try{F.progress=Ye.fromAny("Infinity")}catch{F.progress=ct()}try{F.requirement=Ye.fromAny("Infinity")}catch{}}else AE();zp(),Wo();let a=F.level.sub(i);return a.isZero?.()||pi(),Yo("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:F.level.clone?.()??F.level,progress:F.progress.clone?.()??F.progress,requirement:F.requirement.clone?.()??F.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Fp(e={}){Xt();let t=e.changeType??"manual";return Yo(t,e)}function ns(e){let t;if(e instanceof Ye)try{t=e.clone?.()??e}catch{t=ct()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=ct()}else try{t=c.fromAny(e??0)}catch{t=ct()}if(t&&t.isInfinite?.())try{return Ye.fromAny("Infinity")}catch{return xs()}let n=vu(t);if(!Number.isFinite(n))try{return Ye.fromAny("Infinity")}catch{return xs()}if(n<=0)return xs();let o=n*_E;return Ne(o)}function Up(e){let t;try{t=e instanceof Ye?e:Ye.fromAny(e??0)}catch{t=ct()}try{return Yp(t)}catch{return ct()}}function mu(){if(Xt(),!F.unlocked)return xs();try{return ns(F.level)}catch{return xs()}}function hu(){let e=c.fromInt(1);if(di.size>0||el){let t=di.size>0?Array.from(di):typeof el=="function"?[el]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:F.level.clone?.()??F.level,mutationUnlocked:F.unlocked});o instanceof Ye?e=o.clone?.()??o:o!=null&&(e=Ye.fromAny(o))}catch{}}return e}function Jd(){if(!F.unlocked||F.level.isZero?.())return"img/currencies/coin/coin.webp";let e=vu(F.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function Qr(e){return typeof e!="function"?()=>{}:(Hp.add(e),()=>{Hp.delete(e)})}function Xr(e){return typeof e!="function"?()=>{}:(di.add(e),()=>{di.delete(e)})}function Pa(){if(Xt(),!F.unlocked)return ct();if(F.level.isInfinite?.()||F.progress.isInfinite?.())return c.fromAny("Infinity");let e=vu(F.level);if(Number.isFinite(e)&&e>100)return F.progress.clone?.()??F.progress;let t=F.progress.clone?.()??F.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=Yp(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Wp,Ja,fi,Es,Ye,ct,xs,_E,CE,F,Cn,Hp,Qa,Cv,Mv,Dp,$p,di,el,mo=qe(()=>{Nt();bt();js();Wt();mn();ju();Yn();Wp="ccc:mutation",Ja=e=>`${Wp}:unlocked:${e}`,fi=e=>`${Wp}:level:${e}`,Es=e=>`${Wp}:progress:${e}`,Ye=c,ct=()=>Ye.fromInt(0),xs=()=>Ye.fromInt(1),_E=Math.log10(2),CE=9/(Math.pow(1.12,50)-1);F={unlocked:!1,level:ct(),progress:ct(),requirement:ct(),slot:null},Cn={container:null,bar:null,fill:null,levelValue:null,progress:null},Hp=new Set,Qa=[],Cv=null,Mv=!1,Dp=null,$p=null,di=new Set,el=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Xt,unlockMutationSystem:vr,addMutationPower:Hi,getMutationState:at,getMutationMultiplier:mu,isMutationUnlocked:vo,getTotalCumulativeMp:Pa,addExternalMutationGainMultiplierProvider:Xr,getMutationGainMultiplier:hu}))});var nl,Av,Nv,Kp,jp,Zp,Rv=qe(()=>{nl=`attribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,Av='precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform vec3 uColorDeep; uniform vec3 uColorShallow; void main() { /* Wave animation settings */ float speed = 1.2; float time = uTime * speed; /* Combine sine waves for a more natural look */ /* vUv.x is 0..1 across the screen width */ float wave1 = sin(vUv.x * 8.0 - time) * 0.0285; float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; /* Define the shoreline height (baseline) */ /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */ /* We want to discard pixels below this threshold */ float threshold = 0.428 + wave; if (vUv.y < threshold) { discard; } /* Recalculate gradient based on the new "bottom" */ /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */ float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0); vec3 col = mix(uColorShallow, uColorDeep, gradientY); /* Add a subtle "foam" or highlight at the edge */ float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold); col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4); gl_FragColor = vec4(col, 1.0); }',Nv="precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform sampler2D uWaveMap; uniform vec3 uColorDeep; uniform vec3 uColorShallow; uniform vec3 uColorWaveDeep; uniform vec3 uColorWave; /* Simple noise for foam breakup */ float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); } float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f*f*(3.0-2.0*f); return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x), mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y); } void main() { vec2 uv = vUv; /* Sample the simulation (physics) */ /* Wave Logic */ vec2 waveUV = uv - vec2(0.0, 0.0285); float intensity = texture2D(uWaveMap, waveUV).r; /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */ float shadowOffset = 8.0 / uResolution.y; float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r; /* Discard only if BOTH are empty */ if (intensity < 0.01 && shadowIntensity < 0.01) discard; /* Directional Noise: Streaky vertical noise for rushing water effect */ /* Stretch heavily along Y-axis to simulate speed/motion blur */ float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0)); /* Define Zones based on Intensity */ /* Body (Medium Intensity): Darker/turbulent blue with noise */ /* Edge (High Intensity): Bright white foam */ float foamThreshold = 0.5; float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity); /* Base Colors */ vec3 bodyColor = uColorWaveDeep; vec3 foamColor = uColorWave; /* Mix Colors */ vec3 finalColor = mix(bodyColor, foamColor, foamMix); /* Add streaks to the body part */ if (foamMix < 0.9) { finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix); } /* Hard Edge & Opacity */ /* Ensure the front (bottom) remains sharp, back trails off */ /* Calculate Alpha based on Intensity */ /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */ /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */ /* Low Intensity (Top/Tail): Fades to 0.0 */ float finalAlpha = smoothstep(0.02, 0.15, intensity); /* Screen Fade */ /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */ /* Dynamic Shoreline Fade */ /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */ /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */ float speed = 1.2; float time = uTime * speed; float wave1 = sin(uv.x * 8.0 - time) * 0.0285; float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; float threshold = 0.428 + wave; /* Fade out quickly after exiting the water body (below threshold) */ /* Fade starts slightly higher than the threshold to soften the transition */ /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */ float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y); float screenFade = shoreFade; /* --- Composite Shadow & Wave --- */ float waveAlpha = finalAlpha * screenFade; /* Shadow Alpha */ float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity); /* Shadow is weaker (40% opacity) */ float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade; /* Mix: Wave over Shadow */ /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */ float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha); /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */ /* Shadow is black (RGB=0), so second term is 0 */ vec3 outRGB = finalColor * waveAlpha; gl_FragColor = vec4(outRGB, outAlpha); }",Kp=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,jp=`precision mediump float;\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Zp=`precision mediump float;\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var Bv={};yt(Bv,{WaterSystem:()=>bu,waterSystem:()=>Su});function Pv(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function Ls(e,t,n){let o=Pv(e,e.VERTEX_SHADER,t),r=Pv(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var RE,Ov,OE,PE,bu,Su,Jp=qe(()=>{Rv();RE=[.2,.5,.9],Ov=[.2,.9,1],OE=[1,1,1],PE=[.45,.8,1];bu=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:Ls(s,nl,Nv),simProgram:Ls(s,nl,Zp),brushProgram:Ls(s,Kp,jp),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=Ls(this.glBg,nl,Av),this.bgSimProgram=Ls(this.glBg,nl,Zp),this.bgBrushProgram=Ls(this.glBg,Kp,jp)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,d=-(s/this.height*2-1),f=l/this.width,p=a/this.height,y=new Float32Array([u-f,d-p,0,0,1,u+f,d-p,1,0,1,u-f,d+p,0,1,1,u+f,d+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,y,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),h=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let d=r;for(;d>0;){let f=Math.min(d,s);l.push(f),d-=f}}l.forEach(d=>{let f=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,d);this.bgReadFBO=f.readFBO,this.bgWriteFBO=f.writeFBO,this.bgReadTexture=f.readTex,this.bgWriteTexture=f.writeTex}),this.fgLayers.forEach(d=>{l.forEach(f=>{let p=this.runSimStep(d.gl,d.simProgram,d.quadBuffer,d.readFBO,d.writeFBO,d.readTexture,d.writeTexture,f);d.readFBO=p.readFBO,d.writeFBO=p.writeFBO,d.readTexture=p.readTex,d.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),RE),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),Ov),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(d=>{let f=d.gl;f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,d.canvas.width,d.canvas.height),f.useProgram(d.program),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,d.readTexture),f.uniform1i(f.getUniformLocation(d.program,"uWaveMap"),0),f.uniform3fv(f.getUniformLocation(d.program,"uColorShallow"),Ov),f.uniform3fv(f.getUniformLocation(d.program,"uColorWave"),OE),f.uniform3fv(f.getUniformLocation(d.program,"uColorWaveDeep"),PE),f.uniform1f(f.getUniformLocation(d.program,"uTime"),o),f.uniform2f(f.getUniformLocation(d.program,"uResolution"),d.canvas.width,d.canvas.height),f.bindBuffer(f.ARRAY_BUFFER,d.quadBuffer);let p=f.getAttribLocation(d.program,"position");f.enableVertexAttribArray(p),f.vertexAttribPointer(p,2,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLE_STRIP,0,4)})}},Su=new bu});var qv={};yt(qv,{createSpawner:()=>HE});function Gv(e){if(!e||typeof e!="object"){_s=!1,mi=0n;return}_s=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;mi=n&&n!=="Infinity"?BigInt(n):0n}catch{mi=0n}}function FE(e){let t=1-e;return 1-t*t*t}function DE(e){if(!e)return null;let t=Fv.get(e);return t||(t=new Image,t.src=e,Fv.set(e,t)),t}function HE({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:d=je?BE:1e4,initialBurst:f=1,coinTtlMs:p=1e99,waveSoundSrc:y="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:h=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:S=!1}={}){let L=o,w={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function N(){return!!(w.pf&&w.w&&w.c)}N()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let T=7,Y=[],D=[],B=!1;if(w.c)for(let b=0;b<T;b++){let M=document.createElement("canvas");M.style.position="absolute",M.style.inset="0",M.style.pointerEvents="none",M.style.zIndex=`${10+b*10}`,w.c.appendChild(M);let P=M.getContext("2d",{alpha:!0});Y.push(M),D.push(P)}let C=null,U=null;w.c&&(C=document.createElement("canvas"),C.style.position="absolute",C.style.inset="0",C.style.pointerEvents="none",C.style.zIndex="100",w.c.appendChild(C),U=C.getContext("2d",{alpha:!0}));let R={collectBatch:null,getMagnetUnit:null};function _(b){R={...R,...b}}let X={pfRect:null,wRect:null,safeBottom:0,pfW:0};function J(){if(!N())return!1;let b=w.pf.getBoundingClientRect(),M=w.w.getBoundingClientRect(),P=w.hud?w.hud.getBoundingClientRect().height:0;X={pfRect:b,wRect:M,safeBottom:b.height-P,pfW:b.width};let k=window.devicePixelRatio||1;return Y.forEach((A,de)=>{if(A){A.width=b.width*k,A.height=b.height*k,A.style.width=b.width+"px",A.style.height=b.height+"px";let ce=D[de];ce&&(ce.setTransform(1,0,0,1,0,0),ce.scale(k,k),ce.imageSmoothingEnabled=!0,ce.imageSmoothingQuality="high")}}),B=!0,C&&(C.width=b.width*k,C.height=b.height*k,C.style.width=b.width+"px",C.style.height=b.height+"px",U&&(U.setTransform(1,0,0,1,0,0),U.scale(k,k))),!0}J();let ye="ResizeObserver"in window?new ResizeObserver(()=>J()):null;ye&&w.pf&&ye.observe(w.pf),document.addEventListener("visibilitychange",()=>{document.hidden||J()});let j=(b,M,P)=>Math.max(M,Math.min(P,b)),ae=Math.max(2e3,d*3),xe=12,we=[],z=[],oe=0,$=[];function G(){let b=document.createElement("div");b.className="coin",b.style.position="absolute",b.style.pointerEvents="auto",b.style.borderRadius="50%",b.style.willChange="transform",b.style.contain="layout style size";let M=document.createElement("img");return M.className="coin-inner",M.draggable=!1,M.alt="",M.style.width="100%",M.style.height="100%",M.src=L,M.style.objectFit="contain",M.style.borderRadius="50%",b.appendChild(M),S&&(b.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),b}let Z=()=>we.length?we.pop():G();function ue(b){b.style.transition="",b.style.transform="",b.style.opacity="1",b.classList.remove("coin--collected");for(let M=0;M<=6;M++)b.classList.remove(`coin--size-${M}`);b.style.removeProperty("--ccc-start"),delete b.dataset.dieAt,delete b.dataset.mutationLevel,delete b.dataset.collected,b.style.willChange="transform",b.parentNode&&b.remove(),we.length<ae&&we.push(b)}function fe(b,M=-1){if(b.isRemoved)return;b.isRemoved=!0;let P=M;(P===-1||z[P]!==b)&&(b.index!==void 0&&z[b.index]===b?P=b.index:P=z.indexOf(b)),P!==-1&&(z[P]=null,oe++),b.el?(ue(b.el),b.el=null):B=!0}function x(b){let M=b._coinObj;if(M){let P=-1;M.index!==void 0&&z[M.index]===M?P=M.index:P=z.indexOf(M),P!==-1&&(z[P]=null,oe++),b._coinObj=null}}let V=new URL(y,document.baseURI).href,le=0;function me(){let b=performance.now();if(b-le<g)return;le=b,ut(V,{volume:je?h:m,type:"music"})}function K(){if(!N())return null;if((!X.pfRect||!X.wRect)&&J(),d!==1/0&&z.length-oe>=d){let It=-1;if(dt(2))for(let At=0;At<z.length;At++){let ao=z[At];if(ao&&ao.sizeIndex<4){It=At;break}}else for(let At=0;At<z.length;At++)if(z[At]){It=At;break}if(It===-1)return null;let Tt=z[It];Tt&&fe(Tt,It)}let b=X.pfW,M=X.wRect.top-X.pfRect.top,P=Math.max(0,M),k=0;if(dt(2)){let It=Math.random();for(let Tt=6;Tt>=1;Tt--)if(It<GE[Tt]){k=Tt;break}}k>=4&&Ra&&Ra()&&(k=3);let A=Uv[k],de=xe+(k>=3?15*(k-2):0),ce=de,ke=Math.max(ce,b-A-de),Oe=ce+Math.random()*(ke-ce),Pe=Math.random()*100-50,Te;if(A>=X.pfW)Te=(X.pfW-A)/2;else{let It=X.pfW-A-de;ce>=It?Te=(X.pfW-A)/2:Te=j(Oe+Pe,ce,It)}let Ue=Math.min(X.wRect.height,X.pfRect.height*.3),Ce=Math.max(Ue+80,120),Xe=Math.max(Ce+40,X.safeBottom-A-6),Ie=j(Ce+Math.random()*(Xe-Ce),Ce,Xe),He={x0:Oe,y0:P,x1:Te,y1:Ie,jitterMs:0},nt=X.pfRect.left-X.wRect.left,Ge=qE[k],kt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),ot=.85+Math.random()*.3,gt=kt*(Ge.w/100)*ot,$t=kt*(Ge.h/100)*ot,Gt=Oe+A/2+nt,Mn=P-M;return{wave:{x:Gt,y:Mn,width:gt,height:$t},coin:He,sizeIndex:k}}function te(b){if(!b.length||!N())return;let M=document.createDocumentFragment(),P=[],k=performance.now(),A=!1;for(let{wave:de,coin:ce,sizeIndex:ke}of b){if(de&&(A=!0,Su)){let Xe=ke>=4;Su.addWave(de.x,de.y,de.width,de.height,Xe)}let Oe=Uv[ke],Pe=1;if(dt(8)){let Xe=xt(),Ie=Math.pow(25,Xe);Pe=Math.pow(Ie,ke)}else Pe=$E[ke];let Te=ke>=4,Ue=Z();Ue.style.width=`${Oe}px`,Ue.style.height=`${Oe}px`,Ue.className=`coin coin--size-${ke}`,Ue.firstChild&&(Ue.firstChild.src=L),Ue.style.transform=`translate3d(${ce.x0}px, ${ce.y0}px, 0) rotate(-10deg) scale(0.96)`,Ue.style.opacity="0",_s?Ue.dataset.mutationLevel=mi.toString():Ue.dataset.mutationLevel="0";let Ce={mutationLevel:_s?mi.toString():"0",el:Ue,src:L,x:ce.x0,y:ce.y0,rot:-10,scale:.96,startX:ce.x0,startY:ce.y0,endX:ce.x1,endY:ce.y1,startTime:k+ce.jitterMs,duration:i,dieAt:k+p,jitterMs:ce.jitterMs,isRemoved:!1,settled:!1,size:Oe,sizeIndex:ke,valueMultiplier:Pe,forceDom:Te,soundSrc:$v[ke]?`sounds/coin_pickup${$v[ke]}`:null,bMinX:Math.min(ce.x0,ce.x1)-Oe,bMaxX:Math.max(ce.x0,ce.x1)+Oe,bMinY:Math.min(ce.y0,ce.y1)-Oe,bMaxY:Math.max(ce.y0,ce.y1)+Oe};Ue._coinObj=Ce,Ce.index=z.length,z.push(Ce),P.push(Ce),M.appendChild(Ue)}w.c.appendChild(M),P.length>0&&requestAnimationFrame(()=>{for(let de of P)de.el&&(de.el.style.transition=`transform ${i}ms ${UE} ${de.jitterMs}ms`,de.el.style.transform=`translate3d(${de.endX}px, ${de.endY}px, 0) rotate(0deg) scale(1)`,de.el.style.opacity="1")}),A&&requestAnimationFrame(()=>{me()})}function he(b=1){if(!N())return;(!X.pfRect||!X.wRect)&&J();let M=[];for(let P=0;P<b;P++){let k=K();k&&M.push(k)}M.length&&te(M)}function Le(b,M){if(b.settled||b.isRemoved)return{x:b.x,y:b.y,rot:0,scale:1};let P=M-b.startTime;if(P<0)return{x:b.startX,y:b.startY,rot:-10,scale:.96};let k=P/b.duration;if(k>=1)return{x:b.endX,y:b.endY,rot:0,scale:1};let A=FE(k),de=b.startX+(b.endX-b.startX)*A,ce=b.startY+(b.endY-b.startY)*A,ke=-10+10*A,Oe=.96+.04*A;return{x:de,y:ce,rot:ke,scale:Oe}}function re(b,M){let P=DE(M.src);if(P&&P.complete&&P.naturalWidth>0){let k=M.size||r;b.drawImage(P,M.x,M.y,k,k)}}function ve(){if(D.length){if(B){D.forEach((M,P)=>{Y[P]&&(M.save(),M.setTransform(1,0,0,1,0,0),M.clearRect(0,0,Y[P].width,Y[P].height),M.restore(),S&&(M.save(),M.shadowColor="rgba(0,0,0,0.35)",M.shadowBlur=2,M.shadowOffsetY=2))});let b=z.length;for(let M=0;M<b;M++){let P=z[M];if(P&&P&&P.settled&&!P.isRemoved&&!P.el){let k=P.sizeIndex||0;D[k]&&re(D[k],P)}}S&&D.forEach(M=>M.restore()),B=!1,$.length=0}else if($.length>0){S&&D.forEach(b=>{b.save(),b.shadowColor="rgba(0,0,0,0.35)",b.shadowBlur=2,b.shadowOffsetY=2});for(let b=0;b<$.length;b++){let M=$[b];if(!M.isRemoved&&M.settled&&!M.el){let P=M.sizeIndex||0;D[P]&&re(D[P],M)}}S&&D.forEach(b=>b.restore()),$.length=0}}}let Ae=a,_e=null,Re=performance.now(),ie=0;function Q(b){(!X.pfRect||!X.wRect)&&J();let M=(b-Re)/1e3;Re=b,M>.1&&(M=.1);for(let k=z.length-1;k>=0;k--){let A=z[k];if(!A||!A)continue;if(b>=A.dieAt){fe(A,k);continue}if(A.sizeIndex===5&&!A.isRemoved&&(A.lastLightningTime||(A.lastLightningTime=b-1e3,A.nextLightningInterval=0),b-A.lastLightningTime>A.nextLightningInterval)){A.lastLightningTime=b,A.nextLightningInterval=200+Math.random()*100;for(let ke=0;ke<3;ke++)wo(A,b)}if(A.sizeIndex===6&&!A.isRemoved&&(A.lastLightningTime||(A.lastLightningTime=b-1e3,A.nextLightningInterval=0),b-A.lastLightningTime>A.nextLightningInterval&&(A.lastLightningTime=b,A.nextLightningInterval=200+Math.random()*100,R.collectBatch))){let ke=Le(A,b),Oe=ke.x+A.size/2,Pe=ke.y+A.size/2,Te=[],Ue=A.size/2*(A.size/2),Ce=z.length;for(let Xe=0;Xe<Ce;Xe++){let Ie=z[Xe];if(!Ie||Ie===A||Ie.isRemoved||Ie.settled===!1||Ie.sizeIndex>3)continue;let ze=Ie.x+(Ie.size||r)/2,He=Ie.y+(Ie.size||r)/2,nt=ze-Oe,Ge=He-Pe;nt*nt+Ge*Ge>Ue&&Te.push(Ie)}if(Te.length>0){for(let He=Te.length-1;He>0;He--){let nt=Math.floor(Math.random()*(He+1));[Te[He],Te[nt]]=[Te[nt],Te[He]]}let Xe=Te.slice(0,3),Ie=[],ze=!1;for(let He of Xe){let nt=He.size||r,Ge=He.x+nt/2,kt=He.y+nt/2;Eo(A,Ge,kt),Ko(Ge,kt,nt),Ie.push({coin:He}),ze||(ut("sounds/lightning_strike.ogg",{volume:.25}),ze=!0)}Ie.length>0&&R.collectBatch(Ie)}}if(A.settled)continue;let de=b-A.startTime;if(de<0)continue;if(de/A.duration>=1){A.settled=!0,A.x=A.endX,A.y=A.endY,A.rot=0,A.scale=1,A.el&&!A.forceDom?(ue(A.el),A.el=null,$.push(A)):A.el&&(A.el.style.transition="none",A.el.style.transform=`translate3d(${A.x}px, ${A.y}px, 0) rotate(0deg) scale(1)`);continue}}ie+=Ae*M;let P=Math.floor(ie);if(P>0){ie-=P;let k=Math.min(P,u);if(k>0){let A=performance.now(),de=[],ce=5;for(let ke=0;ke<k&&!(performance.now()-A>ce);ke++){let Oe=K();Oe&&de.push(Oe)}de.length&&te(de)}}if(ve(),oe>50){let k=0;for(let A=0;A<z.length;A++){let de=z[A];de!==null&&(de.index=k,z[k++]=de)}z.length=k,oe=0}jo(M),_e=requestAnimationFrame(Q)}function be(){if(!_e){if(!N()){console.warn("[Spawner] start() called but required nodes are missing.");return}J(),f>0&&_e===null&&he(f),Re=performance.now(),_e=requestAnimationFrame(Q)}}function I(){_e&&(cancelAnimationFrame(_e),_e=null)}function H(b){Ae=Math.max(0,Number(b)||0)}function W(){ie=0,Re=performance.now()}function ee(b){let M=dt(2)&&!!b;for(let P=z.length-1;P>=0;P--){let k=z[P];if(k&&k){if(M&&k.sizeIndex>=4){k.mutationLevel=_s?mi.toString():"0",k.el&&(k.el.dataset.mutationLevel=k.mutationLevel);continue}fe(z[P],P)}}W()}function pe(b){b&&(L=b)}function se(b){let M=b._coinObj;if(!M)return b.style.transform||"translate3d(0,0,0)";let{x:P,y:k,rot:A,scale:de}=Le(M,performance.now());return`translate3d(${P}px, ${k}px, 0) rotate(${A}deg) scale(${de})`}function $e(b){if(b.el)return b.el;if(b.isRemoved)return null;let M=Z(),P=b.size||r;return M.style.width=`${P}px`,M.style.height=`${P}px`,M.className=`coin coin--size-${b.sizeIndex||0}`,M.style.transition="",M.style.transform=`translate3d(${b.x}px, ${b.y}px, 0) rotate(0deg) scale(1)`,M.firstChild&&(M.firstChild.src=b.src),M.style.opacity="1",M.dataset.mutationLevel=b.mutationLevel,M._coinObj=b,b.el=M,w.c.appendChild(M),B=!0,M}function tt(b,M,P,k){let A=P;k&&(A=Math.max(P,260));let de=P*P,ce=[],ke=z.length,Oe=b-A,Pe=b+A,Te=M-A,Ue=M+A,Ce=performance.now();for(let Xe=0;Xe<ke;Xe++){let Ie=z[Xe];if(!Ie||Ie.bMaxX<Oe||Ie.bMinX>Pe||Ie.bMaxY<Te||Ie.bMinY>Ue)continue;let ze=Ie.size||r,He,nt;if(Ie.settled)He=Ie.x+ze/2,nt=Ie.y+ze/2;else{let gt=Le(Ie,Ce);He=gt.x+ze/2,nt=gt.y+ze/2}if(He<Oe||He>Pe||nt<Te||nt>Ue)continue;let Ge=He-b,kt=nt-M,ot=de;if(k&&(Ie.sizeIndex||0)>0){let gt=ze/2;ot=gt*gt}Ge*Ge+kt*kt<=ot&&(Ie.isRemoved||ce.push(Ie))}return ce}function ge(b,M,P,k,A,de){let ce=A;de&&(ce=Math.max(A,260));let ke=A*A,Oe=[],Pe=z.length,Te=Math.min(b,P)-ce,Ue=Math.max(b,P)+ce,Ce=Math.min(M,k)-ce,Xe=Math.max(M,k)+ce,Ie=P-b,ze=k-M,He=Ie*Ie+ze*ze,nt=ke*He,Ge=performance.now();for(let kt=0;kt<Pe;kt++){let ot=z[kt];if(!ot||ot.bMaxX<Te||ot.bMinX>Ue||ot.bMaxY<Ce||ot.bMinY>Xe)continue;let gt=ot.size||r,$t,Gt;if(ot.settled)$t=ot.x+gt/2,Gt=ot.y+gt/2;else{let tn=Le(ot,Ge);$t=tn.x+gt/2,Gt=tn.y+gt/2}if($t<Te||$t>Ue||Gt<Ce||Gt>Xe)continue;let Mn=$t-b,It=Gt-M,Tt=Mn*Ie+It*ze,At=ke;if(de&&(ot.sizeIndex||0)>0){let tn=gt/2;At=tn*tn}let ao=!1;if(Tt<=0)Mn*Mn+It*It<=At&&(ao=!0);else if(Tt>=He){let tn=$t-P,Ps=Gt-k;tn*tn+Ps*Ps<=At&&(ao=!0)}else{let tn=Mn*ze-It*Ie;tn*tn<=At*He&&(ao=!0)}ao&&!ot.isRemoved&&Oe.push(ot)}return Oe}function Be(b){fe(b)}function Dt(b,M,P){let k=P*P,A=[],de=z.length,ce=b-P,ke=b+P,Oe=M-P,Pe=M+P,Te=performance.now();for(let Ue=0;Ue<de;Ue++){let Ce=z[Ue];if(!Ce||Ce.bMaxX<ce||Ce.bMinX>ke||Ce.bMaxY<Oe||Ce.bMinY>Pe)continue;let Xe=Ce.size||r,Ie,ze;if(Ce.settled)Ie=Ce.x+Xe/2,ze=Ce.y+Xe/2;else{let Ge=Le(Ce,Te);Ie=Ge.x+Xe/2,ze=Ge.y+Xe/2}if(Ie<ce||Ie>ke||ze<Oe||ze>Pe)continue;let He=Ie-b,nt=ze-M;He*He+nt*nt<=k&&(!Ce.el&&!Ce.isRemoved&&$e(Ce),Ce.el&&A.push(Ce.el))}return A}function st(b,M,P,k,A){let de=A*A,ce=[],ke=z.length,Oe=Math.min(b,P)-A,Pe=Math.max(b,P)+A,Te=Math.min(M,k)-A,Ue=Math.max(M,k)+A,Ce=P-b,Xe=k-M,Ie=Ce*Ce+Xe*Xe,ze=de*Ie,He=performance.now();for(let nt=0;nt<ke;nt++){let Ge=z[nt];if(!Ge||Ge.bMaxX<Oe||Ge.bMinX>Pe||Ge.bMaxY<Te||Ge.bMinY>Ue)continue;let kt=Ge.size||r,ot,gt;if(Ge.settled)ot=Ge.x+kt/2,gt=Ge.y+kt/2;else{let Tt=Le(Ge,He);ot=Tt.x+kt/2,gt=Tt.y+kt/2}if(ot<Oe||ot>Pe||gt<Te||gt>Ue)continue;let $t=ot-b,Gt=gt-M,Mn=$t*Ce+Gt*Xe,It=!1;if(Mn<=0)$t*$t+Gt*Gt<=de&&(It=!0);else if(Mn>=Ie){let Tt=ot-P,At=gt-k;Tt*Tt+At*At<=de&&(It=!0)}else{let Tt=$t*Xe-Gt*Ce;Tt*Tt<=ze&&(It=!0)}It&&(!Ge.el&&!Ge.isRemoved&&$e(Ge),Ge.el&&ce.push(Ge.el))}return ce}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;_e||be()}});function en(){N()&&he(1)}let Mt=[],cn=[];function so(b,M){if(!b||!M)return;let P=b.size||r,k=M.size||r,A=b.x+P/2,de=b.y+P/2,ce=M.x+k/2,ke=M.y+k/2;Mt.push({x1:A,y1:de,x2:ce,y2:ke,age:0,life:.15})}function Ko(b,M,P){if(!w.pf)return;let k=document.createElement("div");k.className="coin-stain";let A=P*1.2;k.style.width=`${A}px`,k.style.height=`${A}px`,k.style.left=`${b-A/2}px`,k.style.top=`${M-A/2}px`,w.pf.appendChild(k),setTimeout(()=>{k.style.opacity="0",setTimeout(()=>{k.parentNode&&k.remove()},1e3)},2500)}function wo(b,M){let P=Math.random()*Math.PI*2,k=(b.size||r)/2,A=k*Dv,de=Math.cos(P)*A,ce=Math.sin(P)*A,ke=k*(.7+Math.random()*.6),Oe=Math.cos(P)*(A+ke),Pe=Math.sin(P)*(A+ke);Mt.push({parentCoin:b,relX1:de,relY1:ce,relX2:Oe,relY2:Pe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let Te=3+Math.floor(Math.random()*3);for(let Ue=0;Ue<Te;Ue++){let Ce=.3+Math.random()*.5,Xe=de+(Oe-de)*Ce,Ie=ce+(Pe-ce)*Ce,ze=P+(Math.random()*1.2-.6),He=ke*(.4+Math.random()*.4),nt=Xe+Math.cos(ze)*He,Ge=Ie+Math.sin(ze)*He;Mt.push({parentCoin:b,relX1:Xe,relY1:Ie,relX2:nt,relY2:Ge,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ut("sounds/lightning_zap.ogg",{volume:.25})}function Eo(b,M,P){if(!b)return;let k=b.size||r,A=performance.now(),de=Le(b,A),ce=de.x+k/2,ke=de.y+k/2,Oe=M-ce,Pe=P-ke,Te=Math.atan2(Pe,Oe),Ue=Math.sqrt(Oe*Oe+Pe*Pe),Ce=k/2*Dv,Xe=Math.cos(Te)*Ce,Ie=Math.sin(Te)*Ce;Mt.push({parentCoin:b,relX1:Xe,relY1:Ie,x2:M,y2:P,age:0,life:.25,width:6,jaggedScale:25});let ze=ce+Xe,He=ke+Ie,nt=6+Math.floor(Math.random()*5);for(let Ge=0;Ge<nt;Ge++){let kt=.1+Math.random()*.8,ot=ze+(M-ze)*kt,gt=He+(P-He)*kt,$t=Te+(Math.random()*1.6-.8),Gt=Ue*(.1+Math.random()*.3),Mn=ot+Math.cos($t)*Gt,It=gt+Math.sin($t)*Gt;if(Mt.push({x1:ot,y1:gt,x2:Mn,y2:It,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let At=ot+(Mn-ot)*.5,ao=gt+(It-gt)*.5,tn=$t+(Math.random()*1-.5),Ps=Gt*.5;Mt.push({x1:At,y1:ao,x2:At+Math.cos(tn)*Ps,y2:ao+Math.sin(tn)*Ps,age:0,life:.25,width:1.5,jaggedScale:10})}}}function jo(b){if(!U||!C)return;U.clearRect(0,0,C.width,C.height);let M=performance.now();U.lineCap="round",U.lineJoin="round";for(let P=Mt.length-1;P>=0;P--){let k=Mt[P];if(k.age+=b,k.age>=k.life){Mt.splice(P,1);continue}let A=k.x1,de=k.y1,ce=k.x2,ke=k.y2;if(k.parentCoin){let Te=Le(k.parentCoin,M),Ue=Te.x+(k.parentCoin.size||r)/2,Ce=Te.y+(k.parentCoin.size||r)/2;A=Ue+k.relX1,de=Ce+k.relY1,k.relX2!==void 0&&(ce=Ue+k.relX2,ke=Ce+k.relY2)}let Oe=1-k.age/k.life;U.strokeStyle=`rgba(200, 240, 255, ${Oe})`,U.lineWidth=k.width||3,U.shadowColor="rgba(220, 245, 255, 0.9)",U.shadowBlur=20;let Pe=6;U.beginPath(),U.moveTo(A,de);for(let Te=1;Te<=Pe;Te++){let Ue=Te/Pe,Ce=A+(ce-A)*Ue,Xe=de+(ke-de)*Ue;if(Te===Pe)U.lineTo(ce,ke);else{let Ie=-(ke-de),ze=ce-A,He=Math.sqrt(Ie*Ie+ze*ze),nt=k.jaggedScale||40;if(He>0){let Ge=(Math.random()-.5)*nt*(1-Math.abs(Ue-.5));U.lineTo(Ce+Ie/He*Ge,Xe+ze/He*Ge)}else U.lineTo(Ce,Xe)}}U.stroke(),U.shadowBlur=0}for(let P=cn.length-1;P>=0;P--){let k=cn[P];if(k.age+=b,k.age>=k.life){cn.splice(P,1);continue}k.x+=k.vx*b,k.y+=k.vy*b;let A=1-k.age/k.life;U.fillStyle=k.color,U.globalAlpha=A,U.beginPath(),U.arc(k.x,k.y,k.size,0,Math.PI*2),U.fill(),U.globalAlpha=1}}return{start:be,stop:I,setRate:H,clearBacklog:W,clearPlayfield:ee,setCoinSprite:pe,getCoinTransform:se,findCoinsInRadius:Dt,findCoinsInPath:st,findCoinTargetsInRadius:tt,findCoinTargetsInPath:ge,ensureCoinVisual:$e,removeCoinTarget:Be,detachCoin:x,recycleCoin:ue,playEntranceWave:en,setDependencies:_,hasBigCoins:()=>dt(2)&&z.some(b=>b&&b.sizeIndex>=4)}}var _s,mi,BE,Fv,UE,Uv,Dv,$E,GE,$v,qE,Hv=qe(()=>{Sl();mo();po();Jn();kn();Jp();fo();_s=!1,mi=0n,BE=2500,Fv=new Map;try{Gv(at())}catch{_s=!1,mi=0n}try{Qr(e=>{Gv(e)})}catch{}UE="cubic-bezier(0.215, 0.61, 0.355, 1)";Uv=[40,55,80,125,200,320,512],Dv=.78,$E=[1,25,625,15625,390625,9765625,244140625],GE=[0,.1,.01,.001,1e-4,1e-5,1e-6],$v=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],qE=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var Zv={};yt(Zv,{afterSlotWrite:()=>om,beforeSlotWrite:()=>nm});function zv(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function YE(e,t=VE){!e||e<=0||ol.set(e,zv()+t)}function Vv(e){if(!e||e<=0)return!1;let t=ol.get(e);return t==null?!1:t<=zv()?(ol.delete(e),!1):!0}function zE(){ol.clear()}function wu(){try{return typeof localStorage<"u"}catch{return!1}}function tm(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function Kv(e){let t=new Map;if(!wu())return rl.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(bi))continue;let r=tm(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return rl.set(e,t),t}function jv(e){return!Number.isFinite(e)||e<=0?null:rl.has(e)?rl.get(e):Kv(e)}function nm(e){if(!wu()||Iu>0)return;let t=String(e);if(!t.startsWith(bi))return;let n=tm(t);if(n==null)return;let o=jv(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(Iu===0){Iu+=1;try{un(n)}finally{Iu-=1}}Kv(n);return}}}catch{}}function om(e,t){let n=String(e);if(!n.startsWith(bi))return;let o=tm(n);if(o==null)return;let r=jv(o)||new Map;r.set(n,String(t??"")),rl.set(o,r)}function KE(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function jE(){let e=new Map;if(!wu())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(bi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=Hu(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function ZE(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=v();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function JE(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=Xu(e);if(n.length===0){o&&(Vv(e)||un(e),hl(e,null));return}let r=KE(n);o&&r!==o&&!Vv(e)&&un(e),r!==o&&hl(e,r)}function Ms(){if(!wu())return;let e=jE();ZE(e).forEach(n=>{let o=e.get(n)??[];JE(n,o)})}function QE(){if(Qp!=null)return;Qp=(typeof window<"u"?window:globalThis).setTimeout(()=>{Qp=null,Ms()},WE)}function ex(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){YE(o),QE();return}ol.delete(o),Ms()}}function tx(){typeof window>"u"||Xv==null&&(Xv=window.setInterval(Ms,XE))}function nx(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function Cs(){let e=nx();if(!e)return;if(!Si()){(e.dataset.poopShopApplied===em||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==Wv||e.dataset.poopShopApplied!==em)&&(e.style.backgroundImage=Wv,e.dataset.poopShopApplied=em)}function ox(){typeof window>"u"||Yv==null&&(Cs(),Yv=window.setInterval(Cs,50),window.addEventListener("saveSlot:change",Cs),window.addEventListener("saveSlot:modified",e=>{try{let t=v();e?.detail?.slot===t&&Cs()}catch{Cs()}}))}function rx(){typeof window>"u"||(Ms(),tx(),ox(),window.addEventListener("saveSlot:change",()=>Ms()),window.addEventListener("saveIntegrity:storageMutation",ex,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(zE(),Ms(),Cs())}))}var XE,VE,WE,Xv,Qp,ol,rl,Iu,Wv,em,Yv,rm=qe(()=>{bt();XE=1e4,VE=750,WE=50,Xv=null,Qp=null,ol=new Map;rl=new Map,Iu=0;Wv="linear-gradient(180deg,#a9793d,#7b5534)",em="1",Yv=null;rx()});var a0={};yt(a0,{initPopups:()=>cx,teardownpopups:()=>ux});function im(){return io||(io=document.createElement("div"),io.className="currency-popups",io.setAttribute("aria-live","polite"),io.setAttribute("aria-atomic","false"),document.body.appendChild(io),io)}function hi(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function sm(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function Qv(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):ne(n);t&&(t.innerHTML=r)}function sx(e,t=e0){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{il.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function ax(e,t,n){im();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function am(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=v();if(o!=null){if(["xp"].includes(e)){if(nn(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(nn(`ccc:mutation:progress:${o}`))return}else if(Object.values(Me).includes(e)&&Tn(e,o))return}let r=ix[e],i=Object.assign({duration:e0,accumulate:!0},r||{},n);if(!i.icon)return;let s=hi(t);if(!s||sm(s))return;let l=i.accumulate!==!1?il.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,Qv(l);return}let a=ax(e,i,s);a.meta=i,Qv(a),il.set(e,a);let u=im(),d=Jv.indexOf(e),f=null;if(d>=0){let p=Array.from(u.children);for(let y of p){let m=y.dataset.type;if(Jv.indexOf(m)>d){f=y;break}}}f?u.insertBefore(a.element,f):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),sx(a,i.duration)}function lx(){let e={};for(let t of Object.values(Me))e[t]=Gs(t);return e}function t0(){try{let e=lx();Object.entries(e).forEach(([t,n])=>{let o=hi(n)||c.fromInt(0);_r.set(t,o.clone?.()??o)}),_r.has("mp")||_r.set("mp",c.fromInt(0))}catch{_r.clear()}}function n0(){il.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),il.clear()}function o0(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=hi(t.value)||c.fromInt(0),r=_r.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?hi(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&am(n,s),_r.set(n,o.clone?.()??o)}function r0(e){let t=e?.detail;if(!t)return;let n=hi(t.xpAdded);n&&!sm(n)&&am("xp",n)}function i0(e){let t=e?.detail;if(!t)return;let n=hi(t.delta);n&&!sm(n)&&am("mp",n);let o=hi(t.progress);o&&_r.set("mp",o.clone?.()??o)}function s0(){n0(),t0()}function cx(){Eu||(Eu=!0,im(),t0(),window.addEventListener("currency:change",o0),window.addEventListener("xp:change",r0),window.addEventListener("mutation:change",i0),window.addEventListener("saveSlot:change",s0))}function ux(){Eu&&(window.removeEventListener("currency:change",o0),window.removeEventListener("xp:change",r0),window.removeEventListener("mutation:change",i0),window.removeEventListener("saveSlot:change",s0),n0(),_r.clear(),io&&io.remove(),io=null,Eu=!1)}var e0,Jv,ix,io,Eu,_r,il,l0=qe(()=>{Nt();Wt();bt();e0=6767,Jv=["coins","xp","books","gold","mp","magic","gears"],ix={[Me.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Me.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Me.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Me.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Me.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"}},io=null,Eu=!1,_r=new Map,il=new Map});var g0={};yt(g0,{flushBackupSnapshot:()=>h0,getSuspendMetadata:()=>Cx,installSuspendSafeguards:()=>_x,markProgressDirty:()=>Io,restoreFromBackupIfNeeded:()=>Lx});function sl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function Rs(){if(typeof localStorage>"u")return!1;try{let e=`${Vn}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function d0(){if(!sl())throw new Error("IndexedDB unavailable");return ks||(ks=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(fx,dx);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(Ns)||r.createObjectStore(Ns)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}ks=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw ks=null,e}),ks)}function gx(){if(!Rs())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(Vn))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function yx(e){try{let t=await d0();return await new Promise((n,o)=>{let r=!1,i=t.transaction(Ns,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(Ns).put(e,f0);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function vx(){try{let e=await d0();return await new Promise((t,n)=>{let o=!1,r=e.transaction(Ns,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(Ns).get(f0);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function bx(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function lm(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function Sx(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function wx(e){return!(typeof e!="string"||e.length===0||Ix.test(e))}function cm(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(Vn)||n.startsWith(px)||n.startsWith(mx))return;let o=Sx(n);if(o!=null)try{let r={key:n,slot:o,trusted:wx(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function Ex(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=lm(),a=String(i),u=this===localStorage&&a.startsWith(Vn);if(u)try{nm(a)}catch{}let d;try{d=t.apply(this,arguments)}finally{try{if(u){Io("setItem");try{om(a,s)}catch{}}this===localStorage&&a.startsWith(Vn)&&cm(a,l)}catch{}}return d}),typeof n=="function"&&(e.removeItem=function(i){let s=lm(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(Vn)&&(Io("removeItem"),cm(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=lm(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Io("clear"),cm(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function p0(e="idle"){As=e||As,Cr=!0,!Ts&&(Ts=setTimeout(()=>{if(Ts=null,!Cr)return;let t=As;Cr=!1,h0(t)},hx))}function m0(){Ts&&(clearTimeout(Ts),Ts=null)}function Io(e="dirty"){try{p0(e)}catch{}}async function um(e="manual"){if(!Rs()||!sl())return!1;let t=gx();if(!t)return!1;t.reason=e,Lu=!1;let n=await yx(t);return n||(Cr=!0,p0("retry")),n}async function h0(e="manual",{immediate:t=!1}={}){return!Rs()||!sl()?!1:t?(m0(),Cr=!1,Lu=!0,um(e)):(Cr=!0,As=e||As,um(e))}function xu(e){!sl()||!Rs()||(m0(),Cr=!1,Lu=!0,um(e))}function xx(){if(!Rs())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(Vn))return!0}}catch{}return!1}async function Lx(){if(u0||(u0=!0,!Rs()||!sl()))return!1;let e=!1;try{if(!xx())e=!0;else{let o=localStorage.getItem(`${Vn}saveSlot`);if(o){let r=`${Vn}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await vx();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Io("restored"),n}function _x(){if(c0||(c0=!0,typeof window>"u"))return;bx(),Ex();let e=()=>{document.hidden?xu("visibility-hidden"):Io("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>xu("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>xu("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>xu("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Io("pageshow"))}catch{}try{window.addEventListener("focus",()=>Io("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(Vn)||Io("storage-event"))})}catch{}Io("boot")}function Cx(){return{pendingImmediateFlush:Lu,dirty:Cr,lastDirtyReason:As}}var Vn,fx,dx,Ns,f0,px,mx,hx,ks,Ts,Cr,As,c0,u0,Lu,Ix,y0=qe(()=>{rm();Vn="ccc:",fx="ccc:safety",dx=1,Ns="snapshots",f0="latest",px=`${Vn}slotSig`,mx=`${Vn}slotMod`,hx=1e3,ks=null,Ts=null,Cr=!1,As="init",c0=!1,u0=!1,Lu=!1;Ix=/\bat <anonymous>:\d+:\d+\b/});var v0={};yt(v0,{initGlobalOverlayEsc:()=>Tx});function kx(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i}of Mx){let s=document.querySelectorAll(o);if(s.length>0){if(i){t=!0;continue}let a=s[s.length-1].querySelector(r||".shop-close");a&&(a.click(),n=!0)}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function Tx(){window.addEventListener("keydown",kx,!0)}var Mx,b0=qe(()=>{Mx=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".automation-shop-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close"}]});var S0={};yt(S0,{ensureGameDom:()=>Ax});function Ax(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var I0=qe(()=>{});function Ox(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function Px(){if(!je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function Fx(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let d=document.createElement("div");d.textContent=je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(d.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),d.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),d.textContent="Loading skipped",d.style.textDecoration="none",d.style.cursor="default",t())}),o.appendChild(d)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function Ux(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function Dx(e){if(!e||e.__done)return;e.__done=!0;let t=500;e.__label&&(e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let n=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,450)},t)}async function mm(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function $x(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function Gx(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(kn(),cl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function qx(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function Hx({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...$x(e,s),...Gx(t,s),...n?qx(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function Xx(e){if(Os===e)return;Qt&&(Qt.stop(),Qt=null),Os=e;let t=document.querySelector(".menu-root");switch(e){case zo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Os===zo.STARTER_COVE&&(Qt=ut("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},25)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Im=="function"&&Im(n,80),gi){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(gi.init("water-background",i),Cu){try{Cu()}catch{}Cu=null}if(Mu){try{Mu()}catch{}Mu=null}typeof bm=="function"&&(Cu=bm(s=>gi.update(s))),typeof Sm=="function"&&(Mu=Sm((s,l)=>gi.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,gi&&requestAnimationFrame(()=>gi.resize()),F0()),typeof gm=="function")try{gm()}catch{}if(typeof ym=="function")try{ym()}catch{}if(!Jt){Jt=P0({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=Jt;let i=()=>{if(!(!Jt||typeof Jt.setCoinSprite!="function"))try{Jt.setCoinSprite(G0?.())}catch{}};i(),q0?.(i);let s=B0({spawner:Jt});Jt&&typeof Jt.setDependencies=="function"&&Jt.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=U0(),u=D0(a);if(Jt&&u?.coinsPerSecondMult){let d=1*u.coinsPerSecondMult;if(typeof vm=="function"){let f=vm("spawnRate",d);try{f&&typeof f.toScientific=="function"?d=Number(f.toScientific(6)):d=Number(f)}catch{}}Number.isFinite(d)&&Jt.setRate(d)}}catch{}};if(l(),typeof pm=="function")try{pm()}catch{}pm=$0(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof hm=="function")try{hm()}catch{}Jt.start();break}case zo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),Jt&&Jt.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===zo.MENU}}))}catch{}}var Nx,je,w0,P0,B0,F0,E0,x0,L0,_0,C0,M0,k0,U0,D0,hm,$0,Rx,T0,A0,N0,fm,dm,gm,ym,G0,q0,_u,vm,R0,bm,Sm,O0,Im,gi,Cu,Mu,zo,Os,Qt,Jt,pm,ku,Bx,po=qe(()=>{kn();Nx=!0,je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia?window.matchMedia("(pointer: coarse)").matches:"ontouchstart"in window;return window.IS_MOBILE=e,e})();je&&document.documentElement.classList.add("is-mobile");Cu=null,Mu=null;Px();zo={MENU:0,STARTER_COVE:1},Os=zo.MENU,Qt=null,Jt=null,pm=null,ku=()=>new Promise(e=>requestAnimationFrame(e)),Bx=async()=>{await ku(),await ku()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(G=>{e=G}),n=Fx("Loading assets...",e);await ku();let{initAudio:o}=await Promise.resolve().then(()=>(kn(),cl));o();let r=Promise.all([Promise.resolve().then(()=>(zu(),$m)),Promise.resolve().then(()=>(Hv(),qv)),Promise.resolve().then(()=>(da(),Ug)),Promise.resolve().then(()=>(vc(),Lg)),Promise.resolve().then(()=>(bt(),Bm)),Promise.resolve().then(()=>(rm(),Zv)),Promise.resolve().then(()=>(mn(),Zy)),Promise.resolve().then(()=>(Sl(),qm)),Promise.resolve().then(()=>(Yn(),rh)),Promise.resolve().then(()=>(fo(),wy)),Promise.resolve().then(()=>(mo(),Tv)),Promise.resolve().then(()=>(l0(),a0)),Promise.resolve().then(()=>(y0(),g0)),Promise.resolve().then(()=>(Ti(),fh)),Promise.resolve().then(()=>(b0(),v0)),Promise.resolve().then(()=>(js(),_v)),Promise.resolve().then(()=>(Ur(),ph)),Promise.resolve().then(()=>(ql(),Ah)),Promise.resolve().then(()=>(Fi(),wh)),Promise.resolve().then(()=>(rc(),cg)),Promise.resolve().then(()=>(I0(),S0)),Promise.resolve().then(()=>(Jn(),Mh)),Promise.resolve().then(()=>(Jp(),Bv)),Promise.resolve().then(()=>(Wl(),$h))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(G,Z)=>`img/mutations/m${Z+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=Hx(i,G=>{s=G,Ux(n,G)}),[a,u,d,f,p,y,m,h,g,S,L,w,N,T,Y,D,B,C,U,R,_,X,J,ye]=await r;({initSlots:w0}=a),{createSpawner:P0}=u,{initCoinPickup:B0}=d,{initHudButtons:F0}=f,{bank:_0,getHasOpenedSaveSlot:C0,setHasOpenedSaveSlot:M0,ensureStorageDefaults:k0,notifyGameSessionStarted:O0}=p,{getCurrentAreaKey:U0,computeUpgradeEffects:D0,onUpgradesChanged:$0}=m,{registerPreloadedAudio:Rx}=h,{initXpSystem:hm}=g,{initResetSystem:gm}=S,{initMutationSystem:ym,getMutationCoinSprite:G0,onMutationChange:q0}=L,{initPopups:T0}=w,{installSuspendSafeguards:A0,restoreFromBackupIfNeeded:N0,markProgressDirty:fm,flushBackupSnapshot:dm}=N,{installGhostTapGuard:E0,initGlobalGhostTap:x0}=T,{initGlobalOverlayEsc:L0}=Y,{setDebugPanelAccess:_u,applyStatMultiplierOverride:vm}=D,{startGameLoop:R0,registerTick:bm,registerFrame:Sm}=B;let{initOfflineTracker:j,processOfflineProgress:ae}=C,{initWorkshopSystem:xe}=U,{initAutomationEffects:we}=R;({ensureGameDom:Im}=_);let{initSurgeEffects:z}=X;({waterSystem:gi}=J);let{initLabLogic:oe}=ye;window.bank=_0,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(Qt){try{Qt.stop()}catch{}Qt=null}}),window.addEventListener("audio:restartMusic",()=>{if(Qt){try{Qt.stop()}catch{}Qt=null}Os===zo.STARTER_COVE&&(Qt=ut("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",G=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return G.preventDefault(),G.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let G=document.hidden;Au(G),Qt&&Qt.element&&(G?Qt.element.pause():Qt.element.play().catch(()=>{}))}),E0?.(),x0?.(),L0?.(),A0?.(),typeof _u=="function"&&(_u(Nx),window.setDebugPanelAccess=_u);try{await N0?.()}catch{}await Promise.race([l,t]),await Bx(),document.documentElement.classList.remove("booting"),await ku(),Dx(n),await Promise.all([mm("img/currencies/coin/coin_plus_base.webp"),mm("img/stats/xp/xp_plus_base.webp"),mm("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}R0(),j(()=>Os===zo.STARTER_COVE);try{xe()}catch(G){console.error("Workshop init failed",G)}try{we()}catch(G){console.error("Automation init failed",G)}try{z()}catch(G){console.error("Surge effects init failed",G)}try{oe()}catch(G){console.error("Lab system init failed",G)}Ox(),k0(),fm?.("ensure-defaults"),T0();let $=document.getElementById("panel-title");if(C0()?(document.body.classList.add("has-opened"),$&&($.style.opacity="0")):$&&($.style.opacity="1"),w0(()=>{Os!==zo.STARTER_COVE&&(M0(!0),document.body.classList.add("has-opened"),$&&($.style.opacity="0"),Xx(zo.STARTER_COVE),ae(),window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave(),O0?.(),fm?.("slot-entered"))}),typeof window<"u"&&dm)try{window.cccRequestBackup=()=>dm("manual",{immediate:!0})}catch{}})});po();})();
