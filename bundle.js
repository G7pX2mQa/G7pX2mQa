(()=>{var rS=Object.defineProperty;var Ue=(e,t)=>()=>(e&&(t=e(e=0)),t);var bt=(e,t)=>{for(var n in t)rS(e,n,{get:t[n],enumerable:!0})};var Gl={};bt(Gl,{initAudio:()=>iS,loadAudio:()=>hh,playAudio:()=>dt,registerPreloadedBuffer:()=>aS,setAudioSuspended:()=>df,setMusicUnderwater:()=>Hr});function ff(){if(Xt)return Xt;let e=window.AudioContext||window.webkitAudioContext;return e?(Xt=new e,pa=Xt.createGain(),pa.connect(Xt.destination),pa.gain.value=1,$l=Xt.createGain(),$l.gain.value=1,$l.connect(pa),So=Xt.createBiquadFilter(),So.type="lowpass",So.frequency.value=22050,So.Q.value=1,So.connect($l),Xt):null}function iS(){ff()}function sS(){Xt&&Xt.state==="suspended"&&Xt.resume().catch(()=>{})}async function hh(e){let t=ff();if(!t)return null;let n=new URL(e,document.baseURI).href;if(ma.has(n))return ma.get(n);if(ql.has(n))return ql.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return ma.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{ql.delete(n)}})();return ql.set(n,o),o}function dt(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=ff(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=ma.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let d=s.createGain();return d.gain.value=t,u.connect(d),i==="music"?d.connect(So):d.connect(pa),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:d,element:null}}else hh(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function aS(e,t){let n=new URL(e,document.baseURI).href;ma.set(n,t)}function df(e){Xt&&(e?Xt.state==="running"&&Xt.suspend().catch(()=>{}):Xt.state==="suspended"&&Xt.resume().catch(()=>{}))}function Hr(e){if(!So)return;let t=e?600:22050;try{let n=Xt.currentTime;So.frequency.cancelScheduledValues(n),So.frequency.setValueAtTime(t,n)}catch{So.frequency.value=t}}var Xt,pa,$l,So,ma,ql,Bn=Ue(()=>{Xt=null,pa=null,$l=null,So=null,ma=new Map,ql=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,sS,{capture:!0,passive:!0})})});function Ae(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let h=Math.log10(p),m=e.e||0,y=Number(e._eOffset||0n);return h+m+y}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let d;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)+(u.length-15)}let f=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return d+f}function Me(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function pf(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/gh;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/gh:e>0?e:0}var c,gh,It=Ue(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",d=i+s;d.startsWith("-")?(u="-",d=d.slice(1)):d.startsWith("+")&&(d=d.slice(1));let f=d.replace(/^0+/,"")||"0",p=BigInt(u+f);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let f=i.slice(u+1)||"0";try{a=BigInt(f)}catch{a=0n}}let d=Number(l);return Number.isFinite(d)||(d=e.MAX_E),new e(BigInt(r),{base:d,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,d=Number(u),f=l;return Number.isSafeInteger(d)||(f+=u,d=0),new e(i,{base:d,offset:f},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let d=Math.min(n,18);o=u.toFixed(d).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};gh=Math.log(10)});function bh(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return vh.format(t)}catch{return String(e)}}function ha(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function mf(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+bh(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+vh.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,d=hf.get(u)||"",p=o-u+1,h=4-p,m=p+h;n.length<m+1&&(n+="0".repeat(m+1-n.length));let y=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(y=ha(y));let b,E;return y.length>m?(b=y.slice(0,p+1),E="0".repeat(h)):(b=y.slice(0,p),E=y.slice(p)),t+`${b}${h?"."+E:""}${d}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=ha(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+mf(String(o))}function cS(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+mf(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let d=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(d=ha(d)),l){let R=d.slice(0,1)+"."+d.slice(1),T=i==="-"?"-":"";return t+R+"e"+mf(s,T)}let p=Math.floor(a/3)*3,h=hf.get(p)||"",y=a-p+1,g=4-y,b,E;return d.length>4?(b=d.slice(0,y+1),E="0".repeat(g)):(b=d.slice(0,y),E=d.slice(y)),t+(i==="-"?"-":"")+b+(g?"."+E:"")+h}function yh(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=ha(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+cS(l)}function ne(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return yh(e.toScientific(3));if(t<6)return bh(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=hf.get(n);if(!o)return yh(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=ha(u));let f,p;return u.length>l?(f=u.slice(0,i+1),p="0".repeat(s)):(f=u.slice(0,i),p=u.slice(i)),`${f}${s?"."+p:""}${o}`}function Ve(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=Ae(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return ne(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):ne(c.fromAny(t))}catch{return"1"}}var lS,hf,vh,Kt=Ue(()=>{It();lS=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],hf=new Map(lS),vh=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var Ah={};bt(Ah,{CURRENCIES:()=>Ce,KEYS:()=>gt,STORAGE_PREFIX:()=>Di,bank:()=>O,clearActiveSlot:()=>IS,clearAllStorage:()=>LS,ensureCurrencyDefaults:()=>Cf,ensureMultiplierDefaults:()=>Mf,ensureStorageDefaults:()=>xS,getActiveSlot:()=>v,getCurrency:()=>va,getCurrencyMultiplierBN:()=>kh,getHasOpenedSaveSlot:()=>ES,getLastSaveTime:()=>Ef,getLastSaveTimeKey:()=>Wl,getSlotModifiedFlagKey:()=>wS,getSlotSignature:()=>_f,getSlotSignatureKey:()=>Lf,hasModifiedSave:()=>$i,isCurrencyLocked:()=>Fn,isStorageKeyLocked:()=>Vt,markSaveSlotModified:()=>Sn,notifyGameSessionStarted:()=>bS,onCurrencyChange:()=>Yl,peekCurrency:()=>ba,primeStorageWatcherSnapshot:()=>it,setActiveSlot:()=>xf,setCurrency:()=>Fi,setCurrencyMultiplierBN:()=>jl,setHasOpenedSaveSlot:()=>Kl,setSlotSignature:()=>zl,updateLastSaveTime:()=>Ch,watchStorageKey:()=>Ct});function vf(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function bf(e){let t=vf(e);return t==null?null:`${uS}:${t}`}function Sf(e){let t=vf(e);return t==null?null:`${fS}:${t}`}function xh(e={}){Hl.size!==0&&Hl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Yl(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Hl.add(o),()=>{Hl.delete(o)}}function pS(){if(ga!=null||Bo.size===0)return;ga=(typeof window<"u"?window:globalThis).setInterval(hS,dS)}function Lh(){if(Bo.size!==0||ga==null)return;(typeof window<"u"?window:globalThis).clearInterval(ga),ga=null}function _h(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function mS(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function hS(){if(Bo.size===0){Lh();return}Bo.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=_h(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!mS(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function Ct(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Bo.get(e);return s||(s=new Set,Bo.set(e,s)),s.add(i),pS(),()=>{let l=Bo.get(e);l&&(l.delete(i),l.size===0&&(Bo.delete(e),Lh()))}}function it(e,t){if(!e)return;let n=Bo.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=_h(r,o),r.initialized=!0)})}function If(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function gS(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function yS(){gf.forEach(e=>{try{e?.()}catch{}}),gf.clear()}function Ih(e){if(e!==Sh&&(yS(),Sh=e??null,e!=null))for(let t of Object.values(Ce)){let n=`${gt.CURRENCY[t]}:${e}`,o=Ct(n,{parse:gS,equals:If,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};xh(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});gf.set(n,o)}}function vS(){typeof window>"u"||(Ih(v()),window.addEventListener("saveSlot:change",()=>{Ih(v())}))}function bS(){wf=!0}function Wl(e=v()){return e==null?null:`${fr}lastSaveTime:${e}`}function Ch(){if(!wf||document.hidden)return;let e=v();if(e==null)return;let t=Date.now();try{localStorage.setItem(Wl(e),String(t))}catch{}}function Ef(){let e=v();if(e==null)return 0;try{let t=localStorage.getItem(Wl(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function SS(){typeof window>"u"||(wh||(wh=setInterval(Ch,1e3)),window.addEventListener("beforeunload",()=>{if(!wf)return;let e=v();if(e!=null)try{localStorage.setItem(Wl(e),String(Date.now()))}catch{}}))}function v(){if(cr!==void 0)return cr;let e=localStorage.getItem(gt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return cr=n,n}function xf(e){let t=Math.max(1,parseInt(e,10)||1);cr=t,localStorage.setItem(gt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function IS(){cr=null,localStorage.removeItem(gt.SAVE_SLOT)}function ya(e,t=v()){return t==null?null:`${e}:${t}`}function Mh(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Vt(e){return Mh(e)}function Lf(e=v()){return bf(e)}function wS(e=v()){return Sf(e)}function _f(e=v()){if(typeof localStorage>"u")return null;let t=bf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function zl(e,t){if(typeof localStorage>"u")return;let n=bf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function $i(e=v()){if(typeof localStorage>"u")return!1;let t=Sf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function Sn(e=v()){if(typeof localStorage>"u")return;let t=vf(e);if(t==null||$i(t))return;let n=Sf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function ES(){return localStorage.getItem(gt.HAS_OPENED_SAVE_SLOT)==="true"}function Kl(e){localStorage.setItem(gt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function xS(){localStorage.getItem(gt.HAS_OPENED_SAVE_SLOT)===null&&Kl(!1)}function Cf(){let e=v();if(e!=null)for(let t of Object.values(Ce)){let n=`${gt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function Mf(){let e=v();if(e!=null)for(let t of Object.values(Ce)){let n=`${gt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Vl(t);else{let o=ur(c.fromInt(1));Ui(t,o)}}}function va(e){let t=ya(gt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Fi(e,t,{delta:n=null,previous:o=null}={}){let r=v(),i=ya(gt.CURRENCY[e],r),s=o??va(e),l=c.fromInt(0);if(!i||Fn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let d=null;try{d=localStorage.getItem(i)}catch{}let f=d??u,p=a;try{d!=null&&(p=c.fromAny(d),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}it(i,f);let h=!If(s,p),y=(b=>{if(b==null)return null;try{let E=b instanceof c?b.clone?.()??b:c.fromAny(b);if(typeof E.cmp=="function")return E.cmp(l)>0?E:null;if(!E.isZero?.())return E}catch{}return null})(n),g=null;if(h)try{g=p.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=y),h||g){let b={key:e,value:p,slot:r,delta:g??void 0};xh(b);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:b}))}catch{}}return p}function ur(e){return e.mulScaledIntFloor(1n,-yf)}function Xl(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,yf)}function Vl(e){let t=ya(gt.MULTIPLIER[e]);if(!t)return ur(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Xr)){let r=ur(c.fromInt(1));return Ui(e,r),r}let o=n.slice(Xr.length);try{return c.fromAny(o)}catch{let r=ur(c.fromInt(1));return Ui(e,r),r}}function Ui(e,t,n=v()){let o=ya(gt.MULTIPLIER[e],n);if(!o||Fn(e,n))return;let r=ur(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Xr))try{r=c.fromAny(i.slice(Xr.length))}catch{}let s=c.fromAny(t),l=Xr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,d=s;try{let f=u?.startsWith?.(Xr)?u.slice(Xr.length):null;f!=null&&(d=c.fromAny(f))}catch{}try{it(o,u)}catch{}if(!If(r,d))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:Xl(d),slot:n}}))}catch{}}function kh(e){return Xl(Vl(e))}function Fn(e,t=v()){let n=ya(gt.CURRENCY[e],t);return Mh(n)}function jl(e,t){let n=c.fromAny(t),o=ur(n);return Ui(e,o,v()),n}function ba(e,t){let n=localStorage.getItem(`${gt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function LS(){Object.values(gt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Eh(e){let t=n=>{try{let o=c.fromAny(n);return typeof ne=="function"?ne(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return va(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Fi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Fi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Fi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof ne=="function"?ne(r):r.toString()},t.mult={get(){return kh(e)},set(n){return jl(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Vl(e).mulBigNumInteger(o);return r.isZero()&&(r=ur(c.fromInt(1))),Ui(e,r),Xl(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),yf)}catch{o={numer:1n,scale:0}}let r=Vl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=ur(c.fromInt(1))),Ui(e,r);let i=Xl(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var fr,Di,uS,fS,yf,Xr,dS,Bo,ga,Hl,gf,Sh,wh,wf,gt,Ce,cr,O,St=Ue(()=>{It();Kt();fr="ccc:",Di=fr,uS=`${fr}slotSig`,fS=`${fr}slotMod`,yf=18,Xr="XM:",dS=140,Bo=new Map,ga=null,Hl=new Set;gf=new Map,Sh=null;wh=null,wf=!1;SS();gt={HAS_OPENED_SAVE_SLOT:`${fr}hasOpenedSaveSlot`,SAVE_SLOT:`${fr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Ce={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===gt.SAVE_SLOT){if(e.newValue===null)cr=null;else{let t=parseInt(e.newValue,10);cr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:cr}}))}catch{}}});for(let e of Object.values(Ce))gt.CURRENCY[e]=`${fr}${e}`,gt.MULTIPLIER[e]=`${fr}mult:${e}`;vS();O=new Proxy({},{get(e,t){if(Object.values(Ce).includes(t))return Eh(t);if(typeof t=="string"&&Ce[t.toUpperCase?.()])return Eh(Ce[t.toUpperCase()])}});if(typeof window<"u"){window.bank=O;for(let e of Object.values(Ce))window[e]=O[e]}});function Nh(){return Io}function Zl(e){Io=!!e,document.body.classList.toggle("slots-delete-mode",Io);let t=document.getElementById("manage-saves");t&&(t.textContent=Io?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",Io),n.setAttribute("aria-pressed",Io?"true":"false")})}function _S(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function CS(){if(Th)return;Th=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),Zl(!Io)}),window.addEventListener("keydown",r=>{Io&&r.key==="Escape"&&Zl(!1)});let n=r=>{!Io||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!Io)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(_S(s),v()===s)try{localStorage.removeItem(gt.SAVE_SLOT)}catch{}kf(),Zl(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),Zl(!1)}var Io,Th,Rh=Ue(()=>{St();Af();Io=!1,Th=!1;document.addEventListener("DOMContentLoaded",()=>{try{CS()}catch{}})});var Oh={};bt(Oh,{initSlots:()=>AS,refreshSlotsView:()=>kf});function MS(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function kS(e){if(!MS(e))return"No Save Data";try{let t=ba(e,"coins");return ne(t)}catch{return"0"}}function Tf(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=kS(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function AS(e){let t=document.querySelectorAll(".slot-card");Tf(),t.forEach((n,o)=>{let r=o+1,i=s=>{xf(r),Cf(),Mf(),Kl(!0),typeof e=="function"&&e(r,s),Tf()};n.addEventListener("click",s=>{Nh()||(s.preventDefault(),i(s))})})}function kf(){Tf()}var Af=Ue(()=>{It();Kt();Rh();St()});var Bh={};bt(Bh,{registerPreloadedAudio:()=>TS,takePreloadedAudio:()=>NS});function TS(e,t){let n=Ph(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}Jl.set(n,t)}}function NS(e){let t=Ph(e);if(!Jl.has(t))return null;let n=Jl.get(t);return Jl.delete(t),n}var Jl,Ph,Ql=Ue(()=>{Jl=new Map,Ph=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function qi(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var Nf=Ue(()=>{});var Jh={};bt(Jh,{addExternalCoinMultiplierProvider:()=>Uo,addExternalXpGainMultiplierProvider:()=>hr,addXp:()=>Wi,broadcastXpChange:()=>ic,computeCoinMultiplierForXpLevel:()=>Hf,getXpGainMultiplier:()=>ac,getXpLevelStorageKey:()=>RS,getXpRequirementForXpLevel:()=>sc,getXpState:()=>et,initXpSystem:()=>Vi,isXpSystemUnlocked:()=>un,onXpChange:()=>oc,refreshCoinMultiplierFromXpLevel:()=>Jt,resetXpProgress:()=>Yi,setExternalBookRewardProvider:()=>lc,setExternalCoinMultiplierProvider:()=>jh,setExternalXpGainMultiplierProvider:()=>Zh,unlockXpSystem:()=>zr});function RS(e=v()){let t=e??v();return t==null?null:Vr(t)}function cn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function ec(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function Xh(e){if(!e||typeof e!="object")return 0;if(cn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function BS(e){return!e||typeof e!="object"?0:cn(e)||typeof e.cmp=="function"&&e.cmp(Hh)>=0?Number.POSITIVE_INFINITY:Xh(e)}function Uh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(PS,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(La())??c.fromInt(0):n}function FS(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(Gh,18)}function US(e){if(cn(e)||typeof e.cmp=="function"&&e.cmp(Hh)>=0)return _t.clone?.()??_t;let t=e.floorToInteger(),n=e.sub(t),o=Xh(n);if(!Number.isFinite(o))return _t.clone?.()??_t;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return _t.clone?.()??_t;let f=BigInt(u)+l-BigInt(i),h=f%BigInt(250),m=Number(h),y=f-h;return new c(a,{base:m,offset:y})}function Vh(e){if(!e||typeof e!="object")return _t.clone?.()??_t;let n=FS(e),o=US(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return _t.clone?.()??_t;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function Yh(){let e=cn(H.xpLevel),t=cn(H.progress);if(!e&&!t)return!1;let n=_t.clone?.()??_t;if(H.xpLevel=n.clone?.()??n,H.progress=n.clone?.()??n,wt=n.clone?.()??n,O?.books)try{typeof O.books.set=="function"?O.books.set(n.clone?.()??n):typeof O.books.add=="function"&&O.books.add(n.clone?.()??n)}catch{}return!0}function wa(e={}){xa.size!==0&&xa.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function oc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return xa.add(n),()=>{xa.delete(n)}}function Ot(){return c.fromInt(0)}function La(){return c.fromInt(1)}function Gi(e){if(!e)return Ot();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ot()}}function tc(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function DS(){for(;$f.length>0;){let e=$f.pop();try{e?.()}catch{}}}function $h(e){if(e==null)return Ot();try{return c.fromAny(e)}catch{return Ot()}}function Pf(e){if(!Of){Of=!0;try{let t=qf??v(),n={unlocked:H.unlocked,xpLevel:Gi(H.xpLevel),progress:Gi(H.progress),requirement:Gi(wt)};Zt(!0),eo(),wn(!0);let o={unlocked:H.unlocked,xpLevel:Gi(H.xpLevel),progress:Gi(H.progress),requirement:Gi(wt)},r=n.unlocked!==o.unlocked,i=!tc(n.xpLevel,o.xpLevel),s=!tc(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ot();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ot()}catch{l=Ot()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||xa.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(wa(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{Of=!1}}}function Bf(e){if(e===qf||(DS(),qf=e??null,e==null))return;let t=(n,o)=>{let r=Ct(n,o);typeof r=="function"&&$f.push(r)};t(Sa(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>Pf("unlock")}),t(Vr(e),{parse:$h,equals:tc,onChange:()=>Pf("xpLevel")}),t(Xi(e),{parse:$h,equals:tc,onChange:()=>Pf("progress")})}function Wh(){if(Dh){Bf(v());return}Dh=!0,Bf(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Bf(v()),Zt(!0),eo(),wn(!0)})}function Ff(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function $S(e){let t=e<Fh?e:Fh;if(t<=Hi)return;let n=Hi,o=dr.get(n.toString());for(o||(o=c.fromInt(10),dr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),dr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Hi=n;return}}Hi=n}function qS(e){let t=Hi>0n?Hi:0n,n=dr.get(t.toString());if(!n||cn(n))return _t.clone?.()??_t;let o=c.fromAny(t.toString()),r=Ae(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);ec(s)||(i=i.add?.(s.mulDecimal(Gh,18))??i);let l=Uh(e),a=Uh(o),u=l.sub?.(a)??c.fromInt(0);ec(u)||(i=i.add?.(u.mulDecimal(OS,18))??i);let d=BS(i);return Number.isFinite(d)?Me(d):_t.clone?.()??_t}function GS(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=cn(t),o=cn(e);if(n)return o?1:0;if(ec(t)||ec(e))return 0;let s=Ae(e),l=Ae(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function zh(){return In.container&&In.container.isConnected?!0:(In.container=document.querySelector(".xp-counter[data-xp-hud]"),In.container?(In.bar=In.container.querySelector(".xp-bar"),In.fill=In.container.querySelector(".xp-bar__fill"),In.xpLevelValue=In.container.querySelector(".xp-level-value"),In.progress=In.container.querySelector("[data-xp-progress]"),!0):!1)}function Kh(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=dr.get("0");return a.clone?.()??a}if(r.bigInt!=null){$S(i);let a=i.toString(),u=dr.get(a);if(u)return u.clone?.()??u}let s=qS(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?_t.clone?.()??_t:(r.bigInt!=null&&dr.set(r.bigInt.toString(),s),s.clone?.()??s)}function Fo(){wt=Kh(H.xpLevel)}function nc(){H.xpLevel=Ot(),H.progress=Ot(),Fo(),wn(!0)}function qh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function rc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function wn(e=!1){let t=O?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=rc(H.xpLevel),o=n.bigInt,r=!n.finite,i=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null;if(!e&&(r&&Dn||!r&&o!=null&&!Dn&&!$n&&Un!=null&&o===Un||!r&&o==null&&$n&&i&&qn&&i===qn))return;if(r){try{t.set(_t)}catch{}Un=null,Dn=!0,$n=!1,qn=null;return}let s;if(o!=null&&o<=Df){let d=c.fromInt(1),f=Number(o);for(let h=0;h<f;h+=1)d=d.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(f)}typeof d.add=="function"?d=d.add(p):typeof p.add=="function"&&(d=p.add(d)),s=d.clone?.()??d}else s=Vh(H.xpLevel);let l=s.clone?.()??s,a=pr.size>0?Array.from(pr):typeof Yr=="function"?[Yr]:[];for(let d of a)if(typeof d=="function")try{let f=d({baseMultiplier:l.clone?.()??l,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});f instanceof c?l=f.clone?.()??f:f!=null&&(l=c.fromAny(f))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Un=null,Dn=!0,$n=!1,qn=null):o!=null&&o<=Df?(Un=o,Dn=!1,$n=!1,qn=null):(Un=null,Dn=!1,$n=!0,qn=i)}function Zt(e=!1){let t=v();if(t==null)return Ia=null,Rf=!1,H.unlocked=!1,nc(),H;if(!e&&Rf&&t===Ia)return H;Ia=t,Rf=!0;try{let n=localStorage.getItem(Sa(t));H.unlocked=n==="1"}catch{H.unlocked=!1}try{H.xpLevel=c.fromAny(localStorage.getItem(Vr(t))??"0")}catch{H.xpLevel=Ot()}try{H.progress=c.fromAny(localStorage.getItem(Xi(t))??"0")}catch{H.progress=Ot()}return(cn(H.xpLevel)||cn(H.progress))&&(H.unlocked=!0),H.unlocked?(Yh(),Fo(),wn(!0),Wh(),H):(nc(),H)}function Ea(){let e=v();if(e==null)return;let t={unlocked:H.unlocked?"1":"0",level:H.xpLevel.toStorage(),progress:H.progress.toStorage()};try{localStorage.setItem(Sa(e),t.unlocked)}catch{}try{localStorage.setItem(Vr(e),t.level)}catch{}try{localStorage.setItem(Xi(e),t.progress)}catch{}let n=(()=>{let r=H.unlocked,i=H.xpLevel,s=H.progress;try{r=localStorage.getItem(Sa(e))==="1"}catch{}try{let l=localStorage.getItem(Vr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(Xi(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();it(Sa(e),n.unlocked?"1":"0"),it(Vr(e),n.level?.toStorage?.()??t.level),it(Xi(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==H.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(H.unlocked=n.unlocked,H.xpLevel=n.level,H.progress=n.progress,Fo(),wn(!0),eo())}function HS(){wn(!0);let e=La();if(typeof Uf=="function")try{let n=Uf({baseReward:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{O?.books?.addWithMultiplier?O.books.addWithMultiplier(e):O?.books?.add&&O.books.add(e)}catch{}let t=rc(H.xpLevel);t.finite?t.bigInt!=null?(Un=t.bigInt,Dn=!1,$n=!1,qn=null):(Un=null,Dn=!1,$n=!0,qn=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Un=null,Dn=!0,$n=!1,qn=null)}function eo(){if(!zh())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=In;if(!e)return;if(!H.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=ne(wt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Ff(ne(wt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}qi();return}e.removeAttribute("hidden");let i=wt,s=GS(H.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=ne(H.xpLevel)),r){let a=ne(H.progress),u=ne(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Ff(ne(H.progress)),u=Ff(ne(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}qi()}function Vi({forceReload:e=!1}={}){return zh(),Zt(e),Fo(),eo(),Wh(),et()}function zr(){if(Zt(),H.unlocked)return eo(),!1;nc(),H.unlocked=!0,Ea(),eo(),wn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:et()}))}catch{}return!0}function Yi({keepUnlock:e=!0}={}){Zt();let t=H.unlocked;return nc(),H.unlocked=e?t||H.unlocked:!1,Ea(),eo(),wn(!0),et()}function Wi(e,{silent:t=!1}={}){Zt();let n=Ia??v();if(n!=null&&qh(Xi(n)))return{unlocked:H.unlocked,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,progress:H.progress,requirement:wt,slot:n};if(!H.unlocked)return{unlocked:!1,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,requirement:wt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ot()}if(!o.isZero?.()){let f=mr.size>0?Array.from(mr):typeof Wr=="function"?[Wr]:[];for(let p of f)if(typeof p=="function")try{let h=p({baseGain:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});h instanceof c?o=h.clone?.()??h:h!=null&&(o=c.fromAny(h))}catch{}}if(o=Hn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return eo(),{unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,requirement:wt};H.progress=H.progress.add(o),Fo();let r=n!=null&&qh(Vr(n)),i=cn(H.progress),s=cn(H.xpLevel),l=cn(o);if(i||s||l){let f=_t.clone?.()??_t;r||(H.xpLevel=f.clone?.()??f),H.progress=f.clone?.()??f,Fo(),Yh(),Ea(),eo(),wn(!0);let p={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:wt.clone?.()??wt,slot:n};if(wa(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Ot();if(H.progress.cmp(wt)<0){Ea(),eo();let f={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,progress:H.progress,requirement:wt,slot:n};if(wa(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}if(!r){let f=Ae(H.progress),p=.08118668602542883,h=Ae(wt);if(f-h>2){let g=H.xpLevel,b=f-h,E=Math.floor(b/p);if(E>500){let x=BigInt(Math.max(0,E-5));if(x>0n){let R=c.fromAny(x.toString());if(H.xpLevel=H.xpLevel.add(R),a=a.add(R),Fo(),O?.books?.add)try{let T=R.clone();O.books.add(T)}catch{}}}}let m=0,y=500;for(;H.progress.cmp?.(wt)>=0&&m<y&&(H.progress=H.progress.sub(wt),H.xpLevel=H.xpLevel.add(La()),a=a.add(La()),HS(),Fo(),!cn(wt));)m+=1;m>=y&&H.progress.cmp(wt)>=0&&Fo()}Ea(),eo();let u=rc(H.xpLevel);u.finite?u.bigInt!=null?(Un=u.bigInt,Dn=!1,$n=!1,qn=null):(Un=null,Dn=!1,$n=!0,qn=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Un=null,Dn=!0,$n=!1,qn=null);let d={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:wt.clone?.()??wt,slot:n};if(wa(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}function et(){return Zt(),{unlocked:H.unlocked,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:wt.clone?.()??wt}}function ic(e={}){Zt();let t=Ia??v(),n={...et(),slot:t,...e};if(wa(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function un(){return Zt(),!!H.unlocked}function sc(e){return Kh(e)}function ac(){Zt();let e=La(),t=mr.size>0?Array.from(mr):typeof Wr=="function"?[Wr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function Hf(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=rc(t),o=n.bigInt;if(!n.finite)return _t.clone?.()??_t;let i;if(o!=null&&o<=Df){let a=c.fromInt(1),u=Number(o);for(let f=0;f<u;f+=1)a=a.mulDecimal("1.1",18);let d;try{d=c.fromAny(o.toString())}catch{d=c.fromInt(u)}typeof a.add=="function"?a=a.add(d):typeof d.add=="function"&&(a=d.add(a)),i=a.clone?.()??a}else i=Vh(t);let s=i.clone?.()??i,l=pr.size>0?Array.from(pr):typeof Yr=="function"?[Yr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!H.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function jh(e){Yr=typeof e=="function"?e:null,pr.clear(),Yr&&pr.add(Yr),Zt(),wn(!0)}function Jt(){Zt(),wn(!0)}function Zh(e){Wr=typeof e=="function"?e:null,mr.clear(),Wr&&mr.add(Wr)}function Uo(e){return typeof e!="function"?()=>{}:(pr.add(e),Zt(),wn(!0),()=>{pr.delete(e),Zt(),wn(!0)})}function hr(e){return typeof e!="function"?()=>{}:(mr.add(e),Zt(),()=>{mr.delete(e)})}function lc(e){Uf=typeof e=="function"?e:null}var Gf,Sa,Vr,Xi,Ia,Rf,wt,dr,Hi,_t,Un,Dn,$n,qn,Yr,Wr,pr,mr,Uf,Fh,B1,F1,Df,Gh,OS,PS,Hh,H,xa,In,$f,Dh,qf,Of,Gn=Ue(()=>{It();St();zi();Kt();Nf();Gf="ccc:xp",Sa=e=>`${Gf}:unlocked:${e}`,Vr=e=>`${Gf}:level:${e}`,Xi=e=>`${Gf}:progress:${e}`;Ia=null,Rf=!1,wt=c.fromInt(10),dr=new Map;dr.set("0",wt);Hi=0n,_t=c.fromAny("Infinity"),Un=null,Dn=!1,$n=!1,qn=null,Yr=null,Wr=null,pr=new Set,mr=new Set,Uf=null,Fh=5000n,B1=Math.log10(11/10),F1=Math.log10(5/2),Df=200n,Gh="0.04139268515822507",OS="0.3979400086720376",PS="0.1",Hh=c.fromScientific(String(c.MAX_E));H={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};xa=new Set;In={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};$f=[],Dh=!1,qf=null,Of=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Vi,unlockXpSystem:zr,addXp:Wi,getXpState:et,broadcastXpChange:ic,isXpSystemUnlocked:un,getXpRequirementForXpLevel:sc,getXpGainMultiplier:ac,setExternalCoinMultiplierProvider:jh,addExternalCoinMultiplierProvider:Uo,refreshCoinMultiplierFromXpLevel:Jt,setExternalXpGainMultiplierProvider:Zh,addExternalXpGainMultiplierProvider:hr,setExternalBookRewardProvider:lc,resetXpProgress:Yi}))});var ig={};bt(ig,{GHOST_TAP_TIMEOUT_MS:()=>XS,clearGhostTapTarget:()=>_a,consumeGhostTapGuard:()=>rg,initGlobalGhostTap:()=>eI,installGhostTapGuard:()=>QS,markGhostTapTarget:()=>og,setGhostTapSelector:()=>tI,shouldSkipGhostTap:()=>to,suppressNextGhostTap:()=>wo});function $o(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Yf(){return typeof document>"u"?null:document}function WS(e){if(!Yf())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(Vf)}function _a(e){e&&(e[cc]=0)}function og(e,t=0,n=null){if(!e)return;let o=$o(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[cc]=o+r:e[cc]=0,YS=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&wo(i)}function rg(e){if(typeof window>"u")return!1;let t=window[Ki];return typeof t!="number"?!1:$o()<=t?!0:(window[Ki]=null,!1)}function to(e){if(!e)return!1;let t=Number(e[cc]||0);return!Number.isFinite(t)||t<=0?!1:$o()<=t?(_a(e),!0):(_a(e),!1)}function wo(e=0){if(typeof window>"u")return;let t=$o(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[Ki]=null;return}let o=t+n,r=typeof window[Ki]=="number"?window[Ki]:0;window[Ki]=Math.max(r,o)}function zS(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(fc=gr=$o(),Do=0))}function KS(e){fc=gr=$o(),Do=0}function jS(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=$o();gr>0&&(Do=t-gr),fc=t}function ZS(){let e=$o();gr>0&&(Do=e-gr),fc=e}function JS(e){if(!e.isTrusted)return;let t=$o(),n=gr>0?t-gr:-1,o=WS(e.target);if(to(o)){Do=0,e.preventDefault(),e.stopImmediatePropagation();return}if(rg(o)){o&&_a(o),Do=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Do||n)>=ng){_a(o),Do=0,e.preventDefault(),e.stopImmediatePropagation();return}Do=0}function QS(e={}){if(Qh)return;let t=Yf();!t||typeof window>"u"||(Qh=!0,Xf="PointerEvent"in window,eg=!Xf&&"ontouchstart"in window,e.selector&&(Vf=`${e.selector}, ${uc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(ng=e.longPressMs),t.addEventListener("click",JS,!0),Xf?(t.addEventListener("pointerdown",zS,{capture:!0,passive:!1}),t.addEventListener("pointerup",jS,{capture:!0,passive:!0})):eg&&(t.addEventListener("touchstart",KS,{capture:!0,passive:!1}),t.addEventListener("touchend",ZS,{capture:!0,passive:!0})))}function tg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(uc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(og(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function eI(){let e=Yf();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",tg,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",tg,{capture:!1,passive:!1})}function tI(e){e&&(Vf=`${e}, ${uc}`)}var XS,cc,Ki,uc,VS,Qh,Vf,Xf,eg,YS,fc,gr,Do,ng,ji=Ue(()=>{XS=0,cc=Symbol("ccc:ghostTap:skipUntil"),Ki="__cccGhostTapSkipUntil",uc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',VS=80,Qh=!1,Vf=uc,Xf=!1,eg=!1,YS=null,fc=0,gr=0,Do=0,ng=VS});var Wf,sg=Ue(()=>{Wf={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var ag={};bt(ag,{RateAccumulator:()=>Ma,pauseGameLoop:()=>Jf,registerFrame:()=>sI,registerTick:()=>Eo,resumeGameLoop:()=>Qf,startGameLoop:()=>rI,stopGameLoop:()=>iI});function jf(e){e||(e=performance.now());let t=e;if(Zf){Kr=t,Zr=requestAnimationFrame(jf);return}Kr||(Kr=t);let n=(t-Kr)/1e3;Kr=t,n>60&&(n=60),n<0&&(n=0),jr+=n;let o=0,r=250;for(;jr>=Ca;){if(o>=r){jr=jr%Ca;break}zf.forEach(i=>{try{i(Ca)}catch(s){console.error("Error in game tick listener:",s)}}),jr-=Ca,o++}if(Kf.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),Zi===0||Ji===0)Zi=Date.now(),Ji=t;else{let i=t-Ji;if(i>oI){let s=Date.now(),l=s-Zi;l<-1e3?Sn():l>i+1e4&&Sn(),Zi=s,Ji=t}}Zr=requestAnimationFrame(jf)}function Jf(){Zf=!0}function Qf(){Zf=!1,Kr=performance.now(),jr=0,Zi=0,Ji=0}function rI(){Zr||(Kr=performance.now(),jr=0,Zi=0,Ji=0,Zr=requestAnimationFrame(jf))}function iI(){Zr&&(cancelAnimationFrame(Zr),Zr=null)}function Eo(e){return typeof e!="function"?()=>{}:(zf.add(e),()=>{zf.delete(e)})}function sI(e){return typeof e!="function"?()=>{}:(Kf.add(e),()=>{Kf.delete(e)})}var nI,Ca,zf,Kf,Zr,Zf,Kr,jr,Zi,Ji,oI,Ma,Jr=Ue(()=>{St();nI=20,Ca=1/nI,zf=new Set,Kf=new Set,Zr=null,Zf=!1,Kr=0,jr=0,Zi=0,Ji=0,oI=2e3;Ma=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Ca;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var je,Qr,ka,Aa,Ta,Na,no,Qi,aI,lg,ei=Ue(()=>{It();je="automation",Qr=1,ka=2,Aa=3,Ta=4,Na=5,no=6,Qi={[ka]:"coins",[Aa]:"books",[Ta]:"gold",[Na]:"magic"},aI=[{area:je,id:Qr,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:je,id:ka,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:je,id:Aa,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:je,id:Ta,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:je,id:Na,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:je,id:no,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],lg=aI.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var gg={};bt(gg,{getGearsProductionRate:()=>hc,getGenerationLevelKey:()=>oi,getGenerationUpgradeCost:()=>yr,initWorkshopSystem:()=>hg,initWorkshopTab:()=>ad,performFreeGenerationUpgrade:()=>gc,updateWorkshopTab:()=>oo});function ts(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*mI}function oi(e){return`ccc:workshop:genLevel:${e}`}function Pa(){let e=v();if(!e)return c.zero();let t=localStorage.getItem(oi(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function Fa(e){let t=v();if(!t)return!1;let n=oi(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function Ua(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let f=e.toPlainIntegerString();t=parseFloat(f)}catch{return 1/0}if(t<=0)return td;if(t<=ti)return td+t*ug;pc===null&&(pc=td+ti*ug);let n=t-ti;if(t<=Ra)return pc+n+ts(n,es);if(mc===null){let f=Ra-ti;mc=pc+f+ts(f,es)}let o=t-Ra,r=t-ti,i=Ra-ti,s=o+(ts(r,es)-ts(i,es)),l=fI/uI,a=.5*l*o*o;if(t<=dc)return mc+s+a;if(od===null){let f=dc-Ra,p=dc-ti,h=f+(ts(p,es)-ts(i,es)),m=.5*l*f*f;od=mc+h+m}let u=dI*(t-dc);if(u>709)return 1/0;let d=od*Math.exp(u);return!Number.isFinite(d)||d>179e306?1/0:d}function yr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=Ua(t);return Me(n)}function sd(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(nd);if(n.cmp(9e15)<=0){let s=Number(n.toString())*nd;t=Me(s)}else{let i=n.mulDecimal(nd);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Me(s)}catch{t=c.fromAny("Infinity")}}}let o=O?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function yI(){let e=yr(tt);if(O.coins.value.cmp(e)<0)return;let t=tt.add(1);Fa(t)&&(tt=t,O.coins.sub(e),oo(),en())}function vI(){if(!Dt())return;let n=sd(tt).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&O.gears&&O.gears.add(n),tt.cmp(20)<0){let r=Number(tt.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(ni+=a,ni>=1){let u=Math.floor(ni);ni-=u,O.gears&&O.gears.add(u)}}else ni=0}function id(){O.gears&&O.gears.set(0),Fa(c.zero())&&(tt=c.zero()),ni=0,oo()}function dg(e){if(!e)return;let t=Ba.get(e);if(!t){let s=e.getBoundingClientRect();t={gears:[],width:s.width,height:s.height,needsDistribution:!s.width||!s.height},Ba.set(e,t)}let n=e.getBoundingClientRect();n.width>0&&n.height>0&&(t.width=n.width,t.height=n.height);let o=0;tt.cmp(ed)>0?o=ed:o=Number(tt.toPlainIntegerString());let r=Math.min(Math.floor(o),ed),i=t.gears;for(;i.length<r;){let s=document.createElement("img");s.src=pg,s.classList.add("workshop-bg-gear"),s.alt="",s.setAttribute("aria-hidden","true");let l=32+Math.random()*48,a=0,u=0;t.width>0&&t.height>0?(a=Math.random()*(t.width-l),u=Math.random()*(t.height-l),a<0&&(a=0),u<0&&(u=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,f=Math.cos(d)*fg,p=Math.sin(d)*fg,h=Math.random()*360,m=(Math.random()<.5?-1:1)*(hI+Math.random()*gI);s.style.width=`${l}px`,s.style.transform=`translate3d(${a}px, ${u}px, 0) rotate(${h}deg)`,s.style.willChange="transform",e.appendChild(s),i.push({element:s,x:a,y:u,dx:f,dy:p,rotation:h,rotationSpeed:m,size:l})}for(;i.length>r;){let s=i.pop();s.element.parentNode&&s.element.parentNode.removeChild(s.element)}}function bI(e){let t="Click the big red button below to open the Automation Shop";Ze&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${lI}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${pg}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${cI}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{yI()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),II()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{rs("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(Qt&&Qt.isConnected){let a=Qt.querySelector(".workshop-side-left"),u=Qt.querySelector(".workshop-side-right"),d=f=>{if(!f)return;let p=Ba.get(f);if(p){let h=f.getBoundingClientRect();if(p.width=h.width,p.height=h.height,p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let m of p.gears)m.x=Math.random()*(p.width-m.size),m.x<0&&(m.x=0),m.y=Math.random()*(p.height-m.size),m.y<0&&(m.y=0),m.element.style.transform=`translate3d(${m.x}px, ${m.y}px, 0) rotate(${m.rotation}deg)`}}};d(a),d(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?mg():SI()},{root:null,threshold:0}).observe(e),Qt=e}function oo(){if(!Qt)return;let e=Qt.querySelector('[data-workshop="gears-amount"]'),t=Qt.querySelector('[data-workshop="gears-rate"]'),n=Qt.querySelector('[data-workshop="upgrade-cost"]'),o=Qt.querySelector('[data-workshop="upgrade-gen"]'),r=sd(tt),i=yr(tt);if(e&&(e.innerHTML=O.gears.fmt(O.gears.value)),t&&(t.innerHTML=ne(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${ne(i)} ${l}`}if(o){let l=O.coins.value.cmp(i)>=0;o.disabled=!l;let a=Mt(je,no),u=!1;if(a>0){let d=v(),f=d!=null?`:${d}`:"",p=`ccc:autobuy:${je}:${no}${f}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(tt.isInfinite()?s="Infinity":s=tt.floorToInteger().toStorage(),s!==rd){rd=s;let l=Qt.querySelector(".workshop-side-left"),a=Qt.querySelector(".workshop-side-right");l&&dg(l),a&&dg(a)}}function SI(){ns&&(cancelAnimationFrame(ns),ns=null)}function mg(){if(ns)return;Oa=0;let e=t=>{if(Qt&&Qt.isConnected){let n=Qt.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=O.gears.fmt(O.gears.value)),Oa||(Oa=t);let o=(t-Oa)/1e3;Oa=t,o>.1&&(o=.1);for(let[r,i]of Ba){if(!r.isConnected)continue;let{gears:s,width:l,height:a}=i;if(!(!l||!a))for(let u of s)u.x+=u.dx*o,u.y+=u.dy*o,u.x<0?(u.x=0,u.dx=-u.dx):u.x+u.size>l&&(u.x=l-u.size,u.dx=-u.dx),u.y<0?(u.y=0,u.dy=-u.dy):u.y+u.size>a&&(u.y=a-u.size,u.dy=-u.dy),u.rotation+=u.rotationSpeed*o,u.element.style.transform=`translate3d(${u.x}px, ${u.y}px, 0) rotate(${u.rotation}deg)`}}ns=requestAnimationFrame(e)};ns=requestAnimationFrame(e)}function hg(){cg||(cg=!0,tt=Pa(),Eo(vI),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{tt=Pa(),ni=0,Dt()||id(),oo()}),window.addEventListener("currency:change",e=>{e.detail.key===Ce.COINS&&oo()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Ce.GEARS&&oo()}),window.addEventListener("debug:change",()=>{tt=Pa(),oo()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Dt()||id())})))}function ad(e){hg(),!e.__workshopInit&&(e.__workshopInit=!0,tt=Pa(),Ba.clear(),rd=-1,bI(e),typeof IntersectionObserver>"u"&&mg(),Dt()||id(),oo())}function hc(){let e=Pa();return sd(e)}function gc(){let e=O.coins.value.isInfinite(),n=yr(tt).isInfinite();if(e&&n&&!tt.isInfinite())return tt=c.fromAny("Infinity"),Fa(tt),oo(),!0;if(O.coins.value.isZero())return!1;let o=Ae(O.coins.value);if(!Number.isFinite(o))if(O.coins.value.inf)o=1/0;else return!1;if(Ua(tt)>o||tt.cmp(9e15)>0)return!1;let r=Number(tt.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);Ua(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(tt)>0&&Fa(a)?(tt=a,oo(),!0):!1}function II(){if(O.coins.value.isInfinite()){gc()&&en();return}let e=Ae(O.coins.value);if(!Number.isFinite(e)&&O.coins.value.isZero()||Ua(tt)>e||tt.cmp(9e15)>0)return;let t=Number(tt.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);Ua(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(tt.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(yr(c.fromInt(u)));if(l.cmp(O.coins.value)>0){let u=yr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(tt)>0&&Fa(a)&&(tt=a,O.coins.sub(l),oo(),en())}var pg,lI,cI,ed,Qt,cg,ni,tt,rd,ns,td,nd,ti,Ra,dc,ug,es,uI,fI,dI,pI,mI,pc,mc,od,Ba,fg,hI,gI,Oa,os=Ue(()=>{It();Kt();St();Jr();ri();xo();ro();Lo();ei();pg="img/currencies/gear/gear.webp",lI="img/currencies/gear/gear_plus_base.webp",cI="img/currencies/coin/coin.webp",ed=100,Qt=null,cg=!1,ni=0,tt=c.zero(),rd=-1,ns=null,td=12,nd=.3010299956639812,ti=1e6,Ra=1e9,dc=1e12,ug=1,es=.001,uI=1e3,fI=Math.log10(1.00001),dI=23e-11,pI=Math.log(10),mI=1/pI;pc=null,mc=null,od=null;Ba=new Map,fg=67,hI=67,gI=67;Oa=0});function vg(e){typeof e=="function"&&yg.push(e)}function ld(){Da=null}function vc(){Da=null;try{yc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{Jt()}catch{}}function bg(e){return typeof e=="function"&&yc.push(e),()=>{yc=yc.filter(t=>t!==e)}}function EI(e){let t=ct(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Me(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function xI(){try{return!!un()}catch{return!1}}function $a(e){let t=O?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(xI())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=Mt(Se.STARTER_COVE,Ee.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=EI(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function is(e=Se.STARTER_COVE){if(Da)return Da;let t=Pt(e),n=[];if(e===Se.STARTER_COVE&&Se.DNA){let i=Pt(Se.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=En(s,i.id),a=De(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:d,xpMult:f,coinMult:p,mpMult:h}=Go(i,l,s);r.xpValue=Et(r.xpValue,f),r.coinValue=Et(r.coinValue,p),r.mpValue=Et(r.mpValue,h),u=Et(u,d)}if(i.effectType==="coin_spawn"){let d=1;if(u instanceof c)try{d=Number(u.toScientific())}catch{d=1}else d=Number(u);r.coinSpawn*=d}else if(i.effectType==="coin_value")r.coinValue=Et(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=Et(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=Et(r.mpValue,u);else if(i.effectType==="book_value")r.bookValue=Et(r.bookValue,u);else if(i.effectType==="magnet_radius"){let d=0;if(u instanceof c)try{d=Number(u.toScientific())}catch{d=0}else d=Number(u);Number.isFinite(d)&&(r.magnetRadius+=d)}}for(let i of yg)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return Da=r,r}function ss(e){let t=is(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:wI*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue}}function bc(){try{let{mpValue:e}=is(Se.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Sc(){try{let{magnetRadius:e}=is(Se.STARTER_COVE);return e||0}catch{return 0}}function Sg(){try{qo()}catch{}try{Uo(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=is(Se.STARTER_COVE);return Et(n,o)})}catch{}try{hr(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=is(Se.STARTER_COVE);return Et(n,o)})}catch{}try{ii(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=is(Se.STARTER_COVE);return Et(n,o)})}catch{}$a(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{$a()}catch{}try{Jt()}catch{}})}var wI,Da,yc,yg,cd=Ue(()=>{It();St();xo();Gn();_o();ro();wI=1,Da=null,yc=[],yg=[]});var Lg={};bt(Lg,{addExternalEacAmountMultiplierProvider:()=>dd,addExternalEacMultiplierProvider:()=>LI,getAutobuyerToggle:()=>si,getEacAmountMultiplier:()=>Ec,initAutomationEffects:()=>AI,setAutobuyerToggle:()=>vr,setTsunamiBonusProvider:()=>fd,updateAutomation:()=>xg});function fd(e){Ig=e}function LI(e){typeof e=="function"&&wg.push(e)}function dd(e){typeof e=="function"&&Eg.push(e)}function Ec(){let e=1;if(mt(2))if(mt(8)){let t=Yt(),n=Ig(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of Eg)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function pd(e){wc!==e&&(as.clear(),wc=e)}function si(e,t){let n=v();pd(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(as.has(r))return as.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return as.set(r,i),i}function vr(e,t,n){let o=v();pd(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);as.set(i,s);try{localStorage.setItem(i,s)}catch{}}function _I(e){xg(e),kI(e)}function CI(){if(Ic)return Ic;let e=Pt(Se.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Ic=t,Ic}function MI(e){if(!(!e||e.length===0)){for(let t of e)if(si(Se.STARTER_COVE,t.id)!=="0"){let o=Mt(Se.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&hd(Se.STARTER_COVE,t.id)}}}function kI(e){let t=v();pd(t);let n=CI();for(let[r,i]of Object.entries(Qi)){let s=Number(r);Mt(je,s)>0&&n[i]&&MI(n[i])}Mt(je,no)>0&&(ud++,ud>=5&&(ud=0,si(je,no)!=="0"&&gc()))}function xg(e){let n=Mt(je,Qr);for(let r of wg)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){qa=0;return}qa+=e;let o=1/n;if(qa>=o){let r=Math.floor(qa/o);if(r>0){let i=r;i*=Ec(),md(i),qa-=r*o}}}function AI(){Eo(_I),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==wc&&(as.clear(),wc=t)})}var qa,ud,Ig,wg,Eg,as,wc,Ic,ls=Ue(()=>{Jr();ro();Ga();ei();os();St();io();qa=0,ud=0,Ig=()=>0;wg=[];Eg=[];as=new Map,wc=null;Ic=null});function gd(){let e=v();if(Tg=e,e==null){Ha=!1;return}try{Ha=localStorage.getItem(TI(e))==="1"}catch{Ha=!1}}function Ho(e){return cs.nodes[e]||(cs.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),cs.nodes[e]}function NI(e,t){let n=Ho(t);try{let o=localStorage.getItem(Xa(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(Va(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(kg(e,t));n.active=i==="1";let s=localStorage.getItem(Ag(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function _g(){gd();let e=v();cs.nodes={},Xn=null,e!=null&&Ft.forEach(t=>{NI(e,t.id),cs.nodes[t.id].active&&(Xn=t.id)})}function Cg(){let e=v();e!=null&&Ft.forEach(t=>{let n=cs.nodes[t.id];if(n)try{localStorage.setItem(Va(e,t.id),n.rp.toStorage())}catch{}})}function yt(e){return Ho(e).level}function br(e,t){let n=v();if(n==null||Vt(Xa(n,e)))return!1;let o=Ho(e);o.level=t;try{localStorage.setItem(Xa(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function ao(e){return Ho(e).rp}function us(e,t){let n=v();if(n!=null&&Vt(Va(n,e)))return;let o=Ho(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function ai(e){return Ho(e).active}function Ya(e,t){let n=v();if(n==null)return;let o=!!t;o?(Xn!==null&&Xn!==e&&Ya(Xn,!1),Xn=e):Xn===e&&(Xn=null);let r=Ho(e);if(r.active!==o){r.active=o;try{localStorage.setItem(kg(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function Mg(e,t){let n=v();if(n==null)return;let o=Ho(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(Ag(n,e),o.discovered?"1":"0")}catch{}}}function Sr(e){let t=so.get(e);if(!t)return!1;if(Ho(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return Mg(e,!0),!0;if((e===5||e===6)&&((Tg!==v()||Ha===null)&&gd(),!Ha))return!1;for(let o of t.parentIds){let r=so.get(o);if(!r)continue;if(yt(o)<r.maxLevel)return!1}return Mg(e,!0),!0}function xc(e){let t=so.get(e);if(!t)return c.fromAny("Infinity");let n=yt(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function fn(){let e=0,t=yt(1);t>0&&(e+=t*.01);let n=yt(10);return n>0&&(e+=n*.01),e}function Ng(){return yt(4)>=1}function Rg(e=[]){if(v()!=null){try{ci(0)}catch{}Xn!==null&&Ya(Xn,!1),Ft.forEach(n=>{e.includes(n.id)||(br(n.id,0),us(n.id,c.fromInt(0)))})}}function Og(e){let t=fs();if(t.isZero?.()||Xn===null)return;let n=so.get(Xn);if(!n||!Sr(n.id))return;let r=t.mulDecimal(e.toString(),18),i=ao(n.id);if(yt(n.id)>=n.maxLevel)return;let s=i.add(r);for(;;){let l=xc(n.id);if(s.cmp(l)<0||yt(n.id)>=n.maxLevel)break;s=s.sub(l);let a=yt(n.id);if(!br(n.id,a+1))break}us(n.id,s)}function Pg(){let e=so.get(2);if(!e)return c.fromInt(1);let t=yt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function Bg(){let e=so.get(3);if(!e)return c.fromInt(1);let t=yt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function yd(){let e=so.get(5);if(!e)return c.fromInt(1);let t=yt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function vd(){let e=so.get(6);if(!e)return c.fromInt(1);let t=yt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function RI(){let e=so.get(7);if(!e)return c.fromInt(1);let t=yt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.25,t);return c.fromAny(n)}function Fg(){let e=so.get(8);return e?1+yt(e.id)*.1:1}function Ug(){let e=so.get(9);return e?1+yt(e.id)*.1:1}function Dg(){Uo(({baseMultiplier:e})=>{let t=Pg();return e.mulDecimal(t.toScientific())}),hr(({baseGain:e})=>{let t=Bg();return e.mulDecimal(t.toScientific())}),vg(()=>Fg()),dd(()=>Ug()),fd(()=>fn()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&Jt(),e&&e.id===8&&vc()})}var Xa,Va,kg,Ag,TI,Ft,so,Ha,Tg,cs,Xn,li=Ue(()=>{It();St();ui();Kt();Gn();cd();ls();Xa=(e,t)=>`ccc:lab:node:level:${t}:${e}`,Va=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,kg=(e,t)=>`ccc:lab:node:active:${t}:${e}`,Ag=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,TI=e=>`ccc:reset:experiment:completed:${e}`,Ft=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Ve(Pg())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Ve(Bg())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 2x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Ve(yd())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 2x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Ve(vd())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.25x per level",baseRpReq:1e9,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Ve(RI())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e12,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Ve(Fg())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e12,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Ve(Ug())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:"Increases the Tsunami exponent by +0.01 per level",baseRpReq:1e15,scale:2,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami exponent bonus: +${(e*.01).toFixed(2)}`}],so=new Map(Ft.map(e=>[e.id,e])),Ha=null,Tg=null,cs={nodes:{}},Xn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",_g),setInterval(Cg,1e3),window.addEventListener("beforeunload",Cg),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&gd()}),_g());window.RESEARCH_NODES=Ft;window.isResearchNodeVisible=Sr});var Vg={};bt(Vg,{getBookProductionRate:()=>Er,getSurge6WealthMultipliers:()=>Lc,getTsunamiNerf:()=>Yt,getTsunamiNerfKey:()=>Sd,getTsunamiSequenceSeen:()=>xn,initSurgeEffects:()=>BI,isSurgeActive:()=>mt,setTsunamiNerf:()=>ps,setTsunamiSequenceSeen:()=>wr});function Sd(e){return bd(e)}function xn(){let e=v();if(e==null)return!1;try{return localStorage.getItem(Xg(e))==="1"}catch{return!1}}function wr(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(Xg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Yt(){return Ir}function ps(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=v();if(n!=null){let o=bd(n);if(Vt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}Ir=t,ds();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function mt(e){return lo===1/0||typeof lo=="string"&&lo==="Infinity"||lo===Number.POSITIVE_INFINITY?!0:typeof lo=="bigint"?lo>=BigInt(e):typeof lo=="number"?lo>=e:!1}function Wa(e){if(!mt(8))return e;let t=Ae(e);if(!Number.isFinite(t))return e;let o=Yt()+fn();return o>1&&(o=1),Me(t*o)}function ds(){let e=co();lo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(mt(8)){let o=Yt()+fn();o>1&&(o=1);let r=Math.log10($g);Xo=Me(r*o)}else Xo=c.fromInt($g);else Xo=c.fromInt(1)}function Lc(){if(!mt(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,h=0)=>{if(!p){if(h<=0)return c.fromInt(1);let x=Math.log10(h)/3;if(x<=0)return c.fromInt(1);let R=x*Math.log10(2);return Me(R)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=Ae(p),y=m;if(Number.isFinite(m)){if(m<15&&h>0)try{let E=Number(p.toPlainIntegerString());if(Number.isFinite(E)){let x=E+h;x>0&&(y=Math.log10(x))}}catch{}}else if(h>0)y=Math.log10(h);else return c.fromInt(1);let g=y/6;if(g<=0)return c.fromInt(1);let b=g*Math.log10(2);return Me(b)},t=e(O.coins?.value),n=O.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(O.gold?.value),s=e(O.magic?.value),l=t,a=r,u=i,d=s;mt(8)&&(l=Wa(t),a=Wa(r),u=Wa(i),d=Wa(s));let f=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return f=f.mulBigNumInteger?f.mulBigNumInteger(u):f,f=f.mulBigNumInteger?f.mulBigNumInteger(d):f,{coins:l,books:a,gold:u,magic:d,total:f}}function Er(){if(!mt(3))return c.fromInt(0);let t=et().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(qg),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Me(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*qg;n=Me(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),O.books?.mult){let o=O.books.mult.get();n=n.mulBigNumInteger(o)}return mt(8)&&(n=Wa(n)),n}function OI(e){if(!mt(3))return;Gg||(Gg=new Ma("books",O));let t=Er();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);O.books&&O.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,O.books&&O.books.add(c.fromInt(o))}}}function Hg(e){if(e==null)return;let t=localStorage.getItem(bd(e));t!==null?(Ir=Number(t),(Number.isNaN(Ir)||!Number.isFinite(Ir))&&(Ir=mt(8)?0:1)):mt(8)?Ir=0:Ir=1}function PI(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function BI(){let e=v();ds(),Hg(e),ds(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=lo,n=mt(8);ds();let o=lo,r=mt(8);!n&&r?(ps(0),xn()||wr(!0)):r?PI(t,o)>0&&(ps(0),xn()||wr(!0)):n&&!r&&ps(1)}),window.addEventListener("lab:node:change",()=>{ds()}),window.addEventListener("saveSlot:change",()=>{Hg(v()),ds()})),Uo(({baseMultiplier:t})=>Xo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Xo)),hr(({baseGain:t})=>Xo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Xo)),ii(({baseGain:t})=>Xo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Xo)),ii(({baseGain:t})=>{if(!mt(4))return t;let n=c.fromInt(4444e9);if(mt(8)){let r=Yt()+fn();r>1&&(r=1);let i=Math.log10(4444e9);n=Me(i*r)}return t.mulBigNumInteger(n)}),Uo(({baseMultiplier:t})=>{if(!mt(6))return t;let n=Lc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),lc(({baseReward:t})=>mt(3)?c.fromInt(0):t),Eo(OI)}var $g,qg,bd,Xg,Xo,lo,Gg,Ir,io=Ue(()=>{It();St();Gn();_o();xo();Jr();It();li();$g=10,qg=.08685889638,bd=e=>`ccc:surge:tsunamiNerf:${e}`,Xg=e=>`ccc:unlock:tsunami:${e}`;Xo=c.fromInt(1),lo=0n,Gg=null,Ir=0});var jg={};bt(jg,{getLabCost:()=>zg,getLabLevel:()=>Wt,getLabLevelFromCoins:()=>Kg,getLabLevelKey:()=>wd,getRpMult:()=>fs,getRpMultBase:()=>Mc,hasVisitedLab:()=>ys,initLabLogic:()=>FI,initLabTab:()=>Ld,setLabLevel:()=>ci,setLabVisited:()=>Wg,updateLabLevel:()=>Ed,updateLabTab:()=>_d});function Ka(){let e=v();if(ja=e,e==null){Vo=c.fromInt(0),fi=!1;return}try{let t=localStorage.getItem(Cc(e));t?Vo=c.fromAny(t):Vo=c.fromInt(0)}catch{Vo=c.fromInt(0)}try{fi=localStorage.getItem(Yg(e))==="1"}catch{fi=!1}}function ys(){let e=v();return e==null?!1:((ja!==e||fi===null)&&Ka(),fi)}function Wg(e){let t=v();if(t==null)return;let n=!!e;if(!(fi===n&&ja===t)){fi=n;try{localStorage.setItem(Yg(t),n?"1":"0")}catch{}}}function Wt(){let e=v();return e==null?c.fromInt(0):O.coins.value.isInfinite()?c.fromAny("Infinity"):((ja!==e||Vo===null)&&Ka(),Vo)}function ci(e){let t=v();if(t!=null)try{let n=c.fromAny(e);if((ja!==t||Vo===null)&&Ka(),n.cmp(Vo)===0)return;Vo=n,localStorage.setItem(Cc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function zg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Kg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),d=s-20n+BigInt(u);return d<0n?c.fromInt(0):c.fromInt(d)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Ed(){let e=v();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Cc(e)))return;let t=O.coins.value,n=Wt();if(t.isInfinite()){n.isInfinite()||ci(c.fromAny("Infinity"));return}let o=Kg(t);o.cmp(n)>0&&ci(o)}function FI(){Ka(),typeof window<"u"&&window.addEventListener("saveSlot:change",Ka),Eo(Ed),Eo(Og),Dg()}function xd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function UI(e){if(!e||typeof e!="object")return 0;if(xd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function $I(e){if(xd(e)||typeof e.cmp=="function"&&e.cmp(DI)>=0)return gs.clone?.()??gs;let t=e.floorToInteger(),n=e.sub(t),o=UI(n);if(!Number.isFinite(o))return gs.clone?.()??gs;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return gs.clone?.()??gs;let f=BigInt(u)+l-BigInt(i),h=f%BigInt(250),m=Number(h),y=f-h;return new c(a,{base:m,offset:y})}function Mc(){let e=Wt();if(xd(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return $I(n)}function fs(){let e=Mc();return typeof Hn=="function"?Hn("rp",e):e}function Ld(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",za&&za.destroy(),za=new Id(e))}function _d(){Wg(!0),za&&za.resize()}var xr,ms,hs,Yg,Cc,Vo,fi,ja,wd,gs,DI,za,_c,Id,ui=Ue(()=>{St();Lo();It();Kt();io();Jr();zi();li();ri();ro();xr=1e308,ms=1e300,hs=1e-300,Yg=e=>`ccc:lab:visited:${e}`,Cc=e=>`ccc:lab:level:${e}`,Vo=null,fi=null,ja=null;wd=e=>Cc(e);gs=c.fromAny("Infinity"),DI=c.fromScientific(String(c.MAX_E));za=null;_c=512*.95,Id=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${ne(Wt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Ed()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=Ze?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>xr&&(this.camX=xr),this.camX<-xr&&(this.camX=-xr),this.camY>xr&&(this.camY=xr),this.camY<-xr&&(this.camY=-xr),this.zoom>ms&&(this.zoom=ms),this.zoom<hs&&(this.zoom=hs)}update(t){this.checkBounds();let n=Wt(),o=zg(n.add(1)),r=Yt(),i=fn(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${ne(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${ne(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let f=this.bursts.length-1;f>=0;f--){let p=this.bursts[f];p.time+=t;for(let h of p.particles)h.x+=h.vx*t,h.y+=h.vy*t,h.vx*=.95,h.vy*=.95;p.time>=p.life&&this.bursts.splice(f,1)}let a=500/this.zoom,u=0,d=0;if(this.keys.KeyW&&(d-=1),this.keys.KeyS&&(d+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||d!==0){let f=Math.sqrt(u*u+d*d);u/=f,d/=f,this.camX+=u*a*t,this.camY+=d*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,d=Math.floor(Math.log10(u)),f=Math.pow(10,d),p=(_,B)=>{if(B<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*B})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/_)*_,L=Math.ceil((this.camX+n/2/r)/_)*_;if((L-M)/_>1e3)return;for(let fe=M;fe<=L&&!(fe+_<=fe);fe+=_){let K=(fe-this.camX)*r+n/2;t.moveTo(K,0),t.lineTo(K,o)}let X=Math.floor((this.camY-o/2/r)/_)*_,J=Math.ceil((this.camY+o/2/r)/_)*_;for(let fe=X;fe<=J&&!(fe+_<=fe);fe+=_){let K=(fe-this.camY)*r+o/2;t.moveTo(0,K),t.lineTo(n,K)}t.stroke()},h=f*r,m=Math.max(0,Math.min(1,(h-15)/25));p(f,m),p(f*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let y=(0-this.camY)*r+o/2;y>=-10&&y<=o+10&&(t.moveTo(0,y),t.lineTo(n,y));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let b=[],E=new Map;for(let _ of Ft)Sr(_.id)&&(b.push(_),E.set(_.id,this.getNodePosition(_)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let _ of b)if(_.parentIds&&_.parentIds.length>0)for(let B of _.parentIds){let M=Ft.find(L=>L.id===B);if(M&&E.has(M.id)){let L=E.get(M.id),X=E.get(_.id),J=(L.x-this.camX)*r+n/2,fe=(L.y-this.camY)*r+o/2,K=(X.x-this.camX)*r+n/2,Q=(X.y-this.camY)*r+o/2;t.moveTo(J,fe),t.lineTo(K,Q)}}t.stroke();let x=_c,R=x*r,F=x*1.6*r;for(let _ of b){let B=E.get(_.id),M=(B.x-this.camX)*r+n/2,L=(B.y-this.camY)*r+o/2,X=yt(_.id),J=X>=_.maxLevel,fe=!0;if(M+F/2<0||M-F/2>n||L+F*.8<0||L-F/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,M-F/2,L-F/2,F,F),J?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,M-F/2,L-F/2,F,F):ai(_.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,M-F/2,L-F/2,F,F);let Q=this.nodeImages[_.id];if(Q||(Q=new Image,Q.src="img/"+_.icon,this.nodeImages[_.id]=Q),Q.complete&&Q.naturalWidth!==0&&t.drawImage(Q,M-R/2,L-R/2,R,R),fe){let ve=xc(_.id),he=0;if(J)he=1;else if(ve.isInfinite?.()||typeof ve.cmp=="function"&&ve.cmp(c.fromAny("Infinity"))===0)he=0;else{let W=ao(_.id);if(W.isZero?.())he=0;else try{if(ve.isZero?.())he=1;else{let me=W.div(ve).toScientific(5);he=Number(me)}}catch{he=0}}he=Math.max(0,Math.min(1,he));let V=F*.96,ee=F*.18,$=M-V/2,q=L+F/2+F*.05;t.fillStyle="#111",t.fillRect($,q,V,ee);let j=t.createLinearGradient($,q,$,q+ee);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,q,V*he,ee),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,q,V,ee),t.fillStyle="#fff",t.font=`bold ${ee*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,ee*.08);let le=`Level ${X}`;J&&(le=_.maxLevel===1?"UNLOCKED":"MAXED");let ue=t.measureText(le),C=q+ee/2+(ue.actualBoundingBoxAscent-ue.actualBoundingBoxDescent)/2;t.strokeText(le,$+V/2,C),t.fillText(le,$+V/2,C)}}let D=35,G=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let _ of this.bursts){let B=(_.x-this.camX)*this.zoom+n/2,M=(_.y-this.camY)*this.zoom+o/2;for(let L=0;L<G.length;L++){let X=G[L],J=_.time-X.delay;if(J>0&&J<X.dur){let fe=J/X.dur,K=1-Math.pow(1-fe,3),Q=D*K,ve=Math.max(0,1-Math.pow(fe,2)),he=1+L*.5,V=t.createRadialGradient(B,M,Q*.6,B,M,Q);V.addColorStop(0,"rgba(255, 200, 50, 0)"),V.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,ve*.15*he)})`),V.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,ve*.2*he)})`),V.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=V,t.beginPath(),t.arc(B,M,Q,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let L of _.particles)if(_.time<L.life){let X=1-_.time/L.life,J=B+L.x,fe=M+L.y;t.fillStyle=`rgba(255, 255, 150, ${X})`,t.beginPath(),t.arc(J,fe,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=_c/2*1.6;for(let u of Ft){if(!Sr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Ft.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.textContent=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let d=document.createElement("div");d.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=ai(t);Ya(t,!p),this.updateNodeOverlay()};let f=document.createElement("button");f.className="shop-close",f.textContent="Close",f.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},d.append(f,this.overlayToggleBtn),o.append(r,i,l,d),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Cd(r,o,()=>!!this.overlay,()=>f.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Ft.find(l=>l.id===this.activeOverlayId);if(!t||!Sr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=yt(t.id),o=ao(t.id),r=xc(t.id),i=ai(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.textContent=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?ne(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?ne(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${ne(o)} / ${ne(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=_c/2*1.6;for(let u of Ft){if(!Sr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){if(yt(u.id)>=u.maxLevel)return;let y=ai(u.id);Ya(u.id,!y),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,d=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=d/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=_c/2*1.6;for(let u of Ft){if(!Sr(u.id))continue;let d=this.getNodePosition(u),f=i-d.x,p=s-d.y;if(Math.sqrt(f*f+p*p)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<hs&&(i=hs),i>ms&&(i=ms);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,d=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=d-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<hs&&(i=hs),i>ms&&(i=ms);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,d=this.camX+(a-this.width/2)/r,f=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=d-(a-this.width/2)/i,this.camY=f-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var Qg={};bt(Qg,{calculateOfflineRewards:()=>vs,calculatePreAutomationRewards:()=>Ac,formatTimeCompact:()=>kc,grantOfflineRewards:()=>di,initOfflineTracker:()=>HI,processOfflineProgress:()=>Jg,showOfflinePanel:()=>Lr});function kc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),b=g.mulBigNumInteger(l),E=t.sub(b),x=0;try{let R=E.div(c.fromInt(i)).floorToInteger();x=Number(R.toPlainIntegerString())}catch{x=0}return x===0?`${ne(g)}y`:`${ne(g)}y ${x}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let d=Math.floor(u/60),f=u%60;if(d<60)return f===0?`${d}m`:`${d}m ${f}s`;let p=Math.floor(d/60),h=d%60;if(p<24)return h===0?`${p}h`:`${p}h ${h}m`;let m=Math.floor(p/24),y=p%24;return y===0?`${m}d`:`${m}d ${y}h`}function Lr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${kc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let d=document.createElement("div");d.className="offline-list",qI.forEach(m=>{let y=m.key,g=e[y];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(y==="research_levels"){Array.isArray(g)&&g.forEach(D=>{let G=document.createElement("div");G.className="offline-row";let _=document.createElement("span");_.className="offline-plus",_.style.color="#004F96",_.textContent="+";let B=document.createElement("img");B.className="offline-icon",B.src=m.icon,B.alt="RP";let M=document.createElement("span");M.className="offline-text",M.style.color="#004F96";let L=c.fromInt(D.levels),X=L.cmp(c.fromInt(1))===0?"Level":"Levels";M.textContent=`${ne(L)} ${X} of ${D.name}`,G.appendChild(_),G.appendChild(B),G.appendChild(M),d.appendChild(G)});return}let b=document.createElement("div");b.className="offline-row";let E=document.createElement("span");E.className="offline-plus",E.classList.add(`text-${y}`),E.textContent="+";let x=document.createElement("img");x.className="offline-icon",x.src=m.icon,x.alt=y;let R=document.createElement("span");R.className="offline-text",R.classList.add(`text-${y}`);let T=!1;g instanceof c?T=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:T=Number(g)===1;let F=T?m.singular:m.plural;R.innerHTML=`${ne(g)} ${F}`,b.appendChild(E),b.appendChild(x),b.appendChild(R),d.appendChild(b)}),u.appendChild(d),a.appendChild(u);let f=document.createElement("div");f.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let h=()=>{r.remove()};return p.addEventListener("click",h),r.addEventListener("click",m=>{m.target===r&&h()}),f.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(f),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{bs(i,a,".offline-scroll-container")}),r}function GI(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function vs(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=fs?fs():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),d=Ft.filter(h=>ai(h.id)),f=[],p={};for(let h of d){let m=yt(h.id),y=ao(h.id).add(u),g=0,b=h.maxLevel;for(;m<b;){let E=GI(h,m);if(E.isInfinite&&E.isInfinite()||y.cmp(E)<0)break;y=y.sub(E),m++,g++}g>0&&f.push({name:h.title,levels:g}),p[h.id]={level:m,rp:y}}f.length>0&&(o.research_levels=f),Object.keys(p).length>0&&(o.research_progress=p)}let s=(hc?hc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||Fn("gears",t)||(o.gears=s);let l=Er?Er():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||Fn("books",t)||(o.books=u)}let a=Mt(je,Qr)||0;if(a>0){let u=1;mt(2)&&(u=10);let d=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!d.isZero()){let f=Nc(),p=f.coins.mulBigNumInteger(d),h=f.xp.mulBigNumInteger(d),m=f.mp.mulBigNumInteger(d);p.isZero()||Fn("coins",t)||(o.coins=p),h.isZero()||Vt(`ccc:xp:progress:${t}`)||(o.xp=h),m.isZero()||Vt(`ccc:mutation:progress:${t}`)||(o.mp=m)}}return o}function di(e){if(v()!=null){if(e.xp)try{let n=Wi(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Ss(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(br(r,o.level),us(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||O[n]&&typeof O[n].add=="function"&&O[n].add(e[n])}}function Ac(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=Vn(),i=c.fromInt(1);try{let l=ss(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Hn=="function"){let l=Hn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=Nc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),d=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||Vt(`ccc:xp:progress:${t}`)||(o.xp=u),d.isZero()||Vt(`ccc:mutation:progress:${t}`)||(o.mp=d)}return o}function Jg(){let e=v();if(e==null)return;let t=Ef(),n=Date.now();if(t<=0)return;if(n<t-1e4){Sn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Dt()){let l=Ac(r),a=Object.keys(l).length>0;return a&&(di(l),Lr(l,o,!0)),a}let i=vs(r),s=Object.keys(i).length>0;return s&&(di(i),Lr(i,o)),s}function HI(e,t){Zg||(Zg=!0,document.addEventListener("visibilitychange",()=>{v()!=null&&(e&&!e()||(document.hidden?Jf():(Qf(),Jg()&&typeof t=="function"&&t())))}))}var Zg,qI,Tc=Ue(()=>{St();os();xo();Jr();St();It();Kt();ri();Lo();ro();ui();li();ei();Ga();Gn();_o();io();zi();Zg=!1;qI=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Lr});function Ad(e){let t=24,n=Date.now();try{let o=localStorage.getItem(Md(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(kd(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(Md(e),"24"),localStorage.setItem(kd(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function ty(e,t,n){try{localStorage.setItem(Md(e),String(t)),localStorage.setItem(kd(e),String(n))}catch{}}function ny(){let e=v();if(e==null)return;let{charges:t,lastCharge:n}=Ad(e);if(t>=Is)return;let o=Date.now(),r=o-n;if(r>=Rc){let i=Math.floor(r/Rc);t+=i,t>=Is?(t=Is,n=o):n+=i*Rc,ty(e,t,n),_r&&_r.classList.contains("is-active")&&Yo(!0)}}function VI(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function YI(){let e=v();if(e==null)return;ny();let{charges:t,lastCharge:n}=Ad(e);t<=0||(t>=Is&&(n=Date.now()-50),t--,ty(e,t,n),Yo(!0),Za&&clearInterval(Za),Za=setInterval(()=>{Yo()},1e3),dt(XI,{volume:.5}),VI(),setTimeout(()=>{let o=vs(ey);di(o),Lr(o,ey*1e3)},7250))}function Yo(e=!1){if(!_r||!_r.classList.contains("is-active"))return;let t=v();if(t==null)return;e||ny();let{charges:n,lastCharge:o}=Ad(t),r=_r.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${Is}</span>`);let i=_r.querySelector(".warp-timer");if(i)if(n>=Is)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+Rc,u=Math.max(0,a-l);i.textContent=`Next warp in ${kc(u)}`}let s=_r.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function oy(e){if(!e||e.__warpInit)return;e.__warpInit=!0,_r=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",YI),Za||(Za=setInterval(()=>{Yo()},1e3)),Yo()}var Md,kd,Is,Rc,ey,XI,_r,Za,Td=Ue(()=>{St();Tc();Bn();Md=e=>`ccc:warp:charges:${e}`,kd=e=>`ccc:warp:lastCharge:${e}`,Is=24,Rc=3600*1e3,ey=150,XI="sounds/warp.ogg",_r=null,Za=null});function py(){try{return localStorage.getItem(Mr($d))==="1"}catch{return!1}}function Gd(){try{return localStorage.getItem(Mr(my))==="1"}catch{return!1}}function Fc(e){let t=v();if(t==null)return;let n=`${my}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),WI()}catch{}}function Uc(){return Gd()?"Jeff":"Merchant"}function WI(){let e=Uc();We&&We.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function Ja(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&to(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(b=>console.error(b)),n&&y()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,wo(160)))},d=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},f=()=>{r&&l()},p=g=>{r=!0,wo(160)},h=g=>{r&&l()},m=()=>{r&&l()},y=()=>{e.removeEventListener("click",a),hy?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",f)):JI&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",h),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function Oc(e){return jI[e]??0}function ry(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function QI(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function el(e,t){let n=pi.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;Es.set(e,r),n.unlocked=r;let i=Ln.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&Ln.buttons[e]?.classList.contains("is-active")&&qc("dialogue")}function Nd(){let e=!1;try{e=!!_s?.()}catch{}el("reset",e)}function Rd(){let e=!1;try{e=!!Dt?.()}catch{}el("workshop",e)}function ly(){let e=!1;try{typeof Co=="function"&&(e=Co())}catch{}el("warp",e)}function ew(){let e=v();if(e==null)return!1;try{return typeof xn=="function"&&xn()?!0:localStorage.getItem(gy(e))==="1"}catch{return!1}}function Fd(){el("lab",ew())}function tw(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function nw(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof un=="function"&&un()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof et=="function"?et():null;t&&typeof t=="object"&&(e.xpLevel=tw(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Ar=="function"&&Ar()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Dt=="function"&&Dt()}catch{e.hasInfuseReset=!1}return e}function ow(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?Pd:Bd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?Pd:Bd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Hd:""),i.icon=o?.icon??(r==="mysterious"?Cr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Wo:KI),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function rw(){if(iy)return;iy=!0;let e=iw;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==v()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=v();if(t!=null){let n=`${ZI}:${t}`;Ct(n,{onChange:e})}}function iw(){zo()}function sw(e,t){let n=Xd(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,yy(n),aw(t.reward),!0)}function aw(e){if(e){if(e.type==="coins"){try{O.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{O.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{O.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function lw(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function Xd(){try{return JSON.parse(localStorage.getItem(Mr(Qa))||"{}")}catch{return{}}}function yy(e){let t=Mr(Qa);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{it(t,n)}catch{}}catch{}}function cw(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function uw(){let e=Ud;if(Ud=null,typeof e=="function")try{e()}catch{}}function fw(e,t={}){t?.rawChanged&&zo()}function Od(e){if(e===cy)return;if(uw(),cy=e??null,e==null){zo();return}let t=`${Qa}:${e}`;Ud=Ct(t,{parse:cw,onChange:fw});try{it(t)}catch{}zo()}function dw(){if(sy){Od(v());return}sy=!0,Od(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Od(v())})}function Tr(){Promise.resolve().then(()=>(Bn(),Gl)).then(({loadAudio:e})=>{e(vy)})}function pw(){if(ws)return;ws=dt(vy,{volume:Ze?.15:.3,loop:!0})}function jo(){ws&&(ws.stop&&ws.stop(),ws=null)}function mw(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let E=0;E<t.length;E++){let x=t[E];x==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=x):x===">"&&l?(s+=x,i.push({type:"tag",content:s}),s="",l=!1):s+=x}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,d=!1,f=!1,p="";Ko=!0,pw();let h=E=>{f&&(E.preventDefault(),d=!0)},m=E=>{f&&(E.key==="Enter"||E.key===" ")&&(d=!0)},y=o.length?o:[e];requestAnimationFrame(()=>{f=!0,y.forEach(E=>E.addEventListener("click",h,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{y.forEach(E=>E.removeEventListener("click",h)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),jo(),Ko=!1},b=()=>{if(d){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let E=i[a];E.type==="tag"?(p+=E.content,e.innerHTML=p,a++,b()):(p+=E.content[u],e.innerHTML=p,u++,u>=E.content.length&&(a++,u=0),setTimeout(b,n))};b()})}function hw(e={}){if(!We)return;Tr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Wo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Cr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,We.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Wo,r.textContent=e.message||Hd,requestAnimationFrame(()=>t.classList.add("is-visible")),We.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),We.classList.remove("firstchat-active"),jo(),Ko=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=d=>{d.key==="Escape"&&(d.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",d=>{n.contains(d.target)||(d.preventDefault(),Cn(160),l())});let u=d=>{(!d||d.pointerType!=="mouse")&&Cn(160),l()};Ja(i,()=>{u()},{once:!0}),i.focus?.()}function gw(e,t){Tr();let n=t.scriptId;String(e)==="6"&&typeof ys=="function"&&!ys()&&(n=7),Hr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Uc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${xs}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,We.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&f()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),We.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,d=()=>{Hr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),We.classList.remove("firstchat-active"),jo(),Ko=!1,o.remove()},f=()=>{u||(u=!0,d(),zo())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&Cn(160),f())});let p=new kr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,b)=>{t.scriptId===4&&g==="c4b"&&Fc(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){zo(),d();return}sw(e,t),zo(),d()}}}),m=!!Xd()[e]?.claimed,y=structuredClone(Wf[n]);m&&y.nodes.m2b&&y.nodes.c2a&&t.scriptId===1&&(y.nodes.m2b.say="I've already given you Coins, goodbye.",y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&y.nodes.m3a&&(y.nodes.m3a.say="I've already given you Books, goodbye.",y.nodes.c2a&&(y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&y.nodes.m5a&&(y.nodes.m5a.say="I've already given you Gold, goodbye.",y.nodes.c5a&&(y.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&y.nodes.m7a&&(y.nodes.m7a.say="I've already given you Magic, goodbye.",y.nodes.c7a&&(y.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(y),p.start()}function yw(){if(document.getElementById(fy))return;let e=document.createElement("style");e.id=fy,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function vw(){let e=We?.querySelector(".merchant-content");if(!e||e.__customScroll||!ht)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),ht.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){yw();let L=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;ht.style.timelineScope=L,e.style.scrollTimelineName=L,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=L,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let d=null,f=()=>{let M=(e.scrollTop||0)>0;d!==M&&(d=M,ht?.classList.toggle("has-scroll-shadow",M))},p=()=>{let M=We.querySelector(".merchant-grabber"),L=We.querySelector(".merchant-header"),X=We.querySelector(".merchant-actions"),J=(M?.offsetHeight||0)+(L?.offsetHeight||0)|0,fe=(X?.offsetHeight||0)|0;t.style.top=J+"px",t.style.bottom=fe+"px"},h={},m=()=>{let{scrollHeight:M,clientHeight:L,scrollTop:X}=e,J=t.clientHeight||e.clientHeight||1;if(h.scrollHeight===M&&h.clientHeight===L&&h.barH===J&&(u||h.scrollTop===X))return;h={scrollHeight:M,clientHeight:L,scrollTop:X,barH:J};let fe=L/Math.max(1,M),K=Math.max(28,Math.round(J*fe)),Q=Math.max(1,M-L),ve=Math.max(0,J-K);if(n.style.height=K+"px",u)n.style.setProperty("--thumb-y",`${ve}px`),n.style.setProperty("--thumb-x","0px");else{let he=Math.round(X/Q*ve);n.style.transform=`translateY(${he}px)`}t.style.display=M<=L+1?"none":""},y=()=>{p(),m(),f()},g=()=>{o&&(ht.classList.add("is-scrolling"),l&&clearTimeout(l))},b=M=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{ht.classList.remove("is-scrolling")},M))},E=()=>{m(),f(),o&&g(),s||b(r)},x=()=>b(r);e.addEventListener("scroll",E,{passive:!0}),s&&e.addEventListener("scrollend",x,{passive:!0});let R=new ResizeObserver(y);R.observe(e),window.addEventListener("resize",y),requestAnimationFrame(y);let T=!1,F=0,D=0,G=M=>{T=!0,F=M.clientY,D=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},_=M=>{if(!T)return;let L=t.clientHeight||1,X=n.clientHeight||1,J=Math.max(1,L-X),fe=Math.max(1,e.scrollHeight-e.clientHeight),Q=(M.clientY-F)/J*fe;e.scrollTop=D+Q},B=M=>{if(T){T=!1,n.classList.remove("dragging"),b(i);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",G),window.addEventListener("pointermove",_,{passive:!0}),window.addEventListener("pointerup",B),window.addEventListener("pointercancel",B),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let L=t.getBoundingClientRect(),X=M.clientY-L.top,J=t.clientHeight||1,fe=n.clientHeight||1,K=Math.max(0,J-fe),Q=Math.max(0,Math.min(X-fe/2,K)),ve=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=Q/Math.max(1,K)*ve,g(),b(r)}),e.__customScroll={bar:t,thumb:n,ro:R,updateAll:y},y()}function bw(){if(We)return;We=document.createElement("div"),We.className="merchant-overlay",We.id="merchant-overlay",We.setAttribute("inert",""),ht=document.createElement("div"),ht.className="merchant-sheet",ht.setAttribute("role","dialog"),ht.setAttribute("aria-modal","false"),ht.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",Nd(),Rd(),ly(),Fd(),pi.forEach(h=>{h.key==="dialogue"&&Es.set("dialogue",!0);let m=Es.get(h.key),y=m??!!h.unlocked,g=document.createElement("button");g.type="button",g.className="merchant-tab",g.dataset.tab=h.key;let b=h.lockedLabel||"???";g.textContent=y?h.label:b,y?g.title=h.label||"Tab":(g.classList.add("is-locked"),g.disabled=!0,g.title="???"),h.unlocked=y,Es.set(h.key,y),Ja(g,E=>{if(g.disabled){E?.preventDefault?.();return}qc(h.key)}),o.appendChild(g),Ln.buttons[h.key]=g}),Ln.panels.dialogue=i,Ln.panels.reset=s,Ln.panels.workshop=l,Ln.panels.warp=a,Ln.panels.lab=u,Ln.tablist=o,r.append(i,s,l,a,u),n.append(o,r),Nd(),Rd();try{qo()}catch{}try{Vd(s)}catch{}try{$e()}catch{}try{ad(l)}catch{}try{oy(a)}catch{}try{Ld(u)}catch{}if(!ay&&typeof window<"u"){let h=m=>{let{key:y,slot:g}=m?.detail??{};g!=null&&g!==v()||((y==="forge"||!y)&&Nd(),(y==="infuse"||!y)&&Rd(),(y==="surge_completed"||!y)&&ly(),(y==="lab"||y==="tsunami"||!y)&&Fd())};window.addEventListener("unlock:change",h,{passive:!0}),window.addEventListener("saveSlot:change",h,{passive:!0}),ay=!0}let d=document.createElement("div");d.className="merchant-actions";let f=document.createElement("button");f.type="button",f.className="merchant-close",f.textContent="Close",Pc=f,d.appendChild(f);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${xs}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,ht.append(e,t,n,d,p),We.appendChild(ht),document.body.appendChild(We),Sw(),vw(),uy||(uy=!0,Ja(f,()=>{$c()},{once:!1}),document.addEventListener("keydown",xw),e.addEventListener("pointerdown",Lw),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),We.addEventListener("pointerdown",Tr,{once:!0}))}function Sw(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,rw(),zo()}function Iw(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?gw(n.id,n.meta):n.isMysterious&&hw(n.lockInfo)}}function zo(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=nw(),o=Xd(),r=!1,i=new Set;Object.entries(Dc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",d=Oc(u),f=ow(l,n),p=f.status,h=Oc(p);if(h>d)a.status=p,p==="mysterious"?a.lockSnapshot=ry(f):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(h<d){if(u==="unlocked")f=QI(l),p="unlocked",h=Oc(p);else if(u==="mysterious"){let M=a.lockSnapshot||ry(f)||{};f={status:"mysterious",unlocked:!1,title:M.title??f.title??"???",blurb:M.blurb??f.blurb??Pd,tooltip:M.tooltip??f.tooltip??"Hidden Dialogue",message:M.message??f.message??Hd,icon:M.icon??f.icon??Cr,headerTitle:M.headerTitle??f.headerTitle??Wo,ariaLabel:M.ariaLabel??f.ariaLabel??"Hidden merchant dialogue"},p="mysterious",h=Oc(p)}}let m=p==="unlocked",y=p==="mysterious",g=p==="locked",b=!!a.claimed,E=m&&!!(l.once&&b),x=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!x){x=document.createElement("button"),x.type="button",x.className="dlg-card",x.dataset.dlgId=String(s);let M=document.createElement("div");M.className="dlg-title";let L=document.createElement("div");L.className="dlg-blurb";let X=document.createElement("div");X.className="dlg-reward",x.append(M,L,X),t.appendChild(x),Ja(x,Iw)}x._dlgCtx={id:s,meta:l,lockInfo:f,unlocked:m,isMysterious:y},x.dataset.dlgStatus=p,x.disabled!==!!g&&(x.disabled=!!g),x.classList.toggle("is-locked",g),x.classList.toggle("is-mysterious",y),x.classList.toggle("is-complete",!!E),x.classList.toggle("has-again",!!E),g?(x.getAttribute("aria-disabled")!=="true"&&x.setAttribute("aria-disabled","true"),x.getAttribute("tabindex")!=="-1"&&x.setAttribute("tabindex","-1")):(x.hasAttribute("aria-disabled")&&x.removeAttribute("aria-disabled"),x.hasAttribute("tabindex")&&x.removeAttribute("tabindex"));let R=x.querySelector(".dlg-title"),T=m?l.title:f.title??"???";R.textContent!==T&&(R.textContent=T);let F=x.querySelector(".dlg-blurb"),D=m?l.blurb:f.blurb??"";F.textContent!==D&&(F.textContent=D);let G=x.querySelector(".dlg-reward");if(m&&l.reward){let M=zI[l.reward.type];if(M){G.classList.contains("has-reward")||(G.classList.add("has-reward"),G.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),G.style.getPropertyValue("--reward-icon")!==`url('${M}')`&&G.style.setProperty("--reward-icon",`url('${M}')`);let L=G.querySelector(".amt"),X=String(l.reward.amount);L&&L.textContent!==X&&(L.textContent=X);let J=G.querySelector(".currency-name");if(J){let K=String(l.reward.type||""),Q=K.charAt(0).toUpperCase()+K.slice(1);J.textContent!==Q&&(J.textContent=Q)}let fe=`Reward: ${l.reward.amount} ${l.reward.type}`;G.getAttribute("aria-label")!==fe&&G.setAttribute("aria-label",fe)}else{G.classList.remove("has-reward");let L=lw(l.reward);G.textContent!==L&&(G.textContent=L),G.style.display!==""&&(G.style.display=""),G.removeAttribute("aria-label")}G.style.display==="none"&&(G.style.display="")}else G.textContent!==""&&(G.textContent=""),G.style.display!=="none"&&(G.style.display="none");let _=m?`${l.title}${E?" (completed)":""}`:f.ariaLabel||(y?"Hidden merchant dialogue":"Locked merchant dialogue");if(x.getAttribute("aria-label")!==_&&x.setAttribute("aria-label",_),f.tooltip)x.title!==f.tooltip&&(x.title=f.tooltip);else if(m){let M="Left-click: Start Dialogue";x.title!==M&&(x.title=M)}else x.hasAttribute("title")&&x.removeAttribute("title");let B=x.querySelector(".dlg-again");E?B||(B=document.createElement("div"),B.className="dlg-again",B.textContent="Ask Again?",x.appendChild(B)):B&&B.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&yy(o)}function ww(){let e=We.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Hr(!0);let i=new kr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Hr(!1);try{localStorage.setItem(Mr($d),"1")}catch{}try{window.dispatchEvent(new Event(qd))}catch{}e.classList.remove("is-visible"),We.classList.remove("firstchat-active")}});i.load(Wf[0]),i.start()}function Ew(){if(!We)return;let e=We.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),We.classList.remove("firstchat-active")}function by(){if(bw(),Ls)return;let e=document.activeElement;e instanceof HTMLElement&&!We.contains(e)?Bc=e:Bc=null,Ls=!0;let t=v(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(gy(t),"1")}catch{}Fd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Mr($d))==="1"}catch{o=!1}o||We.classList.add("firstchat-instant"),ht.style.transition="none",ht.style.transform="",We.removeAttribute("inert"),ht.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(We.classList.contains("firstchat-instant")||(ht.style.transition=""),We.classList.add("is-open"),Cn(140),Pc&&typeof Pc.focus=="function")try{Pc.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(Mr(dy))||"dialogue"}catch{}n&&(r="dialogue"),qc(r),jo(),o||(We.querySelector(".merchant-firstchat")?.classList.add("is-visible"),We.classList.add("firstchat-active"),ww())})})}function $c(){if(!Ls)return;if(Hr(!1),Ze){try{wo(100)}catch{}try{Cn(80)}catch{}}Ls=!1,ht.style.transition="",ht.style.transform="",We.classList.remove("is-open"),We.classList.remove("firstchat-instant"),Ew();let e=document.activeElement;if(e&&We.contains(e)){let t=Bc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}We.setAttribute("inert",""),Bc=null,jo(),Ko=!1}function xw(e){if(Ls&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<pi.length;i++)Es.get(pi[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<pi.length&&(e.preventDefault(),qc(pi[r].key))}}function Lw(e){if(!Ls)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;_n={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},ht.style.transition="none",window.addEventListener("pointermove",Sy,{passive:!0}),window.addEventListener("pointerup",Iy),window.addEventListener("pointercancel",wy)}function Sy(e){if(!_n||_n.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-_n.startY);_n.lastY=t,_n.moved=n,ht.style.transform=`translateY(${n}px)`}function Iy(){if(!_n||_n.canceled){Dd();return}let e=Math.max(1,performance.now()-_n.startT),t=_n.moved;t/e>.55&&t>40||t>140?(wo(160),ht.style.transition="transform 140ms ease-out",ht.style.transform="translateY(100%)",setTimeout(()=>{$c()},150)):(ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)"),Dd()}function wy(){_n&&(_n.canceled=!0,ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)",Dd())}function Dd(){window.removeEventListener("pointermove",Sy),window.removeEventListener("pointerup",Iy),window.removeEventListener("pointercancel",wy),_n=null}function qc(e){let t=pi.find(o=>o.key===e),n=Es.get(e);(!t||!n)&&(e="dialogue");for(let o in Ln.buttons)Ln.buttons[o].classList.toggle("is-active",o===e);for(let o in Ln.panels)Ln.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{zo()}catch{}if(e==="warp")try{Yo()}catch{}if(e==="lab"){typeof ys=="function"&&!ys()&&_w();try{_d()}catch{}}try{localStorage.setItem(Mr(dy),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=We?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function tl(e=[]){e.forEach(t=>el(t,!0))}function Ey(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${xs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Tr();let u=h=>{h.key==="Escape"&&(h.stopImmediatePropagation(),h.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let d=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{f()},5e3)},15e3)},1e3)},f=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${xs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let h=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),y=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),b={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},E=new kr({textEl:h,choicesEl:m,skipTargets:[h,y,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),jo(),Ko=!1,r.remove(),t&&t()},5e3)}});E.load(b),E.start()},p=new kr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",jo(),Ko=!1,n&&n.hideCursor&&n.hideCursor(),d()}});p.load(o),p.start()}function _w(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Uc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${xs}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Tr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new kr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{jo(),Ko=!1,e.remove()}});s.load(i),s.start()}function xy(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Uc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${xs}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Tr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new kr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{jo(),Ko=!1,t.remove(),e&&e()}});l.load(s),l.start()}var xs,$d,dy,Qa,qd,Mr,my,pi,Es,zI,Cr,Wo,KI,Pd,Bd,Hd,jI,ZI,hy,JI,iy,sy,ay,gy,cy,Ud,Dc,We,ht,Pc,Ls,_n,Bc,uy,Ln,vy,ws,Ko,kr,fy,Gc=Ue(()=>{St();It();sg();Gn();xo();os();Td();ui();io();ri();ji();Lo();Bn();xs="img/misc/merchant.webp",$d="ccc:merchantMet",dy="ccc:merchantTab",Qa="ccc:merchant:dlgState",qd="ccc:merchant:met",Mr=e=>`${e}:${v()}`;my="ccc:unlock:jeff";pi=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],Es=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),zI={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Cr="img/misc/mysterious.webp",Wo="Hidden Dialogue",KI="Locked Dialogue",Pd="Hidden Dialogue",Bd="Locked",Hd="Locked Dialogue",jI={locked:0,mysterious:1,unlocked:2},ZI="ccc:reset:forge:completed",hy=typeof window<"u"&&"PointerEvent"in window,JI=!hy&&typeof window<"u"&&"ontouchstart"in window;iy=!1,sy=!1,ay=!1;gy=e=>`ccc:unlock:lab:${e}`;cy=null,Ud=null;Dc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Cr,headerTitle:Wo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:Bd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Cr,headerTitle:Wo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof Co=="function"&&Co()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Cr,headerTitle:Wo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof xn=="function"&&xn())return!0;let t=typeof co=="function"?co():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof Co=="function"&&Co()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Cr,headerTitle:Wo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Cr,headerTitle:Wo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};dw();We=null,ht=null,Pc=null,Ls=!1,_n=null,Bc=null,uy=!1,Ln={buttons:{},panels:{},tablist:null},vy="sounds/merchant_typing.ogg",ws=null,Ko=!1;kr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await mw(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=Ja(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};fy="ccc-scroll-timeline-styles"});var Ly,Yd=Ue(()=>{Ly=[{area:"dna",id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM"},{area:"dna",id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM"}]});function Ty(e){if(!e||!e.costType)return!1;let t=Tw[e.costType];return!t||Mt(je,t)<=0?!1:si(e.area,e.id)!=="0"}function zd(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function Xc(e,t){return t==="standard"&&zd(e)===Aw}function Wd(e){let t=Pt(e),n={};for(let o of t){let r=En(e,o.id),i=Mt(e,o.id),s=Mo(e,o.id),l=s.iconOverride??Kc(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,d=!!s.locked,f=o.upgType==="HM"?!!ks(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:d,lockState:s,useLockedBase:!!s.useLockedBase||d,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:f}}return n}function Ny(e){return My[e]||My.standard}function Cn(e=140){if(!Ze)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Yc(e){return String(e??"").replace(/<[^>]*>/g,"")}function Hc(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function en(){dt(Rw,{volume:Ze?Ry:Oy})}function Py(){let e=Ze?Ry*2:Oy*2;dt(Ow,{volume:e})}function Pw(e){return`<img alt="" src="${Cy[e]||Cy.coins}" class="currency-ico">`}function Fw(){if(document.getElementById(ky))return;let e=document.createElement("style");e.id=ky,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function bs(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,d=150,f=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){Fw();let Q=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=Q,s.style.scrollTimelineName=Q,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=Q,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let y=null,g=()=>{let Q=((i?s.scrollTop:s.scrollLeft)||0)>0;y!==Q&&(y=Q,t?.classList.toggle("has-scroll-shadow",Q))},b=()=>{if(!s.isConnected||!t.isConnected)return;let K=s.getBoundingClientRect(),Q=t.getBoundingClientRect();if(i){let ve=Math.max(0,K.top-Q.top),he=Math.max(0,Q.bottom-K.bottom);l.style.top=ve+"px",l.style.bottom=he+"px",l.style.left="",l.style.right=""}else{let ve=Math.max(0,K.left-Q.left),he=Math.max(0,Q.right-K.right);l.style.left=ve+"px",l.style.right=he+"px",l.style.top="",l.style.bottom="",l.style.height=""}},E={},x=()=>{let K=i?s.scrollHeight:s.scrollWidth,Q=i?s.clientHeight:s.clientWidth,ve=i?s.scrollTop:s.scrollLeft,he=i?l.clientHeight||Q:l.clientWidth||Q;if(E.scrollSize===K&&E.clientSize===Q&&E.barSize===he&&(m||E.scrollPos===ve))return;E={scrollSize:K,clientSize:Q,scrollPos:ve,barSize:he};let V=Q/Math.max(1,K),ee=Math.max(28,Math.round(he*V)),$=Math.max(1,K-Q),q=Math.max(0,he-ee);if(i?(a.style.height=ee+"px",a.style.width="100%"):(a.style.width=ee+"px",a.style.height="100%"),m)i?(a.style.setProperty("--thumb-y",`${q}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${q}px`),a.style.setProperty("--thumb-y","0px"));else{let le=Math.round(ve/$*q);i?a.style.transform=`translateY(${le}px)`:a.style.transform=`translateX(${le}px)`}let j=K>Q+1;l.style.display=j?"":"none",t?.classList.toggle("has-active-scrollbar",j)},R=()=>{b(),x(),g()};typeof MutationObserver<"u"&&new MutationObserver(()=>R()).observe(s,{childList:!0,subtree:!0,characterData:!0});let T=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},F=K=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},K))},D=()=>{x(),g(),u&&T(),p||F(d)},G=()=>F(d);s.addEventListener("scroll",D,{passive:!0}),p&&s.addEventListener("scrollend",G,{passive:!0}),new ResizeObserver(R).observe(s),window.addEventListener("resize",R),requestAnimationFrame(R);let B=!1,M=0,L=0,X=K=>{B=!0,M=i?K.clientY:K.clientX,L=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),T();try{a.setPointerCapture(K.pointerId)}catch{}K.preventDefault()},J=K=>{if(!B)return;let Q=i?l.clientHeight:l.clientWidth,ve=i?a.clientHeight:a.clientWidth,he=Math.max(1,Q-ve),V=i?s.scrollHeight:s.scrollWidth,ee=i?s.clientHeight:s.clientWidth,$=Math.max(1,V-ee),j=(i?K.clientY:K.clientX)-M,le=L+j/he*$;i?s.scrollTop=le:s.scrollLeft=le},fe=K=>{if(B){B=!1,a.classList.remove("dragging"),F(f);try{a.releasePointerCapture(K.pointerId)}catch{}}};a.addEventListener("pointerdown",X),window.addEventListener("pointermove",J,{passive:!0}),window.addEventListener("pointerup",fe),window.addEventListener("pointercancel",fe),l.addEventListener("pointerdown",K=>{if(K.target===a)return;let Q=l.getBoundingClientRect(),ve=i?K.clientY-Q.top:K.clientX-Q.left,he=i?a.clientHeight:a.clientWidth,V=i?l.clientHeight:l.clientWidth,ee=Math.max(0,V-he),$=Math.max(0,Math.min(ve-he/2,ee)),q=i?s.scrollHeight:s.scrollWidth,j=i?s.clientHeight:s.clientWidth,le=Math.max(1,q-j),ue=$/Math.max(1,ee)*le;i?s.scrollTop=ue:s.scrollLeft=ue,T(),F(d)}),R()}function Ay(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let d=BigInt(a)-BigInt(u);return d>0n?c.fromAny(d.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function Uw(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let f=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(f)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=O[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let f=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return f&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):Ay(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let f=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),h=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(h));if(f.cmp(p)===0&&f.cmp(m)===0){let g=Ay(e,o,r),b=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,E=0,x=Math.max(0,b);for(;E<x;){let R=Math.floor((E+x+1)/2),T=c.fromInt(R);(typeof f.mulBigNumInteger=="function"?f.mulBigNumInteger(T):c.fromAny(f??0).mulBigNumInteger(T)).cmp(a)<=0?E=R:x=R-1}return c.fromInt(E)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:d}=mi(e,o,a,u,{fastOnly:!0});return d??c.fromInt(0)}function rs(e="standard"){(Wc[e]||Wc.standard).open()}function By(e=!1){Object.values(Wc).forEach(t=>t.close(e))}function Nr(e=!1){Object.values(Wc).forEach(t=>t.update(e))}function Dw(){if(tn)return;tn=document.createElement("div"),tn.className="upg-overlay",st=document.createElement("div"),st.className="upg-sheet",st.setAttribute("role","dialog"),st.setAttribute("aria-modal","false"),st.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",st.append(e,t,n,o,r),tn.appendChild(st),document.body.appendChild(tn),tn.addEventListener("pointerdown",u=>{Ze&&u.pointerType!=="mouse"&&u.target===tn&&(u.preventDefault(),u.stopPropagation())},!0),tn.addEventListener("click",u=>{Ze&&u.target===tn&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!zc)return;let d=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:d,lastY:d,moved:0},st.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let d=u.clientY;if(typeof d!="number")return;let f=Math.max(0,d-i.startY);i.lastY=d,i.moved=f,st.style.transform=`translateY(${f}px)`}function a(u){if(!i)return;let d=i.moved>140;if(st.style.transition="transform 160ms ease",st.style.transform=d?"translateY(100%)":"translateY(0)",d){if(Ze&&(!u||u.pointerType!=="mouse"))try{Cn(120)}catch{}setTimeout(Fy,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function Fy(){if(Ze)try{Cn(160)}catch{}if(typeof Vc=="function"){let e=Vc;Vc=null;try{e()}catch{}}zc=!1,!(!tn||!st)&&(st.style.transition="",st.style.transform="",tn.classList.remove("is-open"),tn.style.pointerEvents="none")}function $w(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let d=document.createElement("li"),f=document.createElement("span");f.className="hm-milestone-text",u&&typeof u=="object"?(f.textContent=u.text??"",u.achieved&&d.classList.add("hm-milestone-achieved")):f.textContent=u,d.appendChild(f),i.appendChild(d)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function qw(e,t="standard"){Dw(),zc=!0;let n=!0,o=Ny(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){zc=!1;return}let l=e.upgType==="HM",a=e.tie===Ee.ENDLESS_XP;function u(m,y,g="div"){let b=y.split(" ").filter(R=>R.length>0),E=null,x=[];for(let R=0;R<m.children.length;R++){let T=m.children[R];g&&T.tagName.toLowerCase()!==g.toLowerCase()||b.every(F=>T.classList.contains(F))&&(E?x.push(T):E=T)}return x.forEach(R=>R.remove()),E||(E=document.createElement(g),E.className=y,m.appendChild(E)),E}let d=m=>{let y=document.createElement("div");return y.className="upg-line",y.innerHTML=m,y},f=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let y=m.lockState||o.getLockState(e.id),g=!!y?.locked,b=g&&(y?.hidden||y?.hideEffect||y?.hideCost),E=!!m.unlockUpgrade&&!b;st.classList.toggle("is-locked-hidden",b);let x=st.querySelector(".upg-header"),R=u(x,"upg-title");R.textContent!==(m.displayTitle||m.upg.title)&&(R.textContent=m.displayTitle||m.upg.title);let T=!!m.hmReadyToEvolve,F=T?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,D=u(x,"upg-level"),G=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??ne(m.lvlCapBn),_=m.lvlCapFmtText??m.upg.lvlCapFmtText??Yc(G),B=T?`Level ${m.lvlFmtHtml} / ${G} (EVOLVE READY)`:F?`Level ${m.lvlFmtHtml} / ${G} (MAXED)`:`Level ${m.lvlFmtHtml} / ${G}`,M=Yc(B);D.innerHTML!==B&&(D.innerHTML=B),D.getAttribute("aria-label")!==M&&D.setAttribute("aria-label",M),D.hidden=b,b||D.removeAttribute("aria-hidden"),st.classList.toggle("is-maxed",F),st.classList.toggle("hm-evolve-ready",T),st.classList.toggle("is-unlock-upgrade",E),st.classList.toggle("is-hm-upgrade",l&&!b),st.classList.toggle("is-endless-xp",a),st.classList.toggle("is-magnet-upgrade",e.tie===Ee.MAGNET),st.classList.toggle("is-no-effect",!m.effect);let L=x.querySelector(".auto-toggle-wrapper"),X=t==="automation"?Qi[e.id]:null,J=t==="automation"&&e.id===no,fe=!!X,K=t==="standard"?Nw[e.costType]:null,Q=0;K?Q=Mt(je,K):(fe||J)&&(Q=Mt(je,e.id));let he=Q>0&&(fe||K||J)&&!b;L||(L=document.createElement("div"),L.className="auto-toggle-wrapper hm-view-milestones-row",x.appendChild(L));let V=L.querySelector("button");if(V||(V=document.createElement("button"),V.type="button",V.style.padding="10px 14px",V.style.fontSize="16px",V.style.width="auto",V.style.minWidth="180px",V.addEventListener("click",ie=>{typeof V._onClick=="function"&&V._onClick(ie)}),L.appendChild(V)),he){V.style.visibility="",V.style.pointerEvents="auto";let ie=v(),Ie=ie!=null?`:${ie}`:"",Re=!0;if(fe){let _e=`ccc:autobuy:master:${X}${Ie}`,Oe=Pt(Se.STARTER_COVE),se=!1;for(let te of Oe)if(te.costType===X){let we=`ccc:autobuy:${te.area}:${te.id}${Ie}`;if(si(te.area,te.id)!=="0"){se=!0;break}}Re=se}else Re=si(e.area,e.id)!=="0";Re?(V.className="shop-delve",V.textContent="Automation: ON",V.style.backgroundColor=""):(V.className="shop-close",V.textContent="Automation: OFF",V.style.backgroundColor=""),V._onClick=_e=>{_e.preventDefault(),_e.stopPropagation(),Ze&&Cn(50);let se=!Re?"1":"0";fe?(localStorage.setItem(`ccc:autobuy:master:${X}${Ie}`,se),Pt(Se.STARTER_COVE).forEach(we=>{we.costType===X&&vr(we.area,we.id,se)})):vr(e.area,e.id,se),p()}}else V.style.visibility="hidden",V.style.pointerEvents="none",V.className="shop-delve",V.textContent="Automation: ON",V._onClick=null;let ee=st.querySelector(".upg-content");f&&(ee.scrollTop=0,f=!1);let $=u(ee,"upg-desc centered");$.classList.toggle("lock-desc",b);let q=(m.displayDesc||m.upg.desc||"").trim();T?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):q?($.classList.remove("hm-evolve-note"),$.textContent!==q&&($.textContent=q),$.hidden=!1):$.hidden=!0;let j=u(ee,"upg-info"),le=null,ue=ie=>{le?le.nextElementSibling!==ie&&j.insertBefore(ie,le.nextSibling):j.firstElementChild!==ie&&j.prepend(ie),le=ie};if(g&&y?.reason&&!b){let ie=(m.displayDesc||"").trim(),Ie=String(y.reason??"").trim();if(ie!==Ie){let Re=j.querySelector(".lock-wrapper");if(!Re){Re=document.createElement("div"),Re.className="lock-wrapper";let se=document.createElement("div");se.className="upg-line lock-note",Re.append(se)}let _e=Array.from(Re.children);for(let se of _e)se.tagName==="DIV"&&!se.className&&se.style.height==="12px"&&se.remove();let Oe=Re.querySelector(".lock-note");Oe.textContent!==y.reason&&(Oe.textContent=y.reason),ue(Re)}else{let Re=j.querySelector(".lock-wrapper");Re&&Re.remove()}}else{let ie=j.querySelector(".lock-wrapper");ie&&ie.remove()}if(m.effect&&!(g&&y?.hideEffect)){let ie=j.querySelector(".effect-wrapper");if(!ie){ie=document.createElement("div"),ie.className="effect-wrapper";let Oe=document.createElement("div");Oe.className="upg-line",ie.append(Oe)}let Ie=Array.from(ie.children);for(let Oe of Ie)Oe.tagName==="DIV"&&!Oe.className&&Oe.style.height==="12px"&&Oe.remove();let Re=ie.querySelector(".upg-line"),_e=`<span class="bonus-line">${m.effect}</span>`;Re.innerHTML!==_e&&(Re.innerHTML=_e),ue(ie)}else{let ie=j.querySelector(".effect-wrapper");ie&&ie.remove()}let C=Pw(m.upg.costType),W=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ce=F||T;if(!m.unlockUpgrade&&!ce&&(!g||!y?.hideCost)){let ie=u(j,"upg-costs");ue(ie);let Ie=Hc(m.upg.costType,W),Re=`Cost: ${C} ${O[m.upg.costType].fmt(W)} ${Ie}`,_e=u(ie,"cost-line","div");if(_e.className.includes("upg-line")||(_e.className="upg-line cost-line"),_e.innerHTML!==Re&&(_e.innerHTML=Re),l){let we=u(ie,"milestone-line","div");we.className.includes("upg-line")||(we.className="upg-line milestone-line");let w="\u2014",Y="",z=Ty(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(z){let ae=m.hmNextMilestone.sub(c.fromInt(1)),Ge=0;try{let be=ae.toPlainIntegerString?.();be&&be!=="Infinity"?Ge=Number(be):Ge=Number(ae.toString())}catch{Ge=0}let nt=c.fromInt(0);try{nt=c.fromAny(m.upg.costAtLevel(Ge))}catch{}w=O[m.upg.costType].fmt(nt),Y=Hc(m.upg.costType,nt)}else{let ae=m.hmNextMilestone.sub(m.lvlBn),Ge=ae.toPlainIntegerString?.(),nt=Math.max(0,Math.floor(Number(Ge&&Ge!=="Infinity"?Ge:Number(ae.toString()||0)))),{spent:be}=mi(m.upg,m.lvlBn,c.fromAny("Infinity"),nt);w=O[m.upg.costType].fmt(be),Y=Hc(m.upg.costType,be)}}catch{}let ge=`${z?"Cost at next milestone:":"Cost to next milestone:"} ${C} ${w} ${Y}`;we.innerHTML!==ge&&(we.innerHTML=ge)}else{let we=ie.querySelector(".milestone-line");we&&we.remove()}let Oe=Hc(m.upg.costType,m.have),se=`You have: ${C} ${O[m.upg.costType].fmt(m.have)} ${Oe}`,te=u(ie,"have-line","div");te.className.includes("upg-line")||(te.className="upg-line have-line"),te.innerHTML!==se&&(te.innerHTML=se)}else{let ie=j.querySelector(".upg-costs");ie&&ie.remove()}let me=st.querySelector(".upg-milestones"),Z=me.querySelector(".hm-view-milestones-row");if(!Z){Z=document.createElement("div"),Z.className="hm-view-milestones-row";let ie=document.createElement("button");ie.type="button",ie.className="shop-delve hm-view-milestones",ie.textContent="View Milestones",ie.addEventListener("click",Ie=>{ie._onClick&&ie._onClick(Ie)}),Z.appendChild(ie),me.appendChild(Z)}let re=Z.querySelector("button");l&&!b?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ie=Array.isArray(m.hmMilestones)?m.hmMilestones:[],Ie=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Re=(()=>{try{return BigInt($t)*BigInt(Ie)}catch{return 0n}})(),_e=ie.sort((Oe,se)=>Number(Oe?.level||0)-Number(se?.level||0)).map(Oe=>{let se=Math.max(0,Math.floor(Number(Oe?.level||0))),te=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(se)+Re).toString())}catch{return c.fromAny(se+$t*Ie)}})(),we=te?.isInfinite?.()?"Infinity":ne(te),w=Ve(Oe?.multiplier??Oe?.mult??Oe?.value??1),Y=`${Oe?.target??Oe?.type??"self"}`.toLowerCase(),z=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(te)>=0}catch{}return!1})(),oe=`Level ${we}: Multiplies this upgrade\u2019s effect by ${w}x`;return Y==="xp"&&(oe=`Level ${we}: Multiplies XP value by ${w}x`),(Y==="coin"||Y==="coins")&&(oe=`Level ${we}: Multiplies Coin value by ${w}x`),Y==="mp"&&(oe=`Level ${we}: Multiplies MP value by ${w}x`),{text:oe,achieved:z}});$w(_e)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ye=st.querySelector(".upg-actions"),Le=ye.querySelector(".shop-close");if(Le||(Le=document.createElement("button"),Le.type="button",Le.className="shop-close",Le.textContent="Close",Le.addEventListener("click",()=>{n=!1,Fy()}),ye.appendChild(Le)),g||F)ye.querySelectorAll("button:not(.shop-close)").forEach(ie=>ie.remove()),document.activeElement&&document.activeElement!==Le&&!ye.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Le.focus();else{let ie=m.have.cmp(W)>=0,Ie=(se,te,we,w,Y=!1)=>{let z=ye.querySelector(`.${se.split(" ").join(".")}`);if(!z){z=document.createElement("button"),z.type="button",z.className=se,z.textContent=te;let oe=()=>{typeof z._onClick=="function"&&z._onClick()};"PointerEvent"in window?z.addEventListener("pointerdown",ae=>{ae.pointerType==="mouse"||typeof ae.button=="number"&&ae.button!==0||(oe(),ae.preventDefault())},{passive:!1}):z.addEventListener("touchstart",ae=>{oe(),ae.preventDefault()},{passive:!1}),z.addEventListener("click",()=>{Ze||oe()});let ge=ye.children;w>=ge.length?ye.appendChild(z):ye.insertBefore(z,ge[w])}return z._onClick=we,z.textContent!==te&&(z.textContent=te),z.disabled!==Y&&(z.disabled=Y),z};if(T){ye.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(se=>se.remove()),Ie("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:se}=o.evolve(e.id);se&&(Py(),Nr(),p())},1,!1);return}if(m.unlockUpgrade){ye.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(se=>se.remove()),Ie("shop-delve btn-unlock","Unlock",()=>{let{bought:se}=o.buyOne(e.id);if(!(se instanceof c?se:c.fromAny(se??0)).isZero?.()){if(en(),Xc(e,t))try{tl(["reset"])}catch{}Nr(),p()}},1,!ie);return}if(ye.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(se=>se.remove()),Ie("shop-delve btn-buy-one","Buy",()=>{let se=o.getUiModel(e.id);if(se.have.cmp(se.nextPrice instanceof c?se.nextPrice:c.fromAny(se.nextPrice||0))<0)return;let{bought:te}=o.buyOne(e.id);(te instanceof c?te:c.fromAny(te??0)).isZero?.()||(en(),Nr(),p())},1,!ie),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let se=ye.querySelector(".btn-buy-max");se&&se.remove();let te=ye.querySelector(".btn-buy-cheap");te&&te.remove()}else{Ie("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:w}=o.buyMax(e.id);(w instanceof c?w:c.fromAny(w??0)).isZero?.()||(en(),Nr(),p())},2,!ie);let te=[1,3,4,5,6].includes(zd(m.upg));if(!l&&!te)Ie("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let Y=o.buyCheap;if(!Y)return;let{bought:z}=Y(e.id);(z instanceof c?z:c.fromAny(z??0)).isZero?.()||(en(),Nr(),p())},3,!ie);else{let we=ye.querySelector(".btn-buy-cheap");we&&we.remove()}}if(l)Ie("shop-delve btn-buy-next","Buy Next",()=>{let te=o.getUiModel(e.id);if(te.hmReadyToEvolve)return;let we=te.hmNextMilestone;if(!we||!te.lvlBn||we.cmp(te.lvlBn)<=0){let{bought:be}=o.buyMax(e.id);if((be instanceof c?be:c.fromAny(be??0)).isZero?.())return;en(),Nr(),p();return}let w=0;try{let be=we.sub(te.lvlBn).toPlainIntegerString?.();w=Math.max(0,Math.floor(Number(be&&be!=="Infinity"?be:we.sub(te.lvlBn).toString())))}catch{}let Y=O[te.upg.costType]?.value,z=Y instanceof c?Y:c.fromAny(Y??0),ge=mi(te.upg,te.lvlBn,z,w).count,ae=!1;try{let be=ge?.toPlainIntegerString?.();ae=be&&be!=="Infinity"?Number(be)>=w:Number(ge??0)>=w}catch{}let Ge=ae?o.buyNext(e.id,w):o.buyMax(e.id);(Ge.bought instanceof c?Ge.bought:c.fromAny(Ge.bought??0)).isZero?.()||(en(),Nr(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let se=ye.querySelector(".btn-buy-next");se&&se.remove()}}},h=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,h)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",h),p(),tn.classList.add("is-open"),tn.classList.toggle("is-automation-upgrade",t==="automation"),tn.style.pointerEvents="auto",Cn(140),st.style.transition="none",st.style.transform="translateY(100%)",st.offsetHeight,requestAnimationFrame(()=>{st.style.transition="",st.style.transform=""}),Vc=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,h)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",h)}}function Cd(e,t,n,o){let r=null;function i(d){if(!n())return;let f=typeof d.clientY=="number"?d.clientY:d.touches?.[0]?.clientY||0;r={startY:f,lastY:f,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(d){if(!r||r.canceled)return;let f=d.clientY;if(typeof f!="number")return;let p=Math.max(0,f-r.startY);r.lastY=f,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let d=Math.max(1,performance.now()-r.startT),f=r.moved;f/d>.55&&f>40||f>140?(wo(100),Cn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",d=>d.preventDefault(),{passive:!1})}var _y,Cw,Mw,kw,Cy,Aw,Tw,Nw,My,Rw,Ow,Ry,Oy,Bw,ky,nl,Wc,tn,st,zc,Vc,ri=Ue(()=>{St();It();Kt();Lo();Gc();Ql();Bn();ro();ji();ei();ls();Yd();_y={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},Cw="img/misc/locked_base.webp",Mw="img/misc/maxed.webp",kw="img/misc/green_border.webp",Cy={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},Aw=7,Tw={coins:ka,books:Aa,gold:Ta,magic:Na};Nw={coins:ka,books:Aa,gold:Ta,magic:Na};My={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Wd(Vn()),getUiModel:e=>ks(Vn(),e),buyOne:e=>Cs(Vn(),e),buyMax:e=>ol(Vn(),e),buyCheap:e=>jd(Vn(),e),buyNext:(e,t)=>Ms(Vn(),e,t),getLockState:e=>Mo(Vn(),e),evolve:e=>Kd(Vn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",qd,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Wd(je),getUiModel:e=>ks(je,e),buyOne:e=>Cs(je,e),buyMax:e=>ol(je,e),buyNext:(e,t)=>Ms(je,e,t),getLockState:e=>Mo(je,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>Wd("dna"),getUiModel:e=>ks("dna",e),buyOne:e=>Cs("dna",e),buyMax:e=>ol("dna",e),buyNext:(e,t)=>Ms("dna",e,t),getLockState:e=>Mo("dna",e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof v=="function"?v():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||Nr(!0)});Rw="sounds/purchase_upg.ogg",Ow="sounds/evolve_upg.ogg",Ry=.12,Oy=.3;Bw="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",ky="ccc-scroll-timeline-styles";nl=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return Ny(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!py(),o=v();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let W=document.createElement("div");W.className="shop-tile";let ce=document.createElement("img");ce.className="base",ce.alt="";let me=document.createElement("img");me.className="icon",me.alt="",me.addEventListener("error",()=>{me.src=Bw}),W.appendChild(ce),W.appendChild(me),i.appendChild(W),t.appendChild(i),i.addEventListener("click",Z=>{let re=Z.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){Z.preventDefault(),Z.stopImmediatePropagation();return}if(to(re)){Z.preventDefault(),Z.stopImmediatePropagation();return}if(Z.shiftKey||Z.ctrlKey){if(Z.preventDefault(),Z.stopImmediatePropagation(),!re.upgMeta)return;let ye=re.upgMeta.id,Le=re.upgMeta.upgType==="HM",ie=[1,3,4,5,6].includes(zd(re.upgMeta));if(Z.shiftKey){if(!ie&&this.adapter.buyCheap){let{bought:_e}=this.adapter.buyCheap(ye);(_e instanceof c?_e:c.fromAny(_e??0)).isZero?.()||(en(),this.update());return}let{bought:Ie}=this.adapter.buyMax(ye);if(!(Ie instanceof c?Ie:c.fromAny(Ie??0)).isZero?.()){if(en(),Xc(re.upgMeta,this.mode))try{tl(["reset"])}catch{}this.update()}return}if(Z.ctrlKey){if(Le){let _e=this.adapter.getUiModel(ye);if(_e&&!_e.hmReadyToEvolve){let Oe=_e.hmNextMilestone;if(Oe&&_e.lvlBn&&Oe.cmp(_e.lvlBn)>0){let se=0;try{let oe=Oe.sub(_e.lvlBn).toPlainIntegerString?.();se=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Oe.sub(_e.lvlBn).toString())))}catch{}let te=O[_e.upg.costType]?.value,we=te instanceof c?te:c.fromAny(te??0),Y=mi(_e.upg,_e.lvlBn,we,se).count,z=!1;try{let oe=Y?.toPlainIntegerString?.();z=oe&&oe!=="Infinity"?Number(oe)>=se:Number(Y??0)>=se}catch{}if(z){let oe=this.adapter.buyNext(ye,se);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(en(),this.update());return}}}}let{bought:Ie}=this.adapter.buyMax(ye);if(!(Ie instanceof c?Ie:c.fromAny(Ie??0)).isZero?.()){if(en(),Xc(re.upgMeta,this.mode))try{tl(["reset"])}catch{}this.update()}return}}re.upgMeta&&qw(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",Z=>{if(Ze)return;let re=Z.currentTarget;if(re.dataset.locked==="1"||(Z.preventDefault(),Z.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:Ie}=this.adapter.evolve(re.upgMeta.id);Ie&&(Py(),this.update());return}let{bought:Le}=this.adapter.buyMax(re.upgMeta.id);if(!(Le instanceof c?Le:c.fromAny(Le??0)).isZero?.()){if(en(),Xc(re.upgMeta,this.mode))try{tl(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),d=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",d),i.disabled=d,d?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=d?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let h=s?c.fromInt(0):Uw(r.meta,r.levelNumeric,r.level),m=h instanceof c?h:c.fromAny(h),y=ne(r.level),g=Yc(y),b=ne(m),E=Yc(b),x=!m.isZero?.(),R=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,T=Number.isFinite(R)?Math.max(0,Math.floor(R)):1/0,F=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,D=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(T)&&Number.isFinite(F)?F>=T:!1,G=Number.isFinite(T)&&T===1,_=!!r.meta?.unlockUpgrade,B=!s&&_&&!D,M=!s&&_&&!B&&D,L,X,J=!1,fe=!1;if(s){L="",X="";let W=u?(r.lockState?.reason||"").trim():"",ce=W?`${r.title} (Locked, ${W})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ce)}else{if(B||M)L=B?"Unlockable":"Unlocked",X=L,fe=!0;else if(!s&&G&&!_)D?(L="Owned",X="Owned"):x?(L="Purchasable",X="Purchasable"):(L="Not Owned",X="Not Owned"),fe=!0;else{let W=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ce=String(g||"").replace(/,/g,""),me=/|Infinity/i.test(ce),Z=Number.isFinite(W)?W>=1e3:me||/^\d{4,}$/.test(ce);J=x&&Z,J?(L=`<span class="badge-lvl">${y}</span><span class="badge-plus">(+${b})</span>`,X=`${g} (+${E})`):(L=x?`${y} (+${b})`:y,X=x?`${g} (+${E})`:g)}i.setAttribute("aria-label",`${r.title}, ${X}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let K=i.firstElementChild,Q=K.querySelector(".base"),ve=K.querySelector(".icon"),he=r.meta?.costType||"coins",ee=r.useLockedBase||s?Cw:r.baseIconOverride||_y[he]||_y.coins;Q.src!==ee&&(Q.src=ee);let $=r.icon;if(!$)ve.hidden||(ve.hidden=!0);else{ve.hidden&&(ve.hidden=!1);let W=$;ve._lastSrc!==W&&(ve.src=W,ve._lastSrc=W)}let q=K.querySelector(".maxed-overlay"),j=!s&&Ty(r.meta),le=!s&&D;if(le||!s&&!D&&!p&&j){q||(q=document.createElement("img"),q.className="maxed-overlay",q.alt="",K.insertBefore(q,ve));let W=le?Mw:kw;q.src!==W&&(q.src=W)}else q&&q.remove();let C=K.querySelector(".level-badge");s?C&&C.remove():(C||(C=document.createElement("span"),C.className="level-badge",K.appendChild(C)),C.className="level-badge",fe&&C.classList.add("text-badge"),J&&C.classList.add("two-line"),(x||B)&&C.classList.add("can-buy"),D&&C.classList.add("is-maxed"),L===X?C.textContent!==L&&(C.textContent=L):C.innerHTML!==L&&(C.innerHTML=L))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),bs(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&to(a)||(Tr(),by())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(Ze&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{Ze&&Cn(80),this.close()},{passive:!0}),Cd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=v();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&xy(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,Ze)try{setTimeout(()=>wo(240),120)}catch{}Cn(10),bs(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},Wc={standard:new nl("standard"),automation:new nl("automation"),dna:new nl("dna")};tn=null,st=null,zc=!1,Vc=null});var $y={};bt($y,{applyHudLayout:()=>Zo,initHudButtons:()=>Hw,isMapUnlocked:()=>ep,isShopUnlocked:()=>Qd,lockMap:()=>Qc,lockShop:()=>Jc,unlockMap:()=>Zc,unlockShop:()=>hi});function Jd(e){let t=v();return t==null?e:`${e}:${t}`}function As(e){let t=Jd(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function Qd(){return tp(),As(uo.SHOP)}function ep(){return tp(),As(uo.MAP)}function jc(e,t){let n=t?"1":"0",o=Jd(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:v()}}))}catch{}}function tp(){for(let e of Object.values(uo)){let t=Jd(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function ko(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function Zd(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",$i())}function Gw(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function Zo(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=Gw(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(h=>e.querySelector(`.game-btn[data-btn="${h}"]`)).filter(Boolean),a=[...e.children].filter(h=>!l.includes(h)),u=[...l,...a];if(u.length&&u.some((h,m)=>e.children[m]!==h)){let h=document.createDocumentFragment();u.forEach(m=>h.appendChild(m)),e.appendChild(h)}let p=[...e.querySelectorAll(".game-btn")].filter(h=>!h.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(h=>{h.style.gridColumn="",h.style.gridRow="",h.classList.remove("span-2"),h.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let h=getComputedStyle(e),m=parseFloat(h.columnGap||h.gap||"0")||0,y=e.clientWidth,g=Math.max(180,Math.floor((y-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let h=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),y=e.querySelector('[data-btn="shop"]:not([hidden])');h&&m&&y&&(h.style.gridColumn="1",h.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",y.style.gridColumn="1 / -1",y.style.gridRow="2")}}function Hw(){if(tp(),ko("help",!0),ko("stats",!0),ko("shop",As(uo.SHOP)),ko("map",As(uo.MAP)),Zd(),Zo(),Uy||(Uy=!0,window.addEventListener("resize",Zo),window.addEventListener("orientationchange",Zo),window.addEventListener("saveSlot:change",()=>{ko("shop",As(uo.SHOP)),ko("map",As(uo.MAP)),Zd(),Zo()}),window.addEventListener("saveSlot:modified",e=>{let t=v(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||Zd()})),!Dy){Dy=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&rs()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&to(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function hi(){jc(uo.SHOP,!0),ko("shop",!0),Zo()}function Zc(){jc(uo.MAP,!0),ko("map",!0),Zo()}function Jc(){jc(uo.SHOP,!1),ko("shop",!1),Zo()}function Qc(){jc(uo.MAP,!1),ko("map",!1),Zo()}var uo,Uy,Dy,eu=Ue(()=>{ri();St();ji();uo={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Uy=!1,Dy=!1});function qy(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(W=>W.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,d=4,f=new Float32Array(t*d);for(let C=0;C<t;C++)f[C*d+2]=1/0;let p=new Int16Array(t),h=t;for(let C=0;C<t;C++)p[C]=t-1-C;let m=-1,y=document.createElement("canvas");y.className="cursor-trail-canvas",Object.assign(y.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(y);let g=y.getContext("2d",{alpha:!0,desynchronized:!0}),b=document.createElement("canvas");b.width=a,b.height=a;let E=b.getContext("2d");E.shadowColor="#FFEB3B",E.shadowBlur=l,E.fillStyle="#FFEB3B",E.beginPath(),E.arc(u,u,s,0,Math.PI*2),E.fill();let x=!1,R=null,T=null,F={left:0,top:0,width:0,height:0},D=1,G=!1,_=0,B=0,M=!1,L=null,X=[],J=()=>{if(G)return;let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;F={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}},fe=()=>{if(G)return;J();let C=Math.min(window.devicePixelRatio||1,2);D=F.width>0?Math.min(C,512/F.width):C,y.width=F.width*D,y.height=F.height*D,g.scale(D,D),L=null},K=null;typeof ResizeObserver<"u"&&(K=new ResizeObserver(()=>{fe()}),K.observe(e));let Q=(C,W)=>{if(h<=0)return;let ce=p[--h];ce>m&&(m=ce);let me=ce*d;f[me]=C,f[me+1]=W,f[me+2]=0,f[me+3]=n},ve=(C,W,ce)=>{if(R===null||T===null)ce.count<r&&(Q(C,W),ce.count++);else{let me=C-R,Z=W-T,re=Math.hypot(me,Z);if(re>=o){let ye=Math.floor(re/o);for(let Le=1;Le<=ye&&!(ce.count>=r);Le++){let ie=Le*o/re;Q(R+me*ie,T+Z*ie),ce.count++}}ce.count<r&&(Q(C,W),ce.count++)}R=C,T=W},he=C=>{if(G)return;_||(B=0,_=requestAnimationFrame(ee)),F.width||J();let W=0,ce=0,me=(Z,re)=>Z>=0&&Z<=F.width&&re>=0&&re<=F.height;if(C.getCoalescedEvents){let Z=C.getCoalescedEvents();if(Z.length>0)for(let re of Z){let ye=re.clientX-W,Le=re.clientY-ce;X.push({x:ye,y:Le,inside:me(ye,Le)})}else{let re=C.clientX-W,ye=C.clientY-ce;X.push({x:re,y:ye,inside:me(re,ye)})}}else{let Z=C.clientX-W,re=C.clientY-ce;X.push({x:Z,y:re,inside:me(Z,re)})}},V=()=>{x=!1,R=null,T=null,X.length=0},ee=()=>{if(G)return;let C=performance.now();B||(B=C);let W=C-B;B=C,W>100&&(W=100);let ce={count:0};if(X.length>0){for(let Re of X)Re.inside?(x=!0,ve(Re.x,Re.y,ce)):(x=!1,R=null,T=null);let Ie=X[X.length-1];Ie.inside&&(R!==Ie.x||T!==Ie.y)&&(Q(Ie.x,Ie.y),R=Ie.x,T=Ie.y),X.length=0}else x&&R!==null&&T!==null&&Q(R,T);let me=t-h;if(me===0&&!M){_=0;return}L?g.clearRect(L.x,L.y,L.w,L.h):g.clearRect(0,0,F.width,F.height),M=!1;let Z=1/0,re=1/0,ye=-1/0,Le=-1/0,ie=-1;if(me>0)for(let Ie=0;Ie<=m;Ie++){let Re=Ie*d,_e=f[Re+2];if(_e>=f[Re+3])continue;if(_e+=W,f[Re+2]=_e,_e>=f[Re+3]){p[h++]=Ie;continue}ie=Ie;let Oe=f[Re+3],se=_e/Oe,te=1-se,we=1-.4*se;M=!0,g.globalAlpha=te;let w=a*we,Y=w/2,z=f[Re],oe=f[Re+1],ge=Math.round(z-Y),ae=Math.round(oe-Y),Ge=Math.round(w);g.drawImage(b,ge,ae,Ge,Ge),ge<Z&&(Z=ge),ae<re&&(re=ae);let nt=ge+Ge,be=ae+Ge;nt>ye&&(ye=nt),be>Le&&(Le=be)}m=ie,Z!==1/0?(Z-=2,re-=2,ye+=2,Le+=2,L={x:Z,y:re,w:ye-Z,h:Le-re}):L=null,_=requestAnimationFrame(ee)};window.addEventListener("resize",fe),window.addEventListener("scroll",J,{passive:!0}),window.addEventListener("focus",J,{passive:!0}),document.addEventListener("visibilitychange",J,{passive:!0});let $={passive:!0},q=C=>{J(),he(C)},j=C=>{J(),he(C)};e.addEventListener("pointermove",he,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",q,$),e.addEventListener("pointerleave",V,$),e.addEventListener("pointercancel",V,$),fe(),_=requestAnimationFrame(ee);let le=setInterval(J,1e3);return{destroy:()=>{G=!0,_&&cancelAnimationFrame(_),le&&clearInterval(le),K&&(K.disconnect(),K=null);try{window.removeEventListener("resize",fe)}catch{}try{window.removeEventListener("scroll",J)}catch{}try{window.removeEventListener("focus",J)}catch{}try{document.removeEventListener("visibilitychange",J)}catch{}try{e.removeEventListener("pointermove",he),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",q),e.removeEventListener("pointerleave",V),e.removeEventListener("pointercancel",V)}catch{}y.remove()}}}var Gy=Ue(()=>{});var Qy={};bt(Qy,{clearPendingGains:()=>fp,getPassiveCoinReward:()=>Nc,initCoinPickup:()=>Jw,setCoinMultiplier:()=>Ww,triggerPassiveCollect:()=>md});function Hy(e){if(!e||typeof e!="object"){il=!1,tu=!1,nu="0",vi.clear();return}il=!!e.unlocked,tu=!!e.level?.isInfinite?.();try{nu=e.level?.toPlainIntegerString?.()??"0"}catch{nu="0"}il?tu&&vi.clear():vi.clear()}function Xw(){if(typeof gi=="function")try{gi()}catch{}try{Hy(ut())}catch{il=!1,vi.clear()}try{gi=bi(e=>{Hy(e)})}catch{gi=null}}function Ww(e){Yw=e;try{O.coins?.mult?.set&&O.coins.mult.set(e)}catch{}}function ip(){try{let e=bc();e instanceof c?Ns=e.clone?.()??e:e!=null?Ns=c.fromAny(e):Ns=c.fromInt(1)}catch{Ns=c.fromInt(1)}}function zw(){Xy||(Xy=!0,ip(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",ip),typeof window<"u"&&window.addEventListener("saveSlot:change",ip))}function Kw(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return cp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function lp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*jw:0}function Zw({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,d=0,f=0,p=0,h=null,m=null,y=lp(),g=0,b=0,E=0,x=!1,R=null,T=null,F=()=>{if(x)return;let $=document.documentElement.clientWidth,q=document.documentElement.clientHeight;R={left:0,top:0,width:$,height:q,right:$,bottom:q,x:0,y:0}},D=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",h=null,m=null},G=()=>{if(!l||b<=0){D();return}let $=b*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${f-b}px, ${p-b}px, 0)`,s.classList.add("is-visible")},_=()=>{if(!(!l||b<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=b+sp,q=[];if(typeof i.findCoinTargetsInPath=="function"&&h!==null&&m!==null?q=i.findCoinTargetsInPath(h,m,f,p,$):q=i.findCoinTargetsInRadius(f,p,$),h=f,m=p,q&&q.length>0)if(typeof r=="function"){let j=[];for(let le=0;le<q.length;le++){let ue=q[le],C={coin:ue};ue.el&&i.getCoinTransform&&(C.opts={transform:i.getCoinTransform(ue.el)}),j.push(C)}r(j)}else for(let j=0;j<q.length;j++){let le=q[j],ue=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(ue){let C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform||"";o(ue,{transform:C})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=b+sp,q=i.findCoinsInRadius(f,p,$);if(h=f,m=p,q&&q.length>0){let j=[];for(let le=0;le<q.length;le++){let ue=q[le],C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform;j.push({el:ue,opts:{transform:C}})}typeof r=="function"&&r(j)}}else{let $=t.children,q=b+sp,j=[];for(let le=$.length-1;le>=0;le--){let ue=$[le];if(ue.dataset.collected==="1"||!ue.matches(n))continue;let C=ue.getBoundingClientRect(),W=C.left+C.width/2,ce=C.top+C.height/2,me=W-u,Z=ce-d;Math.hypot(me,Z)<=q&&j.push(ue)}if(!j.length)return;if(typeof r=="function"){let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push({el:C,opts:{transform:W.transform}})}r(le)}else{let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push(W.transform)}for(let ue=0;ue<j.length;ue++)o(j[ue],{transform:le[ue]})}}},B=()=>{E=0,G(),!(!l||b<=0||x)&&(_(),M())},M=()=>{!l||b<=0||E||x||(E=requestAnimationFrame(B))},L=$=>{if(!$||x||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,d=$.clientY,R||F();let q=R;f=u,p=d,l=f>=0&&f<=q.width&&p>=0&&p<=q.height,M()},X=()=>{l=!1,D(),h=null,m=null},J=()=>{h=null,m=null},fe=()=>{g=Sc(),b=g*y,G(),M()},K=()=>{if(!(x||!a)){if(F(),R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()}},Q=()=>{if(y=lp(),b=g*y,F(),a&&R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()},ve=$=>{F(),L($)},he=$=>{J(),ve($)},V=()=>{x=!0,E&&(cancelAnimationFrame(E),E=0),T&&clearInterval(T);try{window.removeEventListener("scroll",K)}catch{}try{window.removeEventListener("resize",Q)}catch{}try{window.removeEventListener("saveSlot:change",fe)}catch{}try{document.removeEventListener("ccc:upgrades:changed",fe)}catch{}try{e.removeEventListener("pointermove",L)}catch{}try{e.removeEventListener("pointerdown",ve)}catch{}try{e.removeEventListener("pointerenter",he)}catch{}try{e.removeEventListener("pointerleave",X)}catch{}try{e.removeEventListener("pointercancel",X)}catch{}try{window.removeEventListener("blur",J)}catch{}try{s.remove()}catch{}},ee={passive:!0};return e.addEventListener("pointermove",L,ee),e.addEventListener("pointerdown",ve,ee),e.addEventListener("pointerenter",he,ee),e.addEventListener("pointerleave",X,ee),e.addEventListener("pointercancel",X,ee),window.addEventListener("resize",Q),window.addEventListener("scroll",K,{passive:!0}),window.addEventListener("focus",F,{passive:!0}),window.addEventListener("blur",J,{passive:!0}),document.addEventListener("visibilitychange",()=>{F(),document.hidden&&J()},{passive:!0}),window.addEventListener("saveSlot:change",fe),document.addEventListener("ccc:upgrades:changed",fe),T=setInterval(F,1e3),fe(),{destroy:V}}function fp(){sl=null,al=null,ll=null}function Jy(e){let t=cp.clone?.()??c.fromInt(1),n=jy(t),o=fo(Vy),i=Zy(e??nu);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Ao=="function"&&Ao()?fo(Ns):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function Nc(){let{coinGain:e,xpGain:t,mpGain:n}=Jy(null);return{coins:e,xp:t,mp:n}}function md(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=Jy(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=Fn(Ce.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{Mn=Mn?.add?Mn.add(r):fo(r)}catch{Mn=fo(r)}rl(),a||Yy(r);let u=typeof un=="function"?un():!0,d=typeof i?.isZero=="function"?i.isZero():!1;u&&!d&&Wy(i),s.isZero?.()||zy(s)}function Jw({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){np?.destroy&&np.destroy();let a=document.querySelector(t),u=document.querySelector(n),d=document.querySelector(o);if(!a||!u||!d)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!d}),{destroy(){}};Xw(),zw(),a.style.touchAction="none";let f=null,p=null;Mn=O.coins.value,ap=()=>{let C=ne(Mn);C.includes("<span")?d.innerHTML=C:d.textContent=C},Ky(),rl();let h=C=>{C?.detail&&C.detail.key==="coins"&&(Mn=C.detail.value,rl())};window.addEventListener("currency:change",h);let m=C=>{if(!(!C?.detail||C.detail.key!=="coins"))try{let{mult:W}=C.detail;W instanceof c?Yn=W.clone?.()??W:W!=null?Yn=c.fromAny(W):Yn=c.fromInt(1),yi=!!Yn?.isInfinite?.()}catch{Yn=null,yi=!1}};window.addEventListener("currency:multiplier",m);let y=v();if(y==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${y}`,b=`ccc:unlock:shop:progress:${y}`,E=localStorage.getItem("ccc:unlock:shop:progress"),x=localStorage.getItem("ccc:unlock:shop");E!=null&&localStorage.getItem(b)==null&&localStorage.setItem(b,E),x!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,x),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let C=parseInt(localStorage.getItem(b)||"0",10);if(localStorage.setItem(b,String(C)),C>=10&&localStorage.getItem(g)!=="1"){try{hi()}catch{}localStorage.setItem(g,"1")}}let R=new URL(i,document.baseURI).href,T=C=>C instanceof HTMLElement?C._coinObj?!C._coinObj.isRemoved&&C.dataset.collected!=="1":C.dataset.collected!=="1"&&C.matches(r):!1;function F(C){try{C.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(F);let D=Ze?.12:.3,G=0;function _(C=R){if(C===R){let W=performance.now();if(W-G<40)return;G=W}dt(C,{volume:D})}function B(C,W={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(C);let ce=()=>{C&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(C):C.remove())};if(l||Ze){ce();return}let me="translate3d(0,0,0)";W.transform?W.transform!=="none"&&(me=W.transform):me=C.style.transform||"translate3d(0,0,0)",C.style.setProperty("--ccc-start",me),C.classList.add("coin--collected");let Z=!1,re=()=>{Z||(Z=!0,C.removeEventListener("animationend",re),ce())};C.addEventListener("animationend",re),setTimeout(re,600)}function M(C){if(!C||!C.length)return;let W=R,ce=-1,me=!1;for(let se of C){let te=se.coin||se.el&&se.el._coinObj;te&&(te.sizeIndex!==void 0?te.sizeIndex>ce&&(ce=te.sizeIndex,te.soundSrc&&(W=te.soundSrc,me=!0)):te.soundSrc&&!me&&(W=te.soundSrc,me=!0))}_(W);let Z=null,re=null,ye=null,Le=0,ie=Fn(Ce.COINS),Ie=typeof un=="function"?un():!0,Re=typeof Ao=="function"&&Ao(),_e=15,Oe=0;for(let se of C){let te=se.el,we=se.coin;if(!we&&te&&te._coinObj&&(we=te._coinObj),te&&!T(te)||we&&we.isRemoved)continue;Le++,te&&(te.dataset.collected="1"),Oe<_e?(!te&&we&&e&&e.ensureCoinVisual&&(te=e.ensureCoinVisual(we),te&&(te.dataset.collected="1")),te?(B(te,se.opts||{}),Oe++):we&&e&&e.removeCoinTarget&&e.removeCoinTarget(we)):we&&e&&e.removeCoinTarget?e.removeCoinTarget(we):te&&(e&&e.detachCoin&&e.detachCoin(te),e&&e.recycleCoin?e.recycleCoin(te):te.remove());let w=te?Kw(te):cp,Y=we?.mutationLevel??(te?.dataset?.mutationLevel||null),z=jy(w),oe=fo(Vy),ge=fo(Ns);if(we&&we.valueMultiplier&&we.valueMultiplier>1){try{z=z.mulDecimalFloor(we.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(we.valueMultiplier)}catch{}try{ge=ge.mulDecimalFloor(we.valueMultiplier)}catch{}}let ae=Zy(Y);if(ae){try{z=z.mulBigNumInteger(ae)}catch{}try{oe=oe.mulBigNumInteger(ae)}catch{}}ie||(Z=Rs(Z,z)),Ie&&(re=Rs(re,oe)),Re&&(ye=Rs(ye,ge))}if(Le!==0){if(Z&&!Z.isZero?.()){try{Mn=Mn?.add?Mn.add(Z):fo(Z)}catch{Mn=fo(Z)}Yy(Z),rl()}if(re&&!re.isZero?.()&&Wy(re),ye&&!ye.isZero?.()&&zy(ye),localStorage.getItem(g)!=="1"){let te=parseInt(localStorage.getItem(b)||"0",10)+Le;if(localStorage.setItem(b,String(te)),te>=10){try{hi()}catch{}localStorage.setItem(g,"1")}}}}function L(C,W={}){return M([{el:C,opts:W}]),!0}f=Zw({playfield:a,coinsLayer:u,coinSelector:r,collectFn:L,collectBatchFn:M,spawner:e}),p=qy(a);let X=C=>{if(C.target===u)return;let W=C.target.closest(r);if(W&&T(W)){let ce={};e&&typeof e.getCoinTransform=="function"&&(ce.transform=e.getCoinTransform(W)),L(W,ce)}};u.addEventListener("pointerdown",X,{passive:!0}),Ze||u.addEventListener("mouseover",X,{passive:!0});let J=25,fe=null,K=()=>{let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;fe={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}};window.addEventListener("resize",K),window.addEventListener("scroll",K,{passive:!0}),K();let Q=null,ve=null,he=()=>{Q=null,ve=null};a.addEventListener("pointerleave",he,{passive:!0}),a.addEventListener("pointerenter",he,{passive:!0}),window.addEventListener("blur",he,{passive:!0});function V(C,W){if(e&&typeof e.findCoinTargetsInRadius=="function"){fe||K();let ce=C,me=W,Z=[];if(typeof e.findCoinTargetsInPath=="function"&&Q!==null&&ve!==null?Z=e.findCoinTargetsInPath(Q,ve,ce,me,J,!0):Z=e.findCoinTargetsInRadius(ce,me,J,!0),Q=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye=0;ye<Z.length;ye++){let Le=Z[ye],ie={coin:Le};Le.el&&e.getCoinTransform&&(ie.opts={transform:e.getCoinTransform(Le.el)}),re.push(ie)}M(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){fe||K();let ce=C,me=W,Z=e.findCoinsInRadius(ce,me,J);if(Q=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye of Z){let Le=e.getCoinTransform?e.getCoinTransform(ye):ye.style.transform;re.push({el:ye,opts:{transform:Le}})}M(re)}}else{let ce=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],me=new Set;for(let Z=0;Z<ce.length;Z++){let re=C+ce[Z][0],ye=W+ce[Z][1],Le=document.elementsFromPoint(re,ye);for(let ie=0;ie<Le.length;ie++){let Ie=Le[ie];T(Ie)&&!me.has(Ie)&&me.add(Ie)}}if(me.size>0){let Z=[];me.forEach(re=>Z.push({el:re})),M(Z)}}}let ee=null,$=!1;function q(C,W){ee={x:C,y:W},$||($=!0,requestAnimationFrame(()=>{ee&&(V(ee.x,ee.y),ee=null),$=!1}))}a.addEventListener("pointerdown",C=>{q(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointermove",C=>{C.pointerType!=="mouse"&&q(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointerup",C=>{C.pointerType!=="mouse"&&q(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("mousemove",C=>{q(C.clientX,C.clientY)},{passive:!0});function j(C){}let le=setInterval(K,1e3),ue=()=>{if(clearInterval(le),ou(),ap=()=>{},typeof window<"u"&&(window.removeEventListener("resize",K),window.removeEventListener("beforeunload",ou),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",h),window.removeEventListener("blur",he)),typeof gi=="function"){try{gi()}catch{}gi=null}if(f?.destroy){try{f.destroy()}catch{}f=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",X),Ze||u.removeEventListener("mouseover",X)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(C=>a.replaceWith(a.cloneNode(!0)))}catch{}};return np={destroy:ue},{get count(){return Mn},set count(C){Mn=c.fromAny?c.fromAny(C):c.fromInt(Number(C)||0),rl()},setMobileVolume:j,destroy:ue,collectBatch:M,getMagnetUnitPx:lp}}var il,tu,nu,gi,np,Vy,cp,Vw,Ts,vi,Yw,Ns,Xy,sl,al,ll,op,Mn,ap,rp,rl,jw,sp,fo,Rs,ou,up,Yy,Wy,zy,Yn,yi,Ky,jy,Zy,Ga=Ue(()=>{St();It();Kt();eu();Gn();Lo();_o();ro();Gy();Bn();il=!1,tu=!1,nu="0",gi=null;np=null,Vy=c.fromInt(1),cp=c.fromInt(1),Vw=c.fromInt(1);try{Ts=c.fromAny("Infinity")}catch{Ts=null}vi=new Map,Yw="1",Ns=c.fromInt(1),Xy=!1,sl=null,al=null,ll=null,op=!1,Mn=null,ap=()=>{},rp=!1,rl=()=>{rp||(rp=!0,requestAnimationFrame(()=>{rp=!1,ap()}))};jw=.05,sp=8;fo=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Rs=(e,t)=>{if(!t)return e;if(!e)return fo(t);try{return e.add(t)}catch{try{return fo(e).add(t)}catch{return fo(t)}}},ou=()=>{let e=sl;if(sl=null,e&&!e.isZero?.())try{O.coins.add(e)}catch{}let t=al;if(al=null,t&&!t.isZero?.())try{Wi(t)}catch{}let n=ll;if(ll=null,n&&!n.isZero?.())try{Ss(n)}catch{}},up=()=>{op||(op=!0,requestAnimationFrame(()=>{op=!1,ou()}))},Yy=e=>{sl=Rs(sl,e),up()},Wy=e=>{al=Rs(al,e),up()},zy=e=>{ll=Rs(ll,e),up()};typeof window<"u"&&window.addEventListener("beforeunload",ou,{passive:!0});Yn=null,yi=!1,Ky=()=>{try{let e=O?.coins?.mult;if(!e||typeof e.get!="function"){Yn=null,yi=!1;return}let t=e.get();if(!t){Yn=c.fromInt(1),yi=!1;return}Yn=t.clone?.()??c.fromAny(t),yi=!!Yn?.isInfinite?.()}catch{Yn=null,yi=!1}},jy=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Yn||Ky();let n=Yn;if(!n)try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(yi||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},Zy=e=>{if(!il)return null;if(tu){if(Ts)try{return Ts.clone?.()??Ts}catch{return Ts}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=vi.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{vi.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=Os(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(Vw)===0,s=r.clone?.()??r;if(vi.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function tv(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let i=Number(e.toString());isNaN(i)||(t=i),(e==="Infinity"||i===1/0)&&(n=!0)}catch{}let o=[],r=[];for(let i of ev){let s=i;if(n){s={...i,description:[...i.description]};let l=Yt(),a=fn(),u=l+a;if(u>1&&(u=1),i.id===1){let d=Math.pow(10,u),f=Ve(d);s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===2){let d=Math.pow(10,u),f=Ve(d);s.description[1]=s.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===4){let d=Math.log10(4444e9),f=Me(d*u),p=ne(f);s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${p}x</span>`)}}i.surgeLevel<=t?o.push(s):r.push(s)}return[...o,...r.slice(0,2)]}var ev,dp,nv=Ue(()=>{Kt();It();It();io();li();ev=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${ne(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]}],dp=ev.filter(e=>e.affectedByTsunami).map(e=>e.id)});function ov(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=dt("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function d(w,Y){w.style.position="absolute",w.style.left="50%";let z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ge=!!o.mpHTML;Y==="coin"?(w.style.top="77%",w.style.transform=`translateX(-50%) ${z}`):oe&&ge?(w.style.top="72.5%",Y==="mp"?w.style.transform=`translateX(calc(-100% - 44px)) ${z}`:w.style.transform=`translateX(44px) ${z}`):(Y==="mp"?w.style.top="66%":Y==="xp"&&(w.style.top="72%"),w.style.transform=`translateX(-50%) ${z}`),w.style.transformOrigin="center center";let ae=w.firstElementChild;ae&&(ae.removeAttribute("hidden"),ae.style.display="flex")}if(o.coinHTML){let w=document.createElement("div");w.innerHTML=o.coinHTML,d(w,"coin"),u.appendChild(w)}if(o.xpHTML){let w=document.createElement("div");w.innerHTML=o.xpHTML,d(w,"xp"),u.appendChild(w)}if(o.mpHTML){let w=document.createElement("div");w.innerHTML=o.mpHTML,d(w,"mp"),u.appendChild(w)}e.appendChild(u);let f=document.createElement("canvas");f.id="tsunami-fg-canvas",f.style.position="absolute",f.style.inset="0",f.style.width="100%",f.style.height="100%",f.style.zIndex="2147483646",f.style.pointerEvents="none",e.appendChild(f);let p=new Image;p.src="img/misc/merchant.webp";let h=!1;p.onload=()=>{h=!0},p.onerror=w=>{console.error("Tsunami: Merchant load failed",w)};let m,y,g=[],b=[],E=0;function x(){g=[],b=[];let w=y*.65,Y=w+y*.15,oe=300*(Math.min(m,y)*5e-4),ge=m*.8,ae=ge-oe*.6,Ge=ge+oe*.6;for(let lt=0;lt<100;lt++){let an=Math.random()*m,At=Y+Math.random()*(y-Y);b.push({x:an,y:At})}let nt=(lt,an,At)=>{if(lt>m*.1&&lt<m*.9){let bn=y-w,vo=w+bn*.15;if(an>vo)return!1}else if(At==="tree"){let bn=y-w,vo=w+bn*.5;if(an>vo)return!1}return!(At==="tree"&&lt>ae&&lt<Ge)},be=(lt,an,At,bn,vo)=>{for(let ar=0;ar<an;ar++){let Oo,Po,lr=!1,S=0;for(;!lr&&S<50;){vo?Oo=vo():Oo=Math.random()*m;let k=y,P=Math.random();if(Po=w+20+P*P*(k-w-20),nt(Oo,Po,lt)&&(lr=!0,lt==="tree")){for(let A of g)if(A.type==="tree"){let N=A.x-Oo,pe=A.y-Po;if(Math.sqrt(N*N+pe*pe)<Math.max(m*.08,100)){lr=!1;break}}}S++}if(lr){let P=.6+(Po-w)/(y-w)*.6,A=(At+Math.random()*bn)*P;g.push({type:lt,x:Oo,y:Po,scale:A})}}},Fe=3+Math.floor(Math.random()*3);be("tree",Fe,.8,.4,()=>Math.random()*(m*.1)),be("tree",Fe,.8,.4,()=>m*.9+Math.random()*(m*.1));let qt=5+Math.floor(Math.random()*3);be("tree",qt,.8,.4,()=>m*.1+Math.random()*(m*.8)),be("rock",20,.6,.4),be("shell",30,.3,.3),g.sort((lt,an)=>lt.y-an.y)}let R=a.getContext("2d",{alpha:!1}),T=f.getContext("2d",{alpha:!0});function F(){let w=window.devicePixelRatio||1;m=window.innerWidth,y=window.innerHeight,a.width=m*w,a.height=y*w,a.style.width=m+"px",a.style.height=y+"px",f.width=m*w,f.height=y*w,f.style.width=m+"px",f.style.height=y+"px",R.scale(w,w),T.scale(w,w),x(),E=-50}window.addEventListener("resize",F),F();let D=Date.now(),G=!0,_,B=!1,M={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},L={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},X=!1,J=[],fe=0,K=!1,Q=0,ve=5e3,he=!1,V=0,ee=[],$=6;for(let w=0;w<$;w++)ee.push({offset:Math.random()*1e3,speedBase:.001+w*5e-4,amplitudeBase:10+w*5});let q=[],j=400;function le(w,Y,z){return w*(1-z)+Y*z}function ue(w){let Y=parseInt(w.slice(1),16);return{r:Y>>16&255,g:Y>>8&255,b:Y&255}}function C(w,Y,z){let oe=ue(w),ge=ue(Y),ae=Math.round(le(oe.r,ge.r,z)),Ge=Math.round(le(oe.g,ge.g,z)),nt=Math.round(le(oe.b,ge.b,z));return`rgb(${ae},${Ge},${nt})`}function W(w,Y,z){let oe=[],ge=w,ae=Y,Ge=20;for(;ae<z;){let nt=ge+(Math.random()-.5)*60,be=ae+Ge+Math.random()*30;oe.push({x1:ge,y1:ae,x2:nt,y2:be}),ge=nt,ae=be}return oe}function ce(w,Y,z,oe,ge,ae){w.beginPath(),w.moveTo(Y+ae,z),w.lineTo(Y+oe-ae,z),w.quadraticCurveTo(Y+oe,z,Y+oe,z+ae),w.lineTo(Y+oe,z+ge-ae),w.quadraticCurveTo(Y+oe,z+ge,Y+oe-ae,z+ge),w.lineTo(Y+ae,z+ge),w.quadraticCurveTo(Y,z+ge,Y,z+ge-ae),w.lineTo(Y,z+ae),w.quadraticCurveTo(Y,z,Y+ae,z),w.closePath()}function me(w,Y,z,oe,ge){w.save(),w.translate(Y,z),w.scale(oe,oe),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(10,-40,-5,-80),w.lineTo(5,-80),w.quadraticCurveTo(20,-40,10,0),w.fillStyle=ge.rock,w.fill(),w.translate(0,-80),w.fillStyle=ge.leaf;for(let ae=0;ae<7;ae++)w.save(),w.rotate(ae/7*Math.PI*2-Math.PI/2),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(30,-10,60,0),w.quadraticCurveTo(30,10,0,0),w.fill(),w.restore();w.restore()}function Z(w,Y,z,oe,ge){w.save(),w.translate(Y,z),w.scale(oe,oe),w.fillStyle=ge.rock,w.beginPath(),w.moveTo(-20,0),w.bezierCurveTo(-20,-15,-10,-25,0,-25),w.bezierCurveTo(10,-25,20,-15,20,0),w.fill(),w.fillStyle="rgba(0,0,0,0.2)",w.beginPath(),w.ellipse(0,0,20,5,0,0,Math.PI*2),w.fill(),w.restore()}function re(w,Y,z,oe,ge){w.save(),w.translate(Y,z),w.scale(oe,oe),w.fillStyle=ge.shell,w.beginPath(),w.arc(0,0,10,Math.PI,0),w.lineTo(0,0),w.fill(),w.strokeStyle=ge.sandDark,w.lineWidth=1,w.beginPath();for(let ae=1;ae<5;ae++){let Ge=Math.PI+ae/5*Math.PI;w.moveTo(0,0),w.lineTo(Math.cos(Ge)*10,Math.sin(Ge)*10)}w.stroke(),w.restore()}function ye(w,Y,z,oe,ge){w.fillStyle=ge.sandDark,w.fillRect(-50,oe,Y+100,z-oe),w.fillStyle=ge.sandDark,w.save(),w.fillStyle=ge.sandLight,w.globalAlpha=.3,w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,oe),w.bezierCurveTo(Y*.3,oe-20,Y*.7,oe+20,Y+50,oe),w.lineTo(Y+50,z+100),w.fill(),w.globalAlpha=.6;let ae=oe+z*.05;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,ae),w.bezierCurveTo(Y*.4,ae+40,Y*.6,ae-10,Y+50,ae+20),w.lineTo(Y+50,z+100),w.fill(),w.globalAlpha=1;let Ge=oe+z*.15;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,Ge),w.bezierCurveTo(Y*.2,Ge-10,Y*.8,Ge+30,Y+50,Ge+10),w.lineTo(Y+50,z+100),w.fill(),w.fillStyle=ge.sandDark,w.globalAlpha=.1,b.forEach(nt=>{w.fillRect(nt.x,nt.y,2,2)}),w.restore()}function Le(w,Y,z,oe=null){let ge=oe||1,ae=!!oe&&oe>5;X&&!ae&&!he&&dt("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),J.push({x:ae?Y/2:Math.random()*Y,y:ae?z/2:Math.random()*z,radius:0,maxRadius:ae?Math.max(Y,z)*1.5:(100+Math.random()*400)*ge,speed:ae?40:(5+Math.random()*15)*ge,opacity:1,hue:225+Math.random()*15,life:1})}function ie(w,Y,z,oe=.5,ge=!0){let ae=.1+oe*.7,Ge=Math.floor(1+oe*4);if(ge&&!he){for(let nt=0;nt<Ge;nt++)if(J.length<50&&Math.random()<ae){let be=1+oe*2;Le(w,Y,z,be)}}w.save(),w.globalCompositeOperation="lighter";for(let nt=J.length-1;nt>=0;nt--){let be=J[nt];if(be.radius+=be.speed,be.opacity-=.015,be.life-=.015,be.opacity<=0||be.radius>be.maxRadius){J.splice(nt,1);continue}let Fe=w.createRadialGradient(be.x,be.y,0,be.x,be.y,be.radius),qt=be.opacity;Fe.addColorStop(0,`hsla(${be.hue}, 100%, 80%, ${qt})`),Fe.addColorStop(.3,`hsla(${be.hue}, 100%, 40%, ${qt*.9})`),Fe.addColorStop(.7,`hsla(${be.hue}, 100%, 15%, ${qt*.6})`),Fe.addColorStop(1,`hsla(${be.hue}, 100%, 5%, 0)`),w.fillStyle=Fe,w.beginPath(),w.arc(be.x,be.y,be.radius,0,Math.PI*2),w.fill()}w.restore()}function Ie(){if(!G)return;let w=Date.now(),Y=w-D;Math.min(Y/t,1)>=1&&!B&&(B=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ge=6e3,ae=5e4,Ge=5e4,nt=5e3,be=4e4,Fe=0;Y<ge?Fe=0:Y<ae?Fe=(Y-ge)/(ae-ge):Fe=1;let qt=0;Y>be&&(qt=Math.max(0,(Y-be)/(ae-be))),Y>ae&&(qt=1),qt>.1&&!i&&(i=dt("sounds/tsu_rumble.ogg",{volume:.8}));let lt={skyTop:C(M.skyTop,L.skyTop,Fe),skyBottom:C(M.skyBottom,L.skyBottom,Fe),sun:C(M.sun,L.sun,Fe),waterDeep:C(M.waterDeep,L.waterDeep,Fe),waterMid:C(M.waterMid,L.waterMid,Fe),waterPeak:C(M.waterPeak,L.waterPeak,Fe),foam:C(M.foam,L.foam,Fe),sandLight:C(M.sandLight,L.sandLight,Fe),sandDark:C(M.sandDark,L.sandDark,Fe),rock:C(M.rock,L.rock,Fe),leaf:C(M.leaf,L.leaf,Fe),shell:C(M.shell,L.shell,Fe)},an=0,At=0;if(Fe>.5||he){let S=(Fe-.5)*2*5+qt*25;V>0&&(S+=50),an=(Math.random()-.5)*S,At=(Math.random()-.5)*S}T.clearRect(0,0,m,y),R.save(),R.translate(an,At),T.save(),T.translate(an,At);let bn=R.createLinearGradient(0,0,0,y);if(bn.addColorStop(0,lt.skyTop),bn.addColorStop(1,lt.skyBottom),R.fillStyle=bn,R.fillRect(-50,-50,m+100,y+100),Fe<1){let S=y*.15+Fe*50;R.beginPath(),R.arc(m*.7,S,40,0,Math.PI*2),R.fillStyle=lt.sun,R.globalAlpha=1-Fe,R.shadowColor=lt.sun,R.shadowBlur=20,R.fill(),R.globalAlpha=1,R.shadowBlur=0}let vo=y*.65;if(h&&Fe<1){R.save();let S=Math.min(m,y)*5e-4,k=300*S,P=300*S,A=m*.8,N=P*.15,pe=vo-P/2+N;R.translate(A,pe),R.rotate(.1),R.drawImage(p,-k/2,-P/2,k,P),R.restore()}if(ye(R,m,y,vo,lt),g.forEach(S=>{S.type==="tree"?me(R,S.x,S.y,S.scale,lt):S.type==="rock"?Z(R,S.x,S.y,S.scale,lt):S.type==="shell"&&re(R,S.x,S.y,S.scale,lt)}),Fe>.3){let S=(Fe-.3)/.7,k=Math.floor(j*S);if(T.strokeStyle=`rgba(120, 180, 255, ${.1+S*.3})`,T.lineWidth=1+S,T.beginPath(),q.length<k)for(let A=0;A<10;A++)q.push({x:Math.random()*m*1.5,y:E,speed:20+Math.random()*20,len:10+Math.random()*20});let P=10+S*20;for(let A=0;A<q.length;A++){let N=q[A];N.y+=N.speed,N.x-=P,T.moveTo(N.x,N.y),T.lineTo(N.x-P*.5,N.y+N.len),(N.y>y||N.x<-100)&&(A<k?(N.x=Math.random()*m*1.5,N.y=E):(q.splice(A,1),A--))}T.stroke()}let ar=.3;if(Fe>ar){let S=(Fe-ar)/(1-ar),k=le(0,y*1.5,S*S);T.fillStyle=lt.waterDeep,T.beginPath(),T.moveTo(-50,y+100),T.lineTo(-50,y-k*.3),T.bezierCurveTo(m*.3,y-k*.4,m*.6,y-k*1.2,m+50,y-k*.8),T.lineTo(m+50,y+100),T.fill()}let Oo=le(0,y*.5,Fe),Po=le(0,y*1.5,qt*qt),lr=y*.85-Oo-Po;if(ee.forEach((S,k)=>{let P;k===$-1?P=lt.waterPeak:k%2===0?P=lt.waterDeep:P=lt.waterMid,T.fillStyle=P,T.beginPath();let A=S.amplitudeBase*(1+Fe*2+qt*5),N=.003+Fe*.005,pe=S.speedBase*(1+Fe*5+qt*10),de=Y*pe+S.offset,Te=k*15*(1-qt),Pe=lr+Te;T.moveTo(-50,y+100),T.lineTo(-50,Pe);for(let Be=-50;Be<=m+50;Be+=15){let Ne=Pe+Math.sin(Be*N+de)*A+Math.cos(Be*N*2.3+de)*(A*.5);T.lineTo(Be,Ne)}if(T.lineTo(m+50,y+100),T.fill(),k===$-1||Fe>.6&&k>$-3){T.save(),T.globalAlpha=.1+Fe*.3,T.fillStyle=lt.foam,T.beginPath();for(let Be=-50;Be<=m+50;Be+=10){let Ne=Pe+Math.sin(Be*N+de)*A+Math.cos(Be*N*2.3+de)*(A*.5);Math.random()>.5&&(Ne-=5),Be===-50?T.moveTo(Be,Ne):T.lineTo(Be,Ne)}T.lineTo(m+50,y+100),T.lineTo(-50,y+100),T.fill(),T.restore()}}),Y<oe){let S=1;Y>1e3&&(S=1-(Y-1e3)/(oe-1e3)),T.fillStyle=`rgba(0, 0, 0, ${S})`,T.fillRect(-50,-50,m+100,y+100)}if(Y>Ge){let S=Math.min(1,(Y-Ge)/nt);T.fillStyle=`rgba(0, 0, 0, ${S})`,T.fillRect(-50,-50,m+100,y+100)}if(X){let S=w-fe,k=12e3,P=0,A=!0;S<k?P=S/k:(P=1,he||(he=!0,Le(T,m,y,25),V=60,l||(l=!0,dt("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),K&&(A=!1),ie(T,m,y,P,A)}if(K){let S=w-Q,k=Math.min(1,S/ve);T.fillStyle=`rgba(0, 0, 0, ${k})`,T.fillRect(-50,-50,m+100,y+100)}if(V>0){let S=V/60,k=S*S;T.fillStyle=`rgba(255, 255, 255, ${k})`,T.fillRect(-50,-50,m+100,y+100),V--}R.restore(),T.restore(),_=requestAnimationFrame(Ie)}function Re(){G=!1,e.style.cursor="",_&&cancelAnimationFrame(_),window.removeEventListener("resize",F),a.parentNode&&a.parentNode.removeChild(a),f.parentNode&&f.parentNode.removeChild(f),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function _e(){X=!0,fe=Date.now(),he=!1,V=0,s||(s=dt("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Oe(){K=!0,Q=Date.now(),s&&s.stop()}function se(){e.style.cursor=""}function te(){e.style.cursor="none"}function we(){s&&(s.stop(),s=null)}return Ie(),{cleanup:Re,triggerBeacons:_e,triggerFinalFade:Oe,showCursor:se,hideCursor:te,stopHumLoop:we}}var rv=Ue(()=>{Bn()});var qv={};bt(qv,{canPerformForgeReset:()=>Pv,canPerformInfuseReset:()=>Bv,computeForgeGoldFromInputs:()=>Iv,computeInfuseMagicFromInputs:()=>wv,computePendingForgeGold:()=>Ov,computeSurgeWavesFromInputs:()=>Ev,getCurrentSurgeLevel:()=>co,getForgeDebugOverrideState:()=>_v,getInfuseDebugOverrideState:()=>Mv,getSurgeBarLevelKey:()=>Bs,getSurgeDebugOverrideState:()=>Tv,hasDoneExperimentReset:()=>Rv,hasDoneForgeReset:()=>Ar,hasDoneInfuseReset:()=>Dt,hasDoneSurgeReset:()=>Co,initResetPanel:()=>Vd,initResetSystem:()=>qo,isExperimentUnlocked:()=>ml,isForgeUnlocked:()=>_s,isInfuseUnlocked:()=>gu,isSurgeUnlocked:()=>Fs,onForgeUpgradeUnlocked:()=>Hp,onInfuseUpgradeUnlocked:()=>Xp,onSurgeUpgradeUnlocked:()=>Vp,performForgeReset:()=>Dp,performInfuseReset:()=>$p,performSurgeReset:()=>qp,recomputePendingMagic:()=>dn,setExperimentResetCompleted:()=>Tp,setForgeDebugOverride:()=>Cv,setForgeResetCompleted:()=>Mp,setInfuseDebugOverride:()=>Av,setInfuseResetCompleted:()=>kp,setInfuseUnlockedForDebug:()=>kv,setSurgeResetCompleted:()=>Ap,setSurgeUnlockedForDebug:()=>Nv,shouldBlockBigCoins:()=>dl,updateResetPanel:()=>$e});function Ip(e){return!aE.includes(e)}function lE(){dt(oE,{volume:.4})}function cE(){dt(rE,{volume:.45})}function uE(){dt(iE,{volume:.5})}function fE(){dt(sE,{volume:.8})}function dl(){return gv}function yv(){let e=An(),t=O.waves?.value??ft(),n=0n;try{n=hl(e)}catch{}let o=I.pendingWaves,r=Gp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),gv=i&&!xn()}function fl(){gp=null}function fu(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function du(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function yp(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function vv(e=null){try{let t=yd(),n=I.pendingGold.clone?.()??I.pendingGold;if(e){let o=e instanceof xt?e:xt.fromAny(e??1);if(o.isInfinite?.())return xt.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=O.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return I.pendingGold}}function mE(){for(;Wn.length;){let e=Wn.pop();try{e?.()}catch{}}}function mp(){!lv&&typeof Yl=="function"&&(lv=Yl((e={})=>{e?.key&&e.key!==Ce.COINS&&e.key!==Ce.WAVES||e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(e?.key===Ce.WAVES?(yu(),$e()):(pn(),dn(),kn()))})),!cv&&typeof oc=="function"&&(cv=oc((e={})=>{e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(pn(),kn(),To(),$e())}))}function Cp(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ae(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function pl(){try{let e=et();if(e&&e.xpLevel)return e.xpLevel}catch{}return ft()}function bv(e,t){if(!e||typeof e!="object")return ft();let n=Ae(e);if(!Number.isFinite(n)&&n>0)return xt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return ft();let r=Me(o*Math.log10(2)),i=Math.max(0,Cp(t)),s=Math.max(0,(i-30)/5),l=s<=0?iv():Me(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?iv():Me(a*Math.log10(1.15)),d=xt.fromInt(10);d=d.mulBigNumInteger(r),d=d.mulBigNumInteger(l),d=d.mulBigNumInteger(u);let f=d.floorToInteger();return f.isZero?.()?ft():f}function hE(e,t){if(!e)return ft();let n=Ae(e);if(!Number.isFinite(n)&&n>0)return xt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let h=Ae(t);Number.isFinite(h)&&(a=Math.max(0,h-4))}let u=o*i,d=Math.floor(o)*s,f=a*l,p=r+u+d+f;return Number.isFinite(p)?Me(p).floorToInteger():xt.fromAny("Infinity")}function Sv(e,t,n=null){let o=hE(e,t),r=vd(),i;if(n){let s=n instanceof xt?n:xt.fromAny(n??1);if(s.isInfinite?.())return xt.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=O.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function Iv(e,t){return bv(e,t)}function wv(e,t){return Sv(e,t)}function Ev(e,t,n,o,r){return xv(e,t,n,o,r)}function xv(e,t,n,o,r){let i=Cp(e);if(i<201)return ft();let s=(i-201)/35,l=Ae(t),a=Ae(n),u=Ae(o),d=Ae(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||d===Number.POSITIVE_INFINITY)return xt.fromAny("Infinity");let f=0;Number.isFinite(l)&&l>24&&(f+=(l-24)*ru),Number.isFinite(a)&&a>13&&(f+=(a-13)*ru),Number.isFinite(u)&&u>5&&(f+=(u-5)*ru),Number.isFinite(d)&&d>12&&(f+=(d-12)*ru);let p=1+f+s;return Number.isFinite(p)?Me(p).floorToInteger():xt.fromAny("Infinity")}function Lv(){return Math.max(0,Cp(pl()))}function An(){if(I.slot!=null)return I.slot;let e=v();return I.slot=e,e}function Mp(e){let t=An();if(t!=null){I.hasDoneForgeReset=!!e;try{localStorage.setItem(wp(t),I.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function kp(e){let t=An();if(t!=null){I.hasDoneInfuseReset=!!e;try{localStorage.setItem(Ep(t),I.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function Ap(e){let t=An();if(t!=null){I.hasDoneSurgeReset=!!e;try{localStorage.setItem(xp(t),I.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Tp(e){let t=An();if(t!=null){I.hasDoneExperimentReset=!!e;try{localStorage.setItem(_p(t),I.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function hu(e=v()){if(e==null)return null;try{let t=localStorage.getItem(cl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function _v(e=v()){return hu(e)}function Cv(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(I.forgeDebugOverride!==n){if(I.forgeDebugOverride=n,n==null)try{localStorage.removeItem(cl(t))}catch{}else try{localStorage.setItem(cl(t),n?"1":"0")}catch{}it(cl(t)),fu(),$e()}}function Np(e=v()){if(e==null)return null;try{let t=localStorage.getItem(ul(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Mv(e=v()){return Np(e)}function kv(e){Rp(e)}function Av(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(I.infuseDebugOverride!==n){if(I.infuseDebugOverride=n,n==null)try{localStorage.removeItem(ul(t))}catch{}else try{localStorage.setItem(ul(t),n?"1":"0")}catch{}it(ul(t)),du(),$e()}}function Rp(e){let t=An();if(t==null)return;let n=!!e;if(I.infuseUnlocked!==n){I.infuseUnlocked=n;try{localStorage.setItem(cu(t),I.infuseUnlocked?"1":"0")}catch{}it(cu(t)),du()}}function pu(e){let t=An();if(t==null)return;let n=!!e;if(I.forgeUnlocked!==n){I.forgeUnlocked=n;try{localStorage.setItem(lu(t),I.forgeUnlocked?"1":"0")}catch{}it(lu(t)),fu()}}function Op(e=v()){if(e==null)return null;try{let t=localStorage.getItem(hv(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Tv(e=v()){return Op(e)}function Nv(e){Pp(e)}function Pp(e){let t=An();if(t==null)return;let n=!!e;if(I.surgeUnlocked!==n){I.surgeUnlocked=n;try{localStorage.setItem(uu(t),I.surgeUnlocked?"1":"0")}catch{}it(uu(t)),yp()}}function vp(e){if(e==null){I.forgeUnlocked=!1,I.forgeDebugOverride=null,I.hasDoneForgeReset=!1,I.infuseUnlocked=!1,I.infuseDebugOverride=null,I.hasDoneInfuseReset=!1,I.surgeUnlocked=!1,I.surgeDebugOverride=null,I.hasDoneSurgeReset=!1,I.hasDoneExperimentReset=!1,I.flagsPrimed=!1;return}try{I.forgeUnlocked=localStorage.getItem(lu(e))==="1"}catch{I.forgeUnlocked=!1}I.forgeDebugOverride=hu(e);try{I.hasDoneForgeReset=localStorage.getItem(wp(e))==="1"}catch{I.hasDoneForgeReset=!1}try{I.infuseUnlocked=localStorage.getItem(cu(e))==="1"}catch{I.infuseUnlocked=!1}try{I.hasDoneInfuseReset=localStorage.getItem(Ep(e))==="1"}catch{I.hasDoneInfuseReset=!1}I.infuseDebugOverride=Np(e);try{I.surgeUnlocked=localStorage.getItem(uu(e))==="1"}catch{I.surgeUnlocked=!1}I.surgeDebugOverride=Op(e);try{I.hasDoneSurgeReset=localStorage.getItem(xp(e))==="1"}catch{I.hasDoneSurgeReset=!1}try{I.hasDoneExperimentReset=localStorage.getItem(_p(e))==="1"}catch{I.hasDoneExperimentReset=!1}I.flagsPrimed=!0}function mo(){let e=v();if(e==null){I.flagsPrimed=!1;return}I.slot!==e&&(I.slot=e,fl(),I.flagsPrimed=!1),I.flagsPrimed||vp(e)}function uv(e){sv!==e&&(mE(),sv=e,e!=null&&(Wn.push(Ct(lu(e),{onChange(t){let n=t==="1";I.forgeUnlocked!==n&&(I.forgeUnlocked=n,fu(),$e())}})),Wn.push(Ct(wp(e),{onChange(t){let n=t==="1";I.hasDoneForgeReset!==n&&(I.hasDoneForgeReset=n,$e())}})),Wn.push(Ct(cl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.forgeDebugOverride!==n&&(I.forgeDebugOverride=n,fu(),$e())}})),Wn.push(Ct(cu(e),{onChange(t){let n=t==="1";I.infuseUnlocked!==n&&(I.infuseUnlocked=n,du(),$e())}})),Wn.push(Ct(Ep(e),{onChange(t){let n=t==="1";I.hasDoneInfuseReset!==n&&(I.hasDoneInfuseReset=n,$e())}})),Wn.push(Ct(ul(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.infuseDebugOverride!==n&&(I.infuseDebugOverride=n,du(),$e())}})),Wn.push(Ct(uu(e),{onChange(t){let n=t==="1";I.surgeUnlocked!==n&&(I.surgeUnlocked=n,yp(),$e())}})),Wn.push(Ct(hv(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.surgeDebugOverride!==n&&(I.surgeDebugOverride=n,yp(),$e())}})),Wn.push(Ct(xp(e),{onChange(t){let n=t==="1";I.hasDoneSurgeReset!==n&&(I.hasDoneSurgeReset=n,$e())}})),Wn.push(Ct(_p(e),{onChange(t){let n=t==="1";I.hasDoneExperimentReset!==n&&(I.hasDoneExperimentReset=n,$e())}}))))}function gE(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function pn(e=!1){let t=O.coins?.value??ft(),n=pl(),o=gE(t,n);!e&&gp===o||(gp=o,Bp()?I.pendingGold=bv(t,n):I.pendingGold=ft(),$e())}function dn(e=null){let t=O.coins?.value??ft(),n=gl();Fp()?I.pendingMagic=Sv(t,n,e):I.pendingMagic=ft(),kn(),$e()}function kn(){if(!Fs()){I.pendingWaves=ft(),To();return}let e=pl(),t=O.coins?.value??ft(),n=O.gold?.value??ft(),o=O.magic?.value??ft(),r=gl();I.pendingWaves=xv(e,t,n,o,r),Co()||I.pendingWaves.cmp(xt.fromInt(10))>0&&(I.pendingWaves=xt.fromInt(10)),To(),yv()}function To(){if(!ml()){I.pendingDna=ft();return}let e=Wt?Wt():ft(),t=pl();try{let n=e.mulDecimal("0.30103",18),r=t.div(c.fromInt(20)).mulDecimal("0.30103",18),i=n.add(r),s=0;i.isInfinite()?s=1/0:s=Number(i.toScientific(10)),I.pendingDna=Me(s).floorToInteger()}catch{try{I.pendingDna=ft()}catch{I.pendingDna=ft()}}}function bp(){let e=hu();return e!=null?!!e:I.forgeUnlocked||Mt(Se.STARTER_COVE,Ee.UNLOCK_FORGE)>=1}function Bp(){try{let e=pl();if(e&&typeof e.cmp=="function")return e.cmp(dE)>=0}catch{}return!1}function Fp(){try{let e=ut();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(pE)>=0}catch{}return!1}function _s(){mo();let e=hu();return e!=null?!!e:!!I.forgeUnlocked||bp()}function gu(){mo();let e=Np();return e!=null?!!e:!!I.infuseUnlocked}function Fs(){mo();let e=Op();return e!=null?!!e:!!I.surgeUnlocked}function ml(){return Ng()}function co(){let e=An();return e==null?0n:hl(e)}function Ar(){return mo(),!!I.hasDoneForgeReset}function Dt(){return mo(),!!I.hasDoneInfuseReset}function Co(){return mo(),!!I.hasDoneSurgeReset}function Rv(){return mo(),!!I.hasDoneExperimentReset}function Ov(){return pn(),I.pendingGold.clone?.()??I.pendingGold}function Pv(){return!(!_s()||!Bp()||I.pendingGold.isZero?.())}function Bv(){return!(!gu()||!Fp()||I.pendingMagic.isZero?.())}function yE({resetGold:e=!1,resetMagic:t=!1}={}){let n=Pt(Se.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===Ee.UNLOCK_XP||r===Ee.UNLOCK_FORGE||r===Ee.UNLOCK_INFUSE||r===Ee.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||Jo(Se.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Up({resetGold:e=!1,resetMagic:t=!1}={}){try{O.coins.set(0)}catch{}try{O.books.set(0)}catch{}try{Yi({keepUnlock:!0})}catch{}try{fp()}catch{}yE({resetGold:e,resetMagic:t})}function Dp(){if(!Pv())return!1;let e=vv();try{O.gold?.add&&O.gold.add(e)}catch{}if(Up({resetGold:!1}),pn(),pu(!0),I.hasDoneForgeReset||Mp(!0),jt(),Or(),Ip("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return $e(),!0}function $p(){if(!Bv())return!1;let e=I.pendingMagic.clone?.()??I.pendingMagic;try{O.magic?.add&&O.magic.add(e)}catch{}Up({resetGold:!0});try{O.gold.set(0)}catch{}try{let t=v(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),jt({forceReload:!0})}catch{}if(pn(),dn(),Ip("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return Rp(!0),I.hasDoneInfuseReset||kp(!0),$e(),!0}function mu(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=An();try{O.waves?.add&&e&&!e.isZero?.()&&O.waves.add(e)}catch{}Up({resetGold:!0,resetMagic:!0});try{O.gold.set(0)}catch{}try{O.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),jt({forceReload:!0})}catch{}if(yu(),Pp(!0),I.hasDoneSurgeReset||Ap(!0),pn(),dn(),kn(),t&&(n||uE(),n||SE()),Ip("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}$e()}function Fv(){if(!ml()||(Wt?Wt():ft()).cmp(10)<0)return!1;let t=I.pendingDna.clone?.()??I.pendingDna;if(t.cmp(hp)<0)return!1;try{O.DNA?.add&&O.DNA.add(t)}catch{}return mu(ft(),{playEffects:!1}),fE(),Rg([4]),I.hasDoneExperimentReset||Tp(!0),pn(),dn(),kn(),To(),$e(),!0}function vE(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{By(!0)}catch{}try{$c()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,wr(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=ov(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Ey(e,()=>{setTimeout(bE,0)},i)},r);au=i.cleanup}function bE(){au&&(au(),au=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),mu(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=v();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function qp(){if(!Fs()||Lv()<201)return!1;let e=I.pendingWaves.clone?.()??I.pendingWaves;if(e.isZero?.())return!1;let t=An(),n=O.waves?.value??ft(),o=hl(t),r=Gp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!xn()?(vE(),mu(e,{playEffects:!1}),!0):(mu(e,{playEffects:!0}),!0)}function SE(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function hl(e){let t=0n;try{let n=localStorage.getItem(Lp(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function IE(e){let t=Lp(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function fv(e){if(!(e instanceof xt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function Uv(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=fv(n),l=fv(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let d=new c(10n,{base:0,offset:u}),f=d.sub(r).div(c.fromInt(9));n.cmp(f)>=0&&(n=n.sub(f),o=u,i=!0,r=d)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function yu(){let e=An();if(e==null||!Fs()||pp||IE(e))return;let t=O.waves?.value??ft(),n=hl(e);if(n===1/0)return;let o=Uv(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Lp(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}pp=!0;try{O.waves.set(o.remainingWaves)}finally{pp=!1}$e(),o.safety>=100&&setTimeout(yu,0)}yv()}function Ps(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=xt.fromInt(e)}catch{}try{return ne(t)}catch{return e?.toString?.()??"0"}}function wE(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,d=a/8*Math.PI*2,f=50+30*Math.sin(d),p=50+30*Math.sin(d+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${f.toFixed(1)}" x2="${u.toFixed(1)}" y2="${p.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,d,f)=>{let p="";for(let h=0;h<=r;h++){let m=h/r,y=a+m*(u-a),g=y/(Math.PI*2)*120,b=50+30*Math.sin(y+f);p+=(h===0?"M":"L")+` ${g.toFixed(1)} ${b.toFixed(1)}`}return`<path d="${p}" stroke="${d}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function EE(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${Qw}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${eE}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${tE}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${nE}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${dv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${pv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${su}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> Click the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${mv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,I.panel=e,I.elements.forge.card=e.querySelector("#reset-card-forge"),I.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),I.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),I.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),I.elements.infuse.card=e.querySelector("#reset-card-infuse"),I.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),I.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),I.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),I.elements.surge.card=e.querySelector("#reset-card-surge"),I.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),I.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),I.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),I.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),I.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),I.elements.surge.headerVal=e.querySelector("[data-surge-level]"),I.elements.surge.header=e.querySelector(".surge-header"),I.elements.experiment.card=e.querySelector("#reset-card-experiment"),I.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),I.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");I.elements.surge.milestones&&t&&bs(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),I.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(I.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&to(r))return;let a=I.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),I.elements.forge.btn&&I.elements.forge.btn.addEventListener("click",()=>{Dp()&&(lE(),$e())}),I.elements.infuse.btn&&I.elements.infuse.btn.addEventListener("click",()=>{$p()&&(cE(),$e())}),I.elements.surge.btn&&I.elements.surge.btn.addEventListener("click",()=>{qp()&&$e()}),I.elements.experiment.btn&&I.elements.experiment.btn.addEventListener("click",()=>{Fv()&&$e()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=wE();o.style.backgroundImage=`url("${r}")`,o.style.backgroundSize="120px 100%",o.addEventListener("click",()=>{rs("dna")});let i=()=>{if(!o.offsetParent)return;let s=document.querySelector(".hud-bottom [data-btn=stats]");if(s&&o){let l=s.getBoundingClientRect();o.style.width=`${l.width}px`,o.style.height=`${l.height}px`,o.style.minWidth="0",o.style.maxWidth="none"}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(l=>{l.forEach(a=>{a.isIntersecting?(o.style.animationPlayState!=="running"&&(o.style.animationPlayState="running"),i()):o.style.animationPlayState!=="paused"&&(o.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let s=new ResizeObserver(i),l=document.querySelector(".hud-bottom");l&&s.observe(l),window.addEventListener("resize",i),requestAnimationFrame(i)}else window.addEventListener("resize",i),requestAnimationFrame(i)}$e()}function Vd(e){!e||e.__resetInit||(e.__resetInit=!0,EE(e))}function po(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=Ps(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let d=e.querySelector(".merchant-reset__action-icon img");d&&!d.src.includes(n)&&(d.src=n)}}function Dv({goldMult:e=null}={}){let t=I.elements.forge;if(!(!t.card||!t.btn)){if(!_s()){po(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(mo(),t.card.classList.toggle("is-forge-complete",!!I.hasDoneForgeReset),t.status)if(I.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!Bp()){po(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}po(t.btn,{disabled:!1},dv,vv(e))}}function $v(){let e=I.elements.infuse;if(!(!e.card||!e.btn)){if(!gu()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="none"&&(I.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="flex"&&(I.layerButtons.infuse.style.display="flex"),mo(),e.card.classList.toggle("is-complete",!!I.hasDoneInfuseReset),e.status)if(I.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!Fp()){po(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}po(e.btn,{disabled:!1},pv,I.pendingMagic)}}function Gp(e,t,n){let o=t.add(n);return Uv(e,o).level}function Sp(){let e=I.elements.surge;if(!e.card||!e.btn)return;if(!Fs()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="none"&&(I.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="flex"&&(I.layerButtons.surge.style.display="flex"),mo();let t=An(),n=O.waves?.value??ft(),o=0n;try{o=hl(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':Ps(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=I.pendingWaves;if(u&&!u.isZero?.()){let d=Gp(o,n,u),f=!1;if(d===1/0)f=!0;else try{f=d>o}catch{}if(f){let p=d===1/0?'<span class="surge-infinity-symbol">\u221E</span>':Ps(d);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${su}">${Ps(n)} / <img src="${su}">${Ps(r)}</span>`),e.milestones){let s=tv(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let d=BigInt(a.surgeLevel)<=o,f=d?"is-reached":"",p=a.description.map(F=>F.includes("Invokes the Tsunami")&&!d?`<div class="tsunami-text">- ${F}</div>`:`<div>- ${F}</div>`).join("");if(d&&a.surgeLevel===3){let F=Er?Er():xt.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${ne(F)}</div>`}if(d&&a.surgeLevel===6){let F=Lc();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Ve(F.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Ve(F.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Ve(F.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Ve(F.magic)}x</span></div>`}let h=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(h=!0);let m=Yt(),y=fn(),g=m+y;g>1&&(g=1);let b=!1;d&&h&&g<1&&dp.includes(a.id)&&(b=!0);let E=b?" is-nerfed":"",x=l[u];if(!x)x=document.createElement("div"),x.className=`surge-milestone-item ${f}${E}`,x.dataset.isReached=String(d),x.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(x);else{x.className!==`surge-milestone-item ${f}${E}`&&(x.className=`surge-milestone-item ${f}${E}`);let F=String(d);x.dataset.isReached!==F&&(x.dataset.isReached=F)}let R=x.querySelector(".surge-milestone-desc");R&&R.innerHTML!==p&&(R.innerHTML=p);let T=x.querySelector(".surge-milestone-nerf-arrow");if(T){let F=!1;h&&g<1&&dp.includes(a.id)&&(F=!0);let D=F?"":"none";T.style.display!==D&&(T.style.display=D)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();I.lastRenderedSurgeLevel!==o&&(I.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],d=e.milestones.children;u===d[d.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!I.hasDoneSurgeReset),e.status)if(I.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(Lv()<201){po(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(I.pendingWaves.isZero?.()){po(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}po(e.btn,{disabled:!1},su,I.pendingWaves)}function xE(){let e=I.elements.experiment;if(!e.card||!e.btn)return;if(!ml()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="none"&&(I.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="flex"&&(I.layerButtons.experiment.style.display="flex"),mo(),e.card.classList.toggle("is-complete",!!I.hasDoneExperimentReset),e.status)if(I.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let o='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==o&&(e.status.innerHTML=o)}if((Wt?Wt():ft()).cmp(10)<0){po(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}if(I.pendingDna.cmp(hp)<0){po(e.btn,{disabled:!0,msg:`Reach ${Ps(hp)} pending DNA to perform an Experiment reset`});return}po(e.btn,{disabled:!1},mv,I.pendingDna)}function $e({goldMult:e=null}={}){I.panel&&(Dv({goldMult:e}),$v(),Sp(),xE())}function Hp(){qo(),pu(!0),$e()}function Xp(){qo(),Rp(!0),$e()}function Vp(){qo(),Pp(!0),$e()}function LE(){if(!I.panel)return;let e=I.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!I.panel.classList.contains("is-active")||!I.elements.surge.barFill)return;let t=I.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Sp(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Sp()},{once:!0}))}function _E(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{LE()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(pn(),dn(),kn()),e.detail?.key==="waves"&&(yu(),$e()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(kn(),$e())}),window.addEventListener("surge:bookResidue",()=>{if(I.panel&&I.panel.offsetParent!==null){let e=I.elements.surge.card;e&&e.style.display!=="none"&&$e()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Ce.GOLD){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;pn(!0);let n=t.mult instanceof c?t.mult:xt.fromAny(t.mult??1);I.panel&&Dv({goldMult:n});return}if(t.key===Ce.MAGIC){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;let n=t.mult instanceof c?t.mult:xt.fromAny(t.mult??1);dn(n),I.panel&&$v();return}}}),window.addEventListener("xp:change",()=>{pn(),kn(),To(),$e()}),window.addEventListener("mutation:change",()=>{dn(),kn(),$e()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&I.slot!=null&&e.detail.slot!==I.slot||(fl(),pn(!0),dn(),kn(),To(),$e())}),window.addEventListener("lab:level:change",()=>{To(),$e()}),window.addEventListener("lab:node:change",()=>{dn(),$e()}))}function qo(){if(av){I.slot=v(),fl(),mp(),pn(!0),dn(),kn(),To();return}try{jt()}catch{return}av=!0;let e=v();if(I.slot=e,fl(),vp(e),I.hasDoneForgeReset&&!Ao())try{Or()}catch{}if(!I.forgeUnlocked&&bp()&&pu(!0),uv(e),mp(),_E(),pn(!0),dn(),kn(),To(),iu){try{iu()}catch{}iu=null}iu=bi(()=>{let t=Yp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=v();if(I.slot=t,fl(),vp(t),I.hasDoneForgeReset&&!Ao())try{Or()}catch{}!I.forgeUnlocked&&bp()&&pu(!0),uv(t),mp(),pn(!0),dn(),kn(),To(),$e()})}var xt,ru,ft,iv,dv,pv,mv,Qw,eE,tE,nE,su,oE,rE,iE,sE,aE,hp,lu,wp,cl,cu,Ep,ul,uu,hv,xp,Bs,Lp,_p,dE,pE,pp,gv,I,Wn,sv,av,iu,gp,lv,cv,au,xo=Ue(()=>{It();St();Kt();Gn();ro();_o();ji();Ga();nv();ri();Bn();io();li();ui();Gc();rv();xt=c,ru=Math.log10(1.1),ft=()=>xt.fromInt(0),iv=()=>xt.fromInt(1),dv="img/currencies/gold/gold.webp",pv="img/currencies/magic/magic.webp",mv="img/currencies/dna/dna.webp",Qw="img/misc/forge.webp",eE="img/misc/infuse.webp",tE="img/misc/surge.webp",nE="img/misc/experiment.webp",su="img/currencies/wave/wave.webp",oE="sounds/forge_reset.ogg",rE="sounds/infuse_reset.ogg",iE="sounds/surge_reset.ogg",sE="sounds/experiment_reset.ogg",aE=[],hp=xt.fromAny("99999999999999");lu=e=>`ccc:reset:forge:${e}`,wp=e=>`ccc:reset:forge:completed:${e}`,cl=e=>`ccc:debug:forgeUnlocked:${e}`,cu=e=>`ccc:reset:infuse:${e}`,Ep=e=>`ccc:reset:infuse:completed:${e}`,ul=e=>`ccc:debug:infuseUnlocked:${e}`,uu=e=>`ccc:reset:surge:${e}`,hv=e=>`ccc:debug:surgeUnlocked:${e}`,xp=e=>`ccc:reset:surge:completed:${e}`,Bs=e=>`ccc:reset:surge:barLevel:${e}`,Lp=Bs,_p=e=>`ccc:reset:experiment:completed:${e}`,dE=xt.fromInt(31),pE=xt.fromInt(7),pp=!1,gv=!1;I={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:ft(),pendingMagic:ft(),pendingWaves:ft(),pendingDna:ft(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},Wn=[],sv=null,av=!1,iu=null,gp=null,lv=null,cv=null;au=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:qo,performForgeReset:Dp,performInfuseReset:$p,performSurgeReset:qp,performExperimentReset:Fv,computePendingForgeGold:Ov,computeForgeGoldFromInputs:Iv,computeInfuseMagicFromInputs:wv,computeSurgeWavesFromInputs:Ev,getForgeDebugOverrideState:_v,hasDoneForgeReset:Ar,isForgeUnlocked:_s,setForgeDebugOverride:Cv,setForgeResetCompleted:Mp,updateResetPanel:$e,isInfuseUnlocked:gu,setInfuseDebugOverride:Av,getInfuseDebugOverrideState:Mv,recomputePendingMagic:dn,setInfuseUnlockedForDebug:kv,setInfuseResetCompleted:kp,hasDoneInfuseReset:Dt,isSurgeUnlocked:Fs,setSurgeUnlockedForDebug:Nv,getSurgeDebugOverrideState:Tv,setSurgeResetCompleted:Ap,hasDoneSurgeReset:Co,getCurrentSurgeLevel:co,shouldBlockBigCoins:dl,hasDoneExperimentReset:Rv,setExperimentResetCompleted:Tp,isExperimentUnlocked:ml}))});var d0={};bt(d0,{AREA_KEYS:()=>Se,HM_EVOLUTION_INTERVAL:()=>$t,MAX_LEVEL_DELTA:()=>Xs,REGISTRY:()=>Pu,UPGRADE_TIES:()=>Ee,approxLog10BigNum:()=>Ae,batchUpgradeOperations:()=>vl,bigNumFromLog10:()=>Me,buyCheap:()=>jd,buyMax:()=>ol,buyOne:()=>Cs,buyTowards:()=>Ms,clearPermanentUpgradeUnlock:()=>fm,computeDefaultUpgradeCost:()=>dm,computeHmMultipliers:()=>Go,computeUpgradeEffects:()=>ss,costToBuyOne:()=>ZE,ensureLevelBigNum:()=>ct,estimateFlatBulk:()=>rm,estimateGeometricBulk:()=>VE,evaluateBulkPurchase:()=>mi,evolveUpgrade:()=>Kd,formatMultForUi:()=>Ve,getCurrentAreaKey:()=>Vn,getHmEvolutions:()=>am,getHmNextMilestoneLevel:()=>JE,getIconUrl:()=>Kc,getLevel:()=>En,getLevelNumber:()=>Mt,getMagnetLevel:()=>Sc,getMpValueMultiplierBn:()=>bc,getUpgrade:()=>zs,getUpgradeLockState:()=>Mo,getUpgradeStorageKey:()=>Ii,getUpgradesForArea:()=>Pt,levelBigNumToNumber:()=>De,log10OnePlusPow10:()=>pf,markUpgradePermanentlyUnlocked:()=>Si,normalizeBigNum:()=>QE,normalizedUpgradeLevel:()=>_u,onUpgradesChanged:()=>bg,peekNextPrice:()=>f0,performFreeAutobuy:()=>hd,safeMultiplyBigNum:()=>Et,setLevel:()=>Jo,syncBookCurrencyMultiplierFromUpgrade:()=>$a,upgradeUiModel:()=>ks});function vu(){Pr.size!==0&&(Pr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{it(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Pr.clear())}function ME(){if(!(typeof window>"u")&&!Hv){Hv=setInterval(vu,2e3);try{window.addEventListener("beforeunload",vu)}catch{}try{window.addEventListener("pagehide",vu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&vu()})}catch{}}}function vl(e){if(Ds)return e();Ds=!0;try{return e()}finally{Ds=!1,yl.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{qs(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),yl.clear(),Gv.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{KE(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),Gv.clear(),Jp&&(Jp=!1,jn())}}function kE(e){try{let t=Ws(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function Yv(e,t){if(!kE(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=Ae(n);return Number.isFinite(o)&&o>=AE}catch{return!1}}function $s(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>Wp)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>Wp/2||i.length>Wp/2)return"Infinity"}return n}function Su(e){return BE[e]??0}function zp(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Vs(e,t){let n=tr(e||t?.area);if(!n)return null;let o=nr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=Kn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function bl(e,t){let n=tr(e||t?.area);if(!n)return null;let o=Kn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function Us(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function tm(e=v()){let t=String(e??"default");if(Eu.has(t))return Eu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Kv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Eu.set(t,n),n}function nm(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Eu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Kv}:${n}`,JSON.stringify(e))}catch{}}function Nu(e=v()){let t=String(e??"default");if(xu.has(t))return xu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${jv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),xu.set(t,n),n}function Ru(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),xu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${jv}:${n}`,JSON.stringify(e))}catch{}}function cm(e=v()){let t=String(e??"default");if(Lu.has(t))return Lu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Zv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Lu.set(t,n),n}function um(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Lu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Zv}:${n}`,JSON.stringify(e))}catch{}}function om(e,t,n=v()){let o=Vs(e,t);if(!o)return;let r=bl(e,t),i=cm(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],um(i,n))}function Jv(e,t,n=v()){let o=Vs(e,t);if(!o)return!1;let r=bl(e,t),i=cm(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],um(i,n),!0):!1}function Si(e,t,n=v()){let o=Vs(e,t);if(!o)return;let r=bl(e,t),i=Nu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Ru(i,n))}function fm(e,t,n=v()){let o=Vs(e,t);if(!o)return;let r=Nu(n);r.upgrades[o]&&(delete r.upgrades[o],Ru(r,n));let i=tm(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},nm(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&or(e,s,n),jn()}function ku(e,t,n=v()){let o=Vs(e,t);if(!o)return!1;let r=bl(e,t),i=Nu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Ru(i,n),!0):!1}function mn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=nr(t?.tie??t?.tieKey),o=e?.areaKey||Se.STARTER_COVE;if(!n||!NE.has(n))return{locked:!0,iconOverride:Tn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?Mt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:Qv()}catch{}function s(){if(e0())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:gn,titleOverride:nn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===Ee.UNLOCK_XP)return s();if(n===Ee.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Tn,useLockedBase:!0};let a=!1;try{let u=yn();a=De(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:gn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:nn,descOverride:u,reason:u}}return{locked:!1}}if(n===Ee.UNLOCK_INFUSE){if(!Ar())return{locked:!0,iconOverride:Tn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:zn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=yn();a=De(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:gn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:nn,descOverride:u,reason:u}}return{locked:!1}}if(n===Ee.UNLOCK_SURGE){if(!Dt())return{locked:!0,iconOverride:Tn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:zn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=yn();a=De(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:gn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:nn,descOverride:u,reason:u}}return{locked:!1}}if(lm.has(n)){if(Dt()||ku(o,t)){try{Si(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let d=yn();a=De(d)>=101}catch{}if(!a)return{locked:!0,iconOverride:Tn,useLockedBase:!0,titleOverride:zn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{om(o,t)}catch{}return{locked:!0,iconOverride:gn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:nn,descOverride:u,reason:u}}if(Ar()||ku(o,t)){try{Si(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Tn,useLockedBase:!0};if(Jv(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:gn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:nn,descOverride:a,reason:a}}let l=!1;try{let a=yn();l=De(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Tn,useLockedBase:!0,titleOverride:zn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{om(o,t)}catch{}return{locked:!0,iconOverride:gn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function tr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function nr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function FE(e,t){let n=nr(t?.tie??t?.tieKey);if(n&&RE.has(n))return!0;let o=Kn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=tr(l);if(a&&OE.has(`${a}:${i}`))return!0}return!1}function Qv(){try{return!!un()}catch{return!1}}function e0(e=v()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${PE}:${t}`)==="1"}catch{return!1}}function yn(){try{let e=typeof et=="function"?et():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function _u(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function Kp(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function Kn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function ct(e){try{if(e=$s(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Me(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=Ae(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function De(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=Ae(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let f=Number(r);return Number.isFinite(f)?f:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let f=Math.floor(Math.log10(a));Number.isFinite(f)&&f>0&&(a/=Math.pow(10,f),u+=f)}else if(a<1){let f=Math.ceil(Math.log10(1/a));Number.isFinite(f)&&f>0&&(a*=Math.pow(10,f),u-=f)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let d=a*Math.pow(10,u);return Number.isFinite(d)?d:u>0?Number.MAX_VALUE:0}catch{let o=Ae(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function UE(e,t){let n=ct(e),o=ct(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(Ae(n))+1,i=Math.floor(Ae(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function t0(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function Ys(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Au(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:Ys(e.numUpgEvolutions)}function dm(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=De(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let d=Math.max(0,Math.floor(r/$t));Number.isFinite(d)&&(i.numUpgEvolutions=d)}let s=i0(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:Ae(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:t0(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,hn(i,r)}function n0(e){let t=Ys(e),n=$t*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Br(o),capFmtText:Gs(o)}}function o0(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(Ae(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=De(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/$t)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt($t);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=De(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/$t)+1)}}function $E(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function pm(e,t=Mu){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=tr(t||e?.area||Mu);return TE[n]||Wv}function Et(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function Ou(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=n0(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Go(e,t,n=Mu){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=pm(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let d=o0(t,Number(u?.level??u?.lvl??0));if(!(d>0))continue;let f=$E(u.multiplier??u.mult??u.value??1,d),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=Et(i,f):p==="coin"||p==="coins"?s=Et(s,f):p==="mp"?l=Et(l,f):r=Et(r,f)}let a=Au(e);if(a>0){let u=CE*a,d=Me(u);r=Et(r,d)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function r0(e,t,n=Mu){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=pm(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=o0(t,s),a=null;try{let u=BigInt(s),d=BigInt(Math.max(0,l)),f=u+BigInt($t)*d;f>0n&&(a=c.fromAny(f.toString()))}catch{}if(!a){let u=c.fromAny($t*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+$t*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny($t))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function i0(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=DE[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Ws(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let f=Number(i);Number.isFinite(f)&&f>0&&(r=f)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let f=Math.pow(10,s);Number.isFinite(f)&&f>0&&(r=f)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let f=Math.exp(l);Number.isFinite(f)&&f>0&&(r=f)}if(!r){let f=Number(o.ratioMinus1);Number.isFinite(f)&&f>0&&(r=f+1)}let a=null;if(!r){let f=i0(e);f&&(r=f.ratio,f.ratioLog10!=null&&(s=f.ratioLog10),a=f.preset)}if(r>1){r=Number(r),i=t0(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=Ae(n),d=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=d;try{let f=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),h=c.fromAny(e.costAtLevel?.(32)??0);f.cmp(p)===0&&f.cmp(h)===0&&(d.ratio=1,d.ratioMinus1=0,d.ratioLog10=0,d.ratioLn=0,d.ratioStr="1")}catch{}return d}catch{return null}}function hn(e,t){let n=Ws(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Me(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Me(n.baseLog10+o*n.ratioLog10).floorToInteger()}function qE(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function Qo(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Ws(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Iu+t*o.ratioLn)/Iu;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Iu+t*o.ratioLn,i=o.ratioLn*n,s=qE(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Iu}function Cu(e,t,n){if(!(n>0))return c.fromInt(0);let o=Ws(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=Qo(e,t,l);a=a.add(Me(u))}if(s>0){let u=t+l,d=c.fromAny(e.costAtLevel(u));for(let f=0;f<s;f+=1)a=a.add(d),f+1<s&&(d=d.mulDecimalFloor(o.ratioStr))}return a}let i=Qo(e,t,n);return Me(i)}function a0(e){if(!(e>0)||!Number.isFinite(e))return e;if(Zp[0]=e,Zp[0]<=0)return 0;GE[0]-=1n;let t=Zp[0];return t>0?t:0}function HE(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=a0(e);return n<e?n:e>1?e/2:0}function wu(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function Sl(e,t,n,o=Xs,r={}){let i=Ws(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(De(t))),d=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,f=typeof o=="number"?o:De(o),p=Number.isFinite(d)?Math.max(0,d-u):jp,h=Number.isFinite(f)?Math.max(0,Math.floor(f)):jp;if(h=Math.min(h,jp,p),!(h>0)){let ee=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:ee,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let ee=Math.min(h,m),$=c.fromAny(e.costAtLevel(u)),q=s,j=0;for(;j<ee;){$=c.fromAny(e.costAtLevel(u+j));let ye=q.add($);if(ye.cmp(n)>0)break;q=ye,j+=1}let le=u+j,ue=Number.isFinite(d)&&le>=d,C=wu(j);if(j<ee||ue||h<=j){let ye=ue?s:c.fromAny(e.costAtLevel(le));return{count:C,spent:q,nextPrice:ye,numericCount:j}}let W=(()=>{try{return er(t??u,u).add(C)}catch{return u+j}})(),ce=Sl(e,W,n.sub(q),h-j,r),me=ce?.count instanceof c?ce.count:wu(ce?.numericCount??0),Z=C.add(me),re=(ce?.spent??s).add(q);return{count:Z,spent:re,nextPrice:ce?.nextPrice??s,numericCount:j+(ce?.numericCount??0)}}let y=Ae(n),g=i.ratioLog10,b=i.ratioMinus1,E=c.fromAny(e.costAtLevel(u)),x=i.baseLog10+u*g;if(b>0&&(!Number.isFinite(y)||Math.abs(y)>1e6&&Math.abs(x)>1e6)){let ee=c.fromAny(e.costAtLevel(u));if(n.cmp(ee)<0)return{count:s,spent:s,nextPrice:ee,numericCount:0};let $=Number.isFinite(h)?Math.max(1,Math.floor(h)):Number.MAX_VALUE,q=1,j=1;for(;j<$;){let me=Qo(e,u,j);if(Me(me).cmp(n)<=0){let re=j*2;if(!Number.isFinite(re)||re<=j){j=$;break}q=j,j=Math.min(re,$)}else break}let le=0;for(;q<j&&le<256;){let me=Math.max(q+1,Math.floor((q+j+1)/2)),Z=Qo(e,u,me);Me(Z).cmp(n)<=0?q=me:j=me-1,le++}let ue=Math.max(1,q),C=wu(ue),W=s,ce=s;if(!a)if(W=Cu(e,u,ue),Number.isFinite(d)){let me=Math.max(0,Math.floor(d-Math.min(u,d)));ue>=me?ce=s:ce=Me(x+ue*g)}else ce=Me(x+ue*g);return{count:C,spent:W,nextPrice:ce,numericCount:ue}}if(n.cmp(E)<0)return{count:s,spent:s,nextPrice:E,numericCount:0};let T=!1,F=null,D=null;try{F=c.fromAny(e.costAtLevel(u+1))}catch{}try{let ee=Math.min(Number.isFinite(d)?Math.max(u+1,Math.floor(d)):u+32,u+32);D=c.fromAny(e.costAtLevel(ee))}catch{}!T&&!(i.ratioMinus1>0)&&(T=!0),F&&D&&(T=F.cmp(E)===0&&D.cmp(E)===0),!T&&!(i.ratioMinus1>0)&&(T=!0);let G=Number.isFinite(h)?Math.max(0,Math.floor(h)):Number.MAX_VALUE;if(T){let ee=er(e.lvlCapBn??"Infinity","Infinity"),$=er(t??0,0),q=ee.isInfinite?.()?c.fromAny("Infinity"):ee.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=rm(E,n,q);return{count:le,spent:ue,nextPrice:C,numericCount:j}}if(!(g>0)||!(b>0)){let ee=er(e.lvlCapBn??"Infinity","Infinity"),$=er(t??0,0),q=ee.isInfinite?.()?c.fromAny("Infinity"):ee.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=rm(E,n,q);return{count:le,spent:ue,nextPrice:C,numericCount:j}}let _=Math.log10(b);if(!Number.isFinite(_))return{count:s,spent:s,nextPrice:E,numericCount:0};let M=pf(y+_-x)/g;(!Number.isFinite(M)||M<0)&&(M=0);let L=Math.floor(Math.min(G,M));Number.isFinite(L)||(L=G),L<=0&&(L=1);let X=1e-7,J=Qo(e,u,L),fe=0,K=2048;for(;L>0&&(!Number.isFinite(J)||J>y+X)&&fe<K;){let ee=Number.isFinite(J)?Math.max(1,Math.ceil((J-y)/Math.max(g,1e-12))):Math.max(1,Math.floor(L/2)),$=Math.max(0,Math.floor(L-ee));if($<L)L=$;else{let q=a0(L);if(!(q<L))break;L=q}J=L>0?Qo(e,u,L):Number.NEGATIVE_INFINITY,fe+=1}if(L<=0||!Number.isFinite(L))if(n.cmp(E)>=0)L=1,J=Ae(E);else return{count:s,spent:s,nextPrice:E,numericCount:0};if(L<G){let ee=C=>{let W=C*2;return Number.isFinite(W)?W:Number.MAX_VALUE},$=L,q=Math.min(G,Math.max(L+1,ee(L))),j=Qo(e,u,q);for(;$<q&&Number.isFinite(j)&&j<=y+X&&q<G;)$=q,q=Math.min(G,ee(q)),j=Qo(e,u,q);let le=$,ue=q;for(let C=0;C<256&&le<ue;C+=1){let W=Math.floor((le+ue+1)/2),ce=Qo(e,u,W);Number.isFinite(ce)&&ce<=y+X?(le=W,J=ce):ue=W-1}L=le}let Q=null;if(!a){Q=Cu(e,u,L);let ee=0;for(;Q.cmp(n)>0&&L>0&&ee<K;){let $=HE(L);if(!($<L))break;L=$,Q=Cu(e,u,L),ee+=1}if(L<=0)return{count:s,spent:s,nextPrice:E,numericCount:0};if(L<G&&ee<K)for(;L<G&&ee<K;){let $=u+L,q;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)q=c.fromAny(e.costAtLevel($));else{let le=x+L*g;q=Me(le).floorToInteger()}}catch{break}let j=Q.add(q);if(j.cmp(n)>0)break;Q=j,L+=1,ee+=1}}let ve=s,he=!a&&Number.isFinite(u)&&Number.isFinite(L)&&u<Number.MAX_SAFE_INTEGER/2&&L<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(d)){let ee=Math.max(0,Math.floor(d-Math.min(u,d)));if(L>=ee)ve=s;else if(he){let $=Math.floor(u+L);ve=c.fromAny(e.costAtLevel($))}else{let $=x+L*g;ve=Me($)}}else if(he){let ee=Math.floor(u+L);ve=c.fromAny(e.costAtLevel(ee))}else{let ee=x+L*g;ve=Me(ee)}return{count:wu(L),spent:Q,nextPrice:ve,numericCount:L}}function XE(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=Ae(t),r=Ae(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function rm(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let d=BigInt(o)/BigInt(r),f=c.fromAny(d.toString());!n.isInfinite?.()&&f.cmp(n)>0&&(f=n);let p=e.mulBigNumInteger(f);return{count:im(f),countBn:f,spent:p,nextPrice:e}}let i=Ae(t),s=Ae(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Me(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:im(l),countBn:l,spent:a,nextPrice:u}}function VE(e,t,n,o){if(!n||o<=0)return{count:0};let r=Ae(t),i=Ae(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let y=0;y<64&&a<u;y+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let d=Math.min(a,o);if(d<=0)return{count:0};let f=i+d*n.ratioLog-n.logDenom;if(f>r)return{count:0};let p=i+d*n.ratioLog,h=Me(f),m=Me(p);return{count:d,spent:h,nextPrice:m,spentLog:f,nextPriceLog:p}}function er(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function im(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Br(e){return ne(e instanceof c?e:c.fromAny(e??0))}function Gs(e){return Br(e).replace(/<[^>]*>/g,"")}function Tu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Hs(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=Tu(n??t??0),s=Tu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:De(i),newLevel:Number.isFinite(o)?o:De(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Bt(e,t){return hn(e,t)}function l0(e,t=v()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Ii(e,t,n=v()){if(n==null)return null;let o=tr(e),r=mm(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function YE(){Xv.forEach(e=>{try{e?.()}catch{}}),Xv.clear()}function Vv(e){YE()}function WE(e,t){if(typeof localStorage>"u")return;let n=l0(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=Ii(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}}),console.log(`[UpgradeMigration] Migrated ${i} upgrades for area ${e} slot ${t}`)}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function zE(e,t,n){WE(e,n);let o=Ii(e,t,n);if(!o)return null;if(Ds&&yl.has(o))try{let r=yl.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Pr.has(o))try{let r=Pr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function qs(e,t,n,o=v(),r={}){let i=Ii(e,t,o);if(i){if(Ds){yl.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Pr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Pr.has(i)&&Pr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{it(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function KE(e,t,n=v()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&qs(e,o.id,o,n)})}function mm(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return Kn(t.id);let n=Kn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=nr(n);if(o){let r=Qp.get(o);if(r){let i=tr(e);if(!i||tr(r.area)===i)return Kn(r.id)}}}return n}function c0(e,t,n=v()){let o=n==null?"null":String(n),r=mm(e,t);return`${o}:${e}:${Kn(r)}`}function ho(e,t){let n=mm(e,t),o=Kn(n),r=v(),i=c0(e,o,r),s=sm.get(i);if(s)return s;let l=zs(e,o),a=zE(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,qs(e,o,a,r)}let d=a.lvl,f=a.nextCost,p=a.nextCostLvl;a.lvl=$s(a.lvl),a.nextCost=$s(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=$s(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==d||a.nextCost!==f||a.nextCostLvl!==p)&&(u=!0);let h=0;l?.upgType==="HM"&&(h=Ys(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),Ou(l,h));let m=ct(a.lvl),y=De(m);try{let R=l?.lvlCapBn??c.fromAny("Infinity");if(!R.isInfinite?.()&&m.cmp(R)>0){let T=R.clone?.()??R;y=De(T);let F=T.toStorage();a.lvl=F,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=F,qs(e,o,a,r)}}catch{}let g=null;try{g=m?.toStorage?.()??ct(y).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let b=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,E=!b||b!==g,x=null;if(!E&&a.nextCost!=null)try{x=c.fromAny(a.nextCost)}catch{x=null,E=!0}if(!x||E){if(l)try{x=c.fromAny(l.costAtLevel(y))}catch{x=c.fromInt(0)}else x=c.fromInt(0);try{a.nextCost=x.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{qs(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let R=c.fromAny("Infinity");l.lvlCapBn=R,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Br(R),l.lvlCapFmtText=Gs(R)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:y,lvlBn:m,nextCostBn:x,slot:r,hmEvolutions:h},sm.set(i,s),s}function Fr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??v();if(!n||o==null)return;let r=Kn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??ct(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=De(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??ct(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=ct(e.lvl??0).toStorage()}i.lvl=$s(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=$s(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=Ys(e.hmEvolutions)),qs(n,r,i,o,t),e.slot=o}function or(e,t,n=v()){sm.delete(c0(e,t,n))}function Mt(e,t){return ho(e,t).lvl}function am(e,t){return ho(e,t).hmEvolutions??0}function u0(e,t){if(!t)return{locked:!1};let n=Qv(),o=n?yn():c.fromInt(0),r=n?De(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let d=FE(e,t),f="Unlock the XP system to reveal this upgrade",p=e0();if(d)if(p)i={locked:!0,iconOverride:gn,titleOverride:nn,descOverride:f,reason:f,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let h='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Tn,titleOverride:zn,descOverride:h,reason:h,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Tn,titleOverride:zn,descOverride:f,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=Kp({locked:!1},i);if(typeof t.computeLockState=="function")try{let d={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,baseLocked:s.locked,getUpgradeLevel(p){return Mt(e,p)}},f=t.computeLockState(d);s=Kp(s,f)}catch{}let l=v(),a=Vs(e,t),u=a?ku(e,t,l):!1;if(a){let d=tm(l),f=Nu(l),p=cm(l),h=a.replace(/_/g,"-"),m=bl(e,t),y=!1;Us(d,h,a)&&(y=!0),m&&Us(d,m,a)&&(y=!0),y&&nm(d,l);let g=!1;Us(f,h,a)&&(g=!0),m&&Us(f,m,a)&&(g=!0),g&&Ru(f,l);let b=!1;Us(p,h,a)&&(b=!0),m&&Us(p,m,a)&&(b=!0),b&&um(p,l)}if(s.locked){let d=!!s.hidden;s.iconOverride||(s.iconOverride=Tn),d?s.titleOverride||(s.titleOverride=nn):(!s.titleOverride||s.titleOverride===nn)&&(s.titleOverride=zn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:d&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Tn||s.iconOverride===gn)&&delete s.iconOverride,(s.titleOverride===nn||s.titleOverride===zn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Tn),a){let d=tm(l),f=d.upgrades[a]||{},p=nr(t?.tie??t?.tieKey),h=p&&zv.has(p),m=p&&lm.has(p),y=f.status||"locked";if(ku(e,t,l))y="unlocked";else if(Jv(e,t,l)&&y==="locked"){let _=!1;try{_=De(yn())>=31}catch{}let B=!1;try{B=De(yn())>=101}catch{}h&&!_||m&&!B?y="locked":y="mysterious"}let g=Su(y),b=zp(s),E=Su(b),x=()=>{s.locked=!0;let _=f.snapshot;_&&typeof _=="object"&&(s=Kp(s,_)),s.iconOverride=gn,s.titleOverride=nn;let B=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=B,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>E&&(y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):y==="mysterious"&&x(),b=zp(s),E=Su(b));let R=!1,T=f&&typeof f=="object"&&typeof f.status=="string"?f.status:"locked",F=h,D=!1;try{D=De(yn())>=31}catch{}let G=!1;try{G=De(yn())>=101}catch{}if((F&&!D&&T==="mysterious"||m&&!G&&T==="mysterious")&&(T="locked"),(!f||typeof f!="object"||Object.keys(f).length!==1||f.status!==T)&&(d.upgrades[a]={status:T},R=!0),E>g){if(f.status=b,d.upgrades[a]={status:f.status},R=!0,y=b,g=E,b==="unlocked")Si(e,t,l);else if(b==="mysterious"){let _=!1;try{_=De(yn())>=31}catch{}(!h||_)&&om(e,t,l)}}y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Tn||s.iconOverride===gn)&&delete s.iconOverride,(s.titleOverride===nn||s.titleOverride===zn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,f.status!=="unlocked"&&(d.upgrades[a]={status:"unlocked"},R=!0),Si(e,t,l)):y==="mysterious"&&b!=="mysterious"&&(x(),b=zp(s),E=Su(b)),R&&nm(d,l)}return s}function Il(e,t){return!!u0(e,t).locked}function hm(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Au(e),{capBn:r,cap:i}=n0(o);try{return t?.cmp?.(r)>=0}catch{}let s=De(t);return Number.isFinite(s)&&s>=i}function En(e,t){let n=ho(e,t);return n.lvlBn?.clone?n.lvlBn.clone():ct(n.lvl??0)}function f0(e,t){let n=ho(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??ct(n.lvl??0),i=De(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function Jo(e,t,n,o=!0,r={}){let i=ho(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,Ou(s,0));let a=s?.lvlCap??1/0,u=i.lvl,d=Tu(i.lvlBn??ct(i.lvl??0)),f=ct(n);f.isInfinite?.()&&(f=c.fromAny("Infinity"));let p=f;try{s&&Yv(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=ct(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=ct(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let h=De(p);if(!s)return i.lvl=h,i.lvlBn=p,i.nextCostBn=c.fromInt(0),Fr(i),or(e,t),jn(),i.lvl;i.lvl=h,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(h))}catch{i.nextCostBn=c.fromInt(0)}return Fr(i,{deferSave:r?.deferSave}),or(e,t),Hs(s,u,d,i.lvl,i.lvlBn),jn(),i.lvl}function Pt(e){return Pu.filter(t=>t.area===e)}function zs(e,t){let n=tr(e),o=Kn(t),r=nr(typeof o=="string"?o:t);return Pu.find(i=>n&&tr(i.area)!==n?!1:!!(Kn(i.id)===o||r&&i.tieKey===r))||null}function Mo(e,t){let n=typeof t=="object"&&t?t:zs(e,t);return u0(e,n)}function jE(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function Kc(e){return e?jE(e.icon):""}function ZE(e,t){let n=zs(e,t),o=En(e,t),r=De(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Cs(e,t){let n=ho(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Il(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??ct(r),s=Tu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(Yv(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=De(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Fr(n),or(e,t),jn(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,d=u?O[u]:null,f=c.fromInt(0);if(d&&!a.isZero?.()){let h=d.value;if((h instanceof c?h:c.fromAny(h??0)).cmp(a)<0)return{bought:0,spent:0};f=a.clone?.()??c.fromAny(a),d.sub(f)}else{if(!a.isZero?.())return{bought:0,spent:0};f=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=De(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(f,n.lvl):o.costAtLevel(n.lvl)),Fr(n),or(e,t),Hs(o,r,s,n.lvl,n.lvlBn),jn(),{bought:1,spent:f}}function Kd(e,t){let n=ho(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??ct(n.lvl);if(!hm(o,r,n.hmEvolutions))return{evolved:!1};let i=Ys(n.hmEvolutions)+1;n.hmEvolutions=i,Ou(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Fr(n),or(e,t),Hs(o,n.lvl,r,n.lvl,r),jn(),{evolved:!0}}function ol(e,t){let n=ho(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Il(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??ct(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=O[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Cs(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let b=i.clone?.()??ct(i),E=De(b),x=b.toStorage?.(),R;if(o.upgType==="HM"){if(R=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let F=c.fromAny("Infinity");o.lvlCapBn=F,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Br(F),o.lvlCapFmtText=Gs(F)}}else{let F=o.lvlCapBn?.clone?.()??er(o.lvlCap??1/0,1/0);R=F?.clone?.()??F}let T=R.sub(b);if(T.isZero?.()){let F=UE(R,b);F.isZero?.()||(T=F)}if(T.isZero?.()){let F=R.toStorage?.();if(x&&F&&x!==F)if(R.isInfinite?.())try{T=c.fromAny("Infinity")}catch{T=c.fromInt(1)}else T=c.fromInt(1)}return n.lvlBn=R.clone?.()??R,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=De(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),O[o.costType].set(u),Fr(n),or(e,t),Hs(o,E,b,n.lvl,n.lvlBn),jn(),{bought:T,spent:c.fromInt(0)}}let d=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(d)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(s)?Math.max(0,s-r):Xs;if(!(f>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=Sl(o,i,u,f),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),y=u.sub(m);O[o.costType].set(y);let g=i.add(h);return n.lvlBn=g,n.lvl=De(g),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Fr(n),or(e,t),Hs(o,r,i,n.lvl,n.lvlBn),jn(),{bought:h,spent:m}}function Ms(e,t,n){let o=ho(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Il(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??ct(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=O[r.costType]?.value,d=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(d.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?De(n):void 0,h=Number.isFinite(f)?Number.isFinite(p)?Math.min(f,p):f:p,m=Sl(r,s,d,h),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=m.spent??c.fromInt(0),b=d.sub(g);O[r.costType].set(b);let E=s.add(y);return o.lvlBn=E,o.lvl=De(E),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Fr(o),or(e,t),Hs(r,i,s,o.lvl,o.lvlBn),jn(),{bought:y,spent:g}}function mi(e,t,n,o=Xs,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=Sl(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function jn(){if(Ds){Jp=!0,ld();return}ld(),vc()}function Vn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Se.STARTER_COVE}function ks(e,t){let n=zs(e,t);if(!n)return null;let o=En(e,t),r=De(o),i=Br(o),s=Gs(o),l=n.lvlCapBn??er(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Br(l),u=n.lvlCapFmtText??Gs(l),d=r<n.lvlCap?f0(e,t):c.fromInt(0),f=Br(d),p=O[n.costType]?.value,h=p instanceof c?p:c.fromAny(p??0),m=Mo(e,t),y=!!m.locked,g=m.titleOverride??n.title,b=m.descOverride??n.desc;if(e===je&&Kn(t)===Qr){let T=Ec();if(Math.abs(T-1)>1e-4&&b){let F=Ve(T);b=b.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+F+" Coins on an interval")}}let E=pm(n,e),x="";typeof n.effectSummary=="function"&&!(y&&m.hideEffect)&&(x=n.effectSummary(r),typeof x=="string"&&(x=x.trim()));let R=m.iconOverride??Kc(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:d,nextPriceFmt:f,have:h,haveFmt:O[n.costType]?.fmt(h)??String(h),effect:x,iconUrl:R,lockState:m,locked:y,areaKey:e,hmMilestones:E,displayTitle:g,displayDesc:b,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?am(e,t):0,hmReadyToEvolve:n.upgType==="HM"?hm(n,o,am(e,t)):!1,hmNextMilestone:n.upgType==="HM"?r0(n,o,e):null}}function JE(e,t){let n=zs(e,t);if(!n||n.upgType!=="HM")return null;let o=En(e,t);return r0(n,o,e)}function QE(e){return Me(Ae(e??0))}function hd(e,t){let n=ho(e,t),o=n.upg;if(!o)return{bought:0};let r=l0(e,n.slot);if(Vt(r))return{bought:0};let i=Ii(e,t,n.slot);if(Vt(i))return{bought:0};if(Il(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??ct(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&hm(o,l,n.hmEvolutions))return{bought:0};let d=O[o.costType]?.value,f=d instanceof c?d.clone?.()??c.fromAny(d):c.fromAny(d??0);if(f.isZero?.())return{bought:0};let p=Sl(o,l,f,Xs),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:0};let m=l.add(h);return ME(),Jo(e,t,m,!0,{deferSave:!0}),{bought:h}}function jd(e,t){let n=ho(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Il(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??ct(n.lvl),i=De(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=O[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=mi(o,r,a,c.fromAny("Infinity")),d=u.numericCount;if(d<=0)return{bought:0,spent:c.fromInt(0)};let f=h=>{if(h<=0)return!0;let m=Cu(o,i,h-1),y=a.sub(m),g=i+h-1,b=c.fromAny(o.costAtLevel(g)),E=y.div(10);return b.cmp(E)<=0},p=0;if(d<2e3){let h=u.spent,m=d;for(;m>0;){let y=i+m-1,g=c.fromAny(o.costAtLevel(y)),b=h.sub(g),x=a.sub(b).div(10);if(g.cmp(x)<=0){p=m;break}h=b,m--}}else{let h=0,m=d;for(;h<m;){let y=Math.ceil((h+m)/2);f(y)?h=y:m=y-1}p=h}return p<=0?{bought:0,spent:c.fromInt(0)}:Ms(e,t,p)}var Xs,$t,jM,CE,Mu,Se,Ds,Gv,yl,Jp,Pr,Hv,AE,Wp,Ee,Wv,TE,Tn,gn,nn,zn,zv,lm,NE,RE,OE,PE,Kv,jv,Zv,BE,Eu,xu,Lu,Qp,ZM,em,bu,zt,Iu,DE,jp,s0,Zp,GE,Pu,sm,Xv,ro=Ue(()=>{St();It();Kt();Gn();_o();xo();io();ei();ls();Yd();cd();Xs=c.fromAny("Infinity"),$t=1e3,jM=c.fromInt(1e3),CE=3,Mu="",Se={STARTER_COVE:"starter_cove",AUTOMATION:je,DNA:"dna"},Ds=!1,Gv=new Map,yl=new Map,Jp=!1,Pr=new Map,Hv=null;AE=308;Wp=1024;Ee={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},Wv=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],TE={[Se.STARTER_COVE]:Wv},Tn="img/misc/locked.webp",gn="img/misc/mysterious.webp",nn="Hidden Upgrade",zn="Locked Upgrade",zv=new Set([Ee.COIN_VALUE_II,Ee.XP_VALUE_II,Ee.MP_VALUE_I,Ee.MAGNET,Ee.ENDLESS_XP]),lm=new Set([Ee.COIN_VALUE_III,Ee.XP_VALUE_III,Ee.MP_VALUE_II,Ee.FASTER_COINS_III,Ee.ENDLESS_MP]),NE=new Set([Ee.UNLOCK_XP,Ee.UNLOCK_FORGE,Ee.UNLOCK_INFUSE,Ee.UNLOCK_SURGE,...zv,...lm]),RE=new Set([Ee.FASTER_COINS_II,Ee.COIN_VALUE_I,Ee.BOOK_VALUE_I,Ee.XP_VALUE_I]),OE=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),PE="ccc:merchantMet",Kv="ccc:shop:reveals",jv="ccc:shop:permaUnlocks",Zv="ccc:shop:permaMyst",BE={locked:0,mysterious:1,unlocked:2},Eu=new Map,xu=new Map,Lu=new Map,Qp=new Map,ZM=nr(Ee.BOOK_VALUE_I),em=c,bu=e=>em.fromAny(e??0),zt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=bu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return em.fromInt(1).add(r.mulDecimal(n))}catch{let i=Ae(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Me(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=bu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return em.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(bu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=bu(i);if(o>0){let l=Ae(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let d=Math.pow(n,a);if(Number.isFinite(d))return d}return Me(u)}}catch{}try{let l=De(s),a=o*l;return Me(a)}catch{return c.fromInt(1)}}}};Iu=Math.log(10);DE={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Au(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Au(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};jp=(()=>{try{let e=De(Xs);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),s0=new ArrayBuffer(8),Zp=new Float64Array(s0),GE=new BigInt64Array(s0);Pu=[{area:Se.STARTER_COVE,id:1,tie:Ee.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:2,tie:Ee.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:mn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{zr()}catch{}}},{area:Se.STARTER_COVE,id:3,tie:Ee.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:4,tie:Ee.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(.5),onLevelChange(){try{Jt()}catch{}}},{area:Se.STARTER_COVE,id:5,tie:Ee.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>_u(e)>0?2:1,onLevelChange({newLevel:e}){$a(e)}},{area:Se.STARTER_COVE,id:6,tie:Ee.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Ve(t)}x`},effectMultiplier:zt.addFlatPerLevel(2)},{area:Se.STARTER_COVE,id:7,tie:Ee.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:mn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Hp()}catch{}}},{area:Se.STARTER_COVE,id:8,tie:Ee.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${ne(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(10),onLevelChange(){try{Jt()}catch{}}},{area:Se.STARTER_COVE,id:9,tie:Ee.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:10,tie:Ee.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:11,tie:Ee.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=_u(e),n=Ve(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>_u(e)},{area:Se.STARTER_COVE,id:12,tie:Ee.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:$t,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return hn(this,e)},nextCostAfter(e,t){return hn(this,t)},computeLockState:mn,effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Go(this,t,this.area),r=Et(n,o);return`XP value bonus: ${Ve(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:13,tie:Ee.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:mn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Xp()}catch{}}},{area:Se.STARTER_COVE,id:14,tie:Ee.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${ne(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(1e3)},{area:Se.STARTER_COVE,id:15,tie:Ee.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:16,tie:Ee.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:17,tie:Ee.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:mn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Ve(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:18,tie:Ee.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:$t,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return hn(this,e)},nextCostAfter(e,t){return hn(this,t)},computeLockState:mn,effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Go(this,t,this.area),r=Et(n,o);return`MP value bonus: ${Ve(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:19,tie:Ee.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:mn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Vp()}catch{}}},{area:Se.STARTER_COVE,id:20,tie:Ee.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:$t,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return hn(this,e)},nextCostAfter(e,t){return hn(this,t)},computeLockState(e){let t=co(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=yn();o=De(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:gn,titleOverride:nn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:zn,descOverride:"Locked"}},onLevelChange(){try{Jt()}catch{}},effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Go(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${Ve(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:21,tie:Ee.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:$t,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return hn(this,e)},nextCostAfter(e,t){return hn(this,t)},computeLockState(e){let t=co(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=yn();o=De(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:gn,titleOverride:nn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:zn,descOverride:"Locked"}},onLevelChange(){try{Jt()}catch{}},effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Go(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${Ve(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:22,tie:Ee.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:$t,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return hn(this,e)},nextCostAfter(e,t){return hn(this,t)},computeLockState(e){let t=co(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=yn();o=De(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:gn,titleOverride:nn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:zn,descOverride:"Locked"}},onLevelChange(){try{Jt()}catch{}},effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Go(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${Ve(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},...lg,...Ly];for(let e of Pu){let t=nr(e.tie??e.tieKey);t&&!Qp.has(t)&&Qp.set(t,e),e.baseCost=er(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return hn(this,n)},e.nextCostAfter=function(n,o){return hn(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=zt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=ct(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Go(this,o,this.area),s=Et(r,i),l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Ve(s)}x`})),e.numUpgEvolutions=Ys(e.numUpgEvolutions),e.upgType==="HM"?Ou(e,e.numUpgEvolutions):(e.lvlCapBn=er(e.lvlCap??1/0,1/0),e.lvlCap=im(e.lvlCapBn),e.lvlCapFmtHtml=Br(e.lvlCapBn),e.lvlCapFmtText=Gs(e.lvlCapBn)),e.bulkMeta=XE(e),Ws(e)}sm=new Map;Xv=new Map;typeof window<"u"&&(Vv(v()),window.addEventListener("saveSlot:change",()=>{Vv(v()),jn()}),window.addEventListener("surge:level:change",()=>{jn()}));Sg()});var $0={};bt($0,{applyAllCurrencyOverridesForActiveSlot:()=>Al,applyStatMultiplierOverride:()=>Hn,getDebugCurrencyMultiplierOverride:()=>xl,getDebugStatMultiplierOverride:()=>hx,setDebugCurrencyMultiplierOverride:()=>A0,setDebugPanelAccess:()=>jx,setDebugStatMultiplierOverride:()=>Nn});function kl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function rx(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function vn(e){typeof e=="function"&&vm.push(e)}function Hu(){return{sections:new Set,subsections:new Set}}function ix(){let e=document.getElementById(_l);if(!e)return Hu();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function sx(e){let{sections:t,subsections:n}=I0??Hu();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function x0(){vm.forEach(e=>{try{e?.()}catch{}}),vm=[],Em.length=0}function Ut(e){!e||typeof e.refresh!="function"||Em.push(e)}function at(e){Em.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function ax(){if(typeof window>"u")return;let e=h=>{let{key:m,slot:y}=h?.detail??{},g=y??v();at(b=>b.type==="currency"&&b.key===m&&b.slot===g)};window.addEventListener("currency:change",e,{passive:!0}),vn(()=>window.removeEventListener("currency:change",e));let t=h=>{let{key:m,slot:y}=h?.detail??{},g=y??v();at(b=>b.type==="currency-mult"&&b.key===m&&b.slot===g)};window.addEventListener("currency:multiplier",t,{passive:!0}),vn(()=>window.removeEventListener("currency:multiplier",t));let n=h=>{let{slot:m,changeType:y,unlocked:g}=h?.detail??{},b=m??v();at(E=>E.type==="xp"&&E.slot===b),at(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===b),(y==="unlock"||typeof g=="boolean")&&at(E=>E.type==="unlock"&&(E.slot==null||E.slot===b))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),vn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=h=>{let{changeType:m,slot:y}=h?.detail??{},g=y??v();at(b=>b.type==="mutation"&&b.slot===g),at(b=>b.type==="stat-mult"&&b.key==="mutation"&&b.slot===g),m==="unlock"&&at(b=>b.type==="unlock"&&(b.slot==null||b.slot===g))};window.addEventListener("mutation:change",o,{passive:!0}),vn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let h=v();at(m=>m.type==="upgrade"&&m.slot===h),at(m=>m.type==="currency-mult"&&m.slot===h),at(m=>m.type==="stat-mult"&&m.slot===h)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),vn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let h=v();at(m=>m.slot===h)};window.addEventListener("saveSlot:change",i,{passive:!0}),vn(()=>window.removeEventListener("saveSlot:change",i));let s=h=>{let{slot:m,key:y}=h?.detail??{},g=m??v();at(b=>b.type==="unlock"&&(b.slot==null||b.slot===g)&&(b.key==null||b.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),vn(()=>window.removeEventListener("unlock:change",s));let l=h=>{let{slot:m}=h?.detail??{},y=m??v();at(g=>g.type==="workshop-level"&&g.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),vn(()=>window.removeEventListener("workshop:change",l));let a=h=>{let{slot:m}=h?.detail??{},y=m??v();at(g=>g.type==="surge-level"&&g.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),vn(()=>window.removeEventListener("surge:level:change",a));let u=h=>{let{slot:m}=h?.detail??{},y=m??v();at(g=>g.type==="tsunami-nerf"&&(g.slot==null||g.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),vn(()=>window.removeEventListener("surge:nerf:change",u));let d=h=>{let{slot:m}=h?.detail??{},y=m??v();at(g=>g.type==="lab-level"&&(g.slot==null||g.slot===y)),at(g=>g.type==="stat-mult"&&g.key==="rp"&&(g.slot==null||g.slot===y))};window.addEventListener("lab:level:change",d,{passive:!0}),vn(()=>window.removeEventListener("lab:level:change",d));let f=h=>{let{id:m,level:y}=h?.detail??{},g=v();at(b=>b.type==="lab-node-level"&&b.slot===g&&b.id===m),m===1&&at(b=>b.type==="tsunami-nerf"&&(b.slot==null||b.slot===g)),m===4&&at(b=>b.type==="unlock"&&(b.slot==null||b.slot===g))};window.addEventListener("lab:node:change",f,{passive:!0}),vn(()=>window.removeEventListener("lab:node:change",f));let p=h=>{let{id:m,rp:y}=h?.detail??{},g=v();at(b=>b.type==="lab-node-rp"&&b.slot===g&&b.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),vn(()=>window.removeEventListener("lab:node:rp",p))}function Xu(){return[{key:Se.STARTER_COVE,title:"The Cove",currencies:[{key:Ce.COINS,label:"Coins"},{key:Ce.BOOKS,label:"Books"},{key:Ce.GOLD,label:"Gold"},{key:Ce.MAGIC,label:"Magic"},{key:Ce.GEARS,label:"Gears"},{key:Ce.WAVES,label:"Waves"},{key:Ce.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function L0(){if(document.getElementById(Bu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Bu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Bu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Bu,document.head.appendChild(n)}function Sm(){let e=document.getElementById(S0);e&&e.remove()}function lx(){return _i&&Ze&&v()!=null&&!kl()&&rx()}function cx(e){e?.detail?.visible&&No(),Wu()}function Uu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${w0++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Zn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${E0++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function kt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function xm(e,t=v()){let n=t??v();return n==null?null:`${gt.CURRENCY[e]}:${n}`}function El(e,t=v()){let n=t??v();if(n==null)return c.fromInt(0);let o=O?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return ba(n,e)}catch{return c.fromInt(0)}}function ux(e,t,n=v()){let o=n??v(),r=El(e,o);if(o==null||o!==v())return{previous:r,next:r};let i=xm(e,o),s=i&&go(i);s&&Qs(i);let l=r;try{Sn(o),l=Fi(e,t,{previous:r})??r,i&&it(i)}catch{}finally{s&&ki(i)}return at(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function Jn(e,t){return`${e??"null"}::${t}`}function Lm(e,t){return Cl.get(Jn(e,t))??null}function fx(e,t=v()){let n=t??v();return!e||n==null?null:`${gt.MULTIPLIER[e]}:${n}`}function dx(e,t=v()){let n=Jn(t,e);Cl.delete(n),Zs.delete(n),at(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function _m(e,t){let n=!Vu(t,e),o=Jn(e,t),r=Ll.get(o);if(!n&&r)return r;let i=px(t,e);return i?(Ll.set(o,i),i):(n&&Ll.delete(o),null)}function _0(e,t){at(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function C0(e,t=v()){let n=Mi(e,t);if(Ll.delete(Jn(t,e)),wi.delete(Jn(t,e)),!(!n||typeof localStorage>"u")&&!go(n)){try{localStorage.removeItem(n)}catch{}_0(e,t)}}function Vu(e,t=v()){return go(Mi(e,t))}function M0(e,t){return Vu(t,e)?_m(e,t):null}function Rn(e,t=v()){let n=Ci(e);return Yu(e,t,n)??n}function Mi(e,t=v()){if(!e)return null;let n=t??v();return n==null?null:`${ex}:${e}:${n}`}function Ci(e){try{if(e==="xp"){let t=ac();if(t)return t}else if(e==="mutation"){let t=Ku?.();if(t)return t;let n=zu();if(n)return n}else if(e==="spawnRate"){let t=ss(Se.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return Mc()}catch{}return c.fromInt(1)}function px(e,t=v()){let n=Mi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function mx(e,t,n){let o=Mi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=go(o),s=i&&js?js:localStorage.setItem.bind(localStorage);i&&!js&&Qs(o),s(o,r.toStorage?.()??String(r)),i&&!js&&ki(o)}catch{}}function Cm(e,t=v()){if(t==null)return;let n=Lm(t,e);if(!n||t!==v())return;let o=Jn(t,e);if(!$u.has(o)){$u.add(o);try{let r=O?.[e]?.mult?.get?.();kt(r,n)||O?.[e]?.mult?.set?.(n)}catch{}finally{$u.delete(o)}}}function k0(){if(!(h0||typeof window>"u")){h0=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??v(),i=Jn(r,t);if(!r||!Cl.has(i)||$u.has(i))return;let s=Zs.get(i),l=Lm(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let d=u.div(a),f=d.sig===1n&&d.e===0&&d._eOffset===0n?1:null,p=l.mulBigNumInteger(d);Cl.set(i,p)}}catch{}Zs.set(i,o)}else o&&Zs.set(i,o);Cm(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Al()},{passive:!0})}catch{}}}function Al(){let e=v();e!=null&&Object.values(Ce).forEach(t=>{Cm(t,e)})}function A0(e,t,n=v()){if(!e||n==null)return null;k0();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=Jn(n,e);if(Cl.set(r,o),!Zs.has(r)){let i=O?.[e]?.mult?.get?.();Zs.set(r,i)}return Cm(e,n),o}function xl(e,t=v()){return!e||t==null?null:Lm(t,e)}function Nn(e,t,n=v()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Ll.set(Jn(n,e),o),wi.set(Jn(n,e),Ci(e)),mx(e,n,o),_0(e,n),o}function hx(e,t=v()){return!e||t==null?null:_m(t,e)}function Hn(e,t,n=v()){let o=Ci(e),r=Yu(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(kt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=Jn(n,e),l=wi.get(s),a=Vu(e,n)&&l?l:o,u=null;try{let d=c.fromAny(r),f=c.fromAny(a);f.isZero()||(u=d.div(f))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function Yu(e,t,n){let o=_m(t,e),r=Jn(t,e);if(!o)return wi.delete(r),null;let i=wi.get(r),s=Vu(e,t);if(!i)wi.set(r,n);else if(!kt(i,n))return s?(wi.set(r,n),o):(C0(e,t),null);return o}function gx(){if(!(p0||typeof localStorage>"u")){p0=!0;try{js=localStorage.setItem.bind(localStorage),m0=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!Js.has(e))return js(e,t)},localStorage.removeItem=e=>{if(!Js.has(e))return m0(e)}}catch{}}}function go(e){return e!=null&&Js.has(e)}function ki(e){e&&(gx(),Js.add(e))}function Qs(e){e&&Js.delete(e)}function yx(e){return e?go(e)?(Qs(e),!1):(ki(e),!0):!1}function vx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=go(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(yx(e),typeof t=="function")try{t(go(e))}catch{}o()}),o(),{button:n,refresh:o}}function bx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>go(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>go(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?Qs(u):ki(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function Sx(){let e=document.getElementById(_l);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function Ix(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{go(r)&&(o.push(r),Qs(r))});try{return t?.()}finally{o.forEach(r=>ki(r))}}function wx(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function Mm(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Im(e,t){e.classList.toggle("debug-invalid",!t)}function Je(){let e=v();try{Sn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function T0(e=v()){return e==null?null:`${tx}:${e}`}function N0(e=v()){let t=T0(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function R0(e,t=v()){let n=T0(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,bm);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function Ex(e,t=v()){let n=N0(t);return n.unshift(e),n.length>bm&&(n.length=bm),R0(n,t),n}function Qe(e){let t=v();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};Ex(o,t),km()}function km(){if(!Ks)return;let e=N0();if(e.length===0){Ks.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",Ks.appendChild(t);return}Ks.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function O0(e=v()){return e==null?null:`${Qa}:${e}`}function P0(e,t=v()){let n=O0(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function B0(e=v()){let t=O0(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function xx(e){if(e){if(Object.values(Ce).includes(e.type)){try{e.type===Ce.BOOKS?O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount):O[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function Lx(){let e=v();if(e==null)return{completed:0};let t=B0(e),n=0;return Object.entries(Dc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,xx(r.reward))}),P0(t,e),{completed:n}}function _x(){let e=v();if(e==null)return{restored:0};let t=B0(e),n=0;return Object.entries(Dc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),P0(t,e),{restored:n}}function on(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let d=!1,f=null,p=!1,h=r?vx(r,{onToggle:i}):null,m=g=>{if(d){f=g;return}f=null,u.value=typeof s=="function"?s(g):wx(g)};l.appendChild(u),h&&l.appendChild(h.button);let y=()=>{let g=Mm(u.value);if(!g){Im(u,!1);return}Im(u,!0);let b=r&&go(r);b&&Qs(r);try{n(g,{input:u,setValue:m})}finally{b&&ki(r),h&&h.refresh()}};return u.addEventListener("focus",()=>{d=!0}),u.addEventListener("change",y),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),p=!0,y(),u.blur())}),u.addEventListener("blur",()=>{if(d=!1,p||y(),p=!1,f!=null){let g=f;f=null,m(g)}}),m(t),h&&h.refresh(),{row:l,input:u,setValue:m,isEditing:()=>d}}function Cx({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let d=document.createElement("div");d.className="debug-unlock-text";let f=document.createElement("span");if(f.className="debug-unlock-title",f.textContent=e,d.appendChild(f),t){let y=document.createElement("span");y.className="debug-unlock-desc",y.textContent=`- ${t}`,d.appendChild(y)}s.appendChild(l),s.appendChild(d);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",y=>{l.contains(y.target)||p()});let h=!1,m=()=>{let y=!1;try{y=typeof n=="function"?!!n():!1}catch{}return a.checked=y,h=y,y};return a.addEventListener("change",()=>{let y=h,g=a.checked;try{g?o?.():r?.()}catch{}Je();let b=m();y!==b&&Qe(`Toggled ${e} [GOLD]${y?"True":"False"}[/GOLD] \u2192 [GOLD]${b?"True":"False"}[/GOLD]`)}),m(),Ut({type:"unlock",slot:i,refresh:m}),s}function Mx(e){try{if(e instanceof c||typeof e?.toScientific=="function")return ne(e);let t=Number(e);return Number.isFinite(t)?ne(t):String(e??"\u2014")}catch{return"\u2014"}}function kx({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},d=!1;if(l.forEach(({config:f,el:p})=>{if(f.type==="select"){u[f.key]=p.value;return}let h=Mm(p.value),m=h instanceof c;if(Im(p,m),!m){d=!0;return}u[f.key]=h}),d||typeof n!="function"){s.textContent="\u2014";return}try{let f=n(u);s.innerHTML=Mx(f)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let d=Object.assign({type:"text",defaultValue:""},u);if(d.key)if(d.type==="select"){let f=document.createElement("select");f.className="debug-panel-input",(d.options||[]).forEach(({value:p,label:h})=>{let m=document.createElement("option");m.value=p,m.textContent=h??p,d.defaultValue!=null&&d.defaultValue===p&&(m.selected=!0),f.appendChild(m)}),f.addEventListener("change",a),i.appendChild(f),l.push({config:d,el:f})}else{let f=document.createElement("input");f.type="text",f.className="debug-panel-input",f.placeholder=d.label||"",f.value=d.defaultValue??"",f.addEventListener("input",a),f.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(f),l.push({config:d,el:f})}}),a(),o}function Ur({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return et()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{zr()}catch{}let d=Ei.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(it(d,"1"),s!=null)try{let f=s.toStorage?.()??c.fromAny(s).toStorage(),p=Ei.level(n);localStorage.setItem(p,f),it(p,f)}catch{}if(l!=null)try{let f=l.toStorage?.()??c.fromAny(l).toStorage(),p=Ei.progress(n);localStorage.setItem(p,f),it(p,f)}catch{}try{Vi({forceReload:!0})}catch{}try{ic({changeType:"debug-panel",slot:n})}catch{}try{at()}catch{}}function Dr({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return ut()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let f=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!f&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Ml(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{jt()}catch{}try{Or()}catch{}let d=xi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(it(d,"1"),e!=null)try{let f=e.toStorage?.()??c.fromAny(e).toStorage(),p=xi.level(n);localStorage.setItem(p,f),it(p,f)}catch{}if(t!=null)try{let f=t.toStorage?.()??c.fromAny(t).toStorage(),p=xi.progress(n);localStorage.setItem(p,f),it(p,f)}catch{}try{jt({forceReload:!0})}catch{}try{Am({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{at()}catch{}}function Ax(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=xm(r.key,n),s=El(r.key,n),l=on(r.label,s,(a,{setValue:u})=>{let d=v();if(d==null)return;let f=El(r.key,d),{next:p}=ux(r.key,a,d);u(p),kt(f,p)||(Je(),Qe(`Modified ${r.label} (${o}) ${ne(f)} \u2192 ${ne(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(El(r.key,v()))});Ut({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let a=El(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function Tx(e,t){let n=v();if(n==null){let D=document.createElement("div");D.className="debug-panel-empty",D.textContent="Select a save slot to edit stats.",e.appendChild(D);return}let o="spawnRate",r=Mi(o,n),i=on("Coin Spawn Rate",Rn(o,n),(D,{setValue:G})=>{let _=v();if(_==null)return;let B=Rn(o,_);try{Nn(o,D,_)}catch{}let M=Rn(o,_);G(M),kt(B,M)||(Je(),Qe(`Modified Spawn Rate (${a}) ${ne(B)} \u2192 ${ne(M)}`))},{storageKey:r,onLockChange:D=>{let G=v();if(G!=null){if(D){if(M0(G,o))return;try{Nn(o,Ci(o),G)}catch{}}else Yu(o,G,Ci(o));i.setValue(Rn(o,G))}}});Ut({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==v())return;let D=Rn(o,n);i.setValue(D)}}),Ut({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==v())return;let D=Rn(o,n);i.setValue(D)}}),e.appendChild(i.row);let s=et(),l=ut(),a=t?.title??t?.key??"Unknown Area",u=Ei.level(n),d=on("XP Level",s.xpLevel,(D,{setValue:G})=>{let _=et().xpLevel;Ur({level:D});let B=et();G(B.xpLevel),kt(_,B.xpLevel)||(Je(),Qe(`Modified XP Level (${a}) ${ne(_)} \u2192 ${ne(B.xpLevel)}`))},{storageKey:u});Ut({type:"xp",slot:n,refresh:()=>{n===v()&&d.setValue(et().xpLevel)}}),e.appendChild(d.row);let f=Ei.progress(n),p=on("XP Progress",s.progress,(D,{setValue:G})=>{let _=et(),B=_?.xpLevel?.clone?.()??_?.xpLevel,M=_?.progress?.clone?.()??_?.progress;Ur({progress:D});let L=et();G(L.progress),d.setValue(L.xpLevel),(!kt(M,L.progress)||!kt(B,L.xpLevel))&&(Je(),Qe(`Modified XP Progress (${a}) ${ne(M)} \u2192 ${ne(L.progress)}`))},{storageKey:f});Ut({type:"xp",slot:n,refresh:()=>{n===v()&&p.setValue(et().progress)}}),e.appendChild(p.row);let h=xi.level(n),m=on("MP Level",l.level,(D,{setValue:G})=>{let _=ut().level;Dr({level:D});let B=ut();G(B.level),kt(_,B.level)||(Je(),Qe(`Modified MP Level (${a}) ${ne(_)} \u2192 ${ne(B.level)}`))},{storageKey:h});Ut({type:"mutation",slot:n,refresh:()=>{n===v()&&m.setValue(ut().level)}}),e.appendChild(m.row);let y=xi.progress(n),g=on("MP Progress",l.progress,(D,{setValue:G})=>{let _=ut(),B=_?.level?.clone?.()??_?.level,M=_?.progress?.clone?.()??_?.progress;Dr({progress:D});let L=ut();G(L.progress),m.setValue(L.level),(!kt(M,L.progress)||!kt(B,L.level))&&(Je(),Qe(`Modified MP Progress (${a}) ${ne(M)} \u2192 ${ne(L.progress)}`))},{storageKey:y});Ut({type:"mutation",slot:n,refresh:()=>{n===v()&&g.setValue(ut().progress)}}),e.appendChild(g.row);let b=oi(n);if(b){let D=0;try{let _=localStorage.getItem(b),B=c.fromAny(_||"0");if(B.isInfinite())D=1/0;else try{D=Number(B.toScientific(20))}catch{D=0}}catch{}let G=on("Workshop Level",D,(_,{setValue:B})=>{let M=Number(_);if(console.log("[DebugPanel] Workshop Level Commit. Value type:",typeof _,"IsBigNum:",_ instanceof c,"Value:",_),_ instanceof c)if(_.isInfinite())M=1/0;else try{M=Number(_.toScientific(20))}catch{M=NaN}if(Number.isNaN(M)||M<0)return;let L=M===1/0?"Infinity":String(Math.floor(M));try{localStorage.setItem(b,L),Je(),Qe(`Modified Workshop Level (The Cove) ${ne(D)} \u2192 ${L}`),D=M}catch{}B(M)},{storageKey:b,onLockChange:()=>{let _=0;try{let B=localStorage.getItem(b),M=c.fromAny(B||"0");M.isInfinite()?_=1/0:_=Number(M.toScientific(20))}catch{}G.setValue(_)}});e.appendChild(G.row),Ut({type:"workshop-level",slot:n,refresh:()=>{if(n!==v())return;let _=0;try{let B=localStorage.getItem(b),M=c.fromAny(B||"0");M.isInfinite()?_=1/0:_=Number(M.toScientific(20))}catch{}G.setValue(_)}})}let E=Bs(n);if(E){let D=0;try{let _=localStorage.getItem(E);_==="Infinity"?D=1/0:D=c.fromAny(_||"0")}catch{D=c.fromInt(0)}let G=on("Surge Level",D,(_,{setValue:B})=>{let M="0",L=0;_ instanceof c?_.isInfinite()?(M="Infinity",L=1/0):(M=_.toPlainIntegerString(),L=_):_===1/0||typeof _=="string"&&/infinity/i.test(_)?(M="Infinity",L=1/0):(M=String(_),L=_);try{localStorage.setItem(E,M),Je();let X=L===1/0?"Infinity":ne(L),J=D===1/0||D instanceof c&&D.isInfinite()?"Infinity":ne(D);Qe(`Modified Surge Level (The Cove) ${J} \u2192 ${X}`),L===1/0?D=1/0:L instanceof c?D=L:D=c.fromAny(L)}catch{}B(L);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let X=D;if(X!==1/0&&X instanceof c)try{X=BigInt(X.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:X}}))}catch{}},{storageKey:E,onLockChange:_=>{let B=c.fromInt(0);try{let M=localStorage.getItem(E);M==="Infinity"?B=1/0:B=c.fromAny(M||"0")}catch{}G.setValue(B)}});Ut({type:"surge-level",slot:n,refresh:()=>{if(n!==v())return;let _=c.fromInt(0);try{let B=localStorage.getItem(E);B==="Infinity"?_=1/0:_=c.fromAny(B||"0")}catch{}G.setValue(_)}}),e.appendChild(G.row)}let x=Wt(),R=on("Lab Level",x,(D,{setValue:G})=>{let _;try{_=D instanceof c?D:c.fromAny(D),_.isNegative&&_.isNegative()&&(_=c.fromInt(0))}catch{G(Wt());return}let B=Wt();ci(_),Je(),kt(B,_)||Qe(`Modified Lab Level (The Cove) ${ne(B)} \u2192 ${ne(_)}`),G(_)},{storageKey:wd(n)});Ut({type:"lab-level",slot:n,refresh:()=>{n===v()&&R.setValue(Wt())}}),e.appendChild(R.row);let T=()=>{let D=Yt(),G=fn(),_=D+G;return _>1&&(_=1),_},F=on("Tsunami Exponent",T().toFixed(2),(D,{setValue:G})=>{let _=Number(D);if(D instanceof c?D.isInfinite()?_=1/0:_=Number(D.toScientific(10)):typeof D=="string"&&/infinity/i.test(D)&&(_=1/0),Number.isNaN(_)){G(T().toFixed(2));return}let B=fn(),M=_-B;M>1&&(M=1),M<0&&(M=0),M=Math.round(M*100)/100;let L=Yt();ps(M),Je(),Math.abs(L-M)>1e-4&&Qe(`Modified Tsunami Exponent (The Cove) Base:${L.toFixed(2)} \u2192 ${M.toFixed(2)} (Effective: ${_.toFixed(2)})`),G(T().toFixed(2))},{storageKey:Sd(n),format:D=>{let G=Number(D);return Number.isFinite(G)?G.toFixed(2):String(D)}});Ut({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==v())return;let D=T();F.setValue(D.toFixed(2))}}),e.appendChild(F.row)}function g0(e,t){let n=v();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Pt(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=En(t.key,i.id??i.tie),u=Ii(t.key,i.id??i.tie,n),d=on(l,a,(f,{setValue:p})=>{if(v()==null)return;let m=En(t.key,i.id??i.tie);try{Jo(t.key,i.id??i.tie,f,!1)}catch{}let y=En(t.key,i.id??i.tie);p(y),kt(m,y)||(Je(),Qe(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${ne(m)} \u2192 Lv${ne(y)}`))},{idLabel:s,storageKey:u});Ut({type:"upgrade",slot:n,refresh:()=>{if(n!==v())return;let f=En(t.key,i.id??i.tie);d.setValue(f)}}),e.appendChild(d.row)})}function Nx(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=O?.[r.key]?.mult,l=xl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${gt.MULTIPLIER[r.key]}:${n}`,u=on(`${r.label} Multiplier`,l,(d,{setValue:f})=>{let p=v();if(p==null)return;let h=xl(r.key,p)??i?.get?.()??c.fromInt(1);try{A0(r.key,d,p)}catch{}Al();let y=xl(r.key,p)??i?.get?.()??c.fromInt(1);f(y),kt(h,y)||(Je(),Qe(`Modified ${r.label} Multiplier (${o}) ${ne(h)} \u2192 ${ne(y)}`))},{storageKey:a});Ut({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let f=xl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(f)}}),e.appendChild(u.row)})}function Rx(){if(v()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Ce).forEach(o=>{let r=O?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||kt(i,t))return;r.set(t),n+=1}catch{}}),n}function Ox(){if(v()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Ce).forEach(o=>{let r=O?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function Px(){let e=v();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=et()}catch{}try{r=ut()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||kt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||kt(o?.progress,t);(!i||!s)&&(Ur({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||kt(r?.level,t),s=r?.progress?.isInfinite?.()||kt(r?.progress,t);(!i||!s)&&(Dr({level:t,progress:t}),n+=1)}}catch{}try{let i=oi(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Bs(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{at()}catch{}return n}function Bx(){let e=v();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=et()}catch{}try{r=ut()}catch{}try{o?.unlocked&&(Ur({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Dr({level:t,progress:t}),n+=1)}catch{}try{let i=oi(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Bs(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{at()}catch{}return n}function F0(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!et()?.unlocked}catch{return!1}},onEnable:()=>{try{zr()}catch{}try{Vi({forceReload:!0})}catch{}},onDisable:()=>{try{Yi({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Ml(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{Ml(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return Qd()}catch{return!1}},onEnable:()=>{try{hi()}catch{}},onDisable:()=>{try{Jc()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return ep()}catch{return!1}},onEnable:()=>{try{Zc()}catch{}},onDisable:()=>{try{Qc()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return Gd()}catch{return!1}},onEnable:()=>{try{Fc(!0)}catch{}},onDisable:()=>{try{Fc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!xn()}catch{return!1}},onEnable:()=>{try{wr(!0)}catch{}},onDisable:()=>{try{wr(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return yt(4)>=1}catch{return!1}},onEnable:()=>{try{br(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{br(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function U0(e){let t=v();if(t==null)return 0;let n=0;F0(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{at()}catch{}return n}function Fx(){let e=v();if(e==null)return{unlocks:0,toggles:0};let t=0;Xu().forEach(o=>{Pt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Si(o.key,r,e),t+=1}catch{}})});try{hi()}catch{}try{Zc()}catch{}let n=U0(!0);return{unlocks:t,toggles:n}}function Ux(){let e=v();if(e==null)return{locks:0,toggles:0};let t=0;Xu().forEach(o=>{Pt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{fm(o.key,r,e),t+=1}catch{}})});try{Jc()}catch{}try{Qc()}catch{}let n=U0(!1);return{locks:t,toggles:n}}function Dx(e,t=v()){let n=t??v();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(xm(a,n)),r(fx(a,n))},s=a=>r(Mi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(Ei.level(n)),r(Ei.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(xi.level(n)),r(xi.progress(n)))};return e==="all"?(Object.values(Ce).forEach(i),l("xp"),l("mutation"),Gu.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Ce).forEach(i),Array.from(o)):e==="allUnlockedStats"?(et()?.unlocked&&l("xp"),ut()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Ce).forEach(i),et()?.unlocked&&l("xp"),ut()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function Du(e){try{O?.[e]?.set?.(c.fromInt(0))}catch{}try{dx(e)}catch{}try{jl(e,c.fromInt(1))}catch{}}function $x(e){if(e==="all"){Object.values(Ce).forEach(i=>Du(i));let o=c.fromInt(0);return Ur({level:o,progress:o}),Dr({level:o,progress:o}),Gu.forEach(({key:i})=>{try{Nn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Ce).length+Gu.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Ce).forEach(i=>{Du(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(et()?.unlocked){Ur({level:o,progress:o});try{Nn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(ut()?.unlocked){Dr({level:o,progress:o});try{Nn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Ce).forEach(l=>{Du(l),o+=1});let r=c.fromInt(0),i=0;try{if(et()?.unlocked){Ur({level:r,progress:r});try{Nn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(ut()?.unlocked){Dr({level:r,progress:r});try{Nn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return Du(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{C0(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Ur({level:n,progress:n});try{Nn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Dr({level:n,progress:n});try{Nn("mutation",c.fromInt(1))}catch{}return"MP"}try{Nn(t,c.fromInt(1))}catch{}return`stat ${t}`}function qx(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";Gu.forEach(r=>{if(r.key==="spawnRate")return;let i=Mi(r.key,n),s=on(`${r.label} Multiplier`,Rn(r.key,n),(l,{setValue:a})=>{let u=v();if(u==null)return;let d=Rn(r.key,u);try{Nn(r.key,l,u)}catch{}let f=Rn(r.key,u);a(f),kt(d,f)||(Je(),Qe(`Modified ${r.label} Multiplier (${o}) ${ne(d)} \u2192 ${ne(f)}`))},{storageKey:i,onLockChange:l=>{let a=v();if(a!=null){if(l){if(M0(a,r.key))return;try{Nn(r.key,Ci(r.key),a)}catch{}}else Yu(r.key,a,Ci(r.key));s.setValue(Rn(r.key,a))}}});Ut({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Rn(r.key,n);s.setValue(l)}}),Ut({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Rn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Ut({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Rn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function Gx(e){let t=v();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Ft||Ft.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Ft.forEach(n=>{let o=Zn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=Xa(t,n.id),s=on("Level",yt(n.id),(u,{setValue:d})=>{let f=Number(u);if(u instanceof c&&(f=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(f)||f<0)return;f>n.maxLevel&&(f=n.maxLevel),f=Math.floor(f);let p=yt(n.id);br(n.id,f),Je(),p!==f&&Qe(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${f}`),d(f)},{storageKey:i});Ut({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===v()&&s.setValue(yt(n.id))}}),r.appendChild(s.row);let l=Va(t,n.id),a=on("Current RP",ao(n.id),(u,{setValue:d})=>{let f;try{f=u instanceof c?u:c.fromAny(u),f.isNegative&&f.isNegative()&&(f=c.fromInt(0))}catch{d(ao(n.id));return}let p=ao(n.id);us(n.id,f),Je(),kt(p,f)||Qe(`Modified Node ${n.id} RP (The Cove) ${ne(p)} \u2192 ${ne(f)}`),d(f)},{storageKey:l});Ut({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===v()&&a.setValue(ao(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function Hx(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>sc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Hf(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Tm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Os(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>yr(n)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>dm(n,o,r)}]}].forEach(n=>{let o=Zn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=kx({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function Xx(e){if(e.innerHTML="",v()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Al(),Xu().forEach(o=>{let r=Zn(o.title,i=>{let s=Zn("Currencies",h=>{Ax(h,o)}),l=Zn("Stats",h=>{Tx(h,o)}),a=Zn("Multipliers",h=>{let m=Zn("Currencies",g=>{Nx(g,o)}),y=Zn("Stats",g=>{qx(g,o)});h.appendChild(m),h.appendChild(y)}),u=Zn("Upgrades",h=>{g0(h,o)}),d=null,f=null;o.key===Se.STARTER_COVE&&(d=Zn("Automation Upgrades",h=>{g0(h,{key:Se.AUTOMATION,title:"Automation"})}),f=Zn("Lab Nodes",h=>{Gx(h)}));let p=Zn("Calculators",h=>{Hx(h)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),d&&i.appendChild(d),f&&i.appendChild(f),i.appendChild(p)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function y0(e=!1){if(v()==null)return 0;let n=0,o=Object.values(Se),r=[];return o.forEach(i=>{Pt(i).forEach(l=>{e&&Mo(i,l.id).locked||r.push({areaKey:i,upg:l})})}),vl(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;Jo(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function v0(e=!1){if(v()==null)return 0;let n=0,o=Object.values(Se),r=[];o.forEach(s=>{Pt(s).forEach(a=>{e&&Mo(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{vl(()=>{r.forEach(({areaKey:s,upg:l})=>{try{vr(s,l.id,"0"),Jo(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function b0(e){let t=v();if(t==null)return 0;let n=e?"1":"0",o=0,r=Pt(je);vl(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;Jo(je,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(Qi),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Se).forEach(l=>{if(l===je)return;Pt(l).forEach(u=>{s.has(u.costType)&&(vr(l,u.id,n),o++)})}),vr(je,no,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function Vx(e){e.innerHTML="";let t=v();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=Lx();Je(),Qe(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=_x();Je(),Qe(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=Rx();Je(),Qe(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=Px();Je(),Qe(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=Ox();Je(),Qe(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=Bx();Je(),Qe(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let g=y0(!0);Je(),Qe(`Maxed ${g} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let g=v0(!0);Je(),Qe(`Reset ${g} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let g=y0(!1);Je(),Qe(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=v0(!1);Je(),Qe(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=b0(!0);Je(),Qe(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=b0(!1);Je(),Qe(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:b}=Fx();Je(),Qe(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${b} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:b}=Ux();Je(),Qe(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${b} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{R0([],t),km(),Je(),Qe("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=v();if(g!=null)try{localStorage.setItem(nx(g),String(ox)),Yo(!0),Je(),Qe("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let b=Mm(g);if(!b||typeof b.isZero=="function"&&b.isZero()||typeof b.isNegative=="function"&&b.isNegative())return;let E,x=!1;Dt()?E=vs(b):(E=Ac(b),x=!0),di(E);let R=b.mulSmall?b.mulSmall(1e3):b.mulBigNumInteger(c.fromInt(1e3));Lr(E,R,x),Je(),Qe(`Performed OP Time Warp for ${ne(b)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let b=document.createElement("button");b.type="button",b.className="debug-panel-toggle debug-misc-button",b.textContent=g.label,b.addEventListener("click",g.onClick),o.appendChild(b)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",Xu().forEach(g=>{let b=document.createElement("optgroup");b.label=g.title||g.key,g.currencies.forEach(E=>{let x=document.createElement("option");x.value=`currency:${E.key}`,x.textContent=`${g.title||g.key} \u2192 ${E.label}`,b.appendChild(x)}),g.stats.forEach(E=>{let x=document.createElement("option");x.value=`stat:${E.key}`,x.textContent=`${g.title||g.key} \u2192 ${E.label}`,b.appendChild(x)}),s.appendChild(b)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let d=document.createElement("option");d.value="all",d.textContent="All",s.appendChild(d),s.querySelector(`option[value="${Fu}"]`)||(Fu=wl),s.value=Fu;let f=()=>Dx(s.value||wl,v()),p=bx(f);s.addEventListener("change",()=>{Fu=s.value||wl,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle reset-check",h.textContent="\u2705",h.addEventListener("click",()=>{let g=s.value||wl,b=f(),E=p.isLocked(),x=(R=!0)=>{let T=Ix(b,()=>$x(g))??{label:g,count:0};if(E&&b.forEach(F=>ki(F)),p.refresh(),Je(),R){let{label:F,count:D}=T;Qe(`Reset ${D===1?"value and multiplier":"values and multipliers"} for ${F} to defaults.`)}};x(!0),setTimeout(()=>x(!1),100)}),r.appendChild(h),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-danger-button",y.textContent="Wipe Slot & Refresh",y.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let b=document.querySelector(".menu-root"),E=document.getElementById("game-root");b&&(b.hidden=!1,b.style.display="",b.style.visibility=""),E&&(E.hidden=!0,E.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(y),e.appendChild(m)}function Yx(e){e.innerHTML="";let t=v();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Vi()}catch{}let n=F0(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(Cx(o))})}function D0(){if(!_i||kl())return;x0(),L0(),w0=0,E0=0;let e=document.getElementById(_l);e&&e.remove();let t=document.createElement("div");t.id=_l,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>No({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>No()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:d,hideOnMobile:f})=>{let p=document.createElement("div");p.className="debug-panel-info-line",f&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=d,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(Uu("Areas: main currency/stat/upgrade management for each area","debug-areas",d=>{Xx(d)})),t.appendChild(Uu("Unlocks: modify specific unlock flags","debug-unlocks",d=>{Yx(d)})),t.appendChild(Uu("Action Log: keep track of everything you do","debug-action-log",d=>{let f=document.createElement("div");f.id="action-log-entries",f.className="debug-panel-action-log",f.style.maxHeight="240px",f.style.overflowY="auto",d.appendChild(f),Ks=f,km(),vn(()=>{Ks=null})})),t.appendChild(Uu("Miscellaneous: helpful miscellaneous functions","debug-misc",d=>{Vx(d)})),sx(t),document.body.appendChild(t),qu>0)try{t.scrollTop=qu}catch{}ax(),Li=!0}function wm(){if(!(!_i||kl())){if(v()==null){No();return}Li||D0()}}function No({preserveExpansionState:e=!1}={}){I0=e?ix():Hu();let t=document.getElementById(_l);if(t){try{qu=t.scrollTop??0}catch{qu=0}t.remove()}x0(),Li=!1}function Wx(){if(!_i||kl()||v()==null){No();return}Li?No({preserveExpansionState:!0}):wm()}function zx(){No(),Sm()}function Wu(){if(!lx()){Sm(),No();return}L0(),Sm();let e=document.createElement("button");e.id=S0,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{Wx()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function Kx(e){if(_i=!!e,!_i){zx();return}Wu()}function jx(e){Kx(e)}var Bu,_l,S0,wl,Li,_i,vm,I0,qu,Fu,w0,E0,Em,Ks,Cl,Zs,$u,Ll,wi,Js,p0,js,m0,ex,tx,bm,nx,ox,gm,Ei,ym,xi,Gu,h0,zi=Ue(()=>{It();Kt();St();Gn();_o();Lo();ro();eu();Gc();os();xo();io();ls();ei();Td();ui();li();Tc();Bu="debug-panel-style",_l="debug-panel",S0="debug-panel-toggle",wl=`currency:${Ce.COINS}`,Li=!1,_i=!1,vm=[],I0=Hu(),qu=0,Fu=wl,w0=0,E0=0,Em=[],Ks=null,Cl=new Map,Zs=new Map,$u=new Set,Ll=new Map,wi=new Map,Js=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=Js);p0=!1,js=null,m0=null,ex="ccc:debug:stat-mult",tx="ccc:actionLog",bm=100,nx=e=>`ccc:warp:charges:${e}`,ox=24;gm="ccc:xp",Ei={unlock:e=>`${gm}:unlocked:${e}`,level:e=>`${gm}:level:${e}`,progress:e=>`${gm}:progress:${e}`},ym="ccc:mutation",xi={unlock:e=>`${ym}:unlocked:${e}`,level:e=>`${ym}:level:${e}`,progress:e=>`${ym}:progress:${e}`},Gu=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];h0=!1;Al();k0();document.addEventListener("keydown",e=>{if(!(!_i||kl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&v()!=null){if(e.shiftKey){Li?(Sx(),No()):wm(),e.preventDefault();return}Li?No({preserveExpansionState:!0}):wm(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Wu()});window.addEventListener("menu:visibilitychange",cx);window.addEventListener("saveSlot:change",()=>{Wu(),Li&&D0()})});var X0={};bt(X0,{addExternalMutationGainMultiplierProvider:()=>ii,addMutationPower:()=>Ss,broadcastMutationChange:()=>Am,computeMutationMultiplierForLevel:()=>Os,computeMutationRequirementForLevel:()=>Tm,getMutationCoinSprite:()=>Yp,getMutationGainMultiplier:()=>Ku,getMutationMultiplier:()=>zu,getMutationState:()=>ut,getTotalCumulativeMp:()=>gl,initMutationSystem:()=>jt,isMutationUnlocked:()=>Ao,onMutationChange:()=>bi,setMutationUnlockedForDebug:()=>Ml,unlockMutationSystem:()=>Or});function ju(e){try{return e?.toStorage?.()}catch{return null}}function Ri(){try{Jt()}catch{}}function H0(e){let t=e;if(!t.isZero?.()){let n=Ni.size>0?Array.from(Ni):typeof Rl=="function"?[Rl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:U.level.clone?.()??U.level,mutationUnlocked:U.unlocked});r instanceof ze?t=r.clone?.()??r:r!=null&&(t=ze.fromAny(r))}catch{}}return t}function Qx(){if(typeof Nm=="function"){try{Nm()}catch{}Nm=null}if(typeof Rm=="function"){try{Rm()}catch{}Rm=null}}function Ol(e){if(e instanceof ze)try{return e.clone?.()??ze.fromAny(e)}catch{return pt()}try{return ze.fromAny(e??0)}catch{return pt()}}function eL(e){if(!e||typeof e!="object")return pt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?ze.fromInt(100):ze.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function Ju(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ae(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function $m(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let d=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(d+=Jx*(p-1),!Number.isFinite(d)))return Number.POSITIVE_INFINITY}let f=u*d;return Number.isFinite(f)?f:Number.POSITIVE_INFINITY}let n=Ju(e);if(!Number.isFinite(n))return ze.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return ze.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),d=Math.pow(l/u,1/a),f=o-9;r=u*Math.pow(d,f)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return ze.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return ze.fromAny("Infinity");let i=Me(r);return eL(i)}function $r(){let e=U.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");U.requirement=o.clone?.()??o,U.progress=o.clone?.()??o}catch{(!U.requirement||typeof U.requirement!="object")&&(U.requirement=c.fromInt(0)),(!U.progress||typeof U.progress!="object")&&(U.progress=c.fromInt(0))}return}let n=$m(U.level);U.requirement=n}function tL(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=Ae(e),l=Ae(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Fm(){return On.container&&On.container.isConnected?!0:(On.container=document.querySelector("[data-mp-hud].mp-counter"),On.container?(On.bar=On.container.querySelector(".mp-bar"),On.fill=On.container.querySelector(".mp-bar__fill"),On.levelValue=On.container.querySelector(".mp-level-value"),On.progress=On.container.querySelector("[data-mp-progress]"),!0):!1)}function Ai(e){try{return ne(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function rr(){if(!Fm())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=On;if(!e)return;if(!U.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Ai(U.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Ai(U.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}qi();return}e.removeAttribute("hidden");let i=U.requirement,s=tL(U.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Ai(U.level)),r){let a=Ai(U.progress),u=Ai(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Ai(U.progress).replace(/<[^>]*>/g,""),u=Ai(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}qi()}function ir(e="update",t={}){let n=ut(),o={...n,slot:U.slot??v(),changeType:e,...t};if(Bm.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function qm(){let e=U.slot;if(e==null&&(e=v(),e!=null&&(U.slot=e)),e==null)return;try{localStorage.setItem(Tl(e),U.unlocked?"1":"0")}catch{}try{localStorage.setItem(Ti(e),U.level.toStorage())}catch{}try{localStorage.setItem(ea(e),U.progress.toStorage())}catch{}it(Tl(e)),it(Ti(e)),it(ea(e));let t=(()=>{let u=U.unlocked,d=U.level,f=U.progress;try{u=localStorage.getItem(Tl(e))==="1"}catch{}try{let p=localStorage.getItem(Ti(e));p&&(d=ze.fromAny(p))}catch{}try{let p=localStorage.getItem(ea(e));p&&(f=ze.fromAny(p))}catch{}return{unlocked:u,level:d,progress:f}})(),n=ju(t.level),o=ju(t.progress),r=ju(U.level),i=ju(U.progress),s=t.unlocked!==U.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&Zu(t,{skipPersist:!0})}function Um(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function nL(){if(!U.unlocked)return;let e=U.slot??v();if(e!=null&&Um(Ti(e))){$r();return}$r();let t=U.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;U.progress.cmp?.(t)>=0&&n<o;){if(U.progress=U.progress.sub(t),U.level=U.level.add(ta()),$r(),t=U.requirement,!t||typeof t!="object"){U.progress=pt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(U.progress=pt())}function Zu(e,{skipPersist:t=!1}={}){U.unlocked=!!e.unlocked,U.level=Ol(e.level),U.progress=Ol(e.progress),U.unlocked||(U.level=pt(),U.progress=pt()),$r(),t||qm(),rr(),ir("load"),Ri()}function Om(e){let t=e??v();if(t==null){Zu({unlocked:!1,level:pt(),progress:pt()},{skipPersist:!0}),U.slot=null;return}let n=!1,o=pt(),r=pt();try{n=localStorage.getItem(Tl(t))==="1"}catch{}try{let i=localStorage.getItem(Ti(t));i&&(o=ze.fromAny(i))}catch{}try{let i=localStorage.getItem(ea(t));i&&(r=ze.fromAny(i))}catch{}Zu({unlocked:n,level:o,progress:r},{skipPersist:!0}),U.slot=t}function oL(){for(;Nl.length;){let e=Nl.pop();try{e?.()}catch{}}}function Pm(e){q0!==e&&(oL(),q0=e,e!=null&&(Nl.push(Ct(Tl(e),{onChange(t){let n=t==="1";U.unlocked!==n&&(U.unlocked=n,n||(U.level=pt(),U.progress=pt()),$r(),rr(),ir("storage"),Ri())}})),Nl.push(Ct(Ti(e),{onChange(t){if(t)try{let n=ze.fromAny(t);U.level.cmp?.(n)!==0&&(U.level=n,$r(),rr(),ir("storage"),Ri())}catch{}}})),Nl.push(Ct(ea(e),{onChange(t){if(t)try{let n=ze.fromAny(t);U.progress.cmp?.(n)!==0&&(U.progress=n,$r(),rr(),ir("storage"))}catch{}}}))))}function jt({forceReload:e=!1}={}){if(Qx(),G0){let n=v();return(n!==U.slot||e)&&Om(n),Pm(n),Fm(),rr(),ut()}G0=!0,Fm();let t=v();return U.slot=t,Om(t),Pm(t),rr(),Ri(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=v();U.slot=n,Om(n),Pm(n),rr(),Ri(),ir("slot")}),ut()}function ut(){return{unlocked:U.unlocked,level:Ol(U.level),progress:Ol(U.progress),requirement:Ol(U.requirement)}}function Ao(){return!!U.unlocked}function Or(){return jt(),U.unlocked?!1:(U.unlocked=!0,$r(),qm(),rr(),ir("unlock"),Ri(),!0)}function Ml(e){jt();let t=!!e;Zu({unlocked:t,level:t?U.level:pt(),progress:t?U.progress:pt()})}function Ss(e){jt();let t=U.slot??v();if(t!=null&&Um(ea(t))||!U.unlocked)return ut();let n=t!=null&&Um(Ti(t));if(U.level&&U.level.isInfinite?.()){let d=U.level.clone?.()??U.level,f=U.progress.clone?.()??U.progress;if(!U.progress?.isInfinite?.())try{U.progress=ze.fromAny("Infinity")}catch{}if(!U.requirement?.isInfinite?.())try{U.requirement=ze.fromAny("Infinity")}catch{}let p;try{p=e instanceof ze?e:ze.fromAny(e??0)}catch{p=pt()}return p=H0(p),p=Hn("mutation",p),ir("progress",{delta:p.clone?.()??p,levelsGained:pt(),level:U.level.clone?.()??U.level,progress:U.progress.clone?.()??U.progress,requirement:U.requirement.clone?.()??U.requirement,previousLevel:d.clone?.()??d,previousProgress:f.clone?.()??f})}let o;try{o=e instanceof ze?e:ze.fromAny(e??0)}catch{o=pt()}if(o=H0(o),o=Hn("mutation",o),o.isZero?.())return ut();let r=o.clone?.()??o,i=U.level.clone?.()??U.level,s=U.progress.clone?.()??U.progress;if(U.progress=U.progress.add(r),U.progress.isInfinite?.()){if(!n)try{U.level=ze.fromAny("Infinity")}catch{}try{U.progress=ze.fromAny("Infinity")}catch{U.progress=pt()}try{U.requirement=ze.fromAny("Infinity")}catch{}}else nL();qm(),rr();let a=U.level.sub(i);return a.isZero?.()||Ri(),ir("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:U.level.clone?.()??U.level,progress:U.progress.clone?.()??U.progress,requirement:U.requirement.clone?.()??U.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Am(e={}){jt();let t=e.changeType??"manual";return ir(t,e)}function Os(e){let t;if(e instanceof ze)try{t=e.clone?.()??e}catch{t=pt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=pt()}else try{t=c.fromAny(e??0)}catch{t=pt()}if(t&&t.isInfinite?.())try{return ze.fromAny("Infinity")}catch{return ta()}let n=Ju(t);if(!Number.isFinite(n))try{return ze.fromAny("Infinity")}catch{return ta()}if(n<=0)return ta();let o=n*Zx;return Me(o)}function Tm(e){let t;try{t=e instanceof ze?e:ze.fromAny(e??0)}catch{t=pt()}try{return $m(t)}catch{return pt()}}function zu(){if(jt(),!U.unlocked)return ta();try{return Os(U.level)}catch{return ta()}}function Ku(){let e=c.fromInt(1);if(Ni.size>0||Rl){let t=Ni.size>0?Array.from(Ni):typeof Rl=="function"?[Rl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:U.level.clone?.()??U.level,mutationUnlocked:U.unlocked});o instanceof ze?e=o.clone?.()??o:o!=null&&(e=ze.fromAny(o))}catch{}}return e}function Yp(){if(!U.unlocked||U.level.isZero?.())return"img/currencies/coin/coin.webp";let e=Ju(U.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function bi(e){return typeof e!="function"?()=>{}:(Bm.add(e),()=>{Bm.delete(e)})}function ii(e){return typeof e!="function"?()=>{}:(Ni.add(e),()=>{Ni.delete(e)})}function gl(){if(jt(),!U.unlocked)return pt();if(U.level.isInfinite?.()||U.progress.isInfinite?.())return c.fromAny("Infinity");let e=Ju(U.level);if(Number.isFinite(e)&&e>100)return U.progress.clone?.()??U.progress;let t=U.progress.clone?.()??U.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=$m(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Dm,Tl,Ti,ea,ze,pt,ta,Zx,Jx,U,On,Bm,Nl,q0,G0,Nm,Rm,Ni,Rl,_o=Ue(()=>{It();St();zi();Kt();It();Nf();Gn();Dm="ccc:mutation",Tl=e=>`${Dm}:unlocked:${e}`,Ti=e=>`${Dm}:level:${e}`,ea=e=>`${Dm}:progress:${e}`,ze=c,pt=()=>ze.fromInt(0),ta=()=>ze.fromInt(1),Zx=Math.log10(2),Jx=9/(Math.pow(1.12,50)-1);U={unlocked:!1,level:pt(),progress:pt(),requirement:pt(),slot:null},On={container:null,bar:null,fill:null,levelValue:null,progress:null},Bm=new Set,Nl=[],q0=null,G0=!1,Nm=null,Rm=null,Ni=new Set,Rl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:jt,unlockMutationSystem:Or,addMutationPower:Ss,getMutationState:ut,getMutationMultiplier:zu,isMutationUnlocked:Ao,getTotalCumulativeMp:gl,addExternalMutationGainMultiplierProvider:ii,getMutationGainMultiplier:Ku}))});var Pl,V0,Y0,Gm,Hm,Xm,W0=Ue(()=>{Pl=`attribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,V0='precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform vec3 uColorDeep; uniform vec3 uColorShallow; void main() { /* Wave animation settings */ float speed = 1.2; float time = uTime * speed; /* Combine sine waves for a more natural look */ /* vUv.x is 0..1 across the screen width */ float wave1 = sin(vUv.x * 8.0 - time) * 0.0285; float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; /* Define the shoreline height (baseline) */ /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */ /* We want to discard pixels below this threshold */ float threshold = 0.428 + wave; if (vUv.y < threshold) { discard; } /* Recalculate gradient based on the new "bottom" */ /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */ float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0); vec3 col = mix(uColorShallow, uColorDeep, gradientY); /* Add a subtle "foam" or highlight at the edge */ float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold); col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4); gl_FragColor = vec4(col, 1.0); }',Y0="precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform sampler2D uWaveMap; uniform vec3 uColorDeep; uniform vec3 uColorShallow; uniform vec3 uColorWaveDeep; uniform vec3 uColorWave; /* Simple noise for foam breakup */ float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); } float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f*f*(3.0-2.0*f); return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x), mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y); } void main() { vec2 uv = vUv; /* Sample the simulation (physics) */ /* Wave Logic */ vec2 waveUV = uv - vec2(0.0, 0.0285); float intensity = texture2D(uWaveMap, waveUV).r; /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */ float shadowOffset = 8.0 / uResolution.y; float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r; /* Discard only if BOTH are empty */ if (intensity < 0.01 && shadowIntensity < 0.01) discard; /* Directional Noise: Streaky vertical noise for rushing water effect */ /* Stretch heavily along Y-axis to simulate speed/motion blur */ float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0)); /* Define Zones based on Intensity */ /* Body (Medium Intensity): Darker/turbulent blue with noise */ /* Edge (High Intensity): Bright white foam */ float foamThreshold = 0.5; float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity); /* Base Colors */ vec3 bodyColor = uColorWaveDeep; vec3 foamColor = uColorWave; /* Mix Colors */ vec3 finalColor = mix(bodyColor, foamColor, foamMix); /* Add streaks to the body part */ if (foamMix < 0.9) { finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix); } /* Hard Edge & Opacity */ /* Ensure the front (bottom) remains sharp, back trails off */ /* Calculate Alpha based on Intensity */ /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */ /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */ /* Low Intensity (Top/Tail): Fades to 0.0 */ float finalAlpha = smoothstep(0.02, 0.15, intensity); /* Screen Fade */ /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */ /* Dynamic Shoreline Fade */ /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */ /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */ float speed = 1.2; float time = uTime * speed; float wave1 = sin(uv.x * 8.0 - time) * 0.0285; float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; float threshold = 0.428 + wave; /* Fade out quickly after exiting the water body (below threshold) */ /* Fade starts slightly higher than the threshold to soften the transition */ /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */ float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y); float screenFade = shoreFade; /* --- Composite Shadow & Wave --- */ float waveAlpha = finalAlpha * screenFade; /* Shadow Alpha */ float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity); /* Shadow is weaker (40% opacity) */ float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade; /* Mix: Wave over Shadow */ /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */ float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha); /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */ /* Shadow is black (RGB=0), so second term is 0 */ vec3 outRGB = finalColor * waveAlpha; gl_FragColor = vec4(outRGB, outAlpha); }",Gm=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,Hm=`precision mediump float;\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Xm=`precision mediump float;\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var j0={};bt(j0,{WaterSystem:()=>Qu,waterSystem:()=>ef});function K0(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function na(e,t,n){let o=K0(e,e.VERTEX_SHADER,t),r=K0(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var rL,z0,iL,sL,Qu,ef,Vm=Ue(()=>{W0();rL=[.2,.5,.9],z0=[.2,.9,1],iL=[1,1,1],sL=[.45,.8,1];Qu=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:na(s,Pl,Y0),simProgram:na(s,Pl,Xm),brushProgram:na(s,Gm,Hm),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=na(this.glBg,Pl,V0),this.bgSimProgram=na(this.glBg,Pl,Xm),this.bgBrushProgram=na(this.glBg,Gm,Hm)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,d=-(s/this.height*2-1),f=l/this.width,p=a/this.height,h=new Float32Array([u-f,d-p,0,0,1,u+f,d-p,1,0,1,u-f,d+p,0,1,1,u+f,d+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,h,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),y=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(y),t.vertexAttribPointer(y,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let d=r;for(;d>0;){let f=Math.min(d,s);l.push(f),d-=f}}l.forEach(d=>{let f=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,d);this.bgReadFBO=f.readFBO,this.bgWriteFBO=f.writeFBO,this.bgReadTexture=f.readTex,this.bgWriteTexture=f.writeTex}),this.fgLayers.forEach(d=>{l.forEach(f=>{let p=this.runSimStep(d.gl,d.simProgram,d.quadBuffer,d.readFBO,d.writeFBO,d.readTexture,d.writeTexture,f);d.readFBO=p.readFBO,d.writeFBO=p.writeFBO,d.readTexture=p.readTex,d.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),rL),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),z0),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(d=>{let f=d.gl;f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,d.canvas.width,d.canvas.height),f.useProgram(d.program),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,d.readTexture),f.uniform1i(f.getUniformLocation(d.program,"uWaveMap"),0),f.uniform3fv(f.getUniformLocation(d.program,"uColorShallow"),z0),f.uniform3fv(f.getUniformLocation(d.program,"uColorWave"),iL),f.uniform3fv(f.getUniformLocation(d.program,"uColorWaveDeep"),sL),f.uniform1f(f.getUniformLocation(d.program,"uTime"),o),f.uniform2f(f.getUniformLocation(d.program,"uResolution"),d.canvas.width,d.canvas.height),f.bindBuffer(f.ARRAY_BUFFER,d.quadBuffer);let p=f.getAttribLocation(d.program,"position");f.enableVertexAttribArray(p),f.vertexAttribPointer(p,2,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLE_STRIP,0,4)})}},ef=new Qu});var nb={};bt(nb,{createSpawner:()=>mL});function tb(e){if(!e||typeof e!="object"){oa=!1,Oi=0n;return}oa=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Oi=n&&n!=="Infinity"?BigInt(n):0n}catch{Oi=0n}}function lL(e){let t=1-e;return 1-t*t*t}function uL(e){if(!e)return null;let t=Z0.get(e);return t||(t=new Image,t.src=e,Z0.set(e,t)),t}function mL({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:d=Ze?aL:1e4,initialBurst:f=1,coinTtlMs:p=1e99,waveSoundSrc:h="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:y=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:b=!1}={}){let E=o,x={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function R(){return!!(x.pf&&x.w&&x.c)}R()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let T=7,F=[],D=[],G=!1;if(x.c)for(let S=0;S<T;S++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+S*10}`,x.c.appendChild(k);let P=k.getContext("2d",{alpha:!0});F.push(k),D.push(P)}let _=null,B=null;x.c&&(_=document.createElement("canvas"),_.style.position="absolute",_.style.inset="0",_.style.pointerEvents="none",_.style.zIndex="100",x.c.appendChild(_),B=_.getContext("2d",{alpha:!0}));let M={collectBatch:null,getMagnetUnit:null};function L(S){M={...M,...S}}let X={pfRect:null,wRect:null,safeBottom:0,pfW:0};function J(){if(!R())return!1;let S=x.pf.getBoundingClientRect(),k=x.w.getBoundingClientRect(),P=x.hud?x.hud.getBoundingClientRect().height:0;X={pfRect:S,wRect:k,safeBottom:S.height-P,pfW:S.width};let A=window.devicePixelRatio||1;return F.forEach((N,pe)=>{if(N){N.width=S.width*A,N.height=S.height*A,N.style.width=S.width+"px",N.style.height=S.height+"px";let de=D[pe];de&&(de.setTransform(1,0,0,1,0,0),de.scale(A,A),de.imageSmoothingEnabled=!0,de.imageSmoothingQuality="high")}}),G=!0,_&&(_.width=S.width*A,_.height=S.height*A,_.style.width=S.width+"px",_.style.height=S.height+"px",B&&(B.setTransform(1,0,0,1,0,0),B.scale(A,A))),!0}J();let fe="ResizeObserver"in window?new ResizeObserver(()=>J()):null;fe&&x.pf&&fe.observe(x.pf),document.addEventListener("visibilitychange",()=>{document.hidden||J()});let K=(S,k,P)=>Math.max(k,Math.min(P,S)),Q=Math.max(2e3,d*3),ve=12,he=[],V=[],ee=0,$=[];function q(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=E,k.style.objectFit="contain",k.style.borderRadius="50%",S.appendChild(k),b&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let j=()=>he.length?he.pop():q();function le(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let k=0;k<=6;k++)S.classList.remove(`coin--size-${k}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),he.length<Q&&he.push(S)}function ue(S,k=-1){if(S.isRemoved)return;S.isRemoved=!0;let P=k;(P===-1||V[P]!==S)&&(S.index!==void 0&&V[S.index]===S?P=S.index:P=V.indexOf(S)),P!==-1&&(V[P]=null,ee++),S.el?(le(S.el),S.el=null):G=!0}function C(S){let k=S._coinObj;if(k){let P=-1;k.index!==void 0&&V[k.index]===k?P=k.index:P=V.indexOf(k),P!==-1&&(V[P]=null,ee++),S._coinObj=null}}let W=new URL(h,document.baseURI).href,ce=0;function me(){let S=performance.now();if(S-ce<g)return;ce=S,dt(W,{volume:Ze?y:m,type:"music"})}function Z(){if(!R())return null;if((!X.pfRect||!X.wRect)&&J(),d!==1/0&&V.length-ee>=d){let Lt=-1;if(mt(2))for(let Rt=0;Rt<V.length;Rt++){let bo=V[Rt];if(bo&&bo.sizeIndex<4){Lt=Rt;break}}else for(let Rt=0;Rt<V.length;Rt++)if(V[Rt]){Lt=Rt;break}if(Lt===-1)return null;let Nt=V[Lt];Nt&&ue(Nt,Lt)}let S=X.pfW,k=X.wRect.top-X.pfRect.top,P=Math.max(0,k),A=0;if(mt(2)){let Lt=Math.random();for(let Nt=6;Nt>=1;Nt--)if(Lt<dL[Nt]){A=Nt;break}}A>=4&&dl&&dl()&&(A=3);let N=J0[A],pe=ve+(A>=3?15*(A-2):0),de=pe,Te=Math.max(de,S-N-pe),Pe=de+Math.random()*(Te-de),Be=Math.random()*100-50,Ne;if(N>=X.pfW)Ne=(X.pfW-N)/2;else{let Lt=X.pfW-N-pe;de>=Lt?Ne=(X.pfW-N)/2:Ne=K(Pe+Be,de,Lt)}let qe=Math.min(X.wRect.height,X.pfRect.height*.3),ke=Math.max(qe+80,120),Ye=Math.max(ke+40,X.safeBottom-N-6),xe=K(ke+Math.random()*(Ye-ke),ke,Ye),Xe={x0:Pe,y0:P,x1:Ne,y1:xe,jitterMs:0},ot=X.pfRect.left-X.wRect.left,He=pL[A],Tt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),rt=.85+Math.random()*.3,vt=Tt*(He.w/100)*rt,Gt=Tt*(He.h/100)*rt,Ht=Pe+N/2+ot,Pn=P-k;return{wave:{x:Ht,y:Pn,width:vt,height:Gt},coin:Xe,sizeIndex:A}}function re(S){if(!S.length||!R())return;let k=document.createDocumentFragment(),P=[],A=performance.now(),N=!1;for(let{wave:pe,coin:de,sizeIndex:Te}of S){if(pe&&(N=!0,ef)){let Ye=Te>=4;ef.addWave(pe.x,pe.y,pe.width,pe.height,Ye)}let Pe=J0[Te],Be=1;if(mt(8)){let Ye=Yt(),xe=Math.pow(25,Ye);Be=Math.pow(xe,Te)}else Be=fL[Te];let Ne=Te>=4,qe=j();qe.style.width=`${Pe}px`,qe.style.height=`${Pe}px`,qe.className=`coin coin--size-${Te}`,qe.firstChild&&(qe.firstChild.src=E),qe.style.transform=`translate3d(${de.x0}px, ${de.y0}px, 0) rotate(-10deg) scale(0.96)`,qe.style.opacity="0",oa?qe.dataset.mutationLevel=Oi.toString():qe.dataset.mutationLevel="0";let ke={mutationLevel:oa?Oi.toString():"0",el:qe,src:E,x:de.x0,y:de.y0,rot:-10,scale:.96,startX:de.x0,startY:de.y0,endX:de.x1,endY:de.y1,startTime:A+de.jitterMs,duration:i,dieAt:A+p,jitterMs:de.jitterMs,isRemoved:!1,settled:!1,size:Pe,sizeIndex:Te,valueMultiplier:Be,forceDom:Ne,soundSrc:eb[Te]?`sounds/coin_pickup${eb[Te]}`:null,bMinX:Math.min(de.x0,de.x1)-Pe,bMaxX:Math.max(de.x0,de.x1)+Pe,bMinY:Math.min(de.y0,de.y1)-Pe,bMaxY:Math.max(de.y0,de.y1)+Pe};qe._coinObj=ke,ke.index=V.length,V.push(ke),P.push(ke),k.appendChild(qe)}x.c.appendChild(k),P.length>0&&requestAnimationFrame(()=>{for(let pe of P)pe.el&&(pe.el.style.transition=`transform ${i}ms ${cL} ${pe.jitterMs}ms`,pe.el.style.transform=`translate3d(${pe.endX}px, ${pe.endY}px, 0) rotate(0deg) scale(1)`,pe.el.style.opacity="1")}),N&&requestAnimationFrame(()=>{me()})}function ye(S=1){if(!R())return;(!X.pfRect||!X.wRect)&&J();let k=[];for(let P=0;P<S;P++){let A=Z();A&&k.push(A)}k.length&&re(k)}function Le(S,k){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let P=k-S.startTime;if(P<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let A=P/S.duration;if(A>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let N=lL(A),pe=S.startX+(S.endX-S.startX)*N,de=S.startY+(S.endY-S.startY)*N,Te=-10+10*N,Pe=.96+.04*N;return{x:pe,y:de,rot:Te,scale:Pe}}function ie(S,k){let P=uL(k.src);if(P&&P.complete&&P.naturalWidth>0){let A=k.size||r;S.drawImage(P,k.x,k.y,A,A)}}function Ie(){if(D.length){if(G){D.forEach((k,P)=>{F[P]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,F[P].width,F[P].height),k.restore(),b&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let S=V.length;for(let k=0;k<S;k++){let P=V[k];if(P&&P&&P.settled&&!P.isRemoved&&!P.el){let A=P.sizeIndex||0;D[A]&&ie(D[A],P)}}b&&D.forEach(k=>k.restore()),G=!1,$.length=0}else if($.length>0){b&&D.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let k=$[S];if(!k.isRemoved&&k.settled&&!k.el){let P=k.sizeIndex||0;D[P]&&ie(D[P],k)}}b&&D.forEach(S=>S.restore()),$.length=0}}}let Re=a,_e=null,Oe=performance.now(),se=0;function te(S){(!X.pfRect||!X.wRect)&&J();let k=(S-Oe)/1e3;Oe=S,k>.1&&(k=.1);for(let A=V.length-1;A>=0;A--){let N=V[A];if(!N||!N)continue;if(S>=N.dieAt){ue(N,A);continue}if(N.sizeIndex===5&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval)){N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100;for(let Te=0;Te<3;Te++)Oo(N,S)}if(N.sizeIndex===6&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval&&(N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100,M.collectBatch))){let Te=Le(N,S),Pe=Te.x+N.size/2,Be=Te.y+N.size/2,Ne=[],qe=N.size/2*(N.size/2),ke=V.length;for(let Ye=0;Ye<ke;Ye++){let xe=V[Ye];if(!xe||xe===N||xe.isRemoved||xe.settled===!1||xe.sizeIndex>3)continue;let Ke=xe.x+(xe.size||r)/2,Xe=xe.y+(xe.size||r)/2,ot=Ke-Pe,He=Xe-Be;ot*ot+He*He>qe&&Ne.push(xe)}if(Ne.length>0){for(let Xe=Ne.length-1;Xe>0;Xe--){let ot=Math.floor(Math.random()*(Xe+1));[Ne[Xe],Ne[ot]]=[Ne[ot],Ne[Xe]]}let Ye=Ne.slice(0,3),xe=[],Ke=!1;for(let Xe of Ye){let ot=Xe.size||r,He=Xe.x+ot/2,Tt=Xe.y+ot/2;Po(N,He,Tt),ar(He,Tt,ot),xe.push({coin:Xe}),Ke||(dt("sounds/lightning_strike.ogg",{volume:.25}),Ke=!0)}xe.length>0&&M.collectBatch(xe)}}if(N.settled)continue;let pe=S-N.startTime;if(pe<0)continue;if(pe/N.duration>=1){N.settled=!0,N.x=N.endX,N.y=N.endY,N.rot=0,N.scale=1,N.el&&!N.forceDom?(le(N.el),N.el=null,$.push(N)):N.el&&(N.el.style.transition="none",N.el.style.transform=`translate3d(${N.x}px, ${N.y}px, 0) rotate(0deg) scale(1)`);continue}}se+=Re*k;let P=Math.floor(se);if(P>0){se-=P;let A=Math.min(P,u);if(A>0){let N=performance.now(),pe=[],de=5;for(let Te=0;Te<A&&!(performance.now()-N>de);Te++){let Pe=Z();Pe&&pe.push(Pe)}pe.length&&re(pe)}}if(Ie(),ee>50){let A=0;for(let N=0;N<V.length;N++){let pe=V[N];pe!==null&&(pe.index=A,V[A++]=pe)}V.length=A,ee=0}lr(k),_e=requestAnimationFrame(te)}function we(){if(!_e){if(!R()){console.warn("[Spawner] start() called but required nodes are missing.");return}J(),f>0&&_e===null&&ye(f),Oe=performance.now(),_e=requestAnimationFrame(te)}}function w(){_e&&(cancelAnimationFrame(_e),_e=null)}function Y(S){Re=Math.max(0,Number(S)||0)}function z(){se=0,Oe=performance.now()}function oe(S){let k=mt(2)&&!!S;for(let P=V.length-1;P>=0;P--){let A=V[P];if(A&&A){if(k&&A.sizeIndex>=4){A.mutationLevel=oa?Oi.toString():"0",A.el&&(A.el.dataset.mutationLevel=A.mutationLevel);continue}ue(V[P],P)}}z()}function ge(S){S&&(E=S)}function ae(S){let k=S._coinObj;if(!k)return S.style.transform||"translate3d(0,0,0)";let{x:P,y:A,rot:N,scale:pe}=Le(k,performance.now());return`translate3d(${P}px, ${A}px, 0) rotate(${N}deg) scale(${pe})`}function Ge(S){if(S.el)return S.el;if(S.isRemoved)return null;let k=j(),P=S.size||r;return k.style.width=`${P}px`,k.style.height=`${P}px`,k.className=`coin coin--size-${S.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=S.src),k.style.opacity="1",k.dataset.mutationLevel=S.mutationLevel,k._coinObj=S,S.el=k,x.c.appendChild(k),G=!0,k}function nt(S,k,P,A){let N=P;A&&(N=Math.max(P,260));let pe=P*P,de=[],Te=V.length,Pe=S-N,Be=S+N,Ne=k-N,qe=k+N,ke=performance.now();for(let Ye=0;Ye<Te;Ye++){let xe=V[Ye];if(!xe||xe.bMaxX<Pe||xe.bMinX>Be||xe.bMaxY<Ne||xe.bMinY>qe)continue;let Ke=xe.size||r,Xe,ot;if(xe.settled)Xe=xe.x+Ke/2,ot=xe.y+Ke/2;else{let vt=Le(xe,ke);Xe=vt.x+Ke/2,ot=vt.y+Ke/2}if(Xe<Pe||Xe>Be||ot<Ne||ot>qe)continue;let He=Xe-S,Tt=ot-k,rt=pe;if(A&&(xe.sizeIndex||0)>0){let vt=Ke/2;rt=vt*vt}He*He+Tt*Tt<=rt&&(xe.isRemoved||de.push(xe))}return de}function be(S,k,P,A,N,pe){let de=N;pe&&(de=Math.max(N,260));let Te=N*N,Pe=[],Be=V.length,Ne=Math.min(S,P)-de,qe=Math.max(S,P)+de,ke=Math.min(k,A)-de,Ye=Math.max(k,A)+de,xe=P-S,Ke=A-k,Xe=xe*xe+Ke*Ke,ot=Te*Xe,He=performance.now();for(let Tt=0;Tt<Be;Tt++){let rt=V[Tt];if(!rt||rt.bMaxX<Ne||rt.bMinX>qe||rt.bMaxY<ke||rt.bMinY>Ye)continue;let vt=rt.size||r,Gt,Ht;if(rt.settled)Gt=rt.x+vt/2,Ht=rt.y+vt/2;else{let ln=Le(rt,He);Gt=ln.x+vt/2,Ht=ln.y+vt/2}if(Gt<Ne||Gt>qe||Ht<ke||Ht>Ye)continue;let Pn=Gt-S,Lt=Ht-k,Nt=Pn*xe+Lt*Ke,Rt=Te;if(pe&&(rt.sizeIndex||0)>0){let ln=vt/2;Rt=ln*ln}let bo=!1;if(Nt<=0)Pn*Pn+Lt*Lt<=Rt&&(bo=!0);else if(Nt>=Xe){let ln=Gt-P,da=Ht-A;ln*ln+da*da<=Rt&&(bo=!0)}else{let ln=Pn*Ke-Lt*xe;ln*ln<=Rt*Xe&&(bo=!0)}bo&&!rt.isRemoved&&Pe.push(rt)}return Pe}function Fe(S){ue(S)}function qt(S,k,P){let A=P*P,N=[],pe=V.length,de=S-P,Te=S+P,Pe=k-P,Be=k+P,Ne=performance.now();for(let qe=0;qe<pe;qe++){let ke=V[qe];if(!ke||ke.bMaxX<de||ke.bMinX>Te||ke.bMaxY<Pe||ke.bMinY>Be)continue;let Ye=ke.size||r,xe,Ke;if(ke.settled)xe=ke.x+Ye/2,Ke=ke.y+Ye/2;else{let He=Le(ke,Ne);xe=He.x+Ye/2,Ke=He.y+Ye/2}if(xe<de||xe>Te||Ke<Pe||Ke>Be)continue;let Xe=xe-S,ot=Ke-k;Xe*Xe+ot*ot<=A&&(!ke.el&&!ke.isRemoved&&Ge(ke),ke.el&&N.push(ke.el))}return N}function lt(S,k,P,A,N){let pe=N*N,de=[],Te=V.length,Pe=Math.min(S,P)-N,Be=Math.max(S,P)+N,Ne=Math.min(k,A)-N,qe=Math.max(k,A)+N,ke=P-S,Ye=A-k,xe=ke*ke+Ye*Ye,Ke=pe*xe,Xe=performance.now();for(let ot=0;ot<Te;ot++){let He=V[ot];if(!He||He.bMaxX<Pe||He.bMinX>Be||He.bMaxY<Ne||He.bMinY>qe)continue;let Tt=He.size||r,rt,vt;if(He.settled)rt=He.x+Tt/2,vt=He.y+Tt/2;else{let Nt=Le(He,Xe);rt=Nt.x+Tt/2,vt=Nt.y+Tt/2}if(rt<Pe||rt>Be||vt<Ne||vt>qe)continue;let Gt=rt-S,Ht=vt-k,Pn=Gt*ke+Ht*Ye,Lt=!1;if(Pn<=0)Gt*Gt+Ht*Ht<=pe&&(Lt=!0);else if(Pn>=xe){let Nt=rt-P,Rt=vt-A;Nt*Nt+Rt*Rt<=pe&&(Lt=!0)}else{let Nt=Gt*Ye-Ht*ke;Nt*Nt<=Ke&&(Lt=!0)}Lt&&(!He.el&&!He.isRemoved&&Ge(He),He.el&&de.push(He.el))}return de}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;_e||we()}});function an(){R()&&ye(1)}let At=[],bn=[];function vo(S,k){if(!S||!k)return;let P=S.size||r,A=k.size||r,N=S.x+P/2,pe=S.y+P/2,de=k.x+A/2,Te=k.y+A/2;At.push({x1:N,y1:pe,x2:de,y2:Te,age:0,life:.15})}function ar(S,k,P){if(!x.pf)return;let A=document.createElement("div");A.className="coin-stain";let N=P*1.2;A.style.width=`${N}px`,A.style.height=`${N}px`,A.style.left=`${S-N/2}px`,A.style.top=`${k-N/2}px`,x.pf.appendChild(A),setTimeout(()=>{A.style.opacity="0",setTimeout(()=>{A.parentNode&&A.remove()},1e3)},2500)}function Oo(S,k){let P=Math.random()*Math.PI*2,A=(S.size||r)/2,N=A*Q0,pe=Math.cos(P)*N,de=Math.sin(P)*N,Te=A*(.7+Math.random()*.6),Pe=Math.cos(P)*(N+Te),Be=Math.sin(P)*(N+Te);At.push({parentCoin:S,relX1:pe,relY1:de,relX2:Pe,relY2:Be,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let Ne=3+Math.floor(Math.random()*3);for(let qe=0;qe<Ne;qe++){let ke=.3+Math.random()*.5,Ye=pe+(Pe-pe)*ke,xe=de+(Be-de)*ke,Ke=P+(Math.random()*1.2-.6),Xe=Te*(.4+Math.random()*.4),ot=Ye+Math.cos(Ke)*Xe,He=xe+Math.sin(Ke)*Xe;At.push({parentCoin:S,relX1:Ye,relY1:xe,relX2:ot,relY2:He,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}dt("sounds/lightning_zap.ogg",{volume:.25})}function Po(S,k,P){if(!S)return;let A=S.size||r,N=performance.now(),pe=Le(S,N),de=pe.x+A/2,Te=pe.y+A/2,Pe=k-de,Be=P-Te,Ne=Math.atan2(Be,Pe),qe=Math.sqrt(Pe*Pe+Be*Be),ke=A/2*Q0,Ye=Math.cos(Ne)*ke,xe=Math.sin(Ne)*ke;At.push({parentCoin:S,relX1:Ye,relY1:xe,x2:k,y2:P,age:0,life:.25,width:6,jaggedScale:25});let Ke=de+Ye,Xe=Te+xe,ot=6+Math.floor(Math.random()*5);for(let He=0;He<ot;He++){let Tt=.1+Math.random()*.8,rt=Ke+(k-Ke)*Tt,vt=Xe+(P-Xe)*Tt,Gt=Ne+(Math.random()*1.6-.8),Ht=qe*(.1+Math.random()*.3),Pn=rt+Math.cos(Gt)*Ht,Lt=vt+Math.sin(Gt)*Ht;if(At.push({x1:rt,y1:vt,x2:Pn,y2:Lt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Rt=rt+(Pn-rt)*.5,bo=vt+(Lt-vt)*.5,ln=Gt+(Math.random()*1-.5),da=Ht*.5;At.push({x1:Rt,y1:bo,x2:Rt+Math.cos(ln)*da,y2:bo+Math.sin(ln)*da,age:0,life:.25,width:1.5,jaggedScale:10})}}}function lr(S){if(!B||!_)return;B.clearRect(0,0,_.width,_.height);let k=performance.now();B.lineCap="round",B.lineJoin="round";for(let P=At.length-1;P>=0;P--){let A=At[P];if(A.age+=S,A.age>=A.life){At.splice(P,1);continue}let N=A.x1,pe=A.y1,de=A.x2,Te=A.y2;if(A.parentCoin){let Ne=Le(A.parentCoin,k),qe=Ne.x+(A.parentCoin.size||r)/2,ke=Ne.y+(A.parentCoin.size||r)/2;N=qe+A.relX1,pe=ke+A.relY1,A.relX2!==void 0&&(de=qe+A.relX2,Te=ke+A.relY2)}let Pe=1-A.age/A.life;B.strokeStyle=`rgba(200, 240, 255, ${Pe})`,B.lineWidth=A.width||3,B.shadowColor="rgba(220, 245, 255, 0.9)",B.shadowBlur=20;let Be=6;B.beginPath(),B.moveTo(N,pe);for(let Ne=1;Ne<=Be;Ne++){let qe=Ne/Be,ke=N+(de-N)*qe,Ye=pe+(Te-pe)*qe;if(Ne===Be)B.lineTo(de,Te);else{let xe=-(Te-pe),Ke=de-N,Xe=Math.sqrt(xe*xe+Ke*Ke),ot=A.jaggedScale||40;if(Xe>0){let He=(Math.random()-.5)*ot*(1-Math.abs(qe-.5));B.lineTo(ke+xe/Xe*He,Ye+Ke/Xe*He)}else B.lineTo(ke,Ye)}}B.stroke(),B.shadowBlur=0}for(let P=bn.length-1;P>=0;P--){let A=bn[P];if(A.age+=S,A.age>=A.life){bn.splice(P,1);continue}A.x+=A.vx*S,A.y+=A.vy*S;let N=1-A.age/A.life;B.fillStyle=A.color,B.globalAlpha=N,B.beginPath(),B.arc(A.x,A.y,A.size,0,Math.PI*2),B.fill(),B.globalAlpha=1}}return{start:we,stop:w,setRate:Y,clearBacklog:z,clearPlayfield:oe,setCoinSprite:ge,getCoinTransform:ae,findCoinsInRadius:qt,findCoinsInPath:lt,findCoinTargetsInRadius:nt,findCoinTargetsInPath:be,ensureCoinVisual:Ge,removeCoinTarget:Fe,detachCoin:C,recycleCoin:le,playEntranceWave:an,setDependencies:L,hasBigCoins:()=>mt(2)&&V.some(S=>S&&S.sizeIndex>=4)}}var oa,Oi,aL,Z0,cL,J0,Q0,fL,dL,eb,pL,ob=Ue(()=>{Ql();_o();Lo();io();Bn();Vm();xo();oa=!1,Oi=0n,aL=2500,Z0=new Map;try{tb(ut())}catch{oa=!1,Oi=0n}try{bi(e=>{tb(e)})}catch{}cL="cubic-bezier(0.215, 0.61, 0.355, 1)";J0=[40,55,80,125,200,320,512],Q0=.78,fL=[1,25,625,15625,390625,9765625,244140625],dL=[0,.1,.01,.001,1e-4,1e-5,1e-6],eb=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],pL=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var fb={};bt(fb,{afterSlotWrite:()=>jm,beforeSlotWrite:()=>Km});function lb(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function vL(e,t=gL){!e||e<=0||Bl.set(e,lb()+t)}function ib(e){if(!e||e<=0)return!1;let t=Bl.get(e);return t==null?!1:t<=lb()?(Bl.delete(e),!1):!0}function bL(){Bl.clear()}function nf(){try{return typeof localStorage<"u"}catch{return!1}}function zm(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function cb(e){let t=new Map;if(!nf())return Fl.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Di))continue;let r=zm(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return Fl.set(e,t),t}function ub(e){return!Number.isFinite(e)||e<=0?null:Fl.has(e)?Fl.get(e):cb(e)}function Km(e){if(!nf()||tf>0)return;let t=String(e);if(!t.startsWith(Di))return;let n=zm(t);if(n==null)return;let o=ub(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(tf===0){tf+=1;try{Sn(n)}finally{tf-=1}}cb(n);return}}}catch{}}function jm(e,t){let n=String(e);if(!n.startsWith(Di))return;let o=zm(n);if(o==null)return;let r=ub(o)||new Map;r.set(n,String(t??"")),Fl.set(o,r)}function SL(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function IL(){let e=new Map;if(!nf())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Di))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=Lf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function wL(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=v();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function EL(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=_f(e);if(n.length===0){o&&(ib(e)||Sn(e),zl(e,null));return}let r=SL(n);o&&r!==o&&!ib(e)&&Sn(e),r!==o&&zl(e,r)}function ia(){if(!nf())return;let e=IL();wL(e).forEach(n=>{let o=e.get(n)??[];EL(n,o)})}function xL(){if(Ym!=null)return;Ym=(typeof window<"u"?window:globalThis).setTimeout(()=>{Ym=null,ia()},yL)}function LL(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){vL(o),xL();return}Bl.delete(o),ia()}}function _L(){typeof window>"u"||rb==null&&(rb=window.setInterval(ia,hL))}function CL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function ra(){let e=CL();if(!e)return;if(!$i()){(e.dataset.poopShopApplied===Wm||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==sb||e.dataset.poopShopApplied!==Wm)&&(e.style.backgroundImage=sb,e.dataset.poopShopApplied=Wm)}function ML(){typeof window>"u"||ab==null&&(ra(),ab=window.setInterval(ra,50),window.addEventListener("saveSlot:change",ra),window.addEventListener("saveSlot:modified",e=>{try{let t=v();e?.detail?.slot===t&&ra()}catch{ra()}}))}function kL(){typeof window>"u"||(ia(),_L(),ML(),window.addEventListener("saveSlot:change",()=>ia()),window.addEventListener("saveIntegrity:storageMutation",LL,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(bL(),ia(),ra())}))}var hL,gL,yL,rb,Ym,Bl,Fl,tf,sb,Wm,ab,Zm=Ue(()=>{St();hL=1e4,gL=750,yL=50,rb=null,Ym=null,Bl=new Map;Fl=new Map,tf=0;sb="linear-gradient(180deg,#a9793d,#7b5534)",Wm="1",ab=null;kL()});var Ib={};bt(Ib,{initPopups:()=>OL,teardownpopups:()=>PL});function Jm(){return yo||(yo=document.createElement("div"),yo.className="currency-popups",yo.setAttribute("aria-live","polite"),yo.setAttribute("aria-atomic","false"),document.body.appendChild(yo),yo)}function Pi(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function Qm(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function pb(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):ne(n);t&&(t.innerHTML=r)}function TL(e,t=mb){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Ul.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function NL(e,t,n){Jm();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function eh(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=v();if(o!=null){if(["xp"].includes(e)){if(Vt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(Vt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Ce).includes(e)&&Fn(e,o))return}let r=AL[e],i=Object.assign({duration:mb,accumulate:!0},r||{},n);if(!i.icon)return;let s=Pi(t);if(!s||Qm(s))return;let l=i.accumulate!==!1?Ul.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,pb(l);return}let a=NL(e,i,s);a.meta=i,pb(a),Ul.set(e,a);let u=Jm(),d=db.indexOf(e),f=null;if(d>=0){let p=Array.from(u.children);for(let h of p){let m=h.dataset.type;if(db.indexOf(m)>d){f=h;break}}}f?u.insertBefore(a.element,f):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),TL(a,i.duration)}function RL(){let e={};for(let t of Object.values(Ce))e[t]=va(t);return e}function hb(){try{let e=RL();Object.entries(e).forEach(([t,n])=>{let o=Pi(n)||c.fromInt(0);qr.set(t,o.clone?.()??o)}),qr.has("mp")||qr.set("mp",c.fromInt(0))}catch{qr.clear()}}function gb(){Ul.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Ul.clear()}function yb(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Pi(t.value)||c.fromInt(0),r=qr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Pi(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&eh(n,s),qr.set(n,o.clone?.()??o)}function vb(e){let t=e?.detail;if(!t)return;let n=Pi(t.xpAdded);n&&!Qm(n)&&eh("xp",n)}function bb(e){let t=e?.detail;if(!t)return;let n=Pi(t.delta);n&&!Qm(n)&&eh("mp",n);let o=Pi(t.progress);o&&qr.set("mp",o.clone?.()??o)}function Sb(){gb(),hb()}function OL(){of||(of=!0,Jm(),hb(),window.addEventListener("currency:change",yb),window.addEventListener("xp:change",vb),window.addEventListener("mutation:change",bb),window.addEventListener("saveSlot:change",Sb))}function PL(){of&&(window.removeEventListener("currency:change",yb),window.removeEventListener("xp:change",vb),window.removeEventListener("mutation:change",bb),window.removeEventListener("saveSlot:change",Sb),gb(),qr.clear(),yo&&yo.remove(),yo=null,of=!1)}var mb,db,AL,yo,of,qr,Ul,wb=Ue(()=>{It();Kt();St();mb=6767,db=["coins","xp","books","gold","mp","magic","gears","dna"],AL={[Ce.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Ce.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Ce.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Ce.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Ce.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Ce.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},yo=null,of=!1,qr=new Map,Ul=new Map});var Ab={};bt(Ab,{flushBackupSnapshot:()=>kb,getSuspendMetadata:()=>JL,installSuspendSafeguards:()=>ZL,markProgressDirty:()=>Ro,restoreFromBackupIfNeeded:()=>jL});function Dl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function ua(){if(typeof localStorage>"u")return!1;try{let e=`${Qn}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function _b(){if(!Dl())throw new Error("IndexedDB unavailable");return sa||(sa=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(BL,FL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(ca)||r.createObjectStore(ca)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}sa=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw sa=null,e}),sa)}function qL(){if(!ua())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(Qn))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function GL(e){try{let t=await _b();return await new Promise((n,o)=>{let r=!1,i=t.transaction(ca,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(ca).put(e,Lb);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function HL(){try{let e=await _b();return await new Promise((t,n)=>{let o=!1,r=e.transaction(ca,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(ca).get(Lb);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function XL(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function th(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function VL(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function WL(e){return!(typeof e!="string"||e.length===0||YL.test(e))}function nh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(Qn)||n.startsWith(UL)||n.startsWith(DL))return;let o=VL(n);if(o!=null)try{let r={key:n,slot:o,trusted:WL(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function zL(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=th(),a=String(i),u=this===localStorage&&a.startsWith(Qn);if(u)try{Km(a)}catch{}let d;try{d=t.apply(this,arguments)}finally{try{if(u){Ro("setItem");try{jm(a,s)}catch{}}this===localStorage&&a.startsWith(Qn)&&nh(a,l)}catch{}}return d}),typeof n=="function"&&(e.removeItem=function(i){let s=th(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(Qn)&&(Ro("removeItem"),nh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=th(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Ro("clear"),nh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function Cb(e="idle"){la=e||la,Gr=!0,!aa&&(aa=setTimeout(()=>{if(aa=null,!Gr)return;let t=la;Gr=!1,kb(t)},$L))}function Mb(){aa&&(clearTimeout(aa),aa=null)}function Ro(e="dirty"){try{Cb(e)}catch{}}async function oh(e="manual"){if(!ua()||!Dl())return!1;let t=qL();if(!t)return!1;t.reason=e,sf=!1;let n=await GL(t);return n||(Gr=!0,Cb("retry")),n}async function kb(e="manual",{immediate:t=!1}={}){return!ua()||!Dl()?!1:t?(Mb(),Gr=!1,sf=!0,oh(e)):(Gr=!0,la=e||la,oh(e))}function rf(e){!Dl()||!ua()||(Mb(),Gr=!1,sf=!0,oh(e))}function KL(){if(!ua())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(Qn))return!0}}catch{}return!1}async function jL(){if(xb||(xb=!0,!ua()||!Dl()))return!1;let e=!1;try{if(!KL())e=!0;else{let o=localStorage.getItem(`${Qn}saveSlot`);if(o){let r=`${Qn}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await HL();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Ro("restored"),n}function ZL(){if(Eb||(Eb=!0,typeof window>"u"))return;XL(),zL();let e=()=>{document.hidden?rf("visibility-hidden"):Ro("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>rf("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>rf("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>rf("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Ro("pageshow"))}catch{}try{window.addEventListener("focus",()=>Ro("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(Qn)||Ro("storage-event"))})}catch{}Ro("boot")}function JL(){return{pendingImmediateFlush:sf,dirty:Gr,lastDirtyReason:la}}var Qn,BL,FL,ca,Lb,UL,DL,$L,sa,aa,Gr,la,Eb,xb,sf,YL,Tb=Ue(()=>{Zm();Qn="ccc:",BL="ccc:safety",FL=1,ca="snapshots",Lb="latest",UL=`${Qn}slotSig`,DL=`${Qn}slotMod`,$L=1e3,sa=null,aa=null,Gr=!1,la="init",Eb=!1,xb=!1,sf=!1;YL=/\bat <anonymous>:\d+:\d+\b/});var Nb={};bt(Nb,{initGlobalOverlayEsc:()=>t1});function e1(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i}of QL){let s=document.querySelectorAll(o);if(s.length>0){if(i){t=!0;continue}let a=s[s.length-1].querySelector(r||".shop-close");a&&(a.click(),n=!0)}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function t1(){window.addEventListener("keydown",e1,!0)}var QL,Rb=Ue(()=>{QL=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".automation-shop-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close"}]});var Ob={};bt(Ob,{ensureGameDom:()=>n1});function n1(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var Pb=Ue(()=>{});function i1(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function s1(){if(!Ze)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function l1(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let d=document.createElement("div");d.textContent=Ze?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(d.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),d.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),d.textContent="Loading skipped",d.style.textDecoration="none",d.style.cursor="default",t())}),o.appendChild(d)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function c1(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function u1(e){if(!e||e.__done)return;e.__done=!0;let t=500;e.__label&&(e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let n=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,450)},t)}async function ah(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function f1(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function d1(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Bn(),Gl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function p1(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function m1({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...f1(e,s),...d1(t,s),...n?p1(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function h1(e){if(fa===e)return;sn&&(sn.stop(),sn=null),fa=e;let t=document.querySelector(".menu-root");switch(e){case sr.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{fa===sr.STARTER_COVE&&(sn=dt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},25)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof mh=="function"&&mh(n,80),Bi){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(Bi.init("water-background",i),lf){try{lf()}catch{}lf=null}if(cf){try{cf()}catch{}cf=null}typeof dh=="function"&&(lf=dh(s=>Bi.update(s))),typeof ph=="function"&&(cf=ph((s,l)=>Bi.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,Bi&&requestAnimationFrame(()=>Bi.resize()),Jb()),typeof ch=="function")try{ch()}catch{}if(typeof uh=="function")try{uh()}catch{}if(!rn){rn=jb({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=rn;let i=()=>{if(!(!rn||typeof rn.setCoinSprite!="function"))try{rn.setCoinSprite(nS?.())}catch{}};i(),oS?.(i);let s=Zb({spawner:rn});rn&&typeof rn.setDependencies=="function"&&rn.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=Qb(),u=eS(a);if(rn&&u?.coinsPerSecondMult){let d=1*u.coinsPerSecondMult;if(typeof fh=="function"){let f=fh("spawnRate",d);try{f&&typeof f.toScientific=="function"?d=Number(f.toScientific(6)):d=Number(f)}catch{}}Number.isFinite(d)&&rn.setRate(d)}}catch{}};if(l(),typeof sh=="function")try{sh()}catch{}sh=tS(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof lh=="function")try{lh()}catch{}rn.start();break}case sr.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),rn&&rn.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===sr.MENU}}))}catch{}}var o1,Ze,Bb,jb,Zb,Jb,Fb,Ub,Db,$b,qb,Gb,Hb,Xb,Qb,eS,lh,tS,r1,Vb,Yb,Wb,rh,ih,ch,uh,nS,oS,af,fh,zb,dh,ph,Kb,mh,Bi,lf,cf,sr,fa,sn,rn,sh,uf,a1,Lo=Ue(()=>{Bn();o1=!0,Ze=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();Ze&&document.documentElement.classList.add("is-mobile");lf=null,cf=null;s1();sr={MENU:0,STARTER_COVE:1},fa=sr.MENU,sn=null,rn=null,sh=null,uf=()=>new Promise(e=>requestAnimationFrame(e)),a1=async()=>{await uf(),await uf()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(q=>{e=q}),n=l1("Loading assets...",e);await uf();let{initAudio:o}=await Promise.resolve().then(()=>(Bn(),Gl));o();let r=Promise.all([Promise.resolve().then(()=>(Af(),Oh)),Promise.resolve().then(()=>(ob(),nb)),Promise.resolve().then(()=>(Ga(),Qy)),Promise.resolve().then(()=>(eu(),$y)),Promise.resolve().then(()=>(St(),Ah)),Promise.resolve().then(()=>(Zm(),fb)),Promise.resolve().then(()=>(ro(),d0)),Promise.resolve().then(()=>(Ql(),Bh)),Promise.resolve().then(()=>(Gn(),Jh)),Promise.resolve().then(()=>(xo(),qv)),Promise.resolve().then(()=>(_o(),X0)),Promise.resolve().then(()=>(wb(),Ib)),Promise.resolve().then(()=>(Tb(),Ab)),Promise.resolve().then(()=>(ji(),ig)),Promise.resolve().then(()=>(Rb(),Nb)),Promise.resolve().then(()=>(zi(),$0)),Promise.resolve().then(()=>(Jr(),ag)),Promise.resolve().then(()=>(Tc(),Qg)),Promise.resolve().then(()=>(os(),gg)),Promise.resolve().then(()=>(ls(),Lg)),Promise.resolve().then(()=>(Pb(),Ob)),Promise.resolve().then(()=>(io(),Vg)),Promise.resolve().then(()=>(Vm(),j0)),Promise.resolve().then(()=>(ui(),jg))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(q,j)=>`img/mutations/m${j+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=m1(i,q=>{s=q,c1(n,q)}),[a,u,d,f,p,h,m,y,g,b,E,x,R,T,F,D,G,_,B,M,L,X,J,fe]=await r;({initSlots:Bb}=a),{createSpawner:jb}=u,{initCoinPickup:Zb}=d,{initHudButtons:Jb}=f,{bank:$b,getHasOpenedSaveSlot:qb,setHasOpenedSaveSlot:Gb,ensureStorageDefaults:Hb,notifyGameSessionStarted:Kb,ensureMultiplierDefaults:Xb}=p,{getCurrentAreaKey:Qb,computeUpgradeEffects:eS,onUpgradesChanged:tS}=m,{registerPreloadedAudio:r1}=y,{initXpSystem:lh}=g,{initResetSystem:ch}=b,{initMutationSystem:uh,getMutationCoinSprite:nS,onMutationChange:oS}=E,{initPopups:Vb}=x,{installSuspendSafeguards:Yb,restoreFromBackupIfNeeded:Wb,markProgressDirty:rh,flushBackupSnapshot:ih}=R,{installGhostTapGuard:Fb,initGlobalGhostTap:Ub}=T,{initGlobalOverlayEsc:Db}=F,{setDebugPanelAccess:af,applyStatMultiplierOverride:fh}=D,{startGameLoop:zb,registerTick:dh,registerFrame:ph}=G;let{initOfflineTracker:K,processOfflineProgress:Q}=_,{initWorkshopSystem:ve}=B,{initAutomationEffects:he}=M;({ensureGameDom:mh}=L);let{initSurgeEffects:V}=X;({waterSystem:Bi}=J);let{initLabLogic:ee}=fe;window.bank=$b,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(sn){try{sn.stop()}catch{}sn=null}}),window.addEventListener("audio:restartMusic",()=>{if(sn){try{sn.stop()}catch{}sn=null}fa===sr.STARTER_COVE&&(sn=dt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",q=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return q.preventDefault(),q.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let q=document.hidden;df(q),sn&&sn.element&&(q?sn.element.pause():sn.element.play().catch(()=>{}))}),Fb?.(),Ub?.(),Db?.(),Yb?.(),typeof af=="function"&&(af(o1),window.setDebugPanelAccess=af);try{await Wb?.()}catch{}await Promise.race([l,t]),await a1(),document.documentElement.classList.remove("booting"),await uf(),u1(n),await Promise.all([ah("img/currencies/coin/coin_plus_base.webp"),ah("img/stats/xp/xp_plus_base.webp"),ah("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}zb(),K(()=>fa===sr.STARTER_COVE);try{ve()}catch(q){console.error("Workshop init failed",q)}try{he()}catch(q){console.error("Automation init failed",q)}try{V()}catch(q){console.error("Surge effects init failed",q)}try{ee()}catch(q){console.error("Lab system init failed",q)}i1(),Hb(),rh?.("ensure-defaults"),Vb();let $=document.getElementById("panel-title");if(qb()?(document.body.classList.add("has-opened"),$&&($.style.opacity="0")):$&&($.style.opacity="1"),Bb(()=>{fa!==sr.STARTER_COVE&&(Gb(!0),document.body.classList.add("has-opened"),$&&($.style.opacity="0"),h1(sr.STARTER_COVE),Xb(),Q(),window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave(),Kb?.(),rh?.("slot-entered"))}),typeof window<"u"&&ih)try{window.cccRequestBackup=()=>ih("manual",{immediate:!0})}catch{}})});Lo();})();
