(()=>{var Vm=Object.defineProperty,Ne=(e,t)=>()=>(e&&(t=e(e=0)),t),Ze=(e,t)=>{for(var n in t)Vm(e,n,{get:t[n],enumerable:!0})},c,St=Ne(()=>{c=class O{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,r=O.DEFAULT_PRECISION){if(this.p=r|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let i=Number(n.base??0);if(n.inf||!Number.isFinite(i)||i>=O.MAX_E)this.e=O.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(i),this.inf=!1;let l=n.offset??0;this._eOffset=typeof l=="bigint"?l:BigInt(l)}}else{let i=Number(n);!Number.isFinite(i)||i>=O.MAX_E?(this.e=O.MAX_E,this.inf=!0):(this.e=Math.trunc(i),this.inf=!1)}this.#s()}static zero(t=O.DEFAULT_PRECISION){return new O(0n,0,t)}static fromInt(t,n=O.DEFAULT_PRECISION){return new O(BigInt(t),0,n)}static fromScientific(t,n=O.DEFAULT_PRECISION){let r=String(t??"").trim();if(!r)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(r))return new O(1n,O.MAX_E,n);let i=r.match(/^(\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!i)return new O(BigInt(r),0,n);let[,l,o="",a]=i,s=a?parseInt(a,10):0;s-=o.length;let u=(l+o).replace(/^0+/,"")||"0",d=BigInt(u);return new O(d,s,n)}static fromStorage(t,n=O.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,r,i,l]=t.split(":"),o=parseInt(r,10)||n,a=l,s=0n,u=l.indexOf("^");if(u>=0){a=l.slice(0,u);let f=l.slice(u+1)||"0";try{s=BigInt(f)}catch{s=0n}}let d=Number(a);return Number.isFinite(d)||(d=O.MAX_E),new O(BigInt(i),{base:d,offset:s},o)}return O.fromScientific(t,n)}static fromAny(t,n=O.DEFAULT_PRECISION){if(t instanceof O)return t;if(typeof t=="string"){let r=t.trim();if(r.startsWith("BN:"))return O.fromStorage(r,n);if(/^inf(?:inity)?$/i.test(r))return new O(1n,O.MAX_E,n);if(/^\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(r))return O.fromScientific(r,n)}if(typeof t=="number")return Number.isFinite(t)?O.fromScientific(t.toString(),n):new O(1n,O.MAX_E,n);if(typeof t=="bigint")return O.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${O.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new O(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=O.fromAny(t,this.p),this.inf)return t.inf?O.zero(this.p):this.clone();if(t.inf)return O.zero(this.p);if(this.cmp(t)<=0)return O.zero(this.p);let n=this.#l(t);if(n>=0){let r=n===0?t.sig:this.#o(t),i=this.sig-r;if(i>0n)return new O(i,this.#e(),this.p)}try{let r=this.toPlainIntegerString(),i=t.toPlainIntegerString();if(r==="Infinity")return this.clone();if(i==="Infinity")return O.zero(this.p);let l=BigInt(r)-BigInt(i);return l<=0n?O.zero(this.p):O.fromInt(l,this.p)}catch{return O.zero(this.p)}}#r(t){return t<=0?1n:10n**BigInt(t)}#e(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#i(t){if(this.inf||!t)return;let n=this.e,r=n+t;this.e=Math.trunc(r);let i=this.e-n,l=BigInt(t-i);l&&(this._eOffset+=l)}#t(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#t(),r=t.#t();return n>r?1:n<r?-1:0}#a(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#t()-t.#t(),r=n<0n?-n:n,i=BigInt(this.p+2);return r>i?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#c(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#n(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#c();return Number.isFinite(t)?this.e+t:this.e}#s(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#r(r),l=t/i;if(t%i*2n>=i&&(l+=1n),t=l,this.#i(r),this.e>=O.MAX_E){this.e=O.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#i(1),this.e>=O.MAX_E)){this.e=O.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#r(i),this.#i(-i)}this.sig=t}#o(t){let n=this.#a(t),r=n<0n?-n:n;if(r===0n)return t.sig;if(r>BigInt(this.p+2))return 0n;let i=Number(r),l=this.#r(i),o=t.sig/l;return t.sig%l*2n>=l&&(o+=1n),o}add(t){if(t=O.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=O.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#l(t)>=0?new O(this.sig+this.#o(t),this.#e(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?O.zero(this.p):t===1?this.clone():new O(this.sig*BigInt(t),this.#e(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=O.fromAny(t,this.p);if(this.inf||n.inf){let l=this.clone();return l.inf=this.inf||n.inf,l.e=O.MAX_E,l}if(this.isZero()||n.isZero())return O.zero(this.p);let r=this.e+n.e,i=this._eOffset+n._eOffset;return new O(this.sig*n.sig,{base:r,offset:i},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}cmp(t){if(t=O.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),r=typeof t.isZero=="function"?t.isZero():!1;if(n||r)return n&&r?0:n?-1:1;let i=this.#l(t);return i!==0?i:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=O.DEFAULT_PRECISION){let r=typeof t=="number"?String(t):String(t??"").trim();if(!r||r==="0")return{numer:0n,scale:0};if(/e/i.test(r)){let s=Number(r);if(!Number.isFinite(s)||s<0)throw new TypeError("Invalid multiplier: "+r);let u=Math.min(n,18);r=s.toFixed(u).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(r))throw new TypeError("Invalid multiplier: "+r);let[i,l=""]=r.split("."),o=l.slice(0,n),a=o.length;return{numer:BigInt(i+o),scale:a}}mulDecimal(t,n=O.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:r,scale:i}=O._parseDecimalMultiplier(t,n);return r===0n?O.zero(this.p):this.mulScaledInt(r,i)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#n();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return O.zero(this.p);if(n>=this.p)return this.clone();let r=this.p-n,i=10n**BigInt(r),l=this.sig/i*i;return new O(l,this.#e(),this.p)}mulDecimalFloor(t,n=O.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let r=BigInt(t);return r===0n?O.zero(this.p):new O(this.sig*r,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#n();return Number.isFinite(t)?t+(this.p-1):this.e+(this.p-1)}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),r=n[0],i=n.slice(1,1+t).replace(/0+$/g,""),l=i?`${r}.${i}`:r,o=this.#n(),a=Number.isFinite(o)?o+(this.p-1):this.e+(this.p-1);return`${l}e${a}`}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#n();if(!Number.isFinite(t))return"Infinity";let n=t+this.p;if(n<=0)return"0";if(n>O.MAX_PLAIN_DIGITS)return"Infinity";let r=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return r.slice(0,n).replace(/^0+/,"")||"0";let i=n-this.p;return(r+"0".repeat(i)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}}});function Hu(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return Va.format(t)}catch{return String(e)}}function Pi(e){let t=1,n=e.split("");for(let r=n.length-1;r>=0&&t;r--){let i=n[r].charCodeAt(0)-48+t;t=i>=10?1:0,n[r]=String.fromCharCode(48+i%10)}return t&&n.unshift("1"),n.join("")}function Da(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Hu(n);if(n.length<=7){let s=Number(n);if(Number.isFinite(s)&&s<=1e6)return t+Va.format(s)}let r=n.length-1;if(r<=300){let s=Math.floor(r/3)*3,u=Zl.get(s)||"",d=r-s+1,f=4-d,p=d+f;n.length<p+1&&(n+="0".repeat(p+1-n.length));let h=n.slice(0,p);(n.charCodeAt(p)||48)>=53&&(h=Pi(h));let g,v;return h.length>p?(g=h.slice(0,d+1),v="0".repeat(f)):(g=h.slice(0,d),v=h.slice(d)),t+`${g}${f?"."+v:""}${u}`}let i=4;n.length<i+1&&(n+="0".repeat(i+1-n.length));let l=n.slice(0,i);(n.charCodeAt(i)||48)>=53&&(l=Pi(l));let o=l.slice(0,1),a=l.slice(1);return t+`${o}.${a}e`+Da(String(r))}function qm(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Da(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,r,i="",l,o]=n,a=!1,s=0;o.length>3?a=!0:(s=parseInt(o||"0",10)||0,a=s>=303);let u=(r+i).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let d=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(d=Pi(d)),a){let b=d.slice(0,1)+"."+d.slice(1),w=l==="-"?"-":"";return t+b+"e"+Da(o,w)}let f=Math.floor(s/3)*3,p=Zl.get(f)||"",h=s-f+1,g=4-h,v,m;return d.length>4?(v=d.slice(0,h+1),m="0".repeat(g)):(v=d.slice(0,h),m=d.slice(h)),t+(l==="-"?"-":"")+v+(g?"."+m:"")+p}function Xu(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let n=e.slice(0,t).replace(".","");if(!/^\d+$/.test(n))return e;n.length<5&&(n+="0".repeat(5-n.length));let r=n.slice(0,4);(n.charCodeAt(4)||48)>=53&&(r=Pi(r)),r.length>4&&(r=r.slice(0,4));let i=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return i+"e"+qm(l)}function K(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Xu(e.toScientific(3));if(t<6)return Hu(e.toPlainIntegerString());let n=Math.floor(t/3)*3,r=Zl.get(n);if(!r)return Xu(e.toScientific(3));let i=t-n+1,l=4-i,o=i+l,a=e.sig.toString().padStart(e.p,"0");a.length<o+1&&(a+="0".repeat(o+1-a.length));let s=a.slice(0,o);(a.charCodeAt(o)||48)>=53&&(s=Pi(s));let u,d;return s.length>o?(u=s.slice(0,i+1),d="0".repeat(l)):(u=s.slice(0,i),d=s.slice(i)),`${u}${l?"."+d:""}${r}`}var Yu,Zl,Va,en=Ne(()=>{St(),Yu=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],Zl=new Map(Yu),Va=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})}),ju={};Ze(ju,{CURRENCIES:()=>be,KEYS:()=>_e,STORAGE_PREFIX:()=>kr,bank:()=>P,clearAllStorage:()=>Jm,ensureCurrencyDefaults:()=>Ju,ensureMultiplierDefaults:()=>ed,ensureStorageDefaults:()=>Qm,getActiveSlot:()=>y,getCurrency:()=>Wa,getCurrencyMultiplierBN:()=>td,getHasOpenedSaveSlot:()=>Km,getSlotModifiedFlagKey:()=>Wm,getSlotSignature:()=>Qu,getSlotSignatureKey:()=>Ku,hasModifiedSave:()=>zl,isCurrencyLocked:()=>Ql,markSaveSlotModified:()=>xr,onCurrencyChange:()=>ja,peekCurrency:()=>Qa,primeStorageWatcherSnapshot:()=>xe,setActiveSlot:()=>Wu,setCurrency:()=>$i,setCurrencyMultiplierBN:()=>Ka,setHasOpenedSaveSlot:()=>za,setSlotSignature:()=>Za,watchStorageKey:()=>Tt});function qa(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Ha(e){let t=qa(e);return t==null?null:`${rd}:${t}`}function Xa(e){let t=qa(e);return t==null?null:`${id}:${t}`}function Ya(e={}){Bi.size!==0&&Bi.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function ja(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let r={handler:e,key:t??null,slot:n??null};return Bi.add(r),()=>{Bi.delete(r)}}function Hm(){Nr!=null||Dt.size===0||(Nr=(typeof window<"u"?window:globalThis).setInterval(Ym,ld))}function Gu(){Dt.size!==0||Nr==null||((typeof window<"u"?window:globalThis).clearInterval(Nr),Nr=null)}function Zu(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function Xm(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function Ym(){if(Dt.size===0){Gu();return}Dt.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(r=>{if(!r)return;let i=Zu(r,n);if(!r.initialized){if(r.lastRaw=n,r.lastValue=i,r.initialized=!0,r.emitCurrentValue)try{r.onChange?.(i,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let l=n!==r.lastRaw,o=!Xm(r,r.lastValue,i);if(!l&&!o)return;let a=r.lastValue,s=r.lastRaw;r.lastRaw=n,r.lastValue=i;try{r.onChange?.(i,{key:t,raw:n,previous:a,previousRaw:s,rawChanged:l,valueChanged:o})}catch{}})})}function Tt(e,{parse:t,equals:n,onChange:r,emitCurrentValue:i=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let l={parse:t,equals:n,onChange:r,emitCurrentValue:i,lastRaw:void 0,lastValue:void 0,initialized:!1},o=Dt.get(e);return o||(o=new Set,Dt.set(e,o)),o.add(l),Hm(),()=>{let a=Dt.get(e);a&&(a.delete(l),a.size===0&&(Dt.delete(e),Gu()))}}function xe(e,t){if(!e)return;let n=Dt.get(e);if(!n||n.size===0)return;let r=t;if(r===void 0)try{r=localStorage.getItem(e)}catch{r=null}n.forEach(i=>{i&&(i.lastRaw=r,i.lastValue=Zu(i,r),i.initialized=!0)})}function Ga(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function jm(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function Gm(){eo.forEach(e=>{try{e?.()}catch{}}),eo.clear()}function zu(e){if(e!==Ja&&(Gm(),Ja=e??null,e!=null))for(let t of Object.values(be)){let n=`${_e.CURRENCY[t]}:${e}`,r=Tt(n,{parse:jm,equals:Ga,onChange:(i,l)=>{if(!l?.valueChanged||typeof window>"u")return;let o={key:t,value:i,slot:e};Ya(o);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:o}))}catch{}}});eo.set(n,r)}}function Zm(){typeof window>"u"||(zu(y()),window.addEventListener("saveSlot:change",()=>{zu(y())}))}function y(){let e=localStorage.getItem(_e.SAVE_SLOT),t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Wu(e){let t=Math.max(1,parseInt(e,10)||1);localStorage.setItem(_e.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function Oi(e,t=y()){return t==null?null:`${e}:${t}`}function zm(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Ku(e=y()){return Ha(e)}function Wm(e=y()){return Xa(e)}function Qu(e=y()){if(typeof localStorage>"u")return null;let t=Ha(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function Za(e,t){if(typeof localStorage>"u")return;let n=Ha(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function zl(e=y()){if(typeof localStorage>"u")return!1;let t=Xa(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function xr(e=y()){if(typeof localStorage>"u")return;let t=qa(e);if(t==null||zl(t))return;let n=Xa(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function Km(){return localStorage.getItem(_e.HAS_OPENED_SAVE_SLOT)==="true"}function za(e){localStorage.setItem(_e.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function Qm(){localStorage.getItem(_e.HAS_OPENED_SAVE_SLOT)===null&&za(!1)}function Ju(){let e=y();if(e!=null)for(let t of Object.values(be)){let n=`${_e.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function ed(){let e=y();if(e!=null)for(let t of Object.values(be)){let n=`${_e.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Kl(t);else{let r=xn(c.fromInt(1));Lr(t,r)}}}function Wa(e){let t=Oi(_e.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function $i(e,t,{delta:n=null,previous:r=null}={}){let i=y(),l=Oi(_e.CURRENCY[e],i),o=r??Wa(e);if(!l)return o;if(Ql(e,i)){let p=null;if(n)try{p=n instanceof c?n.clone?.()??n:c.fromAny(n)}catch{p=null}let h={key:e,value:o,slot:i,delta:p??void 0};Ya(h);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:h}))}catch{}return o}let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let s=a.toStorage();try{localStorage.setItem(l,s)}catch{}let u=null;try{u=localStorage.getItem(l)}catch{}let d=u??s,f=a;try{u!=null&&(f=c.fromAny(u),f.isNegative?.()&&(f=c.fromInt(0)))}catch{}if(xe(l,d),!Ga(o,f)){let p=null;try{p=f.sub?.(o)}catch{}if(!p&&n)try{p=n instanceof c?n:c.fromAny(n)}catch{p=null}let h={key:e,value:f,slot:i,delta:p??void 0};Ya(h);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:h}))}catch{}}return f}function xn(e){return e.mulScaledIntFloor(1n,-Jl)}function Wl(e){let t=c.fromAny(e);if(t.isInfinite())return t.clone();let n=t.mulScaledIntFloor(1n,Jl);return n.isZero()?c.fromInt(1):n}function Kl(e){let t=Oi(_e.MULTIPLIER[e]);if(!t)return xn(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(kn)){let i=xn(c.fromInt(1));return Lr(e,i),i}let r=n.slice(kn.length);try{return c.fromAny(r)}catch{let i=xn(c.fromInt(1));return Lr(e,i),i}}function Lr(e,t,n=y()){let r=Oi(_e.MULTIPLIER[e],n);if(!r||Ql(e,n))return;let i=xn(c.fromInt(1)),l=localStorage.getItem(r);if(l?.startsWith?.(kn))try{i=c.fromAny(l.slice(kn.length))}catch{}let o=c.fromAny(t),a=kn+o.toStorage();try{localStorage.setItem(r,a)}catch{}let s=null;try{s=localStorage.getItem(r)}catch{}let u=s??a,d=o;try{let f=u?.startsWith?.(kn)?u.slice(kn.length):null;f!=null&&(d=c.fromAny(f))}catch{}try{xe(r,u)}catch{}if(!Ga(i,d))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:Wl(d),slot:n}}))}catch{}}function td(e){return Wl(Kl(e))}function Ql(e,t=y()){let n=Oi(_e.CURRENCY[e],t);return zm(n)}function Ka(e,t){let n=c.fromAny(t),r=xn(n);return Lr(e,r,y()),n}function Qa(e,t){let n=localStorage.getItem(`${_e.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Jm(){Object.values(_e).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function nd(e){let t=n=>{try{let r=c.fromAny(n);return typeof K=="function"?K(r):r.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return Wa(e)}}),t.toString=function(){return this.value.toString()},t.add=function(n){let r=c.fromAny(n),i=this.value.add(r);return $i(e,i,{delta:r,previous:this.value})},t.sub=function(n){let r=c.fromAny(n),i=this.value.sub(r);return i.isNegative?.()&&(i=c.fromInt(0)),$i(e,i),i},t.set=function(n){let r=c.fromAny(n),i=null,l;try{l=this.value,l&&typeof l.sub=="function"&&(i=r.sub(l))}catch{}return $i(e,r,{delta:i,previous:l})},t.fmt=function(n){let r=c.fromAny(n);return typeof K=="function"?K(r):r.toString()},t.mult={get(){return td(e)},set(n){return Ka(e,n)},multiplyByInt(n){let r=c.fromAny(n).floorToInteger(),i=Kl(e).mulBigNumInteger(r);return i.isZero()&&(i=xn(c.fromInt(1))),Lr(e,i),Wl(i)},multiplyByDecimal(n){let r;try{r=c._parseDecimalMultiplier(String(n),Jl)}catch{r={numer:1n,scale:0}}let i=Kl(e).mulScaledIntFloor(r.numer,r.scale);i.isZero()&&(i=xn(c.fromInt(1))),Lr(e,i);let l=Wl(i);return l.isZero()?c.fromInt(1):l},multiplyByPercent(n){let r=Number(n)/100+1;return this.multiplyByDecimal(String(r))},applyTo(n){let r=this.get();if(r.isInfinite())return c.fromAny("Infinity");let i=c.fromAny(n,r.p);return i.isZero()||r.isZero()?i.clone():i.mulBigNumInteger(r)}},t.addWithMultiplier=function(n){let r=t.mult.applyTo(n);return t.add(r)},t}var Ln,kr,rd,id,Jl,kn,ld,Dt,Nr,Bi,eo,Ja,_e,be,P,et=Ne(()=>{St(),en(),Ln="ccc:",kr=Ln,rd=`${Ln}slotSig`,id=`${Ln}slotMod`,Jl=18,kn="XM:",ld=140,Dt=new Map,Nr=null,Bi=new Set,eo=new Map,Ja=null,_e={HAS_OPENED_SAVE_SLOT:`${Ln}hasOpenedSaveSlot`,SAVE_SLOT:`${Ln}saveSlot`,CURRENCY:{},MULTIPLIER:{}},be={COINS:"coins",BOOKS:"books",GOLD:"gold"};for(let e of Object.values(be))_e.CURRENCY[e]=`${Ln}${e}`,_e.MULTIPLIER[e]=`${Ln}mult:${e}`;Zm(),P=new Proxy({},{get(e,t){if(Object.values(be).includes(t))return nd(t);if(typeof t=="string"&&be[t.toUpperCase?.()])return nd(be[t.toUpperCase()])}}),typeof window<"u"&&(window.bank=P,window.coins=P.coins,window.books=P.books)});function to(e){Vt=!!e,document.body.classList.toggle("slots-delete-mode",Vt);let t=document.getElementById("manage-saves");t&&(t.textContent=Vt?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",Vt),n.setAttribute("aria-pressed",Vt?"true":"false")})}function eg(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let r=0;r<localStorage.length;r++){let i=localStorage.key(r);t.test(i)&&n.push(i)}n.forEach(r=>localStorage.removeItem(r))}function tg(){if(ec)return;ec=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",i=>{i.preventDefault(),to(!Vt)}),window.addEventListener("keydown",i=>{Vt&&i.key==="Escape"&&to(!1)});let n=i=>{!Vt||!i.target.closest(".slot-card")||(i.preventDefault(),i.stopPropagation())},r=i=>{if(!Vt)return;let l=i.target.closest(".slot-card");if(!l)return;i.preventDefault(),i.stopPropagation();let o=parseInt(l.dataset.slot,10);if((!Number.isFinite(o)||o<=0)&&(o=Array.from(document.querySelectorAll(".slot-card")).indexOf(l)+1),localStorage.getItem(`ccc:coins:${o}`)===null){alert(`Slot ${o} has no save data.`);return}if(confirm(`Delete save data in Slot ${o}? This cannot be undone.`)){if(eg(o),y()===o)try{localStorage.removeItem(_e.SAVE_SLOT)}catch{}ad(),to(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",r,!0),to(!1)}var Vt,ec,ng=Ne(()=>{et(),cd(),Vt=!1,ec=!1,document.addEventListener("DOMContentLoaded",()=>{try{tg()}catch{}})}),od={};Ze(od,{initSlots:()=>lg,refreshSlotsView:()=>ad});function rg(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function ig(e){if(!rg(e))return"No save data";try{return`Coins: ${Qa(e,"coins").toString()}`}catch{return"Coins: 0"}}function tc(){document.querySelectorAll(".slot-card").forEach((e,t)=>{let n=t+1,r=e.querySelector(".slot-title");r&&(r.textContent=ig(n)),e.dataset.slot=String(n)})}function lg(e){let t=document.querySelectorAll(".slot-card");tc(),t.forEach((n,r)=>{let i=r+1;n.addEventListener("click",l=>{l.preventDefault(),Wu(i),Ju(),ed(),za(!0),typeof e=="function"&&e(i,l),tc()})})}function ad(){tc()}var cd=Ne(()=>{St(),ng(),et()}),sd={};Ze(sd,{registerPreloadedAudio:()=>og,takePreloadedAudio:()=>nc});function og(e,t){let n=rc(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}Ri.set(n,t)}}function nc(e){let t=rc(e);if(!Ri.has(t))return null;let n=Ri.get(t);return Ri.delete(t),n}var Ri,rc,ic=Ne(()=>{Ri=new Map,rc=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function no(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),r=!!(t&&!t.hasAttribute("hidden")),i=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",r&&!i),e.classList.toggle("hud-top--xp-mp",r&&i),!r&&!i&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var ud=Ne(()=>{}),dd={};Ze(dd,{addExternalCoinMultiplierProvider:()=>pc,addExternalXpGainMultiplierProvider:()=>mc,addXp:()=>dc,broadcastXpChange:()=>Id,computeCoinMultiplierForXpLevel:()=>wd,getXpLevelStorageKey:()=>ag,getXpRequirementForXpLevel:()=>fc,getXpState:()=>Ce,initXpSystem:()=>Di,isXpSystemUnlocked:()=>Zn,onXpChange:()=>oc,refreshCoinMultiplierFromXpLevel:()=>zn,resetXpProgress:()=>so,setExternalBookRewardProvider:()=>gc,setExternalCoinMultiplierProvider:()=>Ed,setExternalXpGainMultiplierProvider:()=>Sd,unlockXpSystem:()=>Vi});function ag(e=y()){let t=e??y();return t==null?null:Wn(t)}function cg(e){if(e===0n)return 0;let t=e.toString(),n=t.length,r=Math.min(n,15),i=Number(t.slice(0,r)),l=n-r;if(!Number.isFinite(i))return Number.POSITIVE_INFINITY;let o=i*Math.pow(10,l);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function Gn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function Ui(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function sg(e){if(!e||typeof e!="object")return 0;if(Gn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let i=parseFloat(n[1]),l=parseInt(n[2],10);return!Number.isFinite(i)||!Number.isFinite(l)||l>=309?Number.POSITIVE_INFINITY:i*Math.pow(10,l)}let r=Number(t);return Number.isFinite(r)?r:Number.POSITIVE_INFINITY}function fd(e){return!e||typeof e!="object"?0:Gn(e)||typeof e.cmp=="function"&&e.cmp(Ld)>=0?Number.POSITIVE_INFINITY:sg(e)}function lc(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(xd,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(io())??c.fromInt(0):n}function ug(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(yc,18)}function dg(e){let t=lc(e);return Ui(t)?null:t.mulDecimal(vc,18)}function pd(e){if(!e||typeof e!="object")return Le.clone?.()??Le;let t=ug(e),n=dg(e);n&&(t=t.add?.(n)??t);let r=fd(t);if(!Number.isFinite(r))return Le.clone?.()??Le;let i=yd(r);if(i.isInfinite?.()||typeof i.isInfinite=="function"&&i.isInfinite())return Le.clone?.()??Le;let l=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),o=i.clone?.()??i;return typeof o.add=="function"?o=o.add(l):typeof l.add=="function"&&(o=l.add(o)),o}function md(){let e=Gn(S.xpLevel),t=Gn(S.progress);if(!e&&!t)return!1;let n=Le.clone?.()??Le;if(S.xpLevel=n.clone?.()??n,S.progress=n.clone?.()??n,Ae=n.clone?.()??n,P?.books)try{typeof P.books.set=="function"?P.books.set(n.clone?.()??n):typeof P.books.add=="function"&&P.books.add(n.clone?.()??n)}catch{}return!0}function ro(e={}){Pr.size!==0&&Pr.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function oc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return Pr.add(n),()=>{Pr.delete(n)}}function Xe(){return c.fromInt(0)}function io(){return c.fromInt(1)}function Cr(e){if(!e)return Xe();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Xe()}}function lo(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function fg(){for(;go.length>0;){let e=go.pop();try{e?.()}catch{}}}function gd(e){if(e==null)return Xe();try{return c.fromAny(e)}catch{return Xe()}}function ac(e){if(!yo){yo=!0;try{let t=ho??y(),n={unlocked:S.unlocked,xpLevel:Cr(S.xpLevel),progress:Cr(S.progress),requirement:Cr(Ae)};tt(!0),qt(),ut(!0);let r={unlocked:S.unlocked,xpLevel:Cr(S.xpLevel),progress:Cr(S.progress),requirement:Cr(Ae)},i=n.unlocked!==r.unlocked,l=!lo(n.xpLevel,r.xpLevel),o=!lo(n.progress,r.progress);if(!i&&!l&&!o)return;let a=Xe();if(l)try{a=r.xpLevel.sub?.(n.xpLevel)??Xe()}catch{a=Xe()}let s=null;if(!l&&o)try{s=r.progress.sub?.(n.progress)??null}catch{s=null}if(typeof window<"u"||Pr.size>0){let u={unlocked:r.unlocked,xpLevelsGained:a?.clone?.()??a,xpAdded:s?.clone?.()??s,xpLevel:r.xpLevel?.clone?.()??r.xpLevel,progress:r.progress?.clone?.()??r.progress,requirement:r.requirement?.clone?.()??r.requirement,source:"storage",changeType:e,slot:t};if(ro(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{yo=!1}}}function cc(e){if(e===ho||(fg(),ho=e??null,e==null))return;let t=(n,r)=>{let i=Tt(n,r);typeof i=="function"&&go.push(i)};t(Mr(e),{parse:n=>n==="1",equals:(n,r)=>n===r,onChange:()=>ac("unlock")}),t(Wn(e),{parse:gd,equals:lo,onChange:()=>ac("xpLevel")}),t(_r(e),{parse:gd,equals:lo,onChange:()=>ac("progress")})}function hd(){if(bc){cc(y());return}bc=!0,cc(y()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{cc(y()),tt(!0),qt(),ut(!0)})}function sc(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function uc(e){if(!e||typeof e!="object")return Number.NEGATIVE_INFINITY;if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return Number.POSITIVE_INFINITY;if(e.isZero?.()||typeof e.isZero=="function"&&e.isZero())return Number.NEGATIVE_INFINITY;let t=e.sig,n=typeof e.e=="number"?e.e:Number(e.e??0),r=typeof e._eOffset=="bigint"?cg(e._eOffset):Number(e._eOffset??0);if(!Number.isFinite(n))return n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(!Number.isFinite(r))return r>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let i=n+r;if(!Number.isFinite(i))return i>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let l=0;if(typeof t=="bigint"){let o=t.toString().replace(/^0+/,"");if(!o)return Number.NEGATIVE_INFINITY;let a=o.length,s=Math.min(a,15),u=o.slice(0,s),d=Number.parseFloat(u);Number.isFinite(d)&&d>0?l=Math.log10(d)+(a-s):l=a-1}else try{let o=typeof e.toScientific=="function"?e.toScientific(12):String(e);if(!o||o==="0")return Number.NEGATIVE_INFINITY;if(o==="Infinity")return Number.POSITIVE_INFINITY;let a=o.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(a){let s=parseFloat(a[1]),u=parseInt(a[2],10)||0;if(!(s>0)||!Number.isFinite(s))return Number.NEGATIVE_INFINITY;l=Math.log10(s)+u}else{let s=Number(o);if(!Number.isFinite(s)||s<=0)return Number.NEGATIVE_INFINITY;l=Math.log10(s)}}catch{return Number.NEGATIVE_INFINITY}return i+l}function pg(e){let t=e<hc?e:hc;if(t<=Kn)return;let n=Kn,r=tn.get(n.toString());for(r||(r=c.fromInt(10),tn.set(n.toString(),r));n<t;){let i=n+1n,l=r.mulScaledIntFloor(11n,1);if(i>1n&&(i-1n)%10n===0n&&(l=l.mulScaledIntFloor(25n,1)),tn.set(i.toString(),l),r=l,n=i,r.isInfinite?.()||typeof r.isInfinite=="function"&&r.isInfinite()){Kn=n;return}}Kn=n}function yd(e){if(!Number.isFinite(e)||e>=c.MAX_E)return Le.clone?.()??Le;let t=Math.floor(e),n=e-t;Number.isFinite(n)||(n=0);let r=Math.pow(10,n);(!Number.isFinite(r)||r<=0)&&(r=1),r>=10&&(r/=10,t+=1);let i;try{i=Number.isFinite(t)?t.toLocaleString("en",{useGrouping:!1}):String(t)}catch{i=String(t)}let l=`${r.toPrecision(18)}e${i}`;try{return c.fromScientific(l).floorToInteger()}catch{return Le.clone?.()??Le}}function mg(e){let t=Kn>0n?Kn:0n,n=tn.get(t.toString());if(!n||Gn(n))return Le.clone?.()??Le;let r=c.fromAny(t.toString()),i=uc(n),l=c.fromInt(0);if(Number.isFinite(i)&&i>0)try{l=c.fromScientific(i.toString())}catch{l=c.fromInt(0)}let o=e.sub?.(r)??c.fromInt(0);Ui(o)||(l=l.add?.(o.mulDecimal(yc,18))??l);let a=lc(e),s=lc(r),u=a.sub?.(s)??c.fromInt(0);Ui(u)||(l=l.add?.(u.mulDecimal(vc,18))??l);let d=fd(l);return Number.isFinite(d)?yd(d):Le.clone?.()??Le}function gg(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=Gn(t),r=Gn(e);if(n)return r?1:0;if(Ui(t)||Ui(e))return 0;let i=uc(e),l=uc(t);if(!Number.isFinite(i)||!Number.isFinite(l))return i>=l?1:0;let o=i-l,a=Math.pow(10,o);return Number.isFinite(a)?a<=0?0:a>=1?1:a:o>=0?1:0}function vd(){return nt.container&&nt.container.isConnected?!0:(nt.container=document.querySelector(".xp-counter[data-xp-hud]"),nt.container?(nt.bar=nt.container.querySelector(".xp-bar"),nt.fill=nt.container.querySelector(".xp-bar__fill"),nt.xpLevelValue=nt.container.querySelector(".xp-level-value"),nt.progress=nt.container.querySelector("[data-xp-progress]"),!0):!1)}function bd(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let n="0";try{n=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{n="0"}let r={bigInt:null,finite:!0};if(n&&n!=="Infinity")try{r={bigInt:BigInt(n),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let o=tn.get("0");return o.clone?.()??o}if(r.bigInt!=null){pg(i);let o=i.toString(),a=tn.get(o);if(a)return a.clone?.()??a}let l=mg(t);return l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite()?Le.clone?.()??Le:(r.bigInt!=null&&tn.set(r.bigInt.toString(),l),l.clone?.()??l)}function Ar(){Ae=bd(S.xpLevel)}function oo(){S.xpLevel=Xe(),S.progress=Xe(),Ar(),ut(!0)}function ao(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let t="0";try{t=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{t="0"}if(!t||t==="Infinity")return{bigInt:null,finite:!0};try{return{bigInt:BigInt(t),finite:!0}}catch{return{bigInt:null,finite:!0}}}function ut(e=!1){let t=P?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=ao(S.xpLevel),r=n.bigInt,i=!n.finite,l=typeof S.xpLevel?.toStorage=="function"?S.xpLevel.toStorage():null;if(!e&&(i&&ft||!i&&r!=null&&!ft&&!pt&&dt!=null&&r===dt||!i&&r==null&&pt&&l&&mt&&l===mt))return;if(i){try{t.set(Le)}catch{}dt=null,ft=!0,pt=!1,mt=null;return}let o;if(r!=null&&r<=mo){let d=c.fromInt(1),f=Number(r);for(let h=0;h<f;h+=1)d=d.mulDecimal("1.1",18);let p;try{p=c.fromAny(r.toString())}catch{p=c.fromInt(f)}typeof d.add=="function"?d=d.add(p):typeof p.add=="function"&&(d=p.add(d)),o=d.clone?.()??d}else o=pd(S.xpLevel);let a=o.clone?.()??o,s=nn.size>0?Array.from(nn):typeof Nn=="function"?[Nn]:[];for(let d of s)if(typeof d=="function")try{let f=d({baseMultiplier:a.clone?.()??a,xpLevel:S.xpLevel.clone?.()??S.xpLevel,xpUnlocked:S.unlocked});f instanceof c?a=f.clone?.()??f:f!=null&&(a=c.fromAny(f))}catch{}let u=a.isInfinite?.()||typeof a.isInfinite=="function"&&a.isInfinite();try{t.set(a.clone?.()??a)}catch{}u?(dt=null,ft=!0,pt=!1,mt=null):r!=null&&r<=mo?(dt=r,ft=!1,pt=!1,mt=null):(dt=null,ft=!1,pt=!0,mt=l)}function tt(e=!1){let t=y();if(t==null)return Tr=null,fo=!1,S.unlocked=!1,oo(),S;if(!e&&fo&&t===Tr)return S;Tr=t,fo=!0;try{let n=localStorage.getItem(Mr(t));S.unlocked=n==="1"}catch{S.unlocked=!1}try{S.xpLevel=c.fromAny(localStorage.getItem(Wn(t))??"0")}catch{S.xpLevel=Xe()}try{S.progress=c.fromAny(localStorage.getItem(_r(t))??"0")}catch{S.progress=Xe()}return S.unlocked?(md(),Ar(),ut(!0),hd(),S):(oo(),S)}function co(){let e=y();if(e==null)return;let t={unlocked:S.unlocked?"1":"0",level:S.xpLevel.toStorage(),progress:S.progress.toStorage()};try{localStorage.setItem(Mr(e),t.unlocked)}catch{}try{localStorage.setItem(Wn(e),t.level)}catch{}try{localStorage.setItem(_r(e),t.progress)}catch{}let n=(()=>{let r=S.unlocked,i=S.xpLevel,l=S.progress;try{r=localStorage.getItem(Mr(e))==="1"}catch{}try{let o=localStorage.getItem(Wn(e));o&&(i=c.fromAny(o))}catch{}try{let o=localStorage.getItem(_r(e));o&&(l=c.fromAny(o))}catch{}return{unlocked:r,level:i,progress:l}})();xe(Mr(e),n.unlocked?"1":"0"),xe(Wn(e),n.level?.toStorage?.()??t.level),xe(_r(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==S.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(S.unlocked=n.unlocked,S.xpLevel=n.level,S.progress=n.progress,Ar(),ut(!0),qt())}function hg(){ut(!0);let e=io();if(typeof po=="function")try{let n=po({baseReward:e.clone?.()??e,xpLevel:S.xpLevel.clone?.()??S.xpLevel,xpUnlocked:S.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{P?.books?.addWithMultiplier?P.books.addWithMultiplier(e):P?.books?.add&&P.books.add(e)}catch{}let t=ao(S.xpLevel);t.finite?t.bigInt!=null?(dt=t.bigInt,ft=!1,pt=!1,mt=null):(dt=null,ft=!1,pt=!0,mt=typeof S.xpLevel?.toStorage=="function"?S.xpLevel.toStorage():null):(dt=null,ft=!0,pt=!1,mt=null)}function qt(){if(!vd())return;let{container:e,bar:t,fill:n,xpLevelValue:r,progress:i}=nt;if(!e)return;if(!S.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),r&&(r.textContent="0"),i){let s=K(Ae);i.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${s}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let s=sc(K(Ae));t.setAttribute("aria-valuetext",`0 / ${s||"10"} XP`)}no();return}e.removeAttribute("hidden");let l=Ae,o=gg(S.progress,l),a=`${(o*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",a),n.style.width=a),r&&(r.innerHTML=K(S.xpLevel)),i){let s=K(S.progress),u=K(l);i.innerHTML=`<span class="xp-progress-current">${s}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(o*100).toFixed(2));let s=sc(K(S.progress)),u=sc(K(l));t.setAttribute("aria-valuetext",`${s} / ${u} XP`)}no()}function Di({forceReload:e=!1}={}){return vd(),tt(e),Ar(),qt(),hd(),Ce()}function Vi(){if(tt(),S.unlocked)return qt(),!1;oo(),S.unlocked=!0,co(),qt(),ut(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Ce()}))}catch{}return!0}function so({keepUnlock:e=!0}={}){tt();let t=S.unlocked;return oo(),S.unlocked=e?t||S.unlocked:!1,co(),qt(),ut(!0),Ce()}function dc(e,{silent:t=!1}={}){tt();let n=Tr??y();if(!S.unlocked)return{unlocked:!1,xpLevelsGained:Xe(),xpAdded:Xe(),xpLevel:S.xpLevel,requirement:Ae};let r;try{e instanceof c?r=e.clone?.()??c.fromAny(e??0):r=c.fromAny(e??0)}catch{r=Xe()}if(!r.isZero?.()){let p=Qn.size>0?Array.from(Qn):typeof Fr=="function"?[Fr]:[];for(let h of p)if(typeof h=="function")try{let g=h({baseGain:r.clone?.()??r,xpLevel:S.xpLevel.clone?.()??S.xpLevel,xpUnlocked:S.unlocked});g instanceof c?r=g.clone?.()??g:g!=null&&(r=c.fromAny(g))}catch{}}if(r=Ws("xp",r),r.isZero?.()||typeof r.isZero=="function"&&r.isZero())return qt(),{unlocked:!0,xpLevelsGained:Xe(),xpAdded:r,xpLevel:S.xpLevel,requirement:Ae};S.progress=S.progress.add(r),Ar();let i=S.progress?.isInfinite?.()||typeof S.progress?.isInfinite=="function"&&S.progress.isInfinite(),l=S.xpLevel?.isInfinite?.()||typeof S.xpLevel?.isInfinite=="function"&&S.xpLevel.isInfinite(),o=r?.isInfinite?.()||typeof r?.isInfinite=="function"&&r.isInfinite();if(i||l||o){let p=Le.clone?.()??Le;S.xpLevel=p.clone?.()??p,S.progress=p.clone?.()??p,Ae=p.clone?.()??p,md(),co(),qt(),ut(!0);let h={unlocked:!0,xpLevelsGained:Xe(),xpAdded:r.clone?.()??r,xpLevel:S.xpLevel.clone?.()??S.xpLevel,progress:S.progress.clone?.()??S.progress,requirement:Ae.clone?.()??Ae,slot:n};if(ro(h),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:h}))}catch{}return h}let a=Xe(),s=0,u=1e5;for(;S.progress.cmp?.(Ae)>=0&&s<u&&(S.progress=S.progress.sub(Ae),S.xpLevel=S.xpLevel.add(io()),a=a.add(io()),hg(),Ar(),!(Ae.isInfinite?.()||typeof Ae.isInfinite=="function"&&Ae.isInfinite()));)s+=1;s>=u&&(S.progress=Xe()),co(),qt();let d=ao(S.xpLevel);d.finite?d.bigInt!=null?(dt=d.bigInt,ft=!1,pt=!1,mt=null):(dt=null,ft=!1,pt=!0,mt=typeof S.xpLevel?.toStorage=="function"?S.xpLevel.toStorage():null):(dt=null,ft=!0,pt=!1,mt=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:r.clone?.()??r,xpLevel:S.xpLevel.clone?.()??S.xpLevel,progress:S.progress.clone?.()??S.progress,requirement:Ae.clone?.()??Ae,slot:n};if(ro(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function Ce(){return tt(),{unlocked:S.unlocked,xpLevel:S.xpLevel.clone?.()??S.xpLevel,progress:S.progress.clone?.()??S.progress,requirement:Ae.clone?.()??Ae}}function Id(e={}){tt();let t=Tr??y(),n={...Ce(),slot:t,...e};if(ro(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function Zn(){return tt(),!!S.unlocked}function fc(e){return bd(e)}function wd(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=ao(t),r=n.bigInt;if(!n.finite)return Le.clone?.()??Le;let i;if(r!=null&&r<=mo){let a=c.fromInt(1),s=Number(r);for(let d=0;d<s;d+=1)a=a.mulDecimal("1.1",18);let u;try{u=c.fromAny(r.toString())}catch{u=c.fromInt(s)}typeof a.add=="function"?a=a.add(u):typeof u.add=="function"&&(a=u.add(a)),i=a.clone?.()??a}else i=pd(t);let l=i.clone?.()??i,o=nn.size>0?Array.from(nn):typeof Nn=="function"?[Nn]:[];for(let a of o)if(typeof a=="function")try{let s=a({baseMultiplier:l.clone?.()??l,xpLevel:t.clone?.()??t,xpUnlocked:!!S.unlocked});s instanceof c?l=s.clone?.()??s:s!=null&&(l=c.fromAny(s))}catch{}return l.clone?.()??l}function Ed(e){Nn=typeof e=="function"?e:null,nn.clear(),Nn&&nn.add(Nn),tt(),ut(!0)}function zn(){tt(),ut(!0)}function Sd(e){Fr=typeof e=="function"?e:null,Qn.clear(),Fr&&Qn.add(Fr)}function pc(e){return typeof e!="function"?()=>{}:(nn.add(e),tt(),ut(!0),()=>{nn.delete(e),tt(),ut(!0)})}function mc(e){return typeof e!="function"?()=>{}:(Qn.add(e),tt(),()=>{Qn.delete(e)})}function gc(e){po=typeof e=="function"?e:null}var uo,Mr,Wn,_r,Tr,fo,Ae,tn,Kn,Le,dt,ft,pt,mt,Nn,Fr,nn,Qn,po,hc,yg,vg,mo,yc,vc,xd,Ld,S,Pr,nt,go,bc,ho,yo,Jn=Ne(()=>{St(),et(),su(),en(),ud(),uo="ccc:xp",Mr=e=>`${uo}:unlocked:${e}`,Wn=e=>`${uo}:level:${e}`,_r=e=>`${uo}:progress:${e}`,Tr=null,fo=!1,Ae=c.fromInt(10),tn=new Map,tn.set("0",Ae),Kn=0n,Le=c.fromAny("Infinity"),dt=null,ft=!1,pt=!1,mt=null,Nn=null,Fr=null,nn=new Set,Qn=new Set,po=null,hc=5000n,yg=Math.log10(11/10),vg=Math.log10(5/2),mo=200n,yc="0.04139268515822507",vc="0.3979400086720376",xd="0.1",Ld=c.fromScientific(String(c.MAX_E)),S={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)},Pr=new Set,nt={container:null,bar:null,fill:null,xpLevelValue:null,progress:null},go=[],bc=!1,ho=null,yo=!1,typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Di,unlockXpSystem:Vi,addXp:dc,getXpState:Ce,isXpSystemUnlocked:Zn,getXpRequirementForXpLevel:fc,setExternalCoinMultiplierProvider:Ed,addExternalCoinMultiplierProvider:pc,refreshCoinMultiplierFromXpLevel:zn,setExternalXpGainMultiplierProvider:Sd,addExternalXpGainMultiplierProvider:mc,setExternalBookRewardProvider:gc,resetXpProgress:so}))}),kd={};Ze(kd,{canPerformForgeReset:()=>Pd,computeForgeGoldFromInputs:()=>Md,computePendingForgeGold:()=>Fd,getForgeDebugOverrideState:()=>vo,hasDoneForgeReset:()=>er,initResetPanel:()=>$d,initResetSystem:()=>Yi,isForgeUnlocked:()=>Cn,onForgeUpgradeUnlocked:()=>Bd,performForgeReset:()=>kc,setForgeDebugOverride:()=>Xi,setForgeResetCompleted:()=>Hi,updateResetPanel:()=>Fe});function bg(){try{ji?ji.currentTime=0:ji=new Audio(Ud),ji.play().catch(()=>{})}catch{}}function qi(){Io=null}function Nd(){try{return P.gold?.mult?.applyTo?.(_.pendingGold)??_.pendingGold}catch{return _.pendingGold}}function Ig(){for(;zi.length;){let e=zi.pop();try{e?.()}catch{}}}function Ic(){!_c&&typeof ja=="function"&&(_c=ja((e={})=>{e?.key&&e.key!==be.COINS||e?.slot!=null&&_.slot!=null&&e.slot!==_.slot||Ht()})),!Tc&&typeof oc=="function"&&(Tc=oc((e={})=>{e?.slot!=null&&_.slot!=null&&e.slot!==_.slot||(Ht(),Fe())}))}function wg(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let r=Number(n);if(Number.isFinite(r))return r}}catch{}let t=Pe(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Cd(){try{let e=Ce();if(e&&e.xpLevel)return e.xpLevel}catch{}return rn()}function Ad(e,t){if(!e||typeof e!="object"||e.isZero?.())return rn();let n=Pe(e);if(!Number.isFinite(n))return n>0?Or.fromAny("Infinity"):rn();let r=n-5;if(!Number.isFinite(r))return rn();let i=Ie(r*Math.log10(2)),l=Math.max(0,wg(t)),o=Math.max(0,(l-30)/5),a=o<=0?Nc():Ie(o*Math.log10(1.4)),s=Math.floor(r),u=s<=0?Nc():Ie(s*Math.log10(1.15)),d=Or.fromInt(10);d=d.mulBigNumInteger(i),d=d.mulBigNumInteger(a),d=d.mulBigNumInteger(u);let f=d.floorToInteger();return f.isZero?.()?rn():f}function Md(e,t){return Ad(e,t)}function _d(){if(_.slot!=null)return _.slot;let e=y();return _.slot=e,e}function Hi(e){let t=_d();if(t!=null){_.hasDoneForgeReset=!!e;try{localStorage.setItem(Zi(t),_.hasDoneForgeReset?"1":"0")}catch{}xe(Zi(t))}}function wc(e=y()){if(e==null)return null;try{let t=localStorage.getItem($r(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function vo(e=y()){return wc(e)}function Xi(e,t=y()){if(t==null)return;if(e==null){try{localStorage.removeItem($r(t))}catch{}xe($r(t));return}let n=!!e;try{localStorage.setItem($r(t),n?"1":"0")}catch{}xe($r(t))}function bo(e){let t=_d();if(t!=null){_.forgeUnlocked=!!e;try{localStorage.setItem(Gi(t),_.forgeUnlocked?"1":"0")}catch{}xe(Gi(t))}}function Ec(e){if(e==null){_.forgeUnlocked=!1,_.hasDoneForgeReset=!1,_.flagsPrimed=!1;return}try{_.forgeUnlocked=localStorage.getItem(Gi(e))==="1"}catch{_.forgeUnlocked=!1}try{_.hasDoneForgeReset=localStorage.getItem(Zi(e))==="1"}catch{_.hasDoneForgeReset=!1}_.flagsPrimed=!0}function Sc(){let e=y();if(e==null){_.flagsPrimed=!1;return}_.slot!==e&&(_.slot=e,qi(),_.flagsPrimed=!1),_.flagsPrimed||Ec(e)}function Td(e){Ac!==e&&(Ig(),Ac=e,e!=null&&(zi.push(Tt(Gi(e),{onChange(t){let n=t==="1";_.forgeUnlocked!==n&&(_.forgeUnlocked=n,Fe())}})),zi.push(Tt(Zi(e),{onChange(t){let n=t==="1";_.hasDoneForgeReset!==n&&(_.hasDoneForgeReset=n,Fe())}}))))}function Eg(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),r=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${r}`}function Ht(e=!1){let t=P.coins?.value??rn(),n=Cd(),r=Eg(t,n);!e&&Io===r||(Io=r,Lc()?_.pendingGold=Ad(t,n):_.pendingGold=rn(),Fe())}function xc(){let e=wc();return e!=null?!!e:_.forgeUnlocked||kt(ee.STARTER_COVE,U.UNLOCK_FORGE)>=1}function Lc(){try{let e=Cd();if(e&&typeof e.cmp=="function")return e.cmp(Dd)>=0}catch{}return!1}function Cn(){Sc();let e=wc();return e!=null?!!e:!!_.forgeUnlocked||xc()}function er(){return Sc(),!!_.hasDoneForgeReset}function Fd(){return Ht(),_.pendingGold.clone?.()??_.pendingGold}function Pd(){if(!Cn()||!Lc()||_.pendingGold.isZero?.())return!1;let e=P.coins?.value;return!(!e||e.isZero?.())}function Sg(){let e=rr(ee.STARTER_COVE);for(let t of e){if(!t)continue;let n=t.tieKey||t.tie;n===U.UNLOCK_XP||n===U.UNLOCK_FORGE||t.costType!=="gold"&&es(ee.STARTER_COVE,t.id,0,!0,{resetHmEvolutions:!0})}}function kc(){if(!Pd())return!1;let e=_.pendingGold.clone?.()??_.pendingGold;try{let t=P.gold?.mult?.applyTo?.(e)??e;P.gold?.add&&P.gold.add(t)}catch{}try{P.coins.set(0)}catch{}try{P.books.set(0)}catch{}try{so({keepUnlock:!0})}catch{}return Sg(),Ht(),bo(!0),_.hasDoneForgeReset||Hi(!0),Bt(),pi(),Fe(),!0}function Od(e){try{return K(e)}catch{return e?.toString?.()??"0"}}function xg(e){for(let t in _.layerButtons)_.layerButtons[t].classList.toggle("is-active",t===e)}function Lg(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer is-active" data-reset-layer="forge"><img src="${Rd}" alt=""><span>Forge</span></button></aside><div class="merchant-reset__main"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p>                 Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br>                 Increase pending Gold amount by increasing Coins and XP Level<br>                 The button below shows how much Gold you will get upon reset               </p></div><div class="merchant-reset__status" data-reset-status></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Cc}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending>0</span></button></div></div></div></div>`,_.panel=e,_.pendingEl=e.querySelector("[data-reset-pending]"),_.statusEl=e.querySelector("[data-reset-status]"),_.actionBtn=e.querySelector("[data-reset-action]"),_.mainEl=e.querySelector(".merchant-reset__main"),_.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]')},Object.entries(_.layerButtons).forEach(([t,n])=>{n&&n.addEventListener("click",()=>{xg(t),Fe()})}),_.actionBtn&&_.actionBtn.addEventListener("click",()=>{kc()&&(bg(),Fe())}),Fe()}function $d(e){!e||e.__resetInit||(e.__resetInit=!0,Lg(e))}function kg(){if(!_.actionBtn)return;let e=_.actionBtn.querySelector("[data-reset-pending]");e&&(e.innerHTML=Od(Nd()))}function Ng(){if(!_.statusEl)return;let e=_.statusEl;e.innerHTML="",Sc(),_.mainEl?.classList.toggle("is-forge-complete",!!_.hasDoneForgeReset),!_.hasDoneForgeReset&&(e.innerHTML=`<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock <span style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55);     ">Mutations</span> and a new Merchant dialogue<br> Mutated Coins will yield more Coin and XP value than normal </span>`)}function Cg(){if(!_.actionBtn)return;let e=_.actionBtn;if(!Cn()){e.disabled=!0,e.innerHTML='<span class="merchant-reset__req-msg">Unlock the Forge upgrade to access resets</span>';return}if(!Lc()){e.disabled=!0,e.innerHTML='<span class="merchant-reset__req-msg">Reach XP Level 31 to perform a Forge reset</span>';return}if(_.pendingGold.isZero?.()){e.disabled=!0,e.innerHTML='<span class="merchant-reset__req-msg">Collect more coins to earn Gold from a Forge reset</span>';return}e.disabled=!1,e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Cc}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending>${Od(Nd())}</span>`}function Fe(){_.panel&&(kg(),Ng(),Cg())}function Bd(){Yi(),bo(!0),Fe()}function Ag(){typeof window>"u"||(window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&Ht()}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;!t||t.key!==be.GOLD||t.slot!=null&&_.slot!=null&&t.slot!==_.slot||Fe()}),window.addEventListener("xp:change",()=>{Ht(),Fe()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&_.slot!=null&&e.detail.slot!==_.slot||(qi(),Ht(!0),Fe())}))}function Yi(){if(Mc){_.slot=y(),qi(),Ic(),Ht(!0);return}Mc=!0,Bt();let e=y();if(_.slot=e,qi(),Ec(e),_.hasDoneForgeReset&&!fi())try{pi()}catch{}if(!_.forgeUnlocked&&xc()&&bo(!0),Td(e),Ic(),Ag(),Ht(!0),Wi){try{Wi()}catch{}Wi=null}Wi=xa(()=>{let t=Fp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=y();if(_.slot=t,qi(),Ec(t),_.hasDoneForgeReset&&!fi())try{pi()}catch{}!_.forgeUnlocked&&xc()&&bo(!0),Td(t),Ic(),Ht(!0),Fe()})}var Or,rn,Nc,Cc,Rd,Ud,ji,Gi,Zi,$r,Dd,_,zi,Ac,Mc,Wi,Io,_c,Tc,wo=Ne(()=>{St(),et(),en(),Jn(),zr(),vi(),Or=c,rn=()=>Or.fromInt(0),Nc=()=>Or.fromInt(1),Cc="img/currencies/gold/gold.png",Rd="img/misc/forge.png",Ud="sounds/forge_reset.mp3",ji=null,Gi=e=>`ccc:reset:forge:${e}`,Zi=e=>`ccc:reset:forge:completed:${e}`,$r=e=>`ccc:debug:forgeUnlocked:${e}`,Dd=Or.fromInt(31),_={slot:null,forgeUnlocked:!1,hasDoneForgeReset:!1,pendingGold:rn(),panel:null,pendingEl:null,requirementEl:null,actionBtn:null,statusEl:null,layerButtons:{},flagsPrimed:!1},zi=[],Ac=null,Mc=!1,Wi=null,Io=null,_c=null,Tc=null,typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Yi,performForgeReset:kc,computePendingForgeGold:Fd}))}),Vd={};Ze(Vd,{AREA_KEYS:()=>ee,HM_EVOLUTION_INTERVAL:()=>ht,MAX_LEVEL_DELTA:()=>Gr,UPGRADE_TIES:()=>U,approxLog10BigNum:()=>Pe,bigNumFromLog10:()=>Ie,buyMax:()=>rl,buyOne:()=>_o,buyTowards:()=>df,clearPermanentUpgradeUnlock:()=>Yd,computeDefaultUpgradeCost:()=>Zd,computeUpgradeEffects:()=>ff,costToBuyOne:()=>Hg,estimateFlatBulk:()=>Yc,estimateGeometricBulk:()=>Rg,evaluateBulkPurchase:()=>il,evolveUpgrade:()=>uf,formatMultForUi:()=>xt,getCurrentAreaKey:()=>To,getHmEvolutions:()=>Kc,getHmNextMilestoneLevel:()=>jg,getIconUrl:()=>ts,getLevel:()=>gt,getLevelNumber:()=>kt,getMagnetLevel:()=>of,getMpValueMultiplierBn:()=>Qc,getUpgrade:()=>un,getUpgradeLockState:()=>Yr,getUpgradesForArea:()=>rr,markUpgradePermanentlyUnlocked:()=>Qi,normalizeBigNum:()=>Gg,onUpgradesChanged:()=>Yg,peekNextPrice:()=>sf,setLevel:()=>es,upgradeUiModel:()=>jr});function Mg(e){try{let t=qr(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),r=c.fromAny(e.costAtLevel?.(1)??0),i=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(r)===0&&n.cmp(i)===0)}catch{return!1}}function qd(e,t){if(!Mg(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let r=Pe(n);return Number.isFinite(r)&&r>=mf}catch{return!1}}function Pe(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),r=n[2]??"0",i=n[3]??"0",l="0",o=i.indexOf("^");o>=0&&(l=i.slice(o+1)||"0",i=i.slice(0,o)||"0");let a=Number(i||"0"),s=Number(l||"0"),u=Number(r||"0");if(!Number.isFinite(u)||u<=0)return Number.NEGATIVE_INFINITY;let d=(Number.isFinite(a)?a:0)+(Number.isFinite(s)?s:0);return Math.log10(u)+d}function Ie(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),r=e-n;r<0&&(r+=1,n-=1);let i=Math.pow(10,r+(t-1)),l=BigInt(Math.max(1,Math.round(i))),o=n-(t-1);return new c(l,o,t)}function Eo(e){return bf[e]??0}function Fc(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Br(e,t){let n=Xt(e||t?.area);if(!n)return null;let r=ln(t?.tie??t?.tieKey);if(r)return`${n}:${r}`;let i=ze(t?.id),l="";if(typeof i=="number"){if(!Number.isFinite(i))return null;l=String(Math.trunc(i))}else if(typeof i=="string"){let o=i.trim();if(!o)return null;l=o}else return null;return`${n}:${l}`}function Ki(e,t){let n=Xt(e||t?.area);if(!n)return null;let r=ze(t?.id);if(r==null)return null;if(typeof r=="number")return Number.isFinite(r)?`${n}:${Math.trunc(r)}`:null;let i=String(r).trim();return i?`${n}:${i}`:null}function Rr(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function Pc(e=y()){let t=String(e??"default");if(ol.has(t))return ol.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let r=localStorage.getItem(`${rs}:${t}`);if(r){let i=JSON.parse(r);i&&typeof i=="object"&&(n={upgrades:i.upgrades&&typeof i.upgrades=="object"?i.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),ol.set(t,n),n}function Oc(e,t=y()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),ol.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${rs}:${n}`,JSON.stringify(e))}catch{}}function So(e=y()){let t=String(e??"default");if(al.has(t))return al.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let r=localStorage.getItem(`${is}:${t}`);if(r){let i=JSON.parse(r);i&&typeof i=="object"&&(n={upgrades:i.upgrades&&typeof i.upgrades=="object"?i.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),al.set(t,n),n}function xo(e,t=y()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),al.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${is}:${n}`,JSON.stringify(e))}catch{}}function $c(e=y()){let t=String(e??"default");if(cl.has(t))return cl.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let r=localStorage.getItem(`${ls}:${t}`);if(r){let i=JSON.parse(r);i&&typeof i=="object"&&(n={upgrades:i.upgrades&&typeof i.upgrades=="object"?i.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),cl.set(t,n),n}function Bc(e,t=y()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),cl.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${ls}:${n}`,JSON.stringify(e))}catch{}}function Hd(e,t,n=y()){let r=Br(e,t);if(!r)return;let i=Ki(e,t),l=$c(n);l.upgrades[r]||(l.upgrades[r]=!0,i&&l.upgrades[i]&&delete l.upgrades[i],Bc(l,n))}function Xd(e,t,n=y()){let r=Br(e,t);if(!r)return!1;let i=Ki(e,t),l=$c(n);return l.upgrades[r]?!0:i&&l.upgrades[i]?(l.upgrades[r]=l.upgrades[i],delete l.upgrades[i],Bc(l,n),!0):!1}function Qi(e,t,n=y()){let r=Br(e,t);if(!r)return;let i=Ki(e,t),l=So(n);l.upgrades[r]||(l.upgrades[r]=!0,i&&l.upgrades[i]&&delete l.upgrades[i],xo(l,n))}function Yd(e,t,n=y()){let r=Br(e,t);if(!r)return;let i=So(n);i.upgrades[r]&&(delete i.upgrades[r],xo(i,n));let l=Pc(n);(!l.upgrades[r]||l.upgrades[r].status!=="locked")&&(l.upgrades[r]={status:"locked"},Oc(l,n));let o=typeof t?.id<"u"?t.id:t;o!=null&&sn(e,o,n),Yt()}function Rc(e,t,n=y()){let r=Br(e,t);if(!r)return!1;let i=Ki(e,t),l=So(n);return l.upgrades[r]?!0:i&&l.upgrades[i]?(l.upgrades[r]=l.upgrades[i],delete l.upgrades[i],xo(l,n),!0):!1}function tr(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=ln(t?.tie??t?.tieKey),r=e?.areaKey||ee.STARTER_COVE;if(!n||!gf.has(n))return{locked:!0,iconOverride:Pt,useLockedBase:!0};let i=0;try{i=t&&typeof t.id<"u"?kt(r,t.id):0}catch{}if(i>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let l=!1;try{l=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:Uc()}catch{}function o(){if(jd())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let s="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:dn,titleOverride:jt,descOverride:s,reason:s,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===U.UNLOCK_XP)return o();if(n===U.UNLOCK_FORGE){if(!l)return{locked:!0,iconOverride:Pt,useLockedBase:!0};let s=!1;try{let u=Ur();s=fe(u)>=31}catch{}if(!s){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:dn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:jt,descOverride:u,reason:u}}return{locked:!1}}if(er()||Rc(r,t)){try{Qi(r,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!l)return{locked:!0,iconOverride:Pt,useLockedBase:!0};if(Xd(r,t)){let s="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:dn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:jt,descOverride:s,reason:s}}let a=!1;try{let s=Ur();a=fe(s)>=31}catch{}if(!a){let s="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Pt,useLockedBase:!0,titleOverride:ir,descOverride:s,reason:s,hidden:!1,hideCost:!1,hideEffect:!1}}try{Hd(r,t)}catch{}return{locked:!0,iconOverride:dn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function Xt(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function ln(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function _g(e,t){let n=ln(t?.tie??t?.tieKey);if(n&&hf.has(n))return!0;let r=ze(t?.id),i=typeof r=="number"?r:Number.parseInt(r,10),l=Number.isFinite(i)?String(i):r!=null?String(r):"";if(!l)return!1;let o=[];e!=null&&o.push(e),t?.area!=null&&o.push(t.area);for(let a of o){let s=Xt(a);if(s&&yf.has(`${s}:${l}`))return!0}return!1}function Uc(){try{return!!Zn()}catch{return!1}}function jd(e=y()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${vf}:${t}`)==="1"}catch{return!1}}function Ur(){try{let e=typeof Ce=="function"?Ce():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function Dc(e){let t=$e(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let r=Math.max(0,Number(n));return Ie(r*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function Dr(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function Ji(e){let t=Dr(e);if(t<=0)return c.fromInt(1);try{let n=BigInt(t)+1n;return c.fromAny(n.toString())}catch{try{return c.fromAny(String(t+1))}catch{return c.fromInt(1)}}}function Vc(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let r=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let i of r)t[i]!==void 0&&(n[i]=t[i]);return n}function ze(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function $e(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=t.toPlainIntegerString?.();if(n==="Infinity")return c.fromAny("Infinity");if(!n)return c.fromInt(0);let r=n.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function fe(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=t.toPlainIntegerString?.();if(!n||n==="Infinity")return n==="Infinity"?Number.MAX_VALUE:0;let r=n.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),l=Number(i),o=i.length;if(!Number.isFinite(l)||l<=0)return 0;let a=l/Math.pow(10,o-1),s=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),s+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),s-=d)}if(s>308)return Number.MAX_VALUE;if(s<-324)return 0;let u=a*Math.pow(10,s);return Number.isFinite(u)?u:s>0?Number.MAX_VALUE:0}catch{let n=Pe(t);if(!Number.isFinite(n)||n>308)return Number.MAX_VALUE;if(n<-324)return 0;let r=Math.pow(10,n);return Number.isFinite(r)?r:Number.MAX_VALUE}}function Tg(e,t){let n=$e(e),r=$e(t);if(n.isInfinite?.())return r.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(r.isInfinite?.())return c.fromInt(0);try{let i=n.toPlainIntegerString?.(),l=r.toPlainIntegerString?.();if(!i||!l)return c.fromInt(0);if(i==="Infinity")return c.fromAny("Infinity");if(l==="Infinity"||i===l)return c.fromInt(0);let o=BigInt(i)-BigInt(l);return o<=0n?c.fromInt(0):c.fromAny(o.toString())}catch{return c.fromInt(0)}}function Gd(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function Zd(e,t,n="NM"){let r;try{r=c.fromAny(e??0)}catch{r=c.fromInt(0)}let i=0;try{if(t instanceof c){let u=t.toPlainIntegerString?.();u&&u!=="Infinity"&&(i=Number.parseInt(u,10))}else i=Number(t)||0}catch{i=0}let l={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let u=Math.max(0,Math.floor(i/ht));Number.isFinite(u)&&(l.numUpgEvolutions=u)}let o=Qd(l),a=Number.isFinite(o?.ratio)?o.ratio:1,s={baseBn:r,baseLog10:Pe(r),ratio:a,ratioMinus1:Math.max(0,a-1),ratioLog10:Math.log10(Math.max(a,1)),ratioLn:Math.log(Math.max(a,1)),ratioStr:Gd(Math.max(a,1)),defaultPreset:o?.preset};return l.scaling=s,No(l,i)}function Vr(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function qc(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:Vr(e.numUpgEvolutions)}function zd(e){let t=Vr(e),n=ht*(t+1),r=c.fromAny(n);return{cap:n,capBn:r,capFmtHtml:An(r),capFmtText:Hr(r)}}function Wd(e,t){if(!e||typeof t!="number")return 0;try{let n=e.toPlainIntegerString?.();if(!n||n==="Infinity")return 0;let r=BigInt(n),i=BigInt(Math.max(0,Math.floor(t))),l=BigInt(ht);if(r<i)return 0;let o=(r-i)/l;return Number(o+1n)}catch{let n=fe(e);if(!Number.isFinite(n)||n<t)return 0;let r=n-t;return Math.max(0,Math.floor(r/ht)+1)}}function Fg(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let r=n.clone?.()??n;for(let i=1;i<t;i+=1)try{r=r.mulBigNumInteger(n)}catch{try{r=r.mulDecimal(String(n),18)}catch{return c.fromAny("Infinity")}}return r}function Hc(e,t=ll){let n=e?.hmMilestones;if(Array.isArray(n))return n;if(!n||typeof n!="object")return[];let r=Xt(t||e?.area||ll);if(r){if(Array.isArray(n[r]))return n[r];if(Array.isArray(n[t]))return n[t]}return Array.isArray(n.default)?n.default:[]}function Ft(e,t){let n=e instanceof c?e:c.fromAny(e??1),r=t instanceof c?t:null;if(!r)try{r=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(r)}catch{}try{return n.mulDecimal(r.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function Lo(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:r,capFmtHtml:i,capFmtText:l}=zd(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=r,e.lvlCapFmtHtml=i,e.lvlCapFmtText=l}function ko(e,t,n=ll){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let r=Hc(e,n),i=c.fromInt(1),l=c.fromInt(1),o=c.fromInt(1),a=c.fromInt(1);for(let u of r){let d=Wd(t,Number(u?.level??u?.lvl??0));if(!(d>0))continue;let f=Fg(u.multiplier??u.mult??u.value??1,d),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?l=Ft(l,f):p==="coin"||p==="coins"?o=Ft(o,f):p==="mp"?a=Ft(a,f):i=Ft(i,f)}let s=qc(e);for(let u=0;u<s;u+=1)i=Ft(i,pf);return{selfMult:i,xpMult:l,coinMult:o,mpMult:a}}function Kd(e,t,n=ll){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let r=Hc(e,n);if(!r.length)return null;let i=null;for(let l of r){let o=Math.max(0,Math.floor(Number(l?.level??l?.lvl??0))),a=Wd(t,o),s=null;try{let u=BigInt(o),d=BigInt(Math.max(0,a)),f=u+BigInt(ht)*d;f>0n&&(s=c.fromAny(f.toString()))}catch{}if(!s){let u=c.fromAny(ht*Math.max(0,a));try{s=u.add(c.fromAny(o))}catch{s=c.fromAny(o+ht*a)}}if(s){if(t?.cmp?.(s)>=0)try{s=s.add(c.fromAny(ht))}catch{}(!i||i.cmp(s)>0)&&(i=s)}}return i}function Qd(e){if(!e)return null;let t=n=>{let r=`${n??""}`.toUpperCase();if(!r)return null;let i=os[r];if(typeof i!="function")return null;let l=i(e);return!Number.isFinite(l)||l<=0?null:{ratio:l,preset:r}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function qr(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),r=e.scaling??{},i=Number(r.ratio);(!(i>0)||!Number.isFinite(i))&&(i=null);let l=typeof r.ratioStr=="string"?r.ratioStr.trim():"";if(!i&&l){let f=Number(l);Number.isFinite(f)&&f>0&&(i=f)}let o=Number(r.ratioLog10);if(Number.isFinite(o)||(o=null),!i&&o!=null){let f=Math.pow(10,o);Number.isFinite(f)&&f>0&&(i=f)}let a=Number(r.ratioLn);if(Number.isFinite(a)||(a=null),!i&&a!=null){let f=Math.exp(a);Number.isFinite(f)&&f>0&&(i=f)}if(!i){let f=Number(r.ratioMinus1);Number.isFinite(f)&&f>0&&(i=f+1)}let s=null;if(!i){let f=Qd(e);f&&(i=f.ratio,s=f.preset)}if(i>1){i=Number(i),l=Gd(i),o=Math.log10(i),a=Math.log(i);var t=Math.max(1e-12,i-1)}else{i=1,l="1",o=0,a=0;var t=0}let u=Pe(n),d=Object.assign({},r,{baseBn:n,baseLog10:u,ratio:i,ratioMinus1:t,ratioLog10:o,ratioLn:a,ratioStr:l,defaultPreset:s??r.defaultPreset});e.scaling=d;try{let f=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),h=c.fromAny(e.costAtLevel?.(32)??0);f.cmp(p)===0&&f.cmp(h)===0&&(d.ratio=1,d.ratioMinus1=0,d.ratioLog10=0,d.ratioLn=0,d.ratioStr="1")}catch{}return d}catch{return null}}function No(e,t){let n=qr(e);if(!n)return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0));if(r===0)return c.fromAny(n.baseBn);if(r<=100){let i=c.fromAny(n.baseBn);for(let l=0;l<r;l+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}if(r<1e4){let i=Math.max(0,r-10),l=Ie(n.baseLog10+i*n.ratioLog10);for(let o=i;o<r;o+=1)l=l.mulDecimal(n.ratioStr);return l.floorToInteger()}return Ie(n.baseLog10+r*n.ratioLog10).floorToInteger()}function Pg(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function on(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let r=qr(e);if(!r)return Number.NEGATIVE_INFINITY;if(!(r.ratioMinus1>0)||!Number.isFinite(r.ratioLn))return Number.POSITIVE_INFINITY;let i=r.baseLog10*ul+t*r.ratioLn,l=r.ratioLn*n,o=Pg(l);if(!Number.isFinite(o))return Number.POSITIVE_INFINITY;let a=Math.log(r.ratioMinus1);return(i+o-a)/ul}function Xc(e,t,n){if(!(n>0))return c.fromInt(0);let r=qr(e);if(!r)return c.fromInt(0);let i=t+n;if(i<=100){let o=c.fromAny(e.costAtLevel(t)),a=c.fromInt(0);for(let s=0;s<n;s+=1)a=a.add(o),s+1<n&&(o=o.mulDecimalFloor(r.ratioStr));return a}if(i<1e4){let o=Math.min(10,n),a=n-o,s=c.fromInt(0);if(a>0){let u=on(e,t,a);s=s.add(Ie(u))}if(o>0){let u=t+a,d=c.fromAny(e.costAtLevel(u));for(let f=0;f<o;f+=1)s=s.add(d),f+1<o&&(d=d.mulDecimalFloor(r.ratioStr))}return s}let l=on(e,t,n);return Ie(l)}function Og(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/ul;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/ul:e>0?e:0}function Jd(e){if(!(e>0)||!Number.isFinite(e))return e;if($o[0]=e,$o[0]<=0)return 0;wf[0]-=1n;let t=$o[0];return t>0?t:0}function $g(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=Jd(e);return n<e?n:e>1?e/2:0}function Co(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function Ao(e,t,n,r=Gr,i={}){let l=qr(e),o=c.fromInt(0),a=!!(i||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!l)return{count:o,spent:o,nextPrice:o,numericCount:0};let s=Math.max(0,Math.floor(fe(t))),u=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof r=="number"?r:fe(r),f=Number.isFinite(u)?Math.max(0,u-s):Oo,p=Number.isFinite(d)?Math.max(0,Math.floor(d)):Oo;if(p=Math.min(p,Oo,f),!(p>0)){let $=f<=0?o:c.fromAny(e.costAtLevel(s));return{count:o,spent:o,nextPrice:$,numericCount:0}}let h=100-s;if(Number.isFinite(s)&&h>0){let $=Math.min(p,h),q=c.fromAny(e.costAtLevel(s)),j=o,W=0;for(;W<$;){q=c.fromAny(e.costAtLevel(s+W));let F=j.add(q);if(F.cmp(n)>0)break;j=F,W+=1}let ve=s+W,re=Number.isFinite(u)&&ve>=u,X=Co(W);if(W<$||re||p<=W){let F=re?o:c.fromAny(e.costAtLevel(ve));return{count:X,spent:j,nextPrice:F,numericCount:W}}let N=(()=>{try{return an(t??s,s).add(X)}catch{return s+W}})(),D=Ao(e,N,n.sub(j),p-W,i),V=D?.count instanceof c?D.count:Co(D?.numericCount??0),G=X.add(V),Ve=(D?.spent??o).add(j);return{count:G,spent:Ve,nextPrice:D?.nextPrice??o,numericCount:W+(D?.numericCount??0)}}let g=Pe(n),v=l.ratioLog10,m=l.ratioMinus1,b=c.fromAny(e.costAtLevel(s)),w=l.baseLog10+s*v;if(m>0&&(!Number.isFinite(g)||Math.abs(g)>1e6&&Math.abs(w)>1e6)){let $=c.fromAny(e.costAtLevel(s));if(n.cmp($)<0)return{count:o,spent:o,nextPrice:$,numericCount:0};let q=Number.isFinite(p)?Math.max(1,Math.floor(p)):Number.MAX_VALUE,j=1,W=1;for(;W<q;){let V=on(e,s,W);if(Ie(V).cmp(n)<=0){let G=W*2;if(!Number.isFinite(G)||G<=W){W=q;break}j=W,W=Math.min(G,q)}else break}let ve=0;for(;j<W&&ve<256;){let V=Math.max(j+1,Math.floor((j+W+1)/2)),G=on(e,s,V);Ie(G).cmp(n)<=0?j=V:W=V-1,ve++}let re=Math.max(1,j),X=Co(re),N=o,D=o;if(!a)if(N=Xc(e,s,re),Number.isFinite(u)){let V=Math.max(0,Math.floor(u-Math.min(s,u)));re>=V?D=o:D=Ie(w+re*v)}else D=Ie(w+re*v);return{count:X,spent:N,nextPrice:D,numericCount:re}}if(n.cmp(b)<0)return{count:o,spent:o,nextPrice:b,numericCount:0};let L=!1,T=null,x=null;try{T=c.fromAny(e.costAtLevel(s+1))}catch{}try{let $=Math.min(Number.isFinite(u)?Math.max(s+1,Math.floor(u)):s+32,s+32);x=c.fromAny(e.costAtLevel($))}catch{}!L&&!(l.ratioMinus1>0)&&(L=!0),T&&x&&(L=T.cmp(b)===0&&x.cmp(b)===0),!L&&!(l.ratioMinus1>0)&&(L=!0);let B=Number.isFinite(p)?Math.max(0,Math.floor(p)):Number.MAX_VALUE;if(L){let $=an(e.lvlCapBn??"Infinity","Infinity"),q=an(t??0,0),j=$.isInfinite?.()?c.fromAny("Infinity"):$.sub(q).floorToInteger(),{count:W,countBn:ve,spent:re,nextPrice:X}=Yc(b,n,j);return{count:ve,spent:re,nextPrice:X,numericCount:W}}if(!(v>0)||!(m>0)){let $=an(e.lvlCapBn??"Infinity","Infinity"),q=an(t??0,0),j=$.isInfinite?.()?c.fromAny("Infinity"):$.sub(q).floorToInteger(),{count:W,countBn:ve,spent:re,nextPrice:X}=Yc(b,n,j);return{count:ve,spent:re,nextPrice:X,numericCount:W}}let M=Math.log10(m);if(!Number.isFinite(M))return{count:o,spent:o,nextPrice:b,numericCount:0};let R=Og(g+M-w)/v;(!Number.isFinite(R)||R<0)&&(R=0);let k=Math.floor(Math.min(B,R));Number.isFinite(k)||(k=B),k<=0&&(k=1);let H=1e-7,J=on(e,s,k),se=0,ke=2048;for(;k>0&&(!Number.isFinite(J)||J>g+H)&&se<ke;){let $=Number.isFinite(J)?Math.max(1,Math.ceil((J-g)/Math.max(v,1e-12))):Math.max(1,Math.floor(k/2)),q=Math.max(0,Math.floor(k-$));if(q<k)k=q;else{let j=Jd(k);if(!(j<k))break;k=j}J=k>0?on(e,s,k):Number.NEGATIVE_INFINITY,se+=1}if(k<=0||!Number.isFinite(k))if(n.cmp(b)>=0)k=1,J=Pe(b);else return{count:o,spent:o,nextPrice:b,numericCount:0};if(k<B){let $=X=>{let N=X*2;return Number.isFinite(N)?N:Number.MAX_VALUE},q=k,j=Math.min(B,Math.max(k+1,$(k))),W=on(e,s,j);for(;q<j&&Number.isFinite(W)&&W<=g+H&&j<B;)q=j,j=Math.min(B,$(j)),W=on(e,s,j);let ve=q,re=j;for(let X=0;X<256&&ve<re;X+=1){let N=Math.floor((ve+re+1)/2),D=on(e,s,N);Number.isFinite(D)&&D<=g+H?(ve=N,J=D):re=N-1}k=ve}let Y=null;if(!a){Y=Xc(e,s,k);let $=0;for(;Y.cmp(n)>0&&k>0&&$<ke;){let q=$g(k);if(!(q<k))break;k=q,Y=Xc(e,s,k),$+=1}if(k<=0)return{count:o,spent:o,nextPrice:b,numericCount:0};if(k<B&&$<ke)for(;k<B&&$<ke;){let q=s+k,j;try{if(Number.isFinite(q)&&q<Number.MAX_SAFE_INTEGER/2)j=c.fromAny(e.costAtLevel(q));else{let ve=w+k*v;j=Ie(ve).floorToInteger()}}catch{break}let W=Y.add(j);if(W.cmp(n)>0)break;Y=W,k+=1,$+=1}}let ie=o,te=!a&&Number.isFinite(s)&&Number.isFinite(k)&&s<Number.MAX_SAFE_INTEGER/2&&k<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(u)){let $=Math.max(0,Math.floor(u-Math.min(s,u)));if(k>=$)ie=o;else if(te){let q=Math.floor(s+k);ie=c.fromAny(e.costAtLevel(q))}else{let q=w+k*v;ie=Ie(q)}}else if(te){let $=Math.floor(s+k);ie=c.fromAny(e.costAtLevel($))}else{let $=w+k*v;ie=Ie($)}return{count:Co(k),spent:Y,nextPrice:ie,numericCount:k}}function Bg(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),r=Pe(t),i=Pe(n);if(!Number.isFinite(r)||!Number.isFinite(i))return null;let l=i-r;if(!Number.isFinite(l)||l<=0)return null;let o=Math.pow(10,l);if(!Number.isFinite(o)||o<=1)return null;let a=o-1;return!(a>0)||!Number.isFinite(a)?null:{ratio:o,ratioLog:l,logDenom:Math.log10(a)}}catch{return null}}function Yc(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let r=t.toPlainIntegerString?.(),i=e.toPlainIntegerString?.();if(r&&r!=="Infinity"&&i&&i!=="Infinity"){let d=BigInt(r)/BigInt(i),f=c.fromAny(d.toString());!n.isInfinite?.()&&f.cmp(n)>0&&(f=n);let p=e.mulBigNumInteger(f);return{count:jc(f),countBn:f,spent:p,nextPrice:e}}let l=Pe(t),o=Pe(e);if(!Number.isFinite(l)||!Number.isFinite(o)||l<o)return{count:0};let a=Ie(l-o).floorToInteger();!n.isInfinite?.()&&a.cmp(n)>0&&(a=n);let s=e.mulBigNumInteger(a),u=e;return{count:jc(a),countBn:a,spent:s,nextPrice:u}}function Rg(e,t,n,r){if(!n||r<=0)return{count:0};let i=Pe(t),l=Pe(e);if(!Number.isFinite(i)||!Number.isFinite(l))return{count:0};if(i<l)return{count:0};let o=i-l+n.logDenom;if(!Number.isFinite(o)||o<=0)return{count:0};let a=Math.floor(o/n.ratioLog);if(!Number.isFinite(a)||a<=0)return{count:0};if(a=Math.min(a,r),a<=0)return{count:0};let s=0,u=a;for(let v=0;v<64&&s<u;v+=1){let m=Math.max(0,Math.floor((s+u+1)/2));l+m*n.ratioLog-n.logDenom<=i?s=m:u=m-1}let d=Math.min(s,r);if(d<=0)return{count:0};let f=l+d*n.ratioLog-n.logDenom;if(f>i)return{count:0};let p=l+d*n.ratioLog,h=Ie(f),g=Ie(p);return{count:d,spent:h,nextPrice:g,spentLog:f,nextPriceLog:p}}function an(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function jc(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function An(e){return K(e instanceof c?e:c.fromAny(e??0))}function xt(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=Pe(e);if(Number.isFinite(n)&&n<3){let r=Math.pow(10,n);return String(r.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return K(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):K(t)}catch{return"1"}}function Hr(e){return An(e).replace(/<[^>]*>/g,"")}function Mo(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Xr(e,t,n,r,i){if(!e||typeof e.onLevelChange!="function")return;let l=Mo(n??t??0),o=Mo(i??r??0),a={upgrade:e,oldLevel:Number.isFinite(t)?t:fe(l),newLevel:Number.isFinite(r)?r:fe(o),oldLevelBn:l,newLevelBn:o};try{e.onLevelChange(a)}catch{}}function Lt(e,t){return No(e,t)}function Gc(e){let t=P?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(Uc())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=kt(ee.STARTER_COVE,U.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=Dc(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function Ug(e){let t=Xt(e);if(!t)return null;if(Uo.has(t))return Uo.get(t);let n=new Map,r=0;for(let i of dl){if(Xt(i?.area)!==t)continue;let l=ze(i?.id);l==null||n.has(l)||(n.set(l,r),r+=1)}return Uo.set(t,n),n}function el(e,t){if(!Array.isArray(t)||t.length<=1)return!1;let n=Ug(e);if(!n?.size)return!1;let r=n.size,i=t.map((o,a)=>{let s=ze(o?.id),u=n.has(s)?n.get(s):r+a;return{rec:o,rank:u,idx:a}}),l=!1;for(let o=1;o<i.length;o+=1){let a=i[o-1],s=i[o];if(s.rank<a.rank||s.rank===a.rank&&s.idx<a.idx){l=!0;break}}if(!l)return!1;i.sort((o,a)=>o.rank-a.rank||o.idx-a.idx),t.length=0;for(let o of i)t.push(o.rec);return!0}function Zc(e){if(typeof e!="string"||!e)return null;try{let t=JSON.parse(e);return Array.isArray(t)?t:null}catch{return null}}function ef(e,t={}){let{includeLocal:n=!0}=t||{},r={data:null,raw:null,storageChecked:!1,storageFound:!1,checkedLocal:!1,foundLocal:!1,sourceType:null};if(!e)return r;let i=[];try{n&&typeof localStorage<"u"&&(i.push({storage:localStorage,type:"local"}),r.storageChecked=!0,r.checkedLocal=!0)}catch{}for(let l of i){let{storage:o,type:a}=l||{},s=o?.getItem;if(typeof s!="function")continue;let u;try{u=s.call(o,e)}catch{u=null}u!=null&&(r.storageFound=!0,a==="local"&&(r.foundLocal=!0));let d=Zc(u);if(d){let f=typeof u=="string"&&u?u:(()=>{try{return JSON.stringify(d)}catch{return null}})();return r.data=d,r.raw=f,r.sourceType=a,r}}return r}function tl(e,t,n){e&&(Array.isArray(t)&&Ro.set(e,t),typeof n=="string"&&Bo.set(e,n))}function nl(e){e&&(Ro.delete(e),Bo.delete(e))}function zc(e,t){let n=`${t==null?"null":String(t)}:${e}:`;for(let r of Zr.keys())r.startsWith(n)&&Zr.delete(r)}function Wc(e,t=y()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Dg(){Do.forEach(e=>{try{e?.()}catch{}}),Do.clear()}function Vg(e,t,n,r,i={}){if(!n)return;let{rawChanged:l,valueChanged:o}=i;if(!(!l&&!o)){try{if(typeof r=="string"){let a=Zc(r);a?tl(n,a,r):nl(n)}else nl(n)}catch{nl(n)}zc(e,t),Yt()}}function tf(e){if(e!==cs&&(Dg(),cs=e??null,e!=null))for(let t of Object.values(ee)){let n=Wc(t,e);if(!n)continue;let r=Tt(n,{parse:i=>typeof i=="string"?i:null,onChange:(i,l)=>{!l?.rawChanged&&!l?.valueChanged||Vg(t,e,n,i,l)}});Do.set(n,r)}}function nf(e,t=y(),n={}){let{forceReload:r=!1}=n||{},i=Wc(e,t);if(!i)return[];let l=`${i}:backup`,o=ef(i,{includeLocal:!0}),a=ef(l,{includeLocal:!0});if(o.storageChecked&&!o.storageFound&&a.data){try{typeof localStorage<"u"&&localStorage.removeItem(l)}catch{}return nl(i),zc(e,t),[]}if(o.data){if(el(e,o.data)?nr(e,o.data,t):tl(i,o.data,o.raw),a.storageFound)try{typeof localStorage<"u"&&localStorage.removeItem(l)}catch{}return o.data}if(a.data){el(e,a.data)?nr(e,a.data,t):tl(i,a.data,a.raw);try{if(typeof localStorage<"u"){let d=a.raw??JSON.stringify(a.data);localStorage.setItem(i,d),localStorage.removeItem(l)}}catch{}return a.data}try{typeof localStorage<"u"&&localStorage.removeItem(l)}catch{}let s=o.storageChecked||a.storageChecked,u=o.storageFound||a.storageFound;if(!r&&!s){let d=Ro.get(i);if(Array.isArray(d))return el(e,d),d;let f=Bo.get(i),p=Zc(f);if(p)return el(e,p)?nr(e,p,t):tl(i,p,f),p}return u||(nl(i),zc(e,t)),[]}function nr(e,t,n=y()){let r=Wc(e,n);if(!r)return;let i=Array.isArray(t)?t:[];el(e,i);let l=null;try{l=JSON.stringify(i)}catch{try{l=JSON.stringify([])}catch{l="[]"}}tl(r,i,l);try{if(typeof localStorage<"u"){localStorage.setItem(r,l);try{xe(r,l)}catch{}}}catch{}try{if(localStorage.getItem(r)!==l){localStorage.setItem(r,l);try{xe(r,l)}catch{}}}catch{}try{typeof localStorage<"u"&&localStorage.removeItem(`${r}:backup`)}catch{}}function rf(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return ze(t.id);let n=ze(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let r=ln(n);if(r){let i=Fo.get(r);if(i){let l=Xt(e);if(!l||Xt(i.area)===l)return ze(i.id)}}}return n}function lf(e,t,n=y()){let r=n==null?"null":String(n),i=rf(e,t);return`${r}:${e}:${ze(i)}`}function cn(e,t){let n=rf(e,t),r=ze(n),i=y(),l=lf(e,r,i),o=Zr.get(l);if(o)return o;let a=un(e,r),s=nf(e,i),u=s.find(w=>w&&ze(w.id)===r),d=!1;if(u)u.id!==r&&(u.id=r,d=!0);else{if(u={id:r,lvl:c.fromInt(0).toStorage()},a)try{u.nextCost=c.fromAny(a.costAtLevel(0)).toStorage()}catch{u.nextCost=c.fromInt(0).toStorage()}u.nextCostLvl=u.lvl,s.push(u),nr(e,s,i)}let f=0;a?.upgType==="HM"&&(f=Vr(u.hmEvolutions??u.evolutions??u.evol??a.numUpgEvolutions),Lo(a,f));let p=$e(u.lvl),h=fe(p);try{let w=a?.lvlCapBn??c.fromAny("Infinity");if(!w.isInfinite?.()&&p.cmp(w)>0){let L=w.clone?.()??w;h=fe(L);let T=L.toStorage();u.lvl=T,u.nextCost=c.fromInt(0).toStorage(),u.nextCostLvl=T,nr(e,s,i)}}catch{}let g=null;try{g=p?.toStorage?.()??$e(h).toStorage()}catch{}g&&u.lvl!==g&&(u.lvl=g,d=!0);let v=typeof u.nextCostLvl=="string"?u.nextCostLvl:null,m=!v||v!==g,b=null;if(!m&&u.nextCost!=null)try{b=c.fromAny(u.nextCost)}catch{b=null,m=!0}if(!b||m){if(a)try{b=c.fromAny(a.costAtLevel(h))}catch{b=c.fromInt(0)}else b=c.fromInt(0);try{u.nextCost=b.toStorage(),g?u.nextCostLvl=g:delete u.nextCostLvl,d=!0}catch{}}if(d)try{nr(e,s,i)}catch{}if(a?.upgType==="HM"&&p?.isInfinite?.()&&!a.lvlCapBn?.isInfinite?.()){let w=c.fromAny("Infinity");a.lvlCapBn=w,a.lvlCap=Number.POSITIVE_INFINITY,a.lvlCapFmtHtml=An(w),a.lvlCapFmtText=Hr(w)}return o={areaKey:e,upgId:r,upg:a,rec:u,arr:s,lvl:h,lvlBn:p,nextCostBn:b,slot:i,hmEvolutions:f},Zr.set(l,o),o}function Mn(e){if(!e)return;let{areaKey:t}=e,n=e.slot??y();if(!t||n==null)return;let r=ze(e.upgId??e.rec?.id),i=nf(t,n,{forceReload:!0});Array.isArray(i)||(i=[]);let l=i.find(a=>a&&ze(a.id)===r);l?l.id!==r&&(l.id=r):(l={id:r},i.push(l));try{let a=e.upg?.lvlCapBn??c.fromAny("Infinity"),s=e.lvlBn?.clone?.()??$e(e.lvlBn??e.lvl);!a.isInfinite?.()&&s.cmp(a)>0&&(s=a.clone?.()??a,e.lvlBn=s,e.lvl=fe(s))}catch{}try{l.lvl=e.lvlBn?.toStorage?.()??$e(e.lvlBn??e.lvl).toStorage()}catch{l.lvl=$e(e.lvl??0).toStorage()}let o=l.lvl;if(e.nextCostBn!=null){try{l.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{l.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{l.nextCost=c.fromInt(0).toStorage()}}l.nextCostLvl=o}else delete l.nextCostLvl;e.hmEvolutions!=null&&(l.hmEvolutions=Vr(e.hmEvolutions)),nr(t,i,n),e.rec=l,e.arr=i,e.slot=n}function sn(e,t,n=y()){Zr.delete(lf(e,t,n))}function kt(e,t){return cn(e,t).lvl}function Kc(e,t){return cn(e,t).hmEvolutions??0}function Qc(){let e=Ji(kt(ee.STARTER_COVE,U.MP_VALUE_I));try{let t=un(ee.STARTER_COVE,U.ENDLESS_XP),n=gt(ee.STARTER_COVE,U.ENDLESS_XP),{mpMult:r}=ko(t,n,ee.STARTER_COVE);e=Ft(e,r)}catch{}return e}function of(){let e=kt(ee.STARTER_COVE,U.MAGNET);return Number.isFinite(e)?Math.max(0,Math.floor(e)):0}function af(e,t){if(!t)return{locked:!1};let n=Uc(),r=n?Ur():c.fromInt(0),i=n?fe(r):0,l={locked:!1};if(t.requiresUnlockXp&&!n){let d=_g(e,t),f="Unlock the XP system to reveal this upgrade",p=jd();if(d)if(p)l={locked:!0,iconOverride:dn,titleOverride:jt,descOverride:f,reason:f,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let h='Meet the Merchant to reveal "Unlock XP"';l={locked:!0,iconOverride:Pt,titleOverride:ir,descOverride:h,reason:h,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else l={locked:!0,iconOverride:Pt,titleOverride:ir,descOverride:f,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let o=Vc({locked:!1},l);if(typeof t.computeLockState=="function")try{let d={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:r,xpLevel:i,baseLocked:o.locked,getUpgradeLevel(p){return kt(e,p)}},f=t.computeLockState(d);o=Vc(o,f)}catch{}let a=y(),s=Br(e,t),u=s?Rc(e,t,a):!1;if(s){let d=Pc(a),f=So(a),p=$c(a),h=s.replace(/_/g,"-"),g=Ki(e,t),v=!1;Rr(d,h,s)&&(v=!0),g&&Rr(d,g,s)&&(v=!0),v&&Oc(d,a);let m=!1;Rr(f,h,s)&&(m=!0),g&&Rr(f,g,s)&&(m=!0),m&&xo(f,a);let b=!1;Rr(p,h,s)&&(b=!0),g&&Rr(p,g,s)&&(b=!0),b&&Bc(p,a)}if(o.locked){let d=!!o.hidden;o.iconOverride||(o.iconOverride=Pt),d?o.titleOverride||(o.titleOverride=jt):(!o.titleOverride||o.titleOverride===jt)&&(o.titleOverride=ir),o.useLockedBase==null&&(o.useLockedBase=!0),!o.reason&&t?.revealRequirement&&(o.reason=t.revealRequirement),o.descOverride||(o.reason?o.descOverride=`${o.reason}`:t?.revealRequirement?o.descOverride=t.revealRequirement:d&&(o.descOverride="This upgrade is currently hidden."))}else o.hidden=!1,o.hideCost=!1,o.hideEffect=!1,o.useLockedBase=!1,(o.iconOverride===Pt||o.iconOverride===dn)&&delete o.iconOverride,(o.titleOverride===jt||o.titleOverride===ir)&&delete o.titleOverride,delete o.descOverride,delete o.reason;if(o.locked&&t.requiresUnlockXp&&!n&&!o.iconOverride&&(o.iconOverride=Pt),s){let d=Pc(a),f=d.upgrades[s]||{},p=ln(t?.tie??t?.tieKey),h=p&&ns.has(p),g=f.status||"locked";if(Rc(e,t,a))g="unlocked";else if(Xd(e,t,a)&&g==="locked"){let M=!1;try{M=fe(Ur())>=31}catch{}g=h&&!M?"locked":"mysterious"}let v=Eo(g),m=Fc(o),b=Eo(m),w=()=>{o.locked=!0;let M=f.snapshot;M&&typeof M=="object"&&(o=Vc(o,M)),o.iconOverride=dn,o.titleOverride=jt;let R=t?.revealRequirement||o.reason||o.descOverride||"This upgrade is currently hidden.";o.descOverride=R,!o.reason&&t?.revealRequirement&&(o.reason=t.revealRequirement),o.hidden=!0,o.hideCost=!0,o.hideEffect=!0,o.useLockedBase=!0};v>b&&(g==="unlocked"?(o.locked=!1,o.hidden=!1,o.hideCost=!1,o.hideEffect=!1,o.useLockedBase=!1):g==="mysterious"&&w(),m=Fc(o),b=Eo(m));let L=!1,T=f&&typeof f=="object"&&typeof f.status=="string"?f.status:"locked",x=h,B=!1;try{B=fe(Ur())>=31}catch{}if(x&&!B&&T==="mysterious"&&(T="locked"),(!f||typeof f!="object"||Object.keys(f).length!==1||f.status!==T)&&(d.upgrades[s]={status:T},L=!0),b>v){if(f.status=m,d.upgrades[s]={status:f.status},L=!0,g=m,v=b,m==="unlocked")Qi(e,t,a);else if(m==="mysterious"){let M=!1;try{M=fe(Ur())>=31}catch{}(!h||M)&&Hd(e,t,a)}}g==="unlocked"?(o.locked=!1,o.hidden=!1,o.hideCost=!1,o.hideEffect=!1,o.useLockedBase=!1,(o.iconOverride===Pt||o.iconOverride===dn)&&delete o.iconOverride,(o.titleOverride===jt||o.titleOverride===ir)&&delete o.titleOverride,delete o.descOverride,delete o.reason,f.status!=="unlocked"&&(d.upgrades[s]={status:"unlocked"},L=!0),Qi(e,t,a)):g==="mysterious"&&m!=="mysterious"&&(w(),m=Fc(o),b=Eo(m)),L&&Oc(d,a)}return o}function Jc(e,t){return!!af(e,t).locked}function cf(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let r=Number.isFinite(n)?n:qc(e),{capBn:i,cap:l}=zd(r);try{return t?.cmp?.(i)>=0}catch{}let o=fe(t);return Number.isFinite(o)&&o>=l}function gt(e,t){let n=cn(e,t);return n.lvlBn?.clone?n.lvlBn.clone():$e(n.lvl??0)}function sf(e,t){let n=cn(e,t),r=n.upg;if(!r)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let i=(n.lvlBn??$e(n.lvl??0)).add(c.fromInt(1)),l=fe(i);try{return c.fromAny(r.costAtLevel(l))}catch{return c.fromInt(0)}}function es(e,t,n,r=!0,i={}){let l=cn(e,t),o=l.upg,{resetHmEvolutions:a=!1}=i??{};a&&o?.upgType==="HM"&&(l.hmEvolutions=0,Lo(o,0));let s=o?.lvlCap??1/0,u=l.lvl,d=Mo(l.lvlBn??$e(l.lvl??0)),f=$e(n);f.isInfinite?.()&&(f=c.fromAny("Infinity"));let p=f;try{o&&qd(o,p)&&(p=c.fromAny("Infinity"))}catch{}if(r&&Number.isFinite(s)){let g=$e(s);p.cmp(g)>0&&(p=g)}if(r&&Number.isFinite(s)){let g=$e(s);p.cmp(g)>0&&(p=g)}if(l.lvlBn?.cmp&&l.lvlBn.cmp(p)===0)return l.lvl;let h=fe(p);if(!o)return l.lvl=h,l.lvlBn=p,l.nextCostBn=c.fromInt(0),Mn(l),sn(e,t),Yt(),l.lvl;l.lvl=h,l.lvlBn=p;try{l.nextCostBn=c.fromAny(o.costAtLevel(h))}catch{l.nextCostBn=c.fromInt(0)}return Mn(l),sn(e,t),Xr(o,u,d,l.lvl,l.lvlBn),Yt(),l.lvl}function rr(e){return dl.filter(t=>t.area===e)}function un(e,t){let n=Xt(e),r=ze(t),i=ln(typeof r=="string"?r:t);return dl.find(l=>n&&Xt(l.area)!==n?!1:!!(ze(l.id)===r||i&&l.tieKey===i))||null}function Yr(e,t){let n=typeof t=="object"&&t?t:un(e,t);return af(e,n)}function qg(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let n=(a=>a.replace(/\\+/g,"/"))(t);if(n.startsWith("/"))return n.replace(/\/{2,}/g,"/");for(n=n.replace(/^\.\/+/u,"");n.startsWith("../");)n=n.slice(3);let r=n.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let l=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let s=i[a].toLowerCase();if(s==="img"){i.splice(a,1),a-=1;continue}if(s==="sc_upgrade_icons"||s==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&l.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let o=i.join("/");return o?`img/${o}`:""}function ts(e){return e?qg(e.icon):""}function Hg(e,t){let n=un(e,t),r=gt(e,t),i=fe(r);return!n||i>=n.lvlCap?0:n.costAtLevel(i)}function _o(e,t){let n=cn(e,t),r=n.upg;if(!r)return{bought:0,spent:0};if(Jc(e,r))return{bought:0,spent:0};let i=n.lvl,l=n.lvlBn??$e(i),o=Mo(l);if(i>=r.lvlCap)return{bought:0,spent:0};if(qd(r,l))return n.lvlBn=c.fromAny("Infinity"),n.lvl=fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Mn(n),sn(e,t),Yt(),{bought:0,spent:0};let a=n.nextCostBn??c.fromAny(r.costAtLevel(i)),s=a instanceof c?a:c.fromAny(a??0),u=r.costType,d=u?P[u]:null,f=c.fromInt(0);if(d&&!s.isZero?.()){let h=d.value;if((h instanceof c?h:c.fromAny(h??0)).cmp(s)<0)return{bought:0,spent:0};f=s.clone?.()??c.fromAny(s),d.sub(f)}else{if(!s.isZero?.())return{bought:0,spent:0};f=c.fromInt(0)}let p=l.add(c.fromInt(1));return n.lvlBn=p,n.lvl=fe(p),n.nextCostBn=c.fromAny(typeof r.nextCostAfter=="function"?r.nextCostAfter(f,n.lvl):r.costAtLevel(n.lvl)),Mn(n),sn(e,t),Xr(r,i,o,n.lvl,n.lvlBn),Yt(),{bought:1,spent:f}}function uf(e,t){let n=cn(e,t),r=n.upg;if(!r||r.upgType!=="HM")return{evolved:!1};let i=n.lvlBn??$e(n.lvl);if(!cf(r,i,n.hmEvolutions))return{evolved:!1};let l=Vr(n.hmEvolutions)+1;n.hmEvolutions=l,Lo(r,l);try{n.nextCostBn=c.fromAny(r.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Mn(n),sn(e,t),Xr(r,n.lvl,i,n.lvl,i),Yt(),{evolved:!0}}function rl(e,t){let n=cn(e,t),r=n.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Jc(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=n.lvl,l=n.lvlBn??$e(i),o=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(o)&&i>=o)return{bought:0,spent:c.fromInt(0)};let a=P[r.costType]?.value,s=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(r.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return _o(e,t);if(s.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(s.isInfinite?.()){let m=l.clone?.()??$e(l),b=fe(m),w=m.toStorage?.(),L;if(r.upgType==="HM"){if(L=c.fromAny("Infinity"),!r.lvlCapBn?.isInfinite?.()){let x=c.fromAny("Infinity");r.lvlCapBn=x,r.lvlCap=Number.POSITIVE_INFINITY,r.lvlCapFmtHtml=An(x),r.lvlCapFmtText=Hr(x)}}else{let x=r.lvlCapBn?.clone?.()??an(r.lvlCap??1/0,1/0);L=x?.clone?.()??x}let T=L.sub(m);if(T.isZero?.()){let x=Tg(L,m);x.isZero?.()||(T=x)}if(T.isZero?.()){let x=L.toStorage?.();if(w&&x&&w!==x)if(L.isInfinite?.())try{T=c.fromAny("Infinity")}catch{T=c.fromInt(1)}else T=c.fromInt(1)}return n.lvlBn=L.clone?.()??L,r.upgType==="NM"&&Number.isFinite(r.lvlCap)?n.lvl=r.lvlCap:n.lvl=fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),P[r.costType].set(s),Mn(n),sn(e,t),Xr(r,b,m,n.lvl,n.lvlBn),Yt(),{bought:T,spent:c.fromInt(0)}}let u=n.nextCostBn?.clone?.()??c.fromAny(r.costAtLevel(i));if(s.cmp(u)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(o)?Math.max(0,o-i):Gr;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Ao(r,l,s,d),p=f.count instanceof c?f.count:c.fromAny(f.count??0);if(p.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let h=f.spent??c.fromInt(0),g=s.sub(h);P[r.costType].set(g);let v=l.add(p);return n.lvlBn=v,n.lvl=fe(v),f.nextPrice?n.nextCostBn=f.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(r.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Mn(n),sn(e,t),Xr(r,i,l,n.lvl,n.lvlBn),Yt(),{bought:p,spent:h}}function df(e,t,n){let r=cn(e,t),i=r.upg;if(!i)return{bought:0,spent:c.fromInt(0)};if(Jc(e,i))return{bought:c.fromInt(0),spent:c.fromInt(0)};let l=r.lvl,o=r.lvlBn??$e(l),a=Number.isFinite(i.lvlCap)?Math.max(0,Math.floor(i.lvlCap)):1/0;if(Number.isFinite(a)&&l>=a)return{bought:0,spent:c.fromInt(0)};let s=P[i.costType]?.value,u=s instanceof c?s.clone?.()??c.fromAny(s):c.fromAny(s??0);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(a)?Math.max(0,a-l):void 0,f=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?fe(n):void 0,p=Number.isFinite(d)?Number.isFinite(f)?Math.min(d,f):d:f,h=Ao(i,o,u,p),g=h.count instanceof c?h.count:c.fromAny(h.count??0);if(g.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let v=h.spent??c.fromInt(0),m=u.sub(v);P[i.costType].set(m);let b=o.add(g);return r.lvlBn=b,r.lvl=fe(b),h.nextPrice?r.nextCostBn=h.nextPrice:Number.isFinite(r.lvl)?r.nextCostBn=c.fromAny(i.costAtLevel(r.lvl)):r.nextCostBn=c.fromAny("Infinity"),Mn(r),sn(e,t),Xr(i,l,o,r.lvl,r.lvlBn),Yt(),{bought:g,spent:v}}function il(e,t,n,r=Gr,i={}){let l=n instanceof c?n:c.fromAny(n??0),o=Ao(e,t,l,r,i);return{count:o.count,spent:o.spent??c.fromInt(0),nextPrice:o.nextPrice??c.fromInt(0),numericCount:o.numericCount??0}}function ff(e){let t=rr(e),n=1,r=c.fromInt(1),i=c.fromInt(1),l=c.fromInt(1);for(let o of t){let a=gt(e,o.id),s=fe(a),u=o.tieKey||ln(o.tie);if(u===U.FASTER_COINS)n*=o.effectMultiplier(s);else if(u===U.FASTER_COINS_II)n*=o.effectMultiplier(s);else if(u===U.COIN_VALUE_I){let d=Math.max(0,Number.isFinite(s)?s:0);if(d>0){let f=(1+.5*d).toFixed(6);f=f.replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"),r=r.mulDecimal(f,18)}}else if(u===U.COIN_VALUE_II){let d=Dr(s);if(d>0)try{let f=Ji(d);r=r.mulBigNumInteger(f)}catch{}}else if(u===U.BOOK_VALUE_I)l=Dc(s);else if(u===U.XP_VALUE_I){let d=Math.max(0,Number.isFinite(s)?s:0);i=c.fromAny(1+d*2)}else if(u===U.XP_VALUE_II){let d=Dr(s);if(d>0)try{let f=Ji(d);i=i.mulBigNumInteger(f)}catch{}}}return{coinsPerSecondMult:n,coinsPerSecondAbsolute:Ef*n,coinValueMultiplier:r,xpGainMultiplier:i,bookRewardMultiplier:l}}function Xg(){try{Yi()}catch{}try{pc(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n;try{n=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{n=c.fromInt(0)}try{let r=kt(ee.STARTER_COVE,U.COIN_VALUE_I),i=Math.max(0,Number.isFinite(r)?r:0);if(i>0){let l=(1+.5*i).toFixed(6);l=l.replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1");try{n=n.mulDecimal(l,18)}catch{}}}catch{}try{let r=Dr(kt(ee.STARTER_COVE,U.COIN_VALUE_II));if(r>0){let i=Ji(r);try{n=n.mulBigNumInteger(i)}catch{}}}catch{}try{let r=un(ee.STARTER_COVE,U.ENDLESS_XP),i=gt(ee.STARTER_COVE,U.ENDLESS_XP),{coinMult:l}=ko(r,i,ee.STARTER_COVE);n=Ft(n,l)}catch{}return n})}catch{}try{mc(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n;try{n=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{n=c.fromInt(0)}try{let r=kt(ee.STARTER_COVE,U.XP_VALUE_I),i=Math.max(0,Number.isFinite(r)?r:0);if(i>0)try{n=n.mulBigNumInteger(c.fromAny(1+i*2))}catch{}}catch{}try{let r=Dr(kt(ee.STARTER_COVE,U.XP_VALUE_II));if(r>0){let i=Ji(r);try{n=n.mulBigNumInteger(i)}catch{}}}catch{}try{let r=un(ee.STARTER_COVE,U.ENDLESS_XP),i=gt(ee.STARTER_COVE,U.ENDLESS_XP),l=1;try{l=r?.effectMultiplier?.(i)??1}catch{}let{selfMult:o,xpMult:a}=ko(r,i,ee.STARTER_COVE);n=Ft(n,Ft(l,o)),n=Ft(n,a)}catch{}return n})}catch{}try{gc(({baseReward:e,xpUnlocked:t})=>{if(!t)return e;try{return e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{return c.fromInt(0)}})}catch{}Gc(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{Gc()}catch{}try{zn()}catch{}})}function Yg(e){return typeof e=="function"&&fl.push(e),()=>{fl=fl.filter(t=>t!==e)}}function Yt(){try{fl.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{zn()}catch{}}function To(){return document.getElementById("game-root")?.classList?.contains("area-cove"),ee.STARTER_COVE}function jr(e,t){let n=un(e,t);if(!n)return null;let r=gt(e,t),i=fe(r),l=An(r),o=Hr(r),a=n.lvlCapBn??an(n.lvlCap??1/0,1/0),s=n.lvlCapFmtHtml??An(a),u=n.lvlCapFmtText??Hr(a),d=i<n.lvlCap?sf(e,t):c.fromInt(0),f=An(d),p=P[n.costType]?.value,h=p instanceof c?p:c.fromAny(p??0),g=Yr(e,t),v=!!g.locked,m=g.titleOverride??n.title,b=g.descOverride??n.desc,w=Hc(n,e),L="";typeof n.effectSummary=="function"&&!(v&&g.hideEffect)&&(L=n.effectSummary(i),typeof L=="string"&&(L=L.trim()));let T=g.iconOverride??ts(n);return{upg:n,lvl:i,lvlBn:r,lvlFmtHtml:l,lvlFmtText:o,lvlCapBn:a,lvlCapFmtHtml:s,lvlCapFmtText:u,nextPrice:d,nextPriceFmt:f,have:h,haveFmt:P[n.costType]?.fmt(h)??String(h),effect:L,iconUrl:T,lockState:g,locked:v,areaKey:e,hmMilestones:w,displayTitle:m,displayDesc:b,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?Kc(e,t):0,hmReadyToEvolve:n.upgType==="HM"?cf(n,r,Kc(e,t)):!1,hmNextMilestone:n.upgType==="HM"?Kd(n,r,e):null}}function jg(e,t){let n=un(e,t);if(!n||n.upgType!=="HM")return null;let r=gt(e,t);return Kd(n,r,e)}function Gg(e){return Ie(Pe(e??0))}var Gr,ht,pf,ll,mf,U,Pt,dn,jt,ir,ns,gf,hf,yf,vf,rs,is,ls,bf,ol,al,cl,Fo,If,Po,sl,Gt,ul,os,Oo,as,$o,wf,ee,dl,Bo,Ro,Zr,Uo,Do,cs,Ef,fl,zr=Ne(()=>{et(),St(),en(),Jn(),vi(),wo(),Gr=c.fromAny("Infinity"),ht=1e3,pf=c.fromInt(1e3),ll="",mf=308,U={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3"},Pt="img/misc/locked.png",dn="img/misc/mysterious.png",jt="Hidden Upgrade",ir="Locked Upgrade",ns=new Set([U.COIN_VALUE_II,U.XP_VALUE_II,U.MP_VALUE_I,U.MAGNET,U.ENDLESS_XP]),gf=new Set([U.UNLOCK_XP,U.UNLOCK_FORGE,...ns]),hf=new Set([U.FASTER_COINS_II,U.COIN_VALUE_I,U.BOOK_VALUE_I,U.XP_VALUE_I]),yf=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),vf="ccc:merchantMet",rs="ccc:shop:reveals",is="ccc:shop:permaUnlocks",ls="ccc:shop:permaMyst",bf={locked:0,mysterious:1,unlocked:2},ol=new Map,al=new Map,cl=new Map,Fo=new Map,If=ln(U.BOOK_VALUE_I),Po=c,sl=e=>Po.fromAny(e??0),Gt={addPctPerLevel(e){let t=Number(e),n=String(t);return r=>{let i=sl(r);try{let l=i.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=15){let o=Math.max(0,Number(l));return 1+t*o}}catch{}try{return Po.fromInt(1).add(i.mulDecimal(n))}catch{let l=Pe(i);if(Number.isFinite(l)){let o=l+Math.log10(Math.abs(t||0));return Ie(o)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return r=>{let i=sl(r);try{let l=i.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=15){let o=Math.max(0,Number(l));return 1+t*o}}catch{}try{return Po.fromInt(1).add(i.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(sl(e).toScientific(6)),r=Math.log10(n);return i=>{let l=sl(i);try{let o=l.toPlainIntegerString?.();if(o&&o!=="Infinity"&&o.length<=7){let a=Math.max(0,Number(o)),s=r*a;if(s<308){let u=Math.pow(n,a);if(Number.isFinite(u))return u}return Ie(s)}}catch{}try{let o=fe(l),a=r*o;return Ie(a)}catch{return c.fromInt(1)}}}},ul=Math.log(10),os={STANDARD(e){return`${e?.upgType??""}`.toUpperCase()==="HM"?1.5+.1*qc(e):1.2},HM(e){return os.STANDARD(e)},NM(){return 1.2}},Oo=(()=>{try{let e=fe(Gr);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),as=new ArrayBuffer(8),$o=new Float64Array(as),wf=new BigInt64Array(as),ee={STARTER_COVE:"starter_cove"},dl=[{area:ee.STARTER_COVE,id:1,tie:U.FASTER_COINS,title:"Faster Coins",desc:"Increases coin spawn rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",icon:"sc_upgrade_icons/faster_coins.png",costAtLevel(e){return Lt(this,e)},nextCostAfter(e,t){return Lt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin spawn rate bonus: ${xt(t)}x`},effectMultiplier:Gt.addPctPerLevel(.1)},{area:ee.STARTER_COVE,id:2,tie:U.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue XP system: Collect Coins for XP to level up and gain Books Each XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.png",baseIconOverride:"img/stats/xp/xp_base.png",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:tr,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Vi()}catch{}}},{area:ee.STARTER_COVE,id:3,tie:U.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin spawn rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",icon:"sc_upgrade_icons/faster_coins2.png",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin spawn rate bonus: ${xt(t)}x`},effectMultiplier:Gt.addPctPerLevel(.1)},{area:ee.STARTER_COVE,id:4,tie:U.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",icon:"sc_upgrade_icons/coin_val1.png",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${xt(t)}x`},effectMultiplier:Gt.addPctPerLevel(.5),onLevelChange(){try{zn()}catch{}}},{area:ee.STARTER_COVE,id:5,tie:U.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",icon:"sc_upgrade_icons/book_val1.png",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=Dc(e);return`Book value bonus: ${xt(t)}x`},onLevelChange({newLevel:e}){Gc(e)}},{area:ee.STARTER_COVE,id:6,tie:U.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",icon:"sc_upgrade_icons/xp_val1.png",requiresUnlockXp:!0,costAtLevel(e){return Lt(this,e)},nextCostAfter(e,t){return Lt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${xt(t)}x`},effectMultiplier:Gt.addFlatPerLevel(2)},{area:ee.STARTER_COVE,id:7,tie:U.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.png",baseIconOverride:"img/stats/mp/mp_base.png",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:tr,onLevelChange({newLevel:e}){if((e??0)>=1)try{Bd()}catch{}}},{area:ee.STARTER_COVE,id:8,tie:U.COIN_VALUE_II,title:"Coin Value II",desc:"Increases Coin value by +100% per level",lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",icon:"sc_upgrade_icons/coin_val2.png",requiresUnlockXp:!0,costAtLevel(e){return Lt(this,e)},nextCostAfter(e,t){return Lt(this,t)},computeLockState:tr,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${xt(t)}x`},effectMultiplier:Gt.addPctPerLevel(1),onLevelChange(){try{zn()}catch{}}},{area:ee.STARTER_COVE,id:9,tie:U.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",icon:"sc_upgrade_icons/xp_val2.png",requiresUnlockXp:!0,costAtLevel(e){return Lt(this,e)},nextCostAfter(e,t){return Lt(this,t)},computeLockState:tr,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${xt(t)}x`},effectMultiplier:Gt.addPctPerLevel(1)},{area:ee.STARTER_COVE,id:10,tie:U.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",icon:"sc_upgrade_icons/mp_val1.png",requiresUnlockXp:!0,costAtLevel(e){return Lt(this,e)},nextCostAfter(e,t){return Lt(this,t)},computeLockState:tr,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${xt(t)}x`},effectMultiplier:Gt.addPctPerLevel(1)},{area:ee.STARTER_COVE,id:11,tie:U.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level Magnet: Increases the distance from which you can collect Coins`,lvlCap:10,baseCost:100,costType:"gold",upgType:"NM",icon:"sc_upgrade_icons/magnet.png",requiresUnlockXp:!0,scaling:{ratio:2},costAtLevel(e){return Lt(this,e)},nextCostAfter(e,t){return Lt(this,t)},computeLockState:tr,effectSummary(e){let t=Dr(e),n=xt(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:Gt.addPctPerLevel(1)},{area:ee.STARTER_COVE,id:12,tie:U.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade Milestones: Reach a certain upgrade level for powerful buffs Multiplies XP value by 1.1x per level`,lvlCap:ht,baseCost:1e6,costType:"coins",upgType:"HM",icon:"sc_upg_icons/xp_val_hm.png",requiresUnlockXp:!0,scalingPreset:"HM",hmMilestones:[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],costAtLevel(e){return No(this,e)},nextCostAfter(e,t){return No(this,t)},computeLockState:tr,effectSummary(e){let t=$e(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:r}=ko(this,t,this.area),i=Ft(n,r);return`XP value bonus: ${xt(i)}x`},effectMultiplier:Gt.powPerLevel(1.1)}];for(let e of dl){let t=ln(e.tie??e.tieKey);e.tieKey=t,t&&!Fo.has(t)&&Fo.set(t,e),e.baseCost=an(e.baseCost??0,0),e.baseCostBn=e.baseCost,e.numUpgEvolutions=Vr(e.numUpgEvolutions),e.upgType==="HM"?Lo(e,e.numUpgEvolutions):(e.lvlCapBn=an(e.lvlCap??1/0,1/0),e.lvlCap=jc(e.lvlCapBn),e.lvlCapFmtHtml=An(e.lvlCapBn),e.lvlCapFmtText=Hr(e.lvlCapBn)),Number.isFinite(e.lvlCap)&&Math.max(0,Math.floor(e.lvlCap))===1&&t!==If&&(e.unlockUpgrade=!0,e.baseCost=c.fromInt(0),e.baseCostBn=e.baseCost,e.costAtLevel=()=>c.fromInt(0),e.nextCostAfter=()=>c.fromInt(0)),e.bulkMeta=Bg(e),qr(e)}Bo=new Map,Ro=new Map,Zr=new Map,Uo=new Map,Do=new Map,cs=null,typeof window<"u"&&(tf(y()),window.addEventListener("saveSlot:change",()=>{tf(y())})),Ef=1,Xg(),fl=[]}),ss,Zg=Ne(()=>{ss={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c2"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1c"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Liar.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"That does not help.",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"The XP system is a powerful ancient mechanism, designed to allow rapid influx of coin-collecting power. Increasing your XP Level grants you Books infused with my power, capable of great things.",next:"c1a"},m1b:{type:"line",say:"It means you can grow passively stronger by collecting coins.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},c1a:{type:"choice",options:[{label:"This XP system, by whom was it designed, exactly?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m2a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1a"},{label:"Why?",to:"m2c"},{label:"Okay.",to:"m2a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1a"},{label:"I don\u2019t know the full details.",to:"m1a"},{label:"Yes.",to:"m2a"}]},m2a:{type:"line",say:"Would you like some Books, free of charge? They will help you accelerate your coin-collecting power.",next:"c2a"},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your coin-collecting power.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m2a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m2a"},{label:"\u2026",to:"m2a"},{label:"\u2026",to:"m2a"}]},c2d:{type:"choice",options:[{label:"But why does that matter?",to:"m3a"},{label:"But what does that mean?",to:"m3a"},{label:"\u2026",to:"m3a"}]},m3a:{type:"line",say:"If you want free Books, then don\u2019t ask further questions.",next:"c3a"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"Level 999. I hoped to see it one day. Placeholder admiration intensifies.",next:"c0"},c0:{type:"choice",options:[{label:"Was it worth it?",to:"q0"},{label:"What happens next?",to:"q1"},{label:"I need a break.",to:"end"}]},q0:{type:"line",say:"Only you can decide that. But the data you gathered will fuel upcoming secrets.",next:"c1"},q1:{type:"line",say:"Beyond this? More systems, more bargains, and more reasons to climb. Placeholder, of course.",next:"c1"},c1:{type:"choice",options:[{label:"Where are the rewards?",to:"q2"},{label:"I\u2019ll keep going.",to:"end"},{label:"I need another hint.",to:"q3"}]},q2:{type:"line",say:"For now, take pride. The tangible prizes arrive in a future update.",next:"c1"},q3:{type:"line",say:"Watch the Merchant tab. New dialogues will appear at milestones beyond this.",next:"c1"}}}}}),Sf={};Ze(Sf,{GHOST_TAP_TIMEOUT_MS:()=>Lf,clearGhostTapTarget:()=>_n,consumeGhostTapGuard:()=>Vo,installGhostTapGuard:()=>eh,markGhostTapTarget:()=>oe,setGhostTapSelector:()=>th,shouldSkipGhostTap:()=>Wr,suppressNextGhostTap:()=>Zt});function fn(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function xf(){return typeof document>"u"?null:document}function us(e){if(!xf())return null;let t=typeof Element<"u"?Element:null;return!e||!t||(e instanceof t||(e=e.parentElement),!e||!e.closest)?null:e.closest(Ho)}function _n(e){e&&(e[pl]=0)}function oe(e,t=0){if(!e)return;let n=fn(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[pl]=n+r:e[pl]=0,Kr=e,r>0&&Zt(r)}function Vo(e){if(typeof window>"u")return!1;let t=window[Tn];return typeof t!="number"?!1:fn()<=t?(window[Tn]=null,!(e&&Kr&&e===Kr)):(window[Tn]=null,!1)}function Wr(e){if(!e)return!1;let t=Number(e[pl]||0);return!Number.isFinite(t)||t<=0?!1:fn()<=t?Kr&&e===Kr?(_n(e),!1):(_n(e),!0):(_n(e),!1)}function Zt(e=0){if(typeof window>"u")return;let t=fn(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[Tn]=null;return}let r=t+n,i=typeof window[Tn]=="number"?window[Tn]:0;window[Tn]=Math.max(i,r)}function zg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;ml=pn=fn(),mn=0;let t=us(e.target);t&&Vo(t)&&(_n(t),e.preventDefault(),e.stopImmediatePropagation())}function Wg(e){ml=pn=fn(),mn=0;let t=us(e.target);t&&Vo(t)&&(_n(t),e.preventDefault(),e.stopImmediatePropagation())}function Kg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=fn();pn>0&&(mn=t-pn),ml=t}function Qg(){let e=fn();pn>0&&(mn=e-pn),ml=e}function Jg(e){let t=fn(),n=pn>0?t-pn:-1;if(n<0)return;let r=us(e.target);if(r){if((mn||n)>=ps){_n(r),mn=0,e.preventDefault(),e.stopImmediatePropagation();return}Vo(r)&&(_n(r),mn=0,e.preventDefault(),e.stopImmediatePropagation()),mn=0}}function eh(e={}){if(ds)return;let t=xf();!t||typeof window>"u"||(ds=!0,Xo="PointerEvent"in window,fs=!Xo&&"ontouchstart"in window,e.selector&&(Ho=`${e.selector}, ${qo}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(ps=e.longPressMs),t.addEventListener("click",Jg,!0),Xo?(t.addEventListener("pointerdown",zg,{capture:!0,passive:!1}),t.addEventListener("pointerup",Kg,{capture:!0,passive:!0})):fs&&(t.addEventListener("touchstart",Wg,{capture:!0,passive:!1}),t.addEventListener("touchend",Qg,{capture:!0,passive:!0})))}function th(e){e&&(Ho=`${e}, ${qo}`)}var Lf,pl,Tn,qo,kf,ds,Ho,Xo,fs,Kr,ml,pn,mn,ps,gl=Ne(()=>{Lf=0,pl=Symbol("ccc:ghostTap:skipUntil"),Tn="__cccGhostTapSkipUntil",qo='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',kf=80,ds=!1,Ho=qo,Xo=!1,fs=!1,Kr=null,ml=0,pn=0,mn=0,ps=kf});function nh(){try{return localStorage.getItem(Pn(Go))==="1"}catch{return!1}}function hl(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let r=!1,i=!1,l=null,o=m=>{if(!(n&&r)){if(m?.type==="click"&&Wr(e)){m.preventDefault?.();return}oe(e),r=n?!0:r,Promise.resolve(t(m)).catch(()=>{}),n&&v()}},a=()=>{i=!1,l=null},s=m=>{if(i){a();return}o(m)},u=m=>{m.pointerType!=="mouse"&&(typeof m.button=="number"&&m.button!==0||(i=!0,l=typeof m.pointerId=="number"?m.pointerId:null,Zt(160)))},d=m=>{i&&(l!=null&&typeof m.pointerId=="number"&&m.pointerId!==l||(a(),o(m)))},f=()=>{i&&a()},p=m=>{i=!0,Zt(160)},h=m=>{i&&(a(),o(m))},g=()=>{i&&a()},v=()=>{e.removeEventListener("click",s),Qo?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",f)):Ss&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",h),window.removeEventListener("touchcancel",g))};return e.addEventListener("click",s),Qo?(e.addEventListener("pointerdown",u,{passive:!1}),window.addEventListener("pointerup",d,{passive:!1}),window.addEventListener("pointercancel",f,{passive:!1})):Ss&&(e.addEventListener("touchstart",p,{passive:!1}),window.addEventListener("touchend",h,{passive:!1}),window.addEventListener("touchcancel",g,{passive:!1})),v}function Yo(e){return Uf[e]??0}function Nf(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function rh(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function ih(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let r=Number.parseInt(n,10);if(Number.isFinite(r))return r}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let r=Number.parseInt(n,10);if(Number.isFinite(r))return r}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function lh(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof Zn=="function"&&Zn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Ce=="function"?Ce():null;t&&typeof t=="object"&&(e.xpLevel=ih(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof er=="function"&&er()}catch{e.hasForgeReset=!1}return e}function oh(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let r=n&&typeof n=="object"?n:null,i="locked";if(n===!0)i="unlocked";else if(r){let o=String(r.status??"").toLowerCase();o==="unlocked"||r.unlocked===!0?i="unlocked":o==="mysterious"?i="mysterious":i="locked"}else(n===!1||n==null)&&(i="locked");let l={status:i,unlocked:i==="unlocked",title:i==="unlocked"?e.title:"???",blurb:i==="unlocked"?e.blurb:i==="mysterious"?zo:Wo,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return i==="unlocked"?(l.ariaLabel=e.title||"Merchant dialogue",l):(l.title=r?.title??"???",l.blurb=r?.requirement??r?.message??r?.tooltip??(i==="mysterious"?zo:Wo),l.tooltip=r?.tooltip??(i==="locked"?"Locked Dialogue":"Hidden Dialogue"),l.message=r?.message??(i==="mysterious"?Ko:""),l.icon=r?.icon??(i==="mysterious"?Jr:null),l.headerTitle=r?.headerTitle??(i==="mysterious"?or:Rf),l.ariaLabel=r?.ariaLabel??(i==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),l)}function ah(){if(xs)return;xs=!0;let e=ch;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e)),document.addEventListener("ccc:upgrades:changed",e);let t=y();if(t!=null){let n=`${Df}:${t}`;Tt(n,{onChange:e})}}function ch(){Fn()}function sh(e,t){let n=ms(),r=String(e),i=n[r]||{};return t.once&&i.claimed?!1:(i.claimed=!0,n[r]=i,Cf(n),uh(t.reward),!0)}function uh(e){if(e){if(e.type==="coins"){try{P.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{P.books.addWithMultiplier?.(e.amount)??P.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function dh(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:"Reward available":""}function ms(){try{return JSON.parse(localStorage.getItem(Pn(vl))||"{}")}catch{return{}}}function Cf(e){let t=Pn(vl);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{xe(t,n)}catch{}}catch{}}function fh(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function ph(){let e=Jo;if(Jo=null,typeof e=="function")try{e()}catch{}}function mh(e,t={}){t?.rawChanged&&Fn()}function gs(e){if(e===ks)return;if(ph(),ks=e??null,e==null){Fn();return}let t=`${vl}:${e}`;Jo=Tt(t,{parse:fh,onChange:mh});try{xe(t)}catch{}Fn()}function gh(){if(Ls){gs(y());return}Ls=!0,gs(y()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{gs(y())})}function jo(){if(!zt){let e=window.AudioContext||window.webkitAudioContext;zt=new e}gn||(gn=zt.createGain(),gn.gain.value=ce?.15:.3,gn.connect(zt.destination))}function Af(){return Vf[0]}async function Mf(){if(jo(),ei)return ei;if(ti)return ti;let e=Af();return ti=(async()=>{let t=await(await fetch(e,{cache:"force-cache"})).arrayBuffer();return await zt.decodeAudioData(t)})().then(t=>ei=t).catch(t=>{console.warn("Typing SFX decode failed:",t),ti=null}),ti}function _f(){if(Nt)return Nt;let e=new Audio;e.loop=!0,e.preload="auto",e.muted=!1,e.volume=1;let t=Af();return e.src=t,Nt=e,e}function Tf(){jo(),_f(),ta||(ta=zt.createMediaElementSource(Nt),ta.connect(gn))}function Ff(){gn&&(gn.gain.value=ce?.15:.3)}function Qr(){if(na)return;na=!0,jo(),zt.resume().catch(()=>{}),Mf();let e=_f();Tf();let t=e.loop,n=e.muted;e.loop=!1,e.muted=!0,e.play().then(()=>{e.pause(),e.currentTime=0}).catch(r=>{r.name!=="AbortError"&&(console.warn("Typing SFX prime error:",r),na=!1)}).finally(()=>{e.loop=t,e.muted=n})}async function hh(){if(jo(),await zt.resume().catch(()=>{}),await Mf(),hn&&ei){if(it){try{it.stop(0)}catch{}try{it.disconnect()}catch{}it=null}it=zt.createBufferSource(),it.buffer=ei,it.loop=!0,it.connect(gn),it.start(0);return}if(Tf(),hn&&Nt){Nt.currentTime=0;try{await Nt.play()}catch{let e=()=>{hn&&Nt.play().catch(()=>{}),document.removeEventListener("click",e)};document.addEventListener("click",e,{once:!0})}}}function yl(){if(it){try{it.stop(0)}catch{}try{it.disconnect()}catch{}it=null}Nt&&(Nt.pause(),Nt.currentTime=0)}function yh(e,t,n=22,r=[]){return new Promise(i=>{let l=0,o=!1,a=!1;hn=!0,hh();let s=h=>{a&&(h.preventDefault(),o=!0)},u=h=>{a&&(h.key==="Enter"||h.key===" ")&&(o=!0)},d=r.length?r:[e];requestAnimationFrame(()=>{a=!0,d.forEach(h=>h.addEventListener("click",s,{once:!0})),document.addEventListener("keydown",u,{once:!0})}),e.classList.add("is-typing"),e.textContent="";let f=()=>{d.forEach(h=>h.removeEventListener("click",s)),document.removeEventListener("keydown",u),e.classList.remove("is-typing"),yl(),hn=!1},p=()=>{if(o){e.textContent=t,f(),i();return}e.textContent=t.slice(0,l++),l<=t.length?setTimeout(p,n):(f(),i())};p()})}function vh(e={}){if(!ne)return;Qr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||or}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Jr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,ne.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),r=t.querySelector(".merchant-firstchat__header .name"),i=t.querySelector(".merchant-lockinfo__message"),l=t.querySelector(".merchant-lockinfo__close");r.textContent=e.headerTitle||or,i.textContent=e.message||Ko,requestAnimationFrame(()=>t.classList.add("is-visible")),ne.classList.add("firstchat-active");let o=!1,a=()=>{o||(o=!0,t.classList.remove("is-visible"),ne.classList.remove("firstchat-active"),yl(),hn=!1,document.removeEventListener("keydown",s,!0),setTimeout(()=>t.remove(),160))},s=d=>{d.key==="Escape"&&(d.preventDefault(),a())};document.addEventListener("keydown",s,!0),t.addEventListener("pointerdown",d=>{n.contains(d.target)||(d.preventDefault(),We(160),a())});let u=d=>{(!d||d.pointerType!=="mouse")&&We(160),a()};hl(l,()=>{u()},{once:!0}),l.focus?.()}function bh(e,t){Qr();let n=document.createElement("div");n.className="merchant-firstchat",n.setAttribute("data-dismissible","1"),n.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Is}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,ne.appendChild(n);let r=g=>{g.key==="Escape"&&n.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>n.classList.add("is-visible")),ne.classList.add("firstchat-active");let i=n.querySelector(".merchant-firstchat__text"),l=n.querySelector(".merchant-firstchat__row"),o=n.querySelector(".merchant-firstchat__card"),a=n.querySelector(".merchant-firstchat__choices"),s=!1,u=()=>{document.removeEventListener("keydown",r,{capture:!0}),n.classList.remove("is-visible"),ne.classList.remove("firstchat-active"),yl(),hn=!1,setTimeout(()=>n.remove(),160)},d=()=>{s||(s=!0,u(),Fn())};n.addEventListener("pointerdown",g=>{o.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&We(160),d())});let f=new Cs({textEl:i,choicesEl:a,skipTargets:[i,l,o],onEnd:g=>{if(!s){if(s=!0,g&&g.noReward){u(),Fn();return}sh(e,t),u(),Fn()}}}),p=!!ms()[e]?.claimed,h=structuredClone(ss[t.scriptId]);p&&h.nodes.m2b&&h.nodes.c2a&&t.scriptId===1&&(h.nodes.m2b.say="I've already given you Coins, goodbye.",h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),p&&t.scriptId===2&&h.nodes.m2a&&(h.nodes.m2a.say="I've already given you Books, goodbye.",h.nodes.c2a&&(h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),f.load(h),f.start()}function Ih(){let e=ne?.querySelector(".merchant-content");if(!e||e.__customScroll||!ge)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),ge.appendChild(t);let r=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,i=150,l=120,o="onscrollend"in window,a=null,s=()=>{let M=(e.scrollTop||0)>0;ge?.classList.toggle("has-scroll-shadow",M)},u=()=>{let M=ne.querySelector(".merchant-grabber"),R=ne.querySelector(".merchant-header"),k=ne.querySelector(".merchant-actions"),H=(M?.offsetHeight||0)+(R?.offsetHeight||0)|0,J=(k?.offsetHeight||0)|0;t.style.top=H+"px",t.style.bottom=J+"px"},d=()=>{let{scrollHeight:M,clientHeight:R,scrollTop:k}=e,H=t.clientHeight||1,J=R/Math.max(1,M),se=Math.max(28,Math.round(H*J)),ke=Math.max(1,M-R),Y=Math.max(0,H-se),ie=Math.round(k/ke*Y);n.style.height=se+"px",n.style.transform=`translateY(${ie}px)`,t.style.display=M<=R+1?"none":""},f=()=>{u(),d(),s()},p=()=>{r&&(ge.classList.add("is-scrolling"),a&&clearTimeout(a))},h=M=>{r&&(a&&clearTimeout(a),a=setTimeout(()=>{ge.classList.remove("is-scrolling")},M))},g=()=>{d(),s(),r&&p(),o||h(i)},v=()=>h(i);e.addEventListener("scroll",g,{passive:!0}),o&&e.addEventListener("scrollend",v,{passive:!0});let m=new ResizeObserver(f);m.observe(e),window.addEventListener("resize",f),requestAnimationFrame(f);let b=!1,w=0,L=0,T=M=>{b=!0,w=M.clientY,L=e.scrollTop,n.classList.add("dragging"),p();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},x=M=>{if(!b)return;let R=t.clientHeight||1,k=n.clientHeight||1,H=Math.max(1,R-k),J=Math.max(1,e.scrollHeight-e.clientHeight),se=(M.clientY-w)/H*J;e.scrollTop=L+se},B=M=>{if(b){b=!1,n.classList.remove("dragging"),h(l);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",T),window.addEventListener("pointermove",x,{passive:!0}),window.addEventListener("pointerup",B),window.addEventListener("pointercancel",B),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let R=t.getBoundingClientRect(),k=M.clientY-R.top,H=t.clientHeight||1,J=n.clientHeight||1,se=Math.max(0,H-J),ke=Math.max(0,Math.min(k-J/2,se)),Y=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ke/Math.max(1,se)*Y,p(),h(i)}),e.__customScroll={bar:t,thumb:n,ro:m,updateAll:f}}function wh(){if(ne)return;ne=document.createElement("div"),ne.className="merchant-overlay",ne.id="merchant-overlay",ne.setAttribute("inert",""),ge=document.createElement("div"),ge.className="merchant-sheet",ge.setAttribute("role","dialog"),ge.setAttribute("aria-modal","false"),ge.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let r=document.createElement("div");r.className="merchant-tabs",r.setAttribute("role","tablist");let i=document.createElement("div");i.className="merchant-panels";let l=document.createElement("section");l.className="merchant-panel is-active",l.id="merchant-panel-dialogue";let o=document.createElement("section");o.className="merchant-panel",o.id="merchant-panel-reset";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-minigames";let s=(()=>{try{return!!Cn?.()}catch{return!1}})();lr.set("reset",s),Zo.forEach(p=>{p.key==="dialogue"&&lr.set("dialogue",!0);let h=lr.get(p.key),g=h??!!p.unlocked,v=document.createElement("button");v.type="button",v.className="merchant-tab",v.dataset.tab=p.key;let m=p.lockedLabel||"???";v.textContent=g?p.label:m,g?v.title=p.label||"Tab":(v.classList.add("is-locked"),v.disabled=!0,v.title="???"),p.unlocked=g,lr.set(p.key,g),hl(v,b=>{if(v.disabled){b?.preventDefault?.();return}Bf(p.key)}),r.appendChild(v),Ot.buttons[p.key]=v}),Ot.panels.dialogue=l,Ot.panels.reset=o,Ot.panels.minigames=a,Ot.tablist=r,i.append(l,o,a),n.append(r,i);try{Yi()}catch{}try{$d(o)}catch{}try{Fe()}catch{}try{Cn?.()&&bs(["reset"])}catch{}let u=document.createElement("div");u.className="merchant-actions";let d=document.createElement("button");d.type="button",d.className="merchant-close",d.textContent="Close",bl=d,u.appendChild(d);let f=document.createElement("div");f.className="merchant-firstchat merchant-firstchat--initial",f.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Is}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,ge.append(e,t,n,u,f),ne.appendChild(ge),document.body.appendChild(ne),Eh(),Ih(),Ns||(Ns=!0,hl(d,()=>{ys()},{once:!1}),document.addEventListener("keydown",Lh),e.addEventListener("pointerdown",kh),e.addEventListener("touchstart",p=>p.preventDefault(),{passive:!1}),ne.addEventListener("pointerdown",Qr,{once:!0}))}function Eh(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,ah(),Fn()}function Fn(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=lh(),r=ms(),i=!1;t.innerHTML="",Object.entries(ea).forEach(([l,o])=>{let a=r[l]||{},s=a.status||"locked",u=Yo(s),d=oh(o,n),f=d.status,p=Yo(f);if(p>u)a.status=f,f==="mysterious"?a.lockSnapshot=Nf(d):f==="unlocked"&&delete a.lockSnapshot,r[l]=a,i=!0;else if(p<u){if(s==="unlocked")d=rh(o),f="unlocked",p=Yo(f);else if(s==="mysterious"){let M=a.lockSnapshot||Nf(d)||{};d={status:"mysterious",unlocked:!1,title:M.title??d.title??"???",blurb:M.blurb??d.blurb??zo,tooltip:M.tooltip??d.tooltip??"Hidden Dialogue",message:M.message??d.message??Ko,icon:M.icon??d.icon??Jr,headerTitle:M.headerTitle??d.headerTitle??or,ariaLabel:M.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},f="mysterious",p=Yo(f)}}let h=f==="unlocked",g=f==="mysterious",v=f==="locked",m=!!a.claimed,b=h&&!!(o.once&&m),w=document.createElement("button");w.type="button",w.className="dlg-card",w.dataset.dlgStatus=f,w.disabled=!!v,v?(w.classList.add("is-locked"),w.setAttribute("aria-disabled","true"),w.setAttribute("tabindex","-1")):(w.removeAttribute("aria-disabled"),w.removeAttribute("tabindex")),g&&w.classList.add("is-mysterious");let L=document.createElement("div");L.className="dlg-title",L.textContent=h?o.title:d.title??"???";let T=document.createElement("div");T.className="dlg-blurb",T.textContent=h?o.blurb:d.blurb??"";let x=document.createElement("div");x.className="dlg-reward",h&&o.reward?o.reward.type==="coins"?(x.classList.add("has-reward"),x.innerHTML=`<span class="reward-label">Reward:</span><span class="coin"><span class="coin-icon" aria-hidden="true"></span><span class="amt">${o.reward.amount}</span></span>`,x.setAttribute("aria-label",`Reward: ${o.reward.amount} coins`)):o.reward.type==="books"?(x.classList.add("has-reward"),x.innerHTML=`<span class="reward-label">Reward:</span><span class="book"><span class="book-icon" aria-hidden="true"></span><span class="amt">${o.reward.amount}</span></span>`,x.setAttribute("aria-label",`Reward: ${o.reward.amount} Books`)):x.textContent=dh(o.reward):x.textContent="";let B=h?`${o.title}${b?" (completed)":""}`:d.ariaLabel||(g?"Hidden merchant dialogue":"Locked merchant dialogue");if(w.setAttribute("aria-label",B),d.tooltip?w.title=d.tooltip:h?w.title="Left-click: Start Dialogue":w.removeAttribute("title"),w.append(L,T,x),b){w.classList.add("is-complete");let M=document.createElement("div");M.className="dlg-again",M.textContent="Ask Again?",w.classList.add("has-again"),w.append(M)}t.appendChild(w),(h||g)&&hl(w,M=>{if(w.classList.contains("is-locked")&&!g){M?.preventDefault?.();return}h?bh(l,o):g&&vh(d)})}),i&&Cf(r)}function Sh(){let e=ne.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card"),i=e.querySelector("#merchant-first-choices"),l=new Cs({textEl:t,choicesEl:i,skipTargets:[t,n,r],onEnd:()=>{try{localStorage.setItem(Pn(Go),"1")}catch{}try{window.dispatchEvent(new Event(Es))}catch{}e.classList.remove("is-visible"),ne.classList.remove("firstchat-active")}});l.load(ss[0]),l.start()}function xh(){if(!ne)return;let e=ne.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),ne.classList.remove("firstchat-active")}function hs(){if(wh(),ar)return;let e=document.activeElement;e instanceof HTMLElement&&!ne.contains(e)?Il=e:Il=null,ar=!0;let t=!1;try{t=localStorage.getItem(Pn(Go))==="1"}catch{t=!1}t||ne.classList.add("firstchat-instant"),ge.style.transition="none",ge.style.transform="",ne.removeAttribute("inert"),ge.offsetHeight,requestAnimationFrame(()=>{if(ne.classList.contains("firstchat-instant")||(ge.style.transition=""),ne.classList.add("is-open"),We(140),bl&&typeof bl.focus=="function")try{bl.focus({preventScroll:!0})}catch{}let n="dialogue";try{n=localStorage.getItem(Pn(ws))||"dialogue"}catch{}Bf(n),yl(),t||(ne.querySelector(".merchant-firstchat")?.classList.add("is-visible"),ne.classList.add("firstchat-active"),Sh())})}function ys(){if(!ar)return;if(ce){try{Zt(100)}catch{}try{We(80)}catch{}}ar=!1,ge.style.transition="",ge.style.transform="",ne.classList.remove("is-open"),ne.classList.remove("firstchat-instant"),xh();let e=document.activeElement;if(e&&ne.contains(e)){let t=Il;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}ne.setAttribute("inert",""),Il=null,yl(),hn=!1}function Lh(e){ar&&e.key==="Escape"&&(e.preventDefault(),ys())}function kh(e){if(!ar)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;rt={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},ge.style.transition="none",window.addEventListener("pointermove",Pf,{passive:!0}),window.addEventListener("pointerup",Of),window.addEventListener("pointercancel",$f)}function Pf(e){if(!rt||rt.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-rt.startY);rt.lastY=t,rt.moved=n,ge.style.transform=`translateY(${n}px)`}function Of(){if(!rt||rt.canceled){vs();return}let e=Math.max(1,performance.now()-rt.startT),t=rt.moved;t/e>.55&&t>40||t>140?(Zt(160),ge.style.transition="transform 140ms ease-out",ge.style.transform="translateY(100%)",setTimeout(()=>{ys()},150)):(ge.style.transition="transform 180ms ease",ge.style.transform="translateY(0)"),vs()}function $f(){rt&&(rt.canceled=!0,ge.style.transition="transform 180ms ease",ge.style.transform="translateY(0)",vs())}function vs(){window.removeEventListener("pointermove",Pf),window.removeEventListener("pointerup",Of),window.removeEventListener("pointercancel",$f),rt=null}function Bf(e){let t=Zo.find(r=>r.key===e),n=lr.get(e);(!t||!n)&&(e="dialogue");for(let r in Ot.buttons)Ot.buttons[r].classList.toggle("is-active",r===e);for(let r in Ot.panels)Ot.panels[r].classList.toggle("is-active",r===e);try{localStorage.setItem(Pn(ws),e)}catch{}}function bs(e=[]){e.forEach(t=>{let n=Zo.find(i=>i.key===t);if(!n)return;lr.set(t,!0),n.unlocked=!0;let r=Ot.buttons[t];r&&(r.disabled=!1,r.classList.remove("is-locked"),r.textContent=n.label,r.title=n.label||"Tab")})}var Is,Go,ws,vl,Es,Pn,Zo,lr,Jr,or,Rf,zo,Wo,Ko,Uf,Df,Qo,Ss,xs,Ls,ks,Jo,ea,ne,ge,bl,ar,rt,Il,Ns,Ot,Vf,zt,gn,ei,ti,Nt,ta,it,na,hn,Cs,qf=Ne(()=>{et(),St(),Zg(),Jn(),wo(),ip(),gl(),Mi(),Is="img/misc/merchant.png",Go="ccc:merchantMet",ws="ccc:merchantTab",vl="ccc:merchant:dlgState",Es="ccc:merchant:met",Pn=e=>`${e}:${y()}`,Zo=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"minigames",label:"???",unlocked:!1}],lr=new Map([["dialogue",!0],["reset",!1],["minigames",!1]]),Jr="img/misc/mysterious.png",or="Hidden Dialogue",Rf="Locked Dialogue",zo="Hidden Dialogue",Wo="Locked",Ko="Locked Dialogue",Uf={locked:0,mysterious:1,unlocked:2},Df="ccc:reset:forge:completed",Qo=typeof window<"u"&&"PointerEvent"in window,Ss=!Qo&&typeof window<"u"&&"ontouchstart"in window,xs=!1,Ls=!1,ks=null,Jo=null,ea={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Jr,headerTitle:or,ariaLabel:"Hidden merchant dialogue. Unlock the XP system to reveal this dialogue"}},3:{title:"Edge of Mastery",blurb:"Placeholder musings earned through the Forge.",scriptId:3,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:Wo,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue."}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Jr,headerTitle:or,ariaLabel:"Hidden merchant dialogue. Do a Forge reset to reveal this dialogue"},once:!1}},gh(),ne=null,ge=null,bl=null,ar=!1,rt=null,Il=null,Ns=!1,Ot={buttons:{},panels:{},tablist:null},Vf=["sounds/merchant_typing.mp3"],zt=null,gn=null,ei=null,ti=null,Nt=null,ta=null,it=null,na=!1,hn=!1,window.matchMedia?.("(any-pointer: coarse)")?.addEventListener?.("change",Ff),window.addEventListener("orientationchange",Ff),Cs=class{constructor({textEl:e,choicesEl:t,skipTargets:n,onEnd:r}){this.textEl=e,this.choicesEl=t,this.skipTargets=n,this.onEnd=r||(()=>{}),this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(e){this.nodes=e.nodes||{},this.startId=e.start}async start(){this.startId&&await this.goto(this.startId)}async goto(e){let t=this.nodes[e];if(t){if(this.current=e,t.type==="line"){let n=this.nodes[t.next];if(!this.deferNextChoices&&n&&n.type==="choice"?this._renderChoices(n.options||[],!0):this._hideChoices(),await yh(this.textEl,t.say,t.msPerChar??22,this.skipTargets),n&&n.type==="choice"){if(this.current=t.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(n.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",t.next==="end"||t.end===!0?this.onEnd():t.next?this.goto(t.next):void 0}t.type==="choice"&&this._renderChoices(t.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(e,t=!1){this.choicesEl.innerHTML="";for(let n of e){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=n.label,hl(r,async i=>{if(i?.stopPropagation?.(),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,n.to==="end")return this.onEnd({noReward:!1});if(n.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(n.to)},{once:!0}),this.choicesEl.appendChild(r)}if(t){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}}});function Nh(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function Hf(e){return Nh(e)===Jf}function We(e=140){if(!ce)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=r=>{r.stopPropagation(),r.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(r=>t.addEventListener(r,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Ch(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.setAttribute("aria-label","Milestones");let r=document.createElement("div");r.className="hm-milestones-dialog";let i=document.createElement("h3");i.className="hm-milestones-title",i.textContent="Milestones";let l=document.createElement("ul");l.className="hm-milestones-list";for(let u of e){let d=document.createElement("li"),f=document.createElement("span");f.className="hm-milestone-text",u&&typeof u=="object"?(f.textContent=u.text??"",u.achieved&&d.classList.add("hm-milestone-achieved")):f.textContent=u,d.appendChild(f),l.appendChild(d)}let o=document.createElement("button");o.type="button",o.className="hm-milestones-close",o.textContent="Close";let a=()=>{n.remove(),document.removeEventListener("keydown",s)},s=u=>{u.key==="Escape"&&(u.preventDefault(),a())};n.addEventListener("click",u=>{u.target===n&&a()}),o.addEventListener("click",a),document.addEventListener("keydown",s),r.appendChild(i),r.appendChild(l),r.appendChild(o),n.appendChild(r),document.body.appendChild(n),typeof o.focus=="function"&&o.focus({preventScroll:!0})}function As(e){return String(e??"").replace(/<[^>]*>/g,"")}function Xf({src:e,mobileVolume:t,desktopVolume:n}){let r=null,i=null,l=null,o=null,a=null,s=!1,u=0;function d(){if(r)return r;let m=nc(e)||new Audio(e);return m.preload="auto",m.playsInline=!0,m.crossOrigin="anonymous",m.load?.(),r=m,r}function f(){if(!ce||!d()||!("AudioContext"in window||"webkitAudioContext"in window))return!1;try{i=i||new(window.AudioContext||window.webkitAudioContext)}catch{return i=null,!1}if(!i)return!1;if(i.state==="suspended")try{i.resume()}catch{}return l||(l=i.createGain(),l.connect(i.destination)),!0}function p(){if(!i)return null;if(o)return o;if(a)return null;let m=d()?.currentSrc||e;try{a=fetch(m).then(b=>b.ok?b.arrayBuffer():Promise.reject(b.status)).then(b=>new Promise((w,L)=>{let T=!1,x=R=>{T||(T=!0,w(R))},B=R=>{T||(T=!0,L(R))},M=i.decodeAudioData(b,x,B);M&&typeof M.then=="function"&&M.then(x,B)})).then(b=>(o=b,a=null,s=!1,b)).catch(()=>(a=null,s=!1,null)),s=!1}catch{a=null,s=!1}return o||null}function h(){let m=d();if(m){m.muted=!1,m.volume=t;try{m.currentTime=0}catch{}m.play().catch(()=>{})}}function g(){if(!f()||!i||!l)return!1;let m=b=>{if(!b)return!1;try{let w=i.createBufferSource();w.buffer=b,w.connect(l);let L=i.currentTime;try{l.gain.setValueAtTime(t,L)}catch{l.gain.value=t}return w.start(),!0}catch{return!1}};if(o)return m(o);if(u+=1,a||p(),!a){let b=Math.max(1,u);u=0;for(let w=0;w<b;w+=1)h();return!0}return a&&!s&&(s=!0,a.then(b=>{let w=Math.max(1,u);if(u=0,!b){for(let L=0;L<w;L+=1)h();return}for(let L=0;L<w;L+=1)if(!m(b)){h();break}})),!0}function v(){let m=d();if(!m)return;m.volume=n;let b=m.cloneNode();b.volume=n,b.play().catch(()=>{})}return{play(){try{if(ce){if(g())return;h();return}v()}catch{}}}}function ni(){np.play()}function Ah(){rp.play()}function Mh(e){return`<img alt="" src="${Fs[e]||Fs.coins}" class="coin-ico">`}function Yf(){let e=Te?.querySelector(".shop-scroller");if(!e||e.__customScroll)return;let t=document.createElement("div");t.className="shop-scrollbar";let n=document.createElement("div");n.className="shop-scrollbar__thumb",t.appendChild(n),he.appendChild(t),e.__customScroll={bar:t,thumb:n};let r=window.matchMedia("(hover: none) and (pointer: coarse)").matches,i=150,l=120,o="onscrollend"in window,a=()=>{let x=(e.scrollTop||0)>0;he?.classList.toggle("has-scroll-shadow",x)},s=()=>{let x=Te.querySelector(".shop-grabber"),B=Te.querySelector(".shop-header"),M=Te.querySelector(".shop-actions"),R=(x?.offsetHeight||0)+(B?.offsetHeight||0)|0,k=(M?.offsetHeight||0)|0;t.style.top=R+"px",t.style.bottom=k+"px"},u=()=>{let{scrollHeight:x,clientHeight:B,scrollTop:M}=e,R=t.clientHeight,k=B/Math.max(1,x),H=Math.max(28,Math.round(R*k)),J=Math.max(1,x-B),se=Math.max(0,R-H),ke=Math.round(M/J*se);n.style.height=H+"px",n.style.transform=`translateY(${ke}px)`,t.style.display=x<=B+1?"none":""},d=()=>{s(),u(),a()},f=()=>{r&&(he.classList.add("is-scrolling"),clearTimeout(e.__fadeTimer))},p=x=>{r&&(clearTimeout(e.__fadeTimer),e.__fadeTimer=setTimeout(()=>{he.classList.remove("is-scrolling")},x))},h=()=>{u(),a(),r&&f(),o||p(i)},g=()=>p(i);e.addEventListener("scroll",h,{passive:!0}),o&&e.addEventListener("scrollend",g,{passive:!0}),new ResizeObserver(d).observe(e),window.addEventListener("resize",d),requestAnimationFrame(d);let v=!1,m=0,b=0,w=x=>{v=!0,m=x.clientY,b=e.scrollTop,n.classList.add("dragging"),f();try{n.setPointerCapture(x.pointerId)}catch{}x.preventDefault()},L=x=>{if(!v)return;let B=t.clientHeight,M=n.clientHeight,R=Math.max(1,B-M),k=Math.max(1,e.scrollHeight-e.clientHeight),H=(x.clientY-m)/R*k;e.scrollTop=b+H},T=x=>{if(v){v=!1,n.classList.remove("dragging"),p(l);try{n.releasePointerCapture(x.pointerId)}catch{}}};n.addEventListener("pointerdown",w),window.addEventListener("pointermove",L,{passive:!0}),window.addEventListener("pointerup",T),window.addEventListener("pointercancel",T),t.addEventListener("pointerdown",x=>{if(x.target===n)return;let B=t.getBoundingClientRect(),M=x.clientY-B.top,R=t.clientHeight,k=n.clientHeight,H=Math.max(0,R-k),J=Math.max(0,Math.min(M-k/2,H)),se=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=J/Math.max(1,H)*se,f(),p(i)})}function _h(){let e=To(),t=rr(e);Sl={};for(let n of t){let r=gt(e,n.id),i=kt(e,n.id),l=Yr(e,n.id),o=l.iconOverride??ts(n),a=l.titleOverride??n.title,s=l.descOverride??n.desc,u=!!l.locked,d=n.upgType==="HM"?!!jr(e,n.id)?.hmReadyToEvolve:!1;Sl[n.id]={id:n.id,icon:o,title:a,desc:s,level:r,levelNumeric:i,area:n.area,meta:n,locked:u,lockState:l,useLockedBase:!!l.useLockedBase||u,baseIconOverride:n.baseIconOverride||l.baseIconOverride||null,hmReady:d}}}function jf(e,t,n){if(!e)return c.fromInt(0);let r=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!r)return c.fromInt(0);if(r.isInfinite?.())return c.fromAny("Infinity");let i;try{i=t instanceof c?t:c.fromAny(t??n??0)}catch{let s=Math.max(0,Math.floor(Number(n)||0));i=c.fromInt(s)}if(i.isInfinite?.())return c.fromInt(0);try{let s=r.toPlainIntegerString?.(),u=i.toPlainIntegerString?.();if(s==="Infinity")return c.fromAny("Infinity");if(s&&u&&s!=="Infinity"&&u!=="Infinity"){let d=BigInt(s),f=BigInt(u),p=d-f;return p>0n?c.fromAny(p.toString()):c.fromInt(0)}}catch{}let l=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(l))return c.fromAny("Infinity");let o=Math.max(0,Math.floor(Number(n)||0)),a=Math.max(0,l-o);if(a>0)try{return c.fromAny(a)}catch{return c.fromInt(a|0)}return c.fromInt(0)}function Th(e,t,n){let r;try{r=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));r=c.fromInt(d)}if(r.isInfinite?.())return c.fromInt(0);let i=Math.max(0,Math.floor(Number(t)||0)),l=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,o=P[e.costType]?.value,a=o instanceof c?o:c.fromAny(o??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",f=Number.isFinite(l)&&i>=l;return d&&!f||!Number.isFinite(l)?c.fromAny("Infinity"):jf(e,r,t)}if(Number.isFinite(l)&&i>=l)return c.fromInt(0);try{let d=levelBigNumToNumber(r.add(c.fromInt(1))),f=c.fromAny(e.costAtLevel(i)),p=c.fromAny(e.costAtLevel(d)),h=Math.min(Number.isFinite(l)?l:i+32,i+32),g=c.fromAny(e.costAtLevel(h));if(f.cmp(p)===0&&f.cmp(g)===0){let b=jf(e,r,i),w=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(levelBigNumToNumber(b))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,L=0,T=Math.max(0,w);for(;L<T;){let x=Math.floor((L+T+1)/2),B=c.fromInt(x);(typeof f.mulBigNumInteger=="function"?f.mulBigNumInteger(B):c.fromAny(f??0).mulBigNumInteger(B)).cmp(a)<=0?L=x:T=x-1}return c.fromInt(L)}let v=Number.isFinite(l)?Math.max(0,l-i):void 0,{count:m}=il(e,r,a,v,{fastOnly:!0});return m??c.fromInt(0)}catch{}let s=Number.isFinite(l)?Math.max(0,l-i):void 0,{count:u}=il(e,r,a,s,{fastOnly:!0});return u??c.fromInt(0)}function Fh(){let e=Te?.querySelector("#shop-grid");if(e){e.innerHTML="";for(let t in Sl){let n=Sl[t],r=document.createElement("button");r.className="shop-upgrade",r.setAttribute("data-upgid",n.id),r.type="button",r.setAttribute("role","gridcell"),r.dataset.upgId=String(n.id);let i=!!n.locked,l=n.lockState?.iconOverride,o=typeof l=="string"&&l.includes("mysterious"),a=i&&(n.lockState?.hidden||o),s=i&&!a;r.classList.toggle("is-locked",i),r.classList.toggle("is-locked-plain",s),r.disabled=s,s?(r.setAttribute("aria-disabled","true"),r.setAttribute("tabindex","-1")):(r.removeAttribute("aria-disabled"),r.removeAttribute("tabindex")),r.dataset.locked=i?"1":"0",r.dataset.lockedPlain=s?"1":"0",r.dataset.mysterious=a?"1":"0";let u=n.meta?.upgType==="HM",d=u&&n.hmReady,f=u&&n.level?.isInfinite?.();r.classList.toggle("hm-evolve-ready",d);let p=i?c.fromInt(0):Th(n.meta,n.levelNumeric,n.level),h=p instanceof c?p:c.fromAny(p),g=K(n.level),v=As(g),m=K(h),b=As(m),w=!h.isZero?.(),L=Number.isFinite(n.lvlCap)?n.lvlCap:Number.isFinite(n.meta?.lvlCap)?n.meta.lvlCap:1/0,T=Number.isFinite(L)?Math.max(0,Math.floor(L)):1/0,x=Number.parseFloat(String(v||"").replace(/,/g,"")),B=Number.isFinite(n.levelNumeric)?n.levelNumeric:Number.isFinite(x)?x:NaN,M=Number.isFinite(T),R=d?!1:f?!0:M&&Number.isFinite(B)?B>=T:!1,k=n.meta?.tie===U.BOOK_VALUE_I,H=M&&T===1,J=!!n.meta?.unlockUpgrade||H&&!k,se=!i&&J&&!R,ke=!i&&J&&!se&&R,Y,ie,te=!1;if(i){Y="",ie="";let N=a?(n.lockState?.reason||"").trim():"",D=N?`${n.title} (Locked, ${N})`:`${n.title} (Locked)`;r.setAttribute("aria-label",D)}else if(se||ke)Y=se?"Unlockable":"Unlocked",ie=Y,r.setAttribute("aria-label",`${n.title}, ${ie}`);else{let N=Number.isFinite(n.levelNumeric)?n.levelNumeric:NaN,D=String(v||"").replace(/,/g,""),V=/|Infinity/i.test(D),G=Number.isFinite(N)?N>=1e3:V||/^\d{4,}$/.test(D);if(te=w&&G,te){let Ve=`<span class="badge-lvl">${g}</span>`,F=`<span class="badge-plus">(+${m})</span>`;Y=`${Ve}${F}`,ie=`${v} (+${b})`}else Y=w?`${g} (+${m})`:g,ie=w?`${v} (+${b})`:v;r.setAttribute("aria-label",`${n.title}, level ${ie}`)}i?r.title=a?"Hidden Upgrade":"Locked Upgrade":n.meta?.unlockUpgrade?r.title="Left-click: Details \u2022 Right-click: Unlock":r.title="Left-click: Details \u2022 Right-click: Buy Max";let $=document.createElement("div");$.className="shop-tile";let q=document.createElement("img");q.className="base";let j=n.meta?.costType||"coins",W=n.useLockedBase||i,ve=Ts[j]||Ts.coins,re=n.baseIconOverride||ve;q.src=W?Kf:re,q.alt="";let X=document.createElement("img");if(X.className="icon",X.src=n.icon||$s,X.alt="",X.addEventListener("error",()=>{X.src=$s}),r.addEventListener("click",N=>{if(r.disabled||s){N.preventDefault(),N.stopImmediatePropagation();return}if(Wr(r)){N.preventDefault(),N.stopImmediatePropagation();return}oe(r),$h(n.meta)}),r.addEventListener("pointerdown",N=>{if(r.disabled||s){N.preventDefault(),N.stopPropagation(),N.stopImmediatePropagation?.();return}N.pointerType!=="mouse"&&oe(r)}),r.addEventListener("contextmenu",N=>{if(ce||i)return;N.preventDefault(),N.stopPropagation();let D=To(),{bought:V}=rl(D,n.id);if(!(V instanceof c?V:c.fromAny(V??0)).isZero?.()){if(ni(),Hf(n.meta))try{bs(["reset"])}catch{}yt()}}),$.appendChild(q),!i&&R){let N=document.createElement("img");N.className="maxed-overlay",N.src=Qf,N.alt="",$.appendChild(N)}if($.appendChild(X),!i){let N=document.createElement("span");N.className="level-badge",te&&N.classList.add("two-line"),Y===ie?N.textContent=Y:N.innerHTML=Y,(w||se)&&N.classList.add("can-buy"),R&&N.classList.add("is-maxed"),$.appendChild(N)}r.appendChild($),e.appendChild(r)}}}function Ph(){if(Te)return;Te=document.createElement("div"),Te.className="shop-overlay",Te.id="shop-overlay",he=document.createElement("div"),he.className="shop-sheet",he.setAttribute("role","dialog"),he.setAttribute("aria-modal","false"),he.setAttribute("aria-label","Shop");let e=document.createElement("div");e.className="shop-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("div");t.className="shop-content";let n=document.createElement("header");n.className="shop-header",n.innerHTML='<div class="shop-title">Shop</div><div class="shop-line" aria-hidden="true"></div>';let r=document.createElement("div");r.className="shop-grid",r.id="shop-grid",r.setAttribute("role","grid"),r.setAttribute("aria-label","Shop Upgrades");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),t.append(n,i),Yf();let l=document.createElement("div");l.className="shop-actions";let o=document.createElement("button");o.type="button",o.className="shop-close",o.textContent="Close";let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve";let s=()=>{Wr(a)||(oe(a),Qr(),hs())};if(a.addEventListener("click",s),ra=a,cr=()=>{if(!ra)return;let u=nh();ra.classList.toggle("is-new",!u)},cr(),l.appendChild(o),l.append(a),he.append(e,t,l),Te.appendChild(he),document.body.appendChild(Te),Te.addEventListener("pointerdown",u=>{u.pointerType!=="mouse"&&(ri=!0)},{capture:!0,passive:!0}),Te.addEventListener("touchstart",()=>{ri=!0},{capture:!0,passive:!0}),Te.addEventListener("click",u=>{if(ce&&!ri){u.preventDefault(),u.stopImmediatePropagation();return}},{capture:!0}),yt(!0),!_s){let u=function(m){ce&&We(80),El()};_s=!0,o.addEventListener("click",u,{passive:!0});let d=typeof window<"u"&&"PointerEvent"in window;d?o.addEventListener("pointerdown",m=>{m.pointerType!=="mouse"&&(typeof m.button=="number"&&m.button!==0||(oe(o),We(80),El(),m.preventDefault()))},{passive:!1}):o.addEventListener("touchstart",m=>{oe(o),We(80),El(),m.preventDefault()},{passive:!1});let f=m=>{m.pointerType!=="mouse"&&(typeof m.button=="number"&&m.button!==0||(oe(a),Qr(),hs(),m.preventDefault()))},p=m=>{oe(a),Qr(),hs(),m.preventDefault()};d?a.addEventListener("pointerdown",f,{passive:!1}):a.addEventListener("touchstart",p,{passive:!1}),document.addEventListener("keydown",Bh),e.addEventListener("pointerdown",Uh),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1});let h=null,g=()=>{Ct&&(clearTimeout(h),h=setTimeout(()=>{yt()},60))};window.addEventListener("currency:change",g),window.addEventListener("xp:change",g),window.addEventListener("xp:unlock",g);let v=()=>{Ct&&yt()};document.addEventListener("ccc:upgrades:changed",v),window.addEventListener(Es,()=>{typeof cr=="function"&&cr(),Ct&&yt()})}}function Oh(){if(Ke)return;Ke=document.createElement("div"),Ke.className="upg-overlay",ae=document.createElement("div"),ae.className="upg-sheet",ae.setAttribute("role","dialog"),ae.setAttribute("aria-modal","false"),ae.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let r=document.createElement("div");r.className="upg-actions",ae.append(e,t,n,r),Ke.appendChild(ae),document.body.appendChild(Ke),Ke.addEventListener("pointerdown",s=>{ce&&s.pointerType!=="mouse"&&s.target===Ke&&(s.preventDefault(),s.stopPropagation())},!0),Ke.addEventListener("click",s=>{ce&&s.target===Ke&&(s.preventDefault(),s.stopImmediatePropagation())},!0);let i=null;function l(s){if(!xl)return;let u=typeof s.clientY=="number"?s.clientY:s.touches?.[0]?.clientY||0;i={startY:u,lastY:u,moved:0},ae.style.transition="none",window.addEventListener("pointermove",o),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function o(s){if(!i)return;let u=s.clientY;if(typeof u!="number")return;let d=Math.max(0,u-i.startY);i.lastY=u,i.moved=d,ae.style.transform=`translateY(${d}px)`}function a(s){if(!i)return;let u=i.moved>140;if(ae.style.transition="transform 160ms ease",ae.style.transform=u?"translateY(100%)":"translateY(0)",u){if(ce&&(!s||s.pointerType!=="mouse"))try{We(120)}catch{}setTimeout(wl,160)}i=null,window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",l,{passive:!0})}function wl(){if(ce)try{We(160)}catch{}if(typeof Ll=="function"){let e=Ll;Ll=null;try{e()}catch{}}xl=!1,!(!Ke||!ae)&&(ae.style.transition="",ae.style.transform="",Ke.classList.remove("is-open"),Ke.style.pointerEvents="none")}function $h(e){Oh(),xl=!0;let t=!0,n=To(),r=Yr(n,e.id)||{},i=!!r.locked,l=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!l){xl=!1;return}let o=e.upgType==="HM",a=e.tie===U.ENDLESS_XP,s=()=>jr(n,e.id),u=m=>{let b=document.createElement("div");return b.style.height=m,b},d=m=>{let b=document.createElement("div");return b.className="upg-line",b.innerHTML=m,b};function f(m){let b=ae.querySelector(".upg-content");if(!b)return;let w=m?.lockState||Yr(n,e.id)||{},L=!!(w.hidden||w.hideEffect||w.hideCost);if(!m||!m.unlockUpgrade||L){b.style.marginTop="";return}let T=ae.querySelector(".upg-header"),x=ae.querySelector(".upg-actions");if(!T||!x)return;b.style.marginTop="";let B=T.getBoundingClientRect(),M=x.getBoundingClientRect(),R=b.getBoundingClientRect(),k=M.top-B.bottom-R.height;if(k<=0)return;let H=k*.42;b.style.marginTop=`${H}px`}let p=()=>{let m=s();if(!m)return;let b=m.lockState||Yr(n,e.id),w=!!b?.locked,L=w&&(b?.hidden||b?.hideEffect||b?.hideCost),T=w&&L,x=!!m.unlockUpgrade&&!T;ae.classList.toggle("is-locked-hidden",T);let B=ae.querySelector(".upg-header");B.innerHTML="";let M=document.createElement("div");M.className="upg-title",M.textContent=m.displayTitle||m.upg.title;let R=!!m.hmReadyToEvolve,k=R?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,H=document.createElement("div");H.className="upg-level";let J=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??K(m.lvlCapBn),se=m.lvlCapFmtText??m.upg.lvlCapFmtText??As(J),ke=R?`Level ${m.lvlFmtHtml} / ${J} (EVOLVE READY)`:k?`Level ${m.lvlFmtHtml} / ${J} (MAXED)`:`Level ${m.lvlFmtHtml} / ${J}`,Y=R?`Level ${m.lvlFmtText} / ${se} (EVOLVE READY)`:k?`Level ${m.lvlFmtText} / ${se} (MAXED)`:`Level ${m.lvlFmtText} / ${se}`;H.innerHTML=ke,H.setAttribute("aria-label",Y),L?H.hidden=!0:(H.hidden=!1,H.removeAttribute("aria-hidden")),ae.classList.toggle("is-maxed",k),ae.classList.toggle("hm-evolve-ready",R),ae.classList.toggle("is-unlock-upgrade",x),B.append(M,H);let ie=ae.querySelector(".upg-content");ie.innerHTML="",ie.scrollTop=0,ae.classList.toggle("is-hm-upgrade",o),ae.classList.toggle("is-endless-xp",a);let te=document.createElement("div");te.className="upg-desc centered",T&&te.classList.add("lock-desc");let $=(m.displayDesc||m.upg.desc||"").trim();R?(te.classList.add("hm-evolve-note"),te.textContent="Evolve this upgrade to multiply its effect by 1000x"):$?te.textContent=$:te.hidden=!0,ie.appendChild(te);let q=document.createElement("div");if(q.className="upg-info",q.appendChild(u("12px")),w&&b?.reason&&!L){let N=(m.displayDesc||"").trim(),D=String(b.reason??"").trim();if(!(N&&N===D)){let V=document.createElement("div");V.className="upg-line lock-note",V.textContent=b.reason,q.appendChild(V),q.appendChild(u("12px"))}}if(m.effect&&!(w&&b?.hideEffect)){let N=m.effect;q.appendChild(d(`<span class="bonus-line">${N}</span>`)),q.appendChild(u("12px"))}let j=Mh(m.upg.costType),W=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ve=k||R;if(!m.unlockUpgrade&&!ve&&(!w||!b?.hideCost)){let N=document.createElement("div");N.className="upg-costs";let D=document.createElement("div");if(D.className="upg-line",D.innerHTML=`Cost: ${j} ${P[m.upg.costType].fmt(W)}`,N.appendChild(D),o){let G=document.createElement("div");G.className="upg-line";let Ve="\u2014";try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0){let F=m.hmNextMilestone.sub(m.lvlBn),we=F.toPlainIntegerString?.(),Z=Math.max(0,Math.floor(Number(we&&we!=="Infinity"?we:Number(F.toString()||0)))),{spent:pe}=il(m.upg,m.lvlBn,c.fromAny("Infinity"),Z);Ve=P[m.upg.costType].fmt(pe)}}catch{}G.innerHTML=`Cost to next milestone: ${j} ${Ve}`,N.appendChild(G)}let V=document.createElement("div");V.className="upg-line",V.innerHTML=`You have: ${j} ${P[m.upg.costType].fmt(m.have)}`,N.appendChild(V),q.appendChild(N)}if(ie.appendChild(q),o){let N=document.createElement("div");N.className="hm-view-milestones-row";let D=document.createElement("button");D.type="button",D.className="shop-delve hm-view-milestones",D.textContent="View Milestones",D.addEventListener("click",()=>{let V=Array.isArray(m.hmMilestones)?m.hmMilestones:[];if(!V.length)return;let G=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Ve=(()=>{try{return BigInt(ht)*BigInt(G)}catch{return 0n}})(),F=Z=>{if(m.lvlBn?.isInfinite?.())return"Infinity";try{let pe=Z?.toPlainIntegerString?.();if(pe&&pe!=="Infinity"){if(pe.length<=15){let me=Number(pe);if(Number.isFinite(me))return me.toLocaleString()}return pe.replace(/\B(?=(\d{3})+(?!\d))/g,",")}}catch{}return K(Z)},we=V.sort((Z,pe)=>Number(Z?.level??0)-Number(pe?.level??0)).map(Z=>{let pe=Math.max(0,Math.floor(Number(Z?.level??0))),me=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(pe)+Ve).toString())}catch{return c.fromAny(pe+ht*G)}})(),It=me?.toPlainIntegerString?.(),Ye=F(me),Ut=xt(Z?.multiplier??Z?.mult??Z?.value??1),wt=`${Z?.target??Z?.type??"self"}`.toLowerCase(),at=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(me)>=0}catch{}if(Number.isFinite(m.lvl)&&It&&It!=="Infinity"){let z=Number(It);if(Number.isFinite(z))return m.lvl>=z}return!1})();return wt==="xp"?{text:`Level ${Ye}: Multiplies XP value by ${Ut}x`,achieved:at}:wt==="coin"||wt==="coins"?{text:`Level ${Ye}: Multiplies Coin value by ${Ut}x`,achieved:at}:wt==="mp"?{text:`Level ${Ye}: Multiplies MP value by ${Ut}x`,achieved:at}:{text:`Level ${Ye}: Multiplies this upgrade\u2019s effect by ${Ut}x`,achieved:at}});Ch(we)}),N.appendChild(D),ie.appendChild(N)}let re=ae.querySelector(".upg-actions");re.innerHTML="";let X=document.createElement("button");if(X.type="button",X.className="shop-close",X.textContent="Close",X.addEventListener("click",()=>{t=!1,wl()}),"PointerEvent"in window?X.addEventListener("pointerdown",N=>{N.pointerType!=="mouse"&&(typeof N.button=="number"&&N.button!==0||(oe(X),Zt(320),We(160),t=!1,wl(),N.preventDefault()))},{passive:!1}):X.addEventListener("touchstart",N=>{oe(X),Zt(320),We(160),t=!1,wl(),N.preventDefault()},{passive:!1}),w)re.append(X),X.focus();else if(k)re.append(X),X.focus();else{let N=m.have.cmp(W)>=0;if(R){let F=document.createElement("button");F.type="button",F.className="shop-delve hm-evolve-btn",F.textContent="Evolve",F.addEventListener("click",()=>{let{evolved:we}=uf(n,e.id);we&&(Ah(),yt(),p())}),re.append(X,F),F.focus(),f(m);return}if(m.unlockUpgrade){let F=document.createElement("button");F.type="button",F.className="shop-delve",F.textContent="Unlock",F.disabled=!N,F.addEventListener("click",()=>{let{bought:we}=_o(n,e.id);if(!(we instanceof c?we:c.fromAny(we??0)).isZero?.()){if(ni(),Hf(e))try{bs(["reset"])}catch{}yt(),p()}}),re.append(X,F),(N?F:X).focus(),f(m);return}let D=document.createElement("button");D.type="button",D.className="shop-delve",D.textContent="Buy",D.disabled=!N;let V=()=>{let F=jr(n,e.id),we=F.nextPrice instanceof c?F.nextPrice:c.fromAny(F.nextPrice||0);if(F.have.cmp(we)<0)return;let{bought:Z}=_o(n,e.id);(Z instanceof c?Z:c.fromAny(Z??0)).isZero?.()||(ni(),yt(),p())};"PointerEvent"in window?D.addEventListener("pointerdown",F=>{F.pointerType!=="mouse"&&(typeof F.button=="number"&&F.button!==0||(typeof oe=="function"&&oe(D,160),V(),F.preventDefault()))},{passive:!1}):D.addEventListener("touchstart",F=>{typeof oe=="function"&&oe(D,160),V(),F.preventDefault()},{passive:!1}),D.addEventListener("click",F=>{ce||(typeof oe=="function"&&oe(D,160),V())});let G=document.createElement("button");G.type="button",G.className="shop-delve",G.textContent="Buy Max",G.disabled=!N;let Ve=()=>{if(G.disabled||jr(n,e.id).have.cmp(c.fromInt(1))<0)return;let{bought:F}=rl(n,e.id);(F instanceof c?F:c.fromAny(F??0)).isZero?.()||(ni(),yt(),p())};if("PointerEvent"in window?G.addEventListener("pointerdown",F=>{F.pointerType!=="mouse"&&(typeof F.button=="number"&&F.button!==0||(typeof oe=="function"&&oe(G,160),Ve(),F.preventDefault()))},{passive:!1}):G.addEventListener("touchstart",F=>{typeof oe=="function"&&oe(G,160),Ve(),F.preventDefault()},{passive:!1}),G.addEventListener("click",F=>{ce||(typeof oe=="function"&&oe(G,160),Ve())}),re.append(X,D,G),o){let F=document.createElement("button");F.type="button",F.className="shop-delve",F.textContent="Buy Next",F.disabled=m.have.cmp(c.fromInt(1))<0;let we=()=>{if(F.disabled)return;let Z=jr(n,e.id);if(Z.hmReadyToEvolve)return;let pe=Z.hmNextMilestone;if(!pe||!Z.lvlBn||pe.cmp(Z.lvlBn)<=0){let{bought:z}=rl(n,e.id);(z instanceof c?z:c.fromAny(z??0)).isZero?.()||(ni(),yt(),p());return}let me=0;try{let z=pe.sub(Z.lvlBn).toPlainIntegerString?.();z&&z!=="Infinity"?me=Number(z):me=Number(pe.sub(Z.lvlBn).toString())}catch{}me=Math.max(0,Math.floor(me));let It=P[Z.upg.costType]?.value,Ye=It instanceof c?It:c.fromAny(It??0),Ut=il(Z.upg,Z.lvlBn,Ye,me).count,wt=!1;try{let z=Ut?.toPlainIntegerString?.();z&&z!=="Infinity"?wt=Number(z)>=me:wt=Number(Ut??0)>=me}catch{}let at=wt?df(n,e.id,me):rl(n,e.id);(at.bought instanceof c?at.bought:c.fromAny(at.bought??0)).isZero?.()||(ni(),yt(),p())};"PointerEvent"in window?F.addEventListener("pointerdown",Z=>{Z.pointerType!=="mouse"&&(typeof Z.button=="number"&&Z.button!==0||(typeof oe=="function"&&oe(F,160),we(),Z.preventDefault()))},{passive:!1}):F.addEventListener("touchstart",Z=>{typeof oe=="function"&&oe(F,160),we(),Z.preventDefault()},{passive:!1}),F.addEventListener("click",Z=>{ce||(typeof oe=="function"&&oe(F,160),we())}),re.appendChild(F)}(N?D:X).focus()}f(m)},h=()=>{t&&p()},g=()=>{t&&p()};window.addEventListener("currency:change",h),window.addEventListener("xp:change",h),window.addEventListener("xp:unlock",h),document.addEventListener("ccc:upgrades:changed",g),p(),Ke.classList.add("is-open"),Ke.style.pointerEvents="auto",We(140),ae.style.transition="none",ae.style.transform="translateY(100%)",ae.offsetHeight,requestAnimationFrame(()=>{ae.style.transition="",ae.style.transform=""});let v=m=>{t&&m.key==="Escape"&&(m.preventDefault(),t=!1,wl())};window.addEventListener("keydown",v,!0),Ll=()=>{t=!1,window.removeEventListener("currency:change",h),window.removeEventListener("xp:change",h),window.removeEventListener("xp:unlock",h),document.removeEventListener("ccc:upgrades:changed",g),window.removeEventListener("keydown",v,!0)}}function Bh(e){Ct&&e.key==="Escape"&&(e.preventDefault(),El())}function Rh(){Ph(),At&&(clearTimeout(At),At=null),typeof cr=="function"&&cr(),yt(!0),!Ct&&(Ct=!0,he.style.transition="none",he.style.transform="",Te.style.pointerEvents="auto",he.offsetHeight,requestAnimationFrame(()=>{if(he.style.transition="",Te.classList.add("is-open"),Wf=performance.now(),ri=!1,ce)try{setTimeout(()=>Zt(240),120)}catch{}We(10),Yf();let e=Te.querySelector("#shop-grid .shop-upgrade")||Te.querySelector("#shop-grid");e&&e.focus()}))}function El(e=!1){let t=e===!0,n=Te?.classList?.contains("is-open");if(!t&&!Ct&&!n){At&&(clearTimeout(At),At=null);return}At&&(clearTimeout(At),At=null),Ct=!1,he&&(he.style.transition="",he.style.transform=""),Te.classList.remove("is-open"),Te.style.pointerEvents="none",ri=!1}function Uh(e){if(!Ct)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;lt={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},he.style.transition="none",window.addEventListener("pointermove",Gf),window.addEventListener("pointerup",Zf),window.addEventListener("pointercancel",zf)}function Gf(e){if(!lt||lt.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-lt.startY);lt.lastY=t,lt.moved=n,he.style.transform=`translateY(${n}px)`}function Zf(){if(!lt||lt.canceled)return Ms();let e=Math.max(1,performance.now()-lt.startT),t=lt.moved;t/e>.55&&t>40||t>140?(Zt(100),We(80),he.style.transition="transform 140ms ease-out",he.style.transform="translateY(100%)",Ct=!1,At=setTimeout(()=>{At=null,El(!0)},150)):(he.style.transition="transform 180ms ease",he.style.transform="translateY(0)"),Ms()}function zf(){lt&&(lt.canceled=!0,he.style.transition="transform 180ms ease",he.style.transform="translateY(0)",Ms())}function Ms(){window.removeEventListener("pointermove",Gf),window.removeEventListener("pointerup",Zf),window.removeEventListener("pointercancel",zf),lt=null}function yt(e=!1){!e&&!Ct||(_h(),Fh())}var Te,he,Ct,lt,_s,ra,cr,At,Wf,ri,Ts,Kf,Qf,Fs,Jf,ep,tp,Ps,Os,np,rp,$s,Sl,Ke,ae,xl,Ll,ip=Ne(()=>{et(),St(),en(),Mi(),qf(),ic(),zr(),gl(),Te=null,he=null,Ct=!1,lt=null,_s=!1,ra=null,cr=null,At=null,Wf=0,ri=!1,typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof y=="function"?y():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||yt(!0)}),Ts={coins:"img/currencies/coin/coin_base.png",books:"img/currencies/book/book_base.png",gold:"img/currencies/gold/gold_base.png"},Kf="img/misc/locked_base.png",Qf="img/misc/maxed.png",Fs={coins:"img/currencies/coin/coin.png",books:"img/currencies/book/book.png",gold:"img/currencies/gold/gold.png"},Jf=7,ep="sounds/purchase_upg.mp3",tp="sounds/evolve_upg.mp3",Ps=.12,Os=.3,np=Xf({src:ep,mobileVolume:Ps,desktopVolume:Os}),rp=Xf({src:tp,mobileVolume:Ps*2,desktopVolume:Os*2}),$s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO3x0S8AAAAASUVORK5CYII=",Sl={},Ke=null,ae=null,xl=!1,Ll=null}),lp={};Ze(lp,{applyHudLayout:()=>yn,initHudButtons:()=>Vh,isMapUnlocked:()=>ap,isShopUnlocked:()=>op,lockMap:()=>qs,lockShop:()=>Vs,unlockMap:()=>Ds,unlockShop:()=>kl});function Bs(e){let t=y();return t==null?e:`${e}:${t}`}function ii(e){let t=Bs(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function op(){return Rs(),ii(Mt.SHOP)}function ap(){return Rs(),ii(Mt.MAP)}function ia(e,t){let n=t?"1":"0",r=Bs(e);localStorage.setItem(r,n),r!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:y()}}))}catch{}}function Rs(){for(let e of Object.values(Mt)){let t=Bs(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function Wt(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function Us(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",zl())}function Dh(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function yn(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),r=Dh(),i=(r&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(s=>e.querySelector(`.game-btn[data-btn="${s}"]`)).filter(Boolean),l=[...e.children].filter(s=>!i.includes(s)),o=[...i,...l];if(o.length&&o.some((s,u)=>e.children[u]!==s)){let s=document.createDocumentFragment();o.forEach(u=>s.appendChild(u)),e.appendChild(s)}let a=[...e.querySelectorAll(".game-btn")].filter(s=>!s.hidden);if(e.classList.remove("is-2","is-3","is-4"),a.forEach(s=>{s.style.gridColumn="",s.style.gridRow="",s.classList.remove("span-2"),s.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${a.length}`),!r){let s=getComputedStyle(e),u=parseFloat(s.columnGap||s.gap||"0")||0,d=e.clientWidth,f=Math.max(180,Math.floor((d-3*u)/4));if(a.length===2){e.style.gridTemplateColumns=`1fr ${f}px ${f}px 1fr`,a[0].style.gridColumn="2",a[1].style.gridColumn="3";return}if(a.length===3){e.style.gridTemplateColumns=`1fr ${f}px ${f}px ${f}px 1fr`,a[0].style.gridColumn="2",a[1].style.gridColumn="3",a[2].style.gridColumn="4";return}}if(r&&a.length===3){let s=e.querySelector('[data-btn="help"]:not([hidden])'),u=e.querySelector('[data-btn="stats"]:not([hidden])'),d=e.querySelector('[data-btn="shop"]:not([hidden])');s&&u&&d&&(s.style.gridColumn="1",s.style.gridRow="1",u.style.gridColumn="2",u.style.gridRow="1",d.style.gridColumn="1 / -1",d.style.gridRow="2")}}function Vh(){if(Rs(),Wt("help",!0),Wt("stats",!0),Wt("shop",ii(Mt.SHOP)),Wt("map",ii(Mt.MAP)),Us(),yn(),Hs||(Hs=!0,window.addEventListener("resize",yn),window.addEventListener("orientationchange",yn),window.addEventListener("saveSlot:change",()=>{Wt("shop",ii(Mt.SHOP)),Wt("map",ii(Mt.MAP)),Us(),yn()}),window.addEventListener("saveSlot:modified",e=>{let t=y(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||Us()})),!Xs){Xs=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{o&&o.getAttribute("data-btn")==="shop"&&Rh()},n=o=>{let a=o.target.closest(".game-btn");!a||a.getAttribute("data-btn")!=="shop"||Wr(a)||(oe(a),t(a))},r=typeof window<"u"&&"PointerEvent"in window,i=o=>{if(o.pointerType==="mouse"||typeof o.button=="number"&&o.button!==0)return;let a=o.target.closest(".game-btn");!a||a.getAttribute("data-btn")!=="shop"||(oe(a),t(a),o.preventDefault())},l=o=>{let a=o.target.closest(".game-btn");!a||a.getAttribute("data-btn")!=="shop"||(oe(a),t(a),o.preventDefault())};e.addEventListener("click",n,{passive:!0}),r?e.addEventListener("pointerdown",i,{passive:!1}):e.addEventListener("touchstart",l,{passive:!1})}}}function kl(){ia(Mt.SHOP,!0),Wt("shop",!0),yn()}function Ds(){ia(Mt.MAP,!0),Wt("map",!0),yn()}function Vs(){ia(Mt.SHOP,!1),Wt("shop",!1),yn()}function qs(){ia(Mt.MAP,!1),Wt("map",!1),yn()}var Mt,Hs,Xs,Ys=Ne(()=>{ip(),et(),gl(),Mt={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"},Hs=!1,Xs=!1}),cp={};Ze(cp,{applyAllCurrencyOverridesForActiveSlot:()=>Ml,applyStatMultiplierOverride:()=>Ws,getDebugCurrencyMultiplierOverride:()=>_l,getDebugStatMultiplierOverride:()=>Jh,setDebugCurrencyMultiplierOverride:()=>gp,setDebugPanelAccess:()=>My,setDebugStatMultiplierOverride:()=>vt});function Nl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function qh(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function On(e){typeof e=="function"&&ga.push(e)}function la(){return{sections:new Set,subsections:new Set}}function Hh(){let e=document.getElementById(li);if(!e)return la();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(r=>{let i=r.dataset.sectionKey??r.textContent;r.classList.contains("expanded")&&t.add(i)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(r=>{let i=r.dataset.subsectionKey??r.textContent;r.classList.contains("expanded")&&n.add(i)}),{sections:t,subsections:n}}function Xh(e){let{sections:t,subsections:n}=ru??la();e.querySelectorAll(".debug-panel-section-toggle").forEach(r=>{let i=r.dataset.sectionKey??r.textContent;if(!t.has(i))return;let l=r.nextElementSibling;r.classList.add("expanded"),l&&l.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(r=>{let i=r.dataset.subsectionKey??r.textContent;if(!n.has(i))return;let l=r.nextElementSibling;r.classList.add("expanded"),l&&l.classList.add("active")})}function sp(){ga.forEach(e=>{try{e?.()}catch{}}),ga=[],ha.length=0}function $t(e){!e||typeof e.refresh!="function"||ha.push(e)}function Ge(e){ha.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function Yh(){if(typeof window>"u")return;let e=a=>{let{key:s,slot:u}=a?.detail??{},d=u??y();Ge(f=>f.type==="currency"&&f.key===s&&f.slot===d)};window.addEventListener("currency:change",e,{passive:!0}),On(()=>window.removeEventListener("currency:change",e));let t=a=>{let{key:s,slot:u}=a?.detail??{},d=u??y();Ge(f=>f.type==="currency-mult"&&f.key===s&&f.slot===d)};window.addEventListener("currency:multiplier",t,{passive:!0}),On(()=>window.removeEventListener("currency:multiplier",t));let n=a=>{let{slot:s}=a?.detail??{},u=s??y();Ge(d=>d.type==="xp"&&d.slot===u)};window.addEventListener("xp:change",n,{passive:!0}),On(()=>window.removeEventListener("xp:change",n));let r=()=>{let a=y();Ge(s=>s.type==="mutation"&&s.slot===a),Ge(s=>s.type==="stat-mult"&&s.key==="mutation"&&s.slot===a)};window.addEventListener("mutation:change",r,{passive:!0}),On(()=>window.removeEventListener("mutation:change",r));let i=()=>{let a=y();Ge(s=>s.type==="upgrade"&&s.slot===a),Ge(s=>s.type==="currency-mult"&&s.slot===a),Ge(s=>s.type==="stat-mult"&&s.slot===a)};document.addEventListener("ccc:upgrades:changed",i,{passive:!0}),On(()=>document.removeEventListener("ccc:upgrades:changed",i));let l=()=>{let a=y();Ge(s=>s.slot===a)};window.addEventListener("saveSlot:change",l,{passive:!0}),On(()=>window.removeEventListener("saveSlot:change",l));let o=a=>{let{slot:s,key:u}=a?.detail??{},d=s??y();Ge(f=>f.type==="unlock"&&(f.slot==null||f.slot===d)&&(f.key==null||f.key===u))};window.addEventListener("unlock:change",o,{passive:!0}),On(()=>window.removeEventListener("unlock:change",o))}function oa(){return[{key:ee.STARTER_COVE,title:"The Cove",currencies:[{key:be.COINS,label:"Coins"},{key:be.BOOKS,label:"Books"},{key:be.GOLD,label:"Gold"}],stats:[{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function up(){let e=document.getElementById(tu);e||(e=document.createElement("style"),e.id=tu,e.textContent=`         .debug-panel {             position: fixed;             top: 50%;             right: 0;             transform: translateY(-50%);             width: 600px;             max-height: 100vh;             overflow-y: auto;             background: rgb(0, 0, 0);             color: #fff;             font-family: Arial, sans-serif;             padding: 12px;             border-radius: 6px 0 0 6px;             box-shadow: -2px 0 10px rgba(0, 0, 0, 0.6);             z-index: 2147483646;             scrollbar-width: thin;             scrollbar-color: rgba(255, 255, 255, 0.22) rgba(0, 0, 0, 0.5); 			border: 1px solid white;         }          .debug-panel::-webkit-scrollbar,         .debug-panel-section-content::-webkit-scrollbar,         .debug-panel-subsection-content::-webkit-scrollbar {             width: 10px;         }          .debug-panel::-webkit-scrollbar-track,         .debug-panel-section-content::-webkit-scrollbar-track,         .debug-panel-subsection-content::-webkit-scrollbar-track {             background: rgba(0, 0, 0, 0.35);             border-radius: 6px;         }          .debug-panel::-webkit-scrollbar-thumb,         .debug-panel-section-content::-webkit-scrollbar-thumb,         .debug-panel-subsection-content::-webkit-scrollbar-thumb {             background: rgba(255, 255, 255, 0.22);             border-radius: 10px;             border: 1px solid rgba(255, 255, 255, 0.1);         }          .debug-panel::-webkit-scrollbar-thumb:hover,         .debug-panel-section-content::-webkit-scrollbar-thumb:hover,         .debug-panel-subsection-content::-webkit-scrollbar-thumb:hover {             background: rgba(255, 255, 255, 0.3);         }          .debug-panel-header {             display: flex;             justify-content: space-between;             align-items: flex-start;             margin-bottom: 10px;         }          .debug-panel-title {             font-size: 1.2em;             font-weight: bold;         }          .debug-panel-info {             font-size: 0.95em;             color: #ccc;         }          .debug-panel-info-line + .debug-panel-info-line {             margin-top: 2px;         }          @media (pointer: coarse) {             .debug-panel-info-mobile-hidden {                 display: none;             }         }          @media (max-width: 600px) {             .debug-panel {                 left: 0;                 right: 0;                 top: 0;                 transform: none;                 width: auto;                 max-width: none;                 max-height: calc(90vh - 12px);                 padding: 8px;                 margin: 6px;                 border-radius: 8px;             }              .debug-panel-header {                 flex-direction: column;                 align-items: flex-start;                 gap: 6px;             }              .debug-panel-title {                 font-size: 1.05em;             }              .debug-panel-info {                 font-size: 0.85em;             }              .debug-panel-section-toggle,             .debug-panel-subsection-toggle {                 align-items: flex-start;                 gap: 6px;             }              .debug-panel-row {                 flex-direction: column;                 align-items: stretch;             }              .debug-panel-toggle,             .debug-misc-button {                 width: 100%;             }              .debug-misc-button-list {                 justify-content: flex-start;             }              .debug-panel-close-buttons {                 display: flex;                 flex-direction: column;                 align-items: stretch;                 width: 100%;             }              .debug-panel-close {                 width: 100%;                 font-size: 1em;                 padding: 10px 14px;                 border-radius: 6px;                 background: hsla(0, 80%, 40%, 0.15);                 border: 1px solid hsla(0, 80%, 40%, 0.45);                 color: #fff;                 text-align: center;             }              .debug-panel-close + .debug-panel-close {                 margin-top: 6px;             }         }          .debug-panel-close-buttons {             display: none;             gap: 8px;         }          .debug-panel-close {             background: hsla(0, 80%, 40%, 0.15);             border: 1px solid hsla(0, 80%, 40%, 0.45);             color: #fff;             font-size: 1.05em;             cursor: pointer;             border-radius: 4px;             padding: 6px 10px;             transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;         }          .debug-panel-close:hover {             background: hsla(0, 80%, 40%, 0.22);         }          .debug-panel-close:active {             transform: translateY(1px);             background: hsla(0, 80%, 40%, 0.28);         }          .debug-panel-close.debug-panel-close-collapse {             font-size: 1em;         }          .debug-panel-section {             border: 1px solid #444;             border-radius: 4px;             margin-bottom: 10px;             background: rgba(255, 255, 255, 0.05);         }          .debug-panel-section-toggle {             width: 100%;             text-align: left;             background: rgba(255, 255, 255, 0.08);             border: none;             color: #fff;             padding: 8px 10px;             font-weight: bold;             cursor: pointer;             display: flex;             align-items: center;             gap: 8px;         }          .debug-panel-section-toggle::before {             content: '\u25B6';             font-size: 1em;             width: 1em;             display: inline-flex;             align-items: center;             justify-content: center;         }          .debug-panel-section-toggle.expanded::before {             content: '\u25BC';         }          .debug-panel-section-content {             padding: 8px 10px;             border-top: 1px solid #444;             display: none;         }          .debug-panel-section-content.active {             display: block;         }          .debug-panel-empty {             color: #aaa;             font-style: italic;         }          .action-log-entry {             display: flex;             gap: 6px;             padding: 4px 0;             border-bottom: 1px solid rgba(255, 255, 255, 0.08);         }          .action-log-entry:last-child {             border-bottom: none;         }          .action-log-time {             color: #7bc0ff;             font-weight: bold;             min-width: 60px;         }          .action-log-message {             flex: 1;         }          .action-log-empty {             color: #aaa;             font-style: italic;             padding: 6px 0;         }          .action-log-number {             color: #ffd54f;             font-weight: bold;         }          .action-log-number::after {             content: attr(data-unit);             color: #ffa726;             font-weight: normal;             margin-left: 0;         }          .action-log-number[data-unit]:not([data-unit=""])::after {             margin-left: 2px;         }          .action-log-level {             color: #ffd700;             font-weight: bold;             text-shadow: 0 0 2px rgba(0,0,0,0.5);             border-radius: 3px;             padding: 0 2px;         }          .action-log-level span {             color: #ffd700;         }          .action-log-gold {             color: #ffd700;             font-weight: bold;             text-shadow: 0 0 2px rgba(0,0,0,0.5);             border-radius: 3px;             padding: 0;         }          .debug-panel-subsection {             margin: 8px 0 12px;             border: 1px solid #333;             border-radius: 4px;             background: rgba(255, 255, 255, 0.03);         }          .debug-panel-subsection-toggle {             width: 100%;             text-align: left;             background: rgba(255, 255, 255, 0.06);             border: none;             color: #fff;             padding: 6px 8px;             font-weight: bold;             cursor: pointer;             display: flex;             align-items: center;             gap: 8px;             font-size: 0.95em;         }          .debug-panel-subsection-toggle::before {             content: '\u25B6';             font-size: 1em;             width: 1em;             display: inline-flex;             align-items: center;             justify-content: center;         }          .debug-panel-subsection-toggle.expanded::before {             content: '\u25BC';         }          .debug-panel-subsection-content {             display: none;             padding: 8px 10px;             border-top: 1px solid #333;         }          .debug-panel-subsection-content.active {             display: block;         }          .debug-panel-row {             display: flex;             align-items: center;             justify-content: space-between;             gap: 12px;             padding: 4px 0;         }          .debug-panel-toggle {             background: rgba(255, 255, 255, 0.08);             border: 1px solid #555;             color: #fff;             padding: 8px 12px;             border-radius: 6px;             cursor: pointer;             transition: background 0.12s ease, transform 0.12s ease;         }          .debug-panel-toggle:hover {             background: rgba(255, 255, 255, 0.12);             transform: translateY(-1px);         }          .debug-panel-toggle.debug-danger-button {             border-color: hsla(0, 80%, 40%, 0.45);             background: hsla(0, 80%, 40%, 0.15);             color: #fff;             font-weight: 700;             letter-spacing: 0.2px;         }          .debug-panel-toggle.debug-danger-button:hover {             background: hsla(0, 80%, 40%, 0.22);         }          .debug-panel-toggle.debug-danger-button:active {             background: hsla(0, 80%, 40%, 0.28);             transform: translateY(1px);         }          .debug-misc-button-list {             display: flex;             flex-wrap: wrap;             gap: 10px;             justify-content: center;         }          .debug-misc-button {             flex: 0 1 170px;             min-width: 150px;             max-width: 190px;             padding: 6px 10px;             text-align: center;             font-weight: 600;             font-size: 0.95em;         }          .debug-misc-button:hover {             background: rgba(255, 255, 255, 0.14);         }          .debug-unlock-row {             align-items: flex-start;             justify-content: flex-start;         } 		 		.debug-unlock-row, 		.debug-unlock-row * { 			user-select: none; 		}          .debug-unlock-row .flag-toggle {             flex: 0 0 auto;         }          .debug-unlock-text {             flex: 1;             display: flex;             flex-wrap: wrap;             gap: 6px;             align-items: center;         }          .debug-unlock-title {             font-weight: 600;         }          .debug-unlock-desc {             color: #aaa;             font-size: 0.9em;         }          .debug-calculator-inputs {             display: flex;             flex: 0 0 245px;             gap: 8px;             flex-wrap: wrap;         }          .debug-calculator-output {             min-width: 120px;             text-align: right;             font-family: Consolas, 'Courier New', monospace;         }          .debug-panel .infinity-symbol {             font-size: 1.5em;             line-height: 1.05;         }          .debug-panel-row label {             flex: 1;             font-size: 0.95em;         }          .debug-panel-input {             flex: 0 0 245px;             max-width: 100%;             background: #111;             color: #fff;             border: 1px solid #555;             padding: 6px 8px;             border-radius: 4px;             font-family: Consolas, 'Courier New', monospace;         }          .debug-lock-button {             flex: 0 0 50px;             max-width: 60px;             padding: 6px 8px;             border-radius: 4px;             border: 1px solid #555;             background: #111;             color: #fff;             font-weight: bold;             cursor: pointer;         }          .debug-lock-button.locked {             background: #440000;             border-color: #aa0000;             color: #ff6666;         }          .debug-panel-input.debug-invalid {             border-color: #e66;             box-shadow: 0 0 0 1px #e66;         }          .debug-panel-id {             font-size: 0.8em;             color: #aaa;             margin-left: 6px;             position: relative;             top: -2px;         }          .debug-panel-toggle-button {             position: fixed;             top: 10px;             left: 10px;             z-index: 2147483647;             background: rgba(0, 0, 0, 0.85);             color: #fff;             border: 1px solid #666;             border-radius: 4px;             padding: 8px 12px;             cursor: pointer;             font-size: 0.9em;             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);         }          .debug-panel-toggle-button:hover {             background: rgba(0, 0, 0, 0.95);         }          .flag-toggle {             position: relative;             display: inline-block;             width: 50px;             height: 24px;         }          .flag-toggle input {             opacity: 0;             width: 0;             height: 0;         }          .flag-slider {             position: absolute;             cursor: pointer;             top: 0;             left: 0;             right: 0;             bottom: 0;             background-color: #555;             transition: .2s;             border-radius: 12px;         }          .flag-slider:before {             position: absolute;             content: "";             height: 18px;             width: 18px;             left: 3px;             bottom: 3px;             background-color: white;             transition: .2s;             border-radius: 50%;         }          .flag-toggle input:checked + .flag-slider {             background-color: #2196F3;         }          .flag-toggle input:checked + .flag-slider:before {             transform: translateX(26px);         } 		 		.debug-unlock-row:hover { 			cursor: pointer; 		}     `,document.head.appendChild(e))}function js(){let e=document.getElementById(nu);e&&e.remove()}function jh(){return qn&&ce&&y()!=null&&!Nl()&&qh()}function Gh(e){e?.detail?.visible&&Kt(),ma()}function aa(e,t,n){let r=document.createElement("div");r.className="debug-panel-section";let i=document.createElement("button");i.className="debug-panel-section-toggle",i.type="button",i.textContent=e;let l=t||`${e}-${iu++}`;i.dataset.sectionKey=l,r.appendChild(i);let o=document.createElement("div");return o.className="debug-panel-section-content",o.id=t,o.dataset.sectionKey=l,n(o),r.appendChild(o),i.addEventListener("click",()=>{let a=i.classList.toggle("expanded");o.classList.toggle("active",a)}),r}function vn(e,t,{defaultExpanded:n=!1}={}){let r=document.createElement("div");r.className="debug-panel-subsection";let i=document.createElement("button");i.type="button",i.className="debug-panel-subsection-toggle",i.textContent=e;let l=`${e}-${lu++}`;i.dataset.subsectionKey=l,r.appendChild(i);let o=document.createElement("div");return o.className="debug-panel-subsection-content",o.dataset.subsectionKey=l,t(o),r.appendChild(o),i.addEventListener("click",()=>{let a=i.classList.toggle("expanded");o.classList.toggle("active",a)}),n&&(i.classList.add("expanded"),o.classList.add("active")),r}function De(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function ca(e){try{let t=e?.toScientific?.(18),n=Number.parseFloat(t??e);return Number.isFinite(n)?n:Number.NaN}catch{return Number.NaN}}function dp(e,t=y()){let n=t??y();return n==null?null:`${_e.CURRENCY[e]}:${n}`}function sa(e,t=y()){let n=t??y();if(n==null)return c.fromInt(0);let r=P?.[e];if(r)try{return r.value??c.fromInt(0)}catch{}try{return Qa(n,e)}catch{return c.fromInt(0)}}function Zh(e,t,n=y()){let r=n??y(),i=sa(e,r);if(r==null||r!==y())return{previous:i,next:i};let l=dp(e,r),o=l&&Bn(l);o&&fa(l);let a=i;try{xr(r),a=$i(e,t,{previous:i})??i,l&&xe(l)}catch{}finally{o&&da(l)}return Ge(s=>s.type==="currency"&&s.key===e&&s.slot===r),{previous:i,next:a}}function _t(e,t){return`${e??"null"}::${t}`}function Gs(e,t){return oi.get(_t(e,t))??null}function zh(e,t=y()){let n=_t(t,e);oi.delete(n),ai.delete(n),Ge(r=>r.type==="currency-mult"&&r.key===e&&r.slot===t)}function Zs(e,t){let n=!ua(t,e),r=_t(e,t),i=ci.get(r);if(!n&&i)return i;let l=Kh(t,e);return l?(ci.set(r,l),l):(n&&ci.delete(r),null)}function fp(e,t){Ge(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function pp(e,t=y()){let n=Cl(e,t);if(ci.delete(_t(t,e)),bn.delete(_t(t,e)),!(!n||typeof localStorage>"u")&&!Bn(n)){try{localStorage.removeItem(n)}catch{}fp(e,t)}}function ua(e,t=y()){return Bn(Cl(e,t))}function Wh(e,t){return ua(t,e)?Zs(e,t):null}function $n(e,t=y()){let n=Al(e);return Ks(e,t,n)??n}function Cl(e,t=y()){if(!e)return null;let n=t??y();return n==null?null:`${Np}:${e}:${n}`}function Al(e){try{if(e==="xp"){let{xpGainMultiplier:t}=ff(ee.STARTER_COVE)??{};if(t)return t}else if(e==="mutation"){let t=Qc?.();if(t)return t;let n=hu();if(n)return n}}catch{}return c.fromInt(1)}function Kh(e,t=y()){let n=Cl(e,t);if(!n||typeof localStorage>"u")return null;let r=localStorage.getItem(n);if(!r)return null;try{return c.fromAny(r)}catch{return null}}function Qh(e,t,n){let r=Cl(e,t);if(!(!r||typeof localStorage>"u"))try{let i=n instanceof c?n:c.fromAny(n??1),l=Bn(r),o=l&&dr?dr:localStorage.setItem.bind(localStorage);l&&!dr&&fa(r),o(r,i.toStorage?.()??String(i)),l&&!dr&&da(r)}catch{}}function zs(e,t=y()){if(t==null)return;let n=Gs(t,e);if(!n||t!==y())return;let r=_t(t,e);if(!Fl.has(r)){Fl.add(r);try{let i=P?.[e]?.mult?.get?.();De(i,n)||P?.[e]?.mult?.set?.(n)}catch{}finally{Fl.delete(r)}}}function mp(){if(!(cu||typeof window>"u")){cu=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:r}=e?.detail??{},i=n??y(),l=_t(i,t);if(!i||!oi.has(l)||Fl.has(l))return;let o=ai.get(l),a=Gs(i,t);if(o&&a&&r){let s=ca(o),u=ca(r);if(Number.isFinite(s)&&Number.isFinite(u)&&s!==0){let d=u/s;if(d&&d!==1)try{let f=a.mulDecimal?.(d)??a;oi.set(l,f)}catch{}}ai.set(l,r)}else r&&ai.set(l,r);zs(t,i)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Ml()},{passive:!0})}catch{}}}function Ml(){let e=y();e!=null&&Object.values(be).forEach(t=>{zs(t,e)})}function gp(e,t,n=y()){if(!e||n==null)return null;mp();let r;try{r=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{r=c.fromInt(1)}let i=_t(n,e);oi.set(i,r);let l=P?.[e]?.mult?.get?.();return ai.set(i,l),zs(e,n),r}function _l(e,t=y()){return!e||t==null?null:Gs(t,e)}function vt(e,t,n=y()){if(!e||n==null)return null;let r;try{r=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{r=c.fromInt(1)}return ci.set(_t(n,e),r),bn.set(_t(n,e),Al(e)),Qh(e,n,r),fp(e,n),r}function Jh(e,t=y()){return!e||t==null?null:Zs(t,e)}function Ws(e,t,n=y()){let r=Al(e),i=Ks(e,n,r);if(!i)return t;let l;try{l=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(De(l,r))return i}catch{}try{if(l.isZero?.())return l}catch{return l}let o=_t(n,e),a=bn.get(o),s=ua(e,n)&&a?a:r,u=ca(i),d=ca(s),f=Number.isFinite(u)&&Number.isFinite(d)&&d!==0?u/d:Number.NaN;if(Number.isFinite(f)&&f!==1)try{return l.mulDecimal?.(f)??l}catch{}return l}function Ks(e,t,n){let r=Zs(t,e),i=_t(t,e);if(!r)return bn.delete(i),null;let l=bn.get(i),o=ua(e,t);if(!l)bn.set(i,n);else if(!De(l,n))return bn.set(i,n),o?r:(bn.set(i,n),pp(e,t),null);return r}function ey(){if(!(ou||typeof localStorage>"u")){ou=!0;try{dr=localStorage.setItem.bind(localStorage),au=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ur.has(e))return dr(e,t)},localStorage.removeItem=e=>{if(!ur.has(e))return au(e)}}catch{}}}function Bn(e){return e!=null&&ur.has(e)}function da(e){e&&(ey(),ur.add(e))}function fa(e){e&&ur.delete(e)}function ty(e){return e?Bn(e)?(fa(e),!1):(da(e),!0):!1}function ny(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let r=()=>{let i=Bn(e);n.textContent=i?"L":"UL",n.classList.toggle("locked",i)};return n.addEventListener("click",()=>{if(ty(e),typeof t=="function")try{t(Bn(e))}catch{}r()}),r(),{button:n,refresh:r}}function ry(){let e=document.getElementById(li);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function iy(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,r=`${c.DEFAULT_PRECISION}`,i="0",l="0"]=(n||"").split(":"),o=Number.parseInt(r,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${o}:${"0".repeat(o)}:-17`;let a=i.padStart(o,"0");return`BN:${o}:${a}:${l}`}catch{return String(e??"")}}function hp(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Qs(e,t){e.classList.toggle("debug-invalid",!t)}function Be(){let e=y();try{xr(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function yp(e=y()){return e==null?null:`${Cp}:${e}`}function vp(e=y()){let t=yp(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let r=JSON.parse(n);return Array.isArray(r)?r:[]}catch{return[]}}function bp(e,t=y()){let n=yp(t);if(!n||typeof localStorage>"u")return;let r=(Array.isArray(e)?e:[]).slice(0,ya);try{localStorage.setItem(n,JSON.stringify(r))}catch{}}function ly(e,t=y()){let n=vp(t);return n.unshift(e),n.length>ya&&(n.length=ya),bp(n,t),n}function Re(e){let t=y();if(t==null)return;let n=new Date,r={time:n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),message:e,timestamp:n.getTime()};ly(r,t),Js()}function Js(){if(!sr)return;let e=vp();if(e.length===0){sr.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",sr.appendChild(t);return}sr.innerHTML=e.map(t=>{let n=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return n=n.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),n=n.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),n=n.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*><\/span>/g,'<span class="action-log-number">inf</span>'),n=n.replace(//g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${t.time}:</span><span class="action-log-message">${n}</span></div>`}).join("")}function Ip(e=y()){return e==null?null:`${vl}:${e}`}function wp(e,t=y()){let n=Ip(t);if(n)try{let r=JSON.stringify(e||{});localStorage.setItem(n,r)}catch{}}function Ep(e=y()){let t=Ip(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function oy(e){if(e){if(e.type==="coins"){try{P.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{P.books.addWithMultiplier?.(e.amount)??P.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function ay(){let e=y();if(e==null)return{completed:0};let t=Ep(e),n=0;return Object.entries(ea).forEach(([r,i])=>{let l=String(r),o=t[l]||{},a=!!o.claimed,s=Object.assign({},o,{status:"unlocked",claimed:!0});t[l]=s,a||(n+=1,oy(i.reward))}),wp(t,e),{completed:n}}function cy(){let e=y();if(e==null)return{restored:0};let t=Ep(e),n=0;return Object.entries(ea).forEach(([r])=>{let i=String(r),l=t[i]||{};l.claimed&&(n+=1),t[i]=Object.assign({},l,{claimed:!1})}),wp(t,e),{restored:n}}function Rn(e,t,n,{idLabel:r,storageKey:i,onLockChange:l}={}){let o=document.createElement("div");o.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,r!=null){a.append(" ");let v=document.createElement("span");v.className="debug-panel-id",v.textContent=`(ID: ${r})`,a.appendChild(v)}o.appendChild(a);let s=document.createElement("input");s.type="text",s.className="debug-panel-input";let u=!1,d=null,f=!1,p=i?ny(i,{onToggle:l}):null,h=v=>{if(u){d=v;return}d=null,s.value=iy(v)};o.appendChild(s),p&&o.appendChild(p.button);let g=()=>{let v=hp(s.value);if(!v){Qs(s,!1);return}Qs(s,!0);let m=i&&Bn(i);m&&fa(i);try{n(v,{input:s,setValue:h})}finally{m&&da(i),p&&p.refresh()}};return s.addEventListener("focus",()=>{u=!0}),s.addEventListener("change",g),s.addEventListener("keydown",v=>{v.key==="Enter"&&(v.preventDefault(),f=!0,g(),s.blur())}),s.addEventListener("blur",()=>{if(u=!1,f||g(),f=!1,d!=null){let v=d;d=null,h(v)}}),h(t),p&&p.refresh(),{row:o,input:s,setValue:h,isEditing:()=>u}}function sy({labelText:e,description:t,isUnlocked:n,onEnable:r,onDisable:i,slot:l}){let o=document.createElement("div");o.className="debug-panel-row debug-unlock-row";let a=document.createElement("label");a.className="flag-toggle",a.setAttribute("aria-label",e);let s=document.createElement("input");s.type="checkbox";let u=document.createElement("span");u.className="flag-slider",a.appendChild(s),a.appendChild(u);let d=document.createElement("div");d.className="debug-unlock-text";let f=document.createElement("span");if(f.className="debug-unlock-title",f.textContent=e,d.appendChild(f),t){let v=document.createElement("span");v.className="debug-unlock-desc",v.textContent=`- ${t}`,d.appendChild(v)}o.appendChild(a),o.appendChild(d);let p=()=>{s.checked=!s.checked,s.dispatchEvent(new Event("change",{bubbles:!0}))};o.addEventListener("click",v=>{a.contains(v.target)||p()});let h=!1,g=()=>{let v=!1;try{v=typeof n=="function"?!!n():!1}catch{}return s.checked=v,h=v,v};return s.addEventListener("change",()=>{let v=h,m=s.checked;try{m?r?.():i?.()}catch{}Be();let b=g();v!==b&&Re(`Toggled ${e} [GOLD]${v?"True":"False"}[/GOLD] \u2192 [GOLD]${b?"True":"False"}[/GOLD]`)}),g(),$t({type:"unlock",slot:l,refresh:g}),o}function uy(e){try{if(e instanceof c||typeof e?.toScientific=="function")return K(e);let t=Number(e);return Number.isFinite(t)?K(t):String(e??"\u2014")}catch{return"\u2014"}}function dy({labelText:e,inputs:t=[],compute:n}){let r=document.createElement("div");r.className="debug-panel-row debug-calculator-row";let i=document.createElement("label");i.textContent=e,r.appendChild(i);let l=document.createElement("div");l.className="debug-calculator-inputs",r.appendChild(l);let o=document.createElement("div");o.className="debug-calculator-output",o.textContent="\u2014",r.appendChild(o);let a=[],s=()=>{let u={},d=!1;if(a.forEach(({config:f,el:p})=>{if(f.type==="select"){u[f.key]=p.value;return}let h=hp(p.value),g=h instanceof c;if(Qs(p,g),!g){d=!0;return}u[f.key]=h}),d||typeof n!="function"){o.textContent="\u2014";return}try{let f=n(u);o.innerHTML=uy(f)}catch{o.textContent="\u2014"}};return t.forEach(u=>{let d=Object.assign({type:"text",defaultValue:""},u);if(d.key)if(d.type==="select"){let f=document.createElement("select");f.className="debug-panel-input",(d.options||[]).forEach(({value:p,label:h})=>{let g=document.createElement("option");g.value=p,g.textContent=h??p,d.defaultValue!=null&&d.defaultValue===p&&(g.selected=!0),f.appendChild(g)}),f.addEventListener("change",s),l.appendChild(f),a.push({config:d,el:f})}else{let f=document.createElement("input");f.type="text",f.className="debug-panel-input",f.placeholder=d.label||"",f.value=d.defaultValue??"",f.addEventListener("input",s),f.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),s())}),l.appendChild(f),a.push({config:d,el:f})}}),s(),r}function Un({level:e,progress:t}){let n=y();if(n==null)return;try{Vi()}catch{}let r=si.unlock(n);try{localStorage.setItem(r,"1")}catch{}if(xe(r,"1"),e!=null)try{let i=e.toStorage?.()??c.fromAny(e).toStorage(),l=si.level(n);localStorage.setItem(l,i),xe(l,i)}catch{}if(t!=null)try{let i=t.toStorage?.()??c.fromAny(t).toStorage(),l=si.progress(n);localStorage.setItem(l,i),xe(l,i)}catch{}try{Di({forceReload:!0})}catch{}try{Id({changeType:"debug-panel",slot:n})}catch{}try{Ge()}catch{}}function Dn({level:e,progress:t}){let n=y();if(n==null)return;try{let i=typeof Cn=="function"?Cn():!1,l=typeof vo=="function"?vo():null;!i&&l!==!0&&Xi?.(!0)}catch{}try{typeof er=="function"&&!er()&&Hi?.(!0)}catch{}try{Ea(!0)}catch{}try{Fe?.()}catch{}try{Bt()}catch{}try{pi()}catch{}let r=ui.unlock(n);try{localStorage.setItem(r,"1")}catch{}if(xe(r,"1"),e!=null)try{let i=e.toStorage?.()??c.fromAny(e).toStorage(),l=ui.level(n);localStorage.setItem(l,i),xe(l,i)}catch{}if(t!=null)try{let i=t.toStorage?.()??c.fromAny(t).toStorage(),l=ui.progress(n);localStorage.setItem(l,i),xe(l,i)}catch{}try{Bt({forceReload:!0})}catch{}try{_p({changeType:"debug-panel",slot:n})}catch{}try{Ge()}catch{}}function fy(e,t){let n=y();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit currency values.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";t.currencies.forEach(i=>{let l=dp(i.key,n),o=sa(i.key,n),a=Rn(i.label,o,(s,{setValue:u})=>{let d=y();if(d==null||d!==n)return;let{previous:f,next:p}=Zh(i.key,s,d);u(p),De(f,p)||(Be(),Re(`Modified ${i.label} (${r}) ${K(f)} \u2192 ${K(p)}`))},{storageKey:l,onLockChange:()=>a.setValue(sa(i.key,y()))});$t({type:"currency",key:i.key,slot:n,refresh:()=>{if(n!==y())return;let s=sa(i.key,n);a.setValue(s)}}),e.appendChild(a.row)})}function py(e,t){let n=y();if(n==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Select a save slot to edit stats.",e.appendChild(g);return}let r=Ce(),i=Oe(),l=t?.title??t?.key??"Unknown Area",o=si.level(n),a=Rn("XP Level",r.xpLevel,(g,{setValue:v})=>{let m=Ce().xpLevel;Un({level:g});let b=Ce();v(b.xpLevel),De(m,b.xpLevel)||(Be(),Re(`Modified XP Level (${l}) ${K(m)} \u2192 ${K(b.xpLevel)}`))},{storageKey:o});$t({type:"xp",slot:n,refresh:()=>{n===y()&&a.setValue(Ce().xpLevel)}}),e.appendChild(a.row);let s=si.progress(n),u=Rn("XP Progress",r.progress,(g,{setValue:v})=>{let m=Ce(),b=m?.xpLevel?.clone?.()??m?.xpLevel,w=m?.progress?.clone?.()??m?.progress;Un({progress:g});let L=Ce();v(L.progress),a.setValue(L.xpLevel),(!De(w,L.progress)||!De(b,L.xpLevel))&&(Be(),Re(`Modified XP Progress (${l}) ${K(w)} \u2192 ${K(L.progress)}`))},{storageKey:s});$t({type:"xp",slot:n,refresh:()=>{n===y()&&u.setValue(Ce().progress)}}),e.appendChild(u.row);let d=ui.level(n),f=Rn("MP Level",i.level,(g,{setValue:v})=>{let m=Oe().level;Dn({level:g});let b=Oe();v(b.level),De(m,b.level)||(Be(),Re(`Modified MP Level (${l}) ${K(m)} \u2192 ${K(b.level)}`))},{storageKey:d});$t({type:"mutation",slot:n,refresh:()=>{n===y()&&f.setValue(Oe().level)}}),e.appendChild(f.row);let p=ui.progress(n),h=Rn("MP Progress",i.progress,(g,{setValue:v})=>{let m=Oe(),b=m?.level?.clone?.()??m?.level,w=m?.progress?.clone?.()??m?.progress;Dn({progress:g});let L=Oe();v(L.progress),f.setValue(L.level),(!De(w,L.progress)||!De(b,L.level))&&(Be(),Re(`Modified MP Progress (${l}) ${K(w)} \u2192 ${K(L.progress)}`))},{storageKey:p});$t({type:"mutation",slot:n,refresh:()=>{n===y()&&h.setValue(Oe().progress)}}),e.appendChild(h.row)}function my(e,t){let n=y();if(n==null){let l=document.createElement("div");l.className="debug-panel-empty",l.textContent="Select a save slot to edit upgrades.",e.appendChild(l);return}let r=rr(t.key);if(!r||r.length===0){let l=document.createElement("div");l.className="debug-panel-empty",l.textContent="No upgrades found for this area yet.",e.appendChild(l);return}let i=t?.title??t?.key??"Unknown Area";r.forEach(l=>{let o=l.id??l.tie??l.tieKey,a=l.title||`Upgrade ${o??""}`.trim(),s=gt(t.key,l.id??l.tie),u=Rn(a,s,(d,{setValue:f})=>{if(y()==null)return;let p=gt(t.key,l.id??l.tie);try{es(t.key,l.id??l.tie,d,!1)}catch{}let h=gt(t.key,l.id??l.tie);f(h),De(p,h)||(Be(),Re(`Modified ${a} (${i} - ID: ${o??"Unknown"}) Lv${K(p)} \u2192 Lv${K(h)}`))},{idLabel:o});$t({type:"upgrade",slot:n,refresh:()=>{if(n!==y())return;let d=gt(t.key,l.id??l.tie);u.setValue(d)}}),e.appendChild(u.row)})}function gy(e,t){let n=y();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit currency multipliers.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";t.currencies.forEach(i=>{let l=P?.[i.key]?.mult,o=_l(i.key,n)??l?.get?.()??c.fromInt(1),a=`${_e.MULTIPLIER[i.key]}:${n}`,s=Rn(`${i.label} Multiplier`,o,(u,{setValue:d})=>{let f=y();if(f==null)return;let p=_l(i.key,f)??l?.get?.()??c.fromInt(1);try{gp(i.key,u,f)}catch{}Ml();let h=_l(i.key,f)??l?.get?.()??c.fromInt(1);d(h),De(p,h)||(Be(),Re(`Modified ${i.label} Multiplier (${r}) ${K(p)} \u2192 ${K(h)}`))},{storageKey:a});$t({type:"currency-mult",key:i.key,slot:n,refresh:()=>{if(n!==y())return;let u=_l(i.key,n)??l?.get?.()??c.fromInt(1);s.setValue(u)}}),e.appendChild(s.row)})}function hy(){if(y()==null)return 0;let e=c.fromAny("Infinity"),t=0;return Object.values(be).forEach(n=>{let r=P?.[n];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||De(i,e))return;r.set(e),t+=1}catch{}}),t}function yy(){if(y()==null)return 0;let e=c.fromInt(0),t=0;return Object.values(be).forEach(n=>{let r=P?.[n];if(r)try{r.set?.(e),t+=1}catch{}}),t}function vy(){let e=y();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,r,i;try{r=Ce()}catch{}try{i=Oe()}catch{}try{if(r?.unlocked){let o=r?.xpLevel?.isInfinite?.()||De(r?.xpLevel,t),a=r?.progress?.isInfinite?.()||De(r?.progress,t);(!o||!a)&&(Un({level:t,progress:t}),n+=1)}}catch{}try{if(i?.unlocked){let o=i?.level?.isInfinite?.()||De(i?.level,t),a=i?.progress?.isInfinite?.()||De(i?.progress,t);(!o||!a)&&(Dn({level:t,progress:t}),n+=1)}}catch{}let l=o=>o==="xp"?!!r?.unlocked:o==="mutation"?!!i?.unlocked:!0;return di.forEach(({key:o})=>{try{if(!l(o))return;let a=$n(o,e);if(a?.isInfinite?.()||De(a,t))return;vt(o,t,e),n+=1}catch{}}),n}function by(){let e=y();if(e==null)return 0;let t=c.fromInt(0),n=0,r,i;try{r=Ce()}catch{}try{i=Oe()}catch{}try{r?.unlocked&&(Un({level:t,progress:t}),n+=1)}catch{}try{i?.unlocked&&(Dn({level:t,progress:t}),n+=1)}catch{}let l=o=>o==="xp"?!!r?.unlocked:o==="mutation"?!!i?.unlocked:!0;return di.forEach(({key:o})=>{try{if(!l(o))return;vt(o,t,e),n+=1}catch{}}),n}function Sp(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Ce()?.unlocked}catch{return!1}},onEnable:()=>{try{Vi()}catch{}try{Di({forceReload:!0})}catch{}},onDisable:()=>{try{so({keepUnlock:!1})}catch{}try{Xi(!1)}catch{}try{Fe()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{let t=vo();if(t!=null)return t}catch{}try{return!!Cn()}catch{return!1}return!1},onEnable:()=>{try{Xi(!0)}catch{}try{Fe()}catch{}},onDisable:()=>{try{Xi(!1)}catch{}try{Fe()}catch{}}},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return er()}catch{return!1}},onEnable:()=>{try{Hi(!0)}catch{}try{Ea(!0)}catch{}try{Fe()}catch{}},onDisable:()=>{try{Hi(!1)}catch{}try{Ea(!1)}catch{}try{Fe()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return op()}catch{return!1}},onEnable:()=>{try{kl()}catch{}},onDisable:()=>{try{Vs()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return ap()}catch{return!1}},onEnable:()=>{try{Ds()}catch{}},onDisable:()=>{try{qs()}catch{}},slot:e}]}function xp(e){let t=y();if(t==null)return 0;let n=0;Sp(t).forEach(r=>{let i=!1;try{i=typeof r.isUnlocked=="function"?!!r.isUnlocked():!1}catch{}if(i!==e)try{e?r.onEnable?.():r.onDisable?.(),n+=1}catch{}});try{Ge()}catch{}return n}function Iy(){let e=y();if(e==null)return{unlocks:0,toggles:0};let t=0;oa().forEach(r=>{rr(r.key).forEach(i=>{if(i?.unlockUpgrade)try{Qi(r.key,i,e),t+=1}catch{}})});try{kl()}catch{}try{Ds()}catch{}let n=xp(!0);return{unlocks:t,toggles:n}}function wy(){let e=y();if(e==null)return{locks:0,toggles:0};let t=0;oa().forEach(r=>{rr(r.key).forEach(i=>{if(i?.unlockUpgrade)try{Yd(r.key,i,e),t+=1}catch{}})});try{Vs()}catch{}try{qs()}catch{}let n=xp(!1);return{locks:t,toggles:n}}function pa(e){try{P?.[e]?.set?.(c.fromInt(0))}catch{}try{zh(e)}catch{}try{Ka(e,c.fromInt(1))}catch{}}function Ey(e){if(e==="all"){Object.values(be).forEach(i=>pa(i));let r=c.fromInt(0);return Un({level:r,progress:r}),Dn({level:r,progress:r}),di.forEach(({key:i})=>{try{vt(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(be).length+di.length+2}}if(e==="allCurrencies"){let r=0;return Object.values(be).forEach(i=>{pa(i),r+=1}),{label:r===1?"1 currency":`${r} currencies`,count:r}}if(e==="allUnlockedStats"){let r=c.fromInt(0),i=0;try{if(Ce()?.unlocked){Un({level:r,progress:r});try{vt("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(Oe()?.unlocked){Dn({level:r,progress:r});try{vt("mutation",c.fromInt(1))}catch{}i+=1}}catch{}return{label:i===1?"1 unlocked stat":`${i} unlocked stats`,count:i}}if(e==="allUnlocked"){let r=0;Object.values(be).forEach(a=>{pa(a),r+=1});let i=c.fromInt(0),l=0;try{if(Ce()?.unlocked){Un({level:i,progress:i});try{vt("xp",c.fromInt(1))}catch{}l+=1}}catch{}try{if(Oe()?.unlocked){Dn({level:i,progress:i});try{vt("mutation",c.fromInt(1))}catch{}l+=1}}catch{}let o=[];return l===1?o.push("1 unlocked stat"):o.push(`${l} unlocked stats`),o.push(r===1?"1 currency":`${r} currencies`),{label:o.join(" and "),count:l+r}}if(e.startsWith("currency:")){let r=e.slice(9);return pa(r),{label:`${r}`,count:1}}if(e.startsWith("statmult:")){let r=e.slice(9);try{pp(r)}catch{}return{label:`${r} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Un({level:n,progress:n});try{vt("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Dn({level:n,progress:n});try{vt("mutation",c.fromInt(1))}catch{}return"MP"}try{vt(t,c.fromInt(1))}catch{}return`stat ${t}`}function Sy(e,t){let n=y();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit stat multipliers.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";di.forEach(i=>{let l=Cl(i.key,n),o=Rn(`${i.label} Multiplier`,$n(i.key,n),(a,{setValue:s})=>{let u=y();if(u==null)return;let d=$n(i.key,u);try{vt(i.key,a,u)}catch{}let f=$n(i.key,u);s(f),De(d,f)||(Be(),Re(`Modified ${i.label} Multiplier (${r}) ${K(d)} \u2192 ${K(f)}`))},{storageKey:l,onLockChange:a=>{let s=y();if(s!=null){if(a){if(Wh(s,i.key))return;try{vt(i.key,Al(i.key),s)}catch{}}else Ks(i.key,s,Al(i.key));o.setValue($n(i.key,s))}}});$t({type:"stat-mult",key:i.key,slot:n,refresh:()=>{if(n!==y())return;let a=$n(i.key,n);o.setValue(a)}}),$t({type:"upgrade",key:i.key,slot:n,refresh:()=>{if(n!==y())return;let a=$n(i.key,n);o.setValue(a)}}),i.key==="mutation"&&$t({type:"mutation",key:i.key,slot:n,refresh:()=>{if(n!==y())return;let a=$n(i.key,n);o.setValue(a)}}),e.appendChild(o.row)})}function xy(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:t,xpLevel:n})=>Md(t,n)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:t})=>fc(t)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:t})=>wd(t)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:t})=>Tp(t)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:t})=>Sa(t)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:t,level:n,mode:r})=>Zd(t,n,r)}]}].forEach(t=>{let n=vn(t.title,r=>{if(!t.rows||t.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}t.rows.forEach(i=>{let l=dy({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(l)})});e.appendChild(n)})}function Ly(e){if(e.innerHTML="",y()==null){let t=document.createElement("div");t.className="debug-panel-empty",t.textContent="Areas are available once a save slot is selected.",e.appendChild(t);return}Ml(),oa().forEach(t=>{let n=vn(t.title,r=>{let i=vn("Currencies",u=>{fy(u,t)}),l=vn("Stats",u=>{py(u,t)}),o=vn("Multipliers",u=>{let d=vn("Currencies",p=>{gy(p,t)}),f=vn("Stats",p=>{Sy(p,t)});u.appendChild(d),u.appendChild(f)}),a=vn("Upgrades",u=>{my(u,t)}),s=vn("Calculators",u=>{xy(u)});r.appendChild(i),r.appendChild(l),r.appendChild(o),r.appendChild(a),r.appendChild(s)});n.classList.add("debug-panel-area"),e.appendChild(n)})}function ky(e){e.innerHTML="";let t=y();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=ay();Be(),Re(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=cy();Be(),Re(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=hy();Be(),Re(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=vy();Be(),Re(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=yy();Be(),Re(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=by();Be(),Re(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:v}=Iy();Be(),Re(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:v}=wy();Be(),Re(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{bp([],t),Js(),Be(),Re("Action log wiped and reset.")}}],r=document.createElement("div");r.className="debug-misc-button-list",n.forEach(g=>{let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle debug-misc-button",v.textContent=g.label,v.addEventListener("click",g.onClick),r.appendChild(v)}),e.appendChild(r);let i=document.createElement("div");i.className="debug-panel-row";let l=document.createElement("label");l.textContent="Reset Values & Multis For",i.appendChild(l);let o=document.createElement("select");o.className="debug-panel-input",oa().forEach(g=>{let v=document.createElement("optgroup");v.label=g.title||g.key,g.currencies.forEach(m=>{let b=document.createElement("option");b.value=`currency:${m.key}`,b.textContent=`${g.title||g.key} \u2192 ${m.label}`,v.appendChild(b)}),g.stats.forEach(m=>{let b=document.createElement("option");b.value=`stat:${m.key}`,b.textContent=`${g.title||g.key} \u2192 ${m.label}`,v.appendChild(b)}),o.appendChild(v)});let a=document.createElement("option");a.value="allCurrencies",a.textContent="All Currencies",o.appendChild(a);let s=document.createElement("option");s.value="allUnlockedStats",s.textContent="All Unlocked Stats",o.appendChild(s);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",o.appendChild(u);let d=document.createElement("option");d.value="all",d.textContent="All",o.appendChild(d),i.appendChild(o);let f=document.createElement("button");f.type="button",f.className="debug-panel-toggle",f.textContent="Reset",f.addEventListener("click",()=>{let g=o.value||"all",{label:v,count:m}=Ey(g)??{label:g,count:0},b=m===1?"value and multiplier":"values and multipliers";Be(),Re(`Reset ${b} for ${v} to defaults.`)}),i.appendChild(f),e.appendChild(i);let p=document.createElement("div");p.className="debug-panel-row";let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle debug-danger-button",h.textContent="Wipe Slot & Refresh",h.addEventListener("click",()=>{if(!window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone."))return;let g=`:${t}`,v=[];try{for(let m=0;m<localStorage.length;m+=1){let b=localStorage.key(m);b?.startsWith("ccc:")&&b.endsWith(g)&&v.push(b)}v.forEach(m=>localStorage.removeItem(m))}catch{}Be(),Re(`Wiped ${v.length} storage keys for slot ${t} and refreshed.`);try{window.location.reload()}catch{}}),p.appendChild(h),e.appendChild(p)}function Ny(e){e.innerHTML="";let t=y();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Unlocks are available once a save slot is selected.",e.appendChild(n);return}try{Di()}catch{}Sp(t).forEach(n=>{e.appendChild(sy(n))})}function Lp(){if(!qn||Nl())return;sp(),up(),iu=0,lu=0;let e=document.getElementById(li);e&&e.remove();let t=document.createElement("div");t.id=li,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let r=document.createElement("div"),i=document.createElement("div");i.className="debug-panel-title",i.textContent="Debug Panel";let l=document.createElement("div");l.className="debug-panel-close-buttons";let o=document.createElement("button");o.className="debug-panel-close",o.type="button",o.setAttribute("aria-label","Close Debug Panel"),o.textContent="Close",o.addEventListener("click",()=>Kt({preserveExpansionState:!0}));let a=document.createElement("button");a.className="debug-panel-close debug-panel-close-collapse",a.type="button",a.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),a.textContent="Close & Collapse",a.addEventListener("click",()=>Kt()),l.appendChild(o),l.appendChild(a),r.appendChild(i);let s=document.createElement("div");if(s.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:u,hideOnMobile:d})=>{let f=document.createElement("div");f.className="debug-panel-info-line",d&&f.classList.add("debug-panel-info-mobile-hidden"),f.textContent=u,s.appendChild(f)}),r.appendChild(s),n.appendChild(r),n.appendChild(l),t.appendChild(n),t.appendChild(aa("Areas: main currency/stat/upgrade management for each area","debug-areas",u=>{Ly(u)})),t.appendChild(aa("Unlocks: modify specific unlock flags","debug-unlocks",u=>{Ny(u)})),t.appendChild(aa("Action Log: keep track of everything you do","debug-action-log",u=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",u.appendChild(d),sr=d,Js(),On(()=>{sr=null})})),t.appendChild(aa("Miscellaneous: helpful miscellaneous functions","debug-misc",u=>{ky(u)})),Xh(t),document.body.appendChild(t),Tl>0)try{t.scrollTop=Tl}catch{}Yh(),Vn=!0}function eu(){if(!(!qn||Nl())){if(y()==null){Kt();return}Vn||Lp()}}function Kt({preserveExpansionState:e=!1}={}){ru=e?Hh():la();let t=document.getElementById(li);if(t){try{Tl=t.scrollTop??0}catch{Tl=0}t.remove()}sp(),Vn=!1}function Cy(){if(!qn||Nl()||y()==null){Kt();return}Vn?Kt({preserveExpansionState:!0}):eu()}function Ay(){Kt(),js()}function ma(){if(!jh()){js(),Kt();return}up(),js();let e=document.createElement("button");e.id=nu,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=r=>{r.isTrusted&&Wr(e)||(oe(e),Cy())};e.addEventListener("pointerdown",r=>{t=r.pointerType||null,r.pointerType!=="mouse"&&(r.preventDefault(),n(r))}),e.addEventListener("click",r=>{if(t&&t!=="mouse"){t=null;return}t=null,n(r)}),document.body.appendChild(e)}function kp(e){if(qn=!!e,!qn){Ay();return}ma()}function My(e){kp(e)}var tu,li,nu,Vn,qn,ga,ru,Tl,iu,lu,ha,sr,oi,ai,Fl,ci,bn,ur,ou,dr,au,Np,Cp,ya,va,si,ba,ui,di,cu,su=Ne(()=>{St(),en(),et(),Jn(),vi(),Mi(),zr(),wo(),Ys(),qf(),gl(),tu="debug-panel-style",li="debug-panel",nu="debug-panel-toggle",Vn=!1,qn=!1,ga=[],ru=la(),Tl=0,iu=0,lu=0,ha=[],sr=null,oi=new Map,ai=new Map,Fl=new Set,ci=new Map,bn=new Map,ur=new Set,typeof window<"u"&&(window.__cccLockedStorageKeys=ur),ou=!1,dr=null,au=null,Np="ccc:debug:stat-mult",Cp="ccc:actionLog",ya=100,va="ccc:xp",si={unlock:e=>`${va}:unlocked:${e}`,level:e=>`${va}:level:${e}`,progress:e=>`${va}:progress:${e}`},ba="ccc:mutation",ui={unlock:e=>`${ba}:unlocked:${e}`,level:e=>`${ba}:level:${e}`,progress:e=>`${ba}:progress:${e}`},di=[{key:"xp",label:"XP"},{key:"mutation",label:"MP"}],cu=!1,Ml(),mp(),kp(!1),document.addEventListener("keydown",e=>{if(!(!qn||Nl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&y()!=null){if(e.shiftKey){Vn?(ry(),Kt()):eu(),e.preventDefault();return}Vn?Kt({preserveExpansionState:!0}):eu(),e.preventDefault()}}),document.addEventListener("DOMContentLoaded",()=>{ma()}),window.addEventListener("menu:visibilitychange",Gh),window.addEventListener("saveSlot:change",()=>{ma(),Vn&&Lp()})}),Ap={};Ze(Ap,{addMutationPower:()=>gu,broadcastMutationChange:()=>_p,computeMutationMultiplierForLevel:()=>Sa,computeMutationRequirementForLevel:()=>Tp,getMutationCoinSprite:()=>Fp,getMutationMultiplier:()=>hu,getMutationState:()=>Oe,initMutationSystem:()=>Bt,isMutationUnlocked:()=>fi,onMutationChange:()=>xa,setMutationUnlockedForDebug:()=>Ea,unlockMutationSystem:()=>pi});function Ia(e){try{return e?.toStorage?.()}catch{return null}}function fr(){try{zn()}catch{}}function _y(){if(typeof Na=="function"){try{Na()}catch{}Na=null}if(typeof Ca=="function"){try{Ca()}catch{}Ca=null}}function Pl(e){if(e instanceof ue)try{return e.clone?.()??ue.fromAny(e)}catch{return ye()}try{return ue.fromAny(e??0)}catch{return ye()}}function Ty(e){if(!e||typeof e!="object")return ye();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let r=e.floorToInteger?.()??e.clone?.()??e,i=r.toPlainIntegerString?.();if(!i||i==="Infinity")return r;try{let l=BigInt(i)/100n*100n;return l<=0n?ue.fromInt(100):ue.fromAny(l.toString())}catch{return r}}return e.clone?.()??e}function uu(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let r=Number(n);if(Number.isFinite(r))return r}}catch{}let t=Pe(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Mp(e){function t(o){let a=Math.max(0,o+1),s=Math.max(0,a-10),u=-.0022175354763501742*a*a+.20449967884058884*a+2.016778189084622+.20418426693226513*Math.pow(s,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let d=1;if(a>10){let p=Math.pow(1.12,a-10);if(!Number.isFinite(p)||(d+=Op*(p-1),!Number.isFinite(d)))return Number.POSITIVE_INFINITY}let f=u*d;return Number.isFinite(f)?f:Number.POSITIVE_INFINITY}let n=uu(e);if(!Number.isFinite(n))return ue.fromAny("Infinity");let r=Math.max(0,n);if(r>=100)return ue.fromAny("Infinity");let i;if(r<=49)i=t(r);else{let o=r-49,a=300/2499,s=3-a,u=a*o*o+s;if(!Number.isFinite(u))return ue.fromAny("Infinity");i=Math.pow(10,u)}if(!Number.isFinite(i)||i<=0)return ue.fromAny("Infinity");let l=Ie(i);return Ty(l)}function pr(){let e=E.level;if(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())){try{let n=c.fromAny("Infinity");E.requirement=n.clone?.()??n,E.progress=n.clone?.()??n}catch{(!E.requirement||typeof E.requirement!="object")&&(E.requirement=c.fromInt(0)),(!E.progress||typeof E.progress!="object")&&(E.progress=c.fromInt(0))}return}let t=Mp(E.level);E.requirement=t}function Fy(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),r=e.isInfinite?.();if(n)return r?1:0;if(t.isZero?.()||e.isZero?.())return 0;let i=Pe(e),l=Pe(t);if(!Number.isFinite(i)||!Number.isFinite(l))return i>=l?1:0;let o=i-l,a=Math.pow(10,o);return Number.isFinite(a)?a<=0?0:a>=1?1:a:o>=0?1:0}function du(){return ot.container&&ot.container.isConnected?!0:(ot.container=document.querySelector("[data-mp-hud].mp-counter"),ot.container?(ot.bar=ot.container.querySelector(".mp-bar"),ot.fill=ot.container.querySelector(".mp-bar__fill"),ot.levelValue=ot.container.querySelector(".mp-level-value"),ot.progress=ot.container.querySelector("[data-mp-progress]"),!0):!1)}function mr(e){try{return K(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function In(){if(!du())return;let{container:e,bar:t,fill:n,levelValue:r,progress:i}=ot;if(!e)return;if(!E.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),r&&(r.textContent="0"),i){let s=mr(E.requirement);i.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${s}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let s=mr(E.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${s||"10"} MP`)}no();return}e.removeAttribute("hidden");let l=E.requirement,o=Fy(E.progress,l),a=`${(o*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",a),n.style.width=a),r&&(r.innerHTML=mr(E.level)),i){let s=mr(E.progress),u=mr(l);i.innerHTML=`<span class="mp-progress-current">${s}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(o*100).toFixed(2));let s=mr(E.progress).replace(/<[^>]*>/g,""),u=mr(l).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${s} / ${u} MP`)}no()}function Hn(e="update",t={}){let n=Oe(),r={...n,slot:E.slot??y(),changeType:e,...t};if(ka.forEach(i=>{try{i(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:r}))}catch{}return r}function fu(){let e=E.slot;if(e==null&&(e=y(),e!=null&&(E.slot=e)),e==null)return;try{localStorage.setItem(mi(e),E.unlocked?"1":"0")}catch{}try{localStorage.setItem(gi(e),E.level.toStorage())}catch{}try{localStorage.setItem(hi(e),E.progress.toStorage())}catch{}xe(mi(e)),xe(gi(e)),xe(hi(e));let t=(()=>{let u=E.unlocked,d=E.level,f=E.progress;try{u=localStorage.getItem(mi(e))==="1"}catch{}try{let p=localStorage.getItem(gi(e));p&&(d=ue.fromAny(p))}catch{}try{let p=localStorage.getItem(hi(e));p&&(f=ue.fromAny(p))}catch{}return{unlocked:u,level:d,progress:f}})(),n=Ia(t.level),r=Ia(t.progress),i=Ia(E.level),l=Ia(E.progress),o=t.unlocked!==E.unlocked,a=n!=null&&i!=null&&n!==i,s=r!=null&&l!=null&&r!==l;(o||a||s)&&wa(t,{skipPersist:!0})}function Py(){if(!E.unlocked)return;pr();let e=E.requirement;if(!e||typeof e!="object"||e.isInfinite?.())return;let t=0,n=1e5;for(;E.progress.cmp?.(e)>=0&&t<n;){if(E.progress=E.progress.sub(e),E.level=E.level.add(gr()),pr(),e=E.requirement,!e||typeof e!="object"){E.progress=ye();break}if(e.isInfinite?.())break;t+=1}t>=n&&(E.progress=ye())}function wa(e,{skipPersist:t=!1}={}){E.unlocked=!!e.unlocked,E.level=Pl(e.level),E.progress=Pl(e.progress),E.unlocked||(E.level=ye(),E.progress=ye()),pr(),t||fu(),In(),Hn("load"),fr()}function pu(e){let t=e??y();if(t==null){wa({unlocked:!1,level:ye(),progress:ye()},{skipPersist:!0}),E.slot=null;return}let n=!1,r=ye(),i=ye();try{n=localStorage.getItem(mi(t))==="1"}catch{}try{let l=localStorage.getItem(gi(t));l&&(r=ue.fromAny(l))}catch{}try{let l=localStorage.getItem(hi(t));l&&(i=ue.fromAny(l))}catch{}wa({unlocked:n,level:r,progress:i},{skipPersist:!0}),E.slot=t}function Oy(){for(;yi.length;){let e=yi.pop();try{e?.()}catch{}}}function mu(e){yu!==e&&(Oy(),yu=e,e!=null&&(yi.push(Tt(mi(e),{onChange(t){let n=t==="1";E.unlocked!==n&&(E.unlocked=n,n||(E.level=ye(),E.progress=ye()),pr(),In(),Hn("storage"),fr())}})),yi.push(Tt(gi(e),{onChange(t){if(t)try{let n=ue.fromAny(t);E.level.cmp?.(n)!==0&&(E.level=n,pr(),In(),Hn("storage"),fr())}catch{}}})),yi.push(Tt(hi(e),{onChange(t){if(t)try{let n=ue.fromAny(t);E.progress.cmp?.(n)!==0&&(E.progress=n,pr(),In(),Hn("storage"))}catch{}}}))))}function Bt({forceReload:e=!1}={}){if(_y(),vu){let n=y();return(n!==E.slot||e)&&pu(n),mu(n),du(),In(),Oe()}vu=!0,du();let t=y();return E.slot=t,pu(t),mu(t),In(),fr(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=y();E.slot=n,pu(n),mu(n),In(),fr(),Hn("slot")}),Oe()}function Oe(){return{unlocked:E.unlocked,level:Pl(E.level),progress:Pl(E.progress),requirement:Pl(E.requirement)}}function fi(){return!!E.unlocked}function pi(){return Bt(),E.unlocked?!1:(E.unlocked=!0,pr(),fu(),In(),Hn("unlock"),fr(),!0)}function Ea(e){Bt();let t=!!e;wa({unlocked:t,level:t?E.level:ye(),progress:t?E.progress:ye()})}function gu(e){if(Bt(),!E.unlocked)return Oe();if(E.level&&E.level.isInfinite?.()){if(!E.progress?.isInfinite?.())try{E.progress=ue.fromAny("Infinity")}catch{}if(!E.requirement?.isInfinite?.())try{E.requirement=ue.fromAny("Infinity")}catch{}return Oe()}let t;try{t=e instanceof ue?e:ue.fromAny(e??0)}catch{t=ye()}if(t=Ws("mutation",t),t.isZero?.())return Oe();let n=t.clone?.()??t,r=E.level.clone?.()??E.level,i=E.progress.clone?.()??E.progress;if(E.progress=E.progress.add(n),E.progress.isInfinite?.()){try{E.level=ue.fromAny("Infinity")}catch{}try{E.progress=ue.fromAny("Infinity")}catch{E.progress=ye()}try{E.requirement=ue.fromAny("Infinity")}catch{}}else Py();fu(),In();let l=E.level.sub(r);return l.isZero?.()||fr(),Hn("progress",{delta:n.clone?.()??n,levelsGained:l.clone?.()??l,level:E.level.clone?.()??E.level,progress:E.progress.clone?.()??E.progress,requirement:E.requirement.clone?.()??E.requirement,previousLevel:r.clone?.()??r,previousProgress:i.clone?.()??i})}function _p(e={}){Bt();let t=e.changeType??"manual";return Hn(t,e)}function Sa(e){let t;if(e instanceof ue)try{t=e.clone?.()??e}catch{t=ye()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=ye()}else try{t=c.fromAny(e??0)}catch{t=ye()}if(t&&t.isInfinite?.())try{return ue.fromAny("Infinity")}catch{return gr()}let n=uu(t);if(!Number.isFinite(n))try{return ue.fromAny("Infinity")}catch{return gr()}if(n<=0)return gr();let r=n*Pp;return Ie(r)}function Tp(e){let t;try{t=e instanceof ue?e:ue.fromAny(e??0)}catch{t=ye()}try{return Mp(t)}catch{return ye()}}function hu(){if(Bt(),!E.unlocked)return gr();try{return Sa(E.level)}catch{return gr()}}function Fp(){if(!E.unlocked||E.level.isZero?.())return"img/currencies/coin/coin.png";let e=uu(E.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.png`:"img/mutations/m25.png"}function xa(e){return typeof e!="function"?()=>{}:(ka.add(e),()=>{ka.delete(e)})}var La,mi,gi,hi,ue,ye,gr,Pp,Op,E,ot,ka,yi,yu,vu,Na,Ca,vi=Ne(()=>{St(),et(),su(),en(),zr(),ud(),Jn(),La="ccc:mutation",mi=e=>`${La}:unlocked:${e}`,gi=e=>`${La}:level:${e}`,hi=e=>`${La}:progress:${e}`,ue=c,ye=()=>ue.fromInt(0),gr=()=>ue.fromInt(1),Pp=Math.log10(2),Op=9/(Math.pow(1.12,50)-1),E={unlocked:!1,level:ye(),progress:ye(),requirement:ye(),slot:null},ot={container:null,bar:null,fill:null,levelValue:null,progress:null},ka=new Set,yi=[],yu=null,vu=!1,Na=null,Ca=null,typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Bt,unlockMutationSystem:pi,addMutationPower:gu,getMutationState:Oe,getMutationMultiplier:hu,isMutationUnlocked:fi}))}),$p={};Ze($p,{createSpawner:()=>$y});function Bp(e){if(!e||typeof e!="object"){Ol=!1,bi=0n;return}Ol=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;bi=n&&n!=="Infinity"?BigInt(n):0n}catch{bi=0n}}function $y({playfieldSelector:e=".area-cove .playfield",waterSelector:t=".water-base",surgesHost:n=".surges",coinsHost:r=".coins-layer",coinSrc:i="img/coin/coin.png",coinSize:l=40,animationName:o="coin-from-wave",animationDurationMs:a=1500,surgeLifetimeMs:s=1400,surgeWidthVw:u=22,coinsPerSecond:d=1,perFrameBudget:f=24,backlogCap:p=600,maxActiveCoins:h=1500,initialBurst:g=1,coinTtlMs:v=6e4,waveSoundSrc:m="sounds/wave_spawn.mp3",waveSoundDesktopVolume:b=.4,waveSoundMobileVolume:w=.16,waveSoundMinIntervalMs:L=160,enableDropShadow:T=!1}={}){let x=i,B=window.matchMedia("(hover: none) and (pointer: coarse)").matches,M=50,R=0,k=120,H=10,J=400,se=180,ke=2,Y={pf:document.querySelector(e),w:document.querySelector(t),s:document.querySelector(n),c:document.querySelector(r),hud:document.getElementById("hud-bottom")};function ie(){return!!(Y.pf&&Y.w&&Y.s&&Y.c)}ie()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,surgesHost:n,coinsHost:r});let te={pfRect:null,wRect:null,safeBottom:0,pfW:0};function $(){if(!ie())return!1;let C=Y.pf.getBoundingClientRect(),le=Y.w.getBoundingClientRect(),Ee=Y.hud?Y.hud.getBoundingClientRect().height:0;return te={pfRect:C,wRect:le,safeBottom:C.height-Ee,pfW:C.width},!0}$();let q="ResizeObserver"in window?new ResizeObserver(()=>$()):null;q&&Y.pf&&q.observe(Y.pf),document.addEventListener("visibilitychange",()=>{document.hidden||$()});let j=(C,le,Ee)=>Math.max(le,Math.min(Ee,C)),W=Math.max(2e3,h*3),ve=800,re=12,X=[],N=[];function D(){let C=document.createElement("div");return C.className="coin",C.style.position="absolute",C.style.width=`${l}px`,C.style.height=`${l}px`,C.style.background=`url(${x}) center/contain no-repeat`,C.style.borderRadius="50%",C.style.pointerEvents="none",C.style.willChange="transform, opacity",C.style.contain="layout paint style size",T&&(C.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),C}let V=()=>X.length?X.pop():D();function G(C){C.style.animation="none",C.style.transform="",C.style.opacity="1",delete C.dataset.dieAt,delete C.dataset.jitter,delete C.dataset.collected,C.parentNode&&C.remove(),X.length<W&&X.push(C)}function Ve(){let C=document.createElement("div");return C.className="wave-surge",C.style.willChange="transform, opacity",C}let F=()=>N.length?N.pop():Ve();function we(C){C.classList.remove("run"),C.parentNode&&C.remove(),N.length<ve&&N.push(C)}let Z=new URL(m,document.baseURI).href,pe=null,me=null,It=0,Ye=null,Ut=0;function wt(){if(Ye)return Ye;let C=nc(m);if(Ye=Array.from({length:4},(le,Ee)=>{if(Ee===0&&C){C.preload="auto";try{C.currentTime=0}catch{}return C.volume=1,C}let Ue=new Audio(Z);return Ue.preload="auto",Ue.load?.(),Ue}),C)for(let le=1;le<Ye.length;le++)Ye[le].load?.();return Ye}function at(C){if(ce)try{z=z||new(window.AudioContext||window.webkitAudioContext),z.state==="suspended"&&z.resume(),Et=Et||z.createGain(),Et.gain.value=w,Et.connect(z.destination),pe||(pe=new Audio(Z),pe.preload="auto",pe.playsInline=!0,pe.crossOrigin="anonymous"),me||(me=z.createMediaElementSource(pe),me.connect(Et)),pe.muted=!1,pe.volume=1,pe.currentTime=0,pe.play().catch(()=>{});return}catch{try{let Ue=new Audio(Z);Ue.muted=!0,Ue.play().catch(()=>{})}catch{}return}let le=wt(),Ee=le[Ut++%le.length];Ee.volume=C;try{Ee.currentTime=0,Ee.play()}catch{}}let z=null,Et=null,wr=null,Yl=!1;async function $a(){if(!(wr||Yl)){Yl=!0;try{z=z||new(window.AudioContext||window.webkitAudioContext),Et=Et||z.createGain(),Et.gain.value=w,Et.connect(z.destination);let C=await(await fetch(Z,{cache:"force-cache"})).arrayBuffer();if(wr=await new Promise((le,Ee)=>z.decodeAudioData?z.decodeAudioData(C,le,Ee):le(null)),z.state==="suspended")try{await z.resume()}catch{}}catch{}finally{Yl=!1}}}function _i(){try{z&&z.state==="suspended"&&z.resume()}catch{}if(wr&&z&&Et)try{let C=z.createBufferSource();C.buffer=wr,C.connect(Et),C.start();return}catch{}at(w),$a()}let Ba=()=>{ce&&$a()};["pointerdown","touchstart"].forEach(C=>window.addEventListener(C,Ba,{once:!0,passive:!0,capture:!0})),wt(),document.addEventListener("visibilitychange",()=>{if(!document.hidden&&ce&&z&&z.state==="suspended")try{z.resume()}catch{}});function Ti(){let C=performance.now();C-It<L||(It=C,ce?_i():at(b))}function jl(C){if(!C)return null;let{x:le,y:Ee,w:Ue}=C,Je=le+Ue/2+(Math.random()*60-30)-l/2,Se=Ee+10-l/2,Me=Math.random()*100-50,Q=j(Je+Me,re,te.pfW-l-re),He=Math.max(te.wRect.height+80,120),st=Math.max(He+40,te.safeBottom-l-6),Ua=j(He+Math.random()*(st-He),He,st),M0=Je+(Q-Je)*.66,_0=Math.random()*100;return{x0:Je,y0:Se,xMid:M0,y1:Ua,x1:Q,jitterMs:_0}}function Ra(){if(!ie())return null;if((!te.pfRect||!te.wRect)&&$(),h!==1/0&&Y.c.childElementCount>=h){let He=Y.c.firstElementChild;He&&G(He)}let C=te.pfW,le=j(C*(u/100),220,520),Ee=Math.max(1,C-le-re*2),Ue=Math.random()*Ee+re,Je=te.wRect.top-te.pfRect.top,Se=Math.max(0,Je+te.wRect.height*.05),Me={x:Ue,y:Se,w:le},Q=jl(Me);return Q?{wave:Me,coin:Q}:null}function jn(C){if(!C.length||!ie())return;let le=document.createDocumentFragment(),Ee=document.createDocumentFragment(),Ue=[],Je=[];for(let{wave:Se,coin:Me}of C){if(Se){let st=F();st.style.left=`${Se.x}px`,st.style.top=`${Se.y}px`,st.style.width=`${Se.w}px`,le.appendChild(st),Je.push(st)}let Q=V();Q.style.background=`url(${x}) center/contain no-repeat`,Q.style.setProperty("--x0",`${Me.x0}px`),Q.style.setProperty("--y0",`${Me.y0}px`),Q.style.setProperty("--xmid",`${Me.xMid}px`),Q.style.setProperty("--y1",`${Me.y1}px`),Q.style.setProperty("--x1",`${Me.x1}px`),Q.style.transform=`translate3d(${Me.x0}px, ${Me.y0}px, 0)`,Q.dataset.jitter=String(Me.jitterMs);let He=Number(Me.durationMs);Number.isFinite(He)&&He>0?Q.dataset.animMs=String(Math.max(300,He)):Q.dataset.animMs&&delete Q.dataset.animMs,Q.dataset.dieAt=String(performance.now()+v),Ol?Q.dataset.mutationLevel=bi.toString():Q.dataset.mutationLevel="0",Ee.appendChild(Q),Ue.push(Q)}Y.s.appendChild(le),Y.c.appendChild(Ee),requestAnimationFrame(()=>{Je.length&&Ti();for(let Se of Je){Se.classList.remove("run"),Se.offsetWidth,Se.classList.add("run");let Me=Q=>{Q.target===Se&&we(Se)};Se.addEventListener("animationend",Me,{once:!0})}for(let Se of Ue){let Me=Number(Se.dataset.jitter)||0,Q=Number(Se.dataset.animMs),He=Number.isFinite(Q)&&Q>0?Math.max(300,Q):a;Se.style.animation="none",Se.offsetWidth,Se.style.animation=`${o} ${He}ms ease-out ${Me}ms 1 both`}})}function Gl(C=1){if(!ie())return;(!te.pfRect||!te.wRect)&&$();let le=[];for(let Ee=0;Ee<C;Ee++){let Ue=Ra();Ue&&le.push(Ue)}le.length&&jn(le)}let Er=d,Jt=null,Fi=performance.now(),I=0,A=0,de=null,qe=200;function je(C){(!te.pfRect||!te.wRect)&&$();let le=(C-Fi)/1e3;Fi=C;{let Me=0,Q=de||Y.c&&Y.c.firstElementChild;for(;Q&&Me<qe;){let He=Q.nextElementSibling,st=Number(Q.dataset&&Q.dataset.dieAt||0);st&&C>=st&&G(Q),Q=He,Me++}de=Q||null}I+=Er*le;let Ee=I|0,Ue=B?M:p;A>Ue&&(A=Ue),Ee>0&&(A=Math.min(Ue,A+Ee),I-=Ee);let Je=Math.min(A,f),Se=ke;if(B&&C<R&&A>0&&(A<=se?(Je=A,Se=H):(Je=Math.min(A,J),Se=H)),Je>0){let Me=performance.now(),Q=[],He=0;for(let st=0;st<Je&&!(performance.now()-Me>Se);st++){let Ua=Ra();Ua&&(Q.push(Ua),He+=1)}Q.length&&(jn(Q),He>0&&(A=Math.max(0,A-He)))}Jt=requestAnimationFrame(je)}function Sn(){if(!Jt){if(!ie()){console.warn("[Spawner] start() called but required nodes are missing.");return}$(),g>0&&Jt===null&&Gl(g),Fi=performance.now(),Jt=requestAnimationFrame(je)}}function ct(){Jt&&(cancelAnimationFrame(Jt),Jt=null)}function Sr(C){Er=Math.max(0,Number(C)||0)}function qu(C){C&&(x=C)}return document.addEventListener("visibilitychange",()=>{document.hidden||(B&&(R=performance.now()+k),Jt||Sn())}),{start:Sn,stop:ct,setRate:Sr,setCoinSprite:qu}}var Ol,bi,By=Ne(()=>{ic(),vi(),Mi(),Ol=!1,bi=0n;try{Bp(Oe())}catch{Ol=!1,bi=0n}try{xa(e=>{Bp(e)})}catch{}}),Rp={};Ze(Rp,{initCoinPickup:()=>Hy,setCoinMultiplier:()=>Uy});function Up(e){if(!e||typeof e!="object"){Ii=!1,$l=!1,Yn.clear();return}Ii=!!e.unlocked,$l=!!e.level?.isInfinite?.(),Ii?$l&&Yn.clear():Yn.clear()}function Ry(){if(typeof Xn=="function")try{Xn()}catch{}try{Up(Oe())}catch{Ii=!1,Yn.clear()}try{Xn=xa(e=>{Up(e)})}catch{Xn=null}}function Uy(e){Bl=e;try{P.coins?.mult?.set&&P.coins.mult.set(e)}catch{}}function bu(){try{let e=Qc();e instanceof c?Ei=e.clone?.()??e:e!=null?Ei=c.fromAny(e):Ei=c.fromInt(1)}catch{Ei=c.fromInt(1)}}function Dy(){Iu||(Iu=!0,bu(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",bu),typeof window<"u"&&window.addEventListener("saveSlot:change",bu))}function Vy(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return qp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function Dp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*Xp:0}function qy({playfield:e,coinsLayer:t,coinSelector:n,collectFn:r}){if(!e||!t||typeof r!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let i=document.createElement("div");i.className="magnet-indicator",i.setAttribute("aria-hidden","true"),e.appendChild(i);let l=!1,o=0,a=0,s=0,u=0,d=Dp(),f=0,p=0,h=0,g=!1,v=()=>{i.classList.remove("is-visible"),i.style.transform="translate3d(-9999px, -9999px, 0)"},m=()=>{if(!l||p<=0){v();return}let H=p*2;i.style.width=`${H}px`,i.style.height=`${H}px`,i.style.transform=`translate3d(${s-p}px, ${u-p}px, 0)`,i.classList.add("is-visible")},b=()=>{if(!l||p<=0)return;let H=t.querySelectorAll(n),J=p+Yp;for(let se=0;se<H.length;se+=1){let ke=H[se];if(!(ke instanceof HTMLElement)||ke.dataset.collected==="1")continue;let Y=ke.getBoundingClientRect(),ie=Y.left+Y.width/2,te=Y.top+Y.height/2,$=ie-o,q=te-a;Math.hypot($,q)<=J&&r(ke)}},w=()=>{h=0,!(!l||p<=0||g)&&(b(),L())},L=()=>{!l||p<=0||h||g||(h=requestAnimationFrame(w))},T=H=>{if(!H||g||typeof H.clientX!="number"||typeof H.clientY!="number")return;o=H.clientX,a=H.clientY;let J=e.getBoundingClientRect();s=o-J.left,u=a-J.top,l=s>=0&&s<=J.width&&u>=0&&u<=J.height,m(),L()},x=()=>{l=!1,v()},B=()=>{f=of(),p=f*d,m(),L()},M=()=>{d=Dp(),p=f*d,m(),L()},R=()=>{g=!0,h&&(cancelAnimationFrame(h),h=0);try{window.removeEventListener("resize",M)}catch{}try{window.removeEventListener("saveSlot:change",B)}catch{}try{document.removeEventListener("ccc:upgrades:changed",B)}catch{}try{e.removeEventListener("pointermove",T)}catch{}try{e.removeEventListener("pointerdown",T)}catch{}try{e.removeEventListener("pointerenter",T)}catch{}try{e.removeEventListener("pointerleave",x)}catch{}try{e.removeEventListener("pointercancel",x)}catch{}try{i.remove()}catch{}},k={passive:!0};return e.addEventListener("pointermove",T,k),e.addEventListener("pointerdown",T,k),e.addEventListener("pointerenter",T,k),e.addEventListener("pointerleave",x,k),e.addEventListener("pointercancel",x,k),window.addEventListener("resize",M),window.addEventListener("saveSlot:change",B),document.addEventListener("ccc:upgrades:changed",B),B(),{destroy:R}}function Hy({playfieldSelector:e=".area-cove .playfield",coinsLayerSelector:t=".area-cove .coins-layer",hudAmountSelector:n=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.mp3",storageKey:l="ccc:coins",disableAnimation:o=ce}={}){Aa?.destroy&&Aa.destroy();let a=document.querySelector(e),s=document.querySelector(t),u=document.querySelector(n);if(!a||!s||!u)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!s,amt:!!u}),{destroy(){}};Ry(),Dy(),a.style.touchAction="none";let d=null,f=P.coins.value,p=null,h=!1,g=()=>{try{let I=P?.coins?.mult;if(!I||typeof I.get!="function"){p=null,h=!1;return}let A=I.get();if(!A){p=c.fromInt(1),h=!1;return}p=A.clone?.()??c.fromAny(A),h=!!p?.isInfinite?.()}catch{p=null,h=!1}},v=I=>{let A;try{A=I instanceof c?I.clone?.()??I:c.fromAny(I??0)}catch{try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(I):c.fromInt(0)}catch{return c.fromInt(0)}}p||g();let de=p;if(!de)try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(A):A.clone?.()??A}catch{return A.clone?.()??A}if(h||de.isInfinite?.())try{return c.fromAny("Infinity")}catch{return A.clone?.()??A}if(A.isZero?.())return A.clone?.()??A;try{return A.mulBigNumInteger(de)}catch{try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(A):A.clone?.()??A}catch{return A.clone?.()??A}}},m=()=>{let I=K(f);I.includes("<span")?u.innerHTML=I:u.textContent=I};g(),m();let b=I=>{if(!I)return c.fromInt(0);if(typeof I.clone=="function")try{return I.clone()}catch{}try{return c.fromAny(I)}catch{return c.fromInt(0)}},w=I=>{if(!Ii)return null;if($l){if(wi)try{return wi.clone?.()??wi}catch{return wi}return null}if(!I)return null;let A=String(I).trim();if(!A)return null;let de=Yn.get(A);if(de)try{return de.clone?.()??c.fromAny(de)}catch{Yn.delete(A)}let qe;try{qe=c.fromAny(A)}catch{return null}let je;try{je=Sa(qe)}catch{je=null}if(!je)return null;let Sn=je.cmp?.(Hp)===0,ct=je.clone?.()??je;if(Yn.set(A,ct),Sn)return null;try{return ct.clone?.()??ct}catch{return ct}},L=null,T=null,x=null,B=!1,M=(I,A)=>{if(!A)return I;if(!I)return b(A);try{return I.add(A)}catch{try{return b(I).add(A)}catch{return b(A)}}},R=()=>{let I=L;if(L=null,I&&!I.isZero?.())try{P.coins.add(I)}catch{}let A=T;if(T=null,A&&!A.isZero?.())try{dc(A)}catch{}let de=x;if(x=null,de&&!de.isZero?.())try{gu(de)}catch{}},k=()=>{B||(B=!0,requestAnimationFrame(()=>{B=!1,R()}))},H=I=>{L=M(L,I),k()},J=I=>{T=M(T,I),k()},se=I=>{x=M(x,I),k()};typeof window<"u"&&window.addEventListener("beforeunload",R,{passive:!0});try{P.coins?.mult?.get&&P.coins?.mult?.set&&P.coins.mult.get().toPlainIntegerString()==="1"&&Bl&&Bl!=="1"&&P.coins.mult.set(Bl)}catch{}let ke=I=>{I?.detail&&I.detail.key==="coins"&&(f=I.detail.value,m())};window.addEventListener("currency:change",ke);let Y=I=>{if(!(!I?.detail||I.detail.key!=="coins"))try{let{mult:A}=I.detail;A instanceof c?p=A.clone?.()??A:A!=null?p=c.fromAny(A):p=c.fromInt(1),h=!!p?.isInfinite?.()}catch{p=null,h=!1}};window.addEventListener("currency:multiplier",Y);let ie=y();if(ie==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let te=`ccc:unlock:shop:${ie}`,$=`ccc:unlock:shop:progress:${ie}`,q=localStorage.getItem("ccc:unlock:shop:progress"),j=localStorage.getItem("ccc:unlock:shop");q!=null&&localStorage.getItem($)==null&&localStorage.setItem($,q),j!=null&&localStorage.getItem(te)==null&&localStorage.setItem(te,j),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let I=parseInt(localStorage.getItem($)||"0",10);if(localStorage.setItem($,String(I)),I>=10&&localStorage.getItem(te)!=="1"){try{kl()}catch{}localStorage.setItem(te,"1")}}let W=.3,ve=.12,re=new URL(i,document.baseURI).href,X=I=>I instanceof HTMLElement&&I.dataset.collected!=="1"&&I.matches(r);function N(I){try{I.style.pointerEvents="auto"}catch{}}s.querySelectorAll(r).forEach(N);let D=new MutationObserver(I=>{for(let A of I)A.addedNodes.forEach(de=>{de instanceof HTMLElement&&de.matches(r)&&(N(de),Ba(de))})});D.observe(s,{childList:!0,subtree:!0});let V=null,G=null,Ve=null,F=!1,we=!1,Z=!1,pe=0,me=null;function It(){me||(me=new Audio(re),me.preload="auto"),me.muted=!1,me.volume=ve;try{me.currentTime=0,me.play()}catch{}}async function Ye(){if(!(F||we)&&("AudioContext"in window||"webkitAudioContext"in window)){we=!0,Z=!0,V=new(window.AudioContext||window.webkitAudioContext),G=V.createGain(),G.gain.value=ve,G.connect(V.destination);try{let I=await(await fetch(re,{cache:"force-cache"})).arrayBuffer();if(Ve=await new Promise((A,de)=>V.decodeAudioData(I,A,de)),V.state==="suspended")try{await V.resume()}catch{}F=!0}catch(I){console.warn("[coinPickup] WebAudio init failed:",I)}finally{we=!1}}}function Ut(){if(V&&V.state==="suspended")try{V.resume()}catch{}if(ce&&(!F||!V||!Ve||!G||V&&V.state!=="running"))return we||Ye(),It(),!0;if(!F||!V||!Ve||!G)return we||Ye(),!0;try{let I=V.createBufferSource();I.buffer=Ve;try{I.detune=0}catch{}G.gain.setValueAtTime(ve,V.currentTime),I.connect(G);let A=V.currentTime+Math.random()*.006;return I.start(A),!0}catch(I){return console.warn("[coinPickup] playCoinWebAudio error:",I),ce&&It(),!1}}function wt(){return ce?Ut():Yl()}let at=()=>{ce&&Ye()};["pointerdown","touchstart","click"].forEach(I=>{window.addEventListener(I,at,{once:!0,passive:!0,capture:!0}),a.addEventListener(I,at,{once:!0,passive:!0,capture:!0})});let z=null,Et=0,wr=0;ce||(z=Array.from({length:8},()=>{let I=new Audio(re);return I.preload="auto",I.volume=.3,I}));function Yl(){let I=performance.now();if(I-wr<40)return;wr=I;let A=z[Et++%z.length];try{A.currentTime=0,A.play()}catch{}}function $a(I){if(o){I.remove();return}let A=getComputedStyle(I),de=A.transform&&A.transform!=="none"?A.transform:"translate3d(0,0,0)";I.style.setProperty("--ccc-start",de),I.classList.add("coin--collected");let qe=()=>{I.removeEventListener("animationend",qe),I.remove()};I.addEventListener("animationend",qe),setTimeout(qe,600)}function _i(I){if(!X(I))return!1;I.dataset.collected="1",wt(),$a(I);let A=Vy(I),de=Ql(be.COINS),qe=v(A),je=b(Vp),Sn=I.dataset.mutationLevel||null,ct=w(Sn);if(ct){try{qe=qe.mulBigNumInteger(ct)}catch{}try{je=je.mulBigNumInteger(ct)}catch{}}let Sr=typeof qe?.isZero=="function"?qe.isZero():!1;if(!Sr&&!de)try{f=f?.add?f.add(qe):b(qe)}catch{f=b(qe)}m(),Sr||H(qe);let qu=typeof Zn=="function"?Zn():!0,C=typeof je?.isZero=="function"?je.isZero():!1;if(qu&&!C&&J(je),typeof fi=="function"&&fi()){let le=b(Ei);le.isZero?.()||se(le)}if(localStorage.getItem(te)!=="1"){let le=parseInt(localStorage.getItem($)||"0",10)+1;if(localStorage.setItem($,String(le)),le>=10){try{kl()}catch{}localStorage.setItem(te,"1")}}return!0}d=qy({playfield:a,coinsLayer:s,coinSelector:r,collectFn:_i});function Ba(I){I.addEventListener("pointerdown",A=>{_i(I)},{passive:!0}),I.addEventListener("mouseenter",()=>{ce||_i(I)},{passive:!0})}s.querySelectorAll(r).forEach(Ba);let Ti=18,jl=[[0,0],[Ti,0],[-Ti,0],[0,Ti],[0,-Ti]];function Ra(I,A){for(let de=0;de<jl.length;de++){let qe=I+jl[de][0],je=A+jl[de][1],Sn=document.elementsFromPoint(qe,je);for(let ct=0;ct<Sn.length;ct++){let Sr=Sn[ct];X(Sr)&&_i(Sr)}}}let jn=null,Gl=!1;function Er(I,A){jn={x:I,y:A},Gl||(Gl=!0,requestAnimationFrame(()=>{jn&&(Ra(jn.x,jn.y),jn=null),Gl=!1}))}a.addEventListener("pointerdown",I=>{I.pointerType!=="mouse"&&Er(I.clientX,I.clientY)},{passive:!0}),a.addEventListener("pointermove",I=>{I.pointerType!=="mouse"&&Er(I.clientX,I.clientY)},{passive:!0}),a.addEventListener("pointerup",I=>{I.pointerType!=="mouse"&&Er(I.clientX,I.clientY)},{passive:!0}),a.addEventListener("mousemove",I=>{Er(I.clientX,I.clientY)},{passive:!0});function Jt(I){let A=Math.max(0,Math.min(1,Number(I)||0));G&&V&&G.gain.setValueAtTime(A,V.currentTime),me&&(me.volume=A)}let Fi=()=>{if(R(),typeof window<"u"&&(window.removeEventListener("beforeunload",R),window.removeEventListener("currency:multiplier",Y),window.removeEventListener("currency:change",ke)),typeof Xn=="function"){try{Xn()}catch{}Xn=null}if(d?.destroy){try{d.destroy()}catch{}d=null}try{D.disconnect()}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(I=>a.replaceWith(a.cloneNode(!0)))}catch{}};return Aa={destroy:Fi},{get count(){return f},set count(I){f=c.fromAny?c.fromAny(I):c.fromInt(Number(I)||0),m()},setMobileVolume:Jt,destroy:Fi}}var Ii,$l,Xn,Aa,Vp,qp,Hp,wi,Yn,Bl,Ei,Iu,Xp,Yp,Xy=Ne(()=>{et(),St(),en(),Ys(),Jn(),Mi(),vi(),zr(),Ii=!1,$l=!1,Xn=null,Aa=null,Vp=c.fromInt(1),qp=c.fromInt(1),Hp=c.fromInt(1);try{wi=c.fromAny("Infinity")}catch{wi=null}Yn=new Map,Bl="1",Ei=c.fromInt(1),Iu=!1,Xp=.03,Yp=8}),jp={};Ze(jp,{afterSlotWrite:()=>Qp,beforeSlotWrite:()=>Kp});function Gp(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Yy(e,t=em){!e||e<=0||Li.set(e,Gp()+t)}function Zp(e){if(!e||e<=0)return!1;let t=Li.get(e);return t==null?!1:t<=Gp()?(Li.delete(e),!1):!0}function jy(){Li.clear()}function Ma(){try{return typeof localStorage<"u"}catch{return!1}}function wu(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function zp(e){let t=new Map;if(!Ma())return ki.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let r=localStorage.key(n);if(!r||!r.startsWith(kr))continue;let i=wu(r);if(i==null||i!==e)continue;let l="";try{l=localStorage.getItem(r)??""}catch{l=""}t.set(r,l)}}catch{}return ki.set(e,t),t}function Wp(e){return!Number.isFinite(e)||e<=0?null:ki.has(e)?ki.get(e):zp(e)}function Kp(e){if(!Ma()||Rl>0)return;let t=String(e);if(!t.startsWith(kr))return;let n=wu(t);if(n==null)return;let r=Wp(n);if(r)try{for(let[i,l]of r.entries()){let o="";try{o=localStorage.getItem(i)??""}catch{o=""}if(o!==l){if(Rl===0){Rl+=1;try{xr(n)}finally{Rl-=1}}zp(n);return}}}catch{}}function Qp(e,t){let n=String(e);if(!n.startsWith(kr))return;let r=wu(n);if(r==null)return;let i=Wp(r)||new Map;i.set(n,String(t??"")),ki.set(r,i)}function Gy(e=[]){let t=0;for(let n of e){for(let r=0;r<n.length;r+=1)t=(t<<5)-t+n.charCodeAt(r)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function Zy(){let e=new Map;if(!Ma())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(kr))continue;let r=n.match(/:(\d+)$/);if(!r)continue;let i=parseInt(r[1],10);if(!Number.isFinite(i)||i<=0)continue;let l=Ku(i);if(n===l){e.has(i)||e.set(i,[]);continue}let o="";try{o=localStorage.getItem(n)??""}catch{}e.has(i)||e.set(i,[]),e.get(i).push(`${n}=${o}`)}}catch{}return e.forEach(t=>t.sort()),e}function zy(e){let t=new Set;e&&e.forEach((r,i)=>t.add(i));let n=y();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((r,i)=>t.add(i+1)),[...t].filter(r=>Number.isFinite(r)&&r>0)}function Wy(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],r=Qu(e);if(n.length===0){r&&(Zp(e)||xr(e),Za(e,null));return}let i=Gy(n);r&&i!==r&&!Zp(e)&&xr(e),i!==r&&Za(e,i)}function Si(){if(!Ma())return;let e=Zy();zy(e).forEach(t=>{let n=e.get(t)??[];Wy(t,n)})}function Ky(){_a==null&&(_a=(typeof window<"u"?window:globalThis).setTimeout(()=>{_a=null,Si()},tm))}function Qy(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),r=Number.isFinite(n)?n:null;if(!(!Number.isFinite(r)||r<=0)){if(t.trusted){Yy(r),Ky();return}Li.delete(r),Si()}}function Jy(){typeof window>"u"||Eu==null&&(Eu=window.setInterval(Si,Jp))}function e0(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function xi(){let e=e0();if(e){if(!zl()){(e.dataset.poopShopApplied===Ta||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==Su||e.dataset.poopShopApplied!==Ta)&&(e.style.backgroundImage=Su,e.dataset.poopShopApplied=Ta)}}function t0(){typeof window>"u"||xu==null&&(xi(),xu=window.setInterval(xi,50),window.addEventListener("saveSlot:change",xi),window.addEventListener("saveSlot:modified",e=>{try{let t=y();e?.detail?.slot===t&&xi()}catch{xi()}}))}function n0(){typeof window>"u"||(Si(),Jy(),t0(),window.addEventListener("saveSlot:change",()=>Si()),window.addEventListener("saveIntegrity:storageMutation",Qy,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(jy(),Si(),xi())}))}var Jp,em,tm,Eu,_a,Li,ki,Rl,Su,Ta,xu,nm=Ne(()=>{et(),Jp=1e4,em=750,tm=50,Eu=null,_a=null,Li=new Map,ki=new Map,Rl=0,Su="linear-gradient(180deg,#a9793d,#7b5534)",Ta="1",xu=null,n0()}),rm={};Ze(rm,{initPopups:()=>l0,teardownpopups:()=>o0});function Lu(){return Rt||(Rt=document.createElement("div"),Rt.className="currency-popups",Rt.setAttribute("aria-live","polite"),Rt.setAttribute("aria-atomic","false"),document.body.appendChild(Rt),Rt)}function hr(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function ku(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function im(e){if(!e)return;let{amountEl:t,amount:n,meta:r}=e,i=r.formatAmount?r.formatAmount(n):K(n);t&&(t.innerHTML=i)}function r0(e,t=Cu){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{yr.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function i0(e,t,n){Lu();let r=document.createElement("div");r.className="currency-popup",r.setAttribute("role","status");let i=document.createElement("span");i.className="currency-popup__plus",i.textContent="+";let l=document.createElement("img");l.className="currency-popup__icon",l.src=t.icon,l.alt=t.iconAlt||"";let o=document.createElement("span");o.className="currency-popup__text";let a=document.createElement("span");return a.className="currency-popup__amount",o.append(a),r.append(i,l,o),{type:e,meta:t,element:r,amountEl:a,amount:n.clone?.()??n,timeoutId:null}}function Nu(e,t,n={}){let r=dm[e],i=Object.assign({duration:Cu,accumulate:!0},r||{},n);if(!i.icon)return;let l=hr(t);if(!l||ku(l))return;let o=i.accumulate!==!1?yr.get(e):null;if(o){o.amount=o.amount.add(l),o.meta=i,im(o);return}let a=i0(e,i,l);a.meta=i,im(a),yr.set(e,a);let s=Lu(),u=Fa.indexOf(e),d=null;if(u>=0)for(let f=u+1;f<Fa.length;f++){let p=yr.get(Fa[f]);if(p?.element?.parentNode===s){d=p.element;break}}d?s.insertBefore(a.element,d):s.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),r0(a,i.duration)}function lm(){try{let e=getAllCurrencies();Object.entries(e).forEach(([t,n])=>{let r=hr(n)||c.fromInt(0);wn.set(t,r.clone?.()??r)}),wn.has("mp")||wn.set("mp",c.fromInt(0))}catch{wn.clear()}}function om(){yr.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),yr.clear()}function am(e){let t=e?.detail;if(!t?.key)return;let n=t.key,r=hr(t.value)||c.fromInt(0),i=wn.get(n)||c.fromInt(0),l=c.fromInt(0),o=null,a=t.delta!=null?hr(t.delta):null;a&&typeof a.cmp=="function"&&a.cmp(l)>0?o=a:typeof r.cmp=="function"&&r.cmp(i)>0&&(o=r.sub(i)),o&&!(typeof o.isZero=="function"&&o.isZero())&&Nu(n,o),wn.set(n,r.clone?.()??r)}function cm(e){let t=e?.detail;if(!t)return;let n=hr(t.xpAdded);n&&!ku(n)&&Nu("xp",n)}function sm(e){let t=e?.detail;if(!t)return;let n=hr(t.delta);n&&!ku(n)&&Nu("mp",n);let r=hr(t.progress);r&&wn.set("mp",r.clone?.()??r)}function um(){om(),lm()}function l0(){Ul||(Ul=!0,Lu(),lm(),window.addEventListener("currency:change",am),window.addEventListener("xp:change",cm),window.addEventListener("mutation:change",sm),window.addEventListener("saveSlot:change",um))}function o0(){Ul&&(window.removeEventListener("currency:change",am),window.removeEventListener("xp:change",cm),window.removeEventListener("mutation:change",sm),window.removeEventListener("saveSlot:change",um),om(),wn.clear(),Rt&&Rt.remove(),Rt=null,Ul=!1)}var Cu,Fa,dm,Rt,Ul,wn,yr,a0=Ne(()=>{St(),en(),et(),Cu=3200,Fa=["coins","xp","books","gold","mp"],dm={[be.COINS]:{icon:"img/currencies/coin/coin.png",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.png",iconAlt:"XP"},[be.BOOKS]:{icon:"img/currencies/book/book.png",iconAlt:"Book"},[be.GOLD]:{icon:"img/currencies/gold/gold.png",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.png",iconAlt:"Mutation Power"}},Rt=null,Ul=!1,wn=new Map,yr=new Map}),fm={};Ze(fm,{flushBackupSnapshot:()=>hm,getSuspendMetadata:()=>v0,installSuspendSafeguards:()=>y0,markProgressDirty:()=>Qt,restoreFromBackupIfNeeded:()=>h0});function Dl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function Ni(){if(typeof localStorage>"u")return!1;try{let e=`${bt}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function pm(){if(!Dl())throw new Error("IndexedDB unavailable");return Ci||(Ci=new Promise((e,t)=>{let n=!1;try{let r=indexedDB.open(ym,vm);r.onupgradeneeded=()=>{try{let i=r.result;i.objectStoreNames.contains(vr)||i.createObjectStore(vr)}catch(i){console.warn("Failed to upgrade suspend safeguard DB",i)}},r.onsuccess=()=>{n=!0;let i=r.result;i.onversionchange=()=>{try{i.close()}catch{}Ci=null},e(i)},r.onerror=()=>{n||t(r.error||new Error("Failed to open suspend safeguard DB"))},r.onblocked=()=>{}}catch(r){t(r)}}).catch(e=>{throw Ci=null,e}),Ci)}function c0(){if(!Ni())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let r=localStorage.key(n);if(!r||!r.startsWith(bt))continue;let i=null;try{i=localStorage.getItem(r)}catch{i=null}i!=null&&(e[r]=i,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function s0(e){try{let t=await pm();return await new Promise((n,r)=>{let i=!1,l=t.transaction(vr,"readwrite");l.oncomplete=()=>{i||(i=!0,n(!0))},l.onabort=()=>{i||(i=!0,r(l.error||new Error("Snapshot transaction aborted")))},l.onerror=()=>{i||(i=!0,r(l.error||new Error("Snapshot transaction error")))};let o=l.objectStore(vr).put(e,Tu);o.onerror=()=>{i||(i=!0,r(o.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function u0(){try{let e=await pm();return await new Promise((t,n)=>{let r=!1,i=e.transaction(vr,"readonly");i.oncomplete=()=>{r||(r=!0,t(null))},i.onabort=()=>{r||(r=!0,n(i.error||new Error("Snapshot read aborted")))},i.onerror=()=>{r||(r=!0,n(i.error||new Error("Snapshot read error")))};let l=i.objectStore(vr).get(Tu);l.onsuccess=()=>{r||(r=!0,t(l.result||null))},l.onerror=()=>{r||(r=!0,n(l.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function d0(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function Au(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function f0(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function p0(e){return!(typeof e!="string"||e.length===0||Em.test(e))}function Mu(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(bt)||n.startsWith(bm)||n.startsWith(Im))return;let r=f0(n);if(r!=null)try{let i={key:n,slot:r,trusted:p0(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:i}))}catch{}}function m0(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,r=e.clear;typeof t=="function"&&(e.setItem=function(i,l){let o=Au(),a=String(i),s=this===localStorage&&a.startsWith(bt);if(s)try{Kp(a)}catch{}let u;try{u=t.apply(this,arguments)}finally{try{if(s){Qt("setItem");try{Qp(a,l)}catch{}}this===localStorage&&a.startsWith(bt)&&Mu(a,o)}catch{}}return u}),typeof n=="function"&&(e.removeItem=function(i){let l=Au(),o;try{o=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(bt)&&(Qt("removeItem"),Mu(i,l))}catch{}}return o}),typeof r=="function"&&(e.clear=function(){let i=Au(),l;try{l=r.apply(this,arguments)}finally{try{this===localStorage&&(Qt("clear"),Mu(null,i))}catch{}}return l}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function mm(e="idle"){Ir=e||Ir,En=!0,!br&&(br=setTimeout(()=>{if(br=null,!En)return;let t=Ir;En=!1,hm(t)},wm))}function gm(){br&&(clearTimeout(br),br=null)}function Qt(e="dirty"){try{mm(e)}catch{}}async function _u(e="manual"){if(!Ni()||!Dl())return!1;let t=c0();if(!t)return!1;t.reason=e,Vl=!1;let n=await s0(t);return n||(En=!0,mm("retry")),n}async function hm(e="manual",{immediate:t=!1}={}){return!Ni()||!Dl()?!1:t?(gm(),En=!1,Vl=!0,_u(e)):(En=!0,Ir=e||Ir,_u(e))}function Pa(e){!Dl()||!Ni()||(gm(),En=!1,Vl=!0,_u(e))}function g0(){if(!Ni())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(bt))return!0}}catch{}return!1}async function h0(){if(Pu||(Pu=!0,!Ni()||!Dl()))return!1;let e=!1;try{if(!g0())e=!0;else{let r=localStorage.getItem(`${bt}saveSlot`);if(r){let i=`${bt}coins:${r}`;localStorage.getItem(i)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await u0();if(!t?.data)return!1;let n=!1;try{for(let[r,i]of Object.entries(t.data))i!=null&&localStorage.getItem(r)===null&&(localStorage.setItem(r,i),n=!0)}catch(r){console.warn("Failed to restore snapshot into localStorage",r)}return n&&Qt("restored"),n}function y0(){if(Fu||(Fu=!0,typeof window>"u"))return;d0(),m0();let e=()=>{document.hidden?Pa("visibility-hidden"):Qt("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>Pa("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>Pa("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>Pa("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Qt("pageshow"))}catch{}try{window.addEventListener("focus",()=>Qt("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(bt)||Qt("storage-event"))})}catch{}Qt("boot")}function v0(){return{pendingImmediateFlush:Vl,dirty:En,lastDirtyReason:Ir}}var bt,ym,vm,vr,Tu,bm,Im,wm,Ci,br,En,Ir,Fu,Pu,Vl,Em,b0=Ne(()=>{nm(),bt="ccc:",ym="ccc:safety",vm=1,vr="snapshots",Tu="latest",bm=`${bt}slotSig`,Im=`${bt}slotMod`,wm=1e3,Ci=null,br=null,En=!1,Ir="init",Fu=!1,Pu=!1,Vl=!1,Em=/\bat <anonymous>:\d+:\d+\b/});function I0(){if(!ce)return;let e=0,t=350;document.addEventListener("touchend",n=>{let r=performance.now();r-e<=t&&n.preventDefault(),e=r},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function w0(e="Loading assets..."){let t=document.getElementById("boot-loader");t||(t=document.createElement("div"),t.id="boot-loader",t.className="loading-screen",document.body.appendChild(t)),t.innerHTML="",Object.assign(t.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let n=document.createElement("div");n.style.textAlign="center",n.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let l=document.createElement("div");Object.assign(l.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let o=document.createElement("div");o.textContent="0%",Object.assign(o.style,{fontSize:"12px",opacity:".85"}),i.appendChild(l),n.append(r,i,o),t.appendChild(n);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),n.appendChild(a);let s=setTimeout(()=>{t.__done||(a.style.opacity="1")},25e3);return t.__mountedAt=performance.now(),t.__done=!1,t.__wrap=n,t.__bar=i,t.__fill=l,t.__pct=o,t.__label=r,t.__stuckMsg=a,t.__stuckTimeout=s,t}function E0(e,t){if(!e||!e.__fill||!e.__pct)return;let n=Math.max(0,Math.min(1,t||0)),r=Math.round(n*100);e.__fill.style.width=r+"%",e.__pct.textContent=r+"%"}function S0(e){if(!e||e.__done)return;e.__done=!0;let t=500;e.__label&&(e.__label.textContent="Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let n=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,450)},t)}async function Ou(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let r=document.createElement("img");r.src=e,r.alt="",r.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(r),requestAnimationFrame(()=>{r.remove(),n()})})}function x0(e,t){return e.map(n=>new Promise(r=>{let i=new Image,l=()=>{try{t?.(n)}catch{}r(n)};i.onload=l,i.onerror=l,i.src=n}))}function L0(e,t){return e.map(n=>new Promise(r=>{let i=new Audio,l=()=>{try{t?.(n)}catch{}r(n)};i.addEventListener("canplaythrough",()=>{typeof ql=="function"?ql(n,i):Hl.push({url:n,audio:i}),l()},{once:!0}),i.addEventListener("error",l,{once:!0}),i.preload="auto",i.src=n,i.load?.()}))}function k0(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function N0({images:e=[],audio:t=[],fonts:n=!0},r){let i=e.length+t.length+(n?1:0);if(i===0){r?.(1);return}let l=0,o=()=>{l++,r?.(l/i)},a=[...x0(e,o),...L0(t,o),...n?k0(o):[]];await Promise.all(a.map(s=>s.catch(()=>null)))}function C0(e){if(Vu===e)return;Vu=e;let t=document.querySelector(".menu-root");switch(e){case Ai.STARTER_COVE:{t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=document.getElementById("game-root");if(n&&(n.hidden=!1,km()),typeof Uu=="function")try{Uu()}catch{}if(typeof Du=="function")try{Du()}catch{}if(!Qe){Qe=xm({coinSrc:"img/currencies/coin/coin.png",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22}),window.spawner=Qe;let r=()=>{if(!(!Qe||typeof Qe.setCoinSprite!="function"))try{Qe.setCoinSprite(Rm?.())}catch{}};r(),Um?.(r),Lm();let i=()=>{try{let l=Tm(),o=Fm(l);Qe&&o?.coinsPerSecondMult&&Qe.setRate(1*o.coinsPerSecondMult)}catch{}};i(),Pm(i)}if(typeof $u=="function")try{$u()}catch{}Qe.start(),Qe&&typeof Qe.playEntranceWave=="function"&&Qe.playEntranceWave();break}case Ai.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),Qe&&Qe.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Ai.MENU}}))}catch{}}var A0,ce,Sm,xm,Lm,km,Nm,Cm,Am,Mm,_m,Tm,Fm,$u,Pm,ql,Om,$m,Bm,Bu,Ru,Uu,Du,Rm,Um,Oa,Hl,Ai,Vu,Qe,Xl,Dm,Mi=Ne(()=>{A0=!0,ce=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia?.("(any-pointer: coarse)")?.matches||"ontouchstart"in window;return window.IS_MOBILE=e,e})(),Hl=[],I0(),Ai={MENU:0,STARTER_COVE:1},Vu=Ai.MENU,Qe=null,Xl=()=>new Promise(e=>requestAnimationFrame(e)),Dm=async()=>{await Xl(),await Xl()},document.addEventListener("DOMContentLoaded",async()=>{let e=w0("Loading assets...");if(window.__MAINTENANCE__){let x=window.__MAINTENANCE_MESSAGE||"Update in progress. Please wait a few minutes.";e?.__label&&(e.__label.textContent=x),e?.__stuckTimeout&&(clearTimeout(e.__stuckTimeout),e.__stuckTimeout=null),e?.__pct&&(e.__pct.remove(),e.__pct=null),e?.__bar&&(e.__bar.remove(),e.__bar=null),e?.__fill&&(e.__fill=null),e?.__stuckMsg&&(e.__stuckMsg.remove(),e.__stuckMsg=null),e?.__wrap&&(e.__wrap.style.display="grid",e.__wrap.style.gap="18px"),document.documentElement.classList.remove("booting");return}await Xl();let t=Promise.all([Promise.resolve().then(()=>(cd(),od)),Promise.resolve().then(()=>(By(),$p)),Promise.resolve().then(()=>(Xy(),Rp)),Promise.resolve().then(()=>(Ys(),lp)),Promise.resolve().then(()=>(et(),ju)),Promise.resolve().then(()=>(nm(),jp)),Promise.resolve().then(()=>(zr(),Vd)),Promise.resolve().then(()=>(ic(),sd)),Promise.resolve().then(()=>(Jn(),dd)),Promise.resolve().then(()=>(wo(),kd)),Promise.resolve().then(()=>(vi(),Ap)),Promise.resolve().then(()=>(a0(),rm)),Promise.resolve().then(()=>(b0(),fm)),Promise.resolve().then(()=>(gl(),Sf)),Promise.resolve().then(()=>(su(),cp))]),n={images:["img/currencies/coin/coin.png","img/currencies/coin/coin_base.png","img/currencies/coin/coin_plus_base.png","img/currencies/book/book.png","img/currencies/book/book_base.png","img/currencies/book/book_plus_base.png","img/currencies/gold/gold.png","img/currencies/gold/gold_base.png","img/currencies/gold/gold_plus_base.png","img/sc_upg_icons/faster_coins.png","img/sc_upg_icons/book_val1.png","img/sc_upg_icons/coin_val1.png","img/sc_upg_icons/xp_val1.png","img/sc_upg_icons/faster_coins2.png","img/sc_upg_icons/coin_val2.png","img/sc_upg_icons/xp_val2.png","img/sc_upg_icons/mp_val1.png","img/sc_upg_icons/magnet.png","img/sc_upg_icons/xp_val_hm.png","img/stats/xp/xp.png","img/stats/xp/xp_base.png","img/stats/xp/xp_plus_base.png","img/stats/mp/mp.png","img/stats/mp/mp_base.png","img/stats/mp/mp_plus_base.png","img/misc/forge.png","img/misc/locked.png","img/misc/locked_base.png","img/misc/maxed.png","img/misc/merchant.png","img/misc/mysterious.png",...Array.from({length:25},(x,B)=>`img/mutations/m${B+1}.png`)],audio:["sounds/coin_pickup.mp3","sounds/wave_spawn.mp3","sounds/merchant_typing.mp3","sounds/purchase_upg.mp3","sounds/forge_reset.mp3","sounds/evolve_upg.mp3"],fonts:!0},r=0,i=N0(n,x=>{r=x,E0(e,x)}),[l,o,a,s,u,d,f,p,h,g,v,m,b,w,L]=await t;if({initSlots:Sm}=l,{createSpawner:xm}=o,{initCoinPickup:Lm}=a,{initHudButtons:km}=s,{bank:Cm,getHasOpenedSaveSlot:Am,setHasOpenedSaveSlot:Mm,ensureStorageDefaults:_m}=u,{getCurrentAreaKey:Tm,computeUpgradeEffects:Fm,onUpgradesChanged:Pm}=f,{registerPreloadedAudio:ql}=p,{initXpSystem:$u}=h,{initResetSystem:Uu}=g,{initMutationSystem:Du,getMutationCoinSprite:Rm,onMutationChange:Um}=v,{initPopups:Om}=m,{installSuspendSafeguards:$m,restoreFromBackupIfNeeded:Bm,markProgressDirty:Bu,flushBackupSnapshot:Ru}=b,{installGhostTapGuard:Nm}=w,{setDebugPanelAccess:Oa}=L,window.bank=Cm,typeof ql=="function"&&Hl.length)for(;Hl.length;){let x=Hl.shift();if(x)try{ql(x.url,x.audio)}catch{}}Nm?.(),$m?.(),typeof Oa=="function"&&(Oa(!0),window.setDebugPanelAccess=Oa);try{await Bm?.()}catch{}await i,await Dm(),document.documentElement.classList.remove("booting"),await Xl(),S0(e),await Promise.all([Ou("img/currencies/coin/coin_plus_base.png"),Ou("img/stats/xp/xp_plus_base.png"),Ou("img/stats/mp/mp_plus_base.png")]),_m(),Bu?.("ensure-defaults"),Om();let T=document.getElementById("panel-title");if(Am()?(document.body.classList.add("has-opened"),T&&(T.style.opacity="0")):T&&(T.style.opacity="1"),Sm(()=>{Mm(!0),document.body.classList.add("has-opened"),T&&(T.style.opacity="0"),C0(Ai.STARTER_COVE),Bu?.("slot-entered")}),typeof window<"u"&&Ru)try{window.cccRequestBackup=()=>Ru("manual",{immediate:!0})}catch{}})});Mi()})(); 
