(()=>{var fS=Object.defineProperty;var Fe=(e,t)=>()=>(e&&(t=e(e=0)),t);var St=(e,t)=>{for(var n in t)fS(e,n,{get:t[n],enumerable:!0})};var Vl={};St(Vl,{initAudio:()=>dS,loadAudio:()=>yh,playAudio:()=>ct,registerPreloadedBuffer:()=>mS,setAudioSuspended:()=>yf,setMusicUnderwater:()=>Xr});function gf(){if(Wt)return Wt;let e=window.AudioContext||window.webkitAudioContext;return e?(Wt=new e,ha=Wt.createGain(),ha.connect(Wt.destination),ha.gain.value=1,Xl=Wt.createGain(),Xl.gain.value=1,Xl.connect(ha),bo=Wt.createBiquadFilter(),bo.type="lowpass",bo.frequency.value=22050,bo.Q.value=1,bo.connect(Xl),Wt):null}function dS(){gf()}function pS(){Wt&&Wt.state==="suspended"&&Wt.resume().catch(()=>{})}async function yh(e){let t=gf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(ga.has(n))return ga.get(n);if(Wl.has(n))return Wl.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return ga.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{Wl.delete(n)}})();return Wl.set(n,o),o}function ct(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=gf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=ga.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(bo):f.connect(ha),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else yh(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function mS(e,t){let n=new URL(e,document.baseURI).href;ga.set(n,t)}function yf(e){Wt&&(e?Wt.state==="running"&&Wt.suspend().catch(()=>{}):Wt.state==="suspended"&&Wt.resume().catch(()=>{}))}function Xr(e){if(!bo)return;let t=e?600:22050;try{let n=Wt.currentTime;bo.frequency.cancelScheduledValues(n),bo.frequency.setValueAtTime(t,n)}catch{bo.frequency.value=t}}var Wt,ha,Xl,bo,ga,Wl,Pn=Fe(()=>{Wt=null,ha=null,Xl=null,bo=null,ga=new Map,Wl=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,pS,{capture:!0,passive:!0})})});function vh(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var bh=Fe(()=>{});function ke(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let h=Math.log10(p),m=e.e||0,y=Number(e._eOffset||0n);return h+m+y}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(p)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function Me(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function vf(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/Sh;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/Sh:e>0?e:0}var c,Sh,It=Fe(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",p=BigInt(u+d);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};Sh=Math.log(10)});function Eh(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return wh.format(t)}catch{return String(e)}}function ya(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function bf(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Eh(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+wh.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=Sf.get(u)||"",p=o-u+1,h=4-p,m=p+h;n.length<m+1&&(n+="0".repeat(m+1-n.length));let y=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(y=ya(y));let v,E;return y.length>m?(v=y.slice(0,p+1),E="0".repeat(h)):(v=y.slice(0,p),E=y.slice(p)),t+`${v}${h?"."+E:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=ya(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+bf(String(o))}function gS(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+bf(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=ya(f)),l){let A=f.slice(0,1)+"."+f.slice(1),N=i==="-"?"-":"";return t+A+"e"+bf(s,N)}let p=Math.floor(a/3)*3,h=Sf.get(p)||"",y=a-p+1,g=4-y,v,E;return f.length>4?(v=f.slice(0,y+1),E="0".repeat(g)):(v=f.slice(0,y),E=f.slice(y)),t+(i==="-"?"-":"")+v+(g?"."+E:"")+h}function Ih(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=ya(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+gS(l)}function ne(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Ih(e.toScientific(3));if(t<6)return Eh(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=Sf.get(n);if(!o)return Ih(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=ya(u));let d,p;return u.length>l?(d=u.slice(0,i+1),p="0".repeat(s)):(d=u.slice(0,i),p=u.slice(i)),`${d}${s?"."+p:""}${o}`}function We(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=ke(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return ne(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):ne(c.fromAny(t))}catch{return"1"}}var hS,Sf,wh,Kt=Fe(()=>{It();hS=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],Sf=new Map(hS),wh=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var Oh={};St(Oh,{CURRENCIES:()=>Ce,KEYS:()=>yt,STORAGE_PREFIX:()=>Hi,bank:()=>P,clearActiveSlot:()=>MS,clearAllStorage:()=>NS,ensureCurrencyDefaults:()=>Nf,ensureMultiplierDefaults:()=>Rf,ensureStorageDefaults:()=>TS,getActiveSlot:()=>b,getCurrency:()=>Sa,getCurrencyMultiplierBN:()=>Rh,getHasOpenedSaveSlot:()=>kS,getLastSaveTime:()=>Mf,getLastSaveTimeKey:()=>Zl,getSlotModifiedFlagKey:()=>AS,getSlotSignature:()=>Tf,getSlotSignatureKey:()=>kf,hasModifiedSave:()=>Xi,isCurrencyLocked:()=>Bn,isStorageKeyLocked:()=>Vt,markSaveSlotModified:()=>bn,notifyGameSessionStarted:()=>_S,onCurrencyChange:()=>jl,peekCurrency:()=>Ia,primeStorageWatcherSnapshot:()=>it,setActiveSlot:()=>Af,setCurrency:()=>qi,setCurrencyMultiplierBN:()=>ec,setHasOpenedSaveSlot:()=>Ql,setSlotSignature:()=>Jl,updateLastSaveTime:()=>Th,watchStorageKey:()=>Ct});function Ef(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function xf(e){let t=Ef(e);return t==null?null:`${yS}:${t}`}function Lf(e){let t=Ef(e);return t==null?null:`${vS}:${t}`}function Mh(e={}){Yl.size!==0&&Yl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function jl(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Yl.add(o),()=>{Yl.delete(o)}}function SS(){if(va!=null||Do.size===0)return;va=(typeof window<"u"?window:globalThis).setInterval(wS,bS)}function Ah(){if(Do.size!==0||va==null)return;(typeof window<"u"?window:globalThis).clearInterval(va),va=null}function kh(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function IS(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function wS(){if(Do.size===0){Ah();return}Do.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=kh(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!IS(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function Ct(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Do.get(e);return s||(s=new Set,Do.set(e,s)),s.add(i),SS(),()=>{let l=Do.get(e);l&&(l.delete(i),l.size===0&&(Do.delete(e),Ah()))}}function it(e,t){if(!e)return;let n=Do.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=kh(r,o),r.initialized=!0)})}function _f(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function ES(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function xS(){If.forEach(e=>{try{e?.()}catch{}}),If.clear()}function Lh(e){if(e!==xh&&(xS(),xh=e??null,e!=null))for(let t of Object.values(Ce)){let n=`${yt.CURRENCY[t]}:${e}`,o=Ct(n,{parse:ES,equals:_f,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};Mh(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});If.set(n,o)}}function LS(){typeof window>"u"||(Lh(b()),window.addEventListener("saveSlot:change",()=>{Lh(b())}))}function _S(){Cf=!0}function Zl(e=b()){return e==null?null:`${mr}lastSaveTime:${e}`}function Th(){if(!Cf||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(Zl(e),String(t))}catch{}}function Mf(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(Zl(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function CS(){typeof window>"u"||(_h||(_h=setInterval(Th,1e3)),window.addEventListener("beforeunload",()=>{if(!Cf)return;let e=b();if(e!=null)try{localStorage.setItem(Zl(e),String(Date.now()))}catch{}}))}function b(){if(dr!==void 0)return dr;let e=localStorage.getItem(yt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return dr=n,n}function Af(e){let t=Math.max(1,parseInt(e,10)||1);dr=t,localStorage.setItem(yt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function MS(){dr=null,localStorage.removeItem(yt.SAVE_SLOT)}function ba(e,t=b()){return t==null?null:`${e}:${t}`}function Nh(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Vt(e){return Nh(e)}function kf(e=b()){return xf(e)}function AS(e=b()){return Lf(e)}function Tf(e=b()){if(typeof localStorage>"u")return null;let t=xf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function Jl(e,t){if(typeof localStorage>"u")return;let n=xf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function Xi(e=b()){if(typeof localStorage>"u")return!1;let t=Lf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function bn(e=b()){if(typeof localStorage>"u")return;let t=Ef(e);if(t==null||Xi(t))return;let n=Lf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function kS(){return localStorage.getItem(yt.HAS_OPENED_SAVE_SLOT)==="true"}function Ql(e){localStorage.setItem(yt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function TS(){localStorage.getItem(yt.HAS_OPENED_SAVE_SLOT)===null&&Ql(!1)}function Nf(){let e=b();if(e!=null)for(let t of Object.values(Ce)){let n=`${yt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function Rf(){let e=b();if(e!=null)for(let t of Object.values(Ce)){let n=`${yt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Kl(t);else{let o=pr(c.fromInt(1));Gi(t,o)}}}function Sa(e){let t=ba(yt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function qi(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=ba(yt.CURRENCY[e],r),s=o??Sa(e),l=c.fromInt(0);if(!i||Bn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,p=a;try{f!=null&&(p=c.fromAny(f),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}it(i,d);let h=!_f(s,p),y=(v=>{if(v==null)return null;try{let E=v instanceof c?v.clone?.()??v:c.fromAny(v);if(typeof E.cmp=="function")return E.cmp(l)>0?E:null;if(!E.isZero?.())return E}catch{}return null})(n),g=null;if(h)try{g=p.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=y),h||g){let v={key:e,value:p,slot:r,delta:g??void 0};Mh(v);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:v}))}catch{}}return p}function pr(e){return e.mulScaledIntFloor(1n,-wf)}function zl(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,wf)}function Kl(e){let t=ba(yt.MULTIPLIER[e]);if(!t)return pr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Wr)){let r=pr(c.fromInt(1));return Gi(e,r),r}let o=n.slice(Wr.length);try{return c.fromAny(o)}catch{let r=pr(c.fromInt(1));return Gi(e,r),r}}function Gi(e,t,n=b()){let o=ba(yt.MULTIPLIER[e],n);if(!o||Bn(e,n))return;let r=pr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Wr))try{r=c.fromAny(i.slice(Wr.length))}catch{}let s=c.fromAny(t),l=Wr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(Wr)?u.slice(Wr.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{it(o,u)}catch{}if(!_f(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:zl(f),slot:n}}))}catch{}}function Rh(e){return zl(Kl(e))}function Bn(e,t=b()){let n=ba(yt.CURRENCY[e],t);return Nh(n)}function ec(e,t){let n=c.fromAny(t),o=pr(n);return Gi(e,o,b()),n}function Ia(e,t){let n=localStorage.getItem(`${yt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function NS(){Object.values(yt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Ch(e){let t=n=>{try{let o=c.fromAny(n);return typeof ne=="function"?ne(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return Sa(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return qi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),qi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return qi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof ne=="function"?ne(r):r.toString()},t.mult={get(){return Rh(e)},set(n){return ec(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Kl(e).mulBigNumInteger(o);return r.isZero()&&(r=pr(c.fromInt(1))),Gi(e,r),zl(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),wf)}catch{o={numer:1n,scale:0}}let r=Kl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=pr(c.fromInt(1))),Gi(e,r);let i=zl(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var mr,Hi,yS,vS,wf,Wr,bS,Do,va,Yl,If,xh,_h,Cf,yt,Ce,dr,P,vt=Fe(()=>{It();Kt();mr="ccc:",Hi=mr,yS=`${mr}slotSig`,vS=`${mr}slotMod`,wf=18,Wr="XM:",bS=140,Do=new Map,va=null,Yl=new Set;If=new Map,xh=null;_h=null,Cf=!1;CS();yt={HAS_OPENED_SAVE_SLOT:`${mr}hasOpenedSaveSlot`,SAVE_SLOT:`${mr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Ce={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===yt.SAVE_SLOT){if(e.newValue===null)dr=null;else{let t=parseInt(e.newValue,10);dr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:dr}}))}catch{}}});for(let e of Object.values(Ce))yt.CURRENCY[e]=`${mr}${e}`,yt.MULTIPLIER[e]=`${mr}mult:${e}`;LS();P=new Proxy({},{get(e,t){if(Object.values(Ce).includes(t))return Ch(t);if(typeof t=="string"&&Ce[t.toUpperCase?.()])return Ch(Ce[t.toUpperCase()])}});if(typeof window<"u"){window.bank=P;for(let e of Object.values(Ce))window[e]=P[e]}});function Bh(){return So}function tc(e){So=!!e,document.body.classList.toggle("slots-delete-mode",So);let t=document.getElementById("manage-saves");t&&(t.textContent=So?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",So),n.setAttribute("aria-pressed",So?"true":"false")})}function RS(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function OS(){if(Ph)return;Ph=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),tc(!So)}),window.addEventListener("keydown",r=>{So&&r.key==="Escape"&&tc(!1)});let n=r=>{!So||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!So)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(RS(s),b()===s)try{localStorage.removeItem(yt.SAVE_SLOT)}catch{}Of(),tc(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),tc(!1)}var So,Ph,Fh=Fe(()=>{vt();Pf();So=!1,Ph=!1;document.addEventListener("DOMContentLoaded",()=>{try{OS()}catch{}})});var Uh={};St(Uh,{initSlots:()=>FS,refreshSlotsView:()=>Of});function PS(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function BS(e){if(!PS(e))return"No Save Data";try{let t=Ia(e,"coins");return ne(t)}catch{return"0"}}function Bf(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=BS(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function FS(e){let t=document.querySelectorAll(".slot-card");Bf(),t.forEach((n,o)=>{let r=o+1,i=s=>{Af(r),Nf(),Rf(),Ql(!0),typeof e=="function"&&e(r,s),Bf()};n.addEventListener("click",s=>{Bh()||(s.preventDefault(),i(s))})})}function Of(){Bf()}var Pf=Fe(()=>{It();Kt();Fh();vt()});var $h={};St($h,{registerPreloadedAudio:()=>US,takePreloadedAudio:()=>DS});function US(e,t){let n=Dh(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}nc.set(n,t)}}function DS(e){let t=Dh(e);if(!nc.has(t))return null;let n=nc.get(t);return nc.delete(t),n}var nc,Dh,oc=Fe(()=>{nc=new Map,Dh=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Wi(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var Ff=Fe(()=>{});var ng={};St(ng,{addExternalCoinMultiplierProvider:()=>qo,addExternalXpGainMultiplierProvider:()=>vr,addXp:()=>Zi,broadcastXpChange:()=>cc,computeCoinMultiplierForXpLevel:()=>zf,getXpGainMultiplier:()=>fc,getXpLevelStorageKey:()=>$S,getXpRequirementForXpLevel:()=>uc,getXpState:()=>et,initXpSystem:()=>Ki,isXpSystemUnlocked:()=>cn,onXpChange:()=>ac,refreshCoinMultiplierFromXpLevel:()=>Qt,resetXpProgress:()=>ji,setExternalBookRewardProvider:()=>dc,setExternalCoinMultiplierProvider:()=>eg,setExternalXpGainMultiplierProvider:()=>tg,unlockXpSystem:()=>Kr});function $S(e=b()){let t=e??b();return t==null?null:Vr(t)}function ln(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function rc(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function zh(e){if(!e||typeof e!="object")return 0;if(ln(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function HS(e){return!e||typeof e!="object"?0:ln(e)||typeof e.cmp=="function"&&e.cmp(Yh)>=0?Number.POSITIVE_INFINITY:zh(e)}function Gh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(GS,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(Ca())??c.fromInt(0):n}function XS(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(Vh,18)}function WS(e){if(ln(e)||typeof e.cmp=="function"&&e.cmp(Yh)>=0)return Lt.clone?.()??Lt;let t=e.floorToInteger(),n=e.sub(t),o=zh(n);if(!Number.isFinite(o))return Lt.clone?.()??Lt;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return Lt.clone?.()??Lt;let d=BigInt(u)+l-BigInt(i),h=d%BigInt(250),m=Number(h),y=d-h;return new c(a,{base:m,offset:y})}function Kh(e){if(!e||typeof e!="object")return Lt.clone?.()??Lt;let n=XS(e),o=WS(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return Lt.clone?.()??Lt;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function jh(){let e=ln(G.xpLevel),t=ln(G.progress);if(!e&&!t)return!1;let n=Lt.clone?.()??Lt;if(G.xpLevel=n.clone?.()??n,G.progress=n.clone?.()??n,wt=n.clone?.()??n,P?.books)try{typeof P.books.set=="function"?P.books.set(n.clone?.()??n):typeof P.books.add=="function"&&P.books.add(n.clone?.()??n)}catch{}return!0}function xa(e={}){_a.size!==0&&_a.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function ac(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return _a.add(n),()=>{_a.delete(n)}}function Ot(){return c.fromInt(0)}function Ca(){return c.fromInt(1)}function Vi(e){if(!e)return Ot();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ot()}}function ic(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function VS(){for(;Wf.length>0;){let e=Wf.pop();try{e?.()}catch{}}}function Xh(e){if(e==null)return Ot();try{return c.fromAny(e)}catch{return Ot()}}function $f(e){if(!Df){Df=!0;try{let t=Vf??b(),n={unlocked:G.unlocked,xpLevel:Vi(G.xpLevel),progress:Vi(G.progress),requirement:Vi(wt)};Jt(!0),Qn(),In(!0);let o={unlocked:G.unlocked,xpLevel:Vi(G.xpLevel),progress:Vi(G.progress),requirement:Vi(wt)},r=n.unlocked!==o.unlocked,i=!ic(n.xpLevel,o.xpLevel),s=!ic(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ot();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ot()}catch{l=Ot()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||_a.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(xa(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{Df=!1}}}function qf(e){if(e===Vf||(VS(),Vf=e??null,e==null))return;let t=(n,o)=>{let r=Ct(n,o);typeof r=="function"&&Wf.push(r)};t(wa(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>$f("unlock")}),t(Vr(e),{parse:Xh,equals:ic,onChange:()=>$f("xpLevel")}),t(zi(e),{parse:Xh,equals:ic,onChange:()=>$f("progress")})}function Zh(){if(Hh){qf(b());return}Hh=!0,qf(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{qf(b()),Jt(!0),Qn(),In(!0)})}function Gf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function YS(e){let t=e<qh?e:qh;if(t<=Yi)return;let n=Yi,o=hr.get(n.toString());for(o||(o=c.fromInt(10),hr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),hr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Yi=n;return}}Yi=n}function zS(e){let t=Yi>0n?Yi:0n,n=hr.get(t.toString());if(!n||ln(n))return Lt.clone?.()??Lt;let o=c.fromAny(t.toString()),r=ke(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);rc(s)||(i=i.add?.(s.mulDecimal(Vh,18))??i);let l=Gh(e),a=Gh(o),u=l.sub?.(a)??c.fromInt(0);rc(u)||(i=i.add?.(u.mulDecimal(qS,18))??i);let f=HS(i);return Number.isFinite(f)?Me(f):Lt.clone?.()??Lt}function KS(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=ln(t),o=ln(e);if(n)return o?1:0;if(rc(t)||rc(e))return 0;let s=ke(e),l=ke(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Jh(){return Sn.container&&Sn.container.isConnected?!0:(Sn.container=document.querySelector(".xp-counter[data-xp-hud]"),Sn.container?(Sn.bar=Sn.container.querySelector(".xp-bar"),Sn.fill=Sn.container.querySelector(".xp-bar__fill"),Sn.xpLevelValue=Sn.container.querySelector(".xp-level-value"),Sn.progress=Sn.container.querySelector("[data-xp-progress]"),!0):!1)}function Qh(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=hr.get("0");return a.clone?.()??a}if(r.bigInt!=null){YS(i);let a=i.toString(),u=hr.get(a);if(u)return u.clone?.()??u}let s=zS(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?Lt.clone?.()??Lt:(r.bigInt!=null&&hr.set(r.bigInt.toString(),s),s.clone?.()??s)}function $o(){wt=Qh(G.xpLevel)}function sc(){G.xpLevel=Ot(),G.progress=Ot(),$o(),In(!0)}function Wh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function lc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function In(e=!1){let t=P?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=lc(G.xpLevel),o=n.bigInt,r=!n.finite,i=typeof G.xpLevel?.toStorage=="function"?G.xpLevel.toStorage():null;if(!e&&(r&&Un||!r&&o!=null&&!Un&&!Dn&&Fn!=null&&o===Fn||!r&&o==null&&Dn&&i&&$n&&i===$n))return;if(r){try{t.set(Lt)}catch{}Fn=null,Un=!0,Dn=!1,$n=null;return}let s;if(o!=null&&o<=Xf){let f=c.fromInt(1),d=Number(o);for(let h=0;h<d;h+=1)f=f.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(d)}typeof f.add=="function"?f=f.add(p):typeof p.add=="function"&&(f=p.add(f)),s=f.clone?.()??f}else s=Kh(G.xpLevel);let l=s.clone?.()??s,a=gr.size>0?Array.from(gr):typeof Yr=="function"?[Yr]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Fn=null,Un=!0,Dn=!1,$n=null):o!=null&&o<=Xf?(Fn=o,Un=!1,Dn=!1,$n=null):(Fn=null,Un=!1,Dn=!0,$n=i)}function Jt(e=!1){let t=b();if(t==null)return Ea=null,Uf=!1,G.unlocked=!1,sc(),G;if(!e&&Uf&&t===Ea)return G;Ea=t,Uf=!0;try{let n=localStorage.getItem(wa(t));G.unlocked=n==="1"}catch{G.unlocked=!1}try{G.xpLevel=c.fromAny(localStorage.getItem(Vr(t))??"0")}catch{G.xpLevel=Ot()}try{G.progress=c.fromAny(localStorage.getItem(zi(t))??"0")}catch{G.progress=Ot()}return(ln(G.xpLevel)||ln(G.progress))&&(G.unlocked=!0),G.unlocked?(jh(),$o(),In(!0),Zh(),G):(sc(),G)}function La(){let e=b();if(e==null)return;let t={unlocked:G.unlocked?"1":"0",level:G.xpLevel.toStorage(),progress:G.progress.toStorage()};try{localStorage.setItem(wa(e),t.unlocked)}catch{}try{localStorage.setItem(Vr(e),t.level)}catch{}try{localStorage.setItem(zi(e),t.progress)}catch{}let n=(()=>{let r=G.unlocked,i=G.xpLevel,s=G.progress;try{r=localStorage.getItem(wa(e))==="1"}catch{}try{let l=localStorage.getItem(Vr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(zi(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();it(wa(e),n.unlocked?"1":"0"),it(Vr(e),n.level?.toStorage?.()??t.level),it(zi(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==G.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(G.unlocked=n.unlocked,G.xpLevel=n.level,G.progress=n.progress,$o(),In(!0),Qn())}function jS(){In(!0);let e=Ca();if(typeof Hf=="function")try{let n=Hf({baseReward:e.clone?.()??e,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{P?.books?.addWithMultiplier?P.books.addWithMultiplier(e):P?.books?.add&&P.books.add(e)}catch{}let t=lc(G.xpLevel);t.finite?t.bigInt!=null?(Fn=t.bigInt,Un=!1,Dn=!1,$n=null):(Fn=null,Un=!1,Dn=!0,$n=typeof G.xpLevel?.toStorage=="function"?G.xpLevel.toStorage():null):(Fn=null,Un=!0,Dn=!1,$n=null)}function Qn(){if(!Jh())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=Sn;if(!e)return;if(!G.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=ne(wt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Gf(ne(wt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Wi();return}e.removeAttribute("hidden");let i=wt,s=KS(G.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=ne(G.xpLevel)),r){let a=ne(G.progress),u=ne(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Gf(ne(G.progress)),u=Gf(ne(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Wi()}function Ki({forceReload:e=!1}={}){return Jh(),Jt(e),$o(),Qn(),Zh(),et()}function Kr(){if(Jt(),G.unlocked)return Qn(),!1;sc(),G.unlocked=!0,La(),Qn(),In(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:et()}))}catch{}return!0}function ji({keepUnlock:e=!0}={}){Jt();let t=G.unlocked;return sc(),G.unlocked=e?t||G.unlocked:!1,La(),Qn(),In(!0),et()}function Zi(e,{silent:t=!1}={}){Jt();let n=Ea??b();if(n!=null&&Wh(zi(n)))return{unlocked:G.unlocked,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:G.xpLevel,progress:G.progress,requirement:wt,slot:n};if(!G.unlocked)return{unlocked:!1,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:G.xpLevel,requirement:wt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ot()}if(!o.isZero?.()){let d=yr.size>0?Array.from(yr):typeof zr=="function"?[zr]:[];for(let p of d)if(typeof p=="function")try{let h=p({baseGain:o.clone?.()??o,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});h instanceof c?o=h.clone?.()??h:h!=null&&(o=c.fromAny(h))}catch{}}if(o=Gn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return Qn(),{unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:G.xpLevel,requirement:wt};G.progress=G.progress.add(o),$o();let r=n!=null&&Wh(Vr(n)),i=ln(G.progress),s=ln(G.xpLevel),l=ln(o);if(i||s||l){let d=Lt.clone?.()??Lt;r||(G.xpLevel=d.clone?.()??d),G.progress=d.clone?.()??d,$o(),jh(),La(),Qn(),In(!0);let p={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o.clone?.()??o,xpLevel:G.xpLevel.clone?.()??G.xpLevel,progress:G.progress.clone?.()??G.progress,requirement:wt.clone?.()??wt,slot:n};if(xa(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Ot();if(G.progress.cmp(wt)<0){La(),Qn();let d={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:G.xpLevel,progress:G.progress,requirement:wt,slot:n};if(xa(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=ke(G.progress),p=.08118668602542883,h=ke(wt);if(d-h>2){let g=G.xpLevel,v=d-h,E=Math.floor(v/p);if(E>500){let C=BigInt(Math.max(0,E-5));if(C>0n){let A=c.fromAny(C.toString());if(G.xpLevel=G.xpLevel.add(A),a=a.add(A),$o(),P?.books?.add)try{let N=A.clone();P.books.add(N)}catch{}}}}let m=0,y=500;for(;G.progress.cmp?.(wt)>=0&&m<y&&(G.progress=G.progress.sub(wt),G.xpLevel=G.xpLevel.add(Ca()),a=a.add(Ca()),jS(),$o(),!ln(wt));)m+=1;m>=y&&G.progress.cmp(wt)>=0&&$o()}La(),Qn();let u=lc(G.xpLevel);u.finite?u.bigInt!=null?(Fn=u.bigInt,Un=!1,Dn=!1,$n=null):(Fn=null,Un=!1,Dn=!0,$n=typeof G.xpLevel?.toStorage=="function"?G.xpLevel.toStorage():null):(Fn=null,Un=!0,Dn=!1,$n=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:G.xpLevel.clone?.()??G.xpLevel,progress:G.progress.clone?.()??G.progress,requirement:wt.clone?.()??wt,slot:n};if(xa(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function et(){return Jt(),{unlocked:G.unlocked,xpLevel:G.xpLevel.clone?.()??G.xpLevel,progress:G.progress.clone?.()??G.progress,requirement:wt.clone?.()??wt}}function cc(e={}){Jt();let t=Ea??b(),n={...et(),slot:t,...e};if(xa(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function cn(){return Jt(),!!G.unlocked}function uc(e){return Qh(e)}function fc(){Jt();let e=Ca(),t=yr.size>0?Array.from(yr):typeof zr=="function"?[zr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function zf(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=lc(t),o=n.bigInt;if(!n.finite)return Lt.clone?.()??Lt;let i;if(o!=null&&o<=Xf){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=Kh(t);let s=i.clone?.()??i,l=gr.size>0?Array.from(gr):typeof Yr=="function"?[Yr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!G.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function eg(e){Yr=typeof e=="function"?e:null,gr.clear(),Yr&&gr.add(Yr),Jt(),In(!0)}function Qt(){Jt(),In(!0)}function tg(e){zr=typeof e=="function"?e:null,yr.clear(),zr&&yr.add(zr)}function qo(e){return typeof e!="function"?()=>{}:(gr.add(e),Jt(),In(!0),()=>{gr.delete(e),Jt(),In(!0)})}function vr(e){return typeof e!="function"?()=>{}:(yr.add(e),Jt(),()=>{yr.delete(e)})}function dc(e){Hf=typeof e=="function"?e:null}var Yf,wa,Vr,zi,Ea,Uf,wt,hr,Yi,Lt,Fn,Un,Dn,$n,Yr,zr,gr,yr,Hf,qh,H1,X1,Xf,Vh,qS,GS,Yh,G,_a,Sn,Wf,Hh,Vf,Df,qn=Fe(()=>{It();vt();Ji();Kt();Ff();Yf="ccc:xp",wa=e=>`${Yf}:unlocked:${e}`,Vr=e=>`${Yf}:level:${e}`,zi=e=>`${Yf}:progress:${e}`;Ea=null,Uf=!1,wt=c.fromInt(10),hr=new Map;hr.set("0",wt);Yi=0n,Lt=c.fromAny("Infinity"),Fn=null,Un=!1,Dn=!1,$n=null,Yr=null,zr=null,gr=new Set,yr=new Set,Hf=null,qh=5000n,H1=Math.log10(11/10),X1=Math.log10(5/2),Xf=200n,Vh="0.04139268515822507",qS="0.3979400086720376",GS="0.1",Yh=c.fromScientific(String(c.MAX_E));G={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};_a=new Set;Sn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};Wf=[],Hh=!1,Vf=null,Df=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Ki,unlockXpSystem:Kr,addXp:Zi,getXpState:et,broadcastXpChange:cc,isXpSystemUnlocked:cn,getXpRequirementForXpLevel:uc,getXpGainMultiplier:fc,setExternalCoinMultiplierProvider:eg,addExternalCoinMultiplierProvider:qo,refreshCoinMultiplierFromXpLevel:Qt,setExternalXpGainMultiplierProvider:tg,addExternalXpGainMultiplierProvider:vr,setExternalBookRewardProvider:dc,resetXpProgress:ji}))});var cg={};St(cg,{GHOST_TAP_TIMEOUT_MS:()=>ZS,clearGhostTapTarget:()=>Ma,consumeGhostTapGuard:()=>lg,initGlobalGhostTap:()=>aI,installGhostTapGuard:()=>sI,markGhostTapTarget:()=>ag,setGhostTapSelector:()=>lI,shouldSkipGhostTap:()=>eo,suppressNextGhostTap:()=>Io});function Ho(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Zf(){return typeof document>"u"?null:document}function eI(e){if(!Zf())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(jf)}function Ma(e){e&&(e[pc]=0)}function ag(e,t=0,n=null){if(!e)return;let o=Ho(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[pc]=o+r:e[pc]=0,QS=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&Io(i)}function lg(e){if(typeof window>"u")return!1;let t=window[Qi];return typeof t!="number"?!1:Ho()<=t?!0:(window[Qi]=null,!1)}function eo(e){if(!e)return!1;let t=Number(e[pc]||0);return!Number.isFinite(t)||t<=0?!1:Ho()<=t?(Ma(e),!0):(Ma(e),!1)}function Io(e=0){if(typeof window>"u")return;let t=Ho(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[Qi]=null;return}let o=t+n,r=typeof window[Qi]=="number"?window[Qi]:0;window[Qi]=Math.max(r,o)}function tI(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(hc=br=Ho(),Go=0))}function nI(e){hc=br=Ho(),Go=0}function oI(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Ho();br>0&&(Go=t-br),hc=t}function rI(){let e=Ho();br>0&&(Go=e-br),hc=e}function iI(e){if(!e.isTrusted)return;let t=Ho(),n=br>0?t-br:-1,o=eI(e.target);if(eo(o)){Go=0,e.preventDefault(),e.stopImmediatePropagation();return}if(lg(o)){o&&Ma(o),Go=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Go||n)>=sg){Ma(o),Go=0,e.preventDefault(),e.stopImmediatePropagation();return}Go=0}function sI(e={}){if(og)return;let t=Zf();!t||typeof window>"u"||(og=!0,Kf="PointerEvent"in window,rg=!Kf&&"ontouchstart"in window,e.selector&&(jf=`${e.selector}, ${mc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(sg=e.longPressMs),t.addEventListener("click",iI,!0),Kf?(t.addEventListener("pointerdown",tI,{capture:!0,passive:!1}),t.addEventListener("pointerup",oI,{capture:!0,passive:!0})):rg&&(t.addEventListener("touchstart",nI,{capture:!0,passive:!1}),t.addEventListener("touchend",rI,{capture:!0,passive:!0})))}function ig(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(mc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(ag(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function aI(){let e=Zf();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",ig,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",ig,{capture:!1,passive:!1})}function lI(e){e&&(jf=`${e}, ${mc}`)}var ZS,pc,Qi,mc,JS,og,jf,Kf,rg,QS,hc,br,Go,sg,es=Fe(()=>{ZS=0,pc=Symbol("ccc:ghostTap:skipUntil"),Qi="__cccGhostTapSkipUntil",mc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',JS=80,og=!1,jf=mc,Kf=!1,rg=!1,QS=null,hc=0,br=0,Go=0,sg=JS});var Jf,ug=Fe(()=>{Jf={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var fg={};St(fg,{RateAccumulator:()=>ka,pauseGameLoop:()=>od,registerFrame:()=>pI,registerTick:()=>wo,resumeGameLoop:()=>rd,startGameLoop:()=>fI,stopGameLoop:()=>dI});function td(e){e||(e=performance.now());let t=e;if(nd){jr=t,Jr=requestAnimationFrame(td);return}jr||(jr=t);let n=(t-jr)/1e3;jr=t,n>60&&(n=60),n<0&&(n=0),Zr+=n;let o=0,r=250;for(;Zr>=Aa;){if(o>=r){Zr=Zr%Aa;break}Qf.forEach(i=>{try{i(Aa)}catch(s){console.error("Error in game tick listener:",s)}}),Zr-=Aa,o++}if(ed.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),ts===0||ns===0)ts=Date.now(),ns=t;else{let i=t-ns;if(i>uI){let s=Date.now(),l=s-ts;l<-1e3?bn():l>i+1e4&&bn(),ts=s,ns=t}}Jr=requestAnimationFrame(td)}function od(){nd=!0}function rd(){nd=!1,jr=performance.now(),Zr=0,ts=0,ns=0}function fI(){Jr||(jr=performance.now(),Zr=0,ts=0,ns=0,Jr=requestAnimationFrame(td))}function dI(){Jr&&(cancelAnimationFrame(Jr),Jr=null)}function wo(e){return typeof e!="function"?()=>{}:(Qf.add(e),()=>{Qf.delete(e)})}function pI(e){return typeof e!="function"?()=>{}:(ed.add(e),()=>{ed.delete(e)})}var cI,Aa,Qf,ed,Jr,nd,jr,Zr,ts,ns,uI,ka,Qr=Fe(()=>{vt();cI=20,Aa=1/cI,Qf=new Set,ed=new Set,Jr=null,nd=!1,jr=0,Zr=0,ts=0,ns=0,uI=2e3;ka=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Aa;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ke,ei,Ta,Na,Ra,Oa,to,os,mI,dg,ti=Fe(()=>{It();Ke="automation",ei=1,Ta=2,Na=3,Ra=4,Oa=5,to=6,os={[Ta]:"coins",[Na]:"books",[Ra]:"gold",[Oa]:"magic"},mI=[{area:Ke,id:ei,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ke,id:Ta,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ke,id:Na,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ke,id:Ra,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ke,id:Oa,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ke,id:to,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],dg=mI.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var Sg={};St(Sg,{getGearsProductionRate:()=>Sc,getGenerationLevelKey:()=>ri,getGenerationUpgradeCost:()=>Sr,initWorkshopSystem:()=>bg,initWorkshopTab:()=>dd,performFreeGenerationUpgrade:()=>Ic,updateWorkshopTab:()=>no});function is(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*II}function ri(e){return`ccc:workshop:genLevel:${e}`}function Fa(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(ri(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function Da(e){let t=b();if(!t)return!1;let n=ri(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function $a(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return sd;if(t<=ni)return sd+t*mg;yc===null&&(yc=sd+ni*mg);let n=t-ni;if(t<=Pa)return yc+n+is(n,rs);if(vc===null){let d=Pa-ni;vc=yc+d+is(d,rs)}let o=t-Pa,r=t-ni,i=Pa-ni,s=o+(is(r,rs)-is(i,rs)),l=vI/yI,a=.5*l*o*o;if(t<=gc)return vc+s+a;if(ld===null){let d=gc-Pa,p=gc-ni,h=d+(is(p,rs)-is(i,rs)),m=.5*l*d*d;ld=vc+h+m}let u=bI*(t-gc);if(u>709)return 1/0;let f=ld*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function Sr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=$a(t);return Me(n)}function fd(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(ad);if(n.cmp(9e15)<=0){let s=Number(n.toString())*ad;t=Me(s)}else{let i=n.mulDecimal(ad);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Me(s)}catch{t=c.fromAny("Infinity")}}}let o=P?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function xI(){let e=Sr(tt);if(P.coins.value.cmp(e)<0)return;let t=tt.add(1);Da(t)&&(tt=t,P.coins.sub(e),no(),tn())}function LI(){if(!Dt())return;let n=fd(tt).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&P.gears&&P.gears.add(n),tt.cmp(20)<0){let r=Number(tt.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(oi+=a,oi>=1){let u=Math.floor(oi);oi-=u,P.gears&&P.gears.add(u)}}else oi=0}function ud(){P.gears&&P.gears.set(0),Da(c.zero())&&(tt=c.zero()),oi=0,no()}function gg(e){if(!e)return;let t=Ua.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),Ua.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;tt.cmp(id)>0?i=id:i=Number(tt.toPlainIntegerString());let s=Math.min(Math.floor(i),id),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,p=Math.cos(d)*hg,h=Math.sin(d)*hg,m=Math.random()*360,y=(Math.random()<.5?-1:1)*(wI+Math.random()*EI);l.push({x:u,y:f,dx:p,dy:h,rotation:m,rotationSpeed:y,size:a})}for(;l.length>s;)l.pop()}function _I(e){let t="Click the big red button below to open the Automation Shop";ze&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${hI}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${yg}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${gI}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{xI()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),MI()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{ls("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(en&&en.isConnected){let a=en.querySelector(".workshop-side-left"),u=en.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let p=Ua.get(d);if(p){let h=d.getBoundingClientRect(),m=window.devicePixelRatio||1;p.width=h.width,p.height=h.height;let y=Math.round(h.width*m),g=Math.round(h.height*m);if(p.canvas&&(p.canvas.width!==y||p.canvas.height!==g)&&(p.canvas.width=y,p.canvas.height=g,p.ctx.scale(m,m)),p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let v of p.gears)v.x=Math.random()*(p.width-v.size),v.x<0&&(v.x=0),v.y=Math.random()*(p.height-v.size),v.y<0&&(v.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?vg():CI()},{root:null,threshold:0}).observe(e),en=e}function no(){if(!en)return;let e=en.querySelector('[data-workshop="gears-amount"]'),t=en.querySelector('[data-workshop="gears-rate"]'),n=en.querySelector('[data-workshop="upgrade-cost"]'),o=en.querySelector('[data-workshop="upgrade-gen"]'),r=fd(tt),i=Sr(tt);if(e&&(e.innerHTML=P.gears.fmt(P.gears.value)),t&&(t.innerHTML=ne(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${ne(i)} ${l}`}if(o){let l=P.coins.value.cmp(i)>=0;o.disabled=!l;let a=Mt(Ke,to),u=!1;if(a>0){let f=b(),d=f!=null?`:${f}`:"",p=`ccc:autobuy:${Ke}:${to}${d}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(tt.isInfinite()?s="Infinity":s=tt.floorToInteger().toStorage(),s!==cd){cd=s;let l=en.querySelector(".workshop-side-left"),a=en.querySelector(".workshop-side-right");l&&gg(l),a&&gg(a)}}function CI(){ss&&(cancelAnimationFrame(ss),ss=null)}function vg(){if(ss)return;Ba=0;let e=t=>{if(en&&en.isConnected){let n=en.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=P.gears.fmt(P.gears.value)),Ba||(Ba=t);let o=(t-Ba)/1e3;Ba=t,o>.1&&(o=.1);for(let[r,i]of Ua){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!bc.complete||bc.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,p=f.y+f.size/2;u.save(),u.translate(d,p),u.rotate(f.rotation*Math.PI/180),u.drawImage(bc,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}ss=requestAnimationFrame(e)};ss=requestAnimationFrame(e)}function bg(){pg||(pg=!0,tt=Fa(),wo(LI),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{tt=Fa(),oi=0,Dt()||ud(),no()}),window.addEventListener("currency:change",e=>{e.detail.key===Ce.COINS&&no()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Ce.GEARS&&no()}),window.addEventListener("debug:change",()=>{tt=Fa(),no()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Dt()||ud())})))}function dd(e){bg(),!e.__workshopInit&&(e.__workshopInit=!0,tt=Fa(),Ua.clear(),cd=-1,_I(e),typeof IntersectionObserver>"u"&&vg(),Dt()||ud(),no())}function Sc(){let e=Fa();return fd(e)}function Ic(){let e=P.coins.value.isInfinite(),n=Sr(tt).isInfinite();if(e&&n&&!tt.isInfinite())return tt=c.fromAny("Infinity"),Da(tt),no(),!0;if(P.coins.value.isZero())return!1;let o=ke(P.coins.value);if(!Number.isFinite(o))if(P.coins.value.inf)o=1/0;else return!1;if($a(tt)>o||tt.cmp(9e15)>0)return!1;let r=Number(tt.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);$a(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(tt)>0&&Da(a)?(tt=a,no(),!0):!1}function MI(){if(P.coins.value.isInfinite()){Ic()&&tn();return}let e=ke(P.coins.value);if(!Number.isFinite(e)&&P.coins.value.isZero()||$a(tt)>e||tt.cmp(9e15)>0)return;let t=Number(tt.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);$a(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(tt.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(Sr(c.fromInt(u)));if(l.cmp(P.coins.value)>0){let u=Sr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(tt)>0&&Da(a)&&(tt=a,P.coins.sub(l),no(),tn())}var yg,hI,bc,gI,id,en,pg,oi,tt,cd,ss,sd,ad,ni,Pa,gc,mg,rs,yI,vI,bI,SI,II,yc,vc,ld,Ua,hg,wI,EI,Ba,as=Fe(()=>{It();Kt();vt();Qr();ii();Eo();oo();ro();ti();yg="img/currencies/gear/gear.webp",hI="img/currencies/gear/gear_plus_base.webp",bc=new Image;bc.src=yg;gI="img/currencies/coin/coin.webp",id=300,en=null,pg=!1,oi=0,tt=c.zero(),cd=-1,ss=null,sd=12,ad=.3010299956639812,ni=1e6,Pa=1e9,gc=1e12,mg=1,rs=.001,yI=1e3,vI=Math.log10(1.00001),bI=23e-11,SI=Math.log(10),II=1/SI;yc=null,vc=null,ld=null;Ua=new Map,hg=67,wI=67,EI=67;Ba=0});function wg(e){typeof e=="function"&&Ig.push(e)}function pd(){qa=null}function Ec(){qa=null;try{wc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{Qt()}catch{}}function Eg(e){return typeof e=="function"&&wc.push(e),()=>{wc=wc.filter(t=>t!==e)}}function kI(e){let t=ut(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Me(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function TI(){try{return!!cn()}catch{return!1}}function Ga(e){let t=P?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(TI())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=Mt(Se.STARTER_COVE,Ee.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=kI(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function cs(e=Se.STARTER_COVE){if(qa)return qa;let t=Pt(e),n=[];if(e===Se.STARTER_COVE&&Se.DNA){let i=Pt(Se.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=wn(s,i.id),a=De(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:p,mpMult:h}=Wo(i,l,s);r.xpValue=Et(r.xpValue,d),r.coinValue=Et(r.coinValue,p),r.mpValue=Et(r.mpValue,h),u=Et(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=Et(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=Et(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=Et(r.mpValue,u);else if(i.effectType==="book_value")r.bookValue=Et(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of Ig)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return qa=r,r}function us(e){let t=cs(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:AI*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue}}function xc(){try{let{mpValue:e}=cs(Se.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Lc(){try{let{magnetRadius:e}=cs(Se.STARTER_COVE);return e||0}catch{return 0}}function xg(){try{Xo()}catch{}try{qo(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=cs(Se.STARTER_COVE);return Et(n,o)})}catch{}try{vr(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=cs(Se.STARTER_COVE);return Et(n,o)})}catch{}try{si(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=cs(Se.STARTER_COVE);return Et(n,o)})}catch{}Ga(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{Ga()}catch{}try{Qt()}catch{}})}var AI,qa,wc,Ig,md=Fe(()=>{It();vt();Eo();qn();xo();oo();AI=1,qa=null,wc=[],Ig=[]});var Ag={};St(Ag,{addExternalEacAmountMultiplierProvider:()=>yd,addExternalEacMultiplierProvider:()=>NI,getAutobuyerToggle:()=>ai,getEacAmountMultiplier:()=>Mc,initAutomationEffects:()=>FI,setAutobuyerToggle:()=>Ir,setTsunamiBonusProvider:()=>gd,updateAutomation:()=>Mg});function gd(e){Lg=e}function NI(e){typeof e=="function"&&_g.push(e)}function yd(e){typeof e=="function"&&Cg.push(e)}function Mc(){let e=1;if(ft(2))if(ft(8)){let t=En(),n=Lg(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of Cg)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function vd(e){Cc!==e&&(fs.clear(),Cc=e)}function ai(e,t){let n=b();vd(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(fs.has(r))return fs.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return fs.set(r,i),i}function Ir(e,t,n){let o=b();vd(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);fs.set(i,s);try{localStorage.setItem(i,s)}catch{}}function RI(e){Mg(e),BI(e)}function OI(){if(_c)return _c;let e=Pt(Se.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return _c=t,_c}function PI(e){if(!(!e||e.length===0)){for(let t of e)if(ai(Se.STARTER_COVE,t.id)!=="0"){let o=Mt(Se.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&Sd(Se.STARTER_COVE,t.id)}}}function BI(e){let t=b();vd(t);let n=OI();for(let[r,i]of Object.entries(os)){let s=Number(r);Mt(Ke,s)>0&&n[i]&&PI(n[i])}Mt(Ke,to)>0&&(hd++,hd>=5&&(hd=0,ai(Ke,to)!=="0"&&Ic()))}function Mg(e){let n=Mt(Ke,ei);for(let r of _g)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){Ha=0;return}Ha+=e;let o=1/n;if(Ha>=o){let r=Math.floor(Ha/o);if(r>0){let i=r;i*=Mc(),bd(i),Ha-=r*o}}}function FI(){wo(RI),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Cc&&(fs.clear(),Cc=t)})}var Ha,hd,Lg,_g,Cg,fs,Cc,_c,ds=Fe(()=>{Qr();oo();Xa();ti();as();vt();io();Ha=0,hd=0,Lg=()=>0;_g=[];Cg=[];fs=new Map,Cc=null;_c=null});function Id(){let e=b();if(Pg=e,e==null){Wa=!1;return}try{Wa=localStorage.getItem(UI(e))==="1"}catch{Wa=!1}}function Vo(e){return ps.nodes[e]||(ps.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),ps.nodes[e]}function DI(e,t){let n=Vo(t);try{let o=localStorage.getItem(Va(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(Ya(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(Rg(e,t));n.active=i==="1";let s=localStorage.getItem(Og(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function kg(){Id();let e=b();ps.nodes={},Hn=null,e!=null&&Ft.forEach(t=>{DI(e,t.id),ps.nodes[t.id].active&&(Hn=t.id)})}function Tg(){let e=b();e!=null&&Ft.forEach(t=>{let n=ps.nodes[t.id];if(n)try{localStorage.setItem(Ya(e,t.id),n.rp.toStorage())}catch{}})}function mt(e){return Vo(e).level}function wr(e,t){let n=b();if(n==null||Vt(Va(n,e)))return!1;let o=Vo(e);o.level=t;try{localStorage.setItem(Va(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function ao(e){return Vo(e).rp}function ms(e,t){let n=b();if(n!=null&&Vt(Ya(n,e)))return;let o=Vo(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function li(e){return Vo(e).active}function za(e,t){let n=b();if(n==null)return;let o=!!t;o?(Hn!==null&&Hn!==e&&za(Hn,!1),Hn=e):Hn===e&&(Hn=null);let r=Vo(e);if(r.active!==o){r.active=o;try{localStorage.setItem(Rg(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function Ng(e,t){let n=b();if(n==null)return;let o=Vo(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(Og(n,e),o.discovered?"1":"0")}catch{}}}function Er(e){let t=so.get(e);if(!t)return!1;if(Vo(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return Ng(e,!0),!0;if((e===5||e===6)&&((Pg!==b()||Wa===null)&&Id(),!Wa))return!1;for(let o of t.parentIds){let r=so.get(o);if(!r)continue;if(mt(o)<r.maxLevel)return!1}return Ng(e,!0),!0}function Ac(e){let t=so.get(e);if(!t)return c.fromAny("Infinity");let n=mt(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function Lo(){let e=0,t=mt(1);t>0&&(e+=t*.01);let n=mt(10);return n>0&&(e+=n*.01),e}function Bg(){return mt(4)>=1}function Fg(e=[]){if(b()!=null){try{ui(0)}catch{}Hn!==null&&za(Hn,!1),Ft.forEach(n=>{e.includes(n.id)||(wr(n.id,0),ms(n.id,c.fromInt(0)))})}}function Ug(e){let t=hs();if(t.isZero?.()||Hn===null)return;let n=so.get(Hn);if(!n||!Er(n.id))return;let r=t.mulDecimal(e.toString(),18),i=ao(n.id);if(mt(n.id)>=n.maxLevel)return;let s=i.add(r);for(;;){let l=Ac(n.id);if(s.cmp(l)<0||mt(n.id)>=n.maxLevel)break;s=s.sub(l);let a=mt(n.id);if(!wr(n.id,a+1))break}ms(n.id,s)}function Dg(){let e=so.get(2);if(!e)return c.fromInt(1);let t=mt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function $g(){let e=so.get(3);if(!e)return c.fromInt(1);let t=mt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function wd(){let e=so.get(5);if(!e)return c.fromInt(1);let t=mt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function Ed(){let e=so.get(6);if(!e)return c.fromInt(1);let t=mt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function $I(){let e=so.get(7);if(!e)return c.fromInt(1);let t=mt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.1,t);return c.fromAny(n)}function qg(){let e=so.get(8);return e?1+mt(e.id)*.1:1}function Gg(){let e=so.get(9);return e?1+mt(e.id)*.1:1}function Hg(){qo(({baseMultiplier:e})=>{let t=Dg();return e.mulDecimal(t.toScientific())}),vr(({baseGain:e})=>{let t=$g();return e.mulDecimal(t.toScientific())}),wg(()=>qg()),yd(()=>Gg()),gd(()=>Lo()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&Qt(),e&&e.id===8&&Ec()})}var Va,Ya,Rg,Og,UI,Ft,so,Wa,Pg,ps,Hn,ci=Fe(()=>{It();vt();fi();Kt();qn();md();ds();Va=(e,t)=>`ccc:lab:node:level:${t}:${e}`,Ya=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,Rg=(e,t)=>`ccc:lab:node:active:${t}:${e}`,Og=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,UI=e=>`ccc:reset:experiment:completed:${e}`,Ft=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${We(Dg())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${We($g())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${We(wd())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${We(Ed())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e9,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${We($I())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e12,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${We(qg())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e12,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${We(Gg())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:"Increases the Tsunami exponent by +0.01 per level",baseRpReq:1e15,scale:2,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami exponent bonus: +${(e*.01).toFixed(2)}`}],so=new Map(Ft.map(e=>[e.id,e])),Wa=null,Pg=null,ps={nodes:{}},Hn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",kg),setInterval(Tg,1e3),window.addEventListener("beforeunload",Tg),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&Id()}),kg());window.RESEARCH_NODES=Ft;window.isResearchNodeVisible=Er});var Kg={};St(Kg,{getBookProductionRate:()=>Lr,getEffectiveTsunamiNerf:()=>pi,getSurge6WealthMultipliers:()=>kc,getTsunamiNerf:()=>En,getTsunamiNerfKey:()=>Ld,getTsunamiSequenceSeen:()=>un,initSurgeEffects:()=>HI,isSurgeActive:()=>ft,setTsunamiNerf:()=>di,setTsunamiSequenceSeen:()=>zo});function Ld(e){return xd(e)}function un(){let e=b();if(e==null)return!1;try{return localStorage.getItem(zg(e))==="1"}catch{return!1}}function zo(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(zg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function En(){return xr}function pi(){let t=En()+Lo();return t>1&&(t=1),t}function di(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=xd(n);if(Vt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}xr=t,gs();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function ft(e){return lo===1/0||typeof lo=="string"&&lo==="Infinity"||lo===Number.POSITIVE_INFINITY?!0:typeof lo=="bigint"?lo>=BigInt(e):typeof lo=="number"?lo>=e:!1}function Ka(e){if(!ft(8))return e;let t=ke(e);if(!Number.isFinite(t))return e;let n=pi();return Me(t*n)}function gs(){let e=co();lo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(ft(8)){let n=pi(),o=Math.log10(Xg);Yo=Me(o*n)}else Yo=c.fromInt(Xg);else Yo=c.fromInt(1)}function kc(){if(!ft(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,h=0)=>{if(!p){if(h<=0)return c.fromInt(1);let C=Math.log10(h)/3;if(C<=0)return c.fromInt(1);let A=C*Math.log10(2);return Me(A)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=ke(p),y=m;if(Number.isFinite(m)){if(m<15&&h>0)try{let E=Number(p.toPlainIntegerString());if(Number.isFinite(E)){let C=E+h;C>0&&(y=Math.log10(C))}}catch{}}else if(h>0)y=Math.log10(h);else return c.fromInt(1);let g=y/6;if(g<=0)return c.fromInt(1);let v=g*Math.log10(2);return Me(v)},t=e(P.coins?.value),n=P.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(P.gold?.value),s=e(P.magic?.value),l=t,a=r,u=i,f=s;ft(8)&&(l=Ka(t),a=Ka(r),u=Ka(i),f=Ka(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function Lr(){if(!ft(3))return c.fromInt(0);let t=et().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(Wg),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Me(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*Wg;n=Me(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),P.books?.mult){let o=P.books.mult.get();n=n.mulBigNumInteger(o)}return ft(8)&&(n=Ka(n)),n}function qI(e){if(!ft(3))return;Vg||(Vg=new ka("books",P));let t=Lr();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);P.books&&P.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,P.books&&P.books.add(c.fromInt(o))}}}function Yg(e){if(e==null)return;let t=localStorage.getItem(xd(e));t!==null?(xr=Number(t),(Number.isNaN(xr)||!Number.isFinite(xr))&&(xr=ft(8)?0:1)):ft(8)?xr=0:xr=1}function GI(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function HI(){let e=b();gs(),Yg(e),gs(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=lo,n=ft(8);gs();let o=lo,r=ft(8);!n&&r?(di(0),un()||zo(!0)):r?GI(t,o)>0&&(di(0),un()||zo(!0)):n&&!r&&di(1)}),window.addEventListener("lab:node:change",()=>{gs()}),window.addEventListener("saveSlot:change",()=>{Yg(b()),gs()})),qo(({baseMultiplier:t})=>Yo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Yo)),vr(({baseGain:t})=>Yo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Yo)),si(({baseGain:t})=>Yo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Yo)),si(({baseGain:t})=>{if(!ft(4))return t;let n=c.fromInt(4444e9);if(ft(8)){let o=pi(),r=Math.log10(4444e9);n=Me(r*o)}return t.mulBigNumInteger(n)}),qo(({baseMultiplier:t})=>{if(!ft(6))return t;let n=kc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),dc(({baseReward:t})=>ft(3)?c.fromInt(0):t),wo(qI)}var Xg,Wg,xd,zg,Yo,lo,Vg,xr,io=Fe(()=>{It();vt();qn();xo();Eo();Qr();It();ci();Xg=10,Wg=.08685889638,xd=e=>`ccc:surge:tsunamiNerf:${e}`,zg=e=>`ccc:unlock:tsunami:${e}`;Yo=c.fromInt(1),lo=0n,Vg=null,xr=0});var ey={};St(ey,{getLabCost:()=>Jg,getLabLevel:()=>Yt,getLabLevelFromCoins:()=>Qg,getLabLevelKey:()=>Cd,getRpMult:()=>hs,getRpMultBase:()=>Rc,hasVisitedLab:()=>Ss,initLabLogic:()=>XI,initLabTab:()=>kd,setLabLevel:()=>ui,setLabVisited:()=>Zg,updateLabLevel:()=>Md,updateLabTab:()=>Td});function Za(){let e=b();if(Ja=e,e==null){Ko=c.fromInt(0),mi=!1;return}try{let t=localStorage.getItem(Nc(e));t?Ko=c.fromAny(t):Ko=c.fromInt(0)}catch{Ko=c.fromInt(0)}try{mi=localStorage.getItem(jg(e))==="1"}catch{mi=!1}}function Ss(){let e=b();return e==null?!1:((Ja!==e||mi===null)&&Za(),mi)}function Zg(e){let t=b();if(t==null)return;let n=!!e;if(!(mi===n&&Ja===t)){mi=n;try{localStorage.setItem(jg(t),n?"1":"0")}catch{}}}function Yt(){let e=b();return e==null?c.fromInt(0):P.coins.value.isInfinite()?c.fromAny("Infinity"):((Ja!==e||Ko===null)&&Za(),Ko)}function ui(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((Ja!==t||Ko===null)&&Za(),n.cmp(Ko)===0)return;Ko=n,localStorage.setItem(Nc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function Jg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Qg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Md(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Nc(e)))return;let t=P.coins.value,n=Yt();if(t.isInfinite()){n.isInfinite()||ui(c.fromAny("Infinity"));return}let o=Qg(t);o.cmp(n)>0&&ui(o)}function XI(){Za(),typeof window<"u"&&window.addEventListener("saveSlot:change",Za),wo(Md),wo(Ug),Hg()}function Ad(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function WI(e){if(!e||typeof e!="object")return 0;if(Ad(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function YI(e){if(Ad(e)||typeof e.cmp=="function"&&e.cmp(VI)>=0)return bs.clone?.()??bs;let t=e.floorToInteger(),n=e.sub(t),o=WI(n);if(!Number.isFinite(o))return bs.clone?.()??bs;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return bs.clone?.()??bs;let d=BigInt(u)+l-BigInt(i),h=d%BigInt(250),m=Number(h),y=d-h;return new c(a,{base:m,offset:y})}function Rc(){let e=Yt();if(Ad(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return YI(n)}function hs(){let e=Rc();return typeof Gn=="function"?Gn("rp",e):e}function kd(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",ja&&ja.destroy(),ja=new _d(e))}function Td(){Zg(!0),ja&&ja.resize()}var _r,ys,vs,jg,Nc,Ko,mi,Ja,Cd,bs,VI,ja,Tc,_d,fi=Fe(()=>{vt();ro();It();Kt();io();Qr();Ji();ci();ii();oo();_r=1e308,ys=1e300,vs=1e-300,jg=e=>`ccc:lab:visited:${e}`,Nc=e=>`ccc:lab:level:${e}`,Ko=null,mi=null,Ja=null;Cd=e=>Nc(e);bs=c.fromAny("Infinity"),VI=c.fromScientific(String(c.MAX_E));ja=null;Tc=512*.95,_d=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${ne(Yt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Md()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=ze?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>_r&&(this.camX=_r),this.camX<-_r&&(this.camX=-_r),this.camY>_r&&(this.camY=_r),this.camY<-_r&&(this.camY=-_r),this.zoom>ys&&(this.zoom=ys),this.zoom<vs&&(this.zoom=vs)}update(t){this.checkBounds();let n=Yt(),o=Jg(n.add(1)),r=En(),i=Lo(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${ne(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${ne(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let p=this.bursts[d];p.time+=t;for(let h of p.particles)h.x+=h.vx*t,h.y+=h.vy*t,h.vx*=.95,h.vy*=.95;p.time>=p.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),p=(L,B)=>{if(B<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*B})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/L)*L,x=Math.ceil((this.camX+n/2/r)/L)*L;if((x-M)/L>1e3)return;for(let se=M;se<=x&&!(se+L<=se);se+=L){let K=(se-this.camX)*r+n/2;t.moveTo(K,0),t.lineTo(K,o)}let X=Math.floor((this.camY-o/2/r)/L)*L,J=Math.ceil((this.camY+o/2/r)/L)*L;for(let se=X;se<=J&&!(se+L<=se);se+=L){let K=(se-this.camY)*r+o/2;t.moveTo(0,K),t.lineTo(n,K)}t.stroke()},h=d*r,m=Math.max(0,Math.min(1,(h-15)/25));p(d,m),p(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let y=(0-this.camY)*r+o/2;y>=-10&&y<=o+10&&(t.moveTo(0,y),t.lineTo(n,y));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let v=[],E=new Map;for(let L of Ft)Er(L.id)&&(v.push(L),E.set(L.id,this.getNodePosition(L)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let L of v)if(L.parentIds&&L.parentIds.length>0)for(let B of L.parentIds){let M=Ft.find(x=>x.id===B);if(M&&E.has(M.id)){let x=E.get(M.id),X=E.get(L.id),J=(x.x-this.camX)*r+n/2,se=(x.y-this.camY)*r+o/2,K=(X.x-this.camX)*r+n/2,Q=(X.y-this.camY)*r+o/2;t.moveTo(J,se),t.lineTo(K,Q)}}t.stroke();let C=Tc,A=C*r,H=C*1.6*r;for(let L of v){let B=E.get(L.id),M=(B.x-this.camX)*r+n/2,x=(B.y-this.camY)*r+o/2,X=mt(L.id),J=X>=L.maxLevel,se=!0;if(M+H/2<0||M-H/2>n||x+H*.8<0||x-H/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,M-H/2,x-H/2,H,H),J?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,M-H/2,x-H/2,H,H):li(L.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,M-H/2,x-H/2,H,H);let Q=this.nodeImages[L.id];if(Q||(Q=new Image,Q.src="img/"+L.icon,this.nodeImages[L.id]=Q),Q.complete&&Q.naturalWidth!==0&&t.drawImage(Q,M-A/2,x-A/2,A,A),se){let ve=Ac(L.id),he=0;if(J)he=1;else if(ve.isInfinite?.()||typeof ve.cmp=="function"&&ve.cmp(c.fromAny("Infinity"))===0)he=0;else{let Y=ao(L.id);if(Y.isZero?.())he=0;else try{if(ve.isZero?.())he=1;else{let me=Y.div(ve).toScientific(5);he=Number(me)}}catch{he=0}}he=Math.max(0,Math.min(1,he));let W=H*.96,ee=H*.18,$=M-W/2,U=x+H/2+H*.05;t.fillStyle="#111",t.fillRect($,U,W,ee);let j=t.createLinearGradient($,U,$,U+ee);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,U,W*he,ee),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,U,W,ee),t.fillStyle="#fff",t.font=`bold ${ee*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,ee*.08);let ie=`Level ${X}`;J&&(ie=L.maxLevel===1?"UNLOCKED":"MAXED");let ae=t.measureText(ie),_=U+ee/2+(ae.actualBoundingBoxAscent-ae.actualBoundingBoxDescent)/2;t.strokeText(ie,$+W/2,_),t.fillText(ie,$+W/2,_)}}let F=35,q=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let L of this.bursts){let B=(L.x-this.camX)*this.zoom+n/2,M=(L.y-this.camY)*this.zoom+o/2;for(let x=0;x<q.length;x++){let X=q[x],J=L.time-X.delay;if(J>0&&J<X.dur){let se=J/X.dur,K=1-Math.pow(1-se,3),Q=F*K,ve=Math.max(0,1-Math.pow(se,2)),he=1+x*.5,W=t.createRadialGradient(B,M,Q*.6,B,M,Q);W.addColorStop(0,"rgba(255, 200, 50, 0)"),W.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,ve*.15*he)})`),W.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,ve*.2*he)})`),W.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=W,t.beginPath(),t.arc(B,M,Q,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let x of L.particles)if(L.time<x.life){let X=1-L.time/x.life,J=B+x.x,se=M+x.y;t.fillStyle=`rgba(255, 255, 150, ${X})`,t.beginPath(),t.arc(J,se,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Tc/2*1.6;for(let u of Ft){if(!Er(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,p=l-f.y;if(Math.sqrt(d*d+p*p)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Ft.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.textContent=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=li(t);za(t,!p),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Nd(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Ft.find(l=>l.id===this.activeOverlayId);if(!t||!Er(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=mt(t.id),o=ao(t.id),r=Ac(t.id),i=li(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.textContent=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?ne(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?ne(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${ne(o)} / ${ne(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Tc/2*1.6;for(let u of Ft){if(!Er(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,p=l-f.y;if(Math.sqrt(d*d+p*p)<=a){if(mt(u.id)>=u.maxLevel)return;let y=li(u.id);za(u.id,!y),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=Tc/2*1.6;for(let u of Ft){if(!Er(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,p=s-f.y;if(Math.sqrt(d*d+p*p)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<vs&&(i=vs),i>ys&&(i=ys);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<vs&&(i=vs),i>ys&&(i=ys);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var oy={};St(oy,{calculateOfflineRewards:()=>Is,calculatePreAutomationRewards:()=>Pc,formatTimeCompact:()=>Oc,grantOfflineRewards:()=>hi,initOfflineTracker:()=>jI,processOfflineProgress:()=>ny,showOfflinePanel:()=>Cr});function Oc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),v=g.mulBigNumInteger(l),E=t.sub(v),C=0;try{let A=E.div(c.fromInt(i)).floorToInteger();C=Number(A.toPlainIntegerString())}catch{C=0}return C===0?`${ne(g)}y`:`${ne(g)}y ${C}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let p=Math.floor(f/60),h=f%60;if(p<24)return h===0?`${p}h`:`${p}h ${h}m`;let m=Math.floor(p/24),y=p%24;return y===0?`${m}d`:`${m}d ${y}h`}function Cr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${Oc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",zI.forEach(m=>{let y=m.key,g=e[y];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(y==="research_levels"){Array.isArray(g)&&g.forEach(F=>{let q=document.createElement("div");q.className="offline-row";let L=document.createElement("span");L.className="offline-plus",L.style.color="#004F96",L.textContent="+";let B=document.createElement("img");B.className="offline-icon",B.src=m.icon,B.alt="RP";let M=document.createElement("span");M.className="offline-text",M.style.color="#004F96";let x=c.fromInt(F.levels),X=x.cmp(c.fromInt(1))===0?"Level":"Levels";M.textContent=`${ne(x)} ${X} of ${F.name}`,q.appendChild(L),q.appendChild(B),q.appendChild(M),f.appendChild(q)});return}let v=document.createElement("div");v.className="offline-row";let E=document.createElement("span");E.className="offline-plus",E.classList.add(`text-${y}`),E.textContent="+";let C=document.createElement("img");C.className="offline-icon",C.src=m.icon,C.alt=y;let A=document.createElement("span");A.className="offline-text",A.classList.add(`text-${y}`);let N=!1;g instanceof c?N=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:N=Number(g)===1;let H=N?m.singular:m.plural;A.innerHTML=`${ne(g)} ${H}`,v.appendChild(E),v.appendChild(C),v.appendChild(A),f.appendChild(v)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let h=()=>{r.remove()};return p.addEventListener("click",h),r.addEventListener("click",m=>{m.target===r&&h()}),d.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{ws(i,a,".offline-scroll-container")}),r}function KI(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function Is(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=hs?hs():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Ft.filter(h=>li(h.id)),d=[],p={};for(let h of f){let m=mt(h.id),y=ao(h.id).add(u),g=0,v=h.maxLevel;for(;m<v;){let E=KI(h,m);if(E.isInfinite&&E.isInfinite()||y.cmp(E)<0)break;y=y.sub(E),m++,g++}g>0&&d.push({name:h.title,levels:g}),p[h.id]={level:m,rp:y}}d.length>0&&(o.research_levels=d),Object.keys(p).length>0&&(o.research_progress=p)}let s=(Sc?Sc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||Bn("gears",t)||(o.gears=s);let l=Lr?Lr():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||Bn("books",t)||(o.books=u)}let a=Mt(Ke,ei)||0;if(a>0){let u=1;ft(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=Fc(),p=d.coins.mulBigNumInteger(f),h=d.xp.mulBigNumInteger(f),m=d.mp.mulBigNumInteger(f);p.isZero()||Bn("coins",t)||(o.coins=p),h.isZero()||Vt(`ccc:xp:progress:${t}`)||(o.xp=h),m.isZero()||Vt(`ccc:mutation:progress:${t}`)||(o.mp=m)}}return o}function hi(e){if(b()!=null){if(e.xp)try{let n=Zi(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Es(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(wr(r,o.level),ms(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||P[n]&&typeof P[n].add=="function"&&P[n].add(e[n])}}function Pc(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=Xn(),i=c.fromInt(1);try{let l=us(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Gn=="function"){let l=Gn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=Fc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||Vt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||Vt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function ny(){let e=b();if(e==null)return;let t=Mf(),n=Date.now();if(t<=0)return;if(n<t-1e4){bn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Dt()){let l=Pc(r),a=Object.keys(l).length>0;return a&&(hi(l),Cr(l,o,!0)),a}let i=Is(r),s=Object.keys(i).length>0;return s&&(hi(i),Cr(i,o)),s}function jI(e,t){ty||(ty=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?od():(rd(),ny()&&typeof t=="function"&&t())))}))}var ty,zI,Bc=Fe(()=>{vt();as();Eo();Qr();vt();It();Kt();ii();ro();oo();fi();ci();ti();Xa();qn();xo();io();Ji();ty=!1;zI=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Cr});function Pd(e){let t=24,n=Date.now();try{let o=localStorage.getItem(Rd(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Od(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(Rd(e),"24"),localStorage.setItem(Od(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function iy(e,t,n){try{localStorage.setItem(Rd(e),String(t)),localStorage.setItem(Od(e),String(n))}catch{}}function sy(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=Pd(e);if(t>=xs)return;let o=Date.now(),r=o-n;if(r>=Uc){let i=Math.floor(r/Uc);t+=i,t>=xs?(t=xs,n=o):n+=i*Uc,iy(e,t,n),Mr&&Mr.classList.contains("is-active")&&jo(!0)}}function JI(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function QI(){let e=b();if(e==null)return;sy();let{charges:t,lastCharge:n}=Pd(e);t<=0||(t>=xs&&(n=Date.now()-50),t--,iy(e,t,n),jo(!0),Qa&&clearInterval(Qa),Qa=setInterval(()=>{jo()},1e3),ct(ZI,{volume:.5}),JI(),setTimeout(()=>{let o=Is(ry);hi(o),Cr(o,ry*1e3)},7250))}function jo(e=!1){if(!Mr||!Mr.classList.contains("is-active"))return;let t=b();if(t==null)return;e||sy();let{charges:n,lastCharge:o}=Pd(t),r=Mr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${xs}</span>`);let i=Mr.querySelector(".warp-timer");if(i)if(n>=xs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+Uc,u=Math.max(0,a-l);i.textContent=`Next warp in ${Oc(u)}`}let s=Mr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function ay(e){if(!e||e.__warpInit)return;e.__warpInit=!0,Mr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",QI),Qa||(Qa=setInterval(()=>{jo()},1e3)),jo()}var Rd,Od,xs,Uc,ry,ZI,Mr,Qa,Bd=Fe(()=>{vt();Bc();Pn();Rd=e=>`ccc:warp:charges:${e}`,Od=e=>`ccc:warp:lastCharge:${e}`,xs=24,Uc=3600*1e3,ry=150,ZI="sounds/warp.ogg",Mr=null,Qa=null});function yy(){try{return localStorage.getItem(kr(Wd))==="1"}catch{return!1}}function Yd(){try{return localStorage.getItem(kr(vy))==="1"}catch{return!1}}function Gc(e){let t=b();if(t==null)return;let n=`${vy}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),ew()}catch{}}function Hc(){return Yd()?"Jeff":"Merchant"}function ew(){let e=Hc();Ye&&Ye.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function el(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&eo(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(v=>console.error(v)),n&&y()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,Io(160)))},f=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},d=()=>{r&&l()},p=g=>{r=!0,Io(160)},h=g=>{r&&l()},m=()=>{r&&l()},y=()=>{e.removeEventListener("click",a),by?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):iw&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",h),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function Dc(e){return ow[e]??0}function ly(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function sw(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function nl(e,t){let n=gi.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;_s.set(e,r),n.unlocked=r;let i=xn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&xn.buttons[e]?.classList.contains("is-active")&&Vc("dialogue")}function Fd(){let e=!1;try{e=!!As?.()}catch{}nl("reset",e)}function Ud(){let e=!1;try{e=!!Dt?.()}catch{}nl("workshop",e)}function dy(){let e=!1;try{typeof _o=="function"&&(e=_o())}catch{}nl("warp",e)}function aw(){let e=b();if(e==null)return!1;try{return typeof un=="function"&&un()?!0:localStorage.getItem(Sy(e))==="1"}catch{return!1}}function Gd(){nl("lab",aw())}function lw(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function cw(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof cn=="function"&&cn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof et=="function"?et():null;t&&typeof t=="object"&&(e.xpLevel=lw(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Nr=="function"&&Nr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Dt=="function"&&Dt()}catch{e.hasInfuseReset=!1}return e}function uw(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?$d:qd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?$d:qd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?zd:""),i.icon=o?.icon??(r==="mysterious"?Ar:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Zo:nw),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function fw(){if(cy)return;cy=!0;let e=dw;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${rw}:${t}`;Ct(n,{onChange:e})}}function dw(){Jo()}function pw(e,t){let n=Kd(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,Iy(n),mw(t.reward),!0)}function mw(e){if(e){if(e.type==="coins"){try{P.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{P.books.addWithMultiplier?.(e.amount)??P.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{P.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{P.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function hw(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function Kd(){try{return JSON.parse(localStorage.getItem(kr(tl))||"{}")}catch{return{}}}function Iy(e){let t=kr(tl);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{it(t,n)}catch{}}catch{}}function gw(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function yw(){let e=Hd;if(Hd=null,typeof e=="function")try{e()}catch{}}function vw(e,t={}){t?.rawChanged&&Jo()}function Dd(e){if(e===py)return;if(yw(),py=e??null,e==null){Jo();return}let t=`${tl}:${e}`;Hd=Ct(t,{parse:gw,onChange:vw});try{it(t)}catch{}Jo()}function bw(){if(uy){Dd(b());return}uy=!0,Dd(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Dd(b())})}function Rr(){Promise.resolve().then(()=>(Pn(),Vl)).then(({loadAudio:e})=>{e(wy)})}function Sw(){if(Ls)return;Ls=ct(wy,{volume:ze?.15:.3,loop:!0})}function er(){Ls&&(Ls.stop&&Ls.stop(),Ls=null)}function Iw(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let E=0;E<t.length;E++){let C=t[E];C==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=C):C===">"&&l?(s+=C,i.push({type:"tag",content:s}),s="",l=!1):s+=C}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,p="";Qo=!0,Sw();let h=E=>{d&&(E.preventDefault(),f=!0)},m=E=>{d&&(E.key==="Enter"||E.key===" ")&&(f=!0)},y=o.length?o:[e];requestAnimationFrame(()=>{d=!0,y.forEach(E=>E.addEventListener("click",h,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{y.forEach(E=>E.removeEventListener("click",h)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),er(),Qo=!1},v=()=>{if(f){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let E=i[a];E.type==="tag"?(p+=E.content,e.innerHTML=p,a++,v()):(p+=E.content[u],e.innerHTML=p,u++,u>=E.content.length&&(a++,u=0),setTimeout(v,n))};v()})}function ww(e={}){if(!Ye)return;Rr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Zo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Ar}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,Ye.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Zo,r.textContent=e.message||zd,requestAnimationFrame(()=>t.classList.add("is-visible")),Ye.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),Ye.classList.remove("firstchat-active"),er(),Qo=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),_n(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&_n(160),l()};el(i,()=>{u()},{once:!0}),i.focus?.()}function Ew(e,t){Rr();let n=t.scriptId;String(e)==="6"&&typeof Ss=="function"&&!Ss()&&(n=7),Xr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,Ye.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),Ye.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{Xr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),Ye.classList.remove("firstchat-active"),er(),Qo=!1,o.remove()},d=()=>{u||(u=!0,f(),Jo())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&_n(160),d())});let p=new Tr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,v)=>{t.scriptId===4&&g==="c4b"&&Gc(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){Jo(),f();return}pw(e,t),Jo(),f()}}}),m=!!Kd()[e]?.claimed,y=structuredClone(Jf[n]);m&&y.nodes.m2b&&y.nodes.c2a&&t.scriptId===1&&(y.nodes.m2b.say="I've already given you Coins, goodbye.",y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&y.nodes.m3a&&(y.nodes.m3a.say="I've already given you Books, goodbye.",y.nodes.c2a&&(y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&y.nodes.m5a&&(y.nodes.m5a.say="I've already given you Gold, goodbye.",y.nodes.c5a&&(y.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&y.nodes.m7a&&(y.nodes.m7a.say="I've already given you Magic, goodbye.",y.nodes.c7a&&(y.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(y),p.start()}function xw(){if(document.getElementById(hy))return;let e=document.createElement("style");e.id=hy,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function Lw(){let e=Ye?.querySelector(".merchant-content");if(!e||e.__customScroll||!gt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),gt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){xw();let x=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;gt.style.timelineScope=x,e.style.scrollTimelineName=x,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=x,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let M=(e.scrollTop||0)>0;f!==M&&(f=M,gt?.classList.toggle("has-scroll-shadow",M))},p=()=>{let M=Ye.querySelector(".merchant-grabber"),x=Ye.querySelector(".merchant-header"),X=Ye.querySelector(".merchant-actions"),J=(M?.offsetHeight||0)+(x?.offsetHeight||0)|0,se=(X?.offsetHeight||0)|0;t.style.top=J+"px",t.style.bottom=se+"px"},h={},m=()=>{let{scrollHeight:M,clientHeight:x,scrollTop:X}=e,J=t.clientHeight||e.clientHeight||1;if(h.scrollHeight===M&&h.clientHeight===x&&h.barH===J&&(u||h.scrollTop===X))return;h={scrollHeight:M,clientHeight:x,scrollTop:X,barH:J};let se=x/Math.max(1,M),K=Math.max(28,Math.round(J*se)),Q=Math.max(1,M-x),ve=Math.max(0,J-K);if(n.style.height=K+"px",u)n.style.setProperty("--thumb-y",`${ve}px`),n.style.setProperty("--thumb-x","0px");else{let he=Math.round(X/Q*ve);n.style.transform=`translateY(${he}px)`}t.style.display=M<=x+1?"none":""},y=()=>{p(),m(),d()},g=()=>{o&&(gt.classList.add("is-scrolling"),l&&clearTimeout(l))},v=M=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{gt.classList.remove("is-scrolling")},M))},E=()=>{m(),d(),o&&g(),s||v(r)},C=()=>v(r);e.addEventListener("scroll",E,{passive:!0}),s&&e.addEventListener("scrollend",C,{passive:!0});let A=new ResizeObserver(y);A.observe(e),window.addEventListener("resize",y),requestAnimationFrame(y);let N=!1,H=0,F=0,q=M=>{N=!0,H=M.clientY,F=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},L=M=>{if(!N)return;let x=t.clientHeight||1,X=n.clientHeight||1,J=Math.max(1,x-X),se=Math.max(1,e.scrollHeight-e.clientHeight),Q=(M.clientY-H)/J*se;e.scrollTop=F+Q},B=M=>{if(N){N=!1,n.classList.remove("dragging"),v(i);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",q),window.addEventListener("pointermove",L,{passive:!0}),window.addEventListener("pointerup",B),window.addEventListener("pointercancel",B),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let x=t.getBoundingClientRect(),X=M.clientY-x.top,J=t.clientHeight||1,se=n.clientHeight||1,K=Math.max(0,J-se),Q=Math.max(0,Math.min(X-se/2,K)),ve=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=Q/Math.max(1,K)*ve,g(),v(r)}),e.__customScroll={bar:t,thumb:n,ro:A,updateAll:y},y()}function _w(){if(Ye)return;Ye=document.createElement("div"),Ye.className="merchant-overlay",Ye.id="merchant-overlay",Ye.setAttribute("inert",""),gt=document.createElement("div"),gt.className="merchant-sheet",gt.setAttribute("role","dialog"),gt.setAttribute("aria-modal","false"),gt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",Fd(),Ud(),dy(),Gd(),gi.forEach(h=>{h.key==="dialogue"&&_s.set("dialogue",!0);let m=_s.get(h.key),y=m??!!h.unlocked,g=document.createElement("button");g.type="button",g.className="merchant-tab",g.dataset.tab=h.key;let v=h.lockedLabel||"???";g.textContent=y?h.label:v,y?g.title=h.label||"Tab":(g.classList.add("is-locked"),g.disabled=!0,g.title="???"),h.unlocked=y,_s.set(h.key,y),el(g,E=>{if(g.disabled){E?.preventDefault?.();return}Vc(h.key)}),o.appendChild(g),xn.buttons[h.key]=g}),xn.panels.dialogue=i,xn.panels.reset=s,xn.panels.workshop=l,xn.panels.warp=a,xn.panels.lab=u,xn.tablist=o,r.append(i,s,l,a,u),n.append(o,r),Fd(),Ud();try{Xo()}catch{}try{jd(s)}catch{}try{$e()}catch{}try{dd(l)}catch{}try{ay(a)}catch{}try{kd(u)}catch{}if(!fy&&typeof window<"u"){let h=m=>{let{key:y,slot:g}=m?.detail??{};g!=null&&g!==b()||((y==="forge"||!y)&&Fd(),(y==="infuse"||!y)&&Ud(),(y==="surge_completed"||!y)&&dy(),(y==="lab"||y==="tsunami"||!y)&&Gd())};window.addEventListener("unlock:change",h,{passive:!0}),window.addEventListener("saveSlot:change",h,{passive:!0}),fy=!0}let f=document.createElement("div");f.className="merchant-actions";let d=document.createElement("button");d.type="button",d.className="merchant-close",d.textContent="Close",$c=d,f.appendChild(d);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,gt.append(e,t,n,f,p),Ye.appendChild(gt),document.body.appendChild(Ye),Cw(),Lw(),my||(my=!0,el(d,()=>{Wc()},{once:!1}),document.addEventListener("keydown",Tw),e.addEventListener("pointerdown",Nw),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),Ye.addEventListener("pointerdown",Rr,{once:!0}))}function Cw(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,fw(),Jo()}function Mw(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?Ew(n.id,n.meta):n.isMysterious&&ww(n.lockInfo)}}function Jo(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=cw(),o=Kd(),r=!1,i=new Set;Object.entries(Xc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=Dc(u),d=uw(l,n),p=d.status,h=Dc(p);if(h>f)a.status=p,p==="mysterious"?a.lockSnapshot=ly(d):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(h<f){if(u==="unlocked")d=sw(l),p="unlocked",h=Dc(p);else if(u==="mysterious"){let M=a.lockSnapshot||ly(d)||{};d={status:"mysterious",unlocked:!1,title:M.title??d.title??"???",blurb:M.blurb??d.blurb??$d,tooltip:M.tooltip??d.tooltip??"Hidden Dialogue",message:M.message??d.message??zd,icon:M.icon??d.icon??Ar,headerTitle:M.headerTitle??d.headerTitle??Zo,ariaLabel:M.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},p="mysterious",h=Dc(p)}}let m=p==="unlocked",y=p==="mysterious",g=p==="locked",v=!!a.claimed,E=m&&!!(l.once&&v),C=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!C){C=document.createElement("button"),C.type="button",C.className="dlg-card",C.dataset.dlgId=String(s);let M=document.createElement("div");M.className="dlg-title";let x=document.createElement("div");x.className="dlg-blurb";let X=document.createElement("div");X.className="dlg-reward",C.append(M,x,X),t.appendChild(C),el(C,Mw)}C._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:m,isMysterious:y},C.dataset.dlgStatus=p,C.disabled!==!!g&&(C.disabled=!!g),C.classList.toggle("is-locked",g),C.classList.toggle("is-mysterious",y),C.classList.toggle("is-complete",!!E),C.classList.toggle("has-again",!!E),g?(C.getAttribute("aria-disabled")!=="true"&&C.setAttribute("aria-disabled","true"),C.getAttribute("tabindex")!=="-1"&&C.setAttribute("tabindex","-1")):(C.hasAttribute("aria-disabled")&&C.removeAttribute("aria-disabled"),C.hasAttribute("tabindex")&&C.removeAttribute("tabindex"));let A=C.querySelector(".dlg-title"),N=m?l.title:d.title??"???";A.textContent!==N&&(A.textContent=N);let H=C.querySelector(".dlg-blurb"),F=m?l.blurb:d.blurb??"";H.textContent!==F&&(H.textContent=F);let q=C.querySelector(".dlg-reward");if(m&&l.reward){let M=tw[l.reward.type];if(M){q.classList.contains("has-reward")||(q.classList.add("has-reward"),q.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),q.style.getPropertyValue("--reward-icon")!==`url('${M}')`&&q.style.setProperty("--reward-icon",`url('${M}')`);let x=q.querySelector(".amt"),X=String(l.reward.amount);x&&x.textContent!==X&&(x.textContent=X);let J=q.querySelector(".currency-name");if(J){let K=String(l.reward.type||""),Q=K.charAt(0).toUpperCase()+K.slice(1);J.textContent!==Q&&(J.textContent=Q)}let se=`Reward: ${l.reward.amount} ${l.reward.type}`;q.getAttribute("aria-label")!==se&&q.setAttribute("aria-label",se)}else{q.classList.remove("has-reward");let x=hw(l.reward);q.textContent!==x&&(q.textContent=x),q.style.display!==""&&(q.style.display=""),q.removeAttribute("aria-label")}q.style.display==="none"&&(q.style.display="")}else q.textContent!==""&&(q.textContent=""),q.style.display!=="none"&&(q.style.display="none");let L=m?`${l.title}${E?" (completed)":""}`:d.ariaLabel||(y?"Hidden merchant dialogue":"Locked merchant dialogue");if(C.getAttribute("aria-label")!==L&&C.setAttribute("aria-label",L),d.tooltip)C.title!==d.tooltip&&(C.title=d.tooltip);else if(m){let M="Left-click: Start Dialogue";C.title!==M&&(C.title=M)}else C.hasAttribute("title")&&C.removeAttribute("title");let B=C.querySelector(".dlg-again");E?B||(B=document.createElement("div"),B.className="dlg-again",B.textContent="Ask Again?",C.appendChild(B)):B&&B.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&Iy(o)}function Aw(){let e=Ye.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Xr(!0);let i=new Tr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Xr(!1);try{localStorage.setItem(kr(Wd),"1")}catch{}try{window.dispatchEvent(new Event(Vd))}catch{}e.classList.remove("is-visible"),Ye.classList.remove("firstchat-active")}});i.load(Jf[0]),i.start()}function kw(){if(!Ye)return;let e=Ye.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),Ye.classList.remove("firstchat-active")}function Ey(){if(_w(),Ms)return;let e=document.activeElement;e instanceof HTMLElement&&!Ye.contains(e)?qc=e:qc=null,Ms=!0;let t=b(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(Sy(t),"1")}catch{}Gd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(kr(Wd))==="1"}catch{o=!1}o||Ye.classList.add("firstchat-instant"),gt.style.transition="none",gt.style.transform="",Ye.removeAttribute("inert"),gt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ye.classList.contains("firstchat-instant")||(gt.style.transition=""),Ye.classList.add("is-open"),_n(140),$c&&typeof $c.focus=="function")try{$c.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(kr(gy))||"dialogue"}catch{}n&&(r="dialogue"),Vc(r),er(),o||(Ye.querySelector(".merchant-firstchat")?.classList.add("is-visible"),Ye.classList.add("firstchat-active"),Aw())})})}function Wc(){if(!Ms)return;if(Xr(!1),ze){try{Io(100)}catch{}try{_n(80)}catch{}}Ms=!1,gt.style.transition="",gt.style.transform="",Ye.classList.remove("is-open"),Ye.classList.remove("firstchat-instant"),kw();let e=document.activeElement;if(e&&Ye.contains(e)){let t=qc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}Ye.setAttribute("inert",""),qc=null,er(),Qo=!1}function Tw(e){if(Ms&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<gi.length;i++)_s.get(gi[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<gi.length&&(e.preventDefault(),Vc(gi[r].key))}}function Nw(e){if(!Ms)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;Ln={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},gt.style.transition="none",window.addEventListener("pointermove",xy,{passive:!0}),window.addEventListener("pointerup",Ly),window.addEventListener("pointercancel",_y)}function xy(e){if(!Ln||Ln.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-Ln.startY);Ln.lastY=t,Ln.moved=n,gt.style.transform=`translateY(${n}px)`}function Ly(){if(!Ln||Ln.canceled){Xd();return}let e=Math.max(1,performance.now()-Ln.startT),t=Ln.moved;t/e>.55&&t>40||t>140?(Io(160),gt.style.transition="transform 140ms ease-out",gt.style.transform="translateY(100%)",setTimeout(()=>{Wc()},150)):(gt.style.transition="transform 180ms ease",gt.style.transform="translateY(0)"),Xd()}function _y(){Ln&&(Ln.canceled=!0,gt.style.transition="transform 180ms ease",gt.style.transform="translateY(0)",Xd())}function Xd(){window.removeEventListener("pointermove",xy),window.removeEventListener("pointerup",Ly),window.removeEventListener("pointercancel",_y),Ln=null}function Vc(e){let t=gi.find(o=>o.key===e),n=_s.get(e);(!t||!n)&&(e="dialogue");for(let o in xn.buttons)xn.buttons[o].classList.toggle("is-active",o===e);for(let o in xn.panels)xn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Jo()}catch{}if(e==="warp")try{jo()}catch{}if(e==="lab"){typeof Ss=="function"&&!Ss()&&Rw();try{Td()}catch{}}try{localStorage.setItem(kr(gy),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=Ye?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function ol(e=[]){e.forEach(t=>nl(t,!0))}function Cy(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Rr();let u=h=>{h.key==="Escape"&&(h.stopImmediatePropagation(),h.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let h=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),y=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),v={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},E=new Tr({textEl:h,choicesEl:m,skipTargets:[h,y,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),er(),Qo=!1,r.remove(),t&&t()},5e3)}});E.load(v),E.start()},p=new Tr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",er(),Qo=!1,n&&n.hideCursor&&n.hideCursor(),f()}});p.load(o),p.start()}function Rw(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Rr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Tr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{er(),Qo=!1,e.remove()}});s.load(i),s.start()}function My(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Rr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Tr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{er(),Qo=!1,t.remove(),e&&e()}});l.load(s),l.start()}var Cs,Wd,gy,tl,Vd,kr,vy,gi,_s,tw,Ar,Zo,nw,$d,qd,zd,ow,rw,by,iw,cy,uy,fy,Sy,py,Hd,Xc,Ye,gt,$c,Ms,Ln,qc,my,xn,wy,Ls,Qo,Tr,hy,Yc=Fe(()=>{vt();It();ug();qn();Eo();as();Bd();fi();io();ii();es();ro();Pn();Cs="img/misc/merchant.webp",Wd="ccc:merchantMet",gy="ccc:merchantTab",tl="ccc:merchant:dlgState",Vd="ccc:merchant:met",kr=e=>`${e}:${b()}`;vy="ccc:unlock:jeff";gi=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],_s=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),tw={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Ar="img/misc/mysterious.webp",Zo="Hidden Dialogue",nw="Locked Dialogue",$d="Hidden Dialogue",qd="Locked",zd="Locked Dialogue",ow={locked:0,mysterious:1,unlocked:2},rw="ccc:reset:forge:completed",by=typeof window<"u"&&"PointerEvent"in window,iw=!by&&typeof window<"u"&&"ontouchstart"in window;cy=!1,uy=!1,fy=!1;Sy=e=>`ccc:unlock:lab:${e}`;py=null,Hd=null;Xc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Ar,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:qd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Ar,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof _o=="function"&&_o()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Ar,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof un=="function"&&un())return!0;let t=typeof co=="function"?co():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof _o=="function"&&_o()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Ar,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Ar,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};bw();Ye=null,gt=null,$c=null,Ms=!1,Ln=null,qc=null,my=!1,xn={buttons:{},panels:{},tablist:null},wy="sounds/merchant_typing.ogg",Ls=null,Qo=!1;Tr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await Iw(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=el(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};hy="ccc-scroll-timeline-styles"});var Ay,Zd=Fe(()=>{Ay=[{area:"dna",id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM"},{area:"dna",id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM"}]});function Py(e){if(!e||!e.costType)return!1;let t=Uw[e.costType];return!t||Mt(Ke,t)<=0?!1:ai(e.area,e.id)!=="0"}function Qd(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function Kc(e,t){return t==="standard"&&Qd(e)===Fw}function Jd(e){let t=Pt(e),n={};for(let o of t){let r=wn(e,o.id),i=Mt(e,o.id),s=Mo(e,o.id),l=s.iconOverride??tu(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Ns(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:d}}return n}function By(e){return Ny[e]||Ny.standard}function _n(e=140){if(!ze)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Zc(e){return String(e??"").replace(/<[^>]*>/g,"")}function zc(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function tn(){ct($w,{volume:ze?Fy:Uy})}function Dy(){let e=ze?Fy*2:Uy*2;ct(qw,{volume:e})}function Gw(e){return`<img alt="" src="${Ty[e]||Ty.coins}" class="currency-ico">`}function Xw(){if(document.getElementById(Ry))return;let e=document.createElement("style");e.id=Ry,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function ws(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){Xw();let Q=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=Q,s.style.scrollTimelineName=Q,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=Q,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let y=null,g=()=>{let Q=((i?s.scrollTop:s.scrollLeft)||0)>0;y!==Q&&(y=Q,t?.classList.toggle("has-scroll-shadow",Q))},v=()=>{if(!s.isConnected||!t.isConnected)return;let K=s.getBoundingClientRect(),Q=t.getBoundingClientRect();if(i){let ve=Math.max(0,K.top-Q.top),he=Math.max(0,Q.bottom-K.bottom);l.style.top=ve+"px",l.style.bottom=he+"px",l.style.left="",l.style.right=""}else{let ve=Math.max(0,K.left-Q.left),he=Math.max(0,Q.right-K.right);l.style.left=ve+"px",l.style.right=he+"px",l.style.top="",l.style.bottom="",l.style.height=""}},E={},C=()=>{let K=i?s.scrollHeight:s.scrollWidth,Q=i?s.clientHeight:s.clientWidth,ve=i?s.scrollTop:s.scrollLeft,he=i?l.clientHeight||Q:l.clientWidth||Q;if(E.scrollSize===K&&E.clientSize===Q&&E.barSize===he&&(m||E.scrollPos===ve))return;E={scrollSize:K,clientSize:Q,scrollPos:ve,barSize:he};let W=Q/Math.max(1,K),ee=Math.max(28,Math.round(he*W)),$=Math.max(1,K-Q),U=Math.max(0,he-ee);if(i?(a.style.height=ee+"px",a.style.width="100%"):(a.style.width=ee+"px",a.style.height="100%"),m)i?(a.style.setProperty("--thumb-y",`${U}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${U}px`),a.style.setProperty("--thumb-y","0px"));else{let ie=Math.round(ve/$*U);i?a.style.transform=`translateY(${ie}px)`:a.style.transform=`translateX(${ie}px)`}let j=K>Q+1;l.style.display=j?"":"none",t?.classList.toggle("has-active-scrollbar",j)},A=()=>{v(),C(),g()};typeof MutationObserver<"u"&&new MutationObserver(()=>A()).observe(s,{childList:!0,subtree:!0,characterData:!0});let N=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},H=K=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},K))},F=()=>{C(),g(),u&&N(),p||H(f)},q=()=>H(f);s.addEventListener("scroll",F,{passive:!0}),p&&s.addEventListener("scrollend",q,{passive:!0}),new ResizeObserver(A).observe(s),window.addEventListener("resize",A),requestAnimationFrame(A);let B=!1,M=0,x=0,X=K=>{B=!0,M=i?K.clientY:K.clientX,x=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),N();try{a.setPointerCapture(K.pointerId)}catch{}K.preventDefault()},J=K=>{if(!B)return;let Q=i?l.clientHeight:l.clientWidth,ve=i?a.clientHeight:a.clientWidth,he=Math.max(1,Q-ve),W=i?s.scrollHeight:s.scrollWidth,ee=i?s.clientHeight:s.clientWidth,$=Math.max(1,W-ee),j=(i?K.clientY:K.clientX)-M,ie=x+j/he*$;i?s.scrollTop=ie:s.scrollLeft=ie},se=K=>{if(B){B=!1,a.classList.remove("dragging"),H(d);try{a.releasePointerCapture(K.pointerId)}catch{}}};a.addEventListener("pointerdown",X),window.addEventListener("pointermove",J,{passive:!0}),window.addEventListener("pointerup",se),window.addEventListener("pointercancel",se),l.addEventListener("pointerdown",K=>{if(K.target===a)return;let Q=l.getBoundingClientRect(),ve=i?K.clientY-Q.top:K.clientX-Q.left,he=i?a.clientHeight:a.clientWidth,W=i?l.clientHeight:l.clientWidth,ee=Math.max(0,W-he),$=Math.max(0,Math.min(ve-he/2,ee)),U=i?s.scrollHeight:s.scrollWidth,j=i?s.clientHeight:s.clientWidth,ie=Math.max(1,U-j),ae=$/Math.max(1,ee)*ie;i?s.scrollTop=ae:s.scrollLeft=ae,N(),H(f)}),A()}function Oy(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function Ww(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=P[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return d&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):Oy(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),h=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(h));if(d.cmp(p)===0&&d.cmp(m)===0){let g=Oy(e,o,r),v=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,E=0,C=Math.max(0,v);for(;E<C;){let A=Math.floor((E+C+1)/2),N=c.fromInt(A);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(N):c.fromAny(d??0).mulBigNumInteger(N)).cmp(a)<=0?E=A:C=A-1}return c.fromInt(E)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=yi(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function ls(e="standard"){(Jc[e]||Jc.standard).open()}function $y(e=!1){Object.values(Jc).forEach(t=>t.close(e))}function Or(e=!1){Object.values(Jc).forEach(t=>t.update(e))}function Vw(){if(nn)return;nn=document.createElement("div"),nn.className="upg-overlay",st=document.createElement("div"),st.className="upg-sheet",st.setAttribute("role","dialog"),st.setAttribute("aria-modal","false"),st.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",st.append(e,t,n,o,r),nn.appendChild(st),document.body.appendChild(nn),nn.addEventListener("pointerdown",u=>{ze&&u.pointerType!=="mouse"&&u.target===nn&&(u.preventDefault(),u.stopPropagation())},!0),nn.addEventListener("click",u=>{ze&&u.target===nn&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Qc)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},st.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,st.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(st.style.transition="transform 160ms ease",st.style.transform=f?"translateY(100%)":"translateY(0)",f){if(ze&&(!u||u.pointerType!=="mouse"))try{_n(120)}catch{}setTimeout(qy,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function qy(){if(ze)try{_n(160)}catch{}if(typeof jc=="function"){let e=jc;jc=null;try{e()}catch{}}Qc=!1,!(!nn||!st)&&(st.style.transition="",st.style.transform="",nn.classList.remove("is-open"),nn.style.pointerEvents="none")}function Yw(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function zw(e,t="standard"){Vw(),Qc=!0;let n=!0,o=By(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Qc=!1;return}let l=e.upgType==="HM",a=e.tie===Ee.ENDLESS_XP;function u(m,y,g="div"){let v=y.split(" ").filter(A=>A.length>0),E=null,C=[];for(let A=0;A<m.children.length;A++){let N=m.children[A];g&&N.tagName.toLowerCase()!==g.toLowerCase()||v.every(H=>N.classList.contains(H))&&(E?C.push(N):E=N)}return C.forEach(A=>A.remove()),E||(E=document.createElement(g),E.className=y,m.appendChild(E)),E}let f=m=>{let y=document.createElement("div");return y.className="upg-line",y.innerHTML=m,y},d=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let y=m.lockState||o.getLockState(e.id),g=!!y?.locked,v=g&&(y?.hidden||y?.hideEffect||y?.hideCost),E=!!m.unlockUpgrade&&!v;st.classList.toggle("is-locked-hidden",v);let C=st.querySelector(".upg-header"),A=u(C,"upg-title");A.textContent!==(m.displayTitle||m.upg.title)&&(A.textContent=m.displayTitle||m.upg.title);let N=!!m.hmReadyToEvolve,H=N?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,F=u(C,"upg-level"),q=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??ne(m.lvlCapBn),L=m.lvlCapFmtText??m.upg.lvlCapFmtText??Zc(q),B=N?`Level ${m.lvlFmtHtml} / ${q} (EVOLVE READY)`:H?`Level ${m.lvlFmtHtml} / ${q} (MAXED)`:`Level ${m.lvlFmtHtml} / ${q}`,M=Zc(B);F.innerHTML!==B&&(F.innerHTML=B),F.getAttribute("aria-label")!==M&&F.setAttribute("aria-label",M),F.hidden=v,v||F.removeAttribute("aria-hidden"),st.classList.toggle("is-maxed",H),st.classList.toggle("hm-evolve-ready",N),st.classList.toggle("is-unlock-upgrade",E),st.classList.toggle("is-hm-upgrade",l&&!v),st.classList.toggle("is-endless-xp",a),st.classList.toggle("is-magnet-upgrade",e.tie===Ee.MAGNET),st.classList.toggle("is-no-effect",!m.effect);let x=C.querySelector(".auto-toggle-wrapper"),X=t==="automation"?os[e.id]:null,J=t==="automation"&&e.id===to,se=!!X,K=t==="standard"?Dw[e.costType]:null,Q=0;K?Q=Mt(Ke,K):(se||J)&&(Q=Mt(Ke,e.id));let he=Q>0&&(se||K||J)&&!v;x||(x=document.createElement("div"),x.className="auto-toggle-wrapper hm-view-milestones-row",C.appendChild(x));let W=x.querySelector("button");if(W||(W=document.createElement("button"),W.type="button",W.style.padding="10px 14px",W.style.fontSize="16px",W.style.width="auto",W.style.minWidth="180px",W.addEventListener("click",le=>{typeof W._onClick=="function"&&W._onClick(le)}),x.appendChild(W)),he){W.style.visibility="",W.style.pointerEvents="auto";let le=b(),Ie=le!=null?`:${le}`:"",Re=!0;if(se){let _e=`ccc:autobuy:master:${X}${Ie}`,Oe=Pt(Se.STARTER_COVE),ce=!1;for(let te of Oe)if(te.costType===X){let we=`ccc:autobuy:${te.area}:${te.id}${Ie}`;if(ai(te.area,te.id)!=="0"){ce=!0;break}}Re=ce}else Re=ai(e.area,e.id)!=="0";Re?(W.className="shop-delve",W.textContent="Automation: ON",W.style.backgroundColor=""):(W.className="shop-close",W.textContent="Automation: OFF",W.style.backgroundColor=""),W._onClick=_e=>{_e.preventDefault(),_e.stopPropagation(),ze&&_n(50);let ce=!Re?"1":"0";se?(localStorage.setItem(`ccc:autobuy:master:${X}${Ie}`,ce),Pt(Se.STARTER_COVE).forEach(we=>{we.costType===X&&Ir(we.area,we.id,ce)})):Ir(e.area,e.id,ce),p()}}else W.style.visibility="hidden",W.style.pointerEvents="none",W.className="shop-delve",W.textContent="Automation: ON",W._onClick=null;let ee=st.querySelector(".upg-content");d&&(ee.scrollTop=0,d=!1);let $=u(ee,"upg-desc centered");$.classList.toggle("lock-desc",v);let U=(m.displayDesc||m.upg.desc||"").trim();N?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):U?($.classList.remove("hm-evolve-note"),$.textContent!==U&&($.textContent=U),$.hidden=!1):$.hidden=!0;let j=u(ee,"upg-info"),ie=null,ae=le=>{ie?ie.nextElementSibling!==le&&j.insertBefore(le,ie.nextSibling):j.firstElementChild!==le&&j.prepend(le),ie=le};if(g&&y?.reason&&!v){let le=(m.displayDesc||"").trim(),Ie=String(y.reason??"").trim();if(le!==Ie){let Re=j.querySelector(".lock-wrapper");if(!Re){Re=document.createElement("div"),Re.className="lock-wrapper";let ce=document.createElement("div");ce.className="upg-line lock-note",Re.append(ce)}let _e=Array.from(Re.children);for(let ce of _e)ce.tagName==="DIV"&&!ce.className&&ce.style.height==="12px"&&ce.remove();let Oe=Re.querySelector(".lock-note");Oe.textContent!==y.reason&&(Oe.textContent=y.reason),ae(Re)}else{let Re=j.querySelector(".lock-wrapper");Re&&Re.remove()}}else{let le=j.querySelector(".lock-wrapper");le&&le.remove()}if(m.effect&&!(g&&y?.hideEffect)){let le=j.querySelector(".effect-wrapper");if(!le){le=document.createElement("div"),le.className="effect-wrapper";let Oe=document.createElement("div");Oe.className="upg-line",le.append(Oe)}let Ie=Array.from(le.children);for(let Oe of Ie)Oe.tagName==="DIV"&&!Oe.className&&Oe.style.height==="12px"&&Oe.remove();let Re=le.querySelector(".upg-line"),_e=`<span class="bonus-line">${m.effect}</span>`;Re.innerHTML!==_e&&(Re.innerHTML=_e),ae(le)}else{let le=j.querySelector(".effect-wrapper");le&&le.remove()}let _=Gw(m.upg.costType),Y=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),fe=H||N;if(!m.unlockUpgrade&&!fe&&(!g||!y?.hideCost)){let le=u(j,"upg-costs");ae(le);let Ie=zc(m.upg.costType,Y),Re=`Cost: ${_} ${P[m.upg.costType].fmt(Y)} ${Ie}`,_e=u(le,"cost-line","div");if(_e.className.includes("upg-line")||(_e.className="upg-line cost-line"),_e.innerHTML!==Re&&(_e.innerHTML=Re),l){let we=u(le,"milestone-line","div");we.className.includes("upg-line")||(we.className="upg-line milestone-line");let w="\u2014",V="",z=Py(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(z){let ue=m.hmNextMilestone.sub(c.fromInt(1)),Ge=0;try{let be=ue.toPlainIntegerString?.();be&&be!=="Infinity"?Ge=Number(be):Ge=Number(ue.toString())}catch{Ge=0}let nt=c.fromInt(0);try{nt=c.fromAny(m.upg.costAtLevel(Ge))}catch{}w=P[m.upg.costType].fmt(nt),V=zc(m.upg.costType,nt)}else{let ue=m.hmNextMilestone.sub(m.lvlBn),Ge=ue.toPlainIntegerString?.(),nt=Math.max(0,Math.floor(Number(Ge&&Ge!=="Infinity"?Ge:Number(ue.toString()||0)))),{spent:be}=yi(m.upg,m.lvlBn,c.fromAny("Infinity"),nt);w=P[m.upg.costType].fmt(be),V=zc(m.upg.costType,be)}}catch{}let ge=`${z?"Cost at next milestone:":"Cost to next milestone:"} ${_} ${w} ${V}`;we.innerHTML!==ge&&(we.innerHTML=ge)}else{let we=le.querySelector(".milestone-line");we&&we.remove()}let Oe=zc(m.upg.costType,m.have),ce=`You have: ${_} ${P[m.upg.costType].fmt(m.have)} ${Oe}`,te=u(le,"have-line","div");te.className.includes("upg-line")||(te.className="upg-line have-line"),te.innerHTML!==ce&&(te.innerHTML=ce)}else{let le=j.querySelector(".upg-costs");le&&le.remove()}let me=st.querySelector(".upg-milestones"),Z=me.querySelector(".hm-view-milestones-row");if(!Z){Z=document.createElement("div"),Z.className="hm-view-milestones-row";let le=document.createElement("button");le.type="button",le.className="shop-delve hm-view-milestones",le.textContent="View Milestones",le.addEventListener("click",Ie=>{le._onClick&&le._onClick(Ie)}),Z.appendChild(le),me.appendChild(Z)}let re=Z.querySelector("button");l&&!v?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let le=Array.isArray(m.hmMilestones)?m.hmMilestones:[],Ie=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Re=(()=>{try{return BigInt($t)*BigInt(Ie)}catch{return 0n}})(),_e=le.sort((Oe,ce)=>Number(Oe?.level||0)-Number(ce?.level||0)).map(Oe=>{let ce=Math.max(0,Math.floor(Number(Oe?.level||0))),te=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ce)+Re).toString())}catch{return c.fromAny(ce+$t*Ie)}})(),we=te?.isInfinite?.()?"Infinity":ne(te),w=We(Oe?.multiplier??Oe?.mult??Oe?.value??1),V=`${Oe?.target??Oe?.type??"self"}`.toLowerCase(),z=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(te)>=0}catch{}return!1})(),oe=`Level ${we}: Multiplies this upgrade\u2019s effect by ${w}x`;return V==="xp"&&(oe=`Level ${we}: Multiplies XP value by ${w}x`),(V==="coin"||V==="coins")&&(oe=`Level ${we}: Multiplies Coin value by ${w}x`),V==="mp"&&(oe=`Level ${we}: Multiplies MP value by ${w}x`),{text:oe,achieved:z}});Yw(_e)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ye=st.querySelector(".upg-actions"),Le=ye.querySelector(".shop-close");if(Le||(Le=document.createElement("button"),Le.type="button",Le.className="shop-close",Le.textContent="Close",Le.addEventListener("click",()=>{n=!1,qy()}),ye.appendChild(Le)),g||H)ye.querySelectorAll("button:not(.shop-close)").forEach(le=>le.remove()),document.activeElement&&document.activeElement!==Le&&!ye.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Le.focus();else{let le=m.have.cmp(Y)>=0,Ie=(ce,te,we,w,V=!1)=>{let z=ye.querySelector(`.${ce.split(" ").join(".")}`);if(!z){z=document.createElement("button"),z.type="button",z.className=ce,z.textContent=te;let oe=()=>{typeof z._onClick=="function"&&z._onClick()};"PointerEvent"in window?z.addEventListener("pointerdown",ue=>{ue.pointerType==="mouse"||typeof ue.button=="number"&&ue.button!==0||(oe(),ue.preventDefault())},{passive:!1}):z.addEventListener("touchstart",ue=>{oe(),ue.preventDefault()},{passive:!1}),z.addEventListener("click",()=>{ze||oe()});let ge=ye.children;w>=ge.length?ye.appendChild(z):ye.insertBefore(z,ge[w])}return z._onClick=we,z.textContent!==te&&(z.textContent=te),z.disabled!==V&&(z.disabled=V),z};if(N){ye.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ce=>ce.remove()),Ie("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ce}=o.evolve(e.id);ce&&(Dy(),Or(),p())},1,!1);return}if(m.unlockUpgrade){ye.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ce=>ce.remove()),Ie("shop-delve btn-unlock","Unlock",()=>{let{bought:ce}=o.buyOne(e.id);if(!(ce instanceof c?ce:c.fromAny(ce??0)).isZero?.()){if(tn(),Kc(e,t))try{ol(["reset"])}catch{}Or(),p()}},1,!le);return}if(ye.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ce=>ce.remove()),Ie("shop-delve btn-buy-one","Buy",()=>{let ce=o.getUiModel(e.id);if(ce.have.cmp(ce.nextPrice instanceof c?ce.nextPrice:c.fromAny(ce.nextPrice||0))<0)return;let{bought:te}=o.buyOne(e.id);(te instanceof c?te:c.fromAny(te??0)).isZero?.()||(tn(),Or(),p())},1,!le),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let ce=ye.querySelector(".btn-buy-max");ce&&ce.remove();let te=ye.querySelector(".btn-buy-cheap");te&&te.remove()}else{Ie("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:w}=o.buyMax(e.id);(w instanceof c?w:c.fromAny(w??0)).isZero?.()||(tn(),Or(),p())},2,!le);let te=[1,3,4,5,6].includes(Qd(m.upg));if(!l&&!te)Ie("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let V=o.buyCheap;if(!V)return;let{bought:z}=V(e.id);(z instanceof c?z:c.fromAny(z??0)).isZero?.()||(tn(),Or(),p())},3,!le);else{let we=ye.querySelector(".btn-buy-cheap");we&&we.remove()}}if(l)Ie("shop-delve btn-buy-next","Buy Next",()=>{let te=o.getUiModel(e.id);if(te.hmReadyToEvolve)return;let we=te.hmNextMilestone;if(!we||!te.lvlBn||we.cmp(te.lvlBn)<=0){let{bought:be}=o.buyMax(e.id);if((be instanceof c?be:c.fromAny(be??0)).isZero?.())return;tn(),Or(),p();return}let w=0;try{let be=we.sub(te.lvlBn).toPlainIntegerString?.();w=Math.max(0,Math.floor(Number(be&&be!=="Infinity"?be:we.sub(te.lvlBn).toString())))}catch{}let V=P[te.upg.costType]?.value,z=V instanceof c?V:c.fromAny(V??0),ge=yi(te.upg,te.lvlBn,z,w).count,ue=!1;try{let be=ge?.toPlainIntegerString?.();ue=be&&be!=="Infinity"?Number(be)>=w:Number(ge??0)>=w}catch{}let Ge=ue?o.buyNext(e.id,w):o.buyMax(e.id);(Ge.bought instanceof c?Ge.bought:c.fromAny(Ge.bought??0)).isZero?.()||(tn(),Or(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let ce=ye.querySelector(".btn-buy-next");ce&&ce.remove()}}},h=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,h)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",h),p(),nn.classList.add("is-open"),nn.classList.toggle("is-automation-upgrade",t==="automation"),nn.style.pointerEvents="auto",_n(140),st.style.transition="none",st.style.transform="translateY(100%)",st.offsetHeight,requestAnimationFrame(()=>{st.style.transition="",st.style.transform=""}),jc=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,h)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",h)}}function Nd(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let p=Math.max(0,d-r.startY);r.lastY=d,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(Io(100),_n(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var ky,Ow,Pw,Bw,Ty,Fw,Uw,Dw,Ny,$w,qw,Fy,Uy,Hw,Ry,rl,Jc,nn,st,Qc,jc,ii=Fe(()=>{vt();It();Kt();ro();Yc();oc();Pn();oo();es();ti();ds();Zd();ky={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},Ow="img/misc/locked_base.webp",Pw="img/misc/maxed.webp",Bw="img/misc/green_border.webp",Ty={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},Fw=7,Uw={coins:Ta,books:Na,gold:Ra,magic:Oa};Dw={coins:Ta,books:Na,gold:Ra,magic:Oa};Ny={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Jd(Xn()),getUiModel:e=>Ns(Xn(),e),buyOne:e=>ks(Xn(),e),buyMax:e=>il(Xn(),e),buyCheap:e=>sl(Xn(),e),buyNext:(e,t)=>Ts(Xn(),e,t),getLockState:e=>Mo(Xn(),e),evolve:e=>eu(Xn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",Vd,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Jd(Ke),getUiModel:e=>Ns(Ke,e),buyOne:e=>ks(Ke,e),buyMax:e=>il(Ke,e),buyCheap:e=>sl(Ke,e),buyNext:(e,t)=>Ts(Ke,e,t),getLockState:e=>Mo(Ke,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>Jd("dna"),getUiModel:e=>Ns("dna",e),buyOne:e=>ks("dna",e),buyMax:e=>il("dna",e),buyCheap:e=>sl("dna",e),buyNext:(e,t)=>Ts("dna",e,t),getLockState:e=>Mo("dna",e),evolve:e=>eu("dna",e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||Or(!0)});$w="sounds/purchase_upg.ogg",qw="sounds/evolve_upg.ogg",Fy=.12,Uy=.3;Hw="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",Ry="ccc-scroll-timeline-styles";rl=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return By(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!yy(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let Y=document.createElement("div");Y.className="shop-tile";let fe=document.createElement("img");fe.className="base",fe.alt="";let me=document.createElement("img");me.className="icon",me.alt="",me.addEventListener("error",()=>{me.src=Hw}),Y.appendChild(fe),Y.appendChild(me),i.appendChild(Y),t.appendChild(i),i.addEventListener("click",Z=>{let re=Z.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){Z.preventDefault(),Z.stopImmediatePropagation();return}if(eo(re)){Z.preventDefault(),Z.stopImmediatePropagation();return}if(Z.shiftKey||Z.ctrlKey){if(Z.preventDefault(),Z.stopImmediatePropagation(),!re.upgMeta)return;let ye=re.upgMeta.id,Le=re.upgMeta.upgType==="HM",le=[1,3,4,5,6].includes(Qd(re.upgMeta));if(Z.shiftKey){if((Le||!le)&&this.adapter.buyCheap){let{bought:_e}=this.adapter.buyCheap(ye);(_e instanceof c?_e:c.fromAny(_e??0)).isZero?.()||(tn(),this.update());return}let{bought:Ie}=this.adapter.buyMax(ye);if(!(Ie instanceof c?Ie:c.fromAny(Ie??0)).isZero?.()){if(tn(),Kc(re.upgMeta,this.mode))try{ol(["reset"])}catch{}this.update()}return}if(Z.ctrlKey){if(Le){let _e=this.adapter.getUiModel(ye);if(_e&&!_e.hmReadyToEvolve){let Oe=_e.hmNextMilestone;if(Oe&&_e.lvlBn&&Oe.cmp(_e.lvlBn)>0){let ce=0;try{let oe=Oe.sub(_e.lvlBn).toPlainIntegerString?.();ce=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Oe.sub(_e.lvlBn).toString())))}catch{}let te=P[_e.upg.costType]?.value,we=te instanceof c?te:c.fromAny(te??0),V=yi(_e.upg,_e.lvlBn,we,ce).count,z=!1;try{let oe=V?.toPlainIntegerString?.();z=oe&&oe!=="Infinity"?Number(oe)>=ce:Number(V??0)>=ce}catch{}if(z){let oe=this.adapter.buyNext(ye,ce);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(tn(),this.update());return}}}}let{bought:Ie}=this.adapter.buyMax(ye);if(!(Ie instanceof c?Ie:c.fromAny(Ie??0)).isZero?.()){if(tn(),Kc(re.upgMeta,this.mode))try{ol(["reset"])}catch{}this.update()}return}}re.upgMeta&&zw(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",Z=>{if(ze)return;let re=Z.currentTarget;if(re.dataset.locked==="1"||(Z.preventDefault(),Z.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:Ie}=this.adapter.evolve(re.upgMeta.id);Ie&&(Dy(),this.update());return}let{bought:Le}=this.adapter.buyMax(re.upgMeta.id);if(!(Le instanceof c?Le:c.fromAny(Le??0)).isZero?.()){if(tn(),Kc(re.upgMeta,this.mode))try{ol(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let h=s?c.fromInt(0):Ww(r.meta,r.levelNumeric,r.level),m=h instanceof c?h:c.fromAny(h),y=ne(r.level),g=Zc(y),v=ne(m),E=Zc(v),C=!m.isZero?.(),A=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,N=Number.isFinite(A)?Math.max(0,Math.floor(A)):1/0,H=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,F=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(N)&&Number.isFinite(H)?H>=N:!1,q=Number.isFinite(N)&&N===1,L=!!r.meta?.unlockUpgrade,B=!s&&L&&!F,M=!s&&L&&!B&&F,x,X,J=!1,se=!1;if(s){x="",X="";let Y=u?(r.lockState?.reason||"").trim():"",fe=Y?`${r.title} (Locked, ${Y})`:`${r.title} (Locked)`;i.setAttribute("aria-label",fe)}else{if(B||M)x=B?"Unlockable":"Unlocked",X=x,se=!0;else if(!s&&q&&!L)F?(x="Owned",X="Owned"):C?(x="Purchasable",X="Purchasable"):(x="Not Owned",X="Not Owned"),se=!0;else{let Y=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,fe=String(g||"").replace(/,/g,""),me=/|Infinity/i.test(fe),Z=Number.isFinite(Y)?Y>=1e3:me||/^\d{4,}$/.test(fe);J=C&&Z,J?(x=`<span class="badge-lvl">${y}</span><span class="badge-plus">(+${v})</span>`,X=`${g} (+${E})`):(x=C?`${y} (+${v})`:y,X=C?`${g} (+${E})`:g)}i.setAttribute("aria-label",`${r.title}, ${X}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let K=i.firstElementChild,Q=K.querySelector(".base"),ve=K.querySelector(".icon"),he=r.meta?.costType||"coins",ee=r.useLockedBase||s?Ow:r.baseIconOverride||ky[he]||ky.coins;Q.src!==ee&&(Q.src=ee);let $=r.icon;if(!$)ve.hidden||(ve.hidden=!0);else{ve.hidden&&(ve.hidden=!1);let Y=$;ve._lastSrc!==Y&&(ve.src=Y,ve._lastSrc=Y)}let U=K.querySelector(".maxed-overlay"),j=!s&&Py(r.meta),ie=!s&&F;if(ie||!s&&!F&&!p&&j){U||(U=document.createElement("img"),U.className="maxed-overlay",U.alt="",K.insertBefore(U,ve));let Y=ie?Pw:Bw;U.src!==Y&&(U.src=Y)}else U&&U.remove();let _=K.querySelector(".level-badge");s?_&&_.remove():(_||(_=document.createElement("span"),_.className="level-badge",K.appendChild(_)),_.className="level-badge",se&&_.classList.add("text-badge"),J&&_.classList.add("two-line"),(C||B)&&_.classList.add("can-buy"),F&&_.classList.add("is-maxed"),x===X?_.textContent!==x&&(_.textContent=x):_.innerHTML!==x&&(_.innerHTML=x))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),ws(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&eo(a)||(Rr(),Ey())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(ze&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{ze&&_n(80),this.close()},{passive:!0}),Nd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&My(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,ze)try{setTimeout(()=>Io(240),120)}catch{}_n(10),ws(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},Jc={standard:new rl("standard"),automation:new rl("automation"),dna:new rl("dna")};nn=null,st=null,Qc=!1,jc=null});var Xy={};St(Xy,{applyHudLayout:()=>tr,initHudButtons:()=>jw,isMapUnlocked:()=>op,isShopUnlocked:()=>np,lockMap:()=>iu,lockShop:()=>ru,unlockMap:()=>ou,unlockShop:()=>vi});function tp(e){let t=b();return t==null?e:`${e}:${t}`}function Rs(e){let t=tp(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function np(){return rp(),Rs(uo.SHOP)}function op(){return rp(),Rs(uo.MAP)}function nu(e,t){let n=t?"1":"0",o=tp(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function rp(){for(let e of Object.values(uo)){let t=tp(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function Ao(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function ep(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",Xi())}function Kw(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function tr(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=Kw(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(h=>e.querySelector(`.game-btn[data-btn="${h}"]`)).filter(Boolean),a=[...e.children].filter(h=>!l.includes(h)),u=[...l,...a];if(u.length&&u.some((h,m)=>e.children[m]!==h)){let h=document.createDocumentFragment();u.forEach(m=>h.appendChild(m)),e.appendChild(h)}let p=[...e.querySelectorAll(".game-btn")].filter(h=>!h.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(h=>{h.style.gridColumn="",h.style.gridRow="",h.classList.remove("span-2"),h.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let h=getComputedStyle(e),m=parseFloat(h.columnGap||h.gap||"0")||0,y=e.clientWidth,g=Math.max(180,Math.floor((y-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let h=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),y=e.querySelector('[data-btn="shop"]:not([hidden])');h&&m&&y&&(h.style.gridColumn="1",h.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",y.style.gridColumn="1 / -1",y.style.gridRow="2")}}function jw(){if(rp(),Ao("help",!0),Ao("stats",!0),Ao("shop",Rs(uo.SHOP)),Ao("map",Rs(uo.MAP)),ep(),tr(),Gy||(Gy=!0,window.addEventListener("resize",tr),window.addEventListener("orientationchange",tr),window.addEventListener("saveSlot:change",()=>{Ao("shop",Rs(uo.SHOP)),Ao("map",Rs(uo.MAP)),ep(),tr()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||ep()})),!Hy){Hy=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&ls()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&eo(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function vi(){nu(uo.SHOP,!0),Ao("shop",!0),tr()}function ou(){nu(uo.MAP,!0),Ao("map",!0),tr()}function ru(){nu(uo.SHOP,!1),Ao("shop",!1),tr()}function iu(){nu(uo.MAP,!1),Ao("map",!1),tr()}var uo,Gy,Hy,su=Fe(()=>{ii();vt();es();uo={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Gy=!1,Hy=!1});function Wy(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(Y=>Y.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let _=0;_<t;_++)d[_*f+2]=1/0;let p=new Int16Array(t),h=t;for(let _=0;_<t;_++)p[_]=t-1-_;let m=-1,y=document.createElement("canvas");y.className="cursor-trail-canvas",Object.assign(y.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(y);let g=y.getContext("2d",{alpha:!0,desynchronized:!0}),v=document.createElement("canvas");v.width=a,v.height=a;let E=v.getContext("2d");E.shadowColor="#FFEB3B",E.shadowBlur=l,E.fillStyle="#FFEB3B",E.beginPath(),E.arc(u,u,s,0,Math.PI*2),E.fill();let C=!1,A=null,N=null,H={left:0,top:0,width:0,height:0},F=1,q=!1,L=0,B=0,M=!1,x=null,X=[],J=()=>{if(q)return;let _=document.documentElement.clientWidth,Y=document.documentElement.clientHeight;H={left:0,top:0,width:_,height:Y,right:_,bottom:Y,x:0,y:0}},se=()=>{if(q)return;J();let _=Math.min(window.devicePixelRatio||1,2);F=H.width>0?Math.min(_,512/H.width):_,y.width=H.width*F,y.height=H.height*F,g.scale(F,F),x=null},K=null;typeof ResizeObserver<"u"&&(K=new ResizeObserver(()=>{se()}),K.observe(e));let Q=(_,Y)=>{if(h<=0)return;let fe=p[--h];fe>m&&(m=fe);let me=fe*f;d[me]=_,d[me+1]=Y,d[me+2]=0,d[me+3]=n},ve=(_,Y,fe)=>{if(A===null||N===null)fe.count<r&&(Q(_,Y),fe.count++);else{let me=_-A,Z=Y-N,re=Math.hypot(me,Z);if(re>=o){let ye=Math.floor(re/o);for(let Le=1;Le<=ye&&!(fe.count>=r);Le++){let le=Le*o/re;Q(A+me*le,N+Z*le),fe.count++}}fe.count<r&&(Q(_,Y),fe.count++)}A=_,N=Y},he=_=>{if(q)return;L||(B=0,L=requestAnimationFrame(ee)),H.width||J();let Y=0,fe=0,me=(Z,re)=>Z>=0&&Z<=H.width&&re>=0&&re<=H.height;if(_.getCoalescedEvents){let Z=_.getCoalescedEvents();if(Z.length>0)for(let re of Z){let ye=re.clientX-Y,Le=re.clientY-fe;X.push({x:ye,y:Le,inside:me(ye,Le)})}else{let re=_.clientX-Y,ye=_.clientY-fe;X.push({x:re,y:ye,inside:me(re,ye)})}}else{let Z=_.clientX-Y,re=_.clientY-fe;X.push({x:Z,y:re,inside:me(Z,re)})}},W=()=>{C=!1,A=null,N=null,X.length=0},ee=()=>{if(q)return;let _=performance.now();B||(B=_);let Y=_-B;B=_,Y>100&&(Y=100);let fe={count:0};if(X.length>0){for(let Re of X)Re.inside?(C=!0,ve(Re.x,Re.y,fe)):(C=!1,A=null,N=null);let Ie=X[X.length-1];Ie.inside&&(A!==Ie.x||N!==Ie.y)&&(Q(Ie.x,Ie.y),A=Ie.x,N=Ie.y),X.length=0}else C&&A!==null&&N!==null&&Q(A,N);let me=t-h;if(me===0&&!M){L=0;return}x?g.clearRect(x.x,x.y,x.w,x.h):g.clearRect(0,0,H.width,H.height),M=!1;let Z=1/0,re=1/0,ye=-1/0,Le=-1/0,le=-1;if(me>0)for(let Ie=0;Ie<=m;Ie++){let Re=Ie*f,_e=d[Re+2];if(_e>=d[Re+3])continue;if(_e+=Y,d[Re+2]=_e,_e>=d[Re+3]){p[h++]=Ie;continue}le=Ie;let Oe=d[Re+3],ce=_e/Oe,te=1-ce,we=1-.4*ce;M=!0,g.globalAlpha=te;let w=a*we,V=w/2,z=d[Re],oe=d[Re+1],ge=Math.round(z-V),ue=Math.round(oe-V),Ge=Math.round(w);g.drawImage(v,ge,ue,Ge,Ge),ge<Z&&(Z=ge),ue<re&&(re=ue);let nt=ge+Ge,be=ue+Ge;nt>ye&&(ye=nt),be>Le&&(Le=be)}m=le,Z!==1/0?(Z-=2,re-=2,ye+=2,Le+=2,x={x:Z,y:re,w:ye-Z,h:Le-re}):x=null,L=requestAnimationFrame(ee)};window.addEventListener("resize",se),window.addEventListener("scroll",J,{passive:!0}),window.addEventListener("focus",J,{passive:!0}),document.addEventListener("visibilitychange",J,{passive:!0});let $={passive:!0},U=_=>{J(),he(_)},j=_=>{J(),he(_)};e.addEventListener("pointermove",he,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",U,$),e.addEventListener("pointerleave",W,$),e.addEventListener("pointercancel",W,$),se(),L=requestAnimationFrame(ee);let ie=setInterval(J,1e3);return{destroy:()=>{q=!0,L&&cancelAnimationFrame(L),ie&&clearInterval(ie),K&&(K.disconnect(),K=null);try{window.removeEventListener("resize",se)}catch{}try{window.removeEventListener("scroll",J)}catch{}try{window.removeEventListener("focus",J)}catch{}try{document.removeEventListener("visibilitychange",J)}catch{}try{e.removeEventListener("pointermove",he),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",U),e.removeEventListener("pointerleave",W),e.removeEventListener("pointercancel",W)}catch{}y.remove()}}}var Vy=Fe(()=>{});var ov={};St(ov,{clearPendingGains:()=>mp,getPassiveCoinReward:()=>Fc,initCoinPickup:()=>iE,setCoinMultiplier:()=>eE,triggerPassiveCollect:()=>bd});function Yy(e){if(!e||typeof e!="object"){ll=!1,au=!1,lu="0",Ii.clear();return}ll=!!e.unlocked,au=!!e.level?.isInfinite?.();try{lu=e.level?.toPlainIntegerString?.()??"0"}catch{lu="0"}ll?au&&Ii.clear():Ii.clear()}function Zw(){if(typeof bi=="function")try{bi()}catch{}try{Yy(dt())}catch{ll=!1,Ii.clear()}try{bi=wi(e=>{Yy(e)})}catch{bi=null}}function eE(e){Qw=e;try{P.coins?.mult?.set&&P.coins.mult.set(e)}catch{}}function lp(){try{let e=xc();e instanceof c?Ps=e.clone?.()??e:e!=null?Ps=c.fromAny(e):Ps=c.fromInt(1)}catch{Ps=c.fromInt(1)}}function tE(){zy||(zy=!0,lp(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",lp),typeof window<"u"&&window.addEventListener("saveSlot:change",lp))}function nE(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return dp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function fp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*oE:0}function rE({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,p=0,h=null,m=null,y=fp(),g=0,v=0,E=0,C=!1,A=null,N=null,H=()=>{if(C)return;let $=document.documentElement.clientWidth,U=document.documentElement.clientHeight;A={left:0,top:0,width:$,height:U,right:$,bottom:U,x:0,y:0}},F=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",h=null,m=null},q=()=>{if(!l||v<=0){F();return}let $=v*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${d-v}px, ${p-v}px, 0)`,s.classList.add("is-visible")},L=()=>{if(!(!l||v<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=v+cp,U=[];if(typeof i.findCoinTargetsInPath=="function"&&h!==null&&m!==null?U=i.findCoinTargetsInPath(h,m,d,p,$):U=i.findCoinTargetsInRadius(d,p,$),h=d,m=p,U&&U.length>0)if(typeof r=="function"){let j=[];for(let ie=0;ie<U.length;ie++){let ae=U[ie],_={coin:ae};ae.el&&i.getCoinTransform&&(_.opts={transform:i.getCoinTransform(ae.el)}),j.push(_)}r(j)}else for(let j=0;j<U.length;j++){let ie=U[j],ae=i.ensureCoinVisual?i.ensureCoinVisual(ie):ie.el;if(ae){let _=i.getCoinTransform?i.getCoinTransform(ae):ae.style.transform||"";o(ae,{transform:_})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=v+cp,U=i.findCoinsInRadius(d,p,$);if(h=d,m=p,U&&U.length>0){let j=[];for(let ie=0;ie<U.length;ie++){let ae=U[ie],_=i.getCoinTransform?i.getCoinTransform(ae):ae.style.transform;j.push({el:ae,opts:{transform:_}})}typeof r=="function"&&r(j)}}else{let $=t.children,U=v+cp,j=[];for(let ie=$.length-1;ie>=0;ie--){let ae=$[ie];if(ae.dataset.collected==="1"||!ae.matches(n))continue;let _=ae.getBoundingClientRect(),Y=_.left+_.width/2,fe=_.top+_.height/2,me=Y-u,Z=fe-f;Math.hypot(me,Z)<=U&&j.push(ae)}if(!j.length)return;if(typeof r=="function"){let ie=[];for(let ae=0;ae<j.length;ae++){let _=j[ae],Y=window.getComputedStyle(_);ie.push({el:_,opts:{transform:Y.transform}})}r(ie)}else{let ie=[];for(let ae=0;ae<j.length;ae++){let _=j[ae],Y=window.getComputedStyle(_);ie.push(Y.transform)}for(let ae=0;ae<j.length;ae++)o(j[ae],{transform:ie[ae]})}}},B=()=>{E=0,q(),!(!l||v<=0||C)&&(L(),M())},M=()=>{!l||v<=0||E||C||(E=requestAnimationFrame(B))},x=$=>{if(!$||C||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,f=$.clientY,A||H();let U=A;d=u,p=f,l=d>=0&&d<=U.width&&p>=0&&p<=U.height,M()},X=()=>{l=!1,F(),h=null,m=null},J=()=>{h=null,m=null},se=()=>{g=Lc(),v=g*y,q(),M()},K=()=>{if(!(C||!a)){if(H(),A){let $=A;d=u-$.left,p=f-$.top,l=d>=0&&d<=$.width&&p>=0&&p<=$.height}M()}},Q=()=>{if(y=fp(),v=g*y,H(),a&&A){let $=A;d=u-$.left,p=f-$.top,l=d>=0&&d<=$.width&&p>=0&&p<=$.height}M()},ve=$=>{H(),x($)},he=$=>{J(),ve($)},W=()=>{C=!0,E&&(cancelAnimationFrame(E),E=0),N&&clearInterval(N);try{window.removeEventListener("scroll",K)}catch{}try{window.removeEventListener("resize",Q)}catch{}try{window.removeEventListener("saveSlot:change",se)}catch{}try{document.removeEventListener("ccc:upgrades:changed",se)}catch{}try{e.removeEventListener("pointermove",x)}catch{}try{e.removeEventListener("pointerdown",ve)}catch{}try{e.removeEventListener("pointerenter",he)}catch{}try{e.removeEventListener("pointerleave",X)}catch{}try{e.removeEventListener("pointercancel",X)}catch{}try{window.removeEventListener("blur",J)}catch{}try{s.remove()}catch{}},ee={passive:!0};return e.addEventListener("pointermove",x,ee),e.addEventListener("pointerdown",ve,ee),e.addEventListener("pointerenter",he,ee),e.addEventListener("pointerleave",X,ee),e.addEventListener("pointercancel",X,ee),window.addEventListener("resize",Q),window.addEventListener("scroll",K,{passive:!0}),window.addEventListener("focus",H,{passive:!0}),window.addEventListener("blur",J,{passive:!0}),document.addEventListener("visibilitychange",()=>{H(),document.hidden&&J()},{passive:!0}),window.addEventListener("saveSlot:change",se),document.addEventListener("ccc:upgrades:changed",se),N=setInterval(H,1e3),se(),{destroy:W}}function mp(){cl=null,ul=null,fl=null}function nv(e){let t=dp.clone?.()??c.fromInt(1),n=ev(t),o=fo(Ky),i=tv(e??lu);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof ko=="function"&&ko()?fo(Ps):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function Fc(){let{coinGain:e,xpGain:t,mpGain:n}=nv(null);return{coins:e,xp:t,mp:n}}function bd(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=nv(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=Bn(Ce.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{Cn=Cn?.add?Cn.add(r):fo(r)}catch{Cn=fo(r)}al(),a||jy(r);let u=typeof cn=="function"?cn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&Zy(i),s.isZero?.()||Jy(s)}function iE({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){ip?.destroy&&ip.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};Zw(),tE(),a.style.touchAction="none";let d=null,p=null;Cn=P.coins.value,up=()=>{let _=ne(Cn);_.includes("<span")?f.innerHTML=_:f.textContent=_},Qy(),al();let h=_=>{_?.detail&&_.detail.key==="coins"&&(Cn=_.detail.value,al())};window.addEventListener("currency:change",h);let m=_=>{if(!(!_?.detail||_.detail.key!=="coins"))try{let{mult:Y}=_.detail;Y instanceof c?Wn=Y.clone?.()??Y:Y!=null?Wn=c.fromAny(Y):Wn=c.fromInt(1),Si=!!Wn?.isInfinite?.()}catch{Wn=null,Si=!1}};window.addEventListener("currency:multiplier",m);let y=b();if(y==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${y}`,v=`ccc:unlock:shop:progress:${y}`,E=localStorage.getItem("ccc:unlock:shop:progress"),C=localStorage.getItem("ccc:unlock:shop");E!=null&&localStorage.getItem(v)==null&&localStorage.setItem(v,E),C!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,C),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let _=parseInt(localStorage.getItem(v)||"0",10);if(localStorage.setItem(v,String(_)),_>=10&&localStorage.getItem(g)!=="1"){try{vi()}catch{}localStorage.setItem(g,"1")}}let A=new URL(i,document.baseURI).href,N=_=>_ instanceof HTMLElement?_._coinObj?!_._coinObj.isRemoved&&_.dataset.collected!=="1":_.dataset.collected!=="1"&&_.matches(r):!1;function H(_){try{_.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(H);let F=ze?.12:.3,q=0;function L(_=A){if(_===A){let Y=performance.now();if(Y-q<40)return;q=Y}ct(_,{volume:F})}function B(_,Y={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(_);let fe=()=>{_&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(_):_.remove())};if(l||ze){fe();return}let me="translate3d(0,0,0)";Y.transform?Y.transform!=="none"&&(me=Y.transform):me=_.style.transform||"translate3d(0,0,0)",_.style.setProperty("--ccc-start",me),_.classList.add("coin--collected");let Z=!1,re=()=>{Z||(Z=!0,_.removeEventListener("animationend",re),fe())};_.addEventListener("animationend",re),setTimeout(re,600)}function M(_){if(!_||!_.length)return;let Y=A,fe=-1,me=!1;for(let ce of _){let te=ce.coin||ce.el&&ce.el._coinObj;te&&(te.sizeIndex!==void 0?te.sizeIndex>fe&&(fe=te.sizeIndex,te.soundSrc&&(Y=te.soundSrc,me=!0)):te.soundSrc&&!me&&(Y=te.soundSrc,me=!0))}L(Y);let Z=null,re=null,ye=null,Le=0,le=Bn(Ce.COINS),Ie=typeof cn=="function"?cn():!0,Re=typeof ko=="function"&&ko(),_e=15,Oe=0;for(let ce of _){let te=ce.el,we=ce.coin;if(!we&&te&&te._coinObj&&(we=te._coinObj),te&&!N(te)||we&&we.isRemoved)continue;Le++,te&&(te.dataset.collected="1"),Oe<_e?(!te&&we&&e&&e.ensureCoinVisual&&(te=e.ensureCoinVisual(we),te&&(te.dataset.collected="1")),te?(B(te,ce.opts||{}),Oe++):we&&e&&e.removeCoinTarget&&e.removeCoinTarget(we)):we&&e&&e.removeCoinTarget?e.removeCoinTarget(we):te&&(e&&e.detachCoin&&e.detachCoin(te),e&&e.recycleCoin?e.recycleCoin(te):te.remove());let w=te?nE(te):dp,V=we?.mutationLevel??(te?.dataset?.mutationLevel||null),z=ev(w),oe=fo(Ky),ge=fo(Ps);if(we&&we.valueMultiplier&&we.valueMultiplier>1){try{z=z.mulDecimalFloor(we.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(we.valueMultiplier)}catch{}try{ge=ge.mulDecimalFloor(we.valueMultiplier)}catch{}}let ue=tv(V);if(ue){try{z=z.mulBigNumInteger(ue)}catch{}try{oe=oe.mulBigNumInteger(ue)}catch{}}le||(Z=Bs(Z,z)),Ie&&(re=Bs(re,oe)),Re&&(ye=Bs(ye,ge))}if(Le!==0){if(Z&&!Z.isZero?.()){try{Cn=Cn?.add?Cn.add(Z):fo(Z)}catch{Cn=fo(Z)}jy(Z),al()}if(re&&!re.isZero?.()&&Zy(re),ye&&!ye.isZero?.()&&Jy(ye),localStorage.getItem(g)!=="1"){let te=parseInt(localStorage.getItem(v)||"0",10)+Le;if(localStorage.setItem(v,String(te)),te>=10){try{vi()}catch{}localStorage.setItem(g,"1")}}}}function x(_,Y={}){return M([{el:_,opts:Y}]),!0}d=rE({playfield:a,coinsLayer:u,coinSelector:r,collectFn:x,collectBatchFn:M,spawner:e}),p=Wy(a);let X=_=>{if(_.target===u)return;let Y=_.target.closest(r);if(Y&&N(Y)){let fe={};e&&typeof e.getCoinTransform=="function"&&(fe.transform=e.getCoinTransform(Y)),x(Y,fe)}};u.addEventListener("pointerdown",X,{passive:!0}),ze||u.addEventListener("mouseover",X,{passive:!0});let J=25,se=null,K=()=>{let _=document.documentElement.clientWidth,Y=document.documentElement.clientHeight;se={left:0,top:0,width:_,height:Y,right:_,bottom:Y,x:0,y:0}};window.addEventListener("resize",K),window.addEventListener("scroll",K,{passive:!0}),K();let Q=null,ve=null,he=()=>{Q=null,ve=null};a.addEventListener("pointerleave",he,{passive:!0}),a.addEventListener("pointerenter",he,{passive:!0}),window.addEventListener("blur",he,{passive:!0});function W(_,Y){if(e&&typeof e.findCoinTargetsInRadius=="function"){se||K();let fe=_,me=Y,Z=[];if(typeof e.findCoinTargetsInPath=="function"&&Q!==null&&ve!==null?Z=e.findCoinTargetsInPath(Q,ve,fe,me,J,!0):Z=e.findCoinTargetsInRadius(fe,me,J,!0),Q=fe,ve=me,Z&&Z.length>0){let re=[];for(let ye=0;ye<Z.length;ye++){let Le=Z[ye],le={coin:Le};Le.el&&e.getCoinTransform&&(le.opts={transform:e.getCoinTransform(Le.el)}),re.push(le)}M(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){se||K();let fe=_,me=Y,Z=e.findCoinsInRadius(fe,me,J);if(Q=fe,ve=me,Z&&Z.length>0){let re=[];for(let ye of Z){let Le=e.getCoinTransform?e.getCoinTransform(ye):ye.style.transform;re.push({el:ye,opts:{transform:Le}})}M(re)}}else{let fe=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],me=new Set;for(let Z=0;Z<fe.length;Z++){let re=_+fe[Z][0],ye=Y+fe[Z][1],Le=document.elementsFromPoint(re,ye);for(let le=0;le<Le.length;le++){let Ie=Le[le];N(Ie)&&!me.has(Ie)&&me.add(Ie)}}if(me.size>0){let Z=[];me.forEach(re=>Z.push({el:re})),M(Z)}}}let ee=null,$=!1;function U(_,Y){ee={x:_,y:Y},$||($=!0,requestAnimationFrame(()=>{ee&&(W(ee.x,ee.y),ee=null),$=!1}))}a.addEventListener("pointerdown",_=>{U(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("pointermove",_=>{_.pointerType!=="mouse"&&U(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("pointerup",_=>{_.pointerType!=="mouse"&&U(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("mousemove",_=>{U(_.clientX,_.clientY)},{passive:!0});function j(_){}let ie=setInterval(K,1e3),ae=()=>{if(clearInterval(ie),cu(),up=()=>{},typeof window<"u"&&(window.removeEventListener("resize",K),window.removeEventListener("beforeunload",cu),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",h),window.removeEventListener("blur",he)),typeof bi=="function"){try{bi()}catch{}bi=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",X),ze||u.removeEventListener("mouseover",X)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(_=>a.replaceWith(a.cloneNode(!0)))}catch{}};return ip={destroy:ae},{get count(){return Cn},set count(_){Cn=c.fromAny?c.fromAny(_):c.fromInt(Number(_)||0),al()},setMobileVolume:j,destroy:ae,collectBatch:M,getMagnetUnitPx:fp}}var ll,au,lu,bi,ip,Ky,dp,Jw,Os,Ii,Qw,Ps,zy,cl,ul,fl,sp,Cn,up,ap,al,oE,cp,fo,Bs,cu,pp,jy,Zy,Jy,Wn,Si,Qy,ev,tv,Xa=Fe(()=>{vt();It();Kt();su();qn();ro();xo();oo();Vy();Pn();ll=!1,au=!1,lu="0",bi=null;ip=null,Ky=c.fromInt(1),dp=c.fromInt(1),Jw=c.fromInt(1);try{Os=c.fromAny("Infinity")}catch{Os=null}Ii=new Map,Qw="1",Ps=c.fromInt(1),zy=!1,cl=null,ul=null,fl=null,sp=!1,Cn=null,up=()=>{},ap=!1,al=()=>{ap||(ap=!0,requestAnimationFrame(()=>{ap=!1,up()}))};oE=.05,cp=8;fo=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Bs=(e,t)=>{if(!t)return e;if(!e)return fo(t);try{return e.add(t)}catch{try{return fo(e).add(t)}catch{return fo(t)}}},cu=()=>{let e=cl;if(cl=null,e&&!e.isZero?.())try{P.coins.add(e)}catch{}let t=ul;if(ul=null,t&&!t.isZero?.())try{Zi(t)}catch{}let n=fl;if(fl=null,n&&!n.isZero?.())try{Es(n)}catch{}},pp=()=>{sp||(sp=!0,requestAnimationFrame(()=>{sp=!1,cu()}))},jy=e=>{cl=Bs(cl,e),pp()},Zy=e=>{ul=Bs(ul,e),pp()},Jy=e=>{fl=Bs(fl,e),pp()};typeof window<"u"&&window.addEventListener("beforeunload",cu,{passive:!0});Wn=null,Si=!1,Qy=()=>{try{let e=P?.coins?.mult;if(!e||typeof e.get!="function"){Wn=null,Si=!1;return}let t=e.get();if(!t){Wn=c.fromInt(1),Si=!1;return}Wn=t.clone?.()??c.fromAny(t),Si=!!Wn?.isInfinite?.()}catch{Wn=null,Si=!1}},ev=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Wn||Qy();let n=Wn;if(!n)try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(Si||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},tv=e=>{if(!ll)return null;if(au){if(Os)try{return Os.clone?.()??Os}catch{return Os}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=Ii.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{Ii.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=Fs(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(Jw)===0,s=r.clone?.()??r;if(Ii.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function sE(e){if(e==null)return 0;try{let t=localStorage.getItem(iv(e));return t?parseInt(t,10):0}catch{return 0}}function aE(e,t){if(e!=null)try{localStorage.setItem(iv(e),t.toString())}catch{}}function sv(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let a=Number(e.toString());isNaN(a)||(t=a),(e==="Infinity"||a===1/0)&&(n=!0)}catch{}let o=b(),r=sE(o),i=r;console.log(`[Surge9] Slot: ${o}, s9State: ${r}, currentSurgeLevel: ${e}, isSurge8: ${n}`),i<1&&n&&(i=1),i<2&&mt(4)>=1&&(i=2),i!==r&&(console.log(`[Surge9] Transitioning state ${r} -> ${i}`),r=i,aE(o,r));let s=[],l=[];for(let a of rv){let u=a;if(n){u={...a,description:[...a.description]};let f=En(),d=Lo(),p=f+d;if(p>1&&(p=1),a.id===1){let h=Math.pow(10,p),m=We(h);u.description[0]=u.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${m}x</span>`)}else if(a.id===2){let h=Math.pow(10,p),m=We(h);u.description[1]=u.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${m}x</span>`)}else if(a.id===4){let h=Math.log10(4444e9),m=Me(h*p),y=ne(m);u.description[0]=u.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${y}x</span>`)}}a.id===9&&(u===a&&(u={...a,description:[...a.description]}),r===0?(u.description=["This milestone is hidden for now"],console.log("[Surge9] Hiding description (State 0)")):r===1?(u.description=["This milestone is hidden until you research Lab Node 4"],console.log("[Surge9] Showing hint (State 1)")):console.log("[Surge9] Showing full description (State 2)")),a.surgeLevel<=t?s.push(u):l.push(u)}return[...s,...l.slice(0,2)]}var rv,hp,iv,av=Fe(()=>{Kt();It();It();io();ci();vt();rv=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${ne(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]}],hp=rv.filter(e=>e.affectedByTsunami).map(e=>e.id),iv=e=>`ccc:surge:milestone9:state:${e}`});function lv(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ct("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(w,V){w.style.position="absolute",w.style.left="50%";let z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ge=!!o.mpHTML;V==="coin"?(w.style.top="77%",w.style.transform=`translateX(-50%) ${z}`):oe&&ge?(w.style.top="72.5%",V==="mp"?w.style.transform=`translateX(calc(-100% - 44px)) ${z}`:w.style.transform=`translateX(44px) ${z}`):(V==="mp"?w.style.top="66%":V==="xp"&&(w.style.top="72%"),w.style.transform=`translateX(-50%) ${z}`),w.style.transformOrigin="center center";let ue=w.firstElementChild;ue&&(ue.removeAttribute("hidden"),ue.style.display="flex")}if(o.coinHTML){let w=document.createElement("div");w.innerHTML=o.coinHTML,f(w,"coin"),u.appendChild(w)}if(o.xpHTML){let w=document.createElement("div");w.innerHTML=o.xpHTML,f(w,"xp"),u.appendChild(w)}if(o.mpHTML){let w=document.createElement("div");w.innerHTML=o.mpHTML,f(w,"mp"),u.appendChild(w)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let p=new Image;p.src="img/misc/merchant.webp";let h=!1;p.onload=()=>{h=!0},p.onerror=w=>{console.error("Tsunami: Merchant load failed",w)};let m,y,g=[],v=[],E=0;function C(){g=[],v=[];let w=y*.65,V=w+y*.15,oe=300*(Math.min(m,y)*5e-4),ge=m*.8,ue=ge-oe*.6,Ge=ge+oe*.6;for(let lt=0;lt<100;lt++){let sn=Math.random()*m,kt=V+Math.random()*(y-V);v.push({x:sn,y:kt})}let nt=(lt,sn,kt)=>{if(lt>m*.1&&lt<m*.9){let vn=y-w,yo=w+vn*.15;if(sn>yo)return!1}else if(kt==="tree"){let vn=y-w,yo=w+vn*.5;if(sn>yo)return!1}return!(kt==="tree"&&lt>ue&&lt<Ge)},be=(lt,sn,kt,vn,yo)=>{for(let ur=0;ur<sn;ur++){let Fo,Uo,fr=!1,S=0;for(;!fr&&S<50;){yo?Fo=yo():Fo=Math.random()*m;let k=y,O=Math.random();if(Uo=w+20+O*O*(k-w-20),nt(Fo,Uo,lt)&&(fr=!0,lt==="tree")){for(let T of g)if(T.type==="tree"){let R=T.x-Fo,pe=T.y-Uo;if(Math.sqrt(R*R+pe*pe)<Math.max(m*.08,100)){fr=!1;break}}}S++}if(fr){let O=.6+(Uo-w)/(y-w)*.6,T=(kt+Math.random()*vn)*O;g.push({type:lt,x:Fo,y:Uo,scale:T})}}},Ue=3+Math.floor(Math.random()*3);be("tree",Ue,.8,.4,()=>Math.random()*(m*.1)),be("tree",Ue,.8,.4,()=>m*.9+Math.random()*(m*.1));let Gt=5+Math.floor(Math.random()*3);be("tree",Gt,.8,.4,()=>m*.1+Math.random()*(m*.8)),be("rock",20,.6,.4),be("shell",30,.3,.3),g.sort((lt,sn)=>lt.y-sn.y)}let A=a.getContext("2d",{alpha:!1}),N=d.getContext("2d",{alpha:!0});function H(){let w=window.devicePixelRatio||1;m=window.innerWidth,y=window.innerHeight,a.width=m*w,a.height=y*w,a.style.width=m+"px",a.style.height=y+"px",d.width=m*w,d.height=y*w,d.style.width=m+"px",d.style.height=y+"px",A.scale(w,w),N.scale(w,w),C(),E=-50}window.addEventListener("resize",H),H();let F=Date.now(),q=!0,L,B=!1,M={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},x={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},X=!1,J=[],se=0,K=!1,Q=0,ve=5e3,he=!1,W=0,ee=[],$=6;for(let w=0;w<$;w++)ee.push({offset:Math.random()*1e3,speedBase:.001+w*5e-4,amplitudeBase:10+w*5});let U=[],j=400;function ie(w,V,z){return w*(1-z)+V*z}function ae(w){let V=parseInt(w.slice(1),16);return{r:V>>16&255,g:V>>8&255,b:V&255}}function _(w,V,z){let oe=ae(w),ge=ae(V),ue=Math.round(ie(oe.r,ge.r,z)),Ge=Math.round(ie(oe.g,ge.g,z)),nt=Math.round(ie(oe.b,ge.b,z));return`rgb(${ue},${Ge},${nt})`}function Y(w,V,z){let oe=[],ge=w,ue=V,Ge=20;for(;ue<z;){let nt=ge+(Math.random()-.5)*60,be=ue+Ge+Math.random()*30;oe.push({x1:ge,y1:ue,x2:nt,y2:be}),ge=nt,ue=be}return oe}function fe(w,V,z,oe,ge,ue){w.beginPath(),w.moveTo(V+ue,z),w.lineTo(V+oe-ue,z),w.quadraticCurveTo(V+oe,z,V+oe,z+ue),w.lineTo(V+oe,z+ge-ue),w.quadraticCurveTo(V+oe,z+ge,V+oe-ue,z+ge),w.lineTo(V+ue,z+ge),w.quadraticCurveTo(V,z+ge,V,z+ge-ue),w.lineTo(V,z+ue),w.quadraticCurveTo(V,z,V+ue,z),w.closePath()}function me(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(10,-40,-5,-80),w.lineTo(5,-80),w.quadraticCurveTo(20,-40,10,0),w.fillStyle=ge.rock,w.fill(),w.translate(0,-80),w.fillStyle=ge.leaf;for(let ue=0;ue<7;ue++)w.save(),w.rotate(ue/7*Math.PI*2-Math.PI/2),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(30,-10,60,0),w.quadraticCurveTo(30,10,0,0),w.fill(),w.restore();w.restore()}function Z(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.fillStyle=ge.rock,w.beginPath(),w.moveTo(-20,0),w.bezierCurveTo(-20,-15,-10,-25,0,-25),w.bezierCurveTo(10,-25,20,-15,20,0),w.fill(),w.fillStyle="rgba(0,0,0,0.2)",w.beginPath(),w.ellipse(0,0,20,5,0,0,Math.PI*2),w.fill(),w.restore()}function re(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.fillStyle=ge.shell,w.beginPath(),w.arc(0,0,10,Math.PI,0),w.lineTo(0,0),w.fill(),w.strokeStyle=ge.sandDark,w.lineWidth=1,w.beginPath();for(let ue=1;ue<5;ue++){let Ge=Math.PI+ue/5*Math.PI;w.moveTo(0,0),w.lineTo(Math.cos(Ge)*10,Math.sin(Ge)*10)}w.stroke(),w.restore()}function ye(w,V,z,oe,ge){w.fillStyle=ge.sandDark,w.fillRect(-50,oe,V+100,z-oe),w.fillStyle=ge.sandDark,w.save(),w.fillStyle=ge.sandLight,w.globalAlpha=.3,w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,oe),w.bezierCurveTo(V*.3,oe-20,V*.7,oe+20,V+50,oe),w.lineTo(V+50,z+100),w.fill(),w.globalAlpha=.6;let ue=oe+z*.05;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,ue),w.bezierCurveTo(V*.4,ue+40,V*.6,ue-10,V+50,ue+20),w.lineTo(V+50,z+100),w.fill(),w.globalAlpha=1;let Ge=oe+z*.15;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,Ge),w.bezierCurveTo(V*.2,Ge-10,V*.8,Ge+30,V+50,Ge+10),w.lineTo(V+50,z+100),w.fill(),w.fillStyle=ge.sandDark,w.globalAlpha=.1,v.forEach(nt=>{w.fillRect(nt.x,nt.y,2,2)}),w.restore()}function Le(w,V,z,oe=null){let ge=oe||1,ue=!!oe&&oe>5;X&&!ue&&!he&&ct("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),J.push({x:ue?V/2:Math.random()*V,y:ue?z/2:Math.random()*z,radius:0,maxRadius:ue?Math.max(V,z)*1.5:(100+Math.random()*400)*ge,speed:ue?40:(5+Math.random()*15)*ge,opacity:1,hue:225+Math.random()*15,life:1})}function le(w,V,z,oe=.5,ge=!0){let ue=.1+oe*.7,Ge=Math.floor(1+oe*4);if(ge&&!he){for(let nt=0;nt<Ge;nt++)if(J.length<50&&Math.random()<ue){let be=1+oe*2;Le(w,V,z,be)}}w.save(),w.globalCompositeOperation="lighter";for(let nt=J.length-1;nt>=0;nt--){let be=J[nt];if(be.radius+=be.speed,be.opacity-=.015,be.life-=.015,be.opacity<=0||be.radius>be.maxRadius){J.splice(nt,1);continue}let Ue=w.createRadialGradient(be.x,be.y,0,be.x,be.y,be.radius),Gt=be.opacity;Ue.addColorStop(0,`hsla(${be.hue}, 100%, 80%, ${Gt})`),Ue.addColorStop(.3,`hsla(${be.hue}, 100%, 40%, ${Gt*.9})`),Ue.addColorStop(.7,`hsla(${be.hue}, 100%, 15%, ${Gt*.6})`),Ue.addColorStop(1,`hsla(${be.hue}, 100%, 5%, 0)`),w.fillStyle=Ue,w.beginPath(),w.arc(be.x,be.y,be.radius,0,Math.PI*2),w.fill()}w.restore()}function Ie(){if(!q)return;let w=Date.now(),V=w-F;Math.min(V/t,1)>=1&&!B&&(B=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ge=6e3,ue=5e4,Ge=5e4,nt=5e3,be=4e4,Ue=0;V<ge?Ue=0:V<ue?Ue=(V-ge)/(ue-ge):Ue=1;let Gt=0;V>be&&(Gt=Math.max(0,(V-be)/(ue-be))),V>ue&&(Gt=1),Gt>.1&&!i&&(i=ct("sounds/tsu_rumble.ogg",{volume:.8}));let lt={skyTop:_(M.skyTop,x.skyTop,Ue),skyBottom:_(M.skyBottom,x.skyBottom,Ue),sun:_(M.sun,x.sun,Ue),waterDeep:_(M.waterDeep,x.waterDeep,Ue),waterMid:_(M.waterMid,x.waterMid,Ue),waterPeak:_(M.waterPeak,x.waterPeak,Ue),foam:_(M.foam,x.foam,Ue),sandLight:_(M.sandLight,x.sandLight,Ue),sandDark:_(M.sandDark,x.sandDark,Ue),rock:_(M.rock,x.rock,Ue),leaf:_(M.leaf,x.leaf,Ue),shell:_(M.shell,x.shell,Ue)},sn=0,kt=0;if(Ue>.5||he){let S=(Ue-.5)*2*5+Gt*25;W>0&&(S+=50),sn=(Math.random()-.5)*S,kt=(Math.random()-.5)*S}N.clearRect(0,0,m,y),A.save(),A.translate(sn,kt),N.save(),N.translate(sn,kt);let vn=A.createLinearGradient(0,0,0,y);if(vn.addColorStop(0,lt.skyTop),vn.addColorStop(1,lt.skyBottom),A.fillStyle=vn,A.fillRect(-50,-50,m+100,y+100),Ue<1){let S=y*.15+Ue*50;A.beginPath(),A.arc(m*.7,S,40,0,Math.PI*2),A.fillStyle=lt.sun,A.globalAlpha=1-Ue,A.shadowColor=lt.sun,A.shadowBlur=20,A.fill(),A.globalAlpha=1,A.shadowBlur=0}let yo=y*.65;if(h&&Ue<1){A.save();let S=Math.min(m,y)*5e-4,k=300*S,O=300*S,T=m*.8,R=O*.15,pe=yo-O/2+R;A.translate(T,pe),A.rotate(.1),A.drawImage(p,-k/2,-O/2,k,O),A.restore()}if(ye(A,m,y,yo,lt),g.forEach(S=>{S.type==="tree"?me(A,S.x,S.y,S.scale,lt):S.type==="rock"?Z(A,S.x,S.y,S.scale,lt):S.type==="shell"&&re(A,S.x,S.y,S.scale,lt)}),Ue>.3){let S=(Ue-.3)/.7,k=Math.floor(j*S);if(N.strokeStyle=`rgba(120, 180, 255, ${.1+S*.3})`,N.lineWidth=1+S,N.beginPath(),U.length<k)for(let T=0;T<10;T++)U.push({x:Math.random()*m*1.5,y:E,speed:20+Math.random()*20,len:10+Math.random()*20});let O=10+S*20;for(let T=0;T<U.length;T++){let R=U[T];R.y+=R.speed,R.x-=O,N.moveTo(R.x,R.y),N.lineTo(R.x-O*.5,R.y+R.len),(R.y>y||R.x<-100)&&(T<k?(R.x=Math.random()*m*1.5,R.y=E):(U.splice(T,1),T--))}N.stroke()}let ur=.3;if(Ue>ur){let S=(Ue-ur)/(1-ur),k=ie(0,y*1.5,S*S);N.fillStyle=lt.waterDeep,N.beginPath(),N.moveTo(-50,y+100),N.lineTo(-50,y-k*.3),N.bezierCurveTo(m*.3,y-k*.4,m*.6,y-k*1.2,m+50,y-k*.8),N.lineTo(m+50,y+100),N.fill()}let Fo=ie(0,y*.5,Ue),Uo=ie(0,y*1.5,Gt*Gt),fr=y*.85-Fo-Uo;if(ee.forEach((S,k)=>{let O;k===$-1?O=lt.waterPeak:k%2===0?O=lt.waterDeep:O=lt.waterMid,N.fillStyle=O,N.beginPath();let T=S.amplitudeBase*(1+Ue*2+Gt*5),R=.003+Ue*.005,pe=S.speedBase*(1+Ue*5+Gt*10),de=V*pe+S.offset,Te=k*15*(1-Gt),Pe=fr+Te;N.moveTo(-50,y+100),N.lineTo(-50,Pe);for(let Be=-50;Be<=m+50;Be+=15){let Ne=Pe+Math.sin(Be*R+de)*T+Math.cos(Be*R*2.3+de)*(T*.5);N.lineTo(Be,Ne)}if(N.lineTo(m+50,y+100),N.fill(),k===$-1||Ue>.6&&k>$-3){N.save(),N.globalAlpha=.1+Ue*.3,N.fillStyle=lt.foam,N.beginPath();for(let Be=-50;Be<=m+50;Be+=10){let Ne=Pe+Math.sin(Be*R+de)*T+Math.cos(Be*R*2.3+de)*(T*.5);Math.random()>.5&&(Ne-=5),Be===-50?N.moveTo(Be,Ne):N.lineTo(Be,Ne)}N.lineTo(m+50,y+100),N.lineTo(-50,y+100),N.fill(),N.restore()}}),V<oe){let S=1;V>1e3&&(S=1-(V-1e3)/(oe-1e3)),N.fillStyle=`rgba(0, 0, 0, ${S})`,N.fillRect(-50,-50,m+100,y+100)}if(V>Ge){let S=Math.min(1,(V-Ge)/nt);N.fillStyle=`rgba(0, 0, 0, ${S})`,N.fillRect(-50,-50,m+100,y+100)}if(X){let S=w-se,k=12e3,O=0,T=!0;S<k?O=S/k:(O=1,he||(he=!0,Le(N,m,y,25),W=60,l||(l=!0,ct("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),K&&(T=!1),le(N,m,y,O,T)}if(K){let S=w-Q,k=Math.min(1,S/ve);N.fillStyle=`rgba(0, 0, 0, ${k})`,N.fillRect(-50,-50,m+100,y+100)}if(W>0){let S=W/60,k=S*S;N.fillStyle=`rgba(255, 255, 255, ${k})`,N.fillRect(-50,-50,m+100,y+100),W--}A.restore(),N.restore(),L=requestAnimationFrame(Ie)}function Re(){q=!1,e.style.cursor="",L&&cancelAnimationFrame(L),window.removeEventListener("resize",H),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function _e(){X=!0,se=Date.now(),he=!1,W=0,s||(s=ct("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Oe(){K=!0,Q=Date.now(),s&&s.stop()}function ce(){e.style.cursor=""}function te(){e.style.cursor="none"}function we(){s&&(s.stop(),s=null)}return Ie(),{cleanup:Re,triggerBeacons:_e,triggerFinalFade:Oe,showCursor:ce,hideCursor:te,stopHumLoop:we}}var cv=Fe(()=>{Pn()});var Vv={};St(Vv,{canPerformForgeReset:()=>$v,canPerformInfuseReset:()=>qv,computeForgeGoldFromInputs:()=>_v,computeInfuseMagicFromInputs:()=>Cv,computePendingForgeGold:()=>Dv,computeSurgeWavesFromInputs:()=>Mv,getCurrentSurgeLevel:()=>co,getForgeDebugOverrideState:()=>Tv,getInfuseDebugOverrideState:()=>Rv,getSurgeBarLevelKey:()=>Us,getSurgeDebugOverrideState:()=>Bv,hasDoneExperimentReset:()=>Uv,hasDoneForgeReset:()=>Nr,hasDoneInfuseReset:()=>Dt,hasDoneSurgeReset:()=>_o,initResetPanel:()=>jd,initResetSystem:()=>Xo,isExperimentUnlocked:()=>vl,isForgeUnlocked:()=>As,isInfuseUnlocked:()=>wu,isSurgeUnlocked:()=>Ds,onForgeUpgradeUnlocked:()=>Wp,onInfuseUpgradeUnlocked:()=>Vp,onSurgeUpgradeUnlocked:()=>Yp,performForgeReset:()=>qp,performInfuseReset:()=>Gp,performSurgeReset:()=>Hp,recomputePendingMagic:()=>fn,setExperimentResetCompleted:()=>Rp,setForgeDebugOverride:()=>Nv,setForgeResetCompleted:()=>kp,setInfuseDebugOverride:()=>Pv,setInfuseResetCompleted:()=>Tp,setInfuseUnlockedForDebug:()=>Ov,setSurgeResetCompleted:()=>Np,setSurgeUnlockedForDebug:()=>Fv,shouldBlockBigCoins:()=>gl,updateResetPanel:()=>$e});function Ep(e){return!gE.includes(e)}function yE(){ct(dE,{volume:.4})}function vE(){ct(pE,{volume:.45})}function bE(){ct(mE,{volume:.5})}function SE(){ct(hE,{volume:.8})}function gl(){return Iv}function wv(){let e=An(),t=P.waves?.value??pt(),n=0n;try{n=bl(e)}catch{}let o=I.pendingWaves,r=Xp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),Iv=i&&!un()}function hl(){vp=null}function yu(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function vu(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function bp(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Ev(e=null){try{let t=wd(),n=I.pendingGold.clone?.()??I.pendingGold;if(e){let o=e instanceof _t?e:_t.fromAny(e??1);if(o.isInfinite?.())return _t.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=P.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return I.pendingGold}}function EE(){for(;Vn.length;){let e=Vn.pop();try{e?.()}catch{}}}function yp(){!pv&&typeof jl=="function"&&(pv=jl((e={})=>{e?.key&&e.key!==Ce.COINS&&e.key!==Ce.WAVES||e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(e?.key===Ce.WAVES?(Eu(),$e()):(dn(),fn(),Mn()))})),!mv&&typeof ac=="function"&&(mv=ac((e={})=>{e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(dn(),Mn(),To(),$e())}))}function Ap(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=ke(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function yl(){try{let e=et();if(e&&e.xpLevel)return e.xpLevel}catch{}return pt()}function xv(e,t){if(!e||typeof e!="object")return pt();let n=ke(e);if(!Number.isFinite(n)&&n>0)return _t.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return pt();let r=Me(o*Math.log10(2)),i=Math.max(0,Ap(t)),s=Math.max(0,(i-30)/5),l=s<=0?uv():Me(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?uv():Me(a*Math.log10(1.15)),f=_t.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?pt():d}function xE(e,t){if(!e)return pt();let n=ke(e);if(!Number.isFinite(n)&&n>0)return _t.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let h=ke(t);Number.isFinite(h)&&(a=Math.max(0,h-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,p=r+u+f+d;return Number.isFinite(p)?Me(p).floorToInteger():_t.fromAny("Infinity")}function Lv(e,t,n=null){let o=xE(e,t),r=Ed(),i;if(n){let s=n instanceof _t?n:_t.fromAny(n??1);if(s.isInfinite?.())return _t.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=P.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function _v(e,t){return xv(e,t)}function Cv(e,t){return Lv(e,t)}function Mv(e,t,n,o,r){return Av(e,t,n,o,r)}function Av(e,t,n,o,r){let i=Ap(e);if(i<201)return pt();let s=(i-201)/35,l=ke(t),a=ke(n),u=ke(o),f=ke(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return _t.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*uu),Number.isFinite(a)&&a>13&&(d+=(a-13)*uu),Number.isFinite(u)&&u>5&&(d+=(u-5)*uu),Number.isFinite(f)&&f>12&&(d+=(f-12)*uu);let p=1+d+s;return Number.isFinite(p)?Me(p).floorToInteger():_t.fromAny("Infinity")}function kv(){return Math.max(0,Ap(yl()))}function An(){if(I.slot!=null)return I.slot;let e=b();return I.slot=e,e}function kp(e){let t=An();if(t!=null){I.hasDoneForgeReset=!!e;try{localStorage.setItem(xp(t),I.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function Tp(e){let t=An();if(t!=null){I.hasDoneInfuseReset=!!e;try{localStorage.setItem(Lp(t),I.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function Np(e){let t=An();if(t!=null){I.hasDoneSurgeReset=!!e;try{localStorage.setItem(_p(t),I.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Rp(e){let t=An();if(t!=null){I.hasDoneExperimentReset=!!e;try{localStorage.setItem(Mp(t),I.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function Iu(e=b()){if(e==null)return null;try{let t=localStorage.getItem(pl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Tv(e=b()){return Iu(e)}function Nv(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(I.forgeDebugOverride!==n){if(I.forgeDebugOverride=n,n==null)try{localStorage.removeItem(pl(t))}catch{}else try{localStorage.setItem(pl(t),n?"1":"0")}catch{}it(pl(t)),yu(),$e()}}function Op(e=b()){if(e==null)return null;try{let t=localStorage.getItem(ml(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Rv(e=b()){return Op(e)}function Ov(e){Pp(e)}function Pv(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(I.infuseDebugOverride!==n){if(I.infuseDebugOverride=n,n==null)try{localStorage.removeItem(ml(t))}catch{}else try{localStorage.setItem(ml(t),n?"1":"0")}catch{}it(ml(t)),vu(),$e()}}function Pp(e){let t=An();if(t==null)return;let n=!!e;if(I.infuseUnlocked!==n){I.infuseUnlocked=n;try{localStorage.setItem(hu(t),I.infuseUnlocked?"1":"0")}catch{}it(hu(t)),vu()}}function bu(e){let t=An();if(t==null)return;let n=!!e;if(I.forgeUnlocked!==n){I.forgeUnlocked=n;try{localStorage.setItem(mu(t),I.forgeUnlocked?"1":"0")}catch{}it(mu(t)),yu()}}function Bp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Sv(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Bv(e=b()){return Bp(e)}function Fv(e){Fp(e)}function Fp(e){let t=An();if(t==null)return;let n=!!e;if(I.surgeUnlocked!==n){I.surgeUnlocked=n;try{localStorage.setItem(gu(t),I.surgeUnlocked?"1":"0")}catch{}it(gu(t)),bp()}}function Sp(e){if(e==null){I.forgeUnlocked=!1,I.forgeDebugOverride=null,I.hasDoneForgeReset=!1,I.infuseUnlocked=!1,I.infuseDebugOverride=null,I.hasDoneInfuseReset=!1,I.surgeUnlocked=!1,I.surgeDebugOverride=null,I.hasDoneSurgeReset=!1,I.hasDoneExperimentReset=!1,I.flagsPrimed=!1;return}try{I.forgeUnlocked=localStorage.getItem(mu(e))==="1"}catch{I.forgeUnlocked=!1}I.forgeDebugOverride=Iu(e);try{I.hasDoneForgeReset=localStorage.getItem(xp(e))==="1"}catch{I.hasDoneForgeReset=!1}try{I.infuseUnlocked=localStorage.getItem(hu(e))==="1"}catch{I.infuseUnlocked=!1}try{I.hasDoneInfuseReset=localStorage.getItem(Lp(e))==="1"}catch{I.hasDoneInfuseReset=!1}I.infuseDebugOverride=Op(e);try{I.surgeUnlocked=localStorage.getItem(gu(e))==="1"}catch{I.surgeUnlocked=!1}I.surgeDebugOverride=Bp(e);try{I.hasDoneSurgeReset=localStorage.getItem(_p(e))==="1"}catch{I.hasDoneSurgeReset=!1}try{I.hasDoneExperimentReset=localStorage.getItem(Mp(e))==="1"}catch{I.hasDoneExperimentReset=!1}I.flagsPrimed=!0}function po(){let e=b();if(e==null){I.flagsPrimed=!1;return}I.slot!==e&&(I.slot=e,hl(),I.flagsPrimed=!1),I.flagsPrimed||Sp(e)}function hv(e){fv!==e&&(EE(),fv=e,e!=null&&(Vn.push(Ct(mu(e),{onChange(t){let n=t==="1";I.forgeUnlocked!==n&&(I.forgeUnlocked=n,yu(),$e())}})),Vn.push(Ct(xp(e),{onChange(t){let n=t==="1";I.hasDoneForgeReset!==n&&(I.hasDoneForgeReset=n,$e())}})),Vn.push(Ct(pl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.forgeDebugOverride!==n&&(I.forgeDebugOverride=n,yu(),$e())}})),Vn.push(Ct(hu(e),{onChange(t){let n=t==="1";I.infuseUnlocked!==n&&(I.infuseUnlocked=n,vu(),$e())}})),Vn.push(Ct(Lp(e),{onChange(t){let n=t==="1";I.hasDoneInfuseReset!==n&&(I.hasDoneInfuseReset=n,$e())}})),Vn.push(Ct(ml(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.infuseDebugOverride!==n&&(I.infuseDebugOverride=n,vu(),$e())}})),Vn.push(Ct(gu(e),{onChange(t){let n=t==="1";I.surgeUnlocked!==n&&(I.surgeUnlocked=n,bp(),$e())}})),Vn.push(Ct(Sv(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.surgeDebugOverride!==n&&(I.surgeDebugOverride=n,bp(),$e())}})),Vn.push(Ct(_p(e),{onChange(t){let n=t==="1";I.hasDoneSurgeReset!==n&&(I.hasDoneSurgeReset=n,$e())}})),Vn.push(Ct(Mp(e),{onChange(t){let n=t==="1";I.hasDoneExperimentReset!==n&&(I.hasDoneExperimentReset=n,$e())}}))))}function LE(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function dn(e=!1){let t=P.coins?.value??pt(),n=yl(),o=LE(t,n);!e&&vp===o||(vp=o,Up()?I.pendingGold=xv(t,n):I.pendingGold=pt(),$e())}function fn(e=null){let t=P.coins?.value??pt(),n=Sl();Dp()?I.pendingMagic=Lv(t,n,e):I.pendingMagic=pt(),Mn(),$e()}function Mn(){if(!Ds()){I.pendingWaves=pt(),To();return}let e=yl(),t=P.coins?.value??pt(),n=P.gold?.value??pt(),o=P.magic?.value??pt(),r=Sl();I.pendingWaves=Av(e,t,n,o,r),_o()||I.pendingWaves.cmp(_t.fromInt(10))>0&&(I.pendingWaves=_t.fromInt(10)),To(),wv()}function To(){if(!vl()){I.pendingDna=pt();return}let e=.30103,t=0;if(ft(9)){let i=pi();e=Math.log10(2+i),t=10*i}let n=e.toFixed(18),o=Yt?Yt():pt(),r=yl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),I.pendingDna=Me(u).floorToInteger()}catch{try{I.pendingDna=pt()}catch{I.pendingDna=pt()}}}function Ip(){let e=Iu();return e!=null?!!e:I.forgeUnlocked||Mt(Se.STARTER_COVE,Ee.UNLOCK_FORGE)>=1}function Up(){try{let e=yl();if(e&&typeof e.cmp=="function")return e.cmp(IE)>=0}catch{}return!1}function Dp(){try{let e=dt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(wE)>=0}catch{}return!1}function As(){po();let e=Iu();return e!=null?!!e:!!I.forgeUnlocked||Ip()}function wu(){po();let e=Op();return e!=null?!!e:!!I.infuseUnlocked}function Ds(){po();let e=Bp();return e!=null?!!e:!!I.surgeUnlocked}function vl(){return Bg()}function co(){let e=An();return e==null?0n:bl(e)}function Nr(){return po(),!!I.hasDoneForgeReset}function Dt(){return po(),!!I.hasDoneInfuseReset}function _o(){return po(),!!I.hasDoneSurgeReset}function Uv(){return po(),!!I.hasDoneExperimentReset}function Dv(){return dn(),I.pendingGold.clone?.()??I.pendingGold}function $v(){return!(!As()||!Up()||I.pendingGold.isZero?.())}function qv(){return!(!wu()||!Dp()||I.pendingMagic.isZero?.())}function _E({resetGold:e=!1,resetMagic:t=!1}={}){let n=Pt(Se.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===Ee.UNLOCK_XP||r===Ee.UNLOCK_FORGE||r===Ee.UNLOCK_INFUSE||r===Ee.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||nr(Se.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function $p({resetGold:e=!1,resetMagic:t=!1}={}){try{P.coins.set(0)}catch{}try{P.books.set(0)}catch{}try{ji({keepUnlock:!0})}catch{}try{mp()}catch{}_E({resetGold:e,resetMagic:t})}function qp(){if(!$v())return!1;let e=Ev();try{P.gold?.add&&P.gold.add(e)}catch{}if($p({resetGold:!1}),dn(),bu(!0),I.hasDoneForgeReset||kp(!0),jt(),Pr(),Ep("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return $e(),!0}function Gp(){if(!qv())return!1;let e=I.pendingMagic.clone?.()??I.pendingMagic;try{P.magic?.add&&P.magic.add(e)}catch{}$p({resetGold:!0});try{P.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),jt({forceReload:!0})}catch{}if(dn(),fn(),Ep("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return Pp(!0),I.hasDoneInfuseReset||Tp(!0),$e(),!0}function Su(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=An();try{P.waves?.add&&e&&!e.isZero?.()&&P.waves.add(e)}catch{}$p({resetGold:!0,resetMagic:!0});try{P.gold.set(0)}catch{}try{P.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),jt({forceReload:!0})}catch{}if(Eu(),Fp(!0),I.hasDoneSurgeReset||Np(!0),dn(),fn(),Mn(),t&&(n||bE(),n||AE()),Ep("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}$e()}function Gv(){if(!vl()||(Yt?Yt():pt()).cmp(10)<0)return!1;let t=I.pendingDna.clone?.()??I.pendingDna;try{P.DNA?.add&&P.DNA.add(t)}catch{}return Su(pt(),{playEffects:!1}),SE(),Fg([4]),I.hasDoneExperimentReset||Rp(!0),dn(),fn(),Mn(),To(),$e(),!0}function CE(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{$y(!0)}catch{}try{Wc()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,zo(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=lv(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Cy(e,()=>{setTimeout(ME,0)},i)},r);pu=i.cleanup}function ME(){pu&&(pu(),pu=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Su(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function Hp(){if(!Ds()||kv()<201)return!1;let e=I.pendingWaves.clone?.()??I.pendingWaves;if(e.isZero?.())return!1;let t=An(),n=P.waves?.value??pt(),o=bl(t),r=Xp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!un()?(CE(),Su(e,{playEffects:!1}),!0):(Su(e,{playEffects:!0}),!0)}function AE(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function bl(e){let t=0n;try{let n=localStorage.getItem(Cp(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function kE(e){let t=Cp(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function gv(e){if(!(e instanceof _t)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function Hv(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=gv(n),l=gv(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function Eu(){let e=An();if(e==null||!Ds()||gp||kE(e))return;let t=P.waves?.value??pt(),n=bl(e);if(n===1/0)return;let o=Hv(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Cp(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}gp=!0;try{P.waves.set(o.remainingWaves)}finally{gp=!1}$e(),o.safety>=100&&setTimeout(Eu,0)}wv()}function dl(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=_t.fromInt(e)}catch{}try{return ne(t)}catch{return e?.toString?.()??"0"}}function TE(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),p=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${p.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let p="";for(let h=0;h<=r;h++){let m=h/r,y=a+m*(u-a),g=y/(Math.PI*2)*120,v=50+30*Math.sin(y+d);p+=(h===0?"M":"L")+` ${g.toFixed(1)} ${v.toFixed(1)}`}return`<path d="${p}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function NE(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${lE}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${cE}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${uE}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${fE}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${yv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${vv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${du}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${ze?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${bv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,I.panel=e,I.elements.forge.card=e.querySelector("#reset-card-forge"),I.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),I.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),I.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),I.elements.infuse.card=e.querySelector("#reset-card-infuse"),I.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),I.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),I.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),I.elements.surge.card=e.querySelector("#reset-card-surge"),I.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),I.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),I.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),I.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),I.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),I.elements.surge.headerVal=e.querySelector("[data-surge-level]"),I.elements.surge.header=e.querySelector(".surge-header"),I.elements.experiment.card=e.querySelector("#reset-card-experiment"),I.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),I.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");I.elements.surge.milestones&&t&&ws(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),I.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(I.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&eo(r))return;let a=I.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),I.elements.forge.btn&&I.elements.forge.btn.addEventListener("click",()=>{qp()&&(yE(),$e())}),I.elements.infuse.btn&&I.elements.infuse.btn.addEventListener("click",()=>{Gp()&&(vE(),$e())}),I.elements.surge.btn&&I.elements.surge.btn.addEventListener("click",()=>{Hp()&&$e()}),I.elements.experiment.btn&&I.elements.experiment.btn.addEventListener("click",()=>{Gv()&&$e()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=TE();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{ls("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}$e()}function jd(e){!e||e.__resetInit||(e.__resetInit=!0,NE(e))}function No(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=dl(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function Xv({goldMult:e=null}={}){let t=I.elements.forge;if(!(!t.card||!t.btn)){if(!As()){No(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(po(),t.card.classList.toggle("is-forge-complete",!!I.hasDoneForgeReset),t.status)if(I.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!Up()){No(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}No(t.btn,{disabled:!1},yv,Ev(e))}}function Wv(){let e=I.elements.infuse;if(!(!e.card||!e.btn)){if(!wu()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="none"&&(I.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="flex"&&(I.layerButtons.infuse.style.display="flex"),po(),e.card.classList.toggle("is-complete",!!I.hasDoneInfuseReset),e.status)if(I.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!Dp()){No(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}No(e.btn,{disabled:!1},vv,I.pendingMagic)}}function Xp(e,t,n){let o=t.add(n);return Hv(e,o).level}function wp(){let e=I.elements.surge;if(!e.card||!e.btn)return;if(!Ds()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="none"&&(I.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="flex"&&(I.layerButtons.surge.style.display="flex"),po();let t=An(),n=P.waves?.value??pt(),o=0n;try{o=bl(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':dl(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=I.pendingWaves;if(u&&!u.isZero?.()){let f=Xp(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let p=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':dl(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${du}">${dl(n)} / <img src="${du}">${dl(r)}</span>`),e.milestones){let s=sv(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",p=a.description.map(A=>A.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${A}</div>`:`<div>- ${A}</div>`).join("");if(f&&a.surgeLevel===3){let A=Lr?Lr():_t.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${ne(A)}</div>`}if(f&&a.surgeLevel===6){let A=kc();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${We(A.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${We(A.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${We(A.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${We(A.magic)}x</span></div>`}let h=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(h=!0);let m=pi(),y=!1;f&&h&&m<1&&hp.includes(a.id)&&(y=!0);let g=y?" is-nerfed":"",v=l[u];if(!v)v=document.createElement("div"),v.className=`surge-milestone-item ${d}${g}`,v.dataset.isReached=String(f),v.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(v);else{v.className!==`surge-milestone-item ${d}${g}`&&(v.className=`surge-milestone-item ${d}${g}`);let A=String(f);v.dataset.isReached!==A&&(v.dataset.isReached=A)}let E=v.querySelector(".surge-milestone-desc");E&&E.innerHTML!==p&&(E.innerHTML=p);let C=v.querySelector(".surge-milestone-nerf-arrow");if(C){let A=!1;h&&m<1&&hp.includes(a.id)&&(A=!0);let N=A?"":"none";C.style.display!==N&&(C.style.display=N)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();I.lastRenderedSurgeLevel!==o&&(I.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!I.hasDoneSurgeReset),e.status)if(I.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(kv()<201){No(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(I.pendingWaves.isZero?.()){No(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}No(e.btn,{disabled:!1},du,I.pendingWaves)}function RE(){let e=I.elements.experiment;if(!e.card||!e.btn)return;if(!vl()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="none"&&(I.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="flex"&&(I.layerButtons.experiment.style.display="flex"),po(),e.card.classList.toggle("is-complete",!!I.hasDoneExperimentReset),e.status)if(I.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((Yt?Yt():pt()).cmp(10)<0){No(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}No(e.btn,{disabled:!1},bv,I.pendingDna)}function $e({goldMult:e=null}={}){I.panel&&(Xv({goldMult:e}),Wv(),wp(),RE())}function Wp(){Xo(),bu(!0),$e()}function Vp(){Xo(),Pp(!0),$e()}function Yp(){Xo(),Fp(!0),$e()}function OE(){if(!I.panel)return;let e=I.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!I.panel.classList.contains("is-active")||!I.elements.surge.barFill)return;let t=I.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",wp(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",wp()},{once:!0}))}function PE(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{OE()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(dn(),fn(),Mn()),e.detail?.key==="waves"&&(Eu(),$e()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Mn(),$e())}),window.addEventListener("surge:bookResidue",()=>{if(I.panel&&I.panel.offsetParent!==null){let e=I.elements.surge.card;e&&e.style.display!=="none"&&$e()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Ce.GOLD){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;dn(!0);let n=t.mult instanceof c?t.mult:_t.fromAny(t.mult??1);I.panel&&Xv({goldMult:n});return}if(t.key===Ce.MAGIC){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;let n=t.mult instanceof c?t.mult:_t.fromAny(t.mult??1);fn(n),I.panel&&Wv();return}}}),window.addEventListener("xp:change",()=>{dn(),Mn(),To(),$e()}),window.addEventListener("mutation:change",()=>{fn(),Mn(),$e()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&I.slot!=null&&e.detail.slot!==I.slot||(hl(),dn(!0),fn(),Mn(),To(),$e())}),window.addEventListener("lab:level:change",()=>{To(),$e()}),window.addEventListener("lab:node:change",()=>{fn(),$e()}))}function Xo(){if(dv){I.slot=b(),hl(),yp(),dn(!0),fn(),Mn(),To();return}try{jt()}catch{return}dv=!0;let e=b();if(I.slot=e,hl(),Sp(e),I.hasDoneForgeReset&&!ko())try{Pr()}catch{}if(!I.forgeUnlocked&&Ip()&&bu(!0),hv(e),yp(),PE(),dn(!0),fn(),Mn(),To(),fu){try{fu()}catch{}fu=null}fu=wi(()=>{let t=zp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(I.slot=t,hl(),Sp(t),I.hasDoneForgeReset&&!ko())try{Pr()}catch{}!I.forgeUnlocked&&Ip()&&bu(!0),hv(t),yp(),dn(!0),fn(),Mn(),To(),$e()})}var _t,uu,pt,uv,yv,vv,bv,lE,cE,uE,fE,du,dE,pE,mE,hE,gE,mu,xp,pl,hu,Lp,ml,gu,Sv,_p,Us,Cp,Mp,IE,wE,gp,Iv,I,Vn,fv,dv,fu,vp,pv,mv,pu,Eo=Fe(()=>{It();ro();vt();Kt();qn();oo();xo();es();Xa();av();ii();Pn();io();ci();fi();Yc();cv();_t=c,uu=Math.log10(1.1),pt=()=>_t.fromInt(0),uv=()=>_t.fromInt(1),yv="img/currencies/gold/gold.webp",vv="img/currencies/magic/magic.webp",bv="img/currencies/dna/dna.webp",lE="img/misc/forge.webp",cE="img/misc/infuse.webp",uE="img/misc/surge.webp",fE="img/misc/experiment.webp",du="img/currencies/wave/wave.webp",dE="sounds/forge_reset.ogg",pE="sounds/infuse_reset.ogg",mE="sounds/surge_reset.ogg",hE="sounds/experiment_reset.ogg",gE=[];mu=e=>`ccc:reset:forge:${e}`,xp=e=>`ccc:reset:forge:completed:${e}`,pl=e=>`ccc:debug:forgeUnlocked:${e}`,hu=e=>`ccc:reset:infuse:${e}`,Lp=e=>`ccc:reset:infuse:completed:${e}`,ml=e=>`ccc:debug:infuseUnlocked:${e}`,gu=e=>`ccc:reset:surge:${e}`,Sv=e=>`ccc:debug:surgeUnlocked:${e}`,_p=e=>`ccc:reset:surge:completed:${e}`,Us=e=>`ccc:reset:surge:barLevel:${e}`,Cp=Us,Mp=e=>`ccc:reset:experiment:completed:${e}`,IE=_t.fromInt(31),wE=_t.fromInt(7),gp=!1,Iv=!1;I={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:pt(),pendingMagic:pt(),pendingWaves:pt(),pendingDna:pt(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},Vn=[],fv=null,dv=!1,fu=null,vp=null,pv=null,mv=null;pu=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Xo,performForgeReset:qp,performInfuseReset:Gp,performSurgeReset:Hp,performExperimentReset:Gv,computePendingForgeGold:Dv,computeForgeGoldFromInputs:_v,computeInfuseMagicFromInputs:Cv,computeSurgeWavesFromInputs:Mv,getForgeDebugOverrideState:Tv,hasDoneForgeReset:Nr,isForgeUnlocked:As,setForgeDebugOverride:Nv,setForgeResetCompleted:kp,updateResetPanel:$e,isInfuseUnlocked:wu,setInfuseDebugOverride:Pv,getInfuseDebugOverrideState:Rv,recomputePendingMagic:fn,setInfuseUnlockedForDebug:Ov,setInfuseResetCompleted:Tp,hasDoneInfuseReset:Dt,isSurgeUnlocked:Ds,setSurgeUnlockedForDebug:Fv,getSurgeDebugOverrideState:Bv,setSurgeResetCompleted:Np,hasDoneSurgeReset:_o,getCurrentSurgeLevel:co,shouldBlockBigCoins:gl,hasDoneExperimentReset:Uv,setExperimentResetCompleted:Rp,isExperimentUnlocked:vl}))});var y0={};St(y0,{AREA_KEYS:()=>Se,HM_EVOLUTION_INTERVAL:()=>$t,MAX_LEVEL_DELTA:()=>Vs,REGISTRY:()=>qu,UPGRADE_TIES:()=>Ee,approxLog10BigNum:()=>ke,batchUpgradeOperations:()=>wl,bigNumFromLog10:()=>Me,buyCheap:()=>sl,buyMax:()=>il,buyOne:()=>ks,buyTowards:()=>Ts,clearPermanentUpgradeUnlock:()=>pm,computeDefaultUpgradeCost:()=>mm,computeHmMultipliers:()=>Wo,computeUpgradeEffects:()=>us,costToBuyOne:()=>sx,ensureLevelBigNum:()=>ut,estimateFlatBulk:()=>sm,estimateGeometricBulk:()=>ex,evaluateBulkPurchase:()=>yi,evolveUpgrade:()=>eu,formatMultForUi:()=>We,getCurrentAreaKey:()=>Xn,getHmEvolutions:()=>cm,getHmNextMilestoneLevel:()=>ax,getIconUrl:()=>tu,getLevel:()=>wn,getLevelNumber:()=>Mt,getMagnetLevel:()=>Lc,getMpValueMultiplierBn:()=>xc,getUpgrade:()=>js,getUpgradeLockState:()=>Mo,getUpgradeStorageKey:()=>xi,getUpgradesForArea:()=>Pt,levelBigNumToNumber:()=>De,log10OnePlusPow10:()=>vf,markUpgradePermanentlyUnlocked:()=>Ei,normalizeBigNum:()=>lx,normalizedUpgradeLevel:()=>Nu,onUpgradesChanged:()=>Eg,peekNextPrice:()=>g0,performFreeAutobuy:()=>Sd,safeMultiplyBigNum:()=>Et,setLevel:()=>nr,syncBookCurrencyMultiplierFromUpgrade:()=>Ga,upgradeUiModel:()=>Ns});function xu(){Br.size!==0&&(Br.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{it(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Br.clear())}function FE(){if(!(typeof window>"u")&&!zv){zv=setInterval(xu,2e3);try{window.addEventListener("beforeunload",xu)}catch{}try{window.addEventListener("pagehide",xu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&xu()})}catch{}}}function wl(e){if(qs)return e();qs=!0;try{return e()}finally{qs=!1,Il.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{Hs(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),Il.clear(),Yv.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{rx(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),Yv.clear(),em&&(em=!1,Kn())}}function UE(e){try{let t=Ks(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function Zv(e,t){if(!UE(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=ke(n);return Number.isFinite(o)&&o>=DE}catch{return!1}}function Gs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>Kp)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>Kp/2||i.length>Kp/2)return"Infinity"}return n}function _u(e){return WE[e]??0}function jp(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Ys(e,t){let n=ir(e||t?.area);if(!n)return null;let o=sr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=zn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function El(e,t){let n=ir(e||t?.area);if(!n)return null;let o=zn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function $s(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function om(e=b()){let t=String(e??"default");if(Au.has(t))return Au.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${e0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Au.set(t,n),n}function rm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Au.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${e0}:${n}`,JSON.stringify(e))}catch{}}function Uu(e=b()){let t=String(e??"default");if(ku.has(t))return ku.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${t0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),ku.set(t,n),n}function Du(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),ku.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${t0}:${n}`,JSON.stringify(e))}catch{}}function fm(e=b()){let t=String(e??"default");if(Tu.has(t))return Tu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${n0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Tu.set(t,n),n}function dm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Tu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${n0}:${n}`,JSON.stringify(e))}catch{}}function im(e,t,n=b()){let o=Ys(e,t);if(!o)return;let r=El(e,t),i=fm(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],dm(i,n))}function o0(e,t,n=b()){let o=Ys(e,t);if(!o)return!1;let r=El(e,t),i=fm(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],dm(i,n),!0):!1}function Ei(e,t,n=b()){let o=Ys(e,t);if(!o)return;let r=El(e,t),i=Uu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Du(i,n))}function pm(e,t,n=b()){let o=Ys(e,t);if(!o)return;let r=Uu(n);r.upgrades[o]&&(delete r.upgrades[o],Du(r,n));let i=om(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},rm(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&ar(e,s,n),Kn()}function Pu(e,t,n=b()){let o=Ys(e,t);if(!o)return!1;let r=El(e,t),i=Uu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Du(i,n),!0):!1}function pn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=sr(t?.tie??t?.tieKey),o=e?.areaKey||Se.STARTER_COVE;if(!n||!qE.has(n))return{locked:!0,iconOverride:kn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?Mt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:r0()}catch{}function s(){if(i0())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:hn,titleOverride:on,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===Ee.UNLOCK_XP)return s();if(n===Ee.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:kn,useLockedBase:!0};let a=!1;try{let u=gn();a=De(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:hn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:on,descOverride:u,reason:u}}return{locked:!1}}if(n===Ee.UNLOCK_INFUSE){if(!Nr())return{locked:!0,iconOverride:kn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Yn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=gn();a=De(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:hn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:on,descOverride:u,reason:u}}return{locked:!1}}if(n===Ee.UNLOCK_SURGE){if(!Dt())return{locked:!0,iconOverride:kn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Yn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=gn();a=De(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:hn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:on,descOverride:u,reason:u}}return{locked:!1}}if(um.has(n)){if(Dt()||Pu(o,t)){try{Ei(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=gn();a=De(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:kn,useLockedBase:!0,titleOverride:Yn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{im(o,t)}catch{}return{locked:!0,iconOverride:hn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:on,descOverride:u,reason:u}}if(Nr()||Pu(o,t)){try{Ei(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:kn,useLockedBase:!0};if(o0(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:hn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:on,descOverride:a,reason:a}}let l=!1;try{let a=gn();l=De(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:kn,useLockedBase:!0,titleOverride:Yn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{im(o,t)}catch{}return{locked:!0,iconOverride:hn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function ir(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function sr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function VE(e,t){let n=sr(t?.tie??t?.tieKey);if(n&&GE.has(n))return!0;let o=zn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=ir(l);if(a&&HE.has(`${a}:${i}`))return!0}return!1}function r0(){try{return!!cn()}catch{return!1}}function i0(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${XE}:${t}`)==="1"}catch{return!1}}function gn(){try{let e=typeof et=="function"?et():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function Nu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function Zp(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function zn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function ut(e){try{if(e=Gs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Me(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=ke(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function De(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=ke(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=ke(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function YE(e,t){let n=ut(e),o=ut(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(ke(n))+1,i=Math.floor(ke(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function s0(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function zs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Bu(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:zs(e.numUpgEvolutions)}function mm(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=De(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/$t));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=u0(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:ke(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:s0(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,mn(i,r)}function a0(e){let t=zs(e),n=$t*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Fr(o),capFmtText:Xs(o)}}function l0(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(ke(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=De(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/$t)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt($t);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=De(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/$t)+1)}}function KE(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function hm(e,t=Ou){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=ir(t||e?.area||Ou);return $E[n]||Jv}function Et(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function $u(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=a0(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Wo(e,t,n=Ou){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=hm(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=l0(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=KE(u.multiplier??u.mult??u.value??1,f),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=Et(i,d):p==="coin"||p==="coins"?s=Et(s,d):p==="mp"?l=Et(l,d):r=Et(r,d)}let a=Bu(e);if(a>0){let u=BE*a,f=Me(u);r=Et(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function c0(e,t,n=Ou){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=hm(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=l0(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt($t)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny($t*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+$t*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny($t))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function u0(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=zE[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Ks(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=u0(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=s0(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=ke(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),h=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(p)===0&&d.cmp(h)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function mn(e,t){let n=Ks(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Me(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Me(n.baseLog10+o*n.ratioLog10).floorToInteger()}function jE(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function or(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Ks(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Cu+t*o.ratioLn)/Cu;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Cu+t*o.ratioLn,i=o.ratioLn*n,s=jE(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Cu}function Ru(e,t,n){if(!(n>0))return c.fromInt(0);let o=Ks(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=or(e,t,l);a=a.add(Me(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=or(e,t,n);return Me(i)}function d0(e){if(!(e>0)||!Number.isFinite(e))return e;if(Qp[0]=e,Qp[0]<=0)return 0;ZE[0]-=1n;let t=Qp[0];return t>0?t:0}function JE(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=d0(e);return n<e?n:e>1?e/2:0}function Mu(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function xl(e,t,n,o=Vs,r={}){let i=Ks(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(De(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:De(o),p=Number.isFinite(f)?Math.max(0,f-u):Jp,h=Number.isFinite(d)?Math.max(0,Math.floor(d)):Jp;if(h=Math.min(h,Jp,p),!(h>0)){let ee=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:ee,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let ee=Math.min(h,m),$=c.fromAny(e.costAtLevel(u)),U=s,j=0;for(;j<ee;){$=c.fromAny(e.costAtLevel(u+j));let ye=U.add($);if(ye.cmp(n)>0)break;U=ye,j+=1}let ie=u+j,ae=Number.isFinite(f)&&ie>=f,_=Mu(j);if(j<ee||ae||h<=j){let ye=ae?s:c.fromAny(e.costAtLevel(ie));return{count:_,spent:U,nextPrice:ye,numericCount:j}}let Y=(()=>{try{return rr(t??u,u).add(_)}catch{return u+j}})(),fe=xl(e,Y,n.sub(U),h-j,r),me=fe?.count instanceof c?fe.count:Mu(fe?.numericCount??0),Z=_.add(me),re=(fe?.spent??s).add(U);return{count:Z,spent:re,nextPrice:fe?.nextPrice??s,numericCount:j+(fe?.numericCount??0)}}let y=ke(n),g=i.ratioLog10,v=i.ratioMinus1,E=c.fromAny(e.costAtLevel(u)),C=i.baseLog10+u*g;if(v>0&&(!Number.isFinite(y)||Math.abs(y)>1e6&&Math.abs(C)>1e6)){let ee=c.fromAny(e.costAtLevel(u));if(n.cmp(ee)<0)return{count:s,spent:s,nextPrice:ee,numericCount:0};let $=Number.isFinite(h)?Math.max(1,Math.floor(h)):Number.MAX_VALUE,U=1,j=1;for(;j<$;){let me=or(e,u,j);if(Me(me).cmp(n)<=0){let re=j*2;if(!Number.isFinite(re)||re<=j){j=$;break}U=j,j=Math.min(re,$)}else break}let ie=0;for(;U<j&&ie<256;){let me=Math.max(U+1,Math.floor((U+j+1)/2)),Z=or(e,u,me);Me(Z).cmp(n)<=0?U=me:j=me-1,ie++}let ae=Math.max(1,U),_=Mu(ae),Y=s,fe=s;if(!a)if(Y=Ru(e,u,ae),Number.isFinite(f)){let me=Math.max(0,Math.floor(f-Math.min(u,f)));ae>=me?fe=s:fe=Me(C+ae*g)}else fe=Me(C+ae*g);return{count:_,spent:Y,nextPrice:fe,numericCount:ae}}if(n.cmp(E)<0)return{count:s,spent:s,nextPrice:E,numericCount:0};let N=!1,H=null,F=null;try{H=c.fromAny(e.costAtLevel(u+1))}catch{}try{let ee=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);F=c.fromAny(e.costAtLevel(ee))}catch{}!N&&!(i.ratioMinus1>0)&&(N=!0),H&&F&&(N=H.cmp(E)===0&&F.cmp(E)===0),!N&&!(i.ratioMinus1>0)&&(N=!0);let q=Number.isFinite(h)?Math.max(0,Math.floor(h)):Number.MAX_VALUE;if(N){let ee=rr(e.lvlCapBn??"Infinity","Infinity"),$=rr(t??0,0),U=ee.isInfinite?.()?c.fromAny("Infinity"):ee.sub($).floorToInteger(),{count:j,countBn:ie,spent:ae,nextPrice:_}=sm(E,n,U);return{count:ie,spent:ae,nextPrice:_,numericCount:j}}if(!(g>0)||!(v>0)){let ee=rr(e.lvlCapBn??"Infinity","Infinity"),$=rr(t??0,0),U=ee.isInfinite?.()?c.fromAny("Infinity"):ee.sub($).floorToInteger(),{count:j,countBn:ie,spent:ae,nextPrice:_}=sm(E,n,U);return{count:ie,spent:ae,nextPrice:_,numericCount:j}}let L=Math.log10(v);if(!Number.isFinite(L))return{count:s,spent:s,nextPrice:E,numericCount:0};let M=vf(y+L-C)/g;(!Number.isFinite(M)||M<0)&&(M=0);let x=Math.floor(Math.min(q,M));Number.isFinite(x)||(x=q),x<=0&&(x=1);let X=1e-7,J=or(e,u,x),se=0,K=2048;for(;x>0&&(!Number.isFinite(J)||J>y+X)&&se<K;){let ee=Number.isFinite(J)?Math.max(1,Math.ceil((J-y)/Math.max(g,1e-12))):Math.max(1,Math.floor(x/2)),$=Math.max(0,Math.floor(x-ee));if($<x)x=$;else{let U=d0(x);if(!(U<x))break;x=U}J=x>0?or(e,u,x):Number.NEGATIVE_INFINITY,se+=1}if(x<=0||!Number.isFinite(x))if(n.cmp(E)>=0)x=1,J=ke(E);else return{count:s,spent:s,nextPrice:E,numericCount:0};if(x<q){let ee=_=>{let Y=_*2;return Number.isFinite(Y)?Y:Number.MAX_VALUE},$=x,U=Math.min(q,Math.max(x+1,ee(x))),j=or(e,u,U);for(;$<U&&Number.isFinite(j)&&j<=y+X&&U<q;)$=U,U=Math.min(q,ee(U)),j=or(e,u,U);let ie=$,ae=U;for(let _=0;_<256&&ie<ae;_+=1){let Y=Math.floor((ie+ae+1)/2),fe=or(e,u,Y);Number.isFinite(fe)&&fe<=y+X?(ie=Y,J=fe):ae=Y-1}x=ie}let Q=null;if(!a){Q=Ru(e,u,x);let ee=0;for(;Q.cmp(n)>0&&x>0&&ee<K;){let $=JE(x);if(!($<x))break;x=$,Q=Ru(e,u,x),ee+=1}if(x<=0)return{count:s,spent:s,nextPrice:E,numericCount:0};if(x<q&&ee<K)for(;x<q&&ee<K;){let $=u+x,U;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)U=c.fromAny(e.costAtLevel($));else{let ie=C+x*g;U=Me(ie).floorToInteger()}}catch{break}let j=Q.add(U);if(j.cmp(n)>0)break;Q=j,x+=1,ee+=1}}let ve=s,he=!a&&Number.isFinite(u)&&Number.isFinite(x)&&u<Number.MAX_SAFE_INTEGER/2&&x<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let ee=Math.max(0,Math.floor(f-Math.min(u,f)));if(x>=ee)ve=s;else if(he){let $=Math.floor(u+x);ve=c.fromAny(e.costAtLevel($))}else{let $=C+x*g;ve=Me($)}}else if(he){let ee=Math.floor(u+x);ve=c.fromAny(e.costAtLevel(ee))}else{let ee=C+x*g;ve=Me(ee)}return{count:Mu(x),spent:Q,nextPrice:ve,numericCount:x}}function QE(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=ke(t),r=ke(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function sm(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let p=e.mulBigNumInteger(d);return{count:am(d),countBn:d,spent:p,nextPrice:e}}let i=ke(t),s=ke(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Me(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:am(l),countBn:l,spent:a,nextPrice:u}}function ex(e,t,n,o){if(!n||o<=0)return{count:0};let r=ke(t),i=ke(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let y=0;y<64&&a<u;y+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let p=i+f*n.ratioLog,h=Me(d),m=Me(p);return{count:f,spent:h,nextPrice:m,spentLog:d,nextPriceLog:p}}function rr(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function am(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Fr(e){return ne(e instanceof c?e:c.fromAny(e??0))}function Xs(e){return Fr(e).replace(/<[^>]*>/g,"")}function Fu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Ws(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=Fu(n??t??0),s=Fu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:De(i),newLevel:Number.isFinite(o)?o:De(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Bt(e,t){return mn(e,t)}function p0(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function xi(e,t,n=b()){if(n==null)return null;let o=ir(e),r=gm(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function tx(){Kv.forEach(e=>{try{e?.()}catch{}}),Kv.clear()}function jv(e){tx()}function nx(e,t){if(typeof localStorage>"u")return;let n=p0(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=xi(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}}),console.log(`[UpgradeMigration] Migrated ${i} upgrades for area ${e} slot ${t}`)}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function ox(e,t,n){nx(e,n);let o=xi(e,t,n);if(!o)return null;if(qs&&Il.has(o))try{let r=Il.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Br.has(o))try{let r=Br.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function Hs(e,t,n,o=b(),r={}){let i=xi(e,t,o);if(i){if(qs){Il.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Br.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Br.has(i)&&Br.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{it(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function rx(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&Hs(e,o.id,o,n)})}function gm(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return zn(t.id);let n=zn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=sr(n);if(o){let r=tm.get(o);if(r){let i=ir(e);if(!i||ir(r.area)===i)return zn(r.id)}}}return n}function m0(e,t,n=b()){let o=n==null?"null":String(n),r=gm(e,t);return`${o}:${e}:${zn(r)}`}function mo(e,t){let n=gm(e,t),o=zn(n),r=b(),i=m0(e,o,r),s=lm.get(i);if(s)return s;let l=js(e,o),a=ox(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,Hs(e,o,a,r)}let f=a.lvl,d=a.nextCost,p=a.nextCostLvl;a.lvl=Gs(a.lvl),a.nextCost=Gs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Gs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==p)&&(u=!0);let h=0;l?.upgType==="HM"&&(h=zs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),$u(l,h));let m=ut(a.lvl),y=De(m);try{let A=l?.lvlCapBn??c.fromAny("Infinity");if(!A.isInfinite?.()&&m.cmp(A)>0){let N=A.clone?.()??A;y=De(N);let H=N.toStorage();a.lvl=H,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=H,Hs(e,o,a,r)}}catch{}let g=null;try{g=m?.toStorage?.()??ut(y).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let v=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,E=!v||v!==g,C=null;if(!E&&a.nextCost!=null)try{C=c.fromAny(a.nextCost)}catch{C=null,E=!0}if(!C||E){if(l)try{C=c.fromAny(l.costAtLevel(y))}catch{C=c.fromInt(0)}else C=c.fromInt(0);try{a.nextCost=C.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{Hs(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let A=c.fromAny("Infinity");l.lvlCapBn=A,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Fr(A),l.lvlCapFmtText=Xs(A)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:y,lvlBn:m,nextCostBn:C,slot:r,hmEvolutions:h},lm.set(i,s),s}function Ur(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=zn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??ut(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=De(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??ut(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=ut(e.lvl??0).toStorage()}i.lvl=Gs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Gs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=zs(e.hmEvolutions)),Hs(n,r,i,o,t),e.slot=o}function ar(e,t,n=b()){lm.delete(m0(e,t,n))}function Mt(e,t){return mo(e,t).lvl}function cm(e,t){return mo(e,t).hmEvolutions??0}function h0(e,t){if(!t)return{locked:!1};let n=r0(),o=n?gn():c.fromInt(0),r=n?De(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=VE(e,t),d="Unlock the XP system to reveal this upgrade",p=i0();if(f)if(p)i={locked:!0,iconOverride:hn,titleOverride:on,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let h='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:kn,titleOverride:Yn,descOverride:h,reason:h,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:kn,titleOverride:Yn,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=Zp({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,baseLocked:s.locked,getUpgradeLevel(p){return Mt(e,p)}},d=t.computeLockState(f);s=Zp(s,d)}catch{}let l=b(),a=Ys(e,t),u=a?Pu(e,t,l):!1;if(a){let f=om(l),d=Uu(l),p=fm(l),h=a.replace(/_/g,"-"),m=El(e,t),y=!1;$s(f,h,a)&&(y=!0),m&&$s(f,m,a)&&(y=!0),y&&rm(f,l);let g=!1;$s(d,h,a)&&(g=!0),m&&$s(d,m,a)&&(g=!0),g&&Du(d,l);let v=!1;$s(p,h,a)&&(v=!0),m&&$s(p,m,a)&&(v=!0),v&&dm(p,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=kn),f?s.titleOverride||(s.titleOverride=on):(!s.titleOverride||s.titleOverride===on)&&(s.titleOverride=Yn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===kn||s.iconOverride===hn)&&delete s.iconOverride,(s.titleOverride===on||s.titleOverride===Yn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=kn),a){let f=om(l),d=f.upgrades[a]||{},p=sr(t?.tie??t?.tieKey),h=p&&Qv.has(p),m=p&&um.has(p),y=d.status||"locked";if(Pu(e,t,l))y="unlocked";else if(o0(e,t,l)&&y==="locked"){let L=!1;try{L=De(gn())>=31}catch{}let B=!1;try{B=De(gn())>=101}catch{}h&&!L||m&&!B?y="locked":y="mysterious"}let g=_u(y),v=jp(s),E=_u(v),C=()=>{s.locked=!0;let L=d.snapshot;L&&typeof L=="object"&&(s=Zp(s,L)),s.iconOverride=hn,s.titleOverride=on;let B=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=B,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>E&&(y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):y==="mysterious"&&C(),v=jp(s),E=_u(v));let A=!1,N=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",H=h,F=!1;try{F=De(gn())>=31}catch{}let q=!1;try{q=De(gn())>=101}catch{}if((H&&!F&&N==="mysterious"||m&&!q&&N==="mysterious")&&(N="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==N)&&(f.upgrades[a]={status:N},A=!0),E>g){if(d.status=v,f.upgrades[a]={status:d.status},A=!0,y=v,g=E,v==="unlocked")Ei(e,t,l);else if(v==="mysterious"){let L=!1;try{L=De(gn())>=31}catch{}(!h||L)&&im(e,t,l)}}y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===kn||s.iconOverride===hn)&&delete s.iconOverride,(s.titleOverride===on||s.titleOverride===Yn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},A=!0),Ei(e,t,l)):y==="mysterious"&&v!=="mysterious"&&(C(),v=jp(s),E=_u(v)),A&&rm(f,l)}return s}function Ll(e,t){return!!h0(e,t).locked}function ym(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Bu(e),{capBn:r,cap:i}=a0(o);try{return t?.cmp?.(r)>=0}catch{}let s=De(t);return Number.isFinite(s)&&s>=i}function wn(e,t){let n=mo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():ut(n.lvl??0)}function g0(e,t){let n=mo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??ut(n.lvl??0),i=De(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function nr(e,t,n,o=!0,r={}){let i=mo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,$u(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=Fu(i.lvlBn??ut(i.lvl??0)),d=ut(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let p=d;try{s&&Zv(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=ut(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=ut(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let h=De(p);if(!s)return i.lvl=h,i.lvlBn=p,i.nextCostBn=c.fromInt(0),Ur(i),ar(e,t),Kn(),i.lvl;i.lvl=h,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(h))}catch{i.nextCostBn=c.fromInt(0)}return Ur(i,{deferSave:r?.deferSave}),ar(e,t),Ws(s,u,f,i.lvl,i.lvlBn),Kn(),i.lvl}function Pt(e){return qu.filter(t=>t.area===e)}function js(e,t){let n=ir(e),o=zn(t),r=sr(typeof o=="string"?o:t);return qu.find(i=>n&&ir(i.area)!==n?!1:!!(zn(i.id)===o||r&&i.tieKey===r))||null}function Mo(e,t){let n=typeof t=="object"&&t?t:js(e,t);return h0(e,n)}function ix(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function tu(e){return e?ix(e.icon):""}function sx(e,t){let n=js(e,t),o=wn(e,t),r=De(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function ks(e,t){let n=mo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Ll(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??ut(r),s=Fu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(Zv(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=De(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Ur(n),ar(e,t),Kn(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?P[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let h=f.value;if((h instanceof c?h:c.fromAny(h??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=De(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),Ur(n),ar(e,t),Ws(o,r,s,n.lvl,n.lvlBn),Kn(),{bought:1,spent:d}}function eu(e,t){let n=mo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??ut(n.lvl);if(!ym(o,r,n.hmEvolutions))return{evolved:!1};let i=zs(n.hmEvolutions)+1;n.hmEvolutions=i,$u(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Ur(n),ar(e,t),Ws(o,n.lvl,r,n.lvl,r),Kn(),{evolved:!0}}function il(e,t){let n=mo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ll(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??ut(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=P[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return ks(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let v=i.clone?.()??ut(i),E=De(v),C=v.toStorage?.(),A;if(o.upgType==="HM"){if(A=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let H=c.fromAny("Infinity");o.lvlCapBn=H,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Fr(H),o.lvlCapFmtText=Xs(H)}}else{let H=o.lvlCapBn?.clone?.()??rr(o.lvlCap??1/0,1/0);A=H?.clone?.()??H}let N=A.sub(v);if(N.isZero?.()){let H=YE(A,v);H.isZero?.()||(N=H)}if(N.isZero?.()){let H=A.toStorage?.();if(C&&H&&C!==H)if(A.isInfinite?.())try{N=c.fromAny("Infinity")}catch{N=c.fromInt(1)}else N=c.fromInt(1)}return n.lvlBn=A.clone?.()??A,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=De(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),P[o.costType].set(u),Ur(n),ar(e,t),Ws(o,E,v,n.lvl,n.lvlBn),Kn(),{bought:N,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):Vs;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=xl(o,i,u,d),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),y=u.sub(m);P[o.costType].set(y);let g=i.add(h);return n.lvlBn=g,n.lvl=De(g),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Ur(n),ar(e,t),Ws(o,r,i,n.lvl,n.lvlBn),Kn(),{bought:h,spent:m}}function Ts(e,t,n){let o=mo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Ll(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??ut(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=P[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?De(n):void 0,h=Number.isFinite(d)?Number.isFinite(p)?Math.min(d,p):d:p,m=xl(r,s,f,h),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=m.spent??c.fromInt(0),v=f.sub(g);P[r.costType].set(v);let E=s.add(y);return o.lvlBn=E,o.lvl=De(E),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Ur(o),ar(e,t),Ws(r,i,s,o.lvl,o.lvlBn),Kn(),{bought:y,spent:g}}function yi(e,t,n,o=Vs,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=xl(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function Kn(){if(qs){em=!0,pd();return}pd(),Ec()}function Xn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Se.STARTER_COVE}function Ns(e,t){let n=js(e,t);if(!n)return null;let o=wn(e,t),r=De(o),i=Fr(o),s=Xs(o),l=n.lvlCapBn??rr(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Fr(l),u=n.lvlCapFmtText??Xs(l),f=r<n.lvlCap?g0(e,t):c.fromInt(0),d=Fr(f),p=P[n.costType]?.value,h=p instanceof c?p:c.fromAny(p??0),m=Mo(e,t),y=!!m.locked,g=m.titleOverride??n.title,v=m.descOverride??n.desc;if(e===Ke&&zn(t)===ei){let N=Mc();if(Math.abs(N-1)>1e-4&&v){let H=We(N);v=v.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+H+" Coins on an interval")}}let E=hm(n,e),C="";typeof n.effectSummary=="function"&&!(y&&m.hideEffect)&&(C=n.effectSummary(r),typeof C=="string"&&(C=C.trim()));let A=m.iconOverride??tu(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:h,haveFmt:P[n.costType]?.fmt(h)??String(h),effect:C,iconUrl:A,lockState:m,locked:y,areaKey:e,hmMilestones:E,displayTitle:g,displayDesc:v,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?cm(e,t):0,hmReadyToEvolve:n.upgType==="HM"?ym(n,o,cm(e,t)):!1,hmNextMilestone:n.upgType==="HM"?c0(n,o,e):null}}function ax(e,t){let n=js(e,t);if(!n||n.upgType!=="HM")return null;let o=wn(e,t);return c0(n,o,e)}function lx(e){return Me(ke(e??0))}function Sd(e,t){let n=mo(e,t),o=n.upg;if(!o)return{bought:0};let r=p0(e,n.slot);if(Vt(r))return{bought:0};let i=xi(e,t,n.slot);if(Vt(i))return{bought:0};if(Ll(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??ut(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&ym(o,l,n.hmEvolutions))return{bought:0};let f=P[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let p=xl(o,l,d,Vs),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:0};let m=l.add(h);return FE(),nr(e,t,m,!0,{deferSave:!0}),{bought:h}}function sl(e,t){let n=mo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ll(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??ut(n.lvl),i=De(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=P[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=yi(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=h=>{if(h<=0)return!0;let m=Ru(o,i,h-1),y=a.sub(m),g=i+h-1,v=c.fromAny(o.costAtLevel(g)),E=y.div(10);return v.cmp(E)<=0},p=0;if(f<2e3){let h=u.spent,m=f;for(;m>0;){let y=i+m-1,g=c.fromAny(o.costAtLevel(y)),v=h.sub(g),C=a.sub(v).div(10);if(g.cmp(C)<=0){p=m;break}h=v,m--}}else{let h=0,m=f;for(;h<m;){let y=Math.ceil((h+m)/2);d(y)?h=y:m=y-1}p=h}return p<=0?{bought:0,spent:c.fromInt(0)}:Ts(e,t,p)}var Vs,$t,aA,BE,Ou,Se,qs,Yv,Il,em,Br,zv,DE,Kp,Ee,Jv,$E,kn,hn,on,Yn,Qv,um,qE,GE,HE,XE,e0,t0,n0,WE,Au,ku,Tu,tm,lA,nm,Lu,zt,Cu,zE,Jp,f0,Qp,ZE,qu,lm,Kv,oo=Fe(()=>{vt();It();Kt();qn();xo();Eo();io();ti();ds();Zd();md();Vs=c.fromAny("Infinity"),$t=1e3,aA=c.fromInt(1e3),BE=3,Ou="",Se={STARTER_COVE:"starter_cove",AUTOMATION:Ke,DNA:"dna"},qs=!1,Yv=new Map,Il=new Map,em=!1,Br=new Map,zv=null;DE=308;Kp=1024;Ee={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},Jv=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],$E={[Se.STARTER_COVE]:Jv},kn="img/misc/locked.webp",hn="img/misc/mysterious.webp",on="Hidden Upgrade",Yn="Locked Upgrade",Qv=new Set([Ee.COIN_VALUE_II,Ee.XP_VALUE_II,Ee.MP_VALUE_I,Ee.MAGNET,Ee.ENDLESS_XP]),um=new Set([Ee.COIN_VALUE_III,Ee.XP_VALUE_III,Ee.MP_VALUE_II,Ee.FASTER_COINS_III,Ee.ENDLESS_MP]),qE=new Set([Ee.UNLOCK_XP,Ee.UNLOCK_FORGE,Ee.UNLOCK_INFUSE,Ee.UNLOCK_SURGE,...Qv,...um]),GE=new Set([Ee.FASTER_COINS_II,Ee.COIN_VALUE_I,Ee.BOOK_VALUE_I,Ee.XP_VALUE_I]),HE=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),XE="ccc:merchantMet",e0="ccc:shop:reveals",t0="ccc:shop:permaUnlocks",n0="ccc:shop:permaMyst",WE={locked:0,mysterious:1,unlocked:2},Au=new Map,ku=new Map,Tu=new Map,tm=new Map,lA=sr(Ee.BOOK_VALUE_I),nm=c,Lu=e=>nm.fromAny(e??0),zt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Lu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return nm.fromInt(1).add(r.mulDecimal(n))}catch{let i=ke(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Me(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Lu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return nm.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Lu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Lu(i);if(o>0){let l=ke(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return Me(u)}}catch{}try{let l=De(s),a=o*l;return Me(a)}catch{return c.fromInt(1)}}}};Cu=Math.log(10);zE={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Bu(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Bu(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};Jp=(()=>{try{let e=De(Vs);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),f0=new ArrayBuffer(8),Qp=new Float64Array(f0),ZE=new BigInt64Array(f0);qu=[{area:Se.STARTER_COVE,id:1,tie:Ee.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:2,tie:Ee.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Kr()}catch{}}},{area:Se.STARTER_COVE,id:3,tie:Ee.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:4,tie:Ee.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(.5),onLevelChange(){try{Qt()}catch{}}},{area:Se.STARTER_COVE,id:5,tie:Ee.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>Nu(e)>0?2:1,onLevelChange({newLevel:e}){Ga(e)}},{area:Se.STARTER_COVE,id:6,tie:Ee.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${We(t)}x`},effectMultiplier:zt.addFlatPerLevel(2)},{area:Se.STARTER_COVE,id:7,tie:Ee.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Wp()}catch{}}},{area:Se.STARTER_COVE,id:8,tie:Ee.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${ne(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(10),onLevelChange(){try{Qt()}catch{}}},{area:Se.STARTER_COVE,id:9,tie:Ee.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:10,tie:Ee.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:11,tie:Ee.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=Nu(e),n=We(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>Nu(e)},{area:Se.STARTER_COVE,id:12,tie:Ee.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:$t,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return mn(this,e)},nextCostAfter(e,t){return mn(this,t)},computeLockState:pn,effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=Et(n,o);return`XP value bonus: ${We(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:13,tie:Ee.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Vp()}catch{}}},{area:Se.STARTER_COVE,id:14,tie:Ee.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${ne(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(1e3)},{area:Se.STARTER_COVE,id:15,tie:Ee.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:16,tie:Ee.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:17,tie:Ee.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${We(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:18,tie:Ee.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:$t,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return mn(this,e)},nextCostAfter(e,t){return mn(this,t)},computeLockState:pn,effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=Et(n,o);return`MP value bonus: ${We(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:19,tie:Ee.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Yp()}catch{}}},{area:Se.STARTER_COVE,id:20,tie:Ee.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:$t,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return mn(this,e)},nextCostAfter(e,t){return mn(this,t)},computeLockState(e){let t=co(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=gn();o=De(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:hn,titleOverride:on,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Yn,descOverride:"Locked"}},onLevelChange(){try{Qt()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${We(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:21,tie:Ee.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:$t,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return mn(this,e)},nextCostAfter(e,t){return mn(this,t)},computeLockState(e){let t=co(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=gn();o=De(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:hn,titleOverride:on,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Yn,descOverride:"Locked"}},onLevelChange(){try{Qt()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${We(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:22,tie:Ee.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:$t,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return mn(this,e)},nextCostAfter(e,t){return mn(this,t)},computeLockState(e){let t=co(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=gn();o=De(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:hn,titleOverride:on,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Yn,descOverride:"Locked"}},onLevelChange(){try{Qt()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${We(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},...dg,...Ay];for(let e of qu){let t=sr(e.tie??e.tieKey);t&&!tm.has(t)&&tm.set(t,e),e.baseCost=rr(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return mn(this,n)},e.nextCostAfter=function(n,o){return mn(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=zt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=ut(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Wo(this,o,this.area),s=Et(r,i),l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${We(s)}x`})),e.numUpgEvolutions=zs(e.numUpgEvolutions),e.upgType==="HM"?$u(e,e.numUpgEvolutions):(e.lvlCapBn=rr(e.lvlCap??1/0,1/0),e.lvlCap=am(e.lvlCapBn),e.lvlCapFmtHtml=Fr(e.lvlCapBn),e.lvlCapFmtText=Xs(e.lvlCapBn)),e.bulkMeta=QE(e),Ks(e)}lm=new Map;Kv=new Map;typeof window<"u"&&(jv(b()),window.addEventListener("saveSlot:change",()=>{jv(b()),Kn()}),window.addEventListener("surge:level:change",()=>{Kn()}));xg()});var W0={};St(W0,{applyAllCurrencyOverridesForActiveSlot:()=>Ol,applyStatMultiplierOverride:()=>Gn,getDebugCurrencyMultiplierOverride:()=>Ml,getDebugStatMultiplierOverride:()=>xx,setDebugCurrencyMultiplierOverride:()=>P0,setDebugPanelAccess:()=>iL,setDebugStatMultiplierOverride:()=>Tn});function Rl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function px(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function yn(e){typeof e=="function"&&Sm.push(e)}function Ku(){return{sections:new Set,subsections:new Set}}function mx(){let e=document.getElementById(kl);if(!e)return Ku();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function hx(e){let{sections:t,subsections:n}=_0??Ku();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function A0(){Sm.forEach(e=>{try{e?.()}catch{}}),Sm=[],Lm.length=0}function Ut(e){!e||typeof e.refresh!="function"||Lm.push(e)}function at(e){Lm.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function gx(){if(typeof window>"u")return;let e=h=>{let{key:m,slot:y}=h?.detail??{},g=y??b();at(v=>v.type==="currency"&&v.key===m&&v.slot===g)};window.addEventListener("currency:change",e,{passive:!0}),yn(()=>window.removeEventListener("currency:change",e));let t=h=>{let{key:m,slot:y}=h?.detail??{},g=y??b();at(v=>v.type==="currency-mult"&&v.key===m&&v.slot===g)};window.addEventListener("currency:multiplier",t,{passive:!0}),yn(()=>window.removeEventListener("currency:multiplier",t));let n=h=>{let{slot:m,changeType:y,unlocked:g}=h?.detail??{},v=m??b();at(E=>E.type==="xp"&&E.slot===v),at(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===v),(y==="unlock"||typeof g=="boolean")&&at(E=>E.type==="unlock"&&(E.slot==null||E.slot===v))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),yn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=h=>{let{changeType:m,slot:y}=h?.detail??{},g=y??b();at(v=>v.type==="mutation"&&v.slot===g),at(v=>v.type==="stat-mult"&&v.key==="mutation"&&v.slot===g),m==="unlock"&&at(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("mutation:change",o,{passive:!0}),yn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let h=b();at(m=>m.type==="upgrade"&&m.slot===h),at(m=>m.type==="currency-mult"&&m.slot===h),at(m=>m.type==="stat-mult"&&m.slot===h)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),yn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let h=b();at(m=>m.slot===h)};window.addEventListener("saveSlot:change",i,{passive:!0}),yn(()=>window.removeEventListener("saveSlot:change",i));let s=h=>{let{slot:m,key:y}=h?.detail??{},g=m??b();at(v=>v.type==="unlock"&&(v.slot==null||v.slot===g)&&(v.key==null||v.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),yn(()=>window.removeEventListener("unlock:change",s));let l=h=>{let{slot:m}=h?.detail??{},y=m??b();at(g=>g.type==="workshop-level"&&g.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),yn(()=>window.removeEventListener("workshop:change",l));let a=h=>{let{slot:m}=h?.detail??{},y=m??b();at(g=>g.type==="surge-level"&&g.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),yn(()=>window.removeEventListener("surge:level:change",a));let u=h=>{let{slot:m}=h?.detail??{},y=m??b();at(g=>g.type==="tsunami-nerf"&&(g.slot==null||g.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),yn(()=>window.removeEventListener("surge:nerf:change",u));let f=h=>{let{slot:m}=h?.detail??{},y=m??b();at(g=>g.type==="lab-level"&&(g.slot==null||g.slot===y)),at(g=>g.type==="stat-mult"&&g.key==="rp"&&(g.slot==null||g.slot===y))};window.addEventListener("lab:level:change",f,{passive:!0}),yn(()=>window.removeEventListener("lab:level:change",f));let d=h=>{let{id:m,level:y}=h?.detail??{},g=b();at(v=>v.type==="lab-node-level"&&v.slot===g&&v.id===m),m===1&&at(v=>v.type==="tsunami-nerf"&&(v.slot==null||v.slot===g)),m===4&&at(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("lab:node:change",d,{passive:!0}),yn(()=>window.removeEventListener("lab:node:change",d));let p=h=>{let{id:m,rp:y}=h?.detail??{},g=b();at(v=>v.type==="lab-node-rp"&&v.slot===g&&v.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),yn(()=>window.removeEventListener("lab:node:rp",p))}function ju(){return[{key:Se.STARTER_COVE,title:"The Cove",currencies:[{key:Ce.COINS,label:"Coins"},{key:Ce.BOOKS,label:"Books"},{key:Ce.GOLD,label:"Gold"},{key:Ce.MAGIC,label:"Magic"},{key:Ce.GEARS,label:"Gears"},{key:Ce.WAVES,label:"Waves"},{key:Ce.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function k0(){if(document.getElementById(Gu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Gu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Gu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Gu,document.head.appendChild(n)}function wm(){let e=document.getElementById(L0);e&&e.remove()}function yx(){return Ai&&ze&&b()!=null&&!Rl()&&px()}function vx(e){e?.detail?.visible&&Ro(),Qu()}function Xu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${C0++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function jn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${M0++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function At(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function _m(e,t=b()){let n=t??b();return n==null?null:`${yt.CURRENCY[e]}:${n}`}function Cl(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=P?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Ia(n,e)}catch{return c.fromInt(0)}}function bx(e,t,n=b()){let o=n??b(),r=Cl(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=_m(e,o),s=i&&ho(i);s&&ta(i);let l=r;try{bn(o),l=qi(e,t,{previous:r})??r,i&&it(i)}catch{}finally{s&&Ni(i)}return at(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function Zn(e,t){return`${e??"null"}::${t}`}function Cm(e,t){return Tl.get(Zn(e,t))??null}function Sx(e,t=b()){let n=t??b();return!e||n==null?null:`${yt.MULTIPLIER[e]}:${n}`}function Ix(e,t=b()){let n=Zn(t,e);Tl.delete(n),Qs.delete(n),at(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function Mm(e,t){let n=!Zu(t,e),o=Zn(e,t),r=Al.get(o);if(!n&&r)return r;let i=wx(t,e);return i?(Al.set(o,i),i):(n&&Al.delete(o),null)}function T0(e,t){at(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function N0(e,t=b()){let n=Ti(e,t);if(Al.delete(Zn(t,e)),Li.delete(Zn(t,e)),!(!n||typeof localStorage>"u")&&!ho(n)){try{localStorage.removeItem(n)}catch{}T0(e,t)}}function Zu(e,t=b()){return ho(Ti(e,t))}function R0(e,t){return Zu(t,e)?Mm(e,t):null}function Nn(e,t=b()){let n=ki(e);return Ju(e,t,n)??n}function Ti(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${cx}:${e}:${n}`}function ki(e){try{if(e==="xp"){let t=fc();if(t)return t}else if(e==="mutation"){let t=tf?.();if(t)return t;let n=ef();if(n)return n}else if(e==="spawnRate"){let t=us(Se.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return Rc()}catch{}return c.fromInt(1)}function wx(e,t=b()){let n=Ti(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function Ex(e,t,n){let o=Ti(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=ho(o),s=i&&Js?Js:localStorage.setItem.bind(localStorage);i&&!Js&&ta(o),s(o,r.toStorage?.()??String(r)),i&&!Js&&Ni(o)}catch{}}function Am(e,t=b()){if(t==null)return;let n=Cm(t,e);if(!n||t!==b())return;let o=Zn(t,e);if(!Vu.has(o)){Vu.add(o);try{let r=P?.[e]?.mult?.get?.();At(r,n)||P?.[e]?.mult?.set?.(n)}catch{}finally{Vu.delete(o)}}}function O0(){if(!(S0||typeof window>"u")){S0=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=Zn(r,t);if(!r||!Tl.has(i)||Vu.has(i))return;let s=Qs.get(i),l=Cm(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,p=l.mulBigNumInteger(f);Tl.set(i,p)}}catch{}Qs.set(i,o)}else o&&Qs.set(i,o);Am(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Ol()},{passive:!0})}catch{}}}function Ol(){let e=b();e!=null&&Object.values(Ce).forEach(t=>{Am(t,e)})}function P0(e,t,n=b()){if(!e||n==null)return null;O0();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=Zn(n,e);if(Tl.set(r,o),!Qs.has(r)){let i=P?.[e]?.mult?.get?.();Qs.set(r,i)}return Am(e,n),o}function Ml(e,t=b()){return!e||t==null?null:Cm(t,e)}function Tn(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Al.set(Zn(n,e),o),Li.set(Zn(n,e),ki(e)),Ex(e,n,o),T0(e,n),o}function xx(e,t=b()){return!e||t==null?null:Mm(t,e)}function Gn(e,t,n=b()){let o=ki(e),r=Ju(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(At(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=Zn(n,e),l=Li.get(s),a=Zu(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function Ju(e,t,n){let o=Mm(t,e),r=Zn(t,e);if(!o)return Li.delete(r),null;let i=Li.get(r),s=Zu(e,t);if(!i)Li.set(r,n);else if(!At(i,n))return s?(Li.set(r,n),o):(N0(e,t),null);return o}function Lx(){if(!(v0||typeof localStorage>"u")){v0=!0;try{Js=localStorage.setItem.bind(localStorage),b0=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ea.has(e))return Js(e,t)},localStorage.removeItem=e=>{if(!ea.has(e))return b0(e)}}catch{}}}function ho(e){return e!=null&&ea.has(e)}function Ni(e){e&&(Lx(),ea.add(e))}function ta(e){e&&ea.delete(e)}function _x(e){return e?ho(e)?(ta(e),!1):(Ni(e),!0):!1}function Cx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=ho(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(_x(e),typeof t=="function")try{t(ho(e))}catch{}o()}),o(),{button:n,refresh:o}}function Mx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>ho(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>ho(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?ta(u):Ni(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function Ax(){let e=document.getElementById(kl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function kx(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{ho(r)&&(o.push(r),ta(r))});try{return t?.()}finally{o.forEach(r=>Ni(r))}}function Tx(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function km(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Em(e,t){e.classList.toggle("debug-invalid",!t)}function Je(){let e=b();try{bn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function B0(e=b()){return e==null?null:`${ux}:${e}`}function F0(e=b()){let t=B0(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function U0(e,t=b()){let n=B0(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,Im);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function Nx(e,t=b()){let n=F0(t);return n.unshift(e),n.length>Im&&(n.length=Im),U0(n,t),n}function Qe(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};Nx(o,t),Tm()}function Tm(){if(!Zs)return;let e=F0();if(e.length===0){Zs.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",Zs.appendChild(t);return}Zs.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function D0(e=b()){return e==null?null:`${tl}:${e}`}function $0(e,t=b()){let n=D0(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function q0(e=b()){let t=D0(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function Rx(e){if(e){if(Object.values(Ce).includes(e.type)){try{e.type===Ce.BOOKS?P.books.addWithMultiplier?.(e.amount)??P.books.add(e.amount):P[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function Ox(){let e=b();if(e==null)return{completed:0};let t=q0(e),n=0;return Object.entries(Xc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,Rx(r.reward))}),$0(t,e),{completed:n}}function Px(){let e=b();if(e==null)return{restored:0};let t=q0(e),n=0;return Object.entries(Xc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),$0(t,e),{restored:n}}function rn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,p=!1,h=r?Cx(r,{onToggle:i}):null,m=g=>{if(f){d=g;return}d=null,u.value=typeof s=="function"?s(g):Tx(g)};l.appendChild(u),h&&l.appendChild(h.button);let y=()=>{let g=km(u.value);if(!g){Em(u,!1);return}Em(u,!0);let v=r&&ho(r);v&&ta(r);try{n(g,{input:u,setValue:m})}finally{v&&Ni(r),h&&h.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",y),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),p=!0,y(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,p||y(),p=!1,d!=null){let g=d;d=null,m(g)}}),m(t),h&&h.refresh(),{row:l,input:u,setValue:m,isEditing:()=>f}}function Bx({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let y=document.createElement("span");y.className="debug-unlock-desc",y.textContent=`- ${t}`,f.appendChild(y)}s.appendChild(l),s.appendChild(f);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",y=>{l.contains(y.target)||p()});let h=!1,m=()=>{let y=!1;try{y=typeof n=="function"?!!n():!1}catch{}return a.checked=y,h=y,y};return a.addEventListener("change",()=>{let y=h,g=a.checked;try{g?o?.():r?.()}catch{}Je();let v=m();y!==v&&Qe(`Toggled ${e} [GOLD]${y?"True":"False"}[/GOLD] \u2192 [GOLD]${v?"True":"False"}[/GOLD]`)}),m(),Ut({type:"unlock",slot:i,refresh:m}),s}function Fx(e){try{if(e instanceof c||typeof e?.toScientific=="function")return ne(e);let t=Number(e);return Number.isFinite(t)?ne(t):String(e??"\u2014")}catch{return"\u2014"}}function Ux({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:p})=>{if(d.type==="select"){u[d.key]=p.value;return}let h=km(p.value),m=h instanceof c;if(Em(p,m),!m){f=!0;return}u[d.key]=h}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=Fx(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:p,label:h})=>{let m=document.createElement("option");m.value=p,m.textContent=h??p,f.defaultValue!=null&&f.defaultValue===p&&(m.selected=!0),d.appendChild(m)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function Dr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return et()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Kr()}catch{}let f=_i.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(it(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),p=_i.level(n);localStorage.setItem(p,d),it(p,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),p=_i.progress(n);localStorage.setItem(p,d),it(p,d)}catch{}try{Ki({forceReload:!0})}catch{}try{cc({changeType:"debug-panel",slot:n})}catch{}try{at()}catch{}}function $r({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return dt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Nl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{jt()}catch{}try{Pr()}catch{}let f=Ci.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(it(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),p=Ci.level(n);localStorage.setItem(p,d),it(p,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),p=Ci.progress(n);localStorage.setItem(p,d),it(p,d)}catch{}try{jt({forceReload:!0})}catch{}try{Nm({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{at()}catch{}}function Dx(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=_m(r.key,n),s=Cl(r.key,n),l=rn(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=Cl(r.key,f),{next:p}=bx(r.key,a,f);u(p),At(d,p)||(Je(),Qe(`Modified ${r.label} (${o}) ${ne(d)} \u2192 ${ne(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(Cl(r.key,b()))});Ut({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=Cl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function $x(e,t){let n=b();if(n==null){let F=document.createElement("div");F.className="debug-panel-empty",F.textContent="Select a save slot to edit stats.",e.appendChild(F);return}let o="spawnRate",r=Ti(o,n),i=rn("Coin Spawn Rate",Nn(o,n),(F,{setValue:q})=>{let L=b();if(L==null)return;let B=Nn(o,L);try{Tn(o,F,L)}catch{}let M=Nn(o,L);q(M),At(B,M)||(Je(),Qe(`Modified Spawn Rate (${a}) ${ne(B)} \u2192 ${ne(M)}`))},{storageKey:r,onLockChange:F=>{let q=b();if(q!=null){if(F){if(R0(q,o))return;try{Tn(o,ki(o),q)}catch{}}else Ju(o,q,ki(o));i.setValue(Nn(o,q))}}});Ut({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let F=Nn(o,n);i.setValue(F)}}),Ut({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let F=Nn(o,n);i.setValue(F)}}),e.appendChild(i.row);let s=et(),l=dt(),a=t?.title??t?.key??"Unknown Area",u=_i.level(n),f=rn("XP Level",s.xpLevel,(F,{setValue:q})=>{let L=et().xpLevel;Dr({level:F});let B=et();q(B.xpLevel),At(L,B.xpLevel)||(Je(),Qe(`Modified XP Level (${a}) ${ne(L)} \u2192 ${ne(B.xpLevel)}`))},{storageKey:u});Ut({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(et().xpLevel)}}),e.appendChild(f.row);let d=_i.progress(n),p=rn("XP Progress",s.progress,(F,{setValue:q})=>{let L=et(),B=L?.xpLevel?.clone?.()??L?.xpLevel,M=L?.progress?.clone?.()??L?.progress;Dr({progress:F});let x=et();q(x.progress),f.setValue(x.xpLevel),(!At(M,x.progress)||!At(B,x.xpLevel))&&(Je(),Qe(`Modified XP Progress (${a}) ${ne(M)} \u2192 ${ne(x.progress)}`))},{storageKey:d});Ut({type:"xp",slot:n,refresh:()=>{n===b()&&p.setValue(et().progress)}}),e.appendChild(p.row);let h=Ci.level(n),m=rn("MP Level",l.level,(F,{setValue:q})=>{let L=dt().level;$r({level:F});let B=dt();q(B.level),At(L,B.level)||(Je(),Qe(`Modified MP Level (${a}) ${ne(L)} \u2192 ${ne(B.level)}`))},{storageKey:h});Ut({type:"mutation",slot:n,refresh:()=>{n===b()&&m.setValue(dt().level)}}),e.appendChild(m.row);let y=Ci.progress(n),g=rn("MP Progress",l.progress,(F,{setValue:q})=>{let L=dt(),B=L?.level?.clone?.()??L?.level,M=L?.progress?.clone?.()??L?.progress;$r({progress:F});let x=dt();q(x.progress),m.setValue(x.level),(!At(M,x.progress)||!At(B,x.level))&&(Je(),Qe(`Modified MP Progress (${a}) ${ne(M)} \u2192 ${ne(x.progress)}`))},{storageKey:y});Ut({type:"mutation",slot:n,refresh:()=>{n===b()&&g.setValue(dt().progress)}}),e.appendChild(g.row);let v=ri(n);if(v){let F=0;try{let L=localStorage.getItem(v),B=c.fromAny(L||"0");if(B.isInfinite())F=1/0;else try{F=Number(B.toScientific(20))}catch{F=0}}catch{}let q=rn("Workshop Level",F,(L,{setValue:B})=>{let M=Number(L);if(console.log("[DebugPanel] Workshop Level Commit. Value type:",typeof L,"IsBigNum:",L instanceof c,"Value:",L),L instanceof c)if(L.isInfinite())M=1/0;else try{M=Number(L.toScientific(20))}catch{M=NaN}if(Number.isNaN(M)||M<0)return;let x=M===1/0?"Infinity":String(Math.floor(M));try{localStorage.setItem(v,x),Je(),Qe(`Modified Workshop Level (The Cove) ${ne(F)} \u2192 ${x}`),F=M}catch{}B(M)},{storageKey:v,onLockChange:()=>{let L=0;try{let B=localStorage.getItem(v),M=c.fromAny(B||"0");M.isInfinite()?L=1/0:L=Number(M.toScientific(20))}catch{}q.setValue(L)}});e.appendChild(q.row),Ut({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let L=0;try{let B=localStorage.getItem(v),M=c.fromAny(B||"0");M.isInfinite()?L=1/0:L=Number(M.toScientific(20))}catch{}q.setValue(L)}})}let E=Us(n);if(E){let F=0;try{let L=localStorage.getItem(E);L==="Infinity"?F=1/0:F=c.fromAny(L||"0")}catch{F=c.fromInt(0)}let q=rn("Surge Level",F,(L,{setValue:B})=>{let M="0",x=0;L instanceof c?L.isInfinite()?(M="Infinity",x=1/0):(M=L.toPlainIntegerString(),x=L):L===1/0||typeof L=="string"&&/infinity/i.test(L)?(M="Infinity",x=1/0):(M=String(L),x=L);try{localStorage.setItem(E,M),Je();let X=x===1/0?"Infinity":ne(x),J=F===1/0||F instanceof c&&F.isInfinite()?"Infinity":ne(F);Qe(`Modified Surge Level (The Cove) ${J} \u2192 ${X}`),x===1/0?F=1/0:x instanceof c?F=x:F=c.fromAny(x);let se=!1;F===1/0?se=!0:F instanceof c?typeof F.cmp=="function"&&F.cmp(8)>=0&&(se=!0):typeof F=="number"&&F>=8&&(se=!0),se&&(di(0),un()||zo(!0))}catch{}B(x);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let X=F;if(X!==1/0&&X instanceof c)try{X=BigInt(X.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:X}}))}catch{}},{storageKey:E,onLockChange:L=>{let B=c.fromInt(0);try{let M=localStorage.getItem(E);M==="Infinity"?B=1/0:B=c.fromAny(M||"0")}catch{}q.setValue(B)}});Ut({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let L=c.fromInt(0);try{let B=localStorage.getItem(E);B==="Infinity"?L=1/0:L=c.fromAny(B||"0")}catch{}q.setValue(L)}}),e.appendChild(q.row)}let C=Yt(),A=rn("Lab Level",C,(F,{setValue:q})=>{let L;try{L=F instanceof c?F:c.fromAny(F),L.isNegative&&L.isNegative()&&(L=c.fromInt(0))}catch{q(Yt());return}let B=Yt();ui(L),Je(),At(B,L)||Qe(`Modified Lab Level (The Cove) ${ne(B)} \u2192 ${ne(L)}`),q(L)},{storageKey:Cd(n)});Ut({type:"lab-level",slot:n,refresh:()=>{n===b()&&A.setValue(Yt())}}),e.appendChild(A.row);let N=()=>{let F=En(),q=Lo(),L=F+q;return L>1&&(L=1),L},H=rn("Tsunami Exponent",N().toFixed(2),(F,{setValue:q})=>{let L=Number(F);if(F instanceof c?F.isInfinite()?L=1/0:L=Number(F.toScientific(10)):typeof F=="string"&&/infinity/i.test(F)&&(L=1/0),Number.isNaN(L)){q(N().toFixed(2));return}let B=Lo(),M=L-B;M>1&&(M=1),M<0&&(M=0),M=Math.round(M*100)/100;let x=En();di(M),Je(),Math.abs(x-M)>1e-4&&Qe(`Modified Tsunami Exponent (The Cove) Base:${x.toFixed(2)} \u2192 ${M.toFixed(2)} (Effective: ${L.toFixed(2)})`),q(N().toFixed(2))},{storageKey:Ld(n),format:F=>{let q=Number(F);return Number.isFinite(q)?q.toFixed(2):String(F)}});Ut({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let F=N();H.setValue(F.toFixed(2))}}),e.appendChild(H.row)}function I0(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Pt(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=wn(t.key,i.id??i.tie),u=xi(t.key,i.id??i.tie,n),f=rn(l,a,(d,{setValue:p})=>{if(b()==null)return;let m=wn(t.key,i.id??i.tie);try{nr(t.key,i.id??i.tie,d,!1)}catch{}let y=wn(t.key,i.id??i.tie);p(y),At(m,y)||(Je(),Qe(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${ne(m)} \u2192 Lv${ne(y)}`))},{idLabel:s,storageKey:u});Ut({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=wn(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function qx(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=P?.[r.key]?.mult,l=Ml(r.key,n)??i?.get?.()??c.fromInt(1),a=`${yt.MULTIPLIER[r.key]}:${n}`,u=rn(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let p=b();if(p==null)return;let h=Ml(r.key,p)??i?.get?.()??c.fromInt(1);try{P0(r.key,f,p)}catch{}Ol();let y=Ml(r.key,p)??i?.get?.()??c.fromInt(1);d(y),At(h,y)||(Je(),Qe(`Modified ${r.label} Multiplier (${o}) ${ne(h)} \u2192 ${ne(y)}`))},{storageKey:a});Ut({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=Ml(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function Gx(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Ce).forEach(o=>{let r=P?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||At(i,t))return;r.set(t),n+=1}catch{}}),n}function Hx(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Ce).forEach(o=>{let r=P?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function Xx(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=et()}catch{}try{r=dt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||At(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||At(o?.progress,t);(!i||!s)&&(Dr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||At(r?.level,t),s=r?.progress?.isInfinite?.()||At(r?.progress,t);(!i||!s)&&($r({level:t,progress:t}),n+=1)}}catch{}try{let i=ri(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Us(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{at()}catch{}return n}function Wx(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=et()}catch{}try{r=dt()}catch{}try{o?.unlocked&&(Dr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&($r({level:t,progress:t}),n+=1)}catch{}try{let i=ri(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Us(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{at()}catch{}return n}function G0(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!et()?.unlocked}catch{return!1}},onEnable:()=>{try{Kr()}catch{}try{Ki({forceReload:!0})}catch{}},onDisable:()=>{try{ji({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Nl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{Nl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return np()}catch{return!1}},onEnable:()=>{try{vi()}catch{}},onDisable:()=>{try{ru()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return op()}catch{return!1}},onEnable:()=>{try{ou()}catch{}},onDisable:()=>{try{iu()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return Yd()}catch{return!1}},onEnable:()=>{try{Gc(!0)}catch{}},onDisable:()=>{try{Gc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!un()}catch{return!1}},onEnable:()=>{try{zo(!0)}catch{}},onDisable:()=>{try{zo(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return mt(4)>=1}catch{return!1}},onEnable:()=>{try{wr(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{wr(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function H0(e){let t=b();if(t==null)return 0;let n=0;G0(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{at()}catch{}return n}function Vx(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;ju().forEach(o=>{Pt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Ei(o.key,r,e),t+=1}catch{}})});try{vi()}catch{}try{ou()}catch{}let n=H0(!0);return{unlocks:t,toggles:n}}function Yx(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;ju().forEach(o=>{Pt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{pm(o.key,r,e),t+=1}catch{}})});try{ru()}catch{}try{iu()}catch{}let n=H0(!1);return{locks:t,toggles:n}}function zx(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(_m(a,n)),r(Sx(a,n))},s=a=>r(Ti(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(_i.level(n)),r(_i.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(Ci.level(n)),r(Ci.progress(n)))};return e==="all"?(Object.values(Ce).forEach(i),l("xp"),l("mutation"),zu.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Ce).forEach(i),Array.from(o)):e==="allUnlockedStats"?(et()?.unlocked&&l("xp"),dt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Ce).forEach(i),et()?.unlocked&&l("xp"),dt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function Wu(e){try{P?.[e]?.set?.(c.fromInt(0))}catch{}try{Ix(e)}catch{}try{ec(e,c.fromInt(1))}catch{}}function Kx(e){if(e==="all"){Object.values(Ce).forEach(i=>Wu(i));let o=c.fromInt(0);return Dr({level:o,progress:o}),$r({level:o,progress:o}),zu.forEach(({key:i})=>{try{Tn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Ce).length+zu.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Ce).forEach(i=>{Wu(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(et()?.unlocked){Dr({level:o,progress:o});try{Tn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(dt()?.unlocked){$r({level:o,progress:o});try{Tn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Ce).forEach(l=>{Wu(l),o+=1});let r=c.fromInt(0),i=0;try{if(et()?.unlocked){Dr({level:r,progress:r});try{Tn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(dt()?.unlocked){$r({level:r,progress:r});try{Tn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return Wu(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{N0(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Dr({level:n,progress:n});try{Tn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){$r({level:n,progress:n});try{Tn("mutation",c.fromInt(1))}catch{}return"MP"}try{Tn(t,c.fromInt(1))}catch{}return`stat ${t}`}function jx(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";zu.forEach(r=>{if(r.key==="spawnRate")return;let i=Ti(r.key,n),s=rn(`${r.label} Multiplier`,Nn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Nn(r.key,u);try{Tn(r.key,l,u)}catch{}let d=Nn(r.key,u);a(d),At(f,d)||(Je(),Qe(`Modified ${r.label} Multiplier (${o}) ${ne(f)} \u2192 ${ne(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if(R0(a,r.key))return;try{Tn(r.key,ki(r.key),a)}catch{}}else Ju(r.key,a,ki(r.key));s.setValue(Nn(r.key,a))}}});Ut({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Nn(r.key,n);s.setValue(l)}}),Ut({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Nn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Ut({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Nn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function Zx(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Ft||Ft.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Ft.forEach(n=>{let o=jn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=Va(t,n.id),s=rn("Level",mt(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let p=mt(n.id);wr(n.id,d),Je(),p!==d&&Qe(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${d}`),f(d)},{storageKey:i});Ut({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(mt(n.id))}}),r.appendChild(s.row);let l=Ya(t,n.id),a=rn("Current RP",ao(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(ao(n.id));return}let p=ao(n.id);ms(n.id,d),Je(),At(p,d)||Qe(`Modified Node ${n.id} RP (The Cove) ${ne(p)} \u2192 ${ne(d)}`),f(d)},{storageKey:l});Ut({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(ao(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function Jx(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>uc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>zf(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Rm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Fs(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>Sr(n)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>mm(n,o,r)}]}].forEach(n=>{let o=jn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=Ux({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function Qx(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Ol(),ju().forEach(o=>{let r=jn(o.title,i=>{let s=jn("Currencies",h=>{Dx(h,o)}),l=jn("Stats",h=>{$x(h,o)}),a=jn("Multipliers",h=>{let m=jn("Currencies",g=>{qx(g,o)}),y=jn("Stats",g=>{jx(g,o)});h.appendChild(m),h.appendChild(y)}),u=jn("Upgrades",h=>{I0(h,o)}),f=null,d=null;o.key===Se.STARTER_COVE&&(f=jn("Automation Upgrades",h=>{I0(h,{key:Se.AUTOMATION,title:"Automation"})}),d=jn("Lab Nodes",h=>{Zx(h)}));let p=jn("Calculators",h=>{Jx(h)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),i.appendChild(p)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function w0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Se),r=[];return o.forEach(i=>{Pt(i).forEach(l=>{e&&Mo(i,l.id).locked||r.push({areaKey:i,upg:l})})}),wl(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;nr(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function E0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Se),r=[];o.forEach(s=>{Pt(s).forEach(a=>{e&&Mo(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{wl(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Ir(s,l.id,"0"),nr(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function x0(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Pt(Ke);wl(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;nr(Ke,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(os),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Se).forEach(l=>{if(l===Ke)return;Pt(l).forEach(u=>{s.has(u.costType)&&(Ir(l,u.id,n),o++)})}),Ir(Ke,to,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function eL(e){e.innerHTML="";let t=b();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=Ox();Je(),Qe(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=Px();Je(),Qe(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=Gx();Je(),Qe(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=Xx();Je(),Qe(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=Hx();Je(),Qe(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=Wx();Je(),Qe(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let g=w0(!0);Je(),Qe(`Maxed ${g} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let g=E0(!0);Je(),Qe(`Reset ${g} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let g=w0(!1);Je(),Qe(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=E0(!1);Je(),Qe(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=x0(!0);Je(),Qe(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=x0(!1);Je(),Qe(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:v}=Vx();Je(),Qe(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:v}=Yx();Je(),Qe(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{U0([],t),Tm(),Je(),Qe("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=b();if(g!=null)try{localStorage.setItem(fx(g),String(dx)),jo(!0),Je(),Qe("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let v=km(g);if(!v||typeof v.isZero=="function"&&v.isZero()||typeof v.isNegative=="function"&&v.isNegative())return;let E,C=!1;Dt()?E=Is(v):(E=Pc(v),C=!0),hi(E);let A=v.mulSmall?v.mulSmall(1e3):v.mulBigNumInteger(c.fromInt(1e3));Cr(E,A,C),Je(),Qe(`Performed OP Time Warp for ${ne(v)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle debug-misc-button",v.textContent=g.label,v.addEventListener("click",g.onClick),o.appendChild(v)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",ju().forEach(g=>{let v=document.createElement("optgroup");v.label=g.title||g.key,g.currencies.forEach(E=>{let C=document.createElement("option");C.value=`currency:${E.key}`,C.textContent=`${g.title||g.key} \u2192 ${E.label}`,v.appendChild(C)}),g.stats.forEach(E=>{let C=document.createElement("option");C.value=`stat:${E.key}`,C.textContent=`${g.title||g.key} \u2192 ${E.label}`,v.appendChild(C)}),s.appendChild(v)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${Hu}"]`)||(Hu=_l),s.value=Hu;let d=()=>zx(s.value||_l,b()),p=Mx(d);s.addEventListener("change",()=>{Hu=s.value||_l,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle reset-check",h.textContent="\u2705",h.addEventListener("click",()=>{let g=s.value||_l,v=d(),E=p.isLocked(),C=(A=!0)=>{let N=kx(v,()=>Kx(g))??{label:g,count:0};if(E&&v.forEach(H=>Ni(H)),p.refresh(),Je(),A){let{label:H,count:F}=N;Qe(`Reset ${F===1?"value and multiplier":"values and multipliers"} for ${H} to defaults.`)}};C(!0),setTimeout(()=>C(!1),100)}),r.appendChild(h),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-danger-button",y.textContent="Wipe Slot & Refresh",y.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let v=document.querySelector(".menu-root"),E=document.getElementById("game-root");v&&(v.hidden=!1,v.style.display="",v.style.visibility=""),E&&(E.hidden=!0,E.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(y),e.appendChild(m)}function tL(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Ki()}catch{}let n=G0(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(Bx(o))})}function X0(){if(!Ai||Rl())return;A0(),k0(),C0=0,M0=0;let e=document.getElementById(kl);e&&e.remove();let t=document.createElement("div");t.id=kl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Ro({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Ro()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let p=document.createElement("div");p.className="debug-panel-info-line",d&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=f,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(Xu("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{Qx(f)})),t.appendChild(Xu("Unlocks: modify specific unlock flags","debug-unlocks",f=>{tL(f)})),t.appendChild(Xu("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),Zs=d,Tm(),yn(()=>{Zs=null})})),t.appendChild(Xu("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{eL(f)})),hx(t),document.body.appendChild(t),Yu>0)try{t.scrollTop=Yu}catch{}gx(),Mi=!0}function xm(){if(!(!Ai||Rl())){if(b()==null){Ro();return}Mi||X0()}}function Ro({preserveExpansionState:e=!1}={}){_0=e?mx():Ku();let t=document.getElementById(kl);if(t){try{Yu=t.scrollTop??0}catch{Yu=0}t.remove()}A0(),Mi=!1}function nL(){if(!Ai||Rl()||b()==null){Ro();return}Mi?Ro({preserveExpansionState:!0}):xm()}function oL(){Ro(),wm()}function Qu(){if(!yx()){wm(),Ro();return}k0(),wm();let e=document.createElement("button");e.id=L0,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{nL()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function rL(e){if(Ai=!!e,!Ai){oL();return}Qu()}function iL(e){rL(e)}var Gu,kl,L0,_l,Mi,Ai,Sm,_0,Yu,Hu,C0,M0,Lm,Zs,Tl,Qs,Vu,Al,Li,ea,v0,Js,b0,cx,ux,Im,fx,dx,vm,_i,bm,Ci,zu,S0,Ji=Fe(()=>{It();Kt();vt();qn();xo();ro();oo();su();Yc();as();Eo();io();ds();ti();Bd();fi();ci();Bc();Gu="debug-panel-style",kl="debug-panel",L0="debug-panel-toggle",_l=`currency:${Ce.COINS}`,Mi=!1,Ai=!1,Sm=[],_0=Ku(),Yu=0,Hu=_l,C0=0,M0=0,Lm=[],Zs=null,Tl=new Map,Qs=new Map,Vu=new Set,Al=new Map,Li=new Map,ea=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=ea);v0=!1,Js=null,b0=null,cx="ccc:debug:stat-mult",ux="ccc:actionLog",Im=100,fx=e=>`ccc:warp:charges:${e}`,dx=24;vm="ccc:xp",_i={unlock:e=>`${vm}:unlocked:${e}`,level:e=>`${vm}:level:${e}`,progress:e=>`${vm}:progress:${e}`},bm="ccc:mutation",Ci={unlock:e=>`${bm}:unlocked:${e}`,level:e=>`${bm}:level:${e}`,progress:e=>`${bm}:progress:${e}`},zu=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];S0=!1;Ol();O0();document.addEventListener("keydown",e=>{if(!(!Ai||Rl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){Mi?(Ax(),Ro()):xm(),e.preventDefault();return}Mi?Ro({preserveExpansionState:!0}):xm(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Qu()});window.addEventListener("menu:visibilitychange",vx);window.addEventListener("saveSlot:change",()=>{Qu(),Mi&&X0()})});var K0={};St(K0,{addExternalMutationGainMultiplierProvider:()=>si,addMutationPower:()=>Es,broadcastMutationChange:()=>Nm,computeMutationMultiplierForLevel:()=>Fs,computeMutationRequirementForLevel:()=>Rm,getMutationCoinSprite:()=>zp,getMutationGainMultiplier:()=>tf,getMutationMultiplier:()=>ef,getMutationState:()=>dt,getTotalCumulativeMp:()=>Sl,initMutationSystem:()=>jt,isMutationUnlocked:()=>ko,onMutationChange:()=>wi,setMutationUnlockedForDebug:()=>Nl,unlockMutationSystem:()=>Pr});function nf(e){try{return e?.toStorage?.()}catch{return null}}function Bi(){try{Qt()}catch{}}function z0(e){let t=e;if(!t.isZero?.()){let n=Pi.size>0?Array.from(Pi):typeof Fl=="function"?[Fl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof je?t=r.clone?.()??r:r!=null&&(t=je.fromAny(r))}catch{}}return t}function lL(){if(typeof Om=="function"){try{Om()}catch{}Om=null}if(typeof Pm=="function"){try{Pm()}catch{}Pm=null}}function Ul(e){if(e instanceof je)try{return e.clone?.()??je.fromAny(e)}catch{return ht()}try{return je.fromAny(e??0)}catch{return ht()}}function cL(e){if(!e||typeof e!="object")return ht();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?je.fromInt(100):je.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function rf(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=ke(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Gm(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(f+=aL*(p-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=rf(e);if(!Number.isFinite(n))return je.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return je.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return je.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return je.fromAny("Infinity");let i=Me(r);return cL(i)}function qr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=Gm(D.level);D.requirement=n}function uL(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=ke(e),l=ke(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Dm(){return Rn.container&&Rn.container.isConnected?!0:(Rn.container=document.querySelector("[data-mp-hud].mp-counter"),Rn.container?(Rn.bar=Rn.container.querySelector(".mp-bar"),Rn.fill=Rn.container.querySelector(".mp-bar__fill"),Rn.levelValue=Rn.container.querySelector(".mp-level-value"),Rn.progress=Rn.container.querySelector("[data-mp-progress]"),!0):!1)}function Ri(e){try{return ne(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function lr(){if(!Dm())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Rn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Ri(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Ri(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Wi();return}e.removeAttribute("hidden");let i=D.requirement,s=uL(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Ri(D.level)),r){let a=Ri(D.progress),u=Ri(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Ri(D.progress).replace(/<[^>]*>/g,""),u=Ri(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Wi()}function cr(e="update",t={}){let n=dt(),o={...n,slot:D.slot??b(),changeType:e,...t};if(Um.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function Hm(){let e=D.slot;if(e==null&&(e=b(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(Pl(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Oi(e),D.level.toStorage())}catch{}try{localStorage.setItem(na(e),D.progress.toStorage())}catch{}it(Pl(e)),it(Oi(e)),it(na(e));let t=(()=>{let u=D.unlocked,f=D.level,d=D.progress;try{u=localStorage.getItem(Pl(e))==="1"}catch{}try{let p=localStorage.getItem(Oi(e));p&&(f=je.fromAny(p))}catch{}try{let p=localStorage.getItem(na(e));p&&(d=je.fromAny(p))}catch{}return{unlocked:u,level:f,progress:d}})(),n=nf(t.level),o=nf(t.progress),r=nf(D.level),i=nf(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&of(t,{skipPersist:!0})}function $m(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function fL(){if(!D.unlocked)return;let e=D.slot??b();if(e!=null&&$m(Oi(e))){qr();return}qr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(oa()),qr(),t=D.requirement,!t||typeof t!="object"){D.progress=ht();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=ht())}function of(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=Ul(e.level),D.progress=Ul(e.progress),D.unlocked||(D.level=ht(),D.progress=ht()),qr(),t||Hm(),lr(),cr("load"),Bi()}function Bm(e){let t=e??b();if(t==null){of({unlocked:!1,level:ht(),progress:ht()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=ht(),r=ht();try{n=localStorage.getItem(Pl(t))==="1"}catch{}try{let i=localStorage.getItem(Oi(t));i&&(o=je.fromAny(i))}catch{}try{let i=localStorage.getItem(na(t));i&&(r=je.fromAny(i))}catch{}of({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function dL(){for(;Bl.length;){let e=Bl.pop();try{e?.()}catch{}}}function Fm(e){V0!==e&&(dL(),V0=e,e!=null&&(Bl.push(Ct(Pl(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=ht(),D.progress=ht()),qr(),lr(),cr("storage"),Bi())}})),Bl.push(Ct(Oi(e),{onChange(t){if(t)try{let n=je.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,qr(),lr(),cr("storage"),Bi())}catch{}}})),Bl.push(Ct(na(e),{onChange(t){if(t)try{let n=je.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,qr(),lr(),cr("storage"))}catch{}}}))))}function jt({forceReload:e=!1}={}){if(lL(),Y0){let n=b();return(n!==D.slot||e)&&Bm(n),Fm(n),Dm(),lr(),dt()}Y0=!0,Dm();let t=b();return D.slot=t,Bm(t),Fm(t),lr(),Bi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();D.slot=n,Bm(n),Fm(n),lr(),Bi(),cr("slot")}),dt()}function dt(){return{unlocked:D.unlocked,level:Ul(D.level),progress:Ul(D.progress),requirement:Ul(D.requirement)}}function ko(){return!!D.unlocked}function Pr(){return jt(),D.unlocked?!1:(D.unlocked=!0,qr(),Hm(),lr(),cr("unlock"),Bi(),!0)}function Nl(e){jt();let t=!!e;of({unlocked:t,level:t?D.level:ht(),progress:t?D.progress:ht()})}function Es(e){jt();let t=D.slot??b();if(t!=null&&$m(na(t))||!D.unlocked)return dt();let n=t!=null&&$m(Oi(t));if(D.level&&D.level.isInfinite?.()){let f=D.level.clone?.()??D.level,d=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=je.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=je.fromAny("Infinity")}catch{}let p;try{p=e instanceof je?e:je.fromAny(e??0)}catch{p=ht()}return p=z0(p),p=Gn("mutation",p),cr("progress",{delta:p.clone?.()??p,levelsGained:ht(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof je?e:je.fromAny(e??0)}catch{o=ht()}if(o=z0(o),o=Gn("mutation",o),o.isZero?.())return dt();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=je.fromAny("Infinity")}catch{}try{D.progress=je.fromAny("Infinity")}catch{D.progress=ht()}try{D.requirement=je.fromAny("Infinity")}catch{}}else fL();Hm(),lr();let a=D.level.sub(i);return a.isZero?.()||Bi(),cr("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Nm(e={}){jt();let t=e.changeType??"manual";return cr(t,e)}function Fs(e){let t;if(e instanceof je)try{t=e.clone?.()??e}catch{t=ht()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=ht()}else try{t=c.fromAny(e??0)}catch{t=ht()}if(t&&t.isInfinite?.())try{return je.fromAny("Infinity")}catch{return oa()}let n=rf(t);if(!Number.isFinite(n))try{return je.fromAny("Infinity")}catch{return oa()}if(n<=0)return oa();let o=n*sL;return Me(o)}function Rm(e){let t;try{t=e instanceof je?e:je.fromAny(e??0)}catch{t=ht()}try{return Gm(t)}catch{return ht()}}function ef(){if(jt(),!D.unlocked)return oa();try{return Fs(D.level)}catch{return oa()}}function tf(){let e=c.fromInt(1);if(Pi.size>0||Fl){let t=Pi.size>0?Array.from(Pi):typeof Fl=="function"?[Fl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof je?e=o.clone?.()??o:o!=null&&(e=je.fromAny(o))}catch{}}return e}function zp(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=rf(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function wi(e){return typeof e!="function"?()=>{}:(Um.add(e),()=>{Um.delete(e)})}function si(e){return typeof e!="function"?()=>{}:(Pi.add(e),()=>{Pi.delete(e)})}function Sl(){if(jt(),!D.unlocked)return ht();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=rf(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=Gm(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var qm,Pl,Oi,na,je,ht,oa,sL,aL,D,Rn,Um,Bl,V0,Y0,Om,Pm,Pi,Fl,xo=Fe(()=>{It();vt();Ji();Kt();It();Ff();qn();qm="ccc:mutation",Pl=e=>`${qm}:unlocked:${e}`,Oi=e=>`${qm}:level:${e}`,na=e=>`${qm}:progress:${e}`,je=c,ht=()=>je.fromInt(0),oa=()=>je.fromInt(1),sL=Math.log10(2),aL=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:ht(),progress:ht(),requirement:ht(),slot:null},Rn={container:null,bar:null,fill:null,levelValue:null,progress:null},Um=new Set,Bl=[],V0=null,Y0=!1,Om=null,Pm=null,Pi=new Set,Fl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:jt,unlockMutationSystem:Pr,addMutationPower:Es,getMutationState:dt,getMutationMultiplier:ef,isMutationUnlocked:ko,getTotalCumulativeMp:Sl,addExternalMutationGainMultiplierProvider:si,getMutationGainMultiplier:tf}))});var Dl,j0,Z0,Xm,Wm,Vm,J0=Fe(()=>{Dl=`attribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,j0='#ifdef GL_FRAGMENT_PRECISION_HIGH precision highp float; #else precision mediump float; #endif varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform vec3 uColorDeep; uniform vec3 uColorShallow; void main() { /* Wave animation settings */ float speed = 1.2; float time = uTime * speed; /* Combine sine waves for a more natural look */ /* vUv.x is 0..1 across the screen width */ float wave1 = sin(vUv.x * 8.0 - time) * 0.0285; float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; /* Define the shoreline height (baseline) */ /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */ /* We want to discard pixels below this threshold */ float threshold = 0.428 + wave; if (vUv.y < threshold) { discard; } /* Recalculate gradient based on the new "bottom" */ /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */ float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0); vec3 col = mix(uColorShallow, uColorDeep, gradientY); /* Add a subtle "foam" or highlight at the edge */ float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold); col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4); gl_FragColor = vec4(col, 1.0); }',Z0="#ifdef GL_FRAGMENT_PRECISION_HIGH precision highp float; #else precision mediump float; #endif varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform sampler2D uWaveMap; uniform vec3 uColorDeep; uniform vec3 uColorShallow; uniform vec3 uColorWaveDeep; uniform vec3 uColorWave; /* Simple noise for foam breakup */ float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); } float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f*f*(3.0-2.0*f); return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x), mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y); } void main() { vec2 uv = vUv; /* Sample the simulation (physics) */ /* Wave Logic */ vec2 waveUV = uv - vec2(0.0, 0.0285); float intensity = texture2D(uWaveMap, waveUV).r; /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */ float shadowOffset = 8.0 / uResolution.y; float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r; /* Discard only if BOTH are empty */ if (intensity < 0.01 && shadowIntensity < 0.01) discard; /* Directional Noise: Streaky vertical noise for rushing water effect */ /* Stretch heavily along Y-axis to simulate speed/motion blur */ float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0)); /* Define Zones based on Intensity */ /* Body (Medium Intensity): Darker/turbulent blue with noise */ /* Edge (High Intensity): Bright white foam */ float foamThreshold = 0.5; float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity); /* Base Colors */ vec3 bodyColor = uColorWaveDeep; vec3 foamColor = uColorWave; /* Mix Colors */ vec3 finalColor = mix(bodyColor, foamColor, foamMix); /* Add streaks to the body part */ if (foamMix < 0.9) { finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix); } /* Hard Edge & Opacity */ /* Ensure the front (bottom) remains sharp, back trails off */ /* Calculate Alpha based on Intensity */ /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */ /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */ /* Low Intensity (Top/Tail): Fades to 0.0 */ float finalAlpha = smoothstep(0.02, 0.15, intensity); /* Screen Fade */ /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */ /* Dynamic Shoreline Fade */ /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */ /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */ float speed = 1.2; float time = uTime * speed; float wave1 = sin(uv.x * 8.0 - time) * 0.0285; float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; float threshold = 0.428 + wave; /* Fade out quickly after exiting the water body (below threshold) */ /* Fade starts slightly higher than the threshold to soften the transition */ /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */ float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y); float screenFade = shoreFade; /* --- Composite Shadow & Wave --- */ float waveAlpha = finalAlpha * screenFade; /* Shadow Alpha */ float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity); /* Shadow is weaker (40% opacity) */ float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade; /* Mix: Wave over Shadow */ /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */ float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha); /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */ /* Shadow is black (RGB=0), so second term is 0 */ vec3 outRGB = finalColor * waveAlpha; gl_FragColor = vec4(outRGB, outAlpha); }",Xm=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,Wm=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Vm=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var tb={};St(tb,{WaterSystem:()=>sf,waterSystem:()=>af});function eb(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function ra(e,t,n){let o=eb(e,e.VERTEX_SHADER,t),r=eb(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var pL,Q0,mL,hL,sf,af,Ym=Fe(()=>{J0();pL=[.2,.5,.9],Q0=[.2,.9,1],mL=[1,1,1],hL=[.45,.8,1];sf=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:ra(s,Dl,Z0),simProgram:ra(s,Dl,Vm),brushProgram:ra(s,Xm,Wm),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=ra(this.glBg,Dl,j0),this.bgSimProgram=ra(this.glBg,Dl,Vm),this.bgBrushProgram=ra(this.glBg,Xm,Wm)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,p=a/this.height,h=new Float32Array([u-d,f-p,0,0,1,u+d,f-p,1,0,1,u-d,f+p,0,1,1,u+d,f+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,h,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),y=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(y),t.vertexAttribPointer(y,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let p=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=p.readFBO,f.writeFBO=p.writeFBO,f.readTexture=p.readTex,f.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),pL),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),Q0),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),Q0),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),mL),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),hL),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let p=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(p),d.vertexAttribPointer(p,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},af=new sf});var ab={};St(ab,{createSpawner:()=>EL});function sb(e){if(!e||typeof e!="object"){ia=!1,Fi=0n;return}ia=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Fi=n&&n!=="Infinity"?BigInt(n):0n}catch{Fi=0n}}function yL(e){let t=1-e;return 1-t*t*t}function bL(e){if(!e)return null;let t=nb.get(e);return t||(t=new Image,t.src=e,nb.set(e,t)),t}function EL({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=ze?gL:1e4,initialBurst:d=1,coinTtlMs:p=1e99,waveSoundSrc:h="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:y=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:v=!1}={}){let E=o,C={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function A(){return!!(C.pf&&C.w&&C.c)}A()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let N=7,H=[],F=[],q=!1;if(C.c)for(let S=0;S<N;S++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+S*10}`,C.c.appendChild(k);let O=k.getContext("2d",{alpha:!0});H.push(k),F.push(O)}let L=null,B=null;C.c&&(L=document.createElement("canvas"),L.style.position="absolute",L.style.inset="0",L.style.pointerEvents="none",L.style.zIndex="100",C.c.appendChild(L),B=L.getContext("2d",{alpha:!0}));let M={collectBatch:null,getMagnetUnit:null};function x(S){M={...M,...S}}let X={pfRect:null,wRect:null,safeBottom:0,pfW:0};function J(){if(!A())return!1;let S=C.pf.getBoundingClientRect(),k=C.w.getBoundingClientRect(),O=C.hud?C.hud.getBoundingClientRect().height:0;X={pfRect:S,wRect:k,safeBottom:S.height-O,pfW:S.width};let T=window.devicePixelRatio||1;return H.forEach((R,pe)=>{if(R){R.width=S.width*T,R.height=S.height*T,R.style.width=S.width+"px",R.style.height=S.height+"px";let de=F[pe];de&&(de.setTransform(1,0,0,1,0,0),de.scale(T,T),de.imageSmoothingEnabled=!0,de.imageSmoothingQuality="high")}}),q=!0,L&&(L.width=S.width*T,L.height=S.height*T,L.style.width=S.width+"px",L.style.height=S.height+"px",B&&(B.setTransform(1,0,0,1,0,0),B.scale(T,T))),!0}J();let se="ResizeObserver"in window?new ResizeObserver(()=>J()):null;se&&C.pf&&se.observe(C.pf),document.addEventListener("visibilitychange",()=>{document.hidden||J()});let K=(S,k,O)=>Math.max(k,Math.min(O,S)),Q=Math.max(2e3,f*3),ve=12,he=[],W=[],ee=0,$=[];function U(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=E,k.style.objectFit="contain",k.style.borderRadius="50%",S.appendChild(k),v&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let j=()=>he.length?he.pop():U();function ie(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let k=0;k<=6;k++)S.classList.remove(`coin--size-${k}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),he.length<Q&&he.push(S)}function ae(S,k=-1){if(S.isRemoved)return;S.isRemoved=!0;let O=k;(O===-1||W[O]!==S)&&(S.index!==void 0&&W[S.index]===S?O=S.index:O=W.indexOf(S)),O!==-1&&(W[O]=null,ee++),S.el?(ie(S.el),S.el=null):q=!0}function _(S){let k=S._coinObj;if(k){let O=-1;k.index!==void 0&&W[k.index]===k?O=k.index:O=W.indexOf(k),O!==-1&&(W[O]=null,ee++),S._coinObj=null}}let Y=new URL(h,document.baseURI).href,fe=0;function me(){let S=performance.now();if(S-fe<g)return;fe=S,ct(Y,{volume:ze?y:m,type:"music"})}function Z(){if(!A())return null;if((!X.pfRect||!X.wRect)&&J(),f!==1/0&&W.length-ee>=f){let xt=-1;if(ft(2))for(let Rt=0;Rt<W.length;Rt++){let vo=W[Rt];if(vo&&vo.sizeIndex<4){xt=Rt;break}}else for(let Rt=0;Rt<W.length;Rt++)if(W[Rt]){xt=Rt;break}if(xt===-1)return null;let Nt=W[xt];Nt&&ae(Nt,xt)}let S=X.pfW,k=X.wRect.top-X.pfRect.top,O=Math.max(0,k),T=0;if(ft(2)){let xt=Math.random();for(let Nt=6;Nt>=1;Nt--)if(xt<IL[Nt]){T=Nt;break}}T>=4&&gl&&gl()&&(T=3);let R=ob[T],pe=ve+(T>=3?15*(T-2):0),de=pe,Te=Math.max(de,S-R-pe),Pe=de+Math.random()*(Te-de),Be=Math.random()*100-50,Ne;if(R>=X.pfW)Ne=(X.pfW-R)/2;else{let xt=X.pfW-R-pe;de>=xt?Ne=(X.pfW-R)/2:Ne=K(Pe+Be,de,xt)}let qe=Math.min(X.wRect.height,X.pfRect.height*.3),Ae=Math.max(qe+80,120),Ve=Math.max(Ae+40,X.safeBottom-R-6),xe=K(Ae+Math.random()*(Ve-Ae),Ae,Ve),Xe={x0:Pe,y0:O,x1:Ne,y1:xe,jitterMs:0},ot=X.pfRect.left-X.wRect.left,He=wL[T],Tt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),rt=.85+Math.random()*.3,bt=Tt*(He.w/100)*rt,Ht=Tt*(He.h/100)*rt,Xt=Pe+R/2+ot,On=O-k;return{wave:{x:Xt,y:On,width:bt,height:Ht},coin:Xe,sizeIndex:T}}function re(S){if(!S.length||!A())return;let k=document.createDocumentFragment(),O=[],T=performance.now(),R=!1;for(let{wave:pe,coin:de,sizeIndex:Te}of S){if(pe&&(R=!0,af)){let Ve=Te>=4;af.addWave(pe.x,pe.y,pe.width,pe.height,Ve)}let Pe=ob[Te],Be=1;if(ft(8)){let Ve=En(),xe=Math.pow(25,Ve);Be=Math.pow(xe,Te)}else Be=SL[Te];let Ne=Te>=4,qe=j();qe.style.width=`${Pe}px`,qe.style.height=`${Pe}px`,qe.className=`coin coin--size-${Te}`,qe.firstChild&&(qe.firstChild.src=E),qe.style.transform=`translate3d(${de.x0}px, ${de.y0}px, 0) rotate(-10deg) scale(0.96)`,qe.style.opacity="0",ia?qe.dataset.mutationLevel=Fi.toString():qe.dataset.mutationLevel="0";let Ae={mutationLevel:ia?Fi.toString():"0",el:qe,src:E,x:de.x0,y:de.y0,rot:-10,scale:.96,startX:de.x0,startY:de.y0,endX:de.x1,endY:de.y1,startTime:T+de.jitterMs,duration:i,dieAt:T+p,jitterMs:de.jitterMs,isRemoved:!1,settled:!1,size:Pe,sizeIndex:Te,valueMultiplier:Be,forceDom:Ne,soundSrc:ib[Te]?`sounds/coin_pickup${ib[Te]}`:null,bMinX:Math.min(de.x0,de.x1)-Pe,bMaxX:Math.max(de.x0,de.x1)+Pe,bMinY:Math.min(de.y0,de.y1)-Pe,bMaxY:Math.max(de.y0,de.y1)+Pe};qe._coinObj=Ae,Ae.index=W.length,W.push(Ae),O.push(Ae),k.appendChild(qe)}C.c.appendChild(k),O.length>0&&(O[0].el&&O[0].el.offsetHeight,requestAnimationFrame(()=>{for(let pe of O)pe.el&&(pe.el.style.transition=`transform ${i}ms ${vL} ${pe.jitterMs}ms`,pe.el.style.transform=`translate3d(${pe.endX}px, ${pe.endY}px, 0) rotate(0deg) scale(1)`,pe.el.style.opacity="1")})),R&&requestAnimationFrame(()=>{me()})}function ye(S=1){if(!A())return;(!X.pfRect||!X.wRect)&&J();let k=[];for(let O=0;O<S;O++){let T=Z();T&&k.push(T)}k.length&&re(k)}function Le(S,k){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let O=k-S.startTime;if(O<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let T=O/S.duration;if(T>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let R=yL(T),pe=S.startX+(S.endX-S.startX)*R,de=S.startY+(S.endY-S.startY)*R,Te=-10+10*R,Pe=.96+.04*R;return{x:pe,y:de,rot:Te,scale:Pe}}function le(S,k){let O=bL(k.src);if(O&&O.complete&&O.naturalWidth>0){let T=k.size||r;S.drawImage(O,k.x,k.y,T,T)}}function Ie(){if(F.length){if(q){F.forEach((k,O)=>{H[O]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,H[O].width,H[O].height),k.restore(),v&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let S=W.length;for(let k=0;k<S;k++){let O=W[k];if(O&&O&&O.settled&&!O.isRemoved&&!O.el){let T=O.sizeIndex||0;F[T]&&le(F[T],O)}}v&&F.forEach(k=>k.restore()),q=!1,$.length=0}else if($.length>0){v&&F.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let k=$[S];if(!k.isRemoved&&k.settled&&!k.el){let O=k.sizeIndex||0;F[O]&&le(F[O],k)}}v&&F.forEach(S=>S.restore()),$.length=0}}}let Re=a,_e=null,Oe=performance.now(),ce=0;function te(S){(!X.pfRect||!X.wRect)&&J();let k=(S-Oe)/1e3;Oe=S,k>.1&&(k=.1);for(let T=W.length-1;T>=0;T--){let R=W[T];if(!R||!R)continue;if(S>=R.dieAt){ae(R,T);continue}if(R.sizeIndex===5&&!R.isRemoved&&(R.lastLightningTime||(R.lastLightningTime=S-1e3,R.nextLightningInterval=0),S-R.lastLightningTime>R.nextLightningInterval)){R.lastLightningTime=S,R.nextLightningInterval=200+Math.random()*100;for(let Te=0;Te<3;Te++)Fo(R,S)}if(R.sizeIndex===6&&!R.isRemoved&&(R.lastLightningTime||(R.lastLightningTime=S-1e3,R.nextLightningInterval=0),S-R.lastLightningTime>R.nextLightningInterval&&(R.lastLightningTime=S,R.nextLightningInterval=200+Math.random()*100,M.collectBatch))){let Te=Le(R,S),Pe=Te.x+R.size/2,Be=Te.y+R.size/2,Ne=[],qe=R.size/2*(R.size/2),Ae=W.length;for(let Ve=0;Ve<Ae;Ve++){let xe=W[Ve];if(!xe||xe===R||xe.isRemoved||xe.settled===!1||xe.sizeIndex>3)continue;let Ze=xe.x+(xe.size||r)/2,Xe=xe.y+(xe.size||r)/2,ot=Ze-Pe,He=Xe-Be;ot*ot+He*He>qe&&Ne.push(xe)}if(Ne.length>0){for(let Xe=Ne.length-1;Xe>0;Xe--){let ot=Math.floor(Math.random()*(Xe+1));[Ne[Xe],Ne[ot]]=[Ne[ot],Ne[Xe]]}let Ve=Ne.slice(0,3),xe=[],Ze=!1;for(let Xe of Ve){let ot=Xe.size||r,He=Xe.x+ot/2,Tt=Xe.y+ot/2;Uo(R,He,Tt),ur(He,Tt,ot),xe.push({coin:Xe}),Ze||(ct("sounds/lightning_strike.ogg",{volume:.25}),Ze=!0)}xe.length>0&&M.collectBatch(xe)}}if(R.settled)continue;let pe=S-R.startTime;if(pe<0)continue;if(pe/R.duration>=1){R.settled=!0,R.x=R.endX,R.y=R.endY,R.rot=0,R.scale=1,R.el&&!R.forceDom?(ie(R.el),R.el=null,$.push(R)):R.el&&(R.el.style.transition="none",R.el.style.transform=`translate3d(${R.x}px, ${R.y}px, 0) rotate(0deg) scale(1)`);continue}}ce+=Re*k;let O=Math.floor(ce);if(O>0){ce-=O;let T=Math.min(O,u);if(T>0){let R=performance.now(),pe=[],de=5;for(let Te=0;Te<T&&!(performance.now()-R>de);Te++){let Pe=Z();Pe&&pe.push(Pe)}pe.length&&re(pe)}}if(Ie(),ee>50){let T=0;for(let R=0;R<W.length;R++){let pe=W[R];pe!==null&&(pe.index=T,W[T++]=pe)}W.length=T,ee=0}fr(k),_e=requestAnimationFrame(te)}function we(){if(!_e){if(!A()){console.warn("[Spawner] start() called but required nodes are missing.");return}J(),d>0&&_e===null&&ye(d),Oe=performance.now(),_e=requestAnimationFrame(te)}}function w(){_e&&(cancelAnimationFrame(_e),_e=null)}function V(S){Re=Math.max(0,Number(S)||0)}function z(){ce=0,Oe=performance.now()}function oe(S){let k=ft(2)&&!!S;for(let O=W.length-1;O>=0;O--){let T=W[O];if(T&&T){if(k&&T.sizeIndex>=4){T.mutationLevel=ia?Fi.toString():"0",T.el&&(T.el.dataset.mutationLevel=T.mutationLevel);continue}ae(W[O],O)}}z()}function ge(S){S&&(E=S)}function ue(S){let k=S._coinObj;if(!k)return S.style.transform||"translate3d(0,0,0)";let{x:O,y:T,rot:R,scale:pe}=Le(k,performance.now());return`translate3d(${O}px, ${T}px, 0) rotate(${R}deg) scale(${pe})`}function Ge(S){if(S.el)return S.el;if(S.isRemoved)return null;let k=j(),O=S.size||r;return k.style.width=`${O}px`,k.style.height=`${O}px`,k.className=`coin coin--size-${S.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=S.src),k.style.opacity="1",k.dataset.mutationLevel=S.mutationLevel,k._coinObj=S,S.el=k,C.c.appendChild(k),q=!0,k}function nt(S,k,O,T){let R=O;T&&(R=Math.max(O,260));let pe=O*O,de=[],Te=W.length,Pe=S-R,Be=S+R,Ne=k-R,qe=k+R,Ae=performance.now();for(let Ve=0;Ve<Te;Ve++){let xe=W[Ve];if(!xe||xe.bMaxX<Pe||xe.bMinX>Be||xe.bMaxY<Ne||xe.bMinY>qe)continue;let Ze=xe.size||r,Xe,ot;if(xe.settled)Xe=xe.x+Ze/2,ot=xe.y+Ze/2;else{let bt=Le(xe,Ae);Xe=bt.x+Ze/2,ot=bt.y+Ze/2}if(Xe<Pe||Xe>Be||ot<Ne||ot>qe)continue;let He=Xe-S,Tt=ot-k,rt=pe;if(T&&(xe.sizeIndex||0)>0){let bt=Ze/2;rt=bt*bt}He*He+Tt*Tt<=rt&&(xe.isRemoved||de.push(xe))}return de}function be(S,k,O,T,R,pe){let de=R;pe&&(de=Math.max(R,260));let Te=R*R,Pe=[],Be=W.length,Ne=Math.min(S,O)-de,qe=Math.max(S,O)+de,Ae=Math.min(k,T)-de,Ve=Math.max(k,T)+de,xe=O-S,Ze=T-k,Xe=xe*xe+Ze*Ze,ot=Te*Xe,He=performance.now();for(let Tt=0;Tt<Be;Tt++){let rt=W[Tt];if(!rt||rt.bMaxX<Ne||rt.bMinX>qe||rt.bMaxY<Ae||rt.bMinY>Ve)continue;let bt=rt.size||r,Ht,Xt;if(rt.settled)Ht=rt.x+bt/2,Xt=rt.y+bt/2;else{let an=Le(rt,He);Ht=an.x+bt/2,Xt=an.y+bt/2}if(Ht<Ne||Ht>qe||Xt<Ae||Xt>Ve)continue;let On=Ht-S,xt=Xt-k,Nt=On*xe+xt*Ze,Rt=Te;if(pe&&(rt.sizeIndex||0)>0){let an=bt/2;Rt=an*an}let vo=!1;if(Nt<=0)On*On+xt*xt<=Rt&&(vo=!0);else if(Nt>=Xe){let an=Ht-O,ma=Xt-T;an*an+ma*ma<=Rt&&(vo=!0)}else{let an=On*Ze-xt*xe;an*an<=Rt*Xe&&(vo=!0)}vo&&!rt.isRemoved&&Pe.push(rt)}return Pe}function Ue(S){ae(S)}function Gt(S,k,O){let T=O*O,R=[],pe=W.length,de=S-O,Te=S+O,Pe=k-O,Be=k+O,Ne=performance.now();for(let qe=0;qe<pe;qe++){let Ae=W[qe];if(!Ae||Ae.bMaxX<de||Ae.bMinX>Te||Ae.bMaxY<Pe||Ae.bMinY>Be)continue;let Ve=Ae.size||r,xe,Ze;if(Ae.settled)xe=Ae.x+Ve/2,Ze=Ae.y+Ve/2;else{let He=Le(Ae,Ne);xe=He.x+Ve/2,Ze=He.y+Ve/2}if(xe<de||xe>Te||Ze<Pe||Ze>Be)continue;let Xe=xe-S,ot=Ze-k;Xe*Xe+ot*ot<=T&&(!Ae.el&&!Ae.isRemoved&&Ge(Ae),Ae.el&&R.push(Ae.el))}return R}function lt(S,k,O,T,R){let pe=R*R,de=[],Te=W.length,Pe=Math.min(S,O)-R,Be=Math.max(S,O)+R,Ne=Math.min(k,T)-R,qe=Math.max(k,T)+R,Ae=O-S,Ve=T-k,xe=Ae*Ae+Ve*Ve,Ze=pe*xe,Xe=performance.now();for(let ot=0;ot<Te;ot++){let He=W[ot];if(!He||He.bMaxX<Pe||He.bMinX>Be||He.bMaxY<Ne||He.bMinY>qe)continue;let Tt=He.size||r,rt,bt;if(He.settled)rt=He.x+Tt/2,bt=He.y+Tt/2;else{let Nt=Le(He,Xe);rt=Nt.x+Tt/2,bt=Nt.y+Tt/2}if(rt<Pe||rt>Be||bt<Ne||bt>qe)continue;let Ht=rt-S,Xt=bt-k,On=Ht*Ae+Xt*Ve,xt=!1;if(On<=0)Ht*Ht+Xt*Xt<=pe&&(xt=!0);else if(On>=xe){let Nt=rt-O,Rt=bt-T;Nt*Nt+Rt*Rt<=pe&&(xt=!0)}else{let Nt=Ht*Ve-Xt*Ae;Nt*Nt<=Ze&&(xt=!0)}xt&&(!He.el&&!He.isRemoved&&Ge(He),He.el&&de.push(He.el))}return de}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;_e||we()}});function sn(){A()&&ye(1)}let kt=[],vn=[];function yo(S,k){if(!S||!k)return;let O=S.size||r,T=k.size||r,R=S.x+O/2,pe=S.y+O/2,de=k.x+T/2,Te=k.y+T/2;kt.push({x1:R,y1:pe,x2:de,y2:Te,age:0,life:.15})}function ur(S,k,O){if(!C.pf)return;let T=document.createElement("div");T.className="coin-stain";let R=O*1.2;T.style.width=`${R}px`,T.style.height=`${R}px`,T.style.left=`${S-R/2}px`,T.style.top=`${k-R/2}px`,C.pf.appendChild(T),setTimeout(()=>{T.style.opacity="0",setTimeout(()=>{T.parentNode&&T.remove()},1e3)},2500)}function Fo(S,k){let O=Math.random()*Math.PI*2,T=(S.size||r)/2,R=T*rb,pe=Math.cos(O)*R,de=Math.sin(O)*R,Te=T*(.7+Math.random()*.6),Pe=Math.cos(O)*(R+Te),Be=Math.sin(O)*(R+Te);kt.push({parentCoin:S,relX1:pe,relY1:de,relX2:Pe,relY2:Be,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let Ne=3+Math.floor(Math.random()*3);for(let qe=0;qe<Ne;qe++){let Ae=.3+Math.random()*.5,Ve=pe+(Pe-pe)*Ae,xe=de+(Be-de)*Ae,Ze=O+(Math.random()*1.2-.6),Xe=Te*(.4+Math.random()*.4),ot=Ve+Math.cos(Ze)*Xe,He=xe+Math.sin(Ze)*Xe;kt.push({parentCoin:S,relX1:Ve,relY1:xe,relX2:ot,relY2:He,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ct("sounds/lightning_zap.ogg",{volume:.25})}function Uo(S,k,O){if(!S)return;let T=S.size||r,R=performance.now(),pe=Le(S,R),de=pe.x+T/2,Te=pe.y+T/2,Pe=k-de,Be=O-Te,Ne=Math.atan2(Be,Pe),qe=Math.sqrt(Pe*Pe+Be*Be),Ae=T/2*rb,Ve=Math.cos(Ne)*Ae,xe=Math.sin(Ne)*Ae;kt.push({parentCoin:S,relX1:Ve,relY1:xe,x2:k,y2:O,age:0,life:.25,width:6,jaggedScale:25});let Ze=de+Ve,Xe=Te+xe,ot=6+Math.floor(Math.random()*5);for(let He=0;He<ot;He++){let Tt=.1+Math.random()*.8,rt=Ze+(k-Ze)*Tt,bt=Xe+(O-Xe)*Tt,Ht=Ne+(Math.random()*1.6-.8),Xt=qe*(.1+Math.random()*.3),On=rt+Math.cos(Ht)*Xt,xt=bt+Math.sin(Ht)*Xt;if(kt.push({x1:rt,y1:bt,x2:On,y2:xt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Rt=rt+(On-rt)*.5,vo=bt+(xt-bt)*.5,an=Ht+(Math.random()*1-.5),ma=Xt*.5;kt.push({x1:Rt,y1:vo,x2:Rt+Math.cos(an)*ma,y2:vo+Math.sin(an)*ma,age:0,life:.25,width:1.5,jaggedScale:10})}}}function fr(S){if(!B||!L)return;B.clearRect(0,0,L.width,L.height);let k=performance.now();B.lineCap="round",B.lineJoin="round";for(let O=kt.length-1;O>=0;O--){let T=kt[O];if(T.age+=S,T.age>=T.life){kt.splice(O,1);continue}let R=T.x1,pe=T.y1,de=T.x2,Te=T.y2;if(T.parentCoin){let Ne=Le(T.parentCoin,k),qe=Ne.x+(T.parentCoin.size||r)/2,Ae=Ne.y+(T.parentCoin.size||r)/2;R=qe+T.relX1,pe=Ae+T.relY1,T.relX2!==void 0&&(de=qe+T.relX2,Te=Ae+T.relY2)}let Pe=1-T.age/T.life;B.strokeStyle=`rgba(200, 240, 255, ${Pe})`,B.lineWidth=T.width||3,B.shadowColor="rgba(220, 245, 255, 0.9)",B.shadowBlur=20;let Be=6;B.beginPath(),B.moveTo(R,pe);for(let Ne=1;Ne<=Be;Ne++){let qe=Ne/Be,Ae=R+(de-R)*qe,Ve=pe+(Te-pe)*qe;if(Ne===Be)B.lineTo(de,Te);else{let xe=-(Te-pe),Ze=de-R,Xe=Math.sqrt(xe*xe+Ze*Ze),ot=T.jaggedScale||40;if(Xe>0){let He=(Math.random()-.5)*ot*(1-Math.abs(qe-.5));B.lineTo(Ae+xe/Xe*He,Ve+Ze/Xe*He)}else B.lineTo(Ae,Ve)}}B.stroke(),B.shadowBlur=0}for(let O=vn.length-1;O>=0;O--){let T=vn[O];if(T.age+=S,T.age>=T.life){vn.splice(O,1);continue}T.x+=T.vx*S,T.y+=T.vy*S;let R=1-T.age/T.life;B.fillStyle=T.color,B.globalAlpha=R,B.beginPath(),B.arc(T.x,T.y,T.size,0,Math.PI*2),B.fill(),B.globalAlpha=1}}return{start:we,stop:w,setRate:V,clearBacklog:z,clearPlayfield:oe,setCoinSprite:ge,getCoinTransform:ue,findCoinsInRadius:Gt,findCoinsInPath:lt,findCoinTargetsInRadius:nt,findCoinTargetsInPath:be,ensureCoinVisual:Ge,removeCoinTarget:Ue,detachCoin:_,recycleCoin:ie,playEntranceWave:sn,setDependencies:x,hasBigCoins:()=>ft(2)&&W.some(S=>S&&S.sizeIndex>=4)}}var ia,Fi,gL,nb,vL,ob,rb,SL,IL,ib,wL,lb=Fe(()=>{oc();xo();ro();io();Pn();Ym();Eo();ia=!1,Fi=0n,gL=2500,nb=new Map;try{sb(dt())}catch{ia=!1,Fi=0n}try{wi(e=>{sb(e)})}catch{}vL="cubic-bezier(0.215, 0.61, 0.355, 1)";ob=[40,55,80,125,200,320,512],rb=.78,SL=[1,25,625,15625,390625,9765625,244140625],IL=[0,.1,.01,.001,1e-4,1e-5,1e-6],ib=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],wL=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var gb={};St(gb,{afterSlotWrite:()=>Jm,beforeSlotWrite:()=>Zm});function pb(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function CL(e,t=LL){!e||e<=0||$l.set(e,pb()+t)}function ub(e){if(!e||e<=0)return!1;let t=$l.get(e);return t==null?!1:t<=pb()?($l.delete(e),!1):!0}function ML(){$l.clear()}function cf(){try{return typeof localStorage<"u"}catch{return!1}}function jm(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function mb(e){let t=new Map;if(!cf())return ql.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Hi))continue;let r=jm(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return ql.set(e,t),t}function hb(e){return!Number.isFinite(e)||e<=0?null:ql.has(e)?ql.get(e):mb(e)}function Zm(e){if(!cf()||lf>0)return;let t=String(e);if(!t.startsWith(Hi))return;let n=jm(t);if(n==null)return;let o=hb(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(lf===0){lf+=1;try{bn(n)}finally{lf-=1}}mb(n);return}}}catch{}}function Jm(e,t){let n=String(e);if(!n.startsWith(Hi))return;let o=jm(n);if(o==null)return;let r=hb(o)||new Map;r.set(n,String(t??"")),ql.set(o,r)}function AL(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function kL(){let e=new Map;if(!cf())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Hi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=kf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function TL(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function NL(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=Tf(e);if(n.length===0){o&&(ub(e)||bn(e),Jl(e,null));return}let r=AL(n);o&&r!==o&&!ub(e)&&bn(e),r!==o&&Jl(e,r)}function aa(){if(!cf())return;let e=kL();TL(e).forEach(n=>{let o=e.get(n)??[];NL(n,o)})}function RL(){if(zm!=null)return;zm=(typeof window<"u"?window:globalThis).setTimeout(()=>{zm=null,aa()},_L)}function OL(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){CL(o),RL();return}$l.delete(o),aa()}}function PL(){typeof window>"u"||cb==null&&(cb=window.setInterval(aa,xL))}function BL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function sa(){let e=BL();if(!e)return;if(!Xi()){(e.dataset.poopShopApplied===Km||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==fb||e.dataset.poopShopApplied!==Km)&&(e.style.backgroundImage=fb,e.dataset.poopShopApplied=Km)}function FL(){typeof window>"u"||db==null&&(sa(),db=window.setInterval(sa,50),window.addEventListener("saveSlot:change",sa),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&sa()}catch{sa()}}))}function UL(){typeof window>"u"||(aa(),PL(),FL(),window.addEventListener("saveSlot:change",()=>aa()),window.addEventListener("saveIntegrity:storageMutation",OL,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(ML(),aa(),sa())}))}var xL,LL,_L,cb,zm,$l,ql,lf,fb,Km,db,Qm=Fe(()=>{vt();xL=1e4,LL=750,_L=50,cb=null,zm=null,$l=new Map;ql=new Map,lf=0;fb="linear-gradient(180deg,#a9793d,#7b5534)",Km="1",db=null;UL()});var _b={};St(_b,{initPopups:()=>HL,teardownpopups:()=>XL});function eh(){return go||(go=document.createElement("div"),go.className="currency-popups",go.setAttribute("aria-live","polite"),go.setAttribute("aria-atomic","false"),document.body.appendChild(go),go)}function Ui(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function th(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function vb(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):ne(n);t&&(t.innerHTML=r)}function $L(e,t=bb){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Gl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function qL(e,t,n){eh();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function nh(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(Vt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(Vt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Ce).includes(e)&&Bn(e,o))return}let r=DL[e],i=Object.assign({duration:bb,accumulate:!0},r||{},n);if(!i.icon)return;let s=Ui(t);if(!s||th(s))return;let l=i.accumulate!==!1?Gl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,vb(l);return}let a=qL(e,i,s);a.meta=i,vb(a),Gl.set(e,a);let u=eh(),f=yb.indexOf(e),d=null;if(f>=0){let p=Array.from(u.children);for(let h of p){let m=h.dataset.type;if(yb.indexOf(m)>f){d=h;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),$L(a,i.duration)}function GL(){let e={};for(let t of Object.values(Ce))e[t]=Sa(t);return e}function Sb(){try{let e=GL();Object.entries(e).forEach(([t,n])=>{let o=Ui(n)||c.fromInt(0);Gr.set(t,o.clone?.()??o)}),Gr.has("mp")||Gr.set("mp",c.fromInt(0))}catch{Gr.clear()}}function Ib(){Gl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Gl.clear()}function wb(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Ui(t.value)||c.fromInt(0),r=Gr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Ui(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&nh(n,s),Gr.set(n,o.clone?.()??o)}function Eb(e){let t=e?.detail;if(!t)return;let n=Ui(t.xpAdded);n&&!th(n)&&nh("xp",n)}function xb(e){let t=e?.detail;if(!t)return;let n=Ui(t.delta);n&&!th(n)&&nh("mp",n);let o=Ui(t.progress);o&&Gr.set("mp",o.clone?.()??o)}function Lb(){Ib(),Sb()}function HL(){uf||(uf=!0,eh(),Sb(),window.addEventListener("currency:change",wb),window.addEventListener("xp:change",Eb),window.addEventListener("mutation:change",xb),window.addEventListener("saveSlot:change",Lb))}function XL(){uf&&(window.removeEventListener("currency:change",wb),window.removeEventListener("xp:change",Eb),window.removeEventListener("mutation:change",xb),window.removeEventListener("saveSlot:change",Lb),Ib(),Gr.clear(),go&&go.remove(),go=null,uf=!1)}var bb,yb,DL,go,uf,Gr,Gl,Cb=Fe(()=>{It();Kt();vt();bb=6767,yb=["coins","xp","books","gold","mp","magic","gears","dna"],DL={[Ce.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Ce.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Ce.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Ce.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Ce.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Ce.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},go=null,uf=!1,Gr=new Map,Gl=new Map});var Pb={};St(Pb,{flushBackupSnapshot:()=>Ob,getSuspendMetadata:()=>a1,installSuspendSafeguards:()=>s1,markProgressDirty:()=>Oo,restoreFromBackupIfNeeded:()=>i1});function Hl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function da(){if(typeof localStorage>"u")return!1;try{let e=`${Jn}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function Tb(){if(!Hl())throw new Error("IndexedDB unavailable");return la||(la=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(WL,VL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(fa)||r.createObjectStore(fa)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}la=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw la=null,e}),la)}function jL(){if(!da())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(Jn))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function ZL(e){try{let t=await Tb();return await new Promise((n,o)=>{let r=!1,i=t.transaction(fa,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(fa).put(e,kb);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function JL(){try{let e=await Tb();return await new Promise((t,n)=>{let o=!1,r=e.transaction(fa,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(fa).get(kb);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function QL(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function oh(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function e1(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function n1(e){return!(typeof e!="string"||e.length===0||t1.test(e))}function rh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(Jn)||n.startsWith(YL)||n.startsWith(zL))return;let o=e1(n);if(o!=null)try{let r={key:n,slot:o,trusted:n1(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function o1(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=oh(),a=String(i),u=this===localStorage&&a.startsWith(Jn);if(u)try{Zm(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Oo("setItem");try{Jm(a,s)}catch{}}this===localStorage&&a.startsWith(Jn)&&rh(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=oh(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(Jn)&&(Oo("removeItem"),rh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=oh(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Oo("clear"),rh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function Nb(e="idle"){ua=e||ua,Hr=!0,!ca&&(ca=setTimeout(()=>{if(ca=null,!Hr)return;let t=ua;Hr=!1,Ob(t)},KL))}function Rb(){ca&&(clearTimeout(ca),ca=null)}function Oo(e="dirty"){try{Nb(e)}catch{}}async function ih(e="manual"){if(!da()||!Hl())return!1;let t=jL();if(!t)return!1;t.reason=e,df=!1;let n=await ZL(t);return n||(Hr=!0,Nb("retry")),n}async function Ob(e="manual",{immediate:t=!1}={}){return!da()||!Hl()?!1:t?(Rb(),Hr=!1,df=!0,ih(e)):(Hr=!0,ua=e||ua,ih(e))}function ff(e){!Hl()||!da()||(Rb(),Hr=!1,df=!0,ih(e))}function r1(){if(!da())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(Jn))return!0}}catch{}return!1}async function i1(){if(Ab||(Ab=!0,!da()||!Hl()))return!1;let e=!1;try{if(!r1())e=!0;else{let o=localStorage.getItem(`${Jn}saveSlot`);if(o){let r=`${Jn}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await JL();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Oo("restored"),n}function s1(){if(Mb||(Mb=!0,typeof window>"u"))return;QL(),o1();let e=()=>{document.hidden?ff("visibility-hidden"):Oo("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>ff("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>ff("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>ff("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Oo("pageshow"))}catch{}try{window.addEventListener("focus",()=>Oo("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(Jn)||Oo("storage-event"))})}catch{}Oo("boot")}function a1(){return{pendingImmediateFlush:df,dirty:Hr,lastDirtyReason:ua}}var Jn,WL,VL,fa,kb,YL,zL,KL,la,ca,Hr,ua,Mb,Ab,df,t1,Bb=Fe(()=>{Qm();Jn="ccc:",WL="ccc:safety",VL=1,fa="snapshots",kb="latest",YL=`${Jn}slotSig`,zL=`${Jn}slotMod`,KL=1e3,la=null,ca=null,Hr=!1,ua="init",Mb=!1,Ab=!1,df=!1;t1=/\bat <anonymous>:\d+:\d+\b/});var Fb={};St(Fb,{initGlobalOverlayEsc:()=>u1});function c1(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i}of l1){let s=document.querySelectorAll(o);if(s.length>0){if(i){t=!0;continue}let a=s[s.length-1].querySelector(r||".shop-close");a&&(a.click(),n=!0)}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function u1(){window.addEventListener("keydown",c1,!0)}var l1,Ub=Fe(()=>{l1=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".automation-shop-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close"}]});var Db={};St(Db,{ensureGameDom:()=>f1});function f1(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var $b=Fe(()=>{});function m1(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function h1(){if(!ze)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function tS(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483646",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=ze?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function pa(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function nS(e,t){if(!e||e.__done)return;e.__done=!0,e.__fill&&(e.__fill.style.transition="none",e.__fill.style.width="100%");let n=500;e.__label&&(e.__label.textContent=e.__skipped?"Loading Skipped":t||"Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let o=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",o,{once:!0}),setTimeout(o,450)},n)}async function ch(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function y1(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function v1(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Pn(),Vl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function b1(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function S1({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...y1(e,s),...v1(t,s),...n?b1(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function I1(e,t=!0){if($i===e)return;Zt&&(Zt.stop(),Zt=null),$i=e;let n=document.querySelector(".menu-root");switch(e){case Bo.STARTER_COVE:{t&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{$i===Bo.STARTER_COVE&&(Zt=ct("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},25)})}),n&&(n.style.display="none"),document.body.classList.remove("menu-bg");let o=5;if(typeof gh=="function"&&gh(o,80),Di){let s=Array.from({length:o},(l,a)=>`water-fg-${a}`);if(Di.init("water-background",s),mf){try{mf()}catch{}mf=null}if(hf){try{hf()}catch{}hf=null}typeof mh=="function"&&(mf=mh(l=>Di.update(l))),typeof hh=="function"&&(hf=hh((l,a)=>Di.render(l,a)))}let i=document.getElementById("game-root");if(i&&(i.hidden=!1,Di&&requestAnimationFrame(()=>Di.resize()),iS()),typeof fh=="function")try{fh()}catch{}if(typeof dh=="function")try{dh()}catch{}if(!qt){qt=oS({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=qt;let s=()=>{if(!(!qt||typeof qt.setCoinSprite!="function"))try{qt.setCoinSprite(cS?.())}catch{}};s(),uS?.(s);let l=rS({spawner:qt});qt&&typeof qt.setDependencies=="function"&&qt.setDependencies({collectBatch:l.collectBatch,getMagnetUnit:l.getMagnetUnitPx});let a=()=>{try{let u=sS(),f=aS(u);if(qt&&f?.coinsPerSecondMult){let d=1*f.coinsPerSecondMult;if(typeof ph=="function"){let p=ph("spawnRate",d);try{p&&typeof p.toScientific=="function"?d=Number(p.toScientific(6)):d=Number(p)}catch{}}Number.isFinite(d)&&qt.setRate(d)}}catch{}};if(a(),typeof lh=="function")try{lh()}catch{}lh=lS(a),typeof window<"u"&&window.addEventListener("debug:change",a)}if(typeof uh=="function")try{uh()}catch{}qt.start();break}case Bo.MENU:{n&&(n.style.display="",n.removeAttribute("aria-hidden"));let o=document.getElementById("game-root");o&&(o.hidden=!0),qt&&qt.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Bo.MENU}}))}catch{}}var d1,ze,qb,oS,rS,iS,Gb,Hb,Xb,Wb,Vb,Yb,zb,Kb,sS,aS,uh,lS,p1,jb,Zb,Jb,sh,ah,fh,dh,cS,uS,pf,ph,Qb,mh,hh,eS,gh,Di,mf,hf,Bo,$i,Zt,qt,lh,Po,g1,ro=Fe(()=>{Pn();bh();d1=!0,ze=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();ze&&document.documentElement.classList.add("is-mobile");mf=null,hf=null;h1();Bo={MENU:0,STARTER_COVE:1},$i=Bo.MENU,Zt=null,qt=null,lh=null,Po=()=>new Promise(e=>requestAnimationFrame(e)),g1=async()=>{await Po(),await Po()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(U=>{e=U}),n=tS("Loading assets...",e);vh(),await Po();let{initAudio:o}=await Promise.resolve().then(()=>(Pn(),Vl));o();let r=Promise.all([Promise.resolve().then(()=>(Pf(),Uh)),Promise.resolve().then(()=>(lb(),ab)),Promise.resolve().then(()=>(Xa(),ov)),Promise.resolve().then(()=>(su(),Xy)),Promise.resolve().then(()=>(vt(),Oh)),Promise.resolve().then(()=>(Qm(),gb)),Promise.resolve().then(()=>(oo(),y0)),Promise.resolve().then(()=>(oc(),$h)),Promise.resolve().then(()=>(qn(),ng)),Promise.resolve().then(()=>(Eo(),Vv)),Promise.resolve().then(()=>(xo(),K0)),Promise.resolve().then(()=>(Cb(),_b)),Promise.resolve().then(()=>(Bb(),Pb)),Promise.resolve().then(()=>(es(),cg)),Promise.resolve().then(()=>(Ub(),Fb)),Promise.resolve().then(()=>(Ji(),W0)),Promise.resolve().then(()=>(Qr(),fg)),Promise.resolve().then(()=>(Bc(),oy)),Promise.resolve().then(()=>(as(),Sg)),Promise.resolve().then(()=>(ds(),Ag)),Promise.resolve().then(()=>($b(),Db)),Promise.resolve().then(()=>(io(),Kg)),Promise.resolve().then(()=>(Ym(),tb)),Promise.resolve().then(()=>(fi(),ey))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(U,j)=>`img/mutations/m${j+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=S1(i,U=>{s=U,pa(n,U)}),[a,u,f,d,p,h,m,y,g,v,E,C,A,N,H,F,q,L,B,M,x,X,J,se]=await r;({initSlots:qb}=a),{createSpawner:oS}=u,{initCoinPickup:rS}=f,{initHudButtons:iS}=d,{bank:Wb,getHasOpenedSaveSlot:Vb,setHasOpenedSaveSlot:Yb,ensureStorageDefaults:zb,notifyGameSessionStarted:eS,ensureMultiplierDefaults:Kb}=p,{getCurrentAreaKey:sS,computeUpgradeEffects:aS,onUpgradesChanged:lS}=m,{registerPreloadedAudio:p1}=y,{initXpSystem:uh}=g,{initResetSystem:fh}=v,{initMutationSystem:dh,getMutationCoinSprite:cS,onMutationChange:uS}=E,{initPopups:jb}=C,{installSuspendSafeguards:Zb,restoreFromBackupIfNeeded:Jb,markProgressDirty:sh,flushBackupSnapshot:ah}=A,{installGhostTapGuard:Gb,initGlobalGhostTap:Hb}=N,{initGlobalOverlayEsc:Xb}=H,{setDebugPanelAccess:pf,applyStatMultiplierOverride:ph}=F,{startGameLoop:Qb,registerTick:mh,registerFrame:hh}=q;let{initOfflineTracker:K,processOfflineProgress:Q}=L,{initWorkshopSystem:ve}=B,{initAutomationEffects:he}=M;({ensureGameDom:gh}=x);let{initSurgeEffects:W}=X;({waterSystem:Di}=J);let{initLabLogic:ee}=se;window.bank=Wb,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(Zt){try{Zt.stop()}catch{}Zt=null}}),window.addEventListener("audio:restartMusic",()=>{if(Zt){try{Zt.stop()}catch{}Zt=null}$i===Bo.STARTER_COVE&&(Zt=ct("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",U=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return U.preventDefault(),U.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let U=document.hidden;yf(U),Zt&&Zt.element&&(U?Zt.element.pause():Zt.element.play().catch(()=>{}))}),Gb?.(),Hb?.(),Xb?.(),Zb?.(),typeof pf=="function"&&(pf(d1),window.setDebugPanelAccess=pf);try{await Jb?.()}catch{}await Promise.race([l,t]),await g1(),document.documentElement.classList.remove("booting"),await Po(),nS(n),await Promise.all([ch("img/currencies/coin/coin_plus_base.webp"),ch("img/stats/xp/xp_plus_base.webp"),ch("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}Qb(),K(()=>$i===Bo.STARTER_COVE);try{ve()}catch(U){console.error("Workshop init failed",U)}try{he()}catch(U){console.error("Automation init failed",U)}try{W()}catch(U){console.error("Surge effects init failed",U)}try{ee()}catch(U){console.error("Lab system init failed",U)}m1(),zb(),sh?.("ensure-defaults"),jb();let $=document.getElementById("panel-title");if(Vb()?(document.body.classList.add("has-opened"),$&&($.style.opacity="0")):$&&($.style.opacity="1"),qb(async()=>{if($i===Bo.STARTER_COVE)return;let U=tS("Loading game..."),j=performance.now();await Po(),await Po(),Yb(!0),document.body.classList.add("has-opened"),$&&($.style.opacity="0"),I1(Bo.STARTER_COVE,!1),qt&&(qt.stop(),qt.clearPlayfield()),pa(U,.2),await Po(),Kb(),pa(U,.4),await Po(),Q(),pa(U,.7),await Po(),eS?.(),sh?.("slot-entered"),pa(U,.9),await Po();let ie=performance.now()-j;ie<500&&await new Promise(ae=>setTimeout(ae,500-ie)),pa(U,1),nS(U,"Finished loading game"),await new Promise(ae=>setTimeout(ae,750)),$i===Bo.STARTER_COVE&&(Zt=ct("sounds/The_Cove.ogg",{loop:!0,type:"music"})),window.spawner&&(window.spawner.start(),typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave())}),typeof window<"u"&&ah)try{window.cccRequestBackup=()=>ah("manual",{immediate:!0})}catch{}})});ro();})();
