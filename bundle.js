(()=>{var IS=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var vt=(e,t)=>{for(var n in t)IS(e,n,{get:t[n],enumerable:!0})};var Kl={};vt(Kl,{initAudio:()=>wS,loadAudio:()=>Eh,playAudio:()=>ht,registerPreloadedBuffer:()=>xS,setAudioSuspended:()=>If,setMusicUnderwater:()=>Yr});function Sf(){if(Vt)return Vt;let e=window.AudioContext||window.webkitAudioContext;return e?(Vt=new e,ha=Vt.createGain(),ha.connect(Vt.destination),ha.gain.value=1,Wl=Vt.createGain(),Wl.gain.value=1,Wl.connect(ha),Io=Vt.createBiquadFilter(),Io.type="lowpass",Io.frequency.value=22050,Io.Q.value=1,Io.connect(Wl),Vt):null}function wS(){Sf()}function ES(){Vt&&Vt.state==="suspended"&&Vt.resume().catch(()=>{})}async function Eh(e){let t=Sf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(ga.has(n))return ga.get(n);if(zl.has(n))return zl.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return ga.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{zl.delete(n)}})();return zl.set(n,o),o}function ht(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=Sf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=ga.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(Io):f.connect(ha),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else Eh(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function xS(e,t){let n=new URL(e,document.baseURI).href;ga.set(n,t)}function If(e){Vt&&(e?Vt.state==="running"&&Vt.suspend().catch(()=>{}):Vt.state==="suspended"&&Vt.resume().catch(()=>{}))}function Yr(e){if(!Io)return;let t=e?600:22050;try{let n=Vt.currentTime;Io.frequency.cancelScheduledValues(n),Io.frequency.setValueAtTime(t,n)}catch{Io.frequency.value=t}}var Vt,ha,Wl,Io,ga,zl,Dn=De(()=>{Vt=null,ha=null,Wl=null,Io=null,ga=new Map,zl=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,ES,{capture:!0,passive:!0})})});function Ne(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let h=Math.log10(p),m=e.e||0,y=Number(e._eOffset||0n);return h+m+y}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(p)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function _e(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function wf(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/xh;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/xh:e>0?e:0}var c,xh,Et=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",p=BigInt(u+d);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};xh=Math.log(10)});function Ch(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return _h.format(t)}catch{return String(e)}}function ya(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function Ef(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Ch(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+_h.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=xf.get(u)||"",p=o-u+1,h=4-p,m=p+h;n.length<m+1&&(n+="0".repeat(m+1-n.length));let y=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(y=ya(y));let v,E;return y.length>m?(v=y.slice(0,p+1),E="0".repeat(h)):(v=y.slice(0,p),E=y.slice(p)),t+`${v}${h?"."+E:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=ya(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+Ef(String(o))}function _S(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Ef(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=ya(f)),l){let A=f.slice(0,1)+"."+f.slice(1),N=i==="-"?"-":"";return t+A+"e"+Ef(s,N)}let p=Math.floor(a/3)*3,h=xf.get(p)||"",y=a-p+1,g=4-y,v,E;return f.length>4?(v=f.slice(0,y+1),E="0".repeat(g)):(v=f.slice(0,y),E=f.slice(y)),t+(i==="-"?"-":"")+v+(g?"."+E:"")+h}function Lh(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=ya(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+_S(l)}function ne(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Lh(e.toScientific(3));if(t<6)return Ch(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=xf.get(n);if(!o)return Lh(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=ya(u));let d,p;return u.length>l?(d=u.slice(0,i+1),p="0".repeat(s)):(d=u.slice(0,i),p=u.slice(i)),`${d}${s?"."+p:""}${o}`}function Fe(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=Ne(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return ne(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):ne(c.fromAny(t))}catch{return"1"}}var LS,xf,_h,Yt=De(()=>{Et();LS=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],xf=new Map(LS),_h=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var Uh={};vt(Uh,{CURRENCIES:()=>ke,KEYS:()=>bt,STORAGE_PREFIX:()=>Vi,bank:()=>O,clearActiveSlot:()=>US,clearAllStorage:()=>GS,ensureCurrencyDefaults:()=>Bf,ensureMultiplierDefaults:()=>Ff,ensureStorageDefaults:()=>qS,getActiveSlot:()=>b,getCurrency:()=>Sa,getCurrencyMultiplierBN:()=>Fh,getHasOpenedSaveSlot:()=>$S,getLastSaveTime:()=>Nf,getLastSaveTimeKey:()=>ec,getSlotModifiedFlagKey:()=>DS,getSlotSignature:()=>Pf,getSlotSignatureKey:()=>Of,hasModifiedSave:()=>Yi,isCurrencyLocked:()=>$n,isStorageKeyLocked:()=>Wt,markSaveSlotModified:()=>In,notifyGameSessionStarted:()=>BS,onCurrencyChange:()=>Ql,peekCurrency:()=>Ia,primeStorageWatcherSnapshot:()=>lt,setActiveSlot:()=>Rf,setCurrency:()=>Hi,setCurrencyMultiplierBN:()=>oc,setHasOpenedSaveSlot:()=>nc,setSlotSignature:()=>tc,updateLastSaveTime:()=>Ph,watchStorageKey:()=>kt});function Cf(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Mf(e){let t=Cf(e);return t==null?null:`${CS}:${t}`}function kf(e){let t=Cf(e);return t==null?null:`${MS}:${t}`}function Nh(e={}){jl.size!==0&&jl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Ql(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return jl.add(o),()=>{jl.delete(o)}}function TS(){if(va!=null||Do.size===0)return;va=(typeof window<"u"?window:globalThis).setInterval(NS,kS)}function Rh(){if(Do.size!==0||va==null)return;(typeof window<"u"?window:globalThis).clearInterval(va),va=null}function Oh(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function AS(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function NS(){if(Do.size===0){Rh();return}Do.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=Oh(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!AS(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function kt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Do.get(e);return s||(s=new Set,Do.set(e,s)),s.add(i),TS(),()=>{let l=Do.get(e);l&&(l.delete(i),l.size===0&&(Do.delete(e),Rh()))}}function lt(e,t){if(!e)return;let n=Do.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=Oh(r,o),r.initialized=!0)})}function Tf(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function RS(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function OS(){Lf.forEach(e=>{try{e?.()}catch{}}),Lf.clear()}function kh(e){if(e!==Mh&&(OS(),Mh=e??null,e!=null))for(let t of Object.values(ke)){let n=`${bt.CURRENCY[t]}:${e}`,o=kt(n,{parse:RS,equals:Tf,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};Nh(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Lf.set(n,o)}}function PS(){typeof window>"u"||(kh(b()),window.addEventListener("saveSlot:change",()=>{kh(b())}))}function BS(){Af=!0}function ec(e=b()){return e==null?null:`${mr}lastSaveTime:${e}`}function Ph(){if(!Af||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(ec(e),String(t))}catch{}}function Nf(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(ec(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function FS(){typeof window>"u"||(Th||(Th=setInterval(Ph,1e3)),window.addEventListener("beforeunload",()=>{if(!Af)return;let e=b();if(e!=null)try{localStorage.setItem(ec(e),String(Date.now()))}catch{}}))}function b(){if(dr!==void 0)return dr;let e=localStorage.getItem(bt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return dr=n,n}function Rf(e){let t=Math.max(1,parseInt(e,10)||1);dr=t,localStorage.setItem(bt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function US(){dr=null,localStorage.removeItem(bt.SAVE_SLOT)}function ba(e,t=b()){return t==null?null:`${e}:${t}`}function Bh(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Wt(e){return Bh(e)}function Of(e=b()){return Mf(e)}function DS(e=b()){return kf(e)}function Pf(e=b()){if(typeof localStorage>"u")return null;let t=Mf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function tc(e,t){if(typeof localStorage>"u")return;let n=Mf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function Yi(e=b()){if(typeof localStorage>"u")return!1;let t=kf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function In(e=b()){if(typeof localStorage>"u")return;let t=Cf(e);if(t==null||Yi(t))return;let n=kf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function $S(){return localStorage.getItem(bt.HAS_OPENED_SAVE_SLOT)==="true"}function nc(e){localStorage.setItem(bt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function qS(){localStorage.getItem(bt.HAS_OPENED_SAVE_SLOT)===null&&nc(!1)}function Bf(){let e=b();if(e!=null)for(let t of Object.values(ke)){let n=`${bt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function Ff(){let e=b();if(e!=null)for(let t of Object.values(ke)){let n=`${bt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Jl(t);else{let o=pr(c.fromInt(1));Xi(t,o)}}}function Sa(e){let t=ba(bt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Hi(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=ba(bt.CURRENCY[e],r),s=o??Sa(e),l=c.fromInt(0);if(!i||$n(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,p=a;try{f!=null&&(p=c.fromAny(f),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}lt(i,d);let h=!Tf(s,p),y=(v=>{if(v==null)return null;try{let E=v instanceof c?v.clone?.()??v:c.fromAny(v);if(typeof E.cmp=="function")return E.cmp(l)>0?E:null;if(!E.isZero?.())return E}catch{}return null})(n),g=null;if(h)try{g=p.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=y),h||g){let v={key:e,value:p,slot:r,delta:g??void 0};Nh(v);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:v}))}catch{}}return p}function pr(e){return e.mulScaledIntFloor(1n,-_f)}function Zl(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,_f)}function Jl(e){let t=ba(bt.MULTIPLIER[e]);if(!t)return pr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Wr)){let r=pr(c.fromInt(1));return Xi(e,r),r}let o=n.slice(Wr.length);try{return c.fromAny(o)}catch{let r=pr(c.fromInt(1));return Xi(e,r),r}}function Xi(e,t,n=b()){let o=ba(bt.MULTIPLIER[e],n);if(!o||$n(e,n))return;let r=pr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Wr))try{r=c.fromAny(i.slice(Wr.length))}catch{}let s=c.fromAny(t),l=Wr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(Wr)?u.slice(Wr.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{lt(o,u)}catch{}if(!Tf(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:Zl(f),slot:n}}))}catch{}}function Fh(e){return Zl(Jl(e))}function $n(e,t=b()){let n=ba(bt.CURRENCY[e],t);return Bh(n)}function oc(e,t){let n=c.fromAny(t),o=pr(n);return Xi(e,o,b()),n}function Ia(e,t){let n=localStorage.getItem(`${bt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function GS(){Object.values(bt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Ah(e){let t=n=>{try{let o=c.fromAny(n);return typeof ne=="function"?ne(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return Sa(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Hi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Hi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Hi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof ne=="function"?ne(r):r.toString()},t.mult={get(){return Fh(e)},set(n){return oc(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Jl(e).mulBigNumInteger(o);return r.isZero()&&(r=pr(c.fromInt(1))),Xi(e,r),Zl(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),_f)}catch{o={numer:1n,scale:0}}let r=Jl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=pr(c.fromInt(1))),Xi(e,r);let i=Zl(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var mr,Vi,CS,MS,_f,Wr,kS,Do,va,jl,Lf,Mh,Th,Af,bt,ke,dr,O,St=De(()=>{Et();Yt();mr="ccc:",Vi=mr,CS=`${mr}slotSig`,MS=`${mr}slotMod`,_f=18,Wr="XM:",kS=140,Do=new Map,va=null,jl=new Set;Lf=new Map,Mh=null;Th=null,Af=!1;FS();bt={HAS_OPENED_SAVE_SLOT:`${mr}hasOpenedSaveSlot`,SAVE_SLOT:`${mr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},ke={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===bt.SAVE_SLOT){if(e.newValue===null)dr=null;else{let t=parseInt(e.newValue,10);dr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:dr}}))}catch{}}});for(let e of Object.values(ke))bt.CURRENCY[e]=`${mr}${e}`,bt.MULTIPLIER[e]=`${mr}mult:${e}`;PS();O=new Proxy({},{get(e,t){if(Object.values(ke).includes(t))return Ah(t);if(typeof t=="string"&&ke[t.toUpperCase?.()])return Ah(ke[t.toUpperCase()])}});if(typeof window<"u"){window.bank=O;for(let e of Object.values(ke))window[e]=O[e]}});function $h(){return wo}function rc(e){wo=!!e,document.body.classList.toggle("slots-delete-mode",wo);let t=document.getElementById("manage-saves");t&&(t.textContent=wo?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",wo),n.setAttribute("aria-pressed",wo?"true":"false")})}function HS(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function XS(){if(Dh)return;Dh=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),rc(!wo)}),window.addEventListener("keydown",r=>{wo&&r.key==="Escape"&&rc(!1)});let n=r=>{!wo||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!wo)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(HS(s),b()===s)try{localStorage.removeItem(bt.SAVE_SLOT)}catch{}Uf(),rc(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),rc(!1)}var wo,Dh,qh=De(()=>{St();Df();wo=!1,Dh=!1;document.addEventListener("DOMContentLoaded",()=>{try{XS()}catch{}})});var Gh={};vt(Gh,{initSlots:()=>WS,refreshSlotsView:()=>Uf});function VS(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function YS(e){if(!VS(e))return"No Save Data";try{let t=Ia(e,"coins");return ne(t)}catch{return"0"}}function $f(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=YS(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function WS(e){let t=document.querySelectorAll(".slot-card");$f(),t.forEach((n,o)=>{let r=o+1,i=s=>{Rf(r),Bf(),Ff(),nc(!0),typeof e=="function"&&e(r,s),$f()};n.addEventListener("click",s=>{$h()||(s.preventDefault(),i(s))})})}function Uf(){$f()}var Df=De(()=>{Et();Yt();qh();St()});var Xh={};vt(Xh,{registerPreloadedAudio:()=>zS,takePreloadedAudio:()=>KS});function zS(e,t){let n=Hh(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}ic.set(n,t)}}function KS(e){let t=Hh(e);if(!ic.has(t))return null;let n=ic.get(t);return ic.delete(t),n}var ic,Hh,sc=De(()=>{ic=new Map,Hh=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Wi(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var qf=De(()=>{});var sg={};vt(sg,{addExternalCoinMultiplierProvider:()=>qo,addExternalXpGainMultiplierProvider:()=>vr,addXp:()=>Qi,broadcastXpChange:()=>dc,computeCoinMultiplierForXpLevel:()=>Jf,getXpGainMultiplier:()=>mc,getXpLevelStorageKey:()=>jS,getXpRequirementForXpLevel:()=>pc,getXpState:()=>rt,initXpSystem:()=>Zi,isXpSystemUnlocked:()=>fn,onXpChange:()=>uc,refreshCoinMultiplierFromXpLevel:()=>tn,resetXpProgress:()=>Ji,setExternalBookRewardProvider:()=>hc,setExternalCoinMultiplierProvider:()=>rg,setExternalXpGainMultiplierProvider:()=>ig,unlockXpSystem:()=>Zr});function jS(e=b()){let t=e??b();return t==null?null:zr(t)}function un(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function ac(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function Jh(e){if(!e||typeof e!="object")return 0;if(un(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function QS(e){return!e||typeof e!="object"?0:un(e)||typeof e.cmp=="function"&&e.cmp(Zh)>=0?Number.POSITIVE_INFINITY:Jh(e)}function Yh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(JS,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(Ca())??c.fromInt(0):n}function eI(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(jh,18)}function tI(e){if(un(e)||typeof e.cmp=="function"&&e.cmp(Zh)>=0)return _t.clone?.()??_t;let t=e.floorToInteger(),n=e.sub(t),o=Jh(n);if(!Number.isFinite(o))return _t.clone?.()??_t;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return _t.clone?.()??_t;let d=BigInt(u)+l-BigInt(i),h=d%BigInt(250),m=Number(h),y=d-h;return new c(a,{base:m,offset:y})}function Qh(e){if(!e||typeof e!="object")return _t.clone?.()??_t;let n=eI(e),o=tI(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return _t.clone?.()??_t;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function eg(){let e=un(H.xpLevel),t=un(H.progress);if(!e&&!t)return!1;let n=_t.clone?.()??_t;if(H.xpLevel=n.clone?.()??n,H.progress=n.clone?.()??n,xt=n.clone?.()??n,O?.books)try{typeof O.books.set=="function"?O.books.set(n.clone?.()??n):typeof O.books.add=="function"&&O.books.add(n.clone?.()??n)}catch{}return!0}function xa(e={}){_a.size!==0&&_a.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function uc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return _a.add(n),()=>{_a.delete(n)}}function Pt(){return c.fromInt(0)}function Ca(){return c.fromInt(1)}function zi(e){if(!e)return Pt();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Pt()}}function lc(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function nI(){for(;Kf.length>0;){let e=Kf.pop();try{e?.()}catch{}}}function zh(e){if(e==null)return Pt();try{return c.fromAny(e)}catch{return Pt()}}function Xf(e){if(!Hf){Hf=!0;try{let t=jf??b(),n={unlocked:H.unlocked,xpLevel:zi(H.xpLevel),progress:zi(H.progress),requirement:zi(xt)};en(!0),ro(),En(!0);let o={unlocked:H.unlocked,xpLevel:zi(H.xpLevel),progress:zi(H.progress),requirement:zi(xt)},r=n.unlocked!==o.unlocked,i=!lc(n.xpLevel,o.xpLevel),s=!lc(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Pt();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Pt()}catch{l=Pt()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||_a.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(xa(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{Hf=!1}}}function Vf(e){if(e===jf||(nI(),jf=e??null,e==null))return;let t=(n,o)=>{let r=kt(n,o);typeof r=="function"&&Kf.push(r)};t(wa(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>Xf("unlock")}),t(zr(e),{parse:zh,equals:lc,onChange:()=>Xf("xpLevel")}),t(ji(e),{parse:zh,equals:lc,onChange:()=>Xf("progress")})}function tg(){if(Wh){Vf(b());return}Wh=!0,Vf(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Vf(b()),en(!0),ro(),En(!0)})}function Yf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function oI(e){let t=e<Vh?e:Vh;if(t<=Ki)return;let n=Ki,o=hr.get(n.toString());for(o||(o=c.fromInt(10),hr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),hr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Ki=n;return}}Ki=n}function rI(e){let t=Ki>0n?Ki:0n,n=hr.get(t.toString());if(!n||un(n))return _t.clone?.()??_t;let o=c.fromAny(t.toString()),r=Ne(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);ac(s)||(i=i.add?.(s.mulDecimal(jh,18))??i);let l=Yh(e),a=Yh(o),u=l.sub?.(a)??c.fromInt(0);ac(u)||(i=i.add?.(u.mulDecimal(ZS,18))??i);let f=QS(i);return Number.isFinite(f)?_e(f):_t.clone?.()??_t}function iI(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=un(t),o=un(e);if(n)return o?1:0;if(ac(t)||ac(e))return 0;let s=Ne(e),l=Ne(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function ng(){return wn.container&&wn.container.isConnected?!0:(wn.container=document.querySelector(".xp-counter[data-xp-hud]"),wn.container?(wn.bar=wn.container.querySelector(".xp-bar"),wn.fill=wn.container.querySelector(".xp-bar__fill"),wn.xpLevelValue=wn.container.querySelector(".xp-level-value"),wn.progress=wn.container.querySelector("[data-xp-progress]"),!0):!1)}function og(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=hr.get("0");return a.clone?.()??a}if(r.bigInt!=null){oI(i);let a=i.toString(),u=hr.get(a);if(u)return u.clone?.()??u}let s=rI(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?_t.clone?.()??_t:(r.bigInt!=null&&hr.set(r.bigInt.toString(),s),s.clone?.()??s)}function $o(){xt=og(H.xpLevel)}function cc(){H.xpLevel=Pt(),H.progress=Pt(),$o(),En(!0)}function Kh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function fc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function En(e=!1){let t=O?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=fc(H.xpLevel),o=n.bigInt,r=!n.finite,i=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null;if(!e&&(r&&Gn||!r&&o!=null&&!Gn&&!Hn&&qn!=null&&o===qn||!r&&o==null&&Hn&&i&&Xn&&i===Xn))return;if(r){try{t.set(_t)}catch{}qn=null,Gn=!0,Hn=!1,Xn=null;return}let s;if(o!=null&&o<=zf){let f=c.fromInt(1),d=Number(o);for(let h=0;h<d;h+=1)f=f.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(d)}typeof f.add=="function"?f=f.add(p):typeof p.add=="function"&&(f=p.add(f)),s=f.clone?.()??f}else s=Qh(H.xpLevel);let l=s.clone?.()??s,a=gr.size>0?Array.from(gr):typeof Kr=="function"?[Kr]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(qn=null,Gn=!0,Hn=!1,Xn=null):o!=null&&o<=zf?(qn=o,Gn=!1,Hn=!1,Xn=null):(qn=null,Gn=!1,Hn=!0,Xn=i)}function en(e=!1){let t=b();if(t==null)return Ea=null,Gf=!1,H.unlocked=!1,cc(),H;if(!e&&Gf&&t===Ea)return H;Ea=t,Gf=!0;try{let n=localStorage.getItem(wa(t));H.unlocked=n==="1"}catch{H.unlocked=!1}try{H.xpLevel=c.fromAny(localStorage.getItem(zr(t))??"0")}catch{H.xpLevel=Pt()}try{H.progress=c.fromAny(localStorage.getItem(ji(t))??"0")}catch{H.progress=Pt()}return(un(H.xpLevel)||un(H.progress))&&(H.unlocked=!0),H.unlocked?(eg(),$o(),En(!0),tg(),H):(cc(),H)}function La(){let e=b();if(e==null)return;let t={unlocked:H.unlocked?"1":"0",level:H.xpLevel.toStorage(),progress:H.progress.toStorage()};try{localStorage.setItem(wa(e),t.unlocked)}catch{}try{localStorage.setItem(zr(e),t.level)}catch{}try{localStorage.setItem(ji(e),t.progress)}catch{}let n=(()=>{let r=H.unlocked,i=H.xpLevel,s=H.progress;try{r=localStorage.getItem(wa(e))==="1"}catch{}try{let l=localStorage.getItem(zr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(ji(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();lt(wa(e),n.unlocked?"1":"0"),lt(zr(e),n.level?.toStorage?.()??t.level),lt(ji(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==H.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(H.unlocked=n.unlocked,H.xpLevel=n.level,H.progress=n.progress,$o(),En(!0),ro())}function sI(){En(!0);let e=Ca();if(typeof Wf=="function")try{let n=Wf({baseReward:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{O?.books?.addWithMultiplier?O.books.addWithMultiplier(e):O?.books?.add&&O.books.add(e)}catch{}let t=fc(H.xpLevel);t.finite?t.bigInt!=null?(qn=t.bigInt,Gn=!1,Hn=!1,Xn=null):(qn=null,Gn=!1,Hn=!0,Xn=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(qn=null,Gn=!0,Hn=!1,Xn=null)}function ro(){if(!ng())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=wn;if(!e)return;if(!H.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=ne(xt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Yf(ne(xt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Wi();return}e.removeAttribute("hidden");let i=xt,s=iI(H.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=ne(H.xpLevel)),r){let a=ne(H.progress),u=ne(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Yf(ne(H.progress)),u=Yf(ne(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Wi()}function Zi({forceReload:e=!1}={}){return ng(),en(e),$o(),ro(),tg(),rt()}function Zr(){if(en(),H.unlocked)return ro(),!1;cc(),H.unlocked=!0,La(),ro(),En(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:rt()}))}catch{}return!0}function Ji({keepUnlock:e=!0}={}){en();let t=H.unlocked;return cc(),H.unlocked=e?t||H.unlocked:!1,La(),ro(),En(!0),rt()}function Qi(e,{silent:t=!1}={}){en();let n=Ea??b();if(n!=null&&Kh(ji(n)))return{unlocked:H.unlocked,xpLevelsGained:Pt(),xpAdded:Pt(),xpLevel:H.xpLevel,progress:H.progress,requirement:xt,slot:n};if(!H.unlocked)return{unlocked:!1,xpLevelsGained:Pt(),xpAdded:Pt(),xpLevel:H.xpLevel,requirement:xt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Pt()}if(!o.isZero?.()){let d=yr.size>0?Array.from(yr):typeof jr=="function"?[jr]:[];for(let p of d)if(typeof p=="function")try{let h=p({baseGain:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});h instanceof c?o=h.clone?.()??h:h!=null&&(o=c.fromAny(h))}catch{}}if(o=Yn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return ro(),{unlocked:!0,xpLevelsGained:Pt(),xpAdded:o,xpLevel:H.xpLevel,requirement:xt};H.progress=H.progress.add(o),$o();let r=n!=null&&Kh(zr(n)),i=un(H.progress),s=un(H.xpLevel),l=un(o);if(i||s||l){let d=_t.clone?.()??_t;r||(H.xpLevel=d.clone?.()??d),H.progress=d.clone?.()??d,$o(),eg(),La(),ro(),En(!0);let p={unlocked:!0,xpLevelsGained:Pt(),xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:xt.clone?.()??xt,slot:n};if(xa(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Pt();if(H.progress.cmp(xt)<0){La(),ro();let d={unlocked:!0,xpLevelsGained:Pt(),xpAdded:o,xpLevel:H.xpLevel,progress:H.progress,requirement:xt,slot:n};if(xa(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=Ne(H.progress),p=.08118668602542883,h=Ne(xt);if(d-h>2){let g=H.xpLevel,v=d-h,E=Math.floor(v/p);if(E>25){let C=BigInt(Math.max(0,E-5));if(C>0n){let A=c.fromAny(C.toString());if(H.xpLevel=H.xpLevel.add(A),a=a.add(A),$o(),O?.books?.add)try{let N=A.clone();O.books.add(N)}catch{}}}}let m=0,y=500;for(;H.progress.cmp?.(xt)>=0&&m<y&&(H.progress=H.progress.sub(xt),H.xpLevel=H.xpLevel.add(Ca()),a=a.add(Ca()),sI(),$o(),!un(xt));)m+=1;m>=y&&H.progress.cmp(xt)>=0&&$o()}La(),ro();let u=fc(H.xpLevel);u.finite?u.bigInt!=null?(qn=u.bigInt,Gn=!1,Hn=!1,Xn=null):(qn=null,Gn=!1,Hn=!0,Xn=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(qn=null,Gn=!0,Hn=!1,Xn=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:xt.clone?.()??xt,slot:n};if(xa(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function rt(){return en(),{unlocked:H.unlocked,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:xt.clone?.()??xt}}function dc(e={}){en();let t=Ea??b(),n={...rt(),slot:t,...e};if(xa(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function fn(){return en(),!!H.unlocked}function pc(e){return og(e)}function mc(){en();let e=Ca(),t=yr.size>0?Array.from(yr):typeof jr=="function"?[jr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function Jf(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=fc(t),o=n.bigInt;if(!n.finite)return _t.clone?.()??_t;let i;if(o!=null&&o<=zf){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=Qh(t);let s=i.clone?.()??i,l=gr.size>0?Array.from(gr):typeof Kr=="function"?[Kr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!H.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function rg(e){Kr=typeof e=="function"?e:null,gr.clear(),Kr&&gr.add(Kr),en(),En(!0)}function tn(){en(),En(!0)}function ig(e){jr=typeof e=="function"?e:null,yr.clear(),jr&&yr.add(jr)}function qo(e){return typeof e!="function"?()=>{}:(gr.add(e),en(),En(!0),()=>{gr.delete(e),en(),En(!0)})}function vr(e){return typeof e!="function"?()=>{}:(yr.add(e),en(),()=>{yr.delete(e)})}function hc(e){Wf=typeof e=="function"?e:null}var Zf,wa,zr,ji,Ea,Gf,xt,hr,Ki,_t,qn,Gn,Hn,Xn,Kr,jr,gr,yr,Wf,Vh,u_,f_,zf,jh,ZS,JS,Zh,H,_a,wn,Kf,Wh,jf,Hf,Vn=De(()=>{Et();St();es();Yt();qf();Zf="ccc:xp",wa=e=>`${Zf}:unlocked:${e}`,zr=e=>`${Zf}:level:${e}`,ji=e=>`${Zf}:progress:${e}`;Ea=null,Gf=!1,xt=c.fromInt(10),hr=new Map;hr.set("0",xt);Ki=0n,_t=c.fromAny("Infinity"),qn=null,Gn=!1,Hn=!1,Xn=null,Kr=null,jr=null,gr=new Set,yr=new Set,Wf=null,Vh=5000n,u_=Math.log10(11/10),f_=Math.log10(5/2),zf=200n,jh="0.04139268515822507",ZS="0.3979400086720376",JS="0.1",Zh=c.fromScientific(String(c.MAX_E));H={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};_a=new Set;wn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};Kf=[],Wh=!1,jf=null,Hf=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Zi,unlockXpSystem:Zr,addXp:Qi,getXpState:rt,broadcastXpChange:dc,isXpSystemUnlocked:fn,getXpRequirementForXpLevel:pc,getXpGainMultiplier:mc,setExternalCoinMultiplierProvider:rg,addExternalCoinMultiplierProvider:qo,refreshCoinMultiplierFromXpLevel:tn,setExternalXpGainMultiplierProvider:ig,addExternalXpGainMultiplierProvider:vr,setExternalBookRewardProvider:hc,resetXpProgress:Ji}))});var pg={};vt(pg,{GHOST_TAP_TIMEOUT_MS:()=>aI,clearGhostTapTarget:()=>Ma,consumeGhostTapGuard:()=>dg,initGlobalGhostTap:()=>yI,installGhostTapGuard:()=>gI,markGhostTapTarget:()=>fg,setGhostTapSelector:()=>vI,shouldSkipGhostTap:()=>io,suppressNextGhostTap:()=>Eo});function Ho(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function td(){return typeof document>"u"?null:document}function uI(e){if(!td())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(ed)}function Ma(e){e&&(e[gc]=0)}function fg(e,t=0,n=null){if(!e)return;let o=Ho(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[gc]=o+r:e[gc]=0,cI=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&Eo(i)}function dg(e){if(typeof window>"u")return!1;let t=window[ts];return typeof t!="number"?!1:Ho()<=t?!0:(window[ts]=null,!1)}function io(e){if(!e)return!1;let t=Number(e[gc]||0);return!Number.isFinite(t)||t<=0?!1:Ho()<=t?(Ma(e),!0):(Ma(e),!1)}function Eo(e=0){if(typeof window>"u")return;let t=Ho(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[ts]=null;return}let o=t+n,r=typeof window[ts]=="number"?window[ts]:0;window[ts]=Math.max(r,o)}function fI(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(vc=br=Ho(),Go=0))}function dI(e){vc=br=Ho(),Go=0}function pI(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Ho();br>0&&(Go=t-br),vc=t}function mI(){let e=Ho();br>0&&(Go=e-br),vc=e}function hI(e){if(!e.isTrusted)return;let t=Ho(),n=br>0?t-br:-1,o=uI(e.target);if(io(o)){Go=0,e.preventDefault(),e.stopImmediatePropagation();return}if(dg(o)){o&&Ma(o),Go=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Go||n)>=ug){Ma(o),Go=0,e.preventDefault(),e.stopImmediatePropagation();return}Go=0}function gI(e={}){if(ag)return;let t=td();!t||typeof window>"u"||(ag=!0,Qf="PointerEvent"in window,lg=!Qf&&"ontouchstart"in window,e.selector&&(ed=`${e.selector}, ${yc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(ug=e.longPressMs),t.addEventListener("click",hI,!0),Qf?(t.addEventListener("pointerdown",fI,{capture:!0,passive:!1}),t.addEventListener("pointerup",pI,{capture:!0,passive:!0})):lg&&(t.addEventListener("touchstart",dI,{capture:!0,passive:!1}),t.addEventListener("touchend",mI,{capture:!0,passive:!0})))}function cg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(yc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(fg(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function yI(){let e=td();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",cg,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",cg,{capture:!1,passive:!1})}function vI(e){e&&(ed=`${e}, ${yc}`)}var aI,gc,ts,yc,lI,ag,ed,Qf,lg,cI,vc,br,Go,ug,ns=De(()=>{aI=0,gc=Symbol("ccc:ghostTap:skipUntil"),ts="__cccGhostTapSkipUntil",yc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',lI=80,ag=!1,ed=yc,Qf=!1,lg=!1,cI=null,vc=0,br=0,Go=0,ug=lI});var nd,mg=De(()=>{nd={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var hg={};vt(hg,{RateAccumulator:()=>Ta,pauseGameLoop:()=>ad,registerFrame:()=>EI,registerTick:()=>xo,resumeGameLoop:()=>ld,startGameLoop:()=>II,stopGameLoop:()=>wI});function id(e){e||(e=performance.now());let t=e;if(sd){Jr=t,ei=requestAnimationFrame(id);return}Jr||(Jr=t);let n=(t-Jr)/1e3;Jr=t,n>60&&(n=60),n<0&&(n=0),Qr+=n;let o=0,r=250;for(;Qr>=ka;){if(o>=r){Qr=Qr%ka;break}od.forEach(i=>{try{i(ka)}catch(s){console.error("Error in game tick listener:",s)}}),Qr-=ka,o++}if(rd.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),os===0||rs===0)os=Date.now(),rs=t;else{let i=t-rs;if(i>SI){let s=Date.now(),l=s-os;l<-1e3?In():l>i+1e4&&In(),os=s,rs=t}}ei=requestAnimationFrame(id)}function ad(){sd=!0}function ld(){sd=!1,Jr=performance.now(),Qr=0,os=0,rs=0}function II(){ei||(Jr=performance.now(),Qr=0,os=0,rs=0,ei=requestAnimationFrame(id))}function wI(){ei&&(cancelAnimationFrame(ei),ei=null)}function xo(e){return typeof e!="function"?()=>{}:(od.add(e),()=>{od.delete(e)})}function EI(e){return typeof e!="function"?()=>{}:(rd.add(e),()=>{rd.delete(e)})}var bI,ka,od,rd,ei,sd,Jr,Qr,os,rs,SI,Ta,ti=De(()=>{St();bI=20,ka=1/bI,od=new Set,rd=new Set,ei=null,sd=!1,Jr=0,Qr=0,os=0,rs=0,SI=2e3;Ta=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*ka;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ze,ni,Aa,Na,Ra,Oa,so,Pa,is,xI,LI,_I,CI,MI,gg,oi=De(()=>{Et();Ze="automation",ni=1,Aa=2,Na=3,Ra=4,Oa=5,so=6,Pa=7,is={[Aa]:"coins",[Na]:"books",[Ra]:"gold",[Oa]:"magic",[Pa]:"dna"},xI="img/misc/mysterious.webp",LI="img/misc/locked.webp",_I="Hidden Upgrade",CI="Locked Upgrade",MI=[{area:Ze,id:ni,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ze,id:Aa,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ze,id:Na,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ze,id:Ra,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ze,id:Oa,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ze,id:so,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}},{area:Ze,id:Pa,title:"Autobuy DNA Upgrades",desc:"Automatically buys DNA upgrades",icon:"sc_upg_icons/autobuy_dna.webp",lvlCap:1,baseCost:1e27,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e99")},effectSummary(){return null},computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=11||t===1/0)&&(n=!0):typeof t=="bigint"?t>=11n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=11)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};if(!e.surgeUnlocked)return{locked:!0,iconOverride:LI,titleOverride:CI,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0};let o="Reach Surge 11 to reveal this upgrade";return{locked:!0,iconOverride:xI,titleOverride:_I,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}],gg=MI.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var Ig={};vt(Ig,{getLabCost:()=>bg,getLabLevel:()=>zt,getLabLevelFromCoins:()=>Sg,getLabLevelKey:()=>ud,getRpMult:()=>us,getRpMultBase:()=>wc,hasVisitedLab:()=>cs,initLabLogic:()=>kI,initLabTab:()=>pd,setLabLevel:()=>si,setLabVisited:()=>vg,updateLabLevel:()=>fd,updateLabTab:()=>md});function Fa(){let e=b();if(Da=e,e==null){Xo=c.fromInt(0),ii=!1;return}try{let t=localStorage.getItem(Ic(e));t?Xo=c.fromAny(t):Xo=c.fromInt(0)}catch{Xo=c.fromInt(0)}try{ii=localStorage.getItem(yg(e))==="1"}catch{ii=!1}}function cs(){let e=b();return e==null?!1:((Da!==e||ii===null)&&Fa(),ii)}function vg(e){let t=b();if(t==null)return;let n=!!e;if(!(ii===n&&Da===t)){ii=n;try{localStorage.setItem(yg(t),n?"1":"0")}catch{}}}function zt(){let e=b();return e==null?c.fromInt(0):O.coins.value.isInfinite()?c.fromAny("Infinity"):((Da!==e||Xo===null)&&Fa(),Xo)}function si(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((Da!==t||Xo===null)&&Fa(),n.cmp(Xo)===0)return;Xo=n,localStorage.setItem(Ic(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function bg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Sg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function fd(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Ic(e)))return;let t=O.coins.value,n=zt();if(t.isInfinite()){n.isInfinite()||si(c.fromAny("Infinity"));return}let o=Sg(t);o.cmp(n)>0&&si(o)}function kI(){Fa(),typeof window<"u"&&window.addEventListener("saveSlot:change",Fa),xo(fd),xo(wg),Eg()}function dd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function TI(e){if(!e||typeof e!="object")return 0;if(dd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function NI(e){if(dd(e)||typeof e.cmp=="function"&&e.cmp(AI)>=0)return ls.clone?.()??ls;let t=e.floorToInteger(),n=e.sub(t),o=TI(n);if(!Number.isFinite(o))return ls.clone?.()??ls;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return ls.clone?.()??ls;let d=BigInt(u)+l-BigInt(i),h=d%BigInt(250),m=Number(h),y=d-h;return new c(a,{base:m,offset:y})}function wc(){let e=zt();if(dd(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return NI(n)}function us(){let e=wc();return typeof Yn=="function"?Yn("rp",e):e}function pd(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",Ba&&Ba.destroy(),Ba=new cd(e))}function md(){vg(!0),Ba&&Ba.resize()}var Sr,ss,as,yg,Ic,Xo,ii,Da,ud,ls,AI,Ba,bc,cd,ai=De(()=>{St();co();Et();Yt();Wn();ti();es();li();ci();lo();Sr=1e308,ss=1e300,as=1e-300,yg=e=>`ccc:lab:visited:${e}`,Ic=e=>`ccc:lab:level:${e}`,Xo=null,ii=null,Da=null;ud=e=>Ic(e);ls=c.fromAny("Infinity"),AI=c.fromScientific(String(c.MAX_E));Ba=null;bc=512*.95,cd=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${ne(zt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),fd()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami Exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=Je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>Sr&&(this.camX=Sr),this.camX<-Sr&&(this.camX=-Sr),this.camY>Sr&&(this.camY=Sr),this.camY<-Sr&&(this.camY=-Sr),this.zoom>ss&&(this.zoom=ss),this.zoom<as&&(this.zoom=as)}update(t){this.checkBounds();let n=zt(),o=bg(n.add(1)),r=xn(),i=Lo(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${ne(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${ne(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami Exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let p=this.bursts[d];p.time+=t;for(let h of p.particles)h.x+=h.vx*t,h.y+=h.vy*t,h.vx*=.95,h.vy*=.95;p.time>=p.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),p=(_,U)=>{if(U<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*U})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/_)*_,L=Math.ceil((this.camX+n/2/r)/_)*_;if((L-M)/_>1e3)return;for(let se=M;se<=L&&!(se+_<=se);se+=_){let de=(se-this.camX)*r+n/2;t.moveTo(de,0),t.lineTo(de,o)}let V=Math.floor((this.camY-o/2/r)/_)*_,J=Math.ceil((this.camY+o/2/r)/_)*_;for(let se=V;se<=J&&!(se+_<=se);se+=_){let de=(se-this.camY)*r+o/2;t.moveTo(0,de),t.lineTo(n,de)}t.stroke()},h=d*r,m=Math.max(0,Math.min(1,(h-15)/25));p(d,m),p(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let y=(0-this.camY)*r+o/2;y>=-10&&y<=o+10&&(t.moveTo(0,y),t.lineTo(n,y));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let v=[],E=new Map;for(let _ of Ut)Ir(_.id)&&(v.push(_),E.set(_.id,this.getNodePosition(_)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let _ of v)if(_.parentIds&&_.parentIds.length>0)for(let U of _.parentIds){let M=Ut.find(L=>L.id===U);if(M&&E.has(M.id)){let L=E.get(M.id),V=E.get(_.id),J=(L.x-this.camX)*r+n/2,se=(L.y-this.camY)*r+o/2,de=(V.x-this.camX)*r+n/2,ge=(V.y-this.camY)*r+o/2;t.moveTo(J,se),t.lineTo(de,ge)}}t.stroke();let C=bc,A=C*r,X=C*1.6*r;for(let _ of v){let U=E.get(_.id),M=(U.x-this.camX)*r+n/2,L=(U.y-this.camY)*r+o/2,V=ut(_.id),J=V>=_.maxLevel,se=!0;if(M+X/2<0||M-X/2>n||L+X*.8<0||L-X/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,M-X/2,L-X/2,X,X),J?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,M-X/2,L-X/2,X,X):ri(_.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,M-X/2,L-X/2,X,X);let ge=this.nodeImages[_.id];if(ge||(ge=new Image,ge.src="img/"+_.icon,this.nodeImages[_.id]=ge),ge.complete&&ge.naturalWidth!==0&&t.drawImage(ge,M-A/2,L-A/2,A,A),se){let Te=Sc(_.id),Ce=0;if(J)Ce=1;else if(Te.isInfinite?.()||typeof Te.cmp=="function"&&Te.cmp(c.fromAny("Infinity"))===0)Ce=0;else{let K=ao(_.id);if(K.isZero?.())Ce=0;else try{if(Te.isZero?.())Ce=1;else{let pe=K.div(Te).toScientific(5);Ce=Number(pe)}}catch{Ce=0}}Ce=Math.max(0,Math.min(1,Ce));let F=X*.96,z=X*.18,$=M-F/2,q=L+X/2+X*.05;t.fillStyle="#111",t.fillRect($,q,F,z);let j=t.createLinearGradient($,q,$,q+z);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,q,F*Ce,z),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,q,F,z),t.fillStyle="#fff",t.font=`bold ${z*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,z*.08);let Y=`Level ${V}`;J&&(Y=_.maxLevel===1?"UNLOCKED":"MAXED");let re=t.measureText(Y),x=q+z/2+(re.actualBoundingBoxAscent-re.actualBoundingBoxDescent)/2;t.strokeText(Y,$+F/2,x),t.fillText(Y,$+F/2,x)}}let B=35,G=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let _ of this.bursts){let U=(_.x-this.camX)*this.zoom+n/2,M=(_.y-this.camY)*this.zoom+o/2;for(let L=0;L<G.length;L++){let V=G[L],J=_.time-V.delay;if(J>0&&J<V.dur){let se=J/V.dur,de=1-Math.pow(1-se,3),ge=B*de,Te=Math.max(0,1-Math.pow(se,2)),Ce=1+L*.5,F=t.createRadialGradient(U,M,ge*.6,U,M,ge);F.addColorStop(0,"rgba(255, 200, 50, 0)"),F.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,Te*.15*Ce)})`),F.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,Te*.2*Ce)})`),F.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=F,t.beginPath(),t.arc(U,M,ge,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let L of _.particles)if(_.time<L.life){let V=1-_.time/L.life,J=U+L.x,se=M+L.y;t.fillStyle=`rgba(255, 255, 150, ${V})`,t.beginPath(),t.arc(J,se,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=bc/2*1.6;for(let u of Ut){if(!Ir(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,p=l-f.y;if(Math.sqrt(d*d+p*p)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Ut.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.innerHTML=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=ri(t);Ua(t,!p),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),hd(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Ut.find(l=>l.id===this.activeOverlayId);if(!t||!Ir(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=ut(t.id),o=ao(t.id),r=Sc(t.id),i=ri(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.textContent=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?ne(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?ne(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${ne(o)} / ${ne(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=bc/2*1.6;for(let u of Ut){if(!Ir(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,p=l-f.y;if(Math.sqrt(d*d+p*p)<=a){if(ut(u.id)>=u.maxLevel)return;let y=ri(u.id);Ua(u.id,!y),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=bc/2*1.6;for(let u of Ut){if(!Ir(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,p=s-f.y;if(Math.sqrt(d*d+p*p)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<as&&(i=as),i>ss&&(i=ss);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<as&&(i=as),i>ss&&(i=ss);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});function Lg(e){typeof e=="function"&&xg.push(e)}function yd(){$a=null}function xc(){$a=null;try{Ec.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{tn()}catch{}}function vd(e){return typeof e=="function"&&Ec.push(e),()=>{Ec=Ec.filter(t=>t!==e)}}function OI(e){let t=pt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return _e(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function PI(){try{return!!fn()}catch{return!1}}function qa(e){let t=O?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(PI())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=Tt(Se.STARTER_COVE,Ee.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=OI(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function ui(e=Se.STARTER_COVE){if($a)return $a;let t=Ct(e),n=[];if(e===Se.STARTER_COVE&&Se.DNA){let i=Ct(Se.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),goldValue:c.fromInt(1),magicValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=Ln(s,i.id),a=Xe(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:p,mpMult:h}=Yo(i,l,s);r.xpValue=It(r.xpValue,d),r.coinValue=It(r.coinValue,p),r.mpValue=It(r.mpValue,h),u=It(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=It(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=It(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=It(r.mpValue,u);else if(i.effectType==="gold_value")r.goldValue=It(r.goldValue,u);else if(i.effectType==="magic_value")r.magicValue=It(r.magicValue,u);else if(i.effectType==="book_value")r.bookValue=It(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of xg)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return $a=r,r}function fs(e){let t=ui(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:RI*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue,goldValueMultiplier:t.goldValue,magicValueMultiplier:t.magicValue}}function gd(){let{goldValue:e,magicValue:t}=ui(Se.STARTER_COVE);try{O.gold?.mult?.set&&O.gold.mult.set(e)}catch{}try{O.magic?.mult?.set&&O.magic.mult.set(t)}catch{}}function Lc(){try{let{mpValue:e}=ui(Se.STARTER_COVE);return e}catch{return c.fromInt(1)}}function _c(){try{let{magnetRadius:e}=ui(Se.STARTER_COVE);return e||0}catch{return 0}}function _g(){try{Vo()}catch{}gd(),vd(gd);try{qo(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=ui(Se.STARTER_COVE);return It(n,o)})}catch{}try{vr(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=ui(Se.STARTER_COVE);return It(n,o)})}catch{}try{fi(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=ui(Se.STARTER_COVE);return It(n,o)})}catch{}qa(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{qa()}catch{}try{tn()}catch{}try{gd()}catch{}})}var RI,$a,Ec,xg,bd=De(()=>{Et();St();_o();Vn();Co();lo();RI=1,$a=null,Ec=[],xg=[]});var Ag={};vt(Ag,{addExternalEacAmountMultiplierProvider:()=>wd,addExternalEacMultiplierProvider:()=>BI,getAutobuyerToggle:()=>di,getEacAmountMultiplier:()=>kc,initAutomationEffects:()=>qI,setAutobuyerToggle:()=>wr,setTsunamiBonusProvider:()=>Id,updateAutomation:()=>Tg});function Id(e){Cg=e}function BI(e){typeof e=="function"&&Mg.push(e)}function wd(e){typeof e=="function"&&kg.push(e)}function kc(){let e=1;if(Ke(2))if(Ke(8)){let t=xn(),n=Cg(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of kg)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function Ed(e){Mc!==e&&(ds.clear(),Mc=e)}function di(e,t){let n=b();Ed(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(ds.has(r))return ds.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return ds.set(r,i),i}function wr(e,t,n){let o=b();Ed(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);ds.set(i,s);try{localStorage.setItem(i,s)}catch{}}function FI(e){Tg(e),$I(e)}function UI(){if(Cc)return Cc;let e=[...Ct(Se.STARTER_COVE),...Ct(Se.DNA)],t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Cc=t,Cc}function DI(e){if(!(!e||e.length===0))for(let t of e){let n=t.area||Se.STARTER_COVE;if(di(n,t.id)!=="0"){let r=Tt(n,t.id),i=t.lvlCap??1/0;r<i&&Ld(n,t.id)}}}function $I(e){let t=b();Ed(t);let n=UI();for(let[r,i]of Object.entries(is)){let s=Number(r);Tt(Ze,s)>0&&n[i]&&DI(n[i])}Tt(Ze,so)>0&&(Sd++,Sd>=5&&(Sd=0,di(Ze,so)!=="0"&&Tc()))}function Tg(e){let n=Tt(Ze,ni);for(let r of Mg)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){Ga=0;return}Ga+=e;let o=1/n;if(Ga>=o){let r=Math.floor(Ga/o);if(r>0){let i=r;i*=kc(),xd(i),Ga-=r*o}}}function qI(){xo(FI),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Mc&&(ds.clear(),Mc=t)})}var Ga,Sd,Cg,Mg,kg,ds,Mc,Cc,ps=De(()=>{ti();lo();Ha();oi();ms();St();Wn();Ga=0,Sd=0,Cg=()=>0;Mg=[];kg=[];ds=new Map,Mc=null;Cc=null});function _d(){let e=b();if(Fg=e,e==null){Xa=!1;return}try{Xa=localStorage.getItem(GI(e))==="1"}catch{Xa=!1}}function Wo(e){return hs.nodes[e]||(hs.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),hs.nodes[e]}function HI(e,t){let n=Wo(t);try{let o=localStorage.getItem(Va(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(Ya(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(Pg(e,t));n.active=i==="1";let s=localStorage.getItem(Bg(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function Ng(){_d();let e=b();hs.nodes={},zn=null,e!=null&&Ut.forEach(t=>{HI(e,t.id),hs.nodes[t.id].active&&(zn=t.id)})}function Rg(){let e=b();e!=null&&Ut.forEach(t=>{let n=hs.nodes[t.id];if(n)try{localStorage.setItem(Ya(e,t.id),n.rp.toStorage())}catch{}})}function ut(e){return Wo(e).level}function Er(e,t){let n=b();if(n==null||Wt(Va(n,e)))return!1;let o=Wo(e);o.level=t;try{localStorage.setItem(Va(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function ao(e){return Wo(e).rp}function gs(e,t){let n=b();if(n!=null&&Wt(Ya(n,e)))return;let o=Wo(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function ri(e){return Wo(e).active}function Ua(e,t){let n=b();if(n==null)return;let o=!!t;o?(zn!==null&&zn!==e&&Ua(zn,!1),zn=e):zn===e&&(zn=null);let r=Wo(e);if(r.active!==o){r.active=o;try{localStorage.setItem(Pg(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function Og(e,t){let n=b();if(n==null)return;let o=Wo(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(Bg(n,e),o.discovered?"1":"0")}catch{}}}function Ir(e){let t=uo.get(e);if(!t)return!1;if(Wo(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return Og(e,!0),!0;if((e===5||e===6)&&((Fg!==b()||Xa===null)&&_d(),!Xa))return!1;for(let o of t.parentIds){let r=uo.get(o);if(!r)continue;if(ut(o)<r.maxLevel)return!1}return Og(e,!0),!0}function Sc(e){let t=uo.get(e);if(!t)return c.fromAny("Infinity");let n=ut(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function Lo(){let e=0,t=ut(1);t>0&&(e+=t*.01);let n=ut(10);return n>0&&(e+=n*.01),e}function Ug(){return ut(4)>=1}function Dg(e=[]){if(b()!=null){try{si(0)}catch{}zn!==null&&Ua(zn,!1),Ut.forEach(n=>{e.includes(n.id)||(Er(n.id,0),gs(n.id,c.fromInt(0)))})}}function wg(e){let t=us();if(t.isZero?.()||zn===null)return;let n=uo.get(zn);if(!n||!Ir(n.id))return;let r=t.mulDecimal(e.toString(),18),i=ao(n.id);if(ut(n.id)>=n.maxLevel)return;let s=i.add(r);for(;;){let l=Sc(n.id);if(s.cmp(l)<0||ut(n.id)>=n.maxLevel)break;s=s.sub(l);let a=ut(n.id);if(!Er(n.id,a+1))break}gs(n.id,s)}function $g(){let e=uo.get(2);if(!e)return c.fromInt(1);let t=ut(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function qg(){let e=uo.get(3);if(!e)return c.fromInt(1);let t=ut(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function Cd(){let e=uo.get(5);if(!e)return c.fromInt(1);let t=ut(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function Md(){let e=uo.get(6);if(!e)return c.fromInt(1);let t=ut(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function XI(){let e=uo.get(7);if(!e)return c.fromInt(1);let t=ut(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.1,t);return c.fromAny(n)}function Gg(){let e=uo.get(8);return e?1+ut(e.id)*.1:1}function Hg(){let e=uo.get(9);return e?1+ut(e.id)*.1:1}function Eg(){qo(({baseMultiplier:e})=>{let t=$g();return e.mulDecimal(t.toScientific())}),vr(({baseGain:e})=>{let t=qg();return e.mulDecimal(t.toScientific())}),Lg(()=>Gg()),wd(()=>Hg()),Id(()=>Lo()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&tn(),e&&e.id===8&&xc()})}var Va,Ya,Pg,Bg,GI,Ut,uo,Xa,Fg,hs,zn,li=De(()=>{Et();St();ai();Yt();Vn();bd();ps();Va=(e,t)=>`ccc:lab:node:level:${t}:${e}`,Ya=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,Pg=(e,t)=>`ccc:lab:node:active:${t}:${e}`,Bg=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,GI=e=>`ccc:reset:experiment:completed:${e}`,Ut=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Fe($g())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Fe(qg())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Fe(Cd())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Fe(Md())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e8,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Fe(XI())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Fe(Gg())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Fe(Hg())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:`Increases the Tsunami Exponent by +0.01 per level\nThis node will scale <strong>3x</strong> RP each level`,baseRpReq:1e12,scale:3,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`}],uo=new Map(Ut.map(e=>[e.id,e])),Xa=null,Fg=null,hs={nodes:{}},zn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",Ng),setInterval(Rg,1e3),window.addEventListener("beforeunload",Rg),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&_d()}),Ng());window.RESEARCH_NODES=Ut;window.isResearchNodeVisible=Ir});var Kg={};vt(Kg,{getBookProductionRate:()=>_r,getEffectiveTsunamiNerf:()=>Lr,getSurge6WealthMultipliers:()=>Ac,getTsunamiNerf:()=>xn,getTsunamiNerfKey:()=>Td,getTsunamiSequenceSeen:()=>dn,initSurgeEffects:()=>WI,isSurgeActive:()=>Ke,setTsunamiNerf:()=>pi,setTsunamiSequenceSeen:()=>Ko});function Td(e){return kd(e)}function dn(){let e=b();if(e==null)return!1;try{return localStorage.getItem(zg(e))==="1"}catch{return!1}}function Ko(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(zg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function xn(){return xr}function Lr(){let t=xn()+Lo();return t>1&&(t=1),t}function pi(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=kd(n);if(Wt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}xr=t,ys();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function Ke(e){return fo===1/0||typeof fo=="string"&&fo==="Infinity"||fo===Number.POSITIVE_INFINITY?!0:typeof fo=="bigint"?fo>=BigInt(e):typeof fo=="number"?fo>=e:!1}function Wa(e){if(!Ke(8))return e;let t=Ne(e);if(!Number.isFinite(t))return e;let n=Lr();return _e(t*n)}function ys(){let e=Kn();fo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(Ke(8)){let n=Lr(),o=Math.log10(Xg);zo=_e(o*n)}else zo=c.fromInt(Xg);else zo=c.fromInt(1)}function Ac(){if(!Ke(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,h=0)=>{if(!p){if(h<=0)return c.fromInt(1);let C=Math.log10(h)/3;if(C<=0)return c.fromInt(1);let A=C*Math.log10(2);return _e(A)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=Ne(p),y=m;if(Number.isFinite(m)){if(m<15&&h>0)try{let E=Number(p.toPlainIntegerString());if(Number.isFinite(E)){let C=E+h;C>0&&(y=Math.log10(C))}}catch{}}else if(h>0)y=Math.log10(h);else return c.fromInt(1);let g=y/6;if(g<=0)return c.fromInt(1);let v=g*Math.log10(2);return _e(v)},t=e(O.coins?.value),n=O.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(O.gold?.value),s=e(O.magic?.value),l=t,a=r,u=i,f=s;Ke(8)&&(l=Wa(t),a=Wa(r),u=Wa(i),f=Wa(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function _r(){if(!Ke(3))return c.fromInt(0);let t=rt().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(Vg),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=_e(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*Vg;n=_e(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),O.books?.mult){let o=O.books.mult.get();n=n.mulBigNumInteger(o)}return Ke(8)&&(n=Wa(n)),n}function VI(e){if(!Ke(3))return;Yg||(Yg=new Ta("books",O));let t=_r();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);O.books&&O.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,O.books&&O.books.add(c.fromInt(o))}}}function Wg(e){if(e==null)return;let t=localStorage.getItem(kd(e));t!==null?(xr=Number(t),(Number.isNaN(xr)||!Number.isFinite(xr))&&(xr=Ke(8)?0:1)):Ke(8)?xr=0:xr=1}function YI(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function WI(){let e=b();ys(),Wg(e),ys(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=fo,n=Ke(8);ys();let o=fo,r=Ke(8);!n&&r?(pi(0),dn()||Ko(!0)):r?YI(t,o)>0&&(pi(0),dn()||Ko(!0)):n&&!r&&pi(1)}),window.addEventListener("lab:node:change",()=>{ys()}),window.addEventListener("saveSlot:change",()=>{Wg(b()),ys()})),qo(({baseMultiplier:t})=>zo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(zo)),vr(({baseGain:t})=>zo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(zo)),fi(({baseGain:t})=>zo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(zo)),fi(({baseGain:t})=>{if(!Ke(4))return t;let n=c.fromInt(4444e9);if(Ke(8)){let o=Lr(),r=Math.log10(4444e9);n=_e(r*o)}return t.mulBigNumInteger(n)}),qo(({baseMultiplier:t})=>{if(!Ke(6))return t;let n=Ac();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),hc(({baseReward:t})=>Ke(3)?c.fromInt(0):t),xo(VI)}var Xg,Vg,kd,zg,zo,fo,Yg,xr,Wn=De(()=>{Et();St();Vn();Co();_o();ti();Et();li();Xg=10,Vg=.08685889638,kd=e=>`ccc:surge:tsunamiNerf:${e}`,zg=e=>`ccc:unlock:tsunami:${e}`;zo=c.fromInt(1),fo=0n,Yg=null,xr=0});var oy={};vt(oy,{getGearsProductionRate:()=>Bc,getGenerationLevelKey:()=>gi,getGenerationUpgradeCost:()=>Cr,initWorkshopSystem:()=>ny,initWorkshopTab:()=>Fd,performFreeGenerationUpgrade:()=>Tc,updateWorkshopTab:()=>po});function bs(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*ow}function gi(e){return`ccc:workshop:genLevel:${e}`}function ja(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(gi(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function Ja(e){let t=b();if(!t)return!1;let n=gi(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function Qa(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return Nd;if(t<=mi)return Nd+t*Zg;Rc===null&&(Rc=Nd+mi*Zg);let n=t-mi;if(t<=za)return Rc+n+bs(n,vs);if(Oc===null){let d=za-mi;Oc=Rc+d+bs(d,vs)}let o=t-za,r=t-mi,i=za-mi,s=o+(bs(r,vs)-bs(i,vs)),l=ew/QI,a=.5*l*o*o;if(t<=Nc)return Oc+s+a;if(Rd===null){let d=Nc-za,p=Nc-mi,h=d+(bs(p,vs)-bs(i,vs)),m=.5*l*d*d;Rd=Oc+h+m}let u=tw*(t-Nc);if(u>709)return 1/0;let f=Rd*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function Cr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=Qa(t);return _e(n)}function Bd(e){let t,n=e;e instanceof c||(n=c.fromAny(e));let o=Ke(11)?JI:Ke(7)?ZI:jI;if(n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let i=n.mulDecimal(o);if(n.cmp(9e15)<=0){let l=Number(n.toString())*o;t=_e(l)}else{let s=n.mulDecimal(o);if(s.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let l=Number(s.toScientific(10));l===1/0?t=c.fromAny("Infinity"):t=_e(l)}catch{t=c.fromAny("Infinity")}}}let r=O?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(r)}function sw(){let e=Cr(it);if(O.coins.value.cmp(e)<0)return;let t=it.add(1);Ja(t)&&(it=t,O.coins.sub(e),po(),nn())}function aw(){if(!$t())return;let n=Bd(it).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&O.gears&&O.gears.add(n),it.cmp(20)<0){let r=Number(it.toPlainIntegerString()),s=Math.pow(Ke(11)?4:Ke(7)?3:2,r)/20,l=Math.floor(s),a=s-l;if(hi+=a,hi>=1){let u=Math.floor(hi);hi-=u,O.gears&&O.gears.add(u)}}else hi=0}function Pd(){O.gears&&O.gears.set(0),Ja(c.zero())&&(it=c.zero()),hi=0,po()}function Qg(e){if(!e)return;let t=Za.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),Za.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;it.cmp(Ad)>0?i=Ad:i=Number(it.toPlainIntegerString());let s=Math.min(Math.floor(i),Ad),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,p=Math.cos(d)*Jg,h=Math.sin(d)*Jg,m=Math.random()*360,y=(Math.random()<.5?-1:1)*(rw+Math.random()*iw);l.push({x:u,y:f,dx:p,dy:h,rotation:m,rotationSpeed:y,size:a})}for(;l.length>s;)l.pop()}function lw(e){let t="Click the big red button below to open the Automation Shop";Je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${zI}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${ey}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will <span data-workshop="production-verb">double</span> the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${KI}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{sw()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),uw()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{Is("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(Zt&&Zt.isConnected){let a=Zt.querySelector(".workshop-side-left"),u=Zt.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let p=Za.get(d);if(p){let h=d.getBoundingClientRect(),m=window.devicePixelRatio||1;p.width=h.width,p.height=h.height;let y=Math.round(h.width*m),g=Math.round(h.height*m);if(p.canvas&&(p.canvas.width!==y||p.canvas.height!==g)&&(p.canvas.width=y,p.canvas.height=g,p.ctx.scale(m,m)),p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let v of p.gears)v.x=Math.random()*(p.width-v.size),v.x<0&&(v.x=0),v.y=Math.random()*(p.height-v.size),v.y<0&&(v.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?ty():cw()},{root:null,threshold:0}).observe(e),Zt=e}function po(){if(!Zt)return;let e=Zt.querySelector('[data-workshop="production-verb"]');if(e){let a=Ke(11)?"quadruple":Ke(7)?"triple":"double";e.textContent!==a&&(e.textContent=a)}let t=Zt.querySelector('[data-workshop="gears-amount"]'),n=Zt.querySelector('[data-workshop="gears-rate"]'),o=Zt.querySelector('[data-workshop="upgrade-cost"]'),r=Zt.querySelector('[data-workshop="upgrade-gen"]'),i=Bd(it),s=Cr(it);if(t&&(t.innerHTML=O.gears.fmt(O.gears.value)),n&&(n.innerHTML=ne(i)),o){let a="Coins";try{a=!s.isInfinite()&&s.cmp(1)===0?"Coin":"Coins"}catch{}o.innerHTML=`${ne(s)} ${a}`}if(r){let a=O.coins.value.cmp(s)>=0;r.disabled=!a;let u=Tt(Ze,so),f=!1;if(u>0){let d=b(),p=d!=null?`:${d}`:"",h=`ccc:autobuy:${Ze}:${so}${p}`;f=localStorage.getItem(h)!=="0"}f?r.classList.add("is-automated"):r.classList.remove("is-automated")}let l="";if(it.isInfinite()?l="Infinity":l=it.floorToInteger().toStorage(),l!==Od){Od=l;let a=Zt.querySelector(".workshop-side-left"),u=Zt.querySelector(".workshop-side-right");a&&Qg(a),u&&Qg(u)}}function cw(){Ss&&(cancelAnimationFrame(Ss),Ss=null)}function ty(){if(Ss)return;Ka=0;let e=t=>{if(Zt&&Zt.isConnected){let n=Zt.querySelector('[data-workshop="gears-amount"]');n&&!el()&&(n.innerHTML=O.gears.fmt(O.gears.value)),Ka||(Ka=t);let o=(t-Ka)/1e3;Ka=t,o>.1&&(o=.1);for(let[r,i]of Za){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!Pc.complete||Pc.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,p=f.y+f.size/2;u.save(),u.translate(d,p),u.rotate(f.rotation*Math.PI/180),u.drawImage(Pc,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}Ss=requestAnimationFrame(e)};Ss=requestAnimationFrame(e)}function ny(){jg||(jg=!0,it=ja(),xo(aw),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{it=ja(),hi=0,$t()||Pd(),po()}),window.addEventListener("currency:change",e=>{e.detail.key===ke.COINS&&po()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===ke.GEARS&&po()}),window.addEventListener("debug:change",()=>{it=ja(),po()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&($t()||Pd())})))}function Fd(e){ny(),!e.__workshopInit&&(e.__workshopInit=!0,it=ja(),Za.clear(),Od=-1,lw(e),typeof IntersectionObserver>"u"&&ty(),$t()||Pd(),po())}function Bc(){let e=ja();return Bd(e)}function Tc(){let e=O.coins.value.isInfinite(),n=Cr(it).isInfinite();if(e&&n&&!it.isInfinite())return it=c.fromAny("Infinity"),Ja(it),po(),!0;if(O.coins.value.isZero())return!1;let o=Ne(O.coins.value);if(!Number.isFinite(o))if(O.coins.value.inf)o=1/0;else return!1;if(Qa(it)>o||it.cmp(9e15)>0)return!1;let r=Number(it.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);Qa(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(it)>0&&Ja(a)?(it=a,po(),!0):!1}function uw(){if(O.coins.value.isInfinite()){Tc()&&nn();return}let e=Ne(O.coins.value);if(!Number.isFinite(e)&&O.coins.value.isZero()||Qa(it)>e||it.cmp(9e15)>0)return;let t=Number(it.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);Qa(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(it.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(Cr(c.fromInt(u)));if(l.cmp(O.coins.value)>0){let u=Cr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(it)>0&&Ja(a)&&(it=a,O.coins.sub(l),po(),nn())}var ey,zI,Pc,KI,Ad,Zt,jg,hi,it,Od,Ss,Nd,jI,ZI,JI,mi,za,Nc,Zg,vs,QI,ew,tw,nw,ow,Rc,Oc,Rd,Za,Jg,rw,iw,Ka,ms=De(()=>{Et();Yt();St();ti();ci();_o();lo();co();oi();Wn();ey="img/currencies/gear/gear.webp",zI="img/currencies/gear/gear_plus_base.webp",Pc=new Image;Pc.src=ey;KI="img/currencies/coin/coin.webp",Ad=300,Zt=null,jg=!1,hi=0,it=c.zero(),Od=-1,Ss=null,Nd=12,jI=.3010299956639812,ZI=.47712125471966244,JI=.6020599913279624,mi=1e6,za=1e9,Nc=1e12,Zg=1,vs=.001,QI=1e3,ew=Math.log10(1.00001),tw=23e-11,nw=Math.log(10),ow=1/nw;Rc=null,Oc=null,Rd=null;Za=new Map,Jg=67,rw=67,iw=67;Ka=0});var sy={};vt(sy,{calculateOfflineRewards:()=>ws,calculatePreAutomationRewards:()=>Uc,formatTimeCompact:()=>Fc,grantOfflineRewards:()=>yi,initOfflineTracker:()=>pw,processOfflineProgress:()=>iy,showOfflinePanel:()=>Mr});function Fc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),v=g.mulBigNumInteger(l),E=t.sub(v),C=0;try{let A=E.div(c.fromInt(i)).floorToInteger();C=Number(A.toPlainIntegerString())}catch{C=0}return C===0?`${ne(g)}y`:`${ne(g)}y ${C}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let p=Math.floor(f/60),h=f%60;if(p<24)return h===0?`${p}h`:`${p}h ${h}m`;let m=Math.floor(p/24),y=p%24;return y===0?`${m}d`:`${m}d ${y}h`}function Mr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${Fc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",fw.forEach(m=>{let y=m.key,g=e[y];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(y==="research_levels"){Array.isArray(g)&&g.forEach(B=>{let G=document.createElement("div");G.className="offline-row";let _=document.createElement("span");_.className="offline-plus",_.style.color="#004F96",_.textContent="+";let U=document.createElement("img");U.className="offline-icon",U.src=m.icon,U.alt="RP";let M=document.createElement("span");M.className="offline-text",M.style.color="#004F96";let L=c.fromInt(B.levels),V=L.cmp(c.fromInt(1))===0?"Level":"Levels";M.textContent=`${ne(L)} ${V} of ${B.name}`,G.appendChild(_),G.appendChild(U),G.appendChild(M),f.appendChild(G)});return}let v=document.createElement("div");v.className="offline-row";let E=document.createElement("span");E.className="offline-plus",E.classList.add(`text-${y}`),E.textContent="+";let C=document.createElement("img");C.className="offline-icon",C.src=m.icon,C.alt=y;let A=document.createElement("span");A.className="offline-text",A.classList.add(`text-${y}`);let N=!1;g instanceof c?N=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:N=Number(g)===1;let X=N?m.singular:m.plural;A.innerHTML=`${ne(g)} ${X}`,v.appendChild(E),v.appendChild(C),v.appendChild(A),f.appendChild(v)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let h=()=>{r.remove()};return p.addEventListener("click",h),r.addEventListener("click",m=>{m.target===r&&h()}),d.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{Es(i,a,".offline-scroll-container")}),r}function dw(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function ws(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=us?us():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Ut.filter(h=>ri(h.id)),d=[],p={};for(let h of f){let m=ut(h.id),y=ao(h.id).add(u),g=0,v=h.maxLevel;for(;m<v;){let E=dw(h,m);if(E.isInfinite&&E.isInfinite()||y.cmp(E)<0)break;y=y.sub(E),m++,g++}g>0&&d.push({name:h.title,levels:g}),p[h.id]={level:m,rp:y}}d.length>0&&(o.research_levels=d),Object.keys(p).length>0&&(o.research_progress=p)}let s=(Bc?Bc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||$n("gears",t)||(o.gears=s);let l=_r?_r():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||$n("books",t)||(o.books=u)}let a=Tt(Ze,ni)||0;if(a>0){let u=1;Ke(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=$c(),p=d.coins.mulBigNumInteger(f),h=d.xp.mulBigNumInteger(f),m=d.mp.mulBigNumInteger(f);p.isZero()||$n("coins",t)||(o.coins=p),h.isZero()||Wt(`ccc:xp:progress:${t}`)||(o.xp=h),m.isZero()||Wt(`ccc:mutation:progress:${t}`)||(o.mp=m)}}return o}function yi(e){if(b()!=null){if(e.xp)try{let n=Qi(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=xs(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(Er(r,o.level),gs(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||O[n]&&typeof O[n].add=="function"&&O[n].add(e[n])}}function Uc(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=jn(),i=c.fromInt(1);try{let l=fs(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Yn=="function"){let l=Yn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=$c(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||Wt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||Wt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function iy(){let e=b();if(e==null)return;let t=Nf(),n=Date.now();if(t<=0)return;if(n<t-1e4){In(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!$t()){let l=Uc(r),a=Object.keys(l).length>0;return a&&(yi(l),Mr(l,o,!0)),a}let i=ws(r),s=Object.keys(i).length>0;return s&&(yi(i),Mr(i,o)),s}function pw(e,t){ry||(ry=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?ad():(ld(),iy()&&typeof t=="function"&&t())))}))}var ry,fw,Dc=De(()=>{St();ms();_o();ti();St();Et();Yt();ci();co();lo();ai();li();oi();Ha();Vn();Co();Wn();es();ry=!1;fw=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Mr});function $d(e){let t=24,n=Date.now();try{let o=localStorage.getItem(Ud(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Dd(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(Ud(e),"24"),localStorage.setItem(Dd(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function ly(e,t,n){try{localStorage.setItem(Ud(e),String(t)),localStorage.setItem(Dd(e),String(n))}catch{}}function cy(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=$d(e);if(t>=Ls)return;let o=Date.now(),r=o-n;if(r>=qc){let i=Math.floor(r/qc);t+=i,t>=Ls?(t=Ls,n=o):n+=i*qc,ly(e,t,n),kr&&kr.classList.contains("is-active")&&jo(!0)}}function hw(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function gw(){let e=b();if(e==null)return;cy();let{charges:t,lastCharge:n}=$d(e);t<=0||(t>=Ls&&(n=Date.now()-50),t--,ly(e,t,n),jo(!0),tl&&clearInterval(tl),tl=setInterval(()=>{jo()},1e3),ht(mw,{volume:.5}),hw(),setTimeout(()=>{let o=ws(ay);yi(o),Mr(o,ay*1e3)},7250))}function jo(e=!1){if(!kr||!kr.classList.contains("is-active"))return;let t=b();if(t==null)return;e||cy();let{charges:n,lastCharge:o}=$d(t),r=kr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${Ls}</span>`);let i=kr.querySelector(".warp-timer");if(i)if(n>=Ls)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+qc,u=Math.max(0,a-l);i.textContent=`Next warp in ${Fc(u)}`}let s=kr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function uy(e){if(!e||e.__warpInit)return;e.__warpInit=!0,kr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",gw),tl||(tl=setInterval(()=>{jo()},1e3)),jo()}var Ud,Dd,Ls,qc,ay,mw,kr,tl,qd=De(()=>{St();Dc();Dn();Ud=e=>`ccc:warp:charges:${e}`,Dd=e=>`ccc:warp:lastCharge:${e}`,Ls=24,qc=3600*1e3,ay=150,mw="sounds/warp.ogg",kr=null,tl=null});function Sy(){try{return localStorage.getItem(Ar(jd))==="1"}catch{return!1}}function Jd(){try{return localStorage.getItem(Ar(Iy))==="1"}catch{return!1}}function Vc(e){let t=b();if(t==null)return;let n=`${Iy}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),yw()}catch{}}function Yc(){return Jd()?"Jeff":"Merchant"}function yw(){let e=Yc();We&&We.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function nl(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&io(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(v=>console.error(v)),n&&y()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,Eo(160)))},f=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},d=()=>{r&&l()},p=g=>{r=!0,Eo(160)},h=g=>{r&&l()},m=()=>{r&&l()},y=()=>{e.removeEventListener("click",a),wy?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):ww&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",h),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function Gc(e){return Sw[e]??0}function fy(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function Ew(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function rl(e,t){let n=vi.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;Cs.set(e,r),n.unlocked=r;let i=_n.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&_n.buttons[e]?.classList.contains("is-active")&&Kc("dialogue")}function Gd(){let e=!1;try{e=!!Ts?.()}catch{}rl("reset",e)}function Hd(){let e=!1;try{e=!!$t?.()}catch{}rl("workshop",e)}function hy(){let e=!1;try{typeof Mo=="function"&&(e=Mo())}catch{}rl("warp",e)}function xw(){let e=b();if(e==null)return!1;try{return typeof dn=="function"&&dn()?!0:localStorage.getItem(Ey(e))==="1"}catch{return!1}}function Wd(){rl("lab",xw())}function Lw(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function _w(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof fn=="function"&&fn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof rt=="function"?rt():null;t&&typeof t=="object"&&(e.xpLevel=Lw(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Rr=="function"&&Rr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof $t=="function"&&$t()}catch{e.hasInfuseReset=!1}return e}function Cw(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?Vd:Yd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?Vd:Yd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Qd:""),i.icon=o?.icon??(r==="mysterious"?Tr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Zo:bw),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function Mw(){if(dy)return;dy=!0;let e=kw;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${Iw}:${t}`;kt(n,{onChange:e})}}function kw(){Jo()}function Tw(e,t){let n=ep(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,xy(n),Aw(t.reward),!0)}function Aw(e){if(e){if(e.type==="coins"){try{O.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{O.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{O.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function Nw(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function ep(){try{return JSON.parse(localStorage.getItem(Ar(ol))||"{}")}catch{return{}}}function xy(e){let t=Ar(ol);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{lt(t,n)}catch{}}catch{}}function Rw(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function Ow(){let e=zd;if(zd=null,typeof e=="function")try{e()}catch{}}function Pw(e,t={}){t?.rawChanged&&Jo()}function Xd(e){if(e===gy)return;if(Ow(),gy=e??null,e==null){Jo();return}let t=`${ol}:${e}`;zd=kt(t,{parse:Rw,onChange:Pw});try{lt(t)}catch{}Jo()}function Bw(){if(py){Xd(b());return}py=!0,Xd(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Xd(b())})}function Or(){Promise.resolve().then(()=>(Dn(),Kl)).then(({loadAudio:e})=>{e(Ly)})}function Fw(){if(_s)return;_s=ht(Ly,{volume:Je?.15:.3,loop:!0})}function er(){_s&&(_s.stop&&_s.stop(),_s=null)}function Uw(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let E=0;E<t.length;E++){let C=t[E];C==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=C):C===">"&&l?(s+=C,i.push({type:"tag",content:s}),s="",l=!1):s+=C}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,p="";Qo=!0,Fw();let h=E=>{d&&(E.preventDefault(),f=!0)},m=E=>{d&&(E.key==="Enter"||E.key===" ")&&(f=!0)},y=o.length?o:[e];requestAnimationFrame(()=>{d=!0,y.forEach(E=>E.addEventListener("click",h,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{y.forEach(E=>E.removeEventListener("click",h)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),er(),Qo=!1},v=()=>{if(f){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let E=i[a];E.type==="tag"?(p+=E.content,e.innerHTML=p,a++,v()):(p+=E.content[u],e.innerHTML=p,u++,u>=E.content.length&&(a++,u=0),setTimeout(v,n))};v()})}function Dw(e={}){if(!We)return;Or();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Zo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Tr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,We.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Zo,r.textContent=e.message||Qd,requestAnimationFrame(()=>t.classList.add("is-visible")),We.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),We.classList.remove("firstchat-active"),er(),Qo=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),Mn(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&Mn(160),l()};nl(i,()=>{u()},{once:!0}),i.focus?.()}function $w(e,t){Or();let n=t.scriptId;String(e)==="6"&&typeof cs=="function"&&!cs()&&(n=7),Yr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Yc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ms}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,We.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),We.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{Yr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),We.classList.remove("firstchat-active"),er(),Qo=!1,o.remove()},d=()=>{u||(u=!0,f(),Jo())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&Mn(160),d())});let p=new Nr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,v)=>{t.scriptId===4&&g==="c4b"&&Vc(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){Jo(),f();return}Tw(e,t),Jo(),f()}}}),m=!!ep()[e]?.claimed,y=structuredClone(nd[n]);m&&y.nodes.m2b&&y.nodes.c2a&&t.scriptId===1&&(y.nodes.m2b.say="I've already given you Coins, goodbye.",y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&y.nodes.m3a&&(y.nodes.m3a.say="I've already given you Books, goodbye.",y.nodes.c2a&&(y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&y.nodes.m5a&&(y.nodes.m5a.say="I've already given you Gold, goodbye.",y.nodes.c5a&&(y.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&y.nodes.m7a&&(y.nodes.m7a.say="I've already given you Magic, goodbye.",y.nodes.c7a&&(y.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(y),p.start()}function qw(){if(document.getElementById(vy))return;let e=document.createElement("style");e.id=vy,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function Gw(){let e=We?.querySelector(".merchant-content");if(!e||e.__customScroll||!yt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),yt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){qw();let L=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;yt.style.timelineScope=L,e.style.scrollTimelineName=L,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=L,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let M=(e.scrollTop||0)>0;f!==M&&(f=M,yt?.classList.toggle("has-scroll-shadow",M))},p=()=>{let M=We.querySelector(".merchant-grabber"),L=We.querySelector(".merchant-header"),V=We.querySelector(".merchant-actions"),J=(M?.offsetHeight||0)+(L?.offsetHeight||0)|0,se=(V?.offsetHeight||0)|0;t.style.top=J+"px",t.style.bottom=se+"px"},h={},m=()=>{let{scrollHeight:M,clientHeight:L,scrollTop:V}=e,J=t.clientHeight||e.clientHeight||1;if(h.scrollHeight===M&&h.clientHeight===L&&h.barH===J&&(u||h.scrollTop===V))return;h={scrollHeight:M,clientHeight:L,scrollTop:V,barH:J};let se=L/Math.max(1,M),de=Math.max(28,Math.round(J*se)),ge=Math.max(1,M-L),Te=Math.max(0,J-de);if(n.style.height=de+"px",u)n.style.setProperty("--thumb-y",`${Te}px`),n.style.setProperty("--thumb-x","0px");else{let Ce=Math.round(V/ge*Te);n.style.transform=`translateY(${Ce}px)`}t.style.display=M<=L+1?"none":""},y=()=>{p(),m(),d()},g=()=>{o&&(yt.classList.add("is-scrolling"),l&&clearTimeout(l))},v=M=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{yt.classList.remove("is-scrolling")},M))},E=()=>{m(),d(),o&&g(),s||v(r)},C=()=>v(r);e.addEventListener("scroll",E,{passive:!0}),s&&e.addEventListener("scrollend",C,{passive:!0});let A=new ResizeObserver(y);A.observe(e),window.addEventListener("resize",y),requestAnimationFrame(y);let N=!1,X=0,B=0,G=M=>{N=!0,X=M.clientY,B=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},_=M=>{if(!N)return;let L=t.clientHeight||1,V=n.clientHeight||1,J=Math.max(1,L-V),se=Math.max(1,e.scrollHeight-e.clientHeight),ge=(M.clientY-X)/J*se;e.scrollTop=B+ge},U=M=>{if(N){N=!1,n.classList.remove("dragging"),v(i);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",G),window.addEventListener("pointermove",_,{passive:!0}),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let L=t.getBoundingClientRect(),V=M.clientY-L.top,J=t.clientHeight||1,se=n.clientHeight||1,de=Math.max(0,J-se),ge=Math.max(0,Math.min(V-se/2,de)),Te=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ge/Math.max(1,de)*Te,g(),v(r)}),e.__customScroll={bar:t,thumb:n,ro:A,updateAll:y},y()}function Hw(){if(We)return;We=document.createElement("div"),We.className="merchant-overlay",We.id="merchant-overlay",We.setAttribute("inert",""),yt=document.createElement("div"),yt.className="merchant-sheet",yt.setAttribute("role","dialog"),yt.setAttribute("aria-modal","false"),yt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",Gd(),Hd(),hy(),Wd(),vi.forEach(h=>{h.key==="dialogue"&&Cs.set("dialogue",!0);let m=Cs.get(h.key),y=m??!!h.unlocked,g=document.createElement("button");g.type="button",g.className="merchant-tab",g.dataset.tab=h.key;let v=h.lockedLabel||"???";g.textContent=y?h.label:v,y?g.title=h.label||"Tab":(g.classList.add("is-locked"),g.disabled=!0,g.title="???"),h.unlocked=y,Cs.set(h.key,y),nl(g,E=>{if(g.disabled){E?.preventDefault?.();return}Kc(h.key)}),o.appendChild(g),_n.buttons[h.key]=g}),_n.panels.dialogue=i,_n.panels.reset=s,_n.panels.workshop=l,_n.panels.warp=a,_n.panels.lab=u,_n.tablist=o,r.append(i,s,l,a,u),n.append(o,r),Gd(),Hd();try{Vo()}catch{}try{tp(s)}catch{}try{$e()}catch{}try{Fd(l)}catch{}try{uy(a)}catch{}try{pd(u)}catch{}if(!my&&typeof window<"u"){let h=m=>{let{key:y,slot:g}=m?.detail??{};g!=null&&g!==b()||((y==="forge"||!y)&&Gd(),(y==="infuse"||!y)&&Hd(),(y==="surge_completed"||!y)&&hy(),(y==="lab"||y==="tsunami"||!y)&&Wd())};window.addEventListener("unlock:change",h,{passive:!0}),window.addEventListener("saveSlot:change",h,{passive:!0}),my=!0}let f=document.createElement("div");f.className="merchant-actions";let d=document.createElement("button");d.type="button",d.className="merchant-close",d.textContent="Close",Hc=d,f.appendChild(d);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ms}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,yt.append(e,t,n,f,p),We.appendChild(yt),document.body.appendChild(We),Xw(),Gw(),yy||(yy=!0,nl(d,()=>{zc()},{once:!1}),document.addEventListener("keydown",zw),e.addEventListener("pointerdown",Kw),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),We.addEventListener("pointerdown",Or,{once:!0}))}function Xw(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,Mw(),Jo()}function Vw(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?$w(n.id,n.meta):n.isMysterious&&Dw(n.lockInfo)}}function Jo(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=_w(),o=ep(),r=!1,i=new Set;Object.entries(Wc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=Gc(u),d=Cw(l,n),p=d.status,h=Gc(p);if(h>f)a.status=p,p==="mysterious"?a.lockSnapshot=fy(d):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(h<f){if(u==="unlocked")d=Ew(l),p="unlocked",h=Gc(p);else if(u==="mysterious"){let M=a.lockSnapshot||fy(d)||{};d={status:"mysterious",unlocked:!1,title:M.title??d.title??"???",blurb:M.blurb??d.blurb??Vd,tooltip:M.tooltip??d.tooltip??"Hidden Dialogue",message:M.message??d.message??Qd,icon:M.icon??d.icon??Tr,headerTitle:M.headerTitle??d.headerTitle??Zo,ariaLabel:M.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},p="mysterious",h=Gc(p)}}let m=p==="unlocked",y=p==="mysterious",g=p==="locked",v=!!a.claimed,E=m&&!!(l.once&&v),C=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!C){C=document.createElement("button"),C.type="button",C.className="dlg-card",C.dataset.dlgId=String(s);let M=document.createElement("div");M.className="dlg-title";let L=document.createElement("div");L.className="dlg-blurb";let V=document.createElement("div");V.className="dlg-reward",C.append(M,L,V),t.appendChild(C),nl(C,Vw)}C._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:m,isMysterious:y},C.dataset.dlgStatus=p,C.disabled!==!!g&&(C.disabled=!!g),C.classList.toggle("is-locked",g),C.classList.toggle("is-mysterious",y),C.classList.toggle("is-complete",!!E),C.classList.toggle("has-again",!!E),g?(C.getAttribute("aria-disabled")!=="true"&&C.setAttribute("aria-disabled","true"),C.getAttribute("tabindex")!=="-1"&&C.setAttribute("tabindex","-1")):(C.hasAttribute("aria-disabled")&&C.removeAttribute("aria-disabled"),C.hasAttribute("tabindex")&&C.removeAttribute("tabindex"));let A=C.querySelector(".dlg-title"),N=m?l.title:d.title??"???";A.textContent!==N&&(A.textContent=N);let X=C.querySelector(".dlg-blurb"),B=m?l.blurb:d.blurb??"";X.textContent!==B&&(X.textContent=B);let G=C.querySelector(".dlg-reward");if(m&&l.reward){let M=vw[l.reward.type];if(M){G.classList.contains("has-reward")||(G.classList.add("has-reward"),G.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),G.style.getPropertyValue("--reward-icon")!==`url('${M}')`&&G.style.setProperty("--reward-icon",`url('${M}')`);let L=G.querySelector(".amt"),V=String(l.reward.amount);L&&L.textContent!==V&&(L.textContent=V);let J=G.querySelector(".currency-name");if(J){let de=String(l.reward.type||""),ge=de.charAt(0).toUpperCase()+de.slice(1);J.textContent!==ge&&(J.textContent=ge)}let se=`Reward: ${l.reward.amount} ${l.reward.type}`;G.getAttribute("aria-label")!==se&&G.setAttribute("aria-label",se)}else{G.classList.remove("has-reward");let L=Nw(l.reward);G.textContent!==L&&(G.textContent=L),G.style.display!==""&&(G.style.display=""),G.removeAttribute("aria-label")}G.style.display==="none"&&(G.style.display="")}else G.textContent!==""&&(G.textContent=""),G.style.display!=="none"&&(G.style.display="none");let _=m?`${l.title}${E?" (completed)":""}`:d.ariaLabel||(y?"Hidden merchant dialogue":"Locked merchant dialogue");if(C.getAttribute("aria-label")!==_&&C.setAttribute("aria-label",_),d.tooltip)C.title!==d.tooltip&&(C.title=d.tooltip);else if(m){let M="Left-click: Start Dialogue";C.title!==M&&(C.title=M)}else C.hasAttribute("title")&&C.removeAttribute("title");let U=C.querySelector(".dlg-again");E?U||(U=document.createElement("div"),U.className="dlg-again",U.textContent="Ask Again?",C.appendChild(U)):U&&U.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&xy(o)}function Yw(){let e=We.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Yr(!0);let i=new Nr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Yr(!1);try{localStorage.setItem(Ar(jd),"1")}catch{}try{window.dispatchEvent(new Event(Zd))}catch{}e.classList.remove("is-visible"),We.classList.remove("firstchat-active")}});i.load(nd[0]),i.start()}function Ww(){if(!We)return;let e=We.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),We.classList.remove("firstchat-active")}function _y(){if(Hw(),ks)return;let e=document.activeElement;e instanceof HTMLElement&&!We.contains(e)?Xc=e:Xc=null,ks=!0;let t=b(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(Ey(t),"1")}catch{}Wd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Ar(jd))==="1"}catch{o=!1}o||We.classList.add("firstchat-instant"),yt.style.transition="none",yt.style.transform="",We.removeAttribute("inert"),yt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(We.classList.contains("firstchat-instant")||(yt.style.transition=""),We.classList.add("is-open"),Mn(140),Hc&&typeof Hc.focus=="function")try{Hc.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(Ar(by))||"dialogue"}catch{}n&&(r="dialogue"),Kc(r),er(),o||(We.querySelector(".merchant-firstchat")?.classList.add("is-visible"),We.classList.add("firstchat-active"),Yw())})})}function zc(){if(!ks)return;if(Yr(!1),Je){try{Eo(100)}catch{}try{Mn(80)}catch{}}ks=!1,yt.style.transition="",yt.style.transform="",We.classList.remove("is-open"),We.classList.remove("firstchat-instant"),Ww();let e=document.activeElement;if(e&&We.contains(e)){let t=Xc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}We.setAttribute("inert",""),Xc=null,er(),Qo=!1}function zw(e){if(ks&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<vi.length;i++)Cs.get(vi[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<vi.length&&(e.preventDefault(),Kc(vi[r].key))}}function Kw(e){if(!ks)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;Cn={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},yt.style.transition="none",window.addEventListener("pointermove",Cy,{passive:!0}),window.addEventListener("pointerup",My),window.addEventListener("pointercancel",ky)}function Cy(e){if(!Cn||Cn.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-Cn.startY);Cn.lastY=t,Cn.moved=n,yt.style.transform=`translateY(${n}px)`}function My(){if(!Cn||Cn.canceled){Kd();return}let e=Math.max(1,performance.now()-Cn.startT),t=Cn.moved;t/e>.55&&t>40||t>140?(Eo(160),yt.style.transition="transform 140ms ease-out",yt.style.transform="translateY(100%)",setTimeout(()=>{zc()},150)):(yt.style.transition="transform 180ms ease",yt.style.transform="translateY(0)"),Kd()}function ky(){Cn&&(Cn.canceled=!0,yt.style.transition="transform 180ms ease",yt.style.transform="translateY(0)",Kd())}function Kd(){window.removeEventListener("pointermove",Cy),window.removeEventListener("pointerup",My),window.removeEventListener("pointercancel",ky),Cn=null}function Kc(e){let t=vi.find(o=>o.key===e),n=Cs.get(e);(!t||!n)&&(e="dialogue");for(let o in _n.buttons)_n.buttons[o].classList.toggle("is-active",o===e);for(let o in _n.panels)_n.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Jo()}catch{}if(e==="warp")try{jo()}catch{}if(e==="lab"){typeof cs=="function"&&!cs()&&jw();try{md()}catch{}}try{localStorage.setItem(Ar(by),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=We?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function il(e=[]){e.forEach(t=>rl(t,!0))}function Ty(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ms}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Or();let u=h=>{h.key==="Escape"&&(h.stopImmediatePropagation(),h.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ms}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let h=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),y=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),v={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},E=new Nr({textEl:h,choicesEl:m,skipTargets:[h,y,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),er(),Qo=!1,r.remove(),t&&t()},5e3)}});E.load(v),E.start()},p=new Nr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",er(),Qo=!1,n&&n.hideCursor&&n.hideCursor(),f()}});p.load(o),p.start()}function jw(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Yc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ms}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Or();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Nr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{er(),Qo=!1,e.remove()}});s.load(i),s.start()}function Ay(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Yc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ms}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Or();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Nr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{er(),Qo=!1,t.remove(),e&&e()}});l.load(s),l.start()}var Ms,jd,by,ol,Zd,Ar,Iy,vi,Cs,vw,Tr,Zo,bw,Vd,Yd,Qd,Sw,Iw,wy,ww,dy,py,my,Ey,gy,zd,Wc,We,yt,Hc,ks,Cn,Xc,yy,_n,Ly,_s,Qo,Nr,vy,jc=De(()=>{St();Et();mg();Vn();_o();ms();qd();ai();Wn();ci();ns();co();Dn();Ms="img/misc/merchant.webp",jd="ccc:merchantMet",by="ccc:merchantTab",ol="ccc:merchant:dlgState",Zd="ccc:merchant:met",Ar=e=>`${e}:${b()}`;Iy="ccc:unlock:jeff";vi=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],Cs=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),vw={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Tr="img/misc/mysterious.webp",Zo="Hidden Dialogue",bw="Locked Dialogue",Vd="Hidden Dialogue",Yd="Locked",Qd="Locked Dialogue",Sw={locked:0,mysterious:1,unlocked:2},Iw="ccc:reset:forge:completed",wy=typeof window<"u"&&"PointerEvent"in window,ww=!wy&&typeof window<"u"&&"ontouchstart"in window;dy=!1,py=!1,my=!1;Ey=e=>`ccc:unlock:lab:${e}`;gy=null,zd=null;Wc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Tr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:Yd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Tr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof Mo=="function"&&Mo()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Tr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof dn=="function"&&dn())return!0;let t=typeof Kn=="function"?Kn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof Mo=="function"&&Mo()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Tr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Tr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};Bw();We=null,yt=null,Hc=null,ks=!1,Cn=null,Xc=null,yy=!1,_n={buttons:{},panels:{},tablist:null},Ly="sounds/merchant_typing.ogg",_s=null,Qo=!1;Nr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await Uw(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=nl(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};vy="ccc-scroll-timeline-styles"});var Kt,Ny,Ry,Oy,np=De(()=>{Yt();Kt="dna",Ny="img/misc/mysterious.webp",Ry="Hidden Upgrade",Oy=[{area:Kt,id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Coin value bonus: ${Fe(t)}x`},{area:Kt,id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`XP value bonus: ${Fe(t)}x`},{area:Kt,id:3,title:"DNA Gold Value",desc:"Multiplies Gold value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/gold_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"gold_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Gold value bonus: ${Fe(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Ny,titleOverride:Ry,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Kt,id:4,title:"DNA Magic Value",desc:"Multiplies Magic value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/magic_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"magic_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Magic value bonus: ${Fe(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Ny,titleOverride:Ry,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}]});function el(){return sl.size>0}function $y(e){if(!e||!e.costType)return!1;let t=tE[e.costType];return!t||Tt(Ze,t)<=0?!1:di(e.area,e.id)!=="0"}function rp(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function Jc(e,t){return t==="standard"&&rp(e)===eE}function op(e){let t=Ct(e),n={};for(let o of t){let r=Ln(e,o.id),i=Tt(e,o.id),s=ko(e,o.id),l=s.iconOverride??ru(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Rs(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:d}}return n}function qy(e){return Fy[e]||Fy.standard}function Mn(e=140){if(!Je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function eu(e){return String(e??"").replace(/<[^>]*>/g,"")}function Zc(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function nn(){ht(oE,{volume:Je?Gy:Hy})}function Xy(){let e=Je?Gy*2:Hy*2;ht(rE,{volume:e})}function iE(e){return`<img alt="" src="${By[e]||By.coins}" class="currency-ico">`}function aE(){if(document.getElementById(Uy))return;let e=document.createElement("style");e.id=Uy,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function Es(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){aE();let z=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=z,s.style.scrollTimelineName=z,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=z,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let y={scrollSize:0,clientSize:0,barSize:0,thumbSize:0,maxScroll:1,range:0,visibleRatio:1},g=null,v=!1,E=null,C=()=>{if(!s.isConnected||!t.isConnected)return;let F=s.getBoundingClientRect(),z=t.getBoundingClientRect();if(i){let $=Math.max(0,F.top-z.top),q=Math.max(0,z.bottom-F.bottom);l.style.top=$+"px",l.style.bottom=q+"px",l.style.left="",l.style.right=""}else{let $=Math.max(0,F.left-z.left),q=Math.max(0,z.right-F.right);l.style.left=$+"px",l.style.right=q+"px",l.style.top="",l.style.bottom="",l.style.height=""}},A=()=>{let F=i?s.scrollHeight:s.scrollWidth,z=i?s.clientHeight:s.clientWidth,$=i?l.clientHeight||z:l.clientWidth||z,q=z/Math.max(1,F),j=Math.max(28,Math.round($*q)),Y=Math.max(1,F-z),re=Math.max(0,$-j);y={scrollSize:F,clientSize:z,barSize:$,thumbSize:j,maxScroll:Y,range:re,visibleRatio:q},i?(a.style.height=j+"px",a.style.width="100%"):(a.style.width=j+"px",a.style.height="100%"),m&&(i?(a.style.setProperty("--thumb-y",`${re}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${re}px`),a.style.setProperty("--thumb-y","0px")));let x=F>z+1;l.style.display=x?"":"none",t?.classList.toggle("has-active-scrollbar",x),N()},N=()=>{v=!1;let F=i?s.scrollTop:s.scrollLeft,z=(F||0)>0;if(g!==z&&(g=z,t?.classList.toggle("has-scroll-shadow",z)),!m){let{maxScroll:$,range:q}=y,j=Math.round(F/$*q);i?a.style.transform=`translateY(${j}px)`:a.style.transform=`translateX(${j}px)`}u&&_()},X=()=>{C(),A()},B,G=()=>{clearTimeout(B),B=setTimeout(X,100)};typeof MutationObserver<"u"&&new MutationObserver(()=>G()).observe(s,{childList:!0,subtree:!0,characterData:!0});let _=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},U=F=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},F))},M=()=>{sl.has(s)||sl.add(s),clearTimeout(E),E=setTimeout(()=>{sl.has(s)&&(sl.delete(s),window.dispatchEvent(new CustomEvent("menu:scrollStop")))},150),v||(v=!0,window.requestAnimationFrame(N)),p||U(f)},L=()=>U(f);s.addEventListener("scroll",M,{passive:!0}),p&&s.addEventListener("scrollend",L,{passive:!0}),new ResizeObserver(()=>{X()}).observe(s),window.addEventListener("resize",X),requestAnimationFrame(X);let J=!1,se=0,de=0,ge=F=>{J=!0,se=i?F.clientY:F.clientX,de=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),_();try{a.setPointerCapture(F.pointerId)}catch{}F.preventDefault()},Te=F=>{if(!J)return;let{range:z,maxScroll:$}=y;if(z<=0)return;let j=(i?F.clientY:F.clientX)-se,Y=de+j/z*$;i?s.scrollTop=Y:s.scrollLeft=Y},Ce=F=>{if(J){J=!1,a.classList.remove("dragging"),U(d);try{a.releasePointerCapture(F.pointerId)}catch{}}};a.addEventListener("pointerdown",ge),window.addEventListener("pointermove",Te,{passive:!0}),window.addEventListener("pointerup",Ce),window.addEventListener("pointercancel",Ce),l.addEventListener("pointerdown",F=>{if(F.target===a)return;let z=l.getBoundingClientRect(),$=i?F.clientY-z.top:F.clientX-z.left,{thumbSize:q,range:j,maxScroll:Y}=y,x=Math.max(0,Math.min($-q/2,j))/Math.max(1,j)*Y;i?s.scrollTop=x:s.scrollLeft=x,_(),U(f)}),X()}function Dy(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function lE(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=O[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return d&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):Dy(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),h=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(h));if(d.cmp(p)===0&&d.cmp(m)===0){let g=Dy(e,o,r),v=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,E=0,C=Math.max(0,v);for(;E<C;){let A=Math.floor((E+C+1)/2),N=c.fromInt(A);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(N):c.fromAny(d??0).mulBigNumInteger(N)).cmp(a)<=0?E=A:C=A-1}return c.fromInt(E)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=bi(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function Is(e="standard"){(tu[e]||tu.standard).open()}function Vy(e=!1){Object.values(tu).forEach(t=>t.close(e))}function tr(e=!1){Object.values(tu).forEach(t=>t.update(e))}function cE(){if(on)return;on=document.createElement("div"),on.className="upg-overlay",ct=document.createElement("div"),ct.className="upg-sheet",ct.setAttribute("role","dialog"),ct.setAttribute("aria-modal","false"),ct.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",ct.append(e,t,n,o,r),on.appendChild(ct),document.body.appendChild(on),on.addEventListener("pointerdown",u=>{Je&&u.pointerType!=="mouse"&&u.target===on&&(u.preventDefault(),u.stopPropagation())},!0),on.addEventListener("click",u=>{Je&&u.target===on&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!nu)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},ct.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,ct.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(ct.style.transition="transform 160ms ease",ct.style.transform=f?"translateY(100%)":"translateY(0)",f){if(Je&&(!u||u.pointerType!=="mouse"))try{Mn(120)}catch{}setTimeout(Yy,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function Yy(){if(Je)try{Mn(160)}catch{}if(typeof Qc=="function"){let e=Qc;Qc=null;try{e()}catch{}}nu=!1,!(!on||!ct)&&(ct.style.transition="",ct.style.transform="",on.classList.remove("is-open"),on.style.pointerEvents="none")}function uE(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function fE(e,t="standard"){cE(),nu=!0;let n=!0,o=qy(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){nu=!1;return}let l=e.upgType==="HM",a=e.tie===Ee.ENDLESS_XP;function u(m,y,g="div"){let v=y.split(" ").filter(A=>A.length>0),E=null,C=[];for(let A=0;A<m.children.length;A++){let N=m.children[A];g&&N.tagName.toLowerCase()!==g.toLowerCase()||v.every(X=>N.classList.contains(X))&&(E?C.push(N):E=N)}return C.forEach(A=>A.remove()),E||(E=document.createElement(g),E.className=y,m.appendChild(E)),E}let f=m=>{let y=document.createElement("div");return y.className="upg-line",y.innerHTML=m,y},d=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let y=m.lockState||o.getLockState(e.id),g=!!y?.locked,v=g&&(y?.hidden||y?.hideEffect||y?.hideCost),E=!!m.unlockUpgrade&&!v;ct.classList.toggle("is-locked-hidden",v);let C=ct.querySelector(".upg-header"),A=u(C,"upg-title");A.textContent!==(m.displayTitle||m.upg.title)&&(A.textContent=m.displayTitle||m.upg.title);let N=!!m.hmReadyToEvolve,X=N?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,B=u(C,"upg-level"),G=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??ne(m.lvlCapBn),_=m.lvlCapFmtText??m.upg.lvlCapFmtText??eu(G),U=N?`Level ${m.lvlFmtHtml} / ${G} (EVOLVE READY)`:X?`Level ${m.lvlFmtHtml} / ${G} (MAXED)`:`Level ${m.lvlFmtHtml} / ${G}`,M=eu(U);B.innerHTML!==U&&(B.innerHTML=U),B.getAttribute("aria-label")!==M&&B.setAttribute("aria-label",M),B.hidden=v,v||B.removeAttribute("aria-hidden"),ct.classList.toggle("is-maxed",X),ct.classList.toggle("hm-evolve-ready",N),ct.classList.toggle("is-unlock-upgrade",E),ct.classList.toggle("is-hm-upgrade",l&&!v),ct.classList.toggle("is-endless-xp",a),ct.classList.toggle("is-magnet-upgrade",e.tie===Ee.MAGNET),ct.classList.toggle("is-no-effect",!m.effect);let L=C.querySelector(".auto-toggle-wrapper"),V=t==="automation"?is[e.id]:null,J=t==="automation"&&e.id===so,se=!!V,de=t==="standard"||t==="dna"?nE[e.costType]:null,ge=0;de?ge=Tt(Ze,de):(se||J)&&(ge=Tt(Ze,e.id));let Ce=ge>0&&(se||de||J)&&!v;L||(L=document.createElement("div"),L.className="auto-toggle-wrapper hm-view-milestones-row",C.appendChild(L));let F=L.querySelector("button");if(F||(F=document.createElement("button"),F.type="button",F.style.padding="10px 14px",F.style.fontSize="16px",F.style.width="auto",F.style.minWidth="180px",F.addEventListener("click",oe=>{typeof F._onClick=="function"&&F._onClick(oe)}),L.appendChild(F)),Ce){F.style.visibility="",F.style.pointerEvents="auto";let oe=b(),ye=oe!=null?`:${oe}`:"",Be=!0;if(se){let Pe=`ccc:autobuy:master:${V}${ye}`,Oe=[...Ct(Se.STARTER_COVE),...Ct(Kt)],ae=!1;for(let ee of Oe)if(ee.costType===V){let Ie=`ccc:autobuy:${ee.area}:${ee.id}${ye}`;if(di(ee.area,ee.id)!=="0"){ae=!0;break}}Be=ae}else Be=di(e.area,e.id)!=="0";Be?(F.className="shop-delve",F.textContent="Automation: ON",F.style.backgroundColor=""):(F.className="shop-close",F.textContent="Automation: OFF",F.style.backgroundColor=""),F._onClick=Pe=>{Pe.preventDefault(),Pe.stopPropagation(),Je&&Mn(50);let ae=!Be?"1":"0";se?(localStorage.setItem(`ccc:autobuy:master:${V}${ye}`,ae),[...Ct(Se.STARTER_COVE),...Ct(Kt)].forEach(Ie=>{Ie.costType===V&&wr(Ie.area,Ie.id,ae)})):wr(e.area,e.id,ae),p()}}else F.style.visibility="hidden",F.style.pointerEvents="none",F.className="shop-delve",F.textContent="Automation: ON",F._onClick=null;let z=ct.querySelector(".upg-content");d&&(z.scrollTop=0,d=!1);let $=u(z,"upg-desc centered");$.classList.toggle("lock-desc",v);let q=(m.displayDesc||m.upg.desc||"").trim();N?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):q?($.classList.remove("hm-evolve-note"),$.textContent!==q&&($.textContent=q),$.hidden=!1):$.hidden=!0;let j=u(z,"upg-info"),Y=null,re=oe=>{Y?Y.nextElementSibling!==oe&&j.insertBefore(oe,Y.nextSibling):j.firstElementChild!==oe&&j.prepend(oe),Y=oe};if(g&&y?.reason&&!v){let oe=(m.displayDesc||"").trim(),ye=String(y.reason??"").trim();if(oe!==ye){let Be=j.querySelector(".lock-wrapper");if(!Be){Be=document.createElement("div"),Be.className="lock-wrapper";let ae=document.createElement("div");ae.className="upg-line lock-note",Be.append(ae)}let Pe=Array.from(Be.children);for(let ae of Pe)ae.tagName==="DIV"&&!ae.className&&ae.style.height==="12px"&&ae.remove();let Oe=Be.querySelector(".lock-note");Oe.textContent!==y.reason&&(Oe.textContent=y.reason),re(Be)}else{let Be=j.querySelector(".lock-wrapper");Be&&Be.remove()}}else{let oe=j.querySelector(".lock-wrapper");oe&&oe.remove()}if(m.effect&&!(g&&y?.hideEffect)){let oe=j.querySelector(".effect-wrapper");if(!oe){oe=document.createElement("div"),oe.className="effect-wrapper";let Oe=document.createElement("div");Oe.className="upg-line",oe.append(Oe)}let ye=Array.from(oe.children);for(let Oe of ye)Oe.tagName==="DIV"&&!Oe.className&&Oe.style.height==="12px"&&Oe.remove();let Be=oe.querySelector(".upg-line"),Pe=`<span class="bonus-line">${m.effect}</span>`;Be.innerHTML!==Pe&&(Be.innerHTML=Pe),re(oe)}else{let oe=j.querySelector(".effect-wrapper");oe&&oe.remove()}let x=iE(m.upg.costType),K=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ce=X||N;if(!m.unlockUpgrade&&!ce&&(!g||!y?.hideCost)){let oe=u(j,"upg-costs");re(oe);let ye=Zc(m.upg.costType,K),Be=`Cost: ${x} ${O[m.upg.costType].fmt(K)} ${ye}`,Pe=u(oe,"cost-line","div");if(Pe.className.includes("upg-line")||(Pe.className="upg-line cost-line"),Pe.innerHTML!==Be&&(Pe.innerHTML=Be),l){let Ie=u(oe,"milestone-line","div");Ie.className.includes("upg-line")||(Ie.className="upg-line milestone-line");let w="\u2014",W="",Z=$y(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(Z){let le=m.hmNextMilestone.sub(c.fromInt(1)),Ye=0;try{let ve=le.toPlainIntegerString?.();ve&&ve!=="Infinity"?Ye=Number(ve):Ye=Number(le.toString())}catch{Ye=0}let nt=c.fromInt(0);try{nt=c.fromAny(m.upg.costAtLevel(Ye))}catch{}w=O[m.upg.costType].fmt(nt),W=Zc(m.upg.costType,nt)}else{let le=m.hmNextMilestone.sub(m.lvlBn),Ye=le.toPlainIntegerString?.(),nt=Math.max(0,Math.floor(Number(Ye&&Ye!=="Infinity"?Ye:Number(le.toString()||0)))),{spent:ve}=bi(m.upg,m.lvlBn,c.fromAny("Infinity"),nt);w=O[m.upg.costType].fmt(ve),W=Zc(m.upg.costType,ve)}}catch{}let me=`${Z?"Cost at next milestone:":"Cost to next milestone:"} ${x} ${w} ${W}`;Ie.innerHTML!==me&&(Ie.innerHTML=me)}else{let Ie=oe.querySelector(".milestone-line");Ie&&Ie.remove()}let Oe=Zc(m.upg.costType,m.have),ae=`You have: ${x} ${O[m.upg.costType].fmt(m.have)} ${Oe}`,ee=u(oe,"have-line","div");ee.className.includes("upg-line")||(ee.className="upg-line have-line"),ee.innerHTML!==ae&&(ee.innerHTML=ae)}else{let oe=j.querySelector(".upg-costs");oe&&oe.remove()}let pe=ct.querySelector(".upg-milestones"),Q=pe.querySelector(".hm-view-milestones-row");if(!Q){Q=document.createElement("div"),Q.className="hm-view-milestones-row";let oe=document.createElement("button");oe.type="button",oe.className="shop-delve hm-view-milestones",oe.textContent="View Milestones",oe.addEventListener("click",ye=>{oe._onClick&&oe._onClick(ye)}),Q.appendChild(oe),pe.appendChild(Q)}let ie=Q.querySelector("button");l&&!v?(ie.style.visibility="",ie.style.pointerEvents="auto",ie._onClick=()=>{let oe=Array.isArray(m.hmMilestones)?m.hmMilestones:[],ye=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Be=(()=>{try{return BigInt(qt)*BigInt(ye)}catch{return 0n}})(),Pe=oe.sort((Oe,ae)=>Number(Oe?.level||0)-Number(ae?.level||0)).map(Oe=>{let ae=Math.max(0,Math.floor(Number(Oe?.level||0))),ee=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ae)+Be).toString())}catch{return c.fromAny(ae+qt*ye)}})(),Ie=ee?.isInfinite?.()?"Infinity":ne(ee),w=Fe(Oe?.multiplier??Oe?.mult??Oe?.value??1),W=`${Oe?.target??Oe?.type??"self"}`.toLowerCase(),Z=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(ee)>=0}catch{}return!1})(),te=`Level ${Ie}: Multiplies this upgrade\u2019s effect by ${w}x`;return W==="xp"&&(te=`Level ${Ie}: Multiplies XP value by ${w}x`),(W==="coin"||W==="coins")&&(te=`Level ${Ie}: Multiplies Coin value by ${w}x`),W==="mp"&&(te=`Level ${Ie}: Multiplies MP value by ${w}x`),{text:te,achieved:Z}});uE(Pe)}):(ie.style.visibility="hidden",ie.style.pointerEvents="none",ie._onClick=null);let he=ct.querySelector(".upg-actions"),Re=he.querySelector(".shop-close");if(Re||(Re=document.createElement("button"),Re.type="button",Re.className="shop-close",Re.textContent="Close",Re.addEventListener("click",()=>{n=!1,Yy()}),he.appendChild(Re)),g||X)he.querySelectorAll("button:not(.shop-close)").forEach(oe=>oe.remove()),document.activeElement&&document.activeElement!==Re&&!he.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Re.focus();else{let oe=m.have.cmp(K)>=0,ye=(ae,ee,Ie,w,W=!1)=>{let Z=he.querySelector(`.${ae.split(" ").join(".")}`);if(!Z){Z=document.createElement("button"),Z.type="button",Z.className=ae,Z.textContent=ee;let te=()=>{typeof Z._onClick=="function"&&Z._onClick()};"PointerEvent"in window?Z.addEventListener("pointerdown",le=>{le.pointerType==="mouse"||typeof le.button=="number"&&le.button!==0||(te(),le.preventDefault())},{passive:!1}):Z.addEventListener("touchstart",le=>{te(),le.preventDefault()},{passive:!1}),Z.addEventListener("click",()=>{Je||te()});let me=he.children;w>=me.length?he.appendChild(Z):he.insertBefore(Z,me[w])}return Z._onClick=Ie,Z.textContent!==ee&&(Z.textContent=ee),Z.disabled!==W&&(Z.disabled=W),Z};if(N){he.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ae=>ae.remove()),ye("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ae}=o.evolve(e.id);ae&&(Xy(),tr(),p())},1,!1);return}if(m.unlockUpgrade){he.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ae=>ae.remove()),ye("shop-delve btn-unlock","Unlock",()=>{let{bought:ae}=o.buyOne(e.id);if(!(ae instanceof c?ae:c.fromAny(ae??0)).isZero?.()){if(nn(),Jc(e,t))try{il(["reset"])}catch{}tr(),p()}},1,!oe);return}if(he.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ae=>ae.remove()),ye("shop-delve btn-buy-one","Buy",()=>{let ae=o.getUiModel(e.id);if(ae.have.cmp(ae.nextPrice instanceof c?ae.nextPrice:c.fromAny(ae.nextPrice||0))<0)return;let{bought:ee}=o.buyOne(e.id);(ee instanceof c?ee:c.fromAny(ee??0)).isZero?.()||(nn(),tr(),p())},1,!oe),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let ae=he.querySelector(".btn-buy-max");ae&&ae.remove();let ee=he.querySelector(".btn-buy-cheap");ee&&ee.remove()}else{ye("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:w}=o.buyMax(e.id);(w instanceof c?w:c.fromAny(w??0)).isZero?.()||(nn(),tr(),p())},2,!oe);let ee=[1,3,4,5,6].includes(rp(m.upg));if(!l&&!ee)ye("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let W=o.buyCheap;if(!W)return;let{bought:Z}=W(e.id);(Z instanceof c?Z:c.fromAny(Z??0)).isZero?.()||(nn(),tr(),p())},3,!oe);else{let Ie=he.querySelector(".btn-buy-cheap");Ie&&Ie.remove()}}if(l)ye("shop-delve btn-buy-next","Buy Next",()=>{let ee=o.getUiModel(e.id);if(ee.hmReadyToEvolve)return;let Ie=ee.hmNextMilestone;if(!Ie||!ee.lvlBn||Ie.cmp(ee.lvlBn)<=0){let{bought:ve}=o.buyMax(e.id);if((ve instanceof c?ve:c.fromAny(ve??0)).isZero?.())return;nn(),tr(),p();return}let w=0;try{let ve=Ie.sub(ee.lvlBn).toPlainIntegerString?.();w=Math.max(0,Math.floor(Number(ve&&ve!=="Infinity"?ve:Ie.sub(ee.lvlBn).toString())))}catch{}let W=O[ee.upg.costType]?.value,Z=W instanceof c?W:c.fromAny(W??0),me=bi(ee.upg,ee.lvlBn,Z,w).count,le=!1;try{let ve=me?.toPlainIntegerString?.();le=ve&&ve!=="Infinity"?Number(ve)>=w:Number(me??0)>=w}catch{}let Ye=le?o.buyNext(e.id,w):o.buyMax(e.id);(Ye.bought instanceof c?Ye.bought:c.fromAny(Ye.bought??0)).isZero?.()||(nn(),tr(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let ae=he.querySelector(".btn-buy-next");ae&&ae.remove()}}},h=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,h)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",h),p(),on.classList.add("is-open"),on.classList.toggle("is-automation-upgrade",t==="automation"),on.style.pointerEvents="auto",Mn(140),ct.style.transition="none",ct.style.transform="translateY(100%)",ct.offsetHeight,requestAnimationFrame(()=>{ct.style.transition="",ct.style.transform=""}),Qc=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,h)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",h)}}function hd(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let p=Math.max(0,d-r.startY);r.lastY=d,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(Eo(100),Mn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var sl,Py,Zw,Jw,Qw,By,eE,tE,nE,Fy,oE,rE,Gy,Hy,sE,Uy,al,tu,on,ct,nu,Qc,ci=De(()=>{St();Et();Yt();co();jc();sc();Dn();lo();ns();oi();ps();np();sl=new Set;Py={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},Zw="img/misc/locked_base.webp",Jw="img/misc/maxed.webp",Qw="img/misc/green_border.webp",By={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},eE=7,tE={coins:Aa,books:Na,gold:Ra,magic:Oa,dna:Pa};nE={coins:Aa,books:Na,gold:Ra,magic:Oa,dna:Pa};Fy={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>op(jn()),getUiModel:e=>Rs(jn(),e),buyOne:e=>As(jn(),e),buyMax:e=>ll(jn(),e),buyCheap:e=>cl(jn(),e),buyNext:(e,t)=>Ns(jn(),e,t),getLockState:e=>ko(jn(),e),evolve:e=>ou(jn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",Zd,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>op(Ze),getUiModel:e=>Rs(Ze,e),buyOne:e=>As(Ze,e),buyMax:e=>ll(Ze,e),buyCheap:e=>cl(Ze,e),buyNext:(e,t)=>Ns(Ze,e,t),getLockState:e=>ko(Ze,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>op(Kt),getUiModel:e=>Rs(Kt,e),buyOne:e=>As(Kt,e),buyMax:e=>ll(Kt,e),buyCheap:e=>cl(Kt,e),buyNext:(e,t)=>Ns(Kt,e,t),getLockState:e=>ko(Kt,e),evolve:e=>ou(Kt,e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||tr(!0)});oE="sounds/purchase_upg.ogg",rE="sounds/evolve_upg.ogg",Gy=.12,Hy=.3;sE="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",Uy="ccc-scroll-timeline-styles";al=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return qy(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!Sy(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let K=document.createElement("div");K.className="shop-tile";let ce=document.createElement("img");ce.className="base",ce.alt="";let pe=document.createElement("img");pe.className="icon",pe.alt="",pe.addEventListener("error",()=>{pe.src=sE}),K.appendChild(ce),K.appendChild(pe),i.appendChild(K),t.appendChild(i),i.addEventListener("click",Q=>{let ie=Q.currentTarget;if(ie.disabled||ie.dataset.lockedPlain==="1"){Q.preventDefault(),Q.stopImmediatePropagation();return}if(io(ie)){Q.preventDefault(),Q.stopImmediatePropagation();return}if(Q.shiftKey||Q.ctrlKey){if(Q.preventDefault(),Q.stopImmediatePropagation(),!ie.upgMeta)return;let he=ie.upgMeta.id,Re=ie.upgMeta.upgType==="HM",oe=[1,3,4,5,6].includes(rp(ie.upgMeta));if(Q.shiftKey){if((Re||!oe)&&this.adapter.buyCheap){let{bought:Pe}=this.adapter.buyCheap(he);(Pe instanceof c?Pe:c.fromAny(Pe??0)).isZero?.()||(nn(),this.update());return}let{bought:ye}=this.adapter.buyMax(he);if(!(ye instanceof c?ye:c.fromAny(ye??0)).isZero?.()){if(nn(),Jc(ie.upgMeta,this.mode))try{il(["reset"])}catch{}this.update()}return}if(Q.ctrlKey){if(Re){let Pe=this.adapter.getUiModel(he);if(Pe&&!Pe.hmReadyToEvolve){let Oe=Pe.hmNextMilestone;if(Oe&&Pe.lvlBn&&Oe.cmp(Pe.lvlBn)>0){let ae=0;try{let te=Oe.sub(Pe.lvlBn).toPlainIntegerString?.();ae=Math.max(0,Math.floor(Number(te&&te!=="Infinity"?te:Oe.sub(Pe.lvlBn).toString())))}catch{}let ee=O[Pe.upg.costType]?.value,Ie=ee instanceof c?ee:c.fromAny(ee??0),W=bi(Pe.upg,Pe.lvlBn,Ie,ae).count,Z=!1;try{let te=W?.toPlainIntegerString?.();Z=te&&te!=="Infinity"?Number(te)>=ae:Number(W??0)>=ae}catch{}if(Z){let te=this.adapter.buyNext(he,ae);(te.bought instanceof c?te.bought:c.fromAny(te.bought??0)).isZero?.()||(nn(),this.update());return}}}}let{bought:ye}=this.adapter.buyMax(he);if(!(ye instanceof c?ye:c.fromAny(ye??0)).isZero?.()){if(nn(),Jc(ie.upgMeta,this.mode))try{il(["reset"])}catch{}this.update()}return}}ie.upgMeta&&fE(ie.upgMeta,this.mode)}),i.addEventListener("contextmenu",Q=>{if(Je)return;let ie=Q.currentTarget;if(ie.dataset.locked==="1"||(Q.preventDefault(),Q.stopPropagation(),!ie.upgMeta))return;if(this.adapter.getUiModel(ie.upgMeta.id)?.hmReadyToEvolve){let{evolved:ye}=this.adapter.evolve(ie.upgMeta.id);ye&&(Xy(),this.update());return}let{bought:Re}=this.adapter.buyMax(ie.upgMeta.id);if(!(Re instanceof c?Re:c.fromAny(Re??0)).isZero?.()){if(nn(),Jc(ie.upgMeta,this.mode))try{il(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let h=s?c.fromInt(0):lE(r.meta,r.levelNumeric,r.level),m=h instanceof c?h:c.fromAny(h),y=ne(r.level),g=eu(y),v=ne(m),E=eu(v),C=!m.isZero?.(),A=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,N=Number.isFinite(A)?Math.max(0,Math.floor(A)):1/0,X=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,B=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(N)&&Number.isFinite(X)?X>=N:!1,G=Number.isFinite(N)&&N===1,_=!!r.meta?.unlockUpgrade,U=!s&&_&&!B,M=!s&&_&&!U&&B,L,V,J=!1,se=!1;if(s){L="",V="";let K=u?(r.lockState?.reason||"").trim():"",ce=K?`${r.title} (Locked, ${K})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ce)}else{if(U||M)L=U?"Unlockable":"Unlocked",V=L,se=!0;else if(!s&&G&&!_)B?(L="Owned",V="Owned"):C?(L="Purchasable",V="Purchasable"):(L="Not Owned",V="Not Owned"),se=!0;else{let K=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ce=String(g||"").replace(/,/g,""),pe=/|Infinity/i.test(ce),Q=Number.isFinite(K)?K>=1e3:pe||/^\d{4,}$/.test(ce);J=C&&Q,J?(L=`<span class="badge-lvl">${y}</span><span class="badge-plus">(+${v})</span>`,V=`${g} (+${E})`):(L=C?`${y} (+${v})`:y,V=C?`${g} (+${E})`:g)}i.setAttribute("aria-label",`${r.title}, ${V}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let de=i.firstElementChild,ge=de.querySelector(".base"),Te=de.querySelector(".icon"),Ce=r.meta?.costType||"coins",z=r.useLockedBase||s?Zw:r.baseIconOverride||Py[Ce]||Py.coins;ge.src!==z&&(ge.src=z);let $=r.icon;if(!$)Te.hidden||(Te.hidden=!0);else{Te.hidden&&(Te.hidden=!1);let K=$;Te._lastSrc!==K&&(Te.src=K,Te._lastSrc=K)}let q=de.querySelector(".maxed-overlay"),j=!s&&$y(r.meta),Y=!s&&B;if(Y||!s&&!B&&!p&&j){q||(q=document.createElement("img"),q.className="maxed-overlay",q.alt="",de.insertBefore(q,Te));let K=Y?Jw:Qw;q.src!==K&&(q.src=K)}else q&&q.remove();let x=de.querySelector(".level-badge");s?x&&x.remove():(x||(x=document.createElement("span"),x.className="level-badge",de.appendChild(x)),x.className="level-badge",se&&x.classList.add("text-badge"),J&&x.classList.add("two-line"),(C||U)&&x.classList.add("can-buy"),B&&x.classList.add("is-maxed"),L===V?x.textContent!==L&&(x.textContent=L):x.innerHTML!==L&&(x.innerHTML=L))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),Es(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&io(a)||(Or(),_y())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(Je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{Je&&Mn(80),this.close()},{passive:!0}),hd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&Ay(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,Je)try{setTimeout(()=>Eo(240),120)}catch{}Mn(10),Es(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||!t&&el()||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}};typeof window<"u"&&window.addEventListener("menu:scrollStop",()=>{tr(!0)});tu={standard:new al("standard"),automation:new al("automation"),dna:new al("dna")};on=null,ct=null,nu=!1,Qc=null});var Ky={};vt(Ky,{applyHudLayout:()=>nr,initHudButtons:()=>pE,isMapUnlocked:()=>lp,isShopUnlocked:()=>ap,lockMap:()=>lu,lockShop:()=>au,unlockMap:()=>su,unlockShop:()=>Si});function sp(e){let t=b();return t==null?e:`${e}:${t}`}function Os(e){let t=sp(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function ap(){return cp(),Os(mo.SHOP)}function lp(){return cp(),Os(mo.MAP)}function iu(e,t){let n=t?"1":"0",o=sp(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function cp(){for(let e of Object.values(mo)){let t=sp(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function To(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function ip(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",Yi())}function dE(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function nr(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=dE(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(h=>e.querySelector(`.game-btn[data-btn="${h}"]`)).filter(Boolean),a=[...e.children].filter(h=>!l.includes(h)),u=[...l,...a];if(u.length&&u.some((h,m)=>e.children[m]!==h)){let h=document.createDocumentFragment();u.forEach(m=>h.appendChild(m)),e.appendChild(h)}let p=[...e.querySelectorAll(".game-btn")].filter(h=>!h.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(h=>{h.style.gridColumn="",h.style.gridRow="",h.classList.remove("span-2"),h.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let h=getComputedStyle(e),m=parseFloat(h.columnGap||h.gap||"0")||0,y=e.clientWidth,g=Math.max(180,Math.floor((y-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let h=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),y=e.querySelector('[data-btn="shop"]:not([hidden])');h&&m&&y&&(h.style.gridColumn="1",h.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",y.style.gridColumn="1 / -1",y.style.gridRow="2")}}function pE(){if(cp(),To("help",!0),To("stats",!0),To("shop",Os(mo.SHOP)),To("map",Os(mo.MAP)),ip(),nr(),Wy||(Wy=!0,window.addEventListener("resize",nr),window.addEventListener("orientationchange",nr),window.addEventListener("saveSlot:change",()=>{To("shop",Os(mo.SHOP)),To("map",Os(mo.MAP)),ip(),nr()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||ip()})),!zy){zy=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&Is()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&io(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function Si(){iu(mo.SHOP,!0),To("shop",!0),nr()}function su(){iu(mo.MAP,!0),To("map",!0),nr()}function au(){iu(mo.SHOP,!1),To("shop",!1),nr()}function lu(){iu(mo.MAP,!1),To("map",!1),nr()}var mo,Wy,zy,cu=De(()=>{ci();St();ns();mo={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Wy=!1,zy=!1});function jy(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(K=>K.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let x=0;x<t;x++)d[x*f+2]=1/0;let p=new Int16Array(t),h=t;for(let x=0;x<t;x++)p[x]=t-1-x;let m=-1,y=document.createElement("canvas");y.className="cursor-trail-canvas",Object.assign(y.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(y);let g=y.getContext("2d",{alpha:!0,desynchronized:!0}),v=document.createElement("canvas");v.width=a,v.height=a;let E=v.getContext("2d");E.shadowColor="#FFEB3B",E.shadowBlur=l,E.fillStyle="#FFEB3B",E.beginPath(),E.arc(u,u,s,0,Math.PI*2),E.fill();let C=!1,A=null,N=null,X={left:0,top:0,width:0,height:0},B=1,G=!1,_=0,U=0,M=!1,L=null,V=[],J=()=>{if(G)return;let x=document.documentElement.clientWidth,K=document.documentElement.clientHeight;X={left:0,top:0,width:x,height:K,right:x,bottom:K,x:0,y:0}},se=()=>{if(G)return;J();let x=Math.min(window.devicePixelRatio||1,2);B=X.width>0?Math.min(x,512/X.width):x,y.width=X.width*B,y.height=X.height*B,g.scale(B,B),L=null},de=null;typeof ResizeObserver<"u"&&(de=new ResizeObserver(()=>{se()}),de.observe(e));let ge=(x,K)=>{if(h<=0)return;let ce=p[--h];ce>m&&(m=ce);let pe=ce*f;d[pe]=x,d[pe+1]=K,d[pe+2]=0,d[pe+3]=n},Te=(x,K,ce)=>{if(A===null||N===null)ce.count<r&&(ge(x,K),ce.count++);else{let pe=x-A,Q=K-N,ie=Math.hypot(pe,Q);if(ie>=o){let he=Math.floor(ie/o);for(let Re=1;Re<=he&&!(ce.count>=r);Re++){let oe=Re*o/ie;ge(A+pe*oe,N+Q*oe),ce.count++}}ce.count<r&&(ge(x,K),ce.count++)}A=x,N=K},Ce=x=>{if(G)return;_||(U=0,_=requestAnimationFrame(z)),X.width||J();let K=0,ce=0,pe=(Q,ie)=>Q>=0&&Q<=X.width&&ie>=0&&ie<=X.height;if(x.getCoalescedEvents){let Q=x.getCoalescedEvents();if(Q.length>0)for(let ie of Q){let he=ie.clientX-K,Re=ie.clientY-ce;V.push({x:he,y:Re,inside:pe(he,Re)})}else{let ie=x.clientX-K,he=x.clientY-ce;V.push({x:ie,y:he,inside:pe(ie,he)})}}else{let Q=x.clientX-K,ie=x.clientY-ce;V.push({x:Q,y:ie,inside:pe(Q,ie)})}},F=()=>{C=!1,A=null,N=null,V.length=0},z=()=>{if(G)return;let x=performance.now();U||(U=x);let K=x-U;U=x,K>100&&(K=100);let ce={count:0};if(V.length>0){for(let Be of V)Be.inside?(C=!0,Te(Be.x,Be.y,ce)):(C=!1,A=null,N=null);let ye=V[V.length-1];ye.inside&&(A!==ye.x||N!==ye.y)&&(ge(ye.x,ye.y),A=ye.x,N=ye.y),V.length=0}else C&&A!==null&&N!==null&&ge(A,N);let pe=t-h;if(pe===0&&!M){_=0;return}L?g.clearRect(L.x,L.y,L.w,L.h):g.clearRect(0,0,X.width,X.height),M=!1;let Q=1/0,ie=1/0,he=-1/0,Re=-1/0,oe=-1;if(pe>0)for(let ye=0;ye<=m;ye++){let Be=ye*f,Pe=d[Be+2];if(Pe>=d[Be+3])continue;if(Pe+=K,d[Be+2]=Pe,Pe>=d[Be+3]){p[h++]=ye;continue}oe=ye;let Oe=d[Be+3],ae=Pe/Oe,ee=1-ae,Ie=1-.4*ae;M=!0,g.globalAlpha=ee;let w=a*Ie,W=w/2,Z=d[Be],te=d[Be+1],me=Math.round(Z-W),le=Math.round(te-W),Ye=Math.round(w);g.drawImage(v,me,le,Ye,Ye),me<Q&&(Q=me),le<ie&&(ie=le);let nt=me+Ye,ve=le+Ye;nt>he&&(he=nt),ve>Re&&(Re=ve)}m=oe,Q!==1/0?(Q-=2,ie-=2,he+=2,Re+=2,L={x:Q,y:ie,w:he-Q,h:Re-ie}):L=null,_=requestAnimationFrame(z)};window.addEventListener("resize",se),window.addEventListener("scroll",J,{passive:!0}),window.addEventListener("focus",J,{passive:!0}),document.addEventListener("visibilitychange",J,{passive:!0});let $={passive:!0},q=x=>{J(),Ce(x)},j=x=>{J(),Ce(x)};e.addEventListener("pointermove",Ce,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",q,$),e.addEventListener("pointerleave",F,$),e.addEventListener("pointercancel",F,$),se(),_=requestAnimationFrame(z);let Y=setInterval(J,1e3);return{destroy:()=>{G=!0,_&&cancelAnimationFrame(_),Y&&clearInterval(Y),de&&(de.disconnect(),de=null);try{window.removeEventListener("resize",se)}catch{}try{window.removeEventListener("scroll",J)}catch{}try{window.removeEventListener("focus",J)}catch{}try{document.removeEventListener("visibilitychange",J)}catch{}try{e.removeEventListener("pointermove",Ce),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",q),e.removeEventListener("pointerleave",F),e.removeEventListener("pointercancel",F)}catch{}y.remove()}}}var Zy=De(()=>{});var lv={};vt(lv,{clearPendingGains:()=>bp,getPassiveCoinReward:()=>$c,initCoinPickup:()=>wE,setCoinMultiplier:()=>yE,triggerPassiveCollect:()=>xd});function Jy(e){if(!e||typeof e!="object"){fl=!1,uu=!1,fu="0",Ei.clear();return}fl=!!e.unlocked,uu=!!e.level?.isInfinite?.();try{fu=e.level?.toPlainIntegerString?.()??"0"}catch{fu="0"}fl?uu&&Ei.clear():Ei.clear()}function mE(){if(typeof Ii=="function")try{Ii()}catch{}try{Jy(mt())}catch{fl=!1,Ei.clear()}try{Ii=xi(e=>{Jy(e)})}catch{Ii=null}}function yE(e){gE=e;try{O.coins?.mult?.set&&O.coins.mult.set(e)}catch{}}function pp(){try{let e=Lc();e instanceof c?Bs=e.clone?.()??e:e!=null?Bs=c.fromAny(e):Bs=c.fromInt(1)}catch{Bs=c.fromInt(1)}}function vE(){Qy||(Qy=!0,pp(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",pp),typeof window<"u"&&window.addEventListener("saveSlot:change",pp))}function bE(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return yp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function gp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*SE:0}function IE({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,p=0,h=null,m=null,y=gp(),g=0,v=0,E=0,C=!1,A=null,N=null,X=()=>{if(C)return;let $=document.documentElement.clientWidth,q=document.documentElement.clientHeight;A={left:0,top:0,width:$,height:q,right:$,bottom:q,x:0,y:0}},B=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",h=null,m=null},G=()=>{if(!l||v<=0){B();return}let $=v*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${d-v}px, ${p-v}px, 0)`,s.classList.add("is-visible")},_=()=>{if(!(!l||v<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=v+mp,q=[];if(typeof i.findCoinTargetsInPath=="function"&&h!==null&&m!==null?q=i.findCoinTargetsInPath(h,m,d,p,$):q=i.findCoinTargetsInRadius(d,p,$),h=d,m=p,q&&q.length>0)if(typeof r=="function"){let j=[];for(let Y=0;Y<q.length;Y++){let re=q[Y],x={coin:re};re.el&&i.getCoinTransform&&(x.opts={transform:i.getCoinTransform(re.el)}),j.push(x)}r(j)}else for(let j=0;j<q.length;j++){let Y=q[j],re=i.ensureCoinVisual?i.ensureCoinVisual(Y):Y.el;if(re){let x=i.getCoinTransform?i.getCoinTransform(re):re.style.transform||"";o(re,{transform:x})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=v+mp,q=i.findCoinsInRadius(d,p,$);if(h=d,m=p,q&&q.length>0){let j=[];for(let Y=0;Y<q.length;Y++){let re=q[Y],x=i.getCoinTransform?i.getCoinTransform(re):re.style.transform;j.push({el:re,opts:{transform:x}})}typeof r=="function"&&r(j)}}else{let $=t.children,q=v+mp,j=[];for(let Y=$.length-1;Y>=0;Y--){let re=$[Y];if(re.dataset.collected==="1"||!re.matches(n))continue;let x=re.getBoundingClientRect(),K=x.left+x.width/2,ce=x.top+x.height/2,pe=K-u,Q=ce-f;Math.hypot(pe,Q)<=q&&j.push(re)}if(!j.length)return;if(typeof r=="function"){let Y=[];for(let re=0;re<j.length;re++){let x=j[re],K=window.getComputedStyle(x);Y.push({el:x,opts:{transform:K.transform}})}r(Y)}else{let Y=[];for(let re=0;re<j.length;re++){let x=j[re],K=window.getComputedStyle(x);Y.push(K.transform)}for(let re=0;re<j.length;re++)o(j[re],{transform:Y[re]})}}},U=()=>{E=0,G(),!(!l||v<=0||C)&&(_(),M())},M=()=>{!l||v<=0||E||C||(E=requestAnimationFrame(U))},L=$=>{if(!$||C||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,f=$.clientY,A||X();let q=A;d=u,p=f,l=d>=0&&d<=q.width&&p>=0&&p<=q.height,M()},V=()=>{l=!1,B(),h=null,m=null},J=()=>{h=null,m=null},se=()=>{g=_c(),v=g*y,G(),M()},de=()=>{if(!(C||!a)){if(X(),A){let $=A;d=u-$.left,p=f-$.top,l=d>=0&&d<=$.width&&p>=0&&p<=$.height}M()}},ge=()=>{if(y=gp(),v=g*y,X(),a&&A){let $=A;d=u-$.left,p=f-$.top,l=d>=0&&d<=$.width&&p>=0&&p<=$.height}M()},Te=$=>{X(),L($)},Ce=$=>{J(),Te($)},F=()=>{C=!0,E&&(cancelAnimationFrame(E),E=0),N&&clearInterval(N);try{window.removeEventListener("scroll",de)}catch{}try{window.removeEventListener("resize",ge)}catch{}try{window.removeEventListener("saveSlot:change",se)}catch{}try{document.removeEventListener("ccc:upgrades:changed",se)}catch{}try{e.removeEventListener("pointermove",L)}catch{}try{e.removeEventListener("pointerdown",Te)}catch{}try{e.removeEventListener("pointerenter",Ce)}catch{}try{e.removeEventListener("pointerleave",V)}catch{}try{e.removeEventListener("pointercancel",V)}catch{}try{window.removeEventListener("blur",J)}catch{}try{s.remove()}catch{}},z={passive:!0};return e.addEventListener("pointermove",L,z),e.addEventListener("pointerdown",Te,z),e.addEventListener("pointerenter",Ce,z),e.addEventListener("pointerleave",V,z),e.addEventListener("pointercancel",V,z),window.addEventListener("resize",ge),window.addEventListener("scroll",de,{passive:!0}),window.addEventListener("focus",X,{passive:!0}),window.addEventListener("blur",J,{passive:!0}),document.addEventListener("visibilitychange",()=>{X(),document.hidden&&J()},{passive:!0}),window.addEventListener("saveSlot:change",se),document.addEventListener("ccc:upgrades:changed",se),N=setInterval(X,1e3),se(),{destroy:F}}function bp(){dl=null,pl=null,ml=null}function av(e){let t=yp.clone?.()??c.fromInt(1),n=iv(t),o=ho(ev),i=sv(e??fu);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Ao=="function"&&Ao()?ho(Bs):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function $c(){let{coinGain:e,xpGain:t,mpGain:n}=av(null);return{coins:e,xp:t,mp:n}}function xd(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=av(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=$n(ke.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{kn=kn?.add?kn.add(r):ho(r)}catch{kn=ho(r)}ul(),a||tv(r);let u=typeof fn=="function"?fn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&nv(i),s.isZero?.()||ov(s)}function wE({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){up?.destroy&&up.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};mE(),vE(),a.style.touchAction="none";let d=null,p=null;kn=O.coins.value,hp=()=>{let x=ne(kn);x.includes("<span")?f.innerHTML=x:f.textContent=x},rv(),ul();let h=x=>{x?.detail&&x.detail.key==="coins"&&(kn=x.detail.value,ul())};window.addEventListener("currency:change",h);let m=x=>{if(!(!x?.detail||x.detail.key!=="coins"))try{let{mult:K}=x.detail;K instanceof c?Zn=K.clone?.()??K:K!=null?Zn=c.fromAny(K):Zn=c.fromInt(1),wi=!!Zn?.isInfinite?.()}catch{Zn=null,wi=!1}};window.addEventListener("currency:multiplier",m);let y=b();if(y==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${y}`,v=`ccc:unlock:shop:progress:${y}`,E=localStorage.getItem("ccc:unlock:shop:progress"),C=localStorage.getItem("ccc:unlock:shop");E!=null&&localStorage.getItem(v)==null&&localStorage.setItem(v,E),C!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,C),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let x=parseInt(localStorage.getItem(v)||"0",10);if(localStorage.setItem(v,String(x)),x>=10&&localStorage.getItem(g)!=="1"){try{Si()}catch{}localStorage.setItem(g,"1")}}let A=new URL(i,document.baseURI).href,N=x=>x instanceof HTMLElement?x._coinObj?!x._coinObj.isRemoved&&x.dataset.collected!=="1":x.dataset.collected!=="1"&&x.matches(r):!1;function X(x){try{x.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(X);let B=Je?.12:.3,G=0;function _(x=A){if(x===A){let K=performance.now();if(K-G<40)return;G=K}ht(x,{volume:B})}function U(x,K={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(x);let ce=()=>{x&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(x):x.remove())};if(l||Je){ce();return}let pe="translate3d(0,0,0)";K.transform?K.transform!=="none"&&(pe=K.transform):pe=x.style.transform||"translate3d(0,0,0)",x.style.setProperty("--ccc-start",pe),x.classList.add("coin--collected");let Q=!1,ie=()=>{Q||(Q=!0,x.removeEventListener("animationend",ie),ce())};x.addEventListener("animationend",ie),setTimeout(ie,600)}function M(x){if(!x||!x.length)return;let K=A,ce=-1,pe=!1;for(let ae of x){let ee=ae.coin||ae.el&&ae.el._coinObj;ee&&(ee.sizeIndex!==void 0?ee.sizeIndex>ce&&(ce=ee.sizeIndex,ee.soundSrc&&(K=ee.soundSrc,pe=!0)):ee.soundSrc&&!pe&&(K=ee.soundSrc,pe=!0))}_(K);let Q=null,ie=null,he=null,Re=0,oe=$n(ke.COINS),ye=typeof fn=="function"?fn():!0,Be=typeof Ao=="function"&&Ao(),Pe=15,Oe=0;for(let ae of x){let ee=ae.el,Ie=ae.coin;if(!Ie&&ee&&ee._coinObj&&(Ie=ee._coinObj),ee&&!N(ee)||Ie&&Ie.isRemoved)continue;Re++,ee&&(ee.dataset.collected="1"),Oe<Pe?(!ee&&Ie&&e&&e.ensureCoinVisual&&(ee=e.ensureCoinVisual(Ie),ee&&(ee.dataset.collected="1")),ee?(U(ee,ae.opts||{}),Oe++):Ie&&e&&e.removeCoinTarget&&e.removeCoinTarget(Ie)):Ie&&e&&e.removeCoinTarget?e.removeCoinTarget(Ie):ee&&(e&&e.detachCoin&&e.detachCoin(ee),e&&e.recycleCoin?e.recycleCoin(ee):ee.remove());let w=ee?bE(ee):yp,W=Ie?.mutationLevel??(ee?.dataset?.mutationLevel||null),Z=iv(w),te=ho(ev),me=ho(Bs);if(Ie&&Ie.valueMultiplier&&Ie.valueMultiplier>1){try{Z=Z.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{te=te.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{me=me.mulDecimalFloor(Ie.valueMultiplier)}catch{}}let le=sv(W);if(le){try{Z=Z.mulBigNumInteger(le)}catch{}try{te=te.mulBigNumInteger(le)}catch{}}oe||(Q=Fs(Q,Z)),ye&&(ie=Fs(ie,te)),Be&&(he=Fs(he,me))}if(Re!==0){if(Q&&!Q.isZero?.()){try{kn=kn?.add?kn.add(Q):ho(Q)}catch{kn=ho(Q)}tv(Q),ul()}if(ie&&!ie.isZero?.()&&nv(ie),he&&!he.isZero?.()&&ov(he),localStorage.getItem(g)!=="1"){let ee=parseInt(localStorage.getItem(v)||"0",10)+Re;if(localStorage.setItem(v,String(ee)),ee>=10){try{Si()}catch{}localStorage.setItem(g,"1")}}}}function L(x,K={}){return M([{el:x,opts:K}]),!0}d=IE({playfield:a,coinsLayer:u,coinSelector:r,collectFn:L,collectBatchFn:M,spawner:e}),p=jy(a);let V=x=>{if(x.target===u)return;let K=x.target.closest(r);if(K&&N(K)){let ce={};e&&typeof e.getCoinTransform=="function"&&(ce.transform=e.getCoinTransform(K)),L(K,ce)}};u.addEventListener("pointerdown",V,{passive:!0}),Je||u.addEventListener("mouseover",V,{passive:!0});let J=25,se=null,de=()=>{let x=document.documentElement.clientWidth,K=document.documentElement.clientHeight;se={left:0,top:0,width:x,height:K,right:x,bottom:K,x:0,y:0}};window.addEventListener("resize",de),window.addEventListener("scroll",de,{passive:!0}),de();let ge=null,Te=null,Ce=()=>{ge=null,Te=null};a.addEventListener("pointerleave",Ce,{passive:!0}),a.addEventListener("pointerenter",Ce,{passive:!0}),window.addEventListener("blur",Ce,{passive:!0});function F(x,K){if(e&&typeof e.findCoinTargetsInRadius=="function"){se||de();let ce=x,pe=K,Q=[];if(typeof e.findCoinTargetsInPath=="function"&&ge!==null&&Te!==null?Q=e.findCoinTargetsInPath(ge,Te,ce,pe,J,!0):Q=e.findCoinTargetsInRadius(ce,pe,J,!0),ge=ce,Te=pe,Q&&Q.length>0){let ie=[];for(let he=0;he<Q.length;he++){let Re=Q[he],oe={coin:Re};Re.el&&e.getCoinTransform&&(oe.opts={transform:e.getCoinTransform(Re.el)}),ie.push(oe)}M(ie)}}else if(e&&typeof e.findCoinsInRadius=="function"){se||de();let ce=x,pe=K,Q=e.findCoinsInRadius(ce,pe,J);if(ge=ce,Te=pe,Q&&Q.length>0){let ie=[];for(let he of Q){let Re=e.getCoinTransform?e.getCoinTransform(he):he.style.transform;ie.push({el:he,opts:{transform:Re}})}M(ie)}}else{let ce=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],pe=new Set;for(let Q=0;Q<ce.length;Q++){let ie=x+ce[Q][0],he=K+ce[Q][1],Re=document.elementsFromPoint(ie,he);for(let oe=0;oe<Re.length;oe++){let ye=Re[oe];N(ye)&&!pe.has(ye)&&pe.add(ye)}}if(pe.size>0){let Q=[];pe.forEach(ie=>Q.push({el:ie})),M(Q)}}}let z=null,$=!1;function q(x,K){z={x,y:K},$||($=!0,requestAnimationFrame(()=>{z&&(F(z.x,z.y),z=null),$=!1}))}a.addEventListener("pointerdown",x=>{q(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointermove",x=>{x.pointerType!=="mouse"&&q(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointerup",x=>{x.pointerType!=="mouse"&&q(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("mousemove",x=>{q(x.clientX,x.clientY)},{passive:!0});function j(x){}let Y=setInterval(de,1e3),re=()=>{if(clearInterval(Y),du(),hp=()=>{},typeof window<"u"&&(window.removeEventListener("resize",de),window.removeEventListener("beforeunload",du),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",h),window.removeEventListener("blur",Ce)),typeof Ii=="function"){try{Ii()}catch{}Ii=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",V),Je||u.removeEventListener("mouseover",V)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(x=>a.replaceWith(a.cloneNode(!0)))}catch{}};return up={destroy:re},{get count(){return kn},set count(x){kn=c.fromAny?c.fromAny(x):c.fromInt(Number(x)||0),ul()},setMobileVolume:j,destroy:re,collectBatch:M,getMagnetUnitPx:gp}}var fl,uu,fu,Ii,up,ev,yp,hE,Ps,Ei,gE,Bs,Qy,dl,pl,ml,fp,kn,hp,dp,ul,SE,mp,ho,Fs,du,vp,tv,nv,ov,Zn,wi,rv,iv,sv,Ha=De(()=>{St();Et();Yt();cu();Vn();co();Co();lo();Zy();Dn();fl=!1,uu=!1,fu="0",Ii=null;up=null,ev=c.fromInt(1),yp=c.fromInt(1),hE=c.fromInt(1);try{Ps=c.fromAny("Infinity")}catch{Ps=null}Ei=new Map,gE="1",Bs=c.fromInt(1),Qy=!1,dl=null,pl=null,ml=null,fp=!1,kn=null,hp=()=>{},dp=!1,ul=()=>{dp||(dp=!0,requestAnimationFrame(()=>{dp=!1,hp()}))};SE=.05,mp=8;ho=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Fs=(e,t)=>{if(!t)return e;if(!e)return ho(t);try{return e.add(t)}catch{try{return ho(e).add(t)}catch{return ho(t)}}},du=()=>{let e=dl;if(dl=null,e&&!e.isZero?.())try{O.coins.add(e)}catch{}let t=pl;if(pl=null,t&&!t.isZero?.())try{Qi(t)}catch{}let n=ml;if(ml=null,n&&!n.isZero?.())try{xs(n)}catch{}},vp=()=>{fp||(fp=!0,requestAnimationFrame(()=>{fp=!1,du()}))},tv=e=>{dl=Fs(dl,e),vp()},nv=e=>{pl=Fs(pl,e),vp()},ov=e=>{ml=Fs(ml,e),vp()};typeof window<"u"&&window.addEventListener("beforeunload",du,{passive:!0});Zn=null,wi=!1,rv=()=>{try{let e=O?.coins?.mult;if(!e||typeof e.get!="function"){Zn=null,wi=!1;return}let t=e.get();if(!t){Zn=c.fromInt(1),wi=!1;return}Zn=t.clone?.()??c.fromAny(t),wi=!!Zn?.isInfinite?.()}catch{Zn=null,wi=!1}},iv=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Zn||rv();let n=Zn;if(!n)try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(wi||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},sv=e=>{if(!fl)return null;if(uu){if(Ps)try{return Ps.clone?.()??Ps}catch{return Ps}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=Ei.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{Ei.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=Us(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(hE)===0,s=r.clone?.()??r;if(Ei.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function EE(e){if(e==null)return 0;try{let t=localStorage.getItem(uv(e));return t?parseInt(t,10):0}catch{return 0}}function xE(e,t){if(e!=null)try{localStorage.setItem(uv(e),t.toString())}catch{}}function LE(e){if(e==null)return 0;try{let t=localStorage.getItem(fv(e));return t?parseInt(t,10):0}catch{return 0}}function _E(e,t){if(e!=null)try{localStorage.setItem(fv(e),t.toString())}catch{}}function CE(e){if(e==null)return 0;try{let t=localStorage.getItem(dv(e));return t?parseInt(t,10):0}catch{return 0}}function ME(e,t){if(e!=null)try{localStorage.setItem(dv(e),t.toString())}catch{}}function pv(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let p=Number(e.toString());isNaN(p)||(t=p),(e==="Infinity"||p===1/0)&&(n=!0)}catch{}let o=b(),r=EE(o),i=r;i<1&&n&&(i=1),i<2&&ut(4)>=1&&(i=2),i!==r&&(r=i,xE(o,r));let s=LE(o),l=s;l<1&&ut(4)>=1&&(l=1),l!==s&&(s=l,_E(o,s));let a=CE(o),u=a;u<1&&ut(4)>=1&&(u=1),u!==a&&(a=u,ME(o,a));let f=[],d=[];for(let p of cv){let h=p;if(n){h={...p,description:[...p.description]};let m=xn(),y=Lo(),g=m+y;if(g>1&&(g=1),p.id===1){let v=Math.pow(10,g),E=Fe(v);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${E}x</span>`)}else if(p.id===2){let v=Math.pow(10,g),E=Fe(v);h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${E}x</span>`)}else if(p.id===4){let v=Math.log10(4444e9),E=_e(v*g),C=ne(E);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${C}x</span>`)}}p.id===9&&(h===p&&(h={...p,description:[...p.description]}),r===0?h.description=["This milestone is hidden for now"]:r===1&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===10&&(h===p&&(h={...p,description:[...p.description]}),s===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===11&&(h===p&&(h={...p,description:[...p.description]}),a===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.surgeLevel<=t?f.push(h):d.push(h)}return[...f,...d.slice(0,2)]}var cv,Sp,uv,fv,dv,mv=De(()=>{Yt();Et();Et();Wn();li();St();cv=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${ne(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade","Makes each Workshop Level triple Gear production instead of doubling it"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]},{id:10,surgeLevel:10,description:["Unlocks new DNA upgrades"]},{id:11,surgeLevel:11,description:["Unlocks a new automation upgrade","Makes each Workshop Level quadruple Gear production instead of tripling it"]}],Sp=cv.filter(e=>e.affectedByTsunami).map(e=>e.id),uv=e=>`ccc:surge:milestone9:state:${e}`,fv=e=>`ccc:surge:milestone10:state:${e}`,dv=e=>`ccc:surge:milestone11:state:${e}`});function hv(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ht("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(w,W){w.style.position="absolute",w.style.left="50%";let Z="perspective(600px) rotateX(50deg) rotateZ(180deg)",te=!!o.xpHTML,me=!!o.mpHTML;W==="coin"?(w.style.top="77%",w.style.transform=`translateX(-50%) ${Z}`):te&&me?(w.style.top="72.5%",W==="mp"?w.style.transform=`translateX(calc(-100% - 44px)) ${Z}`:w.style.transform=`translateX(44px) ${Z}`):(W==="mp"?w.style.top="66%":W==="xp"&&(w.style.top="72%"),w.style.transform=`translateX(-50%) ${Z}`),w.style.transformOrigin="center center";let le=w.firstElementChild;le&&(le.removeAttribute("hidden"),le.style.display="flex")}if(o.coinHTML){let w=document.createElement("div");w.innerHTML=o.coinHTML,f(w,"coin"),u.appendChild(w)}if(o.xpHTML){let w=document.createElement("div");w.innerHTML=o.xpHTML,f(w,"xp"),u.appendChild(w)}if(o.mpHTML){let w=document.createElement("div");w.innerHTML=o.mpHTML,f(w,"mp"),u.appendChild(w)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let p=new Image;p.src="img/misc/merchant.webp";let h=!1;p.onload=()=>{h=!0},p.onerror=w=>{console.error("Tsunami: Merchant load failed",w)};let m,y,g=[],v=[],E=0;function C(){g=[],v=[];let w=y*.65,W=w+y*.15,te=300*(Math.min(m,y)*5e-4),me=m*.8,le=me-te*.6,Ye=me+te*.6;for(let dt=0;dt<100;dt++){let ln=Math.random()*m,Fn=W+Math.random()*(y-W);v.push({x:ln,y:Fn})}let nt=(dt,ln,Fn)=>{if(dt>m*.1&&dt<m*.9){let Ft=y-w,Sn=w+Ft*.15;if(ln>Sn)return!1}else if(Fn==="tree"){let Ft=y-w,Sn=w+Ft*.5;if(ln>Sn)return!1}return!(Fn==="tree"&&dt>le&&dt<Ye)},ve=(dt,ln,Fn,Ft,Sn)=>{for(let Vr=0;Vr<ln;Vr++){let Fo,Uo,fr=!1,Me=0;for(;!fr&&Me<50;){Sn?Fo=Sn():Fo=Math.random()*m;let S=y,k=Math.random();if(Uo=w+20+k*k*(S-w-20),nt(Fo,Uo,dt)&&(fr=!0,dt==="tree")){for(let R of g)if(R.type==="tree"){let T=R.x-Fo,P=R.y-Uo;if(Math.sqrt(T*T+P*P)<Math.max(m*.08,100)){fr=!1;break}}}Me++}if(fr){let k=.6+(Uo-w)/(y-w)*.6,R=(Fn+Math.random()*Ft)*k;g.push({type:dt,x:Fo,y:Uo,scale:R})}}},qe=3+Math.floor(Math.random()*3);ve("tree",qe,.8,.4,()=>Math.random()*(m*.1)),ve("tree",qe,.8,.4,()=>m*.9+Math.random()*(m*.1));let Gt=5+Math.floor(Math.random()*3);ve("tree",Gt,.8,.4,()=>m*.1+Math.random()*(m*.8)),ve("rock",20,.6,.4),ve("shell",30,.3,.3),g.sort((dt,ln)=>dt.y-ln.y)}let A=a.getContext("2d",{alpha:!1}),N=d.getContext("2d",{alpha:!0});function X(){let w=window.devicePixelRatio||1;m=window.innerWidth,y=window.innerHeight,a.width=m*w,a.height=y*w,a.style.width=m+"px",a.style.height=y+"px",d.width=m*w,d.height=y*w,d.style.width=m+"px",d.style.height=y+"px",A.scale(w,w),N.scale(w,w),C(),E=-50}window.addEventListener("resize",X),X();let B=Date.now(),G=!0,_,U=!1,M={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},L={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},V=!1,J=[],se=0,de=!1,ge=0,Te=5e3,Ce=!1,F=0,z=[],$=6;for(let w=0;w<$;w++)z.push({offset:Math.random()*1e3,speedBase:.001+w*5e-4,amplitudeBase:10+w*5});let q=[],j=400;function Y(w,W,Z){return w*(1-Z)+W*Z}function re(w){let W=parseInt(w.slice(1),16);return{r:W>>16&255,g:W>>8&255,b:W&255}}function x(w,W,Z){let te=re(w),me=re(W),le=Math.round(Y(te.r,me.r,Z)),Ye=Math.round(Y(te.g,me.g,Z)),nt=Math.round(Y(te.b,me.b,Z));return`rgb(${le},${Ye},${nt})`}function K(w,W,Z){let te=[],me=w,le=W,Ye=20;for(;le<Z;){let nt=me+(Math.random()-.5)*60,ve=le+Ye+Math.random()*30;te.push({x1:me,y1:le,x2:nt,y2:ve}),me=nt,le=ve}return te}function ce(w,W,Z,te,me,le){w.beginPath(),w.moveTo(W+le,Z),w.lineTo(W+te-le,Z),w.quadraticCurveTo(W+te,Z,W+te,Z+le),w.lineTo(W+te,Z+me-le),w.quadraticCurveTo(W+te,Z+me,W+te-le,Z+me),w.lineTo(W+le,Z+me),w.quadraticCurveTo(W,Z+me,W,Z+me-le),w.lineTo(W,Z+le),w.quadraticCurveTo(W,Z,W+le,Z),w.closePath()}function pe(w,W,Z,te,me){w.save(),w.translate(W,Z),w.scale(te,te),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(10,-40,-5,-80),w.lineTo(5,-80),w.quadraticCurveTo(20,-40,10,0),w.fillStyle=me.rock,w.fill(),w.translate(0,-80),w.fillStyle=me.leaf;for(let le=0;le<7;le++)w.save(),w.rotate(le/7*Math.PI*2-Math.PI/2),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(30,-10,60,0),w.quadraticCurveTo(30,10,0,0),w.fill(),w.restore();w.restore()}function Q(w,W,Z,te,me){w.save(),w.translate(W,Z),w.scale(te,te),w.fillStyle=me.rock,w.beginPath(),w.moveTo(-20,0),w.bezierCurveTo(-20,-15,-10,-25,0,-25),w.bezierCurveTo(10,-25,20,-15,20,0),w.fill(),w.fillStyle="rgba(0,0,0,0.2)",w.beginPath(),w.ellipse(0,0,20,5,0,0,Math.PI*2),w.fill(),w.restore()}function ie(w,W,Z,te,me){w.save(),w.translate(W,Z),w.scale(te,te),w.fillStyle=me.shell,w.beginPath(),w.arc(0,0,10,Math.PI,0),w.lineTo(0,0),w.fill(),w.strokeStyle=me.sandDark,w.lineWidth=1,w.beginPath();for(let le=1;le<5;le++){let Ye=Math.PI+le/5*Math.PI;w.moveTo(0,0),w.lineTo(Math.cos(Ye)*10,Math.sin(Ye)*10)}w.stroke(),w.restore()}function he(w,W,Z,te,me){w.fillStyle=me.sandDark,w.fillRect(-50,te,W+100,Z-te),w.fillStyle=me.sandDark,w.save(),w.fillStyle=me.sandLight,w.globalAlpha=.3,w.beginPath(),w.moveTo(-50,Z+100),w.lineTo(-50,te),w.bezierCurveTo(W*.3,te-20,W*.7,te+20,W+50,te),w.lineTo(W+50,Z+100),w.fill(),w.globalAlpha=.6;let le=te+Z*.05;w.beginPath(),w.moveTo(-50,Z+100),w.lineTo(-50,le),w.bezierCurveTo(W*.4,le+40,W*.6,le-10,W+50,le+20),w.lineTo(W+50,Z+100),w.fill(),w.globalAlpha=1;let Ye=te+Z*.15;w.beginPath(),w.moveTo(-50,Z+100),w.lineTo(-50,Ye),w.bezierCurveTo(W*.2,Ye-10,W*.8,Ye+30,W+50,Ye+10),w.lineTo(W+50,Z+100),w.fill(),w.fillStyle=me.sandDark,w.globalAlpha=.1,v.forEach(nt=>{w.fillRect(nt.x,nt.y,2,2)}),w.restore()}function Re(w,W,Z,te=null){let me=te||1,le=!!te&&te>5;V&&!le&&!Ce&&ht("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),J.push({x:le?W/2:Math.random()*W,y:le?Z/2:Math.random()*Z,radius:0,maxRadius:le?Math.max(W,Z)*1.5:(100+Math.random()*400)*me,speed:le?40:(5+Math.random()*15)*me,opacity:1,hue:225+Math.random()*15,life:1})}function oe(w,W,Z,te=.5,me=!0){let le=.1+te*.7,Ye=Math.floor(1+te*4);if(me&&!Ce){for(let nt=0;nt<Ye;nt++)if(J.length<50&&Math.random()<le){let ve=1+te*2;Re(w,W,Z,ve)}}w.save(),w.globalCompositeOperation="lighter";for(let nt=J.length-1;nt>=0;nt--){let ve=J[nt];if(ve.radius+=ve.speed,ve.opacity-=.015,ve.life-=.015,ve.opacity<=0||ve.radius>ve.maxRadius){J.splice(nt,1);continue}let qe=w.createRadialGradient(ve.x,ve.y,0,ve.x,ve.y,ve.radius),Gt=ve.opacity;qe.addColorStop(0,`hsla(${ve.hue}, 100%, 80%, ${Gt})`),qe.addColorStop(.3,`hsla(${ve.hue}, 100%, 40%, ${Gt*.9})`),qe.addColorStop(.7,`hsla(${ve.hue}, 100%, 15%, ${Gt*.6})`),qe.addColorStop(1,`hsla(${ve.hue}, 100%, 5%, 0)`),w.fillStyle=qe,w.beginPath(),w.arc(ve.x,ve.y,ve.radius,0,Math.PI*2),w.fill()}w.restore()}function ye(){if(!G)return;let w=Date.now(),W=w-B;Math.min(W/t,1)>=1&&!U&&(U=!0,r&&r.stop(),i&&i.stop(),n&&n());let te=5e3,me=6e3,le=5e4,Ye=5e4,nt=5e3,ve=4e4,qe=0;W<me?qe=0:W<le?qe=(W-me)/(le-me):qe=1;let Gt=0;W>ve&&(Gt=Math.max(0,(W-ve)/(le-ve))),W>le&&(Gt=1),Gt>.1&&!i&&(i=ht("sounds/tsu_rumble.ogg",{volume:.8}));let dt={skyTop:x(M.skyTop,L.skyTop,qe),skyBottom:x(M.skyBottom,L.skyBottom,qe),sun:x(M.sun,L.sun,qe),waterDeep:x(M.waterDeep,L.waterDeep,qe),waterMid:x(M.waterMid,L.waterMid,qe),waterPeak:x(M.waterPeak,L.waterPeak,qe),foam:x(M.foam,L.foam,qe),sandLight:x(M.sandLight,L.sandLight,qe),sandDark:x(M.sandDark,L.sandDark,qe),rock:x(M.rock,L.rock,qe),leaf:x(M.leaf,L.leaf,qe),shell:x(M.shell,L.shell,qe)},ln=0,Fn=0;if(qe>.5||Ce){let Me=(qe-.5)*2*5+Gt*25;F>0&&(Me+=50),ln=(Math.random()-.5)*Me,Fn=(Math.random()-.5)*Me}N.clearRect(0,0,m,y),A.save(),A.translate(ln,Fn),N.save(),N.translate(ln,Fn);let Ft=A.createLinearGradient(0,0,0,y);if(Ft.addColorStop(0,dt.skyTop),Ft.addColorStop(1,dt.skyBottom),A.fillStyle=Ft,A.fillRect(-50,-50,m+100,y+100),qe<1){let Me=y*.15+qe*50;A.beginPath(),A.arc(m*.7,Me,40,0,Math.PI*2),A.fillStyle=dt.sun,A.globalAlpha=1-qe,A.shadowColor=dt.sun,A.shadowBlur=20,A.fill(),A.globalAlpha=1,A.shadowBlur=0}let Sn=y*.65;if(h&&qe<1){A.save();let Me=Math.min(m,y)*5e-4,S=300*Me,k=300*Me,R=m*.8,T=k*.15,P=Sn-k/2+T;A.translate(R,P),A.rotate(.1),A.drawImage(p,-S/2,-k/2,S,k),A.restore()}if(he(A,m,y,Sn,dt),g.forEach(Me=>{Me.type==="tree"?pe(A,Me.x,Me.y,Me.scale,dt):Me.type==="rock"?Q(A,Me.x,Me.y,Me.scale,dt):Me.type==="shell"&&ie(A,Me.x,Me.y,Me.scale,dt)}),qe>.3){let Me=(qe-.3)/.7,S=Math.floor(j*Me);if(N.strokeStyle=`rgba(120, 180, 255, ${.1+Me*.3})`,N.lineWidth=1+Me,N.beginPath(),q.length<S)for(let R=0;R<10;R++)q.push({x:Math.random()*m*1.5,y:E,speed:20+Math.random()*20,len:10+Math.random()*20});let k=10+Me*20;for(let R=0;R<q.length;R++){let T=q[R];T.y+=T.speed,T.x-=k,N.moveTo(T.x,T.y),N.lineTo(T.x-k*.5,T.y+T.len),(T.y>y||T.x<-100)&&(R<S?(T.x=Math.random()*m*1.5,T.y=E):(q.splice(R,1),R--))}N.stroke()}let Vr=.3;if(qe>Vr){let Me=(qe-Vr)/(1-Vr),S=Y(0,y*1.5,Me*Me);N.fillStyle=dt.waterDeep,N.beginPath(),N.moveTo(-50,y+100),N.lineTo(-50,y-S*.3),N.bezierCurveTo(m*.3,y-S*.4,m*.6,y-S*1.2,m+50,y-S*.8),N.lineTo(m+50,y+100),N.fill()}let Fo=Y(0,y*.5,qe),Uo=Y(0,y*1.5,Gt*Gt),fr=y*.85-Fo-Uo;if(z.forEach((Me,S)=>{let k;S===$-1?k=dt.waterPeak:S%2===0?k=dt.waterDeep:k=dt.waterMid,N.fillStyle=k,N.beginPath();let R=Me.amplitudeBase*(1+qe*2+Gt*5),T=.003+qe*.005,P=Me.speedBase*(1+qe*5+Gt*10),ue=W*P+Me.offset,fe=S*15*(1-Gt),we=fr+fe;N.moveTo(-50,y+100),N.lineTo(-50,we);for(let xe=-50;xe<=m+50;xe+=15){let ze=we+Math.sin(xe*T+ue)*R+Math.cos(xe*T*2.3+ue)*(R*.5);N.lineTo(xe,ze)}if(N.lineTo(m+50,y+100),N.fill(),S===$-1||qe>.6&&S>$-3){N.save(),N.globalAlpha=.1+qe*.3,N.fillStyle=dt.foam,N.beginPath();for(let xe=-50;xe<=m+50;xe+=10){let ze=we+Math.sin(xe*T+ue)*R+Math.cos(xe*T*2.3+ue)*(R*.5);Math.random()>.5&&(ze-=5),xe===-50?N.moveTo(xe,ze):N.lineTo(xe,ze)}N.lineTo(m+50,y+100),N.lineTo(-50,y+100),N.fill(),N.restore()}}),W<te){let Me=1;W>1e3&&(Me=1-(W-1e3)/(te-1e3)),N.fillStyle=`rgba(0, 0, 0, ${Me})`,N.fillRect(-50,-50,m+100,y+100)}if(W>Ye){let Me=Math.min(1,(W-Ye)/nt);N.fillStyle=`rgba(0, 0, 0, ${Me})`,N.fillRect(-50,-50,m+100,y+100)}if(V){let Me=w-se,S=12e3,k=0,R=!0;Me<S?k=Me/S:(k=1,Ce||(Ce=!0,Re(N,m,y,25),F=60,l||(l=!0,ht("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),de&&(R=!1),oe(N,m,y,k,R)}if(de){let Me=w-ge,S=Math.min(1,Me/Te);N.fillStyle=`rgba(0, 0, 0, ${S})`,N.fillRect(-50,-50,m+100,y+100)}if(F>0){let Me=F/60,S=Me*Me;N.fillStyle=`rgba(255, 255, 255, ${S})`,N.fillRect(-50,-50,m+100,y+100),F--}A.restore(),N.restore(),_=requestAnimationFrame(ye)}function Be(){G=!1,e.style.cursor="",_&&cancelAnimationFrame(_),window.removeEventListener("resize",X),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function Pe(){V=!0,se=Date.now(),Ce=!1,F=0,s||(s=ht("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Oe(){de=!0,ge=Date.now(),s&&s.stop()}function ae(){e.style.cursor=""}function ee(){e.style.cursor="none"}function Ie(){s&&(s.stop(),s=null)}return ye(),{cleanup:Be,triggerBeacons:Pe,triggerFinalFade:Oe,showCursor:ae,hideCursor:ee,stopHumLoop:Ie}}var gv=De(()=>{Dn()});var e0={};vt(e0,{canPerformForgeReset:()=>zv,canPerformInfuseReset:()=>Kv,computeForgeGoldFromInputs:()=>Rv,computeInfuseMagicFromInputs:()=>Ov,computePendingDnaFromInputs:()=>Bv,computePendingForgeGold:()=>Wv,computeSurgeWavesFromInputs:()=>Pv,getCurrentSurgeLevel:()=>Kn,getForgeDebugOverrideState:()=>Dv,getInfuseDebugOverrideState:()=>qv,getSurgeBarLevelKey:()=>Ds,getSurgeDebugOverrideState:()=>Xv,hasDoneExperimentReset:()=>Yv,hasDoneForgeReset:()=>Rr,hasDoneInfuseReset:()=>$t,hasDoneSurgeReset:()=>Mo,initResetPanel:()=>tp,initResetSystem:()=>Vo,isExperimentUnlocked:()=>Il,isForgeUnlocked:()=>Ts,isInfuseUnlocked:()=>Lu,isSurgeUnlocked:()=>Br,onForgeUpgradeUnlocked:()=>jp,onInfuseUpgradeUnlocked:()=>Zp,onSurgeUpgradeUnlocked:()=>Jp,performForgeReset:()=>Yp,performInfuseReset:()=>Wp,performSurgeReset:()=>zp,recomputePendingMagic:()=>pn,setExperimentResetCompleted:()=>Up,setForgeDebugOverride:()=>$v,setForgeResetCompleted:()=>Pp,setInfuseDebugOverride:()=>Hv,setInfuseResetCompleted:()=>Bp,setInfuseUnlockedForDebug:()=>Gv,setSurgeResetCompleted:()=>Fp,setSurgeUnlockedForDebug:()=>Vv,shouldBlockBigCoins:()=>bl,updateResetPanel:()=>$e});function Mp(e){return!FE.includes(e)}function UE(){ht(RE,{volume:.4})}function DE(){ht(OE,{volume:.45})}function $E(){ht(PE,{volume:.5})}function qE(){ht(BE,{volume:.8})}function bl(){return Mv}function kv(){let e=An(),t=O.waves?.value??st(),n=0n;try{n=wl(e)}catch{}let o=I.pendingWaves,r=Kp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),Mv=i&&!dn()}function vl(){Ep=null}function Su(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function Iu(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function xp(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Tv(e=null){try{let t=Cd(),n=I.pendingGold.clone?.()??I.pendingGold;if(e){let o=e instanceof Mt?e:Mt.fromAny(e??1);if(o.isInfinite?.())return Mt.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=O.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return I.pendingGold}}function XE(){for(;Jn.length;){let e=Jn.pop();try{e?.()}catch{}}}function wp(){!Sv&&typeof Ql=="function"&&(Sv=Ql((e={})=>{e?.key&&e.key!==ke.COINS&&e.key!==ke.WAVES||e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(e?.key===ke.WAVES?(_u(),$e()):(mn(),pn(),Tn()))})),!Iv&&typeof uc=="function"&&(Iv=uc((e={})=>{e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(mn(),Tn(),No(),$e())}))}function Op(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ne(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Sl(){try{let e=rt();if(e&&e.xpLevel)return e.xpLevel}catch{}return st()}function Av(e,t){if(!e||typeof e!="object")return st();let n=Ne(e);if(!Number.isFinite(n)&&n>0)return Mt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return st();let r=_e(o*Math.log10(2)),i=Math.max(0,Op(t)),s=Math.max(0,(i-30)/5),l=s<=0?yv():_e(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?yv():_e(a*Math.log10(1.15)),f=Mt.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?st():d}function VE(e,t){if(!e)return st();let n=Ne(e);if(!Number.isFinite(n)&&n>0)return Mt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let h=Ne(t);Number.isFinite(h)&&(a=Math.max(0,h-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,p=r+u+f+d;return Number.isFinite(p)?_e(p).floorToInteger():Mt.fromAny("Infinity")}function Nv(e,t,n=null){let o=VE(e,t),r=Md(),i;if(n){let s=n instanceof Mt?n:Mt.fromAny(n??1);if(s.isInfinite?.())return Mt.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=O.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function Rv(e,t){return Av(e,t)}function Ov(e,t){return Nv(e,t)}function Pv(e,t,n,o,r){return Fv(e,t,n,o,r)}function Bv(e,t,n=null){e||(e=st()),t||(t=st());let o=.30103,r=0;if(n!==null?!!n:Ke(9)){let l=Lr();o=Math.log10(2+l),r=30*l}let s=o.toFixed(18);try{let l=e.mulDecimal(s,18),u=t.div(c.fromInt(20)).mulDecimal(s,18),f=l.add(u);r>0&&(f=f.add(c.fromAny(r)));let d=0;return f.isInfinite()?d=1/0:d=Number(f.toScientific(10)),_e(d).floorToInteger()}catch{return st()}}function Fv(e,t,n,o,r){let i=Op(e);if(i<201)return st();let s=(i-201)/35,l=Ne(t),a=Ne(n),u=Ne(o),f=Ne(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return Mt.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*pu),Number.isFinite(a)&&a>13&&(d+=(a-13)*pu),Number.isFinite(u)&&u>5&&(d+=(u-5)*pu),Number.isFinite(f)&&f>12&&(d+=(f-12)*pu);let p=1+d+s;return Number.isFinite(p)?_e(p).floorToInteger():Mt.fromAny("Infinity")}function Uv(){return Math.max(0,Op(Sl()))}function An(){if(I.slot!=null)return I.slot;let e=b();return I.slot=e,e}function Pp(e){let t=An();if(t!=null){I.hasDoneForgeReset=!!e;try{localStorage.setItem(kp(t),I.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function Bp(e){let t=An();if(t!=null){I.hasDoneInfuseReset=!!e;try{localStorage.setItem(Tp(t),I.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function Fp(e){let t=An();if(t!=null){I.hasDoneSurgeReset=!!e;try{localStorage.setItem(Ap(t),I.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Up(e){let t=An();if(t!=null){I.hasDoneExperimentReset=!!e;try{localStorage.setItem(Rp(t),I.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function xu(e=b()){if(e==null)return null;try{let t=localStorage.getItem(gl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Dv(e=b()){return xu(e)}function $v(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(I.forgeDebugOverride!==n){if(I.forgeDebugOverride=n,n==null)try{localStorage.removeItem(gl(t))}catch{}else try{localStorage.setItem(gl(t),n?"1":"0")}catch{}lt(gl(t)),Su(),$e()}}function Dp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(yl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function qv(e=b()){return Dp(e)}function Gv(e){$p(e)}function Hv(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(I.infuseDebugOverride!==n){if(I.infuseDebugOverride=n,n==null)try{localStorage.removeItem(yl(t))}catch{}else try{localStorage.setItem(yl(t),n?"1":"0")}catch{}lt(yl(t)),Iu(),$e()}}function $p(e){let t=An();if(t==null)return;let n=!!e;if(I.infuseUnlocked!==n){I.infuseUnlocked=n;try{localStorage.setItem(vu(t),I.infuseUnlocked?"1":"0")}catch{}lt(vu(t)),Iu()}}function wu(e){let t=An();if(t==null)return;let n=!!e;if(I.forgeUnlocked!==n){I.forgeUnlocked=n;try{localStorage.setItem(yu(t),I.forgeUnlocked?"1":"0")}catch{}lt(yu(t)),Su()}}function qp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Cv(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Xv(e=b()){return qp(e)}function Vv(e){Gp(e)}function Gp(e){let t=An();if(t==null)return;let n=!!e;if(I.surgeUnlocked!==n){I.surgeUnlocked=n;try{localStorage.setItem(bu(t),I.surgeUnlocked?"1":"0")}catch{}lt(bu(t)),xp()}}function Lp(e){if(e==null){I.forgeUnlocked=!1,I.forgeDebugOverride=null,I.hasDoneForgeReset=!1,I.infuseUnlocked=!1,I.infuseDebugOverride=null,I.hasDoneInfuseReset=!1,I.surgeUnlocked=!1,I.surgeDebugOverride=null,I.hasDoneSurgeReset=!1,I.hasDoneExperimentReset=!1,I.flagsPrimed=!1;return}try{I.forgeUnlocked=localStorage.getItem(yu(e))==="1"}catch{I.forgeUnlocked=!1}I.forgeDebugOverride=xu(e);try{I.hasDoneForgeReset=localStorage.getItem(kp(e))==="1"}catch{I.hasDoneForgeReset=!1}try{I.infuseUnlocked=localStorage.getItem(vu(e))==="1"}catch{I.infuseUnlocked=!1}try{I.hasDoneInfuseReset=localStorage.getItem(Tp(e))==="1"}catch{I.hasDoneInfuseReset=!1}I.infuseDebugOverride=Dp(e);try{I.surgeUnlocked=localStorage.getItem(bu(e))==="1"}catch{I.surgeUnlocked=!1}I.surgeDebugOverride=qp(e);try{I.hasDoneSurgeReset=localStorage.getItem(Ap(e))==="1"}catch{I.hasDoneSurgeReset=!1}try{I.hasDoneExperimentReset=localStorage.getItem(Rp(e))==="1"}catch{I.hasDoneExperimentReset=!1}I.flagsPrimed=!0}function go(){let e=b();if(e==null){I.flagsPrimed=!1;return}I.slot!==e&&(I.slot=e,vl(),I.flagsPrimed=!1),I.flagsPrimed||Lp(e)}function wv(e){vv!==e&&(XE(),vv=e,e!=null&&(Jn.push(kt(yu(e),{onChange(t){let n=t==="1";I.forgeUnlocked!==n&&(I.forgeUnlocked=n,Su(),$e())}})),Jn.push(kt(kp(e),{onChange(t){let n=t==="1";I.hasDoneForgeReset!==n&&(I.hasDoneForgeReset=n,$e())}})),Jn.push(kt(gl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.forgeDebugOverride!==n&&(I.forgeDebugOverride=n,Su(),$e())}})),Jn.push(kt(vu(e),{onChange(t){let n=t==="1";I.infuseUnlocked!==n&&(I.infuseUnlocked=n,Iu(),$e())}})),Jn.push(kt(Tp(e),{onChange(t){let n=t==="1";I.hasDoneInfuseReset!==n&&(I.hasDoneInfuseReset=n,$e())}})),Jn.push(kt(yl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.infuseDebugOverride!==n&&(I.infuseDebugOverride=n,Iu(),$e())}})),Jn.push(kt(bu(e),{onChange(t){let n=t==="1";I.surgeUnlocked!==n&&(I.surgeUnlocked=n,xp(),$e())}})),Jn.push(kt(Cv(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.surgeDebugOverride!==n&&(I.surgeDebugOverride=n,xp(),$e())}})),Jn.push(kt(Ap(e),{onChange(t){let n=t==="1";I.hasDoneSurgeReset!==n&&(I.hasDoneSurgeReset=n,$e())}})),Jn.push(kt(Rp(e),{onChange(t){let n=t==="1";I.hasDoneExperimentReset!==n&&(I.hasDoneExperimentReset=n,$e())}}))))}function YE(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function mn(e=!1){let t=O.coins?.value??st(),n=Sl(),o=YE(t,n);!e&&Ep===o||(Ep=o,Hp()?I.pendingGold=Av(t,n):I.pendingGold=st(),$e())}function pn(e=null){let t=O.coins?.value??st(),n=El();Xp()?I.pendingMagic=Nv(t,n,e):I.pendingMagic=st(),Tn(),$e()}function Tn(){if(!Br()){I.pendingWaves=st(),No();return}let e=Sl(),t=O.coins?.value??st(),n=O.gold?.value??st(),o=O.magic?.value??st(),r=El();I.pendingWaves=Fv(e,t,n,o,r),Mo()||I.pendingWaves.cmp(Mt.fromInt(10))>0&&(I.pendingWaves=Mt.fromInt(10)),No(),kv()}function No(){if(!Il()){I.pendingDna=st();return}let e=.30103,t=0;if(Ke(9)){let i=Lr();e=Math.log10(2+i),t=30*i}let n=e.toFixed(18),o=zt?zt():st(),r=Sl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),I.pendingDna=_e(u).floorToInteger()}catch{try{I.pendingDna=st()}catch{I.pendingDna=st()}}}function _p(){let e=xu();return e!=null?!!e:I.forgeUnlocked||Tt(Se.STARTER_COVE,Ee.UNLOCK_FORGE)>=1}function Hp(){try{let e=Sl();if(e&&typeof e.cmp=="function")return e.cmp(GE)>=0}catch{}return!1}function Xp(){try{let e=mt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(HE)>=0}catch{}return!1}function Ts(){go();let e=xu();return e!=null?!!e:!!I.forgeUnlocked||_p()}function Lu(){go();let e=Dp();return e!=null?!!e:!!I.infuseUnlocked}function Br(){go();let e=qp();return e!=null?!!e:!!I.surgeUnlocked}function Il(){return Ug()}function Kn(){let e=An();return e==null?0n:wl(e)}function Rr(){return go(),!!I.hasDoneForgeReset}function $t(){return go(),!!I.hasDoneInfuseReset}function Mo(){return go(),!!I.hasDoneSurgeReset}function Yv(){return go(),!!I.hasDoneExperimentReset}function Wv(){return mn(),I.pendingGold.clone?.()??I.pendingGold}function zv(){return!(!Ts()||!Hp()||I.pendingGold.isZero?.())}function Kv(){return!(!Lu()||!Xp()||I.pendingMagic.isZero?.())}function WE({resetGold:e=!1,resetMagic:t=!1}={}){let n=Ct(Se.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===Ee.UNLOCK_XP||r===Ee.UNLOCK_FORGE||r===Ee.UNLOCK_INFUSE||r===Ee.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||or(Se.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Vp({resetGold:e=!1,resetMagic:t=!1}={}){try{O.coins.set(0)}catch{}try{O.books.set(0)}catch{}try{Ji({keepUnlock:!0})}catch{}try{bp()}catch{}WE({resetGold:e,resetMagic:t})}function Yp(){if(!zv())return!1;let e=Tv();try{O.gold?.add&&O.gold.add(e)}catch{}if(Vp({resetGold:!1}),mn(),wu(!0),I.hasDoneForgeReset||Pp(!0),Jt(),Pr(),Mp("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return $e(),!0}function Wp(){if(!Kv())return!1;let e=I.pendingMagic.clone?.()??I.pendingMagic;try{O.magic?.add&&O.magic.add(e)}catch{}Vp({resetGold:!0});try{O.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Jt({forceReload:!0})}catch{}if(mn(),pn(),Mp("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return $p(!0),I.hasDoneInfuseReset||Bp(!0),$e(),!0}function Eu(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=An();try{O.waves?.add&&e&&!e.isZero?.()&&O.waves.add(e)}catch{}Vp({resetGold:!0,resetMagic:!0});try{O.gold.set(0)}catch{}try{O.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Jt({forceReload:!0})}catch{}if(_u(),Gp(!0),I.hasDoneSurgeReset||Fp(!0),mn(),pn(),Tn(),t&&(n||$E(),n||jE()),Mp("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}$e()}function jv(){if(!Il()||(zt?zt():st()).cmp(10)<0)return!1;let t=I.pendingDna.clone?.()??I.pendingDna;try{O.DNA?.add&&O.DNA.add(t)}catch{}return Eu(st(),{playEffects:!1}),qE(),Dg([4]),I.hasDoneExperimentReset||Up(!0),mn(),pn(),Tn(),No(),$e(),!0}function zE(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{Vy(!0)}catch{}try{zc()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,Ko(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=hv(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Ty(e,()=>{setTimeout(KE,0)},i)},r);gu=i.cleanup}function KE(){gu&&(gu(),gu=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Eu(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function zp(){if(!Br()||Uv()<201)return!1;let e=I.pendingWaves.clone?.()??I.pendingWaves;if(e.isZero?.())return!1;let t=An(),n=O.waves?.value??st(),o=wl(t),r=Kp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!dn()?(zE(),Eu(e,{playEffects:!1}),!0):(Eu(e,{playEffects:!0}),!0)}function jE(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function wl(e){let t=0n;try{let n=localStorage.getItem(Np(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function ZE(e){let t=Np(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function Ev(e){if(!(e instanceof Mt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function Zv(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=Ev(n),l=Ev(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function _u(){let e=An();if(e==null||!Br()||Ip||ZE(e))return;let t=O.waves?.value??st(),n=wl(e);if(n===1/0)return;let o=Zv(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Np(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}Ip=!0;try{O.waves.set(o.remainingWaves)}finally{Ip=!1}$e(),o.safety>=100&&setTimeout(_u,0)}kv()}function hl(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Mt.fromInt(e)}catch{}try{return ne(t)}catch{return e?.toString?.()??"0"}}function JE(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),p=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${p.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let p="";for(let h=0;h<=r;h++){let m=h/r,y=a+m*(u-a),g=y/(Math.PI*2)*120,v=50+30*Math.sin(y+d);p+=(h===0?"M":"L")+` ${g.toFixed(1)} ${v.toFixed(1)}`}return`<path d="${p}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function QE(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${kE}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${TE}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${AE}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${NE}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${xv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Lv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${hu}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${Je?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${_v}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,I.panel=e,I.elements.forge.card=e.querySelector("#reset-card-forge"),I.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),I.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),I.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),I.elements.infuse.card=e.querySelector("#reset-card-infuse"),I.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),I.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),I.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),I.elements.surge.card=e.querySelector("#reset-card-surge"),I.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),I.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),I.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),I.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),I.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),I.elements.surge.headerVal=e.querySelector("[data-surge-level]"),I.elements.surge.header=e.querySelector(".surge-header"),I.elements.experiment.card=e.querySelector("#reset-card-experiment"),I.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),I.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");I.elements.surge.milestones&&t&&Es(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),I.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(I.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&io(r))return;let a=I.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),I.elements.forge.btn&&I.elements.forge.btn.addEventListener("click",()=>{Yp()&&(UE(),$e())}),I.elements.infuse.btn&&I.elements.infuse.btn.addEventListener("click",()=>{Wp()&&(DE(),$e())}),I.elements.surge.btn&&I.elements.surge.btn.addEventListener("click",()=>{zp()&&$e()}),I.elements.experiment.btn&&I.elements.experiment.btn.addEventListener("click",()=>{jv()&&$e()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=JE();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{Is("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}$e()}function tp(e){!e||e.__resetInit||(e.__resetInit=!0,QE(e))}function Ro(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=hl(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function Jv({goldMult:e=null}={}){let t=I.elements.forge;if(!(!t.card||!t.btn)){if(!Ts()){Ro(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(go(),t.card.classList.toggle("is-forge-complete",!!I.hasDoneForgeReset),t.status)if(I.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!Hp()){Ro(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Ro(t.btn,{disabled:!1},xv,Tv(e))}}function Qv(){let e=I.elements.infuse;if(!(!e.card||!e.btn)){if(!Lu()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="none"&&(I.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="flex"&&(I.layerButtons.infuse.style.display="flex"),go(),e.card.classList.toggle("is-complete",!!I.hasDoneInfuseReset),e.status)if(I.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!Xp()){Ro(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Ro(e.btn,{disabled:!1},Lv,I.pendingMagic)}}function Kp(e,t,n){let o=t.add(n);return Zv(e,o).level}function Cp(){let e=I.elements.surge;if(!e.card||!e.btn)return;if(!Br()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="none"&&(I.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="flex"&&(I.layerButtons.surge.style.display="flex"),go();let t=An(),n=O.waves?.value??st(),o=0n;try{o=wl(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':hl(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=I.pendingWaves;if(u&&!u.isZero?.()){let f=Kp(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let p=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':hl(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${hu}">${hl(n)} / <img src="${hu}">${hl(r)}</span>`),e.milestones){let s=pv(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",p=a.description.map(A=>A.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${A}</div>`:`<div>- ${A}</div>`).join("");if(f&&a.surgeLevel===3){let A=_r?_r():Mt.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${ne(A)}</div>`}if(f&&a.surgeLevel===6){let A=Ac();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Fe(A.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Fe(A.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Fe(A.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Fe(A.magic)}x</span></div>`}let h=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(h=!0);let m=Lr(),y=!1;f&&h&&m<1&&Sp.includes(a.id)&&(y=!0);let g=y?" is-nerfed":"",v=l[u];if(!v)v=document.createElement("div"),v.className=`surge-milestone-item ${d}${g}`,v.dataset.isReached=String(f),v.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(v);else{v.className!==`surge-milestone-item ${d}${g}`&&(v.className=`surge-milestone-item ${d}${g}`);let A=String(f);v.dataset.isReached!==A&&(v.dataset.isReached=A)}let E=v.querySelector(".surge-milestone-desc");E&&E.innerHTML!==p&&(E.innerHTML=p);let C=v.querySelector(".surge-milestone-nerf-arrow");if(C){let A=!1;h&&m<1&&Sp.includes(a.id)&&(A=!0);let N=A?"":"none";C.style.display!==N&&(C.style.display=N)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();I.lastRenderedSurgeLevel!==o&&(I.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!I.hasDoneSurgeReset),e.status)if(I.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(Uv()<201){Ro(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(I.pendingWaves.isZero?.()){Ro(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Ro(e.btn,{disabled:!1},hu,I.pendingWaves)}function ex(){let e=I.elements.experiment;if(!e.card||!e.btn)return;if(!Il()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="none"&&(I.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="flex"&&(I.layerButtons.experiment.style.display="flex"),go(),e.card.classList.toggle("is-complete",!!I.hasDoneExperimentReset),e.status)if(I.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((zt?zt():st()).cmp(10)<0){Ro(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}Ro(e.btn,{disabled:!1},_v,I.pendingDna)}function $e({goldMult:e=null}={}){I.panel&&(el()||(Jv({goldMult:e}),Qv(),Cp(),ex()))}function jp(){Vo(),wu(!0),$e()}function Zp(){Vo(),$p(!0),$e()}function Jp(){Vo(),Gp(!0),$e()}function tx(){if(!I.panel)return;let e=I.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!I.panel.classList.contains("is-active")||!I.elements.surge.barFill)return;let t=I.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Cp(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Cp()},{once:!0}))}function nx(){typeof window>"u"||(window.addEventListener("menu:scrollStop",()=>{$e()}),window.addEventListener("surge:level:change",()=>{tx()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(mn(),pn(),Tn()),e.detail?.key==="waves"&&(_u(),$e()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Tn(),$e())}),window.addEventListener("surge:bookResidue",()=>{if(I.panel&&I.panel.offsetParent!==null){let e=I.elements.surge.card;e&&e.style.display!=="none"&&$e()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===ke.GOLD){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;mn(!0);let n=t.mult instanceof c?t.mult:Mt.fromAny(t.mult??1);I.panel&&Jv({goldMult:n});return}if(t.key===ke.MAGIC){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;let n=t.mult instanceof c?t.mult:Mt.fromAny(t.mult??1);pn(n),I.panel&&Qv();return}}}),window.addEventListener("xp:change",()=>{mn(),Tn(),No(),$e()}),window.addEventListener("mutation:change",()=>{pn(),Tn(),$e()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&I.slot!=null&&e.detail.slot!==I.slot||(vl(),mn(!0),pn(),Tn(),No(),$e())}),window.addEventListener("lab:level:change",()=>{No(),$e()}),window.addEventListener("lab:node:change",()=>{pn(),$e()}))}function Vo(){if(bv){I.slot=b(),vl(),wp(),mn(!0),pn(),Tn(),No();return}try{Jt()}catch{return}bv=!0;let e=b();if(I.slot=e,vl(),Lp(e),I.hasDoneForgeReset&&!Ao())try{Pr()}catch{}if(!I.forgeUnlocked&&_p()&&wu(!0),wv(e),wp(),nx(),mn(!0),pn(),Tn(),No(),mu){try{mu()}catch{}mu=null}mu=xi(()=>{let t=Qp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(I.slot=t,vl(),Lp(t),I.hasDoneForgeReset&&!Ao())try{Pr()}catch{}!I.forgeUnlocked&&_p()&&wu(!0),wv(t),wp(),mn(!0),pn(),Tn(),No(),$e()})}var Mt,pu,st,yv,xv,Lv,_v,kE,TE,AE,NE,hu,RE,OE,PE,BE,FE,yu,kp,gl,vu,Tp,yl,bu,Cv,Ap,Ds,Np,Rp,GE,HE,Ip,Mv,I,Jn,vv,bv,mu,Ep,Sv,Iv,gu,_o=De(()=>{Et();co();St();Yt();Vn();lo();Co();ns();Ha();mv();ci();Dn();Wn();li();ai();jc();gv();Mt=c,pu=Math.log10(1.1),st=()=>Mt.fromInt(0),yv=()=>Mt.fromInt(1),xv="img/currencies/gold/gold.webp",Lv="img/currencies/magic/magic.webp",_v="img/currencies/dna/dna.webp",kE="img/misc/forge.webp",TE="img/misc/infuse.webp",AE="img/misc/surge.webp",NE="img/misc/experiment.webp",hu="img/currencies/wave/wave.webp",RE="sounds/forge_reset.ogg",OE="sounds/infuse_reset.ogg",PE="sounds/surge_reset.ogg",BE="sounds/experiment_reset.ogg",FE=[];yu=e=>`ccc:reset:forge:${e}`,kp=e=>`ccc:reset:forge:completed:${e}`,gl=e=>`ccc:debug:forgeUnlocked:${e}`,vu=e=>`ccc:reset:infuse:${e}`,Tp=e=>`ccc:reset:infuse:completed:${e}`,yl=e=>`ccc:debug:infuseUnlocked:${e}`,bu=e=>`ccc:reset:surge:${e}`,Cv=e=>`ccc:debug:surgeUnlocked:${e}`,Ap=e=>`ccc:reset:surge:completed:${e}`,Ds=e=>`ccc:reset:surge:barLevel:${e}`,Np=Ds,Rp=e=>`ccc:reset:experiment:completed:${e}`,GE=Mt.fromInt(31),HE=Mt.fromInt(7),Ip=!1,Mv=!1;I={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:st(),pendingMagic:st(),pendingWaves:st(),pendingDna:st(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},Jn=[],vv=null,bv=!1,mu=null,Ep=null,Sv=null,Iv=null;gu=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Vo,performForgeReset:Yp,performInfuseReset:Wp,performSurgeReset:zp,performExperimentReset:jv,computePendingForgeGold:Wv,computeForgeGoldFromInputs:Rv,computeInfuseMagicFromInputs:Ov,computeSurgeWavesFromInputs:Pv,computePendingDnaFromInputs:Bv,getForgeDebugOverrideState:Dv,hasDoneForgeReset:Rr,isForgeUnlocked:Ts,setForgeDebugOverride:$v,setForgeResetCompleted:Pp,updateResetPanel:$e,isInfuseUnlocked:Lu,setInfuseDebugOverride:Hv,getInfuseDebugOverrideState:qv,recomputePendingMagic:pn,setInfuseUnlockedForDebug:Gv,setInfuseResetCompleted:Bp,hasDoneInfuseReset:$t,isSurgeUnlocked:Br,setSurgeUnlockedForDebug:Vv,getSurgeDebugOverrideState:Xv,setSurgeResetCompleted:Fp,hasDoneSurgeReset:Mo,getCurrentSurgeLevel:Kn,shouldBlockBigCoins:bl,hasDoneExperimentReset:Yv,setExperimentResetCompleted:Up,isExperimentUnlocked:Il}))});var L0={};vt(L0,{AREA_KEYS:()=>Se,HM_EVOLUTION_INTERVAL:()=>qt,MAX_LEVEL_DELTA:()=>Ys,REGISTRY:()=>Xu,UPGRADE_TIES:()=>Ee,approxLog10BigNum:()=>Ne,batchUpgradeOperations:()=>Ll,bigNumFromLog10:()=>_e,buyCheap:()=>cl,buyMax:()=>ll,buyOne:()=>As,buyTowards:()=>Ns,clearPermanentUpgradeUnlock:()=>vm,computeDefaultUpgradeCost:()=>bm,computeHmMultipliers:()=>Yo,computeUpgradeEffects:()=>fs,costToBuyOne:()=>Cx,ensureLevelBigNum:()=>pt,estimateFlatBulk:()=>fm,estimateGeometricBulk:()=>Ix,evaluateBulkPurchase:()=>bi,evolveUpgrade:()=>ou,formatMultForUi:()=>Fe,getCurrentAreaKey:()=>jn,getHmEvolutions:()=>mm,getHmNextMilestoneLevel:()=>Mx,getIconUrl:()=>ru,getLevel:()=>Ln,getLevelNumber:()=>Tt,getMagnetLevel:()=>_c,getMpValueMultiplierBn:()=>Lc,getUpgrade:()=>js,getUpgradeLockState:()=>ko,getUpgradeStorageKey:()=>_i,getUpgradesForArea:()=>Ct,levelBigNumToNumber:()=>Xe,log10OnePlusPow10:()=>wf,markUpgradePermanentlyUnlocked:()=>Li,normalizeBigNum:()=>kx,normalizedUpgradeLevel:()=>Pu,onUpgradesChanged:()=>vd,peekNextPrice:()=>x0,performFreeAutobuy:()=>Ld,safeMultiplyBigNum:()=>It,setLevel:()=>or,syncBookCurrencyMultiplierFromUpgrade:()=>qa,upgradeUiModel:()=>Rs});function Cu(){Fr.size!==0&&(Fr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{lt(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Fr.clear())}function rx(){if(!(typeof window>"u")&&!n0){n0=setInterval(Cu,2e3);try{window.addEventListener("beforeunload",Cu)}catch{}try{window.addEventListener("pagehide",Cu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&Cu()})}catch{}}}function Ll(e){if(qs)return e();qs=!0;try{return e()}finally{qs=!1,xl.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{Hs(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),xl.clear(),t0.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{Lx(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),t0.clear(),im&&(im=!1,to())}}function ix(e){try{let t=Ks(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function i0(e,t){if(!ix(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=Ne(n);return Number.isFinite(o)&&o>=sx}catch{return!1}}function Gs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>em)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>em/2||i.length>em/2)return"Infinity"}return n}function ku(e){return dx[e]??0}function tm(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Ws(e,t){let n=sr(e||t?.area);if(!n)return null;let o=ar(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=eo(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function _l(e,t){let n=sr(e||t?.area);if(!n)return null;let o=eo(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function $s(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function lm(e=b()){let t=String(e??"default");if(Nu.has(t))return Nu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${l0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Nu.set(t,n),n}function cm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Nu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${l0}:${n}`,JSON.stringify(e))}catch{}}function qu(e=b()){let t=String(e??"default");if(Ru.has(t))return Ru.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${c0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Ru.set(t,n),n}function Gu(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Ru.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${c0}:${n}`,JSON.stringify(e))}catch{}}function gm(e=b()){let t=String(e??"default");if(Ou.has(t))return Ou.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${u0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Ou.set(t,n),n}function ym(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Ou.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${u0}:${n}`,JSON.stringify(e))}catch{}}function um(e,t,n=b()){let o=Ws(e,t);if(!o)return;let r=_l(e,t),i=gm(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],ym(i,n))}function f0(e,t,n=b()){let o=Ws(e,t);if(!o)return!1;let r=_l(e,t),i=gm(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],ym(i,n),!0):!1}function Li(e,t,n=b()){let o=Ws(e,t);if(!o)return;let r=_l(e,t),i=qu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Gu(i,n))}function vm(e,t,n=b()){let o=Ws(e,t);if(!o)return;let r=qu(n);r.upgrades[o]&&(delete r.upgrades[o],Gu(r,n));let i=lm(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},cm(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&lr(e,s,n),to()}function Uu(e,t,n=b()){let o=Ws(e,t);if(!o)return!1;let r=_l(e,t),i=qu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Gu(i,n),!0):!1}function hn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=ar(t?.tie??t?.tieKey),o=e?.areaKey||Se.STARTER_COVE;if(!n||!lx.has(n))return{locked:!0,iconOverride:Nn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?Tt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:d0()}catch{}function s(){if(p0())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===Ee.UNLOCK_XP)return s();if(n===Ee.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Nn,useLockedBase:!0};let a=!1;try{let u=vn();a=Xe(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}return{locked:!1}}if(n===Ee.UNLOCK_INFUSE){if(!Rr())return{locked:!0,iconOverride:Nn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Qn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=vn();a=Xe(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}return{locked:!1}}if(n===Ee.UNLOCK_SURGE){if(!$t())return{locked:!0,iconOverride:Nn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Qn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=vn();a=Xe(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}return{locked:!1}}if(hm.has(n)){if($t()||Uu(o,t)){try{Li(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=vn();a=Xe(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:Nn,useLockedBase:!0,titleOverride:Qn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{um(o,t)}catch{}return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}if(Rr()||Uu(o,t)){try{Li(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Nn,useLockedBase:!0};if(f0(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:a,reason:a}}let l=!1;try{let a=vn();l=Xe(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Nn,useLockedBase:!0,titleOverride:Qn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{um(o,t)}catch{}return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function sr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function ar(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function px(e,t){let n=ar(t?.tie??t?.tieKey);if(n&&cx.has(n))return!0;let o=eo(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=sr(l);if(a&&ux.has(`${a}:${i}`))return!0}return!1}function d0(){try{return!!fn()}catch{return!1}}function p0(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${fx}:${t}`)==="1"}catch{return!1}}function vn(){try{let e=typeof rt=="function"?rt():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function Pu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function nm(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function eo(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function pt(e){try{if(e=Gs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return _e(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=Ne(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Xe(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=Ne(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=Ne(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function mx(e,t){let n=pt(e),o=pt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(Ne(n))+1,i=Math.floor(Ne(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function m0(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function zs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Du(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:zs(e.numUpgEvolutions)}function bm(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Xe(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/qt));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=v0(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:Ne(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:m0(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,gn(i,r)}function h0(e){let t=zs(e),n=qt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Ur(o),capFmtText:Xs(o)}}function g0(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(Ne(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Xe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(qt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Xe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}}function gx(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Sm(e,t=Fu){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=sr(t||e?.area||Fu);return ax[n]||s0}function It(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function Hu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=h0(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Yo(e,t,n=Fu){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Sm(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=g0(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=gx(u.multiplier??u.mult??u.value??1,f),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=It(i,d):p==="coin"||p==="coins"?s=It(s,d):p==="mp"?l=It(l,d):r=It(r,d)}let a=Du(e);if(a>0){let u=ox*a,f=_e(u);r=It(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function y0(e,t,n=Fu){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Sm(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=g0(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt(qt)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny(qt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+qt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(qt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function v0(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=hx[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Ks(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=v0(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=m0(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=Ne(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),h=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(p)===0&&d.cmp(h)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function gn(e,t){let n=Ks(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=_e(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return _e(n.baseLog10+o*n.ratioLog10).floorToInteger()}function yx(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function rr(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Ks(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Tu+t*o.ratioLn)/Tu;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Tu+t*o.ratioLn,i=o.ratioLn*n,s=yx(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Tu}function Bu(e,t,n){if(!(n>0))return c.fromInt(0);let o=Ks(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=rr(e,t,l);a=a.add(_e(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=rr(e,t,n);return _e(i)}function S0(e){if(!(e>0)||!Number.isFinite(e))return e;if(rm[0]=e,rm[0]<=0)return 0;vx[0]-=1n;let t=rm[0];return t>0?t:0}function bx(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=S0(e);return n<e?n:e>1?e/2:0}function Au(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function Cl(e,t,n,o=Ys,r={}){let i=Ks(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Xe(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:Xe(o),p=Number.isFinite(f)?Math.max(0,f-u):om,h=Number.isFinite(d)?Math.max(0,Math.floor(d)):om;if(h=Math.min(h,om,p),!(h>0)){let z=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:z,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let z=Math.min(h,m),$=c.fromAny(e.costAtLevel(u)),q=s,j=0;for(;j<z;){$=c.fromAny(e.costAtLevel(u+j));let he=q.add($);if(he.cmp(n)>0)break;q=he,j+=1}let Y=u+j,re=Number.isFinite(f)&&Y>=f,x=Au(j);if(j<z||re||h<=j){let he=re?s:c.fromAny(e.costAtLevel(Y));return{count:x,spent:q,nextPrice:he,numericCount:j}}let K=(()=>{try{return ir(t??u,u).add(x)}catch{return u+j}})(),ce=Cl(e,K,n.sub(q),h-j,r),pe=ce?.count instanceof c?ce.count:Au(ce?.numericCount??0),Q=x.add(pe),ie=(ce?.spent??s).add(q);return{count:Q,spent:ie,nextPrice:ce?.nextPrice??s,numericCount:j+(ce?.numericCount??0)}}let y=Ne(n),g=i.ratioLog10,v=i.ratioMinus1,E=c.fromAny(e.costAtLevel(u)),C=i.baseLog10+u*g;if(v>0&&(!Number.isFinite(y)||Math.abs(y)>1e6&&Math.abs(C)>1e6)){let z=c.fromAny(e.costAtLevel(u));if(n.cmp(z)<0)return{count:s,spent:s,nextPrice:z,numericCount:0};let $=Number.isFinite(h)?Math.max(1,Math.floor(h)):Number.MAX_VALUE,q=1,j=1;for(;j<$;){let pe=rr(e,u,j);if(_e(pe).cmp(n)<=0){let ie=j*2;if(!Number.isFinite(ie)||ie<=j){j=$;break}q=j,j=Math.min(ie,$)}else break}let Y=0;for(;q<j&&Y<256;){let pe=Math.max(q+1,Math.floor((q+j+1)/2)),Q=rr(e,u,pe);_e(Q).cmp(n)<=0?q=pe:j=pe-1,Y++}let re=Math.max(1,q),x=Au(re),K=s,ce=s;if(!a)if(K=Bu(e,u,re),Number.isFinite(f)){let pe=Math.max(0,Math.floor(f-Math.min(u,f)));re>=pe?ce=s:ce=_e(C+re*g)}else ce=_e(C+re*g);return{count:x,spent:K,nextPrice:ce,numericCount:re}}if(n.cmp(E)<0)return{count:s,spent:s,nextPrice:E,numericCount:0};let N=!1,X=null,B=null;try{X=c.fromAny(e.costAtLevel(u+1))}catch{}try{let z=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);B=c.fromAny(e.costAtLevel(z))}catch{}!N&&!(i.ratioMinus1>0)&&(N=!0),X&&B&&(N=X.cmp(E)===0&&B.cmp(E)===0),!N&&!(i.ratioMinus1>0)&&(N=!0);let G=Number.isFinite(h)?Math.max(0,Math.floor(h)):Number.MAX_VALUE;if(N){let z=ir(e.lvlCapBn??"Infinity","Infinity"),$=ir(t??0,0),q=z.isInfinite?.()?c.fromAny("Infinity"):z.sub($).floorToInteger(),{count:j,countBn:Y,spent:re,nextPrice:x}=fm(E,n,q);return{count:Y,spent:re,nextPrice:x,numericCount:j}}if(!(g>0)||!(v>0)){let z=ir(e.lvlCapBn??"Infinity","Infinity"),$=ir(t??0,0),q=z.isInfinite?.()?c.fromAny("Infinity"):z.sub($).floorToInteger(),{count:j,countBn:Y,spent:re,nextPrice:x}=fm(E,n,q);return{count:Y,spent:re,nextPrice:x,numericCount:j}}let _=Math.log10(v);if(!Number.isFinite(_))return{count:s,spent:s,nextPrice:E,numericCount:0};let M=wf(y+_-C)/g;(!Number.isFinite(M)||M<0)&&(M=0);let L=Math.floor(Math.min(G,M));Number.isFinite(L)||(L=G),L<=0&&(L=1);let V=1e-7,J=rr(e,u,L),se=0,de=2048;for(;L>0&&(!Number.isFinite(J)||J>y+V)&&se<de;){let z=Number.isFinite(J)?Math.max(1,Math.ceil((J-y)/Math.max(g,1e-12))):Math.max(1,Math.floor(L/2)),$=Math.max(0,Math.floor(L-z));if($<L)L=$;else{let q=S0(L);if(!(q<L))break;L=q}J=L>0?rr(e,u,L):Number.NEGATIVE_INFINITY,se+=1}if(L<=0||!Number.isFinite(L))if(n.cmp(E)>=0)L=1,J=Ne(E);else return{count:s,spent:s,nextPrice:E,numericCount:0};if(L<G){let z=x=>{let K=x*2;return Number.isFinite(K)?K:Number.MAX_VALUE},$=L,q=Math.min(G,Math.max(L+1,z(L))),j=rr(e,u,q);for(;$<q&&Number.isFinite(j)&&j<=y+V&&q<G;)$=q,q=Math.min(G,z(q)),j=rr(e,u,q);let Y=$,re=q;for(let x=0;x<256&&Y<re;x+=1){let K=Math.floor((Y+re+1)/2),ce=rr(e,u,K);Number.isFinite(ce)&&ce<=y+V?(Y=K,J=ce):re=K-1}L=Y}let ge=null;if(!a){ge=Bu(e,u,L);let z=0;for(;ge.cmp(n)>0&&L>0&&z<de;){let $=bx(L);if(!($<L))break;L=$,ge=Bu(e,u,L),z+=1}if(L<=0)return{count:s,spent:s,nextPrice:E,numericCount:0};if(L<G&&z<de)for(;L<G&&z<de;){let $=u+L,q;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)q=c.fromAny(e.costAtLevel($));else{let Y=C+L*g;q=_e(Y).floorToInteger()}}catch{break}let j=ge.add(q);if(j.cmp(n)>0)break;ge=j,L+=1,z+=1}}let Te=s,Ce=!a&&Number.isFinite(u)&&Number.isFinite(L)&&u<Number.MAX_SAFE_INTEGER/2&&L<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let z=Math.max(0,Math.floor(f-Math.min(u,f)));if(L>=z)Te=s;else if(Ce){let $=Math.floor(u+L);Te=c.fromAny(e.costAtLevel($))}else{let $=C+L*g;Te=_e($)}}else if(Ce){let z=Math.floor(u+L);Te=c.fromAny(e.costAtLevel(z))}else{let z=C+L*g;Te=_e(z)}return{count:Au(L),spent:ge,nextPrice:Te,numericCount:L}}function Sx(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=Ne(t),r=Ne(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function fm(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let p=e.mulBigNumInteger(d);return{count:dm(d),countBn:d,spent:p,nextPrice:e}}let i=Ne(t),s=Ne(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=_e(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:dm(l),countBn:l,spent:a,nextPrice:u}}function Ix(e,t,n,o){if(!n||o<=0)return{count:0};let r=Ne(t),i=Ne(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let y=0;y<64&&a<u;y+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let p=i+f*n.ratioLog,h=_e(d),m=_e(p);return{count:f,spent:h,nextPrice:m,spentLog:d,nextPriceLog:p}}function ir(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function dm(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Ur(e){return ne(e instanceof c?e:c.fromAny(e??0))}function Xs(e){return Ur(e).replace(/<[^>]*>/g,"")}function $u(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Vs(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=$u(n??t??0),s=$u(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Xe(i),newLevel:Number.isFinite(o)?o:Xe(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Bt(e,t){return gn(e,t)}function I0(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function _i(e,t,n=b()){if(n==null)return null;let o=sr(e),r=Im(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function wx(){o0.forEach(e=>{try{e?.()}catch{}}),o0.clear()}function r0(e){wx()}function Ex(e,t){if(typeof localStorage>"u")return;let n=I0(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=_i(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}})}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function xx(e,t,n){Ex(e,n);let o=_i(e,t,n);if(!o)return null;if(qs&&xl.has(o))try{let r=xl.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Fr.has(o))try{let r=Fr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function Hs(e,t,n,o=b(),r={}){let i=_i(e,t,o);if(i){if(qs){xl.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Fr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Fr.has(i)&&Fr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{lt(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function Lx(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&Hs(e,o.id,o,n)})}function Im(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return eo(t.id);let n=eo(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=ar(n);if(o){let r=sm.get(o);if(r){let i=sr(e);if(!i||sr(r.area)===i)return eo(r.id)}}}return n}function w0(e,t,n=b()){let o=n==null?"null":String(n),r=Im(e,t);return`${o}:${e}:${eo(r)}`}function yo(e,t){let n=Im(e,t),o=eo(n),r=b(),i=w0(e,o,r),s=pm.get(i);if(s)return s;let l=js(e,o),a=xx(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,Hs(e,o,a,r)}let f=a.lvl,d=a.nextCost,p=a.nextCostLvl;a.lvl=Gs(a.lvl),a.nextCost=Gs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Gs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==p)&&(u=!0);let h=0;l?.upgType==="HM"&&(h=zs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),Hu(l,h));let m=pt(a.lvl),y=Xe(m);try{let A=l?.lvlCapBn??c.fromAny("Infinity");if(!A.isInfinite?.()&&m.cmp(A)>0){let N=A.clone?.()??A;y=Xe(N);let X=N.toStorage();a.lvl=X,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=X,Hs(e,o,a,r)}}catch{}let g=null;try{g=m?.toStorage?.()??pt(y).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let v=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,E=!v||v!==g,C=null;if(!E&&a.nextCost!=null)try{C=c.fromAny(a.nextCost)}catch{C=null,E=!0}if(!C||E){if(l)try{C=c.fromAny(l.costAtLevel(y))}catch{C=c.fromInt(0)}else C=c.fromInt(0);try{a.nextCost=C.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{Hs(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let A=c.fromAny("Infinity");l.lvlCapBn=A,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Ur(A),l.lvlCapFmtText=Xs(A)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:y,lvlBn:m,nextCostBn:C,slot:r,hmEvolutions:h},pm.set(i,s),s}function Dr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=eo(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??pt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Xe(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??pt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=pt(e.lvl??0).toStorage()}i.lvl=Gs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Gs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=zs(e.hmEvolutions)),Hs(n,r,i,o,t),e.slot=o}function lr(e,t,n=b()){pm.delete(w0(e,t,n))}function Tt(e,t){return yo(e,t).lvl}function mm(e,t){return yo(e,t).hmEvolutions??0}function E0(e,t){if(!t)return{locked:!1};let n=d0(),o=n?vn():c.fromInt(0),r=n?Xe(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=px(e,t),d="Unlock the XP system to reveal this upgrade",p=p0();if(f)if(p)i={locked:!0,iconOverride:yn,titleOverride:rn,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let h='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Nn,titleOverride:Qn,descOverride:h,reason:h,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Nn,titleOverride:Qn,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=nm({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,surgeLevel:Kn(),surgeUnlocked:Br(),baseLocked:s.locked,getUpgradeLevel(p){return Tt(e,p)}},d=t.computeLockState(f);s=nm(s,d)}catch{}let l=b(),a=Ws(e,t),u=a?Uu(e,t,l):!1;if(a){let f=lm(l),d=qu(l),p=gm(l),h=a.replace(/_/g,"-"),m=_l(e,t),y=!1;$s(f,h,a)&&(y=!0),m&&$s(f,m,a)&&(y=!0),y&&cm(f,l);let g=!1;$s(d,h,a)&&(g=!0),m&&$s(d,m,a)&&(g=!0),g&&Gu(d,l);let v=!1;$s(p,h,a)&&(v=!0),m&&$s(p,m,a)&&(v=!0),v&&ym(p,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=Nn),f?s.titleOverride||(s.titleOverride=rn):(!s.titleOverride||s.titleOverride===rn)&&(s.titleOverride=Qn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Nn||s.iconOverride===yn)&&delete s.iconOverride,(s.titleOverride===rn||s.titleOverride===Qn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Nn),a){let f=lm(l),d=f.upgrades[a]||{},p=ar(t?.tie??t?.tieKey),h=p&&a0.has(p),m=p&&hm.has(p),y=d.status||"locked";if(Uu(e,t,l))y="unlocked";else if(f0(e,t,l)&&y==="locked"){let _=!1;try{_=Xe(vn())>=31}catch{}let U=!1;try{U=Xe(vn())>=101}catch{}h&&!_||m&&!U?y="locked":y="mysterious"}let g=ku(y),v=tm(s),E=ku(v),C=()=>{s.locked=!0;let _=d.snapshot;_&&typeof _=="object"&&(s=nm(s,_)),s.iconOverride=yn,s.titleOverride=rn;let U=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=U,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>E&&(y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):y==="mysterious"&&C(),v=tm(s),E=ku(v));let A=!1,N=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",X=h,B=!1;try{B=Xe(vn())>=31}catch{}let G=!1;try{G=Xe(vn())>=101}catch{}if((X&&!B&&N==="mysterious"||m&&!G&&N==="mysterious")&&(N="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==N)&&(f.upgrades[a]={status:N},A=!0),E>g){if(d.status=v,f.upgrades[a]={status:d.status},A=!0,y=v,g=E,v==="unlocked")Li(e,t,l);else if(v==="mysterious"){let _=!1;try{_=Xe(vn())>=31}catch{}(!h||_)&&um(e,t,l)}}y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Nn||s.iconOverride===yn)&&delete s.iconOverride,(s.titleOverride===rn||s.titleOverride===Qn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},A=!0),Li(e,t,l)):y==="mysterious"&&v!=="mysterious"&&(C(),v=tm(s),E=ku(v)),A&&cm(f,l)}return s}function Ml(e,t){return!!E0(e,t).locked}function wm(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Du(e),{capBn:r,cap:i}=h0(o);try{return t?.cmp?.(r)>=0}catch{}let s=Xe(t);return Number.isFinite(s)&&s>=i}function Ln(e,t){let n=yo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():pt(n.lvl??0)}function x0(e,t){let n=yo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??pt(n.lvl??0),i=Xe(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function or(e,t,n,o=!0,r={}){let i=yo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,Hu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=$u(i.lvlBn??pt(i.lvl??0)),d=pt(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let p=d;try{s&&i0(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=pt(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=pt(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let h=Xe(p);if(!s)return i.lvl=h,i.lvlBn=p,i.nextCostBn=c.fromInt(0),Dr(i),lr(e,t),to(),i.lvl;i.lvl=h,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(h))}catch{i.nextCostBn=c.fromInt(0)}return Dr(i,{deferSave:r?.deferSave}),lr(e,t),Vs(s,u,f,i.lvl,i.lvlBn),to(),i.lvl}function Ct(e){return Xu.filter(t=>t.area===e)}function js(e,t){let n=sr(e),o=eo(t),r=ar(typeof o=="string"?o:t);return Xu.find(i=>n&&sr(i.area)!==n?!1:!!(eo(i.id)===o||r&&i.tieKey===r))||null}function ko(e,t){let n=typeof t=="object"&&t?t:js(e,t);return E0(e,n)}function _x(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function ru(e){return e?_x(e.icon):""}function Cx(e,t){let n=js(e,t),o=Ln(e,t),r=Xe(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function As(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Ml(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??pt(r),s=$u(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(i0(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Xe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Dr(n),lr(e,t),to(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?O[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let h=f.value;if((h instanceof c?h:c.fromAny(h??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=Xe(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),Dr(n),lr(e,t),Vs(o,r,s,n.lvl,n.lvlBn),to(),{bought:1,spent:d}}function ou(e,t){let n=yo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??pt(n.lvl);if(!wm(o,r,n.hmEvolutions))return{evolved:!1};let i=zs(n.hmEvolutions)+1;n.hmEvolutions=i,Hu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Dr(n),lr(e,t),Vs(o,n.lvl,r,n.lvl,r),to(),{evolved:!0}}function ll(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ml(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??pt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=O[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return As(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let v=i.clone?.()??pt(i),E=Xe(v),C=v.toStorage?.(),A;if(o.upgType==="HM"){if(A=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let X=c.fromAny("Infinity");o.lvlCapBn=X,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Ur(X),o.lvlCapFmtText=Xs(X)}}else{let X=o.lvlCapBn?.clone?.()??ir(o.lvlCap??1/0,1/0);A=X?.clone?.()??X}let N=A.sub(v);if(N.isZero?.()){let X=mx(A,v);X.isZero?.()||(N=X)}if(N.isZero?.()){let X=A.toStorage?.();if(C&&X&&C!==X)if(A.isInfinite?.())try{N=c.fromAny("Infinity")}catch{N=c.fromInt(1)}else N=c.fromInt(1)}return n.lvlBn=A.clone?.()??A,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Xe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),O[o.costType].set(u),Dr(n),lr(e,t),Vs(o,E,v,n.lvl,n.lvlBn),to(),{bought:N,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):Ys;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=Cl(o,i,u,d),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),y=u.sub(m);O[o.costType].set(y);let g=i.add(h);return n.lvlBn=g,n.lvl=Xe(g),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Dr(n),lr(e,t),Vs(o,r,i,n.lvl,n.lvlBn),to(),{bought:h,spent:m}}function Ns(e,t,n){let o=yo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Ml(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??pt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=O[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Xe(n):void 0,h=Number.isFinite(d)?Number.isFinite(p)?Math.min(d,p):d:p,m=Cl(r,s,f,h),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=m.spent??c.fromInt(0),v=f.sub(g);O[r.costType].set(v);let E=s.add(y);return o.lvlBn=E,o.lvl=Xe(E),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Dr(o),lr(e,t),Vs(r,i,s,o.lvl,o.lvlBn),to(),{bought:y,spent:g}}function bi(e,t,n,o=Ys,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=Cl(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function to(){if(qs){im=!0,yd();return}yd(),xc()}function jn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Se.STARTER_COVE}function Rs(e,t){let n=js(e,t);if(!n)return null;let o=Ln(e,t),r=Xe(o),i=Ur(o),s=Xs(o),l=n.lvlCapBn??ir(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Ur(l),u=n.lvlCapFmtText??Xs(l),f=r<n.lvlCap?x0(e,t):c.fromInt(0),d=Ur(f),p=O[n.costType]?.value,h=p instanceof c?p:c.fromAny(p??0),m=ko(e,t),y=!!m.locked,g=m.titleOverride??n.title,v=m.descOverride??n.desc;if(e===Ze&&eo(t)===ni){let N=kc();if(Math.abs(N-1)>1e-4&&v){let X=Fe(N);v=v.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+X+" Coins on an interval")}}let E=Sm(n,e),C="";typeof n.effectSummary=="function"&&!(y&&m.hideEffect)&&(C=n.effectSummary(r),typeof C=="string"&&(C=C.trim()));let A=m.iconOverride??ru(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:h,haveFmt:O[n.costType]?.fmt(h)??String(h),effect:C,iconUrl:A,lockState:m,locked:y,areaKey:e,hmMilestones:E,displayTitle:g,displayDesc:v,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?mm(e,t):0,hmReadyToEvolve:n.upgType==="HM"?wm(n,o,mm(e,t)):!1,hmNextMilestone:n.upgType==="HM"?y0(n,o,e):null}}function Mx(e,t){let n=js(e,t);if(!n||n.upgType!=="HM")return null;let o=Ln(e,t);return y0(n,o,e)}function kx(e){return _e(Ne(e??0))}function Ld(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0};let r=I0(e,n.slot);if(Wt(r))return{bought:0};let i=_i(e,t,n.slot);if(Wt(i))return{bought:0};if(Ml(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??pt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&wm(o,l,n.hmEvolutions))return{bought:0};let f=O[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let p=Cl(o,l,d,Ys),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:0};let m=l.add(h);return rx(),or(e,t,m,!0,{deferSave:!0}),{bought:h}}function cl(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ml(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??pt(n.lvl),i=Xe(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=O[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=bi(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=h=>{if(h<=0)return!0;let m=Bu(o,i,h-1),y=a.sub(m),g=i+h-1,v=c.fromAny(o.costAtLevel(g)),E=y.div(10);return v.cmp(E)<=0},p=0;if(f<2e3){let h=u.spent,m=f;for(;m>0;){let y=i+m-1,g=c.fromAny(o.costAtLevel(y)),v=h.sub(g),C=a.sub(v).div(10);if(g.cmp(C)<=0){p=m;break}h=v,m--}}else{let h=0,m=f;for(;h<m;){let y=Math.ceil((h+m)/2);d(y)?h=y:m=y-1}p=h}return p<=0?{bought:0,spent:c.fromInt(0)}:Ns(e,t,p)}var Ys,qt,Tk,ox,Fu,Se,qs,t0,xl,im,Fr,n0,sx,em,Ee,s0,ax,Nn,yn,rn,Qn,a0,hm,lx,cx,ux,fx,l0,c0,u0,dx,Nu,Ru,Ou,sm,Ak,am,Mu,jt,Tu,hx,om,b0,rm,vx,Xu,pm,o0,lo=De(()=>{St();Et();Yt();Vn();Co();_o();Wn();oi();ps();np();bd();Ys=c.fromAny("Infinity"),qt=1e3,Tk=c.fromInt(1e3),ox=3,Fu="",Se={STARTER_COVE:"starter_cove",AUTOMATION:Ze,DNA:Kt},qs=!1,t0=new Map,xl=new Map,im=!1,Fr=new Map,n0=null;sx=308;em=1024;Ee={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},s0=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],ax={[Se.STARTER_COVE]:s0},Nn="img/misc/locked.webp",yn="img/misc/mysterious.webp",rn="Hidden Upgrade",Qn="Locked Upgrade",a0=new Set([Ee.COIN_VALUE_II,Ee.XP_VALUE_II,Ee.MP_VALUE_I,Ee.MAGNET,Ee.ENDLESS_XP]),hm=new Set([Ee.COIN_VALUE_III,Ee.XP_VALUE_III,Ee.MP_VALUE_II,Ee.FASTER_COINS_III,Ee.ENDLESS_MP]),lx=new Set([Ee.UNLOCK_XP,Ee.UNLOCK_FORGE,Ee.UNLOCK_INFUSE,Ee.UNLOCK_SURGE,...a0,...hm]),cx=new Set([Ee.FASTER_COINS_II,Ee.COIN_VALUE_I,Ee.BOOK_VALUE_I,Ee.XP_VALUE_I]),ux=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),fx="ccc:merchantMet",l0="ccc:shop:reveals",c0="ccc:shop:permaUnlocks",u0="ccc:shop:permaMyst",dx={locked:0,mysterious:1,unlocked:2},Nu=new Map,Ru=new Map,Ou=new Map,sm=new Map,Ak=ar(Ee.BOOK_VALUE_I),am=c,Mu=e=>am.fromAny(e??0),jt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Mu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return am.fromInt(1).add(r.mulDecimal(n))}catch{let i=Ne(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return _e(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Mu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return am.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Mu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Mu(i);if(o>0){let l=Ne(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return _e(u)}}catch{}try{let l=Xe(s),a=o*l;return _e(a)}catch{return c.fromInt(1)}}}};Tu=Math.log(10);hx={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Du(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Du(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};om=(()=>{try{let e=Xe(Ys);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),b0=new ArrayBuffer(8),rm=new Float64Array(b0),vx=new BigInt64Array(b0);Xu=[{area:Se.STARTER_COVE,id:1,tie:Ee.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:2,tie:Ee.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Zr()}catch{}}},{area:Se.STARTER_COVE,id:3,tie:Ee.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:4,tie:Ee.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(.5),onLevelChange(){try{tn()}catch{}}},{area:Se.STARTER_COVE,id:5,tie:Ee.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>Pu(e)>0?2:1,onLevelChange({newLevel:e}){qa(e)}},{area:Se.STARTER_COVE,id:6,tie:Ee.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Fe(t)}x`},effectMultiplier:jt.addFlatPerLevel(2)},{area:Se.STARTER_COVE,id:7,tie:Ee.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,onLevelChange({newLevel:e}){if((e??0)>=1)try{jp()}catch{}}},{area:Se.STARTER_COVE,id:8,tie:Ee.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${ne(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(10),onLevelChange(){try{tn()}catch{}}},{area:Se.STARTER_COVE,id:9,tie:Ee.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:10,tie:Ee.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:11,tie:Ee.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=Pu(e),n=Fe(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>Pu(e)},{area:Se.STARTER_COVE,id:12,tie:Ee.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:qt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState:hn,effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Yo(this,t,this.area),r=It(n,o);return`XP value bonus: ${Fe(r)}x`},effectMultiplier:jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:13,tie:Ee.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Zp()}catch{}}},{area:Se.STARTER_COVE,id:14,tie:Ee.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${ne(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(1e3)},{area:Se.STARTER_COVE,id:15,tie:Ee.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:16,tie:Ee.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:17,tie:Ee.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Fe(t)}x`},effectMultiplier:jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:18,tie:Ee.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:qt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState:hn,effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Yo(this,t,this.area),r=It(n,o);return`MP value bonus: ${Fe(r)}x`},effectMultiplier:jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:19,tie:Ee.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Jp()}catch{}}},{area:Se.STARTER_COVE,id:20,tie:Ee.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState(e){let t=Kn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=vn();o=Xe(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qn,descOverride:"Locked"}},onLevelChange(){try{tn()}catch{}},effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Yo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Fe(r)}x`},effectMultiplier:jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:21,tie:Ee.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState(e){let t=Kn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=vn();o=Xe(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qn,descOverride:"Locked"}},onLevelChange(){try{tn()}catch{}},effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Yo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Fe(r)}x`},effectMultiplier:jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:22,tie:Ee.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState(e){let t=Kn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=vn();o=Xe(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qn,descOverride:"Locked"}},onLevelChange(){try{tn()}catch{}},effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Yo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Fe(r)}x`},effectMultiplier:jt.powPerLevel(1.1)},...gg,...Oy];for(let e of Xu){let t=ar(e.tie??e.tieKey);t&&!sm.has(t)&&sm.set(t,e),e.baseCost=ir(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return gn(this,n)},e.nextCostAfter=function(n,o){return gn(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=jt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=pt(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Yo(this,o,this.area),s=It(r,i);if(typeof this.bonusLine=="function")return this.bonusLine(n,s);let l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Fe(s)}x`})),e.numUpgEvolutions=zs(e.numUpgEvolutions),e.upgType==="HM"?Hu(e,e.numUpgEvolutions):(e.lvlCapBn=ir(e.lvlCap??1/0,1/0),e.lvlCap=dm(e.lvlCapBn),e.lvlCapFmtHtml=Ur(e.lvlCapBn),e.lvlCapFmtText=Xs(e.lvlCapBn)),e.bulkMeta=Sx(e),Ks(e)}pm=new Map;o0=new Map;typeof window<"u"&&(r0(b()),window.addEventListener("saveSlot:change",()=>{r0(b()),to()}),window.addEventListener("surge:level:change",()=>{to()}));_g()});var J0={};vt(J0,{applyAllCurrencyOverridesForActiveSlot:()=>Fl,applyStatMultiplierOverride:()=>Yn,getDebugCurrencyMultiplierOverride:()=>Al,getDebugStatMultiplierOverride:()=>Vx,setDebugCurrencyMultiplierOverride:()=>G0,setDebugPanelAccess:()=>_1,setDebugStatMultiplierOverride:()=>On});function Bl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function Ox(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function bn(e){typeof e=="function"&&_m.push(e)}function Ju(){return{sections:new Set,subsections:new Set}}function Px(){let e=document.getElementById(Rl);if(!e)return Ju();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function Bx(e){let{sections:t,subsections:n}=R0??Ju();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function B0(){_m.forEach(e=>{try{e?.()}catch{}}),_m=[],Am.length=0}function Dt(e){!e||typeof e.refresh!="function"||Am.push(e)}function ft(e){Am.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function Fx(){if(typeof window>"u")return;let e=h=>{let{key:m,slot:y}=h?.detail??{},g=y??b();ft(v=>v.type==="currency"&&v.key===m&&v.slot===g)};window.addEventListener("currency:change",e,{passive:!0}),bn(()=>window.removeEventListener("currency:change",e));let t=h=>{let{key:m,slot:y}=h?.detail??{},g=y??b();ft(v=>v.type==="currency-mult"&&v.key===m&&v.slot===g)};window.addEventListener("currency:multiplier",t,{passive:!0}),bn(()=>window.removeEventListener("currency:multiplier",t));let n=h=>{let{slot:m,changeType:y,unlocked:g}=h?.detail??{},v=m??b();ft(E=>E.type==="xp"&&E.slot===v),ft(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===v),(y==="unlock"||typeof g=="boolean")&&ft(E=>E.type==="unlock"&&(E.slot==null||E.slot===v))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),bn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=h=>{let{changeType:m,slot:y}=h?.detail??{},g=y??b();ft(v=>v.type==="mutation"&&v.slot===g),ft(v=>v.type==="stat-mult"&&v.key==="mutation"&&v.slot===g),m==="unlock"&&ft(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("mutation:change",o,{passive:!0}),bn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let h=b();ft(m=>m.type==="upgrade"&&m.slot===h),ft(m=>m.type==="currency-mult"&&m.slot===h),ft(m=>m.type==="stat-mult"&&m.slot===h)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),bn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let h=b();ft(m=>m.slot===h)};window.addEventListener("saveSlot:change",i,{passive:!0}),bn(()=>window.removeEventListener("saveSlot:change",i));let s=h=>{let{slot:m,key:y}=h?.detail??{},g=m??b();ft(v=>v.type==="unlock"&&(v.slot==null||v.slot===g)&&(v.key==null||v.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),bn(()=>window.removeEventListener("unlock:change",s));let l=h=>{let{slot:m}=h?.detail??{},y=m??b();ft(g=>g.type==="workshop-level"&&g.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),bn(()=>window.removeEventListener("workshop:change",l));let a=h=>{let{slot:m}=h?.detail??{},y=m??b();ft(g=>g.type==="surge-level"&&g.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),bn(()=>window.removeEventListener("surge:level:change",a));let u=h=>{let{slot:m}=h?.detail??{},y=m??b();ft(g=>g.type==="tsunami-nerf"&&(g.slot==null||g.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),bn(()=>window.removeEventListener("surge:nerf:change",u));let f=h=>{let{slot:m}=h?.detail??{},y=m??b();ft(g=>g.type==="lab-level"&&(g.slot==null||g.slot===y)),ft(g=>g.type==="stat-mult"&&g.key==="rp"&&(g.slot==null||g.slot===y))};window.addEventListener("lab:level:change",f,{passive:!0}),bn(()=>window.removeEventListener("lab:level:change",f));let d=h=>{let{id:m,level:y}=h?.detail??{},g=b();ft(v=>v.type==="lab-node-level"&&v.slot===g&&v.id===m),m===1&&ft(v=>v.type==="tsunami-nerf"&&(v.slot==null||v.slot===g)),m===4&&ft(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("lab:node:change",d,{passive:!0}),bn(()=>window.removeEventListener("lab:node:change",d));let p=h=>{let{id:m,rp:y}=h?.detail??{},g=b();ft(v=>v.type==="lab-node-rp"&&v.slot===g&&v.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),bn(()=>window.removeEventListener("lab:node:rp",p))}function Qu(){return[{key:Se.STARTER_COVE,title:"The Cove",currencies:[{key:ke.COINS,label:"Coins"},{key:ke.BOOKS,label:"Books"},{key:ke.GOLD,label:"Gold"},{key:ke.MAGIC,label:"Magic"},{key:ke.GEARS,label:"Gears"},{key:ke.WAVES,label:"Waves"},{key:ke.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function F0(){if(document.getElementById(Vu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Vu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Vu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Vu,document.head.appendChild(n)}function Mm(){let e=document.getElementById(N0);e&&e.remove()}function Ux(){return Ai&&Je&&b()!=null&&!Bl()&&Ox()}function Dx(e){e?.detail?.visible&&Oo(),nf()}function Wu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${O0++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Rn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${P0++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function At(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Nm(e,t=b()){let n=t??b();return n==null?null:`${bt.CURRENCY[e]}:${n}`}function Tl(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=O?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Ia(n,e)}catch{return c.fromInt(0)}}function $x(e,t,n=b()){let o=n??b(),r=Tl(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=Nm(e,o),s=i&&vo(i);s&&ta(i);let l=r;try{In(o),l=Hi(e,t,{previous:r})??r,i&&lt(i)}catch{}finally{s&&Oi(i)}return ft(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function no(e,t){return`${e??"null"}::${t}`}function Rm(e,t){return Ol.get(no(e,t))??null}function qx(e,t=b()){let n=t??b();return!e||n==null?null:`${bt.MULTIPLIER[e]}:${n}`}function Gx(e,t=b()){let n=no(t,e);Ol.delete(n),Qs.delete(n),ft(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function Om(e,t){let n=!ef(t,e),o=no(e,t),r=Nl.get(o);if(!n&&r)return r;let i=Hx(t,e);return i?(Nl.set(o,i),i):(n&&Nl.delete(o),null)}function U0(e,t){ft(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function D0(e,t=b()){let n=Ri(e,t);if(Nl.delete(no(t,e)),Ci.delete(no(t,e)),!(!n||typeof localStorage>"u")&&!vo(n)){try{localStorage.removeItem(n)}catch{}U0(e,t)}}function ef(e,t=b()){return vo(Ri(e,t))}function $0(e,t){return ef(t,e)?Om(e,t):null}function Pn(e,t=b()){let n=Ni(e);return tf(e,t,n)??n}function Ri(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${Tx}:${e}:${n}`}function Ni(e){try{if(e==="xp"){let t=mc();if(t)return t}else if(e==="mutation"){let t=rf?.();if(t)return t;let n=of();if(n)return n}else if(e==="spawnRate"){let t=fs(Se.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return wc()}catch{}return c.fromInt(1)}function Hx(e,t=b()){let n=Ri(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function Xx(e,t,n){let o=Ri(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=vo(o),s=i&&Js?Js:localStorage.setItem.bind(localStorage);i&&!Js&&ta(o),s(o,r.toStorage?.()??String(r)),i&&!Js&&Oi(o)}catch{}}function Pm(e,t=b()){if(t==null)return;let n=Rm(t,e);if(!n||t!==b())return;let o=no(t,e);if(!Ku.has(o)){Ku.add(o);try{let r=O?.[e]?.mult?.get?.();At(r,n)||O?.[e]?.mult?.set?.(n)}catch{}finally{Ku.delete(o)}}}function q0(){if(!(M0||typeof window>"u")){M0=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=no(r,t);if(!r||!Ol.has(i)||Ku.has(i))return;let s=Qs.get(i),l=Rm(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,p=l.mulBigNumInteger(f);Ol.set(i,p)}}catch{}Qs.set(i,o)}else o&&Qs.set(i,o);Pm(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Fl()},{passive:!0})}catch{}}}function Fl(){let e=b();e!=null&&Object.values(ke).forEach(t=>{Pm(t,e)})}function G0(e,t,n=b()){if(!e||n==null)return null;q0();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=no(n,e);if(Ol.set(r,o),!Qs.has(r)){let i=O?.[e]?.mult?.get?.();Qs.set(r,i)}return Pm(e,n),o}function Al(e,t=b()){return!e||t==null?null:Rm(t,e)}function On(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Nl.set(no(n,e),o),Ci.set(no(n,e),Ni(e)),Xx(e,n,o),U0(e,n),o}function Vx(e,t=b()){return!e||t==null?null:Om(t,e)}function Yn(e,t,n=b()){let o=Ni(e),r=tf(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(At(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=no(n,e),l=Ci.get(s),a=ef(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function tf(e,t,n){let o=Om(t,e),r=no(t,e);if(!o)return Ci.delete(r),null;let i=Ci.get(r),s=ef(e,t);if(!i)Ci.set(r,n);else if(!At(i,n))return s?(Ci.set(r,n),o):(D0(e,t),null);return o}function Yx(){if(!(_0||typeof localStorage>"u")){_0=!0;try{Js=localStorage.setItem.bind(localStorage),C0=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ea.has(e))return Js(e,t)},localStorage.removeItem=e=>{if(!ea.has(e))return C0(e)}}catch{}}}function vo(e){return e!=null&&ea.has(e)}function Oi(e){e&&(Yx(),ea.add(e))}function ta(e){e&&ea.delete(e)}function Wx(e){return e?vo(e)?(ta(e),!1):(Oi(e),!0):!1}function zx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=vo(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(Wx(e),typeof t=="function")try{t(vo(e))}catch{}o()}),o(),{button:n,refresh:o}}function Kx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>vo(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>vo(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?ta(u):Oi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function jx(){let e=document.getElementById(Rl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function Zx(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{vo(r)&&(o.push(r),ta(r))});try{return t?.()}finally{o.forEach(r=>Oi(r))}}function Jx(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function Bm(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function km(e,t){e.classList.toggle("debug-invalid",!t)}function et(){let e=b();try{In(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function H0(e=b()){return e==null?null:`${Ax}:${e}`}function X0(e=b()){let t=H0(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function V0(e,t=b()){let n=H0(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,Cm);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function Qx(e,t=b()){let n=X0(t);return n.unshift(e),n.length>Cm&&(n.length=Cm),V0(n,t),n}function tt(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};Qx(o,t),Fm()}function Fm(){if(!Zs)return;let e=X0();if(e.length===0){Zs.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",Zs.appendChild(t);return}Zs.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function Y0(e=b()){return e==null?null:`${ol}:${e}`}function W0(e,t=b()){let n=Y0(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function z0(e=b()){let t=Y0(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function e1(e){if(e){if(Object.values(ke).includes(e.type)){try{e.type===ke.BOOKS?O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount):O[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function t1(){let e=b();if(e==null)return{completed:0};let t=z0(e),n=0;return Object.entries(Wc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,e1(r.reward))}),W0(t,e),{completed:n}}function n1(){let e=b();if(e==null)return{restored:0};let t=z0(e),n=0;return Object.entries(Wc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),W0(t,e),{restored:n}}function sn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,p=!1,h=r?zx(r,{onToggle:i}):null,m=g=>{if(f){d=g;return}d=null,u.value=typeof s=="function"?s(g):Jx(g)};l.appendChild(u),h&&l.appendChild(h.button);let y=()=>{let g=Bm(u.value);if(!g){km(u,!1);return}km(u,!0);let v=r&&vo(r);v&&ta(r);try{n(g,{input:u,setValue:m})}finally{v&&Oi(r),h&&h.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",y),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),p=!0,y(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,p||y(),p=!1,d!=null){let g=d;d=null,m(g)}}),m(t),h&&h.refresh(),{row:l,input:u,setValue:m,isEditing:()=>f}}function o1({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let y=document.createElement("span");y.className="debug-unlock-desc",y.textContent=`- ${t}`,f.appendChild(y)}s.appendChild(l),s.appendChild(f);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",y=>{l.contains(y.target)||p()});let h=!1,m=()=>{let y=!1;try{y=typeof n=="function"?!!n():!1}catch{}return a.checked=y,h=y,y};return a.addEventListener("change",()=>{let y=h,g=a.checked;try{g?o?.():r?.()}catch{}et();let v=m();y!==v&&tt(`Toggled ${e} [GOLD]${y?"True":"False"}[/GOLD] \u2192 [GOLD]${v?"True":"False"}[/GOLD]`)}),m(),Dt({type:"unlock",slot:i,refresh:m}),s}function r1(e){try{if(e instanceof c||typeof e?.toScientific=="function")return ne(e);let t=Number(e);return Number.isFinite(t)?ne(t):String(e??"\u2014")}catch{return"\u2014"}}function i1({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:p})=>{if(d.type==="select"){u[d.key]=p.value;return}let h=Bm(p.value),m=h instanceof c;if(km(p,m),!m){f=!0;return}u[d.key]=h}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=r1(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:p,label:h})=>{let m=document.createElement("option");m.value=p,m.textContent=h??p,f.defaultValue!=null&&f.defaultValue===p&&(m.selected=!0),d.appendChild(m)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function $r({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return rt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Zr()}catch{}let f=Mi.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(lt(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),p=Mi.level(n);localStorage.setItem(p,d),lt(p,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),p=Mi.progress(n);localStorage.setItem(p,d),lt(p,d)}catch{}try{Zi({forceReload:!0})}catch{}try{dc({changeType:"debug-panel",slot:n})}catch{}try{ft()}catch{}}function qr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return mt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Pl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Jt()}catch{}try{Pr()}catch{}let f=ki.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(lt(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),p=ki.level(n);localStorage.setItem(p,d),lt(p,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),p=ki.progress(n);localStorage.setItem(p,d),lt(p,d)}catch{}try{Jt({forceReload:!0})}catch{}try{Um({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ft()}catch{}}function s1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=Nm(r.key,n),s=Tl(r.key,n),l=sn(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=Tl(r.key,f),{next:p}=$x(r.key,a,f);u(p),At(d,p)||(et(),tt(`Modified ${r.label} (${o}) ${ne(d)} \u2192 ${ne(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(Tl(r.key,b()))});Dt({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=Tl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function a1(e,t){let n=b();if(n==null){let B=document.createElement("div");B.className="debug-panel-empty",B.textContent="Select a save slot to edit stats.",e.appendChild(B);return}let o="spawnRate",r=Ri(o,n),i=sn("Coin Spawn Rate",Pn(o,n),(B,{setValue:G})=>{let _=b();if(_==null)return;let U=Pn(o,_);try{On(o,B,_)}catch{}let M=Pn(o,_);G(M),At(U,M)||(et(),tt(`Modified Spawn Rate (${a}) ${ne(U)} \u2192 ${ne(M)}`))},{storageKey:r,onLockChange:B=>{let G=b();if(G!=null){if(B){if($0(G,o))return;try{On(o,Ni(o),G)}catch{}}else tf(o,G,Ni(o));i.setValue(Pn(o,G))}}});Dt({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let B=Pn(o,n);i.setValue(B)}}),Dt({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let B=Pn(o,n);i.setValue(B)}}),e.appendChild(i.row);let s=rt(),l=mt(),a=t?.title??t?.key??"Unknown Area",u=Mi.level(n),f=sn("XP Level",s.xpLevel,(B,{setValue:G})=>{let _=rt().xpLevel;$r({level:B});let U=rt();G(U.xpLevel),At(_,U.xpLevel)||(et(),tt(`Modified XP Level (${a}) ${ne(_)} \u2192 ${ne(U.xpLevel)}`))},{storageKey:u});Dt({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(rt().xpLevel)}}),e.appendChild(f.row);let d=Mi.progress(n),p=sn("XP Progress",s.progress,(B,{setValue:G})=>{let _=rt(),U=_?.xpLevel?.clone?.()??_?.xpLevel,M=_?.progress?.clone?.()??_?.progress;$r({progress:B});let L=rt();G(L.progress),f.setValue(L.xpLevel),(!At(M,L.progress)||!At(U,L.xpLevel))&&(et(),tt(`Modified XP Progress (${a}) ${ne(M)} \u2192 ${ne(L.progress)}`))},{storageKey:d});Dt({type:"xp",slot:n,refresh:()=>{n===b()&&p.setValue(rt().progress)}}),e.appendChild(p.row);let h=ki.level(n),m=sn("MP Level",l.level,(B,{setValue:G})=>{let _=mt().level;qr({level:B});let U=mt();G(U.level),At(_,U.level)||(et(),tt(`Modified MP Level (${a}) ${ne(_)} \u2192 ${ne(U.level)}`))},{storageKey:h});Dt({type:"mutation",slot:n,refresh:()=>{n===b()&&m.setValue(mt().level)}}),e.appendChild(m.row);let y=ki.progress(n),g=sn("MP Progress",l.progress,(B,{setValue:G})=>{let _=mt(),U=_?.level?.clone?.()??_?.level,M=_?.progress?.clone?.()??_?.progress;qr({progress:B});let L=mt();G(L.progress),m.setValue(L.level),(!At(M,L.progress)||!At(U,L.level))&&(et(),tt(`Modified MP Progress (${a}) ${ne(M)} \u2192 ${ne(L.progress)}`))},{storageKey:y});Dt({type:"mutation",slot:n,refresh:()=>{n===b()&&g.setValue(mt().progress)}}),e.appendChild(g.row);let v=gi(n);if(v){let B=0;try{let _=localStorage.getItem(v),U=c.fromAny(_||"0");if(U.isInfinite())B=1/0;else try{B=Number(U.toScientific(20))}catch{B=0}}catch{}let G=sn("Workshop Level",B,(_,{setValue:U})=>{let M=Number(_);if(_ instanceof c)if(_.isInfinite())M=1/0;else try{M=Number(_.toScientific(20))}catch{M=NaN}if(Number.isNaN(M)||M<0)return;let L=M===1/0?"Infinity":String(Math.floor(M));try{localStorage.setItem(v,L),et(),tt(`Modified Workshop Level (The Cove) ${ne(B)} \u2192 ${L}`),B=M}catch{}U(M)},{storageKey:v,onLockChange:()=>{let _=0;try{let U=localStorage.getItem(v),M=c.fromAny(U||"0");M.isInfinite()?_=1/0:_=Number(M.toScientific(20))}catch{}G.setValue(_)}});e.appendChild(G.row),Dt({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let _=0;try{let U=localStorage.getItem(v),M=c.fromAny(U||"0");M.isInfinite()?_=1/0:_=Number(M.toScientific(20))}catch{}G.setValue(_)}})}let E=Ds(n);if(E){let B=0;try{let _=localStorage.getItem(E);_==="Infinity"?B=1/0:B=c.fromAny(_||"0")}catch{B=c.fromInt(0)}let G=sn("Surge Level",B,(_,{setValue:U})=>{let M="0",L=0;_ instanceof c?_.isInfinite()?(M="Infinity",L=1/0):(M=_.toPlainIntegerString(),L=_):_===1/0||typeof _=="string"&&/infinity/i.test(_)?(M="Infinity",L=1/0):(M=String(_),L=_);try{localStorage.setItem(E,M),et();let V=L===1/0?"Infinity":ne(L),J=B===1/0||B instanceof c&&B.isInfinite()?"Infinity":ne(B);tt(`Modified Surge Level (The Cove) ${J} \u2192 ${V}`),L===1/0?B=1/0:L instanceof c?B=L:B=c.fromAny(L);let se=!1;B===1/0?se=!0:B instanceof c?typeof B.cmp=="function"&&B.cmp(8)>=0&&(se=!0):typeof B=="number"&&B>=8&&(se=!0),se&&(pi(0),dn()||Ko(!0))}catch{}U(L);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let V=B;if(V!==1/0&&V instanceof c)try{V=BigInt(V.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:V}}))}catch{}},{storageKey:E,onLockChange:_=>{let U=c.fromInt(0);try{let M=localStorage.getItem(E);M==="Infinity"?U=1/0:U=c.fromAny(M||"0")}catch{}G.setValue(U)}});Dt({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let _=c.fromInt(0);try{let U=localStorage.getItem(E);U==="Infinity"?_=1/0:_=c.fromAny(U||"0")}catch{}G.setValue(_)}}),e.appendChild(G.row)}let C=zt(),A=sn("Lab Level",C,(B,{setValue:G})=>{let _;try{_=B instanceof c?B:c.fromAny(B),_.isNegative&&_.isNegative()&&(_=c.fromInt(0))}catch{G(zt());return}let U=zt();si(_),et(),At(U,_)||tt(`Modified Lab Level (The Cove) ${ne(U)} \u2192 ${ne(_)}`),G(_)},{storageKey:ud(n)});Dt({type:"lab-level",slot:n,refresh:()=>{n===b()&&A.setValue(zt())}}),e.appendChild(A.row);let N=()=>{let B=xn(),G=Lo(),_=B+G;return _>1&&(_=1),_},X=sn("Tsunami Exponent",N().toFixed(2),(B,{setValue:G})=>{let _=Number(B);if(B instanceof c?B.isInfinite()?_=1/0:_=Number(B.toScientific(10)):typeof B=="string"&&/infinity/i.test(B)&&(_=1/0),Number.isNaN(_)){G(N().toFixed(2));return}let U=Lo(),M=_-U;M>1&&(M=1),M<0&&(M=0),M=Math.round(M*100)/100;let L=xn();pi(M),et(),Math.abs(L-M)>1e-4&&tt(`Modified Tsunami Exponent (The Cove) Base:${L.toFixed(2)} \u2192 ${M.toFixed(2)} (Effective: ${_.toFixed(2)})`),G(N().toFixed(2))},{storageKey:Td(n),format:B=>{let G=Number(B);return Number.isFinite(G)?G.toFixed(2):String(B)}});Dt({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let B=N();X.setValue(B.toFixed(2))}}),e.appendChild(X.row)}function Lm(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Ct(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=Ln(t.key,i.id??i.tie),u=_i(t.key,i.id??i.tie,n),f=sn(l,a,(d,{setValue:p})=>{if(b()==null)return;let m=Ln(t.key,i.id??i.tie);try{or(t.key,i.id??i.tie,d,!1)}catch{}let y=Ln(t.key,i.id??i.tie);p(y),At(m,y)||(et(),tt(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${ne(m)} \u2192 Lv${ne(y)}`))},{idLabel:s,storageKey:u});Dt({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=Ln(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function l1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=O?.[r.key]?.mult,l=Al(r.key,n)??i?.get?.()??c.fromInt(1),a=`${bt.MULTIPLIER[r.key]}:${n}`,u=sn(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let p=b();if(p==null)return;let h=Al(r.key,p)??i?.get?.()??c.fromInt(1);try{G0(r.key,f,p)}catch{}Fl();let y=Al(r.key,p)??i?.get?.()??c.fromInt(1);d(y),At(h,y)||(et(),tt(`Modified ${r.label} Multiplier (${o}) ${ne(h)} \u2192 ${ne(y)}`))},{storageKey:a});Dt({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=Al(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function c1(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(ke).forEach(o=>{let r=O?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||At(i,t))return;r.set(t),n+=1}catch{}}),n}function u1(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(ke).forEach(o=>{let r=O?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function f1(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=rt()}catch{}try{r=mt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||At(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||At(o?.progress,t);(!i||!s)&&($r({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||At(r?.level,t),s=r?.progress?.isInfinite?.()||At(r?.progress,t);(!i||!s)&&(qr({level:t,progress:t}),n+=1)}}catch{}try{let i=gi(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Ds(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ft()}catch{}return n}function d1(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=rt()}catch{}try{r=mt()}catch{}try{o?.unlocked&&($r({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(qr({level:t,progress:t}),n+=1)}catch{}try{let i=gi(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Ds(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ft()}catch{}return n}function K0(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!rt()?.unlocked}catch{return!1}},onEnable:()=>{try{Zr()}catch{}try{Zi({forceReload:!0})}catch{}},onDisable:()=>{try{Ji({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Pl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{Pl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return ap()}catch{return!1}},onEnable:()=>{try{Si()}catch{}},onDisable:()=>{try{au()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return lp()}catch{return!1}},onEnable:()=>{try{su()}catch{}},onDisable:()=>{try{lu()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return Jd()}catch{return!1}},onEnable:()=>{try{Vc(!0)}catch{}},onDisable:()=>{try{Vc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!dn()}catch{return!1}},onEnable:()=>{try{Ko(!0)}catch{}},onDisable:()=>{try{Ko(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return ut(4)>=1}catch{return!1}},onEnable:()=>{try{Er(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{Er(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function j0(e){let t=b();if(t==null)return 0;let n=0;K0(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{ft()}catch{}return n}function p1(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;Qu().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Li(o.key,r,e),t+=1}catch{}})});try{Si()}catch{}try{su()}catch{}let n=j0(!0);return{unlocks:t,toggles:n}}function m1(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;Qu().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{vm(o.key,r,e),t+=1}catch{}})});try{au()}catch{}try{lu()}catch{}let n=j0(!1);return{locks:t,toggles:n}}function h1(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(Nm(a,n)),r(qx(a,n))},s=a=>r(Ri(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(Mi.level(n)),r(Mi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(ki.level(n)),r(ki.progress(n)))};return e==="all"?(Object.values(ke).forEach(i),l("xp"),l("mutation"),Zu.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(ke).forEach(i),Array.from(o)):e==="allUnlockedStats"?(rt()?.unlocked&&l("xp"),mt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(ke).forEach(i),rt()?.unlocked&&l("xp"),mt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function zu(e){try{O?.[e]?.set?.(c.fromInt(0))}catch{}try{Gx(e)}catch{}try{oc(e,c.fromInt(1))}catch{}}function g1(e){if(e==="all"){Object.values(ke).forEach(i=>zu(i));let o=c.fromInt(0);return $r({level:o,progress:o}),qr({level:o,progress:o}),Zu.forEach(({key:i})=>{try{On(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(ke).length+Zu.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(ke).forEach(i=>{zu(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(rt()?.unlocked){$r({level:o,progress:o});try{On("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(mt()?.unlocked){qr({level:o,progress:o});try{On("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(ke).forEach(l=>{zu(l),o+=1});let r=c.fromInt(0),i=0;try{if(rt()?.unlocked){$r({level:r,progress:r});try{On("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(mt()?.unlocked){qr({level:r,progress:r});try{On("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return zu(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{D0(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){$r({level:n,progress:n});try{On("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){qr({level:n,progress:n});try{On("mutation",c.fromInt(1))}catch{}return"MP"}try{On(t,c.fromInt(1))}catch{}return`stat ${t}`}function y1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";Zu.forEach(r=>{if(r.key==="spawnRate")return;let i=Ri(r.key,n),s=sn(`${r.label} Multiplier`,Pn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Pn(r.key,u);try{On(r.key,l,u)}catch{}let d=Pn(r.key,u);a(d),At(f,d)||(et(),tt(`Modified ${r.label} Multiplier (${o}) ${ne(f)} \u2192 ${ne(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if($0(a,r.key))return;try{On(r.key,Ni(r.key),a)}catch{}}else tf(r.key,a,Ni(r.key));s.setValue(Pn(r.key,a))}}});Dt({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Pn(r.key,n);s.setValue(l)}}),Dt({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Pn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Dt({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Pn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function v1(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Ut||Ut.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Ut.forEach(n=>{let o=Rn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=Va(t,n.id),s=sn("Level",ut(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let p=ut(n.id);Er(n.id,d),et(),p!==d&&tt(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${d}`),f(d)},{storageKey:i});Dt({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(ut(n.id))}}),r.appendChild(s.row);let l=Ya(t,n.id),a=sn("Current RP",ao(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(ao(n.id));return}let p=ao(n.id);gs(n.id,d),et(),At(p,d)||tt(`Modified Node ${n.id} RP (The Cove) ${ne(p)} \u2192 ${ne(d)}`),f(d)},{storageKey:l});Dt({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(ao(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function b1(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)},{label:"Pending DNA (Experiment)",inputs:[{key:"labLevel",label:"Lab Level"},{key:"xpLevel",label:"XP Level"},{key:"isSurge9",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 9? No"},{value:"Yes",label:"Surge 9? Yes"}]}],compute:({labLevel:n,xpLevel:o,isSurge9:r})=>window.resetSystem?.computePendingDnaFromInputs?.(n,o,r==="Yes")}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>pc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Jf(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Dm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Us(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>Cr(n)},{label:"Lab Level RP Boost",inputs:[{key:"level",label:"Lab Level"}],compute:({level:n})=>{let o=0;if(n instanceof c){if(n.isInfinite())return c.fromAny("Infinity");try{o=Number(n.toScientific(10))}catch{o=0}}else o=Number(n);if(!Number.isFinite(o))return c.fromInt(1);let r=o*Math.log10(2);return _e(r)}}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>bm(n,o,r)}]}].forEach(n=>{let o=Rn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=i1({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function S1(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Fl(),Qu().forEach(o=>{let r=Rn(o.title,i=>{let s=Rn("Currencies",m=>{s1(m,o)}),l=Rn("Stats",m=>{a1(m,o)}),a=Rn("Multipliers",m=>{let y=Rn("Currencies",v=>{l1(v,o)}),g=Rn("Stats",v=>{y1(v,o)});m.appendChild(y),m.appendChild(g)}),u=Rn("Upgrades",m=>{Lm(m,o)}),f=null,d=null,p=null;o.key===Se.STARTER_COVE&&(f=Rn("Automation Upgrades",m=>{Lm(m,{key:Se.AUTOMATION,title:"Automation"})}),d=Rn("DNA Upgrades",m=>{Lm(m,{key:Se.DNA,title:"DNA"})}),p=Rn("Lab Nodes",m=>{v1(m)}));let h=Rn("Calculators",m=>{b1(m)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),p&&i.appendChild(p),i.appendChild(h)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function k0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Se),r=[];return o.forEach(i=>{Ct(i).forEach(l=>{e&&ko(i,l.id).locked||r.push({areaKey:i,upg:l})})}),Ll(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;or(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function T0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Se),r=[];o.forEach(s=>{Ct(s).forEach(a=>{e&&ko(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{Ll(()=>{r.forEach(({areaKey:s,upg:l})=>{try{wr(s,l.id,"0"),or(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function A0(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Ct(Ze);Ll(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;or(Ze,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(is),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Se).forEach(l=>{if(l===Ze)return;Ct(l).forEach(u=>{s.has(u.costType)&&(wr(l,u.id,n),o++)})}),wr(Ze,so,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function I1(e){e.innerHTML="";let t=b();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=t1();et(),tt(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=n1();et(),tt(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=c1();et(),tt(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=f1();et(),tt(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=u1();et(),tt(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=d1();et(),tt(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let g=k0(!0);et(),tt(`Maxed ${g} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let g=T0(!0);et(),tt(`Reset ${g} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let g=k0(!1);et(),tt(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=T0(!1);et(),tt(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=A0(!0);et(),tt(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=A0(!1);et(),tt(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:v}=p1();et(),tt(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:v}=m1();et(),tt(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{V0([],t),Fm(),et(),tt("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=b();if(g!=null)try{localStorage.setItem(Nx(g),String(Rx)),jo(!0),et(),tt("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let v=Bm(g);if(!v||typeof v.isZero=="function"&&v.isZero()||typeof v.isNegative=="function"&&v.isNegative())return;let E,C=!1;$t()?E=ws(v):(E=Uc(v),C=!0),yi(E);let A=v.mulSmall?v.mulSmall(1e3):v.mulBigNumInteger(c.fromInt(1e3));Mr(E,A,C),et(),tt(`Performed OP Time Warp for ${ne(v)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle debug-misc-button",v.textContent=g.label,v.addEventListener("click",g.onClick),o.appendChild(v)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",Qu().forEach(g=>{let v=document.createElement("optgroup");v.label=g.title||g.key,g.currencies.forEach(E=>{let C=document.createElement("option");C.value=`currency:${E.key}`,C.textContent=`${g.title||g.key} \u2192 ${E.label}`,v.appendChild(C)}),g.stats.forEach(E=>{let C=document.createElement("option");C.value=`stat:${E.key}`,C.textContent=`${g.title||g.key} \u2192 ${E.label}`,v.appendChild(C)}),s.appendChild(v)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${Yu}"]`)||(Yu=kl),s.value=Yu;let d=()=>h1(s.value||kl,b()),p=Kx(d);s.addEventListener("change",()=>{Yu=s.value||kl,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle reset-check",h.textContent="\u2705",h.addEventListener("click",()=>{let g=s.value||kl,v=d(),E=p.isLocked(),C=(A=!0)=>{let N=Zx(v,()=>g1(g))??{label:g,count:0};if(E&&v.forEach(X=>Oi(X)),p.refresh(),et(),A){let{label:X,count:B}=N;tt(`Reset ${B===1?"value and multiplier":"values and multipliers"} for ${X} to defaults.`)}};C(!0),setTimeout(()=>C(!1),100)}),r.appendChild(h),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-danger-button",y.textContent="Wipe Slot & Refresh",y.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let v=document.querySelector(".menu-root"),E=document.getElementById("game-root");v&&(v.hidden=!1,v.style.display="",v.style.visibility=""),E&&(E.hidden=!0,E.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(y),e.appendChild(m)}function w1(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Zi()}catch{}let n=K0(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(o1(o))})}function Z0(){if(!Ai||Bl())return;B0(),F0(),O0=0,P0=0;let e=document.getElementById(Rl);e&&e.remove();let t=document.createElement("div");t.id=Rl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Oo({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Oo()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let p=document.createElement("div");p.className="debug-panel-info-line",d&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=f,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(Wu("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{S1(f)})),t.appendChild(Wu("Unlocks: modify specific unlock flags","debug-unlocks",f=>{w1(f)})),t.appendChild(Wu("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),Zs=d,Fm(),bn(()=>{Zs=null})})),t.appendChild(Wu("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{I1(f)})),Bx(t),document.body.appendChild(t),ju>0)try{t.scrollTop=ju}catch{}Fx(),Ti=!0}function Tm(){if(!(!Ai||Bl())){if(b()==null){Oo();return}Ti||Z0()}}function Oo({preserveExpansionState:e=!1}={}){R0=e?Px():Ju();let t=document.getElementById(Rl);if(t){try{ju=t.scrollTop??0}catch{ju=0}t.remove()}B0(),Ti=!1}function E1(){if(!Ai||Bl()||b()==null){Oo();return}Ti?Oo({preserveExpansionState:!0}):Tm()}function x1(){Oo(),Mm()}function nf(){if(!Ux()){Mm(),Oo();return}F0(),Mm();let e=document.createElement("button");e.id=N0,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{E1()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function L1(e){if(Ai=!!e,!Ai){x1();return}nf()}function _1(e){L1(e)}var Vu,Rl,N0,kl,Ti,Ai,_m,R0,ju,Yu,O0,P0,Am,Zs,Ol,Qs,Ku,Nl,Ci,ea,_0,Js,C0,Tx,Ax,Cm,Nx,Rx,Em,Mi,xm,ki,Zu,M0,es=De(()=>{Et();Yt();St();Vn();Co();co();lo();cu();jc();ms();_o();Wn();ps();oi();qd();ai();li();Dc();Vu="debug-panel-style",Rl="debug-panel",N0="debug-panel-toggle",kl=`currency:${ke.COINS}`,Ti=!1,Ai=!1,_m=[],R0=Ju(),ju=0,Yu=kl,O0=0,P0=0,Am=[],Zs=null,Ol=new Map,Qs=new Map,Ku=new Set,Nl=new Map,Ci=new Map,ea=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=ea);_0=!1,Js=null,C0=null,Tx="ccc:debug:stat-mult",Ax="ccc:actionLog",Cm=100,Nx=e=>`ccc:warp:charges:${e}`,Rx=24;Em="ccc:xp",Mi={unlock:e=>`${Em}:unlocked:${e}`,level:e=>`${Em}:level:${e}`,progress:e=>`${Em}:progress:${e}`},xm="ccc:mutation",ki={unlock:e=>`${xm}:unlocked:${e}`,level:e=>`${xm}:level:${e}`,progress:e=>`${xm}:progress:${e}`},Zu=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];M0=!1;Fl();q0();document.addEventListener("keydown",e=>{if(!(!Ai||Bl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){Ti?(jx(),Oo()):Tm(),e.preventDefault();return}Ti?Oo({preserveExpansionState:!0}):Tm(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{nf()});window.addEventListener("menu:visibilitychange",Dx);window.addEventListener("saveSlot:change",()=>{nf(),Ti&&Z0()})});var nb={};vt(nb,{addExternalMutationGainMultiplierProvider:()=>fi,addMutationPower:()=>xs,broadcastMutationChange:()=>Um,computeMutationMultiplierForLevel:()=>Us,computeMutationRequirementForLevel:()=>Dm,getMutationCoinSprite:()=>Qp,getMutationGainMultiplier:()=>rf,getMutationMultiplier:()=>of,getMutationState:()=>mt,getTotalCumulativeMp:()=>El,initMutationSystem:()=>Jt,isMutationUnlocked:()=>Ao,onMutationChange:()=>xi,setMutationUnlockedForDebug:()=>Pl,unlockMutationSystem:()=>Pr});function sf(e){try{return e?.toStorage?.()}catch{return null}}function Ui(){try{tn()}catch{}}function tb(e){let t=e;if(!t.isZero?.()){let n=Fi.size>0?Array.from(Fi):typeof $l=="function"?[$l]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof Qe?t=r.clone?.()??r:r!=null&&(t=Qe.fromAny(r))}catch{}}return t}function k1(){if(typeof $m=="function"){try{$m()}catch{}$m=null}if(typeof qm=="function"){try{qm()}catch{}qm=null}}function ql(e){if(e instanceof Qe)try{return e.clone?.()??Qe.fromAny(e)}catch{return gt()}try{return Qe.fromAny(e??0)}catch{return gt()}}function T1(e){if(!e||typeof e!="object")return gt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?Qe.fromInt(100):Qe.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function lf(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ne(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function zm(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(f+=M1*(p-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=lf(e);if(!Number.isFinite(n))return Qe.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return Qe.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return Qe.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return Qe.fromAny("Infinity");let i=_e(r);return T1(i)}function Gr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=zm(D.level);D.requirement=n}function A1(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=Ne(e),l=Ne(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Vm(){return Bn.container&&Bn.container.isConnected?!0:(Bn.container=document.querySelector("[data-mp-hud].mp-counter"),Bn.container?(Bn.bar=Bn.container.querySelector(".mp-bar"),Bn.fill=Bn.container.querySelector(".mp-bar__fill"),Bn.levelValue=Bn.container.querySelector(".mp-level-value"),Bn.progress=Bn.container.querySelector("[data-mp-progress]"),!0):!1)}function Pi(e){try{return ne(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function cr(){if(!Vm())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Bn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Pi(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Pi(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Wi();return}e.removeAttribute("hidden");let i=D.requirement,s=A1(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Pi(D.level)),r){let a=Pi(D.progress),u=Pi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Pi(D.progress).replace(/<[^>]*>/g,""),u=Pi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Wi()}function ur(e="update",t={}){let n=mt(),o={...n,slot:D.slot??b(),changeType:e,...t};if(Xm.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function Km(){let e=D.slot;if(e==null&&(e=b(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(Ul(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Bi(e),D.level.toStorage())}catch{}try{localStorage.setItem(na(e),D.progress.toStorage())}catch{}lt(Ul(e)),lt(Bi(e)),lt(na(e));let t=(()=>{let u=D.unlocked,f=D.level,d=D.progress;try{u=localStorage.getItem(Ul(e))==="1"}catch{}try{let p=localStorage.getItem(Bi(e));p&&(f=Qe.fromAny(p))}catch{}try{let p=localStorage.getItem(na(e));p&&(d=Qe.fromAny(p))}catch{}return{unlocked:u,level:f,progress:d}})(),n=sf(t.level),o=sf(t.progress),r=sf(D.level),i=sf(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&af(t,{skipPersist:!0})}function Ym(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function N1(){if(!D.unlocked)return;let e=D.slot??b();if(e!=null&&Ym(Bi(e))){Gr();return}Gr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(oa()),Gr(),t=D.requirement,!t||typeof t!="object"){D.progress=gt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=gt())}function af(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=ql(e.level),D.progress=ql(e.progress),D.unlocked||(D.level=gt(),D.progress=gt()),Gr(),t||Km(),cr(),ur("load"),Ui()}function Gm(e){let t=e??b();if(t==null){af({unlocked:!1,level:gt(),progress:gt()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=gt(),r=gt();try{n=localStorage.getItem(Ul(t))==="1"}catch{}try{let i=localStorage.getItem(Bi(t));i&&(o=Qe.fromAny(i))}catch{}try{let i=localStorage.getItem(na(t));i&&(r=Qe.fromAny(i))}catch{}af({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function R1(){for(;Dl.length;){let e=Dl.pop();try{e?.()}catch{}}}function Hm(e){Q0!==e&&(R1(),Q0=e,e!=null&&(Dl.push(kt(Ul(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=gt(),D.progress=gt()),Gr(),cr(),ur("storage"),Ui())}})),Dl.push(kt(Bi(e),{onChange(t){if(t)try{let n=Qe.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Gr(),cr(),ur("storage"),Ui())}catch{}}})),Dl.push(kt(na(e),{onChange(t){if(t)try{let n=Qe.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Gr(),cr(),ur("storage"))}catch{}}}))))}function Jt({forceReload:e=!1}={}){if(k1(),eb){let n=b();return(n!==D.slot||e)&&Gm(n),Hm(n),Vm(),cr(),mt()}eb=!0,Vm();let t=b();return D.slot=t,Gm(t),Hm(t),cr(),Ui(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();D.slot=n,Gm(n),Hm(n),cr(),Ui(),ur("slot")}),mt()}function mt(){return{unlocked:D.unlocked,level:ql(D.level),progress:ql(D.progress),requirement:ql(D.requirement)}}function Ao(){return!!D.unlocked}function Pr(){return Jt(),D.unlocked?!1:(D.unlocked=!0,Gr(),Km(),cr(),ur("unlock"),Ui(),!0)}function Pl(e){Jt();let t=!!e;af({unlocked:t,level:t?D.level:gt(),progress:t?D.progress:gt()})}function xs(e){Jt();let t=D.slot??b();if(t!=null&&Ym(na(t))||!D.unlocked)return mt();let n=t!=null&&Ym(Bi(t));if(D.level&&D.level.isInfinite?.()){let f=D.level.clone?.()??D.level,d=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=Qe.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=Qe.fromAny("Infinity")}catch{}let p;try{p=e instanceof Qe?e:Qe.fromAny(e??0)}catch{p=gt()}return p=tb(p),p=Yn("mutation",p),ur("progress",{delta:p.clone?.()??p,levelsGained:gt(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof Qe?e:Qe.fromAny(e??0)}catch{o=gt()}if(o=tb(o),o=Yn("mutation",o),o.isZero?.())return mt();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=Qe.fromAny("Infinity")}catch{}try{D.progress=Qe.fromAny("Infinity")}catch{D.progress=gt()}try{D.requirement=Qe.fromAny("Infinity")}catch{}}else N1();Km(),cr();let a=D.level.sub(i);return a.isZero?.()||Ui(),ur("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Um(e={}){Jt();let t=e.changeType??"manual";return ur(t,e)}function Us(e){let t;if(e instanceof Qe)try{t=e.clone?.()??e}catch{t=gt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=gt()}else try{t=c.fromAny(e??0)}catch{t=gt()}if(t&&t.isInfinite?.())try{return Qe.fromAny("Infinity")}catch{return oa()}let n=lf(t);if(!Number.isFinite(n))try{return Qe.fromAny("Infinity")}catch{return oa()}if(n<=0)return oa();let o=n*C1;return _e(o)}function Dm(e){let t;try{t=e instanceof Qe?e:Qe.fromAny(e??0)}catch{t=gt()}try{return zm(t)}catch{return gt()}}function of(){if(Jt(),!D.unlocked)return oa();try{return Us(D.level)}catch{return oa()}}function rf(){let e=c.fromInt(1);if(Fi.size>0||$l){let t=Fi.size>0?Array.from(Fi):typeof $l=="function"?[$l]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof Qe?e=o.clone?.()??o:o!=null&&(e=Qe.fromAny(o))}catch{}}return e}function Qp(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=lf(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function xi(e){return typeof e!="function"?()=>{}:(Xm.add(e),()=>{Xm.delete(e)})}function fi(e){return typeof e!="function"?()=>{}:(Fi.add(e),()=>{Fi.delete(e)})}function El(){if(Jt(),!D.unlocked)return gt();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=lf(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=zm(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Wm,Ul,Bi,na,Qe,gt,oa,C1,M1,D,Bn,Xm,Dl,Q0,eb,$m,qm,Fi,$l,Co=De(()=>{Et();St();es();Yt();Et();qf();Vn();Wm="ccc:mutation",Ul=e=>`${Wm}:unlocked:${e}`,Bi=e=>`${Wm}:level:${e}`,na=e=>`${Wm}:progress:${e}`,Qe=c,gt=()=>Qe.fromInt(0),oa=()=>Qe.fromInt(1),C1=Math.log10(2),M1=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:gt(),progress:gt(),requirement:gt(),slot:null},Bn={container:null,bar:null,fill:null,levelValue:null,progress:null},Xm=new Set,Dl=[],Q0=null,eb=!1,$m=null,qm=null,Fi=new Set,$l=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Jt,unlockMutationSystem:Pr,addMutationPower:xs,getMutationState:mt,getMutationMultiplier:of,isMutationUnlocked:Ao,getTotalCumulativeMp:El,addExternalMutationGainMultiplierProvider:fi,getMutationGainMultiplier:rf}))});var Gl,ob,rb,jm,Zm,Jm,ib=De(()=>{Gl=`precision highp float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,ob=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\n\nvoid main() {\n    /* Wave animation settings */\n    float speed = 1.2;\n    float time = uTime * speed;\n    \n    /* Combine sine waves for a more natural look */\n    /* vUv.x is 0..1 across the screen width */\n    float wave1 = sin(vUv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n\n    /* Define the shoreline height (baseline) */\n    /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */\n    /* We want to discard pixels below this threshold */\n    float threshold = 0.428 + wave; \n\n    if (threshold > vUv.y) {\n        discard;\n    }\n\n    /* Recalculate gradient based on the new "bottom" */\n    /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */\n    float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0);\n    \n    vec3 col = mix(uColorShallow, uColorDeep, gradientY);\n    \n    /* Add a subtle "foam" or highlight at the edge */\n    float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold);\n    col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4);\n    \n    gl_FragColor = vec4(col, 1.0);\n}`,rb=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uWaveMap; \nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\nuniform vec3 uColorWaveDeep;  \nuniform vec3 uColorWave;      \n\n/* Simple noise for foam breakup */\nfloat hash(vec2 p) {\n    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\n}\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f*f*(3.0-2.0*f);\n    return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),\n               mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y);\n}\n\nvoid main() {\n    vec2 uv = vUv;\n    \n    /* Sample the simulation (physics) */\n    /* Wave Logic */\n    vec2 waveUV = uv - vec2(0.0, 0.0285);\n    float intensity = texture2D(uWaveMap, waveUV).r;\n    \n    /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */\n    float shadowOffset = 8.0 / uResolution.y; \n    float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r;\n    \n    /* Discard only if BOTH are empty */\n    if (0.01 > intensity && 0.01 > shadowIntensity) discard;\n    \n    /* Directional Noise: Streaky vertical noise for rushing water effect */\n    /* Stretch heavily along Y-axis to simulate speed/motion blur */\n    float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0));\n    \n    /* Define Zones based on Intensity */\n    /* Body (Medium Intensity): Darker/turbulent blue with noise */\n    /* Edge (High Intensity): Bright white foam */\n    \n    float foamThreshold = 0.5;\n    float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity);\n    \n    /* Base Colors */\n    vec3 bodyColor = uColorWaveDeep;\n    vec3 foamColor = uColorWave;\n    \n    /* Mix Colors */\n    vec3 finalColor = mix(bodyColor, foamColor, foamMix);\n    \n    /* Add streaks to the body part */\n    if (0.9 > foamMix) {\n        finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix);\n    }\n    \n    /* Hard Edge & Opacity */\n    /* Ensure the front (bottom) remains sharp, back trails off */\n    \n    /* Calculate Alpha based on Intensity */\n    /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */\n    /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */\n    /* Low Intensity (Top/Tail): Fades to 0.0 */\n    \n    float finalAlpha = smoothstep(0.02, 0.15, intensity);\n    \n    /* Screen Fade */\n    /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */\n    \n    /* Dynamic Shoreline Fade */\n    /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */\n    /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */\n    float speed = 1.2;\n    float time = uTime * speed;\n    float wave1 = sin(uv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n    float threshold = 0.428 + wave;\n    \n    /* Fade out quickly after exiting the water body (below threshold) */\n    /* Fade starts slightly higher than the threshold to soften the transition */\n    /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */\n    float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y);\n    \n    float screenFade = shoreFade;\n    \n    /* --- Composite Shadow & Wave --- */\n    float waveAlpha = finalAlpha * screenFade;\n    \n    /* Shadow Alpha */\n    float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity);\n    /* Shadow is weaker (40% opacity) */\n    float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade;\n    \n    /* Mix: Wave over Shadow */\n    /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */\n    float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha);\n    \n    /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */\n    /* Shadow is black (RGB=0), so second term is 0 */\n    vec3 outRGB = finalColor * waveAlpha; \n    \n    gl_FragColor = vec4(outRGB, outAlpha);\n}`,jm=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,Zm=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Jm=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var lb={};vt(lb,{WaterSystem:()=>cf,waterSystem:()=>uf});function ab(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function ra(e,t,n){let o=ab(e,e.VERTEX_SHADER,t),r=ab(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var O1,sb,P1,B1,cf,uf,Qm=De(()=>{ib();O1=[.2,.5,.9],sb=[.2,.9,1],P1=[1,1,1],B1=[.45,.8,1];cf=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:ra(s,Gl,rb),simProgram:ra(s,Gl,Jm),brushProgram:ra(s,jm,Zm),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=ra(this.glBg,Gl,ob),this.bgSimProgram=ra(this.glBg,Gl,Jm),this.bgBrushProgram=ra(this.glBg,jm,Zm)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,p=a/this.height,h=new Float32Array([u-d,f-p,0,0,1,u+d,f-p,1,0,1,u-d,f+p,0,1,1,u+d,f+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,h,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),y=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(y),t.vertexAttribPointer(y,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let p=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=p.readFBO,f.writeFBO=p.writeFBO,f.readTexture=p.readTex,f.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),O1),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),sb),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),sb),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),P1),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),B1),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let p=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(p),d.vertexAttribPointer(p,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},uf=new cf});var mb={};vt(mb,{createSpawner:()=>X1});function pb(e){if(!e||typeof e!="object"){ia=!1,Di=0n;return}ia=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Di=n&&n!=="Infinity"?BigInt(n):0n}catch{Di=0n}}function U1(e){let t=1-e;return 1-t*t*t}function $1(e){if(!e)return null;let t=cb.get(e);return t||(t=new Image,t.src=e,cb.set(e,t)),t}function X1({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=Je?F1:1e4,initialBurst:d=1,coinTtlMs:p=1e99,waveSoundSrc:h="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:y=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:v=!1}={}){let E=o,C={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function A(){return!!(C.pf&&C.w&&C.c)}A()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let N=7,X=[],B=[],G=!1;if(C.c)for(let S=0;S<N;S++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+S*10}`,C.c.appendChild(k);let R=k.getContext("2d",{alpha:!0});X.push(k),B.push(R)}let _=null,U=null;C.c&&(_=document.createElement("canvas"),_.style.position="absolute",_.style.inset="0",_.style.pointerEvents="none",_.style.zIndex="100",C.c.appendChild(_),U=_.getContext("2d",{alpha:!0}));let M={collectBatch:null,getMagnetUnit:null};function L(S){M={...M,...S}}let V={pfRect:null,wRect:null,safeBottom:0,pfW:0};function J(){if(!A())return!1;let S=C.pf.getBoundingClientRect(),k=C.w.getBoundingClientRect(),R=C.hud?C.hud.getBoundingClientRect().height:0;V={pfRect:S,wRect:k,safeBottom:S.height-R,pfW:S.width};let T=window.devicePixelRatio||1;return X.forEach((P,ue)=>{if(P){P.width=S.width*T,P.height=S.height*T,P.style.width=S.width+"px",P.style.height=S.height+"px";let fe=B[ue];fe&&(fe.setTransform(1,0,0,1,0,0),fe.scale(T,T),fe.imageSmoothingEnabled=!0,fe.imageSmoothingQuality="high")}}),G=!0,_&&(_.width=S.width*T,_.height=S.height*T,_.style.width=S.width+"px",_.style.height=S.height+"px",U&&(U.setTransform(1,0,0,1,0,0),U.scale(T,T))),!0}J();let se="ResizeObserver"in window?new ResizeObserver(()=>J()):null;se&&C.pf&&se.observe(C.pf),document.addEventListener("visibilitychange",()=>{document.hidden||J()});let de=(S,k,R)=>Math.max(k,Math.min(R,S)),ge=Math.max(2e3,f*3),Te=12,Ce=[],F=[],z=0,$=[],q=[];function j(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=E,k.style.objectFit="contain",k.style.borderRadius="50%",S.appendChild(k),v&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let Y=()=>Ce.length?Ce.pop():j();function re(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let k=0;k<=6;k++)S.classList.remove(`coin--size-${k}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),Ce.length<ge&&Ce.push(S)}function x(S,k=-1){if(S.isRemoved)return;S.isRemoved=!0;let R=k;(R===-1||F[R]!==S)&&(S.index!==void 0&&F[S.index]===S?R=S.index:R=F.indexOf(S)),R!==-1&&(F[R]=null,z++),S.el?(re(S.el),S.el=null):q.push({layer:S.sizeIndex||0,x:S.x,y:S.y,size:S.size||r})}function K(S){let k=S._coinObj;if(k){let R=-1;k.index!==void 0&&F[k.index]===k?R=k.index:R=F.indexOf(k),R!==-1&&(F[R]=null,z++),S._coinObj=null}}let ce=new URL(h,document.baseURI).href,pe=0;function Q(){let S=performance.now();if(S-pe<g)return;pe=S,ht(ce,{volume:Je?y:m,type:"music"})}function ie(){if(!A())return null;if((!V.pfRect||!V.wRect)&&J(),f!==1/0&&F.length-z>=f){let Lt=-1;if(Ke(2))for(let Ot=0;Ot<F.length;Ot++){let So=F[Ot];if(So&&So.sizeIndex<4){Lt=Ot;break}}else for(let Ot=0;Ot<F.length;Ot++)if(F[Ot]){Lt=Ot;break}if(Lt===-1)return null;let Rt=F[Lt];Rt&&x(Rt,Lt)}let S=V.pfW,k=V.wRect.top-V.pfRect.top,R=Math.max(0,k),T=0;if(Ke(2)){let Lt=Math.random();for(let Rt=6;Rt>=1;Rt--)if(Lt<G1[Rt]){T=Rt;break}}T>=4&&bl&&bl()&&(T=3);let P=ub[T],ue=Te+(T>=3?15*(T-2):0),fe=ue,we=Math.max(fe,S-P-ue),xe=fe+Math.random()*(we-fe),ze=Math.random()*100-50,Ge;if(P>=V.pfW)Ge=(V.pfW-P)/2;else{let Lt=V.pfW-P-ue;fe>=Lt?Ge=(V.pfW-P)/2:Ge=de(xe+ze,fe,Lt)}let Ue=Math.min(V.wRect.height,V.pfRect.height*.3),Le=Math.max(Ue+80,120),Ae=Math.max(Le+40,V.safeBottom-P-6),be=de(Le+Math.random()*(Ae-Le),Le,Ae),Ve={x0:xe,y0:R,x1:Ge,y1:be,jitterMs:0},ot=V.pfRect.left-V.wRect.left,He=H1[T],Nt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),at=.85+Math.random()*.3,wt=Nt*(He.w/100)*at,Ht=Nt*(He.h/100)*at,Xt=xe+P/2+ot,Un=R-k;return{wave:{x:Xt,y:Un,width:wt,height:Ht},coin:Ve,sizeIndex:T}}function he(S){if(!S.length||!A())return;let k=document.createDocumentFragment(),R=[],T=performance.now(),P=!1;for(let{wave:ue,coin:fe,sizeIndex:we}of S){if(ue&&(P=!0,uf)){let Ae=we>=4;uf.addWave(ue.x,ue.y,ue.width,ue.height,Ae)}let xe=ub[we],ze=1;if(Ke(8)){let Ae=xn(),be=Math.pow(25,Ae);ze=Math.pow(be,we)}else ze=q1[we];let Ge=we>=4,Ue=Y();Ue.style.width=`${xe}px`,Ue.style.height=`${xe}px`,Ue.className=`coin coin--size-${we}`,Ue.firstChild&&(Ue.firstChild.src=E),Ue.style.transform=`translate3d(${fe.x0}px, ${fe.y0}px, 0) rotate(-10deg) scale(0.96)`,Ue.style.opacity="0",ia?Ue.dataset.mutationLevel=Di.toString():Ue.dataset.mutationLevel="0";let Le={mutationLevel:ia?Di.toString():"0",el:Ue,src:E,x:fe.x0,y:fe.y0,rot:-10,scale:.96,startX:fe.x0,startY:fe.y0,endX:fe.x1,endY:fe.y1,startTime:T+fe.jitterMs,duration:i,dieAt:T+p,jitterMs:fe.jitterMs,isRemoved:!1,settled:!1,size:xe,sizeIndex:we,valueMultiplier:ze,forceDom:Ge,soundSrc:db[we]?`sounds/coin_pickup${db[we]}`:null,bMinX:Math.min(fe.x0,fe.x1)-xe,bMaxX:Math.max(fe.x0,fe.x1)+xe,bMinY:Math.min(fe.y0,fe.y1)-xe,bMaxY:Math.max(fe.y0,fe.y1)+xe};Ue._coinObj=Le,Le.index=F.length,F.push(Le),R.push(Le),k.appendChild(Ue)}C.c.appendChild(k),R.length>0&&(R[0].el&&R[0].el.offsetHeight,requestAnimationFrame(()=>{for(let ue of R)ue.el&&(ue.el.style.transition=`transform ${i}ms ${D1} ${ue.jitterMs}ms`,ue.el.style.transform=`translate3d(${ue.endX}px, ${ue.endY}px, 0) rotate(0deg) scale(1)`,ue.el.style.opacity="1")})),P&&requestAnimationFrame(()=>{Q()})}function Re(S=1){if(!A())return;(!V.pfRect||!V.wRect)&&J();let k=[];for(let R=0;R<S;R++){let T=ie();T&&k.push(T)}k.length&&he(k)}function oe(S,k){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let R=k-S.startTime;if(R<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let T=R/S.duration;if(T>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let P=U1(T),ue=S.startX+(S.endX-S.startX)*P,fe=S.startY+(S.endY-S.startY)*P,we=-10+10*P,xe=.96+.04*P;return{x:ue,y:fe,rot:we,scale:xe}}function ye(S,k){let R=$1(k.src);if(R&&R.complete&&R.naturalWidth>0){let T=k.size||r;S.drawImage(R,k.x,k.y,T,T)}}function Be(){if(B.length)if(G){B.forEach((k,R)=>{X[R]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,X[R].width,X[R].height),k.restore(),v&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let S=F.length;for(let k=0;k<S;k++){let R=F[k];if(R&&R&&R.settled&&!R.isRemoved&&!R.el){let T=R.sizeIndex||0;B[T]&&ye(B[T],R)}}v&&B.forEach(k=>k.restore()),G=!1,$.length=0,q.length=0}else{if(q.length>0){v&&B.forEach(k=>{k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2});let S=F.length;for(let k=0;k<q.length;k++){let R=q[k],T=B[R.layer];if(!T)continue;let P=8,ue=R.x-P,fe=R.y-P,we=R.size+P*2;T.save(),T.beginPath(),T.rect(ue,fe,we,we),T.clip(),T.clearRect(ue,fe,we,we);let xe=ue,ze=ue+we,Ge=fe,Ue=fe+we;for(let Le=0;Le<S;Le++){let Ae=F[Le];if(!Ae||!Ae.settled||Ae.isRemoved||Ae.el||(Ae.sizeIndex||0)!==R.layer)continue;let be=Ae.size||r,je=Ae.x,Ve=Ae.x+be,ot=Ae.y,He=Ae.y+be;Ve>xe&&je<ze&&He>Ge&&ot<Ue&&ye(T,Ae)}T.restore()}v&&B.forEach(k=>k.restore()),q.length=0}if($.length>0){v&&B.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let k=$[S];if(!k.isRemoved&&k.settled&&!k.el){let R=k.sizeIndex||0;B[R]&&ye(B[R],k)}}v&&B.forEach(S=>S.restore()),$.length=0}}}let Pe=a,Oe=null,ae=performance.now(),ee=0;function Ie(S){(!V.pfRect||!V.wRect)&&J();let k=(S-ae)/1e3;ae=S,k>.1&&(k=.1);for(let T=F.length-1;T>=0;T--){let P=F[T];if(!P||!P)continue;if(S>=P.dieAt){x(P,T);continue}if(P.sizeIndex===5&&!P.isRemoved&&(P.lastLightningTime||(P.lastLightningTime=S-1e3,P.nextLightningInterval=0),S-P.lastLightningTime>P.nextLightningInterval)){P.lastLightningTime=S,P.nextLightningInterval=200+Math.random()*100;for(let we=0;we<3;we++)Uo(P,S)}if(P.sizeIndex===6&&!P.isRemoved&&(P.lastLightningTime||(P.lastLightningTime=S-1e3,P.nextLightningInterval=0),S-P.lastLightningTime>P.nextLightningInterval&&(P.lastLightningTime=S,P.nextLightningInterval=200+Math.random()*100,M.collectBatch))){let we=oe(P,S),xe=we.x+P.size/2,ze=we.y+P.size/2,Ge=[],Ue=P.size/2*(P.size/2),Le=F.length;for(let Ae=0;Ae<Le;Ae++){let be=F[Ae];if(!be||be===P||be.isRemoved||be.settled===!1||be.sizeIndex>3)continue;let je=be.x+(be.size||r)/2,Ve=be.y+(be.size||r)/2,ot=je-xe,He=Ve-ze;ot*ot+He*He>Ue&&Ge.push(be)}if(Ge.length>0){for(let Ve=Ge.length-1;Ve>0;Ve--){let ot=Math.floor(Math.random()*(Ve+1));[Ge[Ve],Ge[ot]]=[Ge[ot],Ge[Ve]]}let Ae=Ge.slice(0,3),be=[],je=!1;for(let Ve of Ae){let ot=Ve.size||r,He=Ve.x+ot/2,Nt=Ve.y+ot/2;fr(P,He,Nt),Fo(He,Nt,ot),be.push({coin:Ve}),je||(ht("sounds/lightning_strike.ogg",{volume:.25}),je=!0)}be.length>0&&M.collectBatch(be)}}if(P.settled)continue;let ue=S-P.startTime;if(ue<0)continue;if(ue/P.duration>=1){P.settled=!0,P.x=P.endX,P.y=P.endY,P.rot=0,P.scale=1,P.el&&!P.forceDom?(re(P.el),P.el=null,$.push(P)):P.el&&(P.el.style.transition="none",P.el.style.transform=`translate3d(${P.x}px, ${P.y}px, 0) rotate(0deg) scale(1)`);continue}}ee+=Pe*k;let R=Math.floor(ee);if(R>0){ee-=R;let T=Math.min(R,u);if(T>0){let P=performance.now(),ue=[],fe=5;for(let we=0;we<T&&!(performance.now()-P>fe);we++){let xe=ie();xe&&ue.push(xe)}ue.length&&he(ue)}}if(Be(),z>50){let T=0;for(let P=0;P<F.length;P++){let ue=F[P];ue!==null&&(ue.index=T,F[T++]=ue)}F.length=T,z=0}Me(k),Oe=requestAnimationFrame(Ie)}function w(){if(!Oe){if(!A()){console.warn("[Spawner] start() called but required nodes are missing.");return}J(),d>0&&Oe===null&&Re(d),ae=performance.now(),Oe=requestAnimationFrame(Ie)}}function W(){Oe&&(cancelAnimationFrame(Oe),Oe=null)}function Z(S){Pe=Math.max(0,Number(S)||0)}function te(){ee=0,ae=performance.now()}function me(S){let k=Ke(2)&&!!S;for(let R=F.length-1;R>=0;R--){let T=F[R];if(T&&T){if(k&&T.sizeIndex>=4){T.mutationLevel=ia?Di.toString():"0",T.el&&(T.el.dataset.mutationLevel=T.mutationLevel);continue}x(F[R],R)}}te()}function le(S){S&&(E=S)}function Ye(S){let k=S._coinObj;if(!k)return S.style.transform||"translate3d(0,0,0)";let{x:R,y:T,rot:P,scale:ue}=oe(k,performance.now());return`translate3d(${R}px, ${T}px, 0) rotate(${P}deg) scale(${ue})`}function nt(S){if(S.el)return S.el;if(S.isRemoved)return null;let k=Y(),R=S.size||r;return k.style.width=`${R}px`,k.style.height=`${R}px`,k.className=`coin coin--size-${S.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=S.src),k.style.opacity="1",k.dataset.mutationLevel=S.mutationLevel,k._coinObj=S,S.el=k,C.c.appendChild(k),q.push({layer:S.sizeIndex||0,x:S.x,y:S.y,size:S.size||r}),k}function ve(S,k,R,T){let P=R;T&&(P=Math.max(R,260));let ue=R*R,fe=[],we=F.length,xe=S-P,ze=S+P,Ge=k-P,Ue=k+P,Le=performance.now();for(let Ae=0;Ae<we;Ae++){let be=F[Ae];if(!be||be.bMaxX<xe||be.bMinX>ze||be.bMaxY<Ge||be.bMinY>Ue)continue;let je=be.size||r,Ve,ot;if(be.settled)Ve=be.x+je/2,ot=be.y+je/2;else{let wt=oe(be,Le);Ve=wt.x+je/2,ot=wt.y+je/2}if(Ve<xe||Ve>ze||ot<Ge||ot>Ue)continue;let He=Ve-S,Nt=ot-k,at=ue;if(T&&(be.sizeIndex||0)>0){let wt=je/2;at=wt*wt}He*He+Nt*Nt<=at&&(be.isRemoved||fe.push(be))}return fe}function qe(S,k,R,T,P,ue){let fe=P;ue&&(fe=Math.max(P,260));let we=P*P,xe=[],ze=F.length,Ge=Math.min(S,R)-fe,Ue=Math.max(S,R)+fe,Le=Math.min(k,T)-fe,Ae=Math.max(k,T)+fe,be=R-S,je=T-k,Ve=be*be+je*je,ot=we*Ve,He=performance.now();for(let Nt=0;Nt<ze;Nt++){let at=F[Nt];if(!at||at.bMaxX<Ge||at.bMinX>Ue||at.bMaxY<Le||at.bMinY>Ae)continue;let wt=at.size||r,Ht,Xt;if(at.settled)Ht=at.x+wt/2,Xt=at.y+wt/2;else{let cn=oe(at,He);Ht=cn.x+wt/2,Xt=cn.y+wt/2}if(Ht<Ge||Ht>Ue||Xt<Le||Xt>Ae)continue;let Un=Ht-S,Lt=Xt-k,Rt=Un*be+Lt*je,Ot=we;if(ue&&(at.sizeIndex||0)>0){let cn=wt/2;Ot=cn*cn}let So=!1;if(Rt<=0)Un*Un+Lt*Lt<=Ot&&(So=!0);else if(Rt>=Ve){let cn=Ht-R,ma=Xt-T;cn*cn+ma*ma<=Ot&&(So=!0)}else{let cn=Un*je-Lt*be;cn*cn<=Ot*Ve&&(So=!0)}So&&!at.isRemoved&&xe.push(at)}return xe}function Gt(S){x(S)}function dt(S,k,R){let T=R*R,P=[],ue=F.length,fe=S-R,we=S+R,xe=k-R,ze=k+R,Ge=performance.now();for(let Ue=0;Ue<ue;Ue++){let Le=F[Ue];if(!Le||Le.bMaxX<fe||Le.bMinX>we||Le.bMaxY<xe||Le.bMinY>ze)continue;let Ae=Le.size||r,be,je;if(Le.settled)be=Le.x+Ae/2,je=Le.y+Ae/2;else{let He=oe(Le,Ge);be=He.x+Ae/2,je=He.y+Ae/2}if(be<fe||be>we||je<xe||je>ze)continue;let Ve=be-S,ot=je-k;Ve*Ve+ot*ot<=T&&(!Le.el&&!Le.isRemoved&&nt(Le),Le.el&&P.push(Le.el))}return P}function ln(S,k,R,T,P){let ue=P*P,fe=[],we=F.length,xe=Math.min(S,R)-P,ze=Math.max(S,R)+P,Ge=Math.min(k,T)-P,Ue=Math.max(k,T)+P,Le=R-S,Ae=T-k,be=Le*Le+Ae*Ae,je=ue*be,Ve=performance.now();for(let ot=0;ot<we;ot++){let He=F[ot];if(!He||He.bMaxX<xe||He.bMinX>ze||He.bMaxY<Ge||He.bMinY>Ue)continue;let Nt=He.size||r,at,wt;if(He.settled)at=He.x+Nt/2,wt=He.y+Nt/2;else{let Rt=oe(He,Ve);at=Rt.x+Nt/2,wt=Rt.y+Nt/2}if(at<xe||at>ze||wt<Ge||wt>Ue)continue;let Ht=at-S,Xt=wt-k,Un=Ht*Le+Xt*Ae,Lt=!1;if(Un<=0)Ht*Ht+Xt*Xt<=ue&&(Lt=!0);else if(Un>=be){let Rt=at-R,Ot=wt-T;Rt*Rt+Ot*Ot<=ue&&(Lt=!0)}else{let Rt=Ht*Ae-Xt*Le;Rt*Rt<=je&&(Lt=!0)}Lt&&(!He.el&&!He.isRemoved&&nt(He),He.el&&fe.push(He.el))}return fe}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;Oe||w()}});function Fn(){A()&&Re(1)}let Ft=[],Sn=[];function Vr(S,k){if(!S||!k)return;let R=S.size||r,T=k.size||r,P=S.x+R/2,ue=S.y+R/2,fe=k.x+T/2,we=k.y+T/2;Ft.push({x1:P,y1:ue,x2:fe,y2:we,age:0,life:.15})}function Fo(S,k,R){if(!C.pf)return;let T=document.createElement("div");T.className="coin-stain";let P=R*1.2;T.style.width=`${P}px`,T.style.height=`${P}px`,T.style.left=`${S-P/2}px`,T.style.top=`${k-P/2}px`,C.pf.appendChild(T),setTimeout(()=>{T.style.opacity="0",setTimeout(()=>{T.parentNode&&T.remove()},1e3)},2500)}function Uo(S,k){let R=Math.random()*Math.PI*2,T=(S.size||r)/2,P=T*fb,ue=Math.cos(R)*P,fe=Math.sin(R)*P,we=T*(.7+Math.random()*.6),xe=Math.cos(R)*(P+we),ze=Math.sin(R)*(P+we);Ft.push({parentCoin:S,relX1:ue,relY1:fe,relX2:xe,relY2:ze,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let Ge=3+Math.floor(Math.random()*3);for(let Ue=0;Ue<Ge;Ue++){let Le=.3+Math.random()*.5,Ae=ue+(xe-ue)*Le,be=fe+(ze-fe)*Le,je=R+(Math.random()*1.2-.6),Ve=we*(.4+Math.random()*.4),ot=Ae+Math.cos(je)*Ve,He=be+Math.sin(je)*Ve;Ft.push({parentCoin:S,relX1:Ae,relY1:be,relX2:ot,relY2:He,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ht("sounds/lightning_zap.ogg",{volume:.25})}function fr(S,k,R){if(!S)return;let T=S.size||r,P=performance.now(),ue=oe(S,P),fe=ue.x+T/2,we=ue.y+T/2,xe=k-fe,ze=R-we,Ge=Math.atan2(ze,xe),Ue=Math.sqrt(xe*xe+ze*ze),Le=T/2*fb,Ae=Math.cos(Ge)*Le,be=Math.sin(Ge)*Le;Ft.push({parentCoin:S,relX1:Ae,relY1:be,x2:k,y2:R,age:0,life:.25,width:6,jaggedScale:25});let je=fe+Ae,Ve=we+be,ot=6+Math.floor(Math.random()*5);for(let He=0;He<ot;He++){let Nt=.1+Math.random()*.8,at=je+(k-je)*Nt,wt=Ve+(R-Ve)*Nt,Ht=Ge+(Math.random()*1.6-.8),Xt=Ue*(.1+Math.random()*.3),Un=at+Math.cos(Ht)*Xt,Lt=wt+Math.sin(Ht)*Xt;if(Ft.push({x1:at,y1:wt,x2:Un,y2:Lt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Ot=at+(Un-at)*.5,So=wt+(Lt-wt)*.5,cn=Ht+(Math.random()*1-.5),ma=Xt*.5;Ft.push({x1:Ot,y1:So,x2:Ot+Math.cos(cn)*ma,y2:So+Math.sin(cn)*ma,age:0,life:.25,width:1.5,jaggedScale:10})}}}function Me(S){if(!U||!_)return;U.clearRect(0,0,_.width,_.height);let k=performance.now();U.lineCap="round",U.lineJoin="round";for(let R=Ft.length-1;R>=0;R--){let T=Ft[R];if(T.age+=S,T.age>=T.life){Ft.splice(R,1);continue}let P=T.x1,ue=T.y1,fe=T.x2,we=T.y2;if(T.parentCoin){let Ge=oe(T.parentCoin,k),Ue=Ge.x+(T.parentCoin.size||r)/2,Le=Ge.y+(T.parentCoin.size||r)/2;P=Ue+T.relX1,ue=Le+T.relY1,T.relX2!==void 0&&(fe=Ue+T.relX2,we=Le+T.relY2)}let xe=1-T.age/T.life;U.strokeStyle=`rgba(200, 240, 255, ${xe})`,U.lineWidth=T.width||3,U.shadowColor="rgba(220, 245, 255, 0.9)",U.shadowBlur=20;let ze=6;U.beginPath(),U.moveTo(P,ue);for(let Ge=1;Ge<=ze;Ge++){let Ue=Ge/ze,Le=P+(fe-P)*Ue,Ae=ue+(we-ue)*Ue;if(Ge===ze)U.lineTo(fe,we);else{let be=-(we-ue),je=fe-P,Ve=Math.sqrt(be*be+je*je),ot=T.jaggedScale||40;if(Ve>0){let He=(Math.random()-.5)*ot*(1-Math.abs(Ue-.5));U.lineTo(Le+be/Ve*He,Ae+je/Ve*He)}else U.lineTo(Le,Ae)}}U.stroke(),U.shadowBlur=0}for(let R=Sn.length-1;R>=0;R--){let T=Sn[R];if(T.age+=S,T.age>=T.life){Sn.splice(R,1);continue}T.x+=T.vx*S,T.y+=T.vy*S;let P=1-T.age/T.life;U.fillStyle=T.color,U.globalAlpha=P,U.beginPath(),U.arc(T.x,T.y,T.size,0,Math.PI*2),U.fill(),U.globalAlpha=1}}return{start:w,stop:W,setRate:Z,clearBacklog:te,clearPlayfield:me,setCoinSprite:le,getCoinTransform:Ye,findCoinsInRadius:dt,findCoinsInPath:ln,findCoinTargetsInRadius:ve,findCoinTargetsInPath:qe,ensureCoinVisual:nt,removeCoinTarget:Gt,detachCoin:K,recycleCoin:re,playEntranceWave:Fn,setDependencies:L,hasBigCoins:()=>Ke(2)&&F.some(S=>S&&S.sizeIndex>=4)}}var ia,Di,F1,cb,D1,ub,fb,q1,G1,db,H1,hb=De(()=>{sc();Co();co();Wn();Dn();Qm();_o();ia=!1,Di=0n,F1=2500,cb=new Map;try{pb(mt())}catch{ia=!1,Di=0n}try{xi(e=>{pb(e)})}catch{}D1="cubic-bezier(0.215, 0.61, 0.355, 1)";ub=[40,55,80,125,200,320,512],fb=.78,q1=[1,25,625,15625,390625,9765625,244140625],G1=[0,.1,.01,.001,1e-4,1e-5,1e-6],db=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],H1=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var Eb={};vt(Eb,{afterSlotWrite:()=>rh,beforeSlotWrite:()=>oh});function Sb(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function z1(e,t=Y1){!e||e<=0||Hl.set(e,Sb()+t)}function yb(e){if(!e||e<=0)return!1;let t=Hl.get(e);return t==null?!1:t<=Sb()?(Hl.delete(e),!1):!0}function K1(){Hl.clear()}function df(){try{return typeof localStorage<"u"}catch{return!1}}function nh(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function Ib(e){let t=new Map;if(!df())return Xl.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Vi))continue;let r=nh(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return Xl.set(e,t),t}function wb(e){return!Number.isFinite(e)||e<=0?null:Xl.has(e)?Xl.get(e):Ib(e)}function oh(e){if(!df()||ff>0)return;let t=String(e);if(!t.startsWith(Vi))return;let n=nh(t);if(n==null)return;let o=wb(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(ff===0){ff+=1;try{In(n)}finally{ff-=1}}Ib(n);return}}}catch{}}function rh(e,t){let n=String(e);if(!n.startsWith(Vi))return;let o=nh(n);if(o==null)return;let r=wb(o)||new Map;r.set(n,String(t??"")),Xl.set(o,r)}function j1(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function Z1(){let e=new Map;if(!df())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Vi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=Of(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function J1(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function Q1(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=Pf(e);if(n.length===0){o&&(yb(e)||In(e),tc(e,null));return}let r=j1(n);o&&r!==o&&!yb(e)&&In(e),r!==o&&tc(e,r)}function aa(){if(!df())return;let e=Z1();J1(e).forEach(n=>{let o=e.get(n)??[];Q1(n,o)})}function eL(){if(eh!=null)return;eh=(typeof window<"u"?window:globalThis).setTimeout(()=>{eh=null,aa()},W1)}function tL(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){z1(o),eL();return}Hl.delete(o),aa()}}function nL(){typeof window>"u"||gb==null&&(gb=window.setInterval(aa,V1))}function oL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function sa(){let e=oL();if(!e)return;if(!Yi()){(e.dataset.poopShopApplied===th||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==vb||e.dataset.poopShopApplied!==th)&&(e.style.backgroundImage=vb,e.dataset.poopShopApplied=th)}function rL(){typeof window>"u"||bb==null&&(sa(),bb=window.setInterval(sa,50),window.addEventListener("saveSlot:change",sa),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&sa()}catch{sa()}}))}function iL(){typeof window>"u"||(aa(),nL(),rL(),window.addEventListener("saveSlot:change",()=>aa()),window.addEventListener("saveIntegrity:storageMutation",tL,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(K1(),aa(),sa())}))}var V1,Y1,W1,gb,eh,Hl,Xl,ff,vb,th,bb,ih=De(()=>{St();V1=1e4,Y1=750,W1=50,gb=null,eh=null,Hl=new Map;Xl=new Map,ff=0;vb="linear-gradient(180deg,#a9793d,#7b5534)",th="1",bb=null;iL()});var Rb={};vt(Rb,{initPopups:()=>uL,teardownpopups:()=>fL});function sh(){return bo||(bo=document.createElement("div"),bo.className="currency-popups",bo.setAttribute("aria-live","polite"),bo.setAttribute("aria-atomic","false"),document.body.appendChild(bo),bo)}function $i(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function ah(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function Lb(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):ne(n);t&&(t.innerHTML=r)}function aL(e,t=_b){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Vl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function lL(e,t,n){sh();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function lh(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(Wt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(Wt(`ccc:mutation:progress:${o}`))return}else if(Object.values(ke).includes(e)&&$n(e,o))return}let r=sL[e],i=Object.assign({duration:_b,accumulate:!0},r||{},n);if(!i.icon)return;let s=$i(t);if(!s||ah(s))return;let l=i.accumulate!==!1?Vl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,Lb(l);return}let a=lL(e,i,s);a.meta=i,Lb(a),Vl.set(e,a);let u=sh(),f=xb.indexOf(e),d=null;if(f>=0){let p=Array.from(u.children);for(let h of p){let m=h.dataset.type;if(xb.indexOf(m)>f){d=h;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),aL(a,i.duration)}function cL(){let e={};for(let t of Object.values(ke))e[t]=Sa(t);return e}function Cb(){try{let e=cL();Object.entries(e).forEach(([t,n])=>{let o=$i(n)||c.fromInt(0);Hr.set(t,o.clone?.()??o)}),Hr.has("mp")||Hr.set("mp",c.fromInt(0))}catch{Hr.clear()}}function Mb(){Vl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Vl.clear()}function kb(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=$i(t.value)||c.fromInt(0),r=Hr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?$i(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&lh(n,s),Hr.set(n,o.clone?.()??o)}function Tb(e){let t=e?.detail;if(!t)return;let n=$i(t.xpAdded);n&&!ah(n)&&lh("xp",n)}function Ab(e){let t=e?.detail;if(!t)return;let n=$i(t.delta);n&&!ah(n)&&lh("mp",n);let o=$i(t.progress);o&&Hr.set("mp",o.clone?.()??o)}function Nb(){Mb(),Cb()}function uL(){pf||(pf=!0,sh(),Cb(),window.addEventListener("currency:change",kb),window.addEventListener("xp:change",Tb),window.addEventListener("mutation:change",Ab),window.addEventListener("saveSlot:change",Nb))}function fL(){pf&&(window.removeEventListener("currency:change",kb),window.removeEventListener("xp:change",Tb),window.removeEventListener("mutation:change",Ab),window.removeEventListener("saveSlot:change",Nb),Mb(),Hr.clear(),bo&&bo.remove(),bo=null,pf=!1)}var _b,xb,sL,bo,pf,Hr,Vl,Ob=De(()=>{Et();Yt();St();_b=6767,xb=["coins","xp","books","gold","mp","magic","gears","dna"],sL={[ke.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[ke.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[ke.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[ke.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[ke.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[ke.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},bo=null,pf=!1,Hr=new Map,Vl=new Map});var Gb={};vt(Gb,{flushBackupSnapshot:()=>qb,getSuspendMetadata:()=>ML,installSuspendSafeguards:()=>CL,markProgressDirty:()=>Po,restoreFromBackupIfNeeded:()=>_L});function Yl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function da(){if(typeof localStorage>"u")return!1;try{let e=`${oo}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function Ub(){if(!Yl())throw new Error("IndexedDB unavailable");return la||(la=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(dL,pL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(fa)||r.createObjectStore(fa)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}la=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw la=null,e}),la)}function yL(){if(!da())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(oo))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function vL(e){try{let t=await Ub();return await new Promise((n,o)=>{let r=!1,i=t.transaction(fa,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(fa).put(e,Fb);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function bL(){try{let e=await Ub();return await new Promise((t,n)=>{let o=!1,r=e.transaction(fa,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(fa).get(Fb);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function SL(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function ch(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function IL(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function EL(e){return!(typeof e!="string"||e.length===0||wL.test(e))}function uh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(oo)||n.startsWith(mL)||n.startsWith(hL))return;let o=IL(n);if(o!=null)try{let r={key:n,slot:o,trusted:EL(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function xL(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=ch(),a=String(i),u=this===localStorage&&a.startsWith(oo);if(u)try{oh(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Po("setItem");try{rh(a,s)}catch{}}this===localStorage&&a.startsWith(oo)&&uh(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=ch(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(oo)&&(Po("removeItem"),uh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=ch(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Po("clear"),uh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function Db(e="idle"){ua=e||ua,Xr=!0,!ca&&(ca=setTimeout(()=>{if(ca=null,!Xr)return;let t=ua;Xr=!1,qb(t)},gL))}function $b(){ca&&(clearTimeout(ca),ca=null)}function Po(e="dirty"){try{Db(e)}catch{}}async function fh(e="manual"){if(!da()||!Yl())return!1;let t=yL();if(!t)return!1;t.reason=e,hf=!1;let n=await vL(t);return n||(Xr=!0,Db("retry")),n}async function qb(e="manual",{immediate:t=!1}={}){return!da()||!Yl()?!1:t?($b(),Xr=!1,hf=!0,fh(e)):(Xr=!0,ua=e||ua,fh(e))}function mf(e){!Yl()||!da()||($b(),Xr=!1,hf=!0,fh(e))}function LL(){if(!da())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(oo))return!0}}catch{}return!1}async function _L(){if(Bb||(Bb=!0,!da()||!Yl()))return!1;let e=!1;try{if(!LL())e=!0;else{let o=localStorage.getItem(`${oo}saveSlot`);if(o){let r=`${oo}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await bL();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Po("restored"),n}function CL(){if(Pb||(Pb=!0,typeof window>"u"))return;SL(),xL();let e=()=>{document.hidden?mf("visibility-hidden"):Po("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>mf("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>mf("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>mf("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Po("pageshow"))}catch{}try{window.addEventListener("focus",()=>Po("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(oo)||Po("storage-event"))})}catch{}Po("boot")}function ML(){return{pendingImmediateFlush:hf,dirty:Xr,lastDirtyReason:ua}}var oo,dL,pL,fa,Fb,mL,hL,gL,la,ca,Xr,ua,Pb,Bb,hf,wL,Hb=De(()=>{ih();oo="ccc:",dL="ccc:safety",pL=1,fa="snapshots",Fb="latest",mL=`${oo}slotSig`,hL=`${oo}slotMod`,gL=1e3,la=null,ca=null,Xr=!1,ua="init",Pb=!1,Bb=!1,hf=!1;wL=/\bat <anonymous>:\d+:\d+\b/});var Xb={};vt(Xb,{initGlobalOverlayEsc:()=>AL});function TL(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i,closeAll:s}of kL){let l=document.querySelectorAll(o);if(l.length>0){if(i){t=!0;continue}if(s)l.forEach(a=>{let u=a.querySelector(r||".shop-close");u&&(u.click(),n=!0)});else{let u=l[l.length-1].querySelector(r||".shop-close");u&&(u.click(),n=!0)}}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function AL(){window.addEventListener("keydown",TL,!0)}var kL,Vb=De(()=>{kL=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close",closeAll:!0}]});var Yb={};vt(Yb,{ensureGameDom:()=>NL});function NL(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var Wb=De(()=>{});var zb={};vt(zb,{SHOW_FPS:()=>RL,initFpsTracker:()=>OL});function OL(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var RL,Kb=De(()=>{RL=!0});function FL(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function UL(){if(!Je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function uS(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=Je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function pa(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function fS(e,t,n,o=500){!e||e.__done||(e.__done=!0,e.__label&&(n?e.__label.textContent=n:e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(async()=>{if(typeof t=="function")try{t()}catch(i){console.error(i)}await SS(),e.style.opacity="0";let r=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",r,{once:!0}),setTimeout(r,450)},o))}async function hh(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function DL(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function $L(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Dn(),Kl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function qL(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function GL({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...DL(e,s),...$L(t,s),...n?qL(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function HL(e){if(Gi===e)return;an&&(an.stop(),an=null),Gi=e;let t=document.querySelector(".menu-root");switch(e){case Bo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Gi===Bo.STARTER_COVE&&(an=ht("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},300)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof wh=="function"&&wh(n,80),qi){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(qi.init("water-background",i),yf){try{yf()}catch{}yf=null}if(vf){try{vf()}catch{}vf=null}typeof Sh=="function"&&(yf=Sh(s=>qi.update(s))),typeof Ih=="function"&&(vf=Ih((s,l)=>qi.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,qi&&requestAnimationFrame(()=>qi.resize()),mS()),typeof yh=="function")try{yh()}catch{}if(typeof vh=="function")try{vh()}catch{}if(!Qt){Qt=dS({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=Qt;let i=()=>{if(!(!Qt||typeof Qt.setCoinSprite!="function"))try{Qt.setCoinSprite(vS?.())}catch{}};i(),bS?.(i);let s=pS({spawner:Qt});Qt&&typeof Qt.setDependencies=="function"&&Qt.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=hS(),u=gS(a);if(Qt&&u?.coinsPerSecondMult){let f=1*u.coinsPerSecondMult;if(typeof bh=="function"){let d=bh("spawnRate",f);try{d&&typeof d.toScientific=="function"?f=Number(d.toScientific(6)):f=Number(d)}catch{}}Number.isFinite(f)&&Qt.setRate(f)}}catch{}};if(l(),typeof mh=="function")try{mh()}catch{}mh=yS(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof gh=="function")try{gh()}catch{}setTimeout(()=>{Gi===Bo.STARTER_COVE&&Qt&&Qt.start()},300);break}case Bo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),Qt&&Qt.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Bo.MENU}}))}catch{}}var PL,Je,jb,dS,pS,mS,Zb,Jb,Qb,eS,tS,nS,oS,rS,hS,gS,gh,yS,BL,iS,sS,aS,dh,ph,yh,vh,vS,bS,gf,bh,lS,Sh,Ih,cS,wh,qi,yf,vf,Bo,Gi,an,Qt,mh,bf,SS,co=De(()=>{Dn();PL=!0,Je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();Je&&document.documentElement.classList.add("is-mobile");yf=null,vf=null;UL();Bo={MENU:0,STARTER_COVE:1},Gi=Bo.MENU,an=null,Qt=null,mh=null,bf=()=>new Promise(e=>requestAnimationFrame(e)),SS=async()=>{await bf(),await bf()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(Y=>{e=Y}),n=uS("Loading assets...",e);await bf();let{initAudio:o}=await Promise.resolve().then(()=>(Dn(),Kl));o();let r=Promise.all([Promise.resolve().then(()=>(Df(),Gh)),Promise.resolve().then(()=>(hb(),mb)),Promise.resolve().then(()=>(Ha(),lv)),Promise.resolve().then(()=>(cu(),Ky)),Promise.resolve().then(()=>(St(),Uh)),Promise.resolve().then(()=>(ih(),Eb)),Promise.resolve().then(()=>(lo(),L0)),Promise.resolve().then(()=>(sc(),Xh)),Promise.resolve().then(()=>(Vn(),sg)),Promise.resolve().then(()=>(_o(),e0)),Promise.resolve().then(()=>(Co(),nb)),Promise.resolve().then(()=>(Ob(),Rb)),Promise.resolve().then(()=>(Hb(),Gb)),Promise.resolve().then(()=>(ns(),pg)),Promise.resolve().then(()=>(Vb(),Xb)),Promise.resolve().then(()=>(es(),J0)),Promise.resolve().then(()=>(ti(),hg)),Promise.resolve().then(()=>(Dc(),sy)),Promise.resolve().then(()=>(ms(),oy)),Promise.resolve().then(()=>(ps(),Ag)),Promise.resolve().then(()=>(Wb(),Yb)),Promise.resolve().then(()=>(Wn(),Kg)),Promise.resolve().then(()=>(Qm(),lb)),Promise.resolve().then(()=>(ai(),Ig)),Promise.resolve().then(()=>(Kb(),zb))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(Y,re)=>`img/mutations/m${re+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/gold_val_dna.webp","img/sc_upg_icons/magic_val_dna.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_dna.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=GL(i,Y=>{s=Y,pa(n,Y)}),[a,u,f,d,p,h,m,y,g,v,E,C,A,N,X,B,G,_,U,M,L,V,J,se,de]=await r;({initSlots:jb}=a),{createSpawner:dS}=u,{initCoinPickup:pS}=f,{initHudButtons:mS}=d,{bank:eS,getHasOpenedSaveSlot:tS,setHasOpenedSaveSlot:nS,ensureStorageDefaults:oS,notifyGameSessionStarted:cS,ensureMultiplierDefaults:rS}=p,{getCurrentAreaKey:hS,computeUpgradeEffects:gS,onUpgradesChanged:yS}=m,{registerPreloadedAudio:BL}=y,{initXpSystem:gh}=g,{initResetSystem:yh}=v,{initMutationSystem:vh,getMutationCoinSprite:vS,onMutationChange:bS}=E,{initPopups:iS}=C,{installSuspendSafeguards:sS,restoreFromBackupIfNeeded:aS,markProgressDirty:dh,flushBackupSnapshot:ph}=A,{installGhostTapGuard:Zb,initGlobalGhostTap:Jb}=N,{initGlobalOverlayEsc:Qb}=X,{setDebugPanelAccess:gf,applyStatMultiplierOverride:bh}=B,{startGameLoop:lS,registerTick:Sh,registerFrame:Ih}=G;let{initOfflineTracker:ge,processOfflineProgress:Te}=_,{initWorkshopSystem:Ce}=U,{initAutomationEffects:F}=M;({ensureGameDom:wh}=L);let{initSurgeEffects:z}=V;({waterSystem:qi}=J);let{initLabLogic:$}=se,{initFpsTracker:q}=de;window.bank=eS,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(an){try{an.stop()}catch{}an=null}}),window.addEventListener("audio:restartMusic",()=>{if(an){try{an.stop()}catch{}an=null}Gi===Bo.STARTER_COVE&&(an=ht("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",Y=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return Y.preventDefault(),Y.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let Y=document.hidden;If(Y),an&&an.element&&(Y?an.element.pause():an.element.play().catch(()=>{}))}),Zb?.(),Jb?.(),Qb?.(),sS?.(),typeof gf=="function"&&(gf(PL),window.setDebugPanelAccess=gf);try{await aS?.()}catch{}await Promise.race([l,t]),await SS(),document.documentElement.classList.remove("booting"),await bf(),fS(n),await Promise.all([hh("img/currencies/coin/coin_plus_base.webp"),hh("img/stats/xp/xp_plus_base.webp"),hh("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}lS(),ge(()=>Gi===Bo.STARTER_COVE);try{Ce()}catch(Y){console.error("Workshop init failed",Y)}try{F()}catch(Y){console.error("Automation init failed",Y)}try{z()}catch(Y){console.error("Surge effects init failed",Y)}try{$()}catch(Y){console.error("Lab system init failed",Y)}try{q()}catch(Y){console.error("FPS tracker init failed",Y)}FL(),oS(),dh?.("ensure-defaults"),iS();let j=document.getElementById("panel-title");if(tS()?(document.body.classList.add("has-opened"),j&&(j.style.opacity="0")):j&&(j.style.opacity="1"),jb(async()=>{if(Gi===Bo.STARTER_COVE)return;nS(!0),document.body.classList.add("has-opened"),j&&(j.style.opacity="0");let Y=uS("Loading game..."),re=()=>new Promise(x=>setTimeout(x,120));pa(Y,.2),await re(),rS(),pa(Y,.4),await re(),Te(),pa(Y,.65),await re(),cS?.(),pa(Y,.9),await re(),dh?.("slot-entered"),pa(Y,1),fS(Y,()=>{HL(Bo.STARTER_COVE),setTimeout(()=>{window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave()},300)},"Finished loading game",200)}),typeof window<"u"&&ph)try{window.cccRequestBackup=()=>ph("manual",{immediate:!0})}catch{}})});co();})();
