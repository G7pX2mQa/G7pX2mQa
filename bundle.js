(()=>{var YI=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var bt=(e,t)=>{for(var n in t)YI(e,n,{get:t[n],enumerable:!0})};var Sc={};bt(Sc,{initAudio:()=>WI,loadAudio:()=>xg,playAudio:()=>mt,registerPreloadedBuffer:()=>KI,setAudioSuspended:()=>ed,setMusicUnderwater:()=>oi});function Qf(){if(jt)return jt;let e=window.AudioContext||window.webkitAudioContext;return e?(jt=new e,Ba=jt.createGain(),Ba.connect(jt.destination),Ba.gain.value=1,vc=jt.createGain(),vc.gain.value=1,vc.connect(Ba),No=jt.createBiquadFilter(),No.type="lowpass",No.frequency.value=22050,No.Q.value=1,No.connect(vc),jt):null}function WI(){Qf()}function zI(){jt&&jt.state==="suspended"&&jt.resume().catch(()=>{})}async function xg(e){let t=Qf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(Fa.has(n))return Fa.get(n);if(bc.has(n))return bc.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return Fa.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{bc.delete(n)}})();return bc.set(n,o),o}function mt(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=Qf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=Fa.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(No):f.connect(Ba),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else xg(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function KI(e,t){let n=new URL(e,document.baseURI).href;Fa.set(n,t)}function ed(e){jt&&(e?jt.state==="running"&&jt.suspend().catch(()=>{}):jt.state==="suspended"&&jt.resume().catch(()=>{}))}function oi(e){if(!No)return;let t=e?600:22050;try{let n=jt.currentTime;No.frequency.cancelScheduledValues(n),No.frequency.setValueAtTime(t,n)}catch{No.frequency.value=t}}var jt,Ba,vc,No,Fa,bc,An=De(()=>{jt=null,Ba=null,vc=null,No=null,Fa=new Map,bc=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,zI,{capture:!0,passive:!0})})});function be(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let m=Number(e.sig);if(m>0){let v=Math.log10(m),p=e.e||0,h=Number(e._eOffset||0n);return v+p+h}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let m=Number(u);if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)}else{let m=Number(u.slice(0,15));if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function re(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function td(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/Lg;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/Lg:e>0?e:0}var c,Lg,Et=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",m=BigInt(u+d);return new e(m,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,{base:this.e-(n|0),offset:this._eOffset},this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};Lg=Math.log(10)});function Mg(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return Cg.format(t)}catch{return String(e)}}function Ua(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function nd(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Mg(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+Cg.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=od.get(u)||"",m=o-u+1,v=4-m,p=m+v;n.length<p+1&&(n+="0".repeat(p+1-n.length));let h=n.slice(0,p);(n.charCodeAt(p)||48)>=53&&(h=Ua(h));let y,I;return h.length>p?(y=h.slice(0,m+1),I="0".repeat(v)):(y=h.slice(0,m),I=h.slice(m)),t+`${y}${v?"."+I:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Ua(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+nd(String(o))}function ZI(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+nd(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=Ua(f)),l){let M=f.slice(0,1)+"."+f.slice(1),N=i==="-"?"-":"";return t+M+"e"+nd(s,N)}let m=Math.floor(a/3)*3,v=od.get(m)||"",h=a-m+1,g=4-h,y,I;return f.length>4?(y=f.slice(0,h+1),I="0".repeat(g)):(y=f.slice(0,h),I=f.slice(h)),t+(i==="-"?"-":"")+y+(g?"."+I:"")+v}function _g(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Ua(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+ZI(l)}function W(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return _g(e.toScientific(3));if(t<6)return Mg(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=od.get(n);if(!o)return _g(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Ua(u));let d,m;return u.length>l?(d=u.slice(0,i+1),m="0".repeat(s)):(d=u.slice(0,i),m=u.slice(i)),`${d}${s?"."+m:""}${o}`}function Te(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=be(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return W(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):W(c.fromAny(t))}catch{return"1"}}var jI,od,Cg,Gt=De(()=>{Et();jI=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],od=new Map(jI),Cg=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var Dg={};bt(Dg,{CURRENCIES:()=>Re,KEYS:()=>xt,STORAGE_PREFIX:()=>rs,bank:()=>A,clearActiveSlot:()=>cw,clearAllStorage:()=>pw,ensureCurrencyDefaults:()=>hd,ensureMultiplierDefaults:()=>gd,ensureStorageDefaults:()=>dw,getActiveSlot:()=>b,getCurrency:()=>qa,getCurrencyMultiplierBN:()=>Ug,getHasOpenedSaveSlot:()=>fw,getLastSaveTime:()=>fd,getLastSaveTimeKey:()=>Lc,getSlotModifiedFlagKey:()=>uw,getSlotSignature:()=>md,getSlotSignatureKey:()=>pd,hasModifiedSave:()=>is,isCurrencyLocked:()=>gn,isStorageKeyLocked:()=>Zt,markSaveSlotModified:()=>kn,notifyGameSessionStarted:()=>aw,onCurrencyChange:()=>xc,peekCurrency:()=>Ga,primeStorageWatcherSnapshot:()=>ut,setActiveSlot:()=>dd,setCurrency:()=>ns,setCurrencyMultiplierBN:()=>Mc,setHasOpenedSaveSlot:()=>Cc,setSlotSignature:()=>_c,updateLastSaveTime:()=>Bg,watchStorageKey:()=>kt});function sd(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function ad(e){let t=sd(e);return t==null?null:`${JI}:${t}`}function ld(e){let t=sd(e);return t==null?null:`${QI}:${t}`}function Rg(e={}){Ic.size!==0&&Ic.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function xc(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Ic.add(o),()=>{Ic.delete(o)}}function tw(){if(Da!=null||Wo.size===0)return;Da=(typeof window<"u"?window:globalThis).setInterval(ow,ew)}function Og(){if(Wo.size!==0||Da==null)return;(typeof window<"u"?window:globalThis).clearInterval(Da),Da=null}function Pg(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function nw(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function ow(){if(Wo.size===0){Og();return}Wo.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=Pg(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!nw(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function kt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Wo.get(e);return s||(s=new Set,Wo.set(e,s)),s.add(i),tw(),()=>{let l=Wo.get(e);l&&(l.delete(i),l.size===0&&(Wo.delete(e),Og()))}}function ut(e,t){if(!e)return;let n=Wo.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=Pg(r,o),r.initialized=!0)})}function cd(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function rw(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function iw(){rd.forEach(e=>{try{e?.()}catch{}}),rd.clear()}function Ag(e){if(e!==Tg&&(iw(),Tg=e??null,e!=null))for(let t of Object.values(Re)){let n=`${xt.CURRENCY[t]}:${e}`,o=kt(n,{parse:rw,equals:cd,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};Rg(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});rd.set(n,o)}}function sw(){typeof window>"u"||(Ag(b()),window.addEventListener("saveSlot:change",()=>{Ag(b())}))}function aw(){ud=!0}function Lc(e=b()){return e==null?null:`${Lr}lastSaveTime:${e}`}function Bg(){if(!ud||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(Lc(e),String(t))}catch{}}function fd(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(Lc(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function lw(){typeof window>"u"||(kg||(kg=setInterval(Bg,1e3)),window.addEventListener("beforeunload",()=>{if(!ud)return;let e=b();if(e!=null)try{localStorage.setItem(Lc(e),String(Date.now()))}catch{}}))}function b(){if(Er!==void 0)return Er;let e=localStorage.getItem(xt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return Er=n,n}function dd(e){let t=Math.max(1,parseInt(e,10)||1);Er=t,localStorage.setItem(xt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function cw(){Er=null,localStorage.removeItem(xt.SAVE_SLOT)}function $a(e,t=b()){return t==null?null:`${e}:${t}`}function Fg(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Zt(e){return Fg(e)}function pd(e=b()){return ad(e)}function uw(e=b()){return ld(e)}function md(e=b()){if(typeof localStorage>"u")return null;let t=ad(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function _c(e,t){if(typeof localStorage>"u")return;let n=ad(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function is(e=b()){if(typeof localStorage>"u")return!1;let t=ld(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function kn(e=b()){if(typeof localStorage>"u")return;let t=sd(e);if(t==null||is(t))return;let n=ld(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function fw(){return localStorage.getItem(xt.HAS_OPENED_SAVE_SLOT)==="true"}function Cc(e){localStorage.setItem(xt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function dw(){localStorage.getItem(xt.HAS_OPENED_SAVE_SLOT)===null&&Cc(!1)}function hd(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${xt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function gd(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${xt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Ec(t);else{let o=xr(c.fromInt(1));os(t,o)}}}function qa(e){let t=$a(xt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function ns(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=$a(xt.CURRENCY[e],r),s=o??qa(e),l=c.fromInt(0);if(!i||gn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,m=a;try{f!=null&&(m=c.fromAny(f),m.isNegative?.()&&(m=c.fromInt(0)))}catch{}ut(i,d);let v=!cd(s,m),h=(y=>{if(y==null)return null;try{let I=y instanceof c?y.clone?.()??y:c.fromAny(y);if(typeof I.cmp=="function")return I.cmp(l)>0?I:null;if(!I.isZero?.())return I}catch{}return null})(n),g=null;if(v)try{g=m.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=h),v||g){let y={key:e,value:m,slot:r,delta:g??void 0};Rg(y);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:y}))}catch{}}return m}function xr(e){return e.mulScaledIntFloor(1n,-id)}function wc(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,id)}function Ec(e){let t=$a(xt.MULTIPLIER[e]);if(!t)return xr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(ri)){let r=xr(c.fromInt(1));return os(e,r),r}let o=n.slice(ri.length);try{return c.fromAny(o)}catch{let r=xr(c.fromInt(1));return os(e,r),r}}function os(e,t,n=b()){let o=$a(xt.MULTIPLIER[e],n);if(!o||gn(e,n))return;let r=xr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(ri))try{r=c.fromAny(i.slice(ri.length))}catch{}let s=c.fromAny(t),l=ri+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(ri)?u.slice(ri.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{ut(o,u)}catch{}if(!cd(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:wc(f),slot:n}}))}catch{}}function Ug(e){return wc(Ec(e))}function gn(e,t=b()){let n=$a(xt.CURRENCY[e],t);return Fg(n)}function Mc(e,t){let n=c.fromAny(t),o=xr(n);return os(e,o,b()),n}function Ga(e,t){let n=localStorage.getItem(`${xt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function pw(){Object.values(xt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Ng(e){let t=n=>{try{let o=c.fromAny(n);return typeof W=="function"?W(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return qa(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return ns(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),ns(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return ns(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof W=="function"?W(r):r.toString()},t.mult={get(){return Ug(e)},set(n){return Mc(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Ec(e).mulBigNumInteger(o);return r.isZero()&&(r=xr(c.fromInt(1))),os(e,r),wc(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),id)}catch{o={numer:1n,scale:0}}let r=Ec(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=xr(c.fromInt(1))),os(e,r);let i=wc(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var Lr,rs,JI,QI,id,ri,ew,Wo,Da,Ic,rd,Tg,kg,ud,xt,Re,Er,A,St=De(()=>{Et();Gt();Lr="ccc:",rs=Lr,JI=`${Lr}slotSig`,QI=`${Lr}slotMod`,id=18,ri="XM:",ew=140,Wo=new Map,Da=null,Ic=new Set;rd=new Map,Tg=null;kg=null,ud=!1;lw();xt={HAS_OPENED_SAVE_SLOT:`${Lr}hasOpenedSaveSlot`,SAVE_SLOT:`${Lr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Re={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===xt.SAVE_SLOT){if(e.newValue===null)Er=null;else{let t=parseInt(e.newValue,10);Er=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:Er}}))}catch{}}});for(let e of Object.values(Re))xt.CURRENCY[e]=`${Lr}${e}`,xt.MULTIPLIER[e]=`${Lr}mult:${e}`;sw();A=new Proxy({},{get(e,t){if(Object.values(Re).includes(t))return Ng(t);if(typeof t=="string"&&Re[t.toUpperCase?.()])return Ng(Re[t.toUpperCase()])}});if(typeof window<"u"){window.bank=A;for(let e of Object.values(Re))window[e]=A[e]}});function qg(){return Ro}function Tc(e){Ro=!!e,document.body.classList.toggle("slots-delete-mode",Ro);let t=document.getElementById("manage-saves");t&&(t.textContent=Ro?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",Ro),n.setAttribute("aria-pressed",Ro?"true":"false")})}function mw(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function hw(){if($g)return;$g=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),Tc(!Ro)}),window.addEventListener("keydown",r=>{Ro&&r.key==="Escape"&&Tc(!1)});let n=r=>{!Ro||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!Ro)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(mw(s),b()===s)try{localStorage.removeItem(xt.SAVE_SLOT)}catch{}yd(),Tc(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),Tc(!1)}var Ro,$g,Gg=De(()=>{St();vd();Ro=!1,$g=!1;document.addEventListener("DOMContentLoaded",()=>{try{hw()}catch{}})});var Hg={};bt(Hg,{initSlots:()=>vw,refreshSlotsView:()=>yd});function gw(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function yw(e){if(!gw(e))return"No Save Data";try{let t=Ga(e,"coins");return W(t)}catch{return"0"}}function bd(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=yw(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function vw(e){let t=document.querySelectorAll(".slot-card");bd(),t.forEach((n,o)=>{let r=o+1,i=s=>{dd(r),hd(),gd(),Cc(!0),typeof e=="function"&&e(r,s),bd()};n.addEventListener("click",s=>{qg()||(s.preventDefault(),i(s))})})}function yd(){bd()}var vd=De(()=>{Et();Gt();Gg();St()});var Vg={};bt(Vg,{registerPreloadedAudio:()=>bw,takePreloadedAudio:()=>Sw});function bw(e,t){let n=Xg(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}Ac.set(n,t)}}function Sw(e){let t=Xg(e);if(!Ac.has(t))return null;let n=Ac.get(t);return Ac.delete(t),n}var Ac,Xg,kc=De(()=>{Ac=new Map,Xg=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function ss(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var Sd=De(()=>{});var ay={};bt(ay,{addExternalCoinMultiplierProvider:()=>On,addExternalXpGainMultiplierProvider:()=>Ko,addXp:()=>ds,broadcastXpChange:()=>Fc,computeCoinMultiplierForXpLevel:()=>kd,getXpGainMultiplier:()=>Dc,getXpLevelStorageKey:()=>Iw,getXpRequirementForXpLevel:()=>Uc,getXpState:()=>et,initXpSystem:()=>us,isXpSystemUnlocked:()=>vn,onXpChange:()=>Pc,refreshCoinMultiplierFromXpLevel:()=>Jt,resetXpProgress:()=>fs,setExternalBookRewardProvider:()=>$c,setExternalCoinMultiplierProvider:()=>iy,setExternalXpGainMultiplierProvider:()=>sy,unlockXpSystem:()=>li});function Iw(e=b()){let t=e??b();return t==null?null:ii(t)}function yn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function Nc(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function Qg(e){if(!e||typeof e!="object")return 0;if(yn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function xw(e){return!e||typeof e!="object"?0:yn(e)||typeof e.cmp=="function"&&e.cmp(Jg)>=0?Number.POSITIVE_INFINITY:Qg(e)}function Wg(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(Ew,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(za())??c.fromInt(0):n}function Lw(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(Zg,18)}function _w(e){if(yn(e)||typeof e.cmp=="function"&&e.cmp(Jg)>=0)return Mt.clone?.()??Mt;let t=e.floorToInteger(),n=e.sub(t),o=Qg(n);if(!Number.isFinite(o))return Mt.clone?.()??Mt;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return Mt.clone?.()??Mt;let d=BigInt(u)+l-BigInt(i),v=d%BigInt(250),p=Number(v),h=d-v;return new c(a,{base:p,offset:h})}function ey(e){if(!e||typeof e!="object")return Mt.clone?.()??Mt;let n=Lw(e),o=_w(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return Mt.clone?.()??Mt;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function ty(){let e=yn(V.xpLevel),t=yn(V.progress);if(!e&&!t)return!1;let n=Mt.clone?.()??Mt;if(V.xpLevel=n.clone?.()??n,V.progress=n.clone?.()??n,_t=n.clone?.()??n,A?.books)try{typeof A.books.set=="function"?A.books.set(n.clone?.()??n):typeof A.books.add=="function"&&A.books.add(n.clone?.()??n)}catch{}return!0}function Va(e={}){Wa.size!==0&&Wa.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Pc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return Wa.add(n),()=>{Wa.delete(n)}}function Ut(){return c.fromInt(0)}function za(){return c.fromInt(1)}function as(e){if(!e)return Ut();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ut()}}function Rc(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Cw(){for(;Md.length>0;){let e=Md.pop();try{e?.()}catch{}}}function Kg(e){if(e==null)return Ut();try{return c.fromAny(e)}catch{return Ut()}}function Ed(e){if(!wd){wd=!0;try{let t=Td??b(),n={unlocked:V.unlocked,xpLevel:as(V.xpLevel),progress:as(V.progress),requirement:as(_t)};an(!0),ho(),Rn(!0);let o={unlocked:V.unlocked,xpLevel:as(V.xpLevel),progress:as(V.progress),requirement:as(_t)},r=n.unlocked!==o.unlocked,i=!Rc(n.xpLevel,o.xpLevel),s=!Rc(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ut();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ut()}catch{l=Ut()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||Wa.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(Va(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{wd=!1}}}function xd(e){if(e===Td||(Cw(),Td=e??null,e==null))return;let t=(n,o)=>{let r=kt(n,o);typeof r=="function"&&Md.push(r)};t(Ha(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>Ed("unlock")}),t(ii(e),{parse:Kg,equals:Rc,onChange:()=>Ed("xpLevel")}),t(cs(e),{parse:Kg,equals:Rc,onChange:()=>Ed("progress")})}function ny(){if(zg){xd(b());return}zg=!0,xd(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{xd(b()),an(!0),ho(),Rn(!0)})}function Ld(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function Mw(e){let t=e<Yg?e:Yg;if(t<=ls)return;let n=ls,o=_r.get(n.toString());for(o||(o=c.fromInt(10),_r.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),_r.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){ls=n;return}}ls=n}function Tw(e){let t=ls>0n?ls:0n,n=_r.get(t.toString());if(!n||yn(n))return Mt.clone?.()??Mt;let o=c.fromAny(t.toString()),r=be(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);Nc(s)||(i=i.add?.(s.mulDecimal(Zg,18))??i);let l=Wg(e),a=Wg(o),u=l.sub?.(a)??c.fromInt(0);Nc(u)||(i=i.add?.(u.mulDecimal(ww,18))??i);let f=xw(i);return Number.isFinite(f)?re(f):Mt.clone?.()??Mt}function Aw(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=yn(t),o=yn(e);if(n)return o?1:0;if(Nc(t)||Nc(e))return 0;let s=be(e),l=be(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function oy(){return Nn.container&&Nn.container.isConnected?!0:(Nn.container=document.querySelector(".xp-counter[data-xp-hud]"),Nn.container?(Nn.bar=Nn.container.querySelector(".xp-bar"),Nn.fill=Nn.container.querySelector(".xp-bar__fill"),Nn.xpLevelValue=Nn.container.querySelector(".xp-level-value"),Nn.progress=Nn.container.querySelector("[data-xp-progress]"),!0):!1)}function ry(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=_r.get("0");return a.clone?.()??a}if(r.bigInt!=null){Mw(i);let a=i.toString(),u=_r.get(a);if(u)return u.clone?.()??u}let s=Tw(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?Mt.clone?.()??Mt:(r.bigInt!=null&&_r.set(r.bigInt.toString(),s),s.clone?.()??s)}function zo(){_t=ry(V.xpLevel)}function Oc(){V.xpLevel=Ut(),V.progress=Ut(),zo(),Rn(!0)}function jg(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function Bc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function Rn(e=!1){let t=A?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=Bc(V.xpLevel),o=n.bigInt,r=!n.finite,i=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null;if(!e&&(r&&Zn||!r&&o!=null&&!Zn&&!Jn&&jn!=null&&o===jn||!r&&o==null&&Jn&&i&&Qn&&i===Qn))return;if(r){try{t.set(Mt)}catch{}jn=null,Zn=!0,Jn=!1,Qn=null;return}let s;if(o!=null&&o<=Cd){let f=c.fromInt(1),d=Number(o);for(let v=0;v<d;v+=1)f=f.mulDecimal("1.1",18);let m;try{m=c.fromAny(o.toString())}catch{m=c.fromInt(d)}typeof f.add=="function"?f=f.add(m):typeof m.add=="function"&&(f=m.add(f)),s=f.clone?.()??f}else s=ey(V.xpLevel);let l=s.clone?.()??s,a=Cr.size>0?Array.from(Cr):typeof si=="function"?[si]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(jn=null,Zn=!0,Jn=!1,Qn=null):o!=null&&o<=Cd?(jn=o,Zn=!1,Jn=!1,Qn=null):(jn=null,Zn=!1,Jn=!0,Qn=i)}function an(e=!1){let t=b();if(t==null)return Xa=null,Id=!1,V.unlocked=!1,Oc(),V;if(!e&&Id&&t===Xa)return V;Xa=t,Id=!0;try{let n=localStorage.getItem(Ha(t));V.unlocked=n==="1"}catch{V.unlocked=!1}try{V.xpLevel=c.fromAny(localStorage.getItem(ii(t))??"0")}catch{V.xpLevel=Ut()}try{V.progress=c.fromAny(localStorage.getItem(cs(t))??"0")}catch{V.progress=Ut()}return(yn(V.xpLevel)||yn(V.progress))&&(V.unlocked=!0),V.unlocked?(ty(),zo(),Rn(!0),ny(),V):(Oc(),V)}function Ya(){let e=b();if(e==null)return;let t={unlocked:V.unlocked?"1":"0",level:V.xpLevel.toStorage(),progress:V.progress.toStorage()};try{localStorage.setItem(Ha(e),t.unlocked)}catch{}try{localStorage.setItem(ii(e),t.level)}catch{}try{localStorage.setItem(cs(e),t.progress)}catch{}let n=(()=>{let r=V.unlocked,i=V.xpLevel,s=V.progress;try{r=localStorage.getItem(Ha(e))==="1"}catch{}try{let l=localStorage.getItem(ii(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(cs(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();ut(Ha(e),n.unlocked?"1":"0"),ut(ii(e),n.level?.toStorage?.()??t.level),ut(cs(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==V.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(V.unlocked=n.unlocked,V.xpLevel=n.level,V.progress=n.progress,zo(),Rn(!0),ho())}function kw(){Rn(!0);let e=za();if(typeof _d=="function")try{let n=_d({baseReward:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{A?.books?.addWithMultiplier?A.books.addWithMultiplier(e):A?.books?.add&&A.books.add(e)}catch{}let t=Bc(V.xpLevel);t.finite?t.bigInt!=null?(jn=t.bigInt,Zn=!1,Jn=!1,Qn=null):(jn=null,Zn=!1,Jn=!0,Qn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(jn=null,Zn=!0,Jn=!1,Qn=null)}function ho(){if(!oy())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=Nn;if(!e)return;if(!V.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=W(_t);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Ld(W(_t));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}ss();return}e.removeAttribute("hidden");let i=_t,s=Aw(V.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=W(V.xpLevel)),r){let a=W(V.progress),u=W(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Ld(W(V.progress)),u=Ld(W(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}ss()}function us({forceReload:e=!1}={}){return oy(),an(e),zo(),ho(),ny(),et()}function li(){if(an(),V.unlocked)return ho(),!1;Oc(),V.unlocked=!0,Ya(),ho(),Rn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:et()}))}catch{}return!0}function fs({keepUnlock:e=!0}={}){an();let t=V.unlocked;return Oc(),V.unlocked=e?t||V.unlocked:!1,Ya(),ho(),Rn(!0),et()}function ds(e,{silent:t=!1}={}){an();let n=Xa??b();if(n!=null&&jg(cs(n)))return{unlocked:V.unlocked,xpLevelsGained:Ut(),xpAdded:Ut(),xpLevel:V.xpLevel,progress:V.progress,requirement:_t,slot:n};if(!V.unlocked)return{unlocked:!1,xpLevelsGained:Ut(),xpAdded:Ut(),xpLevel:V.xpLevel,requirement:_t};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ut()}if(!o.isZero?.()){let d=Mr.size>0?Array.from(Mr):typeof ai=="function"?[ai]:[];for(let m of d)if(typeof m=="function")try{let v=m({baseGain:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});v instanceof c?o=v.clone?.()??v:v!=null&&(o=c.fromAny(v))}catch{}}if(o=eo("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return ho(),{unlocked:!0,xpLevelsGained:Ut(),xpAdded:o,xpLevel:V.xpLevel,requirement:_t};V.progress=V.progress.add(o),zo();let r=n!=null&&jg(ii(n)),i=yn(V.progress),s=yn(V.xpLevel),l=yn(o);if(i||s||l){let d=Mt.clone?.()??Mt;r||(V.xpLevel=d.clone?.()??d),V.progress=d.clone?.()??d,zo(),ty(),Ya(),ho(),Rn(!0);let m={unlocked:!0,xpLevelsGained:Ut(),xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:_t.clone?.()??_t,slot:n};if(Va(m),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:m}))}catch{}return m}let a=Ut();if(V.progress.cmp(_t)<0){Ya(),ho();let d={unlocked:!0,xpLevelsGained:Ut(),xpAdded:o,xpLevel:V.xpLevel,progress:V.progress,requirement:_t,slot:n};if(Va(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=be(V.progress),m=.08118668602542883,v=be(_t);if(d-v>2){let g=V.xpLevel,y=d-v,I=Math.floor(y/m);if(I>10){let E=BigInt(Math.max(0,I-5));if(E>0n){let M=c.fromAny(E.toString());if(V.xpLevel=V.xpLevel.add(M),a=a.add(M),zo(),A?.books?.add)try{let N=M.clone();A.books.add(N)}catch{}}}}let p=0,h=500;for(;V.progress.cmp?.(_t)>=0&&p<h&&(V.progress=V.progress.sub(_t),V.xpLevel=V.xpLevel.add(za()),a=a.add(za()),kw(),zo(),!yn(_t));)p+=1;p>=h&&V.progress.cmp(_t)>=0&&zo()}Ya(),ho();let u=Bc(V.xpLevel);u.finite?u.bigInt!=null?(jn=u.bigInt,Zn=!1,Jn=!1,Qn=null):(jn=null,Zn=!1,Jn=!0,Qn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(jn=null,Zn=!0,Jn=!1,Qn=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:_t.clone?.()??_t,slot:n};if(Va(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function et(){return an(),{unlocked:V.unlocked,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:_t.clone?.()??_t}}function Fc(e={}){an();let t=Xa??b(),n={...et(),slot:t,...e};if(Va(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function vn(){return an(),!!V.unlocked}function Uc(e){return ry(e)}function Dc(){an();let e=za(),t=Mr.size>0?Array.from(Mr):typeof ai=="function"?[ai]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function kd(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=Bc(t),o=n.bigInt;if(!n.finite)return Mt.clone?.()??Mt;let i;if(o!=null&&o<=Cd){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=ey(t);let s=i.clone?.()??i,l=Cr.size>0?Array.from(Cr):typeof si=="function"?[si]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!V.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function iy(e){si=typeof e=="function"?e:null,Cr.clear(),si&&Cr.add(si),an(),Rn(!0)}function Jt(){an(),Rn(!0)}function sy(e){ai=typeof e=="function"?e:null,Mr.clear(),ai&&Mr.add(ai)}function On(e){return typeof e!="function"?()=>{}:(Cr.add(e),an(),Rn(!0),()=>{Cr.delete(e),an(),Rn(!0)})}function Ko(e){return typeof e!="function"?()=>{}:(Mr.add(e),an(),()=>{Mr.delete(e)})}function $c(e){_d=typeof e=="function"?e:null}var Ad,Ha,ii,cs,Xa,Id,_t,_r,ls,Mt,jn,Zn,Jn,Qn,si,ai,Cr,Mr,_d,Yg,zC,KC,Cd,Zg,ww,Ew,Jg,V,Wa,Nn,Md,zg,Td,wd,bn=De(()=>{Et();St();ps();Gt();Sd();Ad="ccc:xp",Ha=e=>`${Ad}:unlocked:${e}`,ii=e=>`${Ad}:level:${e}`,cs=e=>`${Ad}:progress:${e}`;Xa=null,Id=!1,_t=c.fromInt(10),_r=new Map;_r.set("0",_t);ls=0n,Mt=c.fromAny("Infinity"),jn=null,Zn=!1,Jn=!1,Qn=null,si=null,ai=null,Cr=new Set,Mr=new Set,_d=null,Yg=5000n,zC=Math.log10(11/10),KC=Math.log10(5/2),Cd=200n,Zg="0.04139268515822507",ww="0.3979400086720376",Ew="0.1",Jg=c.fromScientific(String(c.MAX_E));V={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};Wa=new Set;Nn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};Md=[],zg=!1,Td=null,wd=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:us,unlockXpSystem:li,addXp:ds,getXpState:et,broadcastXpChange:Fc,isXpSystemUnlocked:vn,getXpRequirementForXpLevel:Uc,getXpGainMultiplier:Dc,setExternalCoinMultiplierProvider:iy,addExternalCoinMultiplierProvider:On,refreshCoinMultiplierFromXpLevel:Jt,setExternalXpGainMultiplierProvider:sy,addExternalXpGainMultiplierProvider:Ko,setExternalBookRewardProvider:$c,resetXpProgress:fs}))});var my={};bt(my,{GHOST_TAP_TIMEOUT_MS:()=>Nw,clearGhostTapTarget:()=>Ka,consumeGhostTapGuard:()=>py,initGlobalGhostTap:()=>Gw,installGhostTapGuard:()=>qw,markGhostTapTarget:()=>dy,setGhostTapSelector:()=>Hw,shouldSkipGhostTap:()=>go,suppressNextGhostTap:()=>Oo});function Zo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Od(){return typeof document>"u"?null:document}function Pw(e){if(!Od())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(Rd)}function Ka(e){e&&(e[qc]=0)}function dy(e,t=0,n=null){if(!e)return;let o=Zo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[qc]=o+r:e[qc]=0,Ow=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&Oo(i)}function py(e){if(typeof window>"u")return!1;let t=window[ms];return typeof t!="number"?!1:Zo()<=t?!0:(window[ms]=null,!1)}function go(e){if(!e)return!1;let t=Number(e[qc]||0);return!Number.isFinite(t)||t<=0?!1:Zo()<=t?(Ka(e),!0):(Ka(e),!1)}function Oo(e=0){if(typeof window>"u")return;let t=Zo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[ms]=null;return}let o=t+n,r=typeof window[ms]=="number"?window[ms]:0;window[ms]=Math.max(r,o)}function Bw(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Hc=Tr=Zo(),jo=0))}function Fw(e){Hc=Tr=Zo(),jo=0}function Uw(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Zo();Tr>0&&(jo=t-Tr),Hc=t}function Dw(){let e=Zo();Tr>0&&(jo=e-Tr),Hc=e}function $w(e){if(!e.isTrusted)return;let t=Zo(),n=Tr>0?t-Tr:-1,o=Pw(e.target);if(go(o)){jo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(py(o)){o&&Ka(o),jo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((jo||n)>=fy){Ka(o),jo=0,e.preventDefault(),e.stopImmediatePropagation();return}jo=0}function qw(e={}){if(ly)return;let t=Od();!t||typeof window>"u"||(ly=!0,Nd="PointerEvent"in window,cy=!Nd&&"ontouchstart"in window,e.selector&&(Rd=`${e.selector}, ${Gc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(fy=e.longPressMs),t.addEventListener("click",$w,!0),Nd?(t.addEventListener("pointerdown",Bw,{capture:!0,passive:!1}),t.addEventListener("pointerup",Uw,{capture:!0,passive:!0})):cy&&(t.addEventListener("touchstart",Fw,{capture:!0,passive:!1}),t.addEventListener("touchend",Dw,{capture:!0,passive:!0})))}function uy(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Gc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(dy(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function Gw(){let e=Od();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",uy,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",uy,{capture:!1,passive:!1})}function Hw(e){e&&(Rd=`${e}, ${Gc}`)}var Nw,qc,ms,Gc,Rw,ly,Rd,Nd,cy,Ow,Hc,Tr,jo,fy,hs=De(()=>{Nw=0,qc=Symbol("ccc:ghostTap:skipUntil"),ms="__cccGhostTapSkipUntil",Gc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',Rw=80,ly=!1,Rd=Gc,Nd=!1,cy=!1,Ow=null,Hc=0,Tr=0,jo=0,fy=Rw});var Pd,hy=De(()=>{Pd={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var gy={};bt(gy,{FIXED_STEP:()=>Po,RateAccumulator:()=>ja,TICK_RATE:()=>Xc,pauseGameLoop:()=>$d,registerFrame:()=>Ww,registerTick:()=>to,resumeGameLoop:()=>qd,startGameLoop:()=>Vw,stopGameLoop:()=>Yw});function Ud(e){e||(e=performance.now());let t=e;if(Dd){ci=t,fi=requestAnimationFrame(Ud);return}ci||(ci=t);let n=(t-ci)/1e3;ci=t,n>60&&(n=60),n<0&&(n=0),ui+=n;let o=0,r=250;for(;ui>=Po;){if(o>=r){ui=ui%Po;break}Bd.forEach(i=>{try{i(Po)}catch(s){console.error("Error in game tick listener:",s)}}),ui-=Po,o++}if(Fd.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),gs===0||ys===0)gs=Date.now(),ys=t;else{let i=t-ys;if(i>Xw){let s=Date.now(),l=s-gs;l<-1e3?kn():l>i+1e4&&kn(),gs=s,ys=t}}fi=requestAnimationFrame(Ud)}function $d(){Dd=!0}function qd(){Dd=!1,ci=performance.now(),ui=0,gs=0,ys=0}function Vw(){fi||(ci=performance.now(),ui=0,gs=0,ys=0,fi=requestAnimationFrame(Ud))}function Yw(){fi&&(cancelAnimationFrame(fi),fi=null)}function to(e){return typeof e!="function"?()=>{}:(Bd.add(e),()=>{Bd.delete(e)})}function Ww(e){return typeof e!="function"?()=>{}:(Fd.add(e),()=>{Fd.delete(e)})}var Xc,Po,Bd,Fd,fi,Dd,ci,ui,gs,ys,Xw,ja,Ar=De(()=>{St();Xc=20,Po=1/Xc,Bd=new Set,Fd=new Set,fi=null,Dd=!1,ci=0,ui=0,gs=0,ys=0,Xw=2e3;ja=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Po;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Je,di,Za,Ja,Qa,el,yo,tl,vs,zw,Kw,jw,Zw,Jw,yy,pi=De(()=>{Et();Je="automation",di=1,Za=2,Ja=3,Qa=4,el=5,yo=6,tl=7,vs={[Za]:"coins",[Ja]:"books",[Qa]:"gold",[el]:"magic",[tl]:"dna"},zw="img/misc/mysterious.webp",Kw="img/misc/locked.webp",jw="Hidden Upgrade",Zw="Locked Upgrade",Jw=[{area:Je,id:di,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Je,id:Za,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Je,id:Ja,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Je,id:Qa,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Je,id:el,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Je,id:yo,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}},{area:Je,id:tl,title:"Autobuy DNA Upgrades",desc:"Automatically buys DNA upgrades",icon:"sc_upg_icons/autobuy_dna.webp",lvlCap:1,baseCost:1e27,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e27")},effectSummary(){return null},computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=11||t===1/0)&&(n=!0):typeof t=="bigint"?t>=11n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=11)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};if(!e.surgeUnlocked)return{locked:!0,iconOverride:Kw,titleOverride:Zw,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0};let o="Reach Surge 11 to reveal this upgrade";return{locked:!0,iconOverride:zw,titleOverride:jw,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}],yy=Jw.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});function by(e){typeof e=="function"&&vy.push(e)}function Gd(){nl=null}function Yc(){nl=null;try{Vc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{Jt()}catch{}}function Hd(e){return typeof e=="function"&&Vc.push(e),()=>{Vc=Vc.filter(t=>t!==e)}}function eE(e){let t=yt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return re(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function tE(){try{return!!vn()}catch{return!1}}function ol(e){let t=A?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(tE())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=Nt(Ie.STARTER_COVE,_e.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=eE(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function hi(e=Ie.STARTER_COVE){if(nl)return nl;let t=Tt(e),n=[];if(e===Ie.STARTER_COVE&&Ie.DNA){let i=Tt(Ie.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),goldValue:c.fromInt(1),magicValue:c.fromInt(1),waveValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=Pn(s,i.id),a=Ye(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:m,mpMult:v}=Qo(i,l,s);r.xpValue=It(r.xpValue,d),r.coinValue=It(r.coinValue,m),r.mpValue=It(r.mpValue,v),u=It(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=It(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=It(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=It(r.mpValue,u);else if(i.effectType==="gold_value")r.goldValue=It(r.goldValue,u);else if(i.effectType==="magic_value")r.magicValue=It(r.magicValue,u);else if(i.effectType==="wave_value")r.waveValue=It(r.waveValue,u);else if(i.effectType==="book_value")r.bookValue=It(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of vy)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return nl=r,r}function bs(e){let t=hi(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:Qw*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue,goldValueMultiplier:t.goldValue,magicValueMultiplier:t.magicValue}}function mi(){let{goldValue:e,magicValue:t,waveValue:n}=hi(Ie.STARTER_COVE);try{A.gold?.mult?.set&&A.gold.mult.set(e)}catch{}try{if(A.magic?.mult?.set){let o=Xd(),r=It(t,o);A.magic.mult.set(r)}}catch{}try{A.waves?.mult?.set&&A.waves.mult.set(n)}catch{}}function Wc(){try{let{mpValue:e}=hi(Ie.STARTER_COVE);return e}catch{return c.fromInt(1)}}function zc(){try{let{magnetRadius:e}=hi(Ie.STARTER_COVE);return e||0}catch{return 0}}function Sy(){try{Jo()}catch{}mi(),Hd(mi);try{On(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=hi(Ie.STARTER_COVE);return It(n,o)})}catch{}try{Ko(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=hi(Ie.STARTER_COVE);return It(n,o)})}catch{}try{gi(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=hi(Ie.STARTER_COVE);return It(n,o)})}catch{}ol(),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{try{ol()}catch{}try{Jt()}catch{}try{mi()}catch{}}),window.addEventListener("surge:level:change",()=>{try{mi()}catch{}}),window.addEventListener("surge:nerf:change",()=>{try{mi()}catch{}}))}var Qw,nl,Vc,vy,Kc=De(()=>{Et();St();vo();bn();bo();no();Sn();Qw=1,nl=null,Vc=[],vy=[]});var _y={};bt(_y,{getLabCost:()=>xy,getLabLevel:()=>Qt,getLabLevelFromCoins:()=>Ly,getLabLevelKey:()=>Yd,getRpMult:()=>xs,getRpMultBase:()=>Jc,hasVisitedLab:()=>Es,initLabLogic:()=>nE,initLabTab:()=>Kd,setLabLevel:()=>vi,setLabVisited:()=>Ey,updateLabLevel:()=>Wd,updateLabTab:()=>jd});function il(){let e=b();if(al=e,e==null){er=c.fromInt(0),yi=!1;return}try{let t=localStorage.getItem(Zc(e));t?er=c.fromAny(t):er=c.fromInt(0)}catch{er=c.fromInt(0)}try{yi=localStorage.getItem(wy(e))==="1"}catch{yi=!1}}function Es(){let e=b();return e==null?!1:((al!==e||yi===null)&&il(),yi)}function Ey(e){let t=b();if(t==null)return;let n=!!e;if(!(yi===n&&al===t)){yi=n;try{localStorage.setItem(wy(t),n?"1":"0")}catch{}}}function Qt(){let e=b();return e==null?c.fromInt(0):A.coins.value.isInfinite()?c.fromAny("Infinity"):((al!==e||er===null)&&il(),er)}function vi(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((al!==t||er===null)&&il(),n.cmp(er)===0)return;er=n,localStorage.setItem(Zc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function xy(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Ly(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Wd(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Zc(e)))return;let t=A.coins.value,n=Qt();if(t.isInfinite()){n.isInfinite()||vi(c.fromAny("Infinity"));return}let o=Ly(t);o.cmp(n)>0&&vi(o)}function nE(){il(),typeof window<"u"&&window.addEventListener("saveSlot:change",il),to(Wd),to(Cy),My()}function zd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function oE(e){if(!e||typeof e!="object")return 0;if(zd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function Iy(e){if(zd(e)||typeof e.cmp=="function"&&e.cmp(rE)>=0)return ws.clone?.()??ws;let t=e.floorToInteger(),n=e.sub(t),o=oE(n);if(!Number.isFinite(o))return ws.clone?.()??ws;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return ws.clone?.()??ws;let d=BigInt(u)+l-BigInt(i),v=d%BigInt(250),p=Number(v),h=d-v;return new c(a,{base:p,offset:h})}function Jc(){let e=Qt();if(zd(e))return c.fromAny("Infinity");if(se(12)){let o=ft(),r=5*o,i=2+o/2,s=Math.log10(i).toFixed(18),a=e.mulDecimal(s,18).add(c.fromAny(String(r)));return Iy(a)}let n=e.mulDecimal("0.3010299956639812",18);return Iy(n)}function xs(){let e=Jc();return typeof eo=="function"?eo("rp",e):e}function Kd(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",rl&&rl.destroy(),rl=new Vd(e))}function jd(){Ey(!0),rl&&rl.resize()}var kr,Ss,Is,wy,Zc,er,yi,al,Yd,ws,rE,rl,jc,Vd,Si=De(()=>{St();Io();Et();Gt();Sn();Ar();ps();nr();Rr();no();kr=1e308,Ss=1e300,Is=1e-300,wy=e=>`ccc:lab:visited:${e}`,Zc=e=>`ccc:lab:level:${e}`,er=null,yi=null,al=null;Yd=e=>Zc(e);ws=c.fromAny("Infinity"),rE=c.fromScientific(String(c.MAX_E));rl=null;jc=512*.95,Vd=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${W(Qt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Wd()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami Exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=Qe?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>kr&&(this.camX=kr),this.camX<-kr&&(this.camX=-kr),this.camY>kr&&(this.camY=kr),this.camY<-kr&&(this.camY=-kr),this.zoom>Ss&&(this.zoom=Ss),this.zoom<Is&&(this.zoom=Is)}update(t){this.checkBounds();let n=Qt(),o=xy(n.add(1)),r=Bn(),i=oo(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${W(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${W(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami Exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let m=this.bursts[d];m.time+=t;for(let v of m.particles)v.x+=v.vx*t,v.y+=v.vy*t,v.vx*=.95,v.vy*=.95;m.time>=m.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),m=(L,F)=>{if(F<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*F})`,t.lineWidth=1,t.beginPath();let T=Math.floor((this.camX-n/2/r)/L)*L,C=Math.ceil((this.camX+n/2/r)/L)*L;if((C-T)/L>1e3)return;for(let ae=T;ae<=C&&!(ae+L<=ae);ae+=L){let he=(ae-this.camX)*r+n/2;t.moveTo(he,0),t.lineTo(he,o)}let z=Math.floor((this.camY-o/2/r)/L)*L,Q=Math.ceil((this.camY+o/2/r)/L)*L;for(let ae=z;ae<=Q&&!(ae+L<=ae);ae+=L){let he=(ae-this.camY)*r+o/2;t.moveTo(0,he),t.lineTo(n,he)}t.stroke()},v=d*r,p=Math.max(0,Math.min(1,(v-15)/25));m(d,p),m(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let h=(0-this.camY)*r+o/2;h>=-10&&h<=o+10&&(t.moveTo(0,h),t.lineTo(n,h));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let y=[],I=new Map;for(let L of Rt)Nr(L.id)&&(y.push(L),I.set(L.id,this.getNodePosition(L)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let L of y)if(L.parentIds&&L.parentIds.length>0)for(let F of L.parentIds){let T=Rt.find(C=>C.id===F);if(T&&I.has(T.id)){let C=I.get(T.id),z=I.get(L.id),Q=(C.x-this.camX)*r+n/2,ae=(C.y-this.camY)*r+o/2,he=(z.x-this.camX)*r+n/2,Se=(z.y-this.camY)*r+o/2;t.moveTo(Q,ae),t.lineTo(he,Se)}}t.stroke();let E=jc,M=E*r,G=E*1.6*r;for(let L of y){let F=I.get(L.id),T=(F.x-this.camX)*r+n/2,C=(F.y-this.camY)*r+o/2,z=st(L.id),Q=z>=L.maxLevel,ae=!0;if(T+G/2<0||T-G/2>n||C+G*.8<0||C-G/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,T-G/2,C-G/2,G,G),Q?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,T-G/2,C-G/2,G,G):tr(L.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,T-G/2,C-G/2,G,G);let Se=this.nodeImages[L.id];if(Se||(Se=new Image,Se.src="img/"+L.icon,this.nodeImages[L.id]=Se),Se.complete&&Se.naturalWidth!==0&&t.drawImage(Se,T-M/2,C-M/2,M,M),ae){let Oe=sl(L.id),Ae=0;if(Q)Ae=1;else if(Oe.isInfinite?.()||typeof Oe.cmp=="function"&&Oe.cmp(c.fromAny("Infinity"))===0)Ae=0;else{let Y=So(L.id);if(Y.isZero?.())Ae=0;else try{if(Oe.isZero?.())Ae=1;else{let de=Y.div(Oe).toScientific(5);Ae=Number(de)}}catch{Ae=0}}Ae=Math.max(0,Math.min(1,Ae));let U=G*.96,K=G*.18,q=T-U/2,X=C+G/2+G*.05;t.fillStyle="#111",t.fillRect(q,X,U,K);let J=t.createLinearGradient(q,X,q,X+K);J.addColorStop(0,"#2a5298"),J.addColorStop(1,"#1e3c72"),t.fillStyle=J,t.fillRect(q,X,U*Ae,K),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect(q,X,U,K),t.fillStyle="#fff",t.font=`bold ${K*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,K*.08);let le="";{let Y=W(c.fromAny(z));Y.indexOf("<")>=0&&(Y="\u221E"),le=`Level ${Y}`}Q&&(le=L.maxLevel===1?"UNLOCKED":"MAXED");let fe=t.measureText(le),_=X+K/2+(fe.actualBoundingBoxAscent-fe.actualBoundingBoxDescent)/2;t.strokeText(le,q+U/2,_),t.fillText(le,q+U/2,_)}}let P=35,$=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let L of this.bursts){let F=(L.x-this.camX)*this.zoom+n/2,T=(L.y-this.camY)*this.zoom+o/2;for(let C=0;C<$.length;C++){let z=$[C],Q=L.time-z.delay;if(Q>0&&Q<z.dur){let ae=Q/z.dur,he=1-Math.pow(1-ae,3),Se=P*he,Oe=Math.max(0,1-Math.pow(ae,2)),Ae=1+C*.5,U=t.createRadialGradient(F,T,Se*.6,F,T,Se);U.addColorStop(0,"rgba(255, 200, 50, 0)"),U.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,Oe*.15*Ae)})`),U.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,Oe*.2*Ae)})`),U.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=U,t.beginPath(),t.arc(F,T,Se,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let C of L.particles)if(L.time<C.life){let z=1-L.time/C.life,Q=F+C.x,ae=T+C.y;t.fillStyle=`rgba(255, 255, 150, ${z})`,t.beginPath(),t.arc(Q,ae,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=jc/2*1.6;for(let u of Rt){if(!Nr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Rt.find(m=>m.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.innerHTML=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let m=tr(t);bi(t,!m),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Zd(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Rt.find(l=>l.id===this.activeOverlayId);if(!t||!Nr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=st(t.id),o=So(t.id),r=sl(t.id),i=tr(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.innerHTML=`Level ${W(c.fromAny(n))} / ${W(c.fromAny(t.maxLevel))} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.innerHTML=`Level ${W(c.fromAny(n))} / ${W(c.fromAny(t.maxLevel))}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.innerHTML=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?W(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?W(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${W(o)} / ${W(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=jc/2*1.6;for(let u of Rt){if(!Nr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){if(st(u.id)>=u.maxLevel)return;let h=tr(u.id);bi(u.id,!h),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=jc/2*1.6;for(let u of Rt){if(!Nr(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,m=s-f.y;if(Math.sqrt(d*d+m*m)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<Is&&(i=Is),i>Ss&&(i=Ss);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<Is&&(i=Is),i>Ss&&(i=Ss);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var Ry={};bt(Ry,{addExternalEacAmountMultiplierProvider:()=>ep,addExternalEacMultiplierProvider:()=>iE,getAutobuyerToggle:()=>Ii,getEacAmountMultiplier:()=>tu,initAutomationEffects:()=>uE,setAutobuyerToggle:()=>Or,setTsunamiBonusProvider:()=>Qd,updateAutomation:()=>Ny});function Qd(e){Ty=e}function iE(e){typeof e=="function"&&Ay.push(e)}function ep(e){typeof e=="function"&&ky.push(e)}function tu(){let e=1;if(se(2))if(se(8)){let t=Bn(),n=Ty(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of ky)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function tp(e){eu!==e&&(Ls.clear(),eu=e)}function Ii(e,t){let n=b();tp(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(Ls.has(r))return Ls.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return Ls.set(r,i),i}function Or(e,t,n){let o=b();tp(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);Ls.set(i,s);try{localStorage.setItem(i,s)}catch{}}function sE(e){Ny(e),cE(e)}function aE(){if(Qc)return Qc;let e=[...Tt(Ie.STARTER_COVE),...Tt(Ie.DNA)],t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Qc=t,Qc}function lE(e){if(!(!e||e.length===0))for(let t of e){let n=t.area||Ie.STARTER_COVE;if(Ii(n,t.id)!=="0"){let r=Nt(n,t.id),i=t.lvlCap??1/0;r<i&&op(n,t.id)}}}function cE(e){let t=b();tp(t);let n=aE();for(let[r,i]of Object.entries(vs)){let s=Number(r);Nt(Je,s)>0&&n[i]&&lE(n[i])}Nt(Je,yo)>0&&(Jd++,Jd>=5&&(Jd=0,Ii(Je,yo)!=="0"&&nu()))}function Ny(e){let n=Nt(Je,di);for(let r of Ay)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){ll=0;return}ll+=e;let o=1/n;if(ll>=o){let r=Math.floor(ll/o);if(r>0){let i=r;i*=tu(),np(i),ll-=r*o}}}function uE(){to(sE),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==eu&&(Ls.clear(),eu=t)})}var ll,Jd,Ty,Ay,ky,Ls,eu,Qc,_s=De(()=>{Ar();no();cl();pi();Cs();St();Sn();ll=0,Jd=0,Ty=()=>0;Ay=[];ky=[];Ls=new Map,eu=null;Qc=null});function rp(){let e=b();if(Dy=e,e==null){ul=!1;return}try{ul=localStorage.getItem(fE(e))==="1"}catch{ul=!1}}function or(e){return Ms.nodes[e]||(Ms.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),Ms.nodes[e]}function dE(e,t){let n=or(t);try{let o=localStorage.getItem(fl(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(dl(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(Fy(e,t));n.active=i==="1";let s=localStorage.getItem(Uy(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function Oy(){rp();let e=b();Ms.nodes={},ro=null,e!=null&&Rt.forEach(t=>{dE(e,t.id),Ms.nodes[t.id].active&&(ro=t.id)})}function Py(){let e=b();e!=null&&Rt.forEach(t=>{let n=Ms.nodes[t.id];if(n)try{localStorage.setItem(dl(e,t.id),n.rp.toStorage())}catch{}})}function st(e){return or(e).level}function wo(e,t){let n=b();if(n==null||Zt(fl(n,e)))return!1;let o=or(e);if(o.level===t)return!0;o.level=t;try{localStorage.setItem(fl(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function So(e){return or(e).rp}function wi(e,t){let n=b();if(n!=null&&Zt(dl(n,e)))return;let o=or(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function tr(e){return or(e).active}function bi(e,t){let n=b();if(n==null)return;let o=!!t;o?(ro!==null&&ro!==e&&bi(ro,!1),ro=e):ro===e&&(ro=null);let r=or(e);if(r.active!==o){r.active=o;try{localStorage.setItem(Fy(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function By(e,t){let n=b();if(n==null)return;let o=or(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(Uy(n,e),o.discovered?"1":"0")}catch{}}}function Nr(e){let t=Fn.get(e);if(!t)return!1;if(or(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return By(e,!0),!0;if((e===5||e===6)&&((Dy!==b()||ul===null)&&rp(),!ul))return!1;for(let o of t.parentIds){let r=Fn.get(o);if(!r)continue;if(st(o)<r.maxLevel)return!1}return By(e,!0),!0}function sl(e){let t=Fn.get(e);if(!t)return c.fromAny("Infinity");let n=st(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=c.fromAny(t.scale),r=be(o),i=c.fromAny(t.baseRpReq),l=be(i)+n*r;return re(l)}function oo(){let e=0,t=st(1);t>0&&(e+=t*.01);let n=st(10);return n>0&&(e+=n*.01),e}function $y(){return st(4)>=1}function qy(e=[]){if(b()!=null){try{vi(0)}catch{}ro!==null&&bi(ro,!1),Rt.forEach(n=>{e.includes(n.id)||(wo(n.id,0),wi(n.id,c.fromInt(0)))})}}function Cy(e){let t=xs();if(t.isZero?.()||ro===null)return;let n=Fn.get(ro);if(!n||!Nr(n.id))return;let r=t.mulDecimal(e.toString(),18),i=So(n.id);if(st(n.id)>=n.maxLevel)return;let s=i.add(r),l=st(n.id);if(l<n.maxLevel||!Number.isFinite(n.maxLevel)){let a=sl(n.id),u=be(s),f=be(a);if(u-f>2){let d=0n,m=c.zero(),v=c.fromAny(n.scale),p=v.sub(1),h=!1;if((p.isZero()||Math.abs(Number(v.toScientific())-1)<1e-9)&&(h=!0),h){let y=s.div(a).floorToInteger().toPlainIntegerString();(y==="Infinity"||y.length>15)&&(y="9007199254740991");try{d=BigInt(y)}catch{d=0n}if(Number.isFinite(n.maxLevel)){let I=BigInt(n.maxLevel)-BigInt(l);d>I&&(d=I)}d>0n&&(m=a.mulScaledInt(d,0))}else if(p.isZero()===!1&&(p.sig>0n||p.isInfinite())){let g=be(v),y=be(p),I=u-f+y,E=Math.floor(I/g);if(E>5){let M=BigInt(Math.max(0,E-5));if(Number.isFinite(n.maxLevel)){let N=BigInt(n.maxLevel)-BigInt(l);M>N&&(M=N)}if(M>0n){d=M;let N=Number(d)*g,P=re(N).sub(1).div(p);m=a.mulBigNumInteger(P)}}}if(d>0n){s=s.sub(m);let g=l+Number(d);wo(n.id,g)}}}for(;;){let a=sl(n.id);if(s.cmp(a)<0||st(n.id)>=n.maxLevel)break;s=s.sub(a);let u=st(n.id),f=u+1;if(f<=u||!wo(n.id,f))break}wi(n.id,s)}function Xy(){let e=Fn.get(2);if(!e)return c.fromInt(1);let t=st(e.id);return t<=0?c.fromInt(1):re(t*Gy)}function Vy(){let e=Fn.get(3);if(!e)return c.fromInt(1);let t=st(e.id);return t<=0?c.fromInt(1):re(t*Gy)}function Ei(){let e=Fn.get(5);if(!e)return c.fromInt(1);let t=st(e.id);return t<=0?c.fromInt(1):re(t*Hy)}function ip(){let e=Fn.get(6);if(!e)return c.fromInt(1);let t=st(e.id);return t<=0?c.fromInt(1):re(t*Hy)}function mE(){let e=Fn.get(7);if(!e)return c.fromInt(1);let t=st(e.id);return t<=0?c.fromInt(1):re(t*pE)}function Yy(){let e=Fn.get(8);return e?1+st(e.id)*.1:1}function Wy(){let e=Fn.get(9);return e?1+st(e.id)*.1:1}function My(){On(({baseMultiplier:e})=>{let t=Xy();return e.mulDecimal(t.toScientific())}),Ko(({baseGain:e})=>{let t=Vy();return e.mulDecimal(t.toScientific())}),by(()=>Yy()),ep(()=>Wy()),Qd(()=>oo()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&Jt(),e&&e.id===8&&Yc()})}var fl,dl,Fy,Uy,fE,Rt,Fn,ul,Dy,Ms,ro,Gy,Hy,pE,nr=De(()=>{Et();St();Si();Gt();bn();Kc();_s();fl=(e,t)=>`ccc:lab:node:level:${t}:${e}`,dl=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,Fy=(e,t)=>`ccc:lab:node:active:${t}:${e}`,Uy=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,fE=e=>`ccc:reset:experiment:completed:${e}`,Rt=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Te(Xy())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Te(Vy())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Te(Ei())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Te(ip())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e8,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Te(mE())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Te(Yy())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Te(Wy())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:`Increases the Tsunami Exponent by +0.01 per level\nThis node scales <strong>10x</strong> RP each level`,baseRpReq:1e13,scale:10,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`}],Fn=new Map(Rt.map(e=>[e.id,e])),ul=null,Dy=null,Ms={nodes:{}},ro=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",Oy),setInterval(Py,1e3),window.addEventListener("beforeunload",Py),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&rp()}),Oy());Gy=Math.log10(2),Hy=Math.log10(3),pE=Math.log10(1.1);window.RESEARCH_NODES=Rt;window.isResearchNodeVisible=Nr});function cp(){sp||(sp=setTimeout(()=>{sp=null,gE()},1e3))}function gE(){let e=b();if(e!=null&&Ts())try{localStorage.setItem(Ky(e),tn.toFixed(6))}catch{}}function yE(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(Ky(e));if(t){let n=parseFloat(t);return Number.isFinite(n)?n:0}}catch{}return 0}function zy(){iu=!1,Ts()?tn=yE():tn=0,Pr=0,ml=0,ap=0,hl()}function hl(){lp.forEach(e=>{try{e(tn)}catch{}})}function jy(){if(!ou()||iu)return;let e=performance.now();if(Pr=0,ml=0,e-ap>=1e3){let t=ru(),n=!1;tn<t?(tn+=hE,n=!0,tn>t&&(tn=t)):tn>t&&(tn=t,n=!0),n&&(hl(),Ts()&&cp()),ap=e}}function Zy(e){if(!ou()||iu)return;let t=ru(),n=!1;if(tn>t&&(tn=t,n=!0),Ts()){n&&(hl(),cp());return}if(Pr<pl)for(ml+=e;ml>=1;)ml-=1,Pr<pl&&(Pr+=1,Pr>=pl&&(tn=0,n=!0));n&&hl()}function up(){if(!ou())return 0;let e=tn,t=0;return Pr<pl&&(t=Math.max(0,1-Pr/pl)),e*t}function Jy(e,t,n){typeof e=="function"&&(ou=e),typeof t=="function"&&(ru=t),typeof n=="function"&&(Ts=n),typeof window<"u"&&(window.addEventListener("saveSlot:change",zy),zy())}function fp(e){iu=!!e}function Qy(e){tn=Number(e)||0,hl(),Ts()&&cp()}function su(){return tn}function ev(){return ru()}function tv(e){lp.add(e)}function nv(e){lp.delete(e)}var pl,Ky,hE,tn,Pr,ml,ou,ru,Ts,ap,iu,lp,sp,au=De(()=>{St();pl=60,Ky=e=>`ccc:combo:value:${e}`,hE=.001,tn=0,Pr=0,ml=0,ou=()=>!1,ru=()=>1,Ts=()=>!1,ap=0,iu=!1,lp=new Set,sp=null});var lv={};bt(lv,{getBookProductionRate:()=>Fr,getComboUiString:()=>hp,getEffectiveTsunamiNerf:()=>ft,getEffectiveTsunamiNerfWithCombo:()=>mp,getSurge15Divisor:()=>gl,getSurge15Multiplier:()=>lu,getSurge6WealthMultipliers:()=>cu,getSurgeMagicMultiplier:()=>Xd,getTsunamiNerf:()=>Bn,getTsunamiNerfKey:()=>pp,getTsunamiSequenceSeen:()=>In,initSurgeEffects:()=>SE,isSurgeActive:()=>se,setTsunamiNerf:()=>Li,setTsunamiSequenceSeen:()=>ir});function pp(e){return dp(e)}function In(){let e=b();if(e==null)return!1;try{return localStorage.getItem(av(e))==="1"}catch{return!1}}function ir(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(av(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Bn(){return Br}function ft(){let t=Bn()+oo();return t>1&&(t=1),t}function mp(){let e=ft();if(se(14)){let t=up();e+=t,e>1&&(e=1)}return e}function hp(){if(!se(14))return"";let e=up();if(e<=0)return"";let t=Te(e);t==="0"&&(t="0.000");let n=` (+^${t})`,r=Bn()+oo();r>1&&(r=1);let i=1-r;return e>=i-1e-6&&i>0&&(n=`<span style="color: #02e815">${n}</span>`),n}function Li(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=dp(n);if(Zt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}Br=t,As();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function se(e){return Eo===1/0||typeof Eo=="string"&&Eo==="Infinity"||Eo===Number.POSITIVE_INFINITY?!0:typeof Eo=="bigint"?Eo>=BigInt(e):typeof Eo=="number"?Eo>=e:!1}function xi(e){if(!se(8))return e;let t=be(e);if(!Number.isFinite(t))return e;let n=ft();return re(t*n)}function As(){let e=ln();Eo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(se(8)){let n=ft(),o=Math.log10(ov);rr=re(o*n)}else rr=c.fromInt(ov);else rr=c.fromInt(1)}function lu(e=!1){if(!e&&!se(15))return c.fromInt(1);let t=A.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=be(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return re(l)})(t);return se(8)?xi(o):o}function gl(e=!1){if(!e&&!se(15))return c.fromInt(1);let t=A.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=be(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i/2;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return re(l)})(t);return se(8)?xi(o):o}function cu(){if(!se(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(m,v=0)=>{if(!m){if(v<=0)return c.fromInt(1);let E=Math.log10(v)/3;if(E<=0)return c.fromInt(1);let M=E*Math.log10(2);return re(M)}if(m.isInfinite?.())return c.fromAny("Infinity");let p=be(m),h=p;if(Number.isFinite(p)){if(p<15&&v>0)try{let I=Number(m.toPlainIntegerString());if(Number.isFinite(I)){let E=I+v;E>0&&(h=Math.log10(E))}}catch{}}else if(v>0)h=Math.log10(v);else return c.fromInt(1);let g=h/6;if(g<=0)return c.fromInt(1);let y=g*Math.log10(2);return re(y)},t=e(A.coins?.value),n=A.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(A.gold?.value),s=e(A.magic?.value),l=t,a=r,u=i,f=s;se(8)&&(l=xi(t),a=xi(r),u=xi(i),f=xi(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function Fr(){if(!se(3))return c.fromInt(0);let t=et().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(rv),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=re(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*rv;n=re(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),A.books?.mult){let o=A.books.mult.get();n=n.mulBigNumInteger(o)}return se(8)&&(n=xi(n)),n}function vE(e){if(se(14)&&Zy(e),se(3)){iv||(iv=new ja("books",A));let t=Fr();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);A.books&&A.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,A.books&&A.books.add(c.fromInt(o))}}}if(se(13)){let o=2*(ft()*1.5-.5)-2,r=re(o),i=A.coins?.value,s=et(),l=ks(i,s.xpLevel),a=A.gold?.mult?.applyTo?.(l)??l,u=Ei();a=a.mulDecimal(u.toScientific());let d=a.mulDecimal(r.toScientific()).mulDecimal(String(e),18);A.gold&&A.gold.add(d)}if(se(16)){let o=2*(ft()*1.5-.5)-2,r=re(o),i=A.coins?.value,s=sr(),u=Ns(i,s).mulDecimal(r.toScientific()).mulDecimal(String(e),18);A.magic&&A.magic.add(u)}}function sv(e){if(e==null)return;let t=localStorage.getItem(dp(e));t!==null?(Br=Number(t),(Number.isNaN(Br)||!Number.isFinite(Br))&&(Br=se(8)?0:1)):se(8)?Br=0:Br=1}function bE(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function SE(){Jy(()=>se(14)&&Bn()+oo()<1,()=>1-ft(),()=>{let t=ln();return t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY?!0:typeof t=="bigint"?t>=20n:typeof t=="number"?t>=20:!1});let e=b();As(),sv(e),As(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=Eo,n=se(8);As();let o=Eo,r=se(8);!n&&r?(Li(0),In()||ir(!0)):r?bE(t,o)>0&&(Li(0),In()||ir(!0)):n&&!r&&Li(1)}),window.addEventListener("lab:node:change",()=>{As()}),window.addEventListener("saveSlot:change",()=>{sv(b()),As()}),window.addEventListener("currency:change",t=>{if(t.detail?.key==="dna"){try{Jt()}catch{}try{mi()}catch{}}})),On(({baseMultiplier:t})=>rr.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(rr)),Ko(({baseGain:t})=>rr.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(rr)),Ko(({baseGain:t})=>se(19)?t.mulSmall(2):t),gi(({baseGain:t})=>rr.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(rr)),gi(({baseGain:t})=>{if(!se(4))return t;let n=c.fromInt(4444e9);if(se(8)){let o=ft(),r=Math.log10(4444e9);n=re(r*o)}return t.mulBigNumInteger(n)}),On(({baseMultiplier:t})=>{if(!se(6))return t;let n=cu();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),On(({baseMultiplier:t})=>{if(!se(15))return t;let n=t,o=lu();o.cmp(1)>0&&(n=n.mulBigNumInteger(o));let r=gl();return r.cmp(1)>0&&(n=n.div(r)),n}),On(({baseMultiplier:t})=>{let n=0;if(se(17)&&(n-=5),se(18)&&(n+=15),n===0)return t;if(se(8)){let r=ft();n*=r}let o=re(n);return t.mulBigNumInteger(o)}),$c(({baseReward:t})=>se(3)?c.fromInt(0):t),to(vE)}function Xd(){let e=0;if(se(17)&&(e+=15),se(18)&&(e-=5),se(8)){let n=ft();e*=n}let t=c.fromInt(1);if(e!==0&&(t=re(e)),se(15)){let n=gl();n.cmp(1)>0&&(t=t.div(n))}return t}var ov,rv,dp,av,rr,Eo,iv,Br,Sn=De(()=>{Et();St();bn();Kc();bo();vo();Ar();Et();nr();au();Gt();ov=10,rv=.08685889638,dp=e=>`ccc:surge:tsunamiNerf:${e}`,av=e=>`ccc:unlock:tsunami:${e}`;rr=c.fromInt(1),Eo=0n,iv=null,Br=0});var gv={};bt(gv,{getGearsProductionRate:()=>mu,getGenerationLevelKey:()=>Mi,getGenerationUpgradeCost:()=>Ur,initWorkshopSystem:()=>hv,initWorkshopTab:()=>wp,performFreeGenerationUpgrade:()=>nu,updateWorkshopTab:()=>xo});function Os(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*AE}function Mi(e){return`ccc:workshop:genLevel:${e}`}function bl(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(Mi(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function Il(e){let t=b();if(!t)return!1;let n=Mi(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function wl(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return yp;if(t<=_i)return yp+t*uv;fu===null&&(fu=yp+_i*uv);let n=t-_i;if(t<=yl)return fu+n+Os(n,Rs);if(du===null){let d=yl-_i;du=fu+d+Os(d,Rs)}let o=t-yl,r=t-_i,i=yl-_i,s=o+(Os(r,Rs)-Os(i,Rs)),l=CE/_E,a=.5*l*o*o;if(t<=uu)return du+s+a;if(vp===null){let d=uu-yl,m=uu-_i,v=d+(Os(m,Rs)-Os(i,Rs)),p=.5*l*d*d;vp=du+v+p}let u=ME*(t-uu);if(u>709)return 1/0;let f=vp*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function Ur(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=wl(t);return re(n)}function Ip(e){let t,n=e;e instanceof c||(n=c.fromAny(e));let o=se(11)?LE:se(7)?xE:EE;if(n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let i=n.mulDecimal(o);if(n.cmp(9e15)<=0){let l=Number(n.toString())*o;t=re(l)}else{let s=n.mulDecimal(o);if(s.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let l=Number(s.toScientific(10));l===1/0?t=c.fromAny("Infinity"):t=re(l)}catch{t=c.fromAny("Infinity")}}}let r=A?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(r)}function RE(){let e=Ur(at);if(A.coins.value.cmp(e)<0)return;let t=at.add(1);Il(t)&&(at=t,A.coins.sub(e),xo(),Ht())}function OE(){if(!Xt())return;let n=Ip(at).mulDecimal(String(Po)).floorToInteger();if(!n.isZero()&&A.gears&&A.gears.add(n),at.cmp(20)<0){let r=Number(at.toPlainIntegerString()),s=Math.pow(se(11)?4:se(7)?3:2,r)/Xc,l=Math.floor(s),a=s-l;if(Ci+=a,Ci>=1){let u=Math.floor(Ci);Ci-=u,A.gears&&A.gears.add(u)}}else Ci=0}function Sp(){A.gears&&A.gears.set(0),Il(c.zero())&&(at=c.zero()),Ci=0,xo()}function dv(e){if(!e)return;let t=Sl.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),Sl.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;at.cmp(gp)>0?i=gp:i=Number(at.toPlainIntegerString());let s=Math.min(Math.floor(i),gp),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,m=Math.cos(d)*fv,v=Math.sin(d)*fv,p=Math.random()*360,h=(Math.random()<.5?-1:1)*(kE+Math.random()*NE);l.push({x:u,y:f,dx:m,dy:v,rotation:p,rotationSpeed:h,size:a})}for(;l.length>s;)l.pop()}function PE(e){let t="Click the big red button below to open the Automation Shop";Qe&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${IE}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${pv}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will <span data-workshop="production-verb">double</span> the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${wE}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{RE()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),FE()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{Bs("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(nn&&nn.isConnected){let a=nn.querySelector(".workshop-side-left"),u=nn.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let m=Sl.get(d);if(m){let v=d.getBoundingClientRect(),p=window.devicePixelRatio||1;m.width=v.width,m.height=v.height;let h=Math.round(v.width*p),g=Math.round(v.height*p);if(m.canvas&&(m.canvas.width!==h||m.canvas.height!==g)&&(m.canvas.width=h,m.canvas.height=g,m.ctx.scale(p,p)),m.needsDistribution&&m.width>0&&m.height>0){m.needsDistribution=!1;for(let y of m.gears)y.x=Math.random()*(m.width-y.size),y.x<0&&(y.x=0),y.y=Math.random()*(m.height-y.size),y.y<0&&(y.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?mv():BE()},{root:null,threshold:0}).observe(e),nn=e}function xo(){if(!nn)return;let e=nn.querySelector('[data-workshop="production-verb"]');if(e){let a=se(11)?"quadruple":se(7)?"triple":"double";e.textContent!==a&&(e.textContent=a)}let t=nn.querySelector('[data-workshop="gears-amount"]'),n=nn.querySelector('[data-workshop="gears-rate"]'),o=nn.querySelector('[data-workshop="upgrade-cost"]'),r=nn.querySelector('[data-workshop="upgrade-gen"]'),i=Ip(at),s=Ur(at);if(t&&(t.innerHTML=A.gears.fmt(A.gears.value)),n&&(n.innerHTML=W(i)),o){let a="Coins";try{a=!s.isInfinite()&&s.cmp(1)===0?"Coin":"Coins"}catch{}o.innerHTML=`${W(s)} ${a}`}if(r){let a=A.coins.value.cmp(s)>=0;r.disabled=!a;let u=Nt(Je,yo),f=!1;if(u>0){let d=b(),m=d!=null?`:${d}`:"",v=`ccc:autobuy:${Je}:${yo}${m}`;f=localStorage.getItem(v)!=="0"}f?r.classList.add("is-automated"):r.classList.remove("is-automated")}let l="";if(at.isInfinite()?l="Infinity":l=at.floorToInteger().toStorage(),l!==bp){bp=l;let a=nn.querySelector(".workshop-side-left"),u=nn.querySelector(".workshop-side-right");a&&dv(a),u&&dv(u)}}function BE(){Ps&&(cancelAnimationFrame(Ps),Ps=null)}function mv(){if(Ps)return;vl=0;let e=t=>{if(nn&&nn.isConnected){let n=nn.querySelector('[data-workshop="gears-amount"]');n&&!Ep()&&(n.innerHTML=A.gears.fmt(A.gears.value)),vl||(vl=t);let o=(t-vl)/1e3;vl=t,o>.1&&(o=.1);for(let[r,i]of Sl){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!pu.complete||pu.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,m=f.y+f.size/2;u.save(),u.translate(d,m),u.rotate(f.rotation*Math.PI/180),u.drawImage(pu,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}Ps=requestAnimationFrame(e)};Ps=requestAnimationFrame(e)}function hv(){cv||(cv=!0,at=bl(),to(OE),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{at=bl(),Ci=0,Xt()||Sp(),xo()}),window.addEventListener("currency:change",e=>{e.detail.key===Re.COINS&&xo()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Re.GEARS&&xo()}),window.addEventListener("debug:change",()=>{at=bl(),xo()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Xt()||Sp())})))}function wp(e){hv(),!e.__workshopInit&&(e.__workshopInit=!0,at=bl(),Sl.clear(),bp=-1,PE(e),typeof IntersectionObserver>"u"&&mv(),Xt()||Sp(),xo())}function mu(){let e=bl();return Ip(e)}function nu(){let e=A.coins.value.isInfinite(),n=Ur(at).isInfinite();if(e&&n&&!at.isInfinite())return at=c.fromAny("Infinity"),Il(at),xo(),!0;if(A.coins.value.isZero())return!1;let o=be(A.coins.value);if(!Number.isFinite(o))if(A.coins.value.inf)o=1/0;else return!1;if(wl(at)>o||at.cmp(9e15)>0)return!1;let r=Number(at.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);wl(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(at)>0&&Il(a)?(at=a,xo(),!0):!1}function FE(){if(A.coins.value.isInfinite()){nu()&&Ht();return}let e=be(A.coins.value);if(!Number.isFinite(e)&&A.coins.value.isZero()||wl(at)>e||at.cmp(9e15)>0)return;let t=Number(at.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);wl(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(at.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(Ur(c.fromInt(u)));if(l.cmp(A.coins.value)>0){let u=Ur(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(at)>0&&Il(a)&&(at=a,A.coins.sub(l),xo(),Ht())}var pv,IE,pu,wE,gp,nn,cv,Ci,at,bp,Ps,yp,EE,xE,LE,_i,yl,uu,uv,Rs,_E,CE,ME,TE,AE,fu,du,vp,Sl,fv,kE,NE,vl,Cs=De(()=>{Et();Gt();St();Ar();Rr();vo();no();Io();pi();Sn();pv="img/currencies/gear/gear.webp",IE="img/currencies/gear/gear_plus_base.webp",pu=new Image;pu.src=pv;wE="img/currencies/coin/coin.webp",gp=100,nn=null,cv=!1,Ci=0,at=c.zero(),bp=-1,Ps=null,yp=12,EE=.3010299956639812,xE=.47712125471966244,LE=.6020599913279624,_i=1e6,yl=1e9,uu=1e12,uv=1,Rs=.001,_E=1e3,CE=Math.log10(1.00001),ME=23e-11,TE=Math.log(10),AE=1/TE;fu=null,du=null,vp=null;Sl=new Map,fv=67,kE=67,NE=67;vl=0});var bv={};bt(bv,{calculateOfflineRewards:()=>Fs,calculatePreAutomationRewards:()=>gu,formatTimeCompact:()=>hu,grantOfflineRewards:()=>Ti,initOfflineTracker:()=>$E,processOfflineProgress:()=>vv,showOfflinePanel:()=>Dr});function hu(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),y=g.mulBigNumInteger(l),I=t.sub(y),E=0;try{let M=I.div(c.fromInt(i)).floorToInteger();E=Number(M.toPlainIntegerString())}catch{E=0}return E===0?`${W(g)}y`:`${W(g)}y ${E}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let m=Math.floor(f/60),v=f%60;if(m<24)return v===0?`${m}h`:`${m}h ${v}m`;let p=Math.floor(m/24),h=m%24;return h===0?`${p}d`:`${p}d ${h}h`}function Dr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${hu(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let p=document.createElement("div");p.className="offline-pre-auto-note",p.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(p)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",UE.forEach(p=>{let h=p.key,g=e[h];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(h==="research_levels"){Array.isArray(g)&&g.forEach(P=>{let $=document.createElement("div");$.className="offline-row";let L=document.createElement("span");L.className="offline-plus",L.style.color="#004F96",L.textContent="+";let F=document.createElement("img");F.className="offline-icon",F.src=p.icon,F.alt="RP";let T=document.createElement("span");T.className="offline-text",T.style.color="#004F96";let C=c.fromInt(P.levels),z=C.cmp(c.fromInt(1))===0?"Level":"Levels";T.textContent=`${W(C)} ${z} of ${P.name}`,$.appendChild(L),$.appendChild(F),$.appendChild(T),f.appendChild($)});return}let y=document.createElement("div");y.className="offline-row";let I=document.createElement("span");I.className="offline-plus",I.classList.add(`text-${h}`),I.textContent="+";let E=document.createElement("img");E.className="offline-icon",E.src=p.icon,E.alt=h;let M=document.createElement("span");M.className="offline-text",M.classList.add(`text-${h}`);let N=!1;g instanceof c?N=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:N=Number(g)===1;let G=N?p.singular:p.plural;M.innerHTML=`${W(g)} ${G}`,y.appendChild(I),y.appendChild(E),y.appendChild(M),f.appendChild(y)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let m=document.createElement("button");m.type="button",m.className="offline-close-btn",m.textContent="Close";let v=()=>{r.remove()};return m.addEventListener("click",v),r.addEventListener("click",p=>{p.target===r&&v()}),d.appendChild(m),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{Us(i,a,".offline-scroll-container")}),r}function DE(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function Fs(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=xs?xs():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Rt.filter(v=>tr(v.id)),d=[],m={};for(let v of f){let p=st(v.id),h=So(v.id).add(u),g=0,y=v.maxLevel;for(;p<y;){let I=DE(v,p);if(I.isInfinite&&I.isInfinite()||h.cmp(I)<0)break;h=h.sub(I),p++,g++}g>0&&d.push({name:v.title,levels:g}),m[v.id]={level:p,rp:h}}d.length>0&&(o.research_levels=d),Object.keys(m).length>0&&(o.research_progress=m)}let s=(mu?mu():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||gn("gears",t)||(o.gears=s);let l=Fr?Fr():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||gn("books",t)||(o.books=u)}if(se(13)||se(16)){let d=2*(ft()*1.5-.5)-2,v=re(d).mulDecimal(String(e));if(se(13)){let p=A.coins?.value,h=et(),g=ks(p,h.xpLevel),y=A.gold?.mult?.applyTo?.(g)??g,I=Ei();y=y.mulDecimal(I.toScientific());let E=y.mulDecimal(v.toScientific());E.cmp(0)>0&&!gn("gold",t)&&(o.gold=E)}if(se(16)){let p=A.coins?.value,h=sr(),y=Ns(p,h).mulDecimal(v.toScientific());y.cmp(0)>0&&!gn("magic",t)&&(o.magic=y)}}let a=Nt(Je,di)||0;if(a>0){let u=1;se(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=vu(),m=d.coins.mulBigNumInteger(f),v=d.xp.mulBigNumInteger(f),p=d.mp.mulBigNumInteger(f);m.isZero()||gn("coins",t)||(o.coins=m),v.isZero()||Zt(`ccc:xp:progress:${t}`)||(o.xp=v),p.isZero()||Zt(`ccc:mutation:progress:${t}`)||(o.mp=p)}}return o}function Ti(e){if(b()!=null){if(e.xp)try{let n=ds(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Ds(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(wo(r,o.level),wi(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||A[n]&&typeof A[n].add=="function"&&A[n].add(e[n])}}function gu(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=io(),i=c.fromInt(1);try{let l=bs(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof eo=="function"){let l=eo("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=vu(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||Zt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||Zt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function vv(){let e=b();if(e==null)return;let t=fd(),n=Date.now();if(t<=0)return;if(n<t-1e4){kn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Xt()){let l=gu(r),a=Object.keys(l).length>0;return a&&(Ti(l),Dr(l,o,!0)),a}let i=Fs(r),s=Object.keys(i).length>0;return s&&(Ti(i),Dr(i,o)),s}function $E(e,t){yv||(yv=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?$d():(qd(),vv()&&typeof t=="function"&&t())))}))}var yv,UE,yu=De(()=>{St();Cs();vo();Ar();St();Et();Gt();Rr();Io();no();Si();nr();pi();cl();bn();bo();Sn();ps();bn();bo();vo();nr();Et();yv=!1;UE=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Dr});function _p(e){let t=24,n=Date.now();try{let o=localStorage.getItem(xp(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Lp(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(xp(e),"24"),localStorage.setItem(Lp(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function Iv(e,t,n){try{localStorage.setItem(xp(e),String(t)),localStorage.setItem(Lp(e),String(n))}catch{}}function wv(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=_p(e);if(t>=$s)return;let o=Date.now(),r=o-n;if(r>=bu){let i=Math.floor(r/bu);t+=i,t>=$s?(t=$s,n=o):n+=i*bu,Iv(e,t,n),$r&&$r.classList.contains("is-active")&&ar(!0)}}function GE(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function HE(){let e=b();if(e==null)return;wv();let{charges:t,lastCharge:n}=_p(e);t<=0||(t>=$s&&(n=Date.now()-50),t--,Iv(e,t,n),ar(!0),El&&clearInterval(El),El=setInterval(()=>{ar()},1e3),mt(qE,{volume:.5}),GE(),setTimeout(()=>{let o=Fs(Sv);Ti(o),Dr(o,Sv*1e3)},7250))}function ar(e=!1){if(!$r||!$r.classList.contains("is-active"))return;let t=b();if(t==null)return;e||wv();let{charges:n,lastCharge:o}=_p(t),r=$r.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${$s}</span>`);let i=$r.querySelector(".warp-timer");if(i)if(n>=$s)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+bu,u=Math.max(0,a-l);i.textContent=`Next warp in ${hu(u)}`}let s=$r.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function Ev(e){if(!e||e.__warpInit)return;e.__warpInit=!0,$r=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",HE),El||(El=setInterval(()=>{ar()},1e3)),ar()}var xp,Lp,$s,bu,Sv,qE,$r,El,Cp=De(()=>{St();yu();An();xp=e=>`ccc:warp:charges:${e}`,Lp=e=>`ccc:warp:lastCharge:${e}`,$s=24,bu=3600*1e3,Sv=150,qE="sounds/warp.ogg",$r=null,El=null});var Bv={};bt(Bv,{allocateFocus:()=>kv,getChannelCoinMultiplier:()=>Rv,getChannelUnlockState:()=>Gs,initChannelSystem:()=>Pv,initChannelTab:()=>Op,isChannelUnlocked:()=>Nv,resetChannels:()=>WE,setChannelUnlockChecker:()=>Rp,updateChannelTab:()=>Lo,upgradeFocusCapacity:()=>Av});function Np(){return b()}function Lv(){let e=Np();if(e==null)return;try{let n=localStorage.getItem(_v(e));$e.focusCapacity=n?parseInt(n,10):1,isNaN($e.focusCapacity)&&($e.focusCapacity=1)}catch{$e.focusCapacity=1}try{let n=localStorage.getItem(Cv(e));$e.totalFPAccumulated=n?c.fromAny(n):c.fromInt(0)}catch{$e.totalFPAccumulated=c.fromInt(0)}try{let n=localStorage.getItem(Mv(e));if(n){let o=JSON.parse(n);for(let r in o)$e.channels[r]&&($e.channels[r].level=c.fromAny(o[r].level||0),$e.channels[r].fp=Number(o[r].fp||0),$e.channels[r].allocated=Number(o[r].allocated||0))}}catch(n){console.warn("Failed to load channel data",n)}let t=0;for(let n of Object.values($e.channels))t+=n.allocated;if(t>$e.focusCapacity)for(let n in $e.channels)$e.channels[n].allocated=0}function qs(){let e=Np();if(e==null)return;localStorage.setItem(_v(e),String($e.focusCapacity)),localStorage.setItem(Cv(e),$e.totalFPAccumulated.toStorage());let t={};for(let[n,o]of Object.entries($e.channels))t[n]={level:o.level.toStorage(),fp:o.fp,allocated:o.allocated};localStorage.setItem(Mv(e),JSON.stringify(t))}function VE(){Mp||(Mp=setTimeout(()=>{Mp=null,qs()},2e3))}function Tv(){if($e.focusCapacity>=xl)return c.fromAny("Infinity");let e=XE+($e.focusCapacity-1);return c.fromScientific(`1e${e}`)}function Av(){let e=Tv();e.isInfinite()||A.coins.value.cmp(e)>=0&&(A.coins.sub(e),$e.focusCapacity++,qs(),Lo(),Ht())}function YE(){if($e.focusCapacity>=xl||A.coins.value.isZero())return;let e=be(A.coins.value);if(!Number.isFinite(e))return;let t=Math.floor(e-997),n=Math.min(xl,Math.max($e.focusCapacity,t));if(n>xl&&(n=xl),!(n<=$e.focusCapacity))for(;n>$e.focusCapacity;){let o=997+n,r=c.fromScientific(`1e${o}`);if(A.coins.value.cmp(r)<0){n--;continue}let i=r.mulDecimal("1.11111111");if(A.coins.value.cmp(i)>=0){A.coins.sub(i),$e.focusCapacity=n,qs(),Lo(),Ht();return}else n--}}function kv(e,t){let n=$e.channels[e];if(!n)return;let o=0;for(let i of Object.values($e.channels))o+=i.allocated;let r=$e.focusCapacity-o;if(t>0){let i=Math.min(t,r);i>0&&(n.allocated+=i,qs(),Lo())}else if(t<0){let i=Math.min(Math.abs(t),n.allocated);i>0&&(n.allocated-=i,qs(),Lo())}}function Gs(){let e=Np();if(e!=null)try{if(localStorage.getItem(`ccc:unlock:channel:${e}`)==="1")return!0}catch{}return Tp?Tp(20):!1}function Nv(){return Gs()}function Rp(e){Tp=e}function WE(e){if(e==="surge"){$e.totalFPAccumulated=c.fromInt(0);for(let t in $e.channels)$e.channels[t].level=c.fromInt(0),$e.channels[t].fp=0;qs(),Lo()}}function Rv({baseMultiplier:e}){let t=$e.channels[Su.COIN]?.level||c.fromInt(0),n=c.fromInt(1).add(t);return e.mulBigNumInteger(n)}function zE(e){if(!Nv())return;let t=!1,n=!1;for(let o in $e.channels){let r=$e.channels[o];if(r.allocated<=0)continue;let s=r.allocated*e;s>0&&(n=!0);let l=1,a=c.fromAny(s);if(s>1e15){let u=c.fromAny(s);$e.totalFPAccumulated=$e.totalFPAccumulated.add(u),r.level=r.level.add(u),t=!0}else{r.fp+=s;let u=c.fromAny(Math.floor(r.fp));u.isZero()||(r.level=r.level.add(u),r.fp-=Math.floor(r.fp),t=!0)}}if(t){let o=c.fromInt(0);for(let r in $e.channels)o=o.add($e.channels[r].level);$e.totalFPAccumulated=o,Lo(),VE()}else n&&Ll&&wn&&Ov()}function KE(e){e.innerHTML="";let t=document.createElement("div");t.className="channel-tab";let n=document.createElement("div");n.className="channel-header",n.innerHTML=`<div class="channel-explainer"> Channel your Focus into Channels to increase Channel Levels<br> Each Channel has a focus currency or stat it will boost<br> Gain +100% value to the Channel's focus for each level of any Channel<br> Purchase and allocate Focus into Channels so they may level up passively<br> The more Focus a Channel has allocated, the quicker it will gain FP and level up<br> Pay attention to total FP accumulated to see when new things will unlock<br> Channels will reset upon Surge or similar reset, but unlocked Channels are permanent </div><div class="channel-total-fp">Total FP Accumulated: <span id="ch-total-fp">0</span></div>`,t.appendChild(n);let o=document.createElement("div");o.className="channel-controls";let r="img/currencies/coin/coin.webp";o.innerHTML=`<button class="channel-upgrade-btn" id="btn-focus-upg"><span class="channel-upgrade-title">Increase Focus Amount</span><span class="channel-upgrade-cost"> Cost: <img src="${r}" class="channel-upgrade-cost-icon" alt="Coins"><span id="focus-cost">1e999 Coins</span></span><div class="focus-capacity-display">Capacity: <span id="focus-cap">1/1</span></div></button>`,t.appendChild(o);let i=document.createElement("div");i.className="channel-list";for(let[l,a]of Object.entries(kp)){let u=document.createElement("div");u.className="channel-bar-container",u.innerHTML=`<div class="channel-bar-header"><div class="channel-name"><img src="${a.icon}" class="channel-icon" alt="">\n                    ${a.name} </div><div class="channel-level" id="ch-lvl-${l}">Lvl 0</div></div><div class="channel-bar-wrapper"><div class="channel-bar-fill" id="ch-fill-${l}"></div><div class="channel-bar-text" id="ch-text-${l}">0 / 1 FP</div></div><div class="channel-allocation"><button class="btn-allocate" data-action="sub" data-id="${l}">-</button><div class="channel-rate">Focus: <span id="ch-alloc-${l}">0</span></div><button class="btn-allocate" data-action="add" data-id="${l}">+</button></div>`,i.appendChild(u)}t.appendChild(i),e.appendChild(t);let s=t.querySelector("#btn-focus-upg");s.addEventListener("click",Av),s.addEventListener("contextmenu",l=>{l.preventDefault(),YE()}),t.querySelectorAll(".btn-allocate").forEach(l=>{l.addEventListener("click",a=>{let u=a.target.dataset.id,d=a.target.dataset.action==="add"?1:-1;kv(u,d)})})}function Lo(){if(!Ll||!wn)return;let e=wn.querySelector("#ch-total-fp");e&&(e.textContent=W($e.totalFPAccumulated));let t=wn.querySelector("#btn-focus-upg"),n=Tv(),o=wn.querySelector("#focus-cost"),r=wn.querySelector("#focus-cap"),i=0;for(let s of Object.values($e.channels))i+=s.allocated;r&&(r.textContent=`${i}/${$e.focusCapacity}`),n.isInfinite()?(t&&(t.disabled=!0,t.classList.add("is-maxed")),o&&(o.textContent="MAXED")):(t&&(t.disabled=A.coins.value.cmp(n)<0,t.classList.remove("is-maxed")),o&&(o.textContent=`${W(n)} Coins`)),Ov();for(let s in kp){let l=$e.channels[s],a=wn.querySelector(`.btn-allocate[data-id="${s}"][data-action="add"]`);a&&(a.disabled=i>=$e.focusCapacity);let u=wn.querySelector(`.btn-allocate[data-id="${s}"][data-action="sub"]`);u&&(u.disabled=l.allocated<=0)}}function Ov(){if(!(!Ll||!wn))for(let e in kp){let t=$e.channels[e],n=wn.querySelector(`#ch-lvl-${e}`);n&&(n.textContent=`Lvl ${W(t.level)}`);let o=wn.querySelector(`#ch-alloc-${e}`);o&&(o.textContent=t.allocated);let r=wn.querySelector(`#ch-fill-${e}`),i=wn.querySelector(`#ch-text-${e}`),s=Math.min(100,Math.max(0,t.fp*100)),l=1/Po;t.allocated>=l&&(s=100),r&&(r.style.width=`${s}%`),i&&(i.textContent=`${t.fp.toFixed(2)} / 1 FP`)}}function Pv(){xv||(xv=!0,typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Lv(),Lo()}),Lv(),to(e=>zE(e)),On(e=>Rv(e)))}function Op(e){Ll||(Pv(),wn=e,KE(e),Ll=!0,Lo())}var Ap,_v,Cv,Mv,XE,xl,Su,kp,xv,Ll,wn,$e,Mp,Tp,_l=De(()=>{Et();Gt();St();Ar();bn();Rr();no();Ap="ccc:channel",_v=e=>`${Ap}:capacity:${e}`,Cv=e=>`${Ap}:totalFP:${e}`,Mv=e=>`${Ap}:data:${e}`,XE=999,xl=1e3,Su={COIN:"coin"},kp={[Su.COIN]:{id:Su.COIN,name:"Coin Channel",icon:"img/currencies/coin/coin_plus_base.webp",baseReq:1,description:"Boosts Global Coin Value by +100% per level"}},xv=!1,Ll=!1,wn=null,$e={focusCapacity:1,totalFPAccumulated:c.fromInt(0),channels:{[Su.COIN]:{level:c.fromInt(0),fp:0,allocated:0}}};Mp=null;Tp=null});function Yv(){try{return localStorage.getItem(Gr(Xp))==="1"}catch{return!1}}function Yp(){try{return localStorage.getItem(Gr(Wv))==="1"}catch{return!1}}function xu(e){let t=b();if(t==null)return;let n=`${Wv}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),jE()}catch{}}function Lu(){return Yp()?"Jeff":"Merchant"}function jE(){let e=Lu();Ke&&Ke.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function Cl(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&go(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(y=>console.error(y)),n&&h()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,Oo(160)))},f=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},d=()=>{r&&l()},m=g=>{r=!0,Oo(160)},v=g=>{r&&l()},p=()=>{r&&l()},h=()=>{e.removeEventListener("click",a),zv?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):tx&&(e.removeEventListener("touchstart",m),window.removeEventListener("touchend",v),window.removeEventListener("touchcancel",p))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function Iu(e){return QE[e]??0}function Fv(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function nx(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function Ys(e,t){let n=Ai.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;Xs.set(e,r),n.unlocked=r;let i=cn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&cn.buttons[e]?.classList.contains("is-active")&&Tu("dialogue")}function Pp(){let e=!1;try{e=!!zs?.()}catch{}Ys("reset",e)}function Bp(){let e=!1;try{e=!!Xt?.()}catch{}Ys("workshop",e)}function qv(){let e=!1;try{typeof Bo=="function"&&(e=Bo())}catch{}Ys("warp",e)}function ox(){let e=b();if(e==null)return!1;try{return typeof In=="function"&&In()?!0:localStorage.getItem(Kv(e))==="1"}catch{return!1}}function qp(){Ys("lab",ox())}function Fp(){Ys("channel",Gs())}function rx(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function ix(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof vn=="function"&&vn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof et=="function"?et():null;t&&typeof t=="object"&&(e.xpLevel=rx(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Xr=="function"&&Xr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Xt=="function"&&Xt()}catch{e.hasInfuseReset=!1}return e}function sx(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?Dp:$p,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?Dp:$p),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Wp:""),i.icon=o?.icon??(r==="mysterious"?qr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?lr:JE),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function ax(){if(Uv)return;Uv=!0;let e=lx;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${ex}:${t}`;kt(n,{onChange:e})}}function lx(){cr()}function cx(e,t){let n=zp(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,jv(n),ux(t.reward),!0)}function ux(e){if(e){if(e.type==="coins"){try{A.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{A.books.addWithMultiplier?.(e.amount)??A.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{A.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{A.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function fx(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function zp(){try{return JSON.parse(localStorage.getItem(Gr(Ml))||"{}")}catch{return{}}}function jv(e){let t=Gr(Ml);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{ut(t,n)}catch{}}catch{}}function dx(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function px(){let e=Gp;if(Gp=null,typeof e=="function")try{e()}catch{}}function mx(e,t={}){t?.rawChanged&&cr()}function Up(e){if(e===Gv)return;if(px(),Gv=e??null,e==null){cr();return}let t=`${Ml}:${e}`;Gp=kt(t,{parse:dx,onChange:mx});try{ut(t)}catch{}cr()}function hx(){if(Dv){Up(b());return}Dv=!0,Up(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Up(b())})}function Vr(){Promise.resolve().then(()=>(An(),Sc)).then(({loadAudio:e})=>{e(Zv)})}function gx(){if(Hs)return;Hs=mt(Zv,{volume:Qe?.15:.3,loop:!0})}function fr(){Hs&&(Hs.stop&&Hs.stop(),Hs=null)}function yx(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let I=0;I<t.length;I++){let E=t[I];E==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=E):E===">"&&l?(s+=E,i.push({type:"tag",content:s}),s="",l=!1):s+=E}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,m="";ur=!0,gx();let v=I=>{d&&(I.preventDefault(),f=!0)},p=I=>{d&&(I.key==="Enter"||I.key===" ")&&(f=!0)},h=o.length?o:[e];requestAnimationFrame(()=>{d=!0,h.forEach(I=>I.addEventListener("click",v,{once:!0})),document.addEventListener("keydown",p,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{h.forEach(I=>I.removeEventListener("click",v)),document.removeEventListener("keydown",p),e.classList.remove("is-typing"),fr(),ur=!1},y=()=>{if(f){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let I=i[a];I.type==="tag"?(m+=I.content,e.innerHTML=m,a++,y()):(m+=I.content[u],e.innerHTML=m,u++,u>=I.content.length&&(a++,u=0),setTimeout(y,n))};y()})}function vx(e={}){if(!Ke)return;Vr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||lr}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||qr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,Ke.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||lr,r.textContent=e.message||Wp,requestAnimationFrame(()=>t.classList.add("is-visible")),Ke.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),Ke.classList.remove("firstchat-active"),fr(),ur=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),Dn(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&Dn(160),l()};Cl(i,()=>{u()},{once:!0}),i.focus?.()}function bx(e,t){Vr();let n=t.scriptId;String(e)==="6"&&typeof Es=="function"&&!Es()&&(n=7),oi(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Lu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Vs}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,Ke.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),Ke.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{oi(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),Ke.classList.remove("firstchat-active"),fr(),ur=!1,o.remove()},d=()=>{u||(u=!0,f(),cr())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&Dn(160),d())});let m=new Hr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,y)=>{t.scriptId===4&&g==="c4b"&&xu(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){cr(),f();return}cx(e,t),cr(),f()}}}),p=!!zp()[e]?.claimed,h=structuredClone(Pd[n]);p&&h.nodes.m2b&&h.nodes.c2a&&t.scriptId===1&&(h.nodes.m2b.say="I've already given you Coins, goodbye.",h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),p&&t.scriptId===2&&h.nodes.m3a&&(h.nodes.m3a.say="I've already given you Books, goodbye.",h.nodes.c2a&&(h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===3&&h.nodes.m5a&&(h.nodes.m5a.say="I've already given you Gold, goodbye.",h.nodes.c5a&&(h.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===4&&h.nodes.m7a&&(h.nodes.m7a.say="I've already given you Magic, goodbye.",h.nodes.c7a&&(h.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m.load(h),m.start()}function Sx(){if(document.getElementById(Xv))return;let e=document.createElement("style");e.id=Xv,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function Ix(){let e=Ke?.querySelector(".merchant-content");if(!e||e.__customScroll||!ht)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),ht.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){Sx();let C=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;ht.style.timelineScope=C,e.style.scrollTimelineName=C,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=C,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let T=(e.scrollTop||0)>0;f!==T&&(f=T,ht?.classList.toggle("has-scroll-shadow",T))},m=()=>{let T=Ke.querySelector(".merchant-grabber"),C=Ke.querySelector(".merchant-header"),z=Ke.querySelector(".merchant-actions"),Q=(T?.offsetHeight||0)+(C?.offsetHeight||0)|0,ae=(z?.offsetHeight||0)|0;t.style.top=Q+"px",t.style.bottom=ae+"px"},v={},p=()=>{let{scrollHeight:T,clientHeight:C,scrollTop:z}=e,Q=t.clientHeight||e.clientHeight||1;if(v.scrollHeight===T&&v.clientHeight===C&&v.barH===Q&&(u||v.scrollTop===z))return;v={scrollHeight:T,clientHeight:C,scrollTop:z,barH:Q};let ae=C/Math.max(1,T),he=Math.max(28,Math.round(Q*ae)),Se=Math.max(1,T-C),Oe=Math.max(0,Q-he);if(n.style.height=he+"px",u)n.style.setProperty("--thumb-y",`${Oe}px`),n.style.setProperty("--thumb-x","0px");else{let Ae=Math.round(z/Se*Oe);n.style.transform=`translateY(${Ae}px)`}t.style.display=T<=C+1?"none":""},h=()=>{m(),p(),d()},g=()=>{o&&(ht.classList.add("is-scrolling"),l&&clearTimeout(l))},y=T=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{ht.classList.remove("is-scrolling")},T))},I=()=>{p(),d(),o&&g(),s||y(r)},E=()=>y(r);e.addEventListener("scroll",I,{passive:!0}),s&&e.addEventListener("scrollend",E,{passive:!0});let M=new ResizeObserver(h);M.observe(e),window.addEventListener("resize",h),requestAnimationFrame(h);let N=!1,G=0,P=0,$=T=>{N=!0,G=T.clientY,P=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(T.pointerId)}catch{}T.preventDefault()},L=T=>{if(!N)return;let C=t.clientHeight||1,z=n.clientHeight||1,Q=Math.max(1,C-z),ae=Math.max(1,e.scrollHeight-e.clientHeight),Se=(T.clientY-G)/Q*ae;e.scrollTop=P+Se},F=T=>{if(N){N=!1,n.classList.remove("dragging"),y(i);try{n.releasePointerCapture(T.pointerId)}catch{}}};n.addEventListener("pointerdown",$),window.addEventListener("pointermove",L,{passive:!0}),window.addEventListener("pointerup",F),window.addEventListener("pointercancel",F),t.addEventListener("pointerdown",T=>{if(T.target===n)return;let C=t.getBoundingClientRect(),z=T.clientY-C.top,Q=t.clientHeight||1,ae=n.clientHeight||1,he=Math.max(0,Q-ae),Se=Math.max(0,Math.min(z-ae/2,he)),Oe=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=Se/Math.max(1,he)*Oe,g(),y(r)}),e.__customScroll={bar:t,thumb:n,ro:M,updateAll:h},h()}function Cu(){if(Ke)return;Ke=document.createElement("div"),Ke.className="merchant-overlay",Ke.id="merchant-overlay",Ke.setAttribute("inert",""),ht=document.createElement("div"),ht.className="merchant-sheet",ht.setAttribute("role","dialog"),ht.setAttribute("aria-modal","false"),ht.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab";let f=document.createElement("section");f.className="merchant-panel",f.id="merchant-panel-channel",Pp(),Bp(),qv(),qp(),Fp(),Ai.forEach(p=>{p.key==="dialogue"&&Xs.set("dialogue",!0);let h=Xs.get(p.key),g=h??!!p.unlocked,y=document.createElement("button");y.type="button",y.className="merchant-tab",y.dataset.tab=p.key;let I=p.lockedLabel||"???";y.textContent=g?p.label:I,g?y.title=p.label||"Tab":(y.classList.add("is-locked"),y.disabled=!0,y.title="???"),p.unlocked=g,Xs.set(p.key,g),Cl(y,E=>{if(y.disabled){E?.preventDefault?.();return}Tu(p.key)}),o.appendChild(y),cn.buttons[p.key]=y}),cn.panels.dialogue=i,cn.panels.reset=s,cn.panels.workshop=l,cn.panels.warp=a,cn.panels.lab=u,cn.panels.channel=f,cn.tablist=o,r.append(i,s,l,a,u,f),n.append(o,r),Pp(),Bp();try{Jo()}catch{}try{Kp(s)}catch{}try{Ge()}catch{}try{wp(l)}catch{}try{Ev(a)}catch{}try{Kd(u)}catch{}try{Op(f)}catch{}if(!$v&&typeof window<"u"){let p=h=>{let{key:g,slot:y}=h?.detail??{};y!=null&&y!==b()||((g==="forge"||!g)&&Pp(),(g==="infuse"||!g)&&Bp(),(g==="surge_completed"||!g)&&qv(),(g==="lab"||g==="tsunami"||!g)&&qp(),(g==="channel"||!g)&&Fp())};window.addEventListener("unlock:change",p,{passive:!0}),window.addEventListener("saveSlot:change",p,{passive:!0}),window.addEventListener("surge:level:change",()=>Fp(),{passive:!0}),$v=!0}let d=document.createElement("div");d.className="merchant-actions";let m=document.createElement("button");m.type="button",m.className="merchant-close",m.textContent="Close",wu=m,d.appendChild(m);let v=document.createElement("div");v.className="merchant-firstchat merchant-firstchat--initial",v.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Vs}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,ht.append(e,t,n,d,v),Ke.appendChild(ht),document.body.appendChild(Ke),wx(),Ix(),Hv||(Hv=!0,Cl(m,()=>{Mu()},{once:!1}),document.addEventListener("keydown",_x),e.addEventListener("pointerdown",Cx),e.addEventListener("touchstart",h=>h.preventDefault(),{passive:!1}),Ke.addEventListener("pointerdown",Vr,{once:!0}))}function wx(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,ax(),cr()}function Ex(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?bx(n.id,n.meta):n.isMysterious&&vx(n.lockInfo)}}function cr(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=ix(),o=zp(),r=!1,i=new Set;Object.entries(_u).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=Iu(u),d=sx(l,n),m=d.status,v=Iu(m);if(v>f)a.status=m,m==="mysterious"?a.lockSnapshot=Fv(d):m==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(v<f){if(u==="unlocked")d=nx(l),m="unlocked",v=Iu(m);else if(u==="mysterious"){let T=a.lockSnapshot||Fv(d)||{};d={status:"mysterious",unlocked:!1,title:T.title??d.title??"???",blurb:T.blurb??d.blurb??Dp,tooltip:T.tooltip??d.tooltip??"Hidden Dialogue",message:T.message??d.message??Wp,icon:T.icon??d.icon??qr,headerTitle:T.headerTitle??d.headerTitle??lr,ariaLabel:T.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},m="mysterious",v=Iu(m)}}let p=m==="unlocked",h=m==="mysterious",g=m==="locked",y=!!a.claimed,I=p&&!!(l.once&&y),E=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!E){E=document.createElement("button"),E.type="button",E.className="dlg-card",E.dataset.dlgId=String(s);let T=document.createElement("div");T.className="dlg-title";let C=document.createElement("div");C.className="dlg-blurb";let z=document.createElement("div");z.className="dlg-reward",E.append(T,C,z),t.appendChild(E),Cl(E,Ex)}E._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:p,isMysterious:h},E.dataset.dlgStatus=m,E.disabled!==!!g&&(E.disabled=!!g),E.classList.toggle("is-locked",g),E.classList.toggle("is-mysterious",h),E.classList.toggle("is-complete",!!I),E.classList.toggle("has-again",!!I),g?(E.getAttribute("aria-disabled")!=="true"&&E.setAttribute("aria-disabled","true"),E.getAttribute("tabindex")!=="-1"&&E.setAttribute("tabindex","-1")):(E.hasAttribute("aria-disabled")&&E.removeAttribute("aria-disabled"),E.hasAttribute("tabindex")&&E.removeAttribute("tabindex"));let M=E.querySelector(".dlg-title"),N=p?l.title:d.title??"???";M.textContent!==N&&(M.textContent=N);let G=E.querySelector(".dlg-blurb"),P=p?l.blurb:d.blurb??"";G.textContent!==P&&(G.textContent=P);let $=E.querySelector(".dlg-reward");if(p&&l.reward){let T=ZE[l.reward.type];if(T){$.classList.contains("has-reward")||($.classList.add("has-reward"),$.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),$.style.getPropertyValue("--reward-icon")!==`url('${T}')`&&$.style.setProperty("--reward-icon",`url('${T}')`);let C=$.querySelector(".amt"),z=String(l.reward.amount);C&&C.textContent!==z&&(C.textContent=z);let Q=$.querySelector(".currency-name");if(Q){let he=String(l.reward.type||""),Se=he.charAt(0).toUpperCase()+he.slice(1);Q.textContent!==Se&&(Q.textContent=Se)}let ae=`Reward: ${l.reward.amount} ${l.reward.type}`;$.getAttribute("aria-label")!==ae&&$.setAttribute("aria-label",ae)}else{$.classList.remove("has-reward");let C=fx(l.reward);$.textContent!==C&&($.textContent=C),$.style.display!==""&&($.style.display=""),$.removeAttribute("aria-label")}$.style.display==="none"&&($.style.display="")}else $.textContent!==""&&($.textContent=""),$.style.display!=="none"&&($.style.display="none");let L=p?`${l.title}${I?" (completed)":""}`:d.ariaLabel||(h?"Hidden merchant dialogue":"Locked merchant dialogue");if(E.getAttribute("aria-label")!==L&&E.setAttribute("aria-label",L),d.tooltip)E.title!==d.tooltip&&(E.title=d.tooltip);else if(p){let T="Left-click: Start Dialogue";E.title!==T&&(E.title=T)}else E.hasAttribute("title")&&E.removeAttribute("title");let F=E.querySelector(".dlg-again");I?F||(F=document.createElement("div"),F.className="dlg-again",F.textContent="Ask Again?",E.appendChild(F)):F&&F.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&jv(o)}function xx(){let e=Ke.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");oi(!0);let i=new Hr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{oi(!1);try{localStorage.setItem(Gr(Xp),"1")}catch{}try{window.dispatchEvent(new Event(Vp))}catch{}e.classList.remove("is-visible"),Ke.classList.remove("firstchat-active")}});i.load(Pd[0]),i.start()}function Lx(){if(!Ke)return;let e=Ke.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),Ke.classList.remove("firstchat-active")}function Jv(){if(Cu(),ki)return;let e=document.activeElement;e instanceof HTMLElement&&!Ke.contains(e)?Eu=e:Eu=null,ki=!0;let t=b(),n=!1;if(t!=null){let i=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(i)==="1"){try{localStorage.removeItem(i)}catch{}try{localStorage.setItem(Kv(t),"1")}catch{}qp();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Gr(Xp))==="1"}catch{o=!1}o||Ke.classList.add("firstchat-instant");let r="dialogue";try{r=localStorage.getItem(Gr(Vv))||"dialogue"}catch{}n&&(r="dialogue"),Tu(r),fr(),o||(Ke.querySelector(".merchant-firstchat")?.classList.add("is-visible"),Ke.classList.add("firstchat-active"),xx()),ht.style.transition="none",ht.style.transform="",Ke.removeAttribute("inert"),ht.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ke.classList.contains("firstchat-instant")||(ht.style.transition=""),Ke.classList.add("is-open"),Dn(140),wu&&typeof wu.focus=="function")try{wu.focus({preventScroll:!0})}catch{}})})}function Mu(){if(!ki)return;if(oi(!1),Qe){try{Oo(100)}catch{}try{Dn(80)}catch{}}ki=!1,ht.style.transition="",ht.style.transform="",Ke.classList.remove("is-open"),Ke.classList.remove("firstchat-instant"),Lx();let e=document.activeElement;if(e&&Ke.contains(e)){let t=Eu;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}Ke.setAttribute("inert",""),Eu=null,fr(),ur=!1}function _x(e){if(ki&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<Ai.length;i++)Xs.get(Ai[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<Ai.length&&(e.preventDefault(),i0(),Tu(Ai[r].key))}}function Cx(e){if(!ki)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;Un={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},ht.style.transition="none",window.addEventListener("pointermove",Qv,{passive:!0}),window.addEventListener("pointerup",e0),window.addEventListener("pointercancel",t0)}function Qv(e){if(!Un||Un.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-Un.startY);Un.lastY=t,Un.moved=n,ht.style.transform=`translateY(${n}px)`}function e0(){if(!Un||Un.canceled){Hp();return}let e=Math.max(1,performance.now()-Un.startT),t=Un.moved;t/e>.55&&t>40||t>140?(Oo(160),ht.style.transition="transform 140ms ease-out",ht.style.transform="translateY(100%)",setTimeout(()=>{Mu()},150)):(ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)"),Hp()}function t0(){Un&&(Un.canceled=!0,ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)",Hp())}function Hp(){window.removeEventListener("pointermove",Qv),window.removeEventListener("pointerup",e0),window.removeEventListener("pointercancel",t0),Un=null}function Tu(e){let t=Ai.find(o=>o.key===e),n=Xs.get(e);(!t||!n)&&(e="dialogue"),ht&&(e==="lab"?ht.classList.add("is-lab-active"):ht.classList.remove("is-lab-active"));for(let o in cn.buttons)cn.buttons[o].classList.toggle("is-active",o===e);for(let o in cn.panels)cn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{cr()}catch{}if(e==="warp")try{ar()}catch{}if(e==="lab"){typeof Es=="function"&&!Es()&&Mx();try{jd()}catch{}}if(e==="channel")try{Lo()}catch{}try{localStorage.setItem(Gr(Vv),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=Ke?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function n0(){if(!ki)return!1;let e=cn.buttons.lab;return e&&e.classList.contains("is-active")}function Tl(e=[]){e.forEach(t=>Ys(t,!0))}function o0(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Vs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Vr();let u=v=>{v.key==="Escape"&&(v.stopImmediatePropagation(),v.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Vs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let v=r.querySelector("#tsunami-dlg-line-2"),p=r.querySelector("#tsunami-dlg-choices-2"),h=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),y={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},I=new Hr({textEl:v,choicesEl:p,skipTargets:[v,h,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),fr(),ur=!1,r.remove(),t&&t()},5e3)}});I.load(y),I.start()},m=new Hr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",fr(),ur=!1,n&&n.hideCursor&&n.hideCursor(),f()}});m.load(o),m.start()}function Mx(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Lu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Vs}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Vr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Hr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{fr(),ur=!1,e.remove()}});s.load(i),s.start()}function r0(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Lu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Vs}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Vr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Hr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{fr(),ur=!1,t.remove(),e&&e()}});l.load(s),l.start()}var Vs,Xp,Vv,Ml,Vp,Gr,Wv,Ai,Xs,ZE,qr,lr,JE,Dp,$p,Wp,QE,ex,zv,tx,Uv,Dv,$v,Kv,Gv,Gp,_u,Ke,ht,wu,ki,Un,Eu,Hv,cn,Zv,Hs,ur,Hr,Xv,Ws=De(()=>{St();Et();hy();bn();vo();Cs();Cp();Si();_l();Sn();Rr();hs();Io();An();Vs="img/misc/merchant.webp",Xp="ccc:merchantMet",Vv="ccc:merchantTab",Ml="ccc:merchant:dlgState",Vp="ccc:merchant:met",Gr=e=>`${e}:${b()}`;Wv="ccc:unlock:jeff";Ai=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"},{key:"channel",label:"Channel",unlocked:!1,lockedLabel:"???"}],Xs=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1],["channel",!1]]),ZE={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},qr="img/misc/mysterious.webp",lr="Hidden Dialogue",JE="Locked Dialogue",Dp="Hidden Dialogue",$p="Locked",Wp="Locked Dialogue",QE={locked:0,mysterious:1,unlocked:2},ex="ccc:reset:forge:completed",zv=typeof window<"u"&&"PointerEvent"in window,tx=!zv&&typeof window<"u"&&"ontouchstart"in window;Uv=!1,Dv=!1,$v=!1;Kv=e=>`ccc:unlock:lab:${e}`;Rp(e=>{let t=typeof ln=="function"?ln():0n;return t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY?!0:typeof t=="bigint"?t>=BigInt(e):typeof t=="number"?t>=e:!1});Gv=null,Gp=null;_u={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:qr,headerTitle:lr,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:$p,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:qr,headerTitle:lr,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof Bo=="function"&&Bo()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:qr,headerTitle:lr,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof In=="function"&&In())return!0;let t=typeof ln=="function"?ln():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof Bo=="function"&&Bo()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:qr,headerTitle:lr,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:qr,headerTitle:lr,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};hx();Ke=null,ht=null,wu=null,ki=!1,Un=null,Eu=null,Hv=!1,cn={buttons:{},panels:{},tablist:null},Zv="sounds/merchant_typing.ogg",Hs=null,ur=!1;Hr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await yx(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=Cl(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};Xv="ccc-scroll-timeline-styles"});var Vt,jp,Zp,s0,Jp=De(()=>{Gt();Vt="dna",jp="img/misc/mysterious.webp",Zp="Hidden Upgrade",s0=[{area:Vt,id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Coin value bonus: ${Te(t)}x`},{area:Vt,id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`XP value bonus: ${Te(t)}x`},{area:Vt,id:3,title:"DNA Gold Value",desc:"Multiplies Gold value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/gold_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"gold_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Gold value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:jp,titleOverride:Zp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Vt,id:4,title:"DNA Magic Value",desc:"Multiplies Magic value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/magic_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"magic_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Magic value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:jp,titleOverride:Zp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Vt,id:5,title:"DNA Wave Value",desc:"Multiplies Wave value by 1.1x per level",lvlCap:1e3,baseCost:1e39,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/wave_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"wave_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Wave value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=19||t===1/0)&&(n=!0):typeof t=="bigint"?t>=19n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=19)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 19 to reveal this upgrade";return{locked:!0,iconOverride:jp,titleOverride:Zp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}]});function Ep(){return Al.size>0}function d0(e){if(!e||!e.costType)return!1;let t=Rx[e.costType];return!t||Nt(Je,t)<=0?!1:Ii(e.area,e.id)!=="0"}function em(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function ku(e,t){return t==="standard"&&em(e)===Nx}function Qp(e){let t=Tt(e),n={};for(let o of t){let r=Pn(e,o.id),i=Nt(e,o.id),s=Fo(e,o.id),l=s.iconOverride??Bu(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Zs(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:Pu(o.baseIconOverride||s.baseIconOverride),hmReady:d}}return n}function p0(e){return c0[e]||c0.standard}function Dn(e=140){if(!Qe)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Ru(e){return String(e??"").replace(/<[^>]*>/g,"")}function Au(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function Ht(){mt(Px,{volume:Qe?m0:h0})}function g0(){let e=Qe?m0*2:h0*2;mt(Bx,{volume:e})}function Fx(e){return`<img alt="" src="${l0[e]||l0.coins}" class="currency-ico">`}function Dx(){if(document.getElementById(u0))return;let e=document.createElement("style");e.id=u0,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function Us(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,m="onscrollend"in window,p=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(p){Dx();let K=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=K,s.style.scrollTimelineName=K,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=K,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let h={scrollSize:0,clientSize:0,barSize:0,thumbSize:0,maxScroll:1,range:0,visibleRatio:1},g=null,y=!1,I=null,E=()=>{if(!s.isConnected||!t.isConnected)return;let U=s.getBoundingClientRect(),K=t.getBoundingClientRect();if(i){let q=Math.max(0,U.top-K.top),X=Math.max(0,K.bottom-U.bottom);l.style.top=q+"px",l.style.bottom=X+"px",l.style.left="",l.style.right=""}else{let q=Math.max(0,U.left-K.left),X=Math.max(0,K.right-U.right);l.style.left=q+"px",l.style.right=X+"px",l.style.top="",l.style.bottom="",l.style.height=""}},M=()=>{let U=i?s.scrollHeight:s.scrollWidth,K=i?s.clientHeight:s.clientWidth,q=i?l.clientHeight||K:l.clientWidth||K,X=K/Math.max(1,U),J=Math.max(28,Math.round(q*X)),le=Math.max(1,U-K),fe=Math.max(0,q-J);h={scrollSize:U,clientSize:K,barSize:q,thumbSize:J,maxScroll:le,range:fe,visibleRatio:X},i?(a.style.height=J+"px",a.style.width="100%"):(a.style.width=J+"px",a.style.height="100%"),p&&(i?(a.style.setProperty("--thumb-y",`${fe}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${fe}px`),a.style.setProperty("--thumb-y","0px")));let _=U>K+1;l.style.display=_?"":"none",t?.classList.toggle("has-active-scrollbar",_),N()},N=()=>{y=!1;let U=i?s.scrollTop:s.scrollLeft,K=(U||0)>0;if(g!==K&&(g=K,t?.classList.toggle("has-scroll-shadow",K)),!p){let{maxScroll:q,range:X}=h,J=Math.round(U/q*X);i?a.style.transform=`translateY(${J}px)`:a.style.transform=`translateX(${J}px)`}u&&L()},G=()=>{E(),M()};s.__customScroll&&(s.__customScroll.update=G);let P,$=()=>{clearTimeout(P),P=setTimeout(G,100)};typeof MutationObserver<"u"&&new MutationObserver(()=>$()).observe(s,{childList:!0,subtree:!0,characterData:!0});let L=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},F=U=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},U))},T=()=>{Al.has(s)||Al.add(s),clearTimeout(I),I=setTimeout(()=>{Al.has(s)&&(Al.delete(s),window.dispatchEvent(new CustomEvent("menu:scrollStop")))},150),y||(y=!0,window.requestAnimationFrame(N)),m||F(f)},C=()=>F(f);s.addEventListener("scroll",T,{passive:!0}),m&&s.addEventListener("scrollend",C,{passive:!0}),new ResizeObserver(()=>{G()}).observe(s),window.addEventListener("resize",G),requestAnimationFrame(G);let Q=!1,ae=0,he=0,Se=U=>{Q=!0,ae=i?U.clientY:U.clientX,he=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),L();try{a.setPointerCapture(U.pointerId)}catch{}U.preventDefault()},Oe=U=>{if(!Q)return;let{range:K,maxScroll:q}=h;if(K<=0)return;let J=(i?U.clientY:U.clientX)-ae,le=he+J/K*q;i?s.scrollTop=le:s.scrollLeft=le},Ae=U=>{if(Q){Q=!1,a.classList.remove("dragging"),F(d);try{a.releasePointerCapture(U.pointerId)}catch{}}};a.addEventListener("pointerdown",Se),window.addEventListener("pointermove",Oe,{passive:!0}),window.addEventListener("pointerup",Ae),window.addEventListener("pointercancel",Ae),l.addEventListener("pointerdown",U=>{if(U.target===a)return;let K=l.getBoundingClientRect(),q=i?U.clientY-K.top:U.clientX-K.left,{thumbSize:X,range:J,maxScroll:le}=h,_=Math.max(0,Math.min(q-X/2,J))/Math.max(1,J)*le;i?s.scrollTop=_:s.scrollLeft=_,L(),F(f)}),G()}function f0(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function $x(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=A[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",m=Number.isFinite(i)&&r>=i;return d&&!m||!Number.isFinite(i)?c.fromAny("Infinity"):f0(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),m=c.fromAny(e.costAtLevel(r+1)),v=Math.min(Number.isFinite(i)?i:r+32,r+32),p=c.fromAny(e.costAtLevel(v));if(d.cmp(m)===0&&d.cmp(p)===0){let g=f0(e,o,r),y=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,I=0,E=Math.max(0,y);for(;I<E;){let M=Math.floor((I+E+1)/2),N=c.fromInt(M);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(N):c.fromAny(d??0).mulBigNumInteger(N)).cmp(a)<=0?I=M:E=M-1}return c.fromInt(I)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=Ni(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function Bs(e="standard"){(Ol[e]||Ol.standard).open()}function y0(e=!1){Object.values(Ol).forEach(t=>t.close(e))}function i0(){if(Object.entries(Ol).forEach(([e,t])=>{e!=="standard"&&t.close()}),Pl&&v0!=="standard"){tm();let e=document.querySelector(".hm-milestones-overlay");e&&e.remove()}}function dr(e=!1){Object.values(Ol).forEach(t=>t.update(e))}function qx(){if(un)return;un=document.createElement("div"),un.className="upg-overlay",dt=document.createElement("div"),dt.className="upg-sheet",dt.setAttribute("role","dialog"),dt.setAttribute("aria-modal","false"),dt.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",dt.append(e,t,n,o,r),un.appendChild(dt),document.body.appendChild(un),un.addEventListener("pointerdown",u=>{Qe&&u.pointerType!=="mouse"&&u.target===un&&(u.preventDefault(),u.stopPropagation())},!0),un.addEventListener("click",u=>{Qe&&u.target===un&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Pl)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},dt.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,dt.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(dt.style.transition="transform 160ms ease",dt.style.transform=f?"translateY(100%)":"translateY(0)",f){if(Qe&&(!u||u.pointerType!=="mouse"))try{Dn(120)}catch{}setTimeout(tm,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function tm(){if(Qe)try{Dn(160)}catch{}if(typeof Nu=="function"){let e=Nu;Nu=null;try{e()}catch{}}Pl=!1,!(!un||!dt)&&(dt.style.transition="",dt.style.transform="",un.classList.remove("is-open"),un.style.pointerEvents="none")}function Gx(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function Hx(e,t="standard"){qx(),Pl=!0,v0=t;let n=!0,o=p0(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Pl=!1;return}let l=e.upgType==="HM",a=e.tie===_e.ENDLESS_XP;function u(p,h,g="div"){let y=h.split(" ").filter(M=>M.length>0),I=null,E=[];for(let M=0;M<p.children.length;M++){let N=p.children[M];g&&N.tagName.toLowerCase()!==g.toLowerCase()||y.every(G=>N.classList.contains(G))&&(I?E.push(N):I=N)}return E.forEach(M=>M.remove()),I||(I=document.createElement(g),I.className=h,p.appendChild(I)),I}let f=p=>{let h=document.createElement("div");return h.className="upg-line",h.innerHTML=p,h},d=!0,m=()=>{let p=o.getUiModel(e.id);if(!p)return;let h=p.lockState||o.getLockState(e.id),g=!!h?.locked,y=g&&(h?.hidden||h?.hideEffect||h?.hideCost),I=!!p.unlockUpgrade&&!y;dt.classList.toggle("is-locked-hidden",y);let E=dt.querySelector(".upg-header"),M=u(E,"upg-title");M.textContent!==(p.displayTitle||p.upg.title)&&(M.textContent=p.displayTitle||p.upg.title);let N=!!p.hmReadyToEvolve,G=N?!1:p.lvlBn?.isInfinite?.()?!0:Number.isFinite(p.upg.lvlCap)?p.lvl>=p.upg.lvlCap:!1,P=u(E,"upg-level"),$=p.lvlCapFmtHtml??p.upg.lvlCapFmtHtml??W(p.lvlCapBn),L=p.lvlCapFmtText??p.upg.lvlCapFmtText??Ru($),F=N?`Level ${p.lvlFmtHtml} / ${$} (EVOLVE READY)`:G?`Level ${p.lvlFmtHtml} / ${$} (MAXED)`:`Level ${p.lvlFmtHtml} / ${$}`,T=Ru(F);P.innerHTML!==F&&(P.innerHTML=F),P.getAttribute("aria-label")!==T&&P.setAttribute("aria-label",T),P.hidden=y,y||P.removeAttribute("aria-hidden"),dt.classList.toggle("is-maxed",G),dt.classList.toggle("hm-evolve-ready",N),dt.classList.toggle("is-unlock-upgrade",I),dt.classList.toggle("is-hm-upgrade",l&&!y),dt.classList.toggle("is-endless-xp",a),dt.classList.toggle("is-magnet-upgrade",e.tie===_e.MAGNET),dt.classList.toggle("is-no-effect",!p.effect);let C=E.querySelector(".auto-toggle-wrapper"),z=t==="automation"?vs[e.id]:null,Q=t==="automation"&&e.id===yo,ae=!!z,he=t==="standard"||t==="dna"?Ox[e.costType]:null,Se=0;he?Se=Nt(Je,he):(ae||Q)&&(Se=Nt(Je,e.id));let Ae=Se>0&&(ae||he||Q)&&!y;C||(C=document.createElement("div"),C.className="auto-toggle-wrapper hm-view-milestones-row",E.appendChild(C));let U=C.querySelector("button");if(U||(U=document.createElement("button"),U.type="button",U.style.padding="10px 14px",U.style.fontSize="16px",U.style.width="auto",U.style.minWidth="180px",U.addEventListener("click",ne=>{typeof U._onClick=="function"&&U._onClick(ne)}),C.appendChild(U)),Ae){U.style.visibility="",U.style.pointerEvents="auto";let ne=b(),ve=ne!=null?`:${ne}`:"",Ue=!0;if(ae){let ke=`ccc:autobuy:master:${z}${ve}`,Fe=[...Tt(Ie.STARTER_COVE),...Tt(Vt)],ce=!1;for(let te of Fe)if(te.costType===z){let xe=`ccc:autobuy:${te.area}:${te.id}${ve}`;if(Ii(te.area,te.id)!=="0"){ce=!0;break}}Ue=ce}else Ue=Ii(e.area,e.id)!=="0";Ue?(U.className="shop-delve",U.textContent="Automation: ON",U.style.backgroundColor=""):(U.className="shop-close",U.textContent="Automation: OFF",U.style.backgroundColor=""),U._onClick=ke=>{ke.preventDefault(),ke.stopPropagation(),Qe&&Dn(50);let ce=!Ue?"1":"0";ae?(localStorage.setItem(`ccc:autobuy:master:${z}${ve}`,ce),[...Tt(Ie.STARTER_COVE),...Tt(Vt)].forEach(xe=>{xe.costType===z&&Or(xe.area,xe.id,ce)})):Or(e.area,e.id,ce),m()}}else U.style.visibility="hidden",U.style.pointerEvents="none",U.className="shop-delve",U.textContent="Automation: ON",U._onClick=null;let K=dt.querySelector(".upg-content");d&&(K.scrollTop=0,d=!1);let q=u(K,"upg-desc centered");q.classList.toggle("lock-desc",y);let X=(p.displayDesc||p.upg.desc||"").trim();N?(q.classList.add("hm-evolve-note"),q.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&(q.textContent="Evolve this upgrade to multiply its effect by 1000x")):X?(q.classList.remove("hm-evolve-note"),q.textContent!==X&&(q.textContent=X),q.hidden=!1):q.hidden=!0;let J=u(K,"upg-info"),le=null,fe=ne=>{le?le.nextElementSibling!==ne&&J.insertBefore(ne,le.nextSibling):J.firstElementChild!==ne&&J.prepend(ne),le=ne};if(g&&h?.reason&&!y){let ne=(p.displayDesc||"").trim(),ve=String(h.reason??"").trim();if(ne!==ve){let Ue=J.querySelector(".lock-wrapper");if(!Ue){Ue=document.createElement("div"),Ue.className="lock-wrapper";let ce=document.createElement("div");ce.className="upg-line lock-note",Ue.append(ce)}let ke=Array.from(Ue.children);for(let ce of ke)ce.tagName==="DIV"&&!ce.className&&ce.style.height==="12px"&&ce.remove();let Fe=Ue.querySelector(".lock-note");Fe.textContent!==h.reason&&(Fe.textContent=h.reason),fe(Ue)}else{let Ue=J.querySelector(".lock-wrapper");Ue&&Ue.remove()}}else{let ne=J.querySelector(".lock-wrapper");ne&&ne.remove()}if(p.effect&&!(g&&h?.hideEffect)){let ne=J.querySelector(".effect-wrapper");if(!ne){ne=document.createElement("div"),ne.className="effect-wrapper";let Fe=document.createElement("div");Fe.className="upg-line",ne.append(Fe)}let ve=Array.from(ne.children);for(let Fe of ve)Fe.tagName==="DIV"&&!Fe.className&&Fe.style.height==="12px"&&Fe.remove();let Ue=ne.querySelector(".upg-line"),ke=`<span class="bonus-line">${p.effect}</span>`;Ue.innerHTML!==ke&&(Ue.innerHTML=ke),fe(ne)}else{let ne=J.querySelector(".effect-wrapper");ne&&ne.remove()}let _=Fx(p.upg.costType),Y=p.nextPrice instanceof c?p.nextPrice:c.fromAny(p.nextPrice||0),ie=G||N;if(!p.unlockUpgrade&&!ie&&(!g||!h?.hideCost)){let ne=u(J,"upg-costs");fe(ne);let ve=Au(p.upg.costType,Y),Ue=`Cost: ${_} ${A[p.upg.costType].fmt(Y)} ${ve}`,ke=u(ne,"cost-line","div");if(ke.className.includes("upg-line")||(ke.className="upg-line cost-line"),ke.innerHTML!==Ue&&(ke.innerHTML=Ue),l){let xe=u(ne,"milestone-line","div");xe.className.includes("upg-line")||(xe.className="upg-line milestone-line");let x="\u2014",j="",Z=d0(p.upg);try{if(p.hmNextMilestone&&p.hmNextMilestone.cmp(p.lvlBn)>0)if(Z){let ue=p.hmNextMilestone.sub(c.fromInt(1)),ze=0;try{let we=ue.toPlainIntegerString?.();we&&we!=="Infinity"?ze=Number(we):ze=Number(ue.toString())}catch{ze=0}let rt=c.fromInt(0);try{rt=c.fromAny(p.upg.costAtLevel(ze))}catch{}x=A[p.upg.costType].fmt(rt),j=Au(p.upg.costType,rt)}else{let ue=p.hmNextMilestone.sub(p.lvlBn),ze=ue.toPlainIntegerString?.(),rt=Math.max(0,Math.floor(Number(ze&&ze!=="Infinity"?ze:Number(ue.toString()||0)))),{spent:we}=Ni(p.upg,p.lvlBn,c.fromAny("Infinity"),rt);x=A[p.upg.costType].fmt(we),j=Au(p.upg.costType,we)}}catch{}let ye=`${Z?"Cost at next milestone:":"Cost to next milestone:"} ${_} ${x} ${j}`;xe.innerHTML!==ye&&(xe.innerHTML=ye)}else{let xe=ne.querySelector(".milestone-line");xe&&xe.remove()}let Fe=Au(p.upg.costType,p.have),ce=`You have: ${_} ${A[p.upg.costType].fmt(p.have)} ${Fe}`,te=u(ne,"have-line","div");te.className.includes("upg-line")||(te.className="upg-line have-line"),te.innerHTML!==ce&&(te.innerHTML=ce)}else{let ne=J.querySelector(".upg-costs");ne&&ne.remove()}let de=dt.querySelector(".upg-milestones"),H=de.querySelector(".hm-view-milestones-row");if(!H){H=document.createElement("div"),H.className="hm-view-milestones-row";let ne=document.createElement("button");ne.type="button",ne.className="shop-delve hm-view-milestones",ne.textContent="View Milestones",ne.addEventListener("click",ve=>{ne._onClick&&ne._onClick(ve)}),H.appendChild(ne),de.appendChild(H)}let ee=H.querySelector("button");l&&!y?(ee.style.visibility="",ee.style.pointerEvents="auto",ee._onClick=()=>{let ne=Array.isArray(p.hmMilestones)?p.hmMilestones:[],ve=Math.max(0,Math.floor(Number(p.hmEvolutions??0))),Ue=(()=>{try{return BigInt(Yt)*BigInt(ve)}catch{return 0n}})(),ke=ne.sort((Fe,ce)=>Number(Fe?.level||0)-Number(ce?.level||0)).map(Fe=>{let ce=Math.max(0,Math.floor(Number(Fe?.level||0))),te=(()=>{if(p.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ce)+Ue).toString())}catch{return c.fromAny(ce+Yt*ve)}})(),xe=te?.isInfinite?.()?"Infinity":W(te),x=Te(Fe?.multiplier??Fe?.mult??Fe?.value??1),j=`${Fe?.target??Fe?.type??"self"}`.toLowerCase(),Z=(()=>{if(p.lvlBn?.isInfinite?.())return!0;try{return p.lvlBn?.cmp?.(te)>=0}catch{}return!1})(),oe=`Level ${xe}: Multiplies this upgrade\u2019s effect by ${x}x`;return j==="xp"&&(oe=`Level ${xe}: Multiplies XP value by ${x}x`),(j==="coin"||j==="coins")&&(oe=`Level ${xe}: Multiplies Coin value by ${x}x`),j==="mp"&&(oe=`Level ${xe}: Multiplies MP value by ${x}x`),{text:oe,achieved:Z}});Gx(ke)}):(ee.style.visibility="hidden",ee.style.pointerEvents="none",ee._onClick=null);let ge=dt.querySelector(".upg-actions"),Be=ge.querySelector(".shop-close");if(Be||(Be=document.createElement("button"),Be.type="button",Be.className="shop-close",Be.textContent="Close",Be.addEventListener("click",()=>{n=!1,tm()}),ge.appendChild(Be)),g||G)ge.querySelectorAll("button:not(.shop-close)").forEach(ne=>ne.remove()),document.activeElement&&document.activeElement!==Be&&!ge.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Be.focus();else{let ne=p.have.cmp(Y)>=0,ve=(ce,te,xe,x,j=!1)=>{let Z=ge.querySelector(`.${ce.split(" ").join(".")}`);if(!Z){Z=document.createElement("button"),Z.type="button",Z.className=ce,Z.textContent=te;let oe=()=>{typeof Z._onClick=="function"&&Z._onClick()};"PointerEvent"in window?Z.addEventListener("pointerdown",ue=>{ue.pointerType==="mouse"||typeof ue.button=="number"&&ue.button!==0||(oe(),ue.preventDefault())},{passive:!1}):Z.addEventListener("touchstart",ue=>{oe(),ue.preventDefault()},{passive:!1}),Z.addEventListener("click",()=>{Qe||oe()});let ye=ge.children;x>=ye.length?ge.appendChild(Z):ge.insertBefore(Z,ye[x])}return Z._onClick=xe,Z.textContent!==te&&(Z.textContent=te),Z.disabled!==j&&(Z.disabled=j),Z};if(N){ge.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ce=>ce.remove()),ve("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ce}=o.evolve(e.id);ce&&(g0(),dr(),m())},1,!1);return}if(p.unlockUpgrade){ge.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ce=>ce.remove()),ve("shop-delve btn-unlock","Unlock",()=>{let{bought:ce}=o.buyOne(e.id);if(!(ce instanceof c?ce:c.fromAny(ce??0)).isZero?.()){if(Ht(),ku(e,t))try{Tl(["reset"])}catch{}dr(),m()}},1,!ne);return}if(ge.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ce=>ce.remove()),ve("shop-delve btn-buy-one","Buy",()=>{let ce=o.getUiModel(e.id);if(ce.have.cmp(ce.nextPrice instanceof c?ce.nextPrice:c.fromAny(ce.nextPrice||0))<0)return;let{bought:te}=o.buyOne(e.id);(te instanceof c?te:c.fromAny(te??0)).isZero?.()||(Ht(),dr(),m())},1,!ne),(Number.isFinite(p.upg.lvlCap)?p.upg.lvlCap:1/0)===1){let ce=ge.querySelector(".btn-buy-max");ce&&ce.remove();let te=ge.querySelector(".btn-buy-cheap");te&&te.remove()}else{ve("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:x}=o.buyMax(e.id);(x instanceof c?x:c.fromAny(x??0)).isZero?.()||(Ht(),dr(),m())},2,!ne);let te=[1,3,4,5,6].includes(em(p.upg));if(!l&&!te)ve("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let j=o.buyCheap;if(!j)return;let{bought:Z}=j(e.id);(Z instanceof c?Z:c.fromAny(Z??0)).isZero?.()||(Ht(),dr(),m())},3,!ne);else{let xe=ge.querySelector(".btn-buy-cheap");xe&&xe.remove()}}if(l)ve("shop-delve btn-buy-next","Buy Next",()=>{let te=o.getUiModel(e.id);if(te.hmReadyToEvolve)return;let xe=te.hmNextMilestone;if(!xe||!te.lvlBn||xe.cmp(te.lvlBn)<=0){let{bought:we}=o.buyMax(e.id);if((we instanceof c?we:c.fromAny(we??0)).isZero?.())return;Ht(),dr(),m();return}let x=0;try{let we=xe.sub(te.lvlBn).toPlainIntegerString?.();x=Math.max(0,Math.floor(Number(we&&we!=="Infinity"?we:xe.sub(te.lvlBn).toString())))}catch{}let j=A[te.upg.costType]?.value,Z=j instanceof c?j:c.fromAny(j??0),ye=Ni(te.upg,te.lvlBn,Z,x).count,ue=!1;try{let we=ye?.toPlainIntegerString?.();ue=we&&we!=="Infinity"?Number(we)>=x:Number(ye??0)>=x}catch{}let ze=ue?o.buyNext(e.id,x):o.buyMax(e.id);(ze.bought instanceof c?ze.bought:c.fromAny(ze.bought??0)).isZero?.()||(Ht(),dr(),m())},3,p.have.cmp(c.fromInt(1))<0);else{let ce=ge.querySelector(".btn-buy-next");ce&&ce.remove()}}},v=()=>{n&&m()};o.events.forEach(p=>window.addEventListener(p,v)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",v),m(),un.classList.add("is-open"),un.classList.toggle("is-automation-upgrade",t==="automation"),un.style.pointerEvents="auto",Dn(140),dt.style.transition="none",dt.style.transform="translateY(100%)",dt.offsetHeight,requestAnimationFrame(()=>{dt.style.transition="",dt.style.transform=""}),Nu=()=>{n=!1,o.events.forEach(p=>window.removeEventListener(p,v)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",v)}}function Zd(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let m=Math.max(0,d-r.startY);r.lastY=d,r.moved=m,t.style.transform=`translateY(${m}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(Oo(100),Dn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var Al,a0,Tx,Ax,kx,l0,Nx,Rx,Ox,c0,Px,Bx,m0,h0,Ux,u0,kl,Ol,un,dt,Pl,Nu,v0,Rr=De(()=>{St();Et();Gt();Io();Ws();kc();An();no();hs();pi();_s();Jp();Al=new Set;a0={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},Tx="img/misc/locked_base.webp",Ax="img/misc/maxed.webp",kx="img/misc/green_border.webp",l0={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},Nx=7,Rx={coins:Za,books:Ja,gold:Qa,magic:el,dna:tl};Ox={coins:Za,books:Ja,gold:Qa,magic:el,dna:tl};c0={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Qp(io()),getUiModel:e=>Zs(io(),e),buyOne:e=>Ks(io(),e),buyMax:e=>Nl(io(),e),buyCheap:e=>Rl(io(),e),buyNext:(e,t)=>js(io(),e,t),getLockState:e=>Fo(io(),e),evolve:e=>Ou(io(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",Vp,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Qp(Je),getUiModel:e=>Zs(Je,e),buyOne:e=>Ks(Je,e),buyMax:e=>Nl(Je,e),buyCheap:e=>Rl(Je,e),buyNext:(e,t)=>js(Je,e,t),getLockState:e=>Fo(Je,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>Qp(Vt),getUiModel:e=>Zs(Vt,e),buyOne:e=>Ks(Vt,e),buyMax:e=>Nl(Vt,e),buyCheap:e=>Rl(Vt,e),buyNext:(e,t)=>js(Vt,e,t),getLockState:e=>Fo(Vt,e),evolve:e=>Ou(Vt,e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||dr(!0)});Px="sounds/purchase_upg.ogg",Bx="sounds/evolve_upg.ogg",m0=.12,h0=.3;Ux="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",u0="ccc-scroll-timeline-styles";kl=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return p0(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!Yv(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let Y=document.createElement("div");Y.className="shop-tile";let ie=document.createElement("img");ie.className="base",ie.alt="";let de=document.createElement("img");de.className="icon",de.alt="",de.addEventListener("error",()=>{de.src=Ux}),Y.appendChild(ie),Y.appendChild(de),i.appendChild(Y),t.appendChild(i),i.addEventListener("click",H=>{let ee=H.currentTarget;if(ee.disabled||ee.dataset.lockedPlain==="1"){H.preventDefault(),H.stopImmediatePropagation();return}if(go(ee)){H.preventDefault(),H.stopImmediatePropagation();return}if(H.shiftKey||H.ctrlKey){if(H.preventDefault(),H.stopImmediatePropagation(),!ee.upgMeta)return;let ge=ee.upgMeta.id,Be=ee.upgMeta.upgType==="HM",ne=[1,3,4,5,6].includes(em(ee.upgMeta));if(H.shiftKey){if((Be||!ne)&&this.adapter.buyCheap){let{bought:ke}=this.adapter.buyCheap(ge);(ke instanceof c?ke:c.fromAny(ke??0)).isZero?.()||(Ht(),this.update());return}let{bought:ve}=this.adapter.buyMax(ge);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(Ht(),ku(ee.upgMeta,this.mode))try{Tl(["reset"])}catch{}this.update()}return}if(H.ctrlKey){if(Be){let ke=this.adapter.getUiModel(ge);if(ke&&!ke.hmReadyToEvolve){let Fe=ke.hmNextMilestone;if(Fe&&ke.lvlBn&&Fe.cmp(ke.lvlBn)>0){let ce=0;try{let oe=Fe.sub(ke.lvlBn).toPlainIntegerString?.();ce=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Fe.sub(ke.lvlBn).toString())))}catch{}let te=A[ke.upg.costType]?.value,xe=te instanceof c?te:c.fromAny(te??0),j=Ni(ke.upg,ke.lvlBn,xe,ce).count,Z=!1;try{let oe=j?.toPlainIntegerString?.();Z=oe&&oe!=="Infinity"?Number(oe)>=ce:Number(j??0)>=ce}catch{}if(Z){let oe=this.adapter.buyNext(ge,ce);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(Ht(),this.update());return}}}}let{bought:ve}=this.adapter.buyMax(ge);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(Ht(),ku(ee.upgMeta,this.mode))try{Tl(["reset"])}catch{}this.update()}return}}ee.upgMeta&&Hx(ee.upgMeta,this.mode)}),i.addEventListener("contextmenu",H=>{if(Qe)return;let ee=H.currentTarget;if(ee.dataset.locked==="1"||(H.preventDefault(),H.stopPropagation(),!ee.upgMeta))return;if(this.adapter.getUiModel(ee.upgMeta.id)?.hmReadyToEvolve){let{evolved:ve}=this.adapter.evolve(ee.upgMeta.id);ve&&(g0(),this.update());return}let{bought:Be}=this.adapter.buyMax(ee.upgMeta.id);if(!(Be instanceof c?Be:c.fromAny(Be??0)).isZero?.()){if(Ht(),ku(ee.upgMeta,this.mode))try{Tl(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let m=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",m);let v=s?c.fromInt(0):$x(r.meta,r.levelNumeric,r.level),p=v instanceof c?v:c.fromAny(v),h=W(r.level),g=Ru(h),y=W(p),I=Ru(y),E=!p.isZero?.(),M=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,N=Number.isFinite(M)?Math.max(0,Math.floor(M)):1/0,G=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,P=m?!1:r.level?.isInfinite?.()?!0:Number.isFinite(N)&&Number.isFinite(G)?G>=N:!1,$=Number.isFinite(N)&&N===1,L=!!r.meta?.unlockUpgrade,F=!s&&L&&!P,T=!s&&L&&!F&&P,C,z,Q=!1,ae=!1;if(s){C="",z="";let Y=u?(r.lockState?.reason||"").trim():"",ie=Y?`${r.title} (Locked, ${Y})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ie)}else{if(F||T)C=F?"Unlockable":"Unlocked",z=C,ae=!0;else if(!s&&$&&!L)P?(C="Owned",z="Owned"):E?(C="Purchasable",z="Purchasable"):(C="Not Owned",z="Not Owned"),ae=!0;else{let Y=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ie=String(g||"").replace(/,/g,""),de=/|Infinity/i.test(ie),H=Number.isFinite(Y)?Y>=1e3:de||/^\d{4,}$/.test(ie);Q=E&&H,Q?(C=`<span class="badge-lvl">${h}</span><span class="badge-plus">(+${y})</span>`,z=`${g} (+${I})`):(C=E?`${h} (+${y})`:h,z=E?`${g} (+${I})`:g)}i.setAttribute("aria-label",`${r.title}, ${z}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let he=i.firstElementChild,Se=he.querySelector(".base"),Oe=he.querySelector(".icon"),Ae=r.meta?.costType||"coins",K=r.useLockedBase||s?Tx:r.baseIconOverride||a0[Ae]||a0.coins;Se.src!==K&&(Se.src=K);let q=r.icon;if(!q)Oe.hidden||(Oe.hidden=!0);else{Oe.hidden&&(Oe.hidden=!1);let Y=q;Oe._lastSrc!==Y&&(Oe.src=Y,Oe._lastSrc=Y)}let X=he.querySelector(".maxed-overlay"),J=!s&&d0(r.meta),le=!s&&P;if(le||!s&&!P&&!m&&J){X||(X=document.createElement("img"),X.className="maxed-overlay",X.alt="",he.insertBefore(X,Oe));let Y=le?Ax:kx;X.src!==Y&&(X.src=Y)}else X&&X.remove();let _=he.querySelector(".level-badge");s?_&&_.remove():(_||(_=document.createElement("span"),_.className="level-badge",he.appendChild(_)),_.className="level-badge",ae&&_.classList.add("text-badge"),Q&&_.classList.add("two-line"),(E||F)&&_.classList.add("can-buy"),P&&_.classList.add("is-maxed"),C===z?_.textContent!==C&&(_.textContent=C):_.innerHTML!==C&&(_.innerHTML=C))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),Us(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&go(a)||(Vr(),Jv())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(Qe&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{Qe&&Dn(80),this.close()},{passive:!0}),Zd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&r0(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,Qe)try{setTimeout(()=>Oo(240),120)}catch{}Dn(10),Us(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||!t&&Ep()||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}};typeof window<"u"&&window.addEventListener("menu:scrollStop",()=>{dr(!0)});Ol={standard:new kl("standard"),automation:new kl("automation"),dna:new kl("dna")};un=null,dt=null,Pl=!1,Nu=null,v0="standard"});var I0={};bt(I0,{applyHudLayout:()=>pr,initHudButtons:()=>Vx,isMapUnlocked:()=>im,isShopUnlocked:()=>rm,lockMap:()=>$u,lockShop:()=>Du,unlockMap:()=>Uu,unlockShop:()=>Ri});function om(e){let t=b();return t==null?e:`${e}:${t}`}function Js(e){let t=om(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function rm(){return sm(),Js(_o.SHOP)}function im(){return sm(),Js(_o.MAP)}function Fu(e,t){let n=t?"1":"0",o=om(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function sm(){for(let e of Object.values(_o)){let t=om(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function Uo(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function nm(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",is())}function Xx(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function pr(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=Xx(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(v=>e.querySelector(`.game-btn[data-btn="${v}"]`)).filter(Boolean),a=[...e.children].filter(v=>!l.includes(v)),u=[...l,...a];if(u.length&&u.some((v,p)=>e.children[p]!==v)){let v=document.createDocumentFragment();u.forEach(p=>v.appendChild(p)),e.appendChild(v)}let m=[...e.querySelectorAll(".game-btn")].filter(v=>!v.hidden);if(e.classList.remove("is-2","is-3","is-4"),m.forEach(v=>{v.style.gridColumn="",v.style.gridRow="",v.classList.remove("span-2"),v.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${m.length}`),!o){let v=getComputedStyle(e),p=parseFloat(v.columnGap||v.gap||"0")||0,h=e.clientWidth,g=Math.max(180,Math.floor((h-3*p)/4));if(m.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3";return}if(m.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3",m[2].style.gridColumn="4";return}}if(o&&m.length===3){let v=e.querySelector('[data-btn="help"]:not([hidden])'),p=e.querySelector('[data-btn="stats"]:not([hidden])'),h=e.querySelector('[data-btn="shop"]:not([hidden])');v&&p&&h&&(v.style.gridColumn="1",v.style.gridRow="1",p.style.gridColumn="2",p.style.gridRow="1",h.style.gridColumn="1 / -1",h.style.gridRow="2")}}function Vx(){if(sm(),Uo("help",!0),Uo("stats",!0),Uo("shop",Js(_o.SHOP)),Uo("map",Js(_o.MAP)),nm(),pr(),typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>Cu(),{timeout:5e3}):setTimeout(()=>Cu(),100),b0||(b0=!0,window.addEventListener("resize",pr),window.addEventListener("orientationchange",pr),window.addEventListener("saveSlot:change",()=>{Uo("shop",Js(_o.SHOP)),Uo("map",Js(_o.MAP)),nm(),pr()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||nm()})),!S0){S0=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&Bs()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&go(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function Ri(){Fu(_o.SHOP,!0),Uo("shop",!0),pr()}function Uu(){Fu(_o.MAP,!0),Uo("map",!0),pr()}function Du(){Fu(_o.SHOP,!1),Uo("shop",!1),pr()}function $u(){Fu(_o.MAP,!1),Uo("map",!1),pr()}var _o,b0,S0,qu=De(()=>{Rr();Ws();St();hs();_o={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};b0=!1,S0=!1});function w0(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(Y=>Y.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let _=0;_<t;_++)d[_*f+2]=1/0;let m=new Int16Array(t),v=t;for(let _=0;_<t;_++)m[_]=t-1-_;let p=-1,h=document.createElement("canvas");h.className="cursor-trail-canvas",Object.assign(h.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(h);let g=h.getContext("2d",{alpha:!0,desynchronized:!0}),y=document.createElement("canvas");y.width=a,y.height=a;let I=y.getContext("2d");I.shadowColor="#FFEB3B",I.shadowBlur=l,I.fillStyle="#FFEB3B",I.beginPath(),I.arc(u,u,s,0,Math.PI*2),I.fill();let E=!1,M=null,N=null,G={left:0,top:0,width:0,height:0},P=1,$=!1,L=0,F=0,T=!1,C=null,z=[],Q=()=>{if($)return;let _=document.documentElement.clientWidth,Y=document.documentElement.clientHeight;G={left:0,top:0,width:_,height:Y,right:_,bottom:Y,x:0,y:0}},ae=()=>{if($)return;Q();let _=Math.min(window.devicePixelRatio||1,2);P=G.width>0?Math.min(_,512/G.width):_,h.width=G.width*P,h.height=G.height*P,g.scale(P,P),C=null},he=null;typeof ResizeObserver<"u"&&(he=new ResizeObserver(()=>{ae()}),he.observe(e));let Se=(_,Y)=>{if(v<=0)return;let ie=m[--v];ie>p&&(p=ie);let de=ie*f;d[de]=_,d[de+1]=Y,d[de+2]=0,d[de+3]=n},Oe=(_,Y,ie)=>{if(M===null||N===null)ie.count<r&&(Se(_,Y),ie.count++);else{let de=_-M,H=Y-N,ee=Math.hypot(de,H);if(ee>=o){let ge=Math.floor(ee/o);for(let Be=1;Be<=ge&&!(ie.count>=r);Be++){let ne=Be*o/ee;Se(M+de*ne,N+H*ne),ie.count++}}ie.count<r&&(Se(_,Y),ie.count++)}M=_,N=Y},Ae=_=>{if($)return;L||(F=0,L=requestAnimationFrame(K)),G.width||Q();let Y=0,ie=0,de=(H,ee)=>H>=0&&H<=G.width&&ee>=0&&ee<=G.height;if(_.getCoalescedEvents){let H=_.getCoalescedEvents();if(H.length>0)for(let ee of H){let ge=ee.clientX-Y,Be=ee.clientY-ie;z.push({x:ge,y:Be,inside:de(ge,Be)})}else{let ee=_.clientX-Y,ge=_.clientY-ie;z.push({x:ee,y:ge,inside:de(ee,ge)})}}else{let H=_.clientX-Y,ee=_.clientY-ie;z.push({x:H,y:ee,inside:de(H,ee)})}},U=()=>{E=!1,M=null,N=null,z.length=0},K=()=>{if($)return;let _=performance.now();F||(F=_);let Y=_-F;F=_,Y>100&&(Y=100);let ie={count:0};if(z.length>0){for(let Ue of z)Ue.inside?(E=!0,Oe(Ue.x,Ue.y,ie)):(E=!1,M=null,N=null);let ve=z[z.length-1];ve.inside&&(M!==ve.x||N!==ve.y)&&(Se(ve.x,ve.y),M=ve.x,N=ve.y),z.length=0}else E&&M!==null&&N!==null&&Se(M,N);let de=t-v;if(de===0&&!T){L=0;return}C?g.clearRect(C.x,C.y,C.w,C.h):g.clearRect(0,0,G.width,G.height),T=!1;let H=1/0,ee=1/0,ge=-1/0,Be=-1/0,ne=-1;if(de>0)for(let ve=0;ve<=p;ve++){let Ue=ve*f,ke=d[Ue+2];if(ke>=d[Ue+3])continue;if(ke+=Y,d[Ue+2]=ke,ke>=d[Ue+3]){m[v++]=ve;continue}ne=ve;let Fe=d[Ue+3],ce=ke/Fe,te=1-ce,xe=1-.4*ce;T=!0,g.globalAlpha=te;let x=a*xe,j=x/2,Z=d[Ue],oe=d[Ue+1],ye=Math.round(Z-j),ue=Math.round(oe-j),ze=Math.round(x);g.drawImage(y,ye,ue,ze,ze),ye<H&&(H=ye),ue<ee&&(ee=ue);let rt=ye+ze,we=ue+ze;rt>ge&&(ge=rt),we>Be&&(Be=we)}p=ne,H!==1/0?(H-=2,ee-=2,ge+=2,Be+=2,C={x:H,y:ee,w:ge-H,h:Be-ee}):C=null,L=requestAnimationFrame(K)};window.addEventListener("resize",ae),window.addEventListener("scroll",Q,{passive:!0}),window.addEventListener("focus",Q,{passive:!0}),document.addEventListener("visibilitychange",Q,{passive:!0});let q={passive:!0},X=_=>{Q(),Ae(_)},J=_=>{Q(),Ae(_)};e.addEventListener("pointermove",Ae,q),e.addEventListener("pointerdown",J,q),e.addEventListener("pointerenter",X,q),e.addEventListener("pointerleave",U,q),e.addEventListener("pointercancel",U,q),ae(),L=requestAnimationFrame(K);let le=setInterval(Q,1e3);return{destroy:()=>{$=!0,L&&cancelAnimationFrame(L),le&&clearInterval(le),he&&(he.disconnect(),he=null);try{window.removeEventListener("resize",ae)}catch{}try{window.removeEventListener("scroll",Q)}catch{}try{window.removeEventListener("focus",Q)}catch{}try{document.removeEventListener("visibilitychange",Q)}catch{}try{e.removeEventListener("pointermove",Ae),e.removeEventListener("pointerdown",J),e.removeEventListener("pointerenter",X),e.removeEventListener("pointerleave",U),e.removeEventListener("pointercancel",U)}catch{}h.remove()}}}var E0=De(()=>{});var O0={};bt(O0,{clearPendingGains:()=>gm,getPassiveCoinReward:()=>vu,initCoinPickup:()=>e1,setCoinMultiplier:()=>Kx,triggerPassiveCollect:()=>np});function x0(e){if(!e||typeof e!="object"){Fl=!1,Gu=!1,Hu="0",Bi.clear();return}Fl=!!e.unlocked,Gu=!!e.level?.isInfinite?.();try{Hu=e.level?.toPlainIntegerString?.()??"0"}catch{Hu="0"}Fl?Gu&&Bi.clear():Bi.clear()}function Yx(){if(typeof Oi=="function")try{Oi()}catch{}try{x0(vt())}catch{Fl=!1,Bi.clear()}try{Oi=Fi(e=>{x0(e)})}catch{Oi=null}}function Kx(e){zx=e;try{A.coins?.mult?.set&&A.coins.mult.set(e)}catch{}}function um(){try{let e=Wc();e instanceof c?ea=e.clone?.()??e:e!=null?ea=c.fromAny(e):ea=c.fromInt(1)}catch{ea=c.fromInt(1)}}function jx(){L0||(L0=!0,um(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",um),typeof window<"u"&&window.addEventListener("saveSlot:change",um))}function Zx(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return mm.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function pm(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*Jx:0}function Qx({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,m=0,v=null,p=null,h=pm(),g=0,y=0,I=0,E=!1,M=null,N=null,G=()=>{if(E)return;let q=document.documentElement.clientWidth,X=document.documentElement.clientHeight;M={left:0,top:0,width:q,height:X,right:q,bottom:X,x:0,y:0}},P=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",v=null,p=null},$=()=>{if(!l||y<=0){P();return}let q=y*2;s.style.width=`${q}px`,s.style.height=`${q}px`,s.style.transform=`translate3d(${d-y}px, ${m-y}px, 0)`,s.classList.add("is-visible")},L=()=>{if(!(!l||y<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let q=y+fm,X=[];if(typeof i.findCoinTargetsInPath=="function"&&v!==null&&p!==null?X=i.findCoinTargetsInPath(v,p,d,m,q):X=i.findCoinTargetsInRadius(d,m,q),v=d,p=m,X&&X.length>0)if(typeof r=="function"){let J=[];for(let le=0;le<X.length;le++){let fe=X[le],_={coin:fe};fe.el&&i.getCoinTransform&&(_.opts={transform:i.getCoinTransform(fe.el)}),J.push(_)}r(J)}else for(let J=0;J<X.length;J++){let le=X[J],fe=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(fe){let _=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform||"";o(fe,{transform:_})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let q=y+fm,X=i.findCoinsInRadius(d,m,q);if(v=d,p=m,X&&X.length>0){let J=[];for(let le=0;le<X.length;le++){let fe=X[le],_=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform;J.push({el:fe,opts:{transform:_}})}typeof r=="function"&&r(J)}}else{let q=t.children,X=y+fm,J=[];for(let le=q.length-1;le>=0;le--){let fe=q[le];if(fe.dataset.collected==="1"||!fe.matches(n))continue;let _=fe.getBoundingClientRect(),Y=_.left+_.width/2,ie=_.top+_.height/2,de=Y-u,H=ie-f;Math.hypot(de,H)<=X&&J.push(fe)}if(!J.length)return;if(typeof r=="function"){let le=[];for(let fe=0;fe<J.length;fe++){let _=J[fe],Y=window.getComputedStyle(_);le.push({el:_,opts:{transform:Y.transform}})}r(le)}else{let le=[];for(let fe=0;fe<J.length;fe++){let _=J[fe],Y=window.getComputedStyle(_);le.push(Y.transform)}for(let fe=0;fe<J.length;fe++)o(J[fe],{transform:le[fe]})}}},F=()=>{I=0,$(),!(!l||y<=0||E)&&(L(),T())},T=()=>{!l||y<=0||I||E||(I=requestAnimationFrame(F))},C=q=>{if(!q||E||typeof q.clientX!="number"||typeof q.clientY!="number")return;a=!0,u=q.clientX,f=q.clientY,M||G();let X=M;d=u,m=f,l=d>=0&&d<=X.width&&m>=0&&m<=X.height,T()},z=()=>{l=!1,P(),v=null,p=null},Q=()=>{v=null,p=null},ae=()=>{g=zc(),y=g*h,$(),T()},he=()=>{if(!(E||!a)){if(G(),M){let q=M;d=u-q.left,m=f-q.top,l=d>=0&&d<=q.width&&m>=0&&m<=q.height}T()}},Se=()=>{if(h=pm(),y=g*h,G(),a&&M){let q=M;d=u-q.left,m=f-q.top,l=d>=0&&d<=q.width&&m>=0&&m<=q.height}T()},Oe=q=>{G(),C(q)},Ae=q=>{Q(),Oe(q)},U=()=>{E=!0,I&&(cancelAnimationFrame(I),I=0),N&&clearInterval(N);try{window.removeEventListener("scroll",he)}catch{}try{window.removeEventListener("resize",Se)}catch{}try{window.removeEventListener("saveSlot:change",ae)}catch{}try{document.removeEventListener("ccc:upgrades:changed",ae)}catch{}try{e.removeEventListener("pointermove",C)}catch{}try{e.removeEventListener("pointerdown",Oe)}catch{}try{e.removeEventListener("pointerenter",Ae)}catch{}try{e.removeEventListener("pointerleave",z)}catch{}try{e.removeEventListener("pointercancel",z)}catch{}try{window.removeEventListener("blur",Q)}catch{}try{s.remove()}catch{}},K={passive:!0};return e.addEventListener("pointermove",C,K),e.addEventListener("pointerdown",Oe,K),e.addEventListener("pointerenter",Ae,K),e.addEventListener("pointerleave",z,K),e.addEventListener("pointercancel",z,K),window.addEventListener("resize",Se),window.addEventListener("scroll",he,{passive:!0}),window.addEventListener("focus",G,{passive:!0}),window.addEventListener("blur",Q,{passive:!0}),document.addEventListener("visibilitychange",()=>{G(),document.hidden&&Q()},{passive:!0}),window.addEventListener("saveSlot:change",ae),document.addEventListener("ccc:upgrades:changed",ae),N=setInterval(G,1e3),ae(),{destroy:U}}function gm(){Ul=null,Dl=null,$l=null}function R0(e){let t=mm.clone?.()??c.fromInt(1),n=k0(t),o=Co(_0),i=N0(e??Hu);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Do=="function"&&Do()?Co(ea):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function vu(){let{coinGain:e,xpGain:t,mpGain:n}=R0(null);return{coins:e,xp:t,mp:n}}function np(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=R0(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=gn(Re.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{$n=$n?.add?$n.add(r):Co(r)}catch{$n=Co(r)}Bl(),a||C0(r);let u=typeof vn=="function"?vn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&M0(i),s.isZero?.()||T0(s)}function e1({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){am?.destroy&&am.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};Yx(),jx(),a.style.touchAction="none";let d=null,m=null;$n=A.coins.value,dm=()=>{let _=W($n),Y=hp(),ie=_+Y;ie.includes("<span")?f.innerHTML=ie:f.textContent=ie},A0(),Bl();let v=_=>{_?.detail&&_.detail.key==="coins"&&($n=_.detail.value,Bl())};window.addEventListener("currency:change",v);let p=_=>{if(!(!_?.detail||_.detail.key!=="coins"))try{let{mult:Y}=_.detail;Y instanceof c?so=Y.clone?.()??Y:Y!=null?so=c.fromAny(Y):so=c.fromInt(1),Pi=!!so?.isInfinite?.()}catch{so=null,Pi=!1}};window.addEventListener("currency:multiplier",p);let h=b();if(h==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${h}`,y=`ccc:unlock:shop:progress:${h}`,I=localStorage.getItem("ccc:unlock:shop:progress"),E=localStorage.getItem("ccc:unlock:shop");I!=null&&localStorage.getItem(y)==null&&localStorage.setItem(y,I),E!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,E),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let _=parseInt(localStorage.getItem(y)||"0",10);if(localStorage.setItem(y,String(_)),_>=10&&localStorage.getItem(g)!=="1"){try{Ri()}catch{}localStorage.setItem(g,"1")}}let M=new URL(i,document.baseURI).href,N=_=>_ instanceof HTMLElement?_._coinObj?!_._coinObj.isRemoved&&_.dataset.collected!=="1":_.dataset.collected!=="1"&&_.matches(r):!1;function G(_){try{_.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(G);let P=Qe?.12:.3,$=0;function L(_=M){if(_===M){let Y=performance.now();if(Y-$<40)return;$=Y}mt(_,{volume:P})}function F(_,Y={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(_);let ie=()=>{_&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(_):_.remove())};if(l||Qe){ie();return}let de="translate3d(0,0,0)";Y.transform?Y.transform!=="none"&&(de=Y.transform):de=_.style.transform||"translate3d(0,0,0)",_.style.setProperty("--ccc-start",de),_.classList.add("coin--collected");let H=!1,ee=()=>{H||(H=!0,_.removeEventListener("animationend",ee),ie())};_.addEventListener("animationend",ee),setTimeout(ee,600)}function T(_){if(!_||!_.length)return;let Y=M,ie=-1,de=!1;for(let ce of _){let te=ce.coin||ce.el&&ce.el._coinObj;te&&(te.sizeIndex!==void 0?te.sizeIndex>ie&&(ie=te.sizeIndex,te.soundSrc&&(Y=te.soundSrc,de=!0)):te.soundSrc&&!de&&(Y=te.soundSrc,de=!0))}L(Y);let H=null,ee=null,ge=null,Be=0,ne=gn(Re.COINS),ve=typeof vn=="function"?vn():!0,Ue=typeof Do=="function"&&Do(),ke=15,Fe=0;for(let ce of _){let te=ce.el,xe=ce.coin;if(!xe&&te&&te._coinObj&&(xe=te._coinObj),te&&!N(te)||xe&&xe.isRemoved)continue;Be++,te&&(te.dataset.collected="1"),Fe<ke?(!te&&xe&&e&&e.ensureCoinVisual&&(te=e.ensureCoinVisual(xe),te&&(te.dataset.collected="1")),te?(F(te,ce.opts||{}),Fe++):xe&&e&&e.removeCoinTarget&&e.removeCoinTarget(xe)):xe&&e&&e.removeCoinTarget?e.removeCoinTarget(xe):te&&(e&&e.detachCoin&&e.detachCoin(te),e&&e.recycleCoin?e.recycleCoin(te):te.remove());let x=te?Zx(te):mm,j=xe?.mutationLevel??(te?.dataset?.mutationLevel||null),Z=k0(x),oe=Co(_0),ye=Co(ea);if(xe&&xe.valueMultiplier&&xe.valueMultiplier>1){try{Z=Z.mulDecimalFloor(xe.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(xe.valueMultiplier)}catch{}try{ye=ye.mulDecimalFloor(xe.valueMultiplier)}catch{}}let ue=N0(j);if(ue){try{Z=Z.mulBigNumInteger(ue)}catch{}try{oe=oe.mulBigNumInteger(ue)}catch{}}ne||(H=ta(H,Z)),ve&&(ee=ta(ee,oe)),Ue&&(ge=ta(ge,ye))}if(Be!==0){if(jy(),H&&!H.isZero?.()){try{$n=$n?.add?$n.add(H):Co(H)}catch{$n=Co(H)}C0(H),Bl()}if(ee&&!ee.isZero?.()&&M0(ee),ge&&!ge.isZero?.()&&T0(ge),localStorage.getItem(g)!=="1"){let te=parseInt(localStorage.getItem(y)||"0",10)+Be;if(localStorage.setItem(y,String(te)),te>=10){try{Ri()}catch{}localStorage.setItem(g,"1")}}}}function C(_,Y={}){return T([{el:_,opts:Y}]),!0}d=Qx({playfield:a,coinsLayer:u,coinSelector:r,collectFn:C,collectBatchFn:T,spawner:e}),m=w0(a);let z=_=>{if(_.target===u)return;let Y=_.target.closest(r);if(Y&&N(Y)){let ie={};e&&typeof e.getCoinTransform=="function"&&(ie.transform=e.getCoinTransform(Y)),C(Y,ie)}};u.addEventListener("pointerdown",z,{passive:!0}),Qe||u.addEventListener("mouseover",z,{passive:!0});let Q=25,ae=null,he=()=>{let _=document.documentElement.clientWidth,Y=document.documentElement.clientHeight;ae={left:0,top:0,width:_,height:Y,right:_,bottom:Y,x:0,y:0}};window.addEventListener("resize",he),window.addEventListener("scroll",he,{passive:!0}),he();let Se=null,Oe=null,Ae=()=>{Se=null,Oe=null};a.addEventListener("pointerleave",Ae,{passive:!0}),a.addEventListener("pointerenter",Ae,{passive:!0}),window.addEventListener("blur",Ae,{passive:!0});function U(_,Y){if(e&&typeof e.findCoinTargetsInRadius=="function"){ae||he();let ie=_,de=Y,H=[];if(typeof e.findCoinTargetsInPath=="function"&&Se!==null&&Oe!==null?H=e.findCoinTargetsInPath(Se,Oe,ie,de,Q,!0):H=e.findCoinTargetsInRadius(ie,de,Q,!0),Se=ie,Oe=de,H&&H.length>0){let ee=[];for(let ge=0;ge<H.length;ge++){let Be=H[ge],ne={coin:Be};Be.el&&e.getCoinTransform&&(ne.opts={transform:e.getCoinTransform(Be.el)}),ee.push(ne)}T(ee)}}else if(e&&typeof e.findCoinsInRadius=="function"){ae||he();let ie=_,de=Y,H=e.findCoinsInRadius(ie,de,Q);if(Se=ie,Oe=de,H&&H.length>0){let ee=[];for(let ge of H){let Be=e.getCoinTransform?e.getCoinTransform(ge):ge.style.transform;ee.push({el:ge,opts:{transform:Be}})}T(ee)}}else{let ie=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],de=new Set;for(let H=0;H<ie.length;H++){let ee=_+ie[H][0],ge=Y+ie[H][1],Be=document.elementsFromPoint(ee,ge);for(let ne=0;ne<Be.length;ne++){let ve=Be[ne];N(ve)&&!de.has(ve)&&de.add(ve)}}if(de.size>0){let H=[];de.forEach(ee=>H.push({el:ee})),T(H)}}}let K=null,q=!1;function X(_,Y){K={x:_,y:Y},q||(q=!0,requestAnimationFrame(()=>{K&&(U(K.x,K.y),K=null),q=!1}))}a.addEventListener("pointerdown",_=>{X(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("pointermove",_=>{_.pointerType!=="mouse"&&X(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("pointerup",_=>{_.pointerType!=="mouse"&&X(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("mousemove",_=>{X(_.clientX,_.clientY)},{passive:!0});function J(_){}let le=setInterval(he,1e3),fe=()=>{if(clearInterval(le),Xu(),dm=()=>{},typeof window<"u"&&(window.removeEventListener("resize",he),window.removeEventListener("beforeunload",Xu),window.removeEventListener("currency:multiplier",p),window.removeEventListener("currency:change",v),window.removeEventListener("blur",Ae)),typeof Oi=="function"){try{Oi()}catch{}Oi=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(m?.destroy){try{m.destroy()}catch{}m=null}try{u.removeEventListener("pointerdown",z),Qe||u.removeEventListener("mouseover",z)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(_=>a.replaceWith(a.cloneNode(!0)))}catch{}};return am={destroy:fe},{get count(){return $n},set count(_){$n=c.fromAny?c.fromAny(_):c.fromInt(Number(_)||0),Bl()},setMobileVolume:J,destroy:fe,collectBatch:T,getMagnetUnitPx:pm}}var Fl,Gu,Hu,Oi,am,_0,mm,Wx,Qs,Bi,zx,ea,L0,Ul,Dl,$l,lm,$n,dm,cm,Bl,Jx,fm,Co,ta,Xu,hm,C0,M0,T0,so,Pi,A0,k0,N0,cl=De(()=>{St();Et();Gt();qu();bn();Io();bo();no();E0();An();au();Sn();Fl=!1,Gu=!1,Hu="0",Oi=null;am=null,_0=c.fromInt(1),mm=c.fromInt(1),Wx=c.fromInt(1);try{Qs=c.fromAny("Infinity")}catch{Qs=null}Bi=new Map,zx="1",ea=c.fromInt(1),L0=!1,Ul=null,Dl=null,$l=null,lm=!1,$n=null,dm=()=>{},cm=!1,Bl=()=>{cm||(cm=!0,requestAnimationFrame(()=>{cm=!1,dm()}))};Jx=.05,fm=8;Co=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},ta=(e,t)=>{if(!t)return e;if(!e)return Co(t);try{return e.add(t)}catch{try{return Co(e).add(t)}catch{return Co(t)}}},Xu=()=>{let e=Ul;if(Ul=null,e&&!e.isZero?.())try{A.coins.add(e)}catch{}let t=Dl;if(Dl=null,t&&!t.isZero?.())try{ds(t)}catch{}let n=$l;if($l=null,n&&!n.isZero?.())try{Ds(n)}catch{}},hm=()=>{lm||(lm=!0,requestAnimationFrame(()=>{lm=!1,Xu()}))},C0=e=>{Ul=ta(Ul,e),hm()},M0=e=>{Dl=ta(Dl,e),hm()},T0=e=>{$l=ta($l,e),hm()};typeof window<"u"&&window.addEventListener("beforeunload",Xu,{passive:!0});so=null,Pi=!1,A0=()=>{try{let e=A?.coins?.mult;if(!e||typeof e.get!="function"){so=null,Pi=!1;return}let t=e.get();if(!t){so=c.fromInt(1),Pi=!1;return}so=t.clone?.()??c.fromAny(t),Pi=!!so?.isInfinite?.()}catch{so=null,Pi=!1}},k0=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return A?.coins?.mult?.applyTo?A.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}so||A0();let n=so;if(!n)try{return A?.coins?.mult?.applyTo?A.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(Pi||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return A?.coins?.mult?.applyTo?A.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},N0=e=>{if(!Fl)return null;if(Gu){if(Qs)try{return Qs.clone?.()??Qs}catch{return Qs}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=Bi.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{Bi.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=na(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(Wx)===0,s=r.clone?.()??r;if(Bi.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function t1(e){if(e==null)return 0;try{let t=localStorage.getItem(B0(e));return t?parseInt(t,10):0}catch{return 0}}function n1(e,t){if(e!=null)try{localStorage.setItem(B0(e),t.toString())}catch{}}function o1(e){if(e==null)return 0;try{let t=localStorage.getItem(F0(e));return t?parseInt(t,10):0}catch{return 0}}function r1(e,t){if(e!=null)try{localStorage.setItem(F0(e),t.toString())}catch{}}function i1(e){if(e==null)return 0;try{let t=localStorage.getItem(U0(e));return t?parseInt(t,10):0}catch{return 0}}function s1(e,t){if(e!=null)try{localStorage.setItem(U0(e),t.toString())}catch{}}function a1(e){if(e==null)return 0;try{let t=localStorage.getItem(D0(e));return t?parseInt(t,10):0}catch{return 0}}function l1(e,t){if(e!=null)try{localStorage.setItem(D0(e),t.toString())}catch{}}function $0(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let p=Number(e.toString());isNaN(p)||(t=p),(e==="Infinity"||p===1/0)&&(n=!0)}catch{}let o=b(),r=t1(o),i=r;i<1&&n&&(i=1),i<2&&st(4)>=1&&(i=2),i!==r&&(r=i,n1(o,r));let s=o1(o),l=s;l<1&&st(4)>=1&&(l=1),l!==s&&(s=l,r1(o,s));let a=i1(o),u=a;u<1&&st(4)>=1&&(u=1),u!==a&&(a=u,s1(o,a));let f=a1(o),d=f;d<1&&st(4)>=1&&(d=1),d!==f&&(f=d,l1(o,f));let m=[],v=[];for(let p of P0){let h=p;if(n){h={...p,description:[...p.description]};let g=Bn(),y=oo(),I=g+y;if(I>1&&(I=1),p.id===1){let E=Math.pow(10,I),M=Te(E);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${M}x</span>`)}else if(p.id===2){let E=Math.pow(10,I),M=Te(E);h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${M}x</span>`)}else if(p.id===4){let E=Math.log10(4444e9),M=re(E*I),N=W(M);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${N}x</span>`)}else if(p.id===14){let E=Math.log10(1414e16),M=re(E*I),N=W(M);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${N}x</span>`)}else if(p.id===17){let N=re(15*I),G=re(5*I),P=W(N),$=W(G);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`),h.description[2]=h.description[2].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`)}else if(p.id===18){let N=re(15*I),G=re(5*I),P=W(N),$=W(G);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`),h.description[2]=h.description[2].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`)}}if(p.id===9&&(h===p&&(h={...p,description:[...p.description]}),r===0?h.description=["This milestone is hidden for now"]:r===1&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===10&&(h===p&&(h={...p,description:[...p.description]}),s===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===13){h===p&&(h={...p,description:[...p.description]});let y=ft()*1.5-.5,I=Math.pow(100,y),E=Te(I);h.description[0]=`Activates generator: Passively generates <span style="color:#00e5ff">${E}%</span> of pending Gold every second`}if(p.id===14&&(h===p&&(h={...p,description:[...p.description]}),a===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===15)if(h===p&&(h={...p,description:[...p.description]}),f===0)h.description=["This milestone is hidden until you research Lab Node 4"];else{let g=lu(!0),y=Te(g);h.description[0]=`Unspent DNA boosts Coins: <span style="color:#00e5ff">${y}x</span>`;let I=gl(!0),E=Te(I);h.description.push(`Unspent DNA also divides the value of Coins and the value of Magic by <span style="color:#00e5ff">${E}x</span>`)}if(p.id===16){h===p&&(h={...p,description:[...p.description]});let y=ft()*1.5-.5,I=Math.pow(100,y),E=Te(I);h.description[0]=`Activates generator: Passively generates <span style="color:#00e5ff">${E}%</span> of pending Magic every second`}p.surgeLevel<=t?m.push(h):v.push(h)}return[...m,...v.slice(0,2)]}var P0,ym,B0,F0,U0,D0,q0=De(()=>{Gt();Et();Et();Sn();nr();St();P0=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${W(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade","Makes each Workshop Level triple Gear production instead of doubling it"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]},{id:10,surgeLevel:10,description:["Unlocks new DNA upgrades"]},{id:11,surgeLevel:11,description:["Unlocks a new automation upgrade","Makes each Workshop Level quadruple Gear production instead of tripling it"]},{id:12,surgeLevel:12,affectedByTsunami:!0,description:["Adequately boosts the effect Lab Level has on RP multiplier"]},{id:13,surgeLevel:13,affectedByTsunami:!0,description:['Activates generator: Passively generates <span style="color:#00e5ff">0.1%</span> of pending Gold every second']},{id:14,surgeLevel:14,affectedByTsunami:!0,description:[`Multiplies DNA value by <span style="color:#00e5ff">${W(c.fromInt(1414e16))}x</span>`,"Unlocks Combo: Collecting Coins increases a Combo which alleviates the exponent effect on larger Coins (beware, Combo decays)","Combo effect is shown in the Coin Counter"]},{id:15,surgeLevel:15,affectedByTsunami:!0,description:['Unspent DNA boosts Coins: <span style="color:#00e5ff">1x</span>']},{id:16,surgeLevel:16,affectedByTsunami:!0,description:['Activates generator: Passively generates <span style="color:#00e5ff">0.1%</span> of pending Magic every second']},{id:17,surgeLevel:17,affectedByTsunami:!0,description:[`Multiplies Magic value by <span style="color:#00e5ff">${W(c.fromInt(1e15))}x</span>`,`Divides Coin value by <span style="color:#00e5ff">${W(c.fromInt(1e5))}x</span>`,`Divides DNA value by <span style="color:#00e5ff">${W(c.fromInt(1e5))}x</span>`,"Halves Wave value (immune to exponent)"]},{id:18,surgeLevel:18,affectedByTsunami:!0,description:[`Multiplies Coin value by <span style="color:#00e5ff">${W(c.fromInt(1e15))}x</span>`,`Divides Magic value by <span style="color:#00e5ff">${W(c.fromInt(1e5))}x</span>`,`Divides DNA value by <span style="color:#00e5ff">${W(c.fromInt(1e5))}x</span>`,"Halves Wave value (immune to exponent)"]},{id:19,surgeLevel:19,description:["Unlocks a new DNA upgrade","Doubles XP value (immune to exponent)"]},{id:20,surgeLevel:20,description:['Unlocks the <span style="color:#FFEB3B">Channel</span> tab',"Unlocks new Lab nodes","Unlocks a new Coin upgrade","Unlocks a new Merchant dialogue","Combo no longer decays"]}],ym=P0.filter(e=>e.affectedByTsunami).map(e=>e.id),B0=e=>`ccc:surge:milestone9:state:${e}`,F0=e=>`ccc:surge:milestone10:state:${e}`,U0=e=>`ccc:surge:milestone14:state:${e}`,D0=e=>`ccc:surge:milestone15:state:${e}`});function G0(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=mt("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(x,j){x.style.position="absolute",x.style.left="50%";let Z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ye=!!o.mpHTML;j==="coin"?(x.style.top="77%",x.style.transform=`translateX(-50%) ${Z}`):oe&&ye?(x.style.top="72.5%",j==="mp"?x.style.transform=`translateX(calc(-100% - 44px)) ${Z}`:x.style.transform=`translateX(44px) ${Z}`):(j==="mp"?x.style.top="66%":j==="xp"&&(x.style.top="72%"),x.style.transform=`translateX(-50%) ${Z}`),x.style.transformOrigin="center center";let ue=x.firstElementChild;ue&&(ue.removeAttribute("hidden"),ue.style.display="flex")}if(o.coinHTML){let x=document.createElement("div");x.innerHTML=o.coinHTML,f(x,"coin"),u.appendChild(x)}if(o.xpHTML){let x=document.createElement("div");x.innerHTML=o.xpHTML,f(x,"xp"),u.appendChild(x)}if(o.mpHTML){let x=document.createElement("div");x.innerHTML=o.mpHTML,f(x,"mp"),u.appendChild(x)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let m=new Image;m.src="img/misc/merchant.webp";let v=!1;m.onload=()=>{v=!0},m.onerror=x=>{console.error("Tsunami: Merchant load failed",x)};let p,h,g=[],y=[],I=0;function E(){g=[],y=[];let x=h*.65,j=x+h*.15,oe=300*(Math.min(p,h)*5e-4),ye=p*.8,ue=ye-oe*.6,ze=ye+oe*.6;for(let gt=0;gt<100;gt++){let mn=Math.random()*p,zn=j+Math.random()*(h-j);y.push({x:mn,y:zn})}let rt=(gt,mn,zn)=>{if(gt>p*.1&&gt<p*.9){let qt=h-x,Tn=x+qt*.15;if(mn>Tn)return!1}else if(zn==="tree"){let qt=h-x,Tn=x+qt*.5;if(mn>Tn)return!1}return!(zn==="tree"&&gt>ue&&gt<ze)},we=(gt,mn,zn,qt,Tn)=>{for(let ni=0;ni<mn;ni++){let Vo,Yo,wr=!1,Ne=0;for(;!wr&&Ne<50;){Tn?Vo=Tn():Vo=Math.random()*p;let w=h,k=Math.random();if(Yo=x+20+k*k*(w-x-20),rt(Vo,Yo,gt)&&(wr=!0,gt==="tree")){for(let O of g)if(O.type==="tree"){let R=O.x-Vo,B=O.y-Yo;if(Math.sqrt(R*R+B*B)<Math.max(p*.08,100)){wr=!1;break}}}Ne++}if(wr){let k=.6+(Yo-x)/(h-x)*.6,O=(zn+Math.random()*qt)*k;g.push({type:gt,x:Vo,y:Yo,scale:O})}}},He=3+Math.floor(Math.random()*3);we("tree",He,.8,.4,()=>Math.random()*(p*.1)),we("tree",He,.8,.4,()=>p*.9+Math.random()*(p*.1));let Wt=5+Math.floor(Math.random()*3);we("tree",Wt,.8,.4,()=>p*.1+Math.random()*(p*.8)),we("rock",20,.6,.4),we("shell",30,.3,.3),g.sort((gt,mn)=>gt.y-mn.y)}let M=a.getContext("2d",{alpha:!1}),N=d.getContext("2d",{alpha:!0});function G(){let x=window.devicePixelRatio||1;p=window.innerWidth,h=window.innerHeight,a.width=p*x,a.height=h*x,a.style.width=p+"px",a.style.height=h+"px",d.width=p*x,d.height=h*x,d.style.width=p+"px",d.style.height=h+"px",M.scale(x,x),N.scale(x,x),E(),I=-50}window.addEventListener("resize",G),G();let P=Date.now(),$=!0,L,F=!1,T={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},C={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},z=!1,Q=[],ae=0,he=!1,Se=0,Oe=5e3,Ae=!1,U=0,K=[],q=6;for(let x=0;x<q;x++)K.push({offset:Math.random()*1e3,speedBase:.001+x*5e-4,amplitudeBase:10+x*5});let X=[],J=400;function le(x,j,Z){return x*(1-Z)+j*Z}function fe(x){let j=parseInt(x.slice(1),16);return{r:j>>16&255,g:j>>8&255,b:j&255}}function _(x,j,Z){let oe=fe(x),ye=fe(j),ue=Math.round(le(oe.r,ye.r,Z)),ze=Math.round(le(oe.g,ye.g,Z)),rt=Math.round(le(oe.b,ye.b,Z));return`rgb(${ue},${ze},${rt})`}function Y(x,j,Z){let oe=[],ye=x,ue=j,ze=20;for(;ue<Z;){let rt=ye+(Math.random()-.5)*60,we=ue+ze+Math.random()*30;oe.push({x1:ye,y1:ue,x2:rt,y2:we}),ye=rt,ue=we}return oe}function ie(x,j,Z,oe,ye,ue){x.beginPath(),x.moveTo(j+ue,Z),x.lineTo(j+oe-ue,Z),x.quadraticCurveTo(j+oe,Z,j+oe,Z+ue),x.lineTo(j+oe,Z+ye-ue),x.quadraticCurveTo(j+oe,Z+ye,j+oe-ue,Z+ye),x.lineTo(j+ue,Z+ye),x.quadraticCurveTo(j,Z+ye,j,Z+ye-ue),x.lineTo(j,Z+ue),x.quadraticCurveTo(j,Z,j+ue,Z),x.closePath()}function de(x,j,Z,oe,ye){x.save(),x.translate(j,Z),x.scale(oe,oe),x.beginPath(),x.moveTo(0,0),x.quadraticCurveTo(10,-40,-5,-80),x.lineTo(5,-80),x.quadraticCurveTo(20,-40,10,0),x.fillStyle=ye.rock,x.fill(),x.translate(0,-80),x.fillStyle=ye.leaf;for(let ue=0;ue<7;ue++)x.save(),x.rotate(ue/7*Math.PI*2-Math.PI/2),x.beginPath(),x.moveTo(0,0),x.quadraticCurveTo(30,-10,60,0),x.quadraticCurveTo(30,10,0,0),x.fill(),x.restore();x.restore()}function H(x,j,Z,oe,ye){x.save(),x.translate(j,Z),x.scale(oe,oe),x.fillStyle=ye.rock,x.beginPath(),x.moveTo(-20,0),x.bezierCurveTo(-20,-15,-10,-25,0,-25),x.bezierCurveTo(10,-25,20,-15,20,0),x.fill(),x.fillStyle="rgba(0,0,0,0.2)",x.beginPath(),x.ellipse(0,0,20,5,0,0,Math.PI*2),x.fill(),x.restore()}function ee(x,j,Z,oe,ye){x.save(),x.translate(j,Z),x.scale(oe,oe),x.fillStyle=ye.shell,x.beginPath(),x.arc(0,0,10,Math.PI,0),x.lineTo(0,0),x.fill(),x.strokeStyle=ye.sandDark,x.lineWidth=1,x.beginPath();for(let ue=1;ue<5;ue++){let ze=Math.PI+ue/5*Math.PI;x.moveTo(0,0),x.lineTo(Math.cos(ze)*10,Math.sin(ze)*10)}x.stroke(),x.restore()}function ge(x,j,Z,oe,ye){x.fillStyle=ye.sandDark,x.fillRect(-50,oe,j+100,Z-oe),x.fillStyle=ye.sandDark,x.save(),x.fillStyle=ye.sandLight,x.globalAlpha=.3,x.beginPath(),x.moveTo(-50,Z+100),x.lineTo(-50,oe),x.bezierCurveTo(j*.3,oe-20,j*.7,oe+20,j+50,oe),x.lineTo(j+50,Z+100),x.fill(),x.globalAlpha=.6;let ue=oe+Z*.05;x.beginPath(),x.moveTo(-50,Z+100),x.lineTo(-50,ue),x.bezierCurveTo(j*.4,ue+40,j*.6,ue-10,j+50,ue+20),x.lineTo(j+50,Z+100),x.fill(),x.globalAlpha=1;let ze=oe+Z*.15;x.beginPath(),x.moveTo(-50,Z+100),x.lineTo(-50,ze),x.bezierCurveTo(j*.2,ze-10,j*.8,ze+30,j+50,ze+10),x.lineTo(j+50,Z+100),x.fill(),x.fillStyle=ye.sandDark,x.globalAlpha=.1,y.forEach(rt=>{x.fillRect(rt.x,rt.y,2,2)}),x.restore()}function Be(x,j,Z,oe=null){let ye=oe||1,ue=!!oe&&oe>5;z&&!ue&&!Ae&&mt("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),Q.push({x:ue?j/2:Math.random()*j,y:ue?Z/2:Math.random()*Z,radius:0,maxRadius:ue?Math.max(j,Z)*1.5:(100+Math.random()*400)*ye,speed:ue?40:(5+Math.random()*15)*ye,opacity:1,hue:225+Math.random()*15,life:1})}function ne(x,j,Z,oe=.5,ye=!0){let ue=.1+oe*.7,ze=Math.floor(1+oe*4);if(ye&&!Ae){for(let rt=0;rt<ze;rt++)if(Q.length<50&&Math.random()<ue){let we=1+oe*2;Be(x,j,Z,we)}}x.save(),x.globalCompositeOperation="lighter";for(let rt=Q.length-1;rt>=0;rt--){let we=Q[rt];if(we.radius+=we.speed,we.opacity-=.015,we.life-=.015,we.opacity<=0||we.radius>we.maxRadius){Q.splice(rt,1);continue}let He=x.createRadialGradient(we.x,we.y,0,we.x,we.y,we.radius),Wt=we.opacity;He.addColorStop(0,`hsla(${we.hue}, 100%, 80%, ${Wt})`),He.addColorStop(.3,`hsla(${we.hue}, 100%, 40%, ${Wt*.9})`),He.addColorStop(.7,`hsla(${we.hue}, 100%, 15%, ${Wt*.6})`),He.addColorStop(1,`hsla(${we.hue}, 100%, 5%, 0)`),x.fillStyle=He,x.beginPath(),x.arc(we.x,we.y,we.radius,0,Math.PI*2),x.fill()}x.restore()}function ve(){if(!$)return;let x=Date.now(),j=x-P;Math.min(j/t,1)>=1&&!F&&(F=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ye=6e3,ue=5e4,ze=5e4,rt=5e3,we=4e4,He=0;j<ye?He=0:j<ue?He=(j-ye)/(ue-ye):He=1;let Wt=0;j>we&&(Wt=Math.max(0,(j-we)/(ue-we))),j>ue&&(Wt=1),Wt>.1&&!i&&(i=mt("sounds/tsu_rumble.ogg",{volume:.8}));let gt={skyTop:_(T.skyTop,C.skyTop,He),skyBottom:_(T.skyBottom,C.skyBottom,He),sun:_(T.sun,C.sun,He),waterDeep:_(T.waterDeep,C.waterDeep,He),waterMid:_(T.waterMid,C.waterMid,He),waterPeak:_(T.waterPeak,C.waterPeak,He),foam:_(T.foam,C.foam,He),sandLight:_(T.sandLight,C.sandLight,He),sandDark:_(T.sandDark,C.sandDark,He),rock:_(T.rock,C.rock,He),leaf:_(T.leaf,C.leaf,He),shell:_(T.shell,C.shell,He)},mn=0,zn=0;if(He>.5||Ae){let Ne=(He-.5)*2*5+Wt*25;U>0&&(Ne+=50),mn=(Math.random()-.5)*Ne,zn=(Math.random()-.5)*Ne}N.clearRect(0,0,p,h),M.save(),M.translate(mn,zn),N.save(),N.translate(mn,zn);let qt=M.createLinearGradient(0,0,0,h);if(qt.addColorStop(0,gt.skyTop),qt.addColorStop(1,gt.skyBottom),M.fillStyle=qt,M.fillRect(-50,-50,p+100,h+100),He<1){let Ne=h*.15+He*50;M.beginPath(),M.arc(p*.7,Ne,40,0,Math.PI*2),M.fillStyle=gt.sun,M.globalAlpha=1-He,M.shadowColor=gt.sun,M.shadowBlur=20,M.fill(),M.globalAlpha=1,M.shadowBlur=0}let Tn=h*.65;if(v&&He<1){M.save();let Ne=Math.min(p,h)*5e-4,w=300*Ne,k=300*Ne,O=p*.8,R=k*.15,B=Tn-k/2+R;M.translate(O,B),M.rotate(.1),M.drawImage(m,-w/2,-k/2,w,k),M.restore()}if(ge(M,p,h,Tn,gt),g.forEach(Ne=>{Ne.type==="tree"?de(M,Ne.x,Ne.y,Ne.scale,gt):Ne.type==="rock"?H(M,Ne.x,Ne.y,Ne.scale,gt):Ne.type==="shell"&&ee(M,Ne.x,Ne.y,Ne.scale,gt)}),He>.3){let Ne=(He-.3)/.7,w=Math.floor(J*Ne);if(N.strokeStyle=`rgba(120, 180, 255, ${.1+Ne*.3})`,N.lineWidth=1+Ne,N.beginPath(),X.length<w)for(let O=0;O<10;O++)X.push({x:Math.random()*p*1.5,y:I,speed:20+Math.random()*20,len:10+Math.random()*20});let k=10+Ne*20;for(let O=0;O<X.length;O++){let R=X[O];R.y+=R.speed,R.x-=k,N.moveTo(R.x,R.y),N.lineTo(R.x-k*.5,R.y+R.len),(R.y>h||R.x<-100)&&(O<w?(R.x=Math.random()*p*1.5,R.y=I):(X.splice(O,1),O--))}N.stroke()}let ni=.3;if(He>ni){let Ne=(He-ni)/(1-ni),w=le(0,h*1.5,Ne*Ne);N.fillStyle=gt.waterDeep,N.beginPath(),N.moveTo(-50,h+100),N.lineTo(-50,h-w*.3),N.bezierCurveTo(p*.3,h-w*.4,p*.6,h-w*1.2,p+50,h-w*.8),N.lineTo(p+50,h+100),N.fill()}let Vo=le(0,h*.5,He),Yo=le(0,h*1.5,Wt*Wt),wr=h*.85-Vo-Yo;if(K.forEach((Ne,w)=>{let k;w===q-1?k=gt.waterPeak:w%2===0?k=gt.waterDeep:k=gt.waterMid,N.fillStyle=k,N.beginPath();let O=Ne.amplitudeBase*(1+He*2+Wt*5),R=.003+He*.005,B=Ne.speedBase*(1+He*5+Wt*10),pe=j*B+Ne.offset,me=w*15*(1-Wt),Le=wr+me;N.moveTo(-50,h+100),N.lineTo(-50,Le);for(let Ce=-50;Ce<=p+50;Ce+=15){let je=Le+Math.sin(Ce*R+pe)*O+Math.cos(Ce*R*2.3+pe)*(O*.5);N.lineTo(Ce,je)}if(N.lineTo(p+50,h+100),N.fill(),w===q-1||He>.6&&w>q-3){N.save(),N.globalAlpha=.1+He*.3,N.fillStyle=gt.foam,N.beginPath();for(let Ce=-50;Ce<=p+50;Ce+=10){let je=Le+Math.sin(Ce*R+pe)*O+Math.cos(Ce*R*2.3+pe)*(O*.5);Math.random()>.5&&(je-=5),Ce===-50?N.moveTo(Ce,je):N.lineTo(Ce,je)}N.lineTo(p+50,h+100),N.lineTo(-50,h+100),N.fill(),N.restore()}}),j<oe){let Ne=1;j>1e3&&(Ne=1-(j-1e3)/(oe-1e3)),N.fillStyle=`rgba(0, 0, 0, ${Ne})`,N.fillRect(-50,-50,p+100,h+100)}if(j>ze){let Ne=Math.min(1,(j-ze)/rt);N.fillStyle=`rgba(0, 0, 0, ${Ne})`,N.fillRect(-50,-50,p+100,h+100)}if(z){let Ne=x-ae,w=12e3,k=0,O=!0;Ne<w?k=Ne/w:(k=1,Ae||(Ae=!0,Be(N,p,h,25),U=60,l||(l=!0,mt("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),he&&(O=!1),ne(N,p,h,k,O)}if(he){let Ne=x-Se,w=Math.min(1,Ne/Oe);N.fillStyle=`rgba(0, 0, 0, ${w})`,N.fillRect(-50,-50,p+100,h+100)}if(U>0){let Ne=U/60,w=Ne*Ne;N.fillStyle=`rgba(255, 255, 255, ${w})`,N.fillRect(-50,-50,p+100,h+100),U--}M.restore(),N.restore(),L=requestAnimationFrame(ve)}function Ue(){$=!1,e.style.cursor="",L&&cancelAnimationFrame(L),window.removeEventListener("resize",G),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function ke(){z=!0,ae=Date.now(),Ae=!1,U=0,s||(s=mt("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Fe(){he=!0,Se=Date.now(),s&&s.stop()}function ce(){e.style.cursor=""}function te(){e.style.cursor="none"}function xe(){s&&(s.stop(),s=null)}return ve(),{cleanup:Ue,triggerBeacons:ke,triggerFinalFade:Fe,showCursor:ce,hideCursor:te,stopHumLoop:xe}}var H0=De(()=>{An()});var Eb={};bt(Eb,{canPerformForgeReset:()=>vb,canPerformInfuseReset:()=>bb,computeForgeGoldFromInputs:()=>ks,computeInfuseMagicFromInputs:()=>Ns,computePendingDnaFromInputs:()=>sb,computePendingForgeGold:()=>yb,computeSurgeWavesFromInputs:()=>ib,getCurrentSurgeLevel:()=>ln,getForgeDebugOverrideState:()=>cb,getInfuseDebugOverrideState:()=>fb,getSurgeBarLevelKey:()=>oa,getSurgeDebugOverrideState:()=>mb,hasDoneExperimentReset:()=>gb,hasDoneForgeReset:()=>Xr,hasDoneInfuseReset:()=>Xt,hasDoneSurgeReset:()=>Bo,initResetPanel:()=>Kp,initResetSystem:()=>Jo,isExperimentUnlocked:()=>zl,isForgeUnlocked:()=>zs,isInfuseUnlocked:()=>of,isSurgeUnlocked:()=>Wr,onForgeUpgradeUnlocked:()=>Km,onInfuseUpgradeUnlocked:()=>jm,onSurgeUpgradeUnlocked:()=>Zm,performForgeReset:()=>Hm,performInfuseReset:()=>Xm,performSurgeReset:()=>Vm,recomputePendingMagic:()=>En,setExperimentResetCompleted:()=>Pm,setForgeDebugOverride:()=>ub,setForgeResetCompleted:()=>Nm,setInfuseDebugOverride:()=>pb,setInfuseResetCompleted:()=>Rm,setInfuseUnlockedForDebug:()=>db,setSurgeResetCompleted:()=>Om,setSurgeUnlockedForDebug:()=>hb,shouldBlockBigCoins:()=>Yl,updateResetPanel:()=>Ge});function xm(e){return!y1.includes(e)}function v1(){mt(p1,{volume:.4})}function b1(){mt(m1,{volume:.45})}function S1(){mt(h1,{volume:.5})}function I1(){mt(g1,{volume:.8})}function Yl(){return tb}function nb(){let e=Gn(),t=A.waves?.value??lt(),n=0n;try{n=Kl(e)}catch{}let o=S.pendingWaves,r=zm(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),tb=i&&!In()}function Xl(){Sm=null}function Ju(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function Qu(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function Im(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Am(e=null){try{let t=Ei(),n=S.pendingGold.clone?.()??S.pendingGold;if(e){let o=e instanceof At?e:At.fromAny(e??1);if(o.isInfinite?.())return At.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=A.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return S.pendingGold}}function x1(){for(;ao.length;){let e=ao.pop();try{e?.()}catch{}}}function bm(){!W0&&typeof xc=="function"&&(W0=xc((e={})=>{e?.key&&e.key!==Re.COINS&&e.key!==Re.WAVES||e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(e?.key===Re.WAVES?(rf(),Ge()):(xn(),En(),qn()))})),!z0&&typeof Pc=="function"&&(z0=Pc((e={})=>{e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(xn(),qn(),$o(),Ge())}))}function km(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=be(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Wl(){try{let e=et();if(e&&e.xpLevel)return e.xpLevel}catch{}return lt()}function ob(e,t){if(!e||typeof e!="object")return lt();let n=be(e);if(!Number.isFinite(n)&&n>0)return At.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return lt();let r=re(o*Math.log10(2)),i=Math.max(0,km(t)),s=Math.max(0,(i-30)/5),l=s<=0?X0():re(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?X0():re(a*Math.log10(1.15)),f=At.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?lt():d}function L1(e,t){if(!e)return lt();let n=be(e);if(!Number.isFinite(n)&&n>0)return At.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let v=be(t);Number.isFinite(v)&&(a=Math.max(0,v-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,m=r+u+f+d;return Number.isFinite(m)?re(m).floorToInteger():At.fromAny("Infinity")}function rb(e,t,n=null){let o=L1(e,t),r=ip(),i;if(n){let s=n instanceof At?n:At.fromAny(n??1);if(s.isInfinite?.())return At.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=A.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function ks(e,t){return ob(e,t)}function Ns(e,t){return rb(e,t)}function ib(e,t,n,o,r){return ab(e,t,n,o,r)}function sb(e,t,n=null){e||(e=lt()),t||(t=lt());let o=.30103,r=0;if(n!==null?!!n:se(9)){let l=ft();o=Math.log10(2+l*.5),r=30*l}if(se(14))if(se(8)){let l=ft(),a=Math.log10(1414e16);r+=a*l}else r+=Math.log10(1414e16);if(se(17))if(se(8)){let l=ft();r-=5*l}else r-=5;if(se(18))if(se(8)){let l=ft();r-=5*l}else r-=5;let s=o.toFixed(18);try{let l=e.mulDecimal(s,18),u=t.div(c.fromInt(20)).mulDecimal(s,18),f=l.add(u);r>0&&(f=f.add(c.fromAny(r)));let d=0;return f.isInfinite()?d=1/0:d=Number(f.toScientific(10)),re(d).floorToInteger()}catch{return lt()}}function ab(e,t,n,o,r){let i=km(e);if(i<201)return lt();let s=(i-201)/35,l=be(t),a=be(n),u=be(o),f=be(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return At.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*Vu),Number.isFinite(a)&&a>13&&(d+=(a-13)*Vu),Number.isFinite(u)&&u>5&&(d+=(u-5)*Vu),Number.isFinite(f)&&f>12&&(d+=(f-12)*Vu);let m=1+d+s;if(se(17)&&(m-=Math.log10(2)),se(18)&&(m-=Math.log10(2)),!Number.isFinite(m))return At.fromAny("Infinity");let v=re(m).floorToInteger();return A.waves?.mult?.applyTo?.(v)??v}function lb(){return Math.max(0,km(Wl()))}function Gn(){if(S.slot!=null)return S.slot;let e=b();return S.slot=e,e}function Nm(e){let t=Gn();if(t!=null){S.hasDoneForgeReset=!!e;try{localStorage.setItem(Lm(t),S.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function Rm(e){let t=Gn();if(t!=null){S.hasDoneInfuseReset=!!e;try{localStorage.setItem(_m(t),S.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function Om(e){let t=Gn();if(t!=null){S.hasDoneSurgeReset=!!e;try{localStorage.setItem(Cm(t),S.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Pm(e){let t=Gn();if(t!=null){S.hasDoneExperimentReset=!!e;try{localStorage.setItem(Tm(t),S.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function nf(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Gl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function cb(e=b()){return nf(e)}function ub(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.forgeDebugOverride!==n){if(S.forgeDebugOverride=n,n==null)try{localStorage.removeItem(Gl(t))}catch{}else try{localStorage.setItem(Gl(t),n?"1":"0")}catch{}ut(Gl(t)),Ju(),Ge()}}function Bm(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Hl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function fb(e=b()){return Bm(e)}function db(e){Fm(e)}function pb(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.infuseDebugOverride!==n){if(S.infuseDebugOverride=n,n==null)try{localStorage.removeItem(Hl(t))}catch{}else try{localStorage.setItem(Hl(t),n?"1":"0")}catch{}ut(Hl(t)),Qu(),Ge()}}function Fm(e){let t=Gn();if(t==null)return;let n=!!e;if(S.infuseUnlocked!==n){S.infuseUnlocked=n;try{localStorage.setItem(ju(t),S.infuseUnlocked?"1":"0")}catch{}ut(ju(t)),Qu()}}function ef(e){let t=Gn();if(t==null)return;let n=!!e;if(S.forgeUnlocked!==n){S.forgeUnlocked=n;try{localStorage.setItem(Ku(t),S.forgeUnlocked?"1":"0")}catch{}ut(Ku(t)),Ju()}}function Um(e=b()){if(e==null)return null;try{let t=localStorage.getItem(eb(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function mb(e=b()){return Um(e)}function hb(e){Dm(e)}function Dm(e){let t=Gn();if(t==null)return;let n=!!e;if(S.surgeUnlocked!==n){S.surgeUnlocked=n;try{localStorage.setItem(Zu(t),S.surgeUnlocked?"1":"0")}catch{}ut(Zu(t)),Im()}}function wm(e){if(e==null){S.forgeUnlocked=!1,S.forgeDebugOverride=null,S.hasDoneForgeReset=!1,S.infuseUnlocked=!1,S.infuseDebugOverride=null,S.hasDoneInfuseReset=!1,S.surgeUnlocked=!1,S.surgeDebugOverride=null,S.hasDoneSurgeReset=!1,S.hasDoneExperimentReset=!1,S.flagsPrimed=!1;return}try{S.forgeUnlocked=localStorage.getItem(Ku(e))==="1"}catch{S.forgeUnlocked=!1}S.forgeDebugOverride=nf(e);try{S.hasDoneForgeReset=localStorage.getItem(Lm(e))==="1"}catch{S.hasDoneForgeReset=!1}try{S.infuseUnlocked=localStorage.getItem(ju(e))==="1"}catch{S.infuseUnlocked=!1}try{S.hasDoneInfuseReset=localStorage.getItem(_m(e))==="1"}catch{S.hasDoneInfuseReset=!1}S.infuseDebugOverride=Bm(e);try{S.surgeUnlocked=localStorage.getItem(Zu(e))==="1"}catch{S.surgeUnlocked=!1}S.surgeDebugOverride=Um(e);try{S.hasDoneSurgeReset=localStorage.getItem(Cm(e))==="1"}catch{S.hasDoneSurgeReset=!1}try{S.hasDoneExperimentReset=localStorage.getItem(Tm(e))==="1"}catch{S.hasDoneExperimentReset=!1}S.flagsPrimed=!0}function Mo(){let e=b();if(e==null){S.flagsPrimed=!1;return}S.slot!==e&&(S.slot=e,Xl(),S.flagsPrimed=!1),S.flagsPrimed||wm(e)}function K0(e){V0!==e&&(x1(),V0=e,e!=null&&(ao.push(kt(Ku(e),{onChange(t){let n=t==="1";S.forgeUnlocked!==n&&(S.forgeUnlocked=n,Ju(),Ge())}})),ao.push(kt(Lm(e),{onChange(t){let n=t==="1";S.hasDoneForgeReset!==n&&(S.hasDoneForgeReset=n,Ge())}})),ao.push(kt(Gl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.forgeDebugOverride!==n&&(S.forgeDebugOverride=n,Ju(),Ge())}})),ao.push(kt(ju(e),{onChange(t){let n=t==="1";S.infuseUnlocked!==n&&(S.infuseUnlocked=n,Qu(),Ge())}})),ao.push(kt(_m(e),{onChange(t){let n=t==="1";S.hasDoneInfuseReset!==n&&(S.hasDoneInfuseReset=n,Ge())}})),ao.push(kt(Hl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.infuseDebugOverride!==n&&(S.infuseDebugOverride=n,Qu(),Ge())}})),ao.push(kt(Zu(e),{onChange(t){let n=t==="1";S.surgeUnlocked!==n&&(S.surgeUnlocked=n,Im(),Ge())}})),ao.push(kt(eb(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.surgeDebugOverride!==n&&(S.surgeDebugOverride=n,Im(),Ge())}})),ao.push(kt(Cm(e),{onChange(t){let n=t==="1";S.hasDoneSurgeReset!==n&&(S.hasDoneSurgeReset=n,Ge())}})),ao.push(kt(Tm(e),{onChange(t){let n=t==="1";S.hasDoneExperimentReset!==n&&(S.hasDoneExperimentReset=n,Ge())}}))))}function _1(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function xn(e=!1){let t=A.coins?.value??lt(),n=Wl(),o=_1(t,n);!e&&Sm===o||(Sm=o,$m()?S.pendingGold=ob(t,n):S.pendingGold=lt(),Ge())}function En(e=null){let t=A.coins?.value??lt(),n=sr();qm()?S.pendingMagic=rb(t,n,e):S.pendingMagic=lt(),qn(),Ge()}function qn(){if(!Wr()){S.pendingWaves=lt(),$o();return}let e=Wl(),t=A.coins?.value??lt(),n=A.gold?.value??lt(),o=A.magic?.value??lt(),r=sr();S.pendingWaves=ab(e,t,n,o,r),Bo()||S.pendingWaves.cmp(At.fromInt(10))>0&&(S.pendingWaves=At.fromInt(10)),$o(),nb()}function $o(){if(!zl()){S.pendingDna=lt();return}let e=.30103,t=0;if(se(9)){let i=ft();e=Math.log10(2+i*.5),t=30*i}if(se(14))if(se(8)){let i=ft(),s=Math.log10(1414e4);t+=s*i}else t+=Math.log10(1414e4);if(se(17))if(se(8)){let i=ft();t-=5*i}else t-=5;if(se(18))if(se(8)){let i=ft();t-=5*i}else t-=5;let n=e.toFixed(18),o=Qt?Qt():lt(),r=Wl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),S.pendingDna=re(u).floorToInteger()}catch{try{S.pendingDna=lt()}catch{S.pendingDna=lt()}}}function Em(){let e=nf();return e!=null?!!e:S.forgeUnlocked||Nt(Ie.STARTER_COVE,_e.UNLOCK_FORGE)>=1}function $m(){try{let e=Wl();if(e&&typeof e.cmp=="function")return e.cmp(w1)>=0}catch{}return!1}function qm(){try{let e=vt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(E1)>=0}catch{}return!1}function zs(){Mo();let e=nf();return e!=null?!!e:!!S.forgeUnlocked||Em()}function of(){Mo();let e=Bm();return e!=null?!!e:!!S.infuseUnlocked}function Wr(){Mo();let e=Um();return e!=null?!!e:!!S.surgeUnlocked}function zl(){return $y()}function ln(){let e=Gn();return e==null?0n:Kl(e)}function Xr(){return Mo(),!!S.hasDoneForgeReset}function Xt(){return Mo(),!!S.hasDoneInfuseReset}function Bo(){return Mo(),!!S.hasDoneSurgeReset}function gb(){return Mo(),!!S.hasDoneExperimentReset}function yb(){return xn(),S.pendingGold.clone?.()??S.pendingGold}function vb(){return!(!zs()||!$m()||S.pendingGold.isZero?.())}function bb(){return!(!of()||!qm()||S.pendingMagic.isZero?.())}function C1({resetGold:e=!1,resetMagic:t=!1}={}){let n=Tt(Ie.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===_e.UNLOCK_XP||r===_e.UNLOCK_FORGE||r===_e.UNLOCK_INFUSE||r===_e.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||mr(Ie.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Gm({resetGold:e=!1,resetMagic:t=!1}={}){try{A.coins.set(0)}catch{}try{A.books.set(0)}catch{}try{fs({keepUnlock:!0})}catch{}try{gm()}catch{}C1({resetGold:e,resetMagic:t})}function Hm(){if(!vb())return!1;let e=Am();try{A.gold?.add&&A.gold.add(e)}catch{}if(Gm({resetGold:!1}),xn(),ef(!0),S.hasDoneForgeReset||Nm(!0),on(),Yr(),xm("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return Ge(),!0}function Xm(){if(!bb())return!1;let e=S.pendingMagic.clone?.()??S.pendingMagic;try{A.magic?.add&&A.magic.add(e)}catch{}Gm({resetGold:!0});try{A.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),on({forceReload:!0})}catch{}if(xn(),En(),xm("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return Fm(!0),S.hasDoneInfuseReset||Rm(!0),Ge(),!0}function tf(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Gn();try{A.waves?.add&&e&&!e.isZero?.()&&A.waves.add(e)}catch{}Gm({resetGold:!0,resetMagic:!0});try{A.gold.set(0)}catch{}try{A.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),on({forceReload:!0})}catch{}if(rf(),Dm(!0),S.hasDoneSurgeReset||Om(!0),xn(),En(),qn(),t&&(n||S1(),n||A1()),xm("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}Ge()}function Sb(){if(!zl()||(Qt?Qt():lt()).cmp(10)<0)return!1;let t=S.pendingDna.clone?.()??S.pendingDna;try{A.DNA?.add&&A.DNA.add(t)}catch{}return tf(lt(),{playEffects:!1}),I1(),qy([4]),S.hasDoneExperimentReset||Pm(!0),xn(),En(),qn(),$o(),Ge(),!0}function M1(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{y0(!0)}catch{}try{Mu()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,ir(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=G0(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),o0(e,()=>{setTimeout(T1,0)},i)},r);zu=i.cleanup}function T1(){zu&&(zu(),zu=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),tf(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function Vm(){if(!Wr()||lb()<201)return!1;let e=S.pendingWaves.clone?.()??S.pendingWaves;if(e.isZero?.())return!1;let t=Gn(),n=A.waves?.value??lt(),o=Kl(t),r=zm(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!In()?(M1(),tf(e,{playEffects:!1}),!0):(tf(e,{playEffects:!0}),!0)}function A1(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function Kl(e){let t=0n;try{let n=localStorage.getItem(Mm(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function k1(e){let t=Mm(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function j0(e){if(!(e instanceof At)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function Ib(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=j0(n),l=j0(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function rf(){let e=Gn();if(e==null||!Wr()||vm||k1(e))return;let t=A.waves?.value??lt(),n=Kl(e);if(n===1/0)return;let o=Ib(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Mm(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}vm=!0;try{A.waves.set(o.remainingWaves)}finally{vm=!1}Ge(),o.safety>=100&&setTimeout(rf,0)}nb()}function ql(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=At.fromInt(e)}catch{}try{return W(t)}catch{return e?.toString?.()??"0"}}function N1(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),m=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${m.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let m="";for(let v=0;v<=r;v++){let p=v/r,h=a+p*(u-a),g=h/(Math.PI*2)*120,y=50+30*Math.sin(h+d);m+=(v===0?"M":"L")+` ${g.toFixed(1)} ${y.toFixed(1)}`}return`<path d="${m}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function R1(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${c1}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${u1}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${f1}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${d1}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Z0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${J0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Wu}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${Qe?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Q0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,S.panel=e,S.elements.forge.card=e.querySelector("#reset-card-forge"),S.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),S.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),S.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),S.elements.infuse.card=e.querySelector("#reset-card-infuse"),S.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),S.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),S.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),S.elements.surge.card=e.querySelector("#reset-card-surge"),S.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),S.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),S.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),S.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),S.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),S.elements.surge.headerVal=e.querySelector("[data-surge-level]"),S.elements.surge.header=e.querySelector(".surge-header"),S.elements.experiment.card=e.querySelector("#reset-card-experiment"),S.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),S.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");if(S.elements.surge.milestones&&t&&Us(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),typeof IntersectionObserver<"u"){let o=new IntersectionObserver(r=>{r.forEach(i=>{let s=i.target,l=i.isIntersecting;s===S.elements.forge.card?(S.visible.forge=l,l&&Ym()):s===S.elements.infuse.card?(S.visible.infuse=l,l&&Wm()):s===S.elements.surge.card?(S.visible.surge=l,l&&Vl()):s===S.elements.experiment.card?(S.visible.experiment=l,l&&wb()):s===S.elements.surge.milestones&&(S.visible.surgeMilestones=l,l&&Vl())})},{threshold:0});S.elements.forge.card&&o.observe(S.elements.forge.card),S.elements.infuse.card&&o.observe(S.elements.infuse.card),S.elements.surge.card&&o.observe(S.elements.surge.card),S.elements.experiment.card&&o.observe(S.elements.experiment.card),S.elements.surge.milestones&&o.observe(S.elements.surge.milestones)}else S.visible.forge=!0,S.visible.infuse=!0,S.visible.surge=!0,S.visible.experiment=!0,S.visible.surgeMilestones=!0;S.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(S.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&go(r))return;let a=S.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),S.elements.forge.btn&&S.elements.forge.btn.addEventListener("click",()=>{Hm()&&(v1(),Ge())}),S.elements.infuse.btn&&S.elements.infuse.btn.addEventListener("click",()=>{Xm()&&(b1(),Ge())}),S.elements.surge.btn&&S.elements.surge.btn.addEventListener("click",()=>{Vm()&&Ge()}),S.elements.experiment.btn&&S.elements.experiment.btn.addEventListener("click",()=>{Sb()&&Ge()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=N1();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{Bs("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}Ge()}function Kp(e){!e||e.__resetInit||(e.__resetInit=!0,R1(e))}function qo(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=ql(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function Ym({goldMult:e=null}={}){let t=S.elements.forge;if(!(!t.card||!t.btn)){if(!zs()){if(!S.visible.forge)return;qo(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(S.visible.forge){if(Mo(),t.card.classList.toggle("is-forge-complete",!!S.hasDoneForgeReset),t.status)if(S.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!$m()){qo(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}qo(t.btn,{disabled:!1},Z0,Am(e))}}}function Wm(){let e=S.elements.infuse;if(!(!e.card||!e.btn)){if(!of()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="none"&&(S.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="flex"&&(S.layerButtons.infuse.style.display="flex"),!!S.visible.infuse){if(Mo(),e.card.classList.toggle("is-complete",!!S.hasDoneInfuseReset),e.status)if(S.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!qm()){qo(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}qo(e.btn,{disabled:!1},J0,S.pendingMagic)}}}function zm(e,t,n){let o=t.add(n);return Ib(e,o).level}function Vl(){let e=S.elements.surge;if(!e.card||!e.btn)return;if(!Wr()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="none"&&(S.layerButtons.surge.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="flex"&&(S.layerButtons.surge.style.display="flex"),!S.visible.surge)return;Mo();let t=Gn(),n=A.waves?.value??lt(),o=0n;try{o=Kl(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':ql(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=S.pendingWaves;if(u&&!u.isZero?.()){let f=zm(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let m=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':ql(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${m}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${Wu}">${ql(n)} / <img src="${Wu}">${ql(r)}</span>`),e.milestones&&S.visible.surgeMilestones){let s=$0(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",m=a.description.map(M=>M.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${M}</div>`:`<div>- ${M}</div>`).join("");if(f&&a.surgeLevel===3){let M=Fr?Fr():At.fromInt(0);m+=`<div style="color:#02e815">- Current Books/sec: ${W(M.floorToInteger())}</div>`}if(f&&a.surgeLevel===6){let M=cu();m=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Te(M.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Te(M.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Te(M.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Te(M.magic)}x</span></div>`}if(f&&a.surgeLevel===13){let G=2*(ft()*1.5-.5)-2,P=re(G),L=Am().mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Gold/sec: ${W(L.floorToInteger())}</div>`}if(f&&a.surgeLevel===16){let G=2*(ft()*1.5-.5)-2,P=re(G),$=S.pendingMagic.mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Magic/sec: ${W($.floorToInteger())}</div>`}let v=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(v=!0);let p=ft(),h=!1;f&&v&&p<1&&ym.includes(a.id)&&(h=!0);let g=h?" is-nerfed":"",y=l[u];if(!y)y=document.createElement("div"),y.className=`surge-milestone-item ${d}${g}`,y.dataset.isReached=String(f),y.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(y);else{y.className!==`surge-milestone-item ${d}${g}`&&(y.className=`surge-milestone-item ${d}${g}`);let M=String(f);y.dataset.isReached!==M&&(y.dataset.isReached=M)}let I=y.querySelector(".surge-milestone-desc");I&&I.innerHTML!==m&&(I.innerHTML=m);let E=y.querySelector(".surge-milestone-nerf-arrow");if(E){let M=!1;v&&p<1&&ym.includes(a.id)&&(M=!0);let N=M?"":"none";E.style.display!==N&&(E.style.display=N)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();requestAnimationFrame(()=>{e.milestones&&e.milestones.__customScroll&&typeof e.milestones.__customScroll.update=="function"&&e.milestones.__customScroll.update()}),S.lastRenderedSurgeLevel!==o&&(S.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!S.hasDoneSurgeReset),e.status)if(S.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(lb()<201){qo(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(S.pendingWaves.isZero?.()){qo(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}qo(e.btn,{disabled:!1},Wu,S.pendingWaves)}function wb(){let e=S.elements.experiment;if(!e.card||!e.btn)return;if(!zl()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="none"&&(S.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="flex"&&(S.layerButtons.experiment.style.display="flex"),!S.visible.experiment)return;if(Mo(),e.card.classList.toggle("is-complete",!!S.hasDoneExperimentReset),e.status)if(S.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((Qt?Qt():lt()).cmp(10)<0){qo(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}qo(e.btn,{disabled:!1},Q0,S.pendingDna)}function Ge({goldMult:e=null}={}){S.panel&&(Ym({goldMult:e}),Wm(),Vl(),wb())}function Km(){Jo(),ef(!0),Ge()}function jm(){Jo(),Fm(!0),Ge()}function Zm(){Jo(),Dm(!0),Ge()}function O1(){if(!S.panel)return;let e=S.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!S.panel.classList.contains("is-active")||!S.elements.surge.barFill)return;let t=S.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Vl(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Vl()},{once:!0}))}function P1(){typeof window>"u"||(window.addEventListener("menu:scrollStop",()=>{Ge()}),window.addEventListener("surge:level:change",()=>{O1()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(xn(),En(),qn()),e.detail?.key==="waves"&&(rf(),Ge()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(qn(),Ge())}),window.addEventListener("surge:bookResidue",()=>{if(S.panel&&S.panel.offsetParent!==null){let e=S.elements.surge.card;e&&e.style.display!=="none"&&Ge()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Re.GOLD){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;xn(!0);let n=t.mult instanceof c?t.mult:At.fromAny(t.mult??1);S.panel&&Ym({goldMult:n});return}if(t.key===Re.MAGIC){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;let n=t.mult instanceof c?t.mult:At.fromAny(t.mult??1);En(n),S.panel&&Wm();return}}}),window.addEventListener("xp:change",()=>{xn(),qn(),$o(),Ge()}),window.addEventListener("mutation:change",()=>{En(),qn(),Ge()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&S.slot!=null&&e.detail.slot!==S.slot||(Xl(),xn(!0),En(),qn(),$o(),Ge())}),window.addEventListener("lab:level:change",()=>{$o(),Ge()}),window.addEventListener("lab:node:change",()=>{En(),Ge()}))}function Jo(){if(Y0){S.slot=b(),Xl(),bm(),xn(!0),En(),qn(),$o();return}try{on()}catch{return}Y0=!0;let e=b();if(S.slot=e,Xl(),wm(e),S.hasDoneForgeReset&&!Do())try{Yr()}catch{}if(!S.forgeUnlocked&&Em()&&ef(!0),K0(e),bm(),P1(),xn(!0),En(),qn(),$o(),Yu){try{Yu()}catch{}Yu=null}Yu=Fi(()=>{let t=Jm();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(S.slot=t,Xl(),wm(t),S.hasDoneForgeReset&&!Do())try{Yr()}catch{}!S.forgeUnlocked&&Em()&&ef(!0),K0(t),bm(),xn(!0),En(),qn(),$o(),Ge()})}var At,Vu,lt,X0,Z0,J0,Q0,c1,u1,f1,d1,Wu,p1,m1,h1,g1,y1,Ku,Lm,Gl,ju,_m,Hl,Zu,eb,Cm,oa,Mm,Tm,w1,E1,vm,tb,S,ao,V0,Y0,Yu,Sm,W0,z0,zu,vo=De(()=>{Et();Io();St();Gt();bn();no();bo();hs();cl();q0();Rr();An();Sn();nr();Si();Ws();_l();H0();At=c,Vu=Math.log10(1.1),lt=()=>At.fromInt(0),X0=()=>At.fromInt(1),Z0="img/currencies/gold/gold.webp",J0="img/currencies/magic/magic.webp",Q0="img/currencies/dna/dna.webp",c1="img/misc/forge.webp",u1="img/misc/infuse.webp",f1="img/misc/surge.webp",d1="img/misc/experiment.webp",Wu="img/currencies/wave/wave.webp",p1="sounds/forge_reset.ogg",m1="sounds/infuse_reset.ogg",h1="sounds/surge_reset.ogg",g1="sounds/experiment_reset.ogg",y1=[];Ku=e=>`ccc:reset:forge:${e}`,Lm=e=>`ccc:reset:forge:completed:${e}`,Gl=e=>`ccc:debug:forgeUnlocked:${e}`,ju=e=>`ccc:reset:infuse:${e}`,_m=e=>`ccc:reset:infuse:completed:${e}`,Hl=e=>`ccc:debug:infuseUnlocked:${e}`,Zu=e=>`ccc:reset:surge:${e}`,eb=e=>`ccc:debug:surgeUnlocked:${e}`,Cm=e=>`ccc:reset:surge:completed:${e}`,oa=e=>`ccc:reset:surge:barLevel:${e}`,Mm=oa,Tm=e=>`ccc:reset:experiment:completed:${e}`,w1=At.fromInt(31),E1=At.fromInt(7),vm=!1,tb=!1;S={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:lt(),pendingMagic:lt(),pendingWaves:lt(),pendingDna:lt(),panel:null,visible:{forge:!1,infuse:!1,surge:!1,experiment:!1,surgeMilestones:!1},elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},ao=[],V0=null,Y0=!1,Yu=null,Sm=null,W0=null,z0=null;zu=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Jo,performForgeReset:Hm,performInfuseReset:Xm,performSurgeReset:Vm,performExperimentReset:Sb,computePendingForgeGold:yb,computeForgeGoldFromInputs:ks,computeInfuseMagicFromInputs:Ns,computeSurgeWavesFromInputs:ib,computePendingDnaFromInputs:sb,getForgeDebugOverrideState:cb,hasDoneForgeReset:Xr,isForgeUnlocked:zs,setForgeDebugOverride:ub,setForgeResetCompleted:Nm,updateResetPanel:Ge,isInfuseUnlocked:of,setInfuseDebugOverride:pb,getInfuseDebugOverrideState:fb,recomputePendingMagic:En,setInfuseUnlockedForDebug:db,setInfuseResetCompleted:Rm,hasDoneInfuseReset:Xt,isSurgeUnlocked:Wr,setSurgeUnlockedForDebug:hb,getSurgeDebugOverrideState:mb,setSurgeResetCompleted:Om,hasDoneSurgeReset:Bo,getCurrentSurgeLevel:ln,shouldBlockBigCoins:Yl,hasDoneExperimentReset:gb,setExperimentResetCompleted:Pm,isExperimentUnlocked:zl}))});var zb={};bt(zb,{AREA_KEYS:()=>Ie,HM_EVOLUTION_INTERVAL:()=>Yt,MAX_LEVEL_DELTA:()=>da,REGISTRY:()=>wf,UPGRADE_TIES:()=>_e,approxLog10BigNum:()=>be,batchUpgradeOperations:()=>Zl,bigNumFromLog10:()=>re,buyCheap:()=>Rl,buyMax:()=>Nl,buyOne:()=>Ks,buyTowards:()=>js,clearPermanentUpgradeUnlock:()=>yh,computeDefaultUpgradeCost:()=>vh,computeHmMultipliers:()=>Qo,computeUpgradeEffects:()=>bs,costToBuyOne:()=>iL,ensureLevelBigNum:()=>yt,estimateFlatBulk:()=>uh,estimateGeometricBulk:()=>eL,evaluateBulkPurchase:()=>Ni,evolveUpgrade:()=>Ou,formatMultForUi:()=>Te,getCurrentAreaKey:()=>io,getHmEvolutions:()=>ph,getHmNextMilestoneLevel:()=>sL,getIconUrl:()=>Bu,getLevel:()=>Pn,getLevelNumber:()=>Nt,getMagnetLevel:()=>zc,getMpValueMultiplierBn:()=>Wc,getUpgrade:()=>ga,getUpgradeLockState:()=>Fo,getUpgradeStorageKey:()=>Di,getUpgradesForArea:()=>Tt,levelBigNumToNumber:()=>Ye,log10OnePlusPow10:()=>td,markUpgradePermanentlyUnlocked:()=>Ui,normalizeBigNum:()=>aL,normalizeUpgradeIconPath:()=>Pu,normalizedUpgradeLevel:()=>pf,onUpgradesChanged:()=>Hd,peekNextPrice:()=>Wb,performFreeAutobuy:()=>op,safeMultiplyBigNum:()=>It,setLevel:()=>mr,syncBookCurrencyMultiplierFromUpgrade:()=>ol,upgradeUiModel:()=>Zs});function sf(){zr.size!==0&&(zr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{ut(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),zr.clear())}function F1(){if(!(typeof window>"u")&&!Lb){Lb=setInterval(sf,2e3);try{window.addEventListener("beforeunload",sf)}catch{}try{window.addEventListener("pagehide",sf)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&sf()})}catch{}}}function Zl(e){if(sa)return e();sa=!0;try{return e()}finally{sa=!1,jl.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{la(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),jl.clear(),xb.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{rL(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),xb.clear(),rh&&(rh=!1,uo())}}function U1(e){try{let t=ha(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function Mb(e,t){if(!U1(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=be(n);return Number.isFinite(o)&&o>=D1}catch{return!1}}function aa(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>Qm)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>Qm/2||i.length>Qm/2)return"Infinity"}return n}function lf(e){return V1[e]??0}function eh(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function pa(e,t){let n=yr(e||t?.area);if(!n)return null;let o=vr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=co(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function Jl(e,t){let n=yr(e||t?.area);if(!n)return null;let o=co(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function ra(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function ah(e=b()){let t=String(e??"default");if(uf.has(t))return uf.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${kb}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),uf.set(t,n),n}function lh(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),uf.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${kb}:${n}`,JSON.stringify(e))}catch{}}function bf(e=b()){let t=String(e??"default");if(ff.has(t))return ff.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Nb}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),ff.set(t,n),n}function Sf(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),ff.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Nb}:${n}`,JSON.stringify(e))}catch{}}function hh(e=b()){let t=String(e??"default");if(df.has(t))return df.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Rb}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),df.set(t,n),n}function gh(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),df.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Rb}:${n}`,JSON.stringify(e))}catch{}}function ch(e,t,n=b()){let o=pa(e,t);if(!o)return;let r=Jl(e,t),i=hh(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],gh(i,n))}function Ob(e,t,n=b()){let o=pa(e,t);if(!o)return!1;let r=Jl(e,t),i=hh(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],gh(i,n),!0):!1}function Ui(e,t,n=b()){let o=pa(e,t);if(!o)return;let r=Jl(e,t),i=bf(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Sf(i,n))}function yh(e,t,n=b()){let o=pa(e,t);if(!o)return;let r=bf(n);r.upgrades[o]&&(delete r.upgrades[o],Sf(r,n));let i=ah(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},lh(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&br(e,s,n),uo()}function gf(e,t,n=b()){let o=pa(e,t);if(!o)return!1;let r=Jl(e,t),i=bf(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Sf(i,n),!0):!1}function Ln(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=vr(t?.tie??t?.tieKey),o=e?.areaKey||Ie.STARTER_COVE;if(!n||!q1.has(n))return{locked:!0,iconOverride:Hn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?Nt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:Pb()}catch{}function s(){if(Bb())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:Cn,titleOverride:fn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===_e.UNLOCK_XP)return s();if(n===_e.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Hn,useLockedBase:!0};let a=!1;try{let u=Mn();a=Ye(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:Cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:fn,descOverride:u,reason:u}}return{locked:!1}}if(n===_e.UNLOCK_INFUSE){if(!Xr())return{locked:!0,iconOverride:Hn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:lo,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=Mn();a=Ye(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:Cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:fn,descOverride:u,reason:u}}return{locked:!1}}if(n===_e.UNLOCK_SURGE){if(!Xt())return{locked:!0,iconOverride:Hn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:lo,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=Mn();a=Ye(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:Cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:fn,descOverride:u,reason:u}}return{locked:!1}}if(mh.has(n)){if(Xt()||gf(o,t)){try{Ui(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=Mn();a=Ye(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:Hn,useLockedBase:!0,titleOverride:lo,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{ch(o,t)}catch{}return{locked:!0,iconOverride:Cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:fn,descOverride:u,reason:u}}if(Xr()||gf(o,t)){try{Ui(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Hn,useLockedBase:!0};if(Ob(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:fn,descOverride:a,reason:a}}let l=!1;try{let a=Mn();l=Ye(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Hn,useLockedBase:!0,titleOverride:lo,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{ch(o,t)}catch{}return{locked:!0,iconOverride:Cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function yr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function vr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function Y1(e,t){let n=vr(t?.tie??t?.tieKey);if(n&&G1.has(n))return!0;let o=co(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=yr(l);if(a&&H1.has(`${a}:${i}`))return!0}return!1}function Pb(){try{return!!vn()}catch{return!1}}function Bb(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${X1}:${t}`)==="1"}catch{return!1}}function Mn(){try{let e=typeof et=="function"?et():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function pf(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function th(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function co(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function yt(e){try{if(e=aa(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return re(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=be(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Ye(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=be(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=be(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function W1(e,t){let n=yt(e),o=yt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(be(n))+1,i=Math.floor(be(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function Fb(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function ma(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function yf(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:ma(e.numUpgEvolutions)}function vh(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Ye(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/Yt));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=qb(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:be(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:Fb(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,_n(i,r)}function Ub(e){let t=ma(e),n=Yt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Kr(o),capFmtText:ua(o)}}function Db(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(be(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Ye(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Yt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Yt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Ye(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Yt)+1)}}function K1(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function bh(e,t=hf){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=yr(t||e?.area||hf);return $1[n]||Tb}function It(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function If(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=Ub(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Qo(e,t,n=hf){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=bh(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=Db(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=K1(u.multiplier??u.mult??u.value??1,f),m=`${u.target??u.type??"self"}`.toLowerCase();m==="xp"?i=It(i,d):m==="coin"||m==="coins"?s=It(s,d):m==="mp"?l=It(l,d):r=It(r,d)}let a=yf(e);if(a>0){let u=B1*a,f=re(u);r=It(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function $b(e,t,n=hf){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=bh(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=Db(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt(Yt)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny(Yt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Yt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Yt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function qb(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=z1[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function ha(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=qb(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=Fb(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=be(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),m=c.fromAny(e.costAtLevel?.(1)??0),v=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(m)===0&&d.cmp(v)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function _n(e,t){let n=ha(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=re(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return re(n.baseLog10+o*n.ratioLog10).floorToInteger()}function j1(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function hr(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=ha(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*cf+t*o.ratioLn)/cf;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*cf+t*o.ratioLn,i=o.ratioLn*n,s=j1(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/cf}function mf(e,t,n){if(!(n>0))return c.fromInt(0);let o=ha(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=hr(e,t,l);a=a.add(re(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=hr(e,t,n);return re(i)}function Hb(e){if(!(e>0)||!Number.isFinite(e))return e;if(oh[0]=e,oh[0]<=0)return 0;Z1[0]-=1n;let t=oh[0];return t>0?t:0}function J1(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=Hb(e);return n<e?n:e>1?e/2:0}function ia(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function ca(e,t,n,o=da,r={}){let i=ha(e),s=c.fromInt(0),l=r||{},a=!!l.fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Ye(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:Ye(o),m=Number.isFinite(f)?Math.max(0,f-u):nh,v=Number.isFinite(d)?Math.max(0,Math.floor(d)):nh;if(v=Math.min(v,nh,m),!(v>0)){let K=m<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:K,numericCount:0}}let p=100-u;if(Number.isFinite(u)&&p>0){let K=Math.min(v,p);if(l.fastOnly&&i&&Number.isFinite(i.ratioLog10)&&Number.isFinite(i.baseLog10)){let ge=be(n),Be=u+K,ne=i.baseLog10+Be*i.ratioLog10;if(ge>ne+5){let ve=ia(K),Ue=u+K,ke=ca(e,Ue,n,v-K,r),Fe=ke?.count instanceof c?ke.count:ia(ke?.numericCount??0);return{count:ve.add(Fe),spent:s,nextPrice:ke?.nextPrice??s,numericCount:K+(ke?.numericCount??0)}}}let q=c.fromAny(e.costAtLevel(u)),X=s,J=0;for(;J<K;){q=c.fromAny(e.costAtLevel(u+J));let ge=X.add(q);if(ge.cmp(n)>0)break;X=ge,J+=1}let le=u+J,fe=Number.isFinite(f)&&le>=f,_=ia(J);if(J<K||fe||v<=J){let ge=fe?s:c.fromAny(e.costAtLevel(le));return{count:_,spent:X,nextPrice:ge,numericCount:J}}let Y=(()=>{try{return gr(t??u,u).add(_)}catch{return u+J}})(),ie=ca(e,Y,n.sub(X),v-J,r),de=ie?.count instanceof c?ie.count:ia(ie?.numericCount??0),H=_.add(de),ee=(ie?.spent??s).add(X);return{count:H,spent:ee,nextPrice:ie?.nextPrice??s,numericCount:J+(ie?.numericCount??0)}}let h=be(n),g=i.ratioLog10,y=i.ratioMinus1,I=c.fromAny(e.costAtLevel(u)),E=i.baseLog10+u*g;if(y>0&&(!Number.isFinite(h)||Math.abs(h)>1e6&&Math.abs(E)>1e6)){let K=c.fromAny(e.costAtLevel(u));if(n.cmp(K)<0)return{count:s,spent:s,nextPrice:K,numericCount:0};let q=Number.isFinite(v)?Math.max(1,Math.floor(v)):Number.MAX_VALUE,X=1,J=1;for(;J<q;){let de=hr(e,u,J);if(re(de).cmp(n)<=0){let ee=J*2;if(!Number.isFinite(ee)||ee<=J){J=q;break}X=J,J=Math.min(ee,q)}else break}let le=0;for(;X<J&&le<256;){let de=Math.max(X+1,Math.floor((X+J+1)/2)),H=hr(e,u,de);re(H).cmp(n)<=0?X=de:J=de-1,le++}let fe=Math.max(1,X),_=ia(fe),Y=s,ie=s;if(!a)if(Y=mf(e,u,fe),Number.isFinite(f)){let de=Math.max(0,Math.floor(f-Math.min(u,f)));fe>=de?ie=s:ie=re(E+fe*g)}else ie=re(E+fe*g);return{count:_,spent:Y,nextPrice:ie,numericCount:fe}}if(n.cmp(I)<0)return{count:s,spent:s,nextPrice:I,numericCount:0};let N=!1,G=null,P=null;try{G=c.fromAny(e.costAtLevel(u+1))}catch{}try{let K=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);P=c.fromAny(e.costAtLevel(K))}catch{}!N&&!(i.ratioMinus1>0)&&(N=!0),G&&P&&(N=G.cmp(I)===0&&P.cmp(I)===0),!N&&!(i.ratioMinus1>0)&&(N=!0);let $=Number.isFinite(v)?Math.max(0,Math.floor(v)):Number.MAX_VALUE;if(N){let K=gr(e.lvlCapBn??"Infinity","Infinity"),q=gr(t??0,0),X=K.isInfinite?.()?c.fromAny("Infinity"):K.sub(q).floorToInteger(),{count:J,countBn:le,spent:fe,nextPrice:_}=uh(I,n,X);return{count:le,spent:fe,nextPrice:_,numericCount:J}}if(!(g>0)||!(y>0)){let K=gr(e.lvlCapBn??"Infinity","Infinity"),q=gr(t??0,0),X=K.isInfinite?.()?c.fromAny("Infinity"):K.sub(q).floorToInteger(),{count:J,countBn:le,spent:fe,nextPrice:_}=uh(I,n,X);return{count:le,spent:fe,nextPrice:_,numericCount:J}}let L=Math.log10(y);if(!Number.isFinite(L))return{count:s,spent:s,nextPrice:I,numericCount:0};let T=td(h+L-E)/g;(!Number.isFinite(T)||T<0)&&(T=0);let C=Math.floor(Math.min($,T));Number.isFinite(C)||(C=$),C<=0&&(C=1);let z=1e-7,Q=hr(e,u,C),ae=0,he=2048;for(;C>0&&(!Number.isFinite(Q)||Q>h+z)&&ae<he;){let K=Number.isFinite(Q)?Math.max(1,Math.ceil((Q-h)/Math.max(g,1e-12))):Math.max(1,Math.floor(C/2)),q=Math.max(0,Math.floor(C-K));if(q<C)C=q;else{let X=Hb(C);if(!(X<C))break;C=X}Q=C>0?hr(e,u,C):Number.NEGATIVE_INFINITY,ae+=1}if(C<=0||!Number.isFinite(C))if(n.cmp(I)>=0)C=1,Q=be(I);else return{count:s,spent:s,nextPrice:I,numericCount:0};if(C<$){let K=_=>{let Y=_*2;return Number.isFinite(Y)?Y:Number.MAX_VALUE},q=C,X=Math.min($,Math.max(C+1,K(C))),J=hr(e,u,X);for(;q<X&&Number.isFinite(J)&&J<=h+z&&X<$;)q=X,X=Math.min($,K(X)),J=hr(e,u,X);let le=q,fe=X;for(let _=0;_<256&&le<fe;_+=1){let Y=Math.floor((le+fe+1)/2),ie=hr(e,u,Y);Number.isFinite(ie)&&ie<=h+z?(le=Y,Q=ie):fe=Y-1}C=le}let Se=null;if(!a){Se=mf(e,u,C);let K=0;for(;Se.cmp(n)>0&&C>0&&K<he;){let q=J1(C);if(!(q<C))break;C=q,Se=mf(e,u,C),K+=1}if(C<=0)return{count:s,spent:s,nextPrice:I,numericCount:0};if(C<$&&K<he)for(;C<$&&K<he;){let q=u+C,X;try{if(Number.isFinite(q)&&q<Number.MAX_SAFE_INTEGER/2)X=c.fromAny(e.costAtLevel(q));else{let le=E+C*g;X=re(le).floorToInteger()}}catch{break}let J=Se.add(X);if(J.cmp(n)>0)break;Se=J,C+=1,K+=1}}let Oe=s,Ae=!a&&Number.isFinite(u)&&Number.isFinite(C)&&u<Number.MAX_SAFE_INTEGER/2&&C<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let K=Math.max(0,Math.floor(f-Math.min(u,f)));if(C>=K)Oe=s;else if(Ae){let q=Math.floor(u+C);Oe=c.fromAny(e.costAtLevel(q))}else{let q=E+C*g;Oe=re(q)}}else if(Ae){let K=Math.floor(u+C);Oe=c.fromAny(e.costAtLevel(K))}else{let K=E+C*g;Oe=re(K)}return{count:ia(C),spent:Se,nextPrice:Oe,numericCount:C}}function Q1(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=be(t),r=be(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function uh(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let m=e.mulBigNumInteger(d);return{count:fh(d),countBn:d,spent:m,nextPrice:e}}let i=be(t),s=be(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=re(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:fh(l),countBn:l,spent:a,nextPrice:u}}function eL(e,t,n,o){if(!n||o<=0)return{count:0};let r=be(t),i=be(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let h=0;h<64&&a<u;h+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let m=i+f*n.ratioLog,v=re(d),p=re(m);return{count:f,spent:v,nextPrice:p,spentLog:d,nextPriceLog:m}}function gr(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function fh(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Kr(e){return W(e instanceof c?e:c.fromAny(e??0))}function ua(e){return Kr(e).replace(/<[^>]*>/g,"")}function vf(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function fa(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=vf(n??t??0),s=vf(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Ye(i),newLevel:Number.isFinite(o)?o:Ye(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Dt(e,t){return _n(e,t)}function Xb(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Di(e,t,n=b()){if(n==null)return null;let o=yr(e),r=Sh(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function tL(){_b.forEach(e=>{try{e?.()}catch{}}),_b.clear()}function Cb(e){tL()}function nL(e,t){if(typeof localStorage>"u")return;let n=Xb(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=Di(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}})}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function oL(e,t,n){nL(e,n);let o=Di(e,t,n);if(!o)return null;if(sa&&jl.has(o))try{let r=jl.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(zr.has(o))try{let r=zr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function la(e,t,n,o=b(),r={}){let i=Di(e,t,o);if(i){if(sa){jl.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){zr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}zr.has(i)&&zr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{ut(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function rL(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&la(e,o.id,o,n)})}function Sh(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return co(t.id);let n=co(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=vr(n);if(o){let r=ih.get(o);if(r){let i=yr(e);if(!i||yr(r.area)===i)return co(r.id)}}}return n}function Vb(e,t,n=b()){let o=n==null?"null":String(n),r=Sh(e,t);return`${o}:${e}:${co(r)}`}function To(e,t){let n=Sh(e,t),o=co(n),r=b(),i=Vb(e,o,r),s=dh.get(i);if(s)return s;let l=ga(e,o),a=oL(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,la(e,o,a,r)}let f=a.lvl,d=a.nextCost,m=a.nextCostLvl;a.lvl=aa(a.lvl),a.nextCost=aa(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=aa(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==m)&&(u=!0);let v=0;l?.upgType==="HM"&&(v=ma(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),If(l,v));let p=yt(a.lvl),h=Ye(p);try{let M=l?.lvlCapBn??c.fromAny("Infinity");if(!M.isInfinite?.()&&p.cmp(M)>0){let N=M.clone?.()??M;h=Ye(N);let G=N.toStorage();a.lvl=G,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=G,la(e,o,a,r)}}catch{}let g=null;try{g=p?.toStorage?.()??yt(h).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let y=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,I=!y||y!==g,E=null;if(!E||I){if(l)try{E=c.fromAny(l.costAtLevel(h))}catch{E=c.fromInt(0)}else E=c.fromInt(0);try{a.nextCost=E.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{la(e,o,a,r)}catch{}if(l?.upgType==="HM"&&p?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let M=c.fromAny("Infinity");l.lvlCapBn=M,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Kr(M),l.lvlCapFmtText=ua(M)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:h,lvlBn:p,nextCostBn:E,slot:r,hmEvolutions:v},dh.set(i,s),s}function jr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=co(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??yt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Ye(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??yt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=yt(e.lvl??0).toStorage()}i.lvl=aa(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=aa(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=ma(e.hmEvolutions)),la(n,r,i,o,t),e.slot=o}function br(e,t,n=b()){dh.delete(Vb(e,t,n))}function Nt(e,t){return To(e,t).lvl}function ph(e,t){return To(e,t).hmEvolutions??0}function Yb(e,t){if(!t)return{locked:!1};let n=Pb(),o=n?Mn():c.fromInt(0),r=n?Ye(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=Y1(e,t),d="Unlock the XP system to reveal this upgrade",m=Bb();if(f)if(m)i={locked:!0,iconOverride:Cn,titleOverride:fn,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let v='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Hn,titleOverride:lo,descOverride:v,reason:v,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Hn,titleOverride:lo,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=th({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,surgeLevel:ln(),surgeUnlocked:Wr(),baseLocked:s.locked,getUpgradeLevel(m){return Nt(e,m)}},d=t.computeLockState(f);s=th(s,d)}catch{}let l=b(),a=pa(e,t),u=a?gf(e,t,l):!1;if(a){let f=ah(l),d=bf(l),m=hh(l),v=a.replace(/_/g,"-"),p=Jl(e,t),h=!1;ra(f,v,a)&&(h=!0),p&&ra(f,p,a)&&(h=!0),h&&lh(f,l);let g=!1;ra(d,v,a)&&(g=!0),p&&ra(d,p,a)&&(g=!0),g&&Sf(d,l);let y=!1;ra(m,v,a)&&(y=!0),p&&ra(m,p,a)&&(y=!0),y&&gh(m,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=Hn),f?s.titleOverride||(s.titleOverride=fn):(!s.titleOverride||s.titleOverride===fn)&&(s.titleOverride=lo),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Hn||s.iconOverride===Cn)&&delete s.iconOverride,(s.titleOverride===fn||s.titleOverride===lo)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Hn),a){let f=ah(l),d=f.upgrades[a]||{},m=vr(t?.tie??t?.tieKey),v=m&&Ab.has(m),p=m&&mh.has(m),h=d.status||"locked";if(gf(e,t,l))h="unlocked";else if(Ob(e,t,l)&&h==="locked"){let L=!1;try{L=Ye(Mn())>=31}catch{}let F=!1;try{F=Ye(Mn())>=101}catch{}v&&!L||p&&!F?h="locked":h="mysterious"}let g=lf(h),y=eh(s),I=lf(y),E=()=>{s.locked=!0;let L=d.snapshot;L&&typeof L=="object"&&(s=th(s,L)),s.iconOverride=Cn,s.titleOverride=fn;let F=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=F,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>I&&(h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):h==="mysterious"&&E(),y=eh(s),I=lf(y));let M=!1,N=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",G=v,P=!1;try{P=Ye(Mn())>=31}catch{}let $=!1;try{$=Ye(Mn())>=101}catch{}if((G&&!P&&N==="mysterious"||p&&!$&&N==="mysterious")&&(N="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==N)&&(f.upgrades[a]={status:N},M=!0),I>g){if(d.status=y,f.upgrades[a]={status:d.status},M=!0,h=y,g=I,y==="unlocked")Ui(e,t,l);else if(y==="mysterious"){let L=!1;try{L=Ye(Mn())>=31}catch{}(!v||L)&&ch(e,t,l)}}h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Hn||s.iconOverride===Cn)&&delete s.iconOverride,(s.titleOverride===fn||s.titleOverride===lo)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},M=!0),Ui(e,t,l)):h==="mysterious"&&y!=="mysterious"&&(E(),y=eh(s),I=lf(y)),M&&lh(f,l)}return s}function Ql(e,t){return!!Yb(e,t).locked}function Ih(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:yf(e),{capBn:r,cap:i}=Ub(o);try{return t?.cmp?.(r)>=0}catch{}let s=Ye(t);return Number.isFinite(s)&&s>=i}function Pn(e,t){let n=To(e,t);return n.lvlBn?.clone?n.lvlBn.clone():yt(n.lvl??0)}function Wb(e,t){let n=To(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??yt(n.lvl??0),i=Ye(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function mr(e,t,n,o=!0,r={}){let i=To(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,If(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=vf(i.lvlBn??yt(i.lvl??0)),d=yt(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let m=d;try{s&&Mb(s,m)&&(m=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let p=yt(a);m.cmp(p)>0&&(m=p)}if(o&&Number.isFinite(a)){let p=yt(a);m.cmp(p)>0&&(m=p)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(m)===0)return i.lvl;let v=Ye(m);if(!s)return i.lvl=v,i.lvlBn=m,i.nextCostBn=c.fromInt(0),jr(i),br(e,t),uo(),i.lvl;i.lvl=v,i.lvlBn=m;try{i.nextCostBn=c.fromAny(s.costAtLevel(v))}catch{i.nextCostBn=c.fromInt(0)}return jr(i,{deferSave:r?.deferSave}),br(e,t),fa(s,u,f,i.lvl,i.lvlBn),uo(),i.lvl}function Tt(e){return wf.filter(t=>t.area===e)}function ga(e,t){let n=yr(e),o=co(t),r=vr(typeof o=="string"?o:t);return wf.find(i=>n&&yr(i.area)!==n?!1:!!(co(i.id)===o||r&&i.tieKey===r))||null}function Fo(e,t){let n=typeof t=="object"&&t?t:ga(e,t);return Yb(e,n)}function Pu(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function Bu(e){return e?Pu(e.icon):""}function iL(e,t){let n=ga(e,t),o=Pn(e,t),r=Ye(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Ks(e,t){let n=To(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Ql(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??yt(r),s=vf(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(Mb(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Ye(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),jr(n),br(e,t),uo(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?A[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let v=f.value;if((v instanceof c?v:c.fromAny(v??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let m=i.add(c.fromInt(1));return n.lvlBn=m,n.lvl=Ye(m),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),jr(n),br(e,t),fa(o,r,s,n.lvl,n.lvlBn),uo(),{bought:1,spent:d}}function Ou(e,t){let n=To(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??yt(n.lvl);if(!Ih(o,r,n.hmEvolutions))return{evolved:!1};let i=ma(n.hmEvolutions)+1;n.hmEvolutions=i,If(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return jr(n),br(e,t),fa(o,n.lvl,r,n.lvl,r),uo(),{evolved:!0}}function Nl(e,t){let n=To(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ql(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??yt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=A[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Ks(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let y=i.clone?.()??yt(i),I=Ye(y),E=y.toStorage?.(),M;if(o.upgType==="HM"){if(M=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let G=c.fromAny("Infinity");o.lvlCapBn=G,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Kr(G),o.lvlCapFmtText=ua(G)}}else{let G=o.lvlCapBn?.clone?.()??gr(o.lvlCap??1/0,1/0);M=G?.clone?.()??G}let N=M.sub(y);if(N.isZero?.()){let G=W1(M,y);G.isZero?.()||(N=G)}if(N.isZero?.()){let G=M.toStorage?.();if(E&&G&&E!==G)if(M.isInfinite?.())try{N=c.fromAny("Infinity")}catch{N=c.fromInt(1)}else N=c.fromInt(1)}return n.lvlBn=M.clone?.()??M,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Ye(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),A[o.costType].set(u),jr(n),br(e,t),fa(o,I,y,n.lvl,n.lvlBn),uo(),{bought:N,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):da;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=ca(o,i,u,d),v=m.count instanceof c?m.count:c.fromAny(m.count??0);if(v.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=m.spent??c.fromInt(0),h=u.sub(p);A[o.costType].set(h);let g=i.add(v);return n.lvlBn=g,n.lvl=Ye(g),m.nextPrice?n.nextCostBn=m.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),jr(n),br(e,t),fa(o,r,i,n.lvl,n.lvlBn),uo(),{bought:v,spent:p}}function js(e,t,n){let o=To(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Ql(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??yt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=A[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,m=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Ye(n):void 0,v=Number.isFinite(d)?Number.isFinite(m)?Math.min(d,m):d:m,p=ca(r,s,f,v),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=p.spent??c.fromInt(0),y=f.sub(g);A[r.costType].set(y);let I=s.add(h);return o.lvlBn=I,o.lvl=Ye(I),p.nextPrice?o.nextCostBn=p.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),jr(o),br(e,t),fa(r,i,s,o.lvl,o.lvlBn),uo(),{bought:h,spent:g}}function Ni(e,t,n,o=da,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=ca(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function uo(){if(sa){rh=!0,Gd();return}Gd(),Yc()}function io(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Ie.STARTER_COVE}function Zs(e,t){let n=ga(e,t);if(!n)return null;let o=Pn(e,t),r=Ye(o),i=Kr(o),s=ua(o),l=n.lvlCapBn??gr(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Kr(l),u=n.lvlCapFmtText??ua(l),f=r<n.lvlCap?Wb(e,t):c.fromInt(0),d=Kr(f),m=A[n.costType]?.value,v=m instanceof c?m:c.fromAny(m??0),p=Fo(e,t),h=!!p.locked,g=p.titleOverride??n.title,y=p.descOverride??n.desc;if(e===Je&&co(t)===di){let N=tu();if(Math.abs(N-1)>1e-4&&y){let G=Te(N);y=y.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+G+" Coins on an interval")}}let I=bh(n,e),E="";typeof n.effectSummary=="function"&&!(h&&p.hideEffect)&&(E=n.effectSummary(r),typeof E=="string"&&(E=E.trim()));let M=p.iconOverride??Bu(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:v,haveFmt:A[n.costType]?.fmt(v)??String(v),effect:E,iconUrl:M,lockState:p,locked:h,areaKey:e,hmMilestones:I,displayTitle:g,displayDesc:y,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?ph(e,t):0,hmReadyToEvolve:n.upgType==="HM"?Ih(n,o,ph(e,t)):!1,hmNextMilestone:n.upgType==="HM"?$b(n,o,e):null}}function sL(e,t){let n=ga(e,t);if(!n||n.upgType!=="HM")return null;let o=Pn(e,t);return $b(n,o,e)}function aL(e){return re(be(e??0))}function op(e,t){let n=To(e,t),o=n.upg;if(!o)return{bought:0};let r=Xb(e,n.slot);if(Zt(r))return{bought:0};let i=Di(e,t,n.slot);if(Zt(i))return{bought:0};if(Ql(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??yt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&Ih(o,l,n.hmEvolutions))return{bought:0};let f=A[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let m=ca(o,l,d,da),v=m.count instanceof c?m.count:c.fromAny(m.count??0);if(v.isZero?.())return{bought:0};let p=l.add(v);return F1(),mr(e,t,p,!0,{deferSave:!0}),{bought:v}}function Rl(e,t){let n=To(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ql(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??yt(n.lvl),i=Ye(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=A[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=Ni(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=v=>{if(v<=0)return!0;let p=mf(o,i,v-1),h=a.sub(p),g=i+v-1,y=c.fromAny(o.costAtLevel(g)),I=h.div(10);return y.cmp(I)<=0},m=0;if(f<2e3){let v=u.spent,p=f;for(;p>0;){let h=i+p-1,g=c.fromAny(o.costAtLevel(h)),y=v.sub(g),E=a.sub(y).div(10);if(g.cmp(E)<=0){m=p;break}v=y,p--}}else{let v=0,p=f;for(;v<p;){let h=Math.ceil((v+p)/2);d(h)?v=h:p=h-1}m=v}return m<=0?{bought:0,spent:c.fromInt(0)}:js(e,t,m)}var da,Yt,qk,B1,hf,Ie,sa,xb,jl,rh,zr,Lb,D1,Qm,_e,Tb,$1,Hn,Cn,fn,lo,Ab,mh,q1,G1,H1,X1,kb,Nb,Rb,V1,uf,ff,df,ih,Gk,sh,af,en,cf,z1,nh,Gb,oh,Z1,wf,dh,_b,no=De(()=>{St();Et();Gt();bn();bo();vo();Sn();pi();_s();Jp();Kc();da=c.fromAny("Infinity"),Yt=1e3,qk=c.fromInt(1e3),B1=3,hf="",Ie={STARTER_COVE:"starter_cove",AUTOMATION:Je,DNA:Vt},sa=!1,xb=new Map,jl=new Map,rh=!1,zr=new Map,Lb=null;D1=308;Qm=1024;_e={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},Tb=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],$1={[Ie.STARTER_COVE]:Tb},Hn="img/misc/locked.webp",Cn="img/misc/mysterious.webp",fn="Hidden Upgrade",lo="Locked Upgrade",Ab=new Set([_e.COIN_VALUE_II,_e.XP_VALUE_II,_e.MP_VALUE_I,_e.MAGNET,_e.ENDLESS_XP]),mh=new Set([_e.COIN_VALUE_III,_e.XP_VALUE_III,_e.MP_VALUE_II,_e.FASTER_COINS_III,_e.ENDLESS_MP]),q1=new Set([_e.UNLOCK_XP,_e.UNLOCK_FORGE,_e.UNLOCK_INFUSE,_e.UNLOCK_SURGE,...Ab,...mh]),G1=new Set([_e.FASTER_COINS_II,_e.COIN_VALUE_I,_e.BOOK_VALUE_I,_e.XP_VALUE_I]),H1=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),X1="ccc:merchantMet",kb="ccc:shop:reveals",Nb="ccc:shop:permaUnlocks",Rb="ccc:shop:permaMyst",V1={locked:0,mysterious:1,unlocked:2},uf=new Map,ff=new Map,df=new Map,ih=new Map,Gk=vr(_e.BOOK_VALUE_I),sh=c,af=e=>sh.fromAny(e??0),en={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=af(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return sh.fromInt(1).add(r.mulDecimal(n))}catch{let i=be(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return re(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=af(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return sh.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(af(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=af(i);if(o>0){let l=be(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return re(u)}}catch{}try{let l=Ye(s),a=o*l;return re(a)}catch{return c.fromInt(1)}}}};cf=Math.log(10);z1={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=yf(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=yf(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};nh=(()=>{try{let e=Ye(da);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),Gb=new ArrayBuffer(8),oh=new Float64Array(Gb),Z1=new BigInt64Array(Gb);wf=[{area:Ie.STARTER_COVE,id:1,tie:_e.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(.1)},{area:Ie.STARTER_COVE,id:2,tie:_e.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:Ln,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{li()}catch{}}},{area:Ie.STARTER_COVE,id:3,tie:_e.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(.1)},{area:Ie.STARTER_COVE,id:4,tie:_e.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(.5),onLevelChange(){try{Jt()}catch{}}},{area:Ie.STARTER_COVE,id:5,tie:_e.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>pf(e)>0?2:1,onLevelChange({newLevel:e}){ol(e)}},{area:Ie.STARTER_COVE,id:6,tie:_e.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:en.addFlatPerLevel(2)},{area:Ie.STARTER_COVE,id:7,tie:_e.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:Ln,onLevelChange({newLevel:e}){if((e??0)>=1)try{Km()}catch{}}},{area:Ie.STARTER_COVE,id:8,tie:_e.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${W(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(10),onLevelChange(){try{Jt()}catch{}}},{area:Ie.STARTER_COVE,id:9,tie:_e.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:10,tie:_e.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:11,tie:_e.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=pf(e),n=Te(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>pf(e)},{area:Ie.STARTER_COVE,id:12,tie:_e.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach certain upgrade levels for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Yt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return _n(this,e)},nextCostAfter(e,t){return _n(this,t)},computeLockState:Ln,effectSummary(e){let t=yt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Qo(this,t,this.area),r=It(n,o);return`XP value bonus: ${Te(r)}x`},effectMultiplier:en.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:13,tie:_e.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:Ln,onLevelChange({newLevel:e}){if((e??0)>=1)try{jm()}catch{}}},{area:Ie.STARTER_COVE,id:14,tie:_e.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${W(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(1e3)},{area:Ie.STARTER_COVE,id:15,tie:_e.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:16,tie:_e.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:17,tie:_e.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:Ln,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:en.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:18,tie:_e.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Yt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return _n(this,e)},nextCostAfter(e,t){return _n(this,t)},computeLockState:Ln,effectSummary(e){let t=yt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Qo(this,t,this.area),r=It(n,o);return`MP value bonus: ${Te(r)}x`},effectMultiplier:en.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:19,tie:_e.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:Ln,onLevelChange({newLevel:e}){if((e??0)>=1)try{Zm()}catch{}}},{area:Ie.STARTER_COVE,id:20,tie:_e.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Yt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return _n(this,e)},nextCostAfter(e,t){return _n(this,t)},computeLockState(e){let t=ln(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=Mn();o=Ye(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:Cn,titleOverride:fn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:lo,descOverride:"Locked"}},onLevelChange(){try{Jt()}catch{}},effectSummary(e){let t=yt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Qo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:en.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:21,tie:_e.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Yt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return _n(this,e)},nextCostAfter(e,t){return _n(this,t)},computeLockState(e){let t=ln(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=Mn();o=Ye(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:Cn,titleOverride:fn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:lo,descOverride:"Locked"}},onLevelChange(){try{Jt()}catch{}},effectSummary(e){let t=yt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Qo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:en.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:22,tie:_e.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Yt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return _n(this,e)},nextCostAfter(e,t){return _n(this,t)},computeLockState(e){let t=ln(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=Mn();o=Ye(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:Cn,titleOverride:fn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:lo,descOverride:"Locked"}},onLevelChange(){try{Jt()}catch{}},effectSummary(e){let t=yt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Qo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:en.powPerLevel(1.1)},...yy,...s0];for(let e of wf){let t=vr(e.tie??e.tieKey);t&&!ih.has(t)&&ih.set(t,e),e.baseCost=gr(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return _n(this,n)},e.nextCostAfter=function(n,o){return _n(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=en.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=yt(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Qo(this,o,this.area),s=It(r,i);if(typeof this.bonusLine=="function")return this.bonusLine(n,s);let l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Te(s)}x`})),e.numUpgEvolutions=ma(e.numUpgEvolutions),e.upgType==="HM"?If(e,e.numUpgEvolutions):(e.lvlCapBn=gr(e.lvlCap??1/0,1/0),e.lvlCap=fh(e.lvlCapBn),e.lvlCapFmtHtml=Kr(e.lvlCapBn),e.lvlCapFmtText=ua(e.lvlCapBn)),e.bulkMeta=Q1(e),ha(e)}dh=new Map;_b=new Map;typeof window<"u"&&(Cb(b()),window.addEventListener("saveSlot:change",()=>{Cb(b()),uo()}),window.addEventListener("surge:level:change",()=>{uo()}));Sy()});var bS={};bt(bS,{applyAllCurrencyOverridesForActiveSlot:()=>lc,applyStatMultiplierOverride:()=>eo,getDebugCurrencyMultiplierOverride:()=>nc,getDebugStatMultiplierOverride:()=>EL,setDebugCurrencyMultiplierOverride:()=>cS,setDebugPanelAccess:()=>s_,setDebugStatMultiplierOverride:()=>Vn});function ac(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function dL(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function dn(e){typeof e=="function"&&Lh.push(e)}function Af(){return{sections:new Set,subsections:new Set}}function pL(){let e=document.getElementById(rc);if(!e)return Af();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function mL(e){let{sections:t,subsections:n}=eS??Af();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function oS(){Lh.forEach(e=>{try{e?.()}catch{}}),Lh=[],Ah.length=0}function $t(e){!e||typeof e.refresh!="function"||Ah.push(e)}function pt(e){Ah.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function hL(){if(typeof window>"u")return;let e=p=>{let{key:h,slot:g}=p?.detail??{},y=g??b();pt(I=>I.type==="currency"&&I.key===h&&I.slot===y)};window.addEventListener("currency:change",e,{passive:!0}),dn(()=>window.removeEventListener("currency:change",e));let t=p=>{let{key:h,slot:g}=p?.detail??{},y=g??b();pt(I=>I.type==="currency-mult"&&I.key===h&&I.slot===y)};window.addEventListener("currency:multiplier",t,{passive:!0}),dn(()=>window.removeEventListener("currency:multiplier",t));let n=p=>{let{slot:h,changeType:g,unlocked:y}=p?.detail??{},I=h??b();pt(E=>E.type==="xp"&&E.slot===I),pt(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===I),(g==="unlock"||typeof y=="boolean")&&pt(E=>E.type==="unlock"&&(E.slot==null||E.slot===I))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),dn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=p=>{let{changeType:h,slot:g}=p?.detail??{},y=g??b();pt(I=>I.type==="mutation"&&I.slot===y),pt(I=>I.type==="stat-mult"&&I.key==="mutation"&&I.slot===y),h==="unlock"&&pt(I=>I.type==="unlock"&&(I.slot==null||I.slot===y))};window.addEventListener("mutation:change",o,{passive:!0}),dn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let p=b();pt(h=>h.type==="upgrade"&&h.slot===p),pt(h=>h.type==="currency-mult"&&h.slot===p),pt(h=>h.type==="stat-mult"&&h.slot===p)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),dn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let p=b();pt(h=>h.slot===p)};window.addEventListener("saveSlot:change",i,{passive:!0}),dn(()=>window.removeEventListener("saveSlot:change",i));let s=p=>{let{slot:h,key:g}=p?.detail??{},y=h??b();pt(I=>I.type==="unlock"&&(I.slot==null||I.slot===y)&&(I.key==null||I.key===g))};window.addEventListener("unlock:change",s,{passive:!0}),dn(()=>window.removeEventListener("unlock:change",s));let l=p=>{let{slot:h}=p?.detail??{},g=h??b();pt(y=>y.type==="workshop-level"&&y.slot===g)};window.addEventListener("workshop:change",l,{passive:!0}),dn(()=>window.removeEventListener("workshop:change",l));let a=p=>{let{slot:h}=p?.detail??{},g=h??b();pt(y=>y.type==="surge-level"&&y.slot===g)};window.addEventListener("surge:level:change",a,{passive:!0}),dn(()=>window.removeEventListener("surge:level:change",a));let u=p=>{let{slot:h}=p?.detail??{},g=h??b();pt(y=>y.type==="tsunami-nerf"&&(y.slot==null||y.slot===g))};window.addEventListener("surge:nerf:change",u,{passive:!0}),dn(()=>window.removeEventListener("surge:nerf:change",u));let f=p=>{let{slot:h}=p?.detail??{},g=h??b();pt(y=>y.type==="lab-level"&&(y.slot==null||y.slot===g)),pt(y=>y.type==="stat-mult"&&y.key==="rp"&&(y.slot==null||y.slot===g))};window.addEventListener("lab:level:change",f,{passive:!0}),dn(()=>window.removeEventListener("lab:level:change",f));let d=p=>{let{id:h,level:g}=p?.detail??{},y=b();pt(I=>I.type==="lab-node-level"&&I.slot===y&&I.id===h),h===1&&pt(I=>I.type==="tsunami-nerf"&&(I.slot==null||I.slot===y)),h===4&&pt(I=>I.type==="unlock"&&(I.slot==null||I.slot===y))};window.addEventListener("lab:node:change",d,{passive:!0}),dn(()=>window.removeEventListener("lab:node:change",d));let m=p=>{let{id:h,rp:g}=p?.detail??{},y=b();pt(I=>I.type==="lab-node-rp"&&I.slot===y&&I.id===h)};window.addEventListener("lab:node:rp",m,{passive:!0}),dn(()=>window.removeEventListener("lab:node:rp",m));let v=p=>{let h=b();pt(g=>g.type==="combo"&&g.slot===h)};tv(v),dn(()=>nv(v))}function kf(){return[{key:Ie.STARTER_COVE,title:"The Cove",currencies:[{key:Re.COINS,label:"Coins"},{key:Re.BOOKS,label:"Books"},{key:Re.GOLD,label:"Gold"},{key:Re.MAGIC,label:"Magic"},{key:Re.GEARS,label:"Gears"},{key:Re.WAVES,label:"Waves"},{key:Re.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function rS(){if(document.getElementById(Ef))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Ef;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Ef,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Ef,document.head.appendChild(n)}function Ch(){let e=document.getElementById(Qb);e&&e.remove()}function gL(){return Xi&&Qe&&b()!=null&&!ac()&&dL()}function yL(e){e?.detail?.visible&&Go(),Of()}function Lf(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${tS++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Xn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${nS++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Ot(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function kh(e,t=b()){let n=t??b();return n==null?null:`${xt.CURRENCY[e]}:${n}`}function tc(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=A?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Ga(n,e)}catch{return c.fromInt(0)}}function vL(e,t,n=b()){let o=n??b(),r=tc(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=kh(e,o),s=i&&po(i);s&&Ia(i);let l=r;try{kn(o),l=ns(e,t,{previous:r})??r,i&&ut(i)}catch{}finally{s&&Wi(i)}return pt(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function fo(e,t){return`${e??"null"}::${t}`}function Nh(e,t){return ic.get(fo(e,t))??null}function bL(e,t=b()){let n=t??b();return!e||n==null?null:`${xt.MULTIPLIER[e]}:${n}`}function SL(e,t=b()){let n=fo(t,e);ic.delete(n),ba.delete(n),pt(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function Rh(e,t){let n=!Nf(t,e),o=fo(e,t),r=oc.get(o);if(!n&&r)return r;let i=IL(t,e);return i?(oc.set(o,i),i):(n&&oc.delete(o),null)}function iS(e,t){pt(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function sS(e,t=b()){let n=Yi(e,t);if(oc.delete(fo(t,e)),$i.delete(fo(t,e)),!(!n||typeof localStorage>"u")&&!po(n)){try{localStorage.removeItem(n)}catch{}iS(e,t)}}function Nf(e,t=b()){return po(Yi(e,t))}function aS(e,t){return Nf(t,e)?Rh(e,t):null}function Yn(e,t=b()){let n=Vi(e);return Rf(e,t,n)??n}function Yi(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${lL}:${e}:${n}`}function Vi(e){try{if(e==="xp"){let t=Dc();if(t)return t}else if(e==="mutation"){let t=Bf?.();if(t)return t;let n=Pf();if(n)return n}else if(e==="spawnRate"){let t=bs(Ie.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return Jc()}catch{}return c.fromInt(1)}function IL(e,t=b()){let n=Yi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function wL(e,t,n){let o=Yi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=po(o),s=i&&va?va:localStorage.setItem.bind(localStorage);i&&!va&&Ia(o),s(o,r.toStorage?.()??String(r)),i&&!va&&Wi(o)}catch{}}function Oh(e,t=b()){if(t==null)return;let n=Nh(t,e);if(!n||t!==b())return;let o=fo(t,e);if(!Cf.has(o)){Cf.add(o);try{let r=A?.[e]?.mult?.get?.();Ot(r,n)||A?.[e]?.mult?.set?.(n)}catch{}finally{Cf.delete(o)}}}function lS(){if(!(Zb||typeof window>"u")){Zb=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=fo(r,t);if(!r||!ic.has(i)||Cf.has(i))return;let s=ba.get(i),l=Nh(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,m=l.mulBigNumInteger(f);ic.set(i,m)}}catch{}ba.set(i,o)}else o&&ba.set(i,o);Oh(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{lc()},{passive:!0})}catch{}}}function lc(){let e=b();e!=null&&Object.values(Re).forEach(t=>{Oh(t,e)})}function cS(e,t,n=b()){if(!e||n==null)return null;lS();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=fo(n,e);if(ic.set(r,o),!ba.has(r)){let i=A?.[e]?.mult?.get?.();ba.set(r,i)}return Oh(e,n),o}function nc(e,t=b()){return!e||t==null?null:Nh(t,e)}function Vn(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return oc.set(fo(n,e),o),$i.set(fo(n,e),Vi(e)),wL(e,n,o),iS(e,n),o}function EL(e,t=b()){return!e||t==null?null:Rh(t,e)}function eo(e,t,n=b()){let o=Vi(e),r=Rf(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Ot(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=fo(n,e),l=$i.get(s),a=Nf(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function Rf(e,t,n){let o=Rh(t,e),r=fo(t,e);if(!o)return $i.delete(r),null;let i=$i.get(r),s=Nf(e,t);if(!i)$i.set(r,n);else if(!Ot(i,n))return s?($i.set(r,n),o):(sS(e,t),null);return o}function xL(){if(!(Kb||typeof localStorage>"u")){Kb=!0;try{va=localStorage.setItem.bind(localStorage),jb=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!Sa.has(e))return va(e,t)},localStorage.removeItem=e=>{if(!Sa.has(e))return jb(e)}}catch{}}}function po(e){return e!=null&&Sa.has(e)}function Wi(e){e&&(xL(),Sa.add(e))}function Ia(e){e&&Sa.delete(e)}function LL(e){return e?po(e)?(Ia(e),!1):(Wi(e),!0):!1}function _L(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=po(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(LL(e),typeof t=="function")try{t(po(e))}catch{}o()}),o(),{button:n,refresh:o}}function CL(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>po(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>po(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?Ia(u):Wi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function ML(){let e=document.getElementById(rc);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function TL(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{po(r)&&(o.push(r),Ia(r))});try{return t?.()}finally{o.forEach(r=>Wi(r))}}function AL(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function Ph(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Mh(e,t){e.classList.toggle("debug-invalid",!t)}function tt(){let e=b();try{kn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function uS(e=b()){return e==null?null:`${cL}:${e}`}function fS(e=b()){let t=uS(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function dS(e,t=b()){let n=uS(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,_h);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function kL(e,t=b()){let n=fS(t);return n.unshift(e),n.length>_h&&(n.length=_h),dS(n,t),n}function ot(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};kL(o,t),Bh()}function Bh(){if(!ya)return;let e=fS();if(e.length===0){ya.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",ya.appendChild(t);return}ya.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function pS(e=b()){return e==null?null:`${Ml}:${e}`}function mS(e,t=b()){let n=pS(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function hS(e=b()){let t=pS(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function NL(e){if(e){if(Object.values(Re).includes(e.type)){try{e.type===Re.BOOKS?A.books.addWithMultiplier?.(e.amount)??A.books.add(e.amount):A[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function RL(){let e=b();if(e==null)return{completed:0};let t=hS(e),n=0;return Object.entries(_u).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,NL(r.reward))}),mS(t,e),{completed:n}}function OL(){let e=b();if(e==null)return{restored:0};let t=hS(e),n=0;return Object.entries(_u).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),mS(t,e),{restored:n}}function rn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,m=!1,v=r?_L(r,{onToggle:i}):null,p=g=>{if(f){d=g;return}d=null,u.value=typeof s=="function"?s(g):AL(g)};l.appendChild(u),v&&l.appendChild(v.button);let h=()=>{let g=Ph(u.value);if(!g){Mh(u,!1);return}Mh(u,!0);let y=r&&po(r);y&&Ia(r);try{n(g,{input:u,setValue:p})}finally{y&&Wi(r),v&&v.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",h),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),m=!0,h(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,m||h(),m=!1,d!=null){let g=d;d=null,p(g)}}),p(t),v&&v.refresh(),{row:l,input:u,setValue:p,isEditing:()=>f}}function PL({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let h=document.createElement("span");h.className="debug-unlock-desc",h.textContent=`- ${t}`,f.appendChild(h)}s.appendChild(l),s.appendChild(f);let m=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",h=>{l.contains(h.target)||m()});let v=!1,p=()=>{let h=!1;try{h=typeof n=="function"?!!n():!1}catch{}return a.checked=h,v=h,h};return a.addEventListener("change",()=>{let h=v,g=a.checked;try{g?o?.():r?.()}catch{}tt();let y=p();h!==y&&ot(`Toggled ${e} [GOLD]${h?"True":"False"}[/GOLD] \u2192 [GOLD]${y?"True":"False"}[/GOLD]`)}),p(),$t({type:"unlock",slot:i,refresh:p}),s}function BL(e){try{if(e instanceof c||typeof e?.toScientific=="function")return W(e);let t=Number(e);return Number.isFinite(t)?W(t):String(e??"\u2014")}catch{return"\u2014"}}function FL({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:m})=>{if(d.type==="select"){u[d.key]=m.value;return}let v=Ph(m.value),p=v instanceof c;if(Mh(m,p),!p){f=!0;return}u[d.key]=v}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=BL(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:m,label:v})=>{let p=document.createElement("option");p.value=m,p.textContent=v??m,f.defaultValue!=null&&f.defaultValue===m&&(p.selected=!0),d.appendChild(p)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function Zr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return et()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{li()}catch{}let f=qi.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ut(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),m=qi.level(n);localStorage.setItem(m,d),ut(m,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),m=qi.progress(n);localStorage.setItem(m,d),ut(m,d)}catch{}try{us({forceReload:!0})}catch{}try{Fc({changeType:"debug-panel",slot:n})}catch{}try{pt()}catch{}}function Jr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return vt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,m=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&m!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{sc(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{on()}catch{}try{Yr()}catch{}let f=Gi.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ut(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),m=Gi.level(n);localStorage.setItem(m,d),ut(m,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),m=Gi.progress(n);localStorage.setItem(m,d),ut(m,d)}catch{}try{on({forceReload:!0})}catch{}try{Fh({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{pt()}catch{}}function UL(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=kh(r.key,n),s=tc(r.key,n),l=rn(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=tc(r.key,f),{next:m}=vL(r.key,a,f);u(m),Ot(d,m)||(tt(),ot(`Modified ${r.label} (${o}) ${W(d)} \u2192 ${W(m)}`))},{storageKey:i,onLockChange:()=>l.setValue(tc(r.key,b()))});$t({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=tc(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function DL(e,t){let n=b();if(n==null){let P=document.createElement("div");P.className="debug-panel-empty",P.textContent="Select a save slot to edit stats.",e.appendChild(P);return}let o="spawnRate",r=Yi(o,n),i=rn("Coin Spawn Rate",Yn(o,n),(P,{setValue:$})=>{let L=b();if(L==null)return;let F=Yn(o,L);try{Vn(o,P,L)}catch{}let T=Yn(o,L);$(T),Ot(F,T)||(tt(),ot(`Modified Spawn Rate (${a}) ${W(F)} \u2192 ${W(T)}`))},{storageKey:r,onLockChange:P=>{let $=b();if($!=null){if(P){if(aS($,o))return;try{Vn(o,Vi(o),$)}catch{}}else Rf(o,$,Vi(o));i.setValue(Yn(o,$))}}});$t({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Yn(o,n);i.setValue(P)}}),$t({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Yn(o,n);i.setValue(P)}}),e.appendChild(i.row);let s=et(),l=vt(),a=t?.title??t?.key??"Unknown Area",u=qi.level(n),f=rn("XP Level",s.xpLevel,(P,{setValue:$})=>{let L=et().xpLevel;Zr({level:P});let F=et();$(F.xpLevel),Ot(L,F.xpLevel)||(tt(),ot(`Modified XP Level (${a}) ${W(L)} \u2192 ${W(F.xpLevel)}`))},{storageKey:u});$t({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(et().xpLevel)}}),e.appendChild(f.row);let d=qi.progress(n),m=rn("XP Progress",s.progress,(P,{setValue:$})=>{let L=et(),F=L?.xpLevel?.clone?.()??L?.xpLevel,T=L?.progress?.clone?.()??L?.progress;Zr({progress:P});let C=et();$(C.progress),f.setValue(C.xpLevel),(!Ot(T,C.progress)||!Ot(F,C.xpLevel))&&(tt(),ot(`Modified XP Progress (${a}) ${W(T)} \u2192 ${W(C.progress)}`))},{storageKey:d});$t({type:"xp",slot:n,refresh:()=>{n===b()&&m.setValue(et().progress)}}),e.appendChild(m.row);let v=Gi.level(n),p=rn("MP Level",l.level,(P,{setValue:$})=>{let L=vt().level;Jr({level:P});let F=vt();$(F.level),Ot(L,F.level)||(tt(),ot(`Modified MP Level (${a}) ${W(L)} \u2192 ${W(F.level)}`))},{storageKey:v});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&p.setValue(vt().level)}}),e.appendChild(p.row);let h=Gi.progress(n),g=rn("MP Progress",l.progress,(P,{setValue:$})=>{let L=vt(),F=L?.level?.clone?.()??L?.level,T=L?.progress?.clone?.()??L?.progress;Jr({progress:P});let C=vt();$(C.progress),p.setValue(C.level),(!Ot(T,C.progress)||!Ot(F,C.level))&&(tt(),ot(`Modified MP Progress (${a}) ${W(T)} \u2192 ${W(C.progress)}`))},{storageKey:h});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&g.setValue(vt().progress)}}),e.appendChild(g.row);let y=Mi(n);if(y){let P=0;try{let L=localStorage.getItem(y),F=c.fromAny(L||"0");if(F.isInfinite())P=1/0;else try{P=Number(F.toScientific(20))}catch{P=0}}catch{}let $=rn("Workshop Level",P,(L,{setValue:F})=>{let T=Number(L);if(L instanceof c)if(L.isInfinite())T=1/0;else try{T=Number(L.toScientific(20))}catch{T=NaN}if(Number.isNaN(T)||T<0)return;let C=T===1/0?"Infinity":String(Math.floor(T));try{localStorage.setItem(y,C),tt(),ot(`Modified Workshop Level (The Cove) ${W(P)} \u2192 ${C}`),P=T}catch{}F(T)},{storageKey:y,onLockChange:()=>{let L=0;try{let F=localStorage.getItem(y),T=c.fromAny(F||"0");T.isInfinite()?L=1/0:L=Number(T.toScientific(20))}catch{}$.setValue(L)}});e.appendChild($.row),$t({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let L=0;try{let F=localStorage.getItem(y),T=c.fromAny(F||"0");T.isInfinite()?L=1/0:L=Number(T.toScientific(20))}catch{}$.setValue(L)}})}let I=oa(n);if(I){let P=0;try{let L=localStorage.getItem(I);L==="Infinity"?P=1/0:P=c.fromAny(L||"0")}catch{P=c.fromInt(0)}let $=rn("Surge Level",P,(L,{setValue:F})=>{let T="0",C=0;L instanceof c?L.isInfinite()?(T="Infinity",C=1/0):(T=L.toPlainIntegerString(),C=L):L===1/0||typeof L=="string"&&/infinity/i.test(L)?(T="Infinity",C=1/0):(T=String(L),C=L);try{localStorage.setItem(I,T),tt();let z=C===1/0?"Infinity":W(C),Q=P===1/0||P instanceof c&&P.isInfinite()?"Infinity":W(P);ot(`Modified Surge Level (The Cove) ${Q} \u2192 ${z}`),C===1/0?P=1/0:C instanceof c?P=C:P=c.fromAny(C);let ae=!1;P===1/0?ae=!0:P instanceof c?typeof P.cmp=="function"&&P.cmp(8)>=0&&(ae=!0):typeof P=="number"&&P>=8&&(ae=!0),ae&&(Li(0),In()||ir(!0))}catch{}F(C);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let z=P;if(z!==1/0&&z instanceof c)try{z=BigInt(z.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:z}}))}catch{}},{storageKey:I,onLockChange:L=>{let F=c.fromInt(0);try{let T=localStorage.getItem(I);T==="Infinity"?F=1/0:F=c.fromAny(T||"0")}catch{}$.setValue(F)}});$t({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let L=c.fromInt(0);try{let F=localStorage.getItem(I);F==="Infinity"?L=1/0:L=c.fromAny(F||"0")}catch{}$.setValue(L)}}),e.appendChild($.row)}let E=Qt(),M=rn("Lab Level",E,(P,{setValue:$})=>{let L;try{L=P instanceof c?P:c.fromAny(P),L.isNegative&&L.isNegative()&&(L=c.fromInt(0))}catch{$(Qt());return}let F=Qt();vi(L),tt(),Ot(F,L)||ot(`Modified Lab Level (The Cove) ${W(F)} \u2192 ${W(L)}`),$(L)},{storageKey:Yd(n)});$t({type:"lab-level",slot:n,refresh:()=>{n===b()&&M.setValue(Qt())}}),e.appendChild(M.row);let N=()=>{let P=Bn(),$=oo(),L=P+$;return L>1&&(L=1),L},G=rn("Tsunami Exponent",N().toFixed(2),(P,{setValue:$})=>{let L=Number(P);if(P instanceof c?P.isInfinite()?L=1/0:L=Number(P.toScientific(10)):typeof P=="string"&&/infinity/i.test(P)&&(L=1/0),Number.isNaN(L)){$(N().toFixed(2));return}let F=oo(),T=L-F;T>1&&(T=1),T<0&&(T=0),T=Math.round(T*100)/100;let C=Bn();Li(T),tt(),Math.abs(C-T)>1e-4&&ot(`Modified Tsunami Exponent (The Cove) Base:${C.toFixed(2)} \u2192 ${T.toFixed(2)} (Effective: ${L.toFixed(2)})`),$(N().toFixed(2))},{storageKey:pp(n),format:P=>{let $=Number(P);return Number.isFinite($)?$.toFixed(2):String(P)}});if($t({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let P=N();G.setValue(P.toFixed(2))}}),e.appendChild(G.row),t.key===Ie.STARTER_COVE){let P=`ccc:debug:comboLock:${n}`,$=rn("Combo",su(),(L,{setValue:F})=>{let T=0;if(L===1/0||L instanceof c&&L.isInfinite())T=ev();else{try{T=L instanceof c?Number(L.toScientific(10)):Number(L)}catch{T=Number(L)}Number.isNaN(T)&&(T=0)}Qy(T),F(su()),tt()},{storageKey:P,onLockChange:L=>fp(L),format:L=>{let F=Number(L);return Number.isFinite(F)&&Math.abs(F)<1e9?F.toFixed(3):W(L)}});fp(po(P)),$t({type:"combo",slot:n,refresh:()=>{n===b()&&$.setValue(su())}}),e.appendChild($.row)}}function xh(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Tt(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=Pn(t.key,i.id??i.tie),u=Di(t.key,i.id??i.tie,n),f=rn(l,a,(d,{setValue:m})=>{if(b()==null)return;let p=Pn(t.key,i.id??i.tie);try{mr(t.key,i.id??i.tie,d,!1)}catch{}let h=Pn(t.key,i.id??i.tie);m(h),Ot(p,h)||(tt(),ot(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${W(p)} \u2192 Lv${W(h)}`))},{idLabel:s,storageKey:u});$t({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=Pn(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function $L(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=A?.[r.key]?.mult,l=nc(r.key,n)??i?.get?.()??c.fromInt(1),a=`${xt.MULTIPLIER[r.key]}:${n}`,u=rn(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let m=b();if(m==null)return;let v=nc(r.key,m)??i?.get?.()??c.fromInt(1);try{cS(r.key,f,m)}catch{}lc();let h=nc(r.key,m)??i?.get?.()??c.fromInt(1);d(h),Ot(v,h)||(tt(),ot(`Modified ${r.label} Multiplier (${o}) ${W(v)} \u2192 ${W(h)}`))},{storageKey:a});$t({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=nc(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function qL(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Re).forEach(o=>{let r=A?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Ot(i,t))return;r.set(t),n+=1}catch{}}),n}function GL(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Re).forEach(o=>{let r=A?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function HL(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=et()}catch{}try{r=vt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Ot(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Ot(o?.progress,t);(!i||!s)&&(Zr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Ot(r?.level,t),s=r?.progress?.isInfinite?.()||Ot(r?.progress,t);(!i||!s)&&(Jr({level:t,progress:t}),n+=1)}}catch{}try{let i=Mi(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=oa(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{pt()}catch{}return n}function XL(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=et()}catch{}try{r=vt()}catch{}try{o?.unlocked&&(Zr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Jr({level:t,progress:t}),n+=1)}catch{}try{let i=Mi(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=oa(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{pt()}catch{}return n}function gS(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!et()?.unlocked}catch{return!1}},onEnable:()=>{try{li()}catch{}try{us({forceReload:!0})}catch{}},onDisable:()=>{try{fs({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Channel",description:"If true, unlocks the Channel tab",isUnlocked:()=>{try{return!!Gs()}catch{return!1}},onEnable:()=>{let t=b();if(t!=null){try{localStorage.setItem(`ccc:unlock:channel:${t}`,"1")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"channel",slot:t}}))}catch{}}},onDisable:()=>{let t=b();if(t!=null){try{localStorage.setItem(`ccc:unlock:channel:${t}`,"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"channel",slot:t}}))}catch{}}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{sc(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{sc(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return rm()}catch{return!1}},onEnable:()=>{try{Ri()}catch{}},onDisable:()=>{try{Du()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return im()}catch{return!1}},onEnable:()=>{try{Uu()}catch{}},onDisable:()=>{try{$u()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return Yp()}catch{return!1}},onEnable:()=>{try{xu(!0)}catch{}},onDisable:()=>{try{xu(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!In()}catch{return!1}},onEnable:()=>{try{ir(!0)}catch{}},onDisable:()=>{try{ir(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return st(4)>=1}catch{return!1}},onEnable:()=>{try{wo(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{wo(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function yS(e){let t=b();if(t==null)return 0;let n=0;gS(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{pt()}catch{}return n}function VL(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;kf().forEach(o=>{Tt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Ui(o.key,r,e),t+=1}catch{}})});try{Ri()}catch{}try{Uu()}catch{}let n=yS(!0);return{unlocks:t,toggles:n}}function YL(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;kf().forEach(o=>{Tt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{yh(o.key,r,e),t+=1}catch{}})});try{Du()}catch{}try{$u()}catch{}let n=yS(!1);return{locks:t,toggles:n}}function WL(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(kh(a,n)),r(bL(a,n))},s=a=>r(Yi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(qi.level(n)),r(qi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(Gi.level(n)),r(Gi.progress(n)))};return e==="all"?(Object.values(Re).forEach(i),l("xp"),l("mutation"),Tf.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Re).forEach(i),Array.from(o)):e==="allUnlockedStats"?(et()?.unlocked&&l("xp"),vt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Re).forEach(i),et()?.unlocked&&l("xp"),vt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function _f(e){try{A?.[e]?.set?.(c.fromInt(0))}catch{}try{SL(e)}catch{}try{Mc(e,c.fromInt(1))}catch{}}function zL(e){if(e==="all"){Object.values(Re).forEach(i=>_f(i));let o=c.fromInt(0);return Zr({level:o,progress:o}),Jr({level:o,progress:o}),Tf.forEach(({key:i})=>{try{Vn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Re).length+Tf.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Re).forEach(i=>{_f(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(et()?.unlocked){Zr({level:o,progress:o});try{Vn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(vt()?.unlocked){Jr({level:o,progress:o});try{Vn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Re).forEach(l=>{_f(l),o+=1});let r=c.fromInt(0),i=0;try{if(et()?.unlocked){Zr({level:r,progress:r});try{Vn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(vt()?.unlocked){Jr({level:r,progress:r});try{Vn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return _f(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{sS(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Zr({level:n,progress:n});try{Vn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Jr({level:n,progress:n});try{Vn("mutation",c.fromInt(1))}catch{}return"MP"}try{Vn(t,c.fromInt(1))}catch{}return`stat ${t}`}function KL(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";Tf.forEach(r=>{if(r.key==="spawnRate")return;let i=Yi(r.key,n),s=rn(`${r.label} Multiplier`,Yn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Yn(r.key,u);try{Vn(r.key,l,u)}catch{}let d=Yn(r.key,u);a(d),Ot(f,d)||(tt(),ot(`Modified ${r.label} Multiplier (${o}) ${W(f)} \u2192 ${W(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if(aS(a,r.key))return;try{Vn(r.key,Vi(r.key),a)}catch{}}else Rf(r.key,a,Vi(r.key));s.setValue(Yn(r.key,a))}}});$t({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Yn(r.key,n);s.setValue(l)}}),$t({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Yn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&$t({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Yn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function jL(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Rt||Rt.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Rt.forEach(n=>{let o=Xn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=fl(t,n.id),s=rn("Level",st(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let m=st(n.id);wo(n.id,d),tt(),m!==d&&ot(`Modified Node ${n.id} Level (The Cove) ${m} \u2192 ${d}`),f(d)},{storageKey:i});$t({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(st(n.id))}}),r.appendChild(s.row);let l=dl(t,n.id),a=rn("Current RP",So(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(So(n.id));return}let m=So(n.id);wi(n.id,d),tt(),Ot(m,d)||ot(`Modified Node ${n.id} RP (The Cove) ${W(m)} \u2192 ${W(d)}`),f(d)},{storageKey:l});$t({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(So(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function ZL(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)},{label:"Pending DNA (Experiment)",inputs:[{key:"labLevel",label:"Lab Level"},{key:"xpLevel",label:"XP Level"},{key:"isSurge9",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 9? No"},{value:"Yes",label:"Surge 9? Yes"}]}],compute:({labLevel:n,xpLevel:o,isSurge9:r})=>window.resetSystem?.computePendingDnaFromInputs?.(n,o,r==="Yes")}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Uc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>kd(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Uh(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>na(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>Ur(n)},{label:"Lab Level RP Boost",inputs:[{key:"level",label:"Lab Level"},{key:"isSurge12",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 12? No"},{value:"Yes",label:"Surge 12? Yes"}]}],compute:({level:n,isSurge12:o})=>{let r=0;if(n instanceof c){if(n.isInfinite())return c.fromAny("Infinity");try{r=Number(n.toScientific(10))}catch{r=0}}else r=Number(n);if(!Number.isFinite(r))return c.fromInt(1);if(o==="Yes"){let s=ft(),l=5*s,a=2+s/2,u=Math.log10(a),f=r*u+l;return re(f)}let i=r*Math.log10(2);return re(i)}}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>vh(n,o,r)},{label:"Currency Generation Percentage",inputs:[{key:"tsunamiExp",label:"Tsunami Exponent"}],compute:({tsunamiExp:n})=>{let o=Number(n);if(n instanceof c&&(o=n.isInfinite()?1/0:Number(n.toScientific(10))),!Number.isFinite(o))return"\u2014";let r=o*1.5-.5,i=Math.pow(100,r);return Te(i)+"%"}}]}].forEach(n=>{let o=Xn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=FL({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function JL(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}lc(),kf().forEach(o=>{let r=Xn(o.title,i=>{let s=Xn("Currencies",p=>{UL(p,o)}),l=Xn("Stats",p=>{DL(p,o)}),a=Xn("Multipliers",p=>{let h=Xn("Currencies",y=>{$L(y,o)}),g=Xn("Stats",y=>{KL(y,o)});p.appendChild(h),p.appendChild(g)}),u=Xn("Upgrades",p=>{xh(p,o)}),f=null,d=null,m=null;o.key===Ie.STARTER_COVE&&(f=Xn("Automation Upgrades",p=>{xh(p,{key:Ie.AUTOMATION,title:"Automation"})}),d=Xn("DNA Upgrades",p=>{xh(p,{key:Ie.DNA,title:"DNA"})}),m=Xn("Lab Nodes",p=>{jL(p)}));let v=Xn("Calculators",p=>{ZL(p)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),m&&i.appendChild(m),i.appendChild(v)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function QL(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ie),r=[];return o.forEach(i=>{Tt(i).forEach(l=>{e&&Fo(i,l.id).locked||r.push({areaKey:i,upg:l})})}),Zl(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;mr(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function e_(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ie),r=[];o.forEach(s=>{Tt(s).forEach(a=>{e&&Fo(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{Zl(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Or(s,l.id,"0"),mr(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function Jb(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Tt(Je);Zl(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;mr(Je,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(vs),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Ie).forEach(l=>{if(l===Je)return;Tt(l).forEach(u=>{s.has(u.costType)&&(Or(l,u.id,n),o++)})}),Or(Je,yo,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function t_(e){e.innerHTML="";let t=b();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=RL();tt(),ot(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=OL();tt(),ot(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=qL();tt(),ot(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=HL();tt(),ot(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=GL();tt(),ot(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=XL();tt(),ot(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"Max All Upgs",onClick:()=>{let g=QL(!1);tt(),ot(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=e_(!1);tt(),ot(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=Jb(!0);tt(),ot(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=Jb(!1);tt(),ot(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:y}=VL();tt(),ot(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${y} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:y}=YL();tt(),ot(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${y} toggled).`)}},{label:"Max All Lab Nodes",onClick:()=>{let g=0;Rt.forEach(y=>{Number.isFinite(y.maxLevel)&&(wo(y.id,y.maxLevel),g++)}),tt(),ot(`Maxed ${g} Lab Nodes.`)}},{label:"All Lab Nodes 0",onClick:()=>{let g=0;Rt.forEach(y=>{wo(y.id,0),wi(y.id,0),tr(y.id)&&bi(y.id,!1),g++}),tt(),ot(`Reset ${g} Lab Nodes to 0 (Level & RP).`)}},{label:"Wipe Action Log",onClick:()=>{dS([],t),Bh(),tt(),ot("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=b();if(g!=null)try{localStorage.setItem(uL(g),String(fL)),ar(!0),tt(),ot("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let y=Ph(g);if(!y||typeof y.isZero=="function"&&y.isZero()||typeof y.isNegative=="function"&&y.isNegative())return;let I,E=!1;Xt()?I=Fs(y):(I=gu(y),E=!0),Ti(I);let M=y.mulSmall?y.mulSmall(1e3):y.mulBigNumInteger(c.fromInt(1e3));Dr(I,M,E),tt(),ot(`Performed OP Time Warp for ${W(y)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-misc-button",y.textContent=g.label,y.addEventListener("click",g.onClick),o.appendChild(y)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",kf().forEach(g=>{let y=document.createElement("optgroup");y.label=g.title||g.key,g.currencies.forEach(I=>{let E=document.createElement("option");E.value=`currency:${I.key}`,E.textContent=`${g.title||g.key} \u2192 ${I.label}`,y.appendChild(E)}),g.stats.forEach(I=>{let E=document.createElement("option");E.value=`stat:${I.key}`,E.textContent=`${g.title||g.key} \u2192 ${I.label}`,y.appendChild(E)}),s.appendChild(y)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${xf}"]`)||(xf=ec),s.value=xf;let d=()=>WL(s.value||ec,b()),m=CL(d);s.addEventListener("change",()=>{xf=s.value||ec,m.refresh()}),m.refresh(),r.appendChild(s),r.appendChild(m.button);let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle reset-check",v.textContent="\u2705",v.addEventListener("click",()=>{let g=s.value||ec,y=d(),I=m.isLocked(),E=(M=!0)=>{let N=TL(y,()=>zL(g))??{label:g,count:0};if(I&&y.forEach(G=>Wi(G)),m.refresh(),tt(),M){let{label:G,count:P}=N;ot(`Reset ${P===1?"value and multiplier":"values and multipliers"} for ${G} to defaults.`)}};E(!0),setTimeout(()=>E(!1),100)}),r.appendChild(v),e.appendChild(r);let p=document.createElement("div");p.className="debug-panel-row";let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle debug-danger-button",h.textContent="Wipe Slot & Refresh",h.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let y=document.querySelector(".menu-root"),I=document.getElementById("game-root");y&&(y.hidden=!1,y.style.display="",y.style.visibility=""),I&&(I.hidden=!0,I.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),p.appendChild(h),e.appendChild(p)}function n_(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{us()}catch{}let n=gS(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(PL(o))})}function vS(){if(!Xi||ac())return;oS(),rS(),tS=0,nS=0;let e=document.getElementById(rc);e&&e.remove();let t=document.createElement("div");t.id=rc,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Go({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Go()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let m=document.createElement("div");m.className="debug-panel-info-line",d&&m.classList.add("debug-panel-info-mobile-hidden"),m.textContent=f,a.appendChild(m)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(Lf("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{JL(f)})),t.appendChild(Lf("Unlocks: modify specific unlock flags","debug-unlocks",f=>{n_(f)})),t.appendChild(Lf("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),ya=d,Bh(),dn(()=>{ya=null})})),t.appendChild(Lf("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{t_(f)})),mL(t),document.body.appendChild(t),Mf>0)try{t.scrollTop=Mf}catch{}hL(),Hi=!0}function Th(){if(!(!Xi||ac())){if(b()==null){Go();return}Hi||vS()}}function Go({preserveExpansionState:e=!1}={}){eS=e?pL():Af();let t=document.getElementById(rc);if(t){try{Mf=t.scrollTop??0}catch{Mf=0}t.remove()}oS(),Hi=!1}function o_(){if(!Xi||ac()||b()==null){Go();return}Hi?Go({preserveExpansionState:!0}):Th()}function r_(){Go(),Ch()}function Of(){if(!gL()){Ch(),Go();return}rS(),Ch();let e=document.createElement("button");e.id=Qb,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{o_()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function i_(e){if(Xi=!!e,!Xi){r_();return}Of()}function s_(e){i_(e)}var Ef,rc,Qb,ec,Hi,Xi,Lh,eS,Mf,xf,tS,nS,Ah,ya,ic,ba,Cf,oc,$i,Sa,Kb,va,jb,lL,cL,_h,uL,fL,wh,qi,Eh,Gi,Tf,Zb,ps=De(()=>{Et();Gt();St();bn();bo();Io();no();qu();Ws();Cs();vo();Sn();_s();pi();Cp();Si();_l();nr();yu();au();Ef="debug-panel-style",rc="debug-panel",Qb="debug-panel-toggle",ec=`currency:${Re.COINS}`,Hi=!1,Xi=!1,Lh=[],eS=Af(),Mf=0,xf=ec,tS=0,nS=0,Ah=[],ya=null,ic=new Map,ba=new Map,Cf=new Set,oc=new Map,$i=new Map,Sa=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=Sa);Kb=!1,va=null,jb=null,lL="ccc:debug:stat-mult",cL="ccc:actionLog",_h=100,uL=e=>`ccc:warp:charges:${e}`,fL=24;wh="ccc:xp",qi={unlock:e=>`${wh}:unlocked:${e}`,level:e=>`${wh}:level:${e}`,progress:e=>`${wh}:progress:${e}`},Eh="ccc:mutation",Gi={unlock:e=>`${Eh}:unlocked:${e}`,level:e=>`${Eh}:level:${e}`,progress:e=>`${Eh}:progress:${e}`},Tf=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];Zb=!1;lc();lS();document.addEventListener("keydown",e=>{if(!(!Xi||ac())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){Hi?(ML(),Go()):Th(),e.preventDefault();return}Hi?Go({preserveExpansionState:!0}):Th(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Of()});window.addEventListener("menu:visibilitychange",yL);window.addEventListener("saveSlot:change",()=>{Of(),Hi&&vS()})});var ES={};bt(ES,{addExternalMutationGainMultiplierProvider:()=>gi,addMutationPower:()=>Ds,broadcastMutationChange:()=>Fh,computeMutationMultiplierForLevel:()=>na,computeMutationRequirementForLevel:()=>Uh,getMutationCoinSprite:()=>Jm,getMutationGainMultiplier:()=>Bf,getMutationMultiplier:()=>Pf,getMutationState:()=>vt,getTotalCumulativeMp:()=>sr,initMutationSystem:()=>on,isMutationUnlocked:()=>Do,onMutationChange:()=>Fi,setMutationUnlockedForDebug:()=>sc,unlockMutationSystem:()=>Yr});function Ff(e){try{return e?.toStorage?.()}catch{return null}}function Zi(){try{Jt()}catch{}}function wS(e){let t=e;if(!t.isZero?.()){let n=ji.size>0?Array.from(ji):typeof fc=="function"?[fc]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof nt?t=r.clone?.()??r:r!=null&&(t=nt.fromAny(r))}catch{}}return t}function c_(){if(typeof Dh=="function"){try{Dh()}catch{}Dh=null}if(typeof $h=="function"){try{$h()}catch{}$h=null}}function dc(e){if(e instanceof nt)try{return e.clone?.()??nt.fromAny(e)}catch{return wt()}try{return nt.fromAny(e??0)}catch{return wt()}}function u_(e){if(!e||typeof e!="object")return wt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?nt.fromInt(100):nt.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function Df(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=be(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Wh(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let m=Math.pow(1.12,l-10);if(!Number.isFinite(m)||(f+=l_*(m-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=Df(e);if(!Number.isFinite(n))return nt.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return nt.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return nt.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return nt.fromAny("Infinity");let i=re(r);return u_(i)}function Qr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=Wh(D.level);D.requirement=n}function f_(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=be(e),l=be(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Xh(){return Wn.container&&Wn.container.isConnected?!0:(Wn.container=document.querySelector("[data-mp-hud].mp-counter"),Wn.container?(Wn.bar=Wn.container.querySelector(".mp-bar"),Wn.fill=Wn.container.querySelector(".mp-bar__fill"),Wn.levelValue=Wn.container.querySelector(".mp-level-value"),Wn.progress=Wn.container.querySelector("[data-mp-progress]"),!0):!1)}function zi(e){try{return W(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function Sr(){if(!Xh())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Wn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=zi(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=zi(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}ss();return}e.removeAttribute("hidden");let i=D.requirement,s=f_(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=zi(D.level)),r){let a=zi(D.progress),u=zi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=zi(D.progress).replace(/<[^>]*>/g,""),u=zi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}ss()}function Ir(e="update",t={}){let n=vt(),o={...n,slot:D.slot??b(),changeType:e,...t};if(Hh.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function zh(){let e=D.slot;if(e==null&&(e=b(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(cc(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Ki(e),D.level.toStorage())}catch{}try{localStorage.setItem(wa(e),D.progress.toStorage())}catch{}ut(cc(e)),ut(Ki(e)),ut(wa(e));let t=(()=>{let u=D.unlocked,f=D.level,d=D.progress;try{u=localStorage.getItem(cc(e))==="1"}catch{}try{let m=localStorage.getItem(Ki(e));m&&(f=nt.fromAny(m))}catch{}try{let m=localStorage.getItem(wa(e));m&&(d=nt.fromAny(m))}catch{}return{unlocked:u,level:f,progress:d}})(),n=Ff(t.level),o=Ff(t.progress),r=Ff(D.level),i=Ff(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&Uf(t,{skipPersist:!0})}function Vh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function d_(){if(!D.unlocked)return;let e=D.slot??b();if(e!=null&&Vh(Ki(e))){Qr();return}Qr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(Ea()),Qr(),t=D.requirement,!t||typeof t!="object"){D.progress=wt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=wt())}function Uf(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=dc(e.level),D.progress=dc(e.progress),D.unlocked||(D.level=wt(),D.progress=wt()),Qr(),t||zh(),Sr(),Ir("load"),Zi()}function qh(e){let t=e??b();if(t==null){Uf({unlocked:!1,level:wt(),progress:wt()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=wt(),r=wt();try{n=localStorage.getItem(cc(t))==="1"}catch{}try{let i=localStorage.getItem(Ki(t));i&&(o=nt.fromAny(i))}catch{}try{let i=localStorage.getItem(wa(t));i&&(r=nt.fromAny(i))}catch{}Uf({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function p_(){for(;uc.length;){let e=uc.pop();try{e?.()}catch{}}}function Gh(e){SS!==e&&(p_(),SS=e,e!=null&&(uc.push(kt(cc(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=wt(),D.progress=wt()),Qr(),Sr(),Ir("storage"),Zi())}})),uc.push(kt(Ki(e),{onChange(t){if(t)try{let n=nt.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Qr(),Sr(),Ir("storage"),Zi())}catch{}}})),uc.push(kt(wa(e),{onChange(t){if(t)try{let n=nt.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Qr(),Sr(),Ir("storage"))}catch{}}}))))}function on({forceReload:e=!1}={}){if(c_(),IS){let n=b();return(n!==D.slot||e)&&qh(n),Gh(n),Xh(),Sr(),vt()}IS=!0,Xh();let t=b();return D.slot=t,qh(t),Gh(t),Sr(),Zi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();D.slot=n,qh(n),Gh(n),Sr(),Zi(),Ir("slot")}),vt()}function vt(){return{unlocked:D.unlocked,level:dc(D.level),progress:dc(D.progress),requirement:dc(D.requirement)}}function Do(){return!!D.unlocked}function Yr(){return on(),D.unlocked?!1:(D.unlocked=!0,Qr(),zh(),Sr(),Ir("unlock"),Zi(),!0)}function sc(e){on();let t=!!e;Uf({unlocked:t,level:t?D.level:wt(),progress:t?D.progress:wt()})}function Ds(e){on();let t=D.slot??b();if(t!=null&&Vh(wa(t))||!D.unlocked)return vt();let n=t!=null&&Vh(Ki(t));if(D.level&&D.level.isInfinite?.()){let f=D.level.clone?.()??D.level,d=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=nt.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=nt.fromAny("Infinity")}catch{}let m;try{m=e instanceof nt?e:nt.fromAny(e??0)}catch{m=wt()}return m=wS(m),m=eo("mutation",m),Ir("progress",{delta:m.clone?.()??m,levelsGained:wt(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof nt?e:nt.fromAny(e??0)}catch{o=wt()}if(o=wS(o),o=eo("mutation",o),o.isZero?.())return vt();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=nt.fromAny("Infinity")}catch{}try{D.progress=nt.fromAny("Infinity")}catch{D.progress=wt()}try{D.requirement=nt.fromAny("Infinity")}catch{}}else d_();zh(),Sr();let a=D.level.sub(i);return a.isZero?.()||Zi(),Ir("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Fh(e={}){on();let t=e.changeType??"manual";return Ir(t,e)}function na(e){let t;if(e instanceof nt)try{t=e.clone?.()??e}catch{t=wt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=wt()}else try{t=c.fromAny(e??0)}catch{t=wt()}if(t&&t.isInfinite?.())try{return nt.fromAny("Infinity")}catch{return Ea()}let n=Df(t);if(!Number.isFinite(n))try{return nt.fromAny("Infinity")}catch{return Ea()}if(n<=0)return Ea();let o=n*a_;return re(o)}function Uh(e){let t;try{t=e instanceof nt?e:nt.fromAny(e??0)}catch{t=wt()}try{return Wh(t)}catch{return wt()}}function Pf(){if(on(),!D.unlocked)return Ea();try{return na(D.level)}catch{return Ea()}}function Bf(){let e=c.fromInt(1);if(ji.size>0||fc){let t=ji.size>0?Array.from(ji):typeof fc=="function"?[fc]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof nt?e=o.clone?.()??o:o!=null&&(e=nt.fromAny(o))}catch{}}return e}function Jm(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=Df(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function Fi(e){return typeof e!="function"?()=>{}:(Hh.add(e),()=>{Hh.delete(e)})}function gi(e){return typeof e!="function"?()=>{}:(ji.add(e),()=>{ji.delete(e)})}function sr(){if(on(),!D.unlocked)return wt();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=Df(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=Wh(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Yh,cc,Ki,wa,nt,wt,Ea,a_,l_,D,Wn,Hh,uc,SS,IS,Dh,$h,ji,fc,bo=De(()=>{Et();St();ps();Gt();Et();Sd();bn();Yh="ccc:mutation",cc=e=>`${Yh}:unlocked:${e}`,Ki=e=>`${Yh}:level:${e}`,wa=e=>`${Yh}:progress:${e}`,nt=c,wt=()=>nt.fromInt(0),Ea=()=>nt.fromInt(1),a_=Math.log10(2),l_=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:wt(),progress:wt(),requirement:wt(),slot:null},Wn={container:null,bar:null,fill:null,levelValue:null,progress:null},Hh=new Set,uc=[],SS=null,IS=!1,Dh=null,$h=null,ji=new Set,fc=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:on,unlockMutationSystem:Yr,addMutationPower:Ds,getMutationState:vt,getMutationMultiplier:Pf,isMutationUnlocked:Do,getTotalCumulativeMp:sr,addExternalMutationGainMultiplierProvider:gi,getMutationGainMultiplier:Bf}))});var pc,xS,LS,Kh,jh,Zh,_S=De(()=>{pc=`precision highp float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,xS=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\n\nvoid main() {\n    /* Wave animation settings */\n    float speed = 1.2;\n    float time = uTime * speed;\n    \n    /* Combine sine waves for a more natural look */\n    /* vUv.x is 0..1 across the screen width */\n    float wave1 = sin(vUv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n\n    /* Define the shoreline height (baseline) */\n    /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */\n    /* We want to discard pixels below this threshold */\n    float threshold = 0.428 + wave; \n\n    if (threshold > vUv.y) {\n        discard;\n    }\n\n    /* Recalculate gradient based on the new "bottom" */\n    /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */\n    float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0);\n    \n    vec3 col = mix(uColorShallow, uColorDeep, gradientY);\n    \n    /* Add a subtle "foam" or highlight at the edge */\n    float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold);\n    col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4);\n    \n    gl_FragColor = vec4(col, 1.0);\n}`,LS=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uWaveMap; \nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\nuniform vec3 uColorWaveDeep;  \nuniform vec3 uColorWave;      \n\n/* Simple noise for foam breakup */\nfloat hash(vec2 p) {\n    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\n}\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f*f*(3.0-2.0*f);\n    return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),\n               mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y);\n}\n\nvoid main() {\n    vec2 uv = vUv;\n    \n    /* Sample the simulation (physics) */\n    /* Wave Logic */\n    vec2 waveUV = uv - vec2(0.0, 0.0285);\n    float intensity = texture2D(uWaveMap, waveUV).r;\n    \n    /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */\n    float shadowOffset = 8.0 / uResolution.y; \n    float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r;\n    \n    /* Discard only if BOTH are empty */\n    if (0.01 > intensity && 0.01 > shadowIntensity) discard;\n    \n    /* Directional Noise: Streaky vertical noise for rushing water effect */\n    /* Stretch heavily along Y-axis to simulate speed/motion blur */\n    float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0));\n    \n    /* Define Zones based on Intensity */\n    /* Body (Medium Intensity): Darker/turbulent blue with noise */\n    /* Edge (High Intensity): Bright white foam */\n    \n    float foamThreshold = 0.5;\n    float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity);\n    \n    /* Base Colors */\n    vec3 bodyColor = uColorWaveDeep;\n    vec3 foamColor = uColorWave;\n    \n    /* Mix Colors */\n    vec3 finalColor = mix(bodyColor, foamColor, foamMix);\n    \n    /* Add streaks to the body part */\n    if (0.9 > foamMix) {\n        finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix);\n    }\n    \n    /* Hard Edge & Opacity */\n    /* Ensure the front (bottom) remains sharp, back trails off */\n    \n    /* Calculate Alpha based on Intensity */\n    /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */\n    /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */\n    /* Low Intensity (Top/Tail): Fades to 0.0 */\n    \n    float finalAlpha = smoothstep(0.02, 0.15, intensity);\n    \n    /* Screen Fade */\n    /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */\n    \n    /* Dynamic Shoreline Fade */\n    /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */\n    /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */\n    float speed = 1.2;\n    float time = uTime * speed;\n    float wave1 = sin(uv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n    float threshold = 0.428 + wave;\n    \n    /* Fade out quickly after exiting the water body (below threshold) */\n    /* Fade starts slightly higher than the threshold to soften the transition */\n    /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */\n    float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y);\n    \n    float screenFade = shoreFade;\n    \n    /* --- Composite Shadow & Wave --- */\n    float waveAlpha = finalAlpha * screenFade;\n    \n    /* Shadow Alpha */\n    float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity);\n    /* Shadow is weaker (40% opacity) */\n    float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade;\n    \n    /* Mix: Wave over Shadow */\n    /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */\n    float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha);\n    \n    /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */\n    /* Shadow is black (RGB=0), so second term is 0 */\n    vec3 outRGB = finalColor * waveAlpha; \n    \n    gl_FragColor = vec4(outRGB, outAlpha);\n}`,Kh=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,jh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Zh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var TS={};bt(TS,{WaterSystem:()=>$f,waterSystem:()=>qf});function MS(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function xa(e,t,n){let o=MS(e,e.VERTEX_SHADER,t),r=MS(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var m_,CS,h_,g_,$f,qf,Jh=De(()=>{_S();m_=[.2,.5,.9],CS=[.2,.9,1],h_=[1,1,1],g_=[.45,.8,1];$f=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:xa(s,pc,LS),simProgram:xa(s,pc,Zh),brushProgram:xa(s,Kh,jh),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=xa(this.glBg,pc,xS),this.bgSimProgram=xa(this.glBg,pc,Zh),this.bgBrushProgram=xa(this.glBg,Kh,jh)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,m=a/this.height,v=new Float32Array([u-d,f-m,0,0,1,u+d,f-m,1,0,1,u-d,f+m,0,1,1,u+d,f+m,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,v,t.DYNAMIC_DRAW);let p=t.getAttribLocation(n,"aPosition"),h=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(p),t.vertexAttribPointer(p,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let m=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=m.readFBO,f.writeFBO=m.writeFBO,f.readTexture=m.readTex,f.writeTexture=m.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),m_),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),CS),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),CS),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),h_),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),g_),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let m=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(m),d.vertexAttribPointer(m,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},qf=new $f});var PS={};bt(PS,{createSpawner:()=>x_});function OS(e){if(!e||typeof e!="object"){La=!1,Ji=0n;return}La=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Ji=n&&n!=="Infinity"?BigInt(n):0n}catch{Ji=0n}}function v_(e){let t=1-e;return 1-t*t*t}function S_(e){if(!e)return null;let t=AS.get(e);return t||(t=new Image,t.src=e,AS.set(e,t)),t}function x_({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=Qe?y_:1e4,initialBurst:d=1,coinTtlMs:m=1e99,waveSoundSrc:v="sounds/wave_spawn.ogg",waveSoundDesktopVolume:p=.45,waveSoundMobileVolume:h=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:y=!1}={}){let I=o,E={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function M(){return!!(E.pf&&E.w&&E.c)}M()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let N=7,G=[],P=[],$=!1;if(E.c)for(let w=0;w<N;w++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+w*10}`,E.c.appendChild(k);let O=k.getContext("2d",{alpha:!0});G.push(k),P.push(O)}let L=null,F=null;E.c&&(L=document.createElement("canvas"),L.style.position="absolute",L.style.inset="0",L.style.pointerEvents="none",L.style.zIndex="100",E.c.appendChild(L),F=L.getContext("2d",{alpha:!0}));let T={collectBatch:null,getMagnetUnit:null};function C(w){T={...T,...w}}let z={pfRect:null,wRect:null,safeBottom:0,pfW:0};function Q(){if(!M())return!1;let w=E.pf.getBoundingClientRect(),k=E.w.getBoundingClientRect(),O=E.hud?E.hud.getBoundingClientRect().height:0;z={pfRect:w,wRect:k,safeBottom:w.height-O,pfW:w.width};let R=window.devicePixelRatio||1;return G.forEach((B,pe)=>{if(B){B.width=w.width*R,B.height=w.height*R,B.style.width=w.width+"px",B.style.height=w.height+"px";let me=P[pe];me&&(me.setTransform(1,0,0,1,0,0),me.scale(R,R),me.imageSmoothingEnabled=!0,me.imageSmoothingQuality="high")}}),$=!0,L&&(L.width=w.width*R,L.height=w.height*R,L.style.width=w.width+"px",L.style.height=w.height+"px",F&&(F.setTransform(1,0,0,1,0,0),F.scale(R,R))),!0}Q();let ae="ResizeObserver"in window?new ResizeObserver(()=>Q()):null;ae&&E.pf&&ae.observe(E.pf),document.addEventListener("visibilitychange",()=>{document.hidden||Q()});let he=(w,k,O)=>Math.max(k,Math.min(O,w)),Se=Math.max(2e3,f*3),Oe=12,Ae=[],U=[],K=0,q=[],X=[];function J(){let w=document.createElement("div");w.className="coin",w.style.position="absolute",w.style.pointerEvents="auto",w.style.borderRadius="50%",w.style.willChange="transform",w.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=I,k.style.objectFit="contain",k.style.borderRadius="50%",w.appendChild(k),y&&(w.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),w}let le=()=>Ae.length?Ae.pop():J();function fe(w){w.style.transition="",w.style.transform="",w.style.opacity="1",w.classList.remove("coin--collected");for(let k=0;k<=6;k++)w.classList.remove(`coin--size-${k}`);w.style.removeProperty("--ccc-start"),delete w.dataset.dieAt,delete w.dataset.mutationLevel,delete w.dataset.collected,w.style.willChange="transform",w.parentNode&&w.remove(),Ae.length<Se&&Ae.push(w)}function _(w,k=-1){if(w.isRemoved)return;w.isRemoved=!0;let O=k;(O===-1||U[O]!==w)&&(w.index!==void 0&&U[w.index]===w?O=w.index:O=U.indexOf(w)),O!==-1&&(U[O]=null,K++),w.el?(fe(w.el),w.el=null):X.push({layer:w.sizeIndex||0,x:w.x,y:w.y,size:w.size||r})}function Y(w){let k=w._coinObj;if(k){let O=-1;k.index!==void 0&&U[k.index]===k?O=k.index:O=U.indexOf(k),O!==-1&&(U[O]=null,K++),w._coinObj=null}}let ie=new URL(v,document.baseURI).href,de=0;function H(){let w=performance.now();if(w-de<g)return;de=w,mt(ie,{volume:Qe?h:p,type:"music"})}function ee(){if(!M())return null;if((!z.pfRect||!z.wRect)&&Q(),f!==1/0&&U.length-K>=f){let Ct=-1;if(se(2))for(let Ft=0;Ft<U.length;Ft++){let ko=U[Ft];if(ko&&ko.sizeIndex<4){Ct=Ft;break}}else for(let Ft=0;Ft<U.length;Ft++)if(U[Ft]){Ct=Ft;break}if(Ct===-1)return null;let Bt=U[Ct];Bt&&_(Bt,Ct)}let w=z.pfW,k=z.wRect.top-z.pfRect.top,O=Math.max(0,k),R=0;if(se(2)){let Ct=Math.random();for(let Bt=6;Bt>=1;Bt--)if(Ct<w_[Bt]){R=Bt;break}}R>=4&&Yl&&Yl()&&(R=3);let B=kS[R],pe=Oe+(R>=3?15*(R-2):0),me=pe,Le=Math.max(me,w-B-pe),Ce=me+Math.random()*(Le-me),je=Math.random()*100-50,Xe;if(B>=z.pfW)Xe=(z.pfW-B)/2;else{let Ct=z.pfW-B-pe;me>=Ct?Xe=(z.pfW-B)/2:Xe=he(Ce+je,me,Ct)}let qe=Math.min(z.wRect.height,z.pfRect.height*.3),Me=Math.max(qe+80,120),Pe=Math.max(Me+40,z.safeBottom-B-6),Ee=he(Me+Math.random()*(Pe-Me),Me,Pe),We={x0:Ce,y0:O,x1:Xe,y1:Ee,jitterMs:0},it=z.pfRect.left-z.wRect.left,Ve=E_[R],Pt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),ct=.85+Math.random()*.3,Lt=Pt*(Ve.w/100)*ct,zt=Pt*(Ve.h/100)*ct,Kt=Ce+B/2+it,Kn=O-k;return{wave:{x:Kt,y:Kn,width:Lt,height:zt},coin:We,sizeIndex:R}}function ge(w){if(!w.length||!M())return;let k=document.createDocumentFragment(),O=[],R=performance.now(),B=!1;for(let{wave:pe,coin:me,sizeIndex:Le}of w){if(pe&&(B=!0,qf)){let Pe=Le>=4;qf.addWave(pe.x,pe.y,pe.width,pe.height,Pe)}let Ce=kS[Le],je=1;if(se(8)){let Pe=mp(),Ee=Math.pow(25,Pe);je=Math.pow(Ee,Le)}else je=I_[Le];let Xe=Le>=4,qe=le();qe.style.width=`${Ce}px`,qe.style.height=`${Ce}px`,qe.className=`coin coin--size-${Le}`,qe.firstChild&&(qe.firstChild.src=I),qe.style.transform=`translate3d(${me.x0}px, ${me.y0}px, 0) rotate(-10deg) scale(0.96)`,qe.style.opacity="0",La?qe.dataset.mutationLevel=Ji.toString():qe.dataset.mutationLevel="0";let Me={mutationLevel:La?Ji.toString():"0",el:qe,src:I,x:me.x0,y:me.y0,rot:-10,scale:.96,startX:me.x0,startY:me.y0,endX:me.x1,endY:me.y1,startTime:R+me.jitterMs,duration:i,dieAt:R+m,jitterMs:me.jitterMs,isRemoved:!1,settled:!1,size:Ce,sizeIndex:Le,valueMultiplier:je,forceDom:Xe,soundSrc:RS[Le]?`sounds/coin_pickup${RS[Le]}`:null,bMinX:Math.min(me.x0,me.x1)-Ce,bMaxX:Math.max(me.x0,me.x1)+Ce,bMinY:Math.min(me.y0,me.y1)-Ce,bMaxY:Math.max(me.y0,me.y1)+Ce};qe._coinObj=Me,Me.index=U.length,U.push(Me),O.push(Me),k.appendChild(qe)}E.c.appendChild(k),O.length>0&&(O[0].el&&O[0].el.offsetHeight,requestAnimationFrame(()=>{for(let pe of O)pe.el&&(pe.el.style.transition=`transform ${i}ms ${b_} ${pe.jitterMs}ms`,pe.el.style.transform=`translate3d(${pe.endX}px, ${pe.endY}px, 0) rotate(0deg) scale(1)`,pe.el.style.opacity="1")})),B&&requestAnimationFrame(()=>{H()})}function Be(w=1){if(!M())return;(!z.pfRect||!z.wRect)&&Q();let k=[];for(let O=0;O<w;O++){let R=ee();R&&k.push(R)}k.length&&ge(k)}function ne(w,k){if(w.settled||w.isRemoved)return{x:w.x,y:w.y,rot:0,scale:1};let O=k-w.startTime;if(O<0)return{x:w.startX,y:w.startY,rot:-10,scale:.96};let R=O/w.duration;if(R>=1)return{x:w.endX,y:w.endY,rot:0,scale:1};let B=v_(R),pe=w.startX+(w.endX-w.startX)*B,me=w.startY+(w.endY-w.startY)*B,Le=-10+10*B,Ce=.96+.04*B;return{x:pe,y:me,rot:Le,scale:Ce}}function ve(w,k){let O=S_(k.src);if(O&&O.complete&&O.naturalWidth>0){let R=k.size||r;w.drawImage(O,k.x,k.y,R,R)}}function Ue(){if(P.length)if($){P.forEach((k,O)=>{G[O]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,G[O].width,G[O].height),k.restore(),y&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let w=U.length;for(let k=0;k<w;k++){let O=U[k];if(O&&O&&O.settled&&!O.isRemoved&&!O.el){let R=O.sizeIndex||0;P[R]&&ve(P[R],O)}}y&&P.forEach(k=>k.restore()),$=!1,q.length=0,X.length=0}else{if(X.length>0){y&&P.forEach(k=>{k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2});let w=U.length;for(let k=0;k<X.length;k++){let O=X[k],R=P[O.layer];if(!R)continue;let B=8,pe=O.x-B,me=O.y-B,Le=O.size+B*2;R.save(),R.beginPath(),R.rect(pe,me,Le,Le),R.clip(),R.clearRect(pe,me,Le,Le);let Ce=pe,je=pe+Le,Xe=me,qe=me+Le;for(let Me=0;Me<w;Me++){let Pe=U[Me];if(!Pe||!Pe.settled||Pe.isRemoved||Pe.el||(Pe.sizeIndex||0)!==O.layer)continue;let Ee=Pe.size||r,Ze=Pe.x,We=Pe.x+Ee,it=Pe.y,Ve=Pe.y+Ee;We>Ce&&Ze<je&&Ve>Xe&&it<qe&&ve(R,Pe)}R.restore()}y&&P.forEach(k=>k.restore()),X.length=0}if(q.length>0){y&&P.forEach(w=>{w.save(),w.shadowColor="rgba(0,0,0,0.35)",w.shadowBlur=2,w.shadowOffsetY=2});for(let w=0;w<q.length;w++){let k=q[w];if(!k.isRemoved&&k.settled&&!k.el){let O=k.sizeIndex||0;P[O]&&ve(P[O],k)}}y&&P.forEach(w=>w.restore()),q.length=0}}}let ke=a,Fe=null,ce=performance.now(),te=0;function xe(w){(!z.pfRect||!z.wRect)&&Q();let k=(w-ce)/1e3;ce=w,k>.1&&(k=.1);for(let R=U.length-1;R>=0;R--){let B=U[R];if(!B||!B)continue;if(w>=B.dieAt){_(B,R);continue}if(B.sizeIndex===5&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=w-1e3,B.nextLightningInterval=0),w-B.lastLightningTime>B.nextLightningInterval)){B.lastLightningTime=w,B.nextLightningInterval=200+Math.random()*100;for(let Le=0;Le<3;Le++)Yo(B,w)}if(B.sizeIndex===6&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=w-1e3,B.nextLightningInterval=0),w-B.lastLightningTime>B.nextLightningInterval&&(B.lastLightningTime=w,B.nextLightningInterval=200+Math.random()*100,T.collectBatch))){let Le=ne(B,w),Ce=Le.x+B.size/2,je=Le.y+B.size/2,Xe=[],qe=B.size/2*(B.size/2),Me=U.length;for(let Pe=0;Pe<Me;Pe++){let Ee=U[Pe];if(!Ee||Ee===B||Ee.isRemoved||Ee.settled===!1||Ee.sizeIndex>3)continue;let Ze=Ee.x+(Ee.size||r)/2,We=Ee.y+(Ee.size||r)/2,it=Ze-Ce,Ve=We-je;it*it+Ve*Ve>qe&&Xe.push(Ee)}if(Xe.length>0){for(let We=Xe.length-1;We>0;We--){let it=Math.floor(Math.random()*(We+1));[Xe[We],Xe[it]]=[Xe[it],Xe[We]]}let Pe=Xe.slice(0,3),Ee=[],Ze=!1;for(let We of Pe){let it=We.size||r,Ve=We.x+it/2,Pt=We.y+it/2;wr(B,Ve,Pt),Vo(Ve,Pt,it),Ee.push({coin:We}),Ze||(mt("sounds/lightning_strike.ogg",{volume:.25}),Ze=!0)}Ee.length>0&&T.collectBatch(Ee)}}if(B.settled)continue;let pe=w-B.startTime;if(pe<0)continue;if(pe/B.duration>=1){B.settled=!0,B.x=B.endX,B.y=B.endY,B.rot=0,B.scale=1,B.el&&!B.forceDom?(fe(B.el),B.el=null,q.push(B)):B.el&&(B.el.style.transition="none",B.el.style.transform=`translate3d(${B.x}px, ${B.y}px, 0) rotate(0deg) scale(1)`);continue}}te+=ke*k;let O=Math.floor(te);if(O>0){te-=O;let R=Math.min(O,u);if(R>0){let B=performance.now(),pe=[],me=5;for(let Le=0;Le<R&&!(performance.now()-B>me);Le++){let Ce=ee();Ce&&pe.push(Ce)}pe.length&&ge(pe)}}if(Ue(),K>50){let R=0;for(let B=0;B<U.length;B++){let pe=U[B];pe!==null&&(pe.index=R,U[R++]=pe)}U.length=R,K=0}Ne(k),Fe=requestAnimationFrame(xe)}function x(){if(!Fe){if(!M()){console.warn("[Spawner] start() called but required nodes are missing.");return}Q(),d>0&&Fe===null&&Be(d),ce=performance.now(),Fe=requestAnimationFrame(xe)}}function j(){Fe&&(cancelAnimationFrame(Fe),Fe=null)}function Z(w){ke=Math.max(0,Number(w)||0)}function oe(){te=0,ce=performance.now()}function ye(w){let k=se(2)&&!!w;for(let O=U.length-1;O>=0;O--){let R=U[O];if(R&&R){if(k&&R.sizeIndex>=4){R.mutationLevel=La?Ji.toString():"0",R.el&&(R.el.dataset.mutationLevel=R.mutationLevel);continue}_(U[O],O)}}oe()}function ue(w){w&&(I=w)}function ze(w){let k=w._coinObj;if(!k)return w.style.transform||"translate3d(0,0,0)";let{x:O,y:R,rot:B,scale:pe}=ne(k,performance.now());return`translate3d(${O}px, ${R}px, 0) rotate(${B}deg) scale(${pe})`}function rt(w){if(w.el)return w.el;if(w.isRemoved)return null;let k=le(),O=w.size||r;return k.style.width=`${O}px`,k.style.height=`${O}px`,k.className=`coin coin--size-${w.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${w.x}px, ${w.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=w.src),k.style.opacity="1",k.dataset.mutationLevel=w.mutationLevel,k._coinObj=w,w.el=k,E.c.appendChild(k),X.push({layer:w.sizeIndex||0,x:w.x,y:w.y,size:w.size||r}),k}function we(w,k,O,R){let B=O;R&&(B=Math.max(O,260));let pe=O*O,me=[],Le=U.length,Ce=w-B,je=w+B,Xe=k-B,qe=k+B,Me=performance.now();for(let Pe=0;Pe<Le;Pe++){let Ee=U[Pe];if(!Ee||Ee.bMaxX<Ce||Ee.bMinX>je||Ee.bMaxY<Xe||Ee.bMinY>qe)continue;let Ze=Ee.size||r,We,it;if(Ee.settled)We=Ee.x+Ze/2,it=Ee.y+Ze/2;else{let Lt=ne(Ee,Me);We=Lt.x+Ze/2,it=Lt.y+Ze/2}if(We<Ce||We>je||it<Xe||it>qe)continue;let Ve=We-w,Pt=it-k,ct=pe;if(R&&(Ee.sizeIndex||0)>0){let Lt=Ze/2;ct=Lt*Lt}Ve*Ve+Pt*Pt<=ct&&(Ee.isRemoved||me.push(Ee))}return me}function He(w,k,O,R,B,pe){let me=B;pe&&(me=Math.max(B,260));let Le=B*B,Ce=[],je=U.length,Xe=Math.min(w,O)-me,qe=Math.max(w,O)+me,Me=Math.min(k,R)-me,Pe=Math.max(k,R)+me,Ee=O-w,Ze=R-k,We=Ee*Ee+Ze*Ze,it=Le*We,Ve=performance.now();for(let Pt=0;Pt<je;Pt++){let ct=U[Pt];if(!ct||ct.bMaxX<Xe||ct.bMinX>qe||ct.bMaxY<Me||ct.bMinY>Pe)continue;let Lt=ct.size||r,zt,Kt;if(ct.settled)zt=ct.x+Lt/2,Kt=ct.y+Lt/2;else{let hn=ne(ct,Ve);zt=hn.x+Lt/2,Kt=hn.y+Lt/2}if(zt<Xe||zt>qe||Kt<Me||Kt>Pe)continue;let Kn=zt-w,Ct=Kt-k,Bt=Kn*Ee+Ct*Ze,Ft=Le;if(pe&&(ct.sizeIndex||0)>0){let hn=Lt/2;Ft=hn*hn}let ko=!1;if(Bt<=0)Kn*Kn+Ct*Ct<=Ft&&(ko=!0);else if(Bt>=We){let hn=zt-O,Pa=Kt-R;hn*hn+Pa*Pa<=Ft&&(ko=!0)}else{let hn=Kn*Ze-Ct*Ee;hn*hn<=Ft*We&&(ko=!0)}ko&&!ct.isRemoved&&Ce.push(ct)}return Ce}function Wt(w){_(w)}function gt(w,k,O){let R=O*O,B=[],pe=U.length,me=w-O,Le=w+O,Ce=k-O,je=k+O,Xe=performance.now();for(let qe=0;qe<pe;qe++){let Me=U[qe];if(!Me||Me.bMaxX<me||Me.bMinX>Le||Me.bMaxY<Ce||Me.bMinY>je)continue;let Pe=Me.size||r,Ee,Ze;if(Me.settled)Ee=Me.x+Pe/2,Ze=Me.y+Pe/2;else{let Ve=ne(Me,Xe);Ee=Ve.x+Pe/2,Ze=Ve.y+Pe/2}if(Ee<me||Ee>Le||Ze<Ce||Ze>je)continue;let We=Ee-w,it=Ze-k;We*We+it*it<=R&&(!Me.el&&!Me.isRemoved&&rt(Me),Me.el&&B.push(Me.el))}return B}function mn(w,k,O,R,B){let pe=B*B,me=[],Le=U.length,Ce=Math.min(w,O)-B,je=Math.max(w,O)+B,Xe=Math.min(k,R)-B,qe=Math.max(k,R)+B,Me=O-w,Pe=R-k,Ee=Me*Me+Pe*Pe,Ze=pe*Ee,We=performance.now();for(let it=0;it<Le;it++){let Ve=U[it];if(!Ve||Ve.bMaxX<Ce||Ve.bMinX>je||Ve.bMaxY<Xe||Ve.bMinY>qe)continue;let Pt=Ve.size||r,ct,Lt;if(Ve.settled)ct=Ve.x+Pt/2,Lt=Ve.y+Pt/2;else{let Bt=ne(Ve,We);ct=Bt.x+Pt/2,Lt=Bt.y+Pt/2}if(ct<Ce||ct>je||Lt<Xe||Lt>qe)continue;let zt=ct-w,Kt=Lt-k,Kn=zt*Me+Kt*Pe,Ct=!1;if(Kn<=0)zt*zt+Kt*Kt<=pe&&(Ct=!0);else if(Kn>=Ee){let Bt=ct-O,Ft=Lt-R;Bt*Bt+Ft*Ft<=pe&&(Ct=!0)}else{let Bt=zt*Pe-Kt*Me;Bt*Bt<=Ze&&(Ct=!0)}Ct&&(!Ve.el&&!Ve.isRemoved&&rt(Ve),Ve.el&&me.push(Ve.el))}return me}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;Fe||x()}});function zn(){M()&&Be(1)}let qt=[],Tn=[];function ni(w,k){if(!w||!k)return;let O=w.size||r,R=k.size||r,B=w.x+O/2,pe=w.y+O/2,me=k.x+R/2,Le=k.y+R/2;qt.push({x1:B,y1:pe,x2:me,y2:Le,age:0,life:.15})}function Vo(w,k,O){if(!E.pf)return;let R=document.createElement("div");R.className="coin-stain";let B=O*1.2;R.style.width=`${B}px`,R.style.height=`${B}px`,R.style.left=`${w-B/2}px`,R.style.top=`${k-B/2}px`,E.pf.appendChild(R),setTimeout(()=>{R.style.opacity="0",setTimeout(()=>{R.parentNode&&R.remove()},1e3)},2500)}function Yo(w,k){let O=Math.random()*Math.PI*2,R=(w.size||r)/2,B=R*NS,pe=Math.cos(O)*B,me=Math.sin(O)*B,Le=R*(.7+Math.random()*.6),Ce=Math.cos(O)*(B+Le),je=Math.sin(O)*(B+Le);qt.push({parentCoin:w,relX1:pe,relY1:me,relX2:Ce,relY2:je,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let Xe=3+Math.floor(Math.random()*3);for(let qe=0;qe<Xe;qe++){let Me=.3+Math.random()*.5,Pe=pe+(Ce-pe)*Me,Ee=me+(je-me)*Me,Ze=O+(Math.random()*1.2-.6),We=Le*(.4+Math.random()*.4),it=Pe+Math.cos(Ze)*We,Ve=Ee+Math.sin(Ze)*We;qt.push({parentCoin:w,relX1:Pe,relY1:Ee,relX2:it,relY2:Ve,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}mt("sounds/lightning_zap.ogg",{volume:.25})}function wr(w,k,O){if(!w)return;let R=w.size||r,B=performance.now(),pe=ne(w,B),me=pe.x+R/2,Le=pe.y+R/2,Ce=k-me,je=O-Le,Xe=Math.atan2(je,Ce),qe=Math.sqrt(Ce*Ce+je*je),Me=R/2*NS,Pe=Math.cos(Xe)*Me,Ee=Math.sin(Xe)*Me;qt.push({parentCoin:w,relX1:Pe,relY1:Ee,x2:k,y2:O,age:0,life:.25,width:6,jaggedScale:25});let Ze=me+Pe,We=Le+Ee,it=6+Math.floor(Math.random()*5);for(let Ve=0;Ve<it;Ve++){let Pt=.1+Math.random()*.8,ct=Ze+(k-Ze)*Pt,Lt=We+(O-We)*Pt,zt=Xe+(Math.random()*1.6-.8),Kt=qe*(.1+Math.random()*.3),Kn=ct+Math.cos(zt)*Kt,Ct=Lt+Math.sin(zt)*Kt;if(qt.push({x1:ct,y1:Lt,x2:Kn,y2:Ct,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Ft=ct+(Kn-ct)*.5,ko=Lt+(Ct-Lt)*.5,hn=zt+(Math.random()*1-.5),Pa=Kt*.5;qt.push({x1:Ft,y1:ko,x2:Ft+Math.cos(hn)*Pa,y2:ko+Math.sin(hn)*Pa,age:0,life:.25,width:1.5,jaggedScale:10})}}}function Ne(w){if(!F||!L)return;F.clearRect(0,0,L.width,L.height);let k=performance.now();F.lineCap="round",F.lineJoin="round";for(let O=qt.length-1;O>=0;O--){let R=qt[O];if(R.age+=w,R.age>=R.life){qt.splice(O,1);continue}let B=R.x1,pe=R.y1,me=R.x2,Le=R.y2;if(R.parentCoin){let Xe=ne(R.parentCoin,k),qe=Xe.x+(R.parentCoin.size||r)/2,Me=Xe.y+(R.parentCoin.size||r)/2;B=qe+R.relX1,pe=Me+R.relY1,R.relX2!==void 0&&(me=qe+R.relX2,Le=Me+R.relY2)}let Ce=1-R.age/R.life;F.strokeStyle=`rgba(200, 240, 255, ${Ce})`,F.lineWidth=R.width||3,F.shadowColor="rgba(220, 245, 255, 0.9)",F.shadowBlur=20;let je=6;F.beginPath(),F.moveTo(B,pe);for(let Xe=1;Xe<=je;Xe++){let qe=Xe/je,Me=B+(me-B)*qe,Pe=pe+(Le-pe)*qe;if(Xe===je)F.lineTo(me,Le);else{let Ee=-(Le-pe),Ze=me-B,We=Math.sqrt(Ee*Ee+Ze*Ze),it=R.jaggedScale||40;if(We>0){let Ve=(Math.random()-.5)*it*(1-Math.abs(qe-.5));F.lineTo(Me+Ee/We*Ve,Pe+Ze/We*Ve)}else F.lineTo(Me,Pe)}}F.stroke(),F.shadowBlur=0}for(let O=Tn.length-1;O>=0;O--){let R=Tn[O];if(R.age+=w,R.age>=R.life){Tn.splice(O,1);continue}R.x+=R.vx*w,R.y+=R.vy*w;let B=1-R.age/R.life;F.fillStyle=R.color,F.globalAlpha=B,F.beginPath(),F.arc(R.x,R.y,R.size,0,Math.PI*2),F.fill(),F.globalAlpha=1}}return{start:x,stop:j,setRate:Z,clearBacklog:oe,clearPlayfield:ye,setCoinSprite:ue,getCoinTransform:ze,findCoinsInRadius:gt,findCoinsInPath:mn,findCoinTargetsInRadius:we,findCoinTargetsInPath:He,ensureCoinVisual:rt,removeCoinTarget:Wt,detachCoin:Y,recycleCoin:fe,playEntranceWave:zn,setDependencies:C,hasBigCoins:()=>se(2)&&U.some(w=>w&&w.sizeIndex>=4)}}var La,Ji,y_,AS,b_,kS,NS,I_,w_,RS,E_,BS=De(()=>{kc();bo();Io();Sn();An();Jh();vo();La=!1,Ji=0n,y_=2500,AS=new Map;try{OS(vt())}catch{La=!1,Ji=0n}try{Fi(e=>{OS(e)})}catch{}b_="cubic-bezier(0.215, 0.61, 0.355, 1)";kS=[40,55,80,125,200,320,512],NS=.78,I_=[1,25,625,15625,390625,9765625,244140625],w_=[0,.1,.01,.001,1e-4,1e-5,1e-6],RS=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],E_=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var XS={};bt(XS,{afterSlotWrite:()=>og,beforeSlotWrite:()=>ng});function qS(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function M_(e,t=__){!e||e<=0||mc.set(e,qS()+t)}function US(e){if(!e||e<=0)return!1;let t=mc.get(e);return t==null?!1:t<=qS()?(mc.delete(e),!1):!0}function T_(){mc.clear()}function Hf(){try{return typeof localStorage<"u"}catch{return!1}}function tg(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function GS(e){let t=new Map;if(!Hf())return hc.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(rs))continue;let r=tg(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return hc.set(e,t),t}function HS(e){return!Number.isFinite(e)||e<=0?null:hc.has(e)?hc.get(e):GS(e)}function ng(e){if(!Hf()||Gf>0)return;let t=String(e);if(!t.startsWith(rs))return;let n=tg(t);if(n==null)return;let o=HS(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(Gf===0){Gf+=1;try{kn(n)}finally{Gf-=1}}GS(n);return}}}catch{}}function og(e,t){let n=String(e);if(!n.startsWith(rs))return;let o=tg(n);if(o==null)return;let r=HS(o)||new Map;r.set(n,String(t??"")),hc.set(o,r)}function A_(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function k_(){let e=new Map;if(!Hf())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(rs))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=pd(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function N_(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function R_(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=md(e);if(n.length===0){o&&(US(e)||kn(e),_c(e,null));return}let r=A_(n);o&&r!==o&&!US(e)&&kn(e),r!==o&&_c(e,r)}function Ca(){if(!Hf())return;let e=k_();N_(e).forEach(n=>{let o=e.get(n)??[];R_(n,o)})}function O_(){if(Qh!=null)return;Qh=(typeof window<"u"?window:globalThis).setTimeout(()=>{Qh=null,Ca()},C_)}function P_(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){M_(o),O_();return}mc.delete(o),Ca()}}function B_(){typeof window>"u"||FS==null&&(FS=window.setInterval(Ca,L_))}function F_(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function _a(){let e=F_();if(!e)return;if(!is()){(e.dataset.poopShopApplied===eg||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==DS||e.dataset.poopShopApplied!==eg)&&(e.style.backgroundImage=DS,e.dataset.poopShopApplied=eg)}function U_(){typeof window>"u"||$S==null&&(_a(),$S=window.setInterval(_a,50),window.addEventListener("saveSlot:change",_a),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&_a()}catch{_a()}}))}function D_(){typeof window>"u"||(Ca(),B_(),U_(),window.addEventListener("saveSlot:change",()=>Ca()),window.addEventListener("saveIntegrity:storageMutation",P_,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(T_(),Ca(),_a())}))}var L_,__,C_,FS,Qh,mc,hc,Gf,DS,eg,$S,rg=De(()=>{St();L_=1e4,__=750,C_=50,FS=null,Qh=null,mc=new Map;hc=new Map,Gf=0;DS="linear-gradient(180deg,#a9793d,#7b5534)",eg="1",$S=null;D_()});var eI={};bt(eI,{initPopups:()=>X_,teardownpopups:()=>V_});function ig(){return Ao||(Ao=document.createElement("div"),Ao.className="currency-popups",Ao.setAttribute("aria-live","polite"),Ao.setAttribute("aria-atomic","false"),document.body.appendChild(Ao),Ao)}function Qi(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function sg(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function YS(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):W(n);t&&(t.innerHTML=r)}function q_(e,t=WS){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{gc.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function G_(e,t,n){ig();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function ag(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(Zt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(Zt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Re).includes(e)&&gn(e,o))return}let r=$_[e],i=Object.assign({duration:WS,accumulate:!0},r||{},n);if(!i.icon)return;let s=Qi(t);if(!s||sg(s))return;let l=i.accumulate!==!1?gc.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,YS(l);return}let a=G_(e,i,s);a.meta=i,YS(a),gc.set(e,a);let u=ig(),f=VS.indexOf(e),d=null;if(f>=0){let m=Array.from(u.children);for(let v of m){let p=v.dataset.type;if(VS.indexOf(p)>f){d=v;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),q_(a,i.duration)}function H_(){let e={};for(let t of Object.values(Re))e[t]=qa(t);return e}function zS(){try{let e=H_();Object.entries(e).forEach(([t,n])=>{let o=Qi(n)||c.fromInt(0);ei.set(t,o.clone?.()??o)}),ei.has("mp")||ei.set("mp",c.fromInt(0))}catch{ei.clear()}}function KS(){gc.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),gc.clear()}function jS(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Qi(t.value)||c.fromInt(0),r=ei.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Qi(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&ag(n,s),ei.set(n,o.clone?.()??o)}function ZS(e){let t=e?.detail;if(!t)return;let n=Qi(t.xpAdded);n&&!sg(n)&&ag("xp",n)}function JS(e){let t=e?.detail;if(!t)return;let n=Qi(t.delta);n&&!sg(n)&&ag("mp",n);let o=Qi(t.progress);o&&ei.set("mp",o.clone?.()??o)}function QS(){KS(),zS()}function X_(){Xf||(Xf=!0,ig(),zS(),window.addEventListener("currency:change",jS),window.addEventListener("xp:change",ZS),window.addEventListener("mutation:change",JS),window.addEventListener("saveSlot:change",QS))}function V_(){Xf&&(window.removeEventListener("currency:change",jS),window.removeEventListener("xp:change",ZS),window.removeEventListener("mutation:change",JS),window.removeEventListener("saveSlot:change",QS),KS(),ei.clear(),Ao&&Ao.remove(),Ao=null,Xf=!1)}var WS,VS,$_,Ao,Xf,ei,gc,tI=De(()=>{Et();Gt();St();WS=6767,VS=["coins","xp","books","gold","mp","magic","gears","dna"],$_={[Re.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Re.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Re.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Re.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Re.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Re.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},Ao=null,Xf=!1,ei=new Map,gc=new Map});var cI={};bt(cI,{flushBackupSnapshot:()=>lI,getSuspendMetadata:()=>lC,installSuspendSafeguards:()=>aC,markProgressDirty:()=>Ho,restoreFromBackupIfNeeded:()=>sC});function yc(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function Na(){if(typeof localStorage>"u")return!1;try{let e=`${mo}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function iI(){if(!yc())throw new Error("IndexedDB unavailable");return Ma||(Ma=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(Y_,W_);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(ka)||r.createObjectStore(ka)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}Ma=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw Ma=null,e}),Ma)}function Z_(){if(!Na())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(mo))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function J_(e){try{let t=await iI();return await new Promise((n,o)=>{let r=!1,i=t.transaction(ka,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(ka).put(e,rI);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function Q_(){try{let e=await iI();return await new Promise((t,n)=>{let o=!1,r=e.transaction(ka,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(ka).get(rI);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function eC(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function lg(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function tC(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function oC(e){return!(typeof e!="string"||e.length===0||nC.test(e))}function cg(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(mo)||n.startsWith(z_)||n.startsWith(K_))return;let o=tC(n);if(o!=null)try{let r={key:n,slot:o,trusted:oC(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function rC(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=lg(),a=String(i),u=this===localStorage&&a.startsWith(mo);if(u)try{ng(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Ho("setItem");try{og(a,s)}catch{}}this===localStorage&&a.startsWith(mo)&&cg(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=lg(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(mo)&&(Ho("removeItem"),cg(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=lg(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Ho("clear"),cg(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function sI(e="idle"){Aa=e||Aa,ti=!0,!Ta&&(Ta=setTimeout(()=>{if(Ta=null,!ti)return;let t=Aa;ti=!1,lI(t)},j_))}function aI(){Ta&&(clearTimeout(Ta),Ta=null)}function Ho(e="dirty"){try{sI(e)}catch{}}async function ug(e="manual"){if(!Na()||!yc())return!1;let t=Z_();if(!t)return!1;t.reason=e,Yf=!1;let n=await J_(t);return n||(ti=!0,sI("retry")),n}async function lI(e="manual",{immediate:t=!1}={}){return!Na()||!yc()?!1:t?(aI(),ti=!1,Yf=!0,ug(e)):(ti=!0,Aa=e||Aa,ug(e))}function Vf(e){!yc()||!Na()||(aI(),ti=!1,Yf=!0,ug(e))}function iC(){if(!Na())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(mo))return!0}}catch{}return!1}async function sC(){if(oI||(oI=!0,!Na()||!yc()))return!1;let e=!1;try{if(!iC())e=!0;else{let o=localStorage.getItem(`${mo}saveSlot`);if(o){let r=`${mo}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await Q_();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Ho("restored"),n}function aC(){if(nI||(nI=!0,typeof window>"u"))return;eC(),rC();let e=()=>{document.hidden?Vf("visibility-hidden"):Ho("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>Vf("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>Vf("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>Vf("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Ho("pageshow"))}catch{}try{window.addEventListener("focus",()=>Ho("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(mo)||Ho("storage-event"))})}catch{}Ho("boot")}function lC(){return{pendingImmediateFlush:Yf,dirty:ti,lastDirtyReason:Aa}}var mo,Y_,W_,ka,rI,z_,K_,j_,Ma,Ta,ti,Aa,nI,oI,Yf,nC,uI=De(()=>{rg();mo="ccc:",Y_="ccc:safety",W_=1,ka="snapshots",rI="latest",z_=`${mo}slotSig`,K_=`${mo}slotMod`,j_=1e3,Ma=null,Ta=null,ti=!1,Aa="init",nI=!1,oI=!1,Yf=!1;nC=/\bat <anonymous>:\d+:\d+\b/});var fI={};bt(fI,{initGlobalOverlayEsc:()=>fC});function uC(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i,closeAll:s}of cC){let l=document.querySelectorAll(o);if(l.length>0){if(i){t=!0;continue}if(s)l.forEach(a=>{let u=a.querySelector(r||".shop-close");u&&(u.click(),n=!0)});else{let u=l[l.length-1].querySelector(r||".shop-close");u&&(u.click(),n=!0)}}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function fC(){window.addEventListener("keydown",uC,!0)}var cC,dI=De(()=>{cC=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close",closeAll:!0}]});var pI={};bt(pI,{ensureGameDom:()=>dC});function dC(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var mI=De(()=>{});var hI={};bt(hI,{SHOW_FPS:()=>pC,initFpsTracker:()=>mC});function mC(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var pC,gI=De(()=>{pC=!0});var bI={};bt(bI,{initNotifications:()=>vC,showNotification:()=>vI,unpauseNotifications:()=>gC});function hC(){return Ra||(Ra=document.createElement("div"),Ra.className="notification-container",document.body.appendChild(Ra),Ra)}function gC(){yI=!1,dg()}async function dg(){if(fg||yI||Wf.length===0)return;fg=!0;let{text:e,iconSrc:t,duration:n}=Wf.shift();await yC(e,t,n),fg=!1,Wf.length>0&&dg()}function yC(e,t,n){return new Promise(o=>{let r=hC(),i=document.createElement("div");if(i.className="notification",t){let l=document.createElement("img");l.src=t,l.className="notification-icon",l.alt="",i.appendChild(l)}let s=document.createElement("div");s.className="notification-text",s.innerHTML=e,i.appendChild(s),r.appendChild(i),mt("sounds/notif_ding.ogg",{volume:.5}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.classList.add("is-visible")})}),setTimeout(()=>{i.classList.remove("is-visible"),i.classList.add("is-leaving");let l=()=>{i.remove(),o()};i.addEventListener("transitionend",l,{once:!0}),setTimeout(()=>{i.isConnected&&(i.remove(),o())},600)},n)})}function vI(e,t,n=5e3){Wf.push({text:e,iconSrc:t,duration:n}),dg()}function vC(){typeof window>"u"||window.addEventListener("lab:node:change",e=>{let{id:t,level:n}=e.detail||{};if(!t||n==null)return;let o=Fn.get(t);if(!o)return;let r=o.maxLevel;if(n<r||n0())return;let i=o.title||"Node";vI(`${i}<br>Maxed!`,"img/"+o.icon)})}var Ra,Wf,fg,yI,SI=De(()=>{nr();An();Ws();Ra=null,Wf=[],fg=!1,yI=!0});function IC(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function wC(){if(!Qe)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function PI(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=Qe?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function Oa(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function BI(e,t,n,o=500){!e||e.__done||(e.__done=!0,e.__label&&(n?e.__label.textContent=n:e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(async()=>{if(typeof t=="function")try{t()}catch(i){console.error(i)}await VI(),e.style.opacity="0";let r=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",r,{once:!0}),setTimeout(r,450)},o))}async function gg(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function EC(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function xC(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(An(),Sc));await o(n)}catch{}try{t?.(n)}catch{}return n})}function LC(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function _C({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...EC(e,s),...xC(t,s),...n?LC(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function CC(e){if(ts===e)return;pn&&(pn.stop(),pn=null),ts=e;let t=document.querySelector(".menu-root");switch(e){case Xo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{ts===Xo.STARTER_COVE&&(pn=mt("sounds/The_Cove.ogg",{loop:!0,type:"music"}),typeof Zf=="function"&&Zf())},300)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Eg=="function"&&Eg(n,80),es){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(es.init("water-background",i),Kf){try{Kf()}catch{}Kf=null}if(jf){try{jf()}catch{}jf=null}typeof Ig=="function"&&(Kf=Ig(s=>es.update(s))),typeof wg=="function"&&(jf=wg((s,l)=>es.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,es&&requestAnimationFrame(()=>es.resize()),DI()),typeof vg=="function")try{vg()}catch{}if(typeof bg=="function")try{bg()}catch{}if(!sn){sn=FI({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=sn;let i=()=>{if(!(!sn||typeof sn.setCoinSprite!="function"))try{sn.setCoinSprite(HI?.())}catch{}};i(),XI?.(i);let s=UI({spawner:sn});sn&&typeof sn.setDependencies=="function"&&sn.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=$I(),u=qI(a);if(sn&&u?.coinsPerSecondMult){let f=1*u.coinsPerSecondMult;if(typeof Sg=="function"){let d=Sg("spawnRate",f);try{d&&typeof d.toScientific=="function"?f=Number(d.toScientific(6)):f=Number(d)}catch{}}Number.isFinite(f)&&sn.setRate(f)}}catch{}};if(l(),typeof hg=="function")try{hg()}catch{}hg=GI(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof yg=="function")try{yg()}catch{}setTimeout(()=>{ts===Xo.STARTER_COVE&&sn&&sn.start()},300);break}case Xo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),sn&&sn.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Xo.MENU}}))}catch{}}var bC,Qe,II,FI,UI,DI,wI,EI,xI,LI,_I,CI,MI,TI,$I,qI,yg,GI,SC,AI,kI,NI,pg,mg,vg,bg,HI,XI,zf,Sg,RI,Ig,wg,OI,Eg,es,Kf,jf,Zf,Xo,ts,pn,sn,hg,Jf,VI,Io=De(()=>{An();bC=!0,Qe=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();Qe&&document.documentElement.classList.add("is-mobile");Kf=null,jf=null,Zf=null;wC();Xo={MENU:0,STARTER_COVE:1},ts=Xo.MENU,pn=null,sn=null,hg=null,Jf=()=>new Promise(e=>requestAnimationFrame(e)),VI=async()=>{await Jf(),await Jf()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(H=>{e=H}),n=PI("Loading assets...",e);await Jf();let{initAudio:o}=await Promise.resolve().then(()=>(An(),Sc));o();let r=Promise.all([Promise.resolve().then(()=>(vd(),Hg)),Promise.resolve().then(()=>(BS(),PS)),Promise.resolve().then(()=>(cl(),O0)),Promise.resolve().then(()=>(qu(),I0)),Promise.resolve().then(()=>(St(),Dg)),Promise.resolve().then(()=>(rg(),XS)),Promise.resolve().then(()=>(no(),zb)),Promise.resolve().then(()=>(kc(),Vg)),Promise.resolve().then(()=>(bn(),ay)),Promise.resolve().then(()=>(vo(),Eb)),Promise.resolve().then(()=>(bo(),ES)),Promise.resolve().then(()=>(tI(),eI)),Promise.resolve().then(()=>(uI(),cI)),Promise.resolve().then(()=>(hs(),my)),Promise.resolve().then(()=>(dI(),fI)),Promise.resolve().then(()=>(ps(),bS)),Promise.resolve().then(()=>(Ar(),gy)),Promise.resolve().then(()=>(yu(),bv)),Promise.resolve().then(()=>(Cs(),gv)),Promise.resolve().then(()=>(_s(),Ry)),Promise.resolve().then(()=>(mI(),pI)),Promise.resolve().then(()=>(Sn(),lv)),Promise.resolve().then(()=>(Jh(),TS)),Promise.resolve().then(()=>(Si(),_y)),Promise.resolve().then(()=>(gI(),hI)),Promise.resolve().then(()=>(SI(),bI)),Promise.resolve().then(()=>(_l(),Bv))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(H,ee)=>`img/mutations/m${ee+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/gold_val_dna.webp","img/sc_upg_icons/magic_val_dna.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/wave_val_dna.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_dna.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg","sounds/notif_ding.ogg"],fonts:!0},s=0,l=_C(i,H=>{s=H,Oa(n,H)}),[a,u,f,d,m,v,p,h,g,y,I,E,M,N,G,P,$,L,F,T,C,z,Q,ae,he,Se,Oe]=await r;({initSlots:II}=a),{createSpawner:FI}=u,{initCoinPickup:UI}=f,{initHudButtons:DI}=d,{bank:LI,getHasOpenedSaveSlot:_I,setHasOpenedSaveSlot:CI,ensureStorageDefaults:MI,notifyGameSessionStarted:OI,ensureMultiplierDefaults:TI}=m,{getCurrentAreaKey:$I,computeUpgradeEffects:qI,onUpgradesChanged:GI}=p,{registerPreloadedAudio:SC}=h,{initXpSystem:yg}=g,{initResetSystem:vg}=y,{initMutationSystem:bg,getMutationCoinSprite:HI,onMutationChange:XI}=I,{initPopups:AI}=E,{installSuspendSafeguards:kI,restoreFromBackupIfNeeded:NI,markProgressDirty:pg,flushBackupSnapshot:mg}=M,{installGhostTapGuard:wI,initGlobalGhostTap:EI}=N,{initGlobalOverlayEsc:xI}=G,{setDebugPanelAccess:zf,applyStatMultiplierOverride:Sg}=P,{startGameLoop:RI,registerTick:Ig,registerFrame:wg}=$;let{initOfflineTracker:Ae,processOfflineProgress:U}=L,{initWorkshopSystem:K}=F,{initAutomationEffects:q}=T;({ensureGameDom:Eg}=C);let{initSurgeEffects:X}=z;({waterSystem:es}=Q);let{initLabLogic:J}=ae,{initFpsTracker:le}=he,{initNotifications:fe,unpauseNotifications:_,showNotification:Y}=Se,{initChannelSystem:ie}=Oe;Zf=_,window.bank=LI,window.unpauseNotifications=Zf,window.showNotification=Y,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(pn){try{pn.stop()}catch{}pn=null}}),window.addEventListener("audio:restartMusic",()=>{if(pn){try{pn.stop()}catch{}pn=null}ts===Xo.STARTER_COVE&&(pn=mt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",H=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return H.preventDefault(),H.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let H=document.hidden;ed(H),pn&&pn.element&&(H?pn.element.pause():pn.element.play().catch(()=>{}))}),wI?.(),EI?.(),xI?.(),kI?.(),typeof zf=="function"&&(zf(bC),window.setDebugPanelAccess=zf);try{await NI?.()}catch{}await Promise.race([l,t]),await VI(),document.documentElement.classList.remove("booting"),await Jf(),BI(n),await Promise.all([gg("img/currencies/coin/coin_plus_base.webp"),gg("img/stats/xp/xp_plus_base.webp"),gg("img/stats/mp/mp_plus_base.webp")]);try{typeof m.clearActiveSlot=="function"?m.clearActiveSlot():m&&m.KEYS&&m.KEYS.SAVE_SLOT&&localStorage.removeItem(m.KEYS.SAVE_SLOT)}catch{}RI(),Ae(()=>ts===Xo.STARTER_COVE);try{K()}catch(H){console.error("Workshop init failed",H)}try{q()}catch(H){console.error("Automation init failed",H)}try{X()}catch(H){console.error("Surge effects init failed",H)}try{J()}catch(H){console.error("Lab system init failed",H)}try{le()}catch(H){console.error("FPS tracker init failed",H)}IC(),MI(),pg?.("ensure-defaults"),AI(),fe();let de=document.getElementById("panel-title");if(_I()?(document.body.classList.add("has-opened"),de&&(de.style.opacity="0")):de&&(de.style.opacity="1"),II(async()=>{if(ts===Xo.STARTER_COVE)return;CI(!0),document.body.classList.add("has-opened"),de&&(de.style.opacity="0");let H=PI("Loading game..."),ee=()=>new Promise(ge=>setTimeout(ge,120));Oa(H,.2),await ee(),TI(),Oa(H,.4),await ee(),U(),Oa(H,.65),await ee(),OI?.(),Oa(H,.9),await ee(),pg?.("slot-entered"),Oa(H,1),BI(H,()=>{CC(Xo.STARTER_COVE),setTimeout(()=>{window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave()},300)},"Finished loading game",200)}),typeof window<"u"&&mg)try{window.cccRequestBackup=()=>mg("manual",{immediate:!0})}catch{}})});Io();})();
