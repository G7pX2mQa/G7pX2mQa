(()=>{var vS=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var vt=(e,t)=>{for(var n in t)vS(e,n,{get:t[n],enumerable:!0})};var Yl={};vt(Yl,{initAudio:()=>bS,loadAudio:()=>Ih,playAudio:()=>ht,registerPreloadedBuffer:()=>IS,setAudioSuspended:()=>vf,setMusicUnderwater:()=>Vr});function yf(){if(Vt)return Vt;let e=window.AudioContext||window.webkitAudioContext;return e?(Vt=new e,ha=Vt.createGain(),ha.connect(Vt.destination),ha.gain.value=1,Xl=Vt.createGain(),Xl.gain.value=1,Xl.connect(ha),Io=Vt.createBiquadFilter(),Io.type="lowpass",Io.frequency.value=22050,Io.Q.value=1,Io.connect(Xl),Vt):null}function bS(){yf()}function SS(){Vt&&Vt.state==="suspended"&&Vt.resume().catch(()=>{})}async function Ih(e){let t=yf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(ga.has(n))return ga.get(n);if(Vl.has(n))return Vl.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return ga.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{Vl.delete(n)}})();return Vl.set(n,o),o}function ht(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=yf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=ga.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(Io):f.connect(ha),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else Ih(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function IS(e,t){let n=new URL(e,document.baseURI).href;ga.set(n,t)}function vf(e){Vt&&(e?Vt.state==="running"&&Vt.suspend().catch(()=>{}):Vt.state==="suspended"&&Vt.resume().catch(()=>{}))}function Vr(e){if(!Io)return;let t=e?600:22050;try{let n=Vt.currentTime;Io.frequency.cancelScheduledValues(n),Io.frequency.setValueAtTime(t,n)}catch{Io.frequency.value=t}}var Vt,ha,Xl,Io,ga,Vl,Dn=De(()=>{Vt=null,ha=null,Xl=null,Io=null,ga=new Map,Vl=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,SS,{capture:!0,passive:!0})})});function Ne(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let y=Math.log10(p),m=e.e||0,g=Number(e._eOffset||0n);return y+m+g}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(p)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function Ce(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function bf(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/wh;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/wh:e>0?e:0}var c,wh,Et=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",p=BigInt(u+d);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};wh=Math.log(10)});function Lh(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return xh.format(t)}catch{return String(e)}}function ya(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function Sf(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Lh(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+xh.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=If.get(u)||"",p=o-u+1,y=4-p,m=p+y;n.length<m+1&&(n+="0".repeat(m+1-n.length));let g=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(g=ya(g));let v,E;return g.length>m?(v=g.slice(0,p+1),E="0".repeat(y)):(v=g.slice(0,p),E=g.slice(p)),t+`${v}${y?"."+E:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=ya(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+Sf(String(o))}function ES(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Sf(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=ya(f)),l){let A=f.slice(0,1)+"."+f.slice(1),N=i==="-"?"-":"";return t+A+"e"+Sf(s,N)}let p=Math.floor(a/3)*3,y=If.get(p)||"",g=a-p+1,h=4-g,v,E;return f.length>4?(v=f.slice(0,g+1),E="0".repeat(h)):(v=f.slice(0,g),E=f.slice(g)),t+(i==="-"?"-":"")+v+(h?"."+E:"")+y}function Eh(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=ya(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+ES(l)}function ne(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Eh(e.toScientific(3));if(t<6)return Lh(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=If.get(n);if(!o)return Eh(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=ya(u));let d,p;return u.length>l?(d=u.slice(0,i+1),p="0".repeat(s)):(d=u.slice(0,i),p=u.slice(i)),`${d}${s?"."+p:""}${o}`}function Fe(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=Ne(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return ne(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):ne(c.fromAny(t))}catch{return"1"}}var wS,If,xh,Yt=De(()=>{Et();wS=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],If=new Map(wS),xh=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var Bh={};vt(Bh,{CURRENCIES:()=>Te,KEYS:()=>bt,STORAGE_PREFIX:()=>Xi,bank:()=>O,clearActiveSlot:()=>PS,clearAllStorage:()=>DS,ensureCurrencyDefaults:()=>Rf,ensureMultiplierDefaults:()=>Of,ensureStorageDefaults:()=>US,getActiveSlot:()=>b,getCurrency:()=>Sa,getCurrencyMultiplierBN:()=>Ph,getHasOpenedSaveSlot:()=>FS,getLastSaveTime:()=>kf,getLastSaveTimeKey:()=>Zl,getSlotModifiedFlagKey:()=>BS,getSlotSignature:()=>Nf,getSlotSignatureKey:()=>Af,hasModifiedSave:()=>Vi,isCurrencyLocked:()=>$n,isStorageKeyLocked:()=>Wt,markSaveSlotModified:()=>In,notifyGameSessionStarted:()=>RS,onCurrencyChange:()=>jl,peekCurrency:()=>Ia,primeStorageWatcherSnapshot:()=>at,setActiveSlot:()=>Tf,setCurrency:()=>Gi,setCurrencyMultiplierBN:()=>ec,setHasOpenedSaveSlot:()=>Ql,setSlotSignature:()=>Jl,updateLastSaveTime:()=>Rh,watchStorageKey:()=>Mt});function xf(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Lf(e){let t=xf(e);return t==null?null:`${xS}:${t}`}function _f(e){let t=xf(e);return t==null?null:`${LS}:${t}`}function Th(e={}){Wl.size!==0&&Wl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function jl(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Wl.add(o),()=>{Wl.delete(o)}}function CS(){if(va!=null||Do.size===0)return;va=(typeof window<"u"?window:globalThis).setInterval(kS,_S)}function Ah(){if(Do.size!==0||va==null)return;(typeof window<"u"?window:globalThis).clearInterval(va),va=null}function Nh(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function MS(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function kS(){if(Do.size===0){Ah();return}Do.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=Nh(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!MS(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function Mt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Do.get(e);return s||(s=new Set,Do.set(e,s)),s.add(i),CS(),()=>{let l=Do.get(e);l&&(l.delete(i),l.size===0&&(Do.delete(e),Ah()))}}function at(e,t){if(!e)return;let n=Do.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=Nh(r,o),r.initialized=!0)})}function Cf(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function TS(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function AS(){wf.forEach(e=>{try{e?.()}catch{}}),wf.clear()}function Ch(e){if(e!==_h&&(AS(),_h=e??null,e!=null))for(let t of Object.values(Te)){let n=`${bt.CURRENCY[t]}:${e}`,o=Mt(n,{parse:TS,equals:Cf,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};Th(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});wf.set(n,o)}}function NS(){typeof window>"u"||(Ch(b()),window.addEventListener("saveSlot:change",()=>{Ch(b())}))}function RS(){Mf=!0}function Zl(e=b()){return e==null?null:`${pr}lastSaveTime:${e}`}function Rh(){if(!Mf||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(Zl(e),String(t))}catch{}}function kf(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(Zl(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function OS(){typeof window>"u"||(Mh||(Mh=setInterval(Rh,1e3)),window.addEventListener("beforeunload",()=>{if(!Mf)return;let e=b();if(e!=null)try{localStorage.setItem(Zl(e),String(Date.now()))}catch{}}))}function b(){if(fr!==void 0)return fr;let e=localStorage.getItem(bt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return fr=n,n}function Tf(e){let t=Math.max(1,parseInt(e,10)||1);fr=t,localStorage.setItem(bt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function PS(){fr=null,localStorage.removeItem(bt.SAVE_SLOT)}function ba(e,t=b()){return t==null?null:`${e}:${t}`}function Oh(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Wt(e){return Oh(e)}function Af(e=b()){return Lf(e)}function BS(e=b()){return _f(e)}function Nf(e=b()){if(typeof localStorage>"u")return null;let t=Lf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function Jl(e,t){if(typeof localStorage>"u")return;let n=Lf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function Vi(e=b()){if(typeof localStorage>"u")return!1;let t=_f(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function In(e=b()){if(typeof localStorage>"u")return;let t=xf(e);if(t==null||Vi(t))return;let n=_f(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function FS(){return localStorage.getItem(bt.HAS_OPENED_SAVE_SLOT)==="true"}function Ql(e){localStorage.setItem(bt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function US(){localStorage.getItem(bt.HAS_OPENED_SAVE_SLOT)===null&&Ql(!1)}function Rf(){let e=b();if(e!=null)for(let t of Object.values(Te)){let n=`${bt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function Of(){let e=b();if(e!=null)for(let t of Object.values(Te)){let n=`${bt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Kl(t);else{let o=dr(c.fromInt(1));Hi(t,o)}}}function Sa(e){let t=ba(bt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Gi(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=ba(bt.CURRENCY[e],r),s=o??Sa(e),l=c.fromInt(0);if(!i||$n(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,p=a;try{f!=null&&(p=c.fromAny(f),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}at(i,d);let y=!Cf(s,p),g=(v=>{if(v==null)return null;try{let E=v instanceof c?v.clone?.()??v:c.fromAny(v);if(typeof E.cmp=="function")return E.cmp(l)>0?E:null;if(!E.isZero?.())return E}catch{}return null})(n),h=null;if(y)try{h=p.sub?.(s)}catch{}if((!h||h.isZero?.()||typeof h.cmp=="function"&&h.cmp(l)<=0)&&(h=g),y||h){let v={key:e,value:p,slot:r,delta:h??void 0};Th(v);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:v}))}catch{}}return p}function dr(e){return e.mulScaledIntFloor(1n,-Ef)}function zl(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,Ef)}function Kl(e){let t=ba(bt.MULTIPLIER[e]);if(!t)return dr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Yr)){let r=dr(c.fromInt(1));return Hi(e,r),r}let o=n.slice(Yr.length);try{return c.fromAny(o)}catch{let r=dr(c.fromInt(1));return Hi(e,r),r}}function Hi(e,t,n=b()){let o=ba(bt.MULTIPLIER[e],n);if(!o||$n(e,n))return;let r=dr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Yr))try{r=c.fromAny(i.slice(Yr.length))}catch{}let s=c.fromAny(t),l=Yr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(Yr)?u.slice(Yr.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{at(o,u)}catch{}if(!Cf(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:zl(f),slot:n}}))}catch{}}function Ph(e){return zl(Kl(e))}function $n(e,t=b()){let n=ba(bt.CURRENCY[e],t);return Oh(n)}function ec(e,t){let n=c.fromAny(t),o=dr(n);return Hi(e,o,b()),n}function Ia(e,t){let n=localStorage.getItem(`${bt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function DS(){Object.values(bt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function kh(e){let t=n=>{try{let o=c.fromAny(n);return typeof ne=="function"?ne(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return Sa(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Gi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Gi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Gi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof ne=="function"?ne(r):r.toString()},t.mult={get(){return Ph(e)},set(n){return ec(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Kl(e).mulBigNumInteger(o);return r.isZero()&&(r=dr(c.fromInt(1))),Hi(e,r),zl(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),Ef)}catch{o={numer:1n,scale:0}}let r=Kl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=dr(c.fromInt(1))),Hi(e,r);let i=zl(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var pr,Xi,xS,LS,Ef,Yr,_S,Do,va,Wl,wf,_h,Mh,Mf,bt,Te,fr,O,St=De(()=>{Et();Yt();pr="ccc:",Xi=pr,xS=`${pr}slotSig`,LS=`${pr}slotMod`,Ef=18,Yr="XM:",_S=140,Do=new Map,va=null,Wl=new Set;wf=new Map,_h=null;Mh=null,Mf=!1;OS();bt={HAS_OPENED_SAVE_SLOT:`${pr}hasOpenedSaveSlot`,SAVE_SLOT:`${pr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Te={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===bt.SAVE_SLOT){if(e.newValue===null)fr=null;else{let t=parseInt(e.newValue,10);fr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:fr}}))}catch{}}});for(let e of Object.values(Te))bt.CURRENCY[e]=`${pr}${e}`,bt.MULTIPLIER[e]=`${pr}mult:${e}`;NS();O=new Proxy({},{get(e,t){if(Object.values(Te).includes(t))return kh(t);if(typeof t=="string"&&Te[t.toUpperCase?.()])return kh(Te[t.toUpperCase()])}});if(typeof window<"u"){window.bank=O;for(let e of Object.values(Te))window[e]=O[e]}});function Uh(){return wo}function tc(e){wo=!!e,document.body.classList.toggle("slots-delete-mode",wo);let t=document.getElementById("manage-saves");t&&(t.textContent=wo?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",wo),n.setAttribute("aria-pressed",wo?"true":"false")})}function $S(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function qS(){if(Fh)return;Fh=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),tc(!wo)}),window.addEventListener("keydown",r=>{wo&&r.key==="Escape"&&tc(!1)});let n=r=>{!wo||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!wo)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if($S(s),b()===s)try{localStorage.removeItem(bt.SAVE_SLOT)}catch{}Pf(),tc(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),tc(!1)}var wo,Fh,Dh=De(()=>{St();Bf();wo=!1,Fh=!1;document.addEventListener("DOMContentLoaded",()=>{try{qS()}catch{}})});var $h={};vt($h,{initSlots:()=>XS,refreshSlotsView:()=>Pf});function GS(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function HS(e){if(!GS(e))return"No Save Data";try{let t=Ia(e,"coins");return ne(t)}catch{return"0"}}function Ff(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=HS(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function XS(e){let t=document.querySelectorAll(".slot-card");Ff(),t.forEach((n,o)=>{let r=o+1,i=s=>{Tf(r),Rf(),Of(),Ql(!0),typeof e=="function"&&e(r,s),Ff()};n.addEventListener("click",s=>{Uh()||(s.preventDefault(),i(s))})})}function Pf(){Ff()}var Bf=De(()=>{Et();Yt();Dh();St()});var Gh={};vt(Gh,{registerPreloadedAudio:()=>VS,takePreloadedAudio:()=>YS});function VS(e,t){let n=qh(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}nc.set(n,t)}}function YS(e){let t=qh(e);if(!nc.has(t))return null;let n=nc.get(t);return nc.delete(t),n}var nc,qh,oc=De(()=>{nc=new Map,qh=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Yi(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var Uf=De(()=>{});var rg={};vt(rg,{addExternalCoinMultiplierProvider:()=>qo,addExternalXpGainMultiplierProvider:()=>yr,addXp:()=>Ji,broadcastXpChange:()=>cc,computeCoinMultiplierForXpLevel:()=>Kf,getXpGainMultiplier:()=>fc,getXpLevelStorageKey:()=>WS,getXpRequirementForXpLevel:()=>uc,getXpState:()=>ot,initXpSystem:()=>ji,isXpSystemUnlocked:()=>fn,onXpChange:()=>ac,refreshCoinMultiplierFromXpLevel:()=>Qt,resetXpProgress:()=>Zi,setExternalBookRewardProvider:()=>dc,setExternalCoinMultiplierProvider:()=>ng,setExternalXpGainMultiplierProvider:()=>og,unlockXpSystem:()=>jr});function WS(e=b()){let t=e??b();return t==null?null:Wr(t)}function un(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function rc(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function jh(e){if(!e||typeof e!="object")return 0;if(un(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function jS(e){return!e||typeof e!="object"?0:un(e)||typeof e.cmp=="function"&&e.cmp(Kh)>=0?Number.POSITIVE_INFINITY:jh(e)}function Xh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(KS,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(Ca())??c.fromInt(0):n}function ZS(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(zh,18)}function JS(e){if(un(e)||typeof e.cmp=="function"&&e.cmp(Kh)>=0)return _t.clone?.()??_t;let t=e.floorToInteger(),n=e.sub(t),o=jh(n);if(!Number.isFinite(o))return _t.clone?.()??_t;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return _t.clone?.()??_t;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),m=Number(y),g=d-y;return new c(a,{base:m,offset:g})}function Zh(e){if(!e||typeof e!="object")return _t.clone?.()??_t;let n=ZS(e),o=JS(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return _t.clone?.()??_t;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function Jh(){let e=un(X.xpLevel),t=un(X.progress);if(!e&&!t)return!1;let n=_t.clone?.()??_t;if(X.xpLevel=n.clone?.()??n,X.progress=n.clone?.()??n,xt=n.clone?.()??n,O?.books)try{typeof O.books.set=="function"?O.books.set(n.clone?.()??n):typeof O.books.add=="function"&&O.books.add(n.clone?.()??n)}catch{}return!0}function xa(e={}){_a.size!==0&&_a.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function ac(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return _a.add(n),()=>{_a.delete(n)}}function Ot(){return c.fromInt(0)}function Ca(){return c.fromInt(1)}function Wi(e){if(!e)return Ot();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ot()}}function ic(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function QS(){for(;Yf.length>0;){let e=Yf.pop();try{e?.()}catch{}}}function Yh(e){if(e==null)return Ot();try{return c.fromAny(e)}catch{return Ot()}}function qf(e){if(!$f){$f=!0;try{let t=Wf??b(),n={unlocked:X.unlocked,xpLevel:Wi(X.xpLevel),progress:Wi(X.progress),requirement:Wi(xt)};Jt(!0),oo(),En(!0);let o={unlocked:X.unlocked,xpLevel:Wi(X.xpLevel),progress:Wi(X.progress),requirement:Wi(xt)},r=n.unlocked!==o.unlocked,i=!ic(n.xpLevel,o.xpLevel),s=!ic(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ot();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ot()}catch{l=Ot()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||_a.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(xa(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{$f=!1}}}function Gf(e){if(e===Wf||(QS(),Wf=e??null,e==null))return;let t=(n,o)=>{let r=Mt(n,o);typeof r=="function"&&Yf.push(r)};t(wa(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>qf("unlock")}),t(Wr(e),{parse:Yh,equals:ic,onChange:()=>qf("xpLevel")}),t(Ki(e),{parse:Yh,equals:ic,onChange:()=>qf("progress")})}function Qh(){if(Vh){Gf(b());return}Vh=!0,Gf(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Gf(b()),Jt(!0),oo(),En(!0)})}function Hf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function eI(e){let t=e<Hh?e:Hh;if(t<=zi)return;let n=zi,o=mr.get(n.toString());for(o||(o=c.fromInt(10),mr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),mr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){zi=n;return}}zi=n}function tI(e){let t=zi>0n?zi:0n,n=mr.get(t.toString());if(!n||un(n))return _t.clone?.()??_t;let o=c.fromAny(t.toString()),r=Ne(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);rc(s)||(i=i.add?.(s.mulDecimal(zh,18))??i);let l=Xh(e),a=Xh(o),u=l.sub?.(a)??c.fromInt(0);rc(u)||(i=i.add?.(u.mulDecimal(zS,18))??i);let f=jS(i);return Number.isFinite(f)?Ce(f):_t.clone?.()??_t}function nI(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=un(t),o=un(e);if(n)return o?1:0;if(rc(t)||rc(e))return 0;let s=Ne(e),l=Ne(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function eg(){return wn.container&&wn.container.isConnected?!0:(wn.container=document.querySelector(".xp-counter[data-xp-hud]"),wn.container?(wn.bar=wn.container.querySelector(".xp-bar"),wn.fill=wn.container.querySelector(".xp-bar__fill"),wn.xpLevelValue=wn.container.querySelector(".xp-level-value"),wn.progress=wn.container.querySelector("[data-xp-progress]"),!0):!1)}function tg(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=mr.get("0");return a.clone?.()??a}if(r.bigInt!=null){eI(i);let a=i.toString(),u=mr.get(a);if(u)return u.clone?.()??u}let s=tI(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?_t.clone?.()??_t:(r.bigInt!=null&&mr.set(r.bigInt.toString(),s),s.clone?.()??s)}function $o(){xt=tg(X.xpLevel)}function sc(){X.xpLevel=Ot(),X.progress=Ot(),$o(),En(!0)}function Wh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function lc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function En(e=!1){let t=O?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=lc(X.xpLevel),o=n.bigInt,r=!n.finite,i=typeof X.xpLevel?.toStorage=="function"?X.xpLevel.toStorage():null;if(!e&&(r&&Gn||!r&&o!=null&&!Gn&&!Hn&&qn!=null&&o===qn||!r&&o==null&&Hn&&i&&Xn&&i===Xn))return;if(r){try{t.set(_t)}catch{}qn=null,Gn=!0,Hn=!1,Xn=null;return}let s;if(o!=null&&o<=Vf){let f=c.fromInt(1),d=Number(o);for(let y=0;y<d;y+=1)f=f.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(d)}typeof f.add=="function"?f=f.add(p):typeof p.add=="function"&&(f=p.add(f)),s=f.clone?.()??f}else s=Zh(X.xpLevel);let l=s.clone?.()??s,a=hr.size>0?Array.from(hr):typeof zr=="function"?[zr]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(qn=null,Gn=!0,Hn=!1,Xn=null):o!=null&&o<=Vf?(qn=o,Gn=!1,Hn=!1,Xn=null):(qn=null,Gn=!1,Hn=!0,Xn=i)}function Jt(e=!1){let t=b();if(t==null)return Ea=null,Df=!1,X.unlocked=!1,sc(),X;if(!e&&Df&&t===Ea)return X;Ea=t,Df=!0;try{let n=localStorage.getItem(wa(t));X.unlocked=n==="1"}catch{X.unlocked=!1}try{X.xpLevel=c.fromAny(localStorage.getItem(Wr(t))??"0")}catch{X.xpLevel=Ot()}try{X.progress=c.fromAny(localStorage.getItem(Ki(t))??"0")}catch{X.progress=Ot()}return(un(X.xpLevel)||un(X.progress))&&(X.unlocked=!0),X.unlocked?(Jh(),$o(),En(!0),Qh(),X):(sc(),X)}function La(){let e=b();if(e==null)return;let t={unlocked:X.unlocked?"1":"0",level:X.xpLevel.toStorage(),progress:X.progress.toStorage()};try{localStorage.setItem(wa(e),t.unlocked)}catch{}try{localStorage.setItem(Wr(e),t.level)}catch{}try{localStorage.setItem(Ki(e),t.progress)}catch{}let n=(()=>{let r=X.unlocked,i=X.xpLevel,s=X.progress;try{r=localStorage.getItem(wa(e))==="1"}catch{}try{let l=localStorage.getItem(Wr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(Ki(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();at(wa(e),n.unlocked?"1":"0"),at(Wr(e),n.level?.toStorage?.()??t.level),at(Ki(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==X.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(X.unlocked=n.unlocked,X.xpLevel=n.level,X.progress=n.progress,$o(),En(!0),oo())}function oI(){En(!0);let e=Ca();if(typeof Xf=="function")try{let n=Xf({baseReward:e.clone?.()??e,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{O?.books?.addWithMultiplier?O.books.addWithMultiplier(e):O?.books?.add&&O.books.add(e)}catch{}let t=lc(X.xpLevel);t.finite?t.bigInt!=null?(qn=t.bigInt,Gn=!1,Hn=!1,Xn=null):(qn=null,Gn=!1,Hn=!0,Xn=typeof X.xpLevel?.toStorage=="function"?X.xpLevel.toStorage():null):(qn=null,Gn=!0,Hn=!1,Xn=null)}function oo(){if(!eg())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=wn;if(!e)return;if(!X.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=ne(xt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Hf(ne(xt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Yi();return}e.removeAttribute("hidden");let i=xt,s=nI(X.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=ne(X.xpLevel)),r){let a=ne(X.progress),u=ne(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Hf(ne(X.progress)),u=Hf(ne(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Yi()}function ji({forceReload:e=!1}={}){return eg(),Jt(e),$o(),oo(),Qh(),ot()}function jr(){if(Jt(),X.unlocked)return oo(),!1;sc(),X.unlocked=!0,La(),oo(),En(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:ot()}))}catch{}return!0}function Zi({keepUnlock:e=!0}={}){Jt();let t=X.unlocked;return sc(),X.unlocked=e?t||X.unlocked:!1,La(),oo(),En(!0),ot()}function Ji(e,{silent:t=!1}={}){Jt();let n=Ea??b();if(n!=null&&Wh(Ki(n)))return{unlocked:X.unlocked,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:X.xpLevel,progress:X.progress,requirement:xt,slot:n};if(!X.unlocked)return{unlocked:!1,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:X.xpLevel,requirement:xt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ot()}if(!o.isZero?.()){let d=gr.size>0?Array.from(gr):typeof Kr=="function"?[Kr]:[];for(let p of d)if(typeof p=="function")try{let y=p({baseGain:o.clone?.()??o,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});y instanceof c?o=y.clone?.()??y:y!=null&&(o=c.fromAny(y))}catch{}}if(o=Yn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return oo(),{unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:X.xpLevel,requirement:xt};X.progress=X.progress.add(o),$o();let r=n!=null&&Wh(Wr(n)),i=un(X.progress),s=un(X.xpLevel),l=un(o);if(i||s||l){let d=_t.clone?.()??_t;r||(X.xpLevel=d.clone?.()??d),X.progress=d.clone?.()??d,$o(),Jh(),La(),oo(),En(!0);let p={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o.clone?.()??o,xpLevel:X.xpLevel.clone?.()??X.xpLevel,progress:X.progress.clone?.()??X.progress,requirement:xt.clone?.()??xt,slot:n};if(xa(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Ot();if(X.progress.cmp(xt)<0){La(),oo();let d={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:X.xpLevel,progress:X.progress,requirement:xt,slot:n};if(xa(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=Ne(X.progress),p=.08118668602542883,y=Ne(xt);if(d-y>2){let h=X.xpLevel,v=d-y,E=Math.floor(v/p);if(E>500){let C=BigInt(Math.max(0,E-5));if(C>0n){let A=c.fromAny(C.toString());if(X.xpLevel=X.xpLevel.add(A),a=a.add(A),$o(),O?.books?.add)try{let N=A.clone();O.books.add(N)}catch{}}}}let m=0,g=500;for(;X.progress.cmp?.(xt)>=0&&m<g&&(X.progress=X.progress.sub(xt),X.xpLevel=X.xpLevel.add(Ca()),a=a.add(Ca()),oI(),$o(),!un(xt));)m+=1;m>=g&&X.progress.cmp(xt)>=0&&$o()}La(),oo();let u=lc(X.xpLevel);u.finite?u.bigInt!=null?(qn=u.bigInt,Gn=!1,Hn=!1,Xn=null):(qn=null,Gn=!1,Hn=!0,Xn=typeof X.xpLevel?.toStorage=="function"?X.xpLevel.toStorage():null):(qn=null,Gn=!0,Hn=!1,Xn=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:X.xpLevel.clone?.()??X.xpLevel,progress:X.progress.clone?.()??X.progress,requirement:xt.clone?.()??xt,slot:n};if(xa(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function ot(){return Jt(),{unlocked:X.unlocked,xpLevel:X.xpLevel.clone?.()??X.xpLevel,progress:X.progress.clone?.()??X.progress,requirement:xt.clone?.()??xt}}function cc(e={}){Jt();let t=Ea??b(),n={...ot(),slot:t,...e};if(xa(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function fn(){return Jt(),!!X.unlocked}function uc(e){return tg(e)}function fc(){Jt();let e=Ca(),t=gr.size>0?Array.from(gr):typeof Kr=="function"?[Kr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function Kf(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=lc(t),o=n.bigInt;if(!n.finite)return _t.clone?.()??_t;let i;if(o!=null&&o<=Vf){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=Zh(t);let s=i.clone?.()??i,l=hr.size>0?Array.from(hr):typeof zr=="function"?[zr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!X.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function ng(e){zr=typeof e=="function"?e:null,hr.clear(),zr&&hr.add(zr),Jt(),En(!0)}function Qt(){Jt(),En(!0)}function og(e){Kr=typeof e=="function"?e:null,gr.clear(),Kr&&gr.add(Kr)}function qo(e){return typeof e!="function"?()=>{}:(hr.add(e),Jt(),En(!0),()=>{hr.delete(e),Jt(),En(!0)})}function yr(e){return typeof e!="function"?()=>{}:(gr.add(e),Jt(),()=>{gr.delete(e)})}function dc(e){Xf=typeof e=="function"?e:null}var zf,wa,Wr,Ki,Ea,Df,xt,mr,zi,_t,qn,Gn,Hn,Xn,zr,Kr,hr,gr,Xf,Hh,J1,Q1,Vf,zh,zS,KS,Kh,X,_a,wn,Yf,Vh,Wf,$f,Vn=De(()=>{Et();St();Qi();Yt();Uf();zf="ccc:xp",wa=e=>`${zf}:unlocked:${e}`,Wr=e=>`${zf}:level:${e}`,Ki=e=>`${zf}:progress:${e}`;Ea=null,Df=!1,xt=c.fromInt(10),mr=new Map;mr.set("0",xt);zi=0n,_t=c.fromAny("Infinity"),qn=null,Gn=!1,Hn=!1,Xn=null,zr=null,Kr=null,hr=new Set,gr=new Set,Xf=null,Hh=5000n,J1=Math.log10(11/10),Q1=Math.log10(5/2),Vf=200n,zh="0.04139268515822507",zS="0.3979400086720376",KS="0.1",Kh=c.fromScientific(String(c.MAX_E));X={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};_a=new Set;wn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};Yf=[],Vh=!1,Wf=null,$f=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:ji,unlockXpSystem:jr,addXp:Ji,getXpState:ot,broadcastXpChange:cc,isXpSystemUnlocked:fn,getXpRequirementForXpLevel:uc,getXpGainMultiplier:fc,setExternalCoinMultiplierProvider:ng,addExternalCoinMultiplierProvider:qo,refreshCoinMultiplierFromXpLevel:Qt,setExternalXpGainMultiplierProvider:og,addExternalXpGainMultiplierProvider:yr,setExternalBookRewardProvider:dc,resetXpProgress:Zi}))});var fg={};vt(fg,{GHOST_TAP_TIMEOUT_MS:()=>rI,clearGhostTapTarget:()=>Ma,consumeGhostTapGuard:()=>ug,initGlobalGhostTap:()=>mI,installGhostTapGuard:()=>pI,markGhostTapTarget:()=>cg,setGhostTapSelector:()=>hI,shouldSkipGhostTap:()=>ro,suppressNextGhostTap:()=>Eo});function Ho(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Jf(){return typeof document>"u"?null:document}function aI(e){if(!Jf())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(Zf)}function Ma(e){e&&(e[pc]=0)}function cg(e,t=0,n=null){if(!e)return;let o=Ho(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[pc]=o+r:e[pc]=0,sI=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&Eo(i)}function ug(e){if(typeof window>"u")return!1;let t=window[es];return typeof t!="number"?!1:Ho()<=t?!0:(window[es]=null,!1)}function ro(e){if(!e)return!1;let t=Number(e[pc]||0);return!Number.isFinite(t)||t<=0?!1:Ho()<=t?(Ma(e),!0):(Ma(e),!1)}function Eo(e=0){if(typeof window>"u")return;let t=Ho(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[es]=null;return}let o=t+n,r=typeof window[es]=="number"?window[es]:0;window[es]=Math.max(r,o)}function lI(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(hc=vr=Ho(),Go=0))}function cI(e){hc=vr=Ho(),Go=0}function uI(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Ho();vr>0&&(Go=t-vr),hc=t}function fI(){let e=Ho();vr>0&&(Go=e-vr),hc=e}function dI(e){if(!e.isTrusted)return;let t=Ho(),n=vr>0?t-vr:-1,o=aI(e.target);if(ro(o)){Go=0,e.preventDefault(),e.stopImmediatePropagation();return}if(ug(o)){o&&Ma(o),Go=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Go||n)>=lg){Ma(o),Go=0,e.preventDefault(),e.stopImmediatePropagation();return}Go=0}function pI(e={}){if(ig)return;let t=Jf();!t||typeof window>"u"||(ig=!0,jf="PointerEvent"in window,sg=!jf&&"ontouchstart"in window,e.selector&&(Zf=`${e.selector}, ${mc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(lg=e.longPressMs),t.addEventListener("click",dI,!0),jf?(t.addEventListener("pointerdown",lI,{capture:!0,passive:!1}),t.addEventListener("pointerup",uI,{capture:!0,passive:!0})):sg&&(t.addEventListener("touchstart",cI,{capture:!0,passive:!1}),t.addEventListener("touchend",fI,{capture:!0,passive:!0})))}function ag(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(mc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(cg(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function mI(){let e=Jf();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",ag,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",ag,{capture:!1,passive:!1})}function hI(e){e&&(Zf=`${e}, ${mc}`)}var rI,pc,es,mc,iI,ig,Zf,jf,sg,sI,hc,vr,Go,lg,ts=De(()=>{rI=0,pc=Symbol("ccc:ghostTap:skipUntil"),es="__cccGhostTapSkipUntil",mc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',iI=80,ig=!1,Zf=mc,jf=!1,sg=!1,sI=null,hc=0,vr=0,Go=0,lg=iI});var Qf,dg=De(()=>{Qf={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var pg={};vt(pg,{RateAccumulator:()=>Ta,pauseGameLoop:()=>rd,registerFrame:()=>SI,registerTick:()=>xo,resumeGameLoop:()=>id,startGameLoop:()=>vI,stopGameLoop:()=>bI});function nd(e){e||(e=performance.now());let t=e;if(od){Zr=t,Qr=requestAnimationFrame(nd);return}Zr||(Zr=t);let n=(t-Zr)/1e3;Zr=t,n>60&&(n=60),n<0&&(n=0),Jr+=n;let o=0,r=250;for(;Jr>=ka;){if(o>=r){Jr=Jr%ka;break}ed.forEach(i=>{try{i(ka)}catch(s){console.error("Error in game tick listener:",s)}}),Jr-=ka,o++}if(td.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),ns===0||os===0)ns=Date.now(),os=t;else{let i=t-os;if(i>yI){let s=Date.now(),l=s-ns;l<-1e3?In():l>i+1e4&&In(),ns=s,os=t}}Qr=requestAnimationFrame(nd)}function rd(){od=!0}function id(){od=!1,Zr=performance.now(),Jr=0,ns=0,os=0}function vI(){Qr||(Zr=performance.now(),Jr=0,ns=0,os=0,Qr=requestAnimationFrame(nd))}function bI(){Qr&&(cancelAnimationFrame(Qr),Qr=null)}function xo(e){return typeof e!="function"?()=>{}:(ed.add(e),()=>{ed.delete(e)})}function SI(e){return typeof e!="function"?()=>{}:(td.add(e),()=>{td.delete(e)})}var gI,ka,ed,td,Qr,od,Zr,Jr,ns,os,yI,Ta,ei=De(()=>{St();gI=20,ka=1/gI,ed=new Set,td=new Set,Qr=null,od=!1,Zr=0,Jr=0,ns=0,os=0,yI=2e3;Ta=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*ka;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ze,ti,Aa,Na,Ra,Oa,io,rs,II,mg,ni=De(()=>{Et();Ze="automation",ti=1,Aa=2,Na=3,Ra=4,Oa=5,io=6,rs={[Aa]:"coins",[Na]:"books",[Ra]:"gold",[Oa]:"magic"},II=[{area:Ze,id:ti,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ze,id:Aa,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ze,id:Na,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ze,id:Ra,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ze,id:Oa,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ze,id:io,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],mg=II.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var wg={};vt(wg,{getGearsProductionRate:()=>Sc,getGenerationLevelKey:()=>ii,getGenerationUpgradeCost:()=>br,initWorkshopSystem:()=>Ig,initWorkshopTab:()=>pd,performFreeGenerationUpgrade:()=>Ic,updateWorkshopTab:()=>so});function ss(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*MI}function ii(e){return`ccc:workshop:genLevel:${e}`}function Fa(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(ii(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function Da(e){let t=b();if(!t)return!1;let n=ii(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function $a(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return ad;if(t<=oi)return ad+t*gg;yc===null&&(yc=ad+oi*gg);let n=t-oi;if(t<=Pa)return yc+n+ss(n,is);if(vc===null){let d=Pa-oi;vc=yc+d+ss(d,is)}let o=t-Pa,r=t-oi,i=Pa-oi,s=o+(ss(r,is)-ss(i,is)),l=LI/xI,a=.5*l*o*o;if(t<=gc)return vc+s+a;if(cd===null){let d=gc-Pa,p=gc-oi,y=d+(ss(p,is)-ss(i,is)),m=.5*l*d*d;cd=vc+y+m}let u=_I*(t-gc);if(u>709)return 1/0;let f=cd*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function br(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=$a(t);return Ce(n)}function dd(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(ld);if(n.cmp(9e15)<=0){let s=Number(n.toString())*ld;t=Ce(s)}else{let i=n.mulDecimal(ld);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Ce(s)}catch{t=c.fromAny("Infinity")}}}let o=O?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function AI(){let e=br(rt);if(O.coins.value.cmp(e)<0)return;let t=rt.add(1);Da(t)&&(rt=t,O.coins.sub(e),so(),tn())}function NI(){if(!$t())return;let n=dd(rt).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&O.gears&&O.gears.add(n),rt.cmp(20)<0){let r=Number(rt.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(ri+=a,ri>=1){let u=Math.floor(ri);ri-=u,O.gears&&O.gears.add(u)}}else ri=0}function fd(){O.gears&&O.gears.set(0),Da(c.zero())&&(rt=c.zero()),ri=0,so()}function vg(e){if(!e)return;let t=Ua.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),Ua.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;rt.cmp(sd)>0?i=sd:i=Number(rt.toPlainIntegerString());let s=Math.min(Math.floor(i),sd),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,p=Math.cos(d)*yg,y=Math.sin(d)*yg,m=Math.random()*360,g=(Math.random()<.5?-1:1)*(kI+Math.random()*TI);l.push({x:u,y:f,dx:p,dy:y,rotation:m,rotationSpeed:g,size:a})}for(;l.length>s;)l.pop()}function RI(e){let t="Click the big red button below to open the Automation Shop";je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${wI}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${bg}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${EI}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{AI()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),PI()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{cs("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(en&&en.isConnected){let a=en.querySelector(".workshop-side-left"),u=en.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let p=Ua.get(d);if(p){let y=d.getBoundingClientRect(),m=window.devicePixelRatio||1;p.width=y.width,p.height=y.height;let g=Math.round(y.width*m),h=Math.round(y.height*m);if(p.canvas&&(p.canvas.width!==g||p.canvas.height!==h)&&(p.canvas.width=g,p.canvas.height=h,p.ctx.scale(m,m)),p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let v of p.gears)v.x=Math.random()*(p.width-v.size),v.x<0&&(v.x=0),v.y=Math.random()*(p.height-v.size),v.y<0&&(v.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Sg():OI()},{root:null,threshold:0}).observe(e),en=e}function so(){if(!en)return;let e=en.querySelector('[data-workshop="gears-amount"]'),t=en.querySelector('[data-workshop="gears-rate"]'),n=en.querySelector('[data-workshop="upgrade-cost"]'),o=en.querySelector('[data-workshop="upgrade-gen"]'),r=dd(rt),i=br(rt);if(e&&(e.innerHTML=O.gears.fmt(O.gears.value)),t&&(t.innerHTML=ne(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${ne(i)} ${l}`}if(o){let l=O.coins.value.cmp(i)>=0;o.disabled=!l;let a=kt(Ze,io),u=!1;if(a>0){let f=b(),d=f!=null?`:${f}`:"",p=`ccc:autobuy:${Ze}:${io}${d}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(rt.isInfinite()?s="Infinity":s=rt.floorToInteger().toStorage(),s!==ud){ud=s;let l=en.querySelector(".workshop-side-left"),a=en.querySelector(".workshop-side-right");l&&vg(l),a&&vg(a)}}function OI(){as&&(cancelAnimationFrame(as),as=null)}function Sg(){if(as)return;Ba=0;let e=t=>{if(en&&en.isConnected){let n=en.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=O.gears.fmt(O.gears.value)),Ba||(Ba=t);let o=(t-Ba)/1e3;Ba=t,o>.1&&(o=.1);for(let[r,i]of Ua){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!bc.complete||bc.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,p=f.y+f.size/2;u.save(),u.translate(d,p),u.rotate(f.rotation*Math.PI/180),u.drawImage(bc,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}as=requestAnimationFrame(e)};as=requestAnimationFrame(e)}function Ig(){hg||(hg=!0,rt=Fa(),xo(NI),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{rt=Fa(),ri=0,$t()||fd(),so()}),window.addEventListener("currency:change",e=>{e.detail.key===Te.COINS&&so()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Te.GEARS&&so()}),window.addEventListener("debug:change",()=>{rt=Fa(),so()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&($t()||fd())})))}function pd(e){Ig(),!e.__workshopInit&&(e.__workshopInit=!0,rt=Fa(),Ua.clear(),ud=-1,RI(e),typeof IntersectionObserver>"u"&&Sg(),$t()||fd(),so())}function Sc(){let e=Fa();return dd(e)}function Ic(){let e=O.coins.value.isInfinite(),n=br(rt).isInfinite();if(e&&n&&!rt.isInfinite())return rt=c.fromAny("Infinity"),Da(rt),so(),!0;if(O.coins.value.isZero())return!1;let o=Ne(O.coins.value);if(!Number.isFinite(o))if(O.coins.value.inf)o=1/0;else return!1;if($a(rt)>o||rt.cmp(9e15)>0)return!1;let r=Number(rt.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);$a(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(rt)>0&&Da(a)?(rt=a,so(),!0):!1}function PI(){if(O.coins.value.isInfinite()){Ic()&&tn();return}let e=Ne(O.coins.value);if(!Number.isFinite(e)&&O.coins.value.isZero()||$a(rt)>e||rt.cmp(9e15)>0)return;let t=Number(rt.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);$a(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(rt.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(br(c.fromInt(u)));if(l.cmp(O.coins.value)>0){let u=br(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(rt)>0&&Da(a)&&(rt=a,O.coins.sub(l),so(),tn())}var bg,wI,bc,EI,sd,en,hg,ri,rt,ud,as,ad,ld,oi,Pa,gc,gg,is,xI,LI,_I,CI,MI,yc,vc,cd,Ua,yg,kI,TI,Ba,ls=De(()=>{Et();Yt();St();ei();si();Lo();ao();lo();ni();bg="img/currencies/gear/gear.webp",wI="img/currencies/gear/gear_plus_base.webp",bc=new Image;bc.src=bg;EI="img/currencies/coin/coin.webp",sd=300,en=null,hg=!1,ri=0,rt=c.zero(),ud=-1,as=null,ad=12,ld=.3010299956639812,oi=1e6,Pa=1e9,gc=1e12,gg=1,is=.001,xI=1e3,LI=Math.log10(1.00001),_I=23e-11,CI=Math.log(10),MI=1/CI;yc=null,vc=null,cd=null;Ua=new Map,yg=67,kI=67,TI=67;Ba=0});function xg(e){typeof e=="function"&&Eg.push(e)}function hd(){qa=null}function Ec(){qa=null;try{wc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{Qt()}catch{}}function gd(e){return typeof e=="function"&&wc.push(e),()=>{wc=wc.filter(t=>t!==e)}}function FI(e){let t=dt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Ce(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function UI(){try{return!!fn()}catch{return!1}}function Ga(e){let t=O?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(UI())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=kt(ve.STARTER_COVE,xe.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=FI(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function ai(e=ve.STARTER_COVE){if(qa)return qa;let t=Pt(e),n=[];if(e===ve.STARTER_COVE&&ve.DNA){let i=Pt(ve.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),goldValue:c.fromInt(1),magicValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=xn(s,i.id),a=He(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:p,mpMult:y}=Vo(i,l,s);r.xpValue=It(r.xpValue,d),r.coinValue=It(r.coinValue,p),r.mpValue=It(r.mpValue,y),u=It(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=It(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=It(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=It(r.mpValue,u);else if(i.effectType==="gold_value")r.goldValue=It(r.goldValue,u);else if(i.effectType==="magic_value")r.magicValue=It(r.magicValue,u);else if(i.effectType==="book_value")r.bookValue=It(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of Eg)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return qa=r,r}function us(e){let t=ai(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:BI*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue,goldValueMultiplier:t.goldValue,magicValueMultiplier:t.magicValue}}function md(){let{goldValue:e,magicValue:t}=ai(ve.STARTER_COVE);try{O.gold?.mult?.set&&O.gold.mult.set(e)}catch{}try{O.magic?.mult?.set&&O.magic.mult.set(t)}catch{}}function xc(){try{let{mpValue:e}=ai(ve.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Lc(){try{let{magnetRadius:e}=ai(ve.STARTER_COVE);return e||0}catch{return 0}}function Lg(){try{Xo()}catch{}md(),gd(md);try{qo(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=ai(ve.STARTER_COVE);return It(n,o)})}catch{}try{yr(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=ai(ve.STARTER_COVE);return It(n,o)})}catch{}try{li(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=ai(ve.STARTER_COVE);return It(n,o)})}catch{}Ga(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{Ga()}catch{}try{Qt()}catch{}try{md()}catch{}})}var BI,qa,wc,Eg,yd=De(()=>{Et();St();Lo();Vn();_o();ao();BI=1,qa=null,wc=[],Eg=[]});var Tg={};vt(Tg,{addExternalEacAmountMultiplierProvider:()=>Sd,addExternalEacMultiplierProvider:()=>DI,getAutobuyerToggle:()=>ci,getEacAmountMultiplier:()=>Mc,initAutomationEffects:()=>XI,setAutobuyerToggle:()=>Sr,setTsunamiBonusProvider:()=>bd,updateAutomation:()=>kg});function bd(e){_g=e}function DI(e){typeof e=="function"&&Cg.push(e)}function Sd(e){typeof e=="function"&&Mg.push(e)}function Mc(){let e=1;if(ct(2))if(ct(8)){let t=Ln(),n=_g(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of Mg)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function Id(e){Cc!==e&&(fs.clear(),Cc=e)}function ci(e,t){let n=b();Id(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(fs.has(r))return fs.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return fs.set(r,i),i}function Sr(e,t,n){let o=b();Id(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);fs.set(i,s);try{localStorage.setItem(i,s)}catch{}}function $I(e){kg(e),HI(e)}function qI(){if(_c)return _c;let e=Pt(ve.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return _c=t,_c}function GI(e){if(!(!e||e.length===0)){for(let t of e)if(ci(ve.STARTER_COVE,t.id)!=="0"){let o=kt(ve.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&Ed(ve.STARTER_COVE,t.id)}}}function HI(e){let t=b();Id(t);let n=qI();for(let[r,i]of Object.entries(rs)){let s=Number(r);kt(Ze,s)>0&&n[i]&&GI(n[i])}kt(Ze,io)>0&&(vd++,vd>=5&&(vd=0,ci(Ze,io)!=="0"&&Ic()))}function kg(e){let n=kt(Ze,ti);for(let r of Cg)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){Ha=0;return}Ha+=e;let o=1/n;if(Ha>=o){let r=Math.floor(Ha/o);if(r>0){let i=r;i*=Mc(),wd(i),Ha-=r*o}}}function XI(){xo($I),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Cc&&(fs.clear(),Cc=t)})}var Ha,vd,_g,Cg,Mg,fs,Cc,_c,ds=De(()=>{ei();ao();Xa();ni();ls();St();co();Ha=0,vd=0,_g=()=>0;Cg=[];Mg=[];fs=new Map,Cc=null;_c=null});function xd(){let e=b();if(Bg=e,e==null){Va=!1;return}try{Va=localStorage.getItem(VI(e))==="1"}catch{Va=!1}}function Yo(e){return ps.nodes[e]||(ps.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),ps.nodes[e]}function YI(e,t){let n=Yo(t);try{let o=localStorage.getItem(Ya(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(Wa(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(Og(e,t));n.active=i==="1";let s=localStorage.getItem(Pg(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function Ag(){xd();let e=b();ps.nodes={},Wn=null,e!=null&&Ut.forEach(t=>{YI(e,t.id),ps.nodes[t.id].active&&(Wn=t.id)})}function Ng(){let e=b();e!=null&&Ut.forEach(t=>{let n=ps.nodes[t.id];if(n)try{localStorage.setItem(Wa(e,t.id),n.rp.toStorage())}catch{}})}function pt(e){return Yo(e).level}function Ir(e,t){let n=b();if(n==null||Wt(Ya(n,e)))return!1;let o=Yo(e);o.level=t;try{localStorage.setItem(Ya(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function fo(e){return Yo(e).rp}function ms(e,t){let n=b();if(n!=null&&Wt(Wa(n,e)))return;let o=Yo(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function ui(e){return Yo(e).active}function za(e,t){let n=b();if(n==null)return;let o=!!t;o?(Wn!==null&&Wn!==e&&za(Wn,!1),Wn=e):Wn===e&&(Wn=null);let r=Yo(e);if(r.active!==o){r.active=o;try{localStorage.setItem(Og(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function Rg(e,t){let n=b();if(n==null)return;let o=Yo(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(Pg(n,e),o.discovered?"1":"0")}catch{}}}function wr(e){let t=uo.get(e);if(!t)return!1;if(Yo(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return Rg(e,!0),!0;if((e===5||e===6)&&((Bg!==b()||Va===null)&&xd(),!Va))return!1;for(let o of t.parentIds){let r=uo.get(o);if(!r)continue;if(pt(o)<r.maxLevel)return!1}return Rg(e,!0),!0}function kc(e){let t=uo.get(e);if(!t)return c.fromAny("Infinity");let n=pt(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function Co(){let e=0,t=pt(1);t>0&&(e+=t*.01);let n=pt(10);return n>0&&(e+=n*.01),e}function Fg(){return pt(4)>=1}function Ug(e=[]){if(b()!=null){try{di(0)}catch{}Wn!==null&&za(Wn,!1),Ut.forEach(n=>{e.includes(n.id)||(Ir(n.id,0),ms(n.id,c.fromInt(0)))})}}function Dg(e){let t=hs();if(t.isZero?.()||Wn===null)return;let n=uo.get(Wn);if(!n||!wr(n.id))return;let r=t.mulDecimal(e.toString(),18),i=fo(n.id);if(pt(n.id)>=n.maxLevel)return;let s=i.add(r);for(;;){let l=kc(n.id);if(s.cmp(l)<0||pt(n.id)>=n.maxLevel)break;s=s.sub(l);let a=pt(n.id);if(!Ir(n.id,a+1))break}ms(n.id,s)}function $g(){let e=uo.get(2);if(!e)return c.fromInt(1);let t=pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function qg(){let e=uo.get(3);if(!e)return c.fromInt(1);let t=pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function Ld(){let e=uo.get(5);if(!e)return c.fromInt(1);let t=pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function _d(){let e=uo.get(6);if(!e)return c.fromInt(1);let t=pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function WI(){let e=uo.get(7);if(!e)return c.fromInt(1);let t=pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.1,t);return c.fromAny(n)}function Gg(){let e=uo.get(8);return e?1+pt(e.id)*.1:1}function Hg(){let e=uo.get(9);return e?1+pt(e.id)*.1:1}function Xg(){qo(({baseMultiplier:e})=>{let t=$g();return e.mulDecimal(t.toScientific())}),yr(({baseGain:e})=>{let t=qg();return e.mulDecimal(t.toScientific())}),xg(()=>Gg()),Sd(()=>Hg()),bd(()=>Co()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&Qt(),e&&e.id===8&&Ec()})}var Ya,Wa,Og,Pg,VI,Ut,uo,Va,Bg,ps,Wn,fi=De(()=>{Et();St();pi();Yt();Vn();yd();ds();Ya=(e,t)=>`ccc:lab:node:level:${t}:${e}`,Wa=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,Og=(e,t)=>`ccc:lab:node:active:${t}:${e}`,Pg=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,VI=e=>`ccc:reset:experiment:completed:${e}`,Ut=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Fe($g())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Fe(qg())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Fe(Ld())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Fe(_d())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e8,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Fe(WI())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e12,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Fe(Gg())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e12,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Fe(Hg())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:1e15,scale:2,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`}],uo=new Map(Ut.map(e=>[e.id,e])),Va=null,Bg=null,ps={nodes:{}},Wn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",Ag),setInterval(Ng,1e3),window.addEventListener("beforeunload",Ng),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&xd()}),Ag());window.RESEARCH_NODES=Ut;window.isResearchNodeVisible=wr});var jg={};vt(jg,{getBookProductionRate:()=>Lr,getEffectiveTsunamiNerf:()=>xr,getSurge6WealthMultipliers:()=>Tc,getTsunamiNerf:()=>Ln,getTsunamiNerfKey:()=>Md,getTsunamiSequenceSeen:()=>dn,initSurgeEffects:()=>jI,isSurgeActive:()=>ct,setTsunamiNerf:()=>mi,setTsunamiSequenceSeen:()=>zo});function Md(e){return Cd(e)}function dn(){let e=b();if(e==null)return!1;try{return localStorage.getItem(Kg(e))==="1"}catch{return!1}}function zo(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(Kg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Ln(){return Er}function xr(){let t=Ln()+Co();return t>1&&(t=1),t}function mi(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=Cd(n);if(Wt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}Er=t,gs();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function ct(e){return po===1/0||typeof po=="string"&&po==="Infinity"||po===Number.POSITIVE_INFINITY?!0:typeof po=="bigint"?po>=BigInt(e):typeof po=="number"?po>=e:!1}function Ka(e){if(!ct(8))return e;let t=Ne(e);if(!Number.isFinite(t))return e;let n=xr();return Ce(t*n)}function gs(){let e=zn();po=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(ct(8)){let n=xr(),o=Math.log10(Vg);Wo=Ce(o*n)}else Wo=c.fromInt(Vg);else Wo=c.fromInt(1)}function Tc(){if(!ct(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,y=0)=>{if(!p){if(y<=0)return c.fromInt(1);let C=Math.log10(y)/3;if(C<=0)return c.fromInt(1);let A=C*Math.log10(2);return Ce(A)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=Ne(p),g=m;if(Number.isFinite(m)){if(m<15&&y>0)try{let E=Number(p.toPlainIntegerString());if(Number.isFinite(E)){let C=E+y;C>0&&(g=Math.log10(C))}}catch{}}else if(y>0)g=Math.log10(y);else return c.fromInt(1);let h=g/6;if(h<=0)return c.fromInt(1);let v=h*Math.log10(2);return Ce(v)},t=e(O.coins?.value),n=O.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(O.gold?.value),s=e(O.magic?.value),l=t,a=r,u=i,f=s;ct(8)&&(l=Ka(t),a=Ka(r),u=Ka(i),f=Ka(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function Lr(){if(!ct(3))return c.fromInt(0);let t=ot().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(Yg),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Ce(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*Yg;n=Ce(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),O.books?.mult){let o=O.books.mult.get();n=n.mulBigNumInteger(o)}return ct(8)&&(n=Ka(n)),n}function zI(e){if(!ct(3))return;Wg||(Wg=new Ta("books",O));let t=Lr();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);O.books&&O.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,O.books&&O.books.add(c.fromInt(o))}}}function zg(e){if(e==null)return;let t=localStorage.getItem(Cd(e));t!==null?(Er=Number(t),(Number.isNaN(Er)||!Number.isFinite(Er))&&(Er=ct(8)?0:1)):ct(8)?Er=0:Er=1}function KI(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function jI(){let e=b();gs(),zg(e),gs(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=po,n=ct(8);gs();let o=po,r=ct(8);!n&&r?(mi(0),dn()||zo(!0)):r?KI(t,o)>0&&(mi(0),dn()||zo(!0)):n&&!r&&mi(1)}),window.addEventListener("lab:node:change",()=>{gs()}),window.addEventListener("saveSlot:change",()=>{zg(b()),gs()})),qo(({baseMultiplier:t})=>Wo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Wo)),yr(({baseGain:t})=>Wo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Wo)),li(({baseGain:t})=>Wo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Wo)),li(({baseGain:t})=>{if(!ct(4))return t;let n=c.fromInt(4444e9);if(ct(8)){let o=xr(),r=Math.log10(4444e9);n=Ce(r*o)}return t.mulBigNumInteger(n)}),qo(({baseMultiplier:t})=>{if(!ct(6))return t;let n=Tc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),dc(({baseReward:t})=>ct(3)?c.fromInt(0):t),xo(zI)}var Vg,Yg,Cd,Kg,Wo,po,Wg,Er,co=De(()=>{Et();St();Vn();_o();Lo();ei();Et();fi();Vg=10,Yg=.08685889638,Cd=e=>`ccc:surge:tsunamiNerf:${e}`,Kg=e=>`ccc:unlock:tsunami:${e}`;Wo=c.fromInt(1),po=0n,Wg=null,Er=0});var ty={};vt(ty,{getLabCost:()=>Qg,getLabLevel:()=>zt,getLabLevelFromCoins:()=>ey,getLabLevelKey:()=>Td,getRpMult:()=>hs,getRpMultBase:()=>Rc,hasVisitedLab:()=>Ss,initLabLogic:()=>ZI,initLabTab:()=>Rd,setLabLevel:()=>di,setLabVisited:()=>Jg,updateLabLevel:()=>Ad,updateLabTab:()=>Od});function Za(){let e=b();if(Ja=e,e==null){Ko=c.fromInt(0),hi=!1;return}try{let t=localStorage.getItem(Nc(e));t?Ko=c.fromAny(t):Ko=c.fromInt(0)}catch{Ko=c.fromInt(0)}try{hi=localStorage.getItem(Zg(e))==="1"}catch{hi=!1}}function Ss(){let e=b();return e==null?!1:((Ja!==e||hi===null)&&Za(),hi)}function Jg(e){let t=b();if(t==null)return;let n=!!e;if(!(hi===n&&Ja===t)){hi=n;try{localStorage.setItem(Zg(t),n?"1":"0")}catch{}}}function zt(){let e=b();return e==null?c.fromInt(0):O.coins.value.isInfinite()?c.fromAny("Infinity"):((Ja!==e||Ko===null)&&Za(),Ko)}function di(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((Ja!==t||Ko===null)&&Za(),n.cmp(Ko)===0)return;Ko=n,localStorage.setItem(Nc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function Qg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function ey(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Ad(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Nc(e)))return;let t=O.coins.value,n=zt();if(t.isInfinite()){n.isInfinite()||di(c.fromAny("Infinity"));return}let o=ey(t);o.cmp(n)>0&&di(o)}function ZI(){Za(),typeof window<"u"&&window.addEventListener("saveSlot:change",Za),xo(Ad),xo(Dg),Xg()}function Nd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function JI(e){if(!e||typeof e!="object")return 0;if(Nd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function ew(e){if(Nd(e)||typeof e.cmp=="function"&&e.cmp(QI)>=0)return bs.clone?.()??bs;let t=e.floorToInteger(),n=e.sub(t),o=JI(n);if(!Number.isFinite(o))return bs.clone?.()??bs;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return bs.clone?.()??bs;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),m=Number(y),g=d-y;return new c(a,{base:m,offset:g})}function Rc(){let e=zt();if(Nd(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return ew(n)}function hs(){let e=Rc();return typeof Yn=="function"?Yn("rp",e):e}function Rd(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",ja&&ja.destroy(),ja=new kd(e))}function Od(){Jg(!0),ja&&ja.resize()}var _r,ys,vs,Zg,Nc,Ko,hi,Ja,Td,bs,QI,ja,Ac,kd,pi=De(()=>{St();lo();Et();Yt();co();ei();Qi();fi();si();ao();_r=1e308,ys=1e300,vs=1e-300,Zg=e=>`ccc:lab:visited:${e}`,Nc=e=>`ccc:lab:level:${e}`,Ko=null,hi=null,Ja=null;Td=e=>Nc(e);bs=c.fromAny("Infinity"),QI=c.fromScientific(String(c.MAX_E));ja=null;Ac=512*.95,kd=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${ne(zt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Ad()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami Exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>_r&&(this.camX=_r),this.camX<-_r&&(this.camX=-_r),this.camY>_r&&(this.camY=_r),this.camY<-_r&&(this.camY=-_r),this.zoom>ys&&(this.zoom=ys),this.zoom<vs&&(this.zoom=vs)}update(t){this.checkBounds();let n=zt(),o=Qg(n.add(1)),r=Ln(),i=Co(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${ne(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${ne(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami Exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let p=this.bursts[d];p.time+=t;for(let y of p.particles)y.x+=y.vx*t,y.y+=y.vy*t,y.vx*=.95,y.vy*=.95;p.time>=p.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),p=(_,U)=>{if(U<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*U})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/_)*_,L=Math.ceil((this.camX+n/2/r)/_)*_;if((L-M)/_>1e3)return;for(let ae=M;ae<=L&&!(ae+_<=ae);ae+=_){let pe=(ae-this.camX)*r+n/2;t.moveTo(pe,0),t.lineTo(pe,o)}let H=Math.floor((this.camY-o/2/r)/_)*_,J=Math.ceil((this.camY+o/2/r)/_)*_;for(let ae=H;ae<=J&&!(ae+_<=ae);ae+=_){let pe=(ae-this.camY)*r+o/2;t.moveTo(0,pe),t.lineTo(n,pe)}t.stroke()},y=d*r,m=Math.max(0,Math.min(1,(y-15)/25));p(d,m),p(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let g=(0-this.camY)*r+o/2;g>=-10&&g<=o+10&&(t.moveTo(0,g),t.lineTo(n,g));let h=(0-this.camX)*r+n/2;h>=-10&&h<=n+10&&(t.moveTo(h,0),t.lineTo(h,o)),t.stroke();let v=[],E=new Map;for(let _ of Ut)wr(_.id)&&(v.push(_),E.set(_.id,this.getNodePosition(_)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let _ of v)if(_.parentIds&&_.parentIds.length>0)for(let U of _.parentIds){let M=Ut.find(L=>L.id===U);if(M&&E.has(M.id)){let L=E.get(M.id),H=E.get(_.id),J=(L.x-this.camX)*r+n/2,ae=(L.y-this.camY)*r+o/2,pe=(H.x-this.camX)*r+n/2,ye=(H.y-this.camY)*r+o/2;t.moveTo(J,ae),t.lineTo(pe,ye)}}t.stroke();let C=Ac,A=C*r,V=C*1.6*r;for(let _ of v){let U=E.get(_.id),M=(U.x-this.camX)*r+n/2,L=(U.y-this.camY)*r+o/2,H=pt(_.id),J=H>=_.maxLevel,ae=!0;if(M+V/2<0||M-V/2>n||L+V*.8<0||L-V/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,M-V/2,L-V/2,V,V),J?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,M-V/2,L-V/2,V,V):ui(_.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,M-V/2,L-V/2,V,V);let ye=this.nodeImages[_.id];if(ye||(ye=new Image,ye.src="img/"+_.icon,this.nodeImages[_.id]=ye),ye.complete&&ye.naturalWidth!==0&&t.drawImage(ye,M-A/2,L-A/2,A,A),ae){let Me=kc(_.id),ie=0;if(J)ie=1;else if(Me.isInfinite?.()||typeof Me.cmp=="function"&&Me.cmp(c.fromAny("Infinity"))===0)ie=0;else{let z=fo(_.id);if(z.isZero?.())ie=0;else try{if(Me.isZero?.())ie=1;else{let me=z.div(Me).toScientific(5);ie=Number(me)}}catch{ie=0}}ie=Math.max(0,Math.min(1,ie));let D=V*.96,Z=V*.18,$=M-D/2,G=L+V/2+V*.05;t.fillStyle="#111",t.fillRect($,G,D,Z);let j=t.createLinearGradient($,G,$,G+Z);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,G,D*ie,Z),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,G,D,Z),t.fillStyle="#fff",t.font=`bold ${Z*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,Z*.08);let W=`Level ${H}`;J&&(W=_.maxLevel===1?"UNLOCKED":"MAXED");let re=t.measureText(W),x=G+Z/2+(re.actualBoundingBoxAscent-re.actualBoundingBoxDescent)/2;t.strokeText(W,$+D/2,x),t.fillText(W,$+D/2,x)}}let B=35,q=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let _ of this.bursts){let U=(_.x-this.camX)*this.zoom+n/2,M=(_.y-this.camY)*this.zoom+o/2;for(let L=0;L<q.length;L++){let H=q[L],J=_.time-H.delay;if(J>0&&J<H.dur){let ae=J/H.dur,pe=1-Math.pow(1-ae,3),ye=B*pe,Me=Math.max(0,1-Math.pow(ae,2)),ie=1+L*.5,D=t.createRadialGradient(U,M,ye*.6,U,M,ye);D.addColorStop(0,"rgba(255, 200, 50, 0)"),D.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,Me*.15*ie)})`),D.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,Me*.2*ie)})`),D.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=D,t.beginPath(),t.arc(U,M,ye,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let L of _.particles)if(_.time<L.life){let H=1-_.time/L.life,J=U+L.x,ae=M+L.y;t.fillStyle=`rgba(255, 255, 150, ${H})`,t.beginPath(),t.arc(J,ae,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Ac/2*1.6;for(let u of Ut){if(!wr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,p=l-f.y;if(Math.sqrt(d*d+p*p)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Ut.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.textContent=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=ui(t);za(t,!p),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Pd(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Ut.find(l=>l.id===this.activeOverlayId);if(!t||!wr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=pt(t.id),o=fo(t.id),r=kc(t.id),i=ui(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.textContent=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?ne(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?ne(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${ne(o)} / ${ne(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Ac/2*1.6;for(let u of Ut){if(!wr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,p=l-f.y;if(Math.sqrt(d*d+p*p)<=a){if(pt(u.id)>=u.maxLevel)return;let g=ui(u.id);za(u.id,!g),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=Ac/2*1.6;for(let u of Ut){if(!wr(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,p=s-f.y;if(Math.sqrt(d*d+p*p)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<vs&&(i=vs),i>ys&&(i=ys);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<vs&&(i=vs),i>ys&&(i=ys);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var ry={};vt(ry,{calculateOfflineRewards:()=>Is,calculatePreAutomationRewards:()=>Pc,formatTimeCompact:()=>Oc,grantOfflineRewards:()=>gi,initOfflineTracker:()=>ow,processOfflineProgress:()=>oy,showOfflinePanel:()=>Cr});function Oc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let h=t.div(l).floorToInteger(),v=h.mulBigNumInteger(l),E=t.sub(v),C=0;try{let A=E.div(c.fromInt(i)).floorToInteger();C=Number(A.toPlainIntegerString())}catch{C=0}return C===0?`${ne(h)}y`:`${ne(h)}y ${C}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let p=Math.floor(f/60),y=f%60;if(p<24)return y===0?`${p}h`:`${p}h ${y}m`;let m=Math.floor(p/24),g=p%24;return g===0?`${m}d`:`${m}d ${g}h`}function Cr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${Oc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",tw.forEach(m=>{let g=m.key,h=e[g];if(!h||typeof h.isZero=="function"&&h.isZero())return;if(g==="research_levels"){Array.isArray(h)&&h.forEach(B=>{let q=document.createElement("div");q.className="offline-row";let _=document.createElement("span");_.className="offline-plus",_.style.color="#004F96",_.textContent="+";let U=document.createElement("img");U.className="offline-icon",U.src=m.icon,U.alt="RP";let M=document.createElement("span");M.className="offline-text",M.style.color="#004F96";let L=c.fromInt(B.levels),H=L.cmp(c.fromInt(1))===0?"Level":"Levels";M.textContent=`${ne(L)} ${H} of ${B.name}`,q.appendChild(_),q.appendChild(U),q.appendChild(M),f.appendChild(q)});return}let v=document.createElement("div");v.className="offline-row";let E=document.createElement("span");E.className="offline-plus",E.classList.add(`text-${g}`),E.textContent="+";let C=document.createElement("img");C.className="offline-icon",C.src=m.icon,C.alt=g;let A=document.createElement("span");A.className="offline-text",A.classList.add(`text-${g}`);let N=!1;h instanceof c?N=!h.isInfinite()&&h.cmp(c.fromInt(1))===0:N=Number(h)===1;let V=N?m.singular:m.plural;A.innerHTML=`${ne(h)} ${V}`,v.appendChild(E),v.appendChild(C),v.appendChild(A),f.appendChild(v)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let y=()=>{r.remove()};return p.addEventListener("click",y),r.addEventListener("click",m=>{m.target===r&&y()}),d.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{ws(i,a,".offline-scroll-container")}),r}function nw(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function Is(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=hs?hs():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Ut.filter(y=>ui(y.id)),d=[],p={};for(let y of f){let m=pt(y.id),g=fo(y.id).add(u),h=0,v=y.maxLevel;for(;m<v;){let E=nw(y,m);if(E.isInfinite&&E.isInfinite()||g.cmp(E)<0)break;g=g.sub(E),m++,h++}h>0&&d.push({name:y.title,levels:h}),p[y.id]={level:m,rp:g}}d.length>0&&(o.research_levels=d),Object.keys(p).length>0&&(o.research_progress=p)}let s=(Sc?Sc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||$n("gears",t)||(o.gears=s);let l=Lr?Lr():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||$n("books",t)||(o.books=u)}let a=kt(Ze,ti)||0;if(a>0){let u=1;ct(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=Fc(),p=d.coins.mulBigNumInteger(f),y=d.xp.mulBigNumInteger(f),m=d.mp.mulBigNumInteger(f);p.isZero()||$n("coins",t)||(o.coins=p),y.isZero()||Wt(`ccc:xp:progress:${t}`)||(o.xp=y),m.isZero()||Wt(`ccc:mutation:progress:${t}`)||(o.mp=m)}}return o}function gi(e){if(b()!=null){if(e.xp)try{let n=Ji(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Es(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(Ir(r,o.level),ms(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||O[n]&&typeof O[n].add=="function"&&O[n].add(e[n])}}function Pc(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=Kn(),i=c.fromInt(1);try{let l=us(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Yn=="function"){let l=Yn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=Fc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||Wt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||Wt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function oy(){let e=b();if(e==null)return;let t=kf(),n=Date.now();if(t<=0)return;if(n<t-1e4){In(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!$t()){let l=Pc(r),a=Object.keys(l).length>0;return a&&(gi(l),Cr(l,o,!0)),a}let i=Is(r),s=Object.keys(i).length>0;return s&&(gi(i),Cr(i,o)),s}function ow(e,t){ny||(ny=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?rd():(id(),oy()&&typeof t=="function"&&t())))}))}var ny,tw,Bc=De(()=>{St();ls();Lo();ei();St();Et();Yt();si();lo();ao();pi();fi();ni();Xa();Vn();_o();co();Qi();ny=!1;tw=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Cr});function Ud(e){let t=24,n=Date.now();try{let o=localStorage.getItem(Bd(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Fd(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(Bd(e),"24"),localStorage.setItem(Fd(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function sy(e,t,n){try{localStorage.setItem(Bd(e),String(t)),localStorage.setItem(Fd(e),String(n))}catch{}}function ay(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=Ud(e);if(t>=xs)return;let o=Date.now(),r=o-n;if(r>=Uc){let i=Math.floor(r/Uc);t+=i,t>=xs?(t=xs,n=o):n+=i*Uc,sy(e,t,n),Mr&&Mr.classList.contains("is-active")&&jo(!0)}}function iw(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function sw(){let e=b();if(e==null)return;ay();let{charges:t,lastCharge:n}=Ud(e);t<=0||(t>=xs&&(n=Date.now()-50),t--,sy(e,t,n),jo(!0),Qa&&clearInterval(Qa),Qa=setInterval(()=>{jo()},1e3),ht(rw,{volume:.5}),iw(),setTimeout(()=>{let o=Is(iy);gi(o),Cr(o,iy*1e3)},7250))}function jo(e=!1){if(!Mr||!Mr.classList.contains("is-active"))return;let t=b();if(t==null)return;e||ay();let{charges:n,lastCharge:o}=Ud(t),r=Mr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${xs}</span>`);let i=Mr.querySelector(".warp-timer");if(i)if(n>=xs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+Uc,u=Math.max(0,a-l);i.textContent=`Next warp in ${Oc(u)}`}let s=Mr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function ly(e){if(!e||e.__warpInit)return;e.__warpInit=!0,Mr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",sw),Qa||(Qa=setInterval(()=>{jo()},1e3)),jo()}var Bd,Fd,xs,Uc,iy,rw,Mr,Qa,Dd=De(()=>{St();Bc();Dn();Bd=e=>`ccc:warp:charges:${e}`,Fd=e=>`ccc:warp:lastCharge:${e}`,xs=24,Uc=3600*1e3,iy=150,rw="sounds/warp.ogg",Mr=null,Qa=null});function vy(){try{return localStorage.getItem(Tr(zd))==="1"}catch{return!1}}function jd(){try{return localStorage.getItem(Tr(by))==="1"}catch{return!1}}function Gc(e){let t=b();if(t==null)return;let n=`${by}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),aw()}catch{}}function Hc(){return jd()?"Jeff":"Merchant"}function aw(){let e=Hc();We&&We.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function el(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=h=>{if(!(n&&o)){if(h?.type==="click"&&h.isTrusted&&ro(e)){h.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(h)).catch(v=>console.error(v)),n&&g()}},l=()=>{r=!1,i=null},a=h=>{r&&l(),s(h)},u=h=>{h.pointerType!=="mouse"&&(typeof h.button=="number"&&h.button!==0||(r=!0,i=typeof h.pointerId=="number"?h.pointerId:null,Eo(160)))},f=h=>{r&&(i!=null&&typeof h.pointerId=="number"&&h.pointerId!==i||l())},d=()=>{r&&l()},p=h=>{r=!0,Eo(160)},y=h=>{r&&l()},m=()=>{r&&l()},g=()=>{e.removeEventListener("click",a),Sy?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):dw&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function Dc(e){return uw[e]??0}function cy(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function pw(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function nl(e,t){let n=yi.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;_s.set(e,r),n.unlocked=r;let i=_n.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&_n.buttons[e]?.classList.contains("is-active")&&Yc("dialogue")}function $d(){let e=!1;try{e=!!ks?.()}catch{}nl("reset",e)}function qd(){let e=!1;try{e=!!$t?.()}catch{}nl("workshop",e)}function py(){let e=!1;try{typeof Mo=="function"&&(e=Mo())}catch{}nl("warp",e)}function mw(){let e=b();if(e==null)return!1;try{return typeof dn=="function"&&dn()?!0:localStorage.getItem(Iy(e))==="1"}catch{return!1}}function Vd(){nl("lab",mw())}function hw(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function gw(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof fn=="function"&&fn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof ot=="function"?ot():null;t&&typeof t=="object"&&(e.xpLevel=hw(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Nr=="function"&&Nr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof $t=="function"&&$t()}catch{e.hasInfuseReset=!1}return e}function yw(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?Hd:Xd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?Hd:Xd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Zd:""),i.icon=o?.icon??(r==="mysterious"?kr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Zo:cw),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function vw(){if(uy)return;uy=!0;let e=bw;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${fw}:${t}`;Mt(n,{onChange:e})}}function bw(){Jo()}function Sw(e,t){let n=Jd(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,wy(n),Iw(t.reward),!0)}function Iw(e){if(e){if(e.type==="coins"){try{O.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{O.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{O.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function ww(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function Jd(){try{return JSON.parse(localStorage.getItem(Tr(tl))||"{}")}catch{return{}}}function wy(e){let t=Tr(tl);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{at(t,n)}catch{}}catch{}}function Ew(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function xw(){let e=Yd;if(Yd=null,typeof e=="function")try{e()}catch{}}function Lw(e,t={}){t?.rawChanged&&Jo()}function Gd(e){if(e===my)return;if(xw(),my=e??null,e==null){Jo();return}let t=`${tl}:${e}`;Yd=Mt(t,{parse:Ew,onChange:Lw});try{at(t)}catch{}Jo()}function _w(){if(fy){Gd(b());return}fy=!0,Gd(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Gd(b())})}function Rr(){Promise.resolve().then(()=>(Dn(),Yl)).then(({loadAudio:e})=>{e(Ey)})}function Cw(){if(Ls)return;Ls=ht(Ey,{volume:je?.15:.3,loop:!0})}function er(){Ls&&(Ls.stop&&Ls.stop(),Ls=null)}function Mw(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let E=0;E<t.length;E++){let C=t[E];C==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=C):C===">"&&l?(s+=C,i.push({type:"tag",content:s}),s="",l=!1):s+=C}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,p="";Qo=!0,Cw();let y=E=>{d&&(E.preventDefault(),f=!0)},m=E=>{d&&(E.key==="Enter"||E.key===" ")&&(f=!0)},g=o.length?o:[e];requestAnimationFrame(()=>{d=!0,g.forEach(E=>E.addEventListener("click",y,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let h=()=>{g.forEach(E=>E.removeEventListener("click",y)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),er(),Qo=!1},v=()=>{if(f){e.innerHTML=t,h(),r();return}if(a>=i.length){h(),r();return}let E=i[a];E.type==="tag"?(p+=E.content,e.innerHTML=p,a++,v()):(p+=E.content[u],e.innerHTML=p,u++,u>=E.content.length&&(a++,u=0),setTimeout(v,n))};v()})}function kw(e={}){if(!We)return;Rr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Zo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||kr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,We.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Zo,r.textContent=e.message||Zd,requestAnimationFrame(()=>t.classList.add("is-visible")),We.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),We.classList.remove("firstchat-active"),er(),Qo=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),Mn(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&Mn(160),l()};el(i,()=>{u()},{once:!0}),i.focus?.()}function Tw(e,t){Rr();let n=t.scriptId;String(e)==="6"&&typeof Ss=="function"&&!Ss()&&(n=7),Vr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,We.appendChild(o);let r=h=>{h.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),We.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{Vr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),We.classList.remove("firstchat-active"),er(),Qo=!1,o.remove()},d=()=>{u||(u=!0,f(),Jo())};o.addEventListener("pointerdown",h=>{l.contains(h.target)||(h.preventDefault(),h.pointerType!=="mouse"&&Mn(160),d())});let p=new Ar({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(h,v)=>{t.scriptId===4&&h==="c4b"&&Gc(!0)},onEnd:h=>{if(!u){if(u=!0,h&&h.noReward){Jo(),f();return}Sw(e,t),Jo(),f()}}}),m=!!Jd()[e]?.claimed,g=structuredClone(Qf[n]);m&&g.nodes.m2b&&g.nodes.c2a&&t.scriptId===1&&(g.nodes.m2b.say="I've already given you Coins, goodbye.",g.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&g.nodes.m3a&&(g.nodes.m3a.say="I've already given you Books, goodbye.",g.nodes.c2a&&(g.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&g.nodes.m5a&&(g.nodes.m5a.say="I've already given you Gold, goodbye.",g.nodes.c5a&&(g.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&g.nodes.m7a&&(g.nodes.m7a.say="I've already given you Magic, goodbye.",g.nodes.c7a&&(g.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(g),p.start()}function Aw(){if(document.getElementById(gy))return;let e=document.createElement("style");e.id=gy,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function Nw(){let e=We?.querySelector(".merchant-content");if(!e||e.__customScroll||!yt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),yt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){Aw();let L=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;yt.style.timelineScope=L,e.style.scrollTimelineName=L,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=L,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let M=(e.scrollTop||0)>0;f!==M&&(f=M,yt?.classList.toggle("has-scroll-shadow",M))},p=()=>{let M=We.querySelector(".merchant-grabber"),L=We.querySelector(".merchant-header"),H=We.querySelector(".merchant-actions"),J=(M?.offsetHeight||0)+(L?.offsetHeight||0)|0,ae=(H?.offsetHeight||0)|0;t.style.top=J+"px",t.style.bottom=ae+"px"},y={},m=()=>{let{scrollHeight:M,clientHeight:L,scrollTop:H}=e,J=t.clientHeight||e.clientHeight||1;if(y.scrollHeight===M&&y.clientHeight===L&&y.barH===J&&(u||y.scrollTop===H))return;y={scrollHeight:M,clientHeight:L,scrollTop:H,barH:J};let ae=L/Math.max(1,M),pe=Math.max(28,Math.round(J*ae)),ye=Math.max(1,M-L),Me=Math.max(0,J-pe);if(n.style.height=pe+"px",u)n.style.setProperty("--thumb-y",`${Me}px`),n.style.setProperty("--thumb-x","0px");else{let ie=Math.round(H/ye*Me);n.style.transform=`translateY(${ie}px)`}t.style.display=M<=L+1?"none":""},g=()=>{p(),m(),d()},h=()=>{o&&(yt.classList.add("is-scrolling"),l&&clearTimeout(l))},v=M=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{yt.classList.remove("is-scrolling")},M))},E=()=>{m(),d(),o&&h(),s||v(r)},C=()=>v(r);e.addEventListener("scroll",E,{passive:!0}),s&&e.addEventListener("scrollend",C,{passive:!0});let A=new ResizeObserver(g);A.observe(e),window.addEventListener("resize",g),requestAnimationFrame(g);let N=!1,V=0,B=0,q=M=>{N=!0,V=M.clientY,B=e.scrollTop,n.classList.add("dragging"),h();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},_=M=>{if(!N)return;let L=t.clientHeight||1,H=n.clientHeight||1,J=Math.max(1,L-H),ae=Math.max(1,e.scrollHeight-e.clientHeight),ye=(M.clientY-V)/J*ae;e.scrollTop=B+ye},U=M=>{if(N){N=!1,n.classList.remove("dragging"),v(i);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",q),window.addEventListener("pointermove",_,{passive:!0}),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let L=t.getBoundingClientRect(),H=M.clientY-L.top,J=t.clientHeight||1,ae=n.clientHeight||1,pe=Math.max(0,J-ae),ye=Math.max(0,Math.min(H-ae/2,pe)),Me=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ye/Math.max(1,pe)*Me,h(),v(r)}),e.__customScroll={bar:t,thumb:n,ro:A,updateAll:g},g()}function Rw(){if(We)return;We=document.createElement("div"),We.className="merchant-overlay",We.id="merchant-overlay",We.setAttribute("inert",""),yt=document.createElement("div"),yt.className="merchant-sheet",yt.setAttribute("role","dialog"),yt.setAttribute("aria-modal","false"),yt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",$d(),qd(),py(),Vd(),yi.forEach(y=>{y.key==="dialogue"&&_s.set("dialogue",!0);let m=_s.get(y.key),g=m??!!y.unlocked,h=document.createElement("button");h.type="button",h.className="merchant-tab",h.dataset.tab=y.key;let v=y.lockedLabel||"???";h.textContent=g?y.label:v,g?h.title=y.label||"Tab":(h.classList.add("is-locked"),h.disabled=!0,h.title="???"),y.unlocked=g,_s.set(y.key,g),el(h,E=>{if(h.disabled){E?.preventDefault?.();return}Yc(y.key)}),o.appendChild(h),_n.buttons[y.key]=h}),_n.panels.dialogue=i,_n.panels.reset=s,_n.panels.workshop=l,_n.panels.warp=a,_n.panels.lab=u,_n.tablist=o,r.append(i,s,l,a,u),n.append(o,r),$d(),qd();try{Xo()}catch{}try{Qd(s)}catch{}try{Xe()}catch{}try{pd(l)}catch{}try{ly(a)}catch{}try{Rd(u)}catch{}if(!dy&&typeof window<"u"){let y=m=>{let{key:g,slot:h}=m?.detail??{};h!=null&&h!==b()||((g==="forge"||!g)&&$d(),(g==="infuse"||!g)&&qd(),(g==="surge_completed"||!g)&&py(),(g==="lab"||g==="tsunami"||!g)&&Vd())};window.addEventListener("unlock:change",y,{passive:!0}),window.addEventListener("saveSlot:change",y,{passive:!0}),dy=!0}let f=document.createElement("div");f.className="merchant-actions";let d=document.createElement("button");d.type="button",d.className="merchant-close",d.textContent="Close",$c=d,f.appendChild(d);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,yt.append(e,t,n,f,p),We.appendChild(yt),document.body.appendChild(We),Ow(),Nw(),hy||(hy=!0,el(d,()=>{Vc()},{once:!1}),document.addEventListener("keydown",Uw),e.addEventListener("pointerdown",Dw),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),We.addEventListener("pointerdown",Rr,{once:!0}))}function Ow(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,vw(),Jo()}function Pw(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?Tw(n.id,n.meta):n.isMysterious&&kw(n.lockInfo)}}function Jo(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=gw(),o=Jd(),r=!1,i=new Set;Object.entries(Xc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=Dc(u),d=yw(l,n),p=d.status,y=Dc(p);if(y>f)a.status=p,p==="mysterious"?a.lockSnapshot=cy(d):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(y<f){if(u==="unlocked")d=pw(l),p="unlocked",y=Dc(p);else if(u==="mysterious"){let M=a.lockSnapshot||cy(d)||{};d={status:"mysterious",unlocked:!1,title:M.title??d.title??"???",blurb:M.blurb??d.blurb??Hd,tooltip:M.tooltip??d.tooltip??"Hidden Dialogue",message:M.message??d.message??Zd,icon:M.icon??d.icon??kr,headerTitle:M.headerTitle??d.headerTitle??Zo,ariaLabel:M.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},p="mysterious",y=Dc(p)}}let m=p==="unlocked",g=p==="mysterious",h=p==="locked",v=!!a.claimed,E=m&&!!(l.once&&v),C=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!C){C=document.createElement("button"),C.type="button",C.className="dlg-card",C.dataset.dlgId=String(s);let M=document.createElement("div");M.className="dlg-title";let L=document.createElement("div");L.className="dlg-blurb";let H=document.createElement("div");H.className="dlg-reward",C.append(M,L,H),t.appendChild(C),el(C,Pw)}C._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:m,isMysterious:g},C.dataset.dlgStatus=p,C.disabled!==!!h&&(C.disabled=!!h),C.classList.toggle("is-locked",h),C.classList.toggle("is-mysterious",g),C.classList.toggle("is-complete",!!E),C.classList.toggle("has-again",!!E),h?(C.getAttribute("aria-disabled")!=="true"&&C.setAttribute("aria-disabled","true"),C.getAttribute("tabindex")!=="-1"&&C.setAttribute("tabindex","-1")):(C.hasAttribute("aria-disabled")&&C.removeAttribute("aria-disabled"),C.hasAttribute("tabindex")&&C.removeAttribute("tabindex"));let A=C.querySelector(".dlg-title"),N=m?l.title:d.title??"???";A.textContent!==N&&(A.textContent=N);let V=C.querySelector(".dlg-blurb"),B=m?l.blurb:d.blurb??"";V.textContent!==B&&(V.textContent=B);let q=C.querySelector(".dlg-reward");if(m&&l.reward){let M=lw[l.reward.type];if(M){q.classList.contains("has-reward")||(q.classList.add("has-reward"),q.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),q.style.getPropertyValue("--reward-icon")!==`url('${M}')`&&q.style.setProperty("--reward-icon",`url('${M}')`);let L=q.querySelector(".amt"),H=String(l.reward.amount);L&&L.textContent!==H&&(L.textContent=H);let J=q.querySelector(".currency-name");if(J){let pe=String(l.reward.type||""),ye=pe.charAt(0).toUpperCase()+pe.slice(1);J.textContent!==ye&&(J.textContent=ye)}let ae=`Reward: ${l.reward.amount} ${l.reward.type}`;q.getAttribute("aria-label")!==ae&&q.setAttribute("aria-label",ae)}else{q.classList.remove("has-reward");let L=ww(l.reward);q.textContent!==L&&(q.textContent=L),q.style.display!==""&&(q.style.display=""),q.removeAttribute("aria-label")}q.style.display==="none"&&(q.style.display="")}else q.textContent!==""&&(q.textContent=""),q.style.display!=="none"&&(q.style.display="none");let _=m?`${l.title}${E?" (completed)":""}`:d.ariaLabel||(g?"Hidden merchant dialogue":"Locked merchant dialogue");if(C.getAttribute("aria-label")!==_&&C.setAttribute("aria-label",_),d.tooltip)C.title!==d.tooltip&&(C.title=d.tooltip);else if(m){let M="Left-click: Start Dialogue";C.title!==M&&(C.title=M)}else C.hasAttribute("title")&&C.removeAttribute("title");let U=C.querySelector(".dlg-again");E?U||(U=document.createElement("div"),U.className="dlg-again",U.textContent="Ask Again?",C.appendChild(U)):U&&U.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&wy(o)}function Bw(){let e=We.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Vr(!0);let i=new Ar({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Vr(!1);try{localStorage.setItem(Tr(zd),"1")}catch{}try{window.dispatchEvent(new Event(Kd))}catch{}e.classList.remove("is-visible"),We.classList.remove("firstchat-active")}});i.load(Qf[0]),i.start()}function Fw(){if(!We)return;let e=We.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),We.classList.remove("firstchat-active")}function xy(){if(Rw(),Ms)return;let e=document.activeElement;e instanceof HTMLElement&&!We.contains(e)?qc=e:qc=null,Ms=!0;let t=b(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(Iy(t),"1")}catch{}Vd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Tr(zd))==="1"}catch{o=!1}o||We.classList.add("firstchat-instant"),yt.style.transition="none",yt.style.transform="",We.removeAttribute("inert"),yt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(We.classList.contains("firstchat-instant")||(yt.style.transition=""),We.classList.add("is-open"),Mn(140),$c&&typeof $c.focus=="function")try{$c.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(Tr(yy))||"dialogue"}catch{}n&&(r="dialogue"),Yc(r),er(),o||(We.querySelector(".merchant-firstchat")?.classList.add("is-visible"),We.classList.add("firstchat-active"),Bw())})})}function Vc(){if(!Ms)return;if(Vr(!1),je){try{Eo(100)}catch{}try{Mn(80)}catch{}}Ms=!1,yt.style.transition="",yt.style.transform="",We.classList.remove("is-open"),We.classList.remove("firstchat-instant"),Fw();let e=document.activeElement;if(e&&We.contains(e)){let t=qc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}We.setAttribute("inert",""),qc=null,er(),Qo=!1}function Uw(e){if(Ms&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<yi.length;i++)_s.get(yi[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<yi.length&&(e.preventDefault(),Yc(yi[r].key))}}function Dw(e){if(!Ms)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;Cn={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},yt.style.transition="none",window.addEventListener("pointermove",Ly,{passive:!0}),window.addEventListener("pointerup",_y),window.addEventListener("pointercancel",Cy)}function Ly(e){if(!Cn||Cn.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-Cn.startY);Cn.lastY=t,Cn.moved=n,yt.style.transform=`translateY(${n}px)`}function _y(){if(!Cn||Cn.canceled){Wd();return}let e=Math.max(1,performance.now()-Cn.startT),t=Cn.moved;t/e>.55&&t>40||t>140?(Eo(160),yt.style.transition="transform 140ms ease-out",yt.style.transform="translateY(100%)",setTimeout(()=>{Vc()},150)):(yt.style.transition="transform 180ms ease",yt.style.transform="translateY(0)"),Wd()}function Cy(){Cn&&(Cn.canceled=!0,yt.style.transition="transform 180ms ease",yt.style.transform="translateY(0)",Wd())}function Wd(){window.removeEventListener("pointermove",Ly),window.removeEventListener("pointerup",_y),window.removeEventListener("pointercancel",Cy),Cn=null}function Yc(e){let t=yi.find(o=>o.key===e),n=_s.get(e);(!t||!n)&&(e="dialogue");for(let o in _n.buttons)_n.buttons[o].classList.toggle("is-active",o===e);for(let o in _n.panels)_n.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Jo()}catch{}if(e==="warp")try{jo()}catch{}if(e==="lab"){typeof Ss=="function"&&!Ss()&&$w();try{Od()}catch{}}try{localStorage.setItem(Tr(yy),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=We?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function ol(e=[]){e.forEach(t=>nl(t,!0))}function My(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Rr();let u=y=>{y.key==="Escape"&&(y.stopImmediatePropagation(),y.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let y=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),g=r.querySelector(".merchant-firstchat__row"),h=r.querySelector(".merchant-firstchat__card"),v={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},E=new Ar({textEl:y,choicesEl:m,skipTargets:[y,g,h],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),er(),Qo=!1,r.remove(),t&&t()},5e3)}});E.load(v),E.start()},p=new Ar({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",er(),Qo=!1,n&&n.hideCursor&&n.hideCursor(),f()}});p.load(o),p.start()}function $w(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Rr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Ar({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{er(),Qo=!1,e.remove()}});s.load(i),s.start()}function ky(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Cs}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Rr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Ar({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{er(),Qo=!1,t.remove(),e&&e()}});l.load(s),l.start()}var Cs,zd,yy,tl,Kd,Tr,by,yi,_s,lw,kr,Zo,cw,Hd,Xd,Zd,uw,fw,Sy,dw,uy,fy,dy,Iy,my,Yd,Xc,We,yt,$c,Ms,Cn,qc,hy,_n,Ey,Ls,Qo,Ar,gy,Wc=De(()=>{St();Et();dg();Vn();Lo();ls();Dd();pi();co();si();ts();lo();Dn();Cs="img/misc/merchant.webp",zd="ccc:merchantMet",yy="ccc:merchantTab",tl="ccc:merchant:dlgState",Kd="ccc:merchant:met",Tr=e=>`${e}:${b()}`;by="ccc:unlock:jeff";yi=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],_s=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),lw={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},kr="img/misc/mysterious.webp",Zo="Hidden Dialogue",cw="Locked Dialogue",Hd="Hidden Dialogue",Xd="Locked",Zd="Locked Dialogue",uw={locked:0,mysterious:1,unlocked:2},fw="ccc:reset:forge:completed",Sy=typeof window<"u"&&"PointerEvent"in window,dw=!Sy&&typeof window<"u"&&"ontouchstart"in window;uy=!1,fy=!1,dy=!1;Iy=e=>`ccc:unlock:lab:${e}`;my=null,Yd=null;Xc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:kr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:Xd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:kr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof Mo=="function"&&Mo()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:kr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof dn=="function"&&dn())return!0;let t=typeof zn=="function"?zn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof Mo=="function"&&Mo()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:kr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:kr,headerTitle:Zo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};_w();We=null,yt=null,$c=null,Ms=!1,Cn=null,qc=null,hy=!1,_n={buttons:{},panels:{},tablist:null},Ey="sounds/merchant_typing.ogg",Ls=null,Qo=!1;Ar=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await Mw(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=el(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};gy="ccc-scroll-timeline-styles"});var nn,Ty,Ay,Ny,ep=De(()=>{Yt();nn="dna",Ty="img/misc/mysterious.webp",Ay="Hidden Upgrade",Ny=[{area:nn,id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Coin value bonus: ${Fe(t)}x`},{area:nn,id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`XP value bonus: ${Fe(t)}x`},{area:nn,id:3,title:"DNA Gold Value",desc:"Multiplies Gold value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/gold_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"gold_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Gold value bonus: ${Fe(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Ty,titleOverride:Ay,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:nn,id:4,title:"DNA Magic Value",desc:"Multiplies Magic value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/magic_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"magic_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Magic value bonus: ${Fe(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Ty,titleOverride:Ay,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}]});function Uy(e){if(!e||!e.costType)return!1;let t=Vw[e.costType];return!t||kt(Ze,t)<=0?!1:ci(e.area,e.id)!=="0"}function np(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function Kc(e,t){return t==="standard"&&np(e)===Xw}function tp(e){let t=Pt(e),n={};for(let o of t){let r=xn(e,o.id),i=kt(e,o.id),s=ko(e,o.id),l=s.iconOverride??tu(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Ns(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:d}}return n}function Dy(e){return Py[e]||Py.standard}function Mn(e=140){if(!je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Zc(e){return String(e??"").replace(/<[^>]*>/g,"")}function zc(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function tn(){ht(Ww,{volume:je?$y:qy})}function Gy(){let e=je?$y*2:qy*2;ht(zw,{volume:e})}function Kw(e){return`<img alt="" src="${Oy[e]||Oy.coins}" class="currency-ico">`}function Zw(){if(document.getElementById(By))return;let e=document.createElement("style");e.id=By,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function ws(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){Zw();let D=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=D,s.style.scrollTimelineName=D,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=D,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let g={scrollSize:0,clientSize:0,barSize:0,thumbSize:0,maxScroll:1,range:0,visibleRatio:1},h=null,v=!1,E=()=>{if(!s.isConnected||!t.isConnected)return;let ie=s.getBoundingClientRect(),D=t.getBoundingClientRect();if(i){let Z=Math.max(0,ie.top-D.top),$=Math.max(0,D.bottom-ie.bottom);l.style.top=Z+"px",l.style.bottom=$+"px",l.style.left="",l.style.right=""}else{let Z=Math.max(0,ie.left-D.left),$=Math.max(0,D.right-ie.right);l.style.left=Z+"px",l.style.right=$+"px",l.style.top="",l.style.bottom="",l.style.height=""}},C=()=>{let ie=i?s.scrollHeight:s.scrollWidth,D=i?s.clientHeight:s.clientWidth,Z=i?l.clientHeight||D:l.clientWidth||D,$=D/Math.max(1,ie),G=Math.max(28,Math.round(Z*$)),j=Math.max(1,ie-D),W=Math.max(0,Z-G);g={scrollSize:ie,clientSize:D,barSize:Z,thumbSize:G,maxScroll:j,range:W,visibleRatio:$},i?(a.style.height=G+"px",a.style.width="100%"):(a.style.width=G+"px",a.style.height="100%"),m&&(i?(a.style.setProperty("--thumb-y",`${W}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${W}px`),a.style.setProperty("--thumb-y","0px")));let re=ie>D+1;l.style.display=re?"":"none",t?.classList.toggle("has-active-scrollbar",re),A()},A=()=>{v=!1;let ie=i?s.scrollTop:s.scrollLeft,D=(ie||0)>0;if(h!==D&&(h=D,t?.classList.toggle("has-scroll-shadow",D)),!m){let{maxScroll:Z,range:$}=g,G=Math.round(ie/Z*$);i?a.style.transform=`translateY(${G}px)`:a.style.transform=`translateX(${G}px)`}u&&q()},N=()=>{E(),C()},V,B=()=>{clearTimeout(V),V=setTimeout(N,100)};typeof MutationObserver<"u"&&new MutationObserver(()=>B()).observe(s,{childList:!0,subtree:!0,characterData:!0});let q=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},_=ie=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},ie))},U=()=>{v||(v=!0,window.requestAnimationFrame(A)),p||_(f)},M=()=>_(f);s.addEventListener("scroll",U,{passive:!0}),p&&s.addEventListener("scrollend",M,{passive:!0}),new ResizeObserver(()=>{N()}).observe(s),window.addEventListener("resize",N),requestAnimationFrame(N);let H=!1,J=0,ae=0,pe=ie=>{H=!0,J=i?ie.clientY:ie.clientX,ae=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),q();try{a.setPointerCapture(ie.pointerId)}catch{}ie.preventDefault()},ye=ie=>{if(!H)return;let{range:D,maxScroll:Z}=g;if(D<=0)return;let G=(i?ie.clientY:ie.clientX)-J,j=ae+G/D*Z;i?s.scrollTop=j:s.scrollLeft=j},Me=ie=>{if(H){H=!1,a.classList.remove("dragging"),_(d);try{a.releasePointerCapture(ie.pointerId)}catch{}}};a.addEventListener("pointerdown",pe),window.addEventListener("pointermove",ye,{passive:!0}),window.addEventListener("pointerup",Me),window.addEventListener("pointercancel",Me),l.addEventListener("pointerdown",ie=>{if(ie.target===a)return;let D=l.getBoundingClientRect(),Z=i?ie.clientY-D.top:ie.clientX-D.left,{thumbSize:$,range:G,maxScroll:j}=g,re=Math.max(0,Math.min(Z-$/2,G))/Math.max(1,G)*j;i?s.scrollTop=re:s.scrollLeft=re,q(),_(f)}),N()}function Fy(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function Jw(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=O[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return d&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):Fy(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),y=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(y));if(d.cmp(p)===0&&d.cmp(m)===0){let h=Fy(e,o,r),v=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(h.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,E=0,C=Math.max(0,v);for(;E<C;){let A=Math.floor((E+C+1)/2),N=c.fromInt(A);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(N):c.fromAny(d??0).mulBigNumInteger(N)).cmp(a)<=0?E=A:C=A-1}return c.fromInt(E)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=vi(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function cs(e="standard"){(Jc[e]||Jc.standard).open()}function Hy(e=!1){Object.values(Jc).forEach(t=>t.close(e))}function Or(e=!1){Object.values(Jc).forEach(t=>t.update(e))}function Qw(){if(on)return;on=document.createElement("div"),on.className="upg-overlay",lt=document.createElement("div"),lt.className="upg-sheet",lt.setAttribute("role","dialog"),lt.setAttribute("aria-modal","false"),lt.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",lt.append(e,t,n,o,r),on.appendChild(lt),document.body.appendChild(on),on.addEventListener("pointerdown",u=>{je&&u.pointerType!=="mouse"&&u.target===on&&(u.preventDefault(),u.stopPropagation())},!0),on.addEventListener("click",u=>{je&&u.target===on&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Qc)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},lt.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,lt.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(lt.style.transition="transform 160ms ease",lt.style.transform=f?"translateY(100%)":"translateY(0)",f){if(je&&(!u||u.pointerType!=="mouse"))try{Mn(120)}catch{}setTimeout(Xy,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function Xy(){if(je)try{Mn(160)}catch{}if(typeof jc=="function"){let e=jc;jc=null;try{e()}catch{}}Qc=!1,!(!on||!lt)&&(lt.style.transition="",lt.style.transform="",on.classList.remove("is-open"),on.style.pointerEvents="none")}function eE(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function tE(e,t="standard"){Qw(),Qc=!0;let n=!0,o=Dy(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Qc=!1;return}let l=e.upgType==="HM",a=e.tie===xe.ENDLESS_XP;function u(m,g,h="div"){let v=g.split(" ").filter(A=>A.length>0),E=null,C=[];for(let A=0;A<m.children.length;A++){let N=m.children[A];h&&N.tagName.toLowerCase()!==h.toLowerCase()||v.every(V=>N.classList.contains(V))&&(E?C.push(N):E=N)}return C.forEach(A=>A.remove()),E||(E=document.createElement(h),E.className=g,m.appendChild(E)),E}let f=m=>{let g=document.createElement("div");return g.className="upg-line",g.innerHTML=m,g},d=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let g=m.lockState||o.getLockState(e.id),h=!!g?.locked,v=h&&(g?.hidden||g?.hideEffect||g?.hideCost),E=!!m.unlockUpgrade&&!v;lt.classList.toggle("is-locked-hidden",v);let C=lt.querySelector(".upg-header"),A=u(C,"upg-title");A.textContent!==(m.displayTitle||m.upg.title)&&(A.textContent=m.displayTitle||m.upg.title);let N=!!m.hmReadyToEvolve,V=N?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,B=u(C,"upg-level"),q=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??ne(m.lvlCapBn),_=m.lvlCapFmtText??m.upg.lvlCapFmtText??Zc(q),U=N?`Level ${m.lvlFmtHtml} / ${q} (EVOLVE READY)`:V?`Level ${m.lvlFmtHtml} / ${q} (MAXED)`:`Level ${m.lvlFmtHtml} / ${q}`,M=Zc(U);B.innerHTML!==U&&(B.innerHTML=U),B.getAttribute("aria-label")!==M&&B.setAttribute("aria-label",M),B.hidden=v,v||B.removeAttribute("aria-hidden"),lt.classList.toggle("is-maxed",V),lt.classList.toggle("hm-evolve-ready",N),lt.classList.toggle("is-unlock-upgrade",E),lt.classList.toggle("is-hm-upgrade",l&&!v),lt.classList.toggle("is-endless-xp",a),lt.classList.toggle("is-magnet-upgrade",e.tie===xe.MAGNET),lt.classList.toggle("is-no-effect",!m.effect);let L=C.querySelector(".auto-toggle-wrapper"),H=t==="automation"?rs[e.id]:null,J=t==="automation"&&e.id===io,ae=!!H,pe=t==="standard"?Yw[e.costType]:null,ye=0;pe?ye=kt(Ze,pe):(ae||J)&&(ye=kt(Ze,e.id));let ie=ye>0&&(ae||pe||J)&&!v;L||(L=document.createElement("div"),L.className="auto-toggle-wrapper hm-view-milestones-row",C.appendChild(L));let D=L.querySelector("button");if(D||(D=document.createElement("button"),D.type="button",D.style.padding="10px 14px",D.style.fontSize="16px",D.style.width="auto",D.style.minWidth="180px",D.addEventListener("click",oe=>{typeof D._onClick=="function"&&D._onClick(oe)}),L.appendChild(D)),ie){D.style.visibility="",D.style.pointerEvents="auto";let oe=b(),be=oe!=null?`:${oe}`:"",Be=!0;if(ae){let Pe=`ccc:autobuy:master:${H}${be}`,Oe=Pt(ve.STARTER_COVE),le=!1;for(let ee of Oe)if(ee.costType===H){let we=`ccc:autobuy:${ee.area}:${ee.id}${be}`;if(ci(ee.area,ee.id)!=="0"){le=!0;break}}Be=le}else Be=ci(e.area,e.id)!=="0";Be?(D.className="shop-delve",D.textContent="Automation: ON",D.style.backgroundColor=""):(D.className="shop-close",D.textContent="Automation: OFF",D.style.backgroundColor=""),D._onClick=Pe=>{Pe.preventDefault(),Pe.stopPropagation(),je&&Mn(50);let le=!Be?"1":"0";ae?(localStorage.setItem(`ccc:autobuy:master:${H}${be}`,le),Pt(ve.STARTER_COVE).forEach(we=>{we.costType===H&&Sr(we.area,we.id,le)})):Sr(e.area,e.id,le),p()}}else D.style.visibility="hidden",D.style.pointerEvents="none",D.className="shop-delve",D.textContent="Automation: ON",D._onClick=null;let Z=lt.querySelector(".upg-content");d&&(Z.scrollTop=0,d=!1);let $=u(Z,"upg-desc centered");$.classList.toggle("lock-desc",v);let G=(m.displayDesc||m.upg.desc||"").trim();N?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):G?($.classList.remove("hm-evolve-note"),$.textContent!==G&&($.textContent=G),$.hidden=!1):$.hidden=!0;let j=u(Z,"upg-info"),W=null,re=oe=>{W?W.nextElementSibling!==oe&&j.insertBefore(oe,W.nextSibling):j.firstElementChild!==oe&&j.prepend(oe),W=oe};if(h&&g?.reason&&!v){let oe=(m.displayDesc||"").trim(),be=String(g.reason??"").trim();if(oe!==be){let Be=j.querySelector(".lock-wrapper");if(!Be){Be=document.createElement("div"),Be.className="lock-wrapper";let le=document.createElement("div");le.className="upg-line lock-note",Be.append(le)}let Pe=Array.from(Be.children);for(let le of Pe)le.tagName==="DIV"&&!le.className&&le.style.height==="12px"&&le.remove();let Oe=Be.querySelector(".lock-note");Oe.textContent!==g.reason&&(Oe.textContent=g.reason),re(Be)}else{let Be=j.querySelector(".lock-wrapper");Be&&Be.remove()}}else{let oe=j.querySelector(".lock-wrapper");oe&&oe.remove()}if(m.effect&&!(h&&g?.hideEffect)){let oe=j.querySelector(".effect-wrapper");if(!oe){oe=document.createElement("div"),oe.className="effect-wrapper";let Oe=document.createElement("div");Oe.className="upg-line",oe.append(Oe)}let be=Array.from(oe.children);for(let Oe of be)Oe.tagName==="DIV"&&!Oe.className&&Oe.style.height==="12px"&&Oe.remove();let Be=oe.querySelector(".upg-line"),Pe=`<span class="bonus-line">${m.effect}</span>`;Be.innerHTML!==Pe&&(Be.innerHTML=Pe),re(oe)}else{let oe=j.querySelector(".effect-wrapper");oe&&oe.remove()}let x=Kw(m.upg.costType),z=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ue=V||N;if(!m.unlockUpgrade&&!ue&&(!h||!g?.hideCost)){let oe=u(j,"upg-costs");re(oe);let be=zc(m.upg.costType,z),Be=`Cost: ${x} ${O[m.upg.costType].fmt(z)} ${be}`,Pe=u(oe,"cost-line","div");if(Pe.className.includes("upg-line")||(Pe.className="upg-line cost-line"),Pe.innerHTML!==Be&&(Pe.innerHTML=Be),l){let we=u(oe,"milestone-line","div");we.className.includes("upg-line")||(we.className="upg-line milestone-line");let w="\u2014",Y="",K=Uy(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(K){let ce=m.hmNextMilestone.sub(c.fromInt(1)),Ye=0;try{let Se=ce.toPlainIntegerString?.();Se&&Se!=="Infinity"?Ye=Number(Se):Ye=Number(ce.toString())}catch{Ye=0}let tt=c.fromInt(0);try{tt=c.fromAny(m.upg.costAtLevel(Ye))}catch{}w=O[m.upg.costType].fmt(tt),Y=zc(m.upg.costType,tt)}else{let ce=m.hmNextMilestone.sub(m.lvlBn),Ye=ce.toPlainIntegerString?.(),tt=Math.max(0,Math.floor(Number(Ye&&Ye!=="Infinity"?Ye:Number(ce.toString()||0)))),{spent:Se}=vi(m.upg,m.lvlBn,c.fromAny("Infinity"),tt);w=O[m.upg.costType].fmt(Se),Y=zc(m.upg.costType,Se)}}catch{}let he=`${K?"Cost at next milestone:":"Cost to next milestone:"} ${x} ${w} ${Y}`;we.innerHTML!==he&&(we.innerHTML=he)}else{let we=oe.querySelector(".milestone-line");we&&we.remove()}let Oe=zc(m.upg.costType,m.have),le=`You have: ${x} ${O[m.upg.costType].fmt(m.have)} ${Oe}`,ee=u(oe,"have-line","div");ee.className.includes("upg-line")||(ee.className="upg-line have-line"),ee.innerHTML!==le&&(ee.innerHTML=le)}else{let oe=j.querySelector(".upg-costs");oe&&oe.remove()}let me=lt.querySelector(".upg-milestones"),Q=me.querySelector(".hm-view-milestones-row");if(!Q){Q=document.createElement("div"),Q.className="hm-view-milestones-row";let oe=document.createElement("button");oe.type="button",oe.className="shop-delve hm-view-milestones",oe.textContent="View Milestones",oe.addEventListener("click",be=>{oe._onClick&&oe._onClick(be)}),Q.appendChild(oe),me.appendChild(Q)}let se=Q.querySelector("button");l&&!v?(se.style.visibility="",se.style.pointerEvents="auto",se._onClick=()=>{let oe=Array.isArray(m.hmMilestones)?m.hmMilestones:[],be=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Be=(()=>{try{return BigInt(qt)*BigInt(be)}catch{return 0n}})(),Pe=oe.sort((Oe,le)=>Number(Oe?.level||0)-Number(le?.level||0)).map(Oe=>{let le=Math.max(0,Math.floor(Number(Oe?.level||0))),ee=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(le)+Be).toString())}catch{return c.fromAny(le+qt*be)}})(),we=ee?.isInfinite?.()?"Infinity":ne(ee),w=Fe(Oe?.multiplier??Oe?.mult??Oe?.value??1),Y=`${Oe?.target??Oe?.type??"self"}`.toLowerCase(),K=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(ee)>=0}catch{}return!1})(),te=`Level ${we}: Multiplies this upgrade\u2019s effect by ${w}x`;return Y==="xp"&&(te=`Level ${we}: Multiplies XP value by ${w}x`),(Y==="coin"||Y==="coins")&&(te=`Level ${we}: Multiplies Coin value by ${w}x`),Y==="mp"&&(te=`Level ${we}: Multiplies MP value by ${w}x`),{text:te,achieved:K}});eE(Pe)}):(se.style.visibility="hidden",se.style.pointerEvents="none",se._onClick=null);let ge=lt.querySelector(".upg-actions"),Re=ge.querySelector(".shop-close");if(Re||(Re=document.createElement("button"),Re.type="button",Re.className="shop-close",Re.textContent="Close",Re.addEventListener("click",()=>{n=!1,Xy()}),ge.appendChild(Re)),h||V)ge.querySelectorAll("button:not(.shop-close)").forEach(oe=>oe.remove()),document.activeElement&&document.activeElement!==Re&&!ge.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Re.focus();else{let oe=m.have.cmp(z)>=0,be=(le,ee,we,w,Y=!1)=>{let K=ge.querySelector(`.${le.split(" ").join(".")}`);if(!K){K=document.createElement("button"),K.type="button",K.className=le,K.textContent=ee;let te=()=>{typeof K._onClick=="function"&&K._onClick()};"PointerEvent"in window?K.addEventListener("pointerdown",ce=>{ce.pointerType==="mouse"||typeof ce.button=="number"&&ce.button!==0||(te(),ce.preventDefault())},{passive:!1}):K.addEventListener("touchstart",ce=>{te(),ce.preventDefault()},{passive:!1}),K.addEventListener("click",()=>{je||te()});let he=ge.children;w>=he.length?ge.appendChild(K):ge.insertBefore(K,he[w])}return K._onClick=we,K.textContent!==ee&&(K.textContent=ee),K.disabled!==Y&&(K.disabled=Y),K};if(N){ge.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(le=>le.remove()),be("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:le}=o.evolve(e.id);le&&(Gy(),Or(),p())},1,!1);return}if(m.unlockUpgrade){ge.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(le=>le.remove()),be("shop-delve btn-unlock","Unlock",()=>{let{bought:le}=o.buyOne(e.id);if(!(le instanceof c?le:c.fromAny(le??0)).isZero?.()){if(tn(),Kc(e,t))try{ol(["reset"])}catch{}Or(),p()}},1,!oe);return}if(ge.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(le=>le.remove()),be("shop-delve btn-buy-one","Buy",()=>{let le=o.getUiModel(e.id);if(le.have.cmp(le.nextPrice instanceof c?le.nextPrice:c.fromAny(le.nextPrice||0))<0)return;let{bought:ee}=o.buyOne(e.id);(ee instanceof c?ee:c.fromAny(ee??0)).isZero?.()||(tn(),Or(),p())},1,!oe),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let le=ge.querySelector(".btn-buy-max");le&&le.remove();let ee=ge.querySelector(".btn-buy-cheap");ee&&ee.remove()}else{be("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:w}=o.buyMax(e.id);(w instanceof c?w:c.fromAny(w??0)).isZero?.()||(tn(),Or(),p())},2,!oe);let ee=[1,3,4,5,6].includes(np(m.upg));if(!l&&!ee)be("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let Y=o.buyCheap;if(!Y)return;let{bought:K}=Y(e.id);(K instanceof c?K:c.fromAny(K??0)).isZero?.()||(tn(),Or(),p())},3,!oe);else{let we=ge.querySelector(".btn-buy-cheap");we&&we.remove()}}if(l)be("shop-delve btn-buy-next","Buy Next",()=>{let ee=o.getUiModel(e.id);if(ee.hmReadyToEvolve)return;let we=ee.hmNextMilestone;if(!we||!ee.lvlBn||we.cmp(ee.lvlBn)<=0){let{bought:Se}=o.buyMax(e.id);if((Se instanceof c?Se:c.fromAny(Se??0)).isZero?.())return;tn(),Or(),p();return}let w=0;try{let Se=we.sub(ee.lvlBn).toPlainIntegerString?.();w=Math.max(0,Math.floor(Number(Se&&Se!=="Infinity"?Se:we.sub(ee.lvlBn).toString())))}catch{}let Y=O[ee.upg.costType]?.value,K=Y instanceof c?Y:c.fromAny(Y??0),he=vi(ee.upg,ee.lvlBn,K,w).count,ce=!1;try{let Se=he?.toPlainIntegerString?.();ce=Se&&Se!=="Infinity"?Number(Se)>=w:Number(he??0)>=w}catch{}let Ye=ce?o.buyNext(e.id,w):o.buyMax(e.id);(Ye.bought instanceof c?Ye.bought:c.fromAny(Ye.bought??0)).isZero?.()||(tn(),Or(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let le=ge.querySelector(".btn-buy-next");le&&le.remove()}}},y=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,y)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",y),p(),on.classList.add("is-open"),on.classList.toggle("is-automation-upgrade",t==="automation"),on.style.pointerEvents="auto",Mn(140),lt.style.transition="none",lt.style.transform="translateY(100%)",lt.offsetHeight,requestAnimationFrame(()=>{lt.style.transition="",lt.style.transform=""}),jc=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,y)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",y)}}function Pd(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let p=Math.max(0,d-r.startY);r.lastY=d,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(Eo(100),Mn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var Ry,qw,Gw,Hw,Oy,Xw,Vw,Yw,Py,Ww,zw,$y,qy,jw,By,rl,Jc,on,lt,Qc,jc,si=De(()=>{St();Et();Yt();lo();Wc();oc();Dn();ao();ts();ni();ds();ep();Ry={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},qw="img/misc/locked_base.webp",Gw="img/misc/maxed.webp",Hw="img/misc/green_border.webp",Oy={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},Xw=7,Vw={coins:Aa,books:Na,gold:Ra,magic:Oa};Yw={coins:Aa,books:Na,gold:Ra,magic:Oa};Py={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>tp(Kn()),getUiModel:e=>Ns(Kn(),e),buyOne:e=>Ts(Kn(),e),buyMax:e=>il(Kn(),e),buyCheap:e=>sl(Kn(),e),buyNext:(e,t)=>As(Kn(),e,t),getLockState:e=>ko(Kn(),e),evolve:e=>eu(Kn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",Kd,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>tp(Ze),getUiModel:e=>Ns(Ze,e),buyOne:e=>Ts(Ze,e),buyMax:e=>il(Ze,e),buyCheap:e=>sl(Ze,e),buyNext:(e,t)=>As(Ze,e,t),getLockState:e=>ko(Ze,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>tp(nn),getUiModel:e=>Ns(nn,e),buyOne:e=>Ts(nn,e),buyMax:e=>il(nn,e),buyCheap:e=>sl(nn,e),buyNext:(e,t)=>As(nn,e,t),getLockState:e=>ko(nn,e),evolve:e=>eu(nn,e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||Or(!0)});Ww="sounds/purchase_upg.ogg",zw="sounds/evolve_upg.ogg",$y=.12,qy=.3;jw="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",By="ccc-scroll-timeline-styles";rl=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return Dy(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!vy(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let z=document.createElement("div");z.className="shop-tile";let ue=document.createElement("img");ue.className="base",ue.alt="";let me=document.createElement("img");me.className="icon",me.alt="",me.addEventListener("error",()=>{me.src=jw}),z.appendChild(ue),z.appendChild(me),i.appendChild(z),t.appendChild(i),i.addEventListener("click",Q=>{let se=Q.currentTarget;if(se.disabled||se.dataset.lockedPlain==="1"){Q.preventDefault(),Q.stopImmediatePropagation();return}if(ro(se)){Q.preventDefault(),Q.stopImmediatePropagation();return}if(Q.shiftKey||Q.ctrlKey){if(Q.preventDefault(),Q.stopImmediatePropagation(),!se.upgMeta)return;let ge=se.upgMeta.id,Re=se.upgMeta.upgType==="HM",oe=[1,3,4,5,6].includes(np(se.upgMeta));if(Q.shiftKey){if((Re||!oe)&&this.adapter.buyCheap){let{bought:Pe}=this.adapter.buyCheap(ge);(Pe instanceof c?Pe:c.fromAny(Pe??0)).isZero?.()||(tn(),this.update());return}let{bought:be}=this.adapter.buyMax(ge);if(!(be instanceof c?be:c.fromAny(be??0)).isZero?.()){if(tn(),Kc(se.upgMeta,this.mode))try{ol(["reset"])}catch{}this.update()}return}if(Q.ctrlKey){if(Re){let Pe=this.adapter.getUiModel(ge);if(Pe&&!Pe.hmReadyToEvolve){let Oe=Pe.hmNextMilestone;if(Oe&&Pe.lvlBn&&Oe.cmp(Pe.lvlBn)>0){let le=0;try{let te=Oe.sub(Pe.lvlBn).toPlainIntegerString?.();le=Math.max(0,Math.floor(Number(te&&te!=="Infinity"?te:Oe.sub(Pe.lvlBn).toString())))}catch{}let ee=O[Pe.upg.costType]?.value,we=ee instanceof c?ee:c.fromAny(ee??0),Y=vi(Pe.upg,Pe.lvlBn,we,le).count,K=!1;try{let te=Y?.toPlainIntegerString?.();K=te&&te!=="Infinity"?Number(te)>=le:Number(Y??0)>=le}catch{}if(K){let te=this.adapter.buyNext(ge,le);(te.bought instanceof c?te.bought:c.fromAny(te.bought??0)).isZero?.()||(tn(),this.update());return}}}}let{bought:be}=this.adapter.buyMax(ge);if(!(be instanceof c?be:c.fromAny(be??0)).isZero?.()){if(tn(),Kc(se.upgMeta,this.mode))try{ol(["reset"])}catch{}this.update()}return}}se.upgMeta&&tE(se.upgMeta,this.mode)}),i.addEventListener("contextmenu",Q=>{if(je)return;let se=Q.currentTarget;if(se.dataset.locked==="1"||(Q.preventDefault(),Q.stopPropagation(),!se.upgMeta))return;if(this.adapter.getUiModel(se.upgMeta.id)?.hmReadyToEvolve){let{evolved:be}=this.adapter.evolve(se.upgMeta.id);be&&(Gy(),this.update());return}let{bought:Re}=this.adapter.buyMax(se.upgMeta.id);if(!(Re instanceof c?Re:c.fromAny(Re??0)).isZero?.()){if(tn(),Kc(se.upgMeta,this.mode))try{ol(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let y=s?c.fromInt(0):Jw(r.meta,r.levelNumeric,r.level),m=y instanceof c?y:c.fromAny(y),g=ne(r.level),h=Zc(g),v=ne(m),E=Zc(v),C=!m.isZero?.(),A=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,N=Number.isFinite(A)?Math.max(0,Math.floor(A)):1/0,V=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,B=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(N)&&Number.isFinite(V)?V>=N:!1,q=Number.isFinite(N)&&N===1,_=!!r.meta?.unlockUpgrade,U=!s&&_&&!B,M=!s&&_&&!U&&B,L,H,J=!1,ae=!1;if(s){L="",H="";let z=u?(r.lockState?.reason||"").trim():"",ue=z?`${r.title} (Locked, ${z})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ue)}else{if(U||M)L=U?"Unlockable":"Unlocked",H=L,ae=!0;else if(!s&&q&&!_)B?(L="Owned",H="Owned"):C?(L="Purchasable",H="Purchasable"):(L="Not Owned",H="Not Owned"),ae=!0;else{let z=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ue=String(h||"").replace(/,/g,""),me=/|Infinity/i.test(ue),Q=Number.isFinite(z)?z>=1e3:me||/^\d{4,}$/.test(ue);J=C&&Q,J?(L=`<span class="badge-lvl">${g}</span><span class="badge-plus">(+${v})</span>`,H=`${h} (+${E})`):(L=C?`${g} (+${v})`:g,H=C?`${h} (+${E})`:h)}i.setAttribute("aria-label",`${r.title}, ${H}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let pe=i.firstElementChild,ye=pe.querySelector(".base"),Me=pe.querySelector(".icon"),ie=r.meta?.costType||"coins",Z=r.useLockedBase||s?qw:r.baseIconOverride||Ry[ie]||Ry.coins;ye.src!==Z&&(ye.src=Z);let $=r.icon;if(!$)Me.hidden||(Me.hidden=!0);else{Me.hidden&&(Me.hidden=!1);let z=$;Me._lastSrc!==z&&(Me.src=z,Me._lastSrc=z)}let G=pe.querySelector(".maxed-overlay"),j=!s&&Uy(r.meta),W=!s&&B;if(W||!s&&!B&&!p&&j){G||(G=document.createElement("img"),G.className="maxed-overlay",G.alt="",pe.insertBefore(G,Me));let z=W?Gw:Hw;G.src!==z&&(G.src=z)}else G&&G.remove();let x=pe.querySelector(".level-badge");s?x&&x.remove():(x||(x=document.createElement("span"),x.className="level-badge",pe.appendChild(x)),x.className="level-badge",ae&&x.classList.add("text-badge"),J&&x.classList.add("two-line"),(C||U)&&x.classList.add("can-buy"),B&&x.classList.add("is-maxed"),L===H?x.textContent!==L&&(x.textContent=L):x.innerHTML!==L&&(x.innerHTML=L))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),ws(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&ro(a)||(Rr(),xy())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{je&&Mn(80),this.close()},{passive:!0}),Pd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&ky(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,je)try{setTimeout(()=>Eo(240),120)}catch{}Mn(10),ws(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},Jc={standard:new rl("standard"),automation:new rl("automation"),dna:new rl("dna")};on=null,lt=null,Qc=!1,jc=null});var Wy={};vt(Wy,{applyHudLayout:()=>tr,initHudButtons:()=>oE,isMapUnlocked:()=>sp,isShopUnlocked:()=>ip,lockMap:()=>iu,lockShop:()=>ru,unlockMap:()=>ou,unlockShop:()=>bi});function rp(e){let t=b();return t==null?e:`${e}:${t}`}function Rs(e){let t=rp(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function ip(){return ap(),Rs(mo.SHOP)}function sp(){return ap(),Rs(mo.MAP)}function nu(e,t){let n=t?"1":"0",o=rp(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function ap(){for(let e of Object.values(mo)){let t=rp(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function To(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function op(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",Vi())}function nE(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function tr(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=nE(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(y=>e.querySelector(`.game-btn[data-btn="${y}"]`)).filter(Boolean),a=[...e.children].filter(y=>!l.includes(y)),u=[...l,...a];if(u.length&&u.some((y,m)=>e.children[m]!==y)){let y=document.createDocumentFragment();u.forEach(m=>y.appendChild(m)),e.appendChild(y)}let p=[...e.querySelectorAll(".game-btn")].filter(y=>!y.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(y=>{y.style.gridColumn="",y.style.gridRow="",y.classList.remove("span-2"),y.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let y=getComputedStyle(e),m=parseFloat(y.columnGap||y.gap||"0")||0,g=e.clientWidth,h=Math.max(180,Math.floor((g-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${h}px ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let y=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),g=e.querySelector('[data-btn="shop"]:not([hidden])');y&&m&&g&&(y.style.gridColumn="1",y.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",g.style.gridColumn="1 / -1",g.style.gridRow="2")}}function oE(){if(ap(),To("help",!0),To("stats",!0),To("shop",Rs(mo.SHOP)),To("map",Rs(mo.MAP)),op(),tr(),Vy||(Vy=!0,window.addEventListener("resize",tr),window.addEventListener("orientationchange",tr),window.addEventListener("saveSlot:change",()=>{To("shop",Rs(mo.SHOP)),To("map",Rs(mo.MAP)),op(),tr()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||op()})),!Yy){Yy=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&cs()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&ro(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function bi(){nu(mo.SHOP,!0),To("shop",!0),tr()}function ou(){nu(mo.MAP,!0),To("map",!0),tr()}function ru(){nu(mo.SHOP,!1),To("shop",!1),tr()}function iu(){nu(mo.MAP,!1),To("map",!1),tr()}var mo,Vy,Yy,su=De(()=>{si();St();ts();mo={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Vy=!1,Yy=!1});function zy(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(z=>z.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let x=0;x<t;x++)d[x*f+2]=1/0;let p=new Int16Array(t),y=t;for(let x=0;x<t;x++)p[x]=t-1-x;let m=-1,g=document.createElement("canvas");g.className="cursor-trail-canvas",Object.assign(g.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(g);let h=g.getContext("2d",{alpha:!0,desynchronized:!0}),v=document.createElement("canvas");v.width=a,v.height=a;let E=v.getContext("2d");E.shadowColor="#FFEB3B",E.shadowBlur=l,E.fillStyle="#FFEB3B",E.beginPath(),E.arc(u,u,s,0,Math.PI*2),E.fill();let C=!1,A=null,N=null,V={left:0,top:0,width:0,height:0},B=1,q=!1,_=0,U=0,M=!1,L=null,H=[],J=()=>{if(q)return;let x=document.documentElement.clientWidth,z=document.documentElement.clientHeight;V={left:0,top:0,width:x,height:z,right:x,bottom:z,x:0,y:0}},ae=()=>{if(q)return;J();let x=Math.min(window.devicePixelRatio||1,2);B=V.width>0?Math.min(x,512/V.width):x,g.width=V.width*B,g.height=V.height*B,h.scale(B,B),L=null},pe=null;typeof ResizeObserver<"u"&&(pe=new ResizeObserver(()=>{ae()}),pe.observe(e));let ye=(x,z)=>{if(y<=0)return;let ue=p[--y];ue>m&&(m=ue);let me=ue*f;d[me]=x,d[me+1]=z,d[me+2]=0,d[me+3]=n},Me=(x,z,ue)=>{if(A===null||N===null)ue.count<r&&(ye(x,z),ue.count++);else{let me=x-A,Q=z-N,se=Math.hypot(me,Q);if(se>=o){let ge=Math.floor(se/o);for(let Re=1;Re<=ge&&!(ue.count>=r);Re++){let oe=Re*o/se;ye(A+me*oe,N+Q*oe),ue.count++}}ue.count<r&&(ye(x,z),ue.count++)}A=x,N=z},ie=x=>{if(q)return;_||(U=0,_=requestAnimationFrame(Z)),V.width||J();let z=0,ue=0,me=(Q,se)=>Q>=0&&Q<=V.width&&se>=0&&se<=V.height;if(x.getCoalescedEvents){let Q=x.getCoalescedEvents();if(Q.length>0)for(let se of Q){let ge=se.clientX-z,Re=se.clientY-ue;H.push({x:ge,y:Re,inside:me(ge,Re)})}else{let se=x.clientX-z,ge=x.clientY-ue;H.push({x:se,y:ge,inside:me(se,ge)})}}else{let Q=x.clientX-z,se=x.clientY-ue;H.push({x:Q,y:se,inside:me(Q,se)})}},D=()=>{C=!1,A=null,N=null,H.length=0},Z=()=>{if(q)return;let x=performance.now();U||(U=x);let z=x-U;U=x,z>100&&(z=100);let ue={count:0};if(H.length>0){for(let Be of H)Be.inside?(C=!0,Me(Be.x,Be.y,ue)):(C=!1,A=null,N=null);let be=H[H.length-1];be.inside&&(A!==be.x||N!==be.y)&&(ye(be.x,be.y),A=be.x,N=be.y),H.length=0}else C&&A!==null&&N!==null&&ye(A,N);let me=t-y;if(me===0&&!M){_=0;return}L?h.clearRect(L.x,L.y,L.w,L.h):h.clearRect(0,0,V.width,V.height),M=!1;let Q=1/0,se=1/0,ge=-1/0,Re=-1/0,oe=-1;if(me>0)for(let be=0;be<=m;be++){let Be=be*f,Pe=d[Be+2];if(Pe>=d[Be+3])continue;if(Pe+=z,d[Be+2]=Pe,Pe>=d[Be+3]){p[y++]=be;continue}oe=be;let Oe=d[Be+3],le=Pe/Oe,ee=1-le,we=1-.4*le;M=!0,h.globalAlpha=ee;let w=a*we,Y=w/2,K=d[Be],te=d[Be+1],he=Math.round(K-Y),ce=Math.round(te-Y),Ye=Math.round(w);h.drawImage(v,he,ce,Ye,Ye),he<Q&&(Q=he),ce<se&&(se=ce);let tt=he+Ye,Se=ce+Ye;tt>ge&&(ge=tt),Se>Re&&(Re=Se)}m=oe,Q!==1/0?(Q-=2,se-=2,ge+=2,Re+=2,L={x:Q,y:se,w:ge-Q,h:Re-se}):L=null,_=requestAnimationFrame(Z)};window.addEventListener("resize",ae),window.addEventListener("scroll",J,{passive:!0}),window.addEventListener("focus",J,{passive:!0}),document.addEventListener("visibilitychange",J,{passive:!0});let $={passive:!0},G=x=>{J(),ie(x)},j=x=>{J(),ie(x)};e.addEventListener("pointermove",ie,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",G,$),e.addEventListener("pointerleave",D,$),e.addEventListener("pointercancel",D,$),ae(),_=requestAnimationFrame(Z);let W=setInterval(J,1e3);return{destroy:()=>{q=!0,_&&cancelAnimationFrame(_),W&&clearInterval(W),pe&&(pe.disconnect(),pe=null);try{window.removeEventListener("resize",ae)}catch{}try{window.removeEventListener("scroll",J)}catch{}try{window.removeEventListener("focus",J)}catch{}try{document.removeEventListener("visibilitychange",J)}catch{}try{e.removeEventListener("pointermove",ie),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",G),e.removeEventListener("pointerleave",D),e.removeEventListener("pointercancel",D)}catch{}g.remove()}}}var Ky=De(()=>{});var sv={};vt(sv,{clearPendingGains:()=>yp,getPassiveCoinReward:()=>Fc,initCoinPickup:()=>dE,setCoinMultiplier:()=>aE,triggerPassiveCollect:()=>wd});function jy(e){if(!e||typeof e!="object"){ll=!1,au=!1,lu="0",wi.clear();return}ll=!!e.unlocked,au=!!e.level?.isInfinite?.();try{lu=e.level?.toPlainIntegerString?.()??"0"}catch{lu="0"}ll?au&&wi.clear():wi.clear()}function rE(){if(typeof Si=="function")try{Si()}catch{}try{jy(mt())}catch{ll=!1,wi.clear()}try{Si=Ei(e=>{jy(e)})}catch{Si=null}}function aE(e){sE=e;try{O.coins?.mult?.set&&O.coins.mult.set(e)}catch{}}function fp(){try{let e=xc();e instanceof c?Ps=e.clone?.()??e:e!=null?Ps=c.fromAny(e):Ps=c.fromInt(1)}catch{Ps=c.fromInt(1)}}function lE(){Zy||(Zy=!0,fp(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",fp),typeof window<"u"&&window.addEventListener("saveSlot:change",fp))}function cE(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return hp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function mp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*uE:0}function fE({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,p=0,y=null,m=null,g=mp(),h=0,v=0,E=0,C=!1,A=null,N=null,V=()=>{if(C)return;let $=document.documentElement.clientWidth,G=document.documentElement.clientHeight;A={left:0,top:0,width:$,height:G,right:$,bottom:G,x:0,y:0}},B=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",y=null,m=null},q=()=>{if(!l||v<=0){B();return}let $=v*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${d-v}px, ${p-v}px, 0)`,s.classList.add("is-visible")},_=()=>{if(!(!l||v<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=v+dp,G=[];if(typeof i.findCoinTargetsInPath=="function"&&y!==null&&m!==null?G=i.findCoinTargetsInPath(y,m,d,p,$):G=i.findCoinTargetsInRadius(d,p,$),y=d,m=p,G&&G.length>0)if(typeof r=="function"){let j=[];for(let W=0;W<G.length;W++){let re=G[W],x={coin:re};re.el&&i.getCoinTransform&&(x.opts={transform:i.getCoinTransform(re.el)}),j.push(x)}r(j)}else for(let j=0;j<G.length;j++){let W=G[j],re=i.ensureCoinVisual?i.ensureCoinVisual(W):W.el;if(re){let x=i.getCoinTransform?i.getCoinTransform(re):re.style.transform||"";o(re,{transform:x})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=v+dp,G=i.findCoinsInRadius(d,p,$);if(y=d,m=p,G&&G.length>0){let j=[];for(let W=0;W<G.length;W++){let re=G[W],x=i.getCoinTransform?i.getCoinTransform(re):re.style.transform;j.push({el:re,opts:{transform:x}})}typeof r=="function"&&r(j)}}else{let $=t.children,G=v+dp,j=[];for(let W=$.length-1;W>=0;W--){let re=$[W];if(re.dataset.collected==="1"||!re.matches(n))continue;let x=re.getBoundingClientRect(),z=x.left+x.width/2,ue=x.top+x.height/2,me=z-u,Q=ue-f;Math.hypot(me,Q)<=G&&j.push(re)}if(!j.length)return;if(typeof r=="function"){let W=[];for(let re=0;re<j.length;re++){let x=j[re],z=window.getComputedStyle(x);W.push({el:x,opts:{transform:z.transform}})}r(W)}else{let W=[];for(let re=0;re<j.length;re++){let x=j[re],z=window.getComputedStyle(x);W.push(z.transform)}for(let re=0;re<j.length;re++)o(j[re],{transform:W[re]})}}},U=()=>{E=0,q(),!(!l||v<=0||C)&&(_(),M())},M=()=>{!l||v<=0||E||C||(E=requestAnimationFrame(U))},L=$=>{if(!$||C||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,f=$.clientY,A||V();let G=A;d=u,p=f,l=d>=0&&d<=G.width&&p>=0&&p<=G.height,M()},H=()=>{l=!1,B(),y=null,m=null},J=()=>{y=null,m=null},ae=()=>{h=Lc(),v=h*g,q(),M()},pe=()=>{if(!(C||!a)){if(V(),A){let $=A;d=u-$.left,p=f-$.top,l=d>=0&&d<=$.width&&p>=0&&p<=$.height}M()}},ye=()=>{if(g=mp(),v=h*g,V(),a&&A){let $=A;d=u-$.left,p=f-$.top,l=d>=0&&d<=$.width&&p>=0&&p<=$.height}M()},Me=$=>{V(),L($)},ie=$=>{J(),Me($)},D=()=>{C=!0,E&&(cancelAnimationFrame(E),E=0),N&&clearInterval(N);try{window.removeEventListener("scroll",pe)}catch{}try{window.removeEventListener("resize",ye)}catch{}try{window.removeEventListener("saveSlot:change",ae)}catch{}try{document.removeEventListener("ccc:upgrades:changed",ae)}catch{}try{e.removeEventListener("pointermove",L)}catch{}try{e.removeEventListener("pointerdown",Me)}catch{}try{e.removeEventListener("pointerenter",ie)}catch{}try{e.removeEventListener("pointerleave",H)}catch{}try{e.removeEventListener("pointercancel",H)}catch{}try{window.removeEventListener("blur",J)}catch{}try{s.remove()}catch{}},Z={passive:!0};return e.addEventListener("pointermove",L,Z),e.addEventListener("pointerdown",Me,Z),e.addEventListener("pointerenter",ie,Z),e.addEventListener("pointerleave",H,Z),e.addEventListener("pointercancel",H,Z),window.addEventListener("resize",ye),window.addEventListener("scroll",pe,{passive:!0}),window.addEventListener("focus",V,{passive:!0}),window.addEventListener("blur",J,{passive:!0}),document.addEventListener("visibilitychange",()=>{V(),document.hidden&&J()},{passive:!0}),window.addEventListener("saveSlot:change",ae),document.addEventListener("ccc:upgrades:changed",ae),N=setInterval(V,1e3),ae(),{destroy:D}}function yp(){cl=null,ul=null,fl=null}function iv(e){let t=hp.clone?.()??c.fromInt(1),n=ov(t),o=ho(Jy),i=rv(e??lu);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Ao=="function"&&Ao()?ho(Ps):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function Fc(){let{coinGain:e,xpGain:t,mpGain:n}=iv(null);return{coins:e,xp:t,mp:n}}function wd(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=iv(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=$n(Te.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{kn=kn?.add?kn.add(r):ho(r)}catch{kn=ho(r)}al(),a||Qy(r);let u=typeof fn=="function"?fn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&ev(i),s.isZero?.()||tv(s)}function dE({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){lp?.destroy&&lp.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};rE(),lE(),a.style.touchAction="none";let d=null,p=null;kn=O.coins.value,pp=()=>{let x=ne(kn);x.includes("<span")?f.innerHTML=x:f.textContent=x},nv(),al();let y=x=>{x?.detail&&x.detail.key==="coins"&&(kn=x.detail.value,al())};window.addEventListener("currency:change",y);let m=x=>{if(!(!x?.detail||x.detail.key!=="coins"))try{let{mult:z}=x.detail;z instanceof c?jn=z.clone?.()??z:z!=null?jn=c.fromAny(z):jn=c.fromInt(1),Ii=!!jn?.isInfinite?.()}catch{jn=null,Ii=!1}};window.addEventListener("currency:multiplier",m);let g=b();if(g==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let h=`ccc:unlock:shop:${g}`,v=`ccc:unlock:shop:progress:${g}`,E=localStorage.getItem("ccc:unlock:shop:progress"),C=localStorage.getItem("ccc:unlock:shop");E!=null&&localStorage.getItem(v)==null&&localStorage.setItem(v,E),C!=null&&localStorage.getItem(h)==null&&localStorage.setItem(h,C),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let x=parseInt(localStorage.getItem(v)||"0",10);if(localStorage.setItem(v,String(x)),x>=10&&localStorage.getItem(h)!=="1"){try{bi()}catch{}localStorage.setItem(h,"1")}}let A=new URL(i,document.baseURI).href,N=x=>x instanceof HTMLElement?x._coinObj?!x._coinObj.isRemoved&&x.dataset.collected!=="1":x.dataset.collected!=="1"&&x.matches(r):!1;function V(x){try{x.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(V);let B=je?.12:.3,q=0;function _(x=A){if(x===A){let z=performance.now();if(z-q<40)return;q=z}ht(x,{volume:B})}function U(x,z={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(x);let ue=()=>{x&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(x):x.remove())};if(l||je){ue();return}let me="translate3d(0,0,0)";z.transform?z.transform!=="none"&&(me=z.transform):me=x.style.transform||"translate3d(0,0,0)",x.style.setProperty("--ccc-start",me),x.classList.add("coin--collected");let Q=!1,se=()=>{Q||(Q=!0,x.removeEventListener("animationend",se),ue())};x.addEventListener("animationend",se),setTimeout(se,600)}function M(x){if(!x||!x.length)return;let z=A,ue=-1,me=!1;for(let le of x){let ee=le.coin||le.el&&le.el._coinObj;ee&&(ee.sizeIndex!==void 0?ee.sizeIndex>ue&&(ue=ee.sizeIndex,ee.soundSrc&&(z=ee.soundSrc,me=!0)):ee.soundSrc&&!me&&(z=ee.soundSrc,me=!0))}_(z);let Q=null,se=null,ge=null,Re=0,oe=$n(Te.COINS),be=typeof fn=="function"?fn():!0,Be=typeof Ao=="function"&&Ao(),Pe=15,Oe=0;for(let le of x){let ee=le.el,we=le.coin;if(!we&&ee&&ee._coinObj&&(we=ee._coinObj),ee&&!N(ee)||we&&we.isRemoved)continue;Re++,ee&&(ee.dataset.collected="1"),Oe<Pe?(!ee&&we&&e&&e.ensureCoinVisual&&(ee=e.ensureCoinVisual(we),ee&&(ee.dataset.collected="1")),ee?(U(ee,le.opts||{}),Oe++):we&&e&&e.removeCoinTarget&&e.removeCoinTarget(we)):we&&e&&e.removeCoinTarget?e.removeCoinTarget(we):ee&&(e&&e.detachCoin&&e.detachCoin(ee),e&&e.recycleCoin?e.recycleCoin(ee):ee.remove());let w=ee?cE(ee):hp,Y=we?.mutationLevel??(ee?.dataset?.mutationLevel||null),K=ov(w),te=ho(Jy),he=ho(Ps);if(we&&we.valueMultiplier&&we.valueMultiplier>1){try{K=K.mulDecimalFloor(we.valueMultiplier)}catch{}try{te=te.mulDecimalFloor(we.valueMultiplier)}catch{}try{he=he.mulDecimalFloor(we.valueMultiplier)}catch{}}let ce=rv(Y);if(ce){try{K=K.mulBigNumInteger(ce)}catch{}try{te=te.mulBigNumInteger(ce)}catch{}}oe||(Q=Bs(Q,K)),be&&(se=Bs(se,te)),Be&&(ge=Bs(ge,he))}if(Re!==0){if(Q&&!Q.isZero?.()){try{kn=kn?.add?kn.add(Q):ho(Q)}catch{kn=ho(Q)}Qy(Q),al()}if(se&&!se.isZero?.()&&ev(se),ge&&!ge.isZero?.()&&tv(ge),localStorage.getItem(h)!=="1"){let ee=parseInt(localStorage.getItem(v)||"0",10)+Re;if(localStorage.setItem(v,String(ee)),ee>=10){try{bi()}catch{}localStorage.setItem(h,"1")}}}}function L(x,z={}){return M([{el:x,opts:z}]),!0}d=fE({playfield:a,coinsLayer:u,coinSelector:r,collectFn:L,collectBatchFn:M,spawner:e}),p=zy(a);let H=x=>{if(x.target===u)return;let z=x.target.closest(r);if(z&&N(z)){let ue={};e&&typeof e.getCoinTransform=="function"&&(ue.transform=e.getCoinTransform(z)),L(z,ue)}};u.addEventListener("pointerdown",H,{passive:!0}),je||u.addEventListener("mouseover",H,{passive:!0});let J=25,ae=null,pe=()=>{let x=document.documentElement.clientWidth,z=document.documentElement.clientHeight;ae={left:0,top:0,width:x,height:z,right:x,bottom:z,x:0,y:0}};window.addEventListener("resize",pe),window.addEventListener("scroll",pe,{passive:!0}),pe();let ye=null,Me=null,ie=()=>{ye=null,Me=null};a.addEventListener("pointerleave",ie,{passive:!0}),a.addEventListener("pointerenter",ie,{passive:!0}),window.addEventListener("blur",ie,{passive:!0});function D(x,z){if(e&&typeof e.findCoinTargetsInRadius=="function"){ae||pe();let ue=x,me=z,Q=[];if(typeof e.findCoinTargetsInPath=="function"&&ye!==null&&Me!==null?Q=e.findCoinTargetsInPath(ye,Me,ue,me,J,!0):Q=e.findCoinTargetsInRadius(ue,me,J,!0),ye=ue,Me=me,Q&&Q.length>0){let se=[];for(let ge=0;ge<Q.length;ge++){let Re=Q[ge],oe={coin:Re};Re.el&&e.getCoinTransform&&(oe.opts={transform:e.getCoinTransform(Re.el)}),se.push(oe)}M(se)}}else if(e&&typeof e.findCoinsInRadius=="function"){ae||pe();let ue=x,me=z,Q=e.findCoinsInRadius(ue,me,J);if(ye=ue,Me=me,Q&&Q.length>0){let se=[];for(let ge of Q){let Re=e.getCoinTransform?e.getCoinTransform(ge):ge.style.transform;se.push({el:ge,opts:{transform:Re}})}M(se)}}else{let ue=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],me=new Set;for(let Q=0;Q<ue.length;Q++){let se=x+ue[Q][0],ge=z+ue[Q][1],Re=document.elementsFromPoint(se,ge);for(let oe=0;oe<Re.length;oe++){let be=Re[oe];N(be)&&!me.has(be)&&me.add(be)}}if(me.size>0){let Q=[];me.forEach(se=>Q.push({el:se})),M(Q)}}}let Z=null,$=!1;function G(x,z){Z={x,y:z},$||($=!0,requestAnimationFrame(()=>{Z&&(D(Z.x,Z.y),Z=null),$=!1}))}a.addEventListener("pointerdown",x=>{G(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointermove",x=>{x.pointerType!=="mouse"&&G(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointerup",x=>{x.pointerType!=="mouse"&&G(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("mousemove",x=>{G(x.clientX,x.clientY)},{passive:!0});function j(x){}let W=setInterval(pe,1e3),re=()=>{if(clearInterval(W),cu(),pp=()=>{},typeof window<"u"&&(window.removeEventListener("resize",pe),window.removeEventListener("beforeunload",cu),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",y),window.removeEventListener("blur",ie)),typeof Si=="function"){try{Si()}catch{}Si=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",H),je||u.removeEventListener("mouseover",H)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(x=>a.replaceWith(a.cloneNode(!0)))}catch{}};return lp={destroy:re},{get count(){return kn},set count(x){kn=c.fromAny?c.fromAny(x):c.fromInt(Number(x)||0),al()},setMobileVolume:j,destroy:re,collectBatch:M,getMagnetUnitPx:mp}}var ll,au,lu,Si,lp,Jy,hp,iE,Os,wi,sE,Ps,Zy,cl,ul,fl,cp,kn,pp,up,al,uE,dp,ho,Bs,cu,gp,Qy,ev,tv,jn,Ii,nv,ov,rv,Xa=De(()=>{St();Et();Yt();su();Vn();lo();_o();ao();Ky();Dn();ll=!1,au=!1,lu="0",Si=null;lp=null,Jy=c.fromInt(1),hp=c.fromInt(1),iE=c.fromInt(1);try{Os=c.fromAny("Infinity")}catch{Os=null}wi=new Map,sE="1",Ps=c.fromInt(1),Zy=!1,cl=null,ul=null,fl=null,cp=!1,kn=null,pp=()=>{},up=!1,al=()=>{up||(up=!0,requestAnimationFrame(()=>{up=!1,pp()}))};uE=.05,dp=8;ho=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Bs=(e,t)=>{if(!t)return e;if(!e)return ho(t);try{return e.add(t)}catch{try{return ho(e).add(t)}catch{return ho(t)}}},cu=()=>{let e=cl;if(cl=null,e&&!e.isZero?.())try{O.coins.add(e)}catch{}let t=ul;if(ul=null,t&&!t.isZero?.())try{Ji(t)}catch{}let n=fl;if(fl=null,n&&!n.isZero?.())try{Es(n)}catch{}},gp=()=>{cp||(cp=!0,requestAnimationFrame(()=>{cp=!1,cu()}))},Qy=e=>{cl=Bs(cl,e),gp()},ev=e=>{ul=Bs(ul,e),gp()},tv=e=>{fl=Bs(fl,e),gp()};typeof window<"u"&&window.addEventListener("beforeunload",cu,{passive:!0});jn=null,Ii=!1,nv=()=>{try{let e=O?.coins?.mult;if(!e||typeof e.get!="function"){jn=null,Ii=!1;return}let t=e.get();if(!t){jn=c.fromInt(1),Ii=!1;return}jn=t.clone?.()??c.fromAny(t),Ii=!!jn?.isInfinite?.()}catch{jn=null,Ii=!1}},ov=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}jn||nv();let n=jn;if(!n)try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(Ii||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},rv=e=>{if(!ll)return null;if(au){if(Os)try{return Os.clone?.()??Os}catch{return Os}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=wi.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{wi.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=Fs(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(iE)===0,s=r.clone?.()??r;if(wi.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function pE(e){if(e==null)return 0;try{let t=localStorage.getItem(lv(e));return t?parseInt(t,10):0}catch{return 0}}function mE(e,t){if(e!=null)try{localStorage.setItem(lv(e),t.toString())}catch{}}function hE(e){if(e==null)return 0;try{let t=localStorage.getItem(cv(e));return t?parseInt(t,10):0}catch{return 0}}function gE(e,t){if(e!=null)try{localStorage.setItem(cv(e),t.toString())}catch{}}function uv(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let f=Number(e.toString());isNaN(f)||(t=f),(e==="Infinity"||f===1/0)&&(n=!0)}catch{}let o=b(),r=pE(o),i=r;i<1&&n&&(i=1),i<2&&pt(4)>=1&&(i=2),i!==r&&(r=i,mE(o,r));let s=hE(o),l=s;l<1&&pt(4)>=1&&(l=1),l!==s&&(s=l,gE(o,s));let a=[],u=[];for(let f of av){let d=f;if(n){d={...f,description:[...f.description]};let p=Ln(),y=Co(),m=p+y;if(m>1&&(m=1),f.id===1){let g=Math.pow(10,m),h=Fe(g);d.description[0]=d.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${h}x</span>`)}else if(f.id===2){let g=Math.pow(10,m),h=Fe(g);d.description[1]=d.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${h}x</span>`)}else if(f.id===4){let g=Math.log10(4444e9),h=Ce(g*m),v=ne(h);d.description[0]=d.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${v}x</span>`)}}f.id===9&&(d===f&&(d={...f,description:[...f.description]}),r===0?d.description=["This milestone is hidden for now"]:r===1&&(d.description=["This milestone is hidden until you research Lab Node 4"])),f.id===10&&(d===f&&(d={...f,description:[...f.description]}),s===0&&(d.description=["This milestone is hidden until you research Lab Node 4"])),f.surgeLevel<=t?a.push(d):u.push(d)}return[...a,...u.slice(0,2)]}var av,vp,lv,cv,fv=De(()=>{Yt();Et();Et();co();fi();St();av=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${ne(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]},{id:10,surgeLevel:10,description:["Unlocks new DNA upgrades"]}],vp=av.filter(e=>e.affectedByTsunami).map(e=>e.id),lv=e=>`ccc:surge:milestone9:state:${e}`,cv=e=>`ccc:surge:milestone10:state:${e}`});function dv(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ht("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(w,Y){w.style.position="absolute",w.style.left="50%";let K="perspective(600px) rotateX(50deg) rotateZ(180deg)",te=!!o.xpHTML,he=!!o.mpHTML;Y==="coin"?(w.style.top="77%",w.style.transform=`translateX(-50%) ${K}`):te&&he?(w.style.top="72.5%",Y==="mp"?w.style.transform=`translateX(calc(-100% - 44px)) ${K}`:w.style.transform=`translateX(44px) ${K}`):(Y==="mp"?w.style.top="66%":Y==="xp"&&(w.style.top="72%"),w.style.transform=`translateX(-50%) ${K}`),w.style.transformOrigin="center center";let ce=w.firstElementChild;ce&&(ce.removeAttribute("hidden"),ce.style.display="flex")}if(o.coinHTML){let w=document.createElement("div");w.innerHTML=o.coinHTML,f(w,"coin"),u.appendChild(w)}if(o.xpHTML){let w=document.createElement("div");w.innerHTML=o.xpHTML,f(w,"xp"),u.appendChild(w)}if(o.mpHTML){let w=document.createElement("div");w.innerHTML=o.mpHTML,f(w,"mp"),u.appendChild(w)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let p=new Image;p.src="img/misc/merchant.webp";let y=!1;p.onload=()=>{y=!0},p.onerror=w=>{console.error("Tsunami: Merchant load failed",w)};let m,g,h=[],v=[],E=0;function C(){h=[],v=[];let w=g*.65,Y=w+g*.15,te=300*(Math.min(m,g)*5e-4),he=m*.8,ce=he-te*.6,Ye=he+te*.6;for(let ft=0;ft<100;ft++){let ln=Math.random()*m,Fn=Y+Math.random()*(g-Y);v.push({x:ln,y:Fn})}let tt=(ft,ln,Fn)=>{if(ft>m*.1&&ft<m*.9){let Ft=g-w,Sn=w+Ft*.15;if(ln>Sn)return!1}else if(Fn==="tree"){let Ft=g-w,Sn=w+Ft*.5;if(ln>Sn)return!1}return!(Fn==="tree"&&ft>ce&&ft<Ye)},Se=(ft,ln,Fn,Ft,Sn)=>{for(let Xr=0;Xr<ln;Xr++){let Fo,Uo,ur=!1,ke=0;for(;!ur&&ke<50;){Sn?Fo=Sn():Fo=Math.random()*m;let S=g,k=Math.random();if(Uo=w+20+k*k*(S-w-20),tt(Fo,Uo,ft)&&(ur=!0,ft==="tree")){for(let R of h)if(R.type==="tree"){let T=R.x-Fo,P=R.y-Uo;if(Math.sqrt(T*T+P*P)<Math.max(m*.08,100)){ur=!1;break}}}ke++}if(ur){let k=.6+(Uo-w)/(g-w)*.6,R=(Fn+Math.random()*Ft)*k;h.push({type:ft,x:Fo,y:Uo,scale:R})}}},$e=3+Math.floor(Math.random()*3);Se("tree",$e,.8,.4,()=>Math.random()*(m*.1)),Se("tree",$e,.8,.4,()=>m*.9+Math.random()*(m*.1));let Gt=5+Math.floor(Math.random()*3);Se("tree",Gt,.8,.4,()=>m*.1+Math.random()*(m*.8)),Se("rock",20,.6,.4),Se("shell",30,.3,.3),h.sort((ft,ln)=>ft.y-ln.y)}let A=a.getContext("2d",{alpha:!1}),N=d.getContext("2d",{alpha:!0});function V(){let w=window.devicePixelRatio||1;m=window.innerWidth,g=window.innerHeight,a.width=m*w,a.height=g*w,a.style.width=m+"px",a.style.height=g+"px",d.width=m*w,d.height=g*w,d.style.width=m+"px",d.style.height=g+"px",A.scale(w,w),N.scale(w,w),C(),E=-50}window.addEventListener("resize",V),V();let B=Date.now(),q=!0,_,U=!1,M={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},L={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},H=!1,J=[],ae=0,pe=!1,ye=0,Me=5e3,ie=!1,D=0,Z=[],$=6;for(let w=0;w<$;w++)Z.push({offset:Math.random()*1e3,speedBase:.001+w*5e-4,amplitudeBase:10+w*5});let G=[],j=400;function W(w,Y,K){return w*(1-K)+Y*K}function re(w){let Y=parseInt(w.slice(1),16);return{r:Y>>16&255,g:Y>>8&255,b:Y&255}}function x(w,Y,K){let te=re(w),he=re(Y),ce=Math.round(W(te.r,he.r,K)),Ye=Math.round(W(te.g,he.g,K)),tt=Math.round(W(te.b,he.b,K));return`rgb(${ce},${Ye},${tt})`}function z(w,Y,K){let te=[],he=w,ce=Y,Ye=20;for(;ce<K;){let tt=he+(Math.random()-.5)*60,Se=ce+Ye+Math.random()*30;te.push({x1:he,y1:ce,x2:tt,y2:Se}),he=tt,ce=Se}return te}function ue(w,Y,K,te,he,ce){w.beginPath(),w.moveTo(Y+ce,K),w.lineTo(Y+te-ce,K),w.quadraticCurveTo(Y+te,K,Y+te,K+ce),w.lineTo(Y+te,K+he-ce),w.quadraticCurveTo(Y+te,K+he,Y+te-ce,K+he),w.lineTo(Y+ce,K+he),w.quadraticCurveTo(Y,K+he,Y,K+he-ce),w.lineTo(Y,K+ce),w.quadraticCurveTo(Y,K,Y+ce,K),w.closePath()}function me(w,Y,K,te,he){w.save(),w.translate(Y,K),w.scale(te,te),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(10,-40,-5,-80),w.lineTo(5,-80),w.quadraticCurveTo(20,-40,10,0),w.fillStyle=he.rock,w.fill(),w.translate(0,-80),w.fillStyle=he.leaf;for(let ce=0;ce<7;ce++)w.save(),w.rotate(ce/7*Math.PI*2-Math.PI/2),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(30,-10,60,0),w.quadraticCurveTo(30,10,0,0),w.fill(),w.restore();w.restore()}function Q(w,Y,K,te,he){w.save(),w.translate(Y,K),w.scale(te,te),w.fillStyle=he.rock,w.beginPath(),w.moveTo(-20,0),w.bezierCurveTo(-20,-15,-10,-25,0,-25),w.bezierCurveTo(10,-25,20,-15,20,0),w.fill(),w.fillStyle="rgba(0,0,0,0.2)",w.beginPath(),w.ellipse(0,0,20,5,0,0,Math.PI*2),w.fill(),w.restore()}function se(w,Y,K,te,he){w.save(),w.translate(Y,K),w.scale(te,te),w.fillStyle=he.shell,w.beginPath(),w.arc(0,0,10,Math.PI,0),w.lineTo(0,0),w.fill(),w.strokeStyle=he.sandDark,w.lineWidth=1,w.beginPath();for(let ce=1;ce<5;ce++){let Ye=Math.PI+ce/5*Math.PI;w.moveTo(0,0),w.lineTo(Math.cos(Ye)*10,Math.sin(Ye)*10)}w.stroke(),w.restore()}function ge(w,Y,K,te,he){w.fillStyle=he.sandDark,w.fillRect(-50,te,Y+100,K-te),w.fillStyle=he.sandDark,w.save(),w.fillStyle=he.sandLight,w.globalAlpha=.3,w.beginPath(),w.moveTo(-50,K+100),w.lineTo(-50,te),w.bezierCurveTo(Y*.3,te-20,Y*.7,te+20,Y+50,te),w.lineTo(Y+50,K+100),w.fill(),w.globalAlpha=.6;let ce=te+K*.05;w.beginPath(),w.moveTo(-50,K+100),w.lineTo(-50,ce),w.bezierCurveTo(Y*.4,ce+40,Y*.6,ce-10,Y+50,ce+20),w.lineTo(Y+50,K+100),w.fill(),w.globalAlpha=1;let Ye=te+K*.15;w.beginPath(),w.moveTo(-50,K+100),w.lineTo(-50,Ye),w.bezierCurveTo(Y*.2,Ye-10,Y*.8,Ye+30,Y+50,Ye+10),w.lineTo(Y+50,K+100),w.fill(),w.fillStyle=he.sandDark,w.globalAlpha=.1,v.forEach(tt=>{w.fillRect(tt.x,tt.y,2,2)}),w.restore()}function Re(w,Y,K,te=null){let he=te||1,ce=!!te&&te>5;H&&!ce&&!ie&&ht("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),J.push({x:ce?Y/2:Math.random()*Y,y:ce?K/2:Math.random()*K,radius:0,maxRadius:ce?Math.max(Y,K)*1.5:(100+Math.random()*400)*he,speed:ce?40:(5+Math.random()*15)*he,opacity:1,hue:225+Math.random()*15,life:1})}function oe(w,Y,K,te=.5,he=!0){let ce=.1+te*.7,Ye=Math.floor(1+te*4);if(he&&!ie){for(let tt=0;tt<Ye;tt++)if(J.length<50&&Math.random()<ce){let Se=1+te*2;Re(w,Y,K,Se)}}w.save(),w.globalCompositeOperation="lighter";for(let tt=J.length-1;tt>=0;tt--){let Se=J[tt];if(Se.radius+=Se.speed,Se.opacity-=.015,Se.life-=.015,Se.opacity<=0||Se.radius>Se.maxRadius){J.splice(tt,1);continue}let $e=w.createRadialGradient(Se.x,Se.y,0,Se.x,Se.y,Se.radius),Gt=Se.opacity;$e.addColorStop(0,`hsla(${Se.hue}, 100%, 80%, ${Gt})`),$e.addColorStop(.3,`hsla(${Se.hue}, 100%, 40%, ${Gt*.9})`),$e.addColorStop(.7,`hsla(${Se.hue}, 100%, 15%, ${Gt*.6})`),$e.addColorStop(1,`hsla(${Se.hue}, 100%, 5%, 0)`),w.fillStyle=$e,w.beginPath(),w.arc(Se.x,Se.y,Se.radius,0,Math.PI*2),w.fill()}w.restore()}function be(){if(!q)return;let w=Date.now(),Y=w-B;Math.min(Y/t,1)>=1&&!U&&(U=!0,r&&r.stop(),i&&i.stop(),n&&n());let te=5e3,he=6e3,ce=5e4,Ye=5e4,tt=5e3,Se=4e4,$e=0;Y<he?$e=0:Y<ce?$e=(Y-he)/(ce-he):$e=1;let Gt=0;Y>Se&&(Gt=Math.max(0,(Y-Se)/(ce-Se))),Y>ce&&(Gt=1),Gt>.1&&!i&&(i=ht("sounds/tsu_rumble.ogg",{volume:.8}));let ft={skyTop:x(M.skyTop,L.skyTop,$e),skyBottom:x(M.skyBottom,L.skyBottom,$e),sun:x(M.sun,L.sun,$e),waterDeep:x(M.waterDeep,L.waterDeep,$e),waterMid:x(M.waterMid,L.waterMid,$e),waterPeak:x(M.waterPeak,L.waterPeak,$e),foam:x(M.foam,L.foam,$e),sandLight:x(M.sandLight,L.sandLight,$e),sandDark:x(M.sandDark,L.sandDark,$e),rock:x(M.rock,L.rock,$e),leaf:x(M.leaf,L.leaf,$e),shell:x(M.shell,L.shell,$e)},ln=0,Fn=0;if($e>.5||ie){let ke=($e-.5)*2*5+Gt*25;D>0&&(ke+=50),ln=(Math.random()-.5)*ke,Fn=(Math.random()-.5)*ke}N.clearRect(0,0,m,g),A.save(),A.translate(ln,Fn),N.save(),N.translate(ln,Fn);let Ft=A.createLinearGradient(0,0,0,g);if(Ft.addColorStop(0,ft.skyTop),Ft.addColorStop(1,ft.skyBottom),A.fillStyle=Ft,A.fillRect(-50,-50,m+100,g+100),$e<1){let ke=g*.15+$e*50;A.beginPath(),A.arc(m*.7,ke,40,0,Math.PI*2),A.fillStyle=ft.sun,A.globalAlpha=1-$e,A.shadowColor=ft.sun,A.shadowBlur=20,A.fill(),A.globalAlpha=1,A.shadowBlur=0}let Sn=g*.65;if(y&&$e<1){A.save();let ke=Math.min(m,g)*5e-4,S=300*ke,k=300*ke,R=m*.8,T=k*.15,P=Sn-k/2+T;A.translate(R,P),A.rotate(.1),A.drawImage(p,-S/2,-k/2,S,k),A.restore()}if(ge(A,m,g,Sn,ft),h.forEach(ke=>{ke.type==="tree"?me(A,ke.x,ke.y,ke.scale,ft):ke.type==="rock"?Q(A,ke.x,ke.y,ke.scale,ft):ke.type==="shell"&&se(A,ke.x,ke.y,ke.scale,ft)}),$e>.3){let ke=($e-.3)/.7,S=Math.floor(j*ke);if(N.strokeStyle=`rgba(120, 180, 255, ${.1+ke*.3})`,N.lineWidth=1+ke,N.beginPath(),G.length<S)for(let R=0;R<10;R++)G.push({x:Math.random()*m*1.5,y:E,speed:20+Math.random()*20,len:10+Math.random()*20});let k=10+ke*20;for(let R=0;R<G.length;R++){let T=G[R];T.y+=T.speed,T.x-=k,N.moveTo(T.x,T.y),N.lineTo(T.x-k*.5,T.y+T.len),(T.y>g||T.x<-100)&&(R<S?(T.x=Math.random()*m*1.5,T.y=E):(G.splice(R,1),R--))}N.stroke()}let Xr=.3;if($e>Xr){let ke=($e-Xr)/(1-Xr),S=W(0,g*1.5,ke*ke);N.fillStyle=ft.waterDeep,N.beginPath(),N.moveTo(-50,g+100),N.lineTo(-50,g-S*.3),N.bezierCurveTo(m*.3,g-S*.4,m*.6,g-S*1.2,m+50,g-S*.8),N.lineTo(m+50,g+100),N.fill()}let Fo=W(0,g*.5,$e),Uo=W(0,g*1.5,Gt*Gt),ur=g*.85-Fo-Uo;if(Z.forEach((ke,S)=>{let k;S===$-1?k=ft.waterPeak:S%2===0?k=ft.waterDeep:k=ft.waterMid,N.fillStyle=k,N.beginPath();let R=ke.amplitudeBase*(1+$e*2+Gt*5),T=.003+$e*.005,P=ke.speedBase*(1+$e*5+Gt*10),fe=Y*P+ke.offset,de=S*15*(1-Gt),Ee=ur+de;N.moveTo(-50,g+100),N.lineTo(-50,Ee);for(let Le=-50;Le<=m+50;Le+=15){let ze=Ee+Math.sin(Le*T+fe)*R+Math.cos(Le*T*2.3+fe)*(R*.5);N.lineTo(Le,ze)}if(N.lineTo(m+50,g+100),N.fill(),S===$-1||$e>.6&&S>$-3){N.save(),N.globalAlpha=.1+$e*.3,N.fillStyle=ft.foam,N.beginPath();for(let Le=-50;Le<=m+50;Le+=10){let ze=Ee+Math.sin(Le*T+fe)*R+Math.cos(Le*T*2.3+fe)*(R*.5);Math.random()>.5&&(ze-=5),Le===-50?N.moveTo(Le,ze):N.lineTo(Le,ze)}N.lineTo(m+50,g+100),N.lineTo(-50,g+100),N.fill(),N.restore()}}),Y<te){let ke=1;Y>1e3&&(ke=1-(Y-1e3)/(te-1e3)),N.fillStyle=`rgba(0, 0, 0, ${ke})`,N.fillRect(-50,-50,m+100,g+100)}if(Y>Ye){let ke=Math.min(1,(Y-Ye)/tt);N.fillStyle=`rgba(0, 0, 0, ${ke})`,N.fillRect(-50,-50,m+100,g+100)}if(H){let ke=w-ae,S=12e3,k=0,R=!0;ke<S?k=ke/S:(k=1,ie||(ie=!0,Re(N,m,g,25),D=60,l||(l=!0,ht("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),pe&&(R=!1),oe(N,m,g,k,R)}if(pe){let ke=w-ye,S=Math.min(1,ke/Me);N.fillStyle=`rgba(0, 0, 0, ${S})`,N.fillRect(-50,-50,m+100,g+100)}if(D>0){let ke=D/60,S=ke*ke;N.fillStyle=`rgba(255, 255, 255, ${S})`,N.fillRect(-50,-50,m+100,g+100),D--}A.restore(),N.restore(),_=requestAnimationFrame(be)}function Be(){q=!1,e.style.cursor="",_&&cancelAnimationFrame(_),window.removeEventListener("resize",V),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function Pe(){H=!0,ae=Date.now(),ie=!1,D=0,s||(s=ht("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Oe(){pe=!0,ye=Date.now(),s&&s.stop()}function le(){e.style.cursor=""}function ee(){e.style.cursor="none"}function we(){s&&(s.stop(),s=null)}return be(),{cleanup:Be,triggerBeacons:Pe,triggerFinalFade:Oe,showCursor:le,hideCursor:ee,stopHumLoop:we}}var pv=De(()=>{Dn()});var Zv={};vt(Zv,{canPerformForgeReset:()=>Vv,canPerformInfuseReset:()=>Yv,computeForgeGoldFromInputs:()=>Tv,computeInfuseMagicFromInputs:()=>Av,computePendingDnaFromInputs:()=>Rv,computePendingForgeGold:()=>Xv,computeSurgeWavesFromInputs:()=>Nv,getCurrentSurgeLevel:()=>zn,getForgeDebugOverrideState:()=>Bv,getInfuseDebugOverrideState:()=>Uv,getSurgeBarLevelKey:()=>Us,getSurgeDebugOverrideState:()=>qv,hasDoneExperimentReset:()=>Hv,hasDoneForgeReset:()=>Nr,hasDoneInfuseReset:()=>$t,hasDoneSurgeReset:()=>Mo,initResetPanel:()=>Qd,initResetSystem:()=>Xo,isExperimentUnlocked:()=>vl,isForgeUnlocked:()=>ks,isInfuseUnlocked:()=>wu,isSurgeUnlocked:()=>Ds,onForgeUpgradeUnlocked:()=>zp,onInfuseUpgradeUnlocked:()=>Kp,onSurgeUpgradeUnlocked:()=>jp,performForgeReset:()=>Xp,performInfuseReset:()=>Vp,performSurgeReset:()=>Yp,recomputePendingMagic:()=>pn,setExperimentResetCompleted:()=>Bp,setForgeDebugOverride:()=>Fv,setForgeResetCompleted:()=>Rp,setInfuseDebugOverride:()=>$v,setInfuseResetCompleted:()=>Op,setInfuseUnlockedForDebug:()=>Dv,setSurgeResetCompleted:()=>Pp,setSurgeUnlockedForDebug:()=>Gv,shouldBlockBigCoins:()=>gl,updateResetPanel:()=>Xe});function _p(e){return!LE.includes(e)}function _E(){ht(IE,{volume:.4})}function CE(){ht(wE,{volume:.45})}function ME(){ht(EE,{volume:.5})}function kE(){ht(xE,{volume:.8})}function gl(){return Lv}function _v(){let e=An(),t=O.waves?.value??it(),n=0n;try{n=bl(e)}catch{}let o=I.pendingWaves,r=Wp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),Lv=i&&!dn()}function hl(){Ip=null}function yu(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function vu(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function wp(){let e=I.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Cv(e=null){try{let t=Ld(),n=I.pendingGold.clone?.()??I.pendingGold;if(e){let o=e instanceof Ct?e:Ct.fromAny(e??1);if(o.isInfinite?.())return Ct.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=O.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return I.pendingGold}}function NE(){for(;Zn.length;){let e=Zn.pop();try{e?.()}catch{}}}function Sp(){!yv&&typeof jl=="function"&&(yv=jl((e={})=>{e?.key&&e.key!==Te.COINS&&e.key!==Te.WAVES||e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(e?.key===Te.WAVES?(Eu(),Xe()):(mn(),pn(),Tn()))})),!vv&&typeof ac=="function"&&(vv=ac((e={})=>{e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(mn(),Tn(),No(),Xe())}))}function Np(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ne(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function yl(){try{let e=ot();if(e&&e.xpLevel)return e.xpLevel}catch{}return it()}function Mv(e,t){if(!e||typeof e!="object")return it();let n=Ne(e);if(!Number.isFinite(n)&&n>0)return Ct.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return it();let r=Ce(o*Math.log10(2)),i=Math.max(0,Np(t)),s=Math.max(0,(i-30)/5),l=s<=0?mv():Ce(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?mv():Ce(a*Math.log10(1.15)),f=Ct.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?it():d}function RE(e,t){if(!e)return it();let n=Ne(e);if(!Number.isFinite(n)&&n>0)return Ct.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let y=Ne(t);Number.isFinite(y)&&(a=Math.max(0,y-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,p=r+u+f+d;return Number.isFinite(p)?Ce(p).floorToInteger():Ct.fromAny("Infinity")}function kv(e,t,n=null){let o=RE(e,t),r=_d(),i;if(n){let s=n instanceof Ct?n:Ct.fromAny(n??1);if(s.isInfinite?.())return Ct.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=O.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function Tv(e,t){return Mv(e,t)}function Av(e,t){return kv(e,t)}function Nv(e,t,n,o,r){return Ov(e,t,n,o,r)}function Rv(e,t,n=null){e||(e=it()),t||(t=it());let o=.30103,r=0;if(n!==null?!!n:ct(9)){let l=xr();o=Math.log10(2+l),r=30*l}let s=o.toFixed(18);try{let l=e.mulDecimal(s,18),u=t.div(c.fromInt(20)).mulDecimal(s,18),f=l.add(u);r>0&&(f=f.add(c.fromAny(r)));let d=0;return f.isInfinite()?d=1/0:d=Number(f.toScientific(10)),Ce(d).floorToInteger()}catch{return it()}}function Ov(e,t,n,o,r){let i=Np(e);if(i<201)return it();let s=(i-201)/35,l=Ne(t),a=Ne(n),u=Ne(o),f=Ne(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return Ct.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*uu),Number.isFinite(a)&&a>13&&(d+=(a-13)*uu),Number.isFinite(u)&&u>5&&(d+=(u-5)*uu),Number.isFinite(f)&&f>12&&(d+=(f-12)*uu);let p=1+d+s;return Number.isFinite(p)?Ce(p).floorToInteger():Ct.fromAny("Infinity")}function Pv(){return Math.max(0,Np(yl()))}function An(){if(I.slot!=null)return I.slot;let e=b();return I.slot=e,e}function Rp(e){let t=An();if(t!=null){I.hasDoneForgeReset=!!e;try{localStorage.setItem(Cp(t),I.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function Op(e){let t=An();if(t!=null){I.hasDoneInfuseReset=!!e;try{localStorage.setItem(Mp(t),I.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function Pp(e){let t=An();if(t!=null){I.hasDoneSurgeReset=!!e;try{localStorage.setItem(kp(t),I.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Bp(e){let t=An();if(t!=null){I.hasDoneExperimentReset=!!e;try{localStorage.setItem(Ap(t),I.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function Iu(e=b()){if(e==null)return null;try{let t=localStorage.getItem(pl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Bv(e=b()){return Iu(e)}function Fv(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(I.forgeDebugOverride!==n){if(I.forgeDebugOverride=n,n==null)try{localStorage.removeItem(pl(t))}catch{}else try{localStorage.setItem(pl(t),n?"1":"0")}catch{}at(pl(t)),yu(),Xe()}}function Fp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(ml(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Uv(e=b()){return Fp(e)}function Dv(e){Up(e)}function $v(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(I.infuseDebugOverride!==n){if(I.infuseDebugOverride=n,n==null)try{localStorage.removeItem(ml(t))}catch{}else try{localStorage.setItem(ml(t),n?"1":"0")}catch{}at(ml(t)),vu(),Xe()}}function Up(e){let t=An();if(t==null)return;let n=!!e;if(I.infuseUnlocked!==n){I.infuseUnlocked=n;try{localStorage.setItem(hu(t),I.infuseUnlocked?"1":"0")}catch{}at(hu(t)),vu()}}function bu(e){let t=An();if(t==null)return;let n=!!e;if(I.forgeUnlocked!==n){I.forgeUnlocked=n;try{localStorage.setItem(mu(t),I.forgeUnlocked?"1":"0")}catch{}at(mu(t)),yu()}}function Dp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(xv(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function qv(e=b()){return Dp(e)}function Gv(e){$p(e)}function $p(e){let t=An();if(t==null)return;let n=!!e;if(I.surgeUnlocked!==n){I.surgeUnlocked=n;try{localStorage.setItem(gu(t),I.surgeUnlocked?"1":"0")}catch{}at(gu(t)),wp()}}function Ep(e){if(e==null){I.forgeUnlocked=!1,I.forgeDebugOverride=null,I.hasDoneForgeReset=!1,I.infuseUnlocked=!1,I.infuseDebugOverride=null,I.hasDoneInfuseReset=!1,I.surgeUnlocked=!1,I.surgeDebugOverride=null,I.hasDoneSurgeReset=!1,I.hasDoneExperimentReset=!1,I.flagsPrimed=!1;return}try{I.forgeUnlocked=localStorage.getItem(mu(e))==="1"}catch{I.forgeUnlocked=!1}I.forgeDebugOverride=Iu(e);try{I.hasDoneForgeReset=localStorage.getItem(Cp(e))==="1"}catch{I.hasDoneForgeReset=!1}try{I.infuseUnlocked=localStorage.getItem(hu(e))==="1"}catch{I.infuseUnlocked=!1}try{I.hasDoneInfuseReset=localStorage.getItem(Mp(e))==="1"}catch{I.hasDoneInfuseReset=!1}I.infuseDebugOverride=Fp(e);try{I.surgeUnlocked=localStorage.getItem(gu(e))==="1"}catch{I.surgeUnlocked=!1}I.surgeDebugOverride=Dp(e);try{I.hasDoneSurgeReset=localStorage.getItem(kp(e))==="1"}catch{I.hasDoneSurgeReset=!1}try{I.hasDoneExperimentReset=localStorage.getItem(Ap(e))==="1"}catch{I.hasDoneExperimentReset=!1}I.flagsPrimed=!0}function go(){let e=b();if(e==null){I.flagsPrimed=!1;return}I.slot!==e&&(I.slot=e,hl(),I.flagsPrimed=!1),I.flagsPrimed||Ep(e)}function bv(e){hv!==e&&(NE(),hv=e,e!=null&&(Zn.push(Mt(mu(e),{onChange(t){let n=t==="1";I.forgeUnlocked!==n&&(I.forgeUnlocked=n,yu(),Xe())}})),Zn.push(Mt(Cp(e),{onChange(t){let n=t==="1";I.hasDoneForgeReset!==n&&(I.hasDoneForgeReset=n,Xe())}})),Zn.push(Mt(pl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.forgeDebugOverride!==n&&(I.forgeDebugOverride=n,yu(),Xe())}})),Zn.push(Mt(hu(e),{onChange(t){let n=t==="1";I.infuseUnlocked!==n&&(I.infuseUnlocked=n,vu(),Xe())}})),Zn.push(Mt(Mp(e),{onChange(t){let n=t==="1";I.hasDoneInfuseReset!==n&&(I.hasDoneInfuseReset=n,Xe())}})),Zn.push(Mt(ml(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.infuseDebugOverride!==n&&(I.infuseDebugOverride=n,vu(),Xe())}})),Zn.push(Mt(gu(e),{onChange(t){let n=t==="1";I.surgeUnlocked!==n&&(I.surgeUnlocked=n,wp(),Xe())}})),Zn.push(Mt(xv(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.surgeDebugOverride!==n&&(I.surgeDebugOverride=n,wp(),Xe())}})),Zn.push(Mt(kp(e),{onChange(t){let n=t==="1";I.hasDoneSurgeReset!==n&&(I.hasDoneSurgeReset=n,Xe())}})),Zn.push(Mt(Ap(e),{onChange(t){let n=t==="1";I.hasDoneExperimentReset!==n&&(I.hasDoneExperimentReset=n,Xe())}}))))}function OE(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function mn(e=!1){let t=O.coins?.value??it(),n=yl(),o=OE(t,n);!e&&Ip===o||(Ip=o,qp()?I.pendingGold=Mv(t,n):I.pendingGold=it(),Xe())}function pn(e=null){let t=O.coins?.value??it(),n=Sl();Gp()?I.pendingMagic=kv(t,n,e):I.pendingMagic=it(),Tn(),Xe()}function Tn(){if(!Ds()){I.pendingWaves=it(),No();return}let e=yl(),t=O.coins?.value??it(),n=O.gold?.value??it(),o=O.magic?.value??it(),r=Sl();I.pendingWaves=Ov(e,t,n,o,r),Mo()||I.pendingWaves.cmp(Ct.fromInt(10))>0&&(I.pendingWaves=Ct.fromInt(10)),No(),_v()}function No(){if(!vl()){I.pendingDna=it();return}let e=.30103,t=0;if(ct(9)){let i=xr();e=Math.log10(2+i),t=30*i}let n=e.toFixed(18),o=zt?zt():it(),r=yl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),I.pendingDna=Ce(u).floorToInteger()}catch{try{I.pendingDna=it()}catch{I.pendingDna=it()}}}function xp(){let e=Iu();return e!=null?!!e:I.forgeUnlocked||kt(ve.STARTER_COVE,xe.UNLOCK_FORGE)>=1}function qp(){try{let e=yl();if(e&&typeof e.cmp=="function")return e.cmp(TE)>=0}catch{}return!1}function Gp(){try{let e=mt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(AE)>=0}catch{}return!1}function ks(){go();let e=Iu();return e!=null?!!e:!!I.forgeUnlocked||xp()}function wu(){go();let e=Fp();return e!=null?!!e:!!I.infuseUnlocked}function Ds(){go();let e=Dp();return e!=null?!!e:!!I.surgeUnlocked}function vl(){return Fg()}function zn(){let e=An();return e==null?0n:bl(e)}function Nr(){return go(),!!I.hasDoneForgeReset}function $t(){return go(),!!I.hasDoneInfuseReset}function Mo(){return go(),!!I.hasDoneSurgeReset}function Hv(){return go(),!!I.hasDoneExperimentReset}function Xv(){return mn(),I.pendingGold.clone?.()??I.pendingGold}function Vv(){return!(!ks()||!qp()||I.pendingGold.isZero?.())}function Yv(){return!(!wu()||!Gp()||I.pendingMagic.isZero?.())}function PE({resetGold:e=!1,resetMagic:t=!1}={}){let n=Pt(ve.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===xe.UNLOCK_XP||r===xe.UNLOCK_FORGE||r===xe.UNLOCK_INFUSE||r===xe.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||nr(ve.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Hp({resetGold:e=!1,resetMagic:t=!1}={}){try{O.coins.set(0)}catch{}try{O.books.set(0)}catch{}try{Zi({keepUnlock:!0})}catch{}try{yp()}catch{}PE({resetGold:e,resetMagic:t})}function Xp(){if(!Vv())return!1;let e=Cv();try{O.gold?.add&&O.gold.add(e)}catch{}if(Hp({resetGold:!1}),mn(),bu(!0),I.hasDoneForgeReset||Rp(!0),jt(),Pr(),_p("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return Xe(),!0}function Vp(){if(!Yv())return!1;let e=I.pendingMagic.clone?.()??I.pendingMagic;try{O.magic?.add&&O.magic.add(e)}catch{}Hp({resetGold:!0});try{O.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),jt({forceReload:!0})}catch{}if(mn(),pn(),_p("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return Up(!0),I.hasDoneInfuseReset||Op(!0),Xe(),!0}function Su(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=An();try{O.waves?.add&&e&&!e.isZero?.()&&O.waves.add(e)}catch{}Hp({resetGold:!0,resetMagic:!0});try{O.gold.set(0)}catch{}try{O.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),jt({forceReload:!0})}catch{}if(Eu(),$p(!0),I.hasDoneSurgeReset||Pp(!0),mn(),pn(),Tn(),t&&(n||ME(),n||UE()),_p("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}Xe()}function Wv(){if(!vl()||(zt?zt():it()).cmp(10)<0)return!1;let t=I.pendingDna.clone?.()??I.pendingDna;try{O.DNA?.add&&O.DNA.add(t)}catch{}return Su(it(),{playEffects:!1}),kE(),Ug([4]),I.hasDoneExperimentReset||Bp(!0),mn(),pn(),Tn(),No(),Xe(),!0}function BE(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{Hy(!0)}catch{}try{Vc()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,zo(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=dv(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),My(e,()=>{setTimeout(FE,0)},i)},r);pu=i.cleanup}function FE(){pu&&(pu(),pu=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Su(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function Yp(){if(!Ds()||Pv()<201)return!1;let e=I.pendingWaves.clone?.()??I.pendingWaves;if(e.isZero?.())return!1;let t=An(),n=O.waves?.value??it(),o=bl(t),r=Wp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!dn()?(BE(),Su(e,{playEffects:!1}),!0):(Su(e,{playEffects:!0}),!0)}function UE(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function bl(e){let t=0n;try{let n=localStorage.getItem(Tp(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function DE(e){let t=Tp(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function Sv(e){if(!(e instanceof Ct)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function zv(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=Sv(n),l=Sv(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function Eu(){let e=An();if(e==null||!Ds()||bp||DE(e))return;let t=O.waves?.value??it(),n=bl(e);if(n===1/0)return;let o=zv(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Tp(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}bp=!0;try{O.waves.set(o.remainingWaves)}finally{bp=!1}Xe(),o.safety>=100&&setTimeout(Eu,0)}_v()}function dl(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Ct.fromInt(e)}catch{}try{return ne(t)}catch{return e?.toString?.()??"0"}}function $E(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),p=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${p.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let p="";for(let y=0;y<=r;y++){let m=y/r,g=a+m*(u-a),h=g/(Math.PI*2)*120,v=50+30*Math.sin(g+d);p+=(y===0?"M":"L")+` ${h.toFixed(1)} ${v.toFixed(1)}`}return`<path d="${p}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function qE(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${yE}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${vE}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${bE}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${SE}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Iv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${wv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${du}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${je?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Ev}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,I.panel=e,I.elements.forge.card=e.querySelector("#reset-card-forge"),I.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),I.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),I.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),I.elements.infuse.card=e.querySelector("#reset-card-infuse"),I.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),I.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),I.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),I.elements.surge.card=e.querySelector("#reset-card-surge"),I.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),I.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),I.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),I.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),I.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),I.elements.surge.headerVal=e.querySelector("[data-surge-level]"),I.elements.surge.header=e.querySelector(".surge-header"),I.elements.experiment.card=e.querySelector("#reset-card-experiment"),I.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),I.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");I.elements.surge.milestones&&t&&ws(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),I.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(I.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&ro(r))return;let a=I.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),I.elements.forge.btn&&I.elements.forge.btn.addEventListener("click",()=>{Xp()&&(_E(),Xe())}),I.elements.infuse.btn&&I.elements.infuse.btn.addEventListener("click",()=>{Vp()&&(CE(),Xe())}),I.elements.surge.btn&&I.elements.surge.btn.addEventListener("click",()=>{Yp()&&Xe()}),I.elements.experiment.btn&&I.elements.experiment.btn.addEventListener("click",()=>{Wv()&&Xe()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=$E();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{cs("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}Xe()}function Qd(e){!e||e.__resetInit||(e.__resetInit=!0,qE(e))}function Ro(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=dl(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function Kv({goldMult:e=null}={}){let t=I.elements.forge;if(!(!t.card||!t.btn)){if(!ks()){Ro(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(go(),t.card.classList.toggle("is-forge-complete",!!I.hasDoneForgeReset),t.status)if(I.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!qp()){Ro(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Ro(t.btn,{disabled:!1},Iv,Cv(e))}}function jv(){let e=I.elements.infuse;if(!(!e.card||!e.btn)){if(!wu()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="none"&&(I.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="flex"&&(I.layerButtons.infuse.style.display="flex"),go(),e.card.classList.toggle("is-complete",!!I.hasDoneInfuseReset),e.status)if(I.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!Gp()){Ro(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Ro(e.btn,{disabled:!1},wv,I.pendingMagic)}}function Wp(e,t,n){let o=t.add(n);return zv(e,o).level}function Lp(){let e=I.elements.surge;if(!e.card||!e.btn)return;if(!Ds()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="none"&&(I.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="flex"&&(I.layerButtons.surge.style.display="flex"),go();let t=An(),n=O.waves?.value??it(),o=0n;try{o=bl(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':dl(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=I.pendingWaves;if(u&&!u.isZero?.()){let f=Wp(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let p=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':dl(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${du}">${dl(n)} / <img src="${du}">${dl(r)}</span>`),e.milestones){let s=uv(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",p=a.description.map(A=>A.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${A}</div>`:`<div>- ${A}</div>`).join("");if(f&&a.surgeLevel===3){let A=Lr?Lr():Ct.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${ne(A)}</div>`}if(f&&a.surgeLevel===6){let A=Tc();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Fe(A.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Fe(A.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Fe(A.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Fe(A.magic)}x</span></div>`}let y=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(y=!0);let m=xr(),g=!1;f&&y&&m<1&&vp.includes(a.id)&&(g=!0);let h=g?" is-nerfed":"",v=l[u];if(!v)v=document.createElement("div"),v.className=`surge-milestone-item ${d}${h}`,v.dataset.isReached=String(f),v.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(v);else{v.className!==`surge-milestone-item ${d}${h}`&&(v.className=`surge-milestone-item ${d}${h}`);let A=String(f);v.dataset.isReached!==A&&(v.dataset.isReached=A)}let E=v.querySelector(".surge-milestone-desc");E&&E.innerHTML!==p&&(E.innerHTML=p);let C=v.querySelector(".surge-milestone-nerf-arrow");if(C){let A=!1;y&&m<1&&vp.includes(a.id)&&(A=!0);let N=A?"":"none";C.style.display!==N&&(C.style.display=N)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();I.lastRenderedSurgeLevel!==o&&(I.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!I.hasDoneSurgeReset),e.status)if(I.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(Pv()<201){Ro(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(I.pendingWaves.isZero?.()){Ro(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Ro(e.btn,{disabled:!1},du,I.pendingWaves)}function GE(){let e=I.elements.experiment;if(!e.card||!e.btn)return;if(!vl()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="none"&&(I.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="flex"&&(I.layerButtons.experiment.style.display="flex"),go(),e.card.classList.toggle("is-complete",!!I.hasDoneExperimentReset),e.status)if(I.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((zt?zt():it()).cmp(10)<0){Ro(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}Ro(e.btn,{disabled:!1},Ev,I.pendingDna)}function Xe({goldMult:e=null}={}){I.panel&&(Kv({goldMult:e}),jv(),Lp(),GE())}function zp(){Xo(),bu(!0),Xe()}function Kp(){Xo(),Up(!0),Xe()}function jp(){Xo(),$p(!0),Xe()}function HE(){if(!I.panel)return;let e=I.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!I.panel.classList.contains("is-active")||!I.elements.surge.barFill)return;let t=I.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Lp(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Lp()},{once:!0}))}function XE(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{HE()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(mn(),pn(),Tn()),e.detail?.key==="waves"&&(Eu(),Xe()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Tn(),Xe())}),window.addEventListener("surge:bookResidue",()=>{if(I.panel&&I.panel.offsetParent!==null){let e=I.elements.surge.card;e&&e.style.display!=="none"&&Xe()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Te.GOLD){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;mn(!0);let n=t.mult instanceof c?t.mult:Ct.fromAny(t.mult??1);I.panel&&Kv({goldMult:n});return}if(t.key===Te.MAGIC){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;let n=t.mult instanceof c?t.mult:Ct.fromAny(t.mult??1);pn(n),I.panel&&jv();return}}}),window.addEventListener("xp:change",()=>{mn(),Tn(),No(),Xe()}),window.addEventListener("mutation:change",()=>{pn(),Tn(),Xe()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&I.slot!=null&&e.detail.slot!==I.slot||(hl(),mn(!0),pn(),Tn(),No(),Xe())}),window.addEventListener("lab:level:change",()=>{No(),Xe()}),window.addEventListener("lab:node:change",()=>{pn(),Xe()}))}function Xo(){if(gv){I.slot=b(),hl(),Sp(),mn(!0),pn(),Tn(),No();return}try{jt()}catch{return}gv=!0;let e=b();if(I.slot=e,hl(),Ep(e),I.hasDoneForgeReset&&!Ao())try{Pr()}catch{}if(!I.forgeUnlocked&&xp()&&bu(!0),bv(e),Sp(),XE(),mn(!0),pn(),Tn(),No(),fu){try{fu()}catch{}fu=null}fu=Ei(()=>{let t=Zp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(I.slot=t,hl(),Ep(t),I.hasDoneForgeReset&&!Ao())try{Pr()}catch{}!I.forgeUnlocked&&xp()&&bu(!0),bv(t),Sp(),mn(!0),pn(),Tn(),No(),Xe()})}var Ct,uu,it,mv,Iv,wv,Ev,yE,vE,bE,SE,du,IE,wE,EE,xE,LE,mu,Cp,pl,hu,Mp,ml,gu,xv,kp,Us,Tp,Ap,TE,AE,bp,Lv,I,Zn,hv,gv,fu,Ip,yv,vv,pu,Lo=De(()=>{Et();lo();St();Yt();Vn();ao();_o();ts();Xa();fv();si();Dn();co();fi();pi();Wc();pv();Ct=c,uu=Math.log10(1.1),it=()=>Ct.fromInt(0),mv=()=>Ct.fromInt(1),Iv="img/currencies/gold/gold.webp",wv="img/currencies/magic/magic.webp",Ev="img/currencies/dna/dna.webp",yE="img/misc/forge.webp",vE="img/misc/infuse.webp",bE="img/misc/surge.webp",SE="img/misc/experiment.webp",du="img/currencies/wave/wave.webp",IE="sounds/forge_reset.ogg",wE="sounds/infuse_reset.ogg",EE="sounds/surge_reset.ogg",xE="sounds/experiment_reset.ogg",LE=[];mu=e=>`ccc:reset:forge:${e}`,Cp=e=>`ccc:reset:forge:completed:${e}`,pl=e=>`ccc:debug:forgeUnlocked:${e}`,hu=e=>`ccc:reset:infuse:${e}`,Mp=e=>`ccc:reset:infuse:completed:${e}`,ml=e=>`ccc:debug:infuseUnlocked:${e}`,gu=e=>`ccc:reset:surge:${e}`,xv=e=>`ccc:debug:surgeUnlocked:${e}`,kp=e=>`ccc:reset:surge:completed:${e}`,Us=e=>`ccc:reset:surge:barLevel:${e}`,Tp=Us,Ap=e=>`ccc:reset:experiment:completed:${e}`,TE=Ct.fromInt(31),AE=Ct.fromInt(7),bp=!1,Lv=!1;I={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:it(),pendingMagic:it(),pendingWaves:it(),pendingDna:it(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},Zn=[],hv=null,gv=!1,fu=null,Ip=null,yv=null,vv=null;pu=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Xo,performForgeReset:Xp,performInfuseReset:Vp,performSurgeReset:Yp,performExperimentReset:Wv,computePendingForgeGold:Xv,computeForgeGoldFromInputs:Tv,computeInfuseMagicFromInputs:Av,computeSurgeWavesFromInputs:Nv,computePendingDnaFromInputs:Rv,getForgeDebugOverrideState:Bv,hasDoneForgeReset:Nr,isForgeUnlocked:ks,setForgeDebugOverride:Fv,setForgeResetCompleted:Rp,updateResetPanel:Xe,isInfuseUnlocked:wu,setInfuseDebugOverride:$v,getInfuseDebugOverrideState:Uv,recomputePendingMagic:pn,setInfuseUnlockedForDebug:Dv,setInfuseResetCompleted:Op,hasDoneInfuseReset:$t,isSurgeUnlocked:Ds,setSurgeUnlockedForDebug:Gv,getSurgeDebugOverrideState:qv,setSurgeResetCompleted:Pp,hasDoneSurgeReset:Mo,getCurrentSurgeLevel:zn,shouldBlockBigCoins:gl,hasDoneExperimentReset:Hv,setExperimentResetCompleted:Bp,isExperimentUnlocked:vl}))});var w0={};vt(w0,{AREA_KEYS:()=>ve,HM_EVOLUTION_INTERVAL:()=>qt,MAX_LEVEL_DELTA:()=>Ys,REGISTRY:()=>qu,UPGRADE_TIES:()=>xe,approxLog10BigNum:()=>Ne,batchUpgradeOperations:()=>wl,bigNumFromLog10:()=>Ce,buyCheap:()=>sl,buyMax:()=>il,buyOne:()=>Ts,buyTowards:()=>As,clearPermanentUpgradeUnlock:()=>gm,computeDefaultUpgradeCost:()=>ym,computeHmMultipliers:()=>Vo,computeUpgradeEffects:()=>us,costToBuyOne:()=>hx,ensureLevelBigNum:()=>dt,estimateFlatBulk:()=>cm,estimateGeometricBulk:()=>cx,evaluateBulkPurchase:()=>vi,evolveUpgrade:()=>eu,formatMultForUi:()=>Fe,getCurrentAreaKey:()=>Kn,getHmEvolutions:()=>dm,getHmNextMilestoneLevel:()=>gx,getIconUrl:()=>tu,getLevel:()=>xn,getLevelNumber:()=>kt,getMagnetLevel:()=>Lc,getMpValueMultiplierBn:()=>xc,getUpgrade:()=>js,getUpgradeLockState:()=>ko,getUpgradeStorageKey:()=>Li,getUpgradesForArea:()=>Pt,levelBigNumToNumber:()=>He,log10OnePlusPow10:()=>bf,markUpgradePermanentlyUnlocked:()=>xi,normalizeBigNum:()=>yx,normalizedUpgradeLevel:()=>Nu,onUpgradesChanged:()=>gd,peekNextPrice:()=>I0,performFreeAutobuy:()=>Ed,safeMultiplyBigNum:()=>It,setLevel:()=>nr,syncBookCurrencyMultiplierFromUpgrade:()=>Ga,upgradeUiModel:()=>Ns});function xu(){Br.size!==0&&(Br.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{at(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Br.clear())}function YE(){if(!(typeof window>"u")&&!Qv){Qv=setInterval(xu,2e3);try{window.addEventListener("beforeunload",xu)}catch{}try{window.addEventListener("pagehide",xu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&xu()})}catch{}}}function wl(e){if(qs)return e();qs=!0;try{return e()}finally{qs=!1,Il.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{Hs(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),Il.clear(),Jv.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{px(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),Jv.clear(),om&&(om=!1,eo())}}function WE(e){try{let t=Ks(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function n0(e,t){if(!WE(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=Ne(n);return Number.isFinite(o)&&o>=zE}catch{return!1}}function Gs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>Jp)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>Jp/2||i.length>Jp/2)return"Infinity"}return n}function _u(e){return ex[e]??0}function Qp(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Ws(e,t){let n=ir(e||t?.area);if(!n)return null;let o=sr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=Qn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function El(e,t){let n=ir(e||t?.area);if(!n)return null;let o=Qn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function $s(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function sm(e=b()){let t=String(e??"default");if(ku.has(t))return ku.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${i0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),ku.set(t,n),n}function am(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),ku.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${i0}:${n}`,JSON.stringify(e))}catch{}}function Uu(e=b()){let t=String(e??"default");if(Tu.has(t))return Tu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${s0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Tu.set(t,n),n}function Du(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Tu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${s0}:${n}`,JSON.stringify(e))}catch{}}function mm(e=b()){let t=String(e??"default");if(Au.has(t))return Au.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${a0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Au.set(t,n),n}function hm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Au.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${a0}:${n}`,JSON.stringify(e))}catch{}}function lm(e,t,n=b()){let o=Ws(e,t);if(!o)return;let r=El(e,t),i=mm(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],hm(i,n))}function l0(e,t,n=b()){let o=Ws(e,t);if(!o)return!1;let r=El(e,t),i=mm(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],hm(i,n),!0):!1}function xi(e,t,n=b()){let o=Ws(e,t);if(!o)return;let r=El(e,t),i=Uu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Du(i,n))}function gm(e,t,n=b()){let o=Ws(e,t);if(!o)return;let r=Uu(n);r.upgrades[o]&&(delete r.upgrades[o],Du(r,n));let i=sm(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},am(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&ar(e,s,n),eo()}function Pu(e,t,n=b()){let o=Ws(e,t);if(!o)return!1;let r=El(e,t),i=Uu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Du(i,n),!0):!1}function hn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=sr(t?.tie??t?.tieKey),o=e?.areaKey||ve.STARTER_COVE;if(!n||!jE.has(n))return{locked:!0,iconOverride:Nn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?kt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:c0()}catch{}function s(){if(u0())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===xe.UNLOCK_XP)return s();if(n===xe.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Nn,useLockedBase:!0};let a=!1;try{let u=vn();a=He(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}return{locked:!1}}if(n===xe.UNLOCK_INFUSE){if(!Nr())return{locked:!0,iconOverride:Nn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Jn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=vn();a=He(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}return{locked:!1}}if(n===xe.UNLOCK_SURGE){if(!$t())return{locked:!0,iconOverride:Nn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Jn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=vn();a=He(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}return{locked:!1}}if(pm.has(n)){if($t()||Pu(o,t)){try{xi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=vn();a=He(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:Nn,useLockedBase:!0,titleOverride:Jn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{lm(o,t)}catch{}return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:u,reason:u}}if(Nr()||Pu(o,t)){try{xi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Nn,useLockedBase:!0};if(l0(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:rn,descOverride:a,reason:a}}let l=!1;try{let a=vn();l=He(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Nn,useLockedBase:!0,titleOverride:Jn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{lm(o,t)}catch{}return{locked:!0,iconOverride:yn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function ir(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function sr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function tx(e,t){let n=sr(t?.tie??t?.tieKey);if(n&&ZE.has(n))return!0;let o=Qn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=ir(l);if(a&&JE.has(`${a}:${i}`))return!0}return!1}function c0(){try{return!!fn()}catch{return!1}}function u0(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${QE}:${t}`)==="1"}catch{return!1}}function vn(){try{let e=typeof ot=="function"?ot():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function Nu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function em(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function Qn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function dt(e){try{if(e=Gs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Ce(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=Ne(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function He(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=Ne(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=Ne(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function nx(e,t){let n=dt(e),o=dt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(Ne(n))+1,i=Math.floor(Ne(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function f0(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function zs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Bu(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:zs(e.numUpgEvolutions)}function ym(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=He(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/qt));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=h0(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:Ne(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:f0(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,gn(i,r)}function d0(e){let t=zs(e),n=qt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Fr(o),capFmtText:Xs(o)}}function p0(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(Ne(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=He(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(qt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=He(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}}function rx(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function vm(e,t=Ou){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=ir(t||e?.area||Ou);return KE[n]||o0}function It(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function $u(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=d0(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Vo(e,t,n=Ou){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=vm(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=p0(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=rx(u.multiplier??u.mult??u.value??1,f),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=It(i,d):p==="coin"||p==="coins"?s=It(s,d):p==="mp"?l=It(l,d):r=It(r,d)}let a=Bu(e);if(a>0){let u=VE*a,f=Ce(u);r=It(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function m0(e,t,n=Ou){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=vm(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=p0(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt(qt)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny(qt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+qt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(qt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function h0(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=ox[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Ks(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=h0(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=f0(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=Ne(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),y=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(p)===0&&d.cmp(y)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function gn(e,t){let n=Ks(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Ce(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Ce(n.baseLog10+o*n.ratioLog10).floorToInteger()}function ix(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function or(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Ks(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Cu+t*o.ratioLn)/Cu;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Cu+t*o.ratioLn,i=o.ratioLn*n,s=ix(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Cu}function Ru(e,t,n){if(!(n>0))return c.fromInt(0);let o=Ks(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=or(e,t,l);a=a.add(Ce(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=or(e,t,n);return Ce(i)}function y0(e){if(!(e>0)||!Number.isFinite(e))return e;if(nm[0]=e,nm[0]<=0)return 0;sx[0]-=1n;let t=nm[0];return t>0?t:0}function ax(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=y0(e);return n<e?n:e>1?e/2:0}function Mu(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function xl(e,t,n,o=Ys,r={}){let i=Ks(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(He(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:He(o),p=Number.isFinite(f)?Math.max(0,f-u):tm,y=Number.isFinite(d)?Math.max(0,Math.floor(d)):tm;if(y=Math.min(y,tm,p),!(y>0)){let Z=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:Z,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let Z=Math.min(y,m),$=c.fromAny(e.costAtLevel(u)),G=s,j=0;for(;j<Z;){$=c.fromAny(e.costAtLevel(u+j));let ge=G.add($);if(ge.cmp(n)>0)break;G=ge,j+=1}let W=u+j,re=Number.isFinite(f)&&W>=f,x=Mu(j);if(j<Z||re||y<=j){let ge=re?s:c.fromAny(e.costAtLevel(W));return{count:x,spent:G,nextPrice:ge,numericCount:j}}let z=(()=>{try{return rr(t??u,u).add(x)}catch{return u+j}})(),ue=xl(e,z,n.sub(G),y-j,r),me=ue?.count instanceof c?ue.count:Mu(ue?.numericCount??0),Q=x.add(me),se=(ue?.spent??s).add(G);return{count:Q,spent:se,nextPrice:ue?.nextPrice??s,numericCount:j+(ue?.numericCount??0)}}let g=Ne(n),h=i.ratioLog10,v=i.ratioMinus1,E=c.fromAny(e.costAtLevel(u)),C=i.baseLog10+u*h;if(v>0&&(!Number.isFinite(g)||Math.abs(g)>1e6&&Math.abs(C)>1e6)){let Z=c.fromAny(e.costAtLevel(u));if(n.cmp(Z)<0)return{count:s,spent:s,nextPrice:Z,numericCount:0};let $=Number.isFinite(y)?Math.max(1,Math.floor(y)):Number.MAX_VALUE,G=1,j=1;for(;j<$;){let me=or(e,u,j);if(Ce(me).cmp(n)<=0){let se=j*2;if(!Number.isFinite(se)||se<=j){j=$;break}G=j,j=Math.min(se,$)}else break}let W=0;for(;G<j&&W<256;){let me=Math.max(G+1,Math.floor((G+j+1)/2)),Q=or(e,u,me);Ce(Q).cmp(n)<=0?G=me:j=me-1,W++}let re=Math.max(1,G),x=Mu(re),z=s,ue=s;if(!a)if(z=Ru(e,u,re),Number.isFinite(f)){let me=Math.max(0,Math.floor(f-Math.min(u,f)));re>=me?ue=s:ue=Ce(C+re*h)}else ue=Ce(C+re*h);return{count:x,spent:z,nextPrice:ue,numericCount:re}}if(n.cmp(E)<0)return{count:s,spent:s,nextPrice:E,numericCount:0};let N=!1,V=null,B=null;try{V=c.fromAny(e.costAtLevel(u+1))}catch{}try{let Z=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);B=c.fromAny(e.costAtLevel(Z))}catch{}!N&&!(i.ratioMinus1>0)&&(N=!0),V&&B&&(N=V.cmp(E)===0&&B.cmp(E)===0),!N&&!(i.ratioMinus1>0)&&(N=!0);let q=Number.isFinite(y)?Math.max(0,Math.floor(y)):Number.MAX_VALUE;if(N){let Z=rr(e.lvlCapBn??"Infinity","Infinity"),$=rr(t??0,0),G=Z.isInfinite?.()?c.fromAny("Infinity"):Z.sub($).floorToInteger(),{count:j,countBn:W,spent:re,nextPrice:x}=cm(E,n,G);return{count:W,spent:re,nextPrice:x,numericCount:j}}if(!(h>0)||!(v>0)){let Z=rr(e.lvlCapBn??"Infinity","Infinity"),$=rr(t??0,0),G=Z.isInfinite?.()?c.fromAny("Infinity"):Z.sub($).floorToInteger(),{count:j,countBn:W,spent:re,nextPrice:x}=cm(E,n,G);return{count:W,spent:re,nextPrice:x,numericCount:j}}let _=Math.log10(v);if(!Number.isFinite(_))return{count:s,spent:s,nextPrice:E,numericCount:0};let M=bf(g+_-C)/h;(!Number.isFinite(M)||M<0)&&(M=0);let L=Math.floor(Math.min(q,M));Number.isFinite(L)||(L=q),L<=0&&(L=1);let H=1e-7,J=or(e,u,L),ae=0,pe=2048;for(;L>0&&(!Number.isFinite(J)||J>g+H)&&ae<pe;){let Z=Number.isFinite(J)?Math.max(1,Math.ceil((J-g)/Math.max(h,1e-12))):Math.max(1,Math.floor(L/2)),$=Math.max(0,Math.floor(L-Z));if($<L)L=$;else{let G=y0(L);if(!(G<L))break;L=G}J=L>0?or(e,u,L):Number.NEGATIVE_INFINITY,ae+=1}if(L<=0||!Number.isFinite(L))if(n.cmp(E)>=0)L=1,J=Ne(E);else return{count:s,spent:s,nextPrice:E,numericCount:0};if(L<q){let Z=x=>{let z=x*2;return Number.isFinite(z)?z:Number.MAX_VALUE},$=L,G=Math.min(q,Math.max(L+1,Z(L))),j=or(e,u,G);for(;$<G&&Number.isFinite(j)&&j<=g+H&&G<q;)$=G,G=Math.min(q,Z(G)),j=or(e,u,G);let W=$,re=G;for(let x=0;x<256&&W<re;x+=1){let z=Math.floor((W+re+1)/2),ue=or(e,u,z);Number.isFinite(ue)&&ue<=g+H?(W=z,J=ue):re=z-1}L=W}let ye=null;if(!a){ye=Ru(e,u,L);let Z=0;for(;ye.cmp(n)>0&&L>0&&Z<pe;){let $=ax(L);if(!($<L))break;L=$,ye=Ru(e,u,L),Z+=1}if(L<=0)return{count:s,spent:s,nextPrice:E,numericCount:0};if(L<q&&Z<pe)for(;L<q&&Z<pe;){let $=u+L,G;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)G=c.fromAny(e.costAtLevel($));else{let W=C+L*h;G=Ce(W).floorToInteger()}}catch{break}let j=ye.add(G);if(j.cmp(n)>0)break;ye=j,L+=1,Z+=1}}let Me=s,ie=!a&&Number.isFinite(u)&&Number.isFinite(L)&&u<Number.MAX_SAFE_INTEGER/2&&L<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let Z=Math.max(0,Math.floor(f-Math.min(u,f)));if(L>=Z)Me=s;else if(ie){let $=Math.floor(u+L);Me=c.fromAny(e.costAtLevel($))}else{let $=C+L*h;Me=Ce($)}}else if(ie){let Z=Math.floor(u+L);Me=c.fromAny(e.costAtLevel(Z))}else{let Z=C+L*h;Me=Ce(Z)}return{count:Mu(L),spent:ye,nextPrice:Me,numericCount:L}}function lx(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=Ne(t),r=Ne(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function cm(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let p=e.mulBigNumInteger(d);return{count:um(d),countBn:d,spent:p,nextPrice:e}}let i=Ne(t),s=Ne(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Ce(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:um(l),countBn:l,spent:a,nextPrice:u}}function cx(e,t,n,o){if(!n||o<=0)return{count:0};let r=Ne(t),i=Ne(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let g=0;g<64&&a<u;g+=1){let h=Math.max(0,Math.floor((a+u+1)/2));i+h*n.ratioLog-n.logDenom<=r?a=h:u=h-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let p=i+f*n.ratioLog,y=Ce(d),m=Ce(p);return{count:f,spent:y,nextPrice:m,spentLog:d,nextPriceLog:p}}function rr(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function um(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Fr(e){return ne(e instanceof c?e:c.fromAny(e??0))}function Xs(e){return Fr(e).replace(/<[^>]*>/g,"")}function Fu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Vs(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=Fu(n??t??0),s=Fu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:He(i),newLevel:Number.isFinite(o)?o:He(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Bt(e,t){return gn(e,t)}function v0(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Li(e,t,n=b()){if(n==null)return null;let o=ir(e),r=bm(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function ux(){e0.forEach(e=>{try{e?.()}catch{}}),e0.clear()}function t0(e){ux()}function fx(e,t){if(typeof localStorage>"u")return;let n=v0(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=Li(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}})}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function dx(e,t,n){fx(e,n);let o=Li(e,t,n);if(!o)return null;if(qs&&Il.has(o))try{let r=Il.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Br.has(o))try{let r=Br.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function Hs(e,t,n,o=b(),r={}){let i=Li(e,t,o);if(i){if(qs){Il.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Br.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Br.has(i)&&Br.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{at(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function px(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&Hs(e,o.id,o,n)})}function bm(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return Qn(t.id);let n=Qn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=sr(n);if(o){let r=rm.get(o);if(r){let i=ir(e);if(!i||ir(r.area)===i)return Qn(r.id)}}}return n}function b0(e,t,n=b()){let o=n==null?"null":String(n),r=bm(e,t);return`${o}:${e}:${Qn(r)}`}function yo(e,t){let n=bm(e,t),o=Qn(n),r=b(),i=b0(e,o,r),s=fm.get(i);if(s)return s;let l=js(e,o),a=dx(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,Hs(e,o,a,r)}let f=a.lvl,d=a.nextCost,p=a.nextCostLvl;a.lvl=Gs(a.lvl),a.nextCost=Gs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Gs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==p)&&(u=!0);let y=0;l?.upgType==="HM"&&(y=zs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),$u(l,y));let m=dt(a.lvl),g=He(m);try{let A=l?.lvlCapBn??c.fromAny("Infinity");if(!A.isInfinite?.()&&m.cmp(A)>0){let N=A.clone?.()??A;g=He(N);let V=N.toStorage();a.lvl=V,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=V,Hs(e,o,a,r)}}catch{}let h=null;try{h=m?.toStorage?.()??dt(g).toStorage()}catch{}h&&a.lvl!==h&&(a.lvl=h,u=!0);let v=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,E=!v||v!==h,C=null;if(!E&&a.nextCost!=null)try{C=c.fromAny(a.nextCost)}catch{C=null,E=!0}if(!C||E){if(l)try{C=c.fromAny(l.costAtLevel(g))}catch{C=c.fromInt(0)}else C=c.fromInt(0);try{a.nextCost=C.toStorage(),h?a.nextCostLvl=h:delete a.nextCostLvl,u=!0}catch{}}if(u)try{Hs(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let A=c.fromAny("Infinity");l.lvlCapBn=A,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Fr(A),l.lvlCapFmtText=Xs(A)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:g,lvlBn:m,nextCostBn:C,slot:r,hmEvolutions:y},fm.set(i,s),s}function Ur(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=Qn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??dt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=He(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??dt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=dt(e.lvl??0).toStorage()}i.lvl=Gs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Gs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=zs(e.hmEvolutions)),Hs(n,r,i,o,t),e.slot=o}function ar(e,t,n=b()){fm.delete(b0(e,t,n))}function kt(e,t){return yo(e,t).lvl}function dm(e,t){return yo(e,t).hmEvolutions??0}function S0(e,t){if(!t)return{locked:!1};let n=c0(),o=n?vn():c.fromInt(0),r=n?He(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=tx(e,t),d="Unlock the XP system to reveal this upgrade",p=u0();if(f)if(p)i={locked:!0,iconOverride:yn,titleOverride:rn,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let y='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Nn,titleOverride:Jn,descOverride:y,reason:y,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Nn,titleOverride:Jn,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=em({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,surgeLevel:zn(),baseLocked:s.locked,getUpgradeLevel(p){return kt(e,p)}},d=t.computeLockState(f);s=em(s,d)}catch{}let l=b(),a=Ws(e,t),u=a?Pu(e,t,l):!1;if(a){let f=sm(l),d=Uu(l),p=mm(l),y=a.replace(/_/g,"-"),m=El(e,t),g=!1;$s(f,y,a)&&(g=!0),m&&$s(f,m,a)&&(g=!0),g&&am(f,l);let h=!1;$s(d,y,a)&&(h=!0),m&&$s(d,m,a)&&(h=!0),h&&Du(d,l);let v=!1;$s(p,y,a)&&(v=!0),m&&$s(p,m,a)&&(v=!0),v&&hm(p,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=Nn),f?s.titleOverride||(s.titleOverride=rn):(!s.titleOverride||s.titleOverride===rn)&&(s.titleOverride=Jn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Nn||s.iconOverride===yn)&&delete s.iconOverride,(s.titleOverride===rn||s.titleOverride===Jn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Nn),a){let f=sm(l),d=f.upgrades[a]||{},p=sr(t?.tie??t?.tieKey),y=p&&r0.has(p),m=p&&pm.has(p),g=d.status||"locked";if(Pu(e,t,l))g="unlocked";else if(l0(e,t,l)&&g==="locked"){let _=!1;try{_=He(vn())>=31}catch{}let U=!1;try{U=He(vn())>=101}catch{}y&&!_||m&&!U?g="locked":g="mysterious"}let h=_u(g),v=Qp(s),E=_u(v),C=()=>{s.locked=!0;let _=d.snapshot;_&&typeof _=="object"&&(s=em(s,_)),s.iconOverride=yn,s.titleOverride=rn;let U=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=U,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};h>E&&(g==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):g==="mysterious"&&C(),v=Qp(s),E=_u(v));let A=!1,N=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",V=y,B=!1;try{B=He(vn())>=31}catch{}let q=!1;try{q=He(vn())>=101}catch{}if((V&&!B&&N==="mysterious"||m&&!q&&N==="mysterious")&&(N="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==N)&&(f.upgrades[a]={status:N},A=!0),E>h){if(d.status=v,f.upgrades[a]={status:d.status},A=!0,g=v,h=E,v==="unlocked")xi(e,t,l);else if(v==="mysterious"){let _=!1;try{_=He(vn())>=31}catch{}(!y||_)&&lm(e,t,l)}}g==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Nn||s.iconOverride===yn)&&delete s.iconOverride,(s.titleOverride===rn||s.titleOverride===Jn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},A=!0),xi(e,t,l)):g==="mysterious"&&v!=="mysterious"&&(C(),v=Qp(s),E=_u(v)),A&&am(f,l)}return s}function Ll(e,t){return!!S0(e,t).locked}function Sm(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Bu(e),{capBn:r,cap:i}=d0(o);try{return t?.cmp?.(r)>=0}catch{}let s=He(t);return Number.isFinite(s)&&s>=i}function xn(e,t){let n=yo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():dt(n.lvl??0)}function I0(e,t){let n=yo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??dt(n.lvl??0),i=He(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function nr(e,t,n,o=!0,r={}){let i=yo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,$u(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=Fu(i.lvlBn??dt(i.lvl??0)),d=dt(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let p=d;try{s&&n0(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=dt(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=dt(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let y=He(p);if(!s)return i.lvl=y,i.lvlBn=p,i.nextCostBn=c.fromInt(0),Ur(i),ar(e,t),eo(),i.lvl;i.lvl=y,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(y))}catch{i.nextCostBn=c.fromInt(0)}return Ur(i,{deferSave:r?.deferSave}),ar(e,t),Vs(s,u,f,i.lvl,i.lvlBn),eo(),i.lvl}function Pt(e){return qu.filter(t=>t.area===e)}function js(e,t){let n=ir(e),o=Qn(t),r=sr(typeof o=="string"?o:t);return qu.find(i=>n&&ir(i.area)!==n?!1:!!(Qn(i.id)===o||r&&i.tieKey===r))||null}function ko(e,t){let n=typeof t=="object"&&t?t:js(e,t);return S0(e,n)}function mx(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function tu(e){return e?mx(e.icon):""}function hx(e,t){let n=js(e,t),o=xn(e,t),r=He(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Ts(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Ll(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??dt(r),s=Fu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(n0(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=He(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Ur(n),ar(e,t),eo(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?O[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let y=f.value;if((y instanceof c?y:c.fromAny(y??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=He(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),Ur(n),ar(e,t),Vs(o,r,s,n.lvl,n.lvlBn),eo(),{bought:1,spent:d}}function eu(e,t){let n=yo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??dt(n.lvl);if(!Sm(o,r,n.hmEvolutions))return{evolved:!1};let i=zs(n.hmEvolutions)+1;n.hmEvolutions=i,$u(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Ur(n),ar(e,t),Vs(o,n.lvl,r,n.lvl,r),eo(),{evolved:!0}}function il(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ll(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??dt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=O[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Ts(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let v=i.clone?.()??dt(i),E=He(v),C=v.toStorage?.(),A;if(o.upgType==="HM"){if(A=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let V=c.fromAny("Infinity");o.lvlCapBn=V,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Fr(V),o.lvlCapFmtText=Xs(V)}}else{let V=o.lvlCapBn?.clone?.()??rr(o.lvlCap??1/0,1/0);A=V?.clone?.()??V}let N=A.sub(v);if(N.isZero?.()){let V=nx(A,v);V.isZero?.()||(N=V)}if(N.isZero?.()){let V=A.toStorage?.();if(C&&V&&C!==V)if(A.isInfinite?.())try{N=c.fromAny("Infinity")}catch{N=c.fromInt(1)}else N=c.fromInt(1)}return n.lvlBn=A.clone?.()??A,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=He(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),O[o.costType].set(u),Ur(n),ar(e,t),Vs(o,E,v,n.lvl,n.lvlBn),eo(),{bought:N,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):Ys;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=xl(o,i,u,d),y=p.count instanceof c?p.count:c.fromAny(p.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),g=u.sub(m);O[o.costType].set(g);let h=i.add(y);return n.lvlBn=h,n.lvl=He(h),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Ur(n),ar(e,t),Vs(o,r,i,n.lvl,n.lvlBn),eo(),{bought:y,spent:m}}function As(e,t,n){let o=yo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Ll(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??dt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=O[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?He(n):void 0,y=Number.isFinite(d)?Number.isFinite(p)?Math.min(d,p):d:p,m=xl(r,s,f,y),g=m.count instanceof c?m.count:c.fromAny(m.count??0);if(g.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let h=m.spent??c.fromInt(0),v=f.sub(h);O[r.costType].set(v);let E=s.add(g);return o.lvlBn=E,o.lvl=He(E),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Ur(o),ar(e,t),Vs(r,i,s,o.lvl,o.lvlBn),eo(),{bought:g,spent:h}}function vi(e,t,n,o=Ys,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=xl(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function eo(){if(qs){om=!0,hd();return}hd(),Ec()}function Kn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),ve.STARTER_COVE}function Ns(e,t){let n=js(e,t);if(!n)return null;let o=xn(e,t),r=He(o),i=Fr(o),s=Xs(o),l=n.lvlCapBn??rr(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Fr(l),u=n.lvlCapFmtText??Xs(l),f=r<n.lvlCap?I0(e,t):c.fromInt(0),d=Fr(f),p=O[n.costType]?.value,y=p instanceof c?p:c.fromAny(p??0),m=ko(e,t),g=!!m.locked,h=m.titleOverride??n.title,v=m.descOverride??n.desc;if(e===Ze&&Qn(t)===ti){let N=Mc();if(Math.abs(N-1)>1e-4&&v){let V=Fe(N);v=v.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+V+" Coins on an interval")}}let E=vm(n,e),C="";typeof n.effectSummary=="function"&&!(g&&m.hideEffect)&&(C=n.effectSummary(r),typeof C=="string"&&(C=C.trim()));let A=m.iconOverride??tu(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:y,haveFmt:O[n.costType]?.fmt(y)??String(y),effect:C,iconUrl:A,lockState:m,locked:g,areaKey:e,hmMilestones:E,displayTitle:h,displayDesc:v,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?dm(e,t):0,hmReadyToEvolve:n.upgType==="HM"?Sm(n,o,dm(e,t)):!1,hmNextMilestone:n.upgType==="HM"?m0(n,o,e):null}}function gx(e,t){let n=js(e,t);if(!n||n.upgType!=="HM")return null;let o=xn(e,t);return m0(n,o,e)}function yx(e){return Ce(Ne(e??0))}function Ed(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0};let r=v0(e,n.slot);if(Wt(r))return{bought:0};let i=Li(e,t,n.slot);if(Wt(i))return{bought:0};if(Ll(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??dt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&Sm(o,l,n.hmEvolutions))return{bought:0};let f=O[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let p=xl(o,l,d,Ys),y=p.count instanceof c?p.count:c.fromAny(p.count??0);if(y.isZero?.())return{bought:0};let m=l.add(y);return YE(),nr(e,t,m,!0,{deferSave:!0}),{bought:y}}function sl(e,t){let n=yo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ll(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??dt(n.lvl),i=He(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=O[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=vi(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=y=>{if(y<=0)return!0;let m=Ru(o,i,y-1),g=a.sub(m),h=i+y-1,v=c.fromAny(o.costAtLevel(h)),E=g.div(10);return v.cmp(E)<=0},p=0;if(f<2e3){let y=u.spent,m=f;for(;m>0;){let g=i+m-1,h=c.fromAny(o.costAtLevel(g)),v=y.sub(h),C=a.sub(v).div(10);if(h.cmp(C)<=0){p=m;break}y=v,m--}}else{let y=0,m=f;for(;y<m;){let g=Math.ceil((y+m)/2);d(g)?y=g:m=g-1}p=y}return p<=0?{bought:0,spent:c.fromInt(0)}:As(e,t,p)}var Ys,qt,yk,VE,Ou,ve,qs,Jv,Il,om,Br,Qv,zE,Jp,xe,o0,KE,Nn,yn,rn,Jn,r0,pm,jE,ZE,JE,QE,i0,s0,a0,ex,ku,Tu,Au,rm,vk,im,Lu,Kt,Cu,ox,tm,g0,nm,sx,qu,fm,e0,ao=De(()=>{St();Et();Yt();Vn();_o();Lo();co();ni();ds();ep();yd();Ys=c.fromAny("Infinity"),qt=1e3,yk=c.fromInt(1e3),VE=3,Ou="",ve={STARTER_COVE:"starter_cove",AUTOMATION:Ze,DNA:nn},qs=!1,Jv=new Map,Il=new Map,om=!1,Br=new Map,Qv=null;zE=308;Jp=1024;xe={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},o0=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],KE={[ve.STARTER_COVE]:o0},Nn="img/misc/locked.webp",yn="img/misc/mysterious.webp",rn="Hidden Upgrade",Jn="Locked Upgrade",r0=new Set([xe.COIN_VALUE_II,xe.XP_VALUE_II,xe.MP_VALUE_I,xe.MAGNET,xe.ENDLESS_XP]),pm=new Set([xe.COIN_VALUE_III,xe.XP_VALUE_III,xe.MP_VALUE_II,xe.FASTER_COINS_III,xe.ENDLESS_MP]),jE=new Set([xe.UNLOCK_XP,xe.UNLOCK_FORGE,xe.UNLOCK_INFUSE,xe.UNLOCK_SURGE,...r0,...pm]),ZE=new Set([xe.FASTER_COINS_II,xe.COIN_VALUE_I,xe.BOOK_VALUE_I,xe.XP_VALUE_I]),JE=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),QE="ccc:merchantMet",i0="ccc:shop:reveals",s0="ccc:shop:permaUnlocks",a0="ccc:shop:permaMyst",ex={locked:0,mysterious:1,unlocked:2},ku=new Map,Tu=new Map,Au=new Map,rm=new Map,vk=sr(xe.BOOK_VALUE_I),im=c,Lu=e=>im.fromAny(e??0),Kt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Lu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return im.fromInt(1).add(r.mulDecimal(n))}catch{let i=Ne(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Ce(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Lu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return im.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Lu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Lu(i);if(o>0){let l=Ne(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return Ce(u)}}catch{}try{let l=He(s),a=o*l;return Ce(a)}catch{return c.fromInt(1)}}}};Cu=Math.log(10);ox={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Bu(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Bu(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};tm=(()=>{try{let e=He(Ys);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),g0=new ArrayBuffer(8),nm=new Float64Array(g0),sx=new BigInt64Array(g0);qu=[{area:ve.STARTER_COVE,id:1,tie:xe.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(.1)},{area:ve.STARTER_COVE,id:2,tie:xe.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{jr()}catch{}}},{area:ve.STARTER_COVE,id:3,tie:xe.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(.1)},{area:ve.STARTER_COVE,id:4,tie:xe.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(.5),onLevelChange(){try{Qt()}catch{}}},{area:ve.STARTER_COVE,id:5,tie:xe.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>Nu(e)>0?2:1,onLevelChange({newLevel:e}){Ga(e)}},{area:ve.STARTER_COVE,id:6,tie:xe.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addFlatPerLevel(2)},{area:ve.STARTER_COVE,id:7,tie:xe.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,onLevelChange({newLevel:e}){if((e??0)>=1)try{zp()}catch{}}},{area:ve.STARTER_COVE,id:8,tie:xe.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${ne(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(10),onLevelChange(){try{Qt()}catch{}}},{area:ve.STARTER_COVE,id:9,tie:xe.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(1)},{area:ve.STARTER_COVE,id:10,tie:xe.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(1)},{area:ve.STARTER_COVE,id:11,tie:xe.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=Nu(e),n=Fe(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>Nu(e)},{area:ve.STARTER_COVE,id:12,tie:xe.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:qt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState:hn,effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Vo(this,t,this.area),r=It(n,o);return`XP value bonus: ${Fe(r)}x`},effectMultiplier:Kt.powPerLevel(1.1)},{area:ve.STARTER_COVE,id:13,tie:xe.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Kp()}catch{}}},{area:ve.STARTER_COVE,id:14,tie:xe.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${ne(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(1e3)},{area:ve.STARTER_COVE,id:15,tie:xe.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(1)},{area:ve.STARTER_COVE,id:16,tie:xe.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(1)},{area:ve.STARTER_COVE,id:17,tie:xe.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:hn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Fe(t)}x`},effectMultiplier:Kt.addPctPerLevel(1)},{area:ve.STARTER_COVE,id:18,tie:xe.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:qt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState:hn,effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Vo(this,t,this.area),r=It(n,o);return`MP value bonus: ${Fe(r)}x`},effectMultiplier:Kt.powPerLevel(1.1)},{area:ve.STARTER_COVE,id:19,tie:xe.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:hn,onLevelChange({newLevel:e}){if((e??0)>=1)try{jp()}catch{}}},{area:ve.STARTER_COVE,id:20,tie:xe.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState(e){let t=zn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=vn();o=He(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jn,descOverride:"Locked"}},onLevelChange(){try{Qt()}catch{}},effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Vo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Fe(r)}x`},effectMultiplier:Kt.powPerLevel(1.1)},{area:ve.STARTER_COVE,id:21,tie:xe.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState(e){let t=zn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=vn();o=He(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jn,descOverride:"Locked"}},onLevelChange(){try{Qt()}catch{}},effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Vo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Fe(r)}x`},effectMultiplier:Kt.powPerLevel(1.1)},{area:ve.STARTER_COVE,id:22,tie:xe.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return gn(this,e)},nextCostAfter(e,t){return gn(this,t)},computeLockState(e){let t=zn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=vn();o=He(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:yn,titleOverride:rn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jn,descOverride:"Locked"}},onLevelChange(){try{Qt()}catch{}},effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Vo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Fe(r)}x`},effectMultiplier:Kt.powPerLevel(1.1)},...mg,...Ny];for(let e of qu){let t=sr(e.tie??e.tieKey);t&&!rm.has(t)&&rm.set(t,e),e.baseCost=rr(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return gn(this,n)},e.nextCostAfter=function(n,o){return gn(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=Kt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=dt(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Vo(this,o,this.area),s=It(r,i);if(typeof this.bonusLine=="function")return this.bonusLine(n,s);let l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Fe(s)}x`})),e.numUpgEvolutions=zs(e.numUpgEvolutions),e.upgType==="HM"?$u(e,e.numUpgEvolutions):(e.lvlCapBn=rr(e.lvlCap??1/0,1/0),e.lvlCap=um(e.lvlCapBn),e.lvlCapFmtHtml=Fr(e.lvlCapBn),e.lvlCapFmtText=Xs(e.lvlCapBn)),e.bulkMeta=lx(e),Ks(e)}fm=new Map;e0=new Map;typeof window<"u"&&(t0(b()),window.addEventListener("saveSlot:change",()=>{t0(b()),eo()}),window.addEventListener("surge:level:change",()=>{eo()}));Lg()});var K0={};vt(K0,{applyAllCurrencyOverridesForActiveSlot:()=>Ol,applyStatMultiplierOverride:()=>Yn,getDebugCurrencyMultiplierOverride:()=>Ml,getDebugStatMultiplierOverride:()=>Rx,setDebugCurrencyMultiplierOverride:()=>D0,setDebugPanelAccess:()=>mL,setDebugStatMultiplierOverride:()=>On});function Rl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function wx(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function bn(e){typeof e=="function"&&xm.push(e)}function Ku(){return{sections:new Set,subsections:new Set}}function Ex(){let e=document.getElementById(Tl);if(!e)return Ku();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function xx(e){let{sections:t,subsections:n}=T0??Ku();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function R0(){xm.forEach(e=>{try{e?.()}catch{}}),xm=[],km.length=0}function Dt(e){!e||typeof e.refresh!="function"||km.push(e)}function ut(e){km.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function Lx(){if(typeof window>"u")return;let e=y=>{let{key:m,slot:g}=y?.detail??{},h=g??b();ut(v=>v.type==="currency"&&v.key===m&&v.slot===h)};window.addEventListener("currency:change",e,{passive:!0}),bn(()=>window.removeEventListener("currency:change",e));let t=y=>{let{key:m,slot:g}=y?.detail??{},h=g??b();ut(v=>v.type==="currency-mult"&&v.key===m&&v.slot===h)};window.addEventListener("currency:multiplier",t,{passive:!0}),bn(()=>window.removeEventListener("currency:multiplier",t));let n=y=>{let{slot:m,changeType:g,unlocked:h}=y?.detail??{},v=m??b();ut(E=>E.type==="xp"&&E.slot===v),ut(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===v),(g==="unlock"||typeof h=="boolean")&&ut(E=>E.type==="unlock"&&(E.slot==null||E.slot===v))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),bn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=y=>{let{changeType:m,slot:g}=y?.detail??{},h=g??b();ut(v=>v.type==="mutation"&&v.slot===h),ut(v=>v.type==="stat-mult"&&v.key==="mutation"&&v.slot===h),m==="unlock"&&ut(v=>v.type==="unlock"&&(v.slot==null||v.slot===h))};window.addEventListener("mutation:change",o,{passive:!0}),bn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let y=b();ut(m=>m.type==="upgrade"&&m.slot===y),ut(m=>m.type==="currency-mult"&&m.slot===y),ut(m=>m.type==="stat-mult"&&m.slot===y)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),bn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let y=b();ut(m=>m.slot===y)};window.addEventListener("saveSlot:change",i,{passive:!0}),bn(()=>window.removeEventListener("saveSlot:change",i));let s=y=>{let{slot:m,key:g}=y?.detail??{},h=m??b();ut(v=>v.type==="unlock"&&(v.slot==null||v.slot===h)&&(v.key==null||v.key===g))};window.addEventListener("unlock:change",s,{passive:!0}),bn(()=>window.removeEventListener("unlock:change",s));let l=y=>{let{slot:m}=y?.detail??{},g=m??b();ut(h=>h.type==="workshop-level"&&h.slot===g)};window.addEventListener("workshop:change",l,{passive:!0}),bn(()=>window.removeEventListener("workshop:change",l));let a=y=>{let{slot:m}=y?.detail??{},g=m??b();ut(h=>h.type==="surge-level"&&h.slot===g)};window.addEventListener("surge:level:change",a,{passive:!0}),bn(()=>window.removeEventListener("surge:level:change",a));let u=y=>{let{slot:m}=y?.detail??{},g=m??b();ut(h=>h.type==="tsunami-nerf"&&(h.slot==null||h.slot===g))};window.addEventListener("surge:nerf:change",u,{passive:!0}),bn(()=>window.removeEventListener("surge:nerf:change",u));let f=y=>{let{slot:m}=y?.detail??{},g=m??b();ut(h=>h.type==="lab-level"&&(h.slot==null||h.slot===g)),ut(h=>h.type==="stat-mult"&&h.key==="rp"&&(h.slot==null||h.slot===g))};window.addEventListener("lab:level:change",f,{passive:!0}),bn(()=>window.removeEventListener("lab:level:change",f));let d=y=>{let{id:m,level:g}=y?.detail??{},h=b();ut(v=>v.type==="lab-node-level"&&v.slot===h&&v.id===m),m===1&&ut(v=>v.type==="tsunami-nerf"&&(v.slot==null||v.slot===h)),m===4&&ut(v=>v.type==="unlock"&&(v.slot==null||v.slot===h))};window.addEventListener("lab:node:change",d,{passive:!0}),bn(()=>window.removeEventListener("lab:node:change",d));let p=y=>{let{id:m,rp:g}=y?.detail??{},h=b();ut(v=>v.type==="lab-node-rp"&&v.slot===h&&v.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),bn(()=>window.removeEventListener("lab:node:rp",p))}function ju(){return[{key:ve.STARTER_COVE,title:"The Cove",currencies:[{key:Te.COINS,label:"Coins"},{key:Te.BOOKS,label:"Books"},{key:Te.GOLD,label:"Gold"},{key:Te.MAGIC,label:"Magic"},{key:Te.GEARS,label:"Gears"},{key:Te.WAVES,label:"Waves"},{key:Te.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function O0(){if(document.getElementById(Gu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Gu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Gu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Gu,document.head.appendChild(n)}function _m(){let e=document.getElementById(k0);e&&e.remove()}function _x(){return Ti&&je&&b()!=null&&!Rl()&&wx()}function Cx(e){e?.detail?.visible&&Oo(),Qu()}function Xu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${A0++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Rn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${N0++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Tt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Tm(e,t=b()){let n=t??b();return n==null?null:`${bt.CURRENCY[e]}:${n}`}function Cl(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=O?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Ia(n,e)}catch{return c.fromInt(0)}}function Mx(e,t,n=b()){let o=n??b(),r=Cl(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=Tm(e,o),s=i&&vo(i);s&&ta(i);let l=r;try{In(o),l=Gi(e,t,{previous:r})??r,i&&at(i)}catch{}finally{s&&Ri(i)}return ut(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function to(e,t){return`${e??"null"}::${t}`}function Am(e,t){return Al.get(to(e,t))??null}function kx(e,t=b()){let n=t??b();return!e||n==null?null:`${bt.MULTIPLIER[e]}:${n}`}function Tx(e,t=b()){let n=to(t,e);Al.delete(n),Qs.delete(n),ut(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function Nm(e,t){let n=!Zu(t,e),o=to(e,t),r=kl.get(o);if(!n&&r)return r;let i=Ax(t,e);return i?(kl.set(o,i),i):(n&&kl.delete(o),null)}function P0(e,t){ut(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function B0(e,t=b()){let n=Ni(e,t);if(kl.delete(to(t,e)),_i.delete(to(t,e)),!(!n||typeof localStorage>"u")&&!vo(n)){try{localStorage.removeItem(n)}catch{}P0(e,t)}}function Zu(e,t=b()){return vo(Ni(e,t))}function F0(e,t){return Zu(t,e)?Nm(e,t):null}function Pn(e,t=b()){let n=Ai(e);return Ju(e,t,n)??n}function Ni(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${vx}:${e}:${n}`}function Ai(e){try{if(e==="xp"){let t=fc();if(t)return t}else if(e==="mutation"){let t=tf?.();if(t)return t;let n=ef();if(n)return n}else if(e==="spawnRate"){let t=us(ve.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return Rc()}catch{}return c.fromInt(1)}function Ax(e,t=b()){let n=Ni(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function Nx(e,t,n){let o=Ni(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=vo(o),s=i&&Js?Js:localStorage.setItem.bind(localStorage);i&&!Js&&ta(o),s(o,r.toStorage?.()??String(r)),i&&!Js&&Ri(o)}catch{}}function Rm(e,t=b()){if(t==null)return;let n=Am(t,e);if(!n||t!==b())return;let o=to(t,e);if(!Yu.has(o)){Yu.add(o);try{let r=O?.[e]?.mult?.get?.();Tt(r,n)||O?.[e]?.mult?.set?.(n)}catch{}finally{Yu.delete(o)}}}function U0(){if(!(L0||typeof window>"u")){L0=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=to(r,t);if(!r||!Al.has(i)||Yu.has(i))return;let s=Qs.get(i),l=Am(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,p=l.mulBigNumInteger(f);Al.set(i,p)}}catch{}Qs.set(i,o)}else o&&Qs.set(i,o);Rm(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Ol()},{passive:!0})}catch{}}}function Ol(){let e=b();e!=null&&Object.values(Te).forEach(t=>{Rm(t,e)})}function D0(e,t,n=b()){if(!e||n==null)return null;U0();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=to(n,e);if(Al.set(r,o),!Qs.has(r)){let i=O?.[e]?.mult?.get?.();Qs.set(r,i)}return Rm(e,n),o}function Ml(e,t=b()){return!e||t==null?null:Am(t,e)}function On(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return kl.set(to(n,e),o),_i.set(to(n,e),Ai(e)),Nx(e,n,o),P0(e,n),o}function Rx(e,t=b()){return!e||t==null?null:Nm(t,e)}function Yn(e,t,n=b()){let o=Ai(e),r=Ju(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Tt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=to(n,e),l=_i.get(s),a=Zu(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function Ju(e,t,n){let o=Nm(t,e),r=to(t,e);if(!o)return _i.delete(r),null;let i=_i.get(r),s=Zu(e,t);if(!i)_i.set(r,n);else if(!Tt(i,n))return s?(_i.set(r,n),o):(B0(e,t),null);return o}function Ox(){if(!(E0||typeof localStorage>"u")){E0=!0;try{Js=localStorage.setItem.bind(localStorage),x0=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ea.has(e))return Js(e,t)},localStorage.removeItem=e=>{if(!ea.has(e))return x0(e)}}catch{}}}function vo(e){return e!=null&&ea.has(e)}function Ri(e){e&&(Ox(),ea.add(e))}function ta(e){e&&ea.delete(e)}function Px(e){return e?vo(e)?(ta(e),!1):(Ri(e),!0):!1}function Bx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=vo(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(Px(e),typeof t=="function")try{t(vo(e))}catch{}o()}),o(),{button:n,refresh:o}}function Fx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>vo(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>vo(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?ta(u):Ri(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function Ux(){let e=document.getElementById(Tl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function Dx(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{vo(r)&&(o.push(r),ta(r))});try{return t?.()}finally{o.forEach(r=>Ri(r))}}function $x(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function Om(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Cm(e,t){e.classList.toggle("debug-invalid",!t)}function Qe(){let e=b();try{In(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function $0(e=b()){return e==null?null:`${bx}:${e}`}function q0(e=b()){let t=$0(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function G0(e,t=b()){let n=$0(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,Lm);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function qx(e,t=b()){let n=q0(t);return n.unshift(e),n.length>Lm&&(n.length=Lm),G0(n,t),n}function et(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};qx(o,t),Pm()}function Pm(){if(!Zs)return;let e=q0();if(e.length===0){Zs.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",Zs.appendChild(t);return}Zs.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function H0(e=b()){return e==null?null:`${tl}:${e}`}function X0(e,t=b()){let n=H0(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function V0(e=b()){let t=H0(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function Gx(e){if(e){if(Object.values(Te).includes(e.type)){try{e.type===Te.BOOKS?O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount):O[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function Hx(){let e=b();if(e==null)return{completed:0};let t=V0(e),n=0;return Object.entries(Xc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,Gx(r.reward))}),X0(t,e),{completed:n}}function Xx(){let e=b();if(e==null)return{restored:0};let t=V0(e),n=0;return Object.entries(Xc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),X0(t,e),{restored:n}}function sn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let h=document.createElement("span");h.className="debug-panel-id",h.textContent=`(ID: ${o})`,a.appendChild(h)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,p=!1,y=r?Bx(r,{onToggle:i}):null,m=h=>{if(f){d=h;return}d=null,u.value=typeof s=="function"?s(h):$x(h)};l.appendChild(u),y&&l.appendChild(y.button);let g=()=>{let h=Om(u.value);if(!h){Cm(u,!1);return}Cm(u,!0);let v=r&&vo(r);v&&ta(r);try{n(h,{input:u,setValue:m})}finally{v&&Ri(r),y&&y.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",g),u.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),p=!0,g(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,p||g(),p=!1,d!=null){let h=d;d=null,m(h)}}),m(t),y&&y.refresh(),{row:l,input:u,setValue:m,isEditing:()=>f}}function Vx({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let g=document.createElement("span");g.className="debug-unlock-desc",g.textContent=`- ${t}`,f.appendChild(g)}s.appendChild(l),s.appendChild(f);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",g=>{l.contains(g.target)||p()});let y=!1,m=()=>{let g=!1;try{g=typeof n=="function"?!!n():!1}catch{}return a.checked=g,y=g,g};return a.addEventListener("change",()=>{let g=y,h=a.checked;try{h?o?.():r?.()}catch{}Qe();let v=m();g!==v&&et(`Toggled ${e} [GOLD]${g?"True":"False"}[/GOLD] \u2192 [GOLD]${v?"True":"False"}[/GOLD]`)}),m(),Dt({type:"unlock",slot:i,refresh:m}),s}function Yx(e){try{if(e instanceof c||typeof e?.toScientific=="function")return ne(e);let t=Number(e);return Number.isFinite(t)?ne(t):String(e??"\u2014")}catch{return"\u2014"}}function Wx({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:p})=>{if(d.type==="select"){u[d.key]=p.value;return}let y=Om(p.value),m=y instanceof c;if(Cm(p,m),!m){f=!0;return}u[d.key]=y}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=Yx(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:p,label:y})=>{let m=document.createElement("option");m.value=p,m.textContent=y??p,f.defaultValue!=null&&f.defaultValue===p&&(m.selected=!0),d.appendChild(m)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function Dr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return ot()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{jr()}catch{}let f=Ci.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(at(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),p=Ci.level(n);localStorage.setItem(p,d),at(p,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),p=Ci.progress(n);localStorage.setItem(p,d),at(p,d)}catch{}try{ji({forceReload:!0})}catch{}try{cc({changeType:"debug-panel",slot:n})}catch{}try{ut()}catch{}}function $r({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return mt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Nl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{jt()}catch{}try{Pr()}catch{}let f=Mi.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(at(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),p=Mi.level(n);localStorage.setItem(p,d),at(p,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),p=Mi.progress(n);localStorage.setItem(p,d),at(p,d)}catch{}try{jt({forceReload:!0})}catch{}try{Bm({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ut()}catch{}}function zx(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=Tm(r.key,n),s=Cl(r.key,n),l=sn(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=Cl(r.key,f),{next:p}=Mx(r.key,a,f);u(p),Tt(d,p)||(Qe(),et(`Modified ${r.label} (${o}) ${ne(d)} \u2192 ${ne(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(Cl(r.key,b()))});Dt({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=Cl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function Kx(e,t){let n=b();if(n==null){let B=document.createElement("div");B.className="debug-panel-empty",B.textContent="Select a save slot to edit stats.",e.appendChild(B);return}let o="spawnRate",r=Ni(o,n),i=sn("Coin Spawn Rate",Pn(o,n),(B,{setValue:q})=>{let _=b();if(_==null)return;let U=Pn(o,_);try{On(o,B,_)}catch{}let M=Pn(o,_);q(M),Tt(U,M)||(Qe(),et(`Modified Spawn Rate (${a}) ${ne(U)} \u2192 ${ne(M)}`))},{storageKey:r,onLockChange:B=>{let q=b();if(q!=null){if(B){if(F0(q,o))return;try{On(o,Ai(o),q)}catch{}}else Ju(o,q,Ai(o));i.setValue(Pn(o,q))}}});Dt({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let B=Pn(o,n);i.setValue(B)}}),Dt({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let B=Pn(o,n);i.setValue(B)}}),e.appendChild(i.row);let s=ot(),l=mt(),a=t?.title??t?.key??"Unknown Area",u=Ci.level(n),f=sn("XP Level",s.xpLevel,(B,{setValue:q})=>{let _=ot().xpLevel;Dr({level:B});let U=ot();q(U.xpLevel),Tt(_,U.xpLevel)||(Qe(),et(`Modified XP Level (${a}) ${ne(_)} \u2192 ${ne(U.xpLevel)}`))},{storageKey:u});Dt({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(ot().xpLevel)}}),e.appendChild(f.row);let d=Ci.progress(n),p=sn("XP Progress",s.progress,(B,{setValue:q})=>{let _=ot(),U=_?.xpLevel?.clone?.()??_?.xpLevel,M=_?.progress?.clone?.()??_?.progress;Dr({progress:B});let L=ot();q(L.progress),f.setValue(L.xpLevel),(!Tt(M,L.progress)||!Tt(U,L.xpLevel))&&(Qe(),et(`Modified XP Progress (${a}) ${ne(M)} \u2192 ${ne(L.progress)}`))},{storageKey:d});Dt({type:"xp",slot:n,refresh:()=>{n===b()&&p.setValue(ot().progress)}}),e.appendChild(p.row);let y=Mi.level(n),m=sn("MP Level",l.level,(B,{setValue:q})=>{let _=mt().level;$r({level:B});let U=mt();q(U.level),Tt(_,U.level)||(Qe(),et(`Modified MP Level (${a}) ${ne(_)} \u2192 ${ne(U.level)}`))},{storageKey:y});Dt({type:"mutation",slot:n,refresh:()=>{n===b()&&m.setValue(mt().level)}}),e.appendChild(m.row);let g=Mi.progress(n),h=sn("MP Progress",l.progress,(B,{setValue:q})=>{let _=mt(),U=_?.level?.clone?.()??_?.level,M=_?.progress?.clone?.()??_?.progress;$r({progress:B});let L=mt();q(L.progress),m.setValue(L.level),(!Tt(M,L.progress)||!Tt(U,L.level))&&(Qe(),et(`Modified MP Progress (${a}) ${ne(M)} \u2192 ${ne(L.progress)}`))},{storageKey:g});Dt({type:"mutation",slot:n,refresh:()=>{n===b()&&h.setValue(mt().progress)}}),e.appendChild(h.row);let v=ii(n);if(v){let B=0;try{let _=localStorage.getItem(v),U=c.fromAny(_||"0");if(U.isInfinite())B=1/0;else try{B=Number(U.toScientific(20))}catch{B=0}}catch{}let q=sn("Workshop Level",B,(_,{setValue:U})=>{let M=Number(_);if(_ instanceof c)if(_.isInfinite())M=1/0;else try{M=Number(_.toScientific(20))}catch{M=NaN}if(Number.isNaN(M)||M<0)return;let L=M===1/0?"Infinity":String(Math.floor(M));try{localStorage.setItem(v,L),Qe(),et(`Modified Workshop Level (The Cove) ${ne(B)} \u2192 ${L}`),B=M}catch{}U(M)},{storageKey:v,onLockChange:()=>{let _=0;try{let U=localStorage.getItem(v),M=c.fromAny(U||"0");M.isInfinite()?_=1/0:_=Number(M.toScientific(20))}catch{}q.setValue(_)}});e.appendChild(q.row),Dt({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let _=0;try{let U=localStorage.getItem(v),M=c.fromAny(U||"0");M.isInfinite()?_=1/0:_=Number(M.toScientific(20))}catch{}q.setValue(_)}})}let E=Us(n);if(E){let B=0;try{let _=localStorage.getItem(E);_==="Infinity"?B=1/0:B=c.fromAny(_||"0")}catch{B=c.fromInt(0)}let q=sn("Surge Level",B,(_,{setValue:U})=>{let M="0",L=0;_ instanceof c?_.isInfinite()?(M="Infinity",L=1/0):(M=_.toPlainIntegerString(),L=_):_===1/0||typeof _=="string"&&/infinity/i.test(_)?(M="Infinity",L=1/0):(M=String(_),L=_);try{localStorage.setItem(E,M),Qe();let H=L===1/0?"Infinity":ne(L),J=B===1/0||B instanceof c&&B.isInfinite()?"Infinity":ne(B);et(`Modified Surge Level (The Cove) ${J} \u2192 ${H}`),L===1/0?B=1/0:L instanceof c?B=L:B=c.fromAny(L);let ae=!1;B===1/0?ae=!0:B instanceof c?typeof B.cmp=="function"&&B.cmp(8)>=0&&(ae=!0):typeof B=="number"&&B>=8&&(ae=!0),ae&&(mi(0),dn()||zo(!0))}catch{}U(L);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let H=B;if(H!==1/0&&H instanceof c)try{H=BigInt(H.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:H}}))}catch{}},{storageKey:E,onLockChange:_=>{let U=c.fromInt(0);try{let M=localStorage.getItem(E);M==="Infinity"?U=1/0:U=c.fromAny(M||"0")}catch{}q.setValue(U)}});Dt({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let _=c.fromInt(0);try{let U=localStorage.getItem(E);U==="Infinity"?_=1/0:_=c.fromAny(U||"0")}catch{}q.setValue(_)}}),e.appendChild(q.row)}let C=zt(),A=sn("Lab Level",C,(B,{setValue:q})=>{let _;try{_=B instanceof c?B:c.fromAny(B),_.isNegative&&_.isNegative()&&(_=c.fromInt(0))}catch{q(zt());return}let U=zt();di(_),Qe(),Tt(U,_)||et(`Modified Lab Level (The Cove) ${ne(U)} \u2192 ${ne(_)}`),q(_)},{storageKey:Td(n)});Dt({type:"lab-level",slot:n,refresh:()=>{n===b()&&A.setValue(zt())}}),e.appendChild(A.row);let N=()=>{let B=Ln(),q=Co(),_=B+q;return _>1&&(_=1),_},V=sn("Tsunami Exponent",N().toFixed(2),(B,{setValue:q})=>{let _=Number(B);if(B instanceof c?B.isInfinite()?_=1/0:_=Number(B.toScientific(10)):typeof B=="string"&&/infinity/i.test(B)&&(_=1/0),Number.isNaN(_)){q(N().toFixed(2));return}let U=Co(),M=_-U;M>1&&(M=1),M<0&&(M=0),M=Math.round(M*100)/100;let L=Ln();mi(M),Qe(),Math.abs(L-M)>1e-4&&et(`Modified Tsunami Exponent (The Cove) Base:${L.toFixed(2)} \u2192 ${M.toFixed(2)} (Effective: ${_.toFixed(2)})`),q(N().toFixed(2))},{storageKey:Md(n),format:B=>{let q=Number(B);return Number.isFinite(q)?q.toFixed(2):String(B)}});Dt({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let B=N();V.setValue(B.toFixed(2))}}),e.appendChild(V.row)}function Em(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Pt(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=xn(t.key,i.id??i.tie),u=Li(t.key,i.id??i.tie,n),f=sn(l,a,(d,{setValue:p})=>{if(b()==null)return;let m=xn(t.key,i.id??i.tie);try{nr(t.key,i.id??i.tie,d,!1)}catch{}let g=xn(t.key,i.id??i.tie);p(g),Tt(m,g)||(Qe(),et(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${ne(m)} \u2192 Lv${ne(g)}`))},{idLabel:s,storageKey:u});Dt({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=xn(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function jx(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=O?.[r.key]?.mult,l=Ml(r.key,n)??i?.get?.()??c.fromInt(1),a=`${bt.MULTIPLIER[r.key]}:${n}`,u=sn(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let p=b();if(p==null)return;let y=Ml(r.key,p)??i?.get?.()??c.fromInt(1);try{D0(r.key,f,p)}catch{}Ol();let g=Ml(r.key,p)??i?.get?.()??c.fromInt(1);d(g),Tt(y,g)||(Qe(),et(`Modified ${r.label} Multiplier (${o}) ${ne(y)} \u2192 ${ne(g)}`))},{storageKey:a});Dt({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=Ml(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function Zx(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Te).forEach(o=>{let r=O?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Tt(i,t))return;r.set(t),n+=1}catch{}}),n}function Jx(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Te).forEach(o=>{let r=O?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function Qx(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=ot()}catch{}try{r=mt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Tt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Tt(o?.progress,t);(!i||!s)&&(Dr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Tt(r?.level,t),s=r?.progress?.isInfinite?.()||Tt(r?.progress,t);(!i||!s)&&($r({level:t,progress:t}),n+=1)}}catch{}try{let i=ii(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Us(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ut()}catch{}return n}function eL(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=ot()}catch{}try{r=mt()}catch{}try{o?.unlocked&&(Dr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&($r({level:t,progress:t}),n+=1)}catch{}try{let i=ii(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Us(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ut()}catch{}return n}function Y0(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!ot()?.unlocked}catch{return!1}},onEnable:()=>{try{jr()}catch{}try{ji({forceReload:!0})}catch{}},onDisable:()=>{try{Zi({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Nl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{Nl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return ip()}catch{return!1}},onEnable:()=>{try{bi()}catch{}},onDisable:()=>{try{ru()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return sp()}catch{return!1}},onEnable:()=>{try{ou()}catch{}},onDisable:()=>{try{iu()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return jd()}catch{return!1}},onEnable:()=>{try{Gc(!0)}catch{}},onDisable:()=>{try{Gc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!dn()}catch{return!1}},onEnable:()=>{try{zo(!0)}catch{}},onDisable:()=>{try{zo(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return pt(4)>=1}catch{return!1}},onEnable:()=>{try{Ir(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{Ir(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function W0(e){let t=b();if(t==null)return 0;let n=0;Y0(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{ut()}catch{}return n}function tL(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;ju().forEach(o=>{Pt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{xi(o.key,r,e),t+=1}catch{}})});try{bi()}catch{}try{ou()}catch{}let n=W0(!0);return{unlocks:t,toggles:n}}function nL(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;ju().forEach(o=>{Pt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{gm(o.key,r,e),t+=1}catch{}})});try{ru()}catch{}try{iu()}catch{}let n=W0(!1);return{locks:t,toggles:n}}function oL(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(Tm(a,n)),r(kx(a,n))},s=a=>r(Ni(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(Ci.level(n)),r(Ci.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(Mi.level(n)),r(Mi.progress(n)))};return e==="all"?(Object.values(Te).forEach(i),l("xp"),l("mutation"),zu.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Te).forEach(i),Array.from(o)):e==="allUnlockedStats"?(ot()?.unlocked&&l("xp"),mt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Te).forEach(i),ot()?.unlocked&&l("xp"),mt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function Vu(e){try{O?.[e]?.set?.(c.fromInt(0))}catch{}try{Tx(e)}catch{}try{ec(e,c.fromInt(1))}catch{}}function rL(e){if(e==="all"){Object.values(Te).forEach(i=>Vu(i));let o=c.fromInt(0);return Dr({level:o,progress:o}),$r({level:o,progress:o}),zu.forEach(({key:i})=>{try{On(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Te).length+zu.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Te).forEach(i=>{Vu(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(ot()?.unlocked){Dr({level:o,progress:o});try{On("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(mt()?.unlocked){$r({level:o,progress:o});try{On("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Te).forEach(l=>{Vu(l),o+=1});let r=c.fromInt(0),i=0;try{if(ot()?.unlocked){Dr({level:r,progress:r});try{On("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(mt()?.unlocked){$r({level:r,progress:r});try{On("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return Vu(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{B0(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Dr({level:n,progress:n});try{On("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){$r({level:n,progress:n});try{On("mutation",c.fromInt(1))}catch{}return"MP"}try{On(t,c.fromInt(1))}catch{}return`stat ${t}`}function iL(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";zu.forEach(r=>{if(r.key==="spawnRate")return;let i=Ni(r.key,n),s=sn(`${r.label} Multiplier`,Pn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Pn(r.key,u);try{On(r.key,l,u)}catch{}let d=Pn(r.key,u);a(d),Tt(f,d)||(Qe(),et(`Modified ${r.label} Multiplier (${o}) ${ne(f)} \u2192 ${ne(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if(F0(a,r.key))return;try{On(r.key,Ai(r.key),a)}catch{}}else Ju(r.key,a,Ai(r.key));s.setValue(Pn(r.key,a))}}});Dt({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Pn(r.key,n);s.setValue(l)}}),Dt({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Pn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Dt({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Pn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function sL(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Ut||Ut.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Ut.forEach(n=>{let o=Rn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=Ya(t,n.id),s=sn("Level",pt(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let p=pt(n.id);Ir(n.id,d),Qe(),p!==d&&et(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${d}`),f(d)},{storageKey:i});Dt({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(pt(n.id))}}),r.appendChild(s.row);let l=Wa(t,n.id),a=sn("Current RP",fo(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(fo(n.id));return}let p=fo(n.id);ms(n.id,d),Qe(),Tt(p,d)||et(`Modified Node ${n.id} RP (The Cove) ${ne(p)} \u2192 ${ne(d)}`),f(d)},{storageKey:l});Dt({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(fo(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function aL(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)},{label:"Pending DNA (Experiment)",inputs:[{key:"labLevel",label:"Lab Level"},{key:"xpLevel",label:"XP Level"},{key:"isSurge9",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 9? No"},{value:"Yes",label:"Surge 9? Yes"}]}],compute:({labLevel:n,xpLevel:o,isSurge9:r})=>window.resetSystem?.computePendingDnaFromInputs?.(n,o,r==="Yes")}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>uc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Kf(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Fm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Fs(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>br(n)},{label:"Lab Level RP Boost",inputs:[{key:"level",label:"Lab Level"}],compute:({level:n})=>{let o=0;if(n instanceof c){if(n.isInfinite())return c.fromAny("Infinity");try{o=Number(n.toScientific(10))}catch{o=0}}else o=Number(n);if(!Number.isFinite(o))return c.fromInt(1);let r=o*Math.log10(2);return Ce(r)}}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>ym(n,o,r)}]}].forEach(n=>{let o=Rn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=Wx({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function lL(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Ol(),ju().forEach(o=>{let r=Rn(o.title,i=>{let s=Rn("Currencies",m=>{zx(m,o)}),l=Rn("Stats",m=>{Kx(m,o)}),a=Rn("Multipliers",m=>{let g=Rn("Currencies",v=>{jx(v,o)}),h=Rn("Stats",v=>{iL(v,o)});m.appendChild(g),m.appendChild(h)}),u=Rn("Upgrades",m=>{Em(m,o)}),f=null,d=null,p=null;o.key===ve.STARTER_COVE&&(f=Rn("Automation Upgrades",m=>{Em(m,{key:ve.AUTOMATION,title:"Automation"})}),d=Rn("DNA Upgrades",m=>{Em(m,{key:ve.DNA,title:"DNA"})}),p=Rn("Lab Nodes",m=>{sL(m)}));let y=Rn("Calculators",m=>{aL(m)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),p&&i.appendChild(p),i.appendChild(y)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function _0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(ve),r=[];return o.forEach(i=>{Pt(i).forEach(l=>{e&&ko(i,l.id).locked||r.push({areaKey:i,upg:l})})}),wl(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;nr(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function C0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(ve),r=[];o.forEach(s=>{Pt(s).forEach(a=>{e&&ko(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{wl(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Sr(s,l.id,"0"),nr(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function M0(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Pt(Ze);wl(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;nr(Ze,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(rs),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(ve).forEach(l=>{if(l===Ze)return;Pt(l).forEach(u=>{s.has(u.costType)&&(Sr(l,u.id,n),o++)})}),Sr(Ze,io,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function cL(e){e.innerHTML="";let t=b();if(t==null){let h=document.createElement("div");h.className="debug-panel-empty",h.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(h);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:h}=Hx();Qe(),et(`Completed all dialogues (${h} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:h}=Xx();Qe(),et(`Restored dialogues to unclaimed state (${h} ${h===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let h=Zx();Qe(),et(`Set all currencies to Infinity (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let h=Qx();Qe(),et(`Set all stats to Infinity (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let h=Jx();Qe(),et(`Set all currencies to 0 (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let h=eL();Qe(),et(`Set all unlocked stats to 0 (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let h=_0(!0);Qe(),et(`Maxed ${h} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let h=C0(!0);Qe(),et(`Reset ${h} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let h=_0(!1);Qe(),et(`Maxed all ${h} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let h=C0(!1);Qe(),et(`Reset all ${h} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let h=M0(!0);Qe(),et(`Enabled automation for ${h} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let h=M0(!1);Qe(),et(`Disabled automation for ${h} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:h,toggles:v}=tL();Qe(),et(`Unlocked all unlock-type upgrades (${h} entries) and unlock flags (${v} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:h,toggles:v}=nL();Qe(),et(`Locked all unlock-type upgrades (${h} entries) and unlock flags (${v} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{G0([],t),Pm(),Qe(),et("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let h=b();if(h!=null)try{localStorage.setItem(Sx(h),String(Ix)),jo(!0),Qe(),et("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let h=window.prompt("Enter amount of seconds to warp:");if(h==null)return;let v=Om(h);if(!v||typeof v.isZero=="function"&&v.isZero()||typeof v.isNegative=="function"&&v.isNegative())return;let E,C=!1;$t()?E=Is(v):(E=Pc(v),C=!0),gi(E);let A=v.mulSmall?v.mulSmall(1e3):v.mulBigNumInteger(c.fromInt(1e3));Cr(E,A,C),Qe(),et(`Performed OP Time Warp for ${ne(v)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(h=>{let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle debug-misc-button",v.textContent=h.label,v.addEventListener("click",h.onClick),o.appendChild(v)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",ju().forEach(h=>{let v=document.createElement("optgroup");v.label=h.title||h.key,h.currencies.forEach(E=>{let C=document.createElement("option");C.value=`currency:${E.key}`,C.textContent=`${h.title||h.key} \u2192 ${E.label}`,v.appendChild(C)}),h.stats.forEach(E=>{let C=document.createElement("option");C.value=`stat:${E.key}`,C.textContent=`${h.title||h.key} \u2192 ${E.label}`,v.appendChild(C)}),s.appendChild(v)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${Hu}"]`)||(Hu=_l),s.value=Hu;let d=()=>oL(s.value||_l,b()),p=Fx(d);s.addEventListener("change",()=>{Hu=s.value||_l,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle reset-check",y.textContent="\u2705",y.addEventListener("click",()=>{let h=s.value||_l,v=d(),E=p.isLocked(),C=(A=!0)=>{let N=Dx(v,()=>rL(h))??{label:h,count:0};if(E&&v.forEach(V=>Ri(V)),p.refresh(),Qe(),A){let{label:V,count:B}=N;et(`Reset ${B===1?"value and multiplier":"values and multipliers"} for ${V} to defaults.`)}};C(!0),setTimeout(()=>C(!1),100)}),r.appendChild(y),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let g=document.createElement("button");g.type="button",g.className="debug-panel-toggle debug-danger-button",g.textContent="Wipe Slot & Refresh",g.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let v=document.querySelector(".menu-root"),E=document.getElementById("game-root");v&&(v.hidden=!1,v.style.display="",v.style.visibility=""),E&&(E.hidden=!0,E.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(g),e.appendChild(m)}function uL(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{ji()}catch{}let n=Y0(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(Vx(o))})}function z0(){if(!Ti||Rl())return;R0(),O0(),A0=0,N0=0;let e=document.getElementById(Tl);e&&e.remove();let t=document.createElement("div");t.id=Tl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Oo({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Oo()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let p=document.createElement("div");p.className="debug-panel-info-line",d&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=f,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(Xu("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{lL(f)})),t.appendChild(Xu("Unlocks: modify specific unlock flags","debug-unlocks",f=>{uL(f)})),t.appendChild(Xu("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),Zs=d,Pm(),bn(()=>{Zs=null})})),t.appendChild(Xu("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{cL(f)})),xx(t),document.body.appendChild(t),Wu>0)try{t.scrollTop=Wu}catch{}Lx(),ki=!0}function Mm(){if(!(!Ti||Rl())){if(b()==null){Oo();return}ki||z0()}}function Oo({preserveExpansionState:e=!1}={}){T0=e?Ex():Ku();let t=document.getElementById(Tl);if(t){try{Wu=t.scrollTop??0}catch{Wu=0}t.remove()}R0(),ki=!1}function fL(){if(!Ti||Rl()||b()==null){Oo();return}ki?Oo({preserveExpansionState:!0}):Mm()}function dL(){Oo(),_m()}function Qu(){if(!_x()){_m(),Oo();return}O0(),_m();let e=document.createElement("button");e.id=k0,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{fL()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function pL(e){if(Ti=!!e,!Ti){dL();return}Qu()}function mL(e){pL(e)}var Gu,Tl,k0,_l,ki,Ti,xm,T0,Wu,Hu,A0,N0,km,Zs,Al,Qs,Yu,kl,_i,ea,E0,Js,x0,vx,bx,Lm,Sx,Ix,Im,Ci,wm,Mi,zu,L0,Qi=De(()=>{Et();Yt();St();Vn();_o();lo();ao();su();Wc();ls();Lo();co();ds();ni();Dd();pi();fi();Bc();Gu="debug-panel-style",Tl="debug-panel",k0="debug-panel-toggle",_l=`currency:${Te.COINS}`,ki=!1,Ti=!1,xm=[],T0=Ku(),Wu=0,Hu=_l,A0=0,N0=0,km=[],Zs=null,Al=new Map,Qs=new Map,Yu=new Set,kl=new Map,_i=new Map,ea=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=ea);E0=!1,Js=null,x0=null,vx="ccc:debug:stat-mult",bx="ccc:actionLog",Lm=100,Sx=e=>`ccc:warp:charges:${e}`,Ix=24;Im="ccc:xp",Ci={unlock:e=>`${Im}:unlocked:${e}`,level:e=>`${Im}:level:${e}`,progress:e=>`${Im}:progress:${e}`},wm="ccc:mutation",Mi={unlock:e=>`${wm}:unlocked:${e}`,level:e=>`${wm}:level:${e}`,progress:e=>`${wm}:progress:${e}`},zu=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];L0=!1;Ol();U0();document.addEventListener("keydown",e=>{if(!(!Ti||Rl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){ki?(Ux(),Oo()):Mm(),e.preventDefault();return}ki?Oo({preserveExpansionState:!0}):Mm(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Qu()});window.addEventListener("menu:visibilitychange",Cx);window.addEventListener("saveSlot:change",()=>{Qu(),ki&&z0()})});var Q0={};vt(Q0,{addExternalMutationGainMultiplierProvider:()=>li,addMutationPower:()=>Es,broadcastMutationChange:()=>Bm,computeMutationMultiplierForLevel:()=>Fs,computeMutationRequirementForLevel:()=>Fm,getMutationCoinSprite:()=>Zp,getMutationGainMultiplier:()=>tf,getMutationMultiplier:()=>ef,getMutationState:()=>mt,getTotalCumulativeMp:()=>Sl,initMutationSystem:()=>jt,isMutationUnlocked:()=>Ao,onMutationChange:()=>Ei,setMutationUnlockedForDebug:()=>Nl,unlockMutationSystem:()=>Pr});function nf(e){try{return e?.toStorage?.()}catch{return null}}function Fi(){try{Qt()}catch{}}function J0(e){let t=e;if(!t.isZero?.()){let n=Bi.size>0?Array.from(Bi):typeof Fl=="function"?[Fl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:F.level.clone?.()??F.level,mutationUnlocked:F.unlocked});r instanceof Je?t=r.clone?.()??r:r!=null&&(t=Je.fromAny(r))}catch{}}return t}function yL(){if(typeof Um=="function"){try{Um()}catch{}Um=null}if(typeof Dm=="function"){try{Dm()}catch{}Dm=null}}function Ul(e){if(e instanceof Je)try{return e.clone?.()??Je.fromAny(e)}catch{return gt()}try{return Je.fromAny(e??0)}catch{return gt()}}function vL(e){if(!e||typeof e!="object")return gt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?Je.fromInt(100):Je.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function rf(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ne(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Ym(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(f+=gL*(p-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=rf(e);if(!Number.isFinite(n))return Je.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return Je.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return Je.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return Je.fromAny("Infinity");let i=Ce(r);return vL(i)}function qr(){let e=F.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");F.requirement=o.clone?.()??o,F.progress=o.clone?.()??o}catch{(!F.requirement||typeof F.requirement!="object")&&(F.requirement=c.fromInt(0)),(!F.progress||typeof F.progress!="object")&&(F.progress=c.fromInt(0))}return}let n=Ym(F.level);F.requirement=n}function bL(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=Ne(e),l=Ne(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Hm(){return Bn.container&&Bn.container.isConnected?!0:(Bn.container=document.querySelector("[data-mp-hud].mp-counter"),Bn.container?(Bn.bar=Bn.container.querySelector(".mp-bar"),Bn.fill=Bn.container.querySelector(".mp-bar__fill"),Bn.levelValue=Bn.container.querySelector(".mp-level-value"),Bn.progress=Bn.container.querySelector("[data-mp-progress]"),!0):!1)}function Oi(e){try{return ne(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function lr(){if(!Hm())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Bn;if(!e)return;if(!F.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Oi(F.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Oi(F.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Yi();return}e.removeAttribute("hidden");let i=F.requirement,s=bL(F.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Oi(F.level)),r){let a=Oi(F.progress),u=Oi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Oi(F.progress).replace(/<[^>]*>/g,""),u=Oi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Yi()}function cr(e="update",t={}){let n=mt(),o={...n,slot:F.slot??b(),changeType:e,...t};if(Gm.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function Wm(){let e=F.slot;if(e==null&&(e=b(),e!=null&&(F.slot=e)),e==null)return;try{localStorage.setItem(Pl(e),F.unlocked?"1":"0")}catch{}try{localStorage.setItem(Pi(e),F.level.toStorage())}catch{}try{localStorage.setItem(na(e),F.progress.toStorage())}catch{}at(Pl(e)),at(Pi(e)),at(na(e));let t=(()=>{let u=F.unlocked,f=F.level,d=F.progress;try{u=localStorage.getItem(Pl(e))==="1"}catch{}try{let p=localStorage.getItem(Pi(e));p&&(f=Je.fromAny(p))}catch{}try{let p=localStorage.getItem(na(e));p&&(d=Je.fromAny(p))}catch{}return{unlocked:u,level:f,progress:d}})(),n=nf(t.level),o=nf(t.progress),r=nf(F.level),i=nf(F.progress),s=t.unlocked!==F.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&of(t,{skipPersist:!0})}function Xm(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function SL(){if(!F.unlocked)return;let e=F.slot??b();if(e!=null&&Xm(Pi(e))){qr();return}qr();let t=F.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;F.progress.cmp?.(t)>=0&&n<o;){if(F.progress=F.progress.sub(t),F.level=F.level.add(oa()),qr(),t=F.requirement,!t||typeof t!="object"){F.progress=gt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(F.progress=gt())}function of(e,{skipPersist:t=!1}={}){F.unlocked=!!e.unlocked,F.level=Ul(e.level),F.progress=Ul(e.progress),F.unlocked||(F.level=gt(),F.progress=gt()),qr(),t||Wm(),lr(),cr("load"),Fi()}function $m(e){let t=e??b();if(t==null){of({unlocked:!1,level:gt(),progress:gt()},{skipPersist:!0}),F.slot=null;return}let n=!1,o=gt(),r=gt();try{n=localStorage.getItem(Pl(t))==="1"}catch{}try{let i=localStorage.getItem(Pi(t));i&&(o=Je.fromAny(i))}catch{}try{let i=localStorage.getItem(na(t));i&&(r=Je.fromAny(i))}catch{}of({unlocked:n,level:o,progress:r},{skipPersist:!0}),F.slot=t}function IL(){for(;Bl.length;){let e=Bl.pop();try{e?.()}catch{}}}function qm(e){j0!==e&&(IL(),j0=e,e!=null&&(Bl.push(Mt(Pl(e),{onChange(t){let n=t==="1";F.unlocked!==n&&(F.unlocked=n,n||(F.level=gt(),F.progress=gt()),qr(),lr(),cr("storage"),Fi())}})),Bl.push(Mt(Pi(e),{onChange(t){if(t)try{let n=Je.fromAny(t);F.level.cmp?.(n)!==0&&(F.level=n,qr(),lr(),cr("storage"),Fi())}catch{}}})),Bl.push(Mt(na(e),{onChange(t){if(t)try{let n=Je.fromAny(t);F.progress.cmp?.(n)!==0&&(F.progress=n,qr(),lr(),cr("storage"))}catch{}}}))))}function jt({forceReload:e=!1}={}){if(yL(),Z0){let n=b();return(n!==F.slot||e)&&$m(n),qm(n),Hm(),lr(),mt()}Z0=!0,Hm();let t=b();return F.slot=t,$m(t),qm(t),lr(),Fi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();F.slot=n,$m(n),qm(n),lr(),Fi(),cr("slot")}),mt()}function mt(){return{unlocked:F.unlocked,level:Ul(F.level),progress:Ul(F.progress),requirement:Ul(F.requirement)}}function Ao(){return!!F.unlocked}function Pr(){return jt(),F.unlocked?!1:(F.unlocked=!0,qr(),Wm(),lr(),cr("unlock"),Fi(),!0)}function Nl(e){jt();let t=!!e;of({unlocked:t,level:t?F.level:gt(),progress:t?F.progress:gt()})}function Es(e){jt();let t=F.slot??b();if(t!=null&&Xm(na(t))||!F.unlocked)return mt();let n=t!=null&&Xm(Pi(t));if(F.level&&F.level.isInfinite?.()){let f=F.level.clone?.()??F.level,d=F.progress.clone?.()??F.progress;if(!F.progress?.isInfinite?.())try{F.progress=Je.fromAny("Infinity")}catch{}if(!F.requirement?.isInfinite?.())try{F.requirement=Je.fromAny("Infinity")}catch{}let p;try{p=e instanceof Je?e:Je.fromAny(e??0)}catch{p=gt()}return p=J0(p),p=Yn("mutation",p),cr("progress",{delta:p.clone?.()??p,levelsGained:gt(),level:F.level.clone?.()??F.level,progress:F.progress.clone?.()??F.progress,requirement:F.requirement.clone?.()??F.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof Je?e:Je.fromAny(e??0)}catch{o=gt()}if(o=J0(o),o=Yn("mutation",o),o.isZero?.())return mt();let r=o.clone?.()??o,i=F.level.clone?.()??F.level,s=F.progress.clone?.()??F.progress;if(F.progress=F.progress.add(r),F.progress.isInfinite?.()){if(!n)try{F.level=Je.fromAny("Infinity")}catch{}try{F.progress=Je.fromAny("Infinity")}catch{F.progress=gt()}try{F.requirement=Je.fromAny("Infinity")}catch{}}else SL();Wm(),lr();let a=F.level.sub(i);return a.isZero?.()||Fi(),cr("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:F.level.clone?.()??F.level,progress:F.progress.clone?.()??F.progress,requirement:F.requirement.clone?.()??F.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Bm(e={}){jt();let t=e.changeType??"manual";return cr(t,e)}function Fs(e){let t;if(e instanceof Je)try{t=e.clone?.()??e}catch{t=gt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=gt()}else try{t=c.fromAny(e??0)}catch{t=gt()}if(t&&t.isInfinite?.())try{return Je.fromAny("Infinity")}catch{return oa()}let n=rf(t);if(!Number.isFinite(n))try{return Je.fromAny("Infinity")}catch{return oa()}if(n<=0)return oa();let o=n*hL;return Ce(o)}function Fm(e){let t;try{t=e instanceof Je?e:Je.fromAny(e??0)}catch{t=gt()}try{return Ym(t)}catch{return gt()}}function ef(){if(jt(),!F.unlocked)return oa();try{return Fs(F.level)}catch{return oa()}}function tf(){let e=c.fromInt(1);if(Bi.size>0||Fl){let t=Bi.size>0?Array.from(Bi):typeof Fl=="function"?[Fl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:F.level.clone?.()??F.level,mutationUnlocked:F.unlocked});o instanceof Je?e=o.clone?.()??o:o!=null&&(e=Je.fromAny(o))}catch{}}return e}function Zp(){if(!F.unlocked||F.level.isZero?.())return"img/currencies/coin/coin.webp";let e=rf(F.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function Ei(e){return typeof e!="function"?()=>{}:(Gm.add(e),()=>{Gm.delete(e)})}function li(e){return typeof e!="function"?()=>{}:(Bi.add(e),()=>{Bi.delete(e)})}function Sl(){if(jt(),!F.unlocked)return gt();if(F.level.isInfinite?.()||F.progress.isInfinite?.())return c.fromAny("Infinity");let e=rf(F.level);if(Number.isFinite(e)&&e>100)return F.progress.clone?.()??F.progress;let t=F.progress.clone?.()??F.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=Ym(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Vm,Pl,Pi,na,Je,gt,oa,hL,gL,F,Bn,Gm,Bl,j0,Z0,Um,Dm,Bi,Fl,_o=De(()=>{Et();St();Qi();Yt();Et();Uf();Vn();Vm="ccc:mutation",Pl=e=>`${Vm}:unlocked:${e}`,Pi=e=>`${Vm}:level:${e}`,na=e=>`${Vm}:progress:${e}`,Je=c,gt=()=>Je.fromInt(0),oa=()=>Je.fromInt(1),hL=Math.log10(2),gL=9/(Math.pow(1.12,50)-1);F={unlocked:!1,level:gt(),progress:gt(),requirement:gt(),slot:null},Bn={container:null,bar:null,fill:null,levelValue:null,progress:null},Gm=new Set,Bl=[],j0=null,Z0=!1,Um=null,Dm=null,Bi=new Set,Fl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:jt,unlockMutationSystem:Pr,addMutationPower:Es,getMutationState:mt,getMutationMultiplier:ef,isMutationUnlocked:Ao,getTotalCumulativeMp:Sl,addExternalMutationGainMultiplierProvider:li,getMutationGainMultiplier:tf}))});var Dl,eb,tb,zm,Km,jm,nb=De(()=>{Dl=`precision highp float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,eb=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\n\nvoid main() {\n    /* Wave animation settings */\n    float speed = 1.2;\n    float time = uTime * speed;\n    \n    /* Combine sine waves for a more natural look */\n    /* vUv.x is 0..1 across the screen width */\n    float wave1 = sin(vUv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n\n    /* Define the shoreline height (baseline) */\n    /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */\n    /* We want to discard pixels below this threshold */\n    float threshold = 0.428 + wave; \n\n    if (threshold > vUv.y) {\n        discard;\n    }\n\n    /* Recalculate gradient based on the new "bottom" */\n    /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */\n    float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0);\n    \n    vec3 col = mix(uColorShallow, uColorDeep, gradientY);\n    \n    /* Add a subtle "foam" or highlight at the edge */\n    float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold);\n    col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4);\n    \n    gl_FragColor = vec4(col, 1.0);\n}`,tb=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uWaveMap; \nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\nuniform vec3 uColorWaveDeep;  \nuniform vec3 uColorWave;      \n\n/* Simple noise for foam breakup */\nfloat hash(vec2 p) {\n    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\n}\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f*f*(3.0-2.0*f);\n    return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),\n               mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y);\n}\n\nvoid main() {\n    vec2 uv = vUv;\n    \n    /* Sample the simulation (physics) */\n    /* Wave Logic */\n    vec2 waveUV = uv - vec2(0.0, 0.0285);\n    float intensity = texture2D(uWaveMap, waveUV).r;\n    \n    /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */\n    float shadowOffset = 8.0 / uResolution.y; \n    float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r;\n    \n    /* Discard only if BOTH are empty */\n    if (0.01 > intensity && 0.01 > shadowIntensity) discard;\n    \n    /* Directional Noise: Streaky vertical noise for rushing water effect */\n    /* Stretch heavily along Y-axis to simulate speed/motion blur */\n    float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0));\n    \n    /* Define Zones based on Intensity */\n    /* Body (Medium Intensity): Darker/turbulent blue with noise */\n    /* Edge (High Intensity): Bright white foam */\n    \n    float foamThreshold = 0.5;\n    float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity);\n    \n    /* Base Colors */\n    vec3 bodyColor = uColorWaveDeep;\n    vec3 foamColor = uColorWave;\n    \n    /* Mix Colors */\n    vec3 finalColor = mix(bodyColor, foamColor, foamMix);\n    \n    /* Add streaks to the body part */\n    if (0.9 > foamMix) {\n        finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix);\n    }\n    \n    /* Hard Edge & Opacity */\n    /* Ensure the front (bottom) remains sharp, back trails off */\n    \n    /* Calculate Alpha based on Intensity */\n    /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */\n    /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */\n    /* Low Intensity (Top/Tail): Fades to 0.0 */\n    \n    float finalAlpha = smoothstep(0.02, 0.15, intensity);\n    \n    /* Screen Fade */\n    /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */\n    \n    /* Dynamic Shoreline Fade */\n    /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */\n    /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */\n    float speed = 1.2;\n    float time = uTime * speed;\n    float wave1 = sin(uv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n    float threshold = 0.428 + wave;\n    \n    /* Fade out quickly after exiting the water body (below threshold) */\n    /* Fade starts slightly higher than the threshold to soften the transition */\n    /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */\n    float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y);\n    \n    float screenFade = shoreFade;\n    \n    /* --- Composite Shadow & Wave --- */\n    float waveAlpha = finalAlpha * screenFade;\n    \n    /* Shadow Alpha */\n    float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity);\n    /* Shadow is weaker (40% opacity) */\n    float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade;\n    \n    /* Mix: Wave over Shadow */\n    /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */\n    float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha);\n    \n    /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */\n    /* Shadow is black (RGB=0), so second term is 0 */\n    vec3 outRGB = finalColor * waveAlpha; \n    \n    gl_FragColor = vec4(outRGB, outAlpha);\n}`,zm=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,Km=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,jm=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var ib={};vt(ib,{WaterSystem:()=>sf,waterSystem:()=>af});function rb(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function ra(e,t,n){let o=rb(e,e.VERTEX_SHADER,t),r=rb(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var wL,ob,EL,xL,sf,af,Zm=De(()=>{nb();wL=[.2,.5,.9],ob=[.2,.9,1],EL=[1,1,1],xL=[.45,.8,1];sf=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:ra(s,Dl,tb),simProgram:ra(s,Dl,jm),brushProgram:ra(s,zm,Km),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=ra(this.glBg,Dl,eb),this.bgSimProgram=ra(this.glBg,Dl,jm),this.bgBrushProgram=ra(this.glBg,zm,Km)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,p=a/this.height,y=new Float32Array([u-d,f-p,0,0,1,u+d,f-p,1,0,1,u-d,f+p,0,1,1,u+d,f+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,y,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),g=t.getAttribLocation(n,"aUv"),h=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let p=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=p.readFBO,f.writeFBO=p.writeFBO,f.readTexture=p.readTex,f.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),wL),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),ob),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),ob),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),EL),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),xL),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let p=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(p),d.vertexAttribPointer(p,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},af=new sf});var fb={};vt(fb,{createSpawner:()=>NL});function ub(e){if(!e||typeof e!="object"){ia=!1,Ui=0n;return}ia=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Ui=n&&n!=="Infinity"?BigInt(n):0n}catch{Ui=0n}}function _L(e){let t=1-e;return 1-t*t*t}function ML(e){if(!e)return null;let t=sb.get(e);return t||(t=new Image,t.src=e,sb.set(e,t)),t}function NL({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=je?LL:1e4,initialBurst:d=1,coinTtlMs:p=1e99,waveSoundSrc:y="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:g=.2,waveSoundMinIntervalMs:h=160,enableDropShadow:v=!1}={}){let E=o,C={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function A(){return!!(C.pf&&C.w&&C.c)}A()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let N=7,V=[],B=[],q=!1;if(C.c)for(let S=0;S<N;S++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+S*10}`,C.c.appendChild(k);let R=k.getContext("2d",{alpha:!0});V.push(k),B.push(R)}let _=null,U=null;C.c&&(_=document.createElement("canvas"),_.style.position="absolute",_.style.inset="0",_.style.pointerEvents="none",_.style.zIndex="100",C.c.appendChild(_),U=_.getContext("2d",{alpha:!0}));let M={collectBatch:null,getMagnetUnit:null};function L(S){M={...M,...S}}let H={pfRect:null,wRect:null,safeBottom:0,pfW:0};function J(){if(!A())return!1;let S=C.pf.getBoundingClientRect(),k=C.w.getBoundingClientRect(),R=C.hud?C.hud.getBoundingClientRect().height:0;H={pfRect:S,wRect:k,safeBottom:S.height-R,pfW:S.width};let T=window.devicePixelRatio||1;return V.forEach((P,fe)=>{if(P){P.width=S.width*T,P.height=S.height*T,P.style.width=S.width+"px",P.style.height=S.height+"px";let de=B[fe];de&&(de.setTransform(1,0,0,1,0,0),de.scale(T,T),de.imageSmoothingEnabled=!0,de.imageSmoothingQuality="high")}}),q=!0,_&&(_.width=S.width*T,_.height=S.height*T,_.style.width=S.width+"px",_.style.height=S.height+"px",U&&(U.setTransform(1,0,0,1,0,0),U.scale(T,T))),!0}J();let ae="ResizeObserver"in window?new ResizeObserver(()=>J()):null;ae&&C.pf&&ae.observe(C.pf),document.addEventListener("visibilitychange",()=>{document.hidden||J()});let pe=(S,k,R)=>Math.max(k,Math.min(R,S)),ye=Math.max(2e3,f*3),Me=12,ie=[],D=[],Z=0,$=[],G=[];function j(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=E,k.style.objectFit="contain",k.style.borderRadius="50%",S.appendChild(k),v&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let W=()=>ie.length?ie.pop():j();function re(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let k=0;k<=6;k++)S.classList.remove(`coin--size-${k}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),ie.length<ye&&ie.push(S)}function x(S,k=-1){if(S.isRemoved)return;S.isRemoved=!0;let R=k;(R===-1||D[R]!==S)&&(S.index!==void 0&&D[S.index]===S?R=S.index:R=D.indexOf(S)),R!==-1&&(D[R]=null,Z++),S.el?(re(S.el),S.el=null):G.push({layer:S.sizeIndex||0,x:S.x,y:S.y,size:S.size||r})}function z(S){let k=S._coinObj;if(k){let R=-1;k.index!==void 0&&D[k.index]===k?R=k.index:R=D.indexOf(k),R!==-1&&(D[R]=null,Z++),S._coinObj=null}}let ue=new URL(y,document.baseURI).href,me=0;function Q(){let S=performance.now();if(S-me<h)return;me=S,ht(ue,{volume:je?g:m,type:"music"})}function se(){if(!A())return null;if((!H.pfRect||!H.wRect)&&J(),f!==1/0&&D.length-Z>=f){let Lt=-1;if(ct(2))for(let Rt=0;Rt<D.length;Rt++){let So=D[Rt];if(So&&So.sizeIndex<4){Lt=Rt;break}}else for(let Rt=0;Rt<D.length;Rt++)if(D[Rt]){Lt=Rt;break}if(Lt===-1)return null;let Nt=D[Lt];Nt&&x(Nt,Lt)}let S=H.pfW,k=H.wRect.top-H.pfRect.top,R=Math.max(0,k),T=0;if(ct(2)){let Lt=Math.random();for(let Nt=6;Nt>=1;Nt--)if(Lt<TL[Nt]){T=Nt;break}}T>=4&&gl&&gl()&&(T=3);let P=ab[T],fe=Me+(T>=3?15*(T-2):0),de=fe,Ee=Math.max(de,S-P-fe),Le=de+Math.random()*(Ee-de),ze=Math.random()*100-50,qe;if(P>=H.pfW)qe=(H.pfW-P)/2;else{let Lt=H.pfW-P-fe;de>=Lt?qe=(H.pfW-P)/2:qe=pe(Le+ze,de,Lt)}let Ue=Math.min(H.wRect.height,H.pfRect.height*.3),_e=Math.max(Ue+80,120),Ae=Math.max(_e+40,H.safeBottom-P-6),Ie=pe(_e+Math.random()*(Ae-_e),_e,Ae),Ve={x0:Le,y0:R,x1:qe,y1:Ie,jitterMs:0},nt=H.pfRect.left-H.wRect.left,Ge=AL[T],At=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),st=.85+Math.random()*.3,wt=At*(Ge.w/100)*st,Ht=At*(Ge.h/100)*st,Xt=Le+P/2+nt,Un=R-k;return{wave:{x:Xt,y:Un,width:wt,height:Ht},coin:Ve,sizeIndex:T}}function ge(S){if(!S.length||!A())return;let k=document.createDocumentFragment(),R=[],T=performance.now(),P=!1;for(let{wave:fe,coin:de,sizeIndex:Ee}of S){if(fe&&(P=!0,af)){let Ae=Ee>=4;af.addWave(fe.x,fe.y,fe.width,fe.height,Ae)}let Le=ab[Ee],ze=1;if(ct(8)){let Ae=Ln(),Ie=Math.pow(25,Ae);ze=Math.pow(Ie,Ee)}else ze=kL[Ee];let qe=Ee>=4,Ue=W();Ue.style.width=`${Le}px`,Ue.style.height=`${Le}px`,Ue.className=`coin coin--size-${Ee}`,Ue.firstChild&&(Ue.firstChild.src=E),Ue.style.transform=`translate3d(${de.x0}px, ${de.y0}px, 0) rotate(-10deg) scale(0.96)`,Ue.style.opacity="0",ia?Ue.dataset.mutationLevel=Ui.toString():Ue.dataset.mutationLevel="0";let _e={mutationLevel:ia?Ui.toString():"0",el:Ue,src:E,x:de.x0,y:de.y0,rot:-10,scale:.96,startX:de.x0,startY:de.y0,endX:de.x1,endY:de.y1,startTime:T+de.jitterMs,duration:i,dieAt:T+p,jitterMs:de.jitterMs,isRemoved:!1,settled:!1,size:Le,sizeIndex:Ee,valueMultiplier:ze,forceDom:qe,soundSrc:cb[Ee]?`sounds/coin_pickup${cb[Ee]}`:null,bMinX:Math.min(de.x0,de.x1)-Le,bMaxX:Math.max(de.x0,de.x1)+Le,bMinY:Math.min(de.y0,de.y1)-Le,bMaxY:Math.max(de.y0,de.y1)+Le};Ue._coinObj=_e,_e.index=D.length,D.push(_e),R.push(_e),k.appendChild(Ue)}C.c.appendChild(k),R.length>0&&(R[0].el&&R[0].el.offsetHeight,requestAnimationFrame(()=>{for(let fe of R)fe.el&&(fe.el.style.transition=`transform ${i}ms ${CL} ${fe.jitterMs}ms`,fe.el.style.transform=`translate3d(${fe.endX}px, ${fe.endY}px, 0) rotate(0deg) scale(1)`,fe.el.style.opacity="1")})),P&&requestAnimationFrame(()=>{Q()})}function Re(S=1){if(!A())return;(!H.pfRect||!H.wRect)&&J();let k=[];for(let R=0;R<S;R++){let T=se();T&&k.push(T)}k.length&&ge(k)}function oe(S,k){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let R=k-S.startTime;if(R<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let T=R/S.duration;if(T>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let P=_L(T),fe=S.startX+(S.endX-S.startX)*P,de=S.startY+(S.endY-S.startY)*P,Ee=-10+10*P,Le=.96+.04*P;return{x:fe,y:de,rot:Ee,scale:Le}}function be(S,k){let R=ML(k.src);if(R&&R.complete&&R.naturalWidth>0){let T=k.size||r;S.drawImage(R,k.x,k.y,T,T)}}function Be(){if(B.length)if(q){B.forEach((k,R)=>{V[R]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,V[R].width,V[R].height),k.restore(),v&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let S=D.length;for(let k=0;k<S;k++){let R=D[k];if(R&&R&&R.settled&&!R.isRemoved&&!R.el){let T=R.sizeIndex||0;B[T]&&be(B[T],R)}}v&&B.forEach(k=>k.restore()),q=!1,$.length=0,G.length=0}else{if(G.length>0){v&&B.forEach(k=>{k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2});let S=D.length;for(let k=0;k<G.length;k++){let R=G[k],T=B[R.layer];if(!T)continue;let P=8,fe=R.x-P,de=R.y-P,Ee=R.size+P*2;T.save(),T.beginPath(),T.rect(fe,de,Ee,Ee),T.clip(),T.clearRect(fe,de,Ee,Ee);let Le=fe,ze=fe+Ee,qe=de,Ue=de+Ee;for(let _e=0;_e<S;_e++){let Ae=D[_e];if(!Ae||!Ae.settled||Ae.isRemoved||Ae.el||(Ae.sizeIndex||0)!==R.layer)continue;let Ie=Ae.size||r,Ke=Ae.x,Ve=Ae.x+Ie,nt=Ae.y,Ge=Ae.y+Ie;Ve>Le&&Ke<ze&&Ge>qe&&nt<Ue&&be(T,Ae)}T.restore()}v&&B.forEach(k=>k.restore()),G.length=0}if($.length>0){v&&B.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let k=$[S];if(!k.isRemoved&&k.settled&&!k.el){let R=k.sizeIndex||0;B[R]&&be(B[R],k)}}v&&B.forEach(S=>S.restore()),$.length=0}}}let Pe=a,Oe=null,le=performance.now(),ee=0;function we(S){(!H.pfRect||!H.wRect)&&J();let k=(S-le)/1e3;le=S,k>.1&&(k=.1);for(let T=D.length-1;T>=0;T--){let P=D[T];if(!P||!P)continue;if(S>=P.dieAt){x(P,T);continue}if(P.sizeIndex===5&&!P.isRemoved&&(P.lastLightningTime||(P.lastLightningTime=S-1e3,P.nextLightningInterval=0),S-P.lastLightningTime>P.nextLightningInterval)){P.lastLightningTime=S,P.nextLightningInterval=200+Math.random()*100;for(let Ee=0;Ee<3;Ee++)Uo(P,S)}if(P.sizeIndex===6&&!P.isRemoved&&(P.lastLightningTime||(P.lastLightningTime=S-1e3,P.nextLightningInterval=0),S-P.lastLightningTime>P.nextLightningInterval&&(P.lastLightningTime=S,P.nextLightningInterval=200+Math.random()*100,M.collectBatch))){let Ee=oe(P,S),Le=Ee.x+P.size/2,ze=Ee.y+P.size/2,qe=[],Ue=P.size/2*(P.size/2),_e=D.length;for(let Ae=0;Ae<_e;Ae++){let Ie=D[Ae];if(!Ie||Ie===P||Ie.isRemoved||Ie.settled===!1||Ie.sizeIndex>3)continue;let Ke=Ie.x+(Ie.size||r)/2,Ve=Ie.y+(Ie.size||r)/2,nt=Ke-Le,Ge=Ve-ze;nt*nt+Ge*Ge>Ue&&qe.push(Ie)}if(qe.length>0){for(let Ve=qe.length-1;Ve>0;Ve--){let nt=Math.floor(Math.random()*(Ve+1));[qe[Ve],qe[nt]]=[qe[nt],qe[Ve]]}let Ae=qe.slice(0,3),Ie=[],Ke=!1;for(let Ve of Ae){let nt=Ve.size||r,Ge=Ve.x+nt/2,At=Ve.y+nt/2;ur(P,Ge,At),Fo(Ge,At,nt),Ie.push({coin:Ve}),Ke||(ht("sounds/lightning_strike.ogg",{volume:.25}),Ke=!0)}Ie.length>0&&M.collectBatch(Ie)}}if(P.settled)continue;let fe=S-P.startTime;if(fe<0)continue;if(fe/P.duration>=1){P.settled=!0,P.x=P.endX,P.y=P.endY,P.rot=0,P.scale=1,P.el&&!P.forceDom?(re(P.el),P.el=null,$.push(P)):P.el&&(P.el.style.transition="none",P.el.style.transform=`translate3d(${P.x}px, ${P.y}px, 0) rotate(0deg) scale(1)`);continue}}ee+=Pe*k;let R=Math.floor(ee);if(R>0){ee-=R;let T=Math.min(R,u);if(T>0){let P=performance.now(),fe=[],de=5;for(let Ee=0;Ee<T&&!(performance.now()-P>de);Ee++){let Le=se();Le&&fe.push(Le)}fe.length&&ge(fe)}}if(Be(),Z>50){let T=0;for(let P=0;P<D.length;P++){let fe=D[P];fe!==null&&(fe.index=T,D[T++]=fe)}D.length=T,Z=0}ke(k),Oe=requestAnimationFrame(we)}function w(){if(!Oe){if(!A()){console.warn("[Spawner] start() called but required nodes are missing.");return}J(),d>0&&Oe===null&&Re(d),le=performance.now(),Oe=requestAnimationFrame(we)}}function Y(){Oe&&(cancelAnimationFrame(Oe),Oe=null)}function K(S){Pe=Math.max(0,Number(S)||0)}function te(){ee=0,le=performance.now()}function he(S){let k=ct(2)&&!!S;for(let R=D.length-1;R>=0;R--){let T=D[R];if(T&&T){if(k&&T.sizeIndex>=4){T.mutationLevel=ia?Ui.toString():"0",T.el&&(T.el.dataset.mutationLevel=T.mutationLevel);continue}x(D[R],R)}}te()}function ce(S){S&&(E=S)}function Ye(S){let k=S._coinObj;if(!k)return S.style.transform||"translate3d(0,0,0)";let{x:R,y:T,rot:P,scale:fe}=oe(k,performance.now());return`translate3d(${R}px, ${T}px, 0) rotate(${P}deg) scale(${fe})`}function tt(S){if(S.el)return S.el;if(S.isRemoved)return null;let k=W(),R=S.size||r;return k.style.width=`${R}px`,k.style.height=`${R}px`,k.className=`coin coin--size-${S.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=S.src),k.style.opacity="1",k.dataset.mutationLevel=S.mutationLevel,k._coinObj=S,S.el=k,C.c.appendChild(k),G.push({layer:S.sizeIndex||0,x:S.x,y:S.y,size:S.size||r}),k}function Se(S,k,R,T){let P=R;T&&(P=Math.max(R,260));let fe=R*R,de=[],Ee=D.length,Le=S-P,ze=S+P,qe=k-P,Ue=k+P,_e=performance.now();for(let Ae=0;Ae<Ee;Ae++){let Ie=D[Ae];if(!Ie||Ie.bMaxX<Le||Ie.bMinX>ze||Ie.bMaxY<qe||Ie.bMinY>Ue)continue;let Ke=Ie.size||r,Ve,nt;if(Ie.settled)Ve=Ie.x+Ke/2,nt=Ie.y+Ke/2;else{let wt=oe(Ie,_e);Ve=wt.x+Ke/2,nt=wt.y+Ke/2}if(Ve<Le||Ve>ze||nt<qe||nt>Ue)continue;let Ge=Ve-S,At=nt-k,st=fe;if(T&&(Ie.sizeIndex||0)>0){let wt=Ke/2;st=wt*wt}Ge*Ge+At*At<=st&&(Ie.isRemoved||de.push(Ie))}return de}function $e(S,k,R,T,P,fe){let de=P;fe&&(de=Math.max(P,260));let Ee=P*P,Le=[],ze=D.length,qe=Math.min(S,R)-de,Ue=Math.max(S,R)+de,_e=Math.min(k,T)-de,Ae=Math.max(k,T)+de,Ie=R-S,Ke=T-k,Ve=Ie*Ie+Ke*Ke,nt=Ee*Ve,Ge=performance.now();for(let At=0;At<ze;At++){let st=D[At];if(!st||st.bMaxX<qe||st.bMinX>Ue||st.bMaxY<_e||st.bMinY>Ae)continue;let wt=st.size||r,Ht,Xt;if(st.settled)Ht=st.x+wt/2,Xt=st.y+wt/2;else{let cn=oe(st,Ge);Ht=cn.x+wt/2,Xt=cn.y+wt/2}if(Ht<qe||Ht>Ue||Xt<_e||Xt>Ae)continue;let Un=Ht-S,Lt=Xt-k,Nt=Un*Ie+Lt*Ke,Rt=Ee;if(fe&&(st.sizeIndex||0)>0){let cn=wt/2;Rt=cn*cn}let So=!1;if(Nt<=0)Un*Un+Lt*Lt<=Rt&&(So=!0);else if(Nt>=Ve){let cn=Ht-R,ma=Xt-T;cn*cn+ma*ma<=Rt&&(So=!0)}else{let cn=Un*Ke-Lt*Ie;cn*cn<=Rt*Ve&&(So=!0)}So&&!st.isRemoved&&Le.push(st)}return Le}function Gt(S){x(S)}function ft(S,k,R){let T=R*R,P=[],fe=D.length,de=S-R,Ee=S+R,Le=k-R,ze=k+R,qe=performance.now();for(let Ue=0;Ue<fe;Ue++){let _e=D[Ue];if(!_e||_e.bMaxX<de||_e.bMinX>Ee||_e.bMaxY<Le||_e.bMinY>ze)continue;let Ae=_e.size||r,Ie,Ke;if(_e.settled)Ie=_e.x+Ae/2,Ke=_e.y+Ae/2;else{let Ge=oe(_e,qe);Ie=Ge.x+Ae/2,Ke=Ge.y+Ae/2}if(Ie<de||Ie>Ee||Ke<Le||Ke>ze)continue;let Ve=Ie-S,nt=Ke-k;Ve*Ve+nt*nt<=T&&(!_e.el&&!_e.isRemoved&&tt(_e),_e.el&&P.push(_e.el))}return P}function ln(S,k,R,T,P){let fe=P*P,de=[],Ee=D.length,Le=Math.min(S,R)-P,ze=Math.max(S,R)+P,qe=Math.min(k,T)-P,Ue=Math.max(k,T)+P,_e=R-S,Ae=T-k,Ie=_e*_e+Ae*Ae,Ke=fe*Ie,Ve=performance.now();for(let nt=0;nt<Ee;nt++){let Ge=D[nt];if(!Ge||Ge.bMaxX<Le||Ge.bMinX>ze||Ge.bMaxY<qe||Ge.bMinY>Ue)continue;let At=Ge.size||r,st,wt;if(Ge.settled)st=Ge.x+At/2,wt=Ge.y+At/2;else{let Nt=oe(Ge,Ve);st=Nt.x+At/2,wt=Nt.y+At/2}if(st<Le||st>ze||wt<qe||wt>Ue)continue;let Ht=st-S,Xt=wt-k,Un=Ht*_e+Xt*Ae,Lt=!1;if(Un<=0)Ht*Ht+Xt*Xt<=fe&&(Lt=!0);else if(Un>=Ie){let Nt=st-R,Rt=wt-T;Nt*Nt+Rt*Rt<=fe&&(Lt=!0)}else{let Nt=Ht*Ae-Xt*_e;Nt*Nt<=Ke&&(Lt=!0)}Lt&&(!Ge.el&&!Ge.isRemoved&&tt(Ge),Ge.el&&de.push(Ge.el))}return de}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;Oe||w()}});function Fn(){A()&&Re(1)}let Ft=[],Sn=[];function Xr(S,k){if(!S||!k)return;let R=S.size||r,T=k.size||r,P=S.x+R/2,fe=S.y+R/2,de=k.x+T/2,Ee=k.y+T/2;Ft.push({x1:P,y1:fe,x2:de,y2:Ee,age:0,life:.15})}function Fo(S,k,R){if(!C.pf)return;let T=document.createElement("div");T.className="coin-stain";let P=R*1.2;T.style.width=`${P}px`,T.style.height=`${P}px`,T.style.left=`${S-P/2}px`,T.style.top=`${k-P/2}px`,C.pf.appendChild(T),setTimeout(()=>{T.style.opacity="0",setTimeout(()=>{T.parentNode&&T.remove()},1e3)},2500)}function Uo(S,k){let R=Math.random()*Math.PI*2,T=(S.size||r)/2,P=T*lb,fe=Math.cos(R)*P,de=Math.sin(R)*P,Ee=T*(.7+Math.random()*.6),Le=Math.cos(R)*(P+Ee),ze=Math.sin(R)*(P+Ee);Ft.push({parentCoin:S,relX1:fe,relY1:de,relX2:Le,relY2:ze,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let qe=3+Math.floor(Math.random()*3);for(let Ue=0;Ue<qe;Ue++){let _e=.3+Math.random()*.5,Ae=fe+(Le-fe)*_e,Ie=de+(ze-de)*_e,Ke=R+(Math.random()*1.2-.6),Ve=Ee*(.4+Math.random()*.4),nt=Ae+Math.cos(Ke)*Ve,Ge=Ie+Math.sin(Ke)*Ve;Ft.push({parentCoin:S,relX1:Ae,relY1:Ie,relX2:nt,relY2:Ge,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ht("sounds/lightning_zap.ogg",{volume:.25})}function ur(S,k,R){if(!S)return;let T=S.size||r,P=performance.now(),fe=oe(S,P),de=fe.x+T/2,Ee=fe.y+T/2,Le=k-de,ze=R-Ee,qe=Math.atan2(ze,Le),Ue=Math.sqrt(Le*Le+ze*ze),_e=T/2*lb,Ae=Math.cos(qe)*_e,Ie=Math.sin(qe)*_e;Ft.push({parentCoin:S,relX1:Ae,relY1:Ie,x2:k,y2:R,age:0,life:.25,width:6,jaggedScale:25});let Ke=de+Ae,Ve=Ee+Ie,nt=6+Math.floor(Math.random()*5);for(let Ge=0;Ge<nt;Ge++){let At=.1+Math.random()*.8,st=Ke+(k-Ke)*At,wt=Ve+(R-Ve)*At,Ht=qe+(Math.random()*1.6-.8),Xt=Ue*(.1+Math.random()*.3),Un=st+Math.cos(Ht)*Xt,Lt=wt+Math.sin(Ht)*Xt;if(Ft.push({x1:st,y1:wt,x2:Un,y2:Lt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Rt=st+(Un-st)*.5,So=wt+(Lt-wt)*.5,cn=Ht+(Math.random()*1-.5),ma=Xt*.5;Ft.push({x1:Rt,y1:So,x2:Rt+Math.cos(cn)*ma,y2:So+Math.sin(cn)*ma,age:0,life:.25,width:1.5,jaggedScale:10})}}}function ke(S){if(!U||!_)return;U.clearRect(0,0,_.width,_.height);let k=performance.now();U.lineCap="round",U.lineJoin="round";for(let R=Ft.length-1;R>=0;R--){let T=Ft[R];if(T.age+=S,T.age>=T.life){Ft.splice(R,1);continue}let P=T.x1,fe=T.y1,de=T.x2,Ee=T.y2;if(T.parentCoin){let qe=oe(T.parentCoin,k),Ue=qe.x+(T.parentCoin.size||r)/2,_e=qe.y+(T.parentCoin.size||r)/2;P=Ue+T.relX1,fe=_e+T.relY1,T.relX2!==void 0&&(de=Ue+T.relX2,Ee=_e+T.relY2)}let Le=1-T.age/T.life;U.strokeStyle=`rgba(200, 240, 255, ${Le})`,U.lineWidth=T.width||3,U.shadowColor="rgba(220, 245, 255, 0.9)",U.shadowBlur=20;let ze=6;U.beginPath(),U.moveTo(P,fe);for(let qe=1;qe<=ze;qe++){let Ue=qe/ze,_e=P+(de-P)*Ue,Ae=fe+(Ee-fe)*Ue;if(qe===ze)U.lineTo(de,Ee);else{let Ie=-(Ee-fe),Ke=de-P,Ve=Math.sqrt(Ie*Ie+Ke*Ke),nt=T.jaggedScale||40;if(Ve>0){let Ge=(Math.random()-.5)*nt*(1-Math.abs(Ue-.5));U.lineTo(_e+Ie/Ve*Ge,Ae+Ke/Ve*Ge)}else U.lineTo(_e,Ae)}}U.stroke(),U.shadowBlur=0}for(let R=Sn.length-1;R>=0;R--){let T=Sn[R];if(T.age+=S,T.age>=T.life){Sn.splice(R,1);continue}T.x+=T.vx*S,T.y+=T.vy*S;let P=1-T.age/T.life;U.fillStyle=T.color,U.globalAlpha=P,U.beginPath(),U.arc(T.x,T.y,T.size,0,Math.PI*2),U.fill(),U.globalAlpha=1}}return{start:w,stop:Y,setRate:K,clearBacklog:te,clearPlayfield:he,setCoinSprite:ce,getCoinTransform:Ye,findCoinsInRadius:ft,findCoinsInPath:ln,findCoinTargetsInRadius:Se,findCoinTargetsInPath:$e,ensureCoinVisual:tt,removeCoinTarget:Gt,detachCoin:z,recycleCoin:re,playEntranceWave:Fn,setDependencies:L,hasBigCoins:()=>ct(2)&&D.some(S=>S&&S.sizeIndex>=4)}}var ia,Ui,LL,sb,CL,ab,lb,kL,TL,cb,AL,db=De(()=>{oc();_o();lo();co();Dn();Zm();Lo();ia=!1,Ui=0n,LL=2500,sb=new Map;try{ub(mt())}catch{ia=!1,Ui=0n}try{Ei(e=>{ub(e)})}catch{}CL="cubic-bezier(0.215, 0.61, 0.355, 1)";ab=[40,55,80,125,200,320,512],lb=.78,kL=[1,25,625,15625,390625,9765625,244140625],TL=[0,.1,.01,.001,1e-4,1e-5,1e-6],cb=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],AL=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var Sb={};vt(Sb,{afterSlotWrite:()=>nh,beforeSlotWrite:()=>th});function yb(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function BL(e,t=OL){!e||e<=0||$l.set(e,yb()+t)}function mb(e){if(!e||e<=0)return!1;let t=$l.get(e);return t==null?!1:t<=yb()?($l.delete(e),!1):!0}function FL(){$l.clear()}function cf(){try{return typeof localStorage<"u"}catch{return!1}}function eh(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function vb(e){let t=new Map;if(!cf())return ql.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Xi))continue;let r=eh(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return ql.set(e,t),t}function bb(e){return!Number.isFinite(e)||e<=0?null:ql.has(e)?ql.get(e):vb(e)}function th(e){if(!cf()||lf>0)return;let t=String(e);if(!t.startsWith(Xi))return;let n=eh(t);if(n==null)return;let o=bb(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(lf===0){lf+=1;try{In(n)}finally{lf-=1}}vb(n);return}}}catch{}}function nh(e,t){let n=String(e);if(!n.startsWith(Xi))return;let o=eh(n);if(o==null)return;let r=bb(o)||new Map;r.set(n,String(t??"")),ql.set(o,r)}function UL(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function DL(){let e=new Map;if(!cf())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Xi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=Af(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function $L(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function qL(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=Nf(e);if(n.length===0){o&&(mb(e)||In(e),Jl(e,null));return}let r=UL(n);o&&r!==o&&!mb(e)&&In(e),r!==o&&Jl(e,r)}function aa(){if(!cf())return;let e=DL();$L(e).forEach(n=>{let o=e.get(n)??[];qL(n,o)})}function GL(){if(Jm!=null)return;Jm=(typeof window<"u"?window:globalThis).setTimeout(()=>{Jm=null,aa()},PL)}function HL(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){BL(o),GL();return}$l.delete(o),aa()}}function XL(){typeof window>"u"||pb==null&&(pb=window.setInterval(aa,RL))}function VL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function sa(){let e=VL();if(!e)return;if(!Vi()){(e.dataset.poopShopApplied===Qm||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==hb||e.dataset.poopShopApplied!==Qm)&&(e.style.backgroundImage=hb,e.dataset.poopShopApplied=Qm)}function YL(){typeof window>"u"||gb==null&&(sa(),gb=window.setInterval(sa,50),window.addEventListener("saveSlot:change",sa),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&sa()}catch{sa()}}))}function WL(){typeof window>"u"||(aa(),XL(),YL(),window.addEventListener("saveSlot:change",()=>aa()),window.addEventListener("saveIntegrity:storageMutation",HL,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(FL(),aa(),sa())}))}var RL,OL,PL,pb,Jm,$l,ql,lf,hb,Qm,gb,oh=De(()=>{St();RL=1e4,OL=750,PL=50,pb=null,Jm=null,$l=new Map;ql=new Map,lf=0;hb="linear-gradient(180deg,#a9793d,#7b5534)",Qm="1",gb=null;WL()});var Tb={};vt(Tb,{initPopups:()=>JL,teardownpopups:()=>QL});function rh(){return bo||(bo=document.createElement("div"),bo.className="currency-popups",bo.setAttribute("aria-live","polite"),bo.setAttribute("aria-atomic","false"),document.body.appendChild(bo),bo)}function Di(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function ih(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function wb(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):ne(n);t&&(t.innerHTML=r)}function KL(e,t=Eb){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Gl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function jL(e,t,n){rh();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function sh(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(Wt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(Wt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Te).includes(e)&&$n(e,o))return}let r=zL[e],i=Object.assign({duration:Eb,accumulate:!0},r||{},n);if(!i.icon)return;let s=Di(t);if(!s||ih(s))return;let l=i.accumulate!==!1?Gl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,wb(l);return}let a=jL(e,i,s);a.meta=i,wb(a),Gl.set(e,a);let u=rh(),f=Ib.indexOf(e),d=null;if(f>=0){let p=Array.from(u.children);for(let y of p){let m=y.dataset.type;if(Ib.indexOf(m)>f){d=y;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),KL(a,i.duration)}function ZL(){let e={};for(let t of Object.values(Te))e[t]=Sa(t);return e}function xb(){try{let e=ZL();Object.entries(e).forEach(([t,n])=>{let o=Di(n)||c.fromInt(0);Gr.set(t,o.clone?.()??o)}),Gr.has("mp")||Gr.set("mp",c.fromInt(0))}catch{Gr.clear()}}function Lb(){Gl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Gl.clear()}function _b(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Di(t.value)||c.fromInt(0),r=Gr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Di(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&sh(n,s),Gr.set(n,o.clone?.()??o)}function Cb(e){let t=e?.detail;if(!t)return;let n=Di(t.xpAdded);n&&!ih(n)&&sh("xp",n)}function Mb(e){let t=e?.detail;if(!t)return;let n=Di(t.delta);n&&!ih(n)&&sh("mp",n);let o=Di(t.progress);o&&Gr.set("mp",o.clone?.()??o)}function kb(){Lb(),xb()}function JL(){uf||(uf=!0,rh(),xb(),window.addEventListener("currency:change",_b),window.addEventListener("xp:change",Cb),window.addEventListener("mutation:change",Mb),window.addEventListener("saveSlot:change",kb))}function QL(){uf&&(window.removeEventListener("currency:change",_b),window.removeEventListener("xp:change",Cb),window.removeEventListener("mutation:change",Mb),window.removeEventListener("saveSlot:change",kb),Lb(),Gr.clear(),bo&&bo.remove(),bo=null,uf=!1)}var Eb,Ib,zL,bo,uf,Gr,Gl,Ab=De(()=>{Et();Yt();St();Eb=6767,Ib=["coins","xp","books","gold","mp","magic","gears","dna"],zL={[Te.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Te.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Te.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Te.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Te.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Te.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},bo=null,uf=!1,Gr=new Map,Gl=new Map});var Db={};vt(Db,{flushBackupSnapshot:()=>Ub,getSuspendMetadata:()=>g1,installSuspendSafeguards:()=>h1,markProgressDirty:()=>Po,restoreFromBackupIfNeeded:()=>m1});function Hl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function da(){if(typeof localStorage>"u")return!1;try{let e=`${no}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function Pb(){if(!Hl())throw new Error("IndexedDB unavailable");return la||(la=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(e1,t1);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(fa)||r.createObjectStore(fa)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}la=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw la=null,e}),la)}function i1(){if(!da())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(no))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function s1(e){try{let t=await Pb();return await new Promise((n,o)=>{let r=!1,i=t.transaction(fa,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(fa).put(e,Ob);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function a1(){try{let e=await Pb();return await new Promise((t,n)=>{let o=!1,r=e.transaction(fa,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(fa).get(Ob);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function l1(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function ah(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function c1(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function f1(e){return!(typeof e!="string"||e.length===0||u1.test(e))}function lh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(no)||n.startsWith(n1)||n.startsWith(o1))return;let o=c1(n);if(o!=null)try{let r={key:n,slot:o,trusted:f1(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function d1(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=ah(),a=String(i),u=this===localStorage&&a.startsWith(no);if(u)try{th(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Po("setItem");try{nh(a,s)}catch{}}this===localStorage&&a.startsWith(no)&&lh(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=ah(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(no)&&(Po("removeItem"),lh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=ah(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Po("clear"),lh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function Bb(e="idle"){ua=e||ua,Hr=!0,!ca&&(ca=setTimeout(()=>{if(ca=null,!Hr)return;let t=ua;Hr=!1,Ub(t)},r1))}function Fb(){ca&&(clearTimeout(ca),ca=null)}function Po(e="dirty"){try{Bb(e)}catch{}}async function ch(e="manual"){if(!da()||!Hl())return!1;let t=i1();if(!t)return!1;t.reason=e,df=!1;let n=await s1(t);return n||(Hr=!0,Bb("retry")),n}async function Ub(e="manual",{immediate:t=!1}={}){return!da()||!Hl()?!1:t?(Fb(),Hr=!1,df=!0,ch(e)):(Hr=!0,ua=e||ua,ch(e))}function ff(e){!Hl()||!da()||(Fb(),Hr=!1,df=!0,ch(e))}function p1(){if(!da())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(no))return!0}}catch{}return!1}async function m1(){if(Rb||(Rb=!0,!da()||!Hl()))return!1;let e=!1;try{if(!p1())e=!0;else{let o=localStorage.getItem(`${no}saveSlot`);if(o){let r=`${no}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await a1();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Po("restored"),n}function h1(){if(Nb||(Nb=!0,typeof window>"u"))return;l1(),d1();let e=()=>{document.hidden?ff("visibility-hidden"):Po("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>ff("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>ff("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>ff("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Po("pageshow"))}catch{}try{window.addEventListener("focus",()=>Po("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(no)||Po("storage-event"))})}catch{}Po("boot")}function g1(){return{pendingImmediateFlush:df,dirty:Hr,lastDirtyReason:ua}}var no,e1,t1,fa,Ob,n1,o1,r1,la,ca,Hr,ua,Nb,Rb,df,u1,$b=De(()=>{oh();no="ccc:",e1="ccc:safety",t1=1,fa="snapshots",Ob="latest",n1=`${no}slotSig`,o1=`${no}slotMod`,r1=1e3,la=null,ca=null,Hr=!1,ua="init",Nb=!1,Rb=!1,df=!1;u1=/\bat <anonymous>:\d+:\d+\b/});var qb={};vt(qb,{initGlobalOverlayEsc:()=>b1});function v1(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i,closeAll:s}of y1){let l=document.querySelectorAll(o);if(l.length>0){if(i){t=!0;continue}if(s)l.forEach(a=>{let u=a.querySelector(r||".shop-close");u&&(u.click(),n=!0)});else{let u=l[l.length-1].querySelector(r||".shop-close");u&&(u.click(),n=!0)}}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function b1(){window.addEventListener("keydown",v1,!0)}var y1,Gb=De(()=>{y1=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close",closeAll:!0}]});var Hb={};vt(Hb,{ensureGameDom:()=>S1});function S1(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var Xb=De(()=>{});var Vb={};vt(Vb,{SHOW_FPS:()=>I1,initFpsTracker:()=>w1});function w1(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var I1,Yb=De(()=>{I1=!0});function L1(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function _1(){if(!je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function aS(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function pa(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function lS(e,t,n,o=500){!e||e.__done||(e.__done=!0,e.__label&&(n?e.__label.textContent=n:e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(async()=>{if(typeof t=="function")try{t()}catch(i){console.error(i)}await yS(),e.style.opacity="0";let r=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",r,{once:!0}),setTimeout(r,450)},o))}async function ph(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function C1(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function M1(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Dn(),Yl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function k1(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function T1({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...C1(e,s),...M1(t,s),...n?k1(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function A1(e){if(qi===e)return;an&&(an.stop(),an=null),qi=e;let t=document.querySelector(".menu-root");switch(e){case Bo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{qi===Bo.STARTER_COVE&&(an=ht("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},300)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Sh=="function"&&Sh(n,80),$i){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if($i.init("water-background",i),mf){try{mf()}catch{}mf=null}if(hf){try{hf()}catch{}hf=null}typeof vh=="function"&&(mf=vh(s=>$i.update(s))),typeof bh=="function"&&(hf=bh((s,l)=>$i.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,$i&&requestAnimationFrame(()=>$i.resize()),fS()),typeof hh=="function")try{hh()}catch{}if(typeof gh=="function")try{gh()}catch{}if(!Zt){Zt=cS({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=Zt;let i=()=>{if(!(!Zt||typeof Zt.setCoinSprite!="function"))try{Zt.setCoinSprite(hS?.())}catch{}};i(),gS?.(i);let s=uS({spawner:Zt});Zt&&typeof Zt.setDependencies=="function"&&Zt.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=dS(),u=pS(a);if(Zt&&u?.coinsPerSecondMult){let f=1*u.coinsPerSecondMult;if(typeof yh=="function"){let d=yh("spawnRate",f);try{d&&typeof d.toScientific=="function"?f=Number(d.toScientific(6)):f=Number(d)}catch{}}Number.isFinite(f)&&Zt.setRate(f)}}catch{}};if(l(),typeof dh=="function")try{dh()}catch{}dh=mS(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof mh=="function")try{mh()}catch{}setTimeout(()=>{qi===Bo.STARTER_COVE&&Zt&&Zt.start()},300);break}case Bo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),Zt&&Zt.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Bo.MENU}}))}catch{}}var E1,je,Wb,cS,uS,fS,zb,Kb,jb,Zb,Jb,Qb,eS,tS,dS,pS,mh,mS,x1,nS,oS,rS,uh,fh,hh,gh,hS,gS,pf,yh,iS,vh,bh,sS,Sh,$i,mf,hf,Bo,qi,an,Zt,dh,gf,yS,lo=De(()=>{Dn();E1=!0,je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();je&&document.documentElement.classList.add("is-mobile");mf=null,hf=null;_1();Bo={MENU:0,STARTER_COVE:1},qi=Bo.MENU,an=null,Zt=null,dh=null,gf=()=>new Promise(e=>requestAnimationFrame(e)),yS=async()=>{await gf(),await gf()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(W=>{e=W}),n=aS("Loading assets...",e);await gf();let{initAudio:o}=await Promise.resolve().then(()=>(Dn(),Yl));o();let r=Promise.all([Promise.resolve().then(()=>(Bf(),$h)),Promise.resolve().then(()=>(db(),fb)),Promise.resolve().then(()=>(Xa(),sv)),Promise.resolve().then(()=>(su(),Wy)),Promise.resolve().then(()=>(St(),Bh)),Promise.resolve().then(()=>(oh(),Sb)),Promise.resolve().then(()=>(ao(),w0)),Promise.resolve().then(()=>(oc(),Gh)),Promise.resolve().then(()=>(Vn(),rg)),Promise.resolve().then(()=>(Lo(),Zv)),Promise.resolve().then(()=>(_o(),Q0)),Promise.resolve().then(()=>(Ab(),Tb)),Promise.resolve().then(()=>($b(),Db)),Promise.resolve().then(()=>(ts(),fg)),Promise.resolve().then(()=>(Gb(),qb)),Promise.resolve().then(()=>(Qi(),K0)),Promise.resolve().then(()=>(ei(),pg)),Promise.resolve().then(()=>(Bc(),ry)),Promise.resolve().then(()=>(ls(),wg)),Promise.resolve().then(()=>(ds(),Tg)),Promise.resolve().then(()=>(Xb(),Hb)),Promise.resolve().then(()=>(co(),jg)),Promise.resolve().then(()=>(Zm(),ib)),Promise.resolve().then(()=>(pi(),ty)),Promise.resolve().then(()=>(Yb(),Vb))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(W,re)=>`img/mutations/m${re+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/gold_val_dna.webp","img/sc_upg_icons/magic_val_dna.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=T1(i,W=>{s=W,pa(n,W)}),[a,u,f,d,p,y,m,g,h,v,E,C,A,N,V,B,q,_,U,M,L,H,J,ae,pe]=await r;({initSlots:Wb}=a),{createSpawner:cS}=u,{initCoinPickup:uS}=f,{initHudButtons:fS}=d,{bank:Zb,getHasOpenedSaveSlot:Jb,setHasOpenedSaveSlot:Qb,ensureStorageDefaults:eS,notifyGameSessionStarted:sS,ensureMultiplierDefaults:tS}=p,{getCurrentAreaKey:dS,computeUpgradeEffects:pS,onUpgradesChanged:mS}=m,{registerPreloadedAudio:x1}=g,{initXpSystem:mh}=h,{initResetSystem:hh}=v,{initMutationSystem:gh,getMutationCoinSprite:hS,onMutationChange:gS}=E,{initPopups:nS}=C,{installSuspendSafeguards:oS,restoreFromBackupIfNeeded:rS,markProgressDirty:uh,flushBackupSnapshot:fh}=A,{installGhostTapGuard:zb,initGlobalGhostTap:Kb}=N,{initGlobalOverlayEsc:jb}=V,{setDebugPanelAccess:pf,applyStatMultiplierOverride:yh}=B,{startGameLoop:iS,registerTick:vh,registerFrame:bh}=q;let{initOfflineTracker:ye,processOfflineProgress:Me}=_,{initWorkshopSystem:ie}=U,{initAutomationEffects:D}=M;({ensureGameDom:Sh}=L);let{initSurgeEffects:Z}=H;({waterSystem:$i}=J);let{initLabLogic:$}=ae,{initFpsTracker:G}=pe;window.bank=Zb,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(an){try{an.stop()}catch{}an=null}}),window.addEventListener("audio:restartMusic",()=>{if(an){try{an.stop()}catch{}an=null}qi===Bo.STARTER_COVE&&(an=ht("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",W=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return W.preventDefault(),W.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let W=document.hidden;vf(W),an&&an.element&&(W?an.element.pause():an.element.play().catch(()=>{}))}),zb?.(),Kb?.(),jb?.(),oS?.(),typeof pf=="function"&&(pf(E1),window.setDebugPanelAccess=pf);try{await rS?.()}catch{}await Promise.race([l,t]),await yS(),document.documentElement.classList.remove("booting"),await gf(),lS(n),await Promise.all([ph("img/currencies/coin/coin_plus_base.webp"),ph("img/stats/xp/xp_plus_base.webp"),ph("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}iS(),ye(()=>qi===Bo.STARTER_COVE);try{ie()}catch(W){console.error("Workshop init failed",W)}try{D()}catch(W){console.error("Automation init failed",W)}try{Z()}catch(W){console.error("Surge effects init failed",W)}try{$()}catch(W){console.error("Lab system init failed",W)}try{G()}catch(W){console.error("FPS tracker init failed",W)}L1(),eS(),uh?.("ensure-defaults"),nS();let j=document.getElementById("panel-title");if(Jb()?(document.body.classList.add("has-opened"),j&&(j.style.opacity="0")):j&&(j.style.opacity="1"),Wb(async()=>{if(qi===Bo.STARTER_COVE)return;Qb(!0),document.body.classList.add("has-opened"),j&&(j.style.opacity="0");let W=aS("Loading game..."),re=()=>new Promise(x=>setTimeout(x,120));pa(W,.2),await re(),tS(),pa(W,.4),await re(),Me(),pa(W,.65),await re(),sS?.(),pa(W,.9),await re(),uh?.("slot-entered"),pa(W,1),lS(W,()=>{A1(Bo.STARTER_COVE),setTimeout(()=>{window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave()},300)},"Finished loading game",200)}),typeof window<"u"&&fh)try{window.cccRequestBackup=()=>fh("manual",{immediate:!0})}catch{}})});lo();})();
