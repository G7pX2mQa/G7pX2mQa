(()=>{var xS=Object.defineProperty;var $e=(e,t)=>()=>(e&&(t=e(e=0)),t);var vt=(e,t)=>{for(var n in t)xS(e,n,{get:t[n],enumerable:!0})};var Zl={};vt(Zl,{initAudio:()=>LS,loadAudio:()=>Ch,playAudio:()=>ht,registerPreloadedBuffer:()=>CS,setAudioSuspended:()=>Lf,setMusicUnderwater:()=>Yr});function xf(){if(Yt)return Yt;let e=window.AudioContext||window.webkitAudioContext;return e?(Yt=new e,ba=Yt.createGain(),ba.connect(Yt.destination),ba.gain.value=1,Kl=Yt.createGain(),Kl.gain.value=1,Kl.connect(ba),wo=Yt.createBiquadFilter(),wo.type="lowpass",wo.frequency.value=22050,wo.Q.value=1,wo.connect(Kl),Yt):null}function LS(){xf()}function _S(){Yt&&Yt.state==="suspended"&&Yt.resume().catch(()=>{})}async function Ch(e){let t=xf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(Sa.has(n))return Sa.get(n);if(jl.has(n))return jl.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return Sa.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{jl.delete(n)}})();return jl.set(n,o),o}function ht(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=xf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=Sa.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(wo):f.connect(ba),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else Ch(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function CS(e,t){let n=new URL(e,document.baseURI).href;Sa.set(n,t)}function Lf(e){Yt&&(e?Yt.state==="running"&&Yt.suspend().catch(()=>{}):Yt.state==="suspended"&&Yt.resume().catch(()=>{}))}function Yr(e){if(!wo)return;let t=e?600:22050;try{let n=Yt.currentTime;wo.frequency.cancelScheduledValues(n),wo.frequency.setValueAtTime(t,n)}catch{wo.frequency.value=t}}var Yt,ba,Kl,wo,Sa,jl,$n=$e(()=>{Yt=null,ba=null,Kl=null,wo=null,Sa=new Map,jl=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,_S,{capture:!0,passive:!0})})});function ke(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let m=Number(e.sig);if(m>0){let y=Math.log10(m),p=e.e||0,h=Number(e._eOffset||0n);return y+p+h}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let m=Number(u);if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)}else{let m=Number(u.slice(0,15));if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function ve(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function _f(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/Mh;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/Mh:e>0?e:0}var c,Mh,Et=$e(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",m=BigInt(u+d);return new e(m,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};Mh=Math.log(10)});function Ah(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return kh.format(t)}catch{return String(e)}}function Ia(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function Cf(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Ah(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+kh.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=Mf.get(u)||"",m=o-u+1,y=4-m,p=m+y;n.length<p+1&&(n+="0".repeat(p+1-n.length));let h=n.slice(0,p);(n.charCodeAt(p)||48)>=53&&(h=Ia(h));let v,E;return h.length>p?(v=h.slice(0,m+1),E="0".repeat(y)):(v=h.slice(0,m),E=h.slice(m)),t+`${v}${y?"."+E:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Ia(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+Cf(String(o))}function TS(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Cf(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=Ia(f)),l){let M=f.slice(0,1)+"."+f.slice(1),N=i==="-"?"-":"";return t+M+"e"+Cf(s,N)}let m=Math.floor(a/3)*3,y=Mf.get(m)||"",h=a-m+1,g=4-h,v,E;return f.length>4?(v=f.slice(0,h+1),E="0".repeat(g)):(v=f.slice(0,h),E=f.slice(h)),t+(i==="-"?"-":"")+v+(g?"."+E:"")+y}function Th(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Ia(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+TS(l)}function te(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Th(e.toScientific(3));if(t<6)return Ah(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=Mf.get(n);if(!o)return Th(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Ia(u));let d,m;return u.length>l?(d=u.slice(0,i+1),m="0".repeat(s)):(d=u.slice(0,i),m=u.slice(i)),`${d}${s?"."+m:""}${o}`}function Ae(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=ke(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return te(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):te(c.fromAny(t))}catch{return"1"}}var MS,Mf,kh,Wt=$e(()=>{Et();MS=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],Mf=new Map(MS),kh=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var Gh={};vt(Gh,{CURRENCIES:()=>Ne,KEYS:()=>bt,STORAGE_PREFIX:()=>Yi,bank:()=>R,clearActiveSlot:()=>qS,clearAllStorage:()=>VS,ensureCurrencyDefaults:()=>$f,ensureMultiplierDefaults:()=>qf,ensureStorageDefaults:()=>XS,getActiveSlot:()=>b,getCurrency:()=>xa,getCurrencyMultiplierBN:()=>qh,getHasOpenedSaveSlot:()=>HS,getLastSaveTime:()=>Bf,getLastSaveTimeKey:()=>nc,getSlotModifiedFlagKey:()=>GS,getSlotSignature:()=>Df,getSlotSignatureKey:()=>Uf,hasModifiedSave:()=>Wi,isCurrencyLocked:()=>qn,isStorageKeyLocked:()=>zt,markSaveSlotModified:()=>wn,notifyGameSessionStarted:()=>DS,onCurrencyChange:()=>tc,peekCurrency:()=>La,primeStorageWatcherSnapshot:()=>lt,setActiveSlot:()=>Ff,setCurrency:()=>Xi,setCurrencyMultiplierBN:()=>ic,setHasOpenedSaveSlot:()=>rc,setSlotSignature:()=>oc,updateLastSaveTime:()=>Dh,watchStorageKey:()=>Tt});function Af(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Nf(e){let t=Af(e);return t==null?null:`${kS}:${t}`}function Rf(e){let t=Af(e);return t==null?null:`${AS}:${t}`}function Bh(e={}){Jl.size!==0&&Jl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function tc(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Jl.add(o),()=>{Jl.delete(o)}}function RS(){if(wa!=null||qo.size===0)return;wa=(typeof window<"u"?window:globalThis).setInterval(PS,NS)}function Fh(){if(qo.size!==0||wa==null)return;(typeof window<"u"?window:globalThis).clearInterval(wa),wa=null}function Uh(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function OS(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function PS(){if(qo.size===0){Fh();return}qo.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=Uh(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!OS(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function Tt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=qo.get(e);return s||(s=new Set,qo.set(e,s)),s.add(i),RS(),()=>{let l=qo.get(e);l&&(l.delete(i),l.size===0&&(qo.delete(e),Fh()))}}function lt(e,t){if(!e)return;let n=qo.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=Uh(r,o),r.initialized=!0)})}function Of(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function BS(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function FS(){Tf.forEach(e=>{try{e?.()}catch{}}),Tf.clear()}function Rh(e){if(e!==Nh&&(FS(),Nh=e??null,e!=null))for(let t of Object.values(Ne)){let n=`${bt.CURRENCY[t]}:${e}`,o=Tt(n,{parse:BS,equals:Of,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};Bh(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Tf.set(n,o)}}function US(){typeof window>"u"||(Rh(b()),window.addEventListener("saveSlot:change",()=>{Rh(b())}))}function DS(){Pf=!0}function nc(e=b()){return e==null?null:`${hr}lastSaveTime:${e}`}function Dh(){if(!Pf||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(nc(e),String(t))}catch{}}function Bf(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(nc(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function $S(){typeof window>"u"||(Oh||(Oh=setInterval(Dh,1e3)),window.addEventListener("beforeunload",()=>{if(!Pf)return;let e=b();if(e!=null)try{localStorage.setItem(nc(e),String(Date.now()))}catch{}}))}function b(){if(pr!==void 0)return pr;let e=localStorage.getItem(bt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return pr=n,n}function Ff(e){let t=Math.max(1,parseInt(e,10)||1);pr=t,localStorage.setItem(bt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function qS(){pr=null,localStorage.removeItem(bt.SAVE_SLOT)}function Ea(e,t=b()){return t==null?null:`${e}:${t}`}function $h(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function zt(e){return $h(e)}function Uf(e=b()){return Nf(e)}function GS(e=b()){return Rf(e)}function Df(e=b()){if(typeof localStorage>"u")return null;let t=Nf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function oc(e,t){if(typeof localStorage>"u")return;let n=Nf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function Wi(e=b()){if(typeof localStorage>"u")return!1;let t=Rf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function wn(e=b()){if(typeof localStorage>"u")return;let t=Af(e);if(t==null||Wi(t))return;let n=Rf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function HS(){return localStorage.getItem(bt.HAS_OPENED_SAVE_SLOT)==="true"}function rc(e){localStorage.setItem(bt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function XS(){localStorage.getItem(bt.HAS_OPENED_SAVE_SLOT)===null&&rc(!1)}function $f(){let e=b();if(e!=null)for(let t of Object.values(Ne)){let n=`${bt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function qf(){let e=b();if(e!=null)for(let t of Object.values(Ne)){let n=`${bt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))ec(t);else{let o=mr(c.fromInt(1));Vi(t,o)}}}function xa(e){let t=Ea(bt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Xi(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=Ea(bt.CURRENCY[e],r),s=o??xa(e),l=c.fromInt(0);if(!i||qn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,m=a;try{f!=null&&(m=c.fromAny(f),m.isNegative?.()&&(m=c.fromInt(0)))}catch{}lt(i,d);let y=!Of(s,m),h=(v=>{if(v==null)return null;try{let E=v instanceof c?v.clone?.()??v:c.fromAny(v);if(typeof E.cmp=="function")return E.cmp(l)>0?E:null;if(!E.isZero?.())return E}catch{}return null})(n),g=null;if(y)try{g=m.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=h),y||g){let v={key:e,value:m,slot:r,delta:g??void 0};Bh(v);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:v}))}catch{}}return m}function mr(e){return e.mulScaledIntFloor(1n,-kf)}function Ql(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,kf)}function ec(e){let t=Ea(bt.MULTIPLIER[e]);if(!t)return mr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Wr)){let r=mr(c.fromInt(1));return Vi(e,r),r}let o=n.slice(Wr.length);try{return c.fromAny(o)}catch{let r=mr(c.fromInt(1));return Vi(e,r),r}}function Vi(e,t,n=b()){let o=Ea(bt.MULTIPLIER[e],n);if(!o||qn(e,n))return;let r=mr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Wr))try{r=c.fromAny(i.slice(Wr.length))}catch{}let s=c.fromAny(t),l=Wr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(Wr)?u.slice(Wr.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{lt(o,u)}catch{}if(!Of(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:Ql(f),slot:n}}))}catch{}}function qh(e){return Ql(ec(e))}function qn(e,t=b()){let n=Ea(bt.CURRENCY[e],t);return $h(n)}function ic(e,t){let n=c.fromAny(t),o=mr(n);return Vi(e,o,b()),n}function La(e,t){let n=localStorage.getItem(`${bt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function VS(){Object.values(bt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Ph(e){let t=n=>{try{let o=c.fromAny(n);return typeof te=="function"?te(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return xa(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Xi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Xi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Xi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof te=="function"?te(r):r.toString()},t.mult={get(){return qh(e)},set(n){return ic(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=ec(e).mulBigNumInteger(o);return r.isZero()&&(r=mr(c.fromInt(1))),Vi(e,r),Ql(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),kf)}catch{o={numer:1n,scale:0}}let r=ec(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=mr(c.fromInt(1))),Vi(e,r);let i=Ql(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var hr,Yi,kS,AS,kf,Wr,NS,qo,wa,Jl,Tf,Nh,Oh,Pf,bt,Ne,pr,R,St=$e(()=>{Et();Wt();hr="ccc:",Yi=hr,kS=`${hr}slotSig`,AS=`${hr}slotMod`,kf=18,Wr="XM:",NS=140,qo=new Map,wa=null,Jl=new Set;Tf=new Map,Nh=null;Oh=null,Pf=!1;$S();bt={HAS_OPENED_SAVE_SLOT:`${hr}hasOpenedSaveSlot`,SAVE_SLOT:`${hr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Ne={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===bt.SAVE_SLOT){if(e.newValue===null)pr=null;else{let t=parseInt(e.newValue,10);pr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:pr}}))}catch{}}});for(let e of Object.values(Ne))bt.CURRENCY[e]=`${hr}${e}`,bt.MULTIPLIER[e]=`${hr}mult:${e}`;US();R=new Proxy({},{get(e,t){if(Object.values(Ne).includes(t))return Ph(t);if(typeof t=="string"&&Ne[t.toUpperCase?.()])return Ph(Ne[t.toUpperCase()])}});if(typeof window<"u"){window.bank=R;for(let e of Object.values(Ne))window[e]=R[e]}});function Xh(){return Eo}function sc(e){Eo=!!e,document.body.classList.toggle("slots-delete-mode",Eo);let t=document.getElementById("manage-saves");t&&(t.textContent=Eo?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",Eo),n.setAttribute("aria-pressed",Eo?"true":"false")})}function YS(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function WS(){if(Hh)return;Hh=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),sc(!Eo)}),window.addEventListener("keydown",r=>{Eo&&r.key==="Escape"&&sc(!1)});let n=r=>{!Eo||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!Eo)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(YS(s),b()===s)try{localStorage.removeItem(bt.SAVE_SLOT)}catch{}Gf(),sc(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),sc(!1)}var Eo,Hh,Vh=$e(()=>{St();Hf();Eo=!1,Hh=!1;document.addEventListener("DOMContentLoaded",()=>{try{WS()}catch{}})});var Yh={};vt(Yh,{initSlots:()=>jS,refreshSlotsView:()=>Gf});function zS(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function KS(e){if(!zS(e))return"No Save Data";try{let t=La(e,"coins");return te(t)}catch{return"0"}}function Xf(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=KS(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function jS(e){let t=document.querySelectorAll(".slot-card");Xf(),t.forEach((n,o)=>{let r=o+1,i=s=>{Ff(r),$f(),qf(),rc(!0),typeof e=="function"&&e(r,s),Xf()};n.addEventListener("click",s=>{Xh()||(s.preventDefault(),i(s))})})}function Gf(){Xf()}var Hf=$e(()=>{Et();Wt();Vh();St()});var zh={};vt(zh,{registerPreloadedAudio:()=>ZS,takePreloadedAudio:()=>JS});function ZS(e,t){let n=Wh(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}ac.set(n,t)}}function JS(e){let t=Wh(e);if(!ac.has(t))return null;let n=ac.get(t);return ac.delete(t),n}var ac,Wh,lc=$e(()=>{ac=new Map,Wh=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function zi(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var Vf=$e(()=>{});var ug={};vt(ug,{addExternalCoinMultiplierProvider:()=>xo,addExternalXpGainMultiplierProvider:()=>br,addXp:()=>es,broadcastXpChange:()=>mc,computeCoinMultiplierForXpLevel:()=>nd,getXpGainMultiplier:()=>gc,getXpLevelStorageKey:()=>QS,getXpRequirementForXpLevel:()=>hc,getXpState:()=>rt,initXpSystem:()=>Ji,isXpSystemUnlocked:()=>dn,onXpChange:()=>dc,refreshCoinMultiplierFromXpLevel:()=>nn,resetXpProgress:()=>Qi,setExternalBookRewardProvider:()=>yc,setExternalCoinMultiplierProvider:()=>lg,setExternalXpGainMultiplierProvider:()=>cg,unlockXpSystem:()=>Zr});function QS(e=b()){let t=e??b();return t==null?null:zr(t)}function fn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function cc(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function ng(e){if(!e||typeof e!="object")return 0;if(fn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function nI(e){return!e||typeof e!="object"?0:fn(e)||typeof e.cmp=="function"&&e.cmp(tg)>=0?Number.POSITIVE_INFINITY:ng(e)}function jh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(tI,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(Aa())??c.fromInt(0):n}function oI(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(eg,18)}function rI(e){if(fn(e)||typeof e.cmp=="function"&&e.cmp(tg)>=0)return _t.clone?.()??_t;let t=e.floorToInteger(),n=e.sub(t),o=ng(n);if(!Number.isFinite(o))return _t.clone?.()??_t;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return _t.clone?.()??_t;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),p=Number(y),h=d-y;return new c(a,{base:p,offset:h})}function og(e){if(!e||typeof e!="object")return _t.clone?.()??_t;let n=oI(e),o=rI(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return _t.clone?.()??_t;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function rg(){let e=fn(X.xpLevel),t=fn(X.progress);if(!e&&!t)return!1;let n=_t.clone?.()??_t;if(X.xpLevel=n.clone?.()??n,X.progress=n.clone?.()??n,xt=n.clone?.()??n,R?.books)try{typeof R.books.set=="function"?R.books.set(n.clone?.()??n):typeof R.books.add=="function"&&R.books.add(n.clone?.()??n)}catch{}return!0}function Ma(e={}){ka.size!==0&&ka.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function dc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return ka.add(n),()=>{ka.delete(n)}}function Bt(){return c.fromInt(0)}function Aa(){return c.fromInt(1)}function Ki(e){if(!e)return Bt();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Bt()}}function uc(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function iI(){for(;Qf.length>0;){let e=Qf.pop();try{e?.()}catch{}}}function Jh(e){if(e==null)return Bt();try{return c.fromAny(e)}catch{return Bt()}}function zf(e){if(!Wf){Wf=!0;try{let t=ed??b(),n={unlocked:X.unlocked,xpLevel:Ki(X.xpLevel),progress:Ki(X.progress),requirement:Ki(xt)};tn(!0),io(),xn(!0);let o={unlocked:X.unlocked,xpLevel:Ki(X.xpLevel),progress:Ki(X.progress),requirement:Ki(xt)},r=n.unlocked!==o.unlocked,i=!uc(n.xpLevel,o.xpLevel),s=!uc(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Bt();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Bt()}catch{l=Bt()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||ka.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(Ma(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{Wf=!1}}}function Kf(e){if(e===ed||(iI(),ed=e??null,e==null))return;let t=(n,o)=>{let r=Tt(n,o);typeof r=="function"&&Qf.push(r)};t(_a(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>zf("unlock")}),t(zr(e),{parse:Jh,equals:uc,onChange:()=>zf("xpLevel")}),t(Zi(e),{parse:Jh,equals:uc,onChange:()=>zf("progress")})}function ig(){if(Zh){Kf(b());return}Zh=!0,Kf(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Kf(b()),tn(!0),io(),xn(!0)})}function jf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function sI(e){let t=e<Kh?e:Kh;if(t<=ji)return;let n=ji,o=gr.get(n.toString());for(o||(o=c.fromInt(10),gr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),gr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){ji=n;return}}ji=n}function aI(e){let t=ji>0n?ji:0n,n=gr.get(t.toString());if(!n||fn(n))return _t.clone?.()??_t;let o=c.fromAny(t.toString()),r=ke(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);cc(s)||(i=i.add?.(s.mulDecimal(eg,18))??i);let l=jh(e),a=jh(o),u=l.sub?.(a)??c.fromInt(0);cc(u)||(i=i.add?.(u.mulDecimal(eI,18))??i);let f=nI(i);return Number.isFinite(f)?ve(f):_t.clone?.()??_t}function lI(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=fn(t),o=fn(e);if(n)return o?1:0;if(cc(t)||cc(e))return 0;let s=ke(e),l=ke(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function sg(){return En.container&&En.container.isConnected?!0:(En.container=document.querySelector(".xp-counter[data-xp-hud]"),En.container?(En.bar=En.container.querySelector(".xp-bar"),En.fill=En.container.querySelector(".xp-bar__fill"),En.xpLevelValue=En.container.querySelector(".xp-level-value"),En.progress=En.container.querySelector("[data-xp-progress]"),!0):!1)}function ag(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=gr.get("0");return a.clone?.()??a}if(r.bigInt!=null){sI(i);let a=i.toString(),u=gr.get(a);if(u)return u.clone?.()??u}let s=aI(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?_t.clone?.()??_t:(r.bigInt!=null&&gr.set(r.bigInt.toString(),s),s.clone?.()??s)}function Go(){xt=ag(X.xpLevel)}function fc(){X.xpLevel=Bt(),X.progress=Bt(),Go(),xn(!0)}function Qh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function pc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function xn(e=!1){let t=R?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=pc(X.xpLevel),o=n.bigInt,r=!n.finite,i=typeof X.xpLevel?.toStorage=="function"?X.xpLevel.toStorage():null;if(!e&&(r&&Hn||!r&&o!=null&&!Hn&&!Xn&&Gn!=null&&o===Gn||!r&&o==null&&Xn&&i&&Vn&&i===Vn))return;if(r){try{t.set(_t)}catch{}Gn=null,Hn=!0,Xn=!1,Vn=null;return}let s;if(o!=null&&o<=Jf){let f=c.fromInt(1),d=Number(o);for(let y=0;y<d;y+=1)f=f.mulDecimal("1.1",18);let m;try{m=c.fromAny(o.toString())}catch{m=c.fromInt(d)}typeof f.add=="function"?f=f.add(m):typeof m.add=="function"&&(f=m.add(f)),s=f.clone?.()??f}else s=og(X.xpLevel);let l=s.clone?.()??s,a=yr.size>0?Array.from(yr):typeof Kr=="function"?[Kr]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Gn=null,Hn=!0,Xn=!1,Vn=null):o!=null&&o<=Jf?(Gn=o,Hn=!1,Xn=!1,Vn=null):(Gn=null,Hn=!1,Xn=!0,Vn=i)}function tn(e=!1){let t=b();if(t==null)return Ca=null,Yf=!1,X.unlocked=!1,fc(),X;if(!e&&Yf&&t===Ca)return X;Ca=t,Yf=!0;try{let n=localStorage.getItem(_a(t));X.unlocked=n==="1"}catch{X.unlocked=!1}try{X.xpLevel=c.fromAny(localStorage.getItem(zr(t))??"0")}catch{X.xpLevel=Bt()}try{X.progress=c.fromAny(localStorage.getItem(Zi(t))??"0")}catch{X.progress=Bt()}return(fn(X.xpLevel)||fn(X.progress))&&(X.unlocked=!0),X.unlocked?(rg(),Go(),xn(!0),ig(),X):(fc(),X)}function Ta(){let e=b();if(e==null)return;let t={unlocked:X.unlocked?"1":"0",level:X.xpLevel.toStorage(),progress:X.progress.toStorage()};try{localStorage.setItem(_a(e),t.unlocked)}catch{}try{localStorage.setItem(zr(e),t.level)}catch{}try{localStorage.setItem(Zi(e),t.progress)}catch{}let n=(()=>{let r=X.unlocked,i=X.xpLevel,s=X.progress;try{r=localStorage.getItem(_a(e))==="1"}catch{}try{let l=localStorage.getItem(zr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(Zi(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();lt(_a(e),n.unlocked?"1":"0"),lt(zr(e),n.level?.toStorage?.()??t.level),lt(Zi(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==X.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(X.unlocked=n.unlocked,X.xpLevel=n.level,X.progress=n.progress,Go(),xn(!0),io())}function cI(){xn(!0);let e=Aa();if(typeof Zf=="function")try{let n=Zf({baseReward:e.clone?.()??e,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{R?.books?.addWithMultiplier?R.books.addWithMultiplier(e):R?.books?.add&&R.books.add(e)}catch{}let t=pc(X.xpLevel);t.finite?t.bigInt!=null?(Gn=t.bigInt,Hn=!1,Xn=!1,Vn=null):(Gn=null,Hn=!1,Xn=!0,Vn=typeof X.xpLevel?.toStorage=="function"?X.xpLevel.toStorage():null):(Gn=null,Hn=!0,Xn=!1,Vn=null)}function io(){if(!sg())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=En;if(!e)return;if(!X.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=te(xt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=jf(te(xt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}zi();return}e.removeAttribute("hidden");let i=xt,s=lI(X.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=te(X.xpLevel)),r){let a=te(X.progress),u=te(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=jf(te(X.progress)),u=jf(te(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}zi()}function Ji({forceReload:e=!1}={}){return sg(),tn(e),Go(),io(),ig(),rt()}function Zr(){if(tn(),X.unlocked)return io(),!1;fc(),X.unlocked=!0,Ta(),io(),xn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:rt()}))}catch{}return!0}function Qi({keepUnlock:e=!0}={}){tn();let t=X.unlocked;return fc(),X.unlocked=e?t||X.unlocked:!1,Ta(),io(),xn(!0),rt()}function es(e,{silent:t=!1}={}){tn();let n=Ca??b();if(n!=null&&Qh(Zi(n)))return{unlocked:X.unlocked,xpLevelsGained:Bt(),xpAdded:Bt(),xpLevel:X.xpLevel,progress:X.progress,requirement:xt,slot:n};if(!X.unlocked)return{unlocked:!1,xpLevelsGained:Bt(),xpAdded:Bt(),xpLevel:X.xpLevel,requirement:xt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Bt()}if(!o.isZero?.()){let d=vr.size>0?Array.from(vr):typeof jr=="function"?[jr]:[];for(let m of d)if(typeof m=="function")try{let y=m({baseGain:o.clone?.()??o,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});y instanceof c?o=y.clone?.()??y:y!=null&&(o=c.fromAny(y))}catch{}}if(o=Wn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return io(),{unlocked:!0,xpLevelsGained:Bt(),xpAdded:o,xpLevel:X.xpLevel,requirement:xt};X.progress=X.progress.add(o),Go();let r=n!=null&&Qh(zr(n)),i=fn(X.progress),s=fn(X.xpLevel),l=fn(o);if(i||s||l){let d=_t.clone?.()??_t;r||(X.xpLevel=d.clone?.()??d),X.progress=d.clone?.()??d,Go(),rg(),Ta(),io(),xn(!0);let m={unlocked:!0,xpLevelsGained:Bt(),xpAdded:o.clone?.()??o,xpLevel:X.xpLevel.clone?.()??X.xpLevel,progress:X.progress.clone?.()??X.progress,requirement:xt.clone?.()??xt,slot:n};if(Ma(m),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:m}))}catch{}return m}let a=Bt();if(X.progress.cmp(xt)<0){Ta(),io();let d={unlocked:!0,xpLevelsGained:Bt(),xpAdded:o,xpLevel:X.xpLevel,progress:X.progress,requirement:xt,slot:n};if(Ma(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=ke(X.progress),m=.08118668602542883,y=ke(xt);if(d-y>2){let g=X.xpLevel,v=d-y,E=Math.floor(v/m);if(E>10){let L=BigInt(Math.max(0,E-5));if(L>0n){let M=c.fromAny(L.toString());if(X.xpLevel=X.xpLevel.add(M),a=a.add(M),Go(),R?.books?.add)try{let N=M.clone();R.books.add(N)}catch{}}}}let p=0,h=500;for(;X.progress.cmp?.(xt)>=0&&p<h&&(X.progress=X.progress.sub(xt),X.xpLevel=X.xpLevel.add(Aa()),a=a.add(Aa()),cI(),Go(),!fn(xt));)p+=1;p>=h&&X.progress.cmp(xt)>=0&&Go()}Ta(),io();let u=pc(X.xpLevel);u.finite?u.bigInt!=null?(Gn=u.bigInt,Hn=!1,Xn=!1,Vn=null):(Gn=null,Hn=!1,Xn=!0,Vn=typeof X.xpLevel?.toStorage=="function"?X.xpLevel.toStorage():null):(Gn=null,Hn=!0,Xn=!1,Vn=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:X.xpLevel.clone?.()??X.xpLevel,progress:X.progress.clone?.()??X.progress,requirement:xt.clone?.()??xt,slot:n};if(Ma(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function rt(){return tn(),{unlocked:X.unlocked,xpLevel:X.xpLevel.clone?.()??X.xpLevel,progress:X.progress.clone?.()??X.progress,requirement:xt.clone?.()??xt}}function mc(e={}){tn();let t=Ca??b(),n={...rt(),slot:t,...e};if(Ma(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function dn(){return tn(),!!X.unlocked}function hc(e){return ag(e)}function gc(){tn();let e=Aa(),t=vr.size>0?Array.from(vr):typeof jr=="function"?[jr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:X.xpLevel.clone?.()??X.xpLevel,xpUnlocked:X.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function nd(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=pc(t),o=n.bigInt;if(!n.finite)return _t.clone?.()??_t;let i;if(o!=null&&o<=Jf){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=og(t);let s=i.clone?.()??i,l=yr.size>0?Array.from(yr):typeof Kr=="function"?[Kr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!X.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function lg(e){Kr=typeof e=="function"?e:null,yr.clear(),Kr&&yr.add(Kr),tn(),xn(!0)}function nn(){tn(),xn(!0)}function cg(e){jr=typeof e=="function"?e:null,vr.clear(),jr&&vr.add(jr)}function xo(e){return typeof e!="function"?()=>{}:(yr.add(e),tn(),xn(!0),()=>{yr.delete(e),tn(),xn(!0)})}function br(e){return typeof e!="function"?()=>{}:(vr.add(e),tn(),()=>{vr.delete(e)})}function yc(e){Zf=typeof e=="function"?e:null}var td,_a,zr,Zi,Ca,Yf,xt,gr,ji,_t,Gn,Hn,Xn,Vn,Kr,jr,yr,vr,Zf,Kh,m_,h_,Jf,eg,eI,tI,tg,X,ka,En,Qf,Zh,ed,Wf,Yn=$e(()=>{Et();St();ts();Wt();Vf();td="ccc:xp",_a=e=>`${td}:unlocked:${e}`,zr=e=>`${td}:level:${e}`,Zi=e=>`${td}:progress:${e}`;Ca=null,Yf=!1,xt=c.fromInt(10),gr=new Map;gr.set("0",xt);ji=0n,_t=c.fromAny("Infinity"),Gn=null,Hn=!1,Xn=!1,Vn=null,Kr=null,jr=null,yr=new Set,vr=new Set,Zf=null,Kh=5000n,m_=Math.log10(11/10),h_=Math.log10(5/2),Jf=200n,eg="0.04139268515822507",eI="0.3979400086720376",tI="0.1",tg=c.fromScientific(String(c.MAX_E));X={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};ka=new Set;En={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};Qf=[],Zh=!1,ed=null,Wf=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Ji,unlockXpSystem:Zr,addXp:es,getXpState:rt,broadcastXpChange:mc,isXpSystemUnlocked:dn,getXpRequirementForXpLevel:hc,getXpGainMultiplier:gc,setExternalCoinMultiplierProvider:lg,addExternalCoinMultiplierProvider:xo,refreshCoinMultiplierFromXpLevel:nn,setExternalXpGainMultiplierProvider:cg,addExternalXpGainMultiplierProvider:br,setExternalBookRewardProvider:yc,resetXpProgress:Qi}))});var yg={};vt(yg,{GHOST_TAP_TIMEOUT_MS:()=>uI,clearGhostTapTarget:()=>Na,consumeGhostTapGuard:()=>gg,initGlobalGhostTap:()=>SI,installGhostTapGuard:()=>bI,markGhostTapTarget:()=>hg,setGhostTapSelector:()=>II,shouldSkipGhostTap:()=>so,suppressNextGhostTap:()=>Lo});function Xo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function id(){return typeof document>"u"?null:document}function pI(e){if(!id())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(rd)}function Na(e){e&&(e[vc]=0)}function hg(e,t=0,n=null){if(!e)return;let o=Xo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[vc]=o+r:e[vc]=0,dI=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&Lo(i)}function gg(e){if(typeof window>"u")return!1;let t=window[ns];return typeof t!="number"?!1:Xo()<=t?!0:(window[ns]=null,!1)}function so(e){if(!e)return!1;let t=Number(e[vc]||0);return!Number.isFinite(t)||t<=0?!1:Xo()<=t?(Na(e),!0):(Na(e),!1)}function Lo(e=0){if(typeof window>"u")return;let t=Xo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[ns]=null;return}let o=t+n,r=typeof window[ns]=="number"?window[ns]:0;window[ns]=Math.max(r,o)}function mI(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Sc=Sr=Xo(),Ho=0))}function hI(e){Sc=Sr=Xo(),Ho=0}function gI(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Xo();Sr>0&&(Ho=t-Sr),Sc=t}function yI(){let e=Xo();Sr>0&&(Ho=e-Sr),Sc=e}function vI(e){if(!e.isTrusted)return;let t=Xo(),n=Sr>0?t-Sr:-1,o=pI(e.target);if(so(o)){Ho=0,e.preventDefault(),e.stopImmediatePropagation();return}if(gg(o)){o&&Na(o),Ho=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Ho||n)>=mg){Na(o),Ho=0,e.preventDefault(),e.stopImmediatePropagation();return}Ho=0}function bI(e={}){if(fg)return;let t=id();!t||typeof window>"u"||(fg=!0,od="PointerEvent"in window,dg=!od&&"ontouchstart"in window,e.selector&&(rd=`${e.selector}, ${bc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(mg=e.longPressMs),t.addEventListener("click",vI,!0),od?(t.addEventListener("pointerdown",mI,{capture:!0,passive:!1}),t.addEventListener("pointerup",gI,{capture:!0,passive:!0})):dg&&(t.addEventListener("touchstart",hI,{capture:!0,passive:!1}),t.addEventListener("touchend",yI,{capture:!0,passive:!0})))}function pg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(bc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(hg(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function SI(){let e=id();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",pg,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",pg,{capture:!1,passive:!1})}function II(e){e&&(rd=`${e}, ${bc}`)}var uI,vc,ns,bc,fI,fg,rd,od,dg,dI,Sc,Sr,Ho,mg,os=$e(()=>{uI=0,vc=Symbol("ccc:ghostTap:skipUntil"),ns="__cccGhostTapSkipUntil",bc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',fI=80,fg=!1,rd=bc,od=!1,dg=!1,dI=null,Sc=0,Sr=0,Ho=0,mg=fI});var sd,vg=$e(()=>{sd={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var bg={};vt(bg,{RateAccumulator:()=>Oa,pauseGameLoop:()=>fd,registerFrame:()=>_I,registerTick:()=>_o,resumeGameLoop:()=>dd,startGameLoop:()=>xI,stopGameLoop:()=>LI});function cd(e){e||(e=performance.now());let t=e;if(ud){Jr=t,ei=requestAnimationFrame(cd);return}Jr||(Jr=t);let n=(t-Jr)/1e3;Jr=t,n>60&&(n=60),n<0&&(n=0),Qr+=n;let o=0,r=250;for(;Qr>=Ra;){if(o>=r){Qr=Qr%Ra;break}ad.forEach(i=>{try{i(Ra)}catch(s){console.error("Error in game tick listener:",s)}}),Qr-=Ra,o++}if(ld.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),rs===0||is===0)rs=Date.now(),is=t;else{let i=t-is;if(i>EI){let s=Date.now(),l=s-rs;l<-1e3?wn():l>i+1e4&&wn(),rs=s,is=t}}ei=requestAnimationFrame(cd)}function fd(){ud=!0}function dd(){ud=!1,Jr=performance.now(),Qr=0,rs=0,is=0}function xI(){ei||(Jr=performance.now(),Qr=0,rs=0,is=0,ei=requestAnimationFrame(cd))}function LI(){ei&&(cancelAnimationFrame(ei),ei=null)}function _o(e){return typeof e!="function"?()=>{}:(ad.add(e),()=>{ad.delete(e)})}function _I(e){return typeof e!="function"?()=>{}:(ld.add(e),()=>{ld.delete(e)})}var wI,Ra,ad,ld,ei,ud,Jr,Qr,rs,is,EI,Oa,ti=$e(()=>{St();wI=20,Ra=1/wI,ad=new Set,ld=new Set,ei=null,ud=!1,Jr=0,Qr=0,rs=0,is=0,EI=2e3;Oa=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Ra;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ze,ni,Pa,Ba,Fa,Ua,ao,Da,ss,CI,MI,TI,kI,AI,Sg,oi=$e(()=>{Et();Ze="automation",ni=1,Pa=2,Ba=3,Fa=4,Ua=5,ao=6,Da=7,ss={[Pa]:"coins",[Ba]:"books",[Fa]:"gold",[Ua]:"magic",[Da]:"dna"},CI="img/misc/mysterious.webp",MI="img/misc/locked.webp",TI="Hidden Upgrade",kI="Locked Upgrade",AI=[{area:Ze,id:ni,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ze,id:Pa,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ze,id:Ba,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ze,id:Fa,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ze,id:Ua,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ze,id:ao,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}},{area:Ze,id:Da,title:"Autobuy DNA Upgrades",desc:"Automatically buys DNA upgrades",icon:"sc_upg_icons/autobuy_dna.webp",lvlCap:1,baseCost:1e27,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e27")},effectSummary(){return null},computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=11||t===1/0)&&(n=!0):typeof t=="bigint"?t>=11n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=11)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};if(!e.surgeUnlocked)return{locked:!0,iconOverride:MI,titleOverride:kI,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0};let o="Reach Surge 11 to reveal this upgrade";return{locked:!0,iconOverride:CI,titleOverride:TI,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}],Sg=AI.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var _g={};vt(_g,{getLabCost:()=>xg,getLabLevel:()=>Kt,getLabLevelFromCoins:()=>Lg,getLabLevelKey:()=>md,getRpMult:()=>fs,getRpMultBase:()=>xc,hasVisitedLab:()=>us,initLabLogic:()=>NI,initLabTab:()=>yd,setLabLevel:()=>si,setLabVisited:()=>Eg,updateLabLevel:()=>hd,updateLabTab:()=>vd});function qa(){let e=b();if(Ha=e,e==null){Vo=c.fromInt(0),ii=!1;return}try{let t=localStorage.getItem(Ec(e));t?Vo=c.fromAny(t):Vo=c.fromInt(0)}catch{Vo=c.fromInt(0)}try{ii=localStorage.getItem(wg(e))==="1"}catch{ii=!1}}function us(){let e=b();return e==null?!1:((Ha!==e||ii===null)&&qa(),ii)}function Eg(e){let t=b();if(t==null)return;let n=!!e;if(!(ii===n&&Ha===t)){ii=n;try{localStorage.setItem(wg(t),n?"1":"0")}catch{}}}function Kt(){let e=b();return e==null?c.fromInt(0):R.coins.value.isInfinite()?c.fromAny("Infinity"):((Ha!==e||Vo===null)&&qa(),Vo)}function si(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((Ha!==t||Vo===null)&&qa(),n.cmp(Vo)===0)return;Vo=n,localStorage.setItem(Ec(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function xg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Lg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function hd(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Ec(e)))return;let t=R.coins.value,n=Kt();if(t.isInfinite()){n.isInfinite()||si(c.fromAny("Infinity"));return}let o=Lg(t);o.cmp(n)>0&&si(o)}function NI(){qa(),typeof window<"u"&&window.addEventListener("saveSlot:change",qa),_o(hd),_o(Cg),Mg()}function gd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function RI(e){if(!e||typeof e!="object")return 0;if(gd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function Ig(e){if(gd(e)||typeof e.cmp=="function"&&e.cmp(OI)>=0)return cs.clone?.()??cs;let t=e.floorToInteger(),n=e.sub(t),o=RI(n);if(!Number.isFinite(o))return cs.clone?.()??cs;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return cs.clone?.()??cs;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),p=Number(y),h=d-y;return new c(a,{base:p,offset:h})}function xc(){let e=Kt();if(gd(e))return c.fromAny("Infinity");if(Fe(12)){let o=kt(),r=10*o,i=2+o,s=Math.log10(i).toFixed(18),a=e.mulDecimal(s,18).add(c.fromAny(String(r)));return Ig(a)}let n=e.mulDecimal("0.3010299956639812",18);return Ig(n)}function fs(){let e=xc();return typeof Wn=="function"?Wn("rp",e):e}function yd(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",$a&&$a.destroy(),$a=new pd(e))}function vd(){Eg(!0),$a&&$a.resize()}var Ir,as,ls,wg,Ec,Vo,ii,Ha,md,cs,OI,$a,Ic,pd,ai=$e(()=>{St();uo();Et();Wt();zn();ti();ts();li();ci();co();Ir=1e308,as=1e300,ls=1e-300,wg=e=>`ccc:lab:visited:${e}`,Ec=e=>`ccc:lab:level:${e}`,Vo=null,ii=null,Ha=null;md=e=>Ec(e);cs=c.fromAny("Infinity"),OI=c.fromScientific(String(c.MAX_E));$a=null;Ic=512*.95,pd=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${te(Kt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),hd()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami Exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=Je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>Ir&&(this.camX=Ir),this.camX<-Ir&&(this.camX=-Ir),this.camY>Ir&&(this.camY=Ir),this.camY<-Ir&&(this.camY=-Ir),this.zoom>as&&(this.zoom=as),this.zoom<ls&&(this.zoom=ls)}update(t){this.checkBounds();let n=Kt(),o=xg(n.add(1)),r=Ln(),i=Co(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${te(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${te(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami Exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let m=this.bursts[d];m.time+=t;for(let y of m.particles)y.x+=y.vx*t,y.y+=y.vy*t,y.vx*=.95,y.vy*=.95;m.time>=m.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),m=(C,U)=>{if(U<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*U})`,t.lineWidth=1,t.beginPath();let T=Math.floor((this.camX-n/2/r)/C)*C,_=Math.ceil((this.camX+n/2/r)/C)*C;if((_-T)/C>1e3)return;for(let se=T;se<=_&&!(se+C<=se);se+=C){let de=(se-this.camX)*r+n/2;t.moveTo(de,0),t.lineTo(de,o)}let V=Math.floor((this.camY-o/2/r)/C)*C,J=Math.ceil((this.camY+o/2/r)/C)*C;for(let se=V;se<=J&&!(se+C<=se);se+=C){let de=(se-this.camY)*r+o/2;t.moveTo(0,de),t.lineTo(n,de)}t.stroke()},y=d*r,p=Math.max(0,Math.min(1,(y-15)/25));m(d,p),m(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let h=(0-this.camY)*r+o/2;h>=-10&&h<=o+10&&(t.moveTo(0,h),t.lineTo(n,h));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let v=[],E=new Map;for(let C of Dt)wr(C.id)&&(v.push(C),E.set(C.id,this.getNodePosition(C)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let C of v)if(C.parentIds&&C.parentIds.length>0)for(let U of C.parentIds){let T=Dt.find(_=>_.id===U);if(T&&E.has(T.id)){let _=E.get(T.id),V=E.get(C.id),J=(_.x-this.camX)*r+n/2,se=(_.y-this.camY)*r+o/2,de=(V.x-this.camX)*r+n/2,ye=(V.y-this.camY)*r+o/2;t.moveTo(J,se),t.lineTo(de,ye)}}t.stroke();let L=Ic,M=L*r,q=L*1.6*r;for(let C of v){let U=E.get(C.id),T=(U.x-this.camX)*r+n/2,_=(U.y-this.camY)*r+o/2,V=ct(C.id),J=V>=C.maxLevel,se=!0;if(T+q/2<0||T-q/2>n||_+q*.8<0||_-q/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,T-q/2,_-q/2,q,q),J?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,T-q/2,_-q/2,q,q):ri(C.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,T-q/2,_-q/2,q,q);let ye=this.nodeImages[C.id];if(ye||(ye=new Image,ye.src="img/"+C.icon,this.nodeImages[C.id]=ye),ye.complete&&ye.naturalWidth!==0&&t.drawImage(ye,T-M/2,_-M/2,M,M),se){let Re=wc(C.id),Ce=0;if(J)Ce=1;else if(Re.isInfinite?.()||typeof Re.cmp=="function"&&Re.cmp(c.fromAny("Infinity"))===0)Ce=0;else{let K=lo(C.id);if(K.isZero?.())Ce=0;else try{if(Re.isZero?.())Ce=1;else{let pe=K.div(Re).toScientific(5);Ce=Number(pe)}}catch{Ce=0}}Ce=Math.max(0,Math.min(1,Ce));let F=q*.96,Y=q*.18,$=T-F/2,H=_+q/2+q*.05;t.fillStyle="#111",t.fillRect($,H,F,Y);let j=t.createLinearGradient($,H,$,H+Y);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,H,F*Ce,Y),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,H,F,Y),t.fillStyle="#fff",t.font=`bold ${Y*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,Y*.08);let W=`Level ${V}`;J&&(W=C.maxLevel===1?"UNLOCKED":"MAXED");let re=t.measureText(W),x=H+Y/2+(re.actualBoundingBoxAscent-re.actualBoundingBoxDescent)/2;t.strokeText(W,$+F/2,x),t.fillText(W,$+F/2,x)}}let P=35,G=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let C of this.bursts){let U=(C.x-this.camX)*this.zoom+n/2,T=(C.y-this.camY)*this.zoom+o/2;for(let _=0;_<G.length;_++){let V=G[_],J=C.time-V.delay;if(J>0&&J<V.dur){let se=J/V.dur,de=1-Math.pow(1-se,3),ye=P*de,Re=Math.max(0,1-Math.pow(se,2)),Ce=1+_*.5,F=t.createRadialGradient(U,T,ye*.6,U,T,ye);F.addColorStop(0,"rgba(255, 200, 50, 0)"),F.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,Re*.15*Ce)})`),F.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,Re*.2*Ce)})`),F.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=F,t.beginPath(),t.arc(U,T,ye,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let _ of C.particles)if(C.time<_.life){let V=1-C.time/_.life,J=U+_.x,se=T+_.y;t.fillStyle=`rgba(255, 255, 150, ${V})`,t.beginPath(),t.arc(J,se,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Ic/2*1.6;for(let u of Dt){if(!wr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Dt.find(m=>m.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.innerHTML=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let m=ri(t);Ga(t,!m),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),bd(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Dt.find(l=>l.id===this.activeOverlayId);if(!t||!wr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=ct(t.id),o=lo(t.id),r=wc(t.id),i=ri(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.textContent=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?te(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?te(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${te(o)} / ${te(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Ic/2*1.6;for(let u of Dt){if(!wr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){if(ct(u.id)>=u.maxLevel)return;let h=ri(u.id);Ga(u.id,!h),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=Ic/2*1.6;for(let u of Dt){if(!wr(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,m=s-f.y;if(Math.sqrt(d*d+m*m)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<ls&&(i=ls),i>as&&(i=as);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<ls&&(i=ls),i>as&&(i=as);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});function kg(e){typeof e=="function"&&Tg.push(e)}function Id(){Xa=null}function _c(){Xa=null;try{Lc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{nn()}catch{}}function wd(e){return typeof e=="function"&&Lc.push(e),()=>{Lc=Lc.filter(t=>t!==e)}}function BI(e){let t=pt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return ve(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function FI(){try{return!!dn()}catch{return!1}}function Va(e){let t=R?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(FI())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=At(Ie.STARTER_COVE,xe.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=BI(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function ui(e=Ie.STARTER_COVE){if(Xa)return Xa;let t=Ct(e),n=[];if(e===Ie.STARTER_COVE&&Ie.DNA){let i=Ct(Ie.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),goldValue:c.fromInt(1),magicValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=_n(s,i.id),a=Ve(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:m,mpMult:y}=Wo(i,l,s);r.xpValue=It(r.xpValue,d),r.coinValue=It(r.coinValue,m),r.mpValue=It(r.mpValue,y),u=It(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=It(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=It(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=It(r.mpValue,u);else if(i.effectType==="gold_value")r.goldValue=It(r.goldValue,u);else if(i.effectType==="magic_value")r.magicValue=It(r.magicValue,u);else if(i.effectType==="book_value")r.bookValue=It(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of Tg)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return Xa=r,r}function ds(e){let t=ui(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:PI*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue,goldValueMultiplier:t.goldValue,magicValueMultiplier:t.magicValue}}function Sd(){let{goldValue:e,magicValue:t}=ui(Ie.STARTER_COVE);try{R.gold?.mult?.set&&R.gold.mult.set(e)}catch{}try{R.magic?.mult?.set&&R.magic.mult.set(t)}catch{}}function Cc(){try{let{mpValue:e}=ui(Ie.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Mc(){try{let{magnetRadius:e}=ui(Ie.STARTER_COVE);return e||0}catch{return 0}}function Ag(){try{Yo()}catch{}Sd(),wd(Sd);try{xo(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=ui(Ie.STARTER_COVE);return It(n,o)})}catch{}try{br(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=ui(Ie.STARTER_COVE);return It(n,o)})}catch{}try{fi(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=ui(Ie.STARTER_COVE);return It(n,o)})}catch{}Va(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{Va()}catch{}try{nn()}catch{}try{Sd()}catch{}})}var PI,Xa,Lc,Tg,Ed=$e(()=>{Et();St();Mo();Yn();To();co();PI=1,Xa=null,Lc=[],Tg=[]});var Bg={};vt(Bg,{addExternalEacAmountMultiplierProvider:()=>_d,addExternalEacMultiplierProvider:()=>UI,getAutobuyerToggle:()=>di,getEacAmountMultiplier:()=>Ac,initAutomationEffects:()=>HI,setAutobuyerToggle:()=>Er,setTsunamiBonusProvider:()=>Ld,updateAutomation:()=>Pg});function Ld(e){Ng=e}function UI(e){typeof e=="function"&&Rg.push(e)}function _d(e){typeof e=="function"&&Og.push(e)}function Ac(){let e=1;if(Fe(2))if(Fe(8)){let t=Ln(),n=Ng(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of Og)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function Cd(e){kc!==e&&(ps.clear(),kc=e)}function di(e,t){let n=b();Cd(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(ps.has(r))return ps.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return ps.set(r,i),i}function Er(e,t,n){let o=b();Cd(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);ps.set(i,s);try{localStorage.setItem(i,s)}catch{}}function DI(e){Pg(e),GI(e)}function $I(){if(Tc)return Tc;let e=[...Ct(Ie.STARTER_COVE),...Ct(Ie.DNA)],t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Tc=t,Tc}function qI(e){if(!(!e||e.length===0))for(let t of e){let n=t.area||Ie.STARTER_COVE;if(di(n,t.id)!=="0"){let r=At(n,t.id),i=t.lvlCap??1/0;r<i&&Td(n,t.id)}}}function GI(e){let t=b();Cd(t);let n=$I();for(let[r,i]of Object.entries(ss)){let s=Number(r);At(Ze,s)>0&&n[i]&&qI(n[i])}At(Ze,ao)>0&&(xd++,xd>=5&&(xd=0,di(Ze,ao)!=="0"&&Nc()))}function Pg(e){let n=At(Ze,ni);for(let r of Rg)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){Ya=0;return}Ya+=e;let o=1/n;if(Ya>=o){let r=Math.floor(Ya/o);if(r>0){let i=r;i*=Ac(),Md(i),Ya-=r*o}}}function HI(){_o(DI),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==kc&&(ps.clear(),kc=t)})}var Ya,xd,Ng,Rg,Og,ps,kc,Tc,ms=$e(()=>{ti();co();Wa();oi();hs();St();zn();Ya=0,xd=0,Ng=()=>0;Rg=[];Og=[];ps=new Map,kc=null;Tc=null});function kd(){let e=b();if(Gg=e,e==null){za=!1;return}try{za=localStorage.getItem(XI(e))==="1"}catch{za=!1}}function zo(e){return gs.nodes[e]||(gs.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),gs.nodes[e]}function VI(e,t){let n=zo(t);try{let o=localStorage.getItem(Ka(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(ja(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem($g(e,t));n.active=i==="1";let s=localStorage.getItem(qg(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function Fg(){kd();let e=b();gs.nodes={},Kn=null,e!=null&&Dt.forEach(t=>{VI(e,t.id),gs.nodes[t.id].active&&(Kn=t.id)})}function Ug(){let e=b();e!=null&&Dt.forEach(t=>{let n=gs.nodes[t.id];if(n)try{localStorage.setItem(ja(e,t.id),n.rp.toStorage())}catch{}})}function ct(e){return zo(e).level}function xr(e,t){let n=b();if(n==null||zt(Ka(n,e)))return!1;let o=zo(e);o.level=t;try{localStorage.setItem(Ka(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function lo(e){return zo(e).rp}function ys(e,t){let n=b();if(n!=null&&zt(ja(n,e)))return;let o=zo(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function ri(e){return zo(e).active}function Ga(e,t){let n=b();if(n==null)return;let o=!!t;o?(Kn!==null&&Kn!==e&&Ga(Kn,!1),Kn=e):Kn===e&&(Kn=null);let r=zo(e);if(r.active!==o){r.active=o;try{localStorage.setItem($g(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function Dg(e,t){let n=b();if(n==null)return;let o=zo(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(qg(n,e),o.discovered?"1":"0")}catch{}}}function wr(e){let t=fo.get(e);if(!t)return!1;if(zo(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return Dg(e,!0),!0;if((e===5||e===6)&&((Gg!==b()||za===null)&&kd(),!za))return!1;for(let o of t.parentIds){let r=fo.get(o);if(!r)continue;if(ct(o)<r.maxLevel)return!1}return Dg(e,!0),!0}function wc(e){let t=fo.get(e);if(!t)return c.fromAny("Infinity");let n=ct(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function Co(){let e=0,t=ct(1);t>0&&(e+=t*.01);let n=ct(10);return n>0&&(e+=n*.01),e}function Hg(){return ct(4)>=1}function Xg(e=[]){if(b()!=null){try{si(0)}catch{}Kn!==null&&Ga(Kn,!1),Dt.forEach(n=>{e.includes(n.id)||(xr(n.id,0),ys(n.id,c.fromInt(0)))})}}function Cg(e){let t=fs();if(t.isZero?.()||Kn===null)return;let n=fo.get(Kn);if(!n||!wr(n.id))return;let r=t.mulDecimal(e.toString(),18),i=lo(n.id);if(ct(n.id)>=n.maxLevel)return;let s=i.add(r);for(;;){let l=wc(n.id);if(s.cmp(l)<0||ct(n.id)>=n.maxLevel)break;s=s.sub(l);let a=ct(n.id);if(!xr(n.id,a+1))break}ys(n.id,s)}function Vg(){let e=fo.get(2);if(!e)return c.fromInt(1);let t=ct(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function Yg(){let e=fo.get(3);if(!e)return c.fromInt(1);let t=ct(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(2,t);return c.fromAny(n)}function Za(){let e=fo.get(5);if(!e)return c.fromInt(1);let t=ct(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function Ad(){let e=fo.get(6);if(!e)return c.fromInt(1);let t=ct(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(3,t);return c.fromAny(n)}function YI(){let e=fo.get(7);if(!e)return c.fromInt(1);let t=ct(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.1,t);return c.fromAny(n)}function Wg(){let e=fo.get(8);return e?1+ct(e.id)*.1:1}function zg(){let e=fo.get(9);return e?1+ct(e.id)*.1:1}function Mg(){xo(({baseMultiplier:e})=>{let t=Vg();return e.mulDecimal(t.toScientific())}),br(({baseGain:e})=>{let t=Yg();return e.mulDecimal(t.toScientific())}),kg(()=>Wg()),_d(()=>zg()),Ld(()=>Co()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&nn(),e&&e.id===8&&_c()})}var Ka,ja,$g,qg,XI,Dt,fo,za,Gg,gs,Kn,li=$e(()=>{Et();St();ai();Wt();Yn();Ed();ms();Ka=(e,t)=>`ccc:lab:node:level:${t}:${e}`,ja=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,$g=(e,t)=>`ccc:lab:node:active:${t}:${e}`,qg=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,XI=e=>`ccc:reset:experiment:completed:${e}`,Dt=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Ae(Vg())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Ae(Yg())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Ae(Za())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Ae(Ad())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e8,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Ae(YI())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Ae(Wg())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Ae(zg())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:`Increases the Tsunami Exponent by +0.01 per level\nThis node will scale <strong>10x</strong> RP each level`,baseRpReq:1e12,scale:10,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`}],fo=new Map(Dt.map(e=>[e.id,e])),za=null,Gg=null,gs={nodes:{}},Kn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",Fg),setInterval(Ug,1e3),window.addEventListener("beforeunload",Ug),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&kd()}),Fg());window.RESEARCH_NODES=Dt;window.isResearchNodeVisible=wr});var ey={};vt(ey,{getBookProductionRate:()=>_r,getEffectiveTsunamiNerf:()=>kt,getSurge15Multiplier:()=>Rc,getSurge6WealthMultipliers:()=>Oc,getTsunamiNerf:()=>Ln,getTsunamiNerfKey:()=>Rd,getTsunamiSequenceSeen:()=>pn,initSurgeEffects:()=>KI,isSurgeActive:()=>Fe,setTsunamiNerf:()=>pi,setTsunamiSequenceSeen:()=>jo});function Rd(e){return Nd(e)}function pn(){let e=b();if(e==null)return!1;try{return localStorage.getItem(Qg(e))==="1"}catch{return!1}}function jo(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(Qg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Ln(){return Lr}function kt(){let t=Ln()+Co();return t>1&&(t=1),t}function pi(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=Nd(n);if(zt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}Lr=t,vs();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function Fe(e){return po===1/0||typeof po=="string"&&po==="Infinity"||po===Number.POSITIVE_INFINITY?!0:typeof po=="bigint"?po>=BigInt(e):typeof po=="number"?po>=e:!1}function bs(e){if(!Fe(8))return e;let t=ke(e);if(!Number.isFinite(t))return e;let n=kt();return ve(t*n)}function vs(){let e=jn();po=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(Fe(8)){let n=kt(),o=Math.log10(Kg);Ko=ve(o*n)}else Ko=c.fromInt(Kg);else Ko=c.fromInt(1)}function Rc(e=!1){if(!e&&!Fe(15))return c.fromInt(1);let t=R.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=ke(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return ve(l)})(t);return Fe(8)?bs(o):o}function Oc(){if(!Fe(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(m,y=0)=>{if(!m){if(y<=0)return c.fromInt(1);let L=Math.log10(y)/3;if(L<=0)return c.fromInt(1);let M=L*Math.log10(2);return ve(M)}if(m.isInfinite?.())return c.fromAny("Infinity");let p=ke(m),h=p;if(Number.isFinite(p)){if(p<15&&y>0)try{let E=Number(m.toPlainIntegerString());if(Number.isFinite(E)){let L=E+y;L>0&&(h=Math.log10(L))}}catch{}}else if(y>0)h=Math.log10(y);else return c.fromInt(1);let g=h/6;if(g<=0)return c.fromInt(1);let v=g*Math.log10(2);return ve(v)},t=e(R.coins?.value),n=R.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(R.gold?.value),s=e(R.magic?.value),l=t,a=r,u=i,f=s;Fe(8)&&(l=bs(t),a=bs(r),u=bs(i),f=bs(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function _r(){if(!Fe(3))return c.fromInt(0);let t=rt().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(jg),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=ve(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*jg;n=ve(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),R.books?.mult){let o=R.books.mult.get();n=n.mulBigNumInteger(o)}return Fe(8)&&(n=bs(n)),n}function WI(e){if(Fe(3)){Zg||(Zg=new Oa("books",R));let t=_r();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);R.books&&R.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,R.books&&R.books.add(c.fromInt(o))}}}if(Fe(13)){let o=2*(kt()*1.5-.5)-2,r=ve(o),i=R.coins?.value,s=rt(),l=Pc(i,s.xpLevel),a=R.gold?.mult?.applyTo?.(l)??l,u=Za();a=a.mulDecimal(u.toScientific());let d=a.mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.gold&&R.gold.add(d)}if(Fe(16)){let o=2*(kt()*1.5-.5)-2,r=ve(o),i=R.coins?.value,s=mi(),u=Bc(i,s).mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.magic&&R.magic.add(u)}}function Jg(e){if(e==null)return;let t=localStorage.getItem(Nd(e));t!==null?(Lr=Number(t),(Number.isNaN(Lr)||!Number.isFinite(Lr))&&(Lr=Fe(8)?0:1)):Fe(8)?Lr=0:Lr=1}function zI(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function KI(){let e=b();vs(),Jg(e),vs(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=po,n=Fe(8);vs();let o=po,r=Fe(8);!n&&r?(pi(0),pn()||jo(!0)):r?zI(t,o)>0&&(pi(0),pn()||jo(!0)):n&&!r&&pi(1)}),window.addEventListener("lab:node:change",()=>{vs()}),window.addEventListener("saveSlot:change",()=>{Jg(b()),vs()})),xo(({baseMultiplier:t})=>Ko.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Ko)),br(({baseGain:t})=>Ko.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Ko)),fi(({baseGain:t})=>Ko.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Ko)),fi(({baseGain:t})=>{if(!Fe(4))return t;let n=c.fromInt(4444e9);if(Fe(8)){let o=kt(),r=Math.log10(4444e9);n=ve(r*o)}return t.mulBigNumInteger(n)}),xo(({baseMultiplier:t})=>{if(!Fe(6))return t;let n=Oc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),xo(({baseMultiplier:t})=>{if(!Fe(15))return t;let n=Rc();return n.cmp(1)<=0?t:t.mulBigNumInteger(n)}),yc(({baseReward:t})=>Fe(3)?c.fromInt(0):t),_o(WI)}var Kg,jg,Nd,Qg,Ko,po,Zg,Lr,zn=$e(()=>{Et();St();Yn();To();Mo();ti();Et();li();Kg=10,jg=.08685889638,Nd=e=>`ccc:surge:tsunamiNerf:${e}`,Qg=e=>`ccc:unlock:tsunami:${e}`;Ko=c.fromInt(1),po=0n,Zg=null,Lr=0});var ly={};vt(ly,{getGearsProductionRate:()=>qc,getGenerationLevelKey:()=>yi,getGenerationUpgradeCost:()=>Cr,initWorkshopSystem:()=>ay,initWorkshopTab:()=>$d,performFreeGenerationUpgrade:()=>Nc,updateWorkshopTab:()=>mo});function Is(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*iw}function yi(e){return`ccc:workshop:genLevel:${e}`}function el(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(yi(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function nl(e){let t=b();if(!t)return!1;let n=yi(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function ol(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return Pd;if(t<=hi)return Pd+t*ny;Uc===null&&(Uc=Pd+hi*ny);let n=t-hi;if(t<=Ja)return Uc+n+Is(n,Ss);if(Dc===null){let d=Ja-hi;Dc=Uc+d+Is(d,Ss)}let o=t-Ja,r=t-hi,i=Ja-hi,s=o+(Is(r,Ss)-Is(i,Ss)),l=nw/tw,a=.5*l*o*o;if(t<=Fc)return Dc+s+a;if(Bd===null){let d=Fc-Ja,m=Fc-hi,y=d+(Is(m,Ss)-Is(i,Ss)),p=.5*l*d*d;Bd=Dc+y+p}let u=ow*(t-Fc);if(u>709)return 1/0;let f=Bd*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function Cr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=ol(t);return ve(n)}function Dd(e){let t,n=e;e instanceof c||(n=c.fromAny(e));let o=Fe(11)?ew:Fe(7)?QI:JI;if(n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let i=n.mulDecimal(o);if(n.cmp(9e15)<=0){let l=Number(n.toString())*o;t=ve(l)}else{let s=n.mulDecimal(o);if(s.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let l=Number(s.toScientific(10));l===1/0?t=c.fromAny("Infinity"):t=ve(l)}catch{t=c.fromAny("Infinity")}}}let r=R?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(r)}function lw(){let e=Cr(it);if(R.coins.value.cmp(e)<0)return;let t=it.add(1);nl(t)&&(it=t,R.coins.sub(e),mo(),on())}function cw(){if(!qt())return;let n=Dd(it).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&R.gears&&R.gears.add(n),it.cmp(20)<0){let r=Number(it.toPlainIntegerString()),s=Math.pow(Fe(11)?4:Fe(7)?3:2,r)/20,l=Math.floor(s),a=s-l;if(gi+=a,gi>=1){let u=Math.floor(gi);gi-=u,R.gears&&R.gears.add(u)}}else gi=0}function Ud(){R.gears&&R.gears.set(0),nl(c.zero())&&(it=c.zero()),gi=0,mo()}function ry(e){if(!e)return;let t=tl.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),tl.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;it.cmp(Od)>0?i=Od:i=Number(it.toPlainIntegerString());let s=Math.min(Math.floor(i),Od),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,m=Math.cos(d)*oy,y=Math.sin(d)*oy,p=Math.random()*360,h=(Math.random()<.5?-1:1)*(sw+Math.random()*aw);l.push({x:u,y:f,dx:m,dy:y,rotation:p,rotationSpeed:h,size:a})}for(;l.length>s;)l.pop()}function uw(e){let t="Click the big red button below to open the Automation Shop";Je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${jI}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${iy}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will <span data-workshop="production-verb">double</span> the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${ZI}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{lw()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),dw()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{Es("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(Jt&&Jt.isConnected){let a=Jt.querySelector(".workshop-side-left"),u=Jt.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let m=tl.get(d);if(m){let y=d.getBoundingClientRect(),p=window.devicePixelRatio||1;m.width=y.width,m.height=y.height;let h=Math.round(y.width*p),g=Math.round(y.height*p);if(m.canvas&&(m.canvas.width!==h||m.canvas.height!==g)&&(m.canvas.width=h,m.canvas.height=g,m.ctx.scale(p,p)),m.needsDistribution&&m.width>0&&m.height>0){m.needsDistribution=!1;for(let v of m.gears)v.x=Math.random()*(m.width-v.size),v.x<0&&(v.x=0),v.y=Math.random()*(m.height-v.size),v.y<0&&(v.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?sy():fw()},{root:null,threshold:0}).observe(e),Jt=e}function mo(){if(!Jt)return;let e=Jt.querySelector('[data-workshop="production-verb"]');if(e){let a=Fe(11)?"quadruple":Fe(7)?"triple":"double";e.textContent!==a&&(e.textContent=a)}let t=Jt.querySelector('[data-workshop="gears-amount"]'),n=Jt.querySelector('[data-workshop="gears-rate"]'),o=Jt.querySelector('[data-workshop="upgrade-cost"]'),r=Jt.querySelector('[data-workshop="upgrade-gen"]'),i=Dd(it),s=Cr(it);if(t&&(t.innerHTML=R.gears.fmt(R.gears.value)),n&&(n.innerHTML=te(i)),o){let a="Coins";try{a=!s.isInfinite()&&s.cmp(1)===0?"Coin":"Coins"}catch{}o.innerHTML=`${te(s)} ${a}`}if(r){let a=R.coins.value.cmp(s)>=0;r.disabled=!a;let u=At(Ze,ao),f=!1;if(u>0){let d=b(),m=d!=null?`:${d}`:"",y=`ccc:autobuy:${Ze}:${ao}${m}`;f=localStorage.getItem(y)!=="0"}f?r.classList.add("is-automated"):r.classList.remove("is-automated")}let l="";if(it.isInfinite()?l="Infinity":l=it.floorToInteger().toStorage(),l!==Fd){Fd=l;let a=Jt.querySelector(".workshop-side-left"),u=Jt.querySelector(".workshop-side-right");a&&ry(a),u&&ry(u)}}function fw(){ws&&(cancelAnimationFrame(ws),ws=null)}function sy(){if(ws)return;Qa=0;let e=t=>{if(Jt&&Jt.isConnected){let n=Jt.querySelector('[data-workshop="gears-amount"]');n&&!rl()&&(n.innerHTML=R.gears.fmt(R.gears.value)),Qa||(Qa=t);let o=(t-Qa)/1e3;Qa=t,o>.1&&(o=.1);for(let[r,i]of tl){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!$c.complete||$c.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,m=f.y+f.size/2;u.save(),u.translate(d,m),u.rotate(f.rotation*Math.PI/180),u.drawImage($c,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}ws=requestAnimationFrame(e)};ws=requestAnimationFrame(e)}function ay(){ty||(ty=!0,it=el(),_o(cw),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{it=el(),gi=0,qt()||Ud(),mo()}),window.addEventListener("currency:change",e=>{e.detail.key===Ne.COINS&&mo()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Ne.GEARS&&mo()}),window.addEventListener("debug:change",()=>{it=el(),mo()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(qt()||Ud())})))}function $d(e){ay(),!e.__workshopInit&&(e.__workshopInit=!0,it=el(),tl.clear(),Fd=-1,uw(e),typeof IntersectionObserver>"u"&&sy(),qt()||Ud(),mo())}function qc(){let e=el();return Dd(e)}function Nc(){let e=R.coins.value.isInfinite(),n=Cr(it).isInfinite();if(e&&n&&!it.isInfinite())return it=c.fromAny("Infinity"),nl(it),mo(),!0;if(R.coins.value.isZero())return!1;let o=ke(R.coins.value);if(!Number.isFinite(o))if(R.coins.value.inf)o=1/0;else return!1;if(ol(it)>o||it.cmp(9e15)>0)return!1;let r=Number(it.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);ol(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(it)>0&&nl(a)?(it=a,mo(),!0):!1}function dw(){if(R.coins.value.isInfinite()){Nc()&&on();return}let e=ke(R.coins.value);if(!Number.isFinite(e)&&R.coins.value.isZero()||ol(it)>e||it.cmp(9e15)>0)return;let t=Number(it.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);ol(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(it.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(Cr(c.fromInt(u)));if(l.cmp(R.coins.value)>0){let u=Cr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(it)>0&&nl(a)&&(it=a,R.coins.sub(l),mo(),on())}var iy,jI,$c,ZI,Od,Jt,ty,gi,it,Fd,ws,Pd,JI,QI,ew,hi,Ja,Fc,ny,Ss,tw,nw,ow,rw,iw,Uc,Dc,Bd,tl,oy,sw,aw,Qa,hs=$e(()=>{Et();Wt();St();ti();ci();Mo();co();uo();oi();zn();iy="img/currencies/gear/gear.webp",jI="img/currencies/gear/gear_plus_base.webp",$c=new Image;$c.src=iy;ZI="img/currencies/coin/coin.webp",Od=300,Jt=null,ty=!1,gi=0,it=c.zero(),Fd=-1,ws=null,Pd=12,JI=.3010299956639812,QI=.47712125471966244,ew=.6020599913279624,hi=1e6,Ja=1e9,Fc=1e12,ny=1,Ss=.001,tw=1e3,nw=Math.log10(1.00001),ow=23e-11,rw=Math.log(10),iw=1/rw;Uc=null,Dc=null,Bd=null;tl=new Map,oy=67,sw=67,aw=67;Qa=0});var fy={};vt(fy,{calculateOfflineRewards:()=>xs,calculatePreAutomationRewards:()=>Hc,formatTimeCompact:()=>Gc,grantOfflineRewards:()=>vi,initOfflineTracker:()=>hw,processOfflineProgress:()=>uy,showOfflinePanel:()=>Mr});function Gc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),v=g.mulBigNumInteger(l),E=t.sub(v),L=0;try{let M=E.div(c.fromInt(i)).floorToInteger();L=Number(M.toPlainIntegerString())}catch{L=0}return L===0?`${te(g)}y`:`${te(g)}y ${L}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let m=Math.floor(f/60),y=f%60;if(m<24)return y===0?`${m}h`:`${m}h ${y}m`;let p=Math.floor(m/24),h=m%24;return h===0?`${p}d`:`${p}d ${h}h`}function Mr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${Gc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let p=document.createElement("div");p.className="offline-pre-auto-note",p.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(p)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",pw.forEach(p=>{let h=p.key,g=e[h];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(h==="research_levels"){Array.isArray(g)&&g.forEach(P=>{let G=document.createElement("div");G.className="offline-row";let C=document.createElement("span");C.className="offline-plus",C.style.color="#004F96",C.textContent="+";let U=document.createElement("img");U.className="offline-icon",U.src=p.icon,U.alt="RP";let T=document.createElement("span");T.className="offline-text",T.style.color="#004F96";let _=c.fromInt(P.levels),V=_.cmp(c.fromInt(1))===0?"Level":"Levels";T.textContent=`${te(_)} ${V} of ${P.name}`,G.appendChild(C),G.appendChild(U),G.appendChild(T),f.appendChild(G)});return}let v=document.createElement("div");v.className="offline-row";let E=document.createElement("span");E.className="offline-plus",E.classList.add(`text-${h}`),E.textContent="+";let L=document.createElement("img");L.className="offline-icon",L.src=p.icon,L.alt=h;let M=document.createElement("span");M.className="offline-text",M.classList.add(`text-${h}`);let N=!1;g instanceof c?N=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:N=Number(g)===1;let q=N?p.singular:p.plural;M.innerHTML=`${te(g)} ${q}`,v.appendChild(E),v.appendChild(L),v.appendChild(M),f.appendChild(v)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let m=document.createElement("button");m.type="button",m.className="offline-close-btn",m.textContent="Close";let y=()=>{r.remove()};return m.addEventListener("click",y),r.addEventListener("click",p=>{p.target===r&&y()}),d.appendChild(m),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{Ls(i,a,".offline-scroll-container")}),r}function mw(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function xs(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=fs?fs():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Dt.filter(y=>ri(y.id)),d=[],m={};for(let y of f){let p=ct(y.id),h=lo(y.id).add(u),g=0,v=y.maxLevel;for(;p<v;){let E=mw(y,p);if(E.isInfinite&&E.isInfinite()||h.cmp(E)<0)break;h=h.sub(E),p++,g++}g>0&&d.push({name:y.title,levels:g}),m[y.id]={level:p,rp:h}}d.length>0&&(o.research_levels=d),Object.keys(m).length>0&&(o.research_progress=m)}let s=(qc?qc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||qn("gears",t)||(o.gears=s);let l=_r?_r():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||qn("books",t)||(o.books=u)}let a=At(Ze,ni)||0;if(a>0){let u=1;Fe(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=Vc(),m=d.coins.mulBigNumInteger(f),y=d.xp.mulBigNumInteger(f),p=d.mp.mulBigNumInteger(f);m.isZero()||qn("coins",t)||(o.coins=m),y.isZero()||zt(`ccc:xp:progress:${t}`)||(o.xp=y),p.isZero()||zt(`ccc:mutation:progress:${t}`)||(o.mp=p)}}return o}function vi(e){if(b()!=null){if(e.xp)try{let n=es(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=_s(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(xr(r,o.level),ys(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||R[n]&&typeof R[n].add=="function"&&R[n].add(e[n])}}function Hc(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=Zn(),i=c.fromInt(1);try{let l=ds(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Wn=="function"){let l=Wn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=Vc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||zt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||zt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function uy(){let e=b();if(e==null)return;let t=Bf(),n=Date.now();if(t<=0)return;if(n<t-1e4){wn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!qt()){let l=Hc(r),a=Object.keys(l).length>0;return a&&(vi(l),Mr(l,o,!0)),a}let i=xs(r),s=Object.keys(i).length>0;return s&&(vi(i),Mr(i,o)),s}function hw(e,t){cy||(cy=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?fd():(dd(),uy()&&typeof t=="function"&&t())))}))}var cy,pw,Xc=$e(()=>{St();hs();Mo();ti();St();Et();Wt();ci();uo();co();ai();li();oi();Wa();Yn();To();zn();ts();cy=!1;pw=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Mr});function Hd(e){let t=24,n=Date.now();try{let o=localStorage.getItem(qd(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Gd(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(qd(e),"24"),localStorage.setItem(Gd(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function py(e,t,n){try{localStorage.setItem(qd(e),String(t)),localStorage.setItem(Gd(e),String(n))}catch{}}function my(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=Hd(e);if(t>=Cs)return;let o=Date.now(),r=o-n;if(r>=Yc){let i=Math.floor(r/Yc);t+=i,t>=Cs?(t=Cs,n=o):n+=i*Yc,py(e,t,n),Tr&&Tr.classList.contains("is-active")&&Zo(!0)}}function yw(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function vw(){let e=b();if(e==null)return;my();let{charges:t,lastCharge:n}=Hd(e);t<=0||(t>=Cs&&(n=Date.now()-50),t--,py(e,t,n),Zo(!0),il&&clearInterval(il),il=setInterval(()=>{Zo()},1e3),ht(gw,{volume:.5}),yw(),setTimeout(()=>{let o=xs(dy);vi(o),Mr(o,dy*1e3)},7250))}function Zo(e=!1){if(!Tr||!Tr.classList.contains("is-active"))return;let t=b();if(t==null)return;e||my();let{charges:n,lastCharge:o}=Hd(t),r=Tr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${Cs}</span>`);let i=Tr.querySelector(".warp-timer");if(i)if(n>=Cs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+Yc,u=Math.max(0,a-l);i.textContent=`Next warp in ${Gc(u)}`}let s=Tr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function hy(e){if(!e||e.__warpInit)return;e.__warpInit=!0,Tr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",vw),il||(il=setInterval(()=>{Zo()},1e3)),Zo()}var qd,Gd,Cs,Yc,dy,gw,Tr,il,Xd=$e(()=>{St();Xc();$n();qd=e=>`ccc:warp:charges:${e}`,Gd=e=>`ccc:warp:lastCharge:${e}`,Cs=24,Yc=3600*1e3,dy=150,gw="sounds/warp.ogg",Tr=null,il=null});function Ly(){try{return localStorage.getItem(Ar(Qd))==="1"}catch{return!1}}function tp(){try{return localStorage.getItem(Ar(_y))==="1"}catch{return!1}}function jc(e){let t=b();if(t==null)return;let n=`${_y}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),bw()}catch{}}function Zc(){return tp()?"Jeff":"Merchant"}function bw(){let e=Zc();ze&&ze.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function sl(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&so(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(v=>console.error(v)),n&&h()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,Lo(160)))},f=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},d=()=>{r&&l()},m=g=>{r=!0,Lo(160)},y=g=>{r&&l()},p=()=>{r&&l()},h=()=>{e.removeEventListener("click",a),Cy?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):xw&&(e.removeEventListener("touchstart",m),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",p))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function Wc(e){return ww[e]??0}function gy(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function Lw(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function ll(e,t){let n=bi.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;Ts.set(e,r),n.unlocked=r;let i=Cn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&Cn.buttons[e]?.classList.contains("is-active")&&eu("dialogue")}function Vd(){let e=!1;try{e=!!Ns?.()}catch{}ll("reset",e)}function Yd(){let e=!1;try{e=!!qt?.()}catch{}ll("workshop",e)}function Sy(){let e=!1;try{typeof ko=="function"&&(e=ko())}catch{}ll("warp",e)}function _w(){let e=b();if(e==null)return!1;try{return typeof pn=="function"&&pn()?!0:localStorage.getItem(My(e))==="1"}catch{return!1}}function jd(){ll("lab",_w())}function Cw(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function Mw(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof dn=="function"&&dn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof rt=="function"?rt():null;t&&typeof t=="object"&&(e.xpLevel=Cw(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Rr=="function"&&Rr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof qt=="function"&&qt()}catch{e.hasInfuseReset=!1}return e}function Tw(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?zd:Kd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?zd:Kd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?np:""),i.icon=o?.icon??(r==="mysterious"?kr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Jo:Iw),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function kw(){if(yy)return;yy=!0;let e=Aw;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${Ew}:${t}`;Tt(n,{onChange:e})}}function Aw(){Qo()}function Nw(e,t){let n=op(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,Ty(n),Rw(t.reward),!0)}function Rw(e){if(e){if(e.type==="coins"){try{R.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{R.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{R.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function Ow(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function op(){try{return JSON.parse(localStorage.getItem(Ar(al))||"{}")}catch{return{}}}function Ty(e){let t=Ar(al);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{lt(t,n)}catch{}}catch{}}function Pw(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function Bw(){let e=Zd;if(Zd=null,typeof e=="function")try{e()}catch{}}function Fw(e,t={}){t?.rawChanged&&Qo()}function Wd(e){if(e===Iy)return;if(Bw(),Iy=e??null,e==null){Qo();return}let t=`${al}:${e}`;Zd=Tt(t,{parse:Pw,onChange:Fw});try{lt(t)}catch{}Qo()}function Uw(){if(vy){Wd(b());return}vy=!0,Wd(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Wd(b())})}function Or(){Promise.resolve().then(()=>($n(),Zl)).then(({loadAudio:e})=>{e(ky)})}function Dw(){if(Ms)return;Ms=ht(ky,{volume:Je?.15:.3,loop:!0})}function tr(){Ms&&(Ms.stop&&Ms.stop(),Ms=null)}function $w(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let E=0;E<t.length;E++){let L=t[E];L==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=L):L===">"&&l?(s+=L,i.push({type:"tag",content:s}),s="",l=!1):s+=L}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,m="";er=!0,Dw();let y=E=>{d&&(E.preventDefault(),f=!0)},p=E=>{d&&(E.key==="Enter"||E.key===" ")&&(f=!0)},h=o.length?o:[e];requestAnimationFrame(()=>{d=!0,h.forEach(E=>E.addEventListener("click",y,{once:!0})),document.addEventListener("keydown",p,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{h.forEach(E=>E.removeEventListener("click",y)),document.removeEventListener("keydown",p),e.classList.remove("is-typing"),tr(),er=!1},v=()=>{if(f){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let E=i[a];E.type==="tag"?(m+=E.content,e.innerHTML=m,a++,v()):(m+=E.content[u],e.innerHTML=m,u++,u>=E.content.length&&(a++,u=0),setTimeout(v,n))};v()})}function qw(e={}){if(!ze)return;Or();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Jo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||kr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,ze.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Jo,r.textContent=e.message||np,requestAnimationFrame(()=>t.classList.add("is-visible")),ze.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),tr(),er=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),Tn(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&Tn(160),l()};sl(i,()=>{u()},{once:!0}),i.focus?.()}function Gw(e,t){Or();let n=t.scriptId;String(e)==="6"&&typeof us=="function"&&!us()&&(n=7),Yr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Zc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ks}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,ze.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),ze.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{Yr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),tr(),er=!1,o.remove()},d=()=>{u||(u=!0,f(),Qo())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&Tn(160),d())});let m=new Nr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,v)=>{t.scriptId===4&&g==="c4b"&&jc(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){Qo(),f();return}Nw(e,t),Qo(),f()}}}),p=!!op()[e]?.claimed,h=structuredClone(sd[n]);p&&h.nodes.m2b&&h.nodes.c2a&&t.scriptId===1&&(h.nodes.m2b.say="I've already given you Coins, goodbye.",h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),p&&t.scriptId===2&&h.nodes.m3a&&(h.nodes.m3a.say="I've already given you Books, goodbye.",h.nodes.c2a&&(h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===3&&h.nodes.m5a&&(h.nodes.m5a.say="I've already given you Gold, goodbye.",h.nodes.c5a&&(h.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===4&&h.nodes.m7a&&(h.nodes.m7a.say="I've already given you Magic, goodbye.",h.nodes.c7a&&(h.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m.load(h),m.start()}function Hw(){if(document.getElementById(Ey))return;let e=document.createElement("style");e.id=Ey,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function Xw(){let e=ze?.querySelector(".merchant-content");if(!e||e.__customScroll||!yt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),yt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){Hw();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;yt.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let T=(e.scrollTop||0)>0;f!==T&&(f=T,yt?.classList.toggle("has-scroll-shadow",T))},m=()=>{let T=ze.querySelector(".merchant-grabber"),_=ze.querySelector(".merchant-header"),V=ze.querySelector(".merchant-actions"),J=(T?.offsetHeight||0)+(_?.offsetHeight||0)|0,se=(V?.offsetHeight||0)|0;t.style.top=J+"px",t.style.bottom=se+"px"},y={},p=()=>{let{scrollHeight:T,clientHeight:_,scrollTop:V}=e,J=t.clientHeight||e.clientHeight||1;if(y.scrollHeight===T&&y.clientHeight===_&&y.barH===J&&(u||y.scrollTop===V))return;y={scrollHeight:T,clientHeight:_,scrollTop:V,barH:J};let se=_/Math.max(1,T),de=Math.max(28,Math.round(J*se)),ye=Math.max(1,T-_),Re=Math.max(0,J-de);if(n.style.height=de+"px",u)n.style.setProperty("--thumb-y",`${Re}px`),n.style.setProperty("--thumb-x","0px");else{let Ce=Math.round(V/ye*Re);n.style.transform=`translateY(${Ce}px)`}t.style.display=T<=_+1?"none":""},h=()=>{m(),p(),d()},g=()=>{o&&(yt.classList.add("is-scrolling"),l&&clearTimeout(l))},v=T=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{yt.classList.remove("is-scrolling")},T))},E=()=>{p(),d(),o&&g(),s||v(r)},L=()=>v(r);e.addEventListener("scroll",E,{passive:!0}),s&&e.addEventListener("scrollend",L,{passive:!0});let M=new ResizeObserver(h);M.observe(e),window.addEventListener("resize",h),requestAnimationFrame(h);let N=!1,q=0,P=0,G=T=>{N=!0,q=T.clientY,P=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(T.pointerId)}catch{}T.preventDefault()},C=T=>{if(!N)return;let _=t.clientHeight||1,V=n.clientHeight||1,J=Math.max(1,_-V),se=Math.max(1,e.scrollHeight-e.clientHeight),ye=(T.clientY-q)/J*se;e.scrollTop=P+ye},U=T=>{if(N){N=!1,n.classList.remove("dragging"),v(i);try{n.releasePointerCapture(T.pointerId)}catch{}}};n.addEventListener("pointerdown",G),window.addEventListener("pointermove",C,{passive:!0}),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),t.addEventListener("pointerdown",T=>{if(T.target===n)return;let _=t.getBoundingClientRect(),V=T.clientY-_.top,J=t.clientHeight||1,se=n.clientHeight||1,de=Math.max(0,J-se),ye=Math.max(0,Math.min(V-se/2,de)),Re=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ye/Math.max(1,de)*Re,g(),v(r)}),e.__customScroll={bar:t,thumb:n,ro:M,updateAll:h},h()}function Vw(){if(ze)return;ze=document.createElement("div"),ze.className="merchant-overlay",ze.id="merchant-overlay",ze.setAttribute("inert",""),yt=document.createElement("div"),yt.className="merchant-sheet",yt.setAttribute("role","dialog"),yt.setAttribute("aria-modal","false"),yt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",Vd(),Yd(),Sy(),jd(),bi.forEach(y=>{y.key==="dialogue"&&Ts.set("dialogue",!0);let p=Ts.get(y.key),h=p??!!y.unlocked,g=document.createElement("button");g.type="button",g.className="merchant-tab",g.dataset.tab=y.key;let v=y.lockedLabel||"???";g.textContent=h?y.label:v,h?g.title=y.label||"Tab":(g.classList.add("is-locked"),g.disabled=!0,g.title="???"),y.unlocked=h,Ts.set(y.key,h),sl(g,E=>{if(g.disabled){E?.preventDefault?.();return}eu(y.key)}),o.appendChild(g),Cn.buttons[y.key]=g}),Cn.panels.dialogue=i,Cn.panels.reset=s,Cn.panels.workshop=l,Cn.panels.warp=a,Cn.panels.lab=u,Cn.tablist=o,r.append(i,s,l,a,u),n.append(o,r),Vd(),Yd();try{Yo()}catch{}try{rp(s)}catch{}try{qe()}catch{}try{$d(l)}catch{}try{hy(a)}catch{}try{yd(u)}catch{}if(!by&&typeof window<"u"){let y=p=>{let{key:h,slot:g}=p?.detail??{};g!=null&&g!==b()||((h==="forge"||!h)&&Vd(),(h==="infuse"||!h)&&Yd(),(h==="surge_completed"||!h)&&Sy(),(h==="lab"||h==="tsunami"||!h)&&jd())};window.addEventListener("unlock:change",y,{passive:!0}),window.addEventListener("saveSlot:change",y,{passive:!0}),by=!0}let f=document.createElement("div");f.className="merchant-actions";let d=document.createElement("button");d.type="button",d.className="merchant-close",d.textContent="Close",zc=d,f.appendChild(d);let m=document.createElement("div");m.className="merchant-firstchat merchant-firstchat--initial",m.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ks}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,yt.append(e,t,n,f,m),ze.appendChild(yt),document.body.appendChild(ze),Yw(),Xw(),wy||(wy=!0,sl(d,()=>{Qc()},{once:!1}),document.addEventListener("keydown",jw),e.addEventListener("pointerdown",Zw),e.addEventListener("touchstart",p=>p.preventDefault(),{passive:!1}),ze.addEventListener("pointerdown",Or,{once:!0}))}function Yw(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,kw(),Qo()}function Ww(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?Gw(n.id,n.meta):n.isMysterious&&qw(n.lockInfo)}}function Qo(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=Mw(),o=op(),r=!1,i=new Set;Object.entries(Jc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=Wc(u),d=Tw(l,n),m=d.status,y=Wc(m);if(y>f)a.status=m,m==="mysterious"?a.lockSnapshot=gy(d):m==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(y<f){if(u==="unlocked")d=Lw(l),m="unlocked",y=Wc(m);else if(u==="mysterious"){let T=a.lockSnapshot||gy(d)||{};d={status:"mysterious",unlocked:!1,title:T.title??d.title??"???",blurb:T.blurb??d.blurb??zd,tooltip:T.tooltip??d.tooltip??"Hidden Dialogue",message:T.message??d.message??np,icon:T.icon??d.icon??kr,headerTitle:T.headerTitle??d.headerTitle??Jo,ariaLabel:T.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},m="mysterious",y=Wc(m)}}let p=m==="unlocked",h=m==="mysterious",g=m==="locked",v=!!a.claimed,E=p&&!!(l.once&&v),L=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!L){L=document.createElement("button"),L.type="button",L.className="dlg-card",L.dataset.dlgId=String(s);let T=document.createElement("div");T.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let V=document.createElement("div");V.className="dlg-reward",L.append(T,_,V),t.appendChild(L),sl(L,Ww)}L._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:p,isMysterious:h},L.dataset.dlgStatus=m,L.disabled!==!!g&&(L.disabled=!!g),L.classList.toggle("is-locked",g),L.classList.toggle("is-mysterious",h),L.classList.toggle("is-complete",!!E),L.classList.toggle("has-again",!!E),g?(L.getAttribute("aria-disabled")!=="true"&&L.setAttribute("aria-disabled","true"),L.getAttribute("tabindex")!=="-1"&&L.setAttribute("tabindex","-1")):(L.hasAttribute("aria-disabled")&&L.removeAttribute("aria-disabled"),L.hasAttribute("tabindex")&&L.removeAttribute("tabindex"));let M=L.querySelector(".dlg-title"),N=p?l.title:d.title??"???";M.textContent!==N&&(M.textContent=N);let q=L.querySelector(".dlg-blurb"),P=p?l.blurb:d.blurb??"";q.textContent!==P&&(q.textContent=P);let G=L.querySelector(".dlg-reward");if(p&&l.reward){let T=Sw[l.reward.type];if(T){G.classList.contains("has-reward")||(G.classList.add("has-reward"),G.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),G.style.getPropertyValue("--reward-icon")!==`url('${T}')`&&G.style.setProperty("--reward-icon",`url('${T}')`);let _=G.querySelector(".amt"),V=String(l.reward.amount);_&&_.textContent!==V&&(_.textContent=V);let J=G.querySelector(".currency-name");if(J){let de=String(l.reward.type||""),ye=de.charAt(0).toUpperCase()+de.slice(1);J.textContent!==ye&&(J.textContent=ye)}let se=`Reward: ${l.reward.amount} ${l.reward.type}`;G.getAttribute("aria-label")!==se&&G.setAttribute("aria-label",se)}else{G.classList.remove("has-reward");let _=Ow(l.reward);G.textContent!==_&&(G.textContent=_),G.style.display!==""&&(G.style.display=""),G.removeAttribute("aria-label")}G.style.display==="none"&&(G.style.display="")}else G.textContent!==""&&(G.textContent=""),G.style.display!=="none"&&(G.style.display="none");let C=p?`${l.title}${E?" (completed)":""}`:d.ariaLabel||(h?"Hidden merchant dialogue":"Locked merchant dialogue");if(L.getAttribute("aria-label")!==C&&L.setAttribute("aria-label",C),d.tooltip)L.title!==d.tooltip&&(L.title=d.tooltip);else if(p){let T="Left-click: Start Dialogue";L.title!==T&&(L.title=T)}else L.hasAttribute("title")&&L.removeAttribute("title");let U=L.querySelector(".dlg-again");E?U||(U=document.createElement("div"),U.className="dlg-again",U.textContent="Ask Again?",L.appendChild(U)):U&&U.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&Ty(o)}function zw(){let e=ze.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Yr(!0);let i=new Nr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Yr(!1);try{localStorage.setItem(Ar(Qd),"1")}catch{}try{window.dispatchEvent(new Event(ep))}catch{}e.classList.remove("is-visible"),ze.classList.remove("firstchat-active")}});i.load(sd[0]),i.start()}function Kw(){if(!ze)return;let e=ze.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),ze.classList.remove("firstchat-active")}function Ay(){if(Vw(),As)return;let e=document.activeElement;e instanceof HTMLElement&&!ze.contains(e)?Kc=e:Kc=null,As=!0;let t=b(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(My(t),"1")}catch{}jd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Ar(Qd))==="1"}catch{o=!1}o||ze.classList.add("firstchat-instant"),yt.style.transition="none",yt.style.transform="",ze.removeAttribute("inert"),yt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ze.classList.contains("firstchat-instant")||(yt.style.transition=""),ze.classList.add("is-open"),Tn(140),zc&&typeof zc.focus=="function")try{zc.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(Ar(xy))||"dialogue"}catch{}n&&(r="dialogue"),eu(r),tr(),o||(ze.querySelector(".merchant-firstchat")?.classList.add("is-visible"),ze.classList.add("firstchat-active"),zw())})})}function Qc(){if(!As)return;if(Yr(!1),Je){try{Lo(100)}catch{}try{Tn(80)}catch{}}As=!1,yt.style.transition="",yt.style.transform="",ze.classList.remove("is-open"),ze.classList.remove("firstchat-instant"),Kw();let e=document.activeElement;if(e&&ze.contains(e)){let t=Kc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}ze.setAttribute("inert",""),Kc=null,tr(),er=!1}function jw(e){if(As&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<bi.length;i++)Ts.get(bi[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<bi.length&&(e.preventDefault(),eu(bi[r].key))}}function Zw(e){if(!As)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;Mn={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},yt.style.transition="none",window.addEventListener("pointermove",Ny,{passive:!0}),window.addEventListener("pointerup",Ry),window.addEventListener("pointercancel",Oy)}function Ny(e){if(!Mn||Mn.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-Mn.startY);Mn.lastY=t,Mn.moved=n,yt.style.transform=`translateY(${n}px)`}function Ry(){if(!Mn||Mn.canceled){Jd();return}let e=Math.max(1,performance.now()-Mn.startT),t=Mn.moved;t/e>.55&&t>40||t>140?(Lo(160),yt.style.transition="transform 140ms ease-out",yt.style.transform="translateY(100%)",setTimeout(()=>{Qc()},150)):(yt.style.transition="transform 180ms ease",yt.style.transform="translateY(0)"),Jd()}function Oy(){Mn&&(Mn.canceled=!0,yt.style.transition="transform 180ms ease",yt.style.transform="translateY(0)",Jd())}function Jd(){window.removeEventListener("pointermove",Ny),window.removeEventListener("pointerup",Ry),window.removeEventListener("pointercancel",Oy),Mn=null}function eu(e){let t=bi.find(o=>o.key===e),n=Ts.get(e);(!t||!n)&&(e="dialogue");for(let o in Cn.buttons)Cn.buttons[o].classList.toggle("is-active",o===e);for(let o in Cn.panels)Cn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Qo()}catch{}if(e==="warp")try{Zo()}catch{}if(e==="lab"){typeof us=="function"&&!us()&&Jw();try{vd()}catch{}}try{localStorage.setItem(Ar(xy),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=ze?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function cl(e=[]){e.forEach(t=>ll(t,!0))}function Py(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ks}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Or();let u=y=>{y.key==="Escape"&&(y.stopImmediatePropagation(),y.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ks}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let y=r.querySelector("#tsunami-dlg-line-2"),p=r.querySelector("#tsunami-dlg-choices-2"),h=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),v={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},E=new Nr({textEl:y,choicesEl:p,skipTargets:[y,h,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),tr(),er=!1,r.remove(),t&&t()},5e3)}});E.load(v),E.start()},m=new Nr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",tr(),er=!1,n&&n.hideCursor&&n.hideCursor(),f()}});m.load(o),m.start()}function Jw(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Zc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ks}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Or();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Nr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{tr(),er=!1,e.remove()}});s.load(i),s.start()}function By(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Zc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ks}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Or();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Nr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{tr(),er=!1,t.remove(),e&&e()}});l.load(s),l.start()}var ks,Qd,xy,al,ep,Ar,_y,bi,Ts,Sw,kr,Jo,Iw,zd,Kd,np,ww,Ew,Cy,xw,yy,vy,by,My,Iy,Zd,Jc,ze,yt,zc,As,Mn,Kc,wy,Cn,ky,Ms,er,Nr,Ey,tu=$e(()=>{St();Et();vg();Yn();Mo();hs();Xd();ai();zn();ci();os();uo();$n();ks="img/misc/merchant.webp",Qd="ccc:merchantMet",xy="ccc:merchantTab",al="ccc:merchant:dlgState",ep="ccc:merchant:met",Ar=e=>`${e}:${b()}`;_y="ccc:unlock:jeff";bi=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],Ts=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),Sw={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},kr="img/misc/mysterious.webp",Jo="Hidden Dialogue",Iw="Locked Dialogue",zd="Hidden Dialogue",Kd="Locked",np="Locked Dialogue",ww={locked:0,mysterious:1,unlocked:2},Ew="ccc:reset:forge:completed",Cy=typeof window<"u"&&"PointerEvent"in window,xw=!Cy&&typeof window<"u"&&"ontouchstart"in window;yy=!1,vy=!1,by=!1;My=e=>`ccc:unlock:lab:${e}`;Iy=null,Zd=null;Jc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:kr,headerTitle:Jo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:Kd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:kr,headerTitle:Jo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof ko=="function"&&ko()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:kr,headerTitle:Jo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof pn=="function"&&pn())return!0;let t=typeof jn=="function"?jn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof ko=="function"&&ko()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:kr,headerTitle:Jo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:kr,headerTitle:Jo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};Uw();ze=null,yt=null,zc=null,As=!1,Mn=null,Kc=null,wy=!1,Cn={buttons:{},panels:{},tablist:null},ky="sounds/merchant_typing.ogg",Ms=null,er=!1;Nr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await $w(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=sl(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};Ey="ccc-scroll-timeline-styles"});var jt,Fy,Uy,Dy,ip=$e(()=>{Wt();jt="dna",Fy="img/misc/mysterious.webp",Uy="Hidden Upgrade",Dy=[{area:jt,id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Coin value bonus: ${Ae(t)}x`},{area:jt,id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`XP value bonus: ${Ae(t)}x`},{area:jt,id:3,title:"DNA Gold Value",desc:"Multiplies Gold value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/gold_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"gold_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Gold value bonus: ${Ae(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Fy,titleOverride:Uy,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:jt,id:4,title:"DNA Magic Value",desc:"Multiplies Magic value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/magic_val_dna.webp",baseIconOverride:"img/currencies/dna/dna_base.webp",effectType:"magic_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Magic value bonus: ${Ae(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Fy,titleOverride:Uy,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}]});function rl(){return ul.size>0}function Vy(e){if(!e||!e.costType)return!1;let t=oE[e.costType];return!t||At(Ze,t)<=0?!1:di(e.area,e.id)!=="0"}function ap(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function ou(e,t){return t==="standard"&&ap(e)===nE}function sp(e){let t=Ct(e),n={};for(let o of t){let r=_n(e,o.id),i=At(e,o.id),s=Ao(e,o.id),l=s.iconOverride??cu(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Ps(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:d}}return n}function Yy(e){return Gy[e]||Gy.standard}function Tn(e=140){if(!Je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function iu(e){return String(e??"").replace(/<[^>]*>/g,"")}function nu(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function on(){ht(iE,{volume:Je?Wy:zy})}function Ky(){let e=Je?Wy*2:zy*2;ht(sE,{volume:e})}function aE(e){return`<img alt="" src="${qy[e]||qy.coins}" class="currency-ico">`}function cE(){if(document.getElementById(Hy))return;let e=document.createElement("style");e.id=Hy,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function Ls(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,m="onscrollend"in window,p=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(p){cE();let Y=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=Y,s.style.scrollTimelineName=Y,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=Y,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let h={scrollSize:0,clientSize:0,barSize:0,thumbSize:0,maxScroll:1,range:0,visibleRatio:1},g=null,v=!1,E=null,L=()=>{if(!s.isConnected||!t.isConnected)return;let F=s.getBoundingClientRect(),Y=t.getBoundingClientRect();if(i){let $=Math.max(0,F.top-Y.top),H=Math.max(0,Y.bottom-F.bottom);l.style.top=$+"px",l.style.bottom=H+"px",l.style.left="",l.style.right=""}else{let $=Math.max(0,F.left-Y.left),H=Math.max(0,Y.right-F.right);l.style.left=$+"px",l.style.right=H+"px",l.style.top="",l.style.bottom="",l.style.height=""}},M=()=>{let F=i?s.scrollHeight:s.scrollWidth,Y=i?s.clientHeight:s.clientWidth,$=i?l.clientHeight||Y:l.clientWidth||Y,H=Y/Math.max(1,F),j=Math.max(28,Math.round($*H)),W=Math.max(1,F-Y),re=Math.max(0,$-j);h={scrollSize:F,clientSize:Y,barSize:$,thumbSize:j,maxScroll:W,range:re,visibleRatio:H},i?(a.style.height=j+"px",a.style.width="100%"):(a.style.width=j+"px",a.style.height="100%"),p&&(i?(a.style.setProperty("--thumb-y",`${re}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${re}px`),a.style.setProperty("--thumb-y","0px")));let x=F>Y+1;l.style.display=x?"":"none",t?.classList.toggle("has-active-scrollbar",x),N()},N=()=>{v=!1;let F=i?s.scrollTop:s.scrollLeft,Y=(F||0)>0;if(g!==Y&&(g=Y,t?.classList.toggle("has-scroll-shadow",Y)),!p){let{maxScroll:$,range:H}=h,j=Math.round(F/$*H);i?a.style.transform=`translateY(${j}px)`:a.style.transform=`translateX(${j}px)`}u&&C()},q=()=>{L(),M()},P,G=()=>{clearTimeout(P),P=setTimeout(q,100)};typeof MutationObserver<"u"&&new MutationObserver(()=>G()).observe(s,{childList:!0,subtree:!0,characterData:!0});let C=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},U=F=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},F))},T=()=>{ul.has(s)||ul.add(s),clearTimeout(E),E=setTimeout(()=>{ul.has(s)&&(ul.delete(s),window.dispatchEvent(new CustomEvent("menu:scrollStop")))},150),v||(v=!0,window.requestAnimationFrame(N)),m||U(f)},_=()=>U(f);s.addEventListener("scroll",T,{passive:!0}),m&&s.addEventListener("scrollend",_,{passive:!0}),new ResizeObserver(()=>{q()}).observe(s),window.addEventListener("resize",q),requestAnimationFrame(q);let J=!1,se=0,de=0,ye=F=>{J=!0,se=i?F.clientY:F.clientX,de=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),C();try{a.setPointerCapture(F.pointerId)}catch{}F.preventDefault()},Re=F=>{if(!J)return;let{range:Y,maxScroll:$}=h;if(Y<=0)return;let j=(i?F.clientY:F.clientX)-se,W=de+j/Y*$;i?s.scrollTop=W:s.scrollLeft=W},Ce=F=>{if(J){J=!1,a.classList.remove("dragging"),U(d);try{a.releasePointerCapture(F.pointerId)}catch{}}};a.addEventListener("pointerdown",ye),window.addEventListener("pointermove",Re,{passive:!0}),window.addEventListener("pointerup",Ce),window.addEventListener("pointercancel",Ce),l.addEventListener("pointerdown",F=>{if(F.target===a)return;let Y=l.getBoundingClientRect(),$=i?F.clientY-Y.top:F.clientX-Y.left,{thumbSize:H,range:j,maxScroll:W}=h,x=Math.max(0,Math.min($-H/2,j))/Math.max(1,j)*W;i?s.scrollTop=x:s.scrollLeft=x,C(),U(f)}),q()}function Xy(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function uE(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=R[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",m=Number.isFinite(i)&&r>=i;return d&&!m||!Number.isFinite(i)?c.fromAny("Infinity"):Xy(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),m=c.fromAny(e.costAtLevel(r+1)),y=Math.min(Number.isFinite(i)?i:r+32,r+32),p=c.fromAny(e.costAtLevel(y));if(d.cmp(m)===0&&d.cmp(p)===0){let g=Xy(e,o,r),v=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,E=0,L=Math.max(0,v);for(;E<L;){let M=Math.floor((E+L+1)/2),N=c.fromInt(M);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(N):c.fromAny(d??0).mulBigNumInteger(N)).cmp(a)<=0?E=M:L=M-1}return c.fromInt(E)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=Si(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function Es(e="standard"){(su[e]||su.standard).open()}function jy(e=!1){Object.values(su).forEach(t=>t.close(e))}function nr(e=!1){Object.values(su).forEach(t=>t.update(e))}function fE(){if(rn)return;rn=document.createElement("div"),rn.className="upg-overlay",ut=document.createElement("div"),ut.className="upg-sheet",ut.setAttribute("role","dialog"),ut.setAttribute("aria-modal","false"),ut.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",ut.append(e,t,n,o,r),rn.appendChild(ut),document.body.appendChild(rn),rn.addEventListener("pointerdown",u=>{Je&&u.pointerType!=="mouse"&&u.target===rn&&(u.preventDefault(),u.stopPropagation())},!0),rn.addEventListener("click",u=>{Je&&u.target===rn&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!au)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},ut.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,ut.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(ut.style.transition="transform 160ms ease",ut.style.transform=f?"translateY(100%)":"translateY(0)",f){if(Je&&(!u||u.pointerType!=="mouse"))try{Tn(120)}catch{}setTimeout(Zy,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function Zy(){if(Je)try{Tn(160)}catch{}if(typeof ru=="function"){let e=ru;ru=null;try{e()}catch{}}au=!1,!(!rn||!ut)&&(ut.style.transition="",ut.style.transform="",rn.classList.remove("is-open"),rn.style.pointerEvents="none")}function dE(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function pE(e,t="standard"){fE(),au=!0;let n=!0,o=Yy(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){au=!1;return}let l=e.upgType==="HM",a=e.tie===xe.ENDLESS_XP;function u(p,h,g="div"){let v=h.split(" ").filter(M=>M.length>0),E=null,L=[];for(let M=0;M<p.children.length;M++){let N=p.children[M];g&&N.tagName.toLowerCase()!==g.toLowerCase()||v.every(q=>N.classList.contains(q))&&(E?L.push(N):E=N)}return L.forEach(M=>M.remove()),E||(E=document.createElement(g),E.className=h,p.appendChild(E)),E}let f=p=>{let h=document.createElement("div");return h.className="upg-line",h.innerHTML=p,h},d=!0,m=()=>{let p=o.getUiModel(e.id);if(!p)return;let h=p.lockState||o.getLockState(e.id),g=!!h?.locked,v=g&&(h?.hidden||h?.hideEffect||h?.hideCost),E=!!p.unlockUpgrade&&!v;ut.classList.toggle("is-locked-hidden",v);let L=ut.querySelector(".upg-header"),M=u(L,"upg-title");M.textContent!==(p.displayTitle||p.upg.title)&&(M.textContent=p.displayTitle||p.upg.title);let N=!!p.hmReadyToEvolve,q=N?!1:p.lvlBn?.isInfinite?.()?!0:Number.isFinite(p.upg.lvlCap)?p.lvl>=p.upg.lvlCap:!1,P=u(L,"upg-level"),G=p.lvlCapFmtHtml??p.upg.lvlCapFmtHtml??te(p.lvlCapBn),C=p.lvlCapFmtText??p.upg.lvlCapFmtText??iu(G),U=N?`Level ${p.lvlFmtHtml} / ${G} (EVOLVE READY)`:q?`Level ${p.lvlFmtHtml} / ${G} (MAXED)`:`Level ${p.lvlFmtHtml} / ${G}`,T=iu(U);P.innerHTML!==U&&(P.innerHTML=U),P.getAttribute("aria-label")!==T&&P.setAttribute("aria-label",T),P.hidden=v,v||P.removeAttribute("aria-hidden"),ut.classList.toggle("is-maxed",q),ut.classList.toggle("hm-evolve-ready",N),ut.classList.toggle("is-unlock-upgrade",E),ut.classList.toggle("is-hm-upgrade",l&&!v),ut.classList.toggle("is-endless-xp",a),ut.classList.toggle("is-magnet-upgrade",e.tie===xe.MAGNET),ut.classList.toggle("is-no-effect",!p.effect);let _=L.querySelector(".auto-toggle-wrapper"),V=t==="automation"?ss[e.id]:null,J=t==="automation"&&e.id===ao,se=!!V,de=t==="standard"||t==="dna"?rE[e.costType]:null,ye=0;de?ye=At(Ze,de):(se||J)&&(ye=At(Ze,e.id));let Ce=ye>0&&(se||de||J)&&!v;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",L.appendChild(_));let F=_.querySelector("button");if(F||(F=document.createElement("button"),F.type="button",F.style.padding="10px 14px",F.style.fontSize="16px",F.style.width="auto",F.style.minWidth="180px",F.addEventListener("click",ne=>{typeof F._onClick=="function"&&F._onClick(ne)}),_.appendChild(F)),Ce){F.style.visibility="",F.style.pointerEvents="auto";let ne=b(),ge=ne!=null?`:${ne}`:"",Ue=!0;if(se){let Me=`ccc:autobuy:master:${V}${ge}`,Be=[...Ct(Ie.STARTER_COVE),...Ct(jt)],ae=!1;for(let ee of Be)if(ee.costType===V){let we=`ccc:autobuy:${ee.area}:${ee.id}${ge}`;if(di(ee.area,ee.id)!=="0"){ae=!0;break}}Ue=ae}else Ue=di(e.area,e.id)!=="0";Ue?(F.className="shop-delve",F.textContent="Automation: ON",F.style.backgroundColor=""):(F.className="shop-close",F.textContent="Automation: OFF",F.style.backgroundColor=""),F._onClick=Me=>{Me.preventDefault(),Me.stopPropagation(),Je&&Tn(50);let ae=!Ue?"1":"0";se?(localStorage.setItem(`ccc:autobuy:master:${V}${ge}`,ae),[...Ct(Ie.STARTER_COVE),...Ct(jt)].forEach(we=>{we.costType===V&&Er(we.area,we.id,ae)})):Er(e.area,e.id,ae),m()}}else F.style.visibility="hidden",F.style.pointerEvents="none",F.className="shop-delve",F.textContent="Automation: ON",F._onClick=null;let Y=ut.querySelector(".upg-content");d&&(Y.scrollTop=0,d=!1);let $=u(Y,"upg-desc centered");$.classList.toggle("lock-desc",v);let H=(p.displayDesc||p.upg.desc||"").trim();N?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):H?($.classList.remove("hm-evolve-note"),$.textContent!==H&&($.textContent=H),$.hidden=!1):$.hidden=!0;let j=u(Y,"upg-info"),W=null,re=ne=>{W?W.nextElementSibling!==ne&&j.insertBefore(ne,W.nextSibling):j.firstElementChild!==ne&&j.prepend(ne),W=ne};if(g&&h?.reason&&!v){let ne=(p.displayDesc||"").trim(),ge=String(h.reason??"").trim();if(ne!==ge){let Ue=j.querySelector(".lock-wrapper");if(!Ue){Ue=document.createElement("div"),Ue.className="lock-wrapper";let ae=document.createElement("div");ae.className="upg-line lock-note",Ue.append(ae)}let Me=Array.from(Ue.children);for(let ae of Me)ae.tagName==="DIV"&&!ae.className&&ae.style.height==="12px"&&ae.remove();let Be=Ue.querySelector(".lock-note");Be.textContent!==h.reason&&(Be.textContent=h.reason),re(Ue)}else{let Ue=j.querySelector(".lock-wrapper");Ue&&Ue.remove()}}else{let ne=j.querySelector(".lock-wrapper");ne&&ne.remove()}if(p.effect&&!(g&&h?.hideEffect)){let ne=j.querySelector(".effect-wrapper");if(!ne){ne=document.createElement("div"),ne.className="effect-wrapper";let Be=document.createElement("div");Be.className="upg-line",ne.append(Be)}let ge=Array.from(ne.children);for(let Be of ge)Be.tagName==="DIV"&&!Be.className&&Be.style.height==="12px"&&Be.remove();let Ue=ne.querySelector(".upg-line"),Me=`<span class="bonus-line">${p.effect}</span>`;Ue.innerHTML!==Me&&(Ue.innerHTML=Me),re(ne)}else{let ne=j.querySelector(".effect-wrapper");ne&&ne.remove()}let x=aE(p.upg.costType),K=p.nextPrice instanceof c?p.nextPrice:c.fromAny(p.nextPrice||0),ce=q||N;if(!p.unlockUpgrade&&!ce&&(!g||!h?.hideCost)){let ne=u(j,"upg-costs");re(ne);let ge=nu(p.upg.costType,K),Ue=`Cost: ${x} ${R[p.upg.costType].fmt(K)} ${ge}`,Me=u(ne,"cost-line","div");if(Me.className.includes("upg-line")||(Me.className="upg-line cost-line"),Me.innerHTML!==Ue&&(Me.innerHTML=Ue),l){let we=u(ne,"milestone-line","div");we.className.includes("upg-line")||(we.className="upg-line milestone-line");let w="\u2014",z="",Z=Vy(p.upg);try{if(p.hmNextMilestone&&p.hmNextMilestone.cmp(p.lvlBn)>0)if(Z){let le=p.hmNextMilestone.sub(c.fromInt(1)),We=0;try{let be=le.toPlainIntegerString?.();be&&be!=="Infinity"?We=Number(be):We=Number(le.toString())}catch{We=0}let nt=c.fromInt(0);try{nt=c.fromAny(p.upg.costAtLevel(We))}catch{}w=R[p.upg.costType].fmt(nt),z=nu(p.upg.costType,nt)}else{let le=p.hmNextMilestone.sub(p.lvlBn),We=le.toPlainIntegerString?.(),nt=Math.max(0,Math.floor(Number(We&&We!=="Infinity"?We:Number(le.toString()||0)))),{spent:be}=Si(p.upg,p.lvlBn,c.fromAny("Infinity"),nt);w=R[p.upg.costType].fmt(be),z=nu(p.upg.costType,be)}}catch{}let he=`${Z?"Cost at next milestone:":"Cost to next milestone:"} ${x} ${w} ${z}`;we.innerHTML!==he&&(we.innerHTML=he)}else{let we=ne.querySelector(".milestone-line");we&&we.remove()}let Be=nu(p.upg.costType,p.have),ae=`You have: ${x} ${R[p.upg.costType].fmt(p.have)} ${Be}`,ee=u(ne,"have-line","div");ee.className.includes("upg-line")||(ee.className="upg-line have-line"),ee.innerHTML!==ae&&(ee.innerHTML=ae)}else{let ne=j.querySelector(".upg-costs");ne&&ne.remove()}let pe=ut.querySelector(".upg-milestones"),Q=pe.querySelector(".hm-view-milestones-row");if(!Q){Q=document.createElement("div"),Q.className="hm-view-milestones-row";let ne=document.createElement("button");ne.type="button",ne.className="shop-delve hm-view-milestones",ne.textContent="View Milestones",ne.addEventListener("click",ge=>{ne._onClick&&ne._onClick(ge)}),Q.appendChild(ne),pe.appendChild(Q)}let ie=Q.querySelector("button");l&&!v?(ie.style.visibility="",ie.style.pointerEvents="auto",ie._onClick=()=>{let ne=Array.isArray(p.hmMilestones)?p.hmMilestones:[],ge=Math.max(0,Math.floor(Number(p.hmEvolutions??0))),Ue=(()=>{try{return BigInt(Gt)*BigInt(ge)}catch{return 0n}})(),Me=ne.sort((Be,ae)=>Number(Be?.level||0)-Number(ae?.level||0)).map(Be=>{let ae=Math.max(0,Math.floor(Number(Be?.level||0))),ee=(()=>{if(p.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ae)+Ue).toString())}catch{return c.fromAny(ae+Gt*ge)}})(),we=ee?.isInfinite?.()?"Infinity":te(ee),w=Ae(Be?.multiplier??Be?.mult??Be?.value??1),z=`${Be?.target??Be?.type??"self"}`.toLowerCase(),Z=(()=>{if(p.lvlBn?.isInfinite?.())return!0;try{return p.lvlBn?.cmp?.(ee)>=0}catch{}return!1})(),oe=`Level ${we}: Multiplies this upgrade\u2019s effect by ${w}x`;return z==="xp"&&(oe=`Level ${we}: Multiplies XP value by ${w}x`),(z==="coin"||z==="coins")&&(oe=`Level ${we}: Multiplies Coin value by ${w}x`),z==="mp"&&(oe=`Level ${we}: Multiplies MP value by ${w}x`),{text:oe,achieved:Z}});dE(Me)}):(ie.style.visibility="hidden",ie.style.pointerEvents="none",ie._onClick=null);let me=ut.querySelector(".upg-actions"),Pe=me.querySelector(".shop-close");if(Pe||(Pe=document.createElement("button"),Pe.type="button",Pe.className="shop-close",Pe.textContent="Close",Pe.addEventListener("click",()=>{n=!1,Zy()}),me.appendChild(Pe)),g||q)me.querySelectorAll("button:not(.shop-close)").forEach(ne=>ne.remove()),document.activeElement&&document.activeElement!==Pe&&!me.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Pe.focus();else{let ne=p.have.cmp(K)>=0,ge=(ae,ee,we,w,z=!1)=>{let Z=me.querySelector(`.${ae.split(" ").join(".")}`);if(!Z){Z=document.createElement("button"),Z.type="button",Z.className=ae,Z.textContent=ee;let oe=()=>{typeof Z._onClick=="function"&&Z._onClick()};"PointerEvent"in window?Z.addEventListener("pointerdown",le=>{le.pointerType==="mouse"||typeof le.button=="number"&&le.button!==0||(oe(),le.preventDefault())},{passive:!1}):Z.addEventListener("touchstart",le=>{oe(),le.preventDefault()},{passive:!1}),Z.addEventListener("click",()=>{Je||oe()});let he=me.children;w>=he.length?me.appendChild(Z):me.insertBefore(Z,he[w])}return Z._onClick=we,Z.textContent!==ee&&(Z.textContent=ee),Z.disabled!==z&&(Z.disabled=z),Z};if(N){me.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ae=>ae.remove()),ge("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ae}=o.evolve(e.id);ae&&(Ky(),nr(),m())},1,!1);return}if(p.unlockUpgrade){me.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ae=>ae.remove()),ge("shop-delve btn-unlock","Unlock",()=>{let{bought:ae}=o.buyOne(e.id);if(!(ae instanceof c?ae:c.fromAny(ae??0)).isZero?.()){if(on(),ou(e,t))try{cl(["reset"])}catch{}nr(),m()}},1,!ne);return}if(me.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ae=>ae.remove()),ge("shop-delve btn-buy-one","Buy",()=>{let ae=o.getUiModel(e.id);if(ae.have.cmp(ae.nextPrice instanceof c?ae.nextPrice:c.fromAny(ae.nextPrice||0))<0)return;let{bought:ee}=o.buyOne(e.id);(ee instanceof c?ee:c.fromAny(ee??0)).isZero?.()||(on(),nr(),m())},1,!ne),(Number.isFinite(p.upg.lvlCap)?p.upg.lvlCap:1/0)===1){let ae=me.querySelector(".btn-buy-max");ae&&ae.remove();let ee=me.querySelector(".btn-buy-cheap");ee&&ee.remove()}else{ge("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:w}=o.buyMax(e.id);(w instanceof c?w:c.fromAny(w??0)).isZero?.()||(on(),nr(),m())},2,!ne);let ee=[1,3,4,5,6].includes(ap(p.upg));if(!l&&!ee)ge("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let z=o.buyCheap;if(!z)return;let{bought:Z}=z(e.id);(Z instanceof c?Z:c.fromAny(Z??0)).isZero?.()||(on(),nr(),m())},3,!ne);else{let we=me.querySelector(".btn-buy-cheap");we&&we.remove()}}if(l)ge("shop-delve btn-buy-next","Buy Next",()=>{let ee=o.getUiModel(e.id);if(ee.hmReadyToEvolve)return;let we=ee.hmNextMilestone;if(!we||!ee.lvlBn||we.cmp(ee.lvlBn)<=0){let{bought:be}=o.buyMax(e.id);if((be instanceof c?be:c.fromAny(be??0)).isZero?.())return;on(),nr(),m();return}let w=0;try{let be=we.sub(ee.lvlBn).toPlainIntegerString?.();w=Math.max(0,Math.floor(Number(be&&be!=="Infinity"?be:we.sub(ee.lvlBn).toString())))}catch{}let z=R[ee.upg.costType]?.value,Z=z instanceof c?z:c.fromAny(z??0),he=Si(ee.upg,ee.lvlBn,Z,w).count,le=!1;try{let be=he?.toPlainIntegerString?.();le=be&&be!=="Infinity"?Number(be)>=w:Number(he??0)>=w}catch{}let We=le?o.buyNext(e.id,w):o.buyMax(e.id);(We.bought instanceof c?We.bought:c.fromAny(We.bought??0)).isZero?.()||(on(),nr(),m())},3,p.have.cmp(c.fromInt(1))<0);else{let ae=me.querySelector(".btn-buy-next");ae&&ae.remove()}}},y=()=>{n&&m()};o.events.forEach(p=>window.addEventListener(p,y)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",y),m(),rn.classList.add("is-open"),rn.classList.toggle("is-automation-upgrade",t==="automation"),rn.style.pointerEvents="auto",Tn(140),ut.style.transition="none",ut.style.transform="translateY(100%)",ut.offsetHeight,requestAnimationFrame(()=>{ut.style.transition="",ut.style.transform=""}),ru=()=>{n=!1,o.events.forEach(p=>window.removeEventListener(p,y)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",y)}}function bd(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let m=Math.max(0,d-r.startY);r.lastY=d,r.moved=m,t.style.transform=`translateY(${m}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(Lo(100),Tn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var ul,$y,Qw,eE,tE,qy,nE,oE,rE,Gy,iE,sE,Wy,zy,lE,Hy,fl,su,rn,ut,au,ru,ci=$e(()=>{St();Et();Wt();uo();tu();lc();$n();co();os();oi();ms();ip();ul=new Set;$y={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},Qw="img/misc/locked_base.webp",eE="img/misc/maxed.webp",tE="img/misc/green_border.webp",qy={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},nE=7,oE={coins:Pa,books:Ba,gold:Fa,magic:Ua,dna:Da};rE={coins:Pa,books:Ba,gold:Fa,magic:Ua,dna:Da};Gy={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>sp(Zn()),getUiModel:e=>Ps(Zn(),e),buyOne:e=>Rs(Zn(),e),buyMax:e=>dl(Zn(),e),buyCheap:e=>pl(Zn(),e),buyNext:(e,t)=>Os(Zn(),e,t),getLockState:e=>Ao(Zn(),e),evolve:e=>lu(Zn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",ep,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>sp(Ze),getUiModel:e=>Ps(Ze,e),buyOne:e=>Rs(Ze,e),buyMax:e=>dl(Ze,e),buyCheap:e=>pl(Ze,e),buyNext:(e,t)=>Os(Ze,e,t),getLockState:e=>Ao(Ze,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>sp(jt),getUiModel:e=>Ps(jt,e),buyOne:e=>Rs(jt,e),buyMax:e=>dl(jt,e),buyCheap:e=>pl(jt,e),buyNext:(e,t)=>Os(jt,e,t),getLockState:e=>Ao(jt,e),evolve:e=>lu(jt,e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||nr(!0)});iE="sounds/purchase_upg.ogg",sE="sounds/evolve_upg.ogg",Wy=.12,zy=.3;lE="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",Hy="ccc-scroll-timeline-styles";fl=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return Yy(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!Ly(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let K=document.createElement("div");K.className="shop-tile";let ce=document.createElement("img");ce.className="base",ce.alt="";let pe=document.createElement("img");pe.className="icon",pe.alt="",pe.addEventListener("error",()=>{pe.src=lE}),K.appendChild(ce),K.appendChild(pe),i.appendChild(K),t.appendChild(i),i.addEventListener("click",Q=>{let ie=Q.currentTarget;if(ie.disabled||ie.dataset.lockedPlain==="1"){Q.preventDefault(),Q.stopImmediatePropagation();return}if(so(ie)){Q.preventDefault(),Q.stopImmediatePropagation();return}if(Q.shiftKey||Q.ctrlKey){if(Q.preventDefault(),Q.stopImmediatePropagation(),!ie.upgMeta)return;let me=ie.upgMeta.id,Pe=ie.upgMeta.upgType==="HM",ne=[1,3,4,5,6].includes(ap(ie.upgMeta));if(Q.shiftKey){if((Pe||!ne)&&this.adapter.buyCheap){let{bought:Me}=this.adapter.buyCheap(me);(Me instanceof c?Me:c.fromAny(Me??0)).isZero?.()||(on(),this.update());return}let{bought:ge}=this.adapter.buyMax(me);if(!(ge instanceof c?ge:c.fromAny(ge??0)).isZero?.()){if(on(),ou(ie.upgMeta,this.mode))try{cl(["reset"])}catch{}this.update()}return}if(Q.ctrlKey){if(Pe){let Me=this.adapter.getUiModel(me);if(Me&&!Me.hmReadyToEvolve){let Be=Me.hmNextMilestone;if(Be&&Me.lvlBn&&Be.cmp(Me.lvlBn)>0){let ae=0;try{let oe=Be.sub(Me.lvlBn).toPlainIntegerString?.();ae=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Be.sub(Me.lvlBn).toString())))}catch{}let ee=R[Me.upg.costType]?.value,we=ee instanceof c?ee:c.fromAny(ee??0),z=Si(Me.upg,Me.lvlBn,we,ae).count,Z=!1;try{let oe=z?.toPlainIntegerString?.();Z=oe&&oe!=="Infinity"?Number(oe)>=ae:Number(z??0)>=ae}catch{}if(Z){let oe=this.adapter.buyNext(me,ae);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(on(),this.update());return}}}}let{bought:ge}=this.adapter.buyMax(me);if(!(ge instanceof c?ge:c.fromAny(ge??0)).isZero?.()){if(on(),ou(ie.upgMeta,this.mode))try{cl(["reset"])}catch{}this.update()}return}}ie.upgMeta&&pE(ie.upgMeta,this.mode)}),i.addEventListener("contextmenu",Q=>{if(Je)return;let ie=Q.currentTarget;if(ie.dataset.locked==="1"||(Q.preventDefault(),Q.stopPropagation(),!ie.upgMeta))return;if(this.adapter.getUiModel(ie.upgMeta.id)?.hmReadyToEvolve){let{evolved:ge}=this.adapter.evolve(ie.upgMeta.id);ge&&(Ky(),this.update());return}let{bought:Pe}=this.adapter.buyMax(ie.upgMeta.id);if(!(Pe instanceof c?Pe:c.fromAny(Pe??0)).isZero?.()){if(on(),ou(ie.upgMeta,this.mode))try{cl(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let m=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",m);let y=s?c.fromInt(0):uE(r.meta,r.levelNumeric,r.level),p=y instanceof c?y:c.fromAny(y),h=te(r.level),g=iu(h),v=te(p),E=iu(v),L=!p.isZero?.(),M=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,N=Number.isFinite(M)?Math.max(0,Math.floor(M)):1/0,q=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,P=m?!1:r.level?.isInfinite?.()?!0:Number.isFinite(N)&&Number.isFinite(q)?q>=N:!1,G=Number.isFinite(N)&&N===1,C=!!r.meta?.unlockUpgrade,U=!s&&C&&!P,T=!s&&C&&!U&&P,_,V,J=!1,se=!1;if(s){_="",V="";let K=u?(r.lockState?.reason||"").trim():"",ce=K?`${r.title} (Locked, ${K})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ce)}else{if(U||T)_=U?"Unlockable":"Unlocked",V=_,se=!0;else if(!s&&G&&!C)P?(_="Owned",V="Owned"):L?(_="Purchasable",V="Purchasable"):(_="Not Owned",V="Not Owned"),se=!0;else{let K=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ce=String(g||"").replace(/,/g,""),pe=/|Infinity/i.test(ce),Q=Number.isFinite(K)?K>=1e3:pe||/^\d{4,}$/.test(ce);J=L&&Q,J?(_=`<span class="badge-lvl">${h}</span><span class="badge-plus">(+${v})</span>`,V=`${g} (+${E})`):(_=L?`${h} (+${v})`:h,V=L?`${g} (+${E})`:g)}i.setAttribute("aria-label",`${r.title}, ${V}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let de=i.firstElementChild,ye=de.querySelector(".base"),Re=de.querySelector(".icon"),Ce=r.meta?.costType||"coins",Y=r.useLockedBase||s?Qw:r.baseIconOverride||$y[Ce]||$y.coins;ye.src!==Y&&(ye.src=Y);let $=r.icon;if(!$)Re.hidden||(Re.hidden=!0);else{Re.hidden&&(Re.hidden=!1);let K=$;Re._lastSrc!==K&&(Re.src=K,Re._lastSrc=K)}let H=de.querySelector(".maxed-overlay"),j=!s&&Vy(r.meta),W=!s&&P;if(W||!s&&!P&&!m&&j){H||(H=document.createElement("img"),H.className="maxed-overlay",H.alt="",de.insertBefore(H,Re));let K=W?eE:tE;H.src!==K&&(H.src=K)}else H&&H.remove();let x=de.querySelector(".level-badge");s?x&&x.remove():(x||(x=document.createElement("span"),x.className="level-badge",de.appendChild(x)),x.className="level-badge",se&&x.classList.add("text-badge"),J&&x.classList.add("two-line"),(L||U)&&x.classList.add("can-buy"),P&&x.classList.add("is-maxed"),_===V?x.textContent!==_&&(x.textContent=_):x.innerHTML!==_&&(x.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),Ls(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&so(a)||(Or(),Ay())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(Je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{Je&&Tn(80),this.close()},{passive:!0}),bd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&By(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,Je)try{setTimeout(()=>Lo(240),120)}catch{}Tn(10),Ls(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||!t&&rl()||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}};typeof window<"u"&&window.addEventListener("menu:scrollStop",()=>{nr(!0)});su={standard:new fl("standard"),automation:new fl("automation"),dna:new fl("dna")};rn=null,ut=null,au=!1,ru=null});var ev={};vt(ev,{applyHudLayout:()=>or,initHudButtons:()=>hE,isMapUnlocked:()=>fp,isShopUnlocked:()=>up,lockMap:()=>pu,lockShop:()=>du,unlockMap:()=>fu,unlockShop:()=>Ii});function cp(e){let t=b();return t==null?e:`${e}:${t}`}function Bs(e){let t=cp(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function up(){return dp(),Bs(ho.SHOP)}function fp(){return dp(),Bs(ho.MAP)}function uu(e,t){let n=t?"1":"0",o=cp(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function dp(){for(let e of Object.values(ho)){let t=cp(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function No(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function lp(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",Wi())}function mE(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function or(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=mE(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(y=>e.querySelector(`.game-btn[data-btn="${y}"]`)).filter(Boolean),a=[...e.children].filter(y=>!l.includes(y)),u=[...l,...a];if(u.length&&u.some((y,p)=>e.children[p]!==y)){let y=document.createDocumentFragment();u.forEach(p=>y.appendChild(p)),e.appendChild(y)}let m=[...e.querySelectorAll(".game-btn")].filter(y=>!y.hidden);if(e.classList.remove("is-2","is-3","is-4"),m.forEach(y=>{y.style.gridColumn="",y.style.gridRow="",y.classList.remove("span-2"),y.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${m.length}`),!o){let y=getComputedStyle(e),p=parseFloat(y.columnGap||y.gap||"0")||0,h=e.clientWidth,g=Math.max(180,Math.floor((h-3*p)/4));if(m.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3";return}if(m.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3",m[2].style.gridColumn="4";return}}if(o&&m.length===3){let y=e.querySelector('[data-btn="help"]:not([hidden])'),p=e.querySelector('[data-btn="stats"]:not([hidden])'),h=e.querySelector('[data-btn="shop"]:not([hidden])');y&&p&&h&&(y.style.gridColumn="1",y.style.gridRow="1",p.style.gridColumn="2",p.style.gridRow="1",h.style.gridColumn="1 / -1",h.style.gridRow="2")}}function hE(){if(dp(),No("help",!0),No("stats",!0),No("shop",Bs(ho.SHOP)),No("map",Bs(ho.MAP)),lp(),or(),Jy||(Jy=!0,window.addEventListener("resize",or),window.addEventListener("orientationchange",or),window.addEventListener("saveSlot:change",()=>{No("shop",Bs(ho.SHOP)),No("map",Bs(ho.MAP)),lp(),or()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||lp()})),!Qy){Qy=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&Es()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&so(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function Ii(){uu(ho.SHOP,!0),No("shop",!0),or()}function fu(){uu(ho.MAP,!0),No("map",!0),or()}function du(){uu(ho.SHOP,!1),No("shop",!1),or()}function pu(){uu(ho.MAP,!1),No("map",!1),or()}var ho,Jy,Qy,mu=$e(()=>{ci();St();os();ho={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Jy=!1,Qy=!1});function tv(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(K=>K.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let x=0;x<t;x++)d[x*f+2]=1/0;let m=new Int16Array(t),y=t;for(let x=0;x<t;x++)m[x]=t-1-x;let p=-1,h=document.createElement("canvas");h.className="cursor-trail-canvas",Object.assign(h.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(h);let g=h.getContext("2d",{alpha:!0,desynchronized:!0}),v=document.createElement("canvas");v.width=a,v.height=a;let E=v.getContext("2d");E.shadowColor="#FFEB3B",E.shadowBlur=l,E.fillStyle="#FFEB3B",E.beginPath(),E.arc(u,u,s,0,Math.PI*2),E.fill();let L=!1,M=null,N=null,q={left:0,top:0,width:0,height:0},P=1,G=!1,C=0,U=0,T=!1,_=null,V=[],J=()=>{if(G)return;let x=document.documentElement.clientWidth,K=document.documentElement.clientHeight;q={left:0,top:0,width:x,height:K,right:x,bottom:K,x:0,y:0}},se=()=>{if(G)return;J();let x=Math.min(window.devicePixelRatio||1,2);P=q.width>0?Math.min(x,512/q.width):x,h.width=q.width*P,h.height=q.height*P,g.scale(P,P),_=null},de=null;typeof ResizeObserver<"u"&&(de=new ResizeObserver(()=>{se()}),de.observe(e));let ye=(x,K)=>{if(y<=0)return;let ce=m[--y];ce>p&&(p=ce);let pe=ce*f;d[pe]=x,d[pe+1]=K,d[pe+2]=0,d[pe+3]=n},Re=(x,K,ce)=>{if(M===null||N===null)ce.count<r&&(ye(x,K),ce.count++);else{let pe=x-M,Q=K-N,ie=Math.hypot(pe,Q);if(ie>=o){let me=Math.floor(ie/o);for(let Pe=1;Pe<=me&&!(ce.count>=r);Pe++){let ne=Pe*o/ie;ye(M+pe*ne,N+Q*ne),ce.count++}}ce.count<r&&(ye(x,K),ce.count++)}M=x,N=K},Ce=x=>{if(G)return;C||(U=0,C=requestAnimationFrame(Y)),q.width||J();let K=0,ce=0,pe=(Q,ie)=>Q>=0&&Q<=q.width&&ie>=0&&ie<=q.height;if(x.getCoalescedEvents){let Q=x.getCoalescedEvents();if(Q.length>0)for(let ie of Q){let me=ie.clientX-K,Pe=ie.clientY-ce;V.push({x:me,y:Pe,inside:pe(me,Pe)})}else{let ie=x.clientX-K,me=x.clientY-ce;V.push({x:ie,y:me,inside:pe(ie,me)})}}else{let Q=x.clientX-K,ie=x.clientY-ce;V.push({x:Q,y:ie,inside:pe(Q,ie)})}},F=()=>{L=!1,M=null,N=null,V.length=0},Y=()=>{if(G)return;let x=performance.now();U||(U=x);let K=x-U;U=x,K>100&&(K=100);let ce={count:0};if(V.length>0){for(let Ue of V)Ue.inside?(L=!0,Re(Ue.x,Ue.y,ce)):(L=!1,M=null,N=null);let ge=V[V.length-1];ge.inside&&(M!==ge.x||N!==ge.y)&&(ye(ge.x,ge.y),M=ge.x,N=ge.y),V.length=0}else L&&M!==null&&N!==null&&ye(M,N);let pe=t-y;if(pe===0&&!T){C=0;return}_?g.clearRect(_.x,_.y,_.w,_.h):g.clearRect(0,0,q.width,q.height),T=!1;let Q=1/0,ie=1/0,me=-1/0,Pe=-1/0,ne=-1;if(pe>0)for(let ge=0;ge<=p;ge++){let Ue=ge*f,Me=d[Ue+2];if(Me>=d[Ue+3])continue;if(Me+=K,d[Ue+2]=Me,Me>=d[Ue+3]){m[y++]=ge;continue}ne=ge;let Be=d[Ue+3],ae=Me/Be,ee=1-ae,we=1-.4*ae;T=!0,g.globalAlpha=ee;let w=a*we,z=w/2,Z=d[Ue],oe=d[Ue+1],he=Math.round(Z-z),le=Math.round(oe-z),We=Math.round(w);g.drawImage(v,he,le,We,We),he<Q&&(Q=he),le<ie&&(ie=le);let nt=he+We,be=le+We;nt>me&&(me=nt),be>Pe&&(Pe=be)}p=ne,Q!==1/0?(Q-=2,ie-=2,me+=2,Pe+=2,_={x:Q,y:ie,w:me-Q,h:Pe-ie}):_=null,C=requestAnimationFrame(Y)};window.addEventListener("resize",se),window.addEventListener("scroll",J,{passive:!0}),window.addEventListener("focus",J,{passive:!0}),document.addEventListener("visibilitychange",J,{passive:!0});let $={passive:!0},H=x=>{J(),Ce(x)},j=x=>{J(),Ce(x)};e.addEventListener("pointermove",Ce,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",H,$),e.addEventListener("pointerleave",F,$),e.addEventListener("pointercancel",F,$),se(),C=requestAnimationFrame(Y);let W=setInterval(J,1e3);return{destroy:()=>{G=!0,C&&cancelAnimationFrame(C),W&&clearInterval(W),de&&(de.disconnect(),de=null);try{window.removeEventListener("resize",se)}catch{}try{window.removeEventListener("scroll",J)}catch{}try{window.removeEventListener("focus",J)}catch{}try{document.removeEventListener("visibilitychange",J)}catch{}try{e.removeEventListener("pointermove",Ce),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",H),e.removeEventListener("pointerleave",F),e.removeEventListener("pointercancel",F)}catch{}h.remove()}}}var nv=$e(()=>{});var pv={};vt(pv,{clearPendingGains:()=>wp,getPassiveCoinReward:()=>Vc,initCoinPickup:()=>xE,setCoinMultiplier:()=>bE,triggerPassiveCollect:()=>Md});function ov(e){if(!e||typeof e!="object"){hl=!1,hu=!1,gu="0",xi.clear();return}hl=!!e.unlocked,hu=!!e.level?.isInfinite?.();try{gu=e.level?.toPlainIntegerString?.()??"0"}catch{gu="0"}hl?hu&&xi.clear():xi.clear()}function gE(){if(typeof wi=="function")try{wi()}catch{}try{ov(mt())}catch{hl=!1,xi.clear()}try{wi=Li(e=>{ov(e)})}catch{wi=null}}function bE(e){vE=e;try{R.coins?.mult?.set&&R.coins.mult.set(e)}catch{}}function gp(){try{let e=Cc();e instanceof c?Us=e.clone?.()??e:e!=null?Us=c.fromAny(e):Us=c.fromInt(1)}catch{Us=c.fromInt(1)}}function SE(){rv||(rv=!0,gp(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",gp),typeof window<"u"&&window.addEventListener("saveSlot:change",gp))}function IE(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Sp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function bp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*wE:0}function EE({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,m=0,y=null,p=null,h=bp(),g=0,v=0,E=0,L=!1,M=null,N=null,q=()=>{if(L)return;let $=document.documentElement.clientWidth,H=document.documentElement.clientHeight;M={left:0,top:0,width:$,height:H,right:$,bottom:H,x:0,y:0}},P=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",y=null,p=null},G=()=>{if(!l||v<=0){P();return}let $=v*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${d-v}px, ${m-v}px, 0)`,s.classList.add("is-visible")},C=()=>{if(!(!l||v<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=v+yp,H=[];if(typeof i.findCoinTargetsInPath=="function"&&y!==null&&p!==null?H=i.findCoinTargetsInPath(y,p,d,m,$):H=i.findCoinTargetsInRadius(d,m,$),y=d,p=m,H&&H.length>0)if(typeof r=="function"){let j=[];for(let W=0;W<H.length;W++){let re=H[W],x={coin:re};re.el&&i.getCoinTransform&&(x.opts={transform:i.getCoinTransform(re.el)}),j.push(x)}r(j)}else for(let j=0;j<H.length;j++){let W=H[j],re=i.ensureCoinVisual?i.ensureCoinVisual(W):W.el;if(re){let x=i.getCoinTransform?i.getCoinTransform(re):re.style.transform||"";o(re,{transform:x})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=v+yp,H=i.findCoinsInRadius(d,m,$);if(y=d,p=m,H&&H.length>0){let j=[];for(let W=0;W<H.length;W++){let re=H[W],x=i.getCoinTransform?i.getCoinTransform(re):re.style.transform;j.push({el:re,opts:{transform:x}})}typeof r=="function"&&r(j)}}else{let $=t.children,H=v+yp,j=[];for(let W=$.length-1;W>=0;W--){let re=$[W];if(re.dataset.collected==="1"||!re.matches(n))continue;let x=re.getBoundingClientRect(),K=x.left+x.width/2,ce=x.top+x.height/2,pe=K-u,Q=ce-f;Math.hypot(pe,Q)<=H&&j.push(re)}if(!j.length)return;if(typeof r=="function"){let W=[];for(let re=0;re<j.length;re++){let x=j[re],K=window.getComputedStyle(x);W.push({el:x,opts:{transform:K.transform}})}r(W)}else{let W=[];for(let re=0;re<j.length;re++){let x=j[re],K=window.getComputedStyle(x);W.push(K.transform)}for(let re=0;re<j.length;re++)o(j[re],{transform:W[re]})}}},U=()=>{E=0,G(),!(!l||v<=0||L)&&(C(),T())},T=()=>{!l||v<=0||E||L||(E=requestAnimationFrame(U))},_=$=>{if(!$||L||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,f=$.clientY,M||q();let H=M;d=u,m=f,l=d>=0&&d<=H.width&&m>=0&&m<=H.height,T()},V=()=>{l=!1,P(),y=null,p=null},J=()=>{y=null,p=null},se=()=>{g=Mc(),v=g*h,G(),T()},de=()=>{if(!(L||!a)){if(q(),M){let $=M;d=u-$.left,m=f-$.top,l=d>=0&&d<=$.width&&m>=0&&m<=$.height}T()}},ye=()=>{if(h=bp(),v=g*h,q(),a&&M){let $=M;d=u-$.left,m=f-$.top,l=d>=0&&d<=$.width&&m>=0&&m<=$.height}T()},Re=$=>{q(),_($)},Ce=$=>{J(),Re($)},F=()=>{L=!0,E&&(cancelAnimationFrame(E),E=0),N&&clearInterval(N);try{window.removeEventListener("scroll",de)}catch{}try{window.removeEventListener("resize",ye)}catch{}try{window.removeEventListener("saveSlot:change",se)}catch{}try{document.removeEventListener("ccc:upgrades:changed",se)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",Re)}catch{}try{e.removeEventListener("pointerenter",Ce)}catch{}try{e.removeEventListener("pointerleave",V)}catch{}try{e.removeEventListener("pointercancel",V)}catch{}try{window.removeEventListener("blur",J)}catch{}try{s.remove()}catch{}},Y={passive:!0};return e.addEventListener("pointermove",_,Y),e.addEventListener("pointerdown",Re,Y),e.addEventListener("pointerenter",Ce,Y),e.addEventListener("pointerleave",V,Y),e.addEventListener("pointercancel",V,Y),window.addEventListener("resize",ye),window.addEventListener("scroll",de,{passive:!0}),window.addEventListener("focus",q,{passive:!0}),window.addEventListener("blur",J,{passive:!0}),document.addEventListener("visibilitychange",()=>{q(),document.hidden&&J()},{passive:!0}),window.addEventListener("saveSlot:change",se),document.addEventListener("ccc:upgrades:changed",se),N=setInterval(q,1e3),se(),{destroy:F}}function wp(){gl=null,yl=null,vl=null}function dv(e){let t=Sp.clone?.()??c.fromInt(1),n=uv(t),o=go(iv),i=fv(e??gu);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Ro=="function"&&Ro()?go(Us):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function Vc(){let{coinGain:e,xpGain:t,mpGain:n}=dv(null);return{coins:e,xp:t,mp:n}}function Md(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=dv(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=qn(Ne.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{kn=kn?.add?kn.add(r):go(r)}catch{kn=go(r)}ml(),a||sv(r);let u=typeof dn=="function"?dn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&av(i),s.isZero?.()||lv(s)}function xE({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){pp?.destroy&&pp.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};gE(),SE(),a.style.touchAction="none";let d=null,m=null;kn=R.coins.value,vp=()=>{let x=te(kn);x.includes("<span")?f.innerHTML=x:f.textContent=x},cv(),ml();let y=x=>{x?.detail&&x.detail.key==="coins"&&(kn=x.detail.value,ml())};window.addEventListener("currency:change",y);let p=x=>{if(!(!x?.detail||x.detail.key!=="coins"))try{let{mult:K}=x.detail;K instanceof c?Jn=K.clone?.()??K:K!=null?Jn=c.fromAny(K):Jn=c.fromInt(1),Ei=!!Jn?.isInfinite?.()}catch{Jn=null,Ei=!1}};window.addEventListener("currency:multiplier",p);let h=b();if(h==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${h}`,v=`ccc:unlock:shop:progress:${h}`,E=localStorage.getItem("ccc:unlock:shop:progress"),L=localStorage.getItem("ccc:unlock:shop");E!=null&&localStorage.getItem(v)==null&&localStorage.setItem(v,E),L!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,L),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let x=parseInt(localStorage.getItem(v)||"0",10);if(localStorage.setItem(v,String(x)),x>=10&&localStorage.getItem(g)!=="1"){try{Ii()}catch{}localStorage.setItem(g,"1")}}let M=new URL(i,document.baseURI).href,N=x=>x instanceof HTMLElement?x._coinObj?!x._coinObj.isRemoved&&x.dataset.collected!=="1":x.dataset.collected!=="1"&&x.matches(r):!1;function q(x){try{x.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(q);let P=Je?.12:.3,G=0;function C(x=M){if(x===M){let K=performance.now();if(K-G<40)return;G=K}ht(x,{volume:P})}function U(x,K={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(x);let ce=()=>{x&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(x):x.remove())};if(l||Je){ce();return}let pe="translate3d(0,0,0)";K.transform?K.transform!=="none"&&(pe=K.transform):pe=x.style.transform||"translate3d(0,0,0)",x.style.setProperty("--ccc-start",pe),x.classList.add("coin--collected");let Q=!1,ie=()=>{Q||(Q=!0,x.removeEventListener("animationend",ie),ce())};x.addEventListener("animationend",ie),setTimeout(ie,600)}function T(x){if(!x||!x.length)return;let K=M,ce=-1,pe=!1;for(let ae of x){let ee=ae.coin||ae.el&&ae.el._coinObj;ee&&(ee.sizeIndex!==void 0?ee.sizeIndex>ce&&(ce=ee.sizeIndex,ee.soundSrc&&(K=ee.soundSrc,pe=!0)):ee.soundSrc&&!pe&&(K=ee.soundSrc,pe=!0))}C(K);let Q=null,ie=null,me=null,Pe=0,ne=qn(Ne.COINS),ge=typeof dn=="function"?dn():!0,Ue=typeof Ro=="function"&&Ro(),Me=15,Be=0;for(let ae of x){let ee=ae.el,we=ae.coin;if(!we&&ee&&ee._coinObj&&(we=ee._coinObj),ee&&!N(ee)||we&&we.isRemoved)continue;Pe++,ee&&(ee.dataset.collected="1"),Be<Me?(!ee&&we&&e&&e.ensureCoinVisual&&(ee=e.ensureCoinVisual(we),ee&&(ee.dataset.collected="1")),ee?(U(ee,ae.opts||{}),Be++):we&&e&&e.removeCoinTarget&&e.removeCoinTarget(we)):we&&e&&e.removeCoinTarget?e.removeCoinTarget(we):ee&&(e&&e.detachCoin&&e.detachCoin(ee),e&&e.recycleCoin?e.recycleCoin(ee):ee.remove());let w=ee?IE(ee):Sp,z=we?.mutationLevel??(ee?.dataset?.mutationLevel||null),Z=uv(w),oe=go(iv),he=go(Us);if(we&&we.valueMultiplier&&we.valueMultiplier>1){try{Z=Z.mulDecimalFloor(we.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(we.valueMultiplier)}catch{}try{he=he.mulDecimalFloor(we.valueMultiplier)}catch{}}let le=fv(z);if(le){try{Z=Z.mulBigNumInteger(le)}catch{}try{oe=oe.mulBigNumInteger(le)}catch{}}ne||(Q=Ds(Q,Z)),ge&&(ie=Ds(ie,oe)),Ue&&(me=Ds(me,he))}if(Pe!==0){if(Q&&!Q.isZero?.()){try{kn=kn?.add?kn.add(Q):go(Q)}catch{kn=go(Q)}sv(Q),ml()}if(ie&&!ie.isZero?.()&&av(ie),me&&!me.isZero?.()&&lv(me),localStorage.getItem(g)!=="1"){let ee=parseInt(localStorage.getItem(v)||"0",10)+Pe;if(localStorage.setItem(v,String(ee)),ee>=10){try{Ii()}catch{}localStorage.setItem(g,"1")}}}}function _(x,K={}){return T([{el:x,opts:K}]),!0}d=EE({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:T,spawner:e}),m=tv(a);let V=x=>{if(x.target===u)return;let K=x.target.closest(r);if(K&&N(K)){let ce={};e&&typeof e.getCoinTransform=="function"&&(ce.transform=e.getCoinTransform(K)),_(K,ce)}};u.addEventListener("pointerdown",V,{passive:!0}),Je||u.addEventListener("mouseover",V,{passive:!0});let J=25,se=null,de=()=>{let x=document.documentElement.clientWidth,K=document.documentElement.clientHeight;se={left:0,top:0,width:x,height:K,right:x,bottom:K,x:0,y:0}};window.addEventListener("resize",de),window.addEventListener("scroll",de,{passive:!0}),de();let ye=null,Re=null,Ce=()=>{ye=null,Re=null};a.addEventListener("pointerleave",Ce,{passive:!0}),a.addEventListener("pointerenter",Ce,{passive:!0}),window.addEventListener("blur",Ce,{passive:!0});function F(x,K){if(e&&typeof e.findCoinTargetsInRadius=="function"){se||de();let ce=x,pe=K,Q=[];if(typeof e.findCoinTargetsInPath=="function"&&ye!==null&&Re!==null?Q=e.findCoinTargetsInPath(ye,Re,ce,pe,J,!0):Q=e.findCoinTargetsInRadius(ce,pe,J,!0),ye=ce,Re=pe,Q&&Q.length>0){let ie=[];for(let me=0;me<Q.length;me++){let Pe=Q[me],ne={coin:Pe};Pe.el&&e.getCoinTransform&&(ne.opts={transform:e.getCoinTransform(Pe.el)}),ie.push(ne)}T(ie)}}else if(e&&typeof e.findCoinsInRadius=="function"){se||de();let ce=x,pe=K,Q=e.findCoinsInRadius(ce,pe,J);if(ye=ce,Re=pe,Q&&Q.length>0){let ie=[];for(let me of Q){let Pe=e.getCoinTransform?e.getCoinTransform(me):me.style.transform;ie.push({el:me,opts:{transform:Pe}})}T(ie)}}else{let ce=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],pe=new Set;for(let Q=0;Q<ce.length;Q++){let ie=x+ce[Q][0],me=K+ce[Q][1],Pe=document.elementsFromPoint(ie,me);for(let ne=0;ne<Pe.length;ne++){let ge=Pe[ne];N(ge)&&!pe.has(ge)&&pe.add(ge)}}if(pe.size>0){let Q=[];pe.forEach(ie=>Q.push({el:ie})),T(Q)}}}let Y=null,$=!1;function H(x,K){Y={x,y:K},$||($=!0,requestAnimationFrame(()=>{Y&&(F(Y.x,Y.y),Y=null),$=!1}))}a.addEventListener("pointerdown",x=>{H(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointermove",x=>{x.pointerType!=="mouse"&&H(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointerup",x=>{x.pointerType!=="mouse"&&H(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("mousemove",x=>{H(x.clientX,x.clientY)},{passive:!0});function j(x){}let W=setInterval(de,1e3),re=()=>{if(clearInterval(W),yu(),vp=()=>{},typeof window<"u"&&(window.removeEventListener("resize",de),window.removeEventListener("beforeunload",yu),window.removeEventListener("currency:multiplier",p),window.removeEventListener("currency:change",y),window.removeEventListener("blur",Ce)),typeof wi=="function"){try{wi()}catch{}wi=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(m?.destroy){try{m.destroy()}catch{}m=null}try{u.removeEventListener("pointerdown",V),Je||u.removeEventListener("mouseover",V)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(x=>a.replaceWith(a.cloneNode(!0)))}catch{}};return pp={destroy:re},{get count(){return kn},set count(x){kn=c.fromAny?c.fromAny(x):c.fromInt(Number(x)||0),ml()},setMobileVolume:j,destroy:re,collectBatch:T,getMagnetUnitPx:bp}}var hl,hu,gu,wi,pp,iv,Sp,yE,Fs,xi,vE,Us,rv,gl,yl,vl,mp,kn,vp,hp,ml,wE,yp,go,Ds,yu,Ip,sv,av,lv,Jn,Ei,cv,uv,fv,Wa=$e(()=>{St();Et();Wt();mu();Yn();uo();To();co();nv();$n();hl=!1,hu=!1,gu="0",wi=null;pp=null,iv=c.fromInt(1),Sp=c.fromInt(1),yE=c.fromInt(1);try{Fs=c.fromAny("Infinity")}catch{Fs=null}xi=new Map,vE="1",Us=c.fromInt(1),rv=!1,gl=null,yl=null,vl=null,mp=!1,kn=null,vp=()=>{},hp=!1,ml=()=>{hp||(hp=!0,requestAnimationFrame(()=>{hp=!1,vp()}))};wE=.05,yp=8;go=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Ds=(e,t)=>{if(!t)return e;if(!e)return go(t);try{return e.add(t)}catch{try{return go(e).add(t)}catch{return go(t)}}},yu=()=>{let e=gl;if(gl=null,e&&!e.isZero?.())try{R.coins.add(e)}catch{}let t=yl;if(yl=null,t&&!t.isZero?.())try{es(t)}catch{}let n=vl;if(vl=null,n&&!n.isZero?.())try{_s(n)}catch{}},Ip=()=>{mp||(mp=!0,requestAnimationFrame(()=>{mp=!1,yu()}))},sv=e=>{gl=Ds(gl,e),Ip()},av=e=>{yl=Ds(yl,e),Ip()},lv=e=>{vl=Ds(vl,e),Ip()};typeof window<"u"&&window.addEventListener("beforeunload",yu,{passive:!0});Jn=null,Ei=!1,cv=()=>{try{let e=R?.coins?.mult;if(!e||typeof e.get!="function"){Jn=null,Ei=!1;return}let t=e.get();if(!t){Jn=c.fromInt(1),Ei=!1;return}Jn=t.clone?.()??c.fromAny(t),Ei=!!Jn?.isInfinite?.()}catch{Jn=null,Ei=!1}},uv=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Jn||cv();let n=Jn;if(!n)try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(Ei||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},fv=e=>{if(!hl)return null;if(hu){if(Fs)try{return Fs.clone?.()??Fs}catch{return Fs}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=xi.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{xi.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=$s(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(yE)===0,s=r.clone?.()??r;if(xi.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function LE(e){if(e==null)return 0;try{let t=localStorage.getItem(hv(e));return t?parseInt(t,10):0}catch{return 0}}function _E(e,t){if(e!=null)try{localStorage.setItem(hv(e),t.toString())}catch{}}function CE(e){if(e==null)return 0;try{let t=localStorage.getItem(gv(e));return t?parseInt(t,10):0}catch{return 0}}function ME(e,t){if(e!=null)try{localStorage.setItem(gv(e),t.toString())}catch{}}function TE(e){if(e==null)return 0;try{let t=localStorage.getItem(yv(e));return t?parseInt(t,10):0}catch{return 0}}function kE(e,t){if(e!=null)try{localStorage.setItem(yv(e),t.toString())}catch{}}function AE(e){if(e==null)return 0;try{let t=localStorage.getItem(vv(e));return t?parseInt(t,10):0}catch{return 0}}function NE(e,t){if(e!=null)try{localStorage.setItem(vv(e),t.toString())}catch{}}function bv(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let p=Number(e.toString());isNaN(p)||(t=p),(e==="Infinity"||p===1/0)&&(n=!0)}catch{}let o=b(),r=LE(o),i=r;i<1&&n&&(i=1),i<2&&ct(4)>=1&&(i=2),i!==r&&(r=i,_E(o,r));let s=CE(o),l=s;l<1&&ct(4)>=1&&(l=1),l!==s&&(s=l,ME(o,s));let a=TE(o),u=a;u<1&&ct(4)>=1&&(u=1),u!==a&&(a=u,kE(o,a));let f=AE(o),d=f;d<1&&ct(4)>=1&&(d=1),d!==f&&(f=d,NE(o,f));let m=[],y=[];for(let p of mv){let h=p;if(n){h={...p,description:[...p.description]};let g=Ln(),v=Co(),E=g+v;if(E>1&&(E=1),p.id===1){let L=Math.pow(10,E),M=Ae(L);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${M}x</span>`)}else if(p.id===2){let L=Math.pow(10,E),M=Ae(L);h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${M}x</span>`)}else if(p.id===4){let L=Math.log10(4444e9),M=ve(L*E),N=te(M);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${N}x</span>`)}else if(p.id===14){let L=Math.log10(1414e10),M=ve(L*E),N=te(M);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${N}x</span>`)}}if(p.id===9&&(h===p&&(h={...p,description:[...p.description]}),r===0?h.description=["This milestone is hidden for now"]:r===1&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===10&&(h===p&&(h={...p,description:[...p.description]}),s===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===13){h===p&&(h={...p,description:[...p.description]});let v=kt()*1.5-.5,E=Math.pow(100,v),L=Ae(E);h.description[0]=`Generates <span style="color:#00e5ff">${L}%</span> of your pending Gold each second`}if(p.id===14&&(h===p&&(h={...p,description:[...p.description]}),a===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===15)if(h===p&&(h={...p,description:[...p.description]}),f===0)h.description=["This milestone is hidden until you research Lab Node 4"];else{let g=Rc(!0),v=Ae(g);h.description[0]=`Unspent DNA boosts Coins: <span style="color:#00e5ff">${v}x</span>`}if(p.id===16){h===p&&(h={...p,description:[...p.description]});let v=kt()*1.5-.5,E=Math.pow(100,v),L=Ae(E);h.description[0]=`Generates <span style="color:#00e5ff">${L}%</span> of your pending Magic each second`}p.surgeLevel<=t?m.push(h):y.push(h)}return[...m,...y.slice(0,2)]}var mv,Ep,hv,gv,yv,vv,Sv=$e(()=>{Wt();Et();Et();zn();li();St();mv=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${te(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade","Makes each Workshop Level triple Gear production instead of doubling it"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]},{id:10,surgeLevel:10,description:["Unlocks new DNA upgrades"]},{id:11,surgeLevel:11,description:["Unlocks a new automation upgrade","Makes each Workshop Level quadruple Gear production instead of tripling it"]},{id:12,surgeLevel:12,affectedByTsunami:!0,description:["Significantly boosts the effect Lab Level has on RP multiplier"]},{id:13,surgeLevel:13,affectedByTsunami:!0,description:['Generates <span style="color:#00e5ff">0.1%</span> of your pending Gold each second']},{id:14,surgeLevel:14,affectedByTsunami:!0,description:[`Multiplies DNA value by <span style="color:#00e5ff">${te(c.fromInt(1414e10))}x</span>`]},{id:15,surgeLevel:15,affectedByTsunami:!0,description:['Unspent DNA boosts Coins: <span style="color:#00e5ff">1x</span>']},{id:16,surgeLevel:16,affectedByTsunami:!0,description:['Generates <span style="color:#00e5ff">0.1%</span> of your pending Magic each second']}],Ep=mv.filter(e=>e.affectedByTsunami).map(e=>e.id),hv=e=>`ccc:surge:milestone9:state:${e}`,gv=e=>`ccc:surge:milestone10:state:${e}`,yv=e=>`ccc:surge:milestone14:state:${e}`,vv=e=>`ccc:surge:milestone15:state:${e}`});function Iv(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ht("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(w,z){w.style.position="absolute",w.style.left="50%";let Z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,he=!!o.mpHTML;z==="coin"?(w.style.top="77%",w.style.transform=`translateX(-50%) ${Z}`):oe&&he?(w.style.top="72.5%",z==="mp"?w.style.transform=`translateX(calc(-100% - 44px)) ${Z}`:w.style.transform=`translateX(44px) ${Z}`):(z==="mp"?w.style.top="66%":z==="xp"&&(w.style.top="72%"),w.style.transform=`translateX(-50%) ${Z}`),w.style.transformOrigin="center center";let le=w.firstElementChild;le&&(le.removeAttribute("hidden"),le.style.display="flex")}if(o.coinHTML){let w=document.createElement("div");w.innerHTML=o.coinHTML,f(w,"coin"),u.appendChild(w)}if(o.xpHTML){let w=document.createElement("div");w.innerHTML=o.xpHTML,f(w,"xp"),u.appendChild(w)}if(o.mpHTML){let w=document.createElement("div");w.innerHTML=o.mpHTML,f(w,"mp"),u.appendChild(w)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let m=new Image;m.src="img/misc/merchant.webp";let y=!1;m.onload=()=>{y=!0},m.onerror=w=>{console.error("Tsunami: Merchant load failed",w)};let p,h,g=[],v=[],E=0;function L(){g=[],v=[];let w=h*.65,z=w+h*.15,oe=300*(Math.min(p,h)*5e-4),he=p*.8,le=he-oe*.6,We=he+oe*.6;for(let dt=0;dt<100;dt++){let cn=Math.random()*p,Un=z+Math.random()*(h-z);v.push({x:cn,y:Un})}let nt=(dt,cn,Un)=>{if(dt>p*.1&&dt<p*.9){let Ut=h-w,In=w+Ut*.15;if(cn>In)return!1}else if(Un==="tree"){let Ut=h-w,In=w+Ut*.5;if(cn>In)return!1}return!(Un==="tree"&&dt>le&&dt<We)},be=(dt,cn,Un,Ut,In)=>{for(let Vr=0;Vr<cn;Vr++){let Do,$o,dr=!1,Te=0;for(;!dr&&Te<50;){In?Do=In():Do=Math.random()*p;let I=h,k=Math.random();if($o=w+20+k*k*(I-w-20),nt(Do,$o,dt)&&(dr=!0,dt==="tree")){for(let O of g)if(O.type==="tree"){let A=O.x-Do,B=O.y-$o;if(Math.sqrt(A*A+B*B)<Math.max(p*.08,100)){dr=!1;break}}}Te++}if(dr){let k=.6+($o-w)/(h-w)*.6,O=(Un+Math.random()*Ut)*k;g.push({type:dt,x:Do,y:$o,scale:O})}}},Ge=3+Math.floor(Math.random()*3);be("tree",Ge,.8,.4,()=>Math.random()*(p*.1)),be("tree",Ge,.8,.4,()=>p*.9+Math.random()*(p*.1));let Ht=5+Math.floor(Math.random()*3);be("tree",Ht,.8,.4,()=>p*.1+Math.random()*(p*.8)),be("rock",20,.6,.4),be("shell",30,.3,.3),g.sort((dt,cn)=>dt.y-cn.y)}let M=a.getContext("2d",{alpha:!1}),N=d.getContext("2d",{alpha:!0});function q(){let w=window.devicePixelRatio||1;p=window.innerWidth,h=window.innerHeight,a.width=p*w,a.height=h*w,a.style.width=p+"px",a.style.height=h+"px",d.width=p*w,d.height=h*w,d.style.width=p+"px",d.style.height=h+"px",M.scale(w,w),N.scale(w,w),L(),E=-50}window.addEventListener("resize",q),q();let P=Date.now(),G=!0,C,U=!1,T={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},V=!1,J=[],se=0,de=!1,ye=0,Re=5e3,Ce=!1,F=0,Y=[],$=6;for(let w=0;w<$;w++)Y.push({offset:Math.random()*1e3,speedBase:.001+w*5e-4,amplitudeBase:10+w*5});let H=[],j=400;function W(w,z,Z){return w*(1-Z)+z*Z}function re(w){let z=parseInt(w.slice(1),16);return{r:z>>16&255,g:z>>8&255,b:z&255}}function x(w,z,Z){let oe=re(w),he=re(z),le=Math.round(W(oe.r,he.r,Z)),We=Math.round(W(oe.g,he.g,Z)),nt=Math.round(W(oe.b,he.b,Z));return`rgb(${le},${We},${nt})`}function K(w,z,Z){let oe=[],he=w,le=z,We=20;for(;le<Z;){let nt=he+(Math.random()-.5)*60,be=le+We+Math.random()*30;oe.push({x1:he,y1:le,x2:nt,y2:be}),he=nt,le=be}return oe}function ce(w,z,Z,oe,he,le){w.beginPath(),w.moveTo(z+le,Z),w.lineTo(z+oe-le,Z),w.quadraticCurveTo(z+oe,Z,z+oe,Z+le),w.lineTo(z+oe,Z+he-le),w.quadraticCurveTo(z+oe,Z+he,z+oe-le,Z+he),w.lineTo(z+le,Z+he),w.quadraticCurveTo(z,Z+he,z,Z+he-le),w.lineTo(z,Z+le),w.quadraticCurveTo(z,Z,z+le,Z),w.closePath()}function pe(w,z,Z,oe,he){w.save(),w.translate(z,Z),w.scale(oe,oe),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(10,-40,-5,-80),w.lineTo(5,-80),w.quadraticCurveTo(20,-40,10,0),w.fillStyle=he.rock,w.fill(),w.translate(0,-80),w.fillStyle=he.leaf;for(let le=0;le<7;le++)w.save(),w.rotate(le/7*Math.PI*2-Math.PI/2),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(30,-10,60,0),w.quadraticCurveTo(30,10,0,0),w.fill(),w.restore();w.restore()}function Q(w,z,Z,oe,he){w.save(),w.translate(z,Z),w.scale(oe,oe),w.fillStyle=he.rock,w.beginPath(),w.moveTo(-20,0),w.bezierCurveTo(-20,-15,-10,-25,0,-25),w.bezierCurveTo(10,-25,20,-15,20,0),w.fill(),w.fillStyle="rgba(0,0,0,0.2)",w.beginPath(),w.ellipse(0,0,20,5,0,0,Math.PI*2),w.fill(),w.restore()}function ie(w,z,Z,oe,he){w.save(),w.translate(z,Z),w.scale(oe,oe),w.fillStyle=he.shell,w.beginPath(),w.arc(0,0,10,Math.PI,0),w.lineTo(0,0),w.fill(),w.strokeStyle=he.sandDark,w.lineWidth=1,w.beginPath();for(let le=1;le<5;le++){let We=Math.PI+le/5*Math.PI;w.moveTo(0,0),w.lineTo(Math.cos(We)*10,Math.sin(We)*10)}w.stroke(),w.restore()}function me(w,z,Z,oe,he){w.fillStyle=he.sandDark,w.fillRect(-50,oe,z+100,Z-oe),w.fillStyle=he.sandDark,w.save(),w.fillStyle=he.sandLight,w.globalAlpha=.3,w.beginPath(),w.moveTo(-50,Z+100),w.lineTo(-50,oe),w.bezierCurveTo(z*.3,oe-20,z*.7,oe+20,z+50,oe),w.lineTo(z+50,Z+100),w.fill(),w.globalAlpha=.6;let le=oe+Z*.05;w.beginPath(),w.moveTo(-50,Z+100),w.lineTo(-50,le),w.bezierCurveTo(z*.4,le+40,z*.6,le-10,z+50,le+20),w.lineTo(z+50,Z+100),w.fill(),w.globalAlpha=1;let We=oe+Z*.15;w.beginPath(),w.moveTo(-50,Z+100),w.lineTo(-50,We),w.bezierCurveTo(z*.2,We-10,z*.8,We+30,z+50,We+10),w.lineTo(z+50,Z+100),w.fill(),w.fillStyle=he.sandDark,w.globalAlpha=.1,v.forEach(nt=>{w.fillRect(nt.x,nt.y,2,2)}),w.restore()}function Pe(w,z,Z,oe=null){let he=oe||1,le=!!oe&&oe>5;V&&!le&&!Ce&&ht("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),J.push({x:le?z/2:Math.random()*z,y:le?Z/2:Math.random()*Z,radius:0,maxRadius:le?Math.max(z,Z)*1.5:(100+Math.random()*400)*he,speed:le?40:(5+Math.random()*15)*he,opacity:1,hue:225+Math.random()*15,life:1})}function ne(w,z,Z,oe=.5,he=!0){let le=.1+oe*.7,We=Math.floor(1+oe*4);if(he&&!Ce){for(let nt=0;nt<We;nt++)if(J.length<50&&Math.random()<le){let be=1+oe*2;Pe(w,z,Z,be)}}w.save(),w.globalCompositeOperation="lighter";for(let nt=J.length-1;nt>=0;nt--){let be=J[nt];if(be.radius+=be.speed,be.opacity-=.015,be.life-=.015,be.opacity<=0||be.radius>be.maxRadius){J.splice(nt,1);continue}let Ge=w.createRadialGradient(be.x,be.y,0,be.x,be.y,be.radius),Ht=be.opacity;Ge.addColorStop(0,`hsla(${be.hue}, 100%, 80%, ${Ht})`),Ge.addColorStop(.3,`hsla(${be.hue}, 100%, 40%, ${Ht*.9})`),Ge.addColorStop(.7,`hsla(${be.hue}, 100%, 15%, ${Ht*.6})`),Ge.addColorStop(1,`hsla(${be.hue}, 100%, 5%, 0)`),w.fillStyle=Ge,w.beginPath(),w.arc(be.x,be.y,be.radius,0,Math.PI*2),w.fill()}w.restore()}function ge(){if(!G)return;let w=Date.now(),z=w-P;Math.min(z/t,1)>=1&&!U&&(U=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,he=6e3,le=5e4,We=5e4,nt=5e3,be=4e4,Ge=0;z<he?Ge=0:z<le?Ge=(z-he)/(le-he):Ge=1;let Ht=0;z>be&&(Ht=Math.max(0,(z-be)/(le-be))),z>le&&(Ht=1),Ht>.1&&!i&&(i=ht("sounds/tsu_rumble.ogg",{volume:.8}));let dt={skyTop:x(T.skyTop,_.skyTop,Ge),skyBottom:x(T.skyBottom,_.skyBottom,Ge),sun:x(T.sun,_.sun,Ge),waterDeep:x(T.waterDeep,_.waterDeep,Ge),waterMid:x(T.waterMid,_.waterMid,Ge),waterPeak:x(T.waterPeak,_.waterPeak,Ge),foam:x(T.foam,_.foam,Ge),sandLight:x(T.sandLight,_.sandLight,Ge),sandDark:x(T.sandDark,_.sandDark,Ge),rock:x(T.rock,_.rock,Ge),leaf:x(T.leaf,_.leaf,Ge),shell:x(T.shell,_.shell,Ge)},cn=0,Un=0;if(Ge>.5||Ce){let Te=(Ge-.5)*2*5+Ht*25;F>0&&(Te+=50),cn=(Math.random()-.5)*Te,Un=(Math.random()-.5)*Te}N.clearRect(0,0,p,h),M.save(),M.translate(cn,Un),N.save(),N.translate(cn,Un);let Ut=M.createLinearGradient(0,0,0,h);if(Ut.addColorStop(0,dt.skyTop),Ut.addColorStop(1,dt.skyBottom),M.fillStyle=Ut,M.fillRect(-50,-50,p+100,h+100),Ge<1){let Te=h*.15+Ge*50;M.beginPath(),M.arc(p*.7,Te,40,0,Math.PI*2),M.fillStyle=dt.sun,M.globalAlpha=1-Ge,M.shadowColor=dt.sun,M.shadowBlur=20,M.fill(),M.globalAlpha=1,M.shadowBlur=0}let In=h*.65;if(y&&Ge<1){M.save();let Te=Math.min(p,h)*5e-4,I=300*Te,k=300*Te,O=p*.8,A=k*.15,B=In-k/2+A;M.translate(O,B),M.rotate(.1),M.drawImage(m,-I/2,-k/2,I,k),M.restore()}if(me(M,p,h,In,dt),g.forEach(Te=>{Te.type==="tree"?pe(M,Te.x,Te.y,Te.scale,dt):Te.type==="rock"?Q(M,Te.x,Te.y,Te.scale,dt):Te.type==="shell"&&ie(M,Te.x,Te.y,Te.scale,dt)}),Ge>.3){let Te=(Ge-.3)/.7,I=Math.floor(j*Te);if(N.strokeStyle=`rgba(120, 180, 255, ${.1+Te*.3})`,N.lineWidth=1+Te,N.beginPath(),H.length<I)for(let O=0;O<10;O++)H.push({x:Math.random()*p*1.5,y:E,speed:20+Math.random()*20,len:10+Math.random()*20});let k=10+Te*20;for(let O=0;O<H.length;O++){let A=H[O];A.y+=A.speed,A.x-=k,N.moveTo(A.x,A.y),N.lineTo(A.x-k*.5,A.y+A.len),(A.y>h||A.x<-100)&&(O<I?(A.x=Math.random()*p*1.5,A.y=E):(H.splice(O,1),O--))}N.stroke()}let Vr=.3;if(Ge>Vr){let Te=(Ge-Vr)/(1-Vr),I=W(0,h*1.5,Te*Te);N.fillStyle=dt.waterDeep,N.beginPath(),N.moveTo(-50,h+100),N.lineTo(-50,h-I*.3),N.bezierCurveTo(p*.3,h-I*.4,p*.6,h-I*1.2,p+50,h-I*.8),N.lineTo(p+50,h+100),N.fill()}let Do=W(0,h*.5,Ge),$o=W(0,h*1.5,Ht*Ht),dr=h*.85-Do-$o;if(Y.forEach((Te,I)=>{let k;I===$-1?k=dt.waterPeak:I%2===0?k=dt.waterDeep:k=dt.waterMid,N.fillStyle=k,N.beginPath();let O=Te.amplitudeBase*(1+Ge*2+Ht*5),A=.003+Ge*.005,B=Te.speedBase*(1+Ge*5+Ht*10),ue=z*B+Te.offset,fe=I*15*(1-Ht),Ee=dr+fe;N.moveTo(-50,h+100),N.lineTo(-50,Ee);for(let Le=-50;Le<=p+50;Le+=15){let Ke=Ee+Math.sin(Le*A+ue)*O+Math.cos(Le*A*2.3+ue)*(O*.5);N.lineTo(Le,Ke)}if(N.lineTo(p+50,h+100),N.fill(),I===$-1||Ge>.6&&I>$-3){N.save(),N.globalAlpha=.1+Ge*.3,N.fillStyle=dt.foam,N.beginPath();for(let Le=-50;Le<=p+50;Le+=10){let Ke=Ee+Math.sin(Le*A+ue)*O+Math.cos(Le*A*2.3+ue)*(O*.5);Math.random()>.5&&(Ke-=5),Le===-50?N.moveTo(Le,Ke):N.lineTo(Le,Ke)}N.lineTo(p+50,h+100),N.lineTo(-50,h+100),N.fill(),N.restore()}}),z<oe){let Te=1;z>1e3&&(Te=1-(z-1e3)/(oe-1e3)),N.fillStyle=`rgba(0, 0, 0, ${Te})`,N.fillRect(-50,-50,p+100,h+100)}if(z>We){let Te=Math.min(1,(z-We)/nt);N.fillStyle=`rgba(0, 0, 0, ${Te})`,N.fillRect(-50,-50,p+100,h+100)}if(V){let Te=w-se,I=12e3,k=0,O=!0;Te<I?k=Te/I:(k=1,Ce||(Ce=!0,Pe(N,p,h,25),F=60,l||(l=!0,ht("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),de&&(O=!1),ne(N,p,h,k,O)}if(de){let Te=w-ye,I=Math.min(1,Te/Re);N.fillStyle=`rgba(0, 0, 0, ${I})`,N.fillRect(-50,-50,p+100,h+100)}if(F>0){let Te=F/60,I=Te*Te;N.fillStyle=`rgba(255, 255, 255, ${I})`,N.fillRect(-50,-50,p+100,h+100),F--}M.restore(),N.restore(),C=requestAnimationFrame(ge)}function Ue(){G=!1,e.style.cursor="",C&&cancelAnimationFrame(C),window.removeEventListener("resize",q),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function Me(){V=!0,se=Date.now(),Ce=!1,F=0,s||(s=ht("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Be(){de=!0,ye=Date.now(),s&&s.stop()}function ae(){e.style.cursor=""}function ee(){e.style.cursor="none"}function we(){s&&(s.stop(),s=null)}return ge(),{cleanup:Ue,triggerBeacons:Me,triggerFinalFade:Be,showCursor:ae,hideCursor:ee,stopHumLoop:we}}var wv=$e(()=>{$n()});var o0={};vt(o0,{canPerformForgeReset:()=>Zv,canPerformInfuseReset:()=>Jv,computeForgeGoldFromInputs:()=>Pc,computeInfuseMagicFromInputs:()=>Bc,computePendingDnaFromInputs:()=>Dv,computePendingForgeGold:()=>jv,computeSurgeWavesFromInputs:()=>Uv,getCurrentSurgeLevel:()=>jn,getForgeDebugOverrideState:()=>Gv,getInfuseDebugOverrideState:()=>Xv,getSurgeBarLevelKey:()=>qs,getSurgeDebugOverrideState:()=>Wv,hasDoneExperimentReset:()=>Kv,hasDoneForgeReset:()=>Rr,hasDoneInfuseReset:()=>qt,hasDoneSurgeReset:()=>ko,initResetPanel:()=>rp,initResetSystem:()=>Yo,isExperimentUnlocked:()=>Ll,isForgeUnlocked:()=>Ns,isInfuseUnlocked:()=>ku,isSurgeUnlocked:()=>Br,onForgeUpgradeUnlocked:()=>em,onInfuseUpgradeUnlocked:()=>tm,onSurgeUpgradeUnlocked:()=>nm,performForgeReset:()=>jp,performInfuseReset:()=>Zp,performSurgeReset:()=>Jp,recomputePendingMagic:()=>mn,setExperimentResetCompleted:()=>Gp,setForgeDebugOverride:()=>Hv,setForgeResetCompleted:()=>Dp,setInfuseDebugOverride:()=>Yv,setInfuseResetCompleted:()=>$p,setInfuseUnlockedForDebug:()=>Vv,setSurgeResetCompleted:()=>qp,setSurgeUnlockedForDebug:()=>zv,shouldBlockBigCoins:()=>El,updateResetPanel:()=>qe});function Ap(e){return!qE.includes(e)}function GE(){ht(FE,{volume:.4})}function HE(){ht(UE,{volume:.45})}function XE(){ht(DE,{volume:.5})}function VE(){ht($E,{volume:.8})}function El(){return Ov}function Pv(){let e=Nn(),t=R.waves?.value??st(),n=0n;try{n=_l(e)}catch{}let o=S.pendingWaves,r=Qp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),Ov=i&&!pn()}function wl(){_p=null}function Lu(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function _u(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function Cp(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Fp(e=null){try{let t=Za(),n=S.pendingGold.clone?.()??S.pendingGold;if(e){let o=e instanceof Mt?e:Mt.fromAny(e??1);if(o.isInfinite?.())return Mt.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=R.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return S.pendingGold}}function zE(){for(;Qn.length;){let e=Qn.pop();try{e?.()}catch{}}}function Lp(){!_v&&typeof tc=="function"&&(_v=tc((e={})=>{e?.key&&e.key!==Ne.COINS&&e.key!==Ne.WAVES||e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(e?.key===Ne.WAVES?(Au(),qe()):(hn(),mn(),An()))})),!Cv&&typeof dc=="function"&&(Cv=dc((e={})=>{e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(hn(),An(),Oo(),qe())}))}function Up(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=ke(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function xl(){try{let e=rt();if(e&&e.xpLevel)return e.xpLevel}catch{}return st()}function Bv(e,t){if(!e||typeof e!="object")return st();let n=ke(e);if(!Number.isFinite(n)&&n>0)return Mt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return st();let r=ve(o*Math.log10(2)),i=Math.max(0,Up(t)),s=Math.max(0,(i-30)/5),l=s<=0?Ev():ve(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?Ev():ve(a*Math.log10(1.15)),f=Mt.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?st():d}function KE(e,t){if(!e)return st();let n=ke(e);if(!Number.isFinite(n)&&n>0)return Mt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let y=ke(t);Number.isFinite(y)&&(a=Math.max(0,y-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,m=r+u+f+d;return Number.isFinite(m)?ve(m).floorToInteger():Mt.fromAny("Infinity")}function Fv(e,t,n=null){let o=KE(e,t),r=Ad(),i;if(n){let s=n instanceof Mt?n:Mt.fromAny(n??1);if(s.isInfinite?.())return Mt.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=R.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function Pc(e,t){return Bv(e,t)}function Bc(e,t){return Fv(e,t)}function Uv(e,t,n,o,r){return $v(e,t,n,o,r)}function Dv(e,t,n=null){e||(e=st()),t||(t=st());let o=.30103,r=0;if(n!==null?!!n:Fe(9)){let l=kt();o=Math.log10(2+l),r=30*l}if(Fe(14))if(Fe(8)){let l=kt(),a=Math.log10(1414e10);r+=a*l}else r+=Math.log10(1414e10);let s=o.toFixed(18);try{let l=e.mulDecimal(s,18),u=t.div(c.fromInt(20)).mulDecimal(s,18),f=l.add(u);r>0&&(f=f.add(c.fromAny(r)));let d=0;return f.isInfinite()?d=1/0:d=Number(f.toScientific(10)),ve(d).floorToInteger()}catch{return st()}}function $v(e,t,n,o,r){let i=Up(e);if(i<201)return st();let s=(i-201)/35,l=ke(t),a=ke(n),u=ke(o),f=ke(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return Mt.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*vu),Number.isFinite(a)&&a>13&&(d+=(a-13)*vu),Number.isFinite(u)&&u>5&&(d+=(u-5)*vu),Number.isFinite(f)&&f>12&&(d+=(f-12)*vu);let m=1+d+s;return Number.isFinite(m)?ve(m).floorToInteger():Mt.fromAny("Infinity")}function qv(){return Math.max(0,Up(xl()))}function Nn(){if(S.slot!=null)return S.slot;let e=b();return S.slot=e,e}function Dp(e){let t=Nn();if(t!=null){S.hasDoneForgeReset=!!e;try{localStorage.setItem(Np(t),S.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function $p(e){let t=Nn();if(t!=null){S.hasDoneInfuseReset=!!e;try{localStorage.setItem(Rp(t),S.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function qp(e){let t=Nn();if(t!=null){S.hasDoneSurgeReset=!!e;try{localStorage.setItem(Op(t),S.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Gp(e){let t=Nn();if(t!=null){S.hasDoneExperimentReset=!!e;try{localStorage.setItem(Bp(t),S.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function Tu(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Sl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Gv(e=b()){return Tu(e)}function Hv(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.forgeDebugOverride!==n){if(S.forgeDebugOverride=n,n==null)try{localStorage.removeItem(Sl(t))}catch{}else try{localStorage.setItem(Sl(t),n?"1":"0")}catch{}lt(Sl(t)),Lu(),qe()}}function Hp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Il(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Xv(e=b()){return Hp(e)}function Vv(e){Xp(e)}function Yv(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.infuseDebugOverride!==n){if(S.infuseDebugOverride=n,n==null)try{localStorage.removeItem(Il(t))}catch{}else try{localStorage.setItem(Il(t),n?"1":"0")}catch{}lt(Il(t)),_u(),qe()}}function Xp(e){let t=Nn();if(t==null)return;let n=!!e;if(S.infuseUnlocked!==n){S.infuseUnlocked=n;try{localStorage.setItem(Eu(t),S.infuseUnlocked?"1":"0")}catch{}lt(Eu(t)),_u()}}function Cu(e){let t=Nn();if(t==null)return;let n=!!e;if(S.forgeUnlocked!==n){S.forgeUnlocked=n;try{localStorage.setItem(wu(t),S.forgeUnlocked?"1":"0")}catch{}lt(wu(t)),Lu()}}function Vp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Rv(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Wv(e=b()){return Vp(e)}function zv(e){Yp(e)}function Yp(e){let t=Nn();if(t==null)return;let n=!!e;if(S.surgeUnlocked!==n){S.surgeUnlocked=n;try{localStorage.setItem(xu(t),S.surgeUnlocked?"1":"0")}catch{}lt(xu(t)),Cp()}}function Mp(e){if(e==null){S.forgeUnlocked=!1,S.forgeDebugOverride=null,S.hasDoneForgeReset=!1,S.infuseUnlocked=!1,S.infuseDebugOverride=null,S.hasDoneInfuseReset=!1,S.surgeUnlocked=!1,S.surgeDebugOverride=null,S.hasDoneSurgeReset=!1,S.hasDoneExperimentReset=!1,S.flagsPrimed=!1;return}try{S.forgeUnlocked=localStorage.getItem(wu(e))==="1"}catch{S.forgeUnlocked=!1}S.forgeDebugOverride=Tu(e);try{S.hasDoneForgeReset=localStorage.getItem(Np(e))==="1"}catch{S.hasDoneForgeReset=!1}try{S.infuseUnlocked=localStorage.getItem(Eu(e))==="1"}catch{S.infuseUnlocked=!1}try{S.hasDoneInfuseReset=localStorage.getItem(Rp(e))==="1"}catch{S.hasDoneInfuseReset=!1}S.infuseDebugOverride=Hp(e);try{S.surgeUnlocked=localStorage.getItem(xu(e))==="1"}catch{S.surgeUnlocked=!1}S.surgeDebugOverride=Vp(e);try{S.hasDoneSurgeReset=localStorage.getItem(Op(e))==="1"}catch{S.hasDoneSurgeReset=!1}try{S.hasDoneExperimentReset=localStorage.getItem(Bp(e))==="1"}catch{S.hasDoneExperimentReset=!1}S.flagsPrimed=!0}function yo(){let e=b();if(e==null){S.flagsPrimed=!1;return}S.slot!==e&&(S.slot=e,wl(),S.flagsPrimed=!1),S.flagsPrimed||Mp(e)}function Mv(e){xv!==e&&(zE(),xv=e,e!=null&&(Qn.push(Tt(wu(e),{onChange(t){let n=t==="1";S.forgeUnlocked!==n&&(S.forgeUnlocked=n,Lu(),qe())}})),Qn.push(Tt(Np(e),{onChange(t){let n=t==="1";S.hasDoneForgeReset!==n&&(S.hasDoneForgeReset=n,qe())}})),Qn.push(Tt(Sl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.forgeDebugOverride!==n&&(S.forgeDebugOverride=n,Lu(),qe())}})),Qn.push(Tt(Eu(e),{onChange(t){let n=t==="1";S.infuseUnlocked!==n&&(S.infuseUnlocked=n,_u(),qe())}})),Qn.push(Tt(Rp(e),{onChange(t){let n=t==="1";S.hasDoneInfuseReset!==n&&(S.hasDoneInfuseReset=n,qe())}})),Qn.push(Tt(Il(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.infuseDebugOverride!==n&&(S.infuseDebugOverride=n,_u(),qe())}})),Qn.push(Tt(xu(e),{onChange(t){let n=t==="1";S.surgeUnlocked!==n&&(S.surgeUnlocked=n,Cp(),qe())}})),Qn.push(Tt(Rv(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.surgeDebugOverride!==n&&(S.surgeDebugOverride=n,Cp(),qe())}})),Qn.push(Tt(Op(e),{onChange(t){let n=t==="1";S.hasDoneSurgeReset!==n&&(S.hasDoneSurgeReset=n,qe())}})),Qn.push(Tt(Bp(e),{onChange(t){let n=t==="1";S.hasDoneExperimentReset!==n&&(S.hasDoneExperimentReset=n,qe())}}))))}function jE(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function hn(e=!1){let t=R.coins?.value??st(),n=xl(),o=jE(t,n);!e&&_p===o||(_p=o,Wp()?S.pendingGold=Bv(t,n):S.pendingGold=st(),qe())}function mn(e=null){let t=R.coins?.value??st(),n=mi();zp()?S.pendingMagic=Fv(t,n,e):S.pendingMagic=st(),An(),qe()}function An(){if(!Br()){S.pendingWaves=st(),Oo();return}let e=xl(),t=R.coins?.value??st(),n=R.gold?.value??st(),o=R.magic?.value??st(),r=mi();S.pendingWaves=$v(e,t,n,o,r),ko()||S.pendingWaves.cmp(Mt.fromInt(10))>0&&(S.pendingWaves=Mt.fromInt(10)),Oo(),Pv()}function Oo(){if(!Ll()){S.pendingDna=st();return}let e=.30103,t=0;if(Fe(9)){let i=kt();e=Math.log10(2+i),t=30*i}if(Fe(14))if(Fe(8)){let i=kt(),s=Math.log10(1414e10);t+=s*i}else t+=Math.log10(1414e10);let n=e.toFixed(18),o=Kt?Kt():st(),r=xl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),S.pendingDna=ve(u).floorToInteger()}catch{try{S.pendingDna=st()}catch{S.pendingDna=st()}}}function Tp(){let e=Tu();return e!=null?!!e:S.forgeUnlocked||At(Ie.STARTER_COVE,xe.UNLOCK_FORGE)>=1}function Wp(){try{let e=xl();if(e&&typeof e.cmp=="function")return e.cmp(YE)>=0}catch{}return!1}function zp(){try{let e=mt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(WE)>=0}catch{}return!1}function Ns(){yo();let e=Tu();return e!=null?!!e:!!S.forgeUnlocked||Tp()}function ku(){yo();let e=Hp();return e!=null?!!e:!!S.infuseUnlocked}function Br(){yo();let e=Vp();return e!=null?!!e:!!S.surgeUnlocked}function Ll(){return Hg()}function jn(){let e=Nn();return e==null?0n:_l(e)}function Rr(){return yo(),!!S.hasDoneForgeReset}function qt(){return yo(),!!S.hasDoneInfuseReset}function ko(){return yo(),!!S.hasDoneSurgeReset}function Kv(){return yo(),!!S.hasDoneExperimentReset}function jv(){return hn(),S.pendingGold.clone?.()??S.pendingGold}function Zv(){return!(!Ns()||!Wp()||S.pendingGold.isZero?.())}function Jv(){return!(!ku()||!zp()||S.pendingMagic.isZero?.())}function ZE({resetGold:e=!1,resetMagic:t=!1}={}){let n=Ct(Ie.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===xe.UNLOCK_XP||r===xe.UNLOCK_FORGE||r===xe.UNLOCK_INFUSE||r===xe.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||rr(Ie.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Kp({resetGold:e=!1,resetMagic:t=!1}={}){try{R.coins.set(0)}catch{}try{R.books.set(0)}catch{}try{Qi({keepUnlock:!0})}catch{}try{wp()}catch{}ZE({resetGold:e,resetMagic:t})}function jp(){if(!Zv())return!1;let e=Fp();try{R.gold?.add&&R.gold.add(e)}catch{}if(Kp({resetGold:!1}),hn(),Cu(!0),S.hasDoneForgeReset||Dp(!0),Qt(),Pr(),Ap("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return qe(),!0}function Zp(){if(!Jv())return!1;let e=S.pendingMagic.clone?.()??S.pendingMagic;try{R.magic?.add&&R.magic.add(e)}catch{}Kp({resetGold:!0});try{R.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Qt({forceReload:!0})}catch{}if(hn(),mn(),Ap("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return Xp(!0),S.hasDoneInfuseReset||$p(!0),qe(),!0}function Mu(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Nn();try{R.waves?.add&&e&&!e.isZero?.()&&R.waves.add(e)}catch{}Kp({resetGold:!0,resetMagic:!0});try{R.gold.set(0)}catch{}try{R.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Qt({forceReload:!0})}catch{}if(Au(),Yp(!0),S.hasDoneSurgeReset||qp(!0),hn(),mn(),An(),t&&(n||XE(),n||ex()),Ap("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}qe()}function Qv(){if(!Ll()||(Kt?Kt():st()).cmp(10)<0)return!1;let t=S.pendingDna.clone?.()??S.pendingDna;try{R.DNA?.add&&R.DNA.add(t)}catch{}return Mu(st(),{playEffects:!1}),VE(),Xg([4]),S.hasDoneExperimentReset||Gp(!0),hn(),mn(),An(),Oo(),qe(),!0}function JE(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{jy(!0)}catch{}try{Qc()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,jo(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=Iv(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Py(e,()=>{setTimeout(QE,0)},i)},r);Iu=i.cleanup}function QE(){Iu&&(Iu(),Iu=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Mu(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function Jp(){if(!Br()||qv()<201)return!1;let e=S.pendingWaves.clone?.()??S.pendingWaves;if(e.isZero?.())return!1;let t=Nn(),n=R.waves?.value??st(),o=_l(t),r=Qp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!pn()?(JE(),Mu(e,{playEffects:!1}),!0):(Mu(e,{playEffects:!0}),!0)}function ex(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function _l(e){let t=0n;try{let n=localStorage.getItem(Pp(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function tx(e){let t=Pp(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function Tv(e){if(!(e instanceof Mt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function e0(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=Tv(n),l=Tv(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function Au(){let e=Nn();if(e==null||!Br()||xp||tx(e))return;let t=R.waves?.value??st(),n=_l(e);if(n===1/0)return;let o=e0(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Pp(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}xp=!0;try{R.waves.set(o.remainingWaves)}finally{xp=!1}qe(),o.safety>=100&&setTimeout(Au,0)}Pv()}function bl(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Mt.fromInt(e)}catch{}try{return te(t)}catch{return e?.toString?.()??"0"}}function nx(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),m=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${m.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let m="";for(let y=0;y<=r;y++){let p=y/r,h=a+p*(u-a),g=h/(Math.PI*2)*120,v=50+30*Math.sin(h+d);m+=(y===0?"M":"L")+` ${g.toFixed(1)} ${v.toFixed(1)}`}return`<path d="${m}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function ox(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${RE}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${OE}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${PE}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${BE}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${kv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Av}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Su}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${Je?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Nv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,S.panel=e,S.elements.forge.card=e.querySelector("#reset-card-forge"),S.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),S.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),S.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),S.elements.infuse.card=e.querySelector("#reset-card-infuse"),S.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),S.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),S.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),S.elements.surge.card=e.querySelector("#reset-card-surge"),S.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),S.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),S.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),S.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),S.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),S.elements.surge.headerVal=e.querySelector("[data-surge-level]"),S.elements.surge.header=e.querySelector(".surge-header"),S.elements.experiment.card=e.querySelector("#reset-card-experiment"),S.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),S.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");S.elements.surge.milestones&&t&&Ls(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),S.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(S.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&so(r))return;let a=S.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),S.elements.forge.btn&&S.elements.forge.btn.addEventListener("click",()=>{jp()&&(GE(),qe())}),S.elements.infuse.btn&&S.elements.infuse.btn.addEventListener("click",()=>{Zp()&&(HE(),qe())}),S.elements.surge.btn&&S.elements.surge.btn.addEventListener("click",()=>{Jp()&&qe()}),S.elements.experiment.btn&&S.elements.experiment.btn.addEventListener("click",()=>{Qv()&&qe()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=nx();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{Es("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}qe()}function rp(e){!e||e.__resetInit||(e.__resetInit=!0,ox(e))}function Po(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=bl(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function t0({goldMult:e=null}={}){let t=S.elements.forge;if(!(!t.card||!t.btn)){if(!Ns()){Po(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(yo(),t.card.classList.toggle("is-forge-complete",!!S.hasDoneForgeReset),t.status)if(S.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!Wp()){Po(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Po(t.btn,{disabled:!1},kv,Fp(e))}}function n0(){let e=S.elements.infuse;if(!(!e.card||!e.btn)){if(!ku()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="none"&&(S.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="flex"&&(S.layerButtons.infuse.style.display="flex"),yo(),e.card.classList.toggle("is-complete",!!S.hasDoneInfuseReset),e.status)if(S.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!zp()){Po(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Po(e.btn,{disabled:!1},Av,S.pendingMagic)}}function Qp(e,t,n){let o=t.add(n);return e0(e,o).level}function kp(){let e=S.elements.surge;if(!e.card||!e.btn)return;if(!Br()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="none"&&(S.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="flex"&&(S.layerButtons.surge.style.display="flex"),yo();let t=Nn(),n=R.waves?.value??st(),o=0n;try{o=_l(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':bl(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=S.pendingWaves;if(u&&!u.isZero?.()){let f=Qp(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let m=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':bl(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${m}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${Su}">${bl(n)} / <img src="${Su}">${bl(r)}</span>`),e.milestones){let s=bv(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",m=a.description.map(M=>M.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${M}</div>`:`<div>- ${M}</div>`).join("");if(f&&a.surgeLevel===3){let M=_r?_r():Mt.fromInt(0);m+=`<div style="color:#02e815">- Current Books/sec: ${te(M)}</div>`}if(f&&a.surgeLevel===6){let M=Oc();m=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Ae(M.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Ae(M.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Ae(M.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Ae(M.magic)}x</span></div>`}if(f&&a.surgeLevel===13){let q=2*(kt()*1.5-.5)-2,P=ve(q),C=Fp().mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Gold/sec: ${Ae(C)}</div>`}if(f&&a.surgeLevel===16){let q=2*(kt()*1.5-.5)-2,P=ve(q),G=S.pendingMagic.mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Magic/sec: ${Ae(G)}</div>`}let y=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(y=!0);let p=kt(),h=!1;f&&y&&p<1&&Ep.includes(a.id)&&(h=!0);let g=h?" is-nerfed":"",v=l[u];if(!v)v=document.createElement("div"),v.className=`surge-milestone-item ${d}${g}`,v.dataset.isReached=String(f),v.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(v);else{v.className!==`surge-milestone-item ${d}${g}`&&(v.className=`surge-milestone-item ${d}${g}`);let M=String(f);v.dataset.isReached!==M&&(v.dataset.isReached=M)}let E=v.querySelector(".surge-milestone-desc");E&&E.innerHTML!==m&&(E.innerHTML=m);let L=v.querySelector(".surge-milestone-nerf-arrow");if(L){let M=!1;y&&p<1&&Ep.includes(a.id)&&(M=!0);let N=M?"":"none";L.style.display!==N&&(L.style.display=N)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();S.lastRenderedSurgeLevel!==o&&(S.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!S.hasDoneSurgeReset),e.status)if(S.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(qv()<201){Po(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(S.pendingWaves.isZero?.()){Po(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Po(e.btn,{disabled:!1},Su,S.pendingWaves)}function rx(){let e=S.elements.experiment;if(!e.card||!e.btn)return;if(!Ll()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="none"&&(S.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="flex"&&(S.layerButtons.experiment.style.display="flex"),yo(),e.card.classList.toggle("is-complete",!!S.hasDoneExperimentReset),e.status)if(S.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((Kt?Kt():st()).cmp(10)<0){Po(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}Po(e.btn,{disabled:!1},Nv,S.pendingDna)}function qe({goldMult:e=null}={}){S.panel&&(rl()||(t0({goldMult:e}),n0(),kp(),rx()))}function em(){Yo(),Cu(!0),qe()}function tm(){Yo(),Xp(!0),qe()}function nm(){Yo(),Yp(!0),qe()}function ix(){if(!S.panel)return;let e=S.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!S.panel.classList.contains("is-active")||!S.elements.surge.barFill)return;let t=S.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",kp(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",kp()},{once:!0}))}function sx(){typeof window>"u"||(window.addEventListener("menu:scrollStop",()=>{qe()}),window.addEventListener("surge:level:change",()=>{ix()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(hn(),mn(),An()),e.detail?.key==="waves"&&(Au(),qe()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(An(),qe())}),window.addEventListener("surge:bookResidue",()=>{if(S.panel&&S.panel.offsetParent!==null){let e=S.elements.surge.card;e&&e.style.display!=="none"&&qe()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Ne.GOLD){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;hn(!0);let n=t.mult instanceof c?t.mult:Mt.fromAny(t.mult??1);S.panel&&t0({goldMult:n});return}if(t.key===Ne.MAGIC){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;let n=t.mult instanceof c?t.mult:Mt.fromAny(t.mult??1);mn(n),S.panel&&n0();return}}}),window.addEventListener("xp:change",()=>{hn(),An(),Oo(),qe()}),window.addEventListener("mutation:change",()=>{mn(),An(),qe()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&S.slot!=null&&e.detail.slot!==S.slot||(wl(),hn(!0),mn(),An(),Oo(),qe())}),window.addEventListener("lab:level:change",()=>{Oo(),qe()}),window.addEventListener("lab:node:change",()=>{mn(),qe()}))}function Yo(){if(Lv){S.slot=b(),wl(),Lp(),hn(!0),mn(),An(),Oo();return}try{Qt()}catch{return}Lv=!0;let e=b();if(S.slot=e,wl(),Mp(e),S.hasDoneForgeReset&&!Ro())try{Pr()}catch{}if(!S.forgeUnlocked&&Tp()&&Cu(!0),Mv(e),Lp(),sx(),hn(!0),mn(),An(),Oo(),bu){try{bu()}catch{}bu=null}bu=Li(()=>{let t=om();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(S.slot=t,wl(),Mp(t),S.hasDoneForgeReset&&!Ro())try{Pr()}catch{}!S.forgeUnlocked&&Tp()&&Cu(!0),Mv(t),Lp(),hn(!0),mn(),An(),Oo(),qe()})}var Mt,vu,st,Ev,kv,Av,Nv,RE,OE,PE,BE,Su,FE,UE,DE,$E,qE,wu,Np,Sl,Eu,Rp,Il,xu,Rv,Op,qs,Pp,Bp,YE,WE,xp,Ov,S,Qn,xv,Lv,bu,_p,_v,Cv,Iu,Mo=$e(()=>{Et();uo();St();Wt();Yn();co();To();os();Wa();Sv();ci();$n();zn();li();ai();tu();wv();Mt=c,vu=Math.log10(1.1),st=()=>Mt.fromInt(0),Ev=()=>Mt.fromInt(1),kv="img/currencies/gold/gold.webp",Av="img/currencies/magic/magic.webp",Nv="img/currencies/dna/dna.webp",RE="img/misc/forge.webp",OE="img/misc/infuse.webp",PE="img/misc/surge.webp",BE="img/misc/experiment.webp",Su="img/currencies/wave/wave.webp",FE="sounds/forge_reset.ogg",UE="sounds/infuse_reset.ogg",DE="sounds/surge_reset.ogg",$E="sounds/experiment_reset.ogg",qE=[];wu=e=>`ccc:reset:forge:${e}`,Np=e=>`ccc:reset:forge:completed:${e}`,Sl=e=>`ccc:debug:forgeUnlocked:${e}`,Eu=e=>`ccc:reset:infuse:${e}`,Rp=e=>`ccc:reset:infuse:completed:${e}`,Il=e=>`ccc:debug:infuseUnlocked:${e}`,xu=e=>`ccc:reset:surge:${e}`,Rv=e=>`ccc:debug:surgeUnlocked:${e}`,Op=e=>`ccc:reset:surge:completed:${e}`,qs=e=>`ccc:reset:surge:barLevel:${e}`,Pp=qs,Bp=e=>`ccc:reset:experiment:completed:${e}`,YE=Mt.fromInt(31),WE=Mt.fromInt(7),xp=!1,Ov=!1;S={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:st(),pendingMagic:st(),pendingWaves:st(),pendingDna:st(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},Qn=[],xv=null,Lv=!1,bu=null,_p=null,_v=null,Cv=null;Iu=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Yo,performForgeReset:jp,performInfuseReset:Zp,performSurgeReset:Jp,performExperimentReset:Qv,computePendingForgeGold:jv,computeForgeGoldFromInputs:Pc,computeInfuseMagicFromInputs:Bc,computeSurgeWavesFromInputs:Uv,computePendingDnaFromInputs:Dv,getForgeDebugOverrideState:Gv,hasDoneForgeReset:Rr,isForgeUnlocked:Ns,setForgeDebugOverride:Hv,setForgeResetCompleted:Dp,updateResetPanel:qe,isInfuseUnlocked:ku,setInfuseDebugOverride:Yv,getInfuseDebugOverrideState:Xv,recomputePendingMagic:mn,setInfuseUnlockedForDebug:Vv,setInfuseResetCompleted:$p,hasDoneInfuseReset:qt,isSurgeUnlocked:Br,setSurgeUnlockedForDebug:zv,getSurgeDebugOverrideState:Wv,setSurgeResetCompleted:qp,hasDoneSurgeReset:ko,getCurrentSurgeLevel:jn,shouldBlockBigCoins:El,hasDoneExperimentReset:Kv,setExperimentResetCompleted:Gp,isExperimentUnlocked:Ll}))});var M0={};vt(M0,{AREA_KEYS:()=>Ie,HM_EVOLUTION_INTERVAL:()=>Gt,MAX_LEVEL_DELTA:()=>js,REGISTRY:()=>zu,UPGRADE_TIES:()=>xe,approxLog10BigNum:()=>ke,batchUpgradeOperations:()=>Ml,bigNumFromLog10:()=>ve,buyCheap:()=>pl,buyMax:()=>dl,buyOne:()=>Rs,buyTowards:()=>Os,clearPermanentUpgradeUnlock:()=>wm,computeDefaultUpgradeCost:()=>Em,computeHmMultipliers:()=>Wo,computeUpgradeEffects:()=>ds,costToBuyOne:()=>Ax,ensureLevelBigNum:()=>pt,estimateFlatBulk:()=>hm,estimateGeometricBulk:()=>Lx,evaluateBulkPurchase:()=>Si,evolveUpgrade:()=>lu,formatMultForUi:()=>Ae,getCurrentAreaKey:()=>Zn,getHmEvolutions:()=>vm,getHmNextMilestoneLevel:()=>Nx,getIconUrl:()=>cu,getLevel:()=>_n,getLevelNumber:()=>At,getMagnetLevel:()=>Mc,getMpValueMultiplierBn:()=>Cc,getUpgrade:()=>ea,getUpgradeLockState:()=>Ao,getUpgradeStorageKey:()=>Ci,getUpgradesForArea:()=>Ct,levelBigNumToNumber:()=>Ve,log10OnePlusPow10:()=>_f,markUpgradePermanentlyUnlocked:()=>_i,normalizeBigNum:()=>Rx,normalizedUpgradeLevel:()=>Du,onUpgradesChanged:()=>wd,peekNextPrice:()=>C0,performFreeAutobuy:()=>Td,safeMultiplyBigNum:()=>It,setLevel:()=>rr,syncBookCurrencyMultiplierFromUpgrade:()=>Va,upgradeUiModel:()=>Ps});function Nu(){Fr.size!==0&&(Fr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{lt(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Fr.clear())}function lx(){if(!(typeof window>"u")&&!i0){i0=setInterval(Nu,2e3);try{window.addEventListener("beforeunload",Nu)}catch{}try{window.addEventListener("pagehide",Nu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&Nu()})}catch{}}}function Ml(e){if(Xs)return e();Xs=!0;try{return e()}finally{Xs=!1,Cl.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{Ys(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),Cl.clear(),r0.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{Tx(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),r0.clear(),cm&&(cm=!1,no())}}function cx(e){try{let t=Qs(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function l0(e,t){if(!cx(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=ke(n);return Number.isFinite(o)&&o>=ux}catch{return!1}}function Vs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>rm)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>rm/2||i.length>rm/2)return"Infinity"}return n}function Ou(e){return gx[e]??0}function im(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Zs(e,t){let n=ar(e||t?.area);if(!n)return null;let o=lr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=to(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function Tl(e,t){let n=ar(e||t?.area);if(!n)return null;let o=to(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function Gs(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function dm(e=b()){let t=String(e??"default");if(Bu.has(t))return Bu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${f0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Bu.set(t,n),n}function pm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Bu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${f0}:${n}`,JSON.stringify(e))}catch{}}function Vu(e=b()){let t=String(e??"default");if(Fu.has(t))return Fu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${d0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Fu.set(t,n),n}function Yu(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Fu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${d0}:${n}`,JSON.stringify(e))}catch{}}function Sm(e=b()){let t=String(e??"default");if(Uu.has(t))return Uu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${p0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Uu.set(t,n),n}function Im(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Uu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${p0}:${n}`,JSON.stringify(e))}catch{}}function mm(e,t,n=b()){let o=Zs(e,t);if(!o)return;let r=Tl(e,t),i=Sm(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Im(i,n))}function m0(e,t,n=b()){let o=Zs(e,t);if(!o)return!1;let r=Tl(e,t),i=Sm(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Im(i,n),!0):!1}function _i(e,t,n=b()){let o=Zs(e,t);if(!o)return;let r=Tl(e,t),i=Vu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Yu(i,n))}function wm(e,t,n=b()){let o=Zs(e,t);if(!o)return;let r=Vu(n);r.upgrades[o]&&(delete r.upgrades[o],Yu(r,n));let i=dm(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},pm(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&cr(e,s,n),no()}function Gu(e,t,n=b()){let o=Zs(e,t);if(!o)return!1;let r=Tl(e,t),i=Vu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Yu(i,n),!0):!1}function gn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=lr(t?.tie??t?.tieKey),o=e?.areaKey||Ie.STARTER_COVE;if(!n||!dx.has(n))return{locked:!0,iconOverride:Rn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?At(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:h0()}catch{}function s(){if(g0())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:vn,titleOverride:sn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===xe.UNLOCK_XP)return s();if(n===xe.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Rn,useLockedBase:!0};let a=!1;try{let u=bn();a=Ve(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:vn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}return{locked:!1}}if(n===xe.UNLOCK_INFUSE){if(!Rr())return{locked:!0,iconOverride:Rn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:eo,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=bn();a=Ve(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:vn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}return{locked:!1}}if(n===xe.UNLOCK_SURGE){if(!qt())return{locked:!0,iconOverride:Rn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:eo,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=bn();a=Ve(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:vn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}return{locked:!1}}if(bm.has(n)){if(qt()||Gu(o,t)){try{_i(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=bn();a=Ve(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:Rn,useLockedBase:!0,titleOverride:eo,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{mm(o,t)}catch{}return{locked:!0,iconOverride:vn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}if(Rr()||Gu(o,t)){try{_i(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Rn,useLockedBase:!0};if(m0(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:vn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:a,reason:a}}let l=!1;try{let a=bn();l=Ve(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Rn,useLockedBase:!0,titleOverride:eo,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{mm(o,t)}catch{}return{locked:!0,iconOverride:vn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function ar(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function lr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function yx(e,t){let n=lr(t?.tie??t?.tieKey);if(n&&px.has(n))return!0;let o=to(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=ar(l);if(a&&mx.has(`${a}:${i}`))return!0}return!1}function h0(){try{return!!dn()}catch{return!1}}function g0(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${hx}:${t}`)==="1"}catch{return!1}}function bn(){try{let e=typeof rt=="function"?rt():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function Du(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function sm(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function to(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function pt(e){try{if(e=Vs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return ve(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=ke(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Ve(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=ke(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=ke(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function vx(e,t){let n=pt(e),o=pt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(ke(n))+1,i=Math.floor(ke(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function y0(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function Js(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Hu(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:Js(e.numUpgEvolutions)}function Em(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Ve(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/Gt));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=I0(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:ke(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:y0(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,yn(i,r)}function v0(e){let t=Js(e),n=Gt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Ur(o),capFmtText:zs(o)}}function b0(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(ke(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Gt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Gt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Gt)+1)}}function Sx(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function xm(e,t=qu){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=ar(t||e?.area||qu);return fx[n]||c0}function It(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function Wu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=v0(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Wo(e,t,n=qu){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=xm(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=b0(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=Sx(u.multiplier??u.mult??u.value??1,f),m=`${u.target??u.type??"self"}`.toLowerCase();m==="xp"?i=It(i,d):m==="coin"||m==="coins"?s=It(s,d):m==="mp"?l=It(l,d):r=It(r,d)}let a=Hu(e);if(a>0){let u=ax*a,f=ve(u);r=It(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function S0(e,t,n=qu){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=xm(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=b0(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt(Gt)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny(Gt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Gt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Gt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function I0(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=bx[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Qs(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=I0(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=y0(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=ke(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),m=c.fromAny(e.costAtLevel?.(1)??0),y=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(m)===0&&d.cmp(y)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function yn(e,t){let n=Qs(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=ve(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return ve(n.baseLog10+o*n.ratioLog10).floorToInteger()}function Ix(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function ir(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Qs(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Pu+t*o.ratioLn)/Pu;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Pu+t*o.ratioLn,i=o.ratioLn*n,s=Ix(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Pu}function $u(e,t,n){if(!(n>0))return c.fromInt(0);let o=Qs(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=ir(e,t,l);a=a.add(ve(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=ir(e,t,n);return ve(i)}function E0(e){if(!(e>0)||!Number.isFinite(e))return e;if(lm[0]=e,lm[0]<=0)return 0;wx[0]-=1n;let t=lm[0];return t>0?t:0}function Ex(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=E0(e);return n<e?n:e>1?e/2:0}function Hs(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function Ws(e,t,n,o=js,r={}){let i=Qs(e),s=c.fromInt(0),l=r||{},a=!!l.fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Ve(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:Ve(o),m=Number.isFinite(f)?Math.max(0,f-u):am,y=Number.isFinite(d)?Math.max(0,Math.floor(d)):am;if(y=Math.min(y,am,m),!(y>0)){let Y=m<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:Y,numericCount:0}}let p=100-u;if(Number.isFinite(u)&&p>0){let Y=Math.min(y,p);if(l.fastOnly&&i&&Number.isFinite(i.ratioLog10)&&Number.isFinite(i.baseLog10)){let me=ke(n),Pe=u+Y,ne=i.baseLog10+Pe*i.ratioLog10;if(me>ne+5){let ge=Hs(Y),Ue=u+Y,Me=Ws(e,Ue,n,y-Y,r),Be=Me?.count instanceof c?Me.count:Hs(Me?.numericCount??0);return{count:ge.add(Be),spent:s,nextPrice:Me?.nextPrice??s,numericCount:Y+(Me?.numericCount??0)}}}let $=c.fromAny(e.costAtLevel(u)),H=s,j=0;for(;j<Y;){$=c.fromAny(e.costAtLevel(u+j));let me=H.add($);if(me.cmp(n)>0)break;H=me,j+=1}let W=u+j,re=Number.isFinite(f)&&W>=f,x=Hs(j);if(j<Y||re||y<=j){let me=re?s:c.fromAny(e.costAtLevel(W));return{count:x,spent:H,nextPrice:me,numericCount:j}}let K=(()=>{try{return sr(t??u,u).add(x)}catch{return u+j}})(),ce=Ws(e,K,n.sub(H),y-j,r),pe=ce?.count instanceof c?ce.count:Hs(ce?.numericCount??0),Q=x.add(pe),ie=(ce?.spent??s).add(H);return{count:Q,spent:ie,nextPrice:ce?.nextPrice??s,numericCount:j+(ce?.numericCount??0)}}let h=ke(n),g=i.ratioLog10,v=i.ratioMinus1,E=c.fromAny(e.costAtLevel(u)),L=i.baseLog10+u*g;if(v>0&&(!Number.isFinite(h)||Math.abs(h)>1e6&&Math.abs(L)>1e6)){let Y=c.fromAny(e.costAtLevel(u));if(n.cmp(Y)<0)return{count:s,spent:s,nextPrice:Y,numericCount:0};let $=Number.isFinite(y)?Math.max(1,Math.floor(y)):Number.MAX_VALUE,H=1,j=1;for(;j<$;){let pe=ir(e,u,j);if(ve(pe).cmp(n)<=0){let ie=j*2;if(!Number.isFinite(ie)||ie<=j){j=$;break}H=j,j=Math.min(ie,$)}else break}let W=0;for(;H<j&&W<256;){let pe=Math.max(H+1,Math.floor((H+j+1)/2)),Q=ir(e,u,pe);ve(Q).cmp(n)<=0?H=pe:j=pe-1,W++}let re=Math.max(1,H),x=Hs(re),K=s,ce=s;if(!a)if(K=$u(e,u,re),Number.isFinite(f)){let pe=Math.max(0,Math.floor(f-Math.min(u,f)));re>=pe?ce=s:ce=ve(L+re*g)}else ce=ve(L+re*g);return{count:x,spent:K,nextPrice:ce,numericCount:re}}if(n.cmp(E)<0)return{count:s,spent:s,nextPrice:E,numericCount:0};let N=!1,q=null,P=null;try{q=c.fromAny(e.costAtLevel(u+1))}catch{}try{let Y=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);P=c.fromAny(e.costAtLevel(Y))}catch{}!N&&!(i.ratioMinus1>0)&&(N=!0),q&&P&&(N=q.cmp(E)===0&&P.cmp(E)===0),!N&&!(i.ratioMinus1>0)&&(N=!0);let G=Number.isFinite(y)?Math.max(0,Math.floor(y)):Number.MAX_VALUE;if(N){let Y=sr(e.lvlCapBn??"Infinity","Infinity"),$=sr(t??0,0),H=Y.isInfinite?.()?c.fromAny("Infinity"):Y.sub($).floorToInteger(),{count:j,countBn:W,spent:re,nextPrice:x}=hm(E,n,H);return{count:W,spent:re,nextPrice:x,numericCount:j}}if(!(g>0)||!(v>0)){let Y=sr(e.lvlCapBn??"Infinity","Infinity"),$=sr(t??0,0),H=Y.isInfinite?.()?c.fromAny("Infinity"):Y.sub($).floorToInteger(),{count:j,countBn:W,spent:re,nextPrice:x}=hm(E,n,H);return{count:W,spent:re,nextPrice:x,numericCount:j}}let C=Math.log10(v);if(!Number.isFinite(C))return{count:s,spent:s,nextPrice:E,numericCount:0};let T=_f(h+C-L)/g;(!Number.isFinite(T)||T<0)&&(T=0);let _=Math.floor(Math.min(G,T));Number.isFinite(_)||(_=G),_<=0&&(_=1);let V=1e-7,J=ir(e,u,_),se=0,de=2048;for(;_>0&&(!Number.isFinite(J)||J>h+V)&&se<de;){let Y=Number.isFinite(J)?Math.max(1,Math.ceil((J-h)/Math.max(g,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-Y));if($<_)_=$;else{let H=E0(_);if(!(H<_))break;_=H}J=_>0?ir(e,u,_):Number.NEGATIVE_INFINITY,se+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(E)>=0)_=1,J=ke(E);else return{count:s,spent:s,nextPrice:E,numericCount:0};if(_<G){let Y=x=>{let K=x*2;return Number.isFinite(K)?K:Number.MAX_VALUE},$=_,H=Math.min(G,Math.max(_+1,Y(_))),j=ir(e,u,H);for(;$<H&&Number.isFinite(j)&&j<=h+V&&H<G;)$=H,H=Math.min(G,Y(H)),j=ir(e,u,H);let W=$,re=H;for(let x=0;x<256&&W<re;x+=1){let K=Math.floor((W+re+1)/2),ce=ir(e,u,K);Number.isFinite(ce)&&ce<=h+V?(W=K,J=ce):re=K-1}_=W}let ye=null;if(!a){ye=$u(e,u,_);let Y=0;for(;ye.cmp(n)>0&&_>0&&Y<de;){let $=Ex(_);if(!($<_))break;_=$,ye=$u(e,u,_),Y+=1}if(_<=0)return{count:s,spent:s,nextPrice:E,numericCount:0};if(_<G&&Y<de)for(;_<G&&Y<de;){let $=u+_,H;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)H=c.fromAny(e.costAtLevel($));else{let W=L+_*g;H=ve(W).floorToInteger()}}catch{break}let j=ye.add(H);if(j.cmp(n)>0)break;ye=j,_+=1,Y+=1}}let Re=s,Ce=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let Y=Math.max(0,Math.floor(f-Math.min(u,f)));if(_>=Y)Re=s;else if(Ce){let $=Math.floor(u+_);Re=c.fromAny(e.costAtLevel($))}else{let $=L+_*g;Re=ve($)}}else if(Ce){let Y=Math.floor(u+_);Re=c.fromAny(e.costAtLevel(Y))}else{let Y=L+_*g;Re=ve(Y)}return{count:Hs(_),spent:ye,nextPrice:Re,numericCount:_}}function xx(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=ke(t),r=ke(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function hm(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let m=e.mulBigNumInteger(d);return{count:gm(d),countBn:d,spent:m,nextPrice:e}}let i=ke(t),s=ke(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=ve(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:gm(l),countBn:l,spent:a,nextPrice:u}}function Lx(e,t,n,o){if(!n||o<=0)return{count:0};let r=ke(t),i=ke(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let h=0;h<64&&a<u;h+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let m=i+f*n.ratioLog,y=ve(d),p=ve(m);return{count:f,spent:y,nextPrice:p,spentLog:d,nextPriceLog:m}}function sr(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function gm(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Ur(e){return te(e instanceof c?e:c.fromAny(e??0))}function zs(e){return Ur(e).replace(/<[^>]*>/g,"")}function Xu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Ks(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=Xu(n??t??0),s=Xu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Ve(i),newLevel:Number.isFinite(o)?o:Ve(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Ft(e,t){return yn(e,t)}function x0(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Ci(e,t,n=b()){if(n==null)return null;let o=ar(e),r=Lm(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function _x(){s0.forEach(e=>{try{e?.()}catch{}}),s0.clear()}function a0(e){_x()}function Cx(e,t){if(typeof localStorage>"u")return;let n=x0(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=Ci(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}})}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function Mx(e,t,n){Cx(e,n);let o=Ci(e,t,n);if(!o)return null;if(Xs&&Cl.has(o))try{let r=Cl.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Fr.has(o))try{let r=Fr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function Ys(e,t,n,o=b(),r={}){let i=Ci(e,t,o);if(i){if(Xs){Cl.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Fr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Fr.has(i)&&Fr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{lt(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function Tx(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&Ys(e,o.id,o,n)})}function Lm(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return to(t.id);let n=to(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=lr(n);if(o){let r=um.get(o);if(r){let i=ar(e);if(!i||ar(r.area)===i)return to(r.id)}}}return n}function L0(e,t,n=b()){let o=n==null?"null":String(n),r=Lm(e,t);return`${o}:${e}:${to(r)}`}function vo(e,t){let n=Lm(e,t),o=to(n),r=b(),i=L0(e,o,r),s=ym.get(i);if(s)return s;let l=ea(e,o),a=Mx(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,Ys(e,o,a,r)}let f=a.lvl,d=a.nextCost,m=a.nextCostLvl;a.lvl=Vs(a.lvl),a.nextCost=Vs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Vs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==m)&&(u=!0);let y=0;l?.upgType==="HM"&&(y=Js(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),Wu(l,y));let p=pt(a.lvl),h=Ve(p);try{let M=l?.lvlCapBn??c.fromAny("Infinity");if(!M.isInfinite?.()&&p.cmp(M)>0){let N=M.clone?.()??M;h=Ve(N);let q=N.toStorage();a.lvl=q,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=q,Ys(e,o,a,r)}}catch{}let g=null;try{g=p?.toStorage?.()??pt(h).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let v=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,E=!v||v!==g,L=null;if(!L||E){if(l)try{L=c.fromAny(l.costAtLevel(h))}catch{L=c.fromInt(0)}else L=c.fromInt(0);try{a.nextCost=L.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{Ys(e,o,a,r)}catch{}if(l?.upgType==="HM"&&p?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let M=c.fromAny("Infinity");l.lvlCapBn=M,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Ur(M),l.lvlCapFmtText=zs(M)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:h,lvlBn:p,nextCostBn:L,slot:r,hmEvolutions:y},ym.set(i,s),s}function Dr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=to(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??pt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Ve(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??pt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=pt(e.lvl??0).toStorage()}i.lvl=Vs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Vs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=Js(e.hmEvolutions)),Ys(n,r,i,o,t),e.slot=o}function cr(e,t,n=b()){ym.delete(L0(e,t,n))}function At(e,t){return vo(e,t).lvl}function vm(e,t){return vo(e,t).hmEvolutions??0}function _0(e,t){if(!t)return{locked:!1};let n=h0(),o=n?bn():c.fromInt(0),r=n?Ve(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=yx(e,t),d="Unlock the XP system to reveal this upgrade",m=g0();if(f)if(m)i={locked:!0,iconOverride:vn,titleOverride:sn,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let y='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Rn,titleOverride:eo,descOverride:y,reason:y,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Rn,titleOverride:eo,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=sm({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,surgeLevel:jn(),surgeUnlocked:Br(),baseLocked:s.locked,getUpgradeLevel(m){return At(e,m)}},d=t.computeLockState(f);s=sm(s,d)}catch{}let l=b(),a=Zs(e,t),u=a?Gu(e,t,l):!1;if(a){let f=dm(l),d=Vu(l),m=Sm(l),y=a.replace(/_/g,"-"),p=Tl(e,t),h=!1;Gs(f,y,a)&&(h=!0),p&&Gs(f,p,a)&&(h=!0),h&&pm(f,l);let g=!1;Gs(d,y,a)&&(g=!0),p&&Gs(d,p,a)&&(g=!0),g&&Yu(d,l);let v=!1;Gs(m,y,a)&&(v=!0),p&&Gs(m,p,a)&&(v=!0),v&&Im(m,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=Rn),f?s.titleOverride||(s.titleOverride=sn):(!s.titleOverride||s.titleOverride===sn)&&(s.titleOverride=eo),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Rn||s.iconOverride===vn)&&delete s.iconOverride,(s.titleOverride===sn||s.titleOverride===eo)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Rn),a){let f=dm(l),d=f.upgrades[a]||{},m=lr(t?.tie??t?.tieKey),y=m&&u0.has(m),p=m&&bm.has(m),h=d.status||"locked";if(Gu(e,t,l))h="unlocked";else if(m0(e,t,l)&&h==="locked"){let C=!1;try{C=Ve(bn())>=31}catch{}let U=!1;try{U=Ve(bn())>=101}catch{}y&&!C||p&&!U?h="locked":h="mysterious"}let g=Ou(h),v=im(s),E=Ou(v),L=()=>{s.locked=!0;let C=d.snapshot;C&&typeof C=="object"&&(s=sm(s,C)),s.iconOverride=vn,s.titleOverride=sn;let U=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=U,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>E&&(h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):h==="mysterious"&&L(),v=im(s),E=Ou(v));let M=!1,N=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",q=y,P=!1;try{P=Ve(bn())>=31}catch{}let G=!1;try{G=Ve(bn())>=101}catch{}if((q&&!P&&N==="mysterious"||p&&!G&&N==="mysterious")&&(N="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==N)&&(f.upgrades[a]={status:N},M=!0),E>g){if(d.status=v,f.upgrades[a]={status:d.status},M=!0,h=v,g=E,v==="unlocked")_i(e,t,l);else if(v==="mysterious"){let C=!1;try{C=Ve(bn())>=31}catch{}(!y||C)&&mm(e,t,l)}}h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Rn||s.iconOverride===vn)&&delete s.iconOverride,(s.titleOverride===sn||s.titleOverride===eo)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},M=!0),_i(e,t,l)):h==="mysterious"&&v!=="mysterious"&&(L(),v=im(s),E=Ou(v)),M&&pm(f,l)}return s}function kl(e,t){return!!_0(e,t).locked}function _m(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Hu(e),{capBn:r,cap:i}=v0(o);try{return t?.cmp?.(r)>=0}catch{}let s=Ve(t);return Number.isFinite(s)&&s>=i}function _n(e,t){let n=vo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():pt(n.lvl??0)}function C0(e,t){let n=vo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??pt(n.lvl??0),i=Ve(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function rr(e,t,n,o=!0,r={}){let i=vo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,Wu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=Xu(i.lvlBn??pt(i.lvl??0)),d=pt(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let m=d;try{s&&l0(s,m)&&(m=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let p=pt(a);m.cmp(p)>0&&(m=p)}if(o&&Number.isFinite(a)){let p=pt(a);m.cmp(p)>0&&(m=p)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(m)===0)return i.lvl;let y=Ve(m);if(!s)return i.lvl=y,i.lvlBn=m,i.nextCostBn=c.fromInt(0),Dr(i),cr(e,t),no(),i.lvl;i.lvl=y,i.lvlBn=m;try{i.nextCostBn=c.fromAny(s.costAtLevel(y))}catch{i.nextCostBn=c.fromInt(0)}return Dr(i,{deferSave:r?.deferSave}),cr(e,t),Ks(s,u,f,i.lvl,i.lvlBn),no(),i.lvl}function Ct(e){return zu.filter(t=>t.area===e)}function ea(e,t){let n=ar(e),o=to(t),r=lr(typeof o=="string"?o:t);return zu.find(i=>n&&ar(i.area)!==n?!1:!!(to(i.id)===o||r&&i.tieKey===r))||null}function Ao(e,t){let n=typeof t=="object"&&t?t:ea(e,t);return _0(e,n)}function kx(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function cu(e){return e?kx(e.icon):""}function Ax(e,t){let n=ea(e,t),o=_n(e,t),r=Ve(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Rs(e,t){let n=vo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(kl(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??pt(r),s=Xu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(l0(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Dr(n),cr(e,t),no(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?R[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let y=f.value;if((y instanceof c?y:c.fromAny(y??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let m=i.add(c.fromInt(1));return n.lvlBn=m,n.lvl=Ve(m),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),Dr(n),cr(e,t),Ks(o,r,s,n.lvl,n.lvlBn),no(),{bought:1,spent:d}}function lu(e,t){let n=vo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??pt(n.lvl);if(!_m(o,r,n.hmEvolutions))return{evolved:!1};let i=Js(n.hmEvolutions)+1;n.hmEvolutions=i,Wu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Dr(n),cr(e,t),Ks(o,n.lvl,r,n.lvl,r),no(),{evolved:!0}}function dl(e,t){let n=vo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(kl(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??pt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=R[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Rs(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let v=i.clone?.()??pt(i),E=Ve(v),L=v.toStorage?.(),M;if(o.upgType==="HM"){if(M=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let q=c.fromAny("Infinity");o.lvlCapBn=q,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Ur(q),o.lvlCapFmtText=zs(q)}}else{let q=o.lvlCapBn?.clone?.()??sr(o.lvlCap??1/0,1/0);M=q?.clone?.()??q}let N=M.sub(v);if(N.isZero?.()){let q=vx(M,v);q.isZero?.()||(N=q)}if(N.isZero?.()){let q=M.toStorage?.();if(L&&q&&L!==q)if(M.isInfinite?.())try{N=c.fromAny("Infinity")}catch{N=c.fromInt(1)}else N=c.fromInt(1)}return n.lvlBn=M.clone?.()??M,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),R[o.costType].set(u),Dr(n),cr(e,t),Ks(o,E,v,n.lvl,n.lvlBn),no(),{bought:N,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):js;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=Ws(o,i,u,d),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=m.spent??c.fromInt(0),h=u.sub(p);R[o.costType].set(h);let g=i.add(y);return n.lvlBn=g,n.lvl=Ve(g),m.nextPrice?n.nextCostBn=m.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Dr(n),cr(e,t),Ks(o,r,i,n.lvl,n.lvlBn),no(),{bought:y,spent:p}}function Os(e,t,n){let o=vo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(kl(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??pt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=R[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,m=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Ve(n):void 0,y=Number.isFinite(d)?Number.isFinite(m)?Math.min(d,m):d:m,p=Ws(r,s,f,y),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=p.spent??c.fromInt(0),v=f.sub(g);R[r.costType].set(v);let E=s.add(h);return o.lvlBn=E,o.lvl=Ve(E),p.nextPrice?o.nextCostBn=p.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Dr(o),cr(e,t),Ks(r,i,s,o.lvl,o.lvlBn),no(),{bought:h,spent:g}}function Si(e,t,n,o=js,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=Ws(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function no(){if(Xs){cm=!0,Id();return}Id(),_c()}function Zn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Ie.STARTER_COVE}function Ps(e,t){let n=ea(e,t);if(!n)return null;let o=_n(e,t),r=Ve(o),i=Ur(o),s=zs(o),l=n.lvlCapBn??sr(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Ur(l),u=n.lvlCapFmtText??zs(l),f=r<n.lvlCap?C0(e,t):c.fromInt(0),d=Ur(f),m=R[n.costType]?.value,y=m instanceof c?m:c.fromAny(m??0),p=Ao(e,t),h=!!p.locked,g=p.titleOverride??n.title,v=p.descOverride??n.desc;if(e===Ze&&to(t)===ni){let N=Ac();if(Math.abs(N-1)>1e-4&&v){let q=Ae(N);v=v.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+q+" Coins on an interval")}}let E=xm(n,e),L="";typeof n.effectSummary=="function"&&!(h&&p.hideEffect)&&(L=n.effectSummary(r),typeof L=="string"&&(L=L.trim()));let M=p.iconOverride??cu(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:y,haveFmt:R[n.costType]?.fmt(y)??String(y),effect:L,iconUrl:M,lockState:p,locked:h,areaKey:e,hmMilestones:E,displayTitle:g,displayDesc:v,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?vm(e,t):0,hmReadyToEvolve:n.upgType==="HM"?_m(n,o,vm(e,t)):!1,hmNextMilestone:n.upgType==="HM"?S0(n,o,e):null}}function Nx(e,t){let n=ea(e,t);if(!n||n.upgType!=="HM")return null;let o=_n(e,t);return S0(n,o,e)}function Rx(e){return ve(ke(e??0))}function Td(e,t){let n=vo(e,t),o=n.upg;if(!o)return{bought:0};let r=x0(e,n.slot);if(zt(r))return{bought:0};let i=Ci(e,t,n.slot);if(zt(i))return{bought:0};if(kl(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??pt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&_m(o,l,n.hmEvolutions))return{bought:0};let f=R[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let m=Ws(o,l,d,js),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:0};let p=l.add(y);return lx(),rr(e,t,p,!0,{deferSave:!0}),{bought:y}}function pl(e,t){let n=vo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(kl(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??pt(n.lvl),i=Ve(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=R[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=Si(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=y=>{if(y<=0)return!0;let p=$u(o,i,y-1),h=a.sub(p),g=i+y-1,v=c.fromAny(o.costAtLevel(g)),E=h.div(10);return v.cmp(E)<=0},m=0;if(f<2e3){let y=u.spent,p=f;for(;p>0;){let h=i+p-1,g=c.fromAny(o.costAtLevel(h)),v=y.sub(g),L=a.sub(v).div(10);if(g.cmp(L)<=0){m=p;break}y=v,p--}}else{let y=0,p=f;for(;y<p;){let h=Math.ceil((y+p)/2);d(h)?y=h:p=h-1}m=y}return m<=0?{bought:0,spent:c.fromInt(0)}:Os(e,t,m)}var js,Gt,OT,ax,qu,Ie,Xs,r0,Cl,cm,Fr,i0,ux,rm,xe,c0,fx,Rn,vn,sn,eo,u0,bm,dx,px,mx,hx,f0,d0,p0,gx,Bu,Fu,Uu,um,PT,fm,Ru,Zt,Pu,bx,am,w0,lm,wx,zu,ym,s0,co=$e(()=>{St();Et();Wt();Yn();To();Mo();zn();oi();ms();ip();Ed();js=c.fromAny("Infinity"),Gt=1e3,OT=c.fromInt(1e3),ax=3,qu="",Ie={STARTER_COVE:"starter_cove",AUTOMATION:Ze,DNA:jt},Xs=!1,r0=new Map,Cl=new Map,cm=!1,Fr=new Map,i0=null;ux=308;rm=1024;xe={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},c0=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],fx={[Ie.STARTER_COVE]:c0},Rn="img/misc/locked.webp",vn="img/misc/mysterious.webp",sn="Hidden Upgrade",eo="Locked Upgrade",u0=new Set([xe.COIN_VALUE_II,xe.XP_VALUE_II,xe.MP_VALUE_I,xe.MAGNET,xe.ENDLESS_XP]),bm=new Set([xe.COIN_VALUE_III,xe.XP_VALUE_III,xe.MP_VALUE_II,xe.FASTER_COINS_III,xe.ENDLESS_MP]),dx=new Set([xe.UNLOCK_XP,xe.UNLOCK_FORGE,xe.UNLOCK_INFUSE,xe.UNLOCK_SURGE,...u0,...bm]),px=new Set([xe.FASTER_COINS_II,xe.COIN_VALUE_I,xe.BOOK_VALUE_I,xe.XP_VALUE_I]),mx=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),hx="ccc:merchantMet",f0="ccc:shop:reveals",d0="ccc:shop:permaUnlocks",p0="ccc:shop:permaMyst",gx={locked:0,mysterious:1,unlocked:2},Bu=new Map,Fu=new Map,Uu=new Map,um=new Map,PT=lr(xe.BOOK_VALUE_I),fm=c,Ru=e=>fm.fromAny(e??0),Zt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Ru(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return fm.fromInt(1).add(r.mulDecimal(n))}catch{let i=ke(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return ve(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Ru(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return fm.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Ru(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Ru(i);if(o>0){let l=ke(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return ve(u)}}catch{}try{let l=Ve(s),a=o*l;return ve(a)}catch{return c.fromInt(1)}}}};Pu=Math.log(10);bx={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Hu(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Hu(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};am=(()=>{try{let e=Ve(js);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),w0=new ArrayBuffer(8),lm=new Float64Array(w0),wx=new BigInt64Array(w0);zu=[{area:Ie.STARTER_COVE,id:1,tie:xe.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(.1)},{area:Ie.STARTER_COVE,id:2,tie:xe.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:gn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Zr()}catch{}}},{area:Ie.STARTER_COVE,id:3,tie:xe.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(.1)},{area:Ie.STARTER_COVE,id:4,tie:xe.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(.5),onLevelChange(){try{nn()}catch{}}},{area:Ie.STARTER_COVE,id:5,tie:xe.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>Du(e)>0?2:1,onLevelChange({newLevel:e}){Va(e)}},{area:Ie.STARTER_COVE,id:6,tie:xe.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addFlatPerLevel(2)},{area:Ie.STARTER_COVE,id:7,tie:xe.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:gn,onLevelChange({newLevel:e}){if((e??0)>=1)try{em()}catch{}}},{area:Ie.STARTER_COVE,id:8,tie:xe.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${te(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(10),onLevelChange(){try{nn()}catch{}}},{area:Ie.STARTER_COVE,id:9,tie:xe.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:10,tie:xe.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:11,tie:xe.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=Du(e),n=Ae(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>Du(e)},{area:Ie.STARTER_COVE,id:12,tie:xe.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Gt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return yn(this,e)},nextCostAfter(e,t){return yn(this,t)},computeLockState:gn,effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=It(n,o);return`XP value bonus: ${Ae(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:13,tie:xe.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:gn,onLevelChange({newLevel:e}){if((e??0)>=1)try{tm()}catch{}}},{area:Ie.STARTER_COVE,id:14,tie:xe.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${te(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(1e3)},{area:Ie.STARTER_COVE,id:15,tie:xe.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:16,tie:xe.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:17,tie:xe.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:gn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Ae(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:18,tie:xe.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Gt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return yn(this,e)},nextCostAfter(e,t){return yn(this,t)},computeLockState:gn,effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=It(n,o);return`MP value bonus: ${Ae(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:19,tie:xe.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:gn,onLevelChange({newLevel:e}){if((e??0)>=1)try{nm()}catch{}}},{area:Ie.STARTER_COVE,id:20,tie:xe.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Gt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return yn(this,e)},nextCostAfter(e,t){return yn(this,t)},computeLockState(e){let t=jn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=bn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:vn,titleOverride:sn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:eo,descOverride:"Locked"}},onLevelChange(){try{nn()}catch{}},effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Ae(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:21,tie:xe.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Gt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return yn(this,e)},nextCostAfter(e,t){return yn(this,t)},computeLockState(e){let t=jn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=bn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:vn,titleOverride:sn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:eo,descOverride:"Locked"}},onLevelChange(){try{nn()}catch{}},effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Ae(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:22,tie:xe.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Gt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return yn(this,e)},nextCostAfter(e,t){return yn(this,t)},computeLockState(e){let t=jn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=bn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:vn,titleOverride:sn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:eo,descOverride:"Locked"}},onLevelChange(){try{nn()}catch{}},effectSummary(e){let t=pt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=It(n,o);return`Coin value bonus: ${Ae(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},...Sg,...Dy];for(let e of zu){let t=lr(e.tie??e.tieKey);t&&!um.has(t)&&um.set(t,e),e.baseCost=sr(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return yn(this,n)},e.nextCostAfter=function(n,o){return yn(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=Zt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=pt(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Wo(this,o,this.area),s=It(r,i);if(typeof this.bonusLine=="function")return this.bonusLine(n,s);let l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Ae(s)}x`})),e.numUpgEvolutions=Js(e.numUpgEvolutions),e.upgType==="HM"?Wu(e,e.numUpgEvolutions):(e.lvlCapBn=sr(e.lvlCap??1/0,1/0),e.lvlCap=gm(e.lvlCapBn),e.lvlCapFmtHtml=Ur(e.lvlCapBn),e.lvlCapFmtText=zs(e.lvlCapBn)),e.bulkMeta=xx(e),Qs(e)}ym=new Map;s0=new Map;typeof window<"u"&&(a0(b()),window.addEventListener("saveSlot:change",()=>{a0(b()),no()}),window.addEventListener("surge:level:change",()=>{no()}));Ag()});var tb={};vt(tb,{applyAllCurrencyOverridesForActiveSlot:()=>Dl,applyStatMultiplierOverride:()=>Wn,getDebugCurrencyMultiplierOverride:()=>Rl,getDebugStatMultiplierOverride:()=>Kx,setDebugCurrencyMultiplierOverride:()=>V0,setDebugPanelAccess:()=>k1,setDebugStatMultiplierOverride:()=>Pn});function Ul(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function Ux(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function Sn(e){typeof e=="function"&&km.push(e)}function nf(){return{sections:new Set,subsections:new Set}}function Dx(){let e=document.getElementById(Pl);if(!e)return nf();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function $x(e){let{sections:t,subsections:n}=B0??nf();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function D0(){km.forEach(e=>{try{e?.()}catch{}}),km=[],Pm.length=0}function $t(e){!e||typeof e.refresh!="function"||Pm.push(e)}function ft(e){Pm.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function qx(){if(typeof window>"u")return;let e=y=>{let{key:p,slot:h}=y?.detail??{},g=h??b();ft(v=>v.type==="currency"&&v.key===p&&v.slot===g)};window.addEventListener("currency:change",e,{passive:!0}),Sn(()=>window.removeEventListener("currency:change",e));let t=y=>{let{key:p,slot:h}=y?.detail??{},g=h??b();ft(v=>v.type==="currency-mult"&&v.key===p&&v.slot===g)};window.addEventListener("currency:multiplier",t,{passive:!0}),Sn(()=>window.removeEventListener("currency:multiplier",t));let n=y=>{let{slot:p,changeType:h,unlocked:g}=y?.detail??{},v=p??b();ft(E=>E.type==="xp"&&E.slot===v),ft(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===v),(h==="unlock"||typeof g=="boolean")&&ft(E=>E.type==="unlock"&&(E.slot==null||E.slot===v))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),Sn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=y=>{let{changeType:p,slot:h}=y?.detail??{},g=h??b();ft(v=>v.type==="mutation"&&v.slot===g),ft(v=>v.type==="stat-mult"&&v.key==="mutation"&&v.slot===g),p==="unlock"&&ft(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("mutation:change",o,{passive:!0}),Sn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let y=b();ft(p=>p.type==="upgrade"&&p.slot===y),ft(p=>p.type==="currency-mult"&&p.slot===y),ft(p=>p.type==="stat-mult"&&p.slot===y)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),Sn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let y=b();ft(p=>p.slot===y)};window.addEventListener("saveSlot:change",i,{passive:!0}),Sn(()=>window.removeEventListener("saveSlot:change",i));let s=y=>{let{slot:p,key:h}=y?.detail??{},g=p??b();ft(v=>v.type==="unlock"&&(v.slot==null||v.slot===g)&&(v.key==null||v.key===h))};window.addEventListener("unlock:change",s,{passive:!0}),Sn(()=>window.removeEventListener("unlock:change",s));let l=y=>{let{slot:p}=y?.detail??{},h=p??b();ft(g=>g.type==="workshop-level"&&g.slot===h)};window.addEventListener("workshop:change",l,{passive:!0}),Sn(()=>window.removeEventListener("workshop:change",l));let a=y=>{let{slot:p}=y?.detail??{},h=p??b();ft(g=>g.type==="surge-level"&&g.slot===h)};window.addEventListener("surge:level:change",a,{passive:!0}),Sn(()=>window.removeEventListener("surge:level:change",a));let u=y=>{let{slot:p}=y?.detail??{},h=p??b();ft(g=>g.type==="tsunami-nerf"&&(g.slot==null||g.slot===h))};window.addEventListener("surge:nerf:change",u,{passive:!0}),Sn(()=>window.removeEventListener("surge:nerf:change",u));let f=y=>{let{slot:p}=y?.detail??{},h=p??b();ft(g=>g.type==="lab-level"&&(g.slot==null||g.slot===h)),ft(g=>g.type==="stat-mult"&&g.key==="rp"&&(g.slot==null||g.slot===h))};window.addEventListener("lab:level:change",f,{passive:!0}),Sn(()=>window.removeEventListener("lab:level:change",f));let d=y=>{let{id:p,level:h}=y?.detail??{},g=b();ft(v=>v.type==="lab-node-level"&&v.slot===g&&v.id===p),p===1&&ft(v=>v.type==="tsunami-nerf"&&(v.slot==null||v.slot===g)),p===4&&ft(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("lab:node:change",d,{passive:!0}),Sn(()=>window.removeEventListener("lab:node:change",d));let m=y=>{let{id:p,rp:h}=y?.detail??{},g=b();ft(v=>v.type==="lab-node-rp"&&v.slot===g&&v.id===p)};window.addEventListener("lab:node:rp",m,{passive:!0}),Sn(()=>window.removeEventListener("lab:node:rp",m))}function of(){return[{key:Ie.STARTER_COVE,title:"The Cove",currencies:[{key:Ne.COINS,label:"Coins"},{key:Ne.BOOKS,label:"Books"},{key:Ne.GOLD,label:"Gold"},{key:Ne.MAGIC,label:"Magic"},{key:Ne.GEARS,label:"Gears"},{key:Ne.WAVES,label:"Waves"},{key:Ne.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function $0(){if(document.getElementById(Ku))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Ku;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Ku,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Ku,document.head.appendChild(n)}function Nm(){let e=document.getElementById(P0);e&&e.remove()}function Gx(){return Ni&&Je&&b()!=null&&!Ul()&&Ux()}function Hx(e){e?.detail?.visible&&Bo(),af()}function Zu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${F0++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function On(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${U0++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Nt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Bm(e,t=b()){let n=t??b();return n==null?null:`${bt.CURRENCY[e]}:${n}`}function Nl(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=R?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return La(n,e)}catch{return c.fromInt(0)}}function Xx(e,t,n=b()){let o=n??b(),r=Nl(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=Bm(e,o),s=i&&bo(i);s&&ia(i);let l=r;try{wn(o),l=Xi(e,t,{previous:r})??r,i&&lt(i)}catch{}finally{s&&Pi(i)}return ft(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function oo(e,t){return`${e??"null"}::${t}`}function Fm(e,t){return Bl.get(oo(e,t))??null}function Vx(e,t=b()){let n=t??b();return!e||n==null?null:`${bt.MULTIPLIER[e]}:${n}`}function Yx(e,t=b()){let n=oo(t,e);Bl.delete(n),oa.delete(n),ft(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function Um(e,t){let n=!rf(t,e),o=oo(e,t),r=Ol.get(o);if(!n&&r)return r;let i=Wx(t,e);return i?(Ol.set(o,i),i):(n&&Ol.delete(o),null)}function q0(e,t){ft(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function G0(e,t=b()){let n=Oi(e,t);if(Ol.delete(oo(t,e)),Mi.delete(oo(t,e)),!(!n||typeof localStorage>"u")&&!bo(n)){try{localStorage.removeItem(n)}catch{}q0(e,t)}}function rf(e,t=b()){return bo(Oi(e,t))}function H0(e,t){return rf(t,e)?Um(e,t):null}function Bn(e,t=b()){let n=Ri(e);return sf(e,t,n)??n}function Oi(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${Ox}:${e}:${n}`}function Ri(e){try{if(e==="xp"){let t=gc();if(t)return t}else if(e==="mutation"){let t=cf?.();if(t)return t;let n=lf();if(n)return n}else if(e==="spawnRate"){let t=ds(Ie.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return xc()}catch{}return c.fromInt(1)}function Wx(e,t=b()){let n=Oi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function zx(e,t,n){let o=Oi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=bo(o),s=i&&na?na:localStorage.setItem.bind(localStorage);i&&!na&&ia(o),s(o,r.toStorage?.()??String(r)),i&&!na&&Pi(o)}catch{}}function Dm(e,t=b()){if(t==null)return;let n=Fm(t,e);if(!n||t!==b())return;let o=oo(t,e);if(!Qu.has(o)){Qu.add(o);try{let r=R?.[e]?.mult?.get?.();Nt(r,n)||R?.[e]?.mult?.set?.(n)}catch{}finally{Qu.delete(o)}}}function X0(){if(!(A0||typeof window>"u")){A0=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=oo(r,t);if(!r||!Bl.has(i)||Qu.has(i))return;let s=oa.get(i),l=Fm(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,m=l.mulBigNumInteger(f);Bl.set(i,m)}}catch{}oa.set(i,o)}else o&&oa.set(i,o);Dm(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Dl()},{passive:!0})}catch{}}}function Dl(){let e=b();e!=null&&Object.values(Ne).forEach(t=>{Dm(t,e)})}function V0(e,t,n=b()){if(!e||n==null)return null;X0();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=oo(n,e);if(Bl.set(r,o),!oa.has(r)){let i=R?.[e]?.mult?.get?.();oa.set(r,i)}return Dm(e,n),o}function Rl(e,t=b()){return!e||t==null?null:Fm(t,e)}function Pn(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Ol.set(oo(n,e),o),Mi.set(oo(n,e),Ri(e)),zx(e,n,o),q0(e,n),o}function Kx(e,t=b()){return!e||t==null?null:Um(t,e)}function Wn(e,t,n=b()){let o=Ri(e),r=sf(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Nt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=oo(n,e),l=Mi.get(s),a=rf(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function sf(e,t,n){let o=Um(t,e),r=oo(t,e);if(!o)return Mi.delete(r),null;let i=Mi.get(r),s=rf(e,t);if(!i)Mi.set(r,n);else if(!Nt(i,n))return s?(Mi.set(r,n),o):(G0(e,t),null);return o}function jx(){if(!(T0||typeof localStorage>"u")){T0=!0;try{na=localStorage.setItem.bind(localStorage),k0=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ra.has(e))return na(e,t)},localStorage.removeItem=e=>{if(!ra.has(e))return k0(e)}}catch{}}}function bo(e){return e!=null&&ra.has(e)}function Pi(e){e&&(jx(),ra.add(e))}function ia(e){e&&ra.delete(e)}function Zx(e){return e?bo(e)?(ia(e),!1):(Pi(e),!0):!1}function Jx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=bo(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(Zx(e),typeof t=="function")try{t(bo(e))}catch{}o()}),o(),{button:n,refresh:o}}function Qx(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>bo(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>bo(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?ia(u):Pi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function e1(){let e=document.getElementById(Pl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function t1(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{bo(r)&&(o.push(r),ia(r))});try{return t?.()}finally{o.forEach(r=>Pi(r))}}function n1(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function $m(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Rm(e,t){e.classList.toggle("debug-invalid",!t)}function et(){let e=b();try{wn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function Y0(e=b()){return e==null?null:`${Px}:${e}`}function W0(e=b()){let t=Y0(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function z0(e,t=b()){let n=Y0(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,Am);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function o1(e,t=b()){let n=W0(t);return n.unshift(e),n.length>Am&&(n.length=Am),z0(n,t),n}function tt(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};o1(o,t),qm()}function qm(){if(!ta)return;let e=W0();if(e.length===0){ta.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",ta.appendChild(t);return}ta.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function K0(e=b()){return e==null?null:`${al}:${e}`}function j0(e,t=b()){let n=K0(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function Z0(e=b()){let t=K0(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function r1(e){if(e){if(Object.values(Ne).includes(e.type)){try{e.type===Ne.BOOKS?R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount):R[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function i1(){let e=b();if(e==null)return{completed:0};let t=Z0(e),n=0;return Object.entries(Jc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,r1(r.reward))}),j0(t,e),{completed:n}}function s1(){let e=b();if(e==null)return{restored:0};let t=Z0(e),n=0;return Object.entries(Jc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),j0(t,e),{restored:n}}function an(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,m=!1,y=r?Jx(r,{onToggle:i}):null,p=g=>{if(f){d=g;return}d=null,u.value=typeof s=="function"?s(g):n1(g)};l.appendChild(u),y&&l.appendChild(y.button);let h=()=>{let g=$m(u.value);if(!g){Rm(u,!1);return}Rm(u,!0);let v=r&&bo(r);v&&ia(r);try{n(g,{input:u,setValue:p})}finally{v&&Pi(r),y&&y.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",h),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),m=!0,h(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,m||h(),m=!1,d!=null){let g=d;d=null,p(g)}}),p(t),y&&y.refresh(),{row:l,input:u,setValue:p,isEditing:()=>f}}function a1({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let h=document.createElement("span");h.className="debug-unlock-desc",h.textContent=`- ${t}`,f.appendChild(h)}s.appendChild(l),s.appendChild(f);let m=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",h=>{l.contains(h.target)||m()});let y=!1,p=()=>{let h=!1;try{h=typeof n=="function"?!!n():!1}catch{}return a.checked=h,y=h,h};return a.addEventListener("change",()=>{let h=y,g=a.checked;try{g?o?.():r?.()}catch{}et();let v=p();h!==v&&tt(`Toggled ${e} [GOLD]${h?"True":"False"}[/GOLD] \u2192 [GOLD]${v?"True":"False"}[/GOLD]`)}),p(),$t({type:"unlock",slot:i,refresh:p}),s}function l1(e){try{if(e instanceof c||typeof e?.toScientific=="function")return te(e);let t=Number(e);return Number.isFinite(t)?te(t):String(e??"\u2014")}catch{return"\u2014"}}function c1({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:m})=>{if(d.type==="select"){u[d.key]=m.value;return}let y=$m(m.value),p=y instanceof c;if(Rm(m,p),!p){f=!0;return}u[d.key]=y}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=l1(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:m,label:y})=>{let p=document.createElement("option");p.value=m,p.textContent=y??m,f.defaultValue!=null&&f.defaultValue===m&&(p.selected=!0),d.appendChild(p)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function $r({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return rt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Zr()}catch{}let f=Ti.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(lt(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),m=Ti.level(n);localStorage.setItem(m,d),lt(m,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),m=Ti.progress(n);localStorage.setItem(m,d),lt(m,d)}catch{}try{Ji({forceReload:!0})}catch{}try{mc({changeType:"debug-panel",slot:n})}catch{}try{ft()}catch{}}function qr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return mt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,m=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&m!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Fl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Qt()}catch{}try{Pr()}catch{}let f=ki.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(lt(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),m=ki.level(n);localStorage.setItem(m,d),lt(m,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),m=ki.progress(n);localStorage.setItem(m,d),lt(m,d)}catch{}try{Qt({forceReload:!0})}catch{}try{Gm({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ft()}catch{}}function u1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=Bm(r.key,n),s=Nl(r.key,n),l=an(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=Nl(r.key,f),{next:m}=Xx(r.key,a,f);u(m),Nt(d,m)||(et(),tt(`Modified ${r.label} (${o}) ${te(d)} \u2192 ${te(m)}`))},{storageKey:i,onLockChange:()=>l.setValue(Nl(r.key,b()))});$t({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=Nl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function f1(e,t){let n=b();if(n==null){let P=document.createElement("div");P.className="debug-panel-empty",P.textContent="Select a save slot to edit stats.",e.appendChild(P);return}let o="spawnRate",r=Oi(o,n),i=an("Coin Spawn Rate",Bn(o,n),(P,{setValue:G})=>{let C=b();if(C==null)return;let U=Bn(o,C);try{Pn(o,P,C)}catch{}let T=Bn(o,C);G(T),Nt(U,T)||(et(),tt(`Modified Spawn Rate (${a}) ${te(U)} \u2192 ${te(T)}`))},{storageKey:r,onLockChange:P=>{let G=b();if(G!=null){if(P){if(H0(G,o))return;try{Pn(o,Ri(o),G)}catch{}}else sf(o,G,Ri(o));i.setValue(Bn(o,G))}}});$t({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Bn(o,n);i.setValue(P)}}),$t({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Bn(o,n);i.setValue(P)}}),e.appendChild(i.row);let s=rt(),l=mt(),a=t?.title??t?.key??"Unknown Area",u=Ti.level(n),f=an("XP Level",s.xpLevel,(P,{setValue:G})=>{let C=rt().xpLevel;$r({level:P});let U=rt();G(U.xpLevel),Nt(C,U.xpLevel)||(et(),tt(`Modified XP Level (${a}) ${te(C)} \u2192 ${te(U.xpLevel)}`))},{storageKey:u});$t({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(rt().xpLevel)}}),e.appendChild(f.row);let d=Ti.progress(n),m=an("XP Progress",s.progress,(P,{setValue:G})=>{let C=rt(),U=C?.xpLevel?.clone?.()??C?.xpLevel,T=C?.progress?.clone?.()??C?.progress;$r({progress:P});let _=rt();G(_.progress),f.setValue(_.xpLevel),(!Nt(T,_.progress)||!Nt(U,_.xpLevel))&&(et(),tt(`Modified XP Progress (${a}) ${te(T)} \u2192 ${te(_.progress)}`))},{storageKey:d});$t({type:"xp",slot:n,refresh:()=>{n===b()&&m.setValue(rt().progress)}}),e.appendChild(m.row);let y=ki.level(n),p=an("MP Level",l.level,(P,{setValue:G})=>{let C=mt().level;qr({level:P});let U=mt();G(U.level),Nt(C,U.level)||(et(),tt(`Modified MP Level (${a}) ${te(C)} \u2192 ${te(U.level)}`))},{storageKey:y});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&p.setValue(mt().level)}}),e.appendChild(p.row);let h=ki.progress(n),g=an("MP Progress",l.progress,(P,{setValue:G})=>{let C=mt(),U=C?.level?.clone?.()??C?.level,T=C?.progress?.clone?.()??C?.progress;qr({progress:P});let _=mt();G(_.progress),p.setValue(_.level),(!Nt(T,_.progress)||!Nt(U,_.level))&&(et(),tt(`Modified MP Progress (${a}) ${te(T)} \u2192 ${te(_.progress)}`))},{storageKey:h});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&g.setValue(mt().progress)}}),e.appendChild(g.row);let v=yi(n);if(v){let P=0;try{let C=localStorage.getItem(v),U=c.fromAny(C||"0");if(U.isInfinite())P=1/0;else try{P=Number(U.toScientific(20))}catch{P=0}}catch{}let G=an("Workshop Level",P,(C,{setValue:U})=>{let T=Number(C);if(C instanceof c)if(C.isInfinite())T=1/0;else try{T=Number(C.toScientific(20))}catch{T=NaN}if(Number.isNaN(T)||T<0)return;let _=T===1/0?"Infinity":String(Math.floor(T));try{localStorage.setItem(v,_),et(),tt(`Modified Workshop Level (The Cove) ${te(P)} \u2192 ${_}`),P=T}catch{}U(T)},{storageKey:v,onLockChange:()=>{let C=0;try{let U=localStorage.getItem(v),T=c.fromAny(U||"0");T.isInfinite()?C=1/0:C=Number(T.toScientific(20))}catch{}G.setValue(C)}});e.appendChild(G.row),$t({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let C=0;try{let U=localStorage.getItem(v),T=c.fromAny(U||"0");T.isInfinite()?C=1/0:C=Number(T.toScientific(20))}catch{}G.setValue(C)}})}let E=qs(n);if(E){let P=0;try{let C=localStorage.getItem(E);C==="Infinity"?P=1/0:P=c.fromAny(C||"0")}catch{P=c.fromInt(0)}let G=an("Surge Level",P,(C,{setValue:U})=>{let T="0",_=0;C instanceof c?C.isInfinite()?(T="Infinity",_=1/0):(T=C.toPlainIntegerString(),_=C):C===1/0||typeof C=="string"&&/infinity/i.test(C)?(T="Infinity",_=1/0):(T=String(C),_=C);try{localStorage.setItem(E,T),et();let V=_===1/0?"Infinity":te(_),J=P===1/0||P instanceof c&&P.isInfinite()?"Infinity":te(P);tt(`Modified Surge Level (The Cove) ${J} \u2192 ${V}`),_===1/0?P=1/0:_ instanceof c?P=_:P=c.fromAny(_);let se=!1;P===1/0?se=!0:P instanceof c?typeof P.cmp=="function"&&P.cmp(8)>=0&&(se=!0):typeof P=="number"&&P>=8&&(se=!0),se&&(pi(0),pn()||jo(!0))}catch{}U(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let V=P;if(V!==1/0&&V instanceof c)try{V=BigInt(V.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:V}}))}catch{}},{storageKey:E,onLockChange:C=>{let U=c.fromInt(0);try{let T=localStorage.getItem(E);T==="Infinity"?U=1/0:U=c.fromAny(T||"0")}catch{}G.setValue(U)}});$t({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let C=c.fromInt(0);try{let U=localStorage.getItem(E);U==="Infinity"?C=1/0:C=c.fromAny(U||"0")}catch{}G.setValue(C)}}),e.appendChild(G.row)}let L=Kt(),M=an("Lab Level",L,(P,{setValue:G})=>{let C;try{C=P instanceof c?P:c.fromAny(P),C.isNegative&&C.isNegative()&&(C=c.fromInt(0))}catch{G(Kt());return}let U=Kt();si(C),et(),Nt(U,C)||tt(`Modified Lab Level (The Cove) ${te(U)} \u2192 ${te(C)}`),G(C)},{storageKey:md(n)});$t({type:"lab-level",slot:n,refresh:()=>{n===b()&&M.setValue(Kt())}}),e.appendChild(M.row);let N=()=>{let P=Ln(),G=Co(),C=P+G;return C>1&&(C=1),C},q=an("Tsunami Exponent",N().toFixed(2),(P,{setValue:G})=>{let C=Number(P);if(P instanceof c?P.isInfinite()?C=1/0:C=Number(P.toScientific(10)):typeof P=="string"&&/infinity/i.test(P)&&(C=1/0),Number.isNaN(C)){G(N().toFixed(2));return}let U=Co(),T=C-U;T>1&&(T=1),T<0&&(T=0),T=Math.round(T*100)/100;let _=Ln();pi(T),et(),Math.abs(_-T)>1e-4&&tt(`Modified Tsunami Exponent (The Cove) Base:${_.toFixed(2)} \u2192 ${T.toFixed(2)} (Effective: ${C.toFixed(2)})`),G(N().toFixed(2))},{storageKey:Rd(n),format:P=>{let G=Number(P);return Number.isFinite(G)?G.toFixed(2):String(P)}});$t({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let P=N();q.setValue(P.toFixed(2))}}),e.appendChild(q.row)}function Tm(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Ct(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=_n(t.key,i.id??i.tie),u=Ci(t.key,i.id??i.tie,n),f=an(l,a,(d,{setValue:m})=>{if(b()==null)return;let p=_n(t.key,i.id??i.tie);try{rr(t.key,i.id??i.tie,d,!1)}catch{}let h=_n(t.key,i.id??i.tie);m(h),Nt(p,h)||(et(),tt(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${te(p)} \u2192 Lv${te(h)}`))},{idLabel:s,storageKey:u});$t({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=_n(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function d1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=R?.[r.key]?.mult,l=Rl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${bt.MULTIPLIER[r.key]}:${n}`,u=an(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let m=b();if(m==null)return;let y=Rl(r.key,m)??i?.get?.()??c.fromInt(1);try{V0(r.key,f,m)}catch{}Dl();let h=Rl(r.key,m)??i?.get?.()??c.fromInt(1);d(h),Nt(y,h)||(et(),tt(`Modified ${r.label} Multiplier (${o}) ${te(y)} \u2192 ${te(h)}`))},{storageKey:a});$t({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=Rl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function p1(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Ne).forEach(o=>{let r=R?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Nt(i,t))return;r.set(t),n+=1}catch{}}),n}function m1(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Ne).forEach(o=>{let r=R?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function h1(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=rt()}catch{}try{r=mt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Nt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Nt(o?.progress,t);(!i||!s)&&($r({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Nt(r?.level,t),s=r?.progress?.isInfinite?.()||Nt(r?.progress,t);(!i||!s)&&(qr({level:t,progress:t}),n+=1)}}catch{}try{let i=yi(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=qs(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ft()}catch{}return n}function g1(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=rt()}catch{}try{r=mt()}catch{}try{o?.unlocked&&($r({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(qr({level:t,progress:t}),n+=1)}catch{}try{let i=yi(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=qs(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ft()}catch{}return n}function J0(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!rt()?.unlocked}catch{return!1}},onEnable:()=>{try{Zr()}catch{}try{Ji({forceReload:!0})}catch{}},onDisable:()=>{try{Qi({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Fl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{Fl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return up()}catch{return!1}},onEnable:()=>{try{Ii()}catch{}},onDisable:()=>{try{du()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return fp()}catch{return!1}},onEnable:()=>{try{fu()}catch{}},onDisable:()=>{try{pu()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return tp()}catch{return!1}},onEnable:()=>{try{jc(!0)}catch{}},onDisable:()=>{try{jc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!pn()}catch{return!1}},onEnable:()=>{try{jo(!0)}catch{}},onDisable:()=>{try{jo(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return ct(4)>=1}catch{return!1}},onEnable:()=>{try{xr(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{xr(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function Q0(e){let t=b();if(t==null)return 0;let n=0;J0(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{ft()}catch{}return n}function y1(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;of().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{_i(o.key,r,e),t+=1}catch{}})});try{Ii()}catch{}try{fu()}catch{}let n=Q0(!0);return{unlocks:t,toggles:n}}function v1(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;of().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{wm(o.key,r,e),t+=1}catch{}})});try{du()}catch{}try{pu()}catch{}let n=Q0(!1);return{locks:t,toggles:n}}function b1(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(Bm(a,n)),r(Vx(a,n))},s=a=>r(Oi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(Ti.level(n)),r(Ti.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(ki.level(n)),r(ki.progress(n)))};return e==="all"?(Object.values(Ne).forEach(i),l("xp"),l("mutation"),tf.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Ne).forEach(i),Array.from(o)):e==="allUnlockedStats"?(rt()?.unlocked&&l("xp"),mt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Ne).forEach(i),rt()?.unlocked&&l("xp"),mt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function Ju(e){try{R?.[e]?.set?.(c.fromInt(0))}catch{}try{Yx(e)}catch{}try{ic(e,c.fromInt(1))}catch{}}function S1(e){if(e==="all"){Object.values(Ne).forEach(i=>Ju(i));let o=c.fromInt(0);return $r({level:o,progress:o}),qr({level:o,progress:o}),tf.forEach(({key:i})=>{try{Pn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Ne).length+tf.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Ne).forEach(i=>{Ju(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(rt()?.unlocked){$r({level:o,progress:o});try{Pn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(mt()?.unlocked){qr({level:o,progress:o});try{Pn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Ne).forEach(l=>{Ju(l),o+=1});let r=c.fromInt(0),i=0;try{if(rt()?.unlocked){$r({level:r,progress:r});try{Pn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(mt()?.unlocked){qr({level:r,progress:r});try{Pn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return Ju(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{G0(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){$r({level:n,progress:n});try{Pn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){qr({level:n,progress:n});try{Pn("mutation",c.fromInt(1))}catch{}return"MP"}try{Pn(t,c.fromInt(1))}catch{}return`stat ${t}`}function I1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";tf.forEach(r=>{if(r.key==="spawnRate")return;let i=Oi(r.key,n),s=an(`${r.label} Multiplier`,Bn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Bn(r.key,u);try{Pn(r.key,l,u)}catch{}let d=Bn(r.key,u);a(d),Nt(f,d)||(et(),tt(`Modified ${r.label} Multiplier (${o}) ${te(f)} \u2192 ${te(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if(H0(a,r.key))return;try{Pn(r.key,Ri(r.key),a)}catch{}}else sf(r.key,a,Ri(r.key));s.setValue(Bn(r.key,a))}}});$t({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Bn(r.key,n);s.setValue(l)}}),$t({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Bn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&$t({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Bn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function w1(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Dt||Dt.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Dt.forEach(n=>{let o=On(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=Ka(t,n.id),s=an("Level",ct(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let m=ct(n.id);xr(n.id,d),et(),m!==d&&tt(`Modified Node ${n.id} Level (The Cove) ${m} \u2192 ${d}`),f(d)},{storageKey:i});$t({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(ct(n.id))}}),r.appendChild(s.row);let l=ja(t,n.id),a=an("Current RP",lo(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(lo(n.id));return}let m=lo(n.id);ys(n.id,d),et(),Nt(m,d)||tt(`Modified Node ${n.id} RP (The Cove) ${te(m)} \u2192 ${te(d)}`),f(d)},{storageKey:l});$t({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(lo(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function E1(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)},{label:"Pending DNA (Experiment)",inputs:[{key:"labLevel",label:"Lab Level"},{key:"xpLevel",label:"XP Level"},{key:"isSurge9",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 9? No"},{value:"Yes",label:"Surge 9? Yes"}]}],compute:({labLevel:n,xpLevel:o,isSurge9:r})=>window.resetSystem?.computePendingDnaFromInputs?.(n,o,r==="Yes")}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>hc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>nd(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Hm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>$s(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>Cr(n)},{label:"Lab Level RP Boost",inputs:[{key:"level",label:"Lab Level"},{key:"isSurge12",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 12? No"},{value:"Yes",label:"Surge 12? Yes"}]}],compute:({level:n,isSurge12:o})=>{let r=0;if(n instanceof c){if(n.isInfinite())return c.fromAny("Infinity");try{r=Number(n.toScientific(10))}catch{r=0}}else r=Number(n);if(!Number.isFinite(r))return c.fromInt(1);if(o==="Yes"){let s=kt(),l=10*s,a=2+s,u=Math.log10(a),f=r*u+l;return ve(f)}let i=r*Math.log10(2);return ve(i)}}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>Em(n,o,r)},{label:"Currency Generation Percentage",inputs:[{key:"tsunamiExp",label:"Tsunami Exponent"}],compute:({tsunamiExp:n})=>{let o=Number(n);if(n instanceof c&&(o=n.isInfinite()?1/0:Number(n.toScientific(10))),!Number.isFinite(o))return"\u2014";let r=o*1.5-.5,i=Math.pow(100,r);return Ae(i)+"%"}}]}].forEach(n=>{let o=On(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=c1({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function x1(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Dl(),of().forEach(o=>{let r=On(o.title,i=>{let s=On("Currencies",p=>{u1(p,o)}),l=On("Stats",p=>{f1(p,o)}),a=On("Multipliers",p=>{let h=On("Currencies",v=>{d1(v,o)}),g=On("Stats",v=>{I1(v,o)});p.appendChild(h),p.appendChild(g)}),u=On("Upgrades",p=>{Tm(p,o)}),f=null,d=null,m=null;o.key===Ie.STARTER_COVE&&(f=On("Automation Upgrades",p=>{Tm(p,{key:Ie.AUTOMATION,title:"Automation"})}),d=On("DNA Upgrades",p=>{Tm(p,{key:Ie.DNA,title:"DNA"})}),m=On("Lab Nodes",p=>{w1(p)}));let y=On("Calculators",p=>{E1(p)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),m&&i.appendChild(m),i.appendChild(y)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function N0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ie),r=[];return o.forEach(i=>{Ct(i).forEach(l=>{e&&Ao(i,l.id).locked||r.push({areaKey:i,upg:l})})}),Ml(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;rr(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function R0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ie),r=[];o.forEach(s=>{Ct(s).forEach(a=>{e&&Ao(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{Ml(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Er(s,l.id,"0"),rr(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function O0(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Ct(Ze);Ml(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;rr(Ze,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(ss),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Ie).forEach(l=>{if(l===Ze)return;Ct(l).forEach(u=>{s.has(u.costType)&&(Er(l,u.id,n),o++)})}),Er(Ze,ao,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function L1(e){e.innerHTML="";let t=b();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=i1();et(),tt(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=s1();et(),tt(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=p1();et(),tt(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=h1();et(),tt(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=m1();et(),tt(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=g1();et(),tt(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let g=N0(!0);et(),tt(`Maxed ${g} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let g=R0(!0);et(),tt(`Reset ${g} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let g=N0(!1);et(),tt(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=R0(!1);et(),tt(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=O0(!0);et(),tt(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=O0(!1);et(),tt(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:v}=y1();et(),tt(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:v}=v1();et(),tt(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{z0([],t),qm(),et(),tt("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=b();if(g!=null)try{localStorage.setItem(Bx(g),String(Fx)),Zo(!0),et(),tt("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let v=$m(g);if(!v||typeof v.isZero=="function"&&v.isZero()||typeof v.isNegative=="function"&&v.isNegative())return;let E,L=!1;qt()?E=xs(v):(E=Hc(v),L=!0),vi(E);let M=v.mulSmall?v.mulSmall(1e3):v.mulBigNumInteger(c.fromInt(1e3));Mr(E,M,L),et(),tt(`Performed OP Time Warp for ${te(v)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle debug-misc-button",v.textContent=g.label,v.addEventListener("click",g.onClick),o.appendChild(v)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",of().forEach(g=>{let v=document.createElement("optgroup");v.label=g.title||g.key,g.currencies.forEach(E=>{let L=document.createElement("option");L.value=`currency:${E.key}`,L.textContent=`${g.title||g.key} \u2192 ${E.label}`,v.appendChild(L)}),g.stats.forEach(E=>{let L=document.createElement("option");L.value=`stat:${E.key}`,L.textContent=`${g.title||g.key} \u2192 ${E.label}`,v.appendChild(L)}),s.appendChild(v)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${ju}"]`)||(ju=Al),s.value=ju;let d=()=>b1(s.value||Al,b()),m=Qx(d);s.addEventListener("change",()=>{ju=s.value||Al,m.refresh()}),m.refresh(),r.appendChild(s),r.appendChild(m.button);let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle reset-check",y.textContent="\u2705",y.addEventListener("click",()=>{let g=s.value||Al,v=d(),E=m.isLocked(),L=(M=!0)=>{let N=t1(v,()=>S1(g))??{label:g,count:0};if(E&&v.forEach(q=>Pi(q)),m.refresh(),et(),M){let{label:q,count:P}=N;tt(`Reset ${P===1?"value and multiplier":"values and multipliers"} for ${q} to defaults.`)}};L(!0),setTimeout(()=>L(!1),100)}),r.appendChild(y),e.appendChild(r);let p=document.createElement("div");p.className="debug-panel-row";let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle debug-danger-button",h.textContent="Wipe Slot & Refresh",h.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let v=document.querySelector(".menu-root"),E=document.getElementById("game-root");v&&(v.hidden=!1,v.style.display="",v.style.visibility=""),E&&(E.hidden=!0,E.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),p.appendChild(h),e.appendChild(p)}function _1(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Ji()}catch{}let n=J0(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(a1(o))})}function eb(){if(!Ni||Ul())return;D0(),$0(),F0=0,U0=0;let e=document.getElementById(Pl);e&&e.remove();let t=document.createElement("div");t.id=Pl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Bo({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Bo()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let m=document.createElement("div");m.className="debug-panel-info-line",d&&m.classList.add("debug-panel-info-mobile-hidden"),m.textContent=f,a.appendChild(m)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(Zu("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{x1(f)})),t.appendChild(Zu("Unlocks: modify specific unlock flags","debug-unlocks",f=>{_1(f)})),t.appendChild(Zu("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),ta=d,qm(),Sn(()=>{ta=null})})),t.appendChild(Zu("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{L1(f)})),$x(t),document.body.appendChild(t),ef>0)try{t.scrollTop=ef}catch{}qx(),Ai=!0}function Om(){if(!(!Ni||Ul())){if(b()==null){Bo();return}Ai||eb()}}function Bo({preserveExpansionState:e=!1}={}){B0=e?Dx():nf();let t=document.getElementById(Pl);if(t){try{ef=t.scrollTop??0}catch{ef=0}t.remove()}D0(),Ai=!1}function C1(){if(!Ni||Ul()||b()==null){Bo();return}Ai?Bo({preserveExpansionState:!0}):Om()}function M1(){Bo(),Nm()}function af(){if(!Gx()){Nm(),Bo();return}$0(),Nm();let e=document.createElement("button");e.id=P0,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{C1()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function T1(e){if(Ni=!!e,!Ni){M1();return}af()}function k1(e){T1(e)}var Ku,Pl,P0,Al,Ai,Ni,km,B0,ef,ju,F0,U0,Pm,ta,Bl,oa,Qu,Ol,Mi,ra,T0,na,k0,Ox,Px,Am,Bx,Fx,Cm,Ti,Mm,ki,tf,A0,ts=$e(()=>{Et();Wt();St();Yn();To();uo();co();mu();tu();hs();Mo();zn();ms();oi();Xd();ai();li();Xc();Ku="debug-panel-style",Pl="debug-panel",P0="debug-panel-toggle",Al=`currency:${Ne.COINS}`,Ai=!1,Ni=!1,km=[],B0=nf(),ef=0,ju=Al,F0=0,U0=0,Pm=[],ta=null,Bl=new Map,oa=new Map,Qu=new Set,Ol=new Map,Mi=new Map,ra=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=ra);T0=!1,na=null,k0=null,Ox="ccc:debug:stat-mult",Px="ccc:actionLog",Am=100,Bx=e=>`ccc:warp:charges:${e}`,Fx=24;Cm="ccc:xp",Ti={unlock:e=>`${Cm}:unlocked:${e}`,level:e=>`${Cm}:level:${e}`,progress:e=>`${Cm}:progress:${e}`},Mm="ccc:mutation",ki={unlock:e=>`${Mm}:unlocked:${e}`,level:e=>`${Mm}:level:${e}`,progress:e=>`${Mm}:progress:${e}`},tf=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];A0=!1;Dl();X0();document.addEventListener("keydown",e=>{if(!(!Ni||Ul())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){Ai?(e1(),Bo()):Om(),e.preventDefault();return}Ai?Bo({preserveExpansionState:!0}):Om(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{af()});window.addEventListener("menu:visibilitychange",Hx);window.addEventListener("saveSlot:change",()=>{af(),Ai&&eb()})});var ib={};vt(ib,{addExternalMutationGainMultiplierProvider:()=>fi,addMutationPower:()=>_s,broadcastMutationChange:()=>Gm,computeMutationMultiplierForLevel:()=>$s,computeMutationRequirementForLevel:()=>Hm,getMutationCoinSprite:()=>om,getMutationGainMultiplier:()=>cf,getMutationMultiplier:()=>lf,getMutationState:()=>mt,getTotalCumulativeMp:()=>mi,initMutationSystem:()=>Qt,isMutationUnlocked:()=>Ro,onMutationChange:()=>Li,setMutationUnlockedForDebug:()=>Fl,unlockMutationSystem:()=>Pr});function uf(e){try{return e?.toStorage?.()}catch{return null}}function Di(){try{nn()}catch{}}function rb(e){let t=e;if(!t.isZero?.()){let n=Ui.size>0?Array.from(Ui):typeof Gl=="function"?[Gl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof Qe?t=r.clone?.()??r:r!=null&&(t=Qe.fromAny(r))}catch{}}return t}function R1(){if(typeof Xm=="function"){try{Xm()}catch{}Xm=null}if(typeof Vm=="function"){try{Vm()}catch{}Vm=null}}function Hl(e){if(e instanceof Qe)try{return e.clone?.()??Qe.fromAny(e)}catch{return gt()}try{return Qe.fromAny(e??0)}catch{return gt()}}function O1(e){if(!e||typeof e!="object")return gt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?Qe.fromInt(100):Qe.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function df(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=ke(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Jm(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let m=Math.pow(1.12,l-10);if(!Number.isFinite(m)||(f+=N1*(m-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=df(e);if(!Number.isFinite(n))return Qe.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return Qe.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return Qe.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return Qe.fromAny("Infinity");let i=ve(r);return O1(i)}function Gr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=Jm(D.level);D.requirement=n}function P1(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=ke(e),l=ke(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Km(){return Fn.container&&Fn.container.isConnected?!0:(Fn.container=document.querySelector("[data-mp-hud].mp-counter"),Fn.container?(Fn.bar=Fn.container.querySelector(".mp-bar"),Fn.fill=Fn.container.querySelector(".mp-bar__fill"),Fn.levelValue=Fn.container.querySelector(".mp-level-value"),Fn.progress=Fn.container.querySelector("[data-mp-progress]"),!0):!1)}function Bi(e){try{return te(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function ur(){if(!Km())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Fn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Bi(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Bi(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}zi();return}e.removeAttribute("hidden");let i=D.requirement,s=P1(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Bi(D.level)),r){let a=Bi(D.progress),u=Bi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Bi(D.progress).replace(/<[^>]*>/g,""),u=Bi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}zi()}function fr(e="update",t={}){let n=mt(),o={...n,slot:D.slot??b(),changeType:e,...t};if(zm.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function Qm(){let e=D.slot;if(e==null&&(e=b(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem($l(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Fi(e),D.level.toStorage())}catch{}try{localStorage.setItem(sa(e),D.progress.toStorage())}catch{}lt($l(e)),lt(Fi(e)),lt(sa(e));let t=(()=>{let u=D.unlocked,f=D.level,d=D.progress;try{u=localStorage.getItem($l(e))==="1"}catch{}try{let m=localStorage.getItem(Fi(e));m&&(f=Qe.fromAny(m))}catch{}try{let m=localStorage.getItem(sa(e));m&&(d=Qe.fromAny(m))}catch{}return{unlocked:u,level:f,progress:d}})(),n=uf(t.level),o=uf(t.progress),r=uf(D.level),i=uf(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&ff(t,{skipPersist:!0})}function jm(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function B1(){if(!D.unlocked)return;let e=D.slot??b();if(e!=null&&jm(Fi(e))){Gr();return}Gr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(aa()),Gr(),t=D.requirement,!t||typeof t!="object"){D.progress=gt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=gt())}function ff(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=Hl(e.level),D.progress=Hl(e.progress),D.unlocked||(D.level=gt(),D.progress=gt()),Gr(),t||Qm(),ur(),fr("load"),Di()}function Ym(e){let t=e??b();if(t==null){ff({unlocked:!1,level:gt(),progress:gt()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=gt(),r=gt();try{n=localStorage.getItem($l(t))==="1"}catch{}try{let i=localStorage.getItem(Fi(t));i&&(o=Qe.fromAny(i))}catch{}try{let i=localStorage.getItem(sa(t));i&&(r=Qe.fromAny(i))}catch{}ff({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function F1(){for(;ql.length;){let e=ql.pop();try{e?.()}catch{}}}function Wm(e){nb!==e&&(F1(),nb=e,e!=null&&(ql.push(Tt($l(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=gt(),D.progress=gt()),Gr(),ur(),fr("storage"),Di())}})),ql.push(Tt(Fi(e),{onChange(t){if(t)try{let n=Qe.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Gr(),ur(),fr("storage"),Di())}catch{}}})),ql.push(Tt(sa(e),{onChange(t){if(t)try{let n=Qe.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Gr(),ur(),fr("storage"))}catch{}}}))))}function Qt({forceReload:e=!1}={}){if(R1(),ob){let n=b();return(n!==D.slot||e)&&Ym(n),Wm(n),Km(),ur(),mt()}ob=!0,Km();let t=b();return D.slot=t,Ym(t),Wm(t),ur(),Di(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();D.slot=n,Ym(n),Wm(n),ur(),Di(),fr("slot")}),mt()}function mt(){return{unlocked:D.unlocked,level:Hl(D.level),progress:Hl(D.progress),requirement:Hl(D.requirement)}}function Ro(){return!!D.unlocked}function Pr(){return Qt(),D.unlocked?!1:(D.unlocked=!0,Gr(),Qm(),ur(),fr("unlock"),Di(),!0)}function Fl(e){Qt();let t=!!e;ff({unlocked:t,level:t?D.level:gt(),progress:t?D.progress:gt()})}function _s(e){Qt();let t=D.slot??b();if(t!=null&&jm(sa(t))||!D.unlocked)return mt();let n=t!=null&&jm(Fi(t));if(D.level&&D.level.isInfinite?.()){let f=D.level.clone?.()??D.level,d=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=Qe.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=Qe.fromAny("Infinity")}catch{}let m;try{m=e instanceof Qe?e:Qe.fromAny(e??0)}catch{m=gt()}return m=rb(m),m=Wn("mutation",m),fr("progress",{delta:m.clone?.()??m,levelsGained:gt(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof Qe?e:Qe.fromAny(e??0)}catch{o=gt()}if(o=rb(o),o=Wn("mutation",o),o.isZero?.())return mt();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=Qe.fromAny("Infinity")}catch{}try{D.progress=Qe.fromAny("Infinity")}catch{D.progress=gt()}try{D.requirement=Qe.fromAny("Infinity")}catch{}}else B1();Qm(),ur();let a=D.level.sub(i);return a.isZero?.()||Di(),fr("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Gm(e={}){Qt();let t=e.changeType??"manual";return fr(t,e)}function $s(e){let t;if(e instanceof Qe)try{t=e.clone?.()??e}catch{t=gt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=gt()}else try{t=c.fromAny(e??0)}catch{t=gt()}if(t&&t.isInfinite?.())try{return Qe.fromAny("Infinity")}catch{return aa()}let n=df(t);if(!Number.isFinite(n))try{return Qe.fromAny("Infinity")}catch{return aa()}if(n<=0)return aa();let o=n*A1;return ve(o)}function Hm(e){let t;try{t=e instanceof Qe?e:Qe.fromAny(e??0)}catch{t=gt()}try{return Jm(t)}catch{return gt()}}function lf(){if(Qt(),!D.unlocked)return aa();try{return $s(D.level)}catch{return aa()}}function cf(){let e=c.fromInt(1);if(Ui.size>0||Gl){let t=Ui.size>0?Array.from(Ui):typeof Gl=="function"?[Gl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof Qe?e=o.clone?.()??o:o!=null&&(e=Qe.fromAny(o))}catch{}}return e}function om(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=df(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function Li(e){return typeof e!="function"?()=>{}:(zm.add(e),()=>{zm.delete(e)})}function fi(e){return typeof e!="function"?()=>{}:(Ui.add(e),()=>{Ui.delete(e)})}function mi(){if(Qt(),!D.unlocked)return gt();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=df(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=Jm(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Zm,$l,Fi,sa,Qe,gt,aa,A1,N1,D,Fn,zm,ql,nb,ob,Xm,Vm,Ui,Gl,To=$e(()=>{Et();St();ts();Wt();Et();Vf();Yn();Zm="ccc:mutation",$l=e=>`${Zm}:unlocked:${e}`,Fi=e=>`${Zm}:level:${e}`,sa=e=>`${Zm}:progress:${e}`,Qe=c,gt=()=>Qe.fromInt(0),aa=()=>Qe.fromInt(1),A1=Math.log10(2),N1=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:gt(),progress:gt(),requirement:gt(),slot:null},Fn={container:null,bar:null,fill:null,levelValue:null,progress:null},zm=new Set,ql=[],nb=null,ob=!1,Xm=null,Vm=null,Ui=new Set,Gl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Qt,unlockMutationSystem:Pr,addMutationPower:_s,getMutationState:mt,getMutationMultiplier:lf,isMutationUnlocked:Ro,getTotalCumulativeMp:mi,addExternalMutationGainMultiplierProvider:fi,getMutationGainMultiplier:cf}))});var Xl,sb,ab,eh,th,nh,lb=$e(()=>{Xl=`precision highp float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,sb=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\n\nvoid main() {\n    /* Wave animation settings */\n    float speed = 1.2;\n    float time = uTime * speed;\n    \n    /* Combine sine waves for a more natural look */\n    /* vUv.x is 0..1 across the screen width */\n    float wave1 = sin(vUv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n\n    /* Define the shoreline height (baseline) */\n    /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */\n    /* We want to discard pixels below this threshold */\n    float threshold = 0.428 + wave; \n\n    if (threshold > vUv.y) {\n        discard;\n    }\n\n    /* Recalculate gradient based on the new "bottom" */\n    /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */\n    float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0);\n    \n    vec3 col = mix(uColorShallow, uColorDeep, gradientY);\n    \n    /* Add a subtle "foam" or highlight at the edge */\n    float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold);\n    col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4);\n    \n    gl_FragColor = vec4(col, 1.0);\n}`,ab=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uWaveMap; \nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\nuniform vec3 uColorWaveDeep;  \nuniform vec3 uColorWave;      \n\n/* Simple noise for foam breakup */\nfloat hash(vec2 p) {\n    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\n}\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f*f*(3.0-2.0*f);\n    return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),\n               mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y);\n}\n\nvoid main() {\n    vec2 uv = vUv;\n    \n    /* Sample the simulation (physics) */\n    /* Wave Logic */\n    vec2 waveUV = uv - vec2(0.0, 0.0285);\n    float intensity = texture2D(uWaveMap, waveUV).r;\n    \n    /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */\n    float shadowOffset = 8.0 / uResolution.y; \n    float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r;\n    \n    /* Discard only if BOTH are empty */\n    if (0.01 > intensity && 0.01 > shadowIntensity) discard;\n    \n    /* Directional Noise: Streaky vertical noise for rushing water effect */\n    /* Stretch heavily along Y-axis to simulate speed/motion blur */\n    float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0));\n    \n    /* Define Zones based on Intensity */\n    /* Body (Medium Intensity): Darker/turbulent blue with noise */\n    /* Edge (High Intensity): Bright white foam */\n    \n    float foamThreshold = 0.5;\n    float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity);\n    \n    /* Base Colors */\n    vec3 bodyColor = uColorWaveDeep;\n    vec3 foamColor = uColorWave;\n    \n    /* Mix Colors */\n    vec3 finalColor = mix(bodyColor, foamColor, foamMix);\n    \n    /* Add streaks to the body part */\n    if (0.9 > foamMix) {\n        finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix);\n    }\n    \n    /* Hard Edge & Opacity */\n    /* Ensure the front (bottom) remains sharp, back trails off */\n    \n    /* Calculate Alpha based on Intensity */\n    /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */\n    /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */\n    /* Low Intensity (Top/Tail): Fades to 0.0 */\n    \n    float finalAlpha = smoothstep(0.02, 0.15, intensity);\n    \n    /* Screen Fade */\n    /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */\n    \n    /* Dynamic Shoreline Fade */\n    /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */\n    /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */\n    float speed = 1.2;\n    float time = uTime * speed;\n    float wave1 = sin(uv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n    float threshold = 0.428 + wave;\n    \n    /* Fade out quickly after exiting the water body (below threshold) */\n    /* Fade starts slightly higher than the threshold to soften the transition */\n    /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */\n    float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y);\n    \n    float screenFade = shoreFade;\n    \n    /* --- Composite Shadow & Wave --- */\n    float waveAlpha = finalAlpha * screenFade;\n    \n    /* Shadow Alpha */\n    float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity);\n    /* Shadow is weaker (40% opacity) */\n    float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade;\n    \n    /* Mix: Wave over Shadow */\n    /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */\n    float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha);\n    \n    /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */\n    /* Shadow is black (RGB=0), so second term is 0 */\n    vec3 outRGB = finalColor * waveAlpha; \n    \n    gl_FragColor = vec4(outRGB, outAlpha);\n}`,eh=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,th=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,nh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var fb={};vt(fb,{WaterSystem:()=>pf,waterSystem:()=>mf});function ub(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function la(e,t,n){let o=ub(e,e.VERTEX_SHADER,t),r=ub(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var U1,cb,D1,$1,pf,mf,oh=$e(()=>{lb();U1=[.2,.5,.9],cb=[.2,.9,1],D1=[1,1,1],$1=[.45,.8,1];pf=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:la(s,Xl,ab),simProgram:la(s,Xl,nh),brushProgram:la(s,eh,th),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=la(this.glBg,Xl,sb),this.bgSimProgram=la(this.glBg,Xl,nh),this.bgBrushProgram=la(this.glBg,eh,th)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,m=a/this.height,y=new Float32Array([u-d,f-m,0,0,1,u+d,f-m,1,0,1,u-d,f+m,0,1,1,u+d,f+m,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,y,t.DYNAMIC_DRAW);let p=t.getAttribLocation(n,"aPosition"),h=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(p),t.vertexAttribPointer(p,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let m=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=m.readFBO,f.writeFBO=m.writeFBO,f.readTexture=m.readTex,f.writeTexture=m.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),U1),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),cb),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),cb),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),D1),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),$1),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let m=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(m),d.vertexAttribPointer(m,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},mf=new pf});var yb={};vt(yb,{createSpawner:()=>z1});function gb(e){if(!e||typeof e!="object"){ca=!1,$i=0n;return}ca=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;$i=n&&n!=="Infinity"?BigInt(n):0n}catch{$i=0n}}function G1(e){let t=1-e;return 1-t*t*t}function X1(e){if(!e)return null;let t=db.get(e);return t||(t=new Image,t.src=e,db.set(e,t)),t}function z1({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=Je?q1:1e4,initialBurst:d=1,coinTtlMs:m=1e99,waveSoundSrc:y="sounds/wave_spawn.ogg",waveSoundDesktopVolume:p=.45,waveSoundMobileVolume:h=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:v=!1}={}){let E=o,L={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function M(){return!!(L.pf&&L.w&&L.c)}M()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let N=7,q=[],P=[],G=!1;if(L.c)for(let I=0;I<N;I++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+I*10}`,L.c.appendChild(k);let O=k.getContext("2d",{alpha:!0});q.push(k),P.push(O)}let C=null,U=null;L.c&&(C=document.createElement("canvas"),C.style.position="absolute",C.style.inset="0",C.style.pointerEvents="none",C.style.zIndex="100",L.c.appendChild(C),U=C.getContext("2d",{alpha:!0}));let T={collectBatch:null,getMagnetUnit:null};function _(I){T={...T,...I}}let V={pfRect:null,wRect:null,safeBottom:0,pfW:0};function J(){if(!M())return!1;let I=L.pf.getBoundingClientRect(),k=L.w.getBoundingClientRect(),O=L.hud?L.hud.getBoundingClientRect().height:0;V={pfRect:I,wRect:k,safeBottom:I.height-O,pfW:I.width};let A=window.devicePixelRatio||1;return q.forEach((B,ue)=>{if(B){B.width=I.width*A,B.height=I.height*A,B.style.width=I.width+"px",B.style.height=I.height+"px";let fe=P[ue];fe&&(fe.setTransform(1,0,0,1,0,0),fe.scale(A,A),fe.imageSmoothingEnabled=!0,fe.imageSmoothingQuality="high")}}),G=!0,C&&(C.width=I.width*A,C.height=I.height*A,C.style.width=I.width+"px",C.style.height=I.height+"px",U&&(U.setTransform(1,0,0,1,0,0),U.scale(A,A))),!0}J();let se="ResizeObserver"in window?new ResizeObserver(()=>J()):null;se&&L.pf&&se.observe(L.pf),document.addEventListener("visibilitychange",()=>{document.hidden||J()});let de=(I,k,O)=>Math.max(k,Math.min(O,I)),ye=Math.max(2e3,f*3),Re=12,Ce=[],F=[],Y=0,$=[],H=[];function j(){let I=document.createElement("div");I.className="coin",I.style.position="absolute",I.style.pointerEvents="auto",I.style.borderRadius="50%",I.style.willChange="transform",I.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=E,k.style.objectFit="contain",k.style.borderRadius="50%",I.appendChild(k),v&&(I.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),I}let W=()=>Ce.length?Ce.pop():j();function re(I){I.style.transition="",I.style.transform="",I.style.opacity="1",I.classList.remove("coin--collected");for(let k=0;k<=6;k++)I.classList.remove(`coin--size-${k}`);I.style.removeProperty("--ccc-start"),delete I.dataset.dieAt,delete I.dataset.mutationLevel,delete I.dataset.collected,I.style.willChange="transform",I.parentNode&&I.remove(),Ce.length<ye&&Ce.push(I)}function x(I,k=-1){if(I.isRemoved)return;I.isRemoved=!0;let O=k;(O===-1||F[O]!==I)&&(I.index!==void 0&&F[I.index]===I?O=I.index:O=F.indexOf(I)),O!==-1&&(F[O]=null,Y++),I.el?(re(I.el),I.el=null):H.push({layer:I.sizeIndex||0,x:I.x,y:I.y,size:I.size||r})}function K(I){let k=I._coinObj;if(k){let O=-1;k.index!==void 0&&F[k.index]===k?O=k.index:O=F.indexOf(k),O!==-1&&(F[O]=null,Y++),I._coinObj=null}}let ce=new URL(y,document.baseURI).href,pe=0;function Q(){let I=performance.now();if(I-pe<g)return;pe=I,ht(ce,{volume:Je?h:p,type:"music"})}function ie(){if(!M())return null;if((!V.pfRect||!V.wRect)&&J(),f!==1/0&&F.length-Y>=f){let Lt=-1;if(Fe(2))for(let Pt=0;Pt<F.length;Pt++){let Io=F[Pt];if(Io&&Io.sizeIndex<4){Lt=Pt;break}}else for(let Pt=0;Pt<F.length;Pt++)if(F[Pt]){Lt=Pt;break}if(Lt===-1)return null;let Ot=F[Lt];Ot&&x(Ot,Lt)}let I=V.pfW,k=V.wRect.top-V.pfRect.top,O=Math.max(0,k),A=0;if(Fe(2)){let Lt=Math.random();for(let Ot=6;Ot>=1;Ot--)if(Lt<Y1[Ot]){A=Ot;break}}A>=4&&El&&El()&&(A=3);let B=pb[A],ue=Re+(A>=3?15*(A-2):0),fe=ue,Ee=Math.max(fe,I-B-ue),Le=fe+Math.random()*(Ee-fe),Ke=Math.random()*100-50,He;if(B>=V.pfW)He=(V.pfW-B)/2;else{let Lt=V.pfW-B-ue;fe>=Lt?He=(V.pfW-B)/2:He=de(Le+Ke,fe,Lt)}let De=Math.min(V.wRect.height,V.pfRect.height*.3),_e=Math.max(De+80,120),Oe=Math.max(_e+40,V.safeBottom-B-6),Se=de(_e+Math.random()*(Oe-_e),_e,Oe),Ye={x0:Le,y0:O,x1:He,y1:Se,jitterMs:0},ot=V.pfRect.left-V.wRect.left,Xe=W1[A],Rt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),at=.85+Math.random()*.3,wt=Rt*(Xe.w/100)*at,Xt=Rt*(Xe.h/100)*at,Vt=Le+B/2+ot,Dn=O-k;return{wave:{x:Vt,y:Dn,width:wt,height:Xt},coin:Ye,sizeIndex:A}}function me(I){if(!I.length||!M())return;let k=document.createDocumentFragment(),O=[],A=performance.now(),B=!1;for(let{wave:ue,coin:fe,sizeIndex:Ee}of I){if(ue&&(B=!0,mf)){let Oe=Ee>=4;mf.addWave(ue.x,ue.y,ue.width,ue.height,Oe)}let Le=pb[Ee],Ke=1;if(Fe(8)){let Oe=Ln(),Se=Math.pow(25,Oe);Ke=Math.pow(Se,Ee)}else Ke=V1[Ee];let He=Ee>=4,De=W();De.style.width=`${Le}px`,De.style.height=`${Le}px`,De.className=`coin coin--size-${Ee}`,De.firstChild&&(De.firstChild.src=E),De.style.transform=`translate3d(${fe.x0}px, ${fe.y0}px, 0) rotate(-10deg) scale(0.96)`,De.style.opacity="0",ca?De.dataset.mutationLevel=$i.toString():De.dataset.mutationLevel="0";let _e={mutationLevel:ca?$i.toString():"0",el:De,src:E,x:fe.x0,y:fe.y0,rot:-10,scale:.96,startX:fe.x0,startY:fe.y0,endX:fe.x1,endY:fe.y1,startTime:A+fe.jitterMs,duration:i,dieAt:A+m,jitterMs:fe.jitterMs,isRemoved:!1,settled:!1,size:Le,sizeIndex:Ee,valueMultiplier:Ke,forceDom:He,soundSrc:hb[Ee]?`sounds/coin_pickup${hb[Ee]}`:null,bMinX:Math.min(fe.x0,fe.x1)-Le,bMaxX:Math.max(fe.x0,fe.x1)+Le,bMinY:Math.min(fe.y0,fe.y1)-Le,bMaxY:Math.max(fe.y0,fe.y1)+Le};De._coinObj=_e,_e.index=F.length,F.push(_e),O.push(_e),k.appendChild(De)}L.c.appendChild(k),O.length>0&&(O[0].el&&O[0].el.offsetHeight,requestAnimationFrame(()=>{for(let ue of O)ue.el&&(ue.el.style.transition=`transform ${i}ms ${H1} ${ue.jitterMs}ms`,ue.el.style.transform=`translate3d(${ue.endX}px, ${ue.endY}px, 0) rotate(0deg) scale(1)`,ue.el.style.opacity="1")})),B&&requestAnimationFrame(()=>{Q()})}function Pe(I=1){if(!M())return;(!V.pfRect||!V.wRect)&&J();let k=[];for(let O=0;O<I;O++){let A=ie();A&&k.push(A)}k.length&&me(k)}function ne(I,k){if(I.settled||I.isRemoved)return{x:I.x,y:I.y,rot:0,scale:1};let O=k-I.startTime;if(O<0)return{x:I.startX,y:I.startY,rot:-10,scale:.96};let A=O/I.duration;if(A>=1)return{x:I.endX,y:I.endY,rot:0,scale:1};let B=G1(A),ue=I.startX+(I.endX-I.startX)*B,fe=I.startY+(I.endY-I.startY)*B,Ee=-10+10*B,Le=.96+.04*B;return{x:ue,y:fe,rot:Ee,scale:Le}}function ge(I,k){let O=X1(k.src);if(O&&O.complete&&O.naturalWidth>0){let A=k.size||r;I.drawImage(O,k.x,k.y,A,A)}}function Ue(){if(P.length)if(G){P.forEach((k,O)=>{q[O]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,q[O].width,q[O].height),k.restore(),v&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let I=F.length;for(let k=0;k<I;k++){let O=F[k];if(O&&O&&O.settled&&!O.isRemoved&&!O.el){let A=O.sizeIndex||0;P[A]&&ge(P[A],O)}}v&&P.forEach(k=>k.restore()),G=!1,$.length=0,H.length=0}else{if(H.length>0){v&&P.forEach(k=>{k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2});let I=F.length;for(let k=0;k<H.length;k++){let O=H[k],A=P[O.layer];if(!A)continue;let B=8,ue=O.x-B,fe=O.y-B,Ee=O.size+B*2;A.save(),A.beginPath(),A.rect(ue,fe,Ee,Ee),A.clip(),A.clearRect(ue,fe,Ee,Ee);let Le=ue,Ke=ue+Ee,He=fe,De=fe+Ee;for(let _e=0;_e<I;_e++){let Oe=F[_e];if(!Oe||!Oe.settled||Oe.isRemoved||Oe.el||(Oe.sizeIndex||0)!==O.layer)continue;let Se=Oe.size||r,je=Oe.x,Ye=Oe.x+Se,ot=Oe.y,Xe=Oe.y+Se;Ye>Le&&je<Ke&&Xe>He&&ot<De&&ge(A,Oe)}A.restore()}v&&P.forEach(k=>k.restore()),H.length=0}if($.length>0){v&&P.forEach(I=>{I.save(),I.shadowColor="rgba(0,0,0,0.35)",I.shadowBlur=2,I.shadowOffsetY=2});for(let I=0;I<$.length;I++){let k=$[I];if(!k.isRemoved&&k.settled&&!k.el){let O=k.sizeIndex||0;P[O]&&ge(P[O],k)}}v&&P.forEach(I=>I.restore()),$.length=0}}}let Me=a,Be=null,ae=performance.now(),ee=0;function we(I){(!V.pfRect||!V.wRect)&&J();let k=(I-ae)/1e3;ae=I,k>.1&&(k=.1);for(let A=F.length-1;A>=0;A--){let B=F[A];if(!B||!B)continue;if(I>=B.dieAt){x(B,A);continue}if(B.sizeIndex===5&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=I-1e3,B.nextLightningInterval=0),I-B.lastLightningTime>B.nextLightningInterval)){B.lastLightningTime=I,B.nextLightningInterval=200+Math.random()*100;for(let Ee=0;Ee<3;Ee++)$o(B,I)}if(B.sizeIndex===6&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=I-1e3,B.nextLightningInterval=0),I-B.lastLightningTime>B.nextLightningInterval&&(B.lastLightningTime=I,B.nextLightningInterval=200+Math.random()*100,T.collectBatch))){let Ee=ne(B,I),Le=Ee.x+B.size/2,Ke=Ee.y+B.size/2,He=[],De=B.size/2*(B.size/2),_e=F.length;for(let Oe=0;Oe<_e;Oe++){let Se=F[Oe];if(!Se||Se===B||Se.isRemoved||Se.settled===!1||Se.sizeIndex>3)continue;let je=Se.x+(Se.size||r)/2,Ye=Se.y+(Se.size||r)/2,ot=je-Le,Xe=Ye-Ke;ot*ot+Xe*Xe>De&&He.push(Se)}if(He.length>0){for(let Ye=He.length-1;Ye>0;Ye--){let ot=Math.floor(Math.random()*(Ye+1));[He[Ye],He[ot]]=[He[ot],He[Ye]]}let Oe=He.slice(0,3),Se=[],je=!1;for(let Ye of Oe){let ot=Ye.size||r,Xe=Ye.x+ot/2,Rt=Ye.y+ot/2;dr(B,Xe,Rt),Do(Xe,Rt,ot),Se.push({coin:Ye}),je||(ht("sounds/lightning_strike.ogg",{volume:.25}),je=!0)}Se.length>0&&T.collectBatch(Se)}}if(B.settled)continue;let ue=I-B.startTime;if(ue<0)continue;if(ue/B.duration>=1){B.settled=!0,B.x=B.endX,B.y=B.endY,B.rot=0,B.scale=1,B.el&&!B.forceDom?(re(B.el),B.el=null,$.push(B)):B.el&&(B.el.style.transition="none",B.el.style.transform=`translate3d(${B.x}px, ${B.y}px, 0) rotate(0deg) scale(1)`);continue}}ee+=Me*k;let O=Math.floor(ee);if(O>0){ee-=O;let A=Math.min(O,u);if(A>0){let B=performance.now(),ue=[],fe=5;for(let Ee=0;Ee<A&&!(performance.now()-B>fe);Ee++){let Le=ie();Le&&ue.push(Le)}ue.length&&me(ue)}}if(Ue(),Y>50){let A=0;for(let B=0;B<F.length;B++){let ue=F[B];ue!==null&&(ue.index=A,F[A++]=ue)}F.length=A,Y=0}Te(k),Be=requestAnimationFrame(we)}function w(){if(!Be){if(!M()){console.warn("[Spawner] start() called but required nodes are missing.");return}J(),d>0&&Be===null&&Pe(d),ae=performance.now(),Be=requestAnimationFrame(we)}}function z(){Be&&(cancelAnimationFrame(Be),Be=null)}function Z(I){Me=Math.max(0,Number(I)||0)}function oe(){ee=0,ae=performance.now()}function he(I){let k=Fe(2)&&!!I;for(let O=F.length-1;O>=0;O--){let A=F[O];if(A&&A){if(k&&A.sizeIndex>=4){A.mutationLevel=ca?$i.toString():"0",A.el&&(A.el.dataset.mutationLevel=A.mutationLevel);continue}x(F[O],O)}}oe()}function le(I){I&&(E=I)}function We(I){let k=I._coinObj;if(!k)return I.style.transform||"translate3d(0,0,0)";let{x:O,y:A,rot:B,scale:ue}=ne(k,performance.now());return`translate3d(${O}px, ${A}px, 0) rotate(${B}deg) scale(${ue})`}function nt(I){if(I.el)return I.el;if(I.isRemoved)return null;let k=W(),O=I.size||r;return k.style.width=`${O}px`,k.style.height=`${O}px`,k.className=`coin coin--size-${I.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${I.x}px, ${I.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=I.src),k.style.opacity="1",k.dataset.mutationLevel=I.mutationLevel,k._coinObj=I,I.el=k,L.c.appendChild(k),H.push({layer:I.sizeIndex||0,x:I.x,y:I.y,size:I.size||r}),k}function be(I,k,O,A){let B=O;A&&(B=Math.max(O,260));let ue=O*O,fe=[],Ee=F.length,Le=I-B,Ke=I+B,He=k-B,De=k+B,_e=performance.now();for(let Oe=0;Oe<Ee;Oe++){let Se=F[Oe];if(!Se||Se.bMaxX<Le||Se.bMinX>Ke||Se.bMaxY<He||Se.bMinY>De)continue;let je=Se.size||r,Ye,ot;if(Se.settled)Ye=Se.x+je/2,ot=Se.y+je/2;else{let wt=ne(Se,_e);Ye=wt.x+je/2,ot=wt.y+je/2}if(Ye<Le||Ye>Ke||ot<He||ot>De)continue;let Xe=Ye-I,Rt=ot-k,at=ue;if(A&&(Se.sizeIndex||0)>0){let wt=je/2;at=wt*wt}Xe*Xe+Rt*Rt<=at&&(Se.isRemoved||fe.push(Se))}return fe}function Ge(I,k,O,A,B,ue){let fe=B;ue&&(fe=Math.max(B,260));let Ee=B*B,Le=[],Ke=F.length,He=Math.min(I,O)-fe,De=Math.max(I,O)+fe,_e=Math.min(k,A)-fe,Oe=Math.max(k,A)+fe,Se=O-I,je=A-k,Ye=Se*Se+je*je,ot=Ee*Ye,Xe=performance.now();for(let Rt=0;Rt<Ke;Rt++){let at=F[Rt];if(!at||at.bMaxX<He||at.bMinX>De||at.bMaxY<_e||at.bMinY>Oe)continue;let wt=at.size||r,Xt,Vt;if(at.settled)Xt=at.x+wt/2,Vt=at.y+wt/2;else{let un=ne(at,Xe);Xt=un.x+wt/2,Vt=un.y+wt/2}if(Xt<He||Xt>De||Vt<_e||Vt>Oe)continue;let Dn=Xt-I,Lt=Vt-k,Ot=Dn*Se+Lt*je,Pt=Ee;if(ue&&(at.sizeIndex||0)>0){let un=wt/2;Pt=un*un}let Io=!1;if(Ot<=0)Dn*Dn+Lt*Lt<=Pt&&(Io=!0);else if(Ot>=Ye){let un=Xt-O,va=Vt-A;un*un+va*va<=Pt&&(Io=!0)}else{let un=Dn*je-Lt*Se;un*un<=Pt*Ye&&(Io=!0)}Io&&!at.isRemoved&&Le.push(at)}return Le}function Ht(I){x(I)}function dt(I,k,O){let A=O*O,B=[],ue=F.length,fe=I-O,Ee=I+O,Le=k-O,Ke=k+O,He=performance.now();for(let De=0;De<ue;De++){let _e=F[De];if(!_e||_e.bMaxX<fe||_e.bMinX>Ee||_e.bMaxY<Le||_e.bMinY>Ke)continue;let Oe=_e.size||r,Se,je;if(_e.settled)Se=_e.x+Oe/2,je=_e.y+Oe/2;else{let Xe=ne(_e,He);Se=Xe.x+Oe/2,je=Xe.y+Oe/2}if(Se<fe||Se>Ee||je<Le||je>Ke)continue;let Ye=Se-I,ot=je-k;Ye*Ye+ot*ot<=A&&(!_e.el&&!_e.isRemoved&&nt(_e),_e.el&&B.push(_e.el))}return B}function cn(I,k,O,A,B){let ue=B*B,fe=[],Ee=F.length,Le=Math.min(I,O)-B,Ke=Math.max(I,O)+B,He=Math.min(k,A)-B,De=Math.max(k,A)+B,_e=O-I,Oe=A-k,Se=_e*_e+Oe*Oe,je=ue*Se,Ye=performance.now();for(let ot=0;ot<Ee;ot++){let Xe=F[ot];if(!Xe||Xe.bMaxX<Le||Xe.bMinX>Ke||Xe.bMaxY<He||Xe.bMinY>De)continue;let Rt=Xe.size||r,at,wt;if(Xe.settled)at=Xe.x+Rt/2,wt=Xe.y+Rt/2;else{let Ot=ne(Xe,Ye);at=Ot.x+Rt/2,wt=Ot.y+Rt/2}if(at<Le||at>Ke||wt<He||wt>De)continue;let Xt=at-I,Vt=wt-k,Dn=Xt*_e+Vt*Oe,Lt=!1;if(Dn<=0)Xt*Xt+Vt*Vt<=ue&&(Lt=!0);else if(Dn>=Se){let Ot=at-O,Pt=wt-A;Ot*Ot+Pt*Pt<=ue&&(Lt=!0)}else{let Ot=Xt*Oe-Vt*_e;Ot*Ot<=je&&(Lt=!0)}Lt&&(!Xe.el&&!Xe.isRemoved&&nt(Xe),Xe.el&&fe.push(Xe.el))}return fe}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;Be||w()}});function Un(){M()&&Pe(1)}let Ut=[],In=[];function Vr(I,k){if(!I||!k)return;let O=I.size||r,A=k.size||r,B=I.x+O/2,ue=I.y+O/2,fe=k.x+A/2,Ee=k.y+A/2;Ut.push({x1:B,y1:ue,x2:fe,y2:Ee,age:0,life:.15})}function Do(I,k,O){if(!L.pf)return;let A=document.createElement("div");A.className="coin-stain";let B=O*1.2;A.style.width=`${B}px`,A.style.height=`${B}px`,A.style.left=`${I-B/2}px`,A.style.top=`${k-B/2}px`,L.pf.appendChild(A),setTimeout(()=>{A.style.opacity="0",setTimeout(()=>{A.parentNode&&A.remove()},1e3)},2500)}function $o(I,k){let O=Math.random()*Math.PI*2,A=(I.size||r)/2,B=A*mb,ue=Math.cos(O)*B,fe=Math.sin(O)*B,Ee=A*(.7+Math.random()*.6),Le=Math.cos(O)*(B+Ee),Ke=Math.sin(O)*(B+Ee);Ut.push({parentCoin:I,relX1:ue,relY1:fe,relX2:Le,relY2:Ke,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let He=3+Math.floor(Math.random()*3);for(let De=0;De<He;De++){let _e=.3+Math.random()*.5,Oe=ue+(Le-ue)*_e,Se=fe+(Ke-fe)*_e,je=O+(Math.random()*1.2-.6),Ye=Ee*(.4+Math.random()*.4),ot=Oe+Math.cos(je)*Ye,Xe=Se+Math.sin(je)*Ye;Ut.push({parentCoin:I,relX1:Oe,relY1:Se,relX2:ot,relY2:Xe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ht("sounds/lightning_zap.ogg",{volume:.25})}function dr(I,k,O){if(!I)return;let A=I.size||r,B=performance.now(),ue=ne(I,B),fe=ue.x+A/2,Ee=ue.y+A/2,Le=k-fe,Ke=O-Ee,He=Math.atan2(Ke,Le),De=Math.sqrt(Le*Le+Ke*Ke),_e=A/2*mb,Oe=Math.cos(He)*_e,Se=Math.sin(He)*_e;Ut.push({parentCoin:I,relX1:Oe,relY1:Se,x2:k,y2:O,age:0,life:.25,width:6,jaggedScale:25});let je=fe+Oe,Ye=Ee+Se,ot=6+Math.floor(Math.random()*5);for(let Xe=0;Xe<ot;Xe++){let Rt=.1+Math.random()*.8,at=je+(k-je)*Rt,wt=Ye+(O-Ye)*Rt,Xt=He+(Math.random()*1.6-.8),Vt=De*(.1+Math.random()*.3),Dn=at+Math.cos(Xt)*Vt,Lt=wt+Math.sin(Xt)*Vt;if(Ut.push({x1:at,y1:wt,x2:Dn,y2:Lt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Pt=at+(Dn-at)*.5,Io=wt+(Lt-wt)*.5,un=Xt+(Math.random()*1-.5),va=Vt*.5;Ut.push({x1:Pt,y1:Io,x2:Pt+Math.cos(un)*va,y2:Io+Math.sin(un)*va,age:0,life:.25,width:1.5,jaggedScale:10})}}}function Te(I){if(!U||!C)return;U.clearRect(0,0,C.width,C.height);let k=performance.now();U.lineCap="round",U.lineJoin="round";for(let O=Ut.length-1;O>=0;O--){let A=Ut[O];if(A.age+=I,A.age>=A.life){Ut.splice(O,1);continue}let B=A.x1,ue=A.y1,fe=A.x2,Ee=A.y2;if(A.parentCoin){let He=ne(A.parentCoin,k),De=He.x+(A.parentCoin.size||r)/2,_e=He.y+(A.parentCoin.size||r)/2;B=De+A.relX1,ue=_e+A.relY1,A.relX2!==void 0&&(fe=De+A.relX2,Ee=_e+A.relY2)}let Le=1-A.age/A.life;U.strokeStyle=`rgba(200, 240, 255, ${Le})`,U.lineWidth=A.width||3,U.shadowColor="rgba(220, 245, 255, 0.9)",U.shadowBlur=20;let Ke=6;U.beginPath(),U.moveTo(B,ue);for(let He=1;He<=Ke;He++){let De=He/Ke,_e=B+(fe-B)*De,Oe=ue+(Ee-ue)*De;if(He===Ke)U.lineTo(fe,Ee);else{let Se=-(Ee-ue),je=fe-B,Ye=Math.sqrt(Se*Se+je*je),ot=A.jaggedScale||40;if(Ye>0){let Xe=(Math.random()-.5)*ot*(1-Math.abs(De-.5));U.lineTo(_e+Se/Ye*Xe,Oe+je/Ye*Xe)}else U.lineTo(_e,Oe)}}U.stroke(),U.shadowBlur=0}for(let O=In.length-1;O>=0;O--){let A=In[O];if(A.age+=I,A.age>=A.life){In.splice(O,1);continue}A.x+=A.vx*I,A.y+=A.vy*I;let B=1-A.age/A.life;U.fillStyle=A.color,U.globalAlpha=B,U.beginPath(),U.arc(A.x,A.y,A.size,0,Math.PI*2),U.fill(),U.globalAlpha=1}}return{start:w,stop:z,setRate:Z,clearBacklog:oe,clearPlayfield:he,setCoinSprite:le,getCoinTransform:We,findCoinsInRadius:dt,findCoinsInPath:cn,findCoinTargetsInRadius:be,findCoinTargetsInPath:Ge,ensureCoinVisual:nt,removeCoinTarget:Ht,detachCoin:K,recycleCoin:re,playEntranceWave:Un,setDependencies:_,hasBigCoins:()=>Fe(2)&&F.some(I=>I&&I.sizeIndex>=4)}}var ca,$i,q1,db,H1,pb,mb,V1,Y1,hb,W1,vb=$e(()=>{lc();To();uo();zn();$n();oh();Mo();ca=!1,$i=0n,q1=2500,db=new Map;try{gb(mt())}catch{ca=!1,$i=0n}try{Li(e=>{gb(e)})}catch{}H1="cubic-bezier(0.215, 0.61, 0.355, 1)";pb=[40,55,80,125,200,320,512],mb=.78,V1=[1,25,625,15625,390625,9765625,244140625],Y1=[0,.1,.01,.001,1e-4,1e-5,1e-6],hb=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],W1=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var _b={};vt(_b,{afterSlotWrite:()=>lh,beforeSlotWrite:()=>ah});function Eb(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function J1(e,t=j1){!e||e<=0||Vl.set(e,Eb()+t)}function Sb(e){if(!e||e<=0)return!1;let t=Vl.get(e);return t==null?!1:t<=Eb()?(Vl.delete(e),!1):!0}function Q1(){Vl.clear()}function gf(){try{return typeof localStorage<"u"}catch{return!1}}function sh(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function xb(e){let t=new Map;if(!gf())return Yl.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Yi))continue;let r=sh(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return Yl.set(e,t),t}function Lb(e){return!Number.isFinite(e)||e<=0?null:Yl.has(e)?Yl.get(e):xb(e)}function ah(e){if(!gf()||hf>0)return;let t=String(e);if(!t.startsWith(Yi))return;let n=sh(t);if(n==null)return;let o=Lb(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(hf===0){hf+=1;try{wn(n)}finally{hf-=1}}xb(n);return}}}catch{}}function lh(e,t){let n=String(e);if(!n.startsWith(Yi))return;let o=sh(n);if(o==null)return;let r=Lb(o)||new Map;r.set(n,String(t??"")),Yl.set(o,r)}function eL(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function tL(){let e=new Map;if(!gf())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Yi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=Uf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function nL(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function oL(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=Df(e);if(n.length===0){o&&(Sb(e)||wn(e),oc(e,null));return}let r=eL(n);o&&r!==o&&!Sb(e)&&wn(e),r!==o&&oc(e,r)}function fa(){if(!gf())return;let e=tL();nL(e).forEach(n=>{let o=e.get(n)??[];oL(n,o)})}function rL(){if(rh!=null)return;rh=(typeof window<"u"?window:globalThis).setTimeout(()=>{rh=null,fa()},Z1)}function iL(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){J1(o),rL();return}Vl.delete(o),fa()}}function sL(){typeof window>"u"||bb==null&&(bb=window.setInterval(fa,K1))}function aL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function ua(){let e=aL();if(!e)return;if(!Wi()){(e.dataset.poopShopApplied===ih||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==Ib||e.dataset.poopShopApplied!==ih)&&(e.style.backgroundImage=Ib,e.dataset.poopShopApplied=ih)}function lL(){typeof window>"u"||wb==null&&(ua(),wb=window.setInterval(ua,50),window.addEventListener("saveSlot:change",ua),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&ua()}catch{ua()}}))}function cL(){typeof window>"u"||(fa(),sL(),lL(),window.addEventListener("saveSlot:change",()=>fa()),window.addEventListener("saveIntegrity:storageMutation",iL,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(Q1(),fa(),ua())}))}var K1,j1,Z1,bb,rh,Vl,Yl,hf,Ib,ih,wb,ch=$e(()=>{St();K1=1e4,j1=750,Z1=50,bb=null,rh=null,Vl=new Map;Yl=new Map,hf=0;Ib="linear-gradient(180deg,#a9793d,#7b5534)",ih="1",wb=null;cL()});var Bb={};vt(Bb,{initPopups:()=>mL,teardownpopups:()=>hL});function uh(){return So||(So=document.createElement("div"),So.className="currency-popups",So.setAttribute("aria-live","polite"),So.setAttribute("aria-atomic","false"),document.body.appendChild(So),So)}function qi(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function fh(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function Mb(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):te(n);t&&(t.innerHTML=r)}function fL(e,t=Tb){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Wl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function dL(e,t,n){uh();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function dh(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(zt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(zt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Ne).includes(e)&&qn(e,o))return}let r=uL[e],i=Object.assign({duration:Tb,accumulate:!0},r||{},n);if(!i.icon)return;let s=qi(t);if(!s||fh(s))return;let l=i.accumulate!==!1?Wl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,Mb(l);return}let a=dL(e,i,s);a.meta=i,Mb(a),Wl.set(e,a);let u=uh(),f=Cb.indexOf(e),d=null;if(f>=0){let m=Array.from(u.children);for(let y of m){let p=y.dataset.type;if(Cb.indexOf(p)>f){d=y;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),fL(a,i.duration)}function pL(){let e={};for(let t of Object.values(Ne))e[t]=xa(t);return e}function kb(){try{let e=pL();Object.entries(e).forEach(([t,n])=>{let o=qi(n)||c.fromInt(0);Hr.set(t,o.clone?.()??o)}),Hr.has("mp")||Hr.set("mp",c.fromInt(0))}catch{Hr.clear()}}function Ab(){Wl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Wl.clear()}function Nb(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=qi(t.value)||c.fromInt(0),r=Hr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?qi(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&dh(n,s),Hr.set(n,o.clone?.()??o)}function Rb(e){let t=e?.detail;if(!t)return;let n=qi(t.xpAdded);n&&!fh(n)&&dh("xp",n)}function Ob(e){let t=e?.detail;if(!t)return;let n=qi(t.delta);n&&!fh(n)&&dh("mp",n);let o=qi(t.progress);o&&Hr.set("mp",o.clone?.()??o)}function Pb(){Ab(),kb()}function mL(){yf||(yf=!0,uh(),kb(),window.addEventListener("currency:change",Nb),window.addEventListener("xp:change",Rb),window.addEventListener("mutation:change",Ob),window.addEventListener("saveSlot:change",Pb))}function hL(){yf&&(window.removeEventListener("currency:change",Nb),window.removeEventListener("xp:change",Rb),window.removeEventListener("mutation:change",Ob),window.removeEventListener("saveSlot:change",Pb),Ab(),Hr.clear(),So&&So.remove(),So=null,yf=!1)}var Tb,Cb,uL,So,yf,Hr,Wl,Fb=$e(()=>{Et();Wt();St();Tb=6767,Cb=["coins","xp","books","gold","mp","magic","gears","dna"],uL={[Ne.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Ne.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Ne.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Ne.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Ne.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Ne.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},So=null,yf=!1,Hr=new Map,Wl=new Map});var Vb={};vt(Vb,{flushBackupSnapshot:()=>Xb,getSuspendMetadata:()=>NL,installSuspendSafeguards:()=>AL,markProgressDirty:()=>Fo,restoreFromBackupIfNeeded:()=>kL});function zl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function ga(){if(typeof localStorage>"u")return!1;try{let e=`${ro}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function qb(){if(!zl())throw new Error("IndexedDB unavailable");return da||(da=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(gL,yL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(ha)||r.createObjectStore(ha)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}da=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw da=null,e}),da)}function IL(){if(!ga())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(ro))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function wL(e){try{let t=await qb();return await new Promise((n,o)=>{let r=!1,i=t.transaction(ha,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(ha).put(e,$b);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function EL(){try{let e=await qb();return await new Promise((t,n)=>{let o=!1,r=e.transaction(ha,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(ha).get($b);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function xL(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function ph(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function LL(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function CL(e){return!(typeof e!="string"||e.length===0||_L.test(e))}function mh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(ro)||n.startsWith(vL)||n.startsWith(bL))return;let o=LL(n);if(o!=null)try{let r={key:n,slot:o,trusted:CL(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function ML(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=ph(),a=String(i),u=this===localStorage&&a.startsWith(ro);if(u)try{ah(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Fo("setItem");try{lh(a,s)}catch{}}this===localStorage&&a.startsWith(ro)&&mh(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=ph(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(ro)&&(Fo("removeItem"),mh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=ph(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Fo("clear"),mh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function Gb(e="idle"){ma=e||ma,Xr=!0,!pa&&(pa=setTimeout(()=>{if(pa=null,!Xr)return;let t=ma;Xr=!1,Xb(t)},SL))}function Hb(){pa&&(clearTimeout(pa),pa=null)}function Fo(e="dirty"){try{Gb(e)}catch{}}async function hh(e="manual"){if(!ga()||!zl())return!1;let t=IL();if(!t)return!1;t.reason=e,bf=!1;let n=await wL(t);return n||(Xr=!0,Gb("retry")),n}async function Xb(e="manual",{immediate:t=!1}={}){return!ga()||!zl()?!1:t?(Hb(),Xr=!1,bf=!0,hh(e)):(Xr=!0,ma=e||ma,hh(e))}function vf(e){!zl()||!ga()||(Hb(),Xr=!1,bf=!0,hh(e))}function TL(){if(!ga())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(ro))return!0}}catch{}return!1}async function kL(){if(Db||(Db=!0,!ga()||!zl()))return!1;let e=!1;try{if(!TL())e=!0;else{let o=localStorage.getItem(`${ro}saveSlot`);if(o){let r=`${ro}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await EL();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Fo("restored"),n}function AL(){if(Ub||(Ub=!0,typeof window>"u"))return;xL(),ML();let e=()=>{document.hidden?vf("visibility-hidden"):Fo("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>vf("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>vf("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>vf("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Fo("pageshow"))}catch{}try{window.addEventListener("focus",()=>Fo("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(ro)||Fo("storage-event"))})}catch{}Fo("boot")}function NL(){return{pendingImmediateFlush:bf,dirty:Xr,lastDirtyReason:ma}}var ro,gL,yL,ha,$b,vL,bL,SL,da,pa,Xr,ma,Ub,Db,bf,_L,Yb=$e(()=>{ch();ro="ccc:",gL="ccc:safety",yL=1,ha="snapshots",$b="latest",vL=`${ro}slotSig`,bL=`${ro}slotMod`,SL=1e3,da=null,pa=null,Xr=!1,ma="init",Ub=!1,Db=!1,bf=!1;_L=/\bat <anonymous>:\d+:\d+\b/});var Wb={};vt(Wb,{initGlobalOverlayEsc:()=>PL});function OL(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i,closeAll:s}of RL){let l=document.querySelectorAll(o);if(l.length>0){if(i){t=!0;continue}if(s)l.forEach(a=>{let u=a.querySelector(r||".shop-close");u&&(u.click(),n=!0)});else{let u=l[l.length-1].querySelector(r||".shop-close");u&&(u.click(),n=!0)}}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function PL(){window.addEventListener("keydown",OL,!0)}var RL,zb=$e(()=>{RL=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close",closeAll:!0}]});var Kb={};vt(Kb,{ensureGameDom:()=>BL});function BL(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var jb=$e(()=>{});var Zb={};vt(Zb,{SHOW_FPS:()=>FL,initFpsTracker:()=>UL});function UL(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var FL,Jb=$e(()=>{FL=!0});function qL(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function GL(){if(!Je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function pS(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=Je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function ya(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function mS(e,t,n,o=500){!e||e.__done||(e.__done=!0,e.__label&&(n?e.__label.textContent=n:e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(async()=>{if(typeof t=="function")try{t()}catch(i){console.error(i)}await ES(),e.style.opacity="0";let r=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",r,{once:!0}),setTimeout(r,450)},o))}async function bh(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function HL(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function XL(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>($n(),Zl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function VL(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function YL({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...HL(e,s),...XL(t,s),...n?VL(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function WL(e){if(Hi===e)return;ln&&(ln.stop(),ln=null),Hi=e;let t=document.querySelector(".menu-root");switch(e){case Uo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Hi===Uo.STARTER_COVE&&(ln=ht("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},300)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof _h=="function"&&_h(n,80),Gi){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(Gi.init("water-background",i),If){try{If()}catch{}If=null}if(wf){try{wf()}catch{}wf=null}typeof xh=="function"&&(If=xh(s=>Gi.update(s))),typeof Lh=="function"&&(wf=Lh((s,l)=>Gi.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,Gi&&requestAnimationFrame(()=>Gi.resize()),yS()),typeof Ih=="function")try{Ih()}catch{}if(typeof wh=="function")try{wh()}catch{}if(!en){en=hS({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=en;let i=()=>{if(!(!en||typeof en.setCoinSprite!="function"))try{en.setCoinSprite(IS?.())}catch{}};i(),wS?.(i);let s=gS({spawner:en});en&&typeof en.setDependencies=="function"&&en.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=vS(),u=bS(a);if(en&&u?.coinsPerSecondMult){let f=1*u.coinsPerSecondMult;if(typeof Eh=="function"){let d=Eh("spawnRate",f);try{d&&typeof d.toScientific=="function"?f=Number(d.toScientific(6)):f=Number(d)}catch{}}Number.isFinite(f)&&en.setRate(f)}}catch{}};if(l(),typeof vh=="function")try{vh()}catch{}vh=SS(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof Sh=="function")try{Sh()}catch{}setTimeout(()=>{Hi===Uo.STARTER_COVE&&en&&en.start()},300);break}case Uo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),en&&en.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Uo.MENU}}))}catch{}}var DL,Je,Qb,hS,gS,yS,eS,tS,nS,oS,rS,iS,sS,aS,vS,bS,Sh,SS,$L,lS,cS,uS,gh,yh,Ih,wh,IS,wS,Sf,Eh,fS,xh,Lh,dS,_h,Gi,If,wf,Uo,Hi,ln,en,vh,Ef,ES,uo=$e(()=>{$n();DL=!0,Je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();Je&&document.documentElement.classList.add("is-mobile");If=null,wf=null;GL();Uo={MENU:0,STARTER_COVE:1},Hi=Uo.MENU,ln=null,en=null,vh=null,Ef=()=>new Promise(e=>requestAnimationFrame(e)),ES=async()=>{await Ef(),await Ef()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(W=>{e=W}),n=pS("Loading assets...",e);await Ef();let{initAudio:o}=await Promise.resolve().then(()=>($n(),Zl));o();let r=Promise.all([Promise.resolve().then(()=>(Hf(),Yh)),Promise.resolve().then(()=>(vb(),yb)),Promise.resolve().then(()=>(Wa(),pv)),Promise.resolve().then(()=>(mu(),ev)),Promise.resolve().then(()=>(St(),Gh)),Promise.resolve().then(()=>(ch(),_b)),Promise.resolve().then(()=>(co(),M0)),Promise.resolve().then(()=>(lc(),zh)),Promise.resolve().then(()=>(Yn(),ug)),Promise.resolve().then(()=>(Mo(),o0)),Promise.resolve().then(()=>(To(),ib)),Promise.resolve().then(()=>(Fb(),Bb)),Promise.resolve().then(()=>(Yb(),Vb)),Promise.resolve().then(()=>(os(),yg)),Promise.resolve().then(()=>(zb(),Wb)),Promise.resolve().then(()=>(ts(),tb)),Promise.resolve().then(()=>(ti(),bg)),Promise.resolve().then(()=>(Xc(),fy)),Promise.resolve().then(()=>(hs(),ly)),Promise.resolve().then(()=>(ms(),Bg)),Promise.resolve().then(()=>(jb(),Kb)),Promise.resolve().then(()=>(zn(),ey)),Promise.resolve().then(()=>(oh(),fb)),Promise.resolve().then(()=>(ai(),_g)),Promise.resolve().then(()=>(Jb(),Zb))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(W,re)=>`img/mutations/m${re+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/gold_val_dna.webp","img/sc_upg_icons/magic_val_dna.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_dna.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=YL(i,W=>{s=W,ya(n,W)}),[a,u,f,d,m,y,p,h,g,v,E,L,M,N,q,P,G,C,U,T,_,V,J,se,de]=await r;({initSlots:Qb}=a),{createSpawner:hS}=u,{initCoinPickup:gS}=f,{initHudButtons:yS}=d,{bank:oS,getHasOpenedSaveSlot:rS,setHasOpenedSaveSlot:iS,ensureStorageDefaults:sS,notifyGameSessionStarted:dS,ensureMultiplierDefaults:aS}=m,{getCurrentAreaKey:vS,computeUpgradeEffects:bS,onUpgradesChanged:SS}=p,{registerPreloadedAudio:$L}=h,{initXpSystem:Sh}=g,{initResetSystem:Ih}=v,{initMutationSystem:wh,getMutationCoinSprite:IS,onMutationChange:wS}=E,{initPopups:lS}=L,{installSuspendSafeguards:cS,restoreFromBackupIfNeeded:uS,markProgressDirty:gh,flushBackupSnapshot:yh}=M,{installGhostTapGuard:eS,initGlobalGhostTap:tS}=N,{initGlobalOverlayEsc:nS}=q,{setDebugPanelAccess:Sf,applyStatMultiplierOverride:Eh}=P,{startGameLoop:fS,registerTick:xh,registerFrame:Lh}=G;let{initOfflineTracker:ye,processOfflineProgress:Re}=C,{initWorkshopSystem:Ce}=U,{initAutomationEffects:F}=T;({ensureGameDom:_h}=_);let{initSurgeEffects:Y}=V;({waterSystem:Gi}=J);let{initLabLogic:$}=se,{initFpsTracker:H}=de;window.bank=oS,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(ln){try{ln.stop()}catch{}ln=null}}),window.addEventListener("audio:restartMusic",()=>{if(ln){try{ln.stop()}catch{}ln=null}Hi===Uo.STARTER_COVE&&(ln=ht("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",W=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return W.preventDefault(),W.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let W=document.hidden;Lf(W),ln&&ln.element&&(W?ln.element.pause():ln.element.play().catch(()=>{}))}),eS?.(),tS?.(),nS?.(),cS?.(),typeof Sf=="function"&&(Sf(DL),window.setDebugPanelAccess=Sf);try{await uS?.()}catch{}await Promise.race([l,t]),await ES(),document.documentElement.classList.remove("booting"),await Ef(),mS(n),await Promise.all([bh("img/currencies/coin/coin_plus_base.webp"),bh("img/stats/xp/xp_plus_base.webp"),bh("img/stats/mp/mp_plus_base.webp")]);try{typeof m.clearActiveSlot=="function"?m.clearActiveSlot():m&&m.KEYS&&m.KEYS.SAVE_SLOT&&localStorage.removeItem(m.KEYS.SAVE_SLOT)}catch{}fS(),ye(()=>Hi===Uo.STARTER_COVE);try{Ce()}catch(W){console.error("Workshop init failed",W)}try{F()}catch(W){console.error("Automation init failed",W)}try{Y()}catch(W){console.error("Surge effects init failed",W)}try{$()}catch(W){console.error("Lab system init failed",W)}try{H()}catch(W){console.error("FPS tracker init failed",W)}qL(),sS(),gh?.("ensure-defaults"),lS();let j=document.getElementById("panel-title");if(rS()?(document.body.classList.add("has-opened"),j&&(j.style.opacity="0")):j&&(j.style.opacity="1"),Qb(async()=>{if(Hi===Uo.STARTER_COVE)return;iS(!0),document.body.classList.add("has-opened"),j&&(j.style.opacity="0");let W=pS("Loading game..."),re=()=>new Promise(x=>setTimeout(x,120));ya(W,.2),await re(),aS(),ya(W,.4),await re(),Re(),ya(W,.65),await re(),dS?.(),ya(W,.9),await re(),gh?.("slot-entered"),ya(W,1),mS(W,()=>{WL(Uo.STARTER_COVE),setTimeout(()=>{window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave()},300)},"Finished loading game",200)}),typeof window<"u"&&yh)try{window.cccRequestBackup=()=>yh("manual",{immediate:!0})}catch{}})});uo();})();
