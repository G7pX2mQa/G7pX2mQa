(()=>{var _b=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var vt=(e,t)=>{for(var n in t)_b(e,n,{get:t[n],enumerable:!0})};var kl={};vt(kl,{initAudio:()=>Cb,loadAudio:()=>Zm,playAudio:()=>dt,registerPreloadedBuffer:()=>kb,setAudioSuspended:()=>tf,setMusicUnderwater:()=>Ur});function ef(){if(Yt)return Yt;let e=window.AudioContext||window.webkitAudioContext;return e?(Yt=new e,ea=Yt.createGain(),ea.connect(Yt.destination),ea.gain.value=1,Cl=Yt.createGain(),Cl.gain.value=1,Cl.connect(ea),yo=Yt.createBiquadFilter(),yo.type="lowpass",yo.frequency.value=22050,yo.Q.value=1,yo.connect(Cl),Yt):null}function Cb(){ef()}function Mb(){Yt&&Yt.state==="suspended"&&Yt.resume().catch(()=>{})}async function Zm(e){let t=ef();if(!t)return null;let n=new URL(e,document.baseURI).href;if(ta.has(n))return ta.get(n);if(Ml.has(n))return Ml.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return ta.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{Ml.delete(n)}})();return Ml.set(n,o),o}function dt(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=ef(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=ta.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let d=s.createGain();return d.gain.value=t,u.connect(d),i==="music"?d.connect(yo):d.connect(ea),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:d,element:null}}else Zm(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function kb(e,t){let n=new URL(e,document.baseURI).href;ta.set(n,t)}function tf(e){Yt&&(e?Yt.state==="running"&&Yt.suspend().catch(()=>{}):Yt.state==="suspended"&&Yt.resume().catch(()=>{}))}function Ur(e){if(!yo)return;let t=e?600:22050;try{let n=Yt.currentTime;yo.frequency.cancelScheduledValues(n),yo.frequency.setValueAtTime(t,n)}catch{yo.frequency.value=t}}var Yt,ea,Cl,yo,ta,Ml,Pn=De(()=>{Yt=null,ea=null,Cl=null,yo=null,ta=new Map,Ml=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,Mb,{capture:!0,passive:!0})})});var c,Ct=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",d=i+s;d.startsWith("-")?(u="-",d=d.slice(1)):d.startsWith("+")&&(d=d.slice(1));let f=d.replace(/^0+/,"")||"0",p=BigInt(u+f);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let f=i.slice(u+1)||"0";try{a=BigInt(f)}catch{a=0n}}let d=Number(l);return Number.isFinite(d)||(d=e.MAX_E),new e(BigInt(r),{base:d,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,d=Number(u),f=l;return Number.isSafeInteger(d)||(f+=u,d=0),new e(i,{base:d,offset:f},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let d=Math.min(n,18);o=u.toFixed(d).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}}});function eh(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return Qm.format(t)}catch{return String(e)}}function na(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function nf(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+eh(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+Qm.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,d=of.get(u)||"",p=o-u+1,g=4-p,m=p+g;n.length<m+1&&(n+="0".repeat(m+1-n.length));let y=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(y=na(y));let b,E;return y.length>m?(b=y.slice(0,p+1),E="0".repeat(g)):(b=y.slice(0,p),E=y.slice(p)),t+`${b}${g?"."+E:""}${d}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=na(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+nf(String(o))}function Ab(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+nf(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let d=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(d=na(d)),l){let R=d.slice(0,1)+"."+d.slice(1),T=i==="-"?"-":"";return t+R+"e"+nf(s,T)}let p=Math.floor(a/3)*3,g=of.get(p)||"",y=a-p+1,h=4-y,b,E;return d.length>4?(b=d.slice(0,y+1),E="0".repeat(h)):(b=d.slice(0,y),E=d.slice(y)),t+(i==="-"?"-":"")+b+(h?"."+E:"")+g}function Jm(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=na(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+Ab(l)}function J(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Jm(e.toScientific(3));if(t<6)return eh(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=of.get(n);if(!o)return Jm(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=na(u));let f,p;return u.length>l?(f=u.slice(0,i+1),p="0".repeat(s)):(f=u.slice(0,i),p=u.slice(i)),`${f}${s?"."+p:""}${o}`}var Tb,of,Qm,zt=De(()=>{Ct();Tb=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],of=new Map(Tb),Qm=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var fh={};vt(fh,{CURRENCIES:()=>Me,KEYS:()=>gt,STORAGE_PREFIX:()=>Ri,bank:()=>O,clearActiveSlot:()=>Hb,clearAllStorage:()=>Wb,ensureCurrencyDefaults:()=>gf,ensureMultiplierDefaults:()=>yf,ensureStorageDefaults:()=>Vb,getActiveSlot:()=>v,getCurrency:()=>ia,getCurrencyMultiplierBN:()=>uh,getHasOpenedSaveSlot:()=>Yb,getLastSaveTime:()=>df,getLastSaveTimeKey:()=>Ol,getSlotModifiedFlagKey:()=>Xb,getSlotSignature:()=>hf,getSlotSignatureKey:()=>mf,hasModifiedSave:()=>Oi,isCurrencyLocked:()=>Bn,isStorageKeyLocked:()=>an,markSaveSlotModified:()=>yn,notifyGameSessionStarted:()=>qb,onCurrencyChange:()=>Rl,peekCurrency:()=>sa,primeStorageWatcherSnapshot:()=>rt,setActiveSlot:()=>pf,setCurrency:()=>Ai,setCurrencyMultiplierBN:()=>Fl,setHasOpenedSaveSlot:()=>Bl,setSlotSignature:()=>Pl,updateLastSaveTime:()=>lh,watchStorageKey:()=>_t});function af(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function lf(e){let t=af(e);return t==null?null:`${Nb}:${t}`}function cf(e){let t=af(e);return t==null?null:`${Rb}:${t}`}function ih(e={}){Tl.size!==0&&Tl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Rl(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Tl.add(o),()=>{Tl.delete(o)}}function Pb(){if(oa!=null||Ao.size===0)return;oa=(typeof window<"u"?window:globalThis).setInterval(Fb,Ob)}function sh(){if(Ao.size!==0||oa==null)return;(typeof window<"u"?window:globalThis).clearInterval(oa),oa=null}function ah(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function Bb(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function Fb(){if(Ao.size===0){sh();return}Ao.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=ah(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!Bb(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function _t(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Ao.get(e);return s||(s=new Set,Ao.set(e,s)),s.add(i),Pb(),()=>{let l=Ao.get(e);l&&(l.delete(i),l.size===0&&(Ao.delete(e),sh()))}}function rt(e,t){if(!e)return;let n=Ao.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=ah(r,o),r.initialized=!0)})}function uf(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function Ub(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function Db(){rf.forEach(e=>{try{e?.()}catch{}}),rf.clear()}function nh(e){if(e!==th&&(Db(),th=e??null,e!=null))for(let t of Object.values(Me)){let n=`${gt.CURRENCY[t]}:${e}`,o=_t(n,{parse:Ub,equals:uf,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};ih(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});rf.set(n,o)}}function $b(){typeof window>"u"||(nh(v()),window.addEventListener("saveSlot:change",()=>{nh(v())}))}function qb(){ff=!0}function Ol(e=v()){return e==null?null:`${sr}lastSaveTime:${e}`}function lh(){if(!ff||document.hidden)return;let e=v();if(e==null)return;let t=Date.now();try{localStorage.setItem(Ol(e),String(t))}catch{}}function df(){let e=v();if(e==null)return 0;try{let t=localStorage.getItem(Ol(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function Gb(){typeof window>"u"||(oh||(oh=setInterval(lh,1e3)),window.addEventListener("beforeunload",()=>{if(!ff)return;let e=v();if(e!=null)try{localStorage.setItem(Ol(e),String(Date.now()))}catch{}}))}function v(){if(rr!==void 0)return rr;let e=localStorage.getItem(gt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return rr=n,n}function pf(e){let t=Math.max(1,parseInt(e,10)||1);rr=t,localStorage.setItem(gt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function Hb(){rr=null,localStorage.removeItem(gt.SAVE_SLOT)}function ra(e,t=v()){return t==null?null:`${e}:${t}`}function ch(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function an(e){return ch(e)}function mf(e=v()){return lf(e)}function Xb(e=v()){return cf(e)}function hf(e=v()){if(typeof localStorage>"u")return null;let t=lf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function Pl(e,t){if(typeof localStorage>"u")return;let n=lf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function Oi(e=v()){if(typeof localStorage>"u")return!1;let t=cf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function yn(e=v()){if(typeof localStorage>"u")return;let t=af(e);if(t==null||Oi(t))return;let n=cf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function Yb(){return localStorage.getItem(gt.HAS_OPENED_SAVE_SLOT)==="true"}function Bl(e){localStorage.setItem(gt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function Vb(){localStorage.getItem(gt.HAS_OPENED_SAVE_SLOT)===null&&Bl(!1)}function gf(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${gt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function yf(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${gt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Nl(t);else{let o=ir(c.fromInt(1));Ni(t,o)}}}function ia(e){let t=ra(gt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Ai(e,t,{delta:n=null,previous:o=null}={}){let r=v(),i=ra(gt.CURRENCY[e],r),s=o??ia(e),l=c.fromInt(0);if(!i||Bn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let d=null;try{d=localStorage.getItem(i)}catch{}let f=d??u,p=a;try{d!=null&&(p=c.fromAny(d),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}rt(i,f);let g=!uf(s,p),y=(b=>{if(b==null)return null;try{let E=b instanceof c?b.clone?.()??b:c.fromAny(b);if(typeof E.cmp=="function")return E.cmp(l)>0?E:null;if(!E.isZero?.())return E}catch{}return null})(n),h=null;if(g)try{h=p.sub?.(s)}catch{}if((!h||h.isZero?.()||typeof h.cmp=="function"&&h.cmp(l)<=0)&&(h=y),g||h){let b={key:e,value:p,slot:r,delta:h??void 0};ih(b);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:b}))}catch{}}return p}function ir(e){return e.mulScaledIntFloor(1n,-sf)}function Al(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,sf)}function Nl(e){let t=ra(gt.MULTIPLIER[e]);if(!t)return ir(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Dr)){let r=ir(c.fromInt(1));return Ni(e,r),r}let o=n.slice(Dr.length);try{return c.fromAny(o)}catch{let r=ir(c.fromInt(1));return Ni(e,r),r}}function Ni(e,t,n=v()){let o=ra(gt.MULTIPLIER[e],n);if(!o||Bn(e,n))return;let r=ir(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Dr))try{r=c.fromAny(i.slice(Dr.length))}catch{}let s=c.fromAny(t),l=Dr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,d=s;try{let f=u?.startsWith?.(Dr)?u.slice(Dr.length):null;f!=null&&(d=c.fromAny(f))}catch{}try{rt(o,u)}catch{}if(!uf(r,d))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:Al(d),slot:n}}))}catch{}}function uh(e){return Al(Nl(e))}function Bn(e,t=v()){let n=ra(gt.CURRENCY[e],t);return ch(n)}function Fl(e,t){let n=c.fromAny(t),o=ir(n);return Ni(e,o,v()),n}function sa(e,t){let n=localStorage.getItem(`${gt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Wb(){Object.values(gt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function rh(e){let t=n=>{try{let o=c.fromAny(n);return typeof J=="function"?J(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return ia(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Ai(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Ai(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Ai(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof J=="function"?J(r):r.toString()},t.mult={get(){return uh(e)},set(n){return Fl(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Nl(e).mulBigNumInteger(o);return r.isZero()&&(r=ir(c.fromInt(1))),Ni(e,r),Al(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),sf)}catch{o={numer:1n,scale:0}}let r=Nl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=ir(c.fromInt(1))),Ni(e,r);let i=Al(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var sr,Ri,Nb,Rb,sf,Dr,Ob,Ao,oa,Tl,rf,th,oh,ff,gt,Me,rr,O,bt=De(()=>{Ct();zt();sr="ccc:",Ri=sr,Nb=`${sr}slotSig`,Rb=`${sr}slotMod`,sf=18,Dr="XM:",Ob=140,Ao=new Map,oa=null,Tl=new Set;rf=new Map,th=null;oh=null,ff=!1;Gb();gt={HAS_OPENED_SAVE_SLOT:`${sr}hasOpenedSaveSlot`,SAVE_SLOT:`${sr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Me={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===gt.SAVE_SLOT){if(e.newValue===null)rr=null;else{let t=parseInt(e.newValue,10);rr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:rr}}))}catch{}}});for(let e of Object.values(Me))gt.CURRENCY[e]=`${sr}${e}`,gt.MULTIPLIER[e]=`${sr}mult:${e}`;$b();O=new Proxy({},{get(e,t){if(Object.values(Me).includes(t))return rh(t);if(typeof t=="string"&&Me[t.toUpperCase?.()])return rh(Me[t.toUpperCase()])}});if(typeof window<"u"){window.bank=O;for(let e of Object.values(Me))window[e]=O[e]}});function ph(){return vo}function Ul(e){vo=!!e,document.body.classList.toggle("slots-delete-mode",vo);let t=document.getElementById("manage-saves");t&&(t.textContent=vo?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",vo),n.setAttribute("aria-pressed",vo?"true":"false")})}function zb(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function Kb(){if(dh)return;dh=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),Ul(!vo)}),window.addEventListener("keydown",r=>{vo&&r.key==="Escape"&&Ul(!1)});let n=r=>{!vo||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!vo)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(zb(s),v()===s)try{localStorage.removeItem(gt.SAVE_SLOT)}catch{}vf(),Ul(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),Ul(!1)}var vo,dh,mh=De(()=>{bt();bf();vo=!1,dh=!1;document.addEventListener("DOMContentLoaded",()=>{try{Kb()}catch{}})});var hh={};vt(hh,{initSlots:()=>Jb,refreshSlotsView:()=>vf});function jb(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function Zb(e){if(!jb(e))return"No Save Data";try{let t=sa(e,"coins");return J(t)}catch{return"0"}}function Sf(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=Zb(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function Jb(e){let t=document.querySelectorAll(".slot-card");Sf(),t.forEach((n,o)=>{let r=o+1,i=s=>{pf(r),gf(),yf(),Bl(!0),typeof e=="function"&&e(r,s),Sf()};n.addEventListener("click",s=>{ph()||(s.preventDefault(),i(s))})})}function vf(){Sf()}var bf=De(()=>{Ct();zt();mh();bt()});var yh={};vt(yh,{registerPreloadedAudio:()=>Qb,takePreloadedAudio:()=>eS});function Qb(e,t){let n=gh(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}Dl.set(n,t)}}function eS(e){let t=gh(e);if(!Dl.has(t))return null;let n=Dl.get(t);return Dl.delete(t),n}var Dl,gh,$l=De(()=>{Dl=new Map,gh=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Pi(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var If=De(()=>{});var Rh={};vt(Rh,{addExternalCoinMultiplierProvider:()=>Ro,addExternalXpGainMultiplierProvider:()=>ur,addXp:()=>qi,broadcastXpChange:()=>Vl,computeCoinMultiplierForXpLevel:()=>Nf,getXpGainMultiplier:()=>zl,getXpLevelStorageKey:()=>tS,getXpRequirementForXpLevel:()=>Wl,getXpState:()=>Qe,initXpSystem:()=>Di,isXpSystemUnlocked:()=>cn,onXpChange:()=>Xl,refreshCoinMultiplierFromXpLevel:()=>jt,resetXpProgress:()=>$i,setExternalBookRewardProvider:()=>Kl,setExternalCoinMultiplierProvider:()=>Ah,setExternalXpGainMultiplierProvider:()=>Nh,unlockXpSystem:()=>Hr});function tS(e=v()){let t=e??v();return t==null?null:$r(t)}function rS(e){if(e===0n)return 0;let t=e.toString(),n=t.length,o=Math.min(n,15),r=Number(t.slice(0,o)),i=n-o;if(!Number.isFinite(r))return Number.POSITIVE_INFINITY;let s=r*Math.pow(10,i);return Number.isFinite(s)?s:Number.POSITIVE_INFINITY}function ln(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function ql(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function Lh(e){if(!e||typeof e!="object")return 0;if(ln(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function iS(e){return!e||typeof e!="object"?0:ln(e)||typeof e.cmp=="function"&&e.cmp(xh)>=0?Number.POSITIVE_INFINITY:Lh(e)}function bh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(oS,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(da())??c.fromInt(0):n}function sS(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(Eh,18)}function aS(e){if(ln(e)||typeof e.cmp=="function"&&e.cmp(xh)>=0)return pt.clone?.()??pt;let t=e.floorToInteger(),n=e.sub(t),o=Lh(n);if(!Number.isFinite(o))return pt.clone?.()??pt;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return pt.clone?.()??pt;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function _h(e){if(!e||typeof e!="object")return pt.clone?.()??pt;let n=sS(e),o=aS(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return pt.clone?.()??pt;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function Ch(){let e=ln(H.xpLevel),t=ln(H.progress);if(!e&&!t)return!1;let n=pt.clone?.()??pt;if(H.xpLevel=n.clone?.()??n,H.progress=n.clone?.()??n,It=n.clone?.()??n,O?.books)try{typeof O.books.set=="function"?O.books.set(n.clone?.()??n):typeof O.books.add=="function"&&O.books.add(n.clone?.()??n)}catch{}return!0}function ca(e={}){fa.size!==0&&fa.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Xl(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return fa.add(n),()=>{fa.delete(n)}}function Ot(){return c.fromInt(0)}function da(){return c.fromInt(1)}function Bi(e){if(!e)return Ot();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ot()}}function Gl(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function lS(){for(;kf.length>0;){let e=kf.pop();try{e?.()}catch{}}}function Ih(e){if(e==null)return Ot();try{return c.fromAny(e)}catch{return Ot()}}function xf(e){if(!Ef){Ef=!0;try{let t=Tf??v(),n={unlocked:H.unlocked,xpLevel:Bi(H.xpLevel),progress:Bi(H.progress),requirement:Bi(It)};Kt(!0),eo(),bn(!0);let o={unlocked:H.unlocked,xpLevel:Bi(H.xpLevel),progress:Bi(H.progress),requirement:Bi(It)},r=n.unlocked!==o.unlocked,i=!Gl(n.xpLevel,o.xpLevel),s=!Gl(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ot();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ot()}catch{l=Ot()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||fa.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(ca(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{Ef=!1}}}function Lf(e){if(e===Tf||(lS(),Tf=e??null,e==null))return;let t=(n,o)=>{let r=_t(n,o);typeof r=="function"&&kf.push(r)};t(aa(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>xf("unlock")}),t($r(e),{parse:Ih,equals:Gl,onChange:()=>xf("xpLevel")}),t(Ui(e),{parse:Ih,equals:Gl,onChange:()=>xf("progress")})}function Mh(){if(Sh){Lf(v());return}Sh=!0,Lf(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Lf(v()),Kt(!0),eo(),bn(!0)})}function _f(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function pa(e){if(!e||typeof e!="object")return Number.NEGATIVE_INFINITY;if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return Number.POSITIVE_INFINITY;if(e.isZero?.()||typeof e.isZero=="function"&&e.isZero())return Number.NEGATIVE_INFINITY;let t=e.sig,n=typeof e.e=="number"?e.e:Number(e.e??0),o=typeof e._eOffset=="bigint"?rS(e._eOffset):Number(e._eOffset??0);if(!Number.isFinite(n))return n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(!Number.isFinite(o))return o>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let r=n+o;if(!Number.isFinite(r))return r>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let i=0;if(typeof t=="bigint"){let l=t.toString().replace(/^0+/,"");if(!l)return Number.NEGATIVE_INFINITY;let a=l.length,u=Math.min(a,15),d=l.slice(0,u),f=Number.parseFloat(d);Number.isFinite(f)&&f>0?i=Math.log10(f)+(a-u):i=a-1}else try{let s=typeof e.toScientific=="function"?e.toScientific(12):String(e);if(!s||s==="0")return Number.NEGATIVE_INFINITY;if(s==="Infinity")return Number.POSITIVE_INFINITY;let l=s.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(l){let a=parseFloat(l[1]),u=parseInt(l[2],10)||0;if(!(a>0)||!Number.isFinite(a))return Number.NEGATIVE_INFINITY;i=Math.log10(a)+u}else{let a=Number(s);if(!Number.isFinite(a)||a<=0)return Number.NEGATIVE_INFINITY;i=Math.log10(a)}}catch{return Number.NEGATIVE_INFINITY}return r+i}function cS(e){let t=e<vh?e:vh;if(t<=Fi)return;let n=Fi,o=ar.get(n.toString());for(o||(o=c.fromInt(10),ar.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),ar.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Fi=n;return}}Fi=n}function uS(e){if(!Number.isFinite(e)||e>=c.MAX_E)return pt.clone?.()??pt;let t=Math.floor(e),n=e-t;Number.isFinite(n)||(n=0);let o=Math.pow(10,n);(!Number.isFinite(o)||o<=0)&&(o=1),o>=10&&(o/=10,t+=1);let r;try{r=Number.isFinite(t)?t.toLocaleString("en",{useGrouping:!1}):String(t)}catch{r=String(t)}let i=`${o.toPrecision(18)}e${r}`;try{return c.fromScientific(i).floorToInteger()}catch{return pt.clone?.()??pt}}function fS(e){let t=Fi>0n?Fi:0n,n=ar.get(t.toString());if(!n||ln(n))return pt.clone?.()??pt;let o=c.fromAny(t.toString()),r=pa(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);ql(s)||(i=i.add?.(s.mulDecimal(Eh,18))??i);let l=bh(e),a=bh(o),u=l.sub?.(a)??c.fromInt(0);ql(u)||(i=i.add?.(u.mulDecimal(nS,18))??i);let d=iS(i);return Number.isFinite(d)?uS(d):pt.clone?.()??pt}function dS(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=ln(t),o=ln(e);if(n)return o?1:0;if(ql(t)||ql(e))return 0;let s=pa(e),l=pa(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function kh(){return vn.container&&vn.container.isConnected?!0:(vn.container=document.querySelector(".xp-counter[data-xp-hud]"),vn.container?(vn.bar=vn.container.querySelector(".xp-bar"),vn.fill=vn.container.querySelector(".xp-bar__fill"),vn.xpLevelValue=vn.container.querySelector(".xp-level-value"),vn.progress=vn.container.querySelector("[data-xp-progress]"),!0):!1)}function Th(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=ar.get("0");return a.clone?.()??a}if(r.bigInt!=null){cS(i);let a=i.toString(),u=ar.get(a);if(u)return u.clone?.()??u}let s=fS(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?pt.clone?.()??pt:(r.bigInt!=null&&ar.set(r.bigInt.toString(),s),s.clone?.()??s)}function No(){It=Th(H.xpLevel)}function Hl(){H.xpLevel=Ot(),H.progress=Ot(),No(),bn(!0)}function wh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function Yl(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function bn(e=!1){let t=O?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=Yl(H.xpLevel),o=n.bigInt,r=!n.finite,i=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null;if(!e&&(r&&Un||!r&&o!=null&&!Un&&!Dn&&Fn!=null&&o===Fn||!r&&o==null&&Dn&&i&&$n&&i===$n))return;if(r){try{t.set(pt)}catch{}Fn=null,Un=!0,Dn=!1,$n=null;return}let s;if(o!=null&&o<=Mf){let d=c.fromInt(1),f=Number(o);for(let g=0;g<f;g+=1)d=d.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(f)}typeof d.add=="function"?d=d.add(p):typeof p.add=="function"&&(d=p.add(d)),s=d.clone?.()??d}else s=_h(H.xpLevel);let l=s.clone?.()??s,a=lr.size>0?Array.from(lr):typeof qr=="function"?[qr]:[];for(let d of a)if(typeof d=="function")try{let f=d({baseMultiplier:l.clone?.()??l,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});f instanceof c?l=f.clone?.()??f:f!=null&&(l=c.fromAny(f))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Fn=null,Un=!0,Dn=!1,$n=null):o!=null&&o<=Mf?(Fn=o,Un=!1,Dn=!1,$n=null):(Fn=null,Un=!1,Dn=!0,$n=i)}function Kt(e=!1){let t=v();if(t==null)return la=null,wf=!1,H.unlocked=!1,Hl(),H;if(!e&&wf&&t===la)return H;la=t,wf=!0;try{let n=localStorage.getItem(aa(t));H.unlocked=n==="1"}catch{H.unlocked=!1}try{H.xpLevel=c.fromAny(localStorage.getItem($r(t))??"0")}catch{H.xpLevel=Ot()}try{H.progress=c.fromAny(localStorage.getItem(Ui(t))??"0")}catch{H.progress=Ot()}return(ln(H.xpLevel)||ln(H.progress))&&(H.unlocked=!0),H.unlocked?(Ch(),No(),bn(!0),Mh(),H):(Hl(),H)}function ua(){let e=v();if(e==null)return;let t={unlocked:H.unlocked?"1":"0",level:H.xpLevel.toStorage(),progress:H.progress.toStorage()};try{localStorage.setItem(aa(e),t.unlocked)}catch{}try{localStorage.setItem($r(e),t.level)}catch{}try{localStorage.setItem(Ui(e),t.progress)}catch{}let n=(()=>{let r=H.unlocked,i=H.xpLevel,s=H.progress;try{r=localStorage.getItem(aa(e))==="1"}catch{}try{let l=localStorage.getItem($r(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(Ui(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();rt(aa(e),n.unlocked?"1":"0"),rt($r(e),n.level?.toStorage?.()??t.level),rt(Ui(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==H.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(H.unlocked=n.unlocked,H.xpLevel=n.level,H.progress=n.progress,No(),bn(!0),eo())}function pS(){bn(!0);let e=da();if(typeof Cf=="function")try{let n=Cf({baseReward:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{O?.books?.addWithMultiplier?O.books.addWithMultiplier(e):O?.books?.add&&O.books.add(e)}catch{}let t=Yl(H.xpLevel);t.finite?t.bigInt!=null?(Fn=t.bigInt,Un=!1,Dn=!1,$n=null):(Fn=null,Un=!1,Dn=!0,$n=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Fn=null,Un=!0,Dn=!1,$n=null)}function eo(){if(!kh())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=vn;if(!e)return;if(!H.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=J(It);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=_f(J(It));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Pi();return}e.removeAttribute("hidden");let i=It,s=dS(H.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=J(H.xpLevel)),r){let a=J(H.progress),u=J(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=_f(J(H.progress)),u=_f(J(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Pi()}function Di({forceReload:e=!1}={}){return kh(),Kt(e),No(),eo(),Mh(),Qe()}function Hr(){if(Kt(),H.unlocked)return eo(),!1;Hl(),H.unlocked=!0,ua(),eo(),bn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Qe()}))}catch{}return!0}function $i({keepUnlock:e=!0}={}){Kt();let t=H.unlocked;return Hl(),H.unlocked=e?t||H.unlocked:!1,ua(),eo(),bn(!0),Qe()}function qi(e,{silent:t=!1}={}){Kt();let n=la??v();if(n!=null&&wh(Ui(n)))return{unlocked:H.unlocked,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,progress:H.progress,requirement:It,slot:n};if(!H.unlocked)return{unlocked:!1,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,requirement:It};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ot()}if(!o.isZero?.()){let f=cr.size>0?Array.from(cr):typeof Gr=="function"?[Gr]:[];for(let p of f)if(typeof p=="function")try{let g=p({baseGain:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});g instanceof c?o=g.clone?.()??g:g!=null&&(o=c.fromAny(g))}catch{}}if(o=Gn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return eo(),{unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,requirement:It};H.progress=H.progress.add(o),No();let r=n!=null&&wh($r(n)),i=ln(H.progress),s=ln(H.xpLevel),l=ln(o);if(i||s||l){let f=pt.clone?.()??pt;r||(H.xpLevel=f.clone?.()??f),H.progress=f.clone?.()??f,No(),Ch(),ua(),eo(),bn(!0);let p={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:It.clone?.()??It,slot:n};if(ca(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Ot();if(H.progress.cmp(It)<0){ua(),eo();let f={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,progress:H.progress,requirement:It,slot:n};if(ca(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}if(!r){let f=pa(H.progress),p=.08118668602542883,g=pa(It);if(f-g>2){let h=H.xpLevel,b=f-g,E=Math.floor(b/p);if(E>500){let L=BigInt(Math.max(0,E-5));if(L>0n){let R=c.fromAny(L.toString());if(H.xpLevel=H.xpLevel.add(R),a=a.add(R),No(),O?.books?.add)try{let T=R.clone();O.books.add(T)}catch{}}}}let m=0,y=500;for(;H.progress.cmp?.(It)>=0&&m<y&&(H.progress=H.progress.sub(It),H.xpLevel=H.xpLevel.add(da()),a=a.add(da()),pS(),No(),!ln(It));)m+=1;m>=y&&H.progress.cmp(It)>=0&&No()}ua(),eo();let u=Yl(H.xpLevel);u.finite?u.bigInt!=null?(Fn=u.bigInt,Un=!1,Dn=!1,$n=null):(Fn=null,Un=!1,Dn=!0,$n=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Fn=null,Un=!0,Dn=!1,$n=null);let d={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:It.clone?.()??It,slot:n};if(ca(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}function Qe(){return Kt(),{unlocked:H.unlocked,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:It.clone?.()??It}}function Vl(e={}){Kt();let t=la??v(),n={...Qe(),slot:t,...e};if(ca(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function cn(){return Kt(),!!H.unlocked}function Wl(e){return Th(e)}function zl(){Kt();let e=da(),t=cr.size>0?Array.from(cr):typeof Gr=="function"?[Gr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function Nf(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=Yl(t),o=n.bigInt;if(!n.finite)return pt.clone?.()??pt;let i;if(o!=null&&o<=Mf){let a=c.fromInt(1),u=Number(o);for(let f=0;f<u;f+=1)a=a.mulDecimal("1.1",18);let d;try{d=c.fromAny(o.toString())}catch{d=c.fromInt(u)}typeof a.add=="function"?a=a.add(d):typeof d.add=="function"&&(a=d.add(a)),i=a.clone?.()??a}else i=_h(t);let s=i.clone?.()??i,l=lr.size>0?Array.from(lr):typeof qr=="function"?[qr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!H.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function Ah(e){qr=typeof e=="function"?e:null,lr.clear(),qr&&lr.add(qr),Kt(),bn(!0)}function jt(){Kt(),bn(!0)}function Nh(e){Gr=typeof e=="function"?e:null,cr.clear(),Gr&&cr.add(Gr)}function Ro(e){return typeof e!="function"?()=>{}:(lr.add(e),Kt(),bn(!0),()=>{lr.delete(e),Kt(),bn(!0)})}function ur(e){return typeof e!="function"?()=>{}:(cr.add(e),Kt(),()=>{cr.delete(e)})}function Kl(e){Cf=typeof e=="function"?e:null}var Af,aa,$r,Ui,la,wf,It,ar,Fi,pt,Fn,Un,Dn,$n,qr,Gr,lr,cr,Cf,vh,n1,o1,Mf,Eh,nS,oS,xh,H,fa,vn,kf,Sh,Tf,Ef,qn=De(()=>{Ct();bt();Gi();zt();If();Af="ccc:xp",aa=e=>`${Af}:unlocked:${e}`,$r=e=>`${Af}:level:${e}`,Ui=e=>`${Af}:progress:${e}`;la=null,wf=!1,It=c.fromInt(10),ar=new Map;ar.set("0",It);Fi=0n,pt=c.fromAny("Infinity"),Fn=null,Un=!1,Dn=!1,$n=null,qr=null,Gr=null,lr=new Set,cr=new Set,Cf=null,vh=5000n,n1=Math.log10(11/10),o1=Math.log10(5/2),Mf=200n,Eh="0.04139268515822507",nS="0.3979400086720376",oS="0.1",xh=c.fromScientific(String(c.MAX_E));H={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};fa=new Set;vn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};kf=[],Sh=!1,Tf=null,Ef=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Di,unlockXpSystem:Hr,addXp:qi,getXpState:Qe,broadcastXpChange:Vl,isXpSystemUnlocked:cn,getXpRequirementForXpLevel:Wl,getXpGainMultiplier:zl,setExternalCoinMultiplierProvider:Ah,addExternalCoinMultiplierProvider:Ro,refreshCoinMultiplierFromXpLevel:jt,setExternalXpGainMultiplierProvider:Nh,addExternalXpGainMultiplierProvider:ur,setExternalBookRewardProvider:Kl,resetXpProgress:$i}))});var $h={};vt($h,{GHOST_TAP_TIMEOUT_MS:()=>mS,clearGhostTapTarget:()=>ma,consumeGhostTapGuard:()=>Dh,initGlobalGhostTap:()=>xS,installGhostTapGuard:()=>ES,markGhostTapTarget:()=>Uh,setGhostTapSelector:()=>LS,shouldSkipGhostTap:()=>to,suppressNextGhostTap:()=>bo});function Po(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Pf(){return typeof document>"u"?null:document}function yS(e){if(!Pf())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(Of)}function ma(e){e&&(e[jl]=0)}function Uh(e,t=0,n=null){if(!e)return;let o=Po(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[jl]=o+r:e[jl]=0,gS=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&bo(i)}function Dh(e){if(typeof window>"u")return!1;let t=window[Hi];return typeof t!="number"?!1:Po()<=t?!0:(window[Hi]=null,!1)}function to(e){if(!e)return!1;let t=Number(e[jl]||0);return!Number.isFinite(t)||t<=0?!1:Po()<=t?(ma(e),!0):(ma(e),!1)}function bo(e=0){if(typeof window>"u")return;let t=Po(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[Hi]=null;return}let o=t+n,r=typeof window[Hi]=="number"?window[Hi]:0;window[Hi]=Math.max(r,o)}function vS(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Jl=fr=Po(),Oo=0))}function bS(e){Jl=fr=Po(),Oo=0}function SS(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Po();fr>0&&(Oo=t-fr),Jl=t}function IS(){let e=Po();fr>0&&(Oo=e-fr),Jl=e}function wS(e){if(!e.isTrusted)return;let t=Po(),n=fr>0?t-fr:-1,o=yS(e.target);if(to(o)){Oo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(Dh(o)){o&&ma(o),Oo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Oo||n)>=Fh){ma(o),Oo=0,e.preventDefault(),e.stopImmediatePropagation();return}Oo=0}function ES(e={}){if(Oh)return;let t=Pf();!t||typeof window>"u"||(Oh=!0,Rf="PointerEvent"in window,Ph=!Rf&&"ontouchstart"in window,e.selector&&(Of=`${e.selector}, ${Zl}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(Fh=e.longPressMs),t.addEventListener("click",wS,!0),Rf?(t.addEventListener("pointerdown",vS,{capture:!0,passive:!1}),t.addEventListener("pointerup",SS,{capture:!0,passive:!0})):Ph&&(t.addEventListener("touchstart",bS,{capture:!0,passive:!1}),t.addEventListener("touchend",IS,{capture:!0,passive:!0})))}function Bh(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Zl);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(Uh(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function xS(){let e=Pf();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",Bh,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",Bh,{capture:!1,passive:!1})}function LS(e){e&&(Of=`${e}, ${Zl}`)}var mS,jl,Hi,Zl,hS,Oh,Of,Rf,Ph,gS,Jl,fr,Oo,Fh,Xi=De(()=>{mS=0,jl=Symbol("ccc:ghostTap:skipUntil"),Hi="__cccGhostTapSkipUntil",Zl='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',hS=80,Oh=!1,Of=Zl,Rf=!1,Ph=!1,gS=null,Jl=0,fr=0,Oo=0,Fh=hS});var Bf,qh=De(()=>{Bf={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var Gh={};vt(Gh,{RateAccumulator:()=>ga,pauseGameLoop:()=>qf,registerFrame:()=>TS,registerTick:()=>So,resumeGameLoop:()=>Gf,startGameLoop:()=>MS,stopGameLoop:()=>kS});function Df(e){e||(e=performance.now());let t=e;if($f){Xr=t,Vr=requestAnimationFrame(Df);return}Xr||(Xr=t);let n=(t-Xr)/1e3;Xr=t,n>60&&(n=60),n<0&&(n=0),Yr+=n;let o=0,r=250;for(;Yr>=ha;){if(o>=r){Yr=Yr%ha;break}Ff.forEach(i=>{try{i(ha)}catch(s){console.error("Error in game tick listener:",s)}}),Yr-=ha,o++}if(Uf.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),Yi===0||Vi===0)Yi=Date.now(),Vi=t;else{let i=t-Vi;if(i>CS){let s=Date.now(),l=s-Yi;l<-1e3?yn():l>i+1e4&&yn(),Yi=s,Vi=t}}Vr=requestAnimationFrame(Df)}function qf(){$f=!0}function Gf(){$f=!1,Xr=performance.now(),Yr=0,Yi=0,Vi=0}function MS(){Vr||(Xr=performance.now(),Yr=0,Yi=0,Vi=0,Vr=requestAnimationFrame(Df))}function kS(){Vr&&(cancelAnimationFrame(Vr),Vr=null)}function So(e){return typeof e!="function"?()=>{}:(Ff.add(e),()=>{Ff.delete(e)})}function TS(e){return typeof e!="function"?()=>{}:(Uf.add(e),()=>{Uf.delete(e)})}var _S,ha,Ff,Uf,Vr,$f,Xr,Yr,Yi,Vi,CS,ga,Wr=De(()=>{bt();_S=20,ha=1/_S,Ff=new Set,Uf=new Set,Vr=null,$f=!1,Xr=0,Yr=0,Yi=0,Vi=0,CS=2e3;ga=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*ha;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ke,zr,ya,va,ba,Sa,no,Wi,AS,Hh,Kr=De(()=>{Ct();Ke="automation",zr=1,ya=2,va=3,ba=4,Sa=5,no=6,Wi={[ya]:"coins",[va]:"books",[ba]:"gold",[Sa]:"magic"},AS=[{area:Ke,id:zr,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ke,id:ya,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ke,id:va,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ke,id:ba,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ke,id:Sa,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ke,id:no,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],Hh=AS.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var Zh={};vt(Zh,{getGearsProductionRate:()=>nc,getGenerationLevelKey:()=>Jr,getGenerationUpgradeCost:()=>dr,initWorkshopSystem:()=>jh,initWorkshopTab:()=>jf,performFreeGenerationUpgrade:()=>oc,updateWorkshopTab:()=>oo});function Ki(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*US}function Jr(e){return`ccc:workshop:genLevel:${e}`}function Ea(){let e=v();if(!e)return c.zero();let t=localStorage.getItem(Jr(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function La(e){let t=v();if(!t)return!1;let n=Jr(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function _a(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let f=e.toPlainIntegerString();t=parseFloat(f)}catch{return 1/0}if(t<=0)return Xf;if(t<=jr)return Xf+t*Yh;ec===null&&(ec=Xf+jr*Yh);let n=t-jr;if(t<=Ia)return ec+n+Ki(n,zi);if(tc===null){let f=Ia-jr;tc=ec+f+Ki(f,zi)}let o=t-Ia,r=t-jr,i=Ia-jr,s=o+(Ki(r,zi)-Ki(i,zi)),l=PS/OS,a=.5*l*o*o;if(t<=Ql)return tc+s+a;if(Vf===null){let f=Ql-Ia,p=Ql-jr,g=f+(Ki(p,zi)-Ki(i,zi)),m=.5*l*f*f;Vf=tc+g+m}let u=BS*(t-Ql);if(u>709)return 1/0;let d=Vf*Math.exp(u);return!Number.isFinite(d)||d>179e306?1/0:d}function dr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=_a(t);return Ae(n)}function Kf(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(Yf);if(n.cmp(9e15)<=0){let s=Number(n.toString())*Yf;t=Ae(s)}else{let i=n.mulDecimal(Yf);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Ae(s)}catch{t=c.fromAny("Infinity")}}}let o=O?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function qS(){let e=dr(et);if(O.coins.value.cmp(e)<0)return;let t=et.add(1);La(t)&&(et=t,O.coins.sub(e),oo(),Jt())}function GS(){if(!$t())return;let n=Kf(et).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&O.gears&&O.gears.add(n),et.cmp(20)<0){let r=Number(et.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(Zr+=a,Zr>=1){let u=Math.floor(Zr);Zr-=u,O.gears&&O.gears.add(u)}}else Zr=0}function zf(){O.gears&&O.gears.set(0),La(c.zero())&&(et=c.zero()),Zr=0,oo()}function Wh(e){if(!e)return;let t=xa.get(e);if(!t){let s=e.getBoundingClientRect();t={gears:[],width:s.width,height:s.height,needsDistribution:!s.width||!s.height},xa.set(e,t)}let n=e.getBoundingClientRect();n.width>0&&n.height>0&&(t.width=n.width,t.height=n.height);let o=0;et.cmp(Hf)>0?o=Hf:o=Number(et.toPlainIntegerString());let r=Math.min(Math.floor(o),Hf),i=t.gears;for(;i.length<r;){let s=document.createElement("img");s.src=zh,s.classList.add("workshop-bg-gear"),s.alt="",s.setAttribute("aria-hidden","true");let l=32+Math.random()*48,a=0,u=0;t.width>0&&t.height>0?(a=Math.random()*(t.width-l),u=Math.random()*(t.height-l),a<0&&(a=0),u<0&&(u=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,f=Math.cos(d)*Vh,p=Math.sin(d)*Vh,g=Math.random()*360,m=(Math.random()<.5?-1:1)*(DS+Math.random()*$S);s.style.width=`${l}px`,s.style.transform=`translate3d(${a}px, ${u}px, 0) rotate(${g}deg)`,s.style.willChange="transform",e.appendChild(s),i.push({element:s,x:a,y:u,dx:f,dy:p,rotation:g,rotationSpeed:m,size:l})}for(;i.length>r;){let s=i.pop();s.element.parentNode&&s.element.parentNode.removeChild(s.element)}}function HS(e){let t="Click the big red button below to open the Automation Shop";je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${NS}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${zh}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${RS}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{qS()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),YS()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{rc("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(Zt&&Zt.isConnected){let a=Zt.querySelector(".workshop-side-left"),u=Zt.querySelector(".workshop-side-right"),d=f=>{if(!f)return;let p=xa.get(f);if(p){let g=f.getBoundingClientRect();if(p.width=g.width,p.height=g.height,p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let m of p.gears)m.x=Math.random()*(p.width-m.size),m.x<0&&(m.x=0),m.y=Math.random()*(p.height-m.size),m.y<0&&(m.y=0),m.element.style.transform=`translate3d(${m.x}px, ${m.y}px, 0) rotate(${m.rotation}deg)`}}};d(a),d(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Kh():XS()},{root:null,threshold:0}).observe(e),Zt=e}function oo(){if(!Zt)return;let e=Zt.querySelector('[data-workshop="gears-amount"]'),t=Zt.querySelector('[data-workshop="gears-rate"]'),n=Zt.querySelector('[data-workshop="upgrade-cost"]'),o=Zt.querySelector('[data-workshop="upgrade-gen"]'),r=Kf(et),i=dr(et);if(e&&(e.innerHTML=O.gears.fmt(O.gears.value)),t&&(t.innerHTML=J(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${J(i)} ${l}`}if(o){let l=O.coins.value.cmp(i)>=0;o.disabled=!l;let a=Mt(Ke,no),u=!1;if(a>0){let d=v(),f=d!=null?`:${d}`:"",p=`ccc:autobuy:${Ke}:${no}${f}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(et.isInfinite()?s="Infinity":s=et.floorToInteger().toStorage(),s!==Wf){Wf=s;let l=Zt.querySelector(".workshop-side-left"),a=Zt.querySelector(".workshop-side-right");l&&Wh(l),a&&Wh(a)}}function XS(){ji&&(cancelAnimationFrame(ji),ji=null)}function Kh(){if(ji)return;wa=0;let e=t=>{if(Zt&&Zt.isConnected){let n=Zt.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=O.gears.fmt(O.gears.value)),wa||(wa=t);let o=(t-wa)/1e3;wa=t,o>.1&&(o=.1);for(let[r,i]of xa){if(!r.isConnected)continue;let{gears:s,width:l,height:a}=i;if(!(!l||!a))for(let u of s)u.x+=u.dx*o,u.y+=u.dy*o,u.x<0?(u.x=0,u.dx=-u.dx):u.x+u.size>l&&(u.x=l-u.size,u.dx=-u.dx),u.y<0?(u.y=0,u.dy=-u.dy):u.y+u.size>a&&(u.y=a-u.size,u.dy=-u.dy),u.rotation+=u.rotationSpeed*o,u.element.style.transform=`translate3d(${u.x}px, ${u.y}px, 0) rotate(${u.rotation}deg)`}}ji=requestAnimationFrame(e)};ji=requestAnimationFrame(e)}function jh(){Xh||(Xh=!0,et=Ea(),So(GS),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{et=Ea(),Zr=0,$t()||zf(),oo()}),window.addEventListener("currency:change",e=>{e.detail.key===Me.COINS&&oo()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Me.GEARS&&oo()}),window.addEventListener("debug:change",()=>{et=Ea(),oo()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&($t()||zf())})))}function jf(e){jh(),!e.__workshopInit&&(e.__workshopInit=!0,et=Ea(),xa.clear(),Wf=-1,HS(e),typeof IntersectionObserver>"u"&&Kh(),$t()||zf(),oo())}function nc(){let e=Ea();return Kf(e)}function oc(){let e=O.coins.value.isInfinite(),n=dr(et).isInfinite();if(e&&n&&!et.isInfinite())return et=c.fromAny("Infinity"),La(et),oo(),!0;if(O.coins.value.isZero())return!1;let o=$e(O.coins.value);if(!Number.isFinite(o))if(O.coins.value.inf)o=1/0;else return!1;if(_a(et)>o||et.cmp(9e15)>0)return!1;let r=Number(et.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);_a(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(et)>0&&La(a)?(et=a,oo(),!0):!1}function YS(){if(O.coins.value.isInfinite()){oc()&&Jt();return}let e=$e(O.coins.value);if(!Number.isFinite(e)&&O.coins.value.isZero()||_a(et)>e||et.cmp(9e15)>0)return;let t=Number(et.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);_a(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(et.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(dr(c.fromInt(u)));if(l.cmp(O.coins.value)>0){let u=dr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(et)>0&&La(a)&&(et=a,O.coins.sub(l),oo(),Jt())}var zh,NS,RS,Hf,Zt,Xh,Zr,et,Wf,ji,Xf,Yf,jr,Ia,Ql,Yh,zi,OS,PS,BS,FS,US,ec,tc,Vf,xa,Vh,DS,$S,wa,Zi=De(()=>{Ct();zt();bt();Wr();Qr();Io();un();wo();Kr();zh="img/currencies/gear/gear.webp",NS="img/currencies/gear/gear_plus_base.webp",RS="img/currencies/coin/coin.webp",Hf=100,Zt=null,Xh=!1,Zr=0,et=c.zero(),Wf=-1,ji=null,Xf=12,Yf=.3010299956639812,jr=1e6,Ia=1e9,Ql=1e12,Yh=1,zi=.001,OS=1e3,PS=Math.log10(1.00001),BS=23e-11,FS=Math.log(10),US=1/FS;ec=null,tc=null,Vf=null;xa=new Map,Vh=67,DS=67,$S=67;wa=0});function ei(e){return Ca.nodes[e]||(Ca.nodes[e]={rp:c.fromInt(0),level:0,active:!1}),Ca.nodes[e]}function VS(e,t){let n=ei(t);try{let o=localStorage.getItem(ic(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(sc(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(eg(e,t));n.active=i==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1}}function Jh(){let e=v();Ca.nodes={},e!=null&&wt.forEach(t=>VS(e,t.id))}function Qh(){let e=v();e!=null&&wt.forEach(t=>{let n=Ca.nodes[t.id];if(n)try{localStorage.setItem(sc(e,t.id),n.rp.toStorage())}catch{}})}function Pt(e){return ei(e).level}function ti(e,t){let n=v();if(n==null)return;let o=ei(e);o.level=t;try{localStorage.setItem(ic(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}}function ro(e){return ei(e).rp}function ka(e,t){let n=ei(e);n.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:n.rp}}))}catch{}}function Bo(e){return ei(e).active}function ac(e,t){let n=v();if(n==null)return;t&&wt.forEach(r=>{r.id!==e&&Bo(r.id)&&ac(r.id,!1)});let o=ei(e);o.active=!!t;try{localStorage.setItem(eg(n,e),o.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:o.active}}))}catch{}}function pr(e){let t=wt.find(n=>n.id===e);if(!t)return!1;if(!t.parentIds||t.parentIds.length===0)return!0;for(let n of t.parentIds){let o=wt.find(i=>i.id===n);if(!o)continue;if(Pt(n)<o.maxLevel)return!1}return!0}function Ma(e){let t=wt.find(u=>u.id===e);if(!t)return c.fromAny("Infinity");let n=Pt(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function Sn(){let e=Pt(1);return e<=0?0:e*.01}function tg(){return Pt(4)>=1}function ng(e){let t=Ji();if(t.isZero?.())return;let o=t.mulDecimal(e.toString(),18);wt.forEach(r=>{if(pr(r.id)&&Bo(r.id)){let i=ro(r.id),s=Ma(r.id);if(Pt(r.id)>=r.maxLevel)return;let l=i.add(o);for(;;){let a=Ma(r.id);if(l.cmp(a)<0||Pt(r.id)>=r.maxLevel)break;l=l.sub(a);let u=Pt(r.id);ti(r.id,u+1)}ka(r.id,l)}})}function Zf(){let e=wt.find(o=>o.id===2);if(!e)return c.fromInt(1);let t=Pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.5,t);return c.fromAny(n)}function Jf(){let e=wt.find(o=>o.id===3);if(!e)return c.fromInt(1);let t=Pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.5,t);return c.fromAny(n)}function og(){Ro(({baseMultiplier:e})=>{let t=Zf();return e.mulDecimal(t.toScientific())}),ur(({baseGain:e})=>{let t=Jf();return e.mulDecimal(t.toScientific())}),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&jt()})}var ic,sc,eg,wt,Ca,ni=De(()=>{Ct();bt();oi();qn();ic=(e,t)=>`ccc:lab:node:level:${t}:${e}`,sc=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,eg=(e,t)=>`ccc:lab:node:active:${t}:${e}`,wt=[{id:1,title:"Tsunami Exponent Restoration",desc:"Increases the Tsunami exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[]},{id:2,title:"Experimental Coin Value",desc:"Multiplies Coin value by 1.5x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp"},{id:3,title:"Experimental XP Value",desc:"Multiplies XP value by 1.5x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp"},{id:4,title:"Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3]}],Ca={nodes:{}};typeof window<"u"&&(window.addEventListener("saveSlot:change",Jh),setInterval(Qh,1e3),window.addEventListener("beforeunload",Qh),Jh());window.RESEARCH_NODES=wt;window.isResearchNodeVisible=pr});var cg={};vt(cg,{getBookProductionRate:()=>gr,getSurge6WealthMultipliers:()=>lc,getTsunamiNerf:()=>Ft,getTsunamiNerfKey:()=>ed,getTsunamiSequenceSeen:()=>In,initSurgeEffects:()=>KS,isSurgeActive:()=>mt,setTsunamiNerf:()=>es,setTsunamiSequenceSeen:()=>hr});function ed(e){return Qf(e)}function In(){let e=v();if(e==null)return!1;try{return localStorage.getItem(lg(e))==="1"}catch{return!1}}function hr(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(lg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Ft(){return mr}function es(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=v();if(n!=null){let o=Qf(n);if(an(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}mr=t,Qi();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function mt(e){return io===1/0||typeof io=="string"&&io==="Infinity"||io===Number.POSITIVE_INFINITY?!0:typeof io=="bigint"?io>=BigInt(e):typeof io=="number"?io>=e:!1}function Ta(e){if(!mt(8))return e;let t=$e(e);if(!Number.isFinite(t))return e;let o=Ft()+Sn();return o>1&&(o=1),Ae(t*o)}function Qi(){let e=wn();io=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(mt(8)){let o=Ft()+Sn();o>1&&(o=1);let r=Math.log10(rg);Fo=Ae(r*o)}else Fo=c.fromInt(rg);else Fo=c.fromInt(1)}function lc(){if(!mt(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,g=0)=>{if(!p){if(g<=0)return c.fromInt(1);let L=Math.log10(g)/3;if(L<=0)return c.fromInt(1);let R=L*Math.log10(2);return Ae(R)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=$e(p),y=m;if(Number.isFinite(m)){if(m<15&&g>0)try{let E=Number(p.toPlainIntegerString());if(Number.isFinite(E)){let L=E+g;L>0&&(y=Math.log10(L))}}catch{}}else if(g>0)y=Math.log10(g);else return c.fromInt(1);let h=y/6;if(h<=0)return c.fromInt(1);let b=h*Math.log10(2);return Ae(b)},t=e(O.coins?.value),n=O.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(O.gold?.value),s=e(O.magic?.value),l=t,a=r,u=i,d=s;mt(8)&&(l=Ta(t),a=Ta(r),u=Ta(i),d=Ta(s));let f=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return f=f.mulBigNumInteger?f.mulBigNumInteger(u):f,f=f.mulBigNumInteger?f.mulBigNumInteger(d):f,{coins:l,books:a,gold:u,magic:d,total:f}}function gr(){if(!mt(3))return c.fromInt(0);let t=Qe().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(ig),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Ae(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*ig;n=Ae(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),O.books?.mult){let o=O.books.mult.get();n=n.mulBigNumInteger(o)}return mt(8)&&(n=Ta(n)),n}function WS(e){if(!mt(3))return;sg||(sg=new ga("books",O));let t=gr();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);O.books&&O.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,O.books&&O.books.add(c.fromInt(o))}}}function ag(e){if(e==null)return;let t=localStorage.getItem(Qf(e));t!==null?(mr=Number(t),(Number.isNaN(mr)||!Number.isFinite(mr))&&(mr=mt(8)?0:1)):mt(8)?mr=0:mr=1}function zS(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function KS(){let e=v();Qi(),ag(e),Qi(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=io,n=mt(8);Qi();let o=io,r=mt(8);!n&&r?(es(0),In()||hr(!0)):r?zS(t,o)>0&&(es(0),In()||hr(!0)):n&&!r&&es(1)}),window.addEventListener("lab:node:change",()=>{Qi()}),window.addEventListener("saveSlot:change",()=>{ag(v()),Qi()})),Ro(({baseMultiplier:t})=>Fo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Fo)),ur(({baseGain:t})=>Fo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Fo)),ri(({baseGain:t})=>Fo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Fo)),ri(({baseGain:t})=>{if(!mt(4))return t;let n=c.fromInt(4444e9);if(mt(8)){let r=Ft()+Sn();r>1&&(r=1);let i=Math.log10(4444e9);n=Ae(i*r)}return t.mulBigNumInteger(n)}),Ro(({baseMultiplier:t})=>{if(!mt(6))return t;let n=lc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),Kl(({baseReward:t})=>mt(3)?c.fromInt(0):t),So(WS)}var rg,ig,Qf,lg,Fo,io,sg,mr,so=De(()=>{Ct();bt();qn();Eo();Io();Wr();un();ni();rg=10,ig=.08685889638,Qf=e=>`ccc:surge:tsunamiNerf:${e}`,lg=e=>`ccc:unlock:tsunami:${e}`;Fo=c.fromInt(1),io=0n,sg=null,mr=0});var mg={};vt(mg,{getLabCost:()=>dg,getLabLevel:()=>fn,getLabLevelFromCoins:()=>pg,getLabLevelKey:()=>nd,getRpMult:()=>Ji,getRpMultBase:()=>fc,hasVisitedLab:()=>rs,initLabLogic:()=>jS,initLabTab:()=>id,setLabLevel:()=>Na,setLabVisited:()=>fg,updateLabLevel:()=>od,updateLabTab:()=>sd});function rs(){let e=v();if(e==null)return!1;try{return localStorage.getItem(ug(e))==="1"}catch{return!1}}function fg(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(ug(t),n?"1":"0")}catch{}}function fn(){let e=v();if(e==null)return c.fromInt(0);if(O.coins.value.isInfinite())return c.fromAny("Infinity");try{let t=localStorage.getItem(uc(e));return t?c.fromAny(t):c.fromInt(0)}catch{return c.fromInt(0)}}function Na(e){let t=v();if(t!=null)try{let n=c.fromAny(e),o=fn();if(n.cmp(o)===0)return;localStorage.setItem(uc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function dg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function pg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),d=s-20n+BigInt(u);return d<0n?c.fromInt(0):c.fromInt(d)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function od(){let e=v();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(uc(e)))return;let t=O.coins.value,n=fn();if(t.isInfinite()){n.isInfinite()||Na(c.fromAny("Infinity"));return}let o=pg(t);o.cmp(n)>0&&Na(o)}function jS(){So(od),So(ng),og()}function rd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function ZS(e){if(!e||typeof e!="object")return 0;if(rd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function QS(e){if(rd(e)||typeof e.cmp=="function"&&e.cmp(JS)>=0)return os.clone?.()??os;let t=e.floorToInteger(),n=e.sub(t),o=ZS(n);if(!Number.isFinite(o))return os.clone?.()??os;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return os.clone?.()??os;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function fc(){let e=fn();if(rd(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return QS(n)}function Ji(){let e=fc();return typeof Gn=="function"?Gn("rp",e):e}function id(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",Aa&&Aa.destroy(),Aa=new td(e))}function sd(){fg(!0),Aa&&Aa.resize()}var yr,ts,ns,ug,uc,nd,os,JS,Aa,cc,td,oi=De(()=>{bt();wo();Ct();zt();so();Wr();Gi();ni();Qr();un();yr=1e308,ts=1e300,ns=1e-300,ug=e=>`ccc:lab:visited:${e}`,uc=e=>`ccc:lab:level:${e}`;nd=e=>uc(e);os=c.fromAny("Infinity"),JS=c.fromScientific(String(c.MAX_E));Aa=null;cc=512*.95,td=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${J(fn())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),od()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>yr&&(this.camX=yr),this.camX<-yr&&(this.camX=-yr),this.camY>yr&&(this.camY=yr),this.camY<-yr&&(this.camY=-yr),this.zoom>ts&&(this.zoom=ts),this.zoom<ns&&(this.zoom=ns)}update(t){this.checkBounds();let n=fn(),o=dg(n.add(1)),r=Ft(),i=Sn(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${J(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${J(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let f=this.bursts.length-1;f>=0;f--){let p=this.bursts[f];p.time+=t;for(let g of p.particles)g.x+=g.vx*t,g.y+=g.vy*t,g.vx*=.95,g.vy*=.95;p.time>=p.life&&this.bursts.splice(f,1)}let a=500/this.zoom,u=0,d=0;if(this.keys.KeyW&&(d-=1),this.keys.KeyS&&(d+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||d!==0){let f=Math.sqrt(u*u+d*d);u/=f,d/=f,this.camX+=u*a*t,this.camY+=d*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,d=Math.floor(Math.log10(u)),f=Math.pow(10,d),p=(x,B)=>{if(B<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*B})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/x)*x,_=Math.ceil((this.camX+n/2/r)/x)*x;if((_-M)/x>1e3)return;for(let fe=M;fe<=_&&!(fe+x<=fe);fe+=x){let K=(fe-this.camX)*r+n/2;t.moveTo(K,0),t.lineTo(K,o)}let X=Math.floor((this.camY-o/2/r)/x)*x,Q=Math.ceil((this.camY+o/2/r)/x)*x;for(let fe=X;fe<=Q&&!(fe+x<=fe);fe+=x){let K=(fe-this.camY)*r+o/2;t.moveTo(0,K),t.lineTo(n,K)}t.stroke()},g=f*r,m=Math.max(0,Math.min(1,(g-15)/25));p(f,m),p(f*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let y=(0-this.camY)*r+o/2;y>=-10&&y<=o+10&&(t.moveTo(0,y),t.lineTo(n,y));let h=(0-this.camX)*r+n/2;h>=-10&&h<=n+10&&(t.moveTo(h,0),t.lineTo(h,o)),t.stroke();let b=[],E=new Map;for(let x of wt)pr(x.id)&&(b.push(x),E.set(x.id,this.getNodePosition(x)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let x of b)if(x.parentIds&&x.parentIds.length>0)for(let B of x.parentIds){let M=wt.find(_=>_.id===B);if(M&&E.has(M.id)){let _=E.get(M.id),X=E.get(x.id),Q=(_.x-this.camX)*r+n/2,fe=(_.y-this.camY)*r+o/2,K=(X.x-this.camX)*r+n/2,ee=(X.y-this.camY)*r+o/2;t.moveTo(Q,fe),t.lineTo(K,ee)}}t.stroke();let L=cc,R=L*r,F=L*1.6*r;for(let x of b){let B=E.get(x.id),M=(B.x-this.camX)*r+n/2,_=(B.y-this.camY)*r+o/2,X=Pt(x.id),Q=X>=x.maxLevel,fe=!0;if(M+F/2<0||M-F/2>n||_+F*.8<0||_-F/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,M-F/2,_-F/2,F,F),Q?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,M-F/2,_-F/2,F,F):Bo(x.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,M-F/2,_-F/2,F,F);let ee=this.nodeImages[x.id];if(ee||(ee=new Image,ee.src="img/"+x.icon,this.nodeImages[x.id]=ee),ee.complete&&ee.naturalWidth!==0&&t.drawImage(ee,M-R/2,_-R/2,R,R),fe){let ve=Ma(x.id),he=0;if(Q)he=1;else if(ve.isInfinite?.()||typeof ve.cmp=="function"&&ve.cmp(c.fromAny("Infinity"))===0)he=0;else{let W=ro(x.id);if(W.isZero?.())he=0;else try{if(ve.isZero?.())he=1;else{let me=W.div(ve).toScientific(5);he=Number(me)}}catch{he=0}}he=Math.max(0,Math.min(1,he));let Y=F*.96,te=F*.18,$=M-Y/2,G=_+F/2+F*.05;t.fillStyle="#111",t.fillRect($,G,Y,te);let j=t.createLinearGradient($,G,$,G+te);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,G,Y*he,te),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,G,Y,te),t.fillStyle="#fff",t.font=`bold ${te*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,te*.08);let le=`Level ${X}`;Q&&(le=x.maxLevel===1?"UNLOCKED":"MAXED");let ue=t.measureText(le),C=G+te/2+(ue.actualBoundingBoxAscent-ue.actualBoundingBoxDescent)/2;t.strokeText(le,$+Y/2,C),t.fillText(le,$+Y/2,C)}}let U=35,q=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let x of this.bursts){let B=(x.x-this.camX)*this.zoom+n/2,M=(x.y-this.camY)*this.zoom+o/2;for(let _=0;_<q.length;_++){let X=q[_],Q=x.time-X.delay;if(Q>0&&Q<X.dur){let fe=Q/X.dur,K=1-Math.pow(1-fe,3),ee=U*K,ve=Math.max(0,1-Math.pow(fe,2)),he=1+_*.5,Y=t.createRadialGradient(B,M,ee*.6,B,M,ee);Y.addColorStop(0,"rgba(255, 200, 50, 0)"),Y.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,ve*.15*he)})`),Y.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,ve*.2*he)})`),Y.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=Y,t.beginPath(),t.arc(B,M,ee,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let _ of x.particles)if(x.time<_.life){let X=1-x.time/_.life,Q=B+_.x,fe=M+_.y;t.fillStyle=`rgba(255, 255, 150, ${X})`,t.beginPath(),t.arc(Q,fe,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=cc/2*1.6;for(let u of wt){if(!pr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=wt.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.textContent=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let d=document.createElement("div");d.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=Bo(t);ac(t,!p),this.updateNodeOverlay()};let f=document.createElement("button");f.className="shop-close",f.textContent="Close",f.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},d.append(f,this.overlayToggleBtn),o.append(r,i,l,d),this.overlay.appendChild(o),document.body.appendChild(this.overlay),ad(r,o,()=>!!this.overlay,()=>f.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=wt.find(l=>l.id===this.activeOverlayId);if(!t||!pr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=Pt(t.id),o=ro(t.id),r=Ma(t.id),i=Bo(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(t.id===2){this.overlayBonus.style.display="";let l=Zf();this.overlayBonus.textContent=`Coin value bonus: ${at(l)}x`}else if(t.id===3){this.overlayBonus.style.display="";let l=Jf();this.overlayBonus.textContent=`XP value bonus: ${at(l)}x`}else if(t.id===4)this.overlayBonus.style.display="none";else{this.overlayBonus.style.display="";let l=n*.01;this.overlayBonus.textContent=`Tsunami exponent bonus: +${l.toFixed(2)}`}if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?J(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?J(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${J(o)} / ${J(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=cc/2*1.6;for(let u of wt){if(!pr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){if(Pt(u.id)>=u.maxLevel)return;let y=Bo(u.id);ac(u.id,!y),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,d=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=d/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=cc/2*1.6;for(let u of wt){if(!pr(u.id))continue;let d=this.getNodePosition(u),f=i-d.x,p=s-d.y;if(Math.sqrt(f*f+p*p)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<ns&&(i=ns),i>ts&&(i=ts);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,d=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=d-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<ns&&(i=ns),i>ts&&(i=ts);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,d=this.camX+(a-this.width/2)/r,f=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=d-(a-this.width/2)/i,this.camY=f-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var yg={};vt(yg,{calculateOfflineRewards:()=>is,calculatePreAutomationRewards:()=>pc,formatTimeCompact:()=>dc,grantOfflineRewards:()=>ii,initOfflineTracker:()=>nI,processOfflineProgress:()=>gg,showOfflinePanel:()=>vr});function dc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let h=t.div(l).floorToInteger(),b=h.mulBigNumInteger(l),E=t.sub(b),L=0;try{let R=E.div(c.fromInt(i)).floorToInteger();L=Number(R.toPlainIntegerString())}catch{L=0}return L===0?`${J(h)}y`:`${J(h)}y ${L}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let d=Math.floor(u/60),f=u%60;if(d<60)return f===0?`${d}m`:`${d}m ${f}s`;let p=Math.floor(d/60),g=d%60;if(p<24)return g===0?`${p}h`:`${p}h ${g}m`;let m=Math.floor(p/24),y=p%24;return y===0?`${m}d`:`${m}d ${y}h`}function vr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${dc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let d=document.createElement("div");d.className="offline-list",eI.forEach(m=>{let y=m.key,h=e[y];if(!h||typeof h.isZero=="function"&&h.isZero())return;if(y==="research_levels"){Array.isArray(h)&&h.forEach(U=>{let q=document.createElement("div");q.className="offline-row";let x=document.createElement("span");x.className="offline-plus",x.style.color="#004F96",x.textContent="+";let B=document.createElement("img");B.className="offline-icon",B.src=m.icon,B.alt="RP";let M=document.createElement("span");M.className="offline-text",M.style.color="#004F96";let _=c.fromInt(U.levels),X=_.cmp(c.fromInt(1))===0?"Level":"Levels";M.textContent=`${J(_)} ${X} of ${U.name}`,q.appendChild(x),q.appendChild(B),q.appendChild(M),d.appendChild(q)});return}let b=document.createElement("div");b.className="offline-row";let E=document.createElement("span");E.className="offline-plus",E.classList.add(`text-${y}`),E.textContent="+";let L=document.createElement("img");L.className="offline-icon",L.src=m.icon,L.alt=y;let R=document.createElement("span");R.className="offline-text",R.classList.add(`text-${y}`);let T=!1;h instanceof c?T=!h.isInfinite()&&h.cmp(c.fromInt(1))===0:T=Number(h)===1;let F=T?m.singular:m.plural;R.innerHTML=`${J(h)} ${F}`,b.appendChild(E),b.appendChild(L),b.appendChild(R),d.appendChild(b)}),u.appendChild(d),a.appendChild(u);let f=document.createElement("div");f.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let g=()=>{r.remove()};return p.addEventListener("click",g),r.addEventListener("click",m=>{m.target===r&&g()}),f.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(f),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{ss(i,a,".offline-scroll-container")}),r}function tI(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function is(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=Ji?Ji():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),d=wt.filter(g=>Bo(g.id)),f=[],p={};for(let g of d){let m=Pt(g.id),y=ro(g.id).add(u),h=0,b=g.maxLevel;for(;m<b;){let E=tI(g,m);if(E.isInfinite&&E.isInfinite()||y.cmp(E)<0)break;y=y.sub(E),m++,h++}h>0&&f.push({name:g.title,levels:h}),p[g.id]={level:m,rp:y}}f.length>0&&(o.research_levels=f),Object.keys(p).length>0&&(o.research_progress=p)}let s=(nc?nc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||Bn("gears",t)||(o.gears=s);let l=gr?gr():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||Bn("books",t)||(o.books=u)}let a=Mt(Ke,zr)||0;if(a>0){let u=1;mt(2)&&(u=10);let d=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!d.isZero()){let f=hc(),p=f.coins.mulBigNumInteger(d),g=f.xp.mulBigNumInteger(d),m=f.mp.mulBigNumInteger(d);p.isZero()||Bn("coins",t)||(o.coins=p),g.isZero()||an(`ccc:xp:progress:${t}`)||(o.xp=g),m.isZero()||an(`ccc:mutation:progress:${t}`)||(o.mp=m)}}return o}function ii(e){if(v()!=null){if(e.xp)try{let n=qi(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=ls(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(ti(r,o.level),ka(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||O[n]&&typeof O[n].add=="function"&&O[n].add(e[n])}}function pc(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=Hn(),i=c.fromInt(1);try{let l=as(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Gn=="function"){let l=Gn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=hc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),d=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||an(`ccc:xp:progress:${t}`)||(o.xp=u),d.isZero()||an(`ccc:mutation:progress:${t}`)||(o.mp=d)}return o}function gg(){let e=v();if(e==null)return;let t=df(),n=Date.now();if(t<=0)return;if(n<t-1e4){yn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!$t()){let l=pc(r),a=Object.keys(l).length>0;return a&&(ii(l),vr(l,o,!0)),a}let i=is(r),s=Object.keys(i).length>0;return s&&(ii(i),vr(i,o)),s}function nI(e,t){hg||(hg=!0,document.addEventListener("visibilitychange",()=>{v()!=null&&(e&&!e()||(document.hidden?qf():(Gf(),gg()&&typeof t=="function"&&t())))}))}var hg,eI,mc=De(()=>{bt();Zi();Io();Wr();bt();Ct();zt();Qr();wo();un();oi();ni();Kr();Ra();qn();Eo();so();Gi();hg=!1;eI=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=vr});function ud(e){let t=24,n=Date.now();try{let o=localStorage.getItem(ld(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(cd(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(ld(e),"24"),localStorage.setItem(cd(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function bg(e,t,n){try{localStorage.setItem(ld(e),String(t)),localStorage.setItem(cd(e),String(n))}catch{}}function Sg(){let e=v();if(e==null)return;let{charges:t,lastCharge:n}=ud(e);if(t>=cs)return;let o=Date.now(),r=o-n;if(r>=gc){let i=Math.floor(r/gc);t+=i,t>=cs?(t=cs,n=o):n+=i*gc,bg(e,t,n),br&&br.classList.contains("is-active")&&Uo(!0)}}function rI(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function iI(){let e=v();if(e==null)return;Sg();let{charges:t,lastCharge:n}=ud(e);t<=0||(t>=cs&&(n=Date.now()-50),t--,bg(e,t,n),Uo(!0),Oa&&clearInterval(Oa),Oa=setInterval(()=>{Uo()},1e3),dt(oI,{volume:.5}),rI(),setTimeout(()=>{let o=is(vg);ii(o),vr(o,vg*1e3)},7250))}function Uo(e=!1){if(!br||!br.classList.contains("is-active"))return;let t=v();if(t==null)return;e||Sg();let{charges:n,lastCharge:o}=ud(t),r=br.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${cs}</span>`);let i=br.querySelector(".warp-timer");if(i)if(n>=cs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+gc,u=Math.max(0,a-l);i.textContent=`Next warp in ${dc(u)}`}let s=br.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function Ig(e){if(!e||e.__warpInit)return;e.__warpInit=!0,br=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",iI),Oa||(Oa=setInterval(()=>{Uo()},1e3)),Uo()}var ld,cd,cs,gc,vg,oI,br,Oa,fd=De(()=>{bt();mc();Pn();ld=e=>`ccc:warp:charges:${e}`,cd=e=>`ccc:warp:lastCharge:${e}`,cs=24,gc=3600*1e3,vg=150,oI="sounds/warp.ogg",br=null,Oa=null});function Ag(){try{return localStorage.getItem(Ir(Sd))==="1"}catch{return!1}}function wd(){try{return localStorage.getItem(Ir(Ng))==="1"}catch{return!1}}function Sc(e){let t=v();if(t==null)return;let n=`${Ng}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),sI()}catch{}}function Ic(){return wd()?"Jeff":"Merchant"}function sI(){let e=Ic();Ye&&Ye.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function Pa(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=h=>{if(!(n&&o)){if(h?.type==="click"&&h.isTrusted&&to(e)){h.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(h)).catch(b=>console.error(b)),n&&y()}},l=()=>{r=!1,i=null},a=h=>{r&&l(),s(h)},u=h=>{h.pointerType!=="mouse"&&(typeof h.button=="number"&&h.button!==0||(r=!0,i=typeof h.pointerId=="number"?h.pointerId:null,bo(160)))},d=h=>{r&&(i!=null&&typeof h.pointerId=="number"&&h.pointerId!==i||l())},f=()=>{r&&l()},p=h=>{r=!0,bo(160)},g=h=>{r&&l()},m=()=>{r&&l()},y=()=>{e.removeEventListener("click",a),Rg?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",f)):fI&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",g),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function yc(e){return cI[e]??0}function wg(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function dI(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function Fa(e,t){let n=si.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;fs.set(e,r),n.unlocked=r;let i=En.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&En.buttons[e]?.classList.contains("is-active")&&xc("dialogue")}function dd(){let e=!1;try{e=!!ms?.()}catch{}Fa("reset",e)}function pd(){let e=!1;try{e=!!$t?.()}catch{}Fa("workshop",e)}function _g(){let e=!1;try{typeof xo=="function"&&(e=xo())}catch{}Fa("warp",e)}function pI(){let e=v();if(e==null)return!1;try{return typeof In=="function"&&In()?!0:localStorage.getItem(Og(e))==="1"}catch{return!1}}function yd(){Fa("lab",pI())}function mI(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function hI(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof cn=="function"&&cn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Qe=="function"?Qe():null;t&&typeof t=="object"&&(e.xpLevel=mI(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Er=="function"&&Er()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof $t=="function"&&$t()}catch{e.hasInfuseReset=!1}return e}function gI(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?hd:gd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?hd:gd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Ed:""),i.icon=o?.icon??(r==="mysterious"?Sr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Do:lI),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function yI(){if(Eg)return;Eg=!0;let e=vI;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==v()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=v();if(t!=null){let n=`${uI}:${t}`;_t(n,{onChange:e})}}function vI(){$o()}function bI(e,t){let n=xd(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,Pg(n),SI(t.reward),!0)}function SI(e){if(e){if(e.type==="coins"){try{O.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{O.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{O.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function II(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function xd(){try{return JSON.parse(localStorage.getItem(Ir(Ba))||"{}")}catch{return{}}}function Pg(e){let t=Ir(Ba);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{rt(t,n)}catch{}}catch{}}function wI(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function EI(){let e=vd;if(vd=null,typeof e=="function")try{e()}catch{}}function xI(e,t={}){t?.rawChanged&&$o()}function md(e){if(e===Cg)return;if(EI(),Cg=e??null,e==null){$o();return}let t=`${Ba}:${e}`;vd=_t(t,{parse:wI,onChange:xI});try{rt(t)}catch{}$o()}function LI(){if(xg){md(v());return}xg=!0,md(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{md(v())})}function xr(){Promise.resolve().then(()=>(Pn(),kl)).then(({loadAudio:e})=>{e(Bg)})}function _I(){if(us)return;us=dt(Bg,{volume:je?.15:.3,loop:!0})}function Go(){us&&(us.stop&&us.stop(),us=null)}function CI(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let E=0;E<t.length;E++){let L=t[E];L==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=L):L===">"&&l?(s+=L,i.push({type:"tag",content:s}),s="",l=!1):s+=L}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,d=!1,f=!1,p="";qo=!0,_I();let g=E=>{f&&(E.preventDefault(),d=!0)},m=E=>{f&&(E.key==="Enter"||E.key===" ")&&(d=!0)},y=o.length?o:[e];requestAnimationFrame(()=>{f=!0,y.forEach(E=>E.addEventListener("click",g,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let h=()=>{y.forEach(E=>E.removeEventListener("click",g)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),Go(),qo=!1},b=()=>{if(d){e.innerHTML=t,h(),r();return}if(a>=i.length){h(),r();return}let E=i[a];E.type==="tag"?(p+=E.content,e.innerHTML=p,a++,b()):(p+=E.content[u],e.innerHTML=p,u++,u>=E.content.length&&(a++,u=0),setTimeout(b,n))};b()})}function MI(e={}){if(!Ye)return;xr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Do}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Sr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,Ye.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Do,r.textContent=e.message||Ed,requestAnimationFrame(()=>t.classList.add("is-visible")),Ye.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),Ye.classList.remove("firstchat-active"),Go(),qo=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=d=>{d.key==="Escape"&&(d.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",d=>{n.contains(d.target)||(d.preventDefault(),Ln(160),l())});let u=d=>{(!d||d.pointerType!=="mouse")&&Ln(160),l()};Pa(i,()=>{u()},{once:!0}),i.focus?.()}function kI(e,t){xr();let n=t.scriptId;String(e)==="6"&&typeof rs=="function"&&!rs()&&(n=7),Ur(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${Ic()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ds}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,Ye.appendChild(o);let r=h=>{h.key==="Escape"&&o.isConnected&&f()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),Ye.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,d=()=>{Ur(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),Ye.classList.remove("firstchat-active"),Go(),qo=!1,o.remove()},f=()=>{u||(u=!0,d(),$o())};o.addEventListener("pointerdown",h=>{l.contains(h.target)||(h.preventDefault(),h.pointerType!=="mouse"&&Ln(160),f())});let p=new wr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(h,b)=>{t.scriptId===4&&h==="c4b"&&Sc(!0)},onEnd:h=>{if(!u){if(u=!0,h&&h.noReward){$o(),d();return}bI(e,t),$o(),d()}}}),m=!!xd()[e]?.claimed,y=structuredClone(Bf[n]);m&&y.nodes.m2b&&y.nodes.c2a&&t.scriptId===1&&(y.nodes.m2b.say="I've already given you Coins, goodbye.",y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&y.nodes.m3a&&(y.nodes.m3a.say="I've already given you Books, goodbye.",y.nodes.c2a&&(y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&y.nodes.m5a&&(y.nodes.m5a.say="I've already given you Gold, goodbye.",y.nodes.c5a&&(y.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&y.nodes.m7a&&(y.nodes.m7a.say="I've already given you Magic, goodbye.",y.nodes.c7a&&(y.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(y),p.start()}function TI(){if(document.getElementById(kg))return;let e=document.createElement("style");e.id=kg,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function AI(){let e=Ye?.querySelector(".merchant-content");if(!e||e.__customScroll||!ht)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),ht.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){TI();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;ht.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let d=null,f=()=>{let M=(e.scrollTop||0)>0;d!==M&&(d=M,ht?.classList.toggle("has-scroll-shadow",M))},p=()=>{let M=Ye.querySelector(".merchant-grabber"),_=Ye.querySelector(".merchant-header"),X=Ye.querySelector(".merchant-actions"),Q=(M?.offsetHeight||0)+(_?.offsetHeight||0)|0,fe=(X?.offsetHeight||0)|0;t.style.top=Q+"px",t.style.bottom=fe+"px"},g={},m=()=>{let{scrollHeight:M,clientHeight:_,scrollTop:X}=e,Q=t.clientHeight||e.clientHeight||1;if(g.scrollHeight===M&&g.clientHeight===_&&g.barH===Q&&(u||g.scrollTop===X))return;g={scrollHeight:M,clientHeight:_,scrollTop:X,barH:Q};let fe=_/Math.max(1,M),K=Math.max(28,Math.round(Q*fe)),ee=Math.max(1,M-_),ve=Math.max(0,Q-K);if(n.style.height=K+"px",u)n.style.setProperty("--thumb-y",`${ve}px`),n.style.setProperty("--thumb-x","0px");else{let he=Math.round(X/ee*ve);n.style.transform=`translateY(${he}px)`}t.style.display=M<=_+1?"none":""},y=()=>{p(),m(),f()},h=()=>{o&&(ht.classList.add("is-scrolling"),l&&clearTimeout(l))},b=M=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{ht.classList.remove("is-scrolling")},M))},E=()=>{m(),f(),o&&h(),s||b(r)},L=()=>b(r);e.addEventListener("scroll",E,{passive:!0}),s&&e.addEventListener("scrollend",L,{passive:!0});let R=new ResizeObserver(y);R.observe(e),window.addEventListener("resize",y),requestAnimationFrame(y);let T=!1,F=0,U=0,q=M=>{T=!0,F=M.clientY,U=e.scrollTop,n.classList.add("dragging"),h();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},x=M=>{if(!T)return;let _=t.clientHeight||1,X=n.clientHeight||1,Q=Math.max(1,_-X),fe=Math.max(1,e.scrollHeight-e.clientHeight),ee=(M.clientY-F)/Q*fe;e.scrollTop=U+ee},B=M=>{if(T){T=!1,n.classList.remove("dragging"),b(i);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",q),window.addEventListener("pointermove",x,{passive:!0}),window.addEventListener("pointerup",B),window.addEventListener("pointercancel",B),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let _=t.getBoundingClientRect(),X=M.clientY-_.top,Q=t.clientHeight||1,fe=n.clientHeight||1,K=Math.max(0,Q-fe),ee=Math.max(0,Math.min(X-fe/2,K)),ve=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ee/Math.max(1,K)*ve,h(),b(r)}),e.__customScroll={bar:t,thumb:n,ro:R,updateAll:y},y()}function NI(){if(Ye)return;Ye=document.createElement("div"),Ye.className="merchant-overlay",Ye.id="merchant-overlay",Ye.setAttribute("inert",""),ht=document.createElement("div"),ht.className="merchant-sheet",ht.setAttribute("role","dialog"),ht.setAttribute("aria-modal","false"),ht.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",dd(),pd(),_g(),yd(),si.forEach(g=>{g.key==="dialogue"&&fs.set("dialogue",!0);let m=fs.get(g.key),y=m??!!g.unlocked,h=document.createElement("button");h.type="button",h.className="merchant-tab",h.dataset.tab=g.key;let b=g.lockedLabel||"???";h.textContent=y?g.label:b,y?h.title=g.label||"Tab":(h.classList.add("is-locked"),h.disabled=!0,h.title="???"),g.unlocked=y,fs.set(g.key,y),Pa(h,E=>{if(h.disabled){E?.preventDefault?.();return}xc(g.key)}),o.appendChild(h),En.buttons[g.key]=h}),En.panels.dialogue=i,En.panels.reset=s,En.panels.workshop=l,En.panels.warp=a,En.panels.lab=u,En.tablist=o,r.append(i,s,l,a,u),n.append(o,r),dd(),pd();try{Ho()}catch{}try{Ld(s)}catch{}try{Ve()}catch{}try{jf(l)}catch{}try{Ig(a)}catch{}try{id(u)}catch{}if(!Lg&&typeof window<"u"){let g=m=>{let{key:y,slot:h}=m?.detail??{};h!=null&&h!==v()||((y==="forge"||!y)&&dd(),(y==="infuse"||!y)&&pd(),(y==="surge_completed"||!y)&&_g(),(y==="lab"||y==="tsunami"||!y)&&yd())};window.addEventListener("unlock:change",g,{passive:!0}),window.addEventListener("saveSlot:change",g,{passive:!0}),Lg=!0}let d=document.createElement("div");d.className="merchant-actions";let f=document.createElement("button");f.type="button",f.className="merchant-close",f.textContent="Close",vc=f,d.appendChild(f);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ds}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,ht.append(e,t,n,d,p),Ye.appendChild(ht),document.body.appendChild(Ye),RI(),AI(),Mg||(Mg=!0,Pa(f,()=>{Ec()},{once:!1}),document.addEventListener("keydown",FI),e.addEventListener("pointerdown",UI),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),Ye.addEventListener("pointerdown",xr,{once:!0}))}function RI(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,yI(),$o()}function OI(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?kI(n.id,n.meta):n.isMysterious&&MI(n.lockInfo)}}function $o(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=hI(),o=xd(),r=!1,i=new Set;Object.entries(wc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",d=yc(u),f=gI(l,n),p=f.status,g=yc(p);if(g>d)a.status=p,p==="mysterious"?a.lockSnapshot=wg(f):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(g<d){if(u==="unlocked")f=dI(l),p="unlocked",g=yc(p);else if(u==="mysterious"){let M=a.lockSnapshot||wg(f)||{};f={status:"mysterious",unlocked:!1,title:M.title??f.title??"???",blurb:M.blurb??f.blurb??hd,tooltip:M.tooltip??f.tooltip??"Hidden Dialogue",message:M.message??f.message??Ed,icon:M.icon??f.icon??Sr,headerTitle:M.headerTitle??f.headerTitle??Do,ariaLabel:M.ariaLabel??f.ariaLabel??"Hidden merchant dialogue"},p="mysterious",g=yc(p)}}let m=p==="unlocked",y=p==="mysterious",h=p==="locked",b=!!a.claimed,E=m&&!!(l.once&&b),L=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!L){L=document.createElement("button"),L.type="button",L.className="dlg-card",L.dataset.dlgId=String(s);let M=document.createElement("div");M.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let X=document.createElement("div");X.className="dlg-reward",L.append(M,_,X),t.appendChild(L),Pa(L,OI)}L._dlgCtx={id:s,meta:l,lockInfo:f,unlocked:m,isMysterious:y},L.dataset.dlgStatus=p,L.disabled!==!!h&&(L.disabled=!!h),L.classList.toggle("is-locked",h),L.classList.toggle("is-mysterious",y),L.classList.toggle("is-complete",!!E),L.classList.toggle("has-again",!!E),h?(L.getAttribute("aria-disabled")!=="true"&&L.setAttribute("aria-disabled","true"),L.getAttribute("tabindex")!=="-1"&&L.setAttribute("tabindex","-1")):(L.hasAttribute("aria-disabled")&&L.removeAttribute("aria-disabled"),L.hasAttribute("tabindex")&&L.removeAttribute("tabindex"));let R=L.querySelector(".dlg-title"),T=m?l.title:f.title??"???";R.textContent!==T&&(R.textContent=T);let F=L.querySelector(".dlg-blurb"),U=m?l.blurb:f.blurb??"";F.textContent!==U&&(F.textContent=U);let q=L.querySelector(".dlg-reward");if(m&&l.reward){let M=aI[l.reward.type];if(M){q.classList.contains("has-reward")||(q.classList.add("has-reward"),q.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),q.style.getPropertyValue("--reward-icon")!==`url('${M}')`&&q.style.setProperty("--reward-icon",`url('${M}')`);let _=q.querySelector(".amt"),X=String(l.reward.amount);_&&_.textContent!==X&&(_.textContent=X);let Q=q.querySelector(".currency-name");if(Q){let K=String(l.reward.type||""),ee=K.charAt(0).toUpperCase()+K.slice(1);Q.textContent!==ee&&(Q.textContent=ee)}let fe=`Reward: ${l.reward.amount} ${l.reward.type}`;q.getAttribute("aria-label")!==fe&&q.setAttribute("aria-label",fe)}else{q.classList.remove("has-reward");let _=II(l.reward);q.textContent!==_&&(q.textContent=_),q.style.display!==""&&(q.style.display=""),q.removeAttribute("aria-label")}q.style.display==="none"&&(q.style.display="")}else q.textContent!==""&&(q.textContent=""),q.style.display!=="none"&&(q.style.display="none");let x=m?`${l.title}${E?" (completed)":""}`:f.ariaLabel||(y?"Hidden merchant dialogue":"Locked merchant dialogue");if(L.getAttribute("aria-label")!==x&&L.setAttribute("aria-label",x),f.tooltip)L.title!==f.tooltip&&(L.title=f.tooltip);else if(m){let M="Left-click: Start Dialogue";L.title!==M&&(L.title=M)}else L.hasAttribute("title")&&L.removeAttribute("title");let B=L.querySelector(".dlg-again");E?B||(B=document.createElement("div"),B.className="dlg-again",B.textContent="Ask Again?",L.appendChild(B)):B&&B.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&Pg(o)}function PI(){let e=Ye.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Ur(!0);let i=new wr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Ur(!1);try{localStorage.setItem(Ir(Sd),"1")}catch{}try{window.dispatchEvent(new Event(Id))}catch{}e.classList.remove("is-visible"),Ye.classList.remove("firstchat-active")}});i.load(Bf[0]),i.start()}function BI(){if(!Ye)return;let e=Ye.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),Ye.classList.remove("firstchat-active")}function Fg(){if(NI(),ps)return;let e=document.activeElement;e instanceof HTMLElement&&!Ye.contains(e)?bc=e:bc=null,ps=!0;let t=v(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(Og(t),"1")}catch{}yd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Ir(Sd))==="1"}catch{o=!1}o||Ye.classList.add("firstchat-instant"),ht.style.transition="none",ht.style.transform="",Ye.removeAttribute("inert"),ht.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ye.classList.contains("firstchat-instant")||(ht.style.transition=""),Ye.classList.add("is-open"),Ln(140),vc&&typeof vc.focus=="function")try{vc.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(Ir(Tg))||"dialogue"}catch{}n&&(r="dialogue"),xc(r),Go(),o||(Ye.querySelector(".merchant-firstchat")?.classList.add("is-visible"),Ye.classList.add("firstchat-active"),PI())})})}function Ec(){if(!ps)return;if(Ur(!1),je){try{bo(100)}catch{}try{Ln(80)}catch{}}ps=!1,ht.style.transition="",ht.style.transform="",Ye.classList.remove("is-open"),Ye.classList.remove("firstchat-instant"),BI();let e=document.activeElement;if(e&&Ye.contains(e)){let t=bc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}Ye.setAttribute("inert",""),bc=null,Go(),qo=!1}function FI(e){if(ps&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<si.length;i++)fs.get(si[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<si.length&&(e.preventDefault(),xc(si[r].key))}}function UI(e){if(!ps)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;xn={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},ht.style.transition="none",window.addEventListener("pointermove",Ug,{passive:!0}),window.addEventListener("pointerup",Dg),window.addEventListener("pointercancel",$g)}function Ug(e){if(!xn||xn.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-xn.startY);xn.lastY=t,xn.moved=n,ht.style.transform=`translateY(${n}px)`}function Dg(){if(!xn||xn.canceled){bd();return}let e=Math.max(1,performance.now()-xn.startT),t=xn.moved;t/e>.55&&t>40||t>140?(bo(160),ht.style.transition="transform 140ms ease-out",ht.style.transform="translateY(100%)",setTimeout(()=>{Ec()},150)):(ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)"),bd()}function $g(){xn&&(xn.canceled=!0,ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)",bd())}function bd(){window.removeEventListener("pointermove",Ug),window.removeEventListener("pointerup",Dg),window.removeEventListener("pointercancel",$g),xn=null}function xc(e){let t=si.find(o=>o.key===e),n=fs.get(e);(!t||!n)&&(e="dialogue");for(let o in En.buttons)En.buttons[o].classList.toggle("is-active",o===e);for(let o in En.panels)En.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{$o()}catch{}if(e==="warp")try{Uo()}catch{}if(e==="lab"){typeof rs=="function"&&!rs()&&DI();try{sd()}catch{}}try{localStorage.setItem(Ir(Tg),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=Ye?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function Ua(e=[]){e.forEach(t=>Fa(t,!0))}function qg(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ds}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");xr();let u=g=>{g.key==="Escape"&&(g.stopImmediatePropagation(),g.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let d=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{f()},5e3)},15e3)},1e3)},f=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ds}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let g=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),y=r.querySelector(".merchant-firstchat__row"),h=r.querySelector(".merchant-firstchat__card"),b={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},E=new wr({textEl:g,choicesEl:m,skipTargets:[g,y,h],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),Go(),qo=!1,r.remove(),t&&t()},5e3)}});E.load(b),E.start()},p=new wr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",Go(),qo=!1,n&&n.hideCursor&&n.hideCursor(),d()}});p.load(o),p.start()}function DI(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${Ic()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ds}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");xr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new wr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{Go(),qo=!1,e.remove()}});s.load(i),s.start()}function Gg(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${Ic()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ds}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");xr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new wr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{Go(),qo=!1,t.remove(),e&&e()}});l.load(s),l.start()}var ds,Sd,Tg,Ba,Id,Ir,Ng,si,fs,aI,Sr,Do,lI,hd,gd,Ed,cI,uI,Rg,fI,Eg,xg,Lg,Og,Cg,vd,wc,Ye,ht,vc,ps,xn,bc,Mg,En,Bg,us,qo,wr,kg,Lc=De(()=>{bt();Ct();qh();qn();Io();Zi();fd();oi();so();Qr();Xi();wo();Pn();ds="img/misc/merchant.webp",Sd="ccc:merchantMet",Tg="ccc:merchantTab",Ba="ccc:merchant:dlgState",Id="ccc:merchant:met",Ir=e=>`${e}:${v()}`;Ng="ccc:unlock:jeff";si=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],fs=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),aI={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Sr="img/misc/mysterious.webp",Do="Hidden Dialogue",lI="Locked Dialogue",hd="Hidden Dialogue",gd="Locked",Ed="Locked Dialogue",cI={locked:0,mysterious:1,unlocked:2},uI="ccc:reset:forge:completed",Rg=typeof window<"u"&&"PointerEvent"in window,fI=!Rg&&typeof window<"u"&&"ontouchstart"in window;Eg=!1,xg=!1,Lg=!1;Og=e=>`ccc:unlock:lab:${e}`;Cg=null,vd=null;wc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Sr,headerTitle:Do,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:gd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Sr,headerTitle:Do,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof xo=="function"&&xo()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Sr,headerTitle:Do,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof In=="function"&&In())return!0;let t=typeof wn=="function"?wn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof xo=="function"&&xo()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Sr,headerTitle:Do,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Sr,headerTitle:Do,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};LI();Ye=null,ht=null,vc=null,ps=!1,xn=null,bc=null,Mg=!1,En={buttons:{},panels:{},tablist:null},Bg="sounds/merchant_typing.ogg",us=null,qo=!1;wr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await CI(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=Pa(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};kg="ccc-scroll-timeline-styles"});var Xg={};vt(Xg,{getAutobuyerToggle:()=>ai,initAutomationEffects:()=>XI,setAutobuyerToggle:()=>Lr,updateAutomation:()=>Hg});function Cd(e){Cc!==e&&(hs.clear(),Cc=e)}function ai(e,t){let n=v();Cd(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(hs.has(r))return hs.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return hs.set(r,i),i}function Lr(e,t,n){let o=v();Cd(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);hs.set(i,s);try{localStorage.setItem(i,s)}catch{}}function $I(e){Hg(e),HI(e)}function qI(){if(_c)return _c;let e=Ut(xe.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return _c=t,_c}function GI(e){if(!(!e||e.length===0)){for(let t of e)if(ai(xe.STARTER_COVE,t.id)!=="0"){let o=Mt(xe.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&kd(xe.STARTER_COVE,t.id)}}}function HI(e){let t=v();Cd(t);let n=qI();for(let[r,i]of Object.entries(Wi)){let s=Number(r);Mt(Ke,s)>0&&n[i]&&GI(n[i])}Mt(Ke,no)>0&&(_d++,_d>=5&&(_d=0,ai(Ke,no)!=="0"&&oc()))}function Hg(e){let n=Mt(Ke,zr);if(n<=0){Da=0;return}Da+=e;let o=1/n;if(Da>=o){let r=Math.floor(Da/o);if(r>0){let i=r;if(mt(2))if(mt(8)){let s=Ft();i*=Math.pow(10,s)}else i*=10;Md(i),Da-=r*o}}}function XI(){So($I),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Cc&&(hs.clear(),Cc=t)})}var Da,_d,hs,Cc,_c,Mc=De(()=>{Wr();un();Ra();Kr();Zi();bt();so();Da=0,_d=0,hs=new Map,Cc=null;_c=null});function Zg(e){if(!e||!e.costType)return!1;let t=KI[e.costType];return!t||Mt(Ke,t)<=0?!1:ai(e.area,e.id)!=="0"}function Td(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function Tc(e,t){return t==="standard"&&Td(e)===zI}function Wg(e){let t=Ut(e),n={};for(let o of t){let r=_n(e,o.id),i=Mt(e,o.id),s=Xo(e,o.id),l=s.iconOverride??Fc(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,d=!!s.locked,f=o.upgType==="HM"?!!Ga(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:d,lockState:s,useLockedBase:!!s.useLockedBase||d,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:f}}return n}function Jg(e){return zg[e]||zg.standard}function Ln(e=140){if(!je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Nc(e){return String(e??"").replace(/<[^>]*>/g,"")}function kc(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function Jt(){dt(ZI,{volume:je?Qg:ey})}function ty(){let e=je?Qg*2:ey*2;dt(JI,{volume:e})}function QI(e){return`<img alt="" src="${Vg[e]||Vg.coins}" class="currency-ico">`}function tw(){if(document.getElementById(Kg))return;let e=document.createElement("style");e.id=Kg,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function ss(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,d=150,f=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){tw();let ee=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=ee,s.style.scrollTimelineName=ee,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=ee,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let y=null,h=()=>{let ee=((i?s.scrollTop:s.scrollLeft)||0)>0;y!==ee&&(y=ee,t?.classList.toggle("has-scroll-shadow",ee))},b=()=>{if(!s.isConnected||!t.isConnected)return;let K=s.getBoundingClientRect(),ee=t.getBoundingClientRect();if(i){let ve=Math.max(0,K.top-ee.top),he=Math.max(0,ee.bottom-K.bottom);l.style.top=ve+"px",l.style.bottom=he+"px",l.style.left="",l.style.right=""}else{let ve=Math.max(0,K.left-ee.left),he=Math.max(0,ee.right-K.right);l.style.left=ve+"px",l.style.right=he+"px",l.style.top="",l.style.bottom="",l.style.height=""}},E={},L=()=>{let K=i?s.scrollHeight:s.scrollWidth,ee=i?s.clientHeight:s.clientWidth,ve=i?s.scrollTop:s.scrollLeft,he=i?l.clientHeight||ee:l.clientWidth||ee;if(E.scrollSize===K&&E.clientSize===ee&&E.barSize===he&&(m||E.scrollPos===ve))return;E={scrollSize:K,clientSize:ee,scrollPos:ve,barSize:he};let Y=ee/Math.max(1,K),te=Math.max(28,Math.round(he*Y)),$=Math.max(1,K-ee),G=Math.max(0,he-te);if(i?(a.style.height=te+"px",a.style.width="100%"):(a.style.width=te+"px",a.style.height="100%"),m)i?(a.style.setProperty("--thumb-y",`${G}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${G}px`),a.style.setProperty("--thumb-y","0px"));else{let le=Math.round(ve/$*G);i?a.style.transform=`translateY(${le}px)`:a.style.transform=`translateX(${le}px)`}let j=K>ee+1;l.style.display=j?"":"none",t?.classList.toggle("has-active-scrollbar",j)},R=()=>{b(),L(),h()};typeof MutationObserver<"u"&&new MutationObserver(()=>R()).observe(s,{childList:!0,subtree:!0,characterData:!0});let T=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},F=K=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},K))},U=()=>{L(),h(),u&&T(),p||F(d)},q=()=>F(d);s.addEventListener("scroll",U,{passive:!0}),p&&s.addEventListener("scrollend",q,{passive:!0}),new ResizeObserver(R).observe(s),window.addEventListener("resize",R),requestAnimationFrame(R);let B=!1,M=0,_=0,X=K=>{B=!0,M=i?K.clientY:K.clientX,_=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),T();try{a.setPointerCapture(K.pointerId)}catch{}K.preventDefault()},Q=K=>{if(!B)return;let ee=i?l.clientHeight:l.clientWidth,ve=i?a.clientHeight:a.clientWidth,he=Math.max(1,ee-ve),Y=i?s.scrollHeight:s.scrollWidth,te=i?s.clientHeight:s.clientWidth,$=Math.max(1,Y-te),j=(i?K.clientY:K.clientX)-M,le=_+j/he*$;i?s.scrollTop=le:s.scrollLeft=le},fe=K=>{if(B){B=!1,a.classList.remove("dragging"),F(f);try{a.releasePointerCapture(K.pointerId)}catch{}}};a.addEventListener("pointerdown",X),window.addEventListener("pointermove",Q,{passive:!0}),window.addEventListener("pointerup",fe),window.addEventListener("pointercancel",fe),l.addEventListener("pointerdown",K=>{if(K.target===a)return;let ee=l.getBoundingClientRect(),ve=i?K.clientY-ee.top:K.clientX-ee.left,he=i?a.clientHeight:a.clientWidth,Y=i?l.clientHeight:l.clientWidth,te=Math.max(0,Y-he),$=Math.max(0,Math.min(ve-he/2,te)),G=i?s.scrollHeight:s.scrollWidth,j=i?s.clientHeight:s.clientWidth,le=Math.max(1,G-j),ue=$/Math.max(1,te)*le;i?s.scrollTop=ue:s.scrollLeft=ue,T(),F(d)}),R()}function jg(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let d=BigInt(a)-BigInt(u);return d>0n?c.fromAny(d.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function nw(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let f=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(f)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=O[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let f=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return f&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):jg(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let f=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),g=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(g));if(f.cmp(p)===0&&f.cmp(m)===0){let h=jg(e,o,r),b=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(h.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,E=0,L=Math.max(0,b);for(;E<L;){let R=Math.floor((E+L+1)/2),T=c.fromInt(R);(typeof f.mulBigNumInteger=="function"?f.mulBigNumInteger(T):c.fromAny(f??0).mulBigNumInteger(T)).cmp(a)<=0?E=R:L=R-1}return c.fromInt(E)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:d}=li(e,o,a,u,{fastOnly:!0});return d??c.fromInt(0)}function rc(e="standard"){(Oc[e]||Oc.standard).open()}function ny(e=!1){Object.values(Oc).forEach(t=>t.close(e))}function _r(e=!1){Object.values(Oc).forEach(t=>t.update(e))}function ow(){if(Qt)return;Qt=document.createElement("div"),Qt.className="upg-overlay",it=document.createElement("div"),it.className="upg-sheet",it.setAttribute("role","dialog"),it.setAttribute("aria-modal","false"),it.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",it.append(e,t,n,o,r),Qt.appendChild(it),document.body.appendChild(Qt),Qt.addEventListener("pointerdown",u=>{je&&u.pointerType!=="mouse"&&u.target===Qt&&(u.preventDefault(),u.stopPropagation())},!0),Qt.addEventListener("click",u=>{je&&u.target===Qt&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Pc)return;let d=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:d,lastY:d,moved:0},it.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let d=u.clientY;if(typeof d!="number")return;let f=Math.max(0,d-i.startY);i.lastY=d,i.moved=f,it.style.transform=`translateY(${f}px)`}function a(u){if(!i)return;let d=i.moved>140;if(it.style.transition="transform 160ms ease",it.style.transform=d?"translateY(100%)":"translateY(0)",d){if(je&&(!u||u.pointerType!=="mouse"))try{Ln(120)}catch{}setTimeout(oy,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function oy(){if(je)try{Ln(160)}catch{}if(typeof Ac=="function"){let e=Ac;Ac=null;try{e()}catch{}}Pc=!1,!(!Qt||!it)&&(it.style.transition="",it.style.transform="",Qt.classList.remove("is-open"),Qt.style.pointerEvents="none")}function rw(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let d=document.createElement("li"),f=document.createElement("span");f.className="hm-milestone-text",u&&typeof u=="object"?(f.textContent=u.text??"",u.achieved&&d.classList.add("hm-milestone-achieved")):f.textContent=u,d.appendChild(f),i.appendChild(d)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function iw(e,t="standard"){ow(),Pc=!0;let n=!0,o=Jg(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Pc=!1;return}let l=e.upgType==="HM",a=e.tie===we.ENDLESS_XP;function u(m,y,h="div"){let b=y.split(" ").filter(R=>R.length>0),E=null,L=[];for(let R=0;R<m.children.length;R++){let T=m.children[R];h&&T.tagName.toLowerCase()!==h.toLowerCase()||b.every(F=>T.classList.contains(F))&&(E?L.push(T):E=T)}return L.forEach(R=>R.remove()),E||(E=document.createElement(h),E.className=y,m.appendChild(E)),E}let d=m=>{let y=document.createElement("div");return y.className="upg-line",y.innerHTML=m,y},f=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let y=m.lockState||o.getLockState(e.id),h=!!y?.locked,b=h&&(y?.hidden||y?.hideEffect||y?.hideCost),E=!!m.unlockUpgrade&&!b;it.classList.toggle("is-locked-hidden",b);let L=it.querySelector(".upg-header"),R=u(L,"upg-title");R.textContent!==(m.displayTitle||m.upg.title)&&(R.textContent=m.displayTitle||m.upg.title);let T=!!m.hmReadyToEvolve,F=T?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,U=u(L,"upg-level"),q=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??J(m.lvlCapBn),x=m.lvlCapFmtText??m.upg.lvlCapFmtText??Nc(q),B=T?`Level ${m.lvlFmtHtml} / ${q} (EVOLVE READY)`:F?`Level ${m.lvlFmtHtml} / ${q} (MAXED)`:`Level ${m.lvlFmtHtml} / ${q}`,M=Nc(B);U.innerHTML!==B&&(U.innerHTML=B),U.getAttribute("aria-label")!==M&&U.setAttribute("aria-label",M),U.hidden=b,b||U.removeAttribute("aria-hidden"),it.classList.toggle("is-maxed",F),it.classList.toggle("hm-evolve-ready",T),it.classList.toggle("is-unlock-upgrade",E),it.classList.toggle("is-hm-upgrade",l&&!b),it.classList.toggle("is-endless-xp",a),it.classList.toggle("is-magnet-upgrade",e.tie===we.MAGNET),it.classList.toggle("is-no-effect",!m.effect);let _=L.querySelector(".auto-toggle-wrapper"),X=t==="automation"?Wi[e.id]:null,Q=t==="automation"&&e.id===no,fe=!!X,K=t==="standard"?jI[e.costType]:null,ee=0;K?ee=Mt(Ke,K):(fe||Q)&&(ee=Mt(Ke,e.id));let he=ee>0&&(fe||K||Q)&&!b;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",L.appendChild(_));let Y=_.querySelector("button");if(Y||(Y=document.createElement("button"),Y.type="button",Y.style.padding="10px 14px",Y.style.fontSize="16px",Y.style.width="auto",Y.style.minWidth="180px",Y.addEventListener("click",ie=>{typeof Y._onClick=="function"&&Y._onClick(ie)}),_.appendChild(Y)),he){Y.style.visibility="",Y.style.pointerEvents="auto";let ie=v(),Se=ie!=null?`:${ie}`:"",Ne=!0;if(fe){let _e=`ccc:autobuy:master:${X}${Se}`,Re=Ut(xe.STARTER_COVE),se=!1;for(let ne of Re)if(ne.costType===X){let Ie=`ccc:autobuy:${ne.area}:${ne.id}${Se}`;if(ai(ne.area,ne.id)!=="0"){se=!0;break}}Ne=se}else Ne=ai(e.area,e.id)!=="0";Ne?(Y.className="shop-delve",Y.textContent="Automation: ON",Y.style.backgroundColor=""):(Y.className="shop-close",Y.textContent="Automation: OFF",Y.style.backgroundColor=""),Y._onClick=_e=>{_e.preventDefault(),_e.stopPropagation(),je&&Ln(50);let se=!Ne?"1":"0";fe?(localStorage.setItem(`ccc:autobuy:master:${X}${Se}`,se),Ut(xe.STARTER_COVE).forEach(Ie=>{Ie.costType===X&&Lr(Ie.area,Ie.id,se)})):Lr(e.area,e.id,se),p()}}else Y.style.visibility="hidden",Y.style.pointerEvents="none",Y.className="shop-delve",Y.textContent="Automation: ON",Y._onClick=null;let te=it.querySelector(".upg-content");f&&(te.scrollTop=0,f=!1);let $=u(te,"upg-desc centered");$.classList.toggle("lock-desc",b);let G=(m.displayDesc||m.upg.desc||"").trim();T?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):G?($.classList.remove("hm-evolve-note"),$.textContent!==G&&($.textContent=G),$.hidden=!1):$.hidden=!0;let j=u(te,"upg-info"),le=null,ue=ie=>{le?le.nextElementSibling!==ie&&j.insertBefore(ie,le.nextSibling):j.firstElementChild!==ie&&j.prepend(ie),le=ie};if(h&&y?.reason&&!b){let ie=(m.displayDesc||"").trim(),Se=String(y.reason??"").trim();if(ie!==Se){let Ne=j.querySelector(".lock-wrapper");if(!Ne){Ne=document.createElement("div"),Ne.className="lock-wrapper";let se=document.createElement("div");se.className="upg-line lock-note",Ne.append(se)}let _e=Array.from(Ne.children);for(let se of _e)se.tagName==="DIV"&&!se.className&&se.style.height==="12px"&&se.remove();let Re=Ne.querySelector(".lock-note");Re.textContent!==y.reason&&(Re.textContent=y.reason),ue(Ne)}else{let Ne=j.querySelector(".lock-wrapper");Ne&&Ne.remove()}}else{let ie=j.querySelector(".lock-wrapper");ie&&ie.remove()}if(m.effect&&!(h&&y?.hideEffect)){let ie=j.querySelector(".effect-wrapper");if(!ie){ie=document.createElement("div"),ie.className="effect-wrapper";let Re=document.createElement("div");Re.className="upg-line",ie.append(Re)}let Se=Array.from(ie.children);for(let Re of Se)Re.tagName==="DIV"&&!Re.className&&Re.style.height==="12px"&&Re.remove();let Ne=ie.querySelector(".upg-line"),_e=`<span class="bonus-line">${m.effect}</span>`;Ne.innerHTML!==_e&&(Ne.innerHTML=_e),ue(ie)}else{let ie=j.querySelector(".effect-wrapper");ie&&ie.remove()}let C=QI(m.upg.costType),W=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ce=F||T;if(!m.unlockUpgrade&&!ce&&(!h||!y?.hideCost)){let ie=u(j,"upg-costs");ue(ie);let Se=kc(m.upg.costType,W),Ne=`Cost: ${C} ${O[m.upg.costType].fmt(W)} ${Se}`,_e=u(ie,"cost-line","div");if(_e.className.includes("upg-line")||(_e.className="upg-line cost-line"),_e.innerHTML!==Ne&&(_e.innerHTML=Ne),l){let Ie=u(ie,"milestone-line","div");Ie.className.includes("upg-line")||(Ie.className="upg-line milestone-line");let w="\u2014",V="",z=Zg(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(z){let ae=m.hmNextMilestone.sub(c.fromInt(1)),qe=0;try{let be=ae.toPlainIntegerString?.();be&&be!=="Infinity"?qe=Number(be):qe=Number(ae.toString())}catch{qe=0}let tt=c.fromInt(0);try{tt=c.fromAny(m.upg.costAtLevel(qe))}catch{}w=O[m.upg.costType].fmt(tt),V=kc(m.upg.costType,tt)}else{let ae=m.hmNextMilestone.sub(m.lvlBn),qe=ae.toPlainIntegerString?.(),tt=Math.max(0,Math.floor(Number(qe&&qe!=="Infinity"?qe:Number(ae.toString()||0)))),{spent:be}=li(m.upg,m.lvlBn,c.fromAny("Infinity"),tt);w=O[m.upg.costType].fmt(be),V=kc(m.upg.costType,be)}}catch{}let ge=`${z?"Cost at next milestone:":"Cost to next milestone:"} ${C} ${w} ${V}`;Ie.innerHTML!==ge&&(Ie.innerHTML=ge)}else{let Ie=ie.querySelector(".milestone-line");Ie&&Ie.remove()}let Re=kc(m.upg.costType,m.have),se=`You have: ${C} ${O[m.upg.costType].fmt(m.have)} ${Re}`,ne=u(ie,"have-line","div");ne.className.includes("upg-line")||(ne.className="upg-line have-line"),ne.innerHTML!==se&&(ne.innerHTML=se)}else{let ie=j.querySelector(".upg-costs");ie&&ie.remove()}let me=it.querySelector(".upg-milestones"),Z=me.querySelector(".hm-view-milestones-row");if(!Z){Z=document.createElement("div"),Z.className="hm-view-milestones-row";let ie=document.createElement("button");ie.type="button",ie.className="shop-delve hm-view-milestones",ie.textContent="View Milestones",ie.addEventListener("click",Se=>{ie._onClick&&ie._onClick(Se)}),Z.appendChild(ie),me.appendChild(Z)}let re=Z.querySelector("button");l&&!b?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ie=Array.isArray(m.hmMilestones)?m.hmMilestones:[],Se=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Ne=(()=>{try{return BigInt(qt)*BigInt(Se)}catch{return 0n}})(),_e=ie.sort((Re,se)=>Number(Re?.level||0)-Number(se?.level||0)).map(Re=>{let se=Math.max(0,Math.floor(Number(Re?.level||0))),ne=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(se)+Ne).toString())}catch{return c.fromAny(se+qt*Se)}})(),Ie=ne?.isInfinite?.()?"Infinity":J(ne),w=at(Re?.multiplier??Re?.mult??Re?.value??1),V=`${Re?.target??Re?.type??"self"}`.toLowerCase(),z=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(ne)>=0}catch{}return!1})(),oe=`Level ${Ie}: Multiplies this upgrade\u2019s effect by ${w}x`;return V==="xp"&&(oe=`Level ${Ie}: Multiplies XP value by ${w}x`),(V==="coin"||V==="coins")&&(oe=`Level ${Ie}: Multiplies Coin value by ${w}x`),V==="mp"&&(oe=`Level ${Ie}: Multiplies MP value by ${w}x`),{text:oe,achieved:z}});rw(_e)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ye=it.querySelector(".upg-actions"),Le=ye.querySelector(".shop-close");if(Le||(Le=document.createElement("button"),Le.type="button",Le.className="shop-close",Le.textContent="Close",Le.addEventListener("click",()=>{n=!1,oy()}),ye.appendChild(Le)),h||F)ye.querySelectorAll("button:not(.shop-close)").forEach(ie=>ie.remove()),document.activeElement&&document.activeElement!==Le&&!ye.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Le.focus();else{let ie=m.have.cmp(W)>=0,Se=(se,ne,Ie,w,V=!1)=>{let z=ye.querySelector(`.${se.split(" ").join(".")}`);if(!z){z=document.createElement("button"),z.type="button",z.className=se,z.textContent=ne;let oe=()=>{typeof z._onClick=="function"&&z._onClick()};"PointerEvent"in window?z.addEventListener("pointerdown",ae=>{ae.pointerType==="mouse"||typeof ae.button=="number"&&ae.button!==0||(oe(),ae.preventDefault())},{passive:!1}):z.addEventListener("touchstart",ae=>{oe(),ae.preventDefault()},{passive:!1}),z.addEventListener("click",()=>{je||oe()});let ge=ye.children;w>=ge.length?ye.appendChild(z):ye.insertBefore(z,ge[w])}return z._onClick=Ie,z.textContent!==ne&&(z.textContent=ne),z.disabled!==V&&(z.disabled=V),z};if(T){ye.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(se=>se.remove()),Se("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:se}=o.evolve(e.id);se&&(ty(),_r(),p())},1,!1);return}if(m.unlockUpgrade){ye.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(se=>se.remove()),Se("shop-delve btn-unlock","Unlock",()=>{let{bought:se}=o.buyOne(e.id);if(!(se instanceof c?se:c.fromAny(se??0)).isZero?.()){if(Jt(),Tc(e,t))try{Ua(["reset"])}catch{}_r(),p()}},1,!ie);return}if(ye.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(se=>se.remove()),Se("shop-delve btn-buy-one","Buy",()=>{let se=o.getUiModel(e.id);if(se.have.cmp(se.nextPrice instanceof c?se.nextPrice:c.fromAny(se.nextPrice||0))<0)return;let{bought:ne}=o.buyOne(e.id);(ne instanceof c?ne:c.fromAny(ne??0)).isZero?.()||(Jt(),_r(),p())},1,!ie),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let se=ye.querySelector(".btn-buy-max");se&&se.remove();let ne=ye.querySelector(".btn-buy-cheap");ne&&ne.remove()}else{Se("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:w}=o.buyMax(e.id);(w instanceof c?w:c.fromAny(w??0)).isZero?.()||(Jt(),_r(),p())},2,!ie);let ne=[1,3,4,5,6].includes(Td(m.upg));if(!l&&!ne)Se("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let V=o.buyCheap;if(!V)return;let{bought:z}=V(e.id);(z instanceof c?z:c.fromAny(z??0)).isZero?.()||(Jt(),_r(),p())},3,!ie);else{let Ie=ye.querySelector(".btn-buy-cheap");Ie&&Ie.remove()}}if(l)Se("shop-delve btn-buy-next","Buy Next",()=>{let ne=o.getUiModel(e.id);if(ne.hmReadyToEvolve)return;let Ie=ne.hmNextMilestone;if(!Ie||!ne.lvlBn||Ie.cmp(ne.lvlBn)<=0){let{bought:be}=o.buyMax(e.id);if((be instanceof c?be:c.fromAny(be??0)).isZero?.())return;Jt(),_r(),p();return}let w=0;try{let be=Ie.sub(ne.lvlBn).toPlainIntegerString?.();w=Math.max(0,Math.floor(Number(be&&be!=="Infinity"?be:Ie.sub(ne.lvlBn).toString())))}catch{}let V=O[ne.upg.costType]?.value,z=V instanceof c?V:c.fromAny(V??0),ge=li(ne.upg,ne.lvlBn,z,w).count,ae=!1;try{let be=ge?.toPlainIntegerString?.();ae=be&&be!=="Infinity"?Number(be)>=w:Number(ge??0)>=w}catch{}let qe=ae?o.buyNext(e.id,w):o.buyMax(e.id);(qe.bought instanceof c?qe.bought:c.fromAny(qe.bought??0)).isZero?.()||(Jt(),_r(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let se=ye.querySelector(".btn-buy-next");se&&se.remove()}}},g=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,g)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",g),p(),Qt.classList.add("is-open"),Qt.classList.toggle("is-automation-upgrade",t==="automation"),Qt.style.pointerEvents="auto",Ln(140),it.style.transition="none",it.style.transform="translateY(100%)",it.offsetHeight,requestAnimationFrame(()=>{it.style.transition="",it.style.transform=""}),Ac=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,g)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",g)}}function ad(e,t,n,o){let r=null;function i(d){if(!n())return;let f=typeof d.clientY=="number"?d.clientY:d.touches?.[0]?.clientY||0;r={startY:f,lastY:f,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(d){if(!r||r.canceled)return;let f=d.clientY;if(typeof f!="number")return;let p=Math.max(0,f-r.startY);r.lastY=f,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let d=Math.max(1,performance.now()-r.startT),f=r.moved;f/d>.55&&f>40||f>140?(bo(100),Ln(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",d=>d.preventDefault(),{passive:!1})}var Yg,YI,VI,WI,Vg,zI,KI,jI,zg,ZI,JI,Qg,ey,ew,Kg,Rc,Oc,Qt,it,Pc,Ac,Qr=De(()=>{bt();Ct();zt();wo();Lc();$l();Pn();un();Xi();Kr();Mc();Yg={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp"},YI="img/misc/locked_base.webp",VI="img/misc/maxed.webp",WI="img/misc/green_border.webp",Vg={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp"},zI=7,KI={coins:ya,books:va,gold:ba,magic:Sa};jI={coins:ya,books:va,gold:ba,magic:Sa};zg={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Wg(Hn()),getUiModel:e=>Ga(Hn(),e),buyOne:e=>$a(Hn(),e),buyMax:e=>Bc(Hn(),e),buyCheap:e=>Nd(Hn(),e),buyNext:(e,t)=>qa(Hn(),e,t),getLockState:e=>Xo(Hn(),e),evolve:e=>Ad(Hn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",Id,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Wg(Ke),getUiModel:e=>Ga(Ke,e),buyOne:e=>$a(Ke,e),buyMax:e=>Bc(Ke,e),buyNext:(e,t)=>qa(Ke,e,t),getLockState:e=>Xo(Ke,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof v=="function"?v():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||_r(!0)});ZI="sounds/purchase_upg.ogg",JI="sounds/evolve_upg.ogg",Qg=.12,ey=.3;ew="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",Kg="ccc-scroll-timeline-styles";Rc=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return Jg(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!Ag(),o=v();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let W=document.createElement("div");W.className="shop-tile";let ce=document.createElement("img");ce.className="base",ce.alt="";let me=document.createElement("img");me.className="icon",me.alt="",me.addEventListener("error",()=>{me.src=ew}),W.appendChild(ce),W.appendChild(me),i.appendChild(W),t.appendChild(i),i.addEventListener("click",Z=>{let re=Z.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){Z.preventDefault(),Z.stopImmediatePropagation();return}if(to(re)){Z.preventDefault(),Z.stopImmediatePropagation();return}if(Z.shiftKey||Z.ctrlKey){if(Z.preventDefault(),Z.stopImmediatePropagation(),!re.upgMeta)return;let ye=re.upgMeta.id,Le=re.upgMeta.upgType==="HM",ie=[1,3,4,5,6].includes(Td(re.upgMeta));if(Z.shiftKey){if(!ie&&this.adapter.buyCheap){let{bought:_e}=this.adapter.buyCheap(ye);(_e instanceof c?_e:c.fromAny(_e??0)).isZero?.()||(Jt(),this.update());return}let{bought:Se}=this.adapter.buyMax(ye);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Jt(),Tc(re.upgMeta,this.mode))try{Ua(["reset"])}catch{}this.update()}return}if(Z.ctrlKey){if(Le){let _e=this.adapter.getUiModel(ye);if(_e&&!_e.hmReadyToEvolve){let Re=_e.hmNextMilestone;if(Re&&_e.lvlBn&&Re.cmp(_e.lvlBn)>0){let se=0;try{let oe=Re.sub(_e.lvlBn).toPlainIntegerString?.();se=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Re.sub(_e.lvlBn).toString())))}catch{}let ne=O[_e.upg.costType]?.value,Ie=ne instanceof c?ne:c.fromAny(ne??0),V=li(_e.upg,_e.lvlBn,Ie,se).count,z=!1;try{let oe=V?.toPlainIntegerString?.();z=oe&&oe!=="Infinity"?Number(oe)>=se:Number(V??0)>=se}catch{}if(z){let oe=this.adapter.buyNext(ye,se);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(Jt(),this.update());return}}}}let{bought:Se}=this.adapter.buyMax(ye);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Jt(),Tc(re.upgMeta,this.mode))try{Ua(["reset"])}catch{}this.update()}return}}re.upgMeta&&iw(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",Z=>{if(je)return;let re=Z.currentTarget;if(re.dataset.locked==="1"||(Z.preventDefault(),Z.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:Se}=this.adapter.evolve(re.upgMeta.id);Se&&(ty(),this.update());return}let{bought:Le}=this.adapter.buyMax(re.upgMeta.id);if(!(Le instanceof c?Le:c.fromAny(Le??0)).isZero?.()){if(Jt(),Tc(re.upgMeta,this.mode))try{Ua(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),d=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",d),i.disabled=d,d?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=d?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let g=s?c.fromInt(0):nw(r.meta,r.levelNumeric,r.level),m=g instanceof c?g:c.fromAny(g),y=J(r.level),h=Nc(y),b=J(m),E=Nc(b),L=!m.isZero?.(),R=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,T=Number.isFinite(R)?Math.max(0,Math.floor(R)):1/0,F=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,U=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(T)&&Number.isFinite(F)?F>=T:!1,q=Number.isFinite(T)&&T===1,x=!!r.meta?.unlockUpgrade,B=!s&&x&&!U,M=!s&&x&&!B&&U,_,X,Q=!1,fe=!1;if(s){_="",X="";let W=u?(r.lockState?.reason||"").trim():"",ce=W?`${r.title} (Locked, ${W})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ce)}else{if(B||M)_=B?"Unlockable":"Unlocked",X=_,fe=!0;else if(!s&&q&&!x)U?(_="Owned",X="Owned"):L?(_="Purchasable",X="Purchasable"):(_="Not Owned",X="Not Owned"),fe=!0;else{let W=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ce=String(h||"").replace(/,/g,""),me=/|Infinity/i.test(ce),Z=Number.isFinite(W)?W>=1e3:me||/^\d{4,}$/.test(ce);Q=L&&Z,Q?(_=`<span class="badge-lvl">${y}</span><span class="badge-plus">(+${b})</span>`,X=`${h} (+${E})`):(_=L?`${y} (+${b})`:y,X=L?`${h} (+${E})`:h)}i.setAttribute("aria-label",`${r.title}, ${X}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let K=i.firstElementChild,ee=K.querySelector(".base"),ve=K.querySelector(".icon"),he=r.meta?.costType||"coins",te=r.useLockedBase||s?YI:r.baseIconOverride||Yg[he]||Yg.coins;ee.src!==te&&(ee.src=te);let $=r.icon;if(!$)ve.hidden||(ve.hidden=!0);else{ve.hidden&&(ve.hidden=!1);let W=$;ve._lastSrc!==W&&(ve.src=W,ve._lastSrc=W)}let G=K.querySelector(".maxed-overlay"),j=!s&&Zg(r.meta),le=!s&&U;if(le||!s&&!U&&!p&&j){G||(G=document.createElement("img"),G.className="maxed-overlay",G.alt="",K.insertBefore(G,ve));let W=le?VI:WI;G.src!==W&&(G.src=W)}else G&&G.remove();let C=K.querySelector(".level-badge");s?C&&C.remove():(C||(C=document.createElement("span"),C.className="level-badge",K.appendChild(C)),C.className="level-badge",fe&&C.classList.add("text-badge"),Q&&C.classList.add("two-line"),(L||B)&&C.classList.add("can-buy"),U&&C.classList.add("is-maxed"),_===X?C.textContent!==_&&(C.textContent=_):C.innerHTML!==_&&(C.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),ss(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&to(a)||(xr(),Fg())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{je&&Ln(80),this.close()},{passive:!0}),ad(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=v();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&Gg(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,je)try{setTimeout(()=>bo(240),120)}catch{}Ln(10),ss(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},Oc={standard:new Rc("standard"),automation:new Rc("automation")};Qt=null,it=null,Pc=!1,Ac=null});var sy={};vt(sy,{applyHudLayout:()=>Yo,initHudButtons:()=>aw,isMapUnlocked:()=>Bd,isShopUnlocked:()=>Pd,lockMap:()=>qc,lockShop:()=>$c,unlockMap:()=>Dc,unlockShop:()=>ci});function Od(e){let t=v();return t==null?e:`${e}:${t}`}function gs(e){let t=Od(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function Pd(){return Fd(),gs(ao.SHOP)}function Bd(){return Fd(),gs(ao.MAP)}function Uc(e,t){let n=t?"1":"0",o=Od(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:v()}}))}catch{}}function Fd(){for(let e of Object.values(ao)){let t=Od(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function Lo(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function Rd(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",Oi())}function sw(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function Yo(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=sw(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(g=>e.querySelector(`.game-btn[data-btn="${g}"]`)).filter(Boolean),a=[...e.children].filter(g=>!l.includes(g)),u=[...l,...a];if(u.length&&u.some((g,m)=>e.children[m]!==g)){let g=document.createDocumentFragment();u.forEach(m=>g.appendChild(m)),e.appendChild(g)}let p=[...e.querySelectorAll(".game-btn")].filter(g=>!g.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(g=>{g.style.gridColumn="",g.style.gridRow="",g.classList.remove("span-2"),g.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let g=getComputedStyle(e),m=parseFloat(g.columnGap||g.gap||"0")||0,y=e.clientWidth,h=Math.max(180,Math.floor((y-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${h}px ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let g=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),y=e.querySelector('[data-btn="shop"]:not([hidden])');g&&m&&y&&(g.style.gridColumn="1",g.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",y.style.gridColumn="1 / -1",y.style.gridRow="2")}}function aw(){if(Fd(),Lo("help",!0),Lo("stats",!0),Lo("shop",gs(ao.SHOP)),Lo("map",gs(ao.MAP)),Rd(),Yo(),ry||(ry=!0,window.addEventListener("resize",Yo),window.addEventListener("orientationchange",Yo),window.addEventListener("saveSlot:change",()=>{Lo("shop",gs(ao.SHOP)),Lo("map",gs(ao.MAP)),Rd(),Yo()}),window.addEventListener("saveSlot:modified",e=>{let t=v(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||Rd()})),!iy){iy=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&rc()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&to(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function ci(){Uc(ao.SHOP,!0),Lo("shop",!0),Yo()}function Dc(){Uc(ao.MAP,!0),Lo("map",!0),Yo()}function $c(){Uc(ao.SHOP,!1),Lo("shop",!1),Yo()}function qc(){Uc(ao.MAP,!1),Lo("map",!1),Yo()}var ao,ry,iy,Gc=De(()=>{Qr();bt();Xi();ao={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};ry=!1,iy=!1});function ay(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(W=>W.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,d=4,f=new Float32Array(t*d);for(let C=0;C<t;C++)f[C*d+2]=1/0;let p=new Int16Array(t),g=t;for(let C=0;C<t;C++)p[C]=t-1-C;let m=-1,y=document.createElement("canvas");y.className="cursor-trail-canvas",Object.assign(y.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(y);let h=y.getContext("2d",{alpha:!0,desynchronized:!0}),b=document.createElement("canvas");b.width=a,b.height=a;let E=b.getContext("2d");E.shadowColor="#FFEB3B",E.shadowBlur=l,E.fillStyle="#FFEB3B",E.beginPath(),E.arc(u,u,s,0,Math.PI*2),E.fill();let L=!1,R=null,T=null,F={left:0,top:0,width:0,height:0},U=1,q=!1,x=0,B=0,M=!1,_=null,X=[],Q=()=>{if(q)return;let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;F={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}},fe=()=>{if(q)return;Q();let C=Math.min(window.devicePixelRatio||1,2);U=F.width>0?Math.min(C,512/F.width):C,y.width=F.width*U,y.height=F.height*U,h.scale(U,U),_=null},K=null;typeof ResizeObserver<"u"&&(K=new ResizeObserver(()=>{fe()}),K.observe(e));let ee=(C,W)=>{if(g<=0)return;let ce=p[--g];ce>m&&(m=ce);let me=ce*d;f[me]=C,f[me+1]=W,f[me+2]=0,f[me+3]=n},ve=(C,W,ce)=>{if(R===null||T===null)ce.count<r&&(ee(C,W),ce.count++);else{let me=C-R,Z=W-T,re=Math.hypot(me,Z);if(re>=o){let ye=Math.floor(re/o);for(let Le=1;Le<=ye&&!(ce.count>=r);Le++){let ie=Le*o/re;ee(R+me*ie,T+Z*ie),ce.count++}}ce.count<r&&(ee(C,W),ce.count++)}R=C,T=W},he=C=>{if(q)return;x||(B=0,x=requestAnimationFrame(te)),F.width||Q();let W=0,ce=0,me=(Z,re)=>Z>=0&&Z<=F.width&&re>=0&&re<=F.height;if(C.getCoalescedEvents){let Z=C.getCoalescedEvents();if(Z.length>0)for(let re of Z){let ye=re.clientX-W,Le=re.clientY-ce;X.push({x:ye,y:Le,inside:me(ye,Le)})}else{let re=C.clientX-W,ye=C.clientY-ce;X.push({x:re,y:ye,inside:me(re,ye)})}}else{let Z=C.clientX-W,re=C.clientY-ce;X.push({x:Z,y:re,inside:me(Z,re)})}},Y=()=>{L=!1,R=null,T=null,X.length=0},te=()=>{if(q)return;let C=performance.now();B||(B=C);let W=C-B;B=C,W>100&&(W=100);let ce={count:0};if(X.length>0){for(let Ne of X)Ne.inside?(L=!0,ve(Ne.x,Ne.y,ce)):(L=!1,R=null,T=null);let Se=X[X.length-1];Se.inside&&(R!==Se.x||T!==Se.y)&&(ee(Se.x,Se.y),R=Se.x,T=Se.y),X.length=0}else L&&R!==null&&T!==null&&ee(R,T);let me=t-g;if(me===0&&!M){x=0;return}_?h.clearRect(_.x,_.y,_.w,_.h):h.clearRect(0,0,F.width,F.height),M=!1;let Z=1/0,re=1/0,ye=-1/0,Le=-1/0,ie=-1;if(me>0)for(let Se=0;Se<=m;Se++){let Ne=Se*d,_e=f[Ne+2];if(_e>=f[Ne+3])continue;if(_e+=W,f[Ne+2]=_e,_e>=f[Ne+3]){p[g++]=Se;continue}ie=Se;let Re=f[Ne+3],se=_e/Re,ne=1-se,Ie=1-.4*se;M=!0,h.globalAlpha=ne;let w=a*Ie,V=w/2,z=f[Ne],oe=f[Ne+1],ge=Math.round(z-V),ae=Math.round(oe-V),qe=Math.round(w);h.drawImage(b,ge,ae,qe,qe),ge<Z&&(Z=ge),ae<re&&(re=ae);let tt=ge+qe,be=ae+qe;tt>ye&&(ye=tt),be>Le&&(Le=be)}m=ie,Z!==1/0?(Z-=2,re-=2,ye+=2,Le+=2,_={x:Z,y:re,w:ye-Z,h:Le-re}):_=null,x=requestAnimationFrame(te)};window.addEventListener("resize",fe),window.addEventListener("scroll",Q,{passive:!0}),window.addEventListener("focus",Q,{passive:!0}),document.addEventListener("visibilitychange",Q,{passive:!0});let $={passive:!0},G=C=>{Q(),he(C)},j=C=>{Q(),he(C)};e.addEventListener("pointermove",he,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",G,$),e.addEventListener("pointerleave",Y,$),e.addEventListener("pointercancel",Y,$),fe(),x=requestAnimationFrame(te);let le=setInterval(Q,1e3);return{destroy:()=>{q=!0,x&&cancelAnimationFrame(x),le&&clearInterval(le),K&&(K.disconnect(),K=null);try{window.removeEventListener("resize",fe)}catch{}try{window.removeEventListener("scroll",Q)}catch{}try{window.removeEventListener("focus",Q)}catch{}try{document.removeEventListener("visibilitychange",Q)}catch{}try{e.removeEventListener("pointermove",he),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",G),e.removeEventListener("pointerleave",Y),e.removeEventListener("pointercancel",Y)}catch{}y.remove()}}}var ly=De(()=>{});var by={};vt(by,{clearPendingGains:()=>Wd,getPassiveCoinReward:()=>hc,initCoinPickup:()=>gw,setCoinMultiplier:()=>fw,triggerPassiveCollect:()=>Md});function cy(e){if(!e||typeof e!="object"){Xa=!1,Hc=!1,Xc="0",di.clear();return}Xa=!!e.unlocked,Hc=!!e.level?.isInfinite?.();try{Xc=e.level?.toPlainIntegerString?.()??"0"}catch{Xc="0"}Xa?Hc&&di.clear():di.clear()}function lw(){if(typeof ui=="function")try{ui()}catch{}try{cy(lt())}catch{Xa=!1,di.clear()}try{ui=pi(e=>{cy(e)})}catch{ui=null}}function fw(e){uw=e;try{O.coins?.mult?.set&&O.coins.mult.set(e)}catch{}}function qd(){try{let e=Vc();e instanceof c?vs=e.clone?.()??e:e!=null?vs=c.fromAny(e):vs=c.fromInt(1)}catch{vs=c.fromInt(1)}}function dw(){uy||(uy=!0,qd(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",qd),typeof window<"u"&&window.addEventListener("saveSlot:change",qd))}function pw(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Yd.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function Xd(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*mw:0}function hw({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,d=0,f=0,p=0,g=null,m=null,y=Xd(),h=0,b=0,E=0,L=!1,R=null,T=null,F=()=>{if(L)return;let $=document.documentElement.clientWidth,G=document.documentElement.clientHeight;R={left:0,top:0,width:$,height:G,right:$,bottom:G,x:0,y:0}},U=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",g=null,m=null},q=()=>{if(!l||b<=0){U();return}let $=b*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${f-b}px, ${p-b}px, 0)`,s.classList.add("is-visible")},x=()=>{if(!(!l||b<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=b+Gd,G=[];if(typeof i.findCoinTargetsInPath=="function"&&g!==null&&m!==null?G=i.findCoinTargetsInPath(g,m,f,p,$):G=i.findCoinTargetsInRadius(f,p,$),g=f,m=p,G&&G.length>0)if(typeof r=="function"){let j=[];for(let le=0;le<G.length;le++){let ue=G[le],C={coin:ue};ue.el&&i.getCoinTransform&&(C.opts={transform:i.getCoinTransform(ue.el)}),j.push(C)}r(j)}else for(let j=0;j<G.length;j++){let le=G[j],ue=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(ue){let C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform||"";o(ue,{transform:C})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=b+Gd,G=i.findCoinsInRadius(f,p,$);if(g=f,m=p,G&&G.length>0){let j=[];for(let le=0;le<G.length;le++){let ue=G[le],C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform;j.push({el:ue,opts:{transform:C}})}typeof r=="function"&&r(j)}}else{let $=t.children,G=b+Gd,j=[];for(let le=$.length-1;le>=0;le--){let ue=$[le];if(ue.dataset.collected==="1"||!ue.matches(n))continue;let C=ue.getBoundingClientRect(),W=C.left+C.width/2,ce=C.top+C.height/2,me=W-u,Z=ce-d;Math.hypot(me,Z)<=G&&j.push(ue)}if(!j.length)return;if(typeof r=="function"){let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push({el:C,opts:{transform:W.transform}})}r(le)}else{let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push(W.transform)}for(let ue=0;ue<j.length;ue++)o(j[ue],{transform:le[ue]})}}},B=()=>{E=0,q(),!(!l||b<=0||L)&&(x(),M())},M=()=>{!l||b<=0||E||L||(E=requestAnimationFrame(B))},_=$=>{if(!$||L||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,d=$.clientY,R||F();let G=R;f=u,p=d,l=f>=0&&f<=G.width&&p>=0&&p<=G.height,M()},X=()=>{l=!1,U(),g=null,m=null},Q=()=>{g=null,m=null},fe=()=>{h=Wc(),b=h*y,q(),M()},K=()=>{if(!(L||!a)){if(F(),R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()}},ee=()=>{if(y=Xd(),b=h*y,F(),a&&R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()},ve=$=>{F(),_($)},he=$=>{Q(),ve($)},Y=()=>{L=!0,E&&(cancelAnimationFrame(E),E=0),T&&clearInterval(T);try{window.removeEventListener("scroll",K)}catch{}try{window.removeEventListener("resize",ee)}catch{}try{window.removeEventListener("saveSlot:change",fe)}catch{}try{document.removeEventListener("ccc:upgrades:changed",fe)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",ve)}catch{}try{e.removeEventListener("pointerenter",he)}catch{}try{e.removeEventListener("pointerleave",X)}catch{}try{e.removeEventListener("pointercancel",X)}catch{}try{window.removeEventListener("blur",Q)}catch{}try{s.remove()}catch{}},te={passive:!0};return e.addEventListener("pointermove",_,te),e.addEventListener("pointerdown",ve,te),e.addEventListener("pointerenter",he,te),e.addEventListener("pointerleave",X,te),e.addEventListener("pointercancel",X,te),window.addEventListener("resize",ee),window.addEventListener("scroll",K,{passive:!0}),window.addEventListener("focus",F,{passive:!0}),window.addEventListener("blur",Q,{passive:!0}),document.addEventListener("visibilitychange",()=>{F(),document.hidden&&Q()},{passive:!0}),window.addEventListener("saveSlot:change",fe),document.addEventListener("ccc:upgrades:changed",fe),T=setInterval(F,1e3),fe(),{destroy:Y}}function Wd(){Ya=null,Va=null,Wa=null}function vy(e){let t=Yd.clone?.()??c.fromInt(1),n=gy(t),o=lo(fy),i=yy(e??Xc);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof _o=="function"&&_o()?lo(vs):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function hc(){let{coinGain:e,xpGain:t,mpGain:n}=vy(null);return{coins:e,xp:t,mp:n}}function Md(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=vy(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=Bn(Me.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{Cn=Cn?.add?Cn.add(r):lo(r)}catch{Cn=lo(r)}Ha(),a||dy(r);let u=typeof cn=="function"?cn():!0,d=typeof i?.isZero=="function"?i.isZero():!1;u&&!d&&py(i),s.isZero?.()||my(s)}function gw({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){Ud?.destroy&&Ud.destroy();let a=document.querySelector(t),u=document.querySelector(n),d=document.querySelector(o);if(!a||!u||!d)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!d}),{destroy(){}};lw(),dw(),a.style.touchAction="none";let f=null,p=null;Cn=O.coins.value,Hd=()=>{let C=J(Cn);C.includes("<span")?d.innerHTML=C:d.textContent=C},hy(),Ha();let g=C=>{C?.detail&&C.detail.key==="coins"&&(Cn=C.detail.value,Ha())};window.addEventListener("currency:change",g);let m=C=>{if(!(!C?.detail||C.detail.key!=="coins"))try{let{mult:W}=C.detail;W instanceof c?Xn=W.clone?.()??W:W!=null?Xn=c.fromAny(W):Xn=c.fromInt(1),fi=!!Xn?.isInfinite?.()}catch{Xn=null,fi=!1}};window.addEventListener("currency:multiplier",m);let y=v();if(y==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let h=`ccc:unlock:shop:${y}`,b=`ccc:unlock:shop:progress:${y}`,E=localStorage.getItem("ccc:unlock:shop:progress"),L=localStorage.getItem("ccc:unlock:shop");E!=null&&localStorage.getItem(b)==null&&localStorage.setItem(b,E),L!=null&&localStorage.getItem(h)==null&&localStorage.setItem(h,L),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let C=parseInt(localStorage.getItem(b)||"0",10);if(localStorage.setItem(b,String(C)),C>=10&&localStorage.getItem(h)!=="1"){try{ci()}catch{}localStorage.setItem(h,"1")}}let R=new URL(i,document.baseURI).href,T=C=>C instanceof HTMLElement?C._coinObj?!C._coinObj.isRemoved&&C.dataset.collected!=="1":C.dataset.collected!=="1"&&C.matches(r):!1;function F(C){try{C.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(F);let U=je?.12:.3,q=0;function x(C=R){if(C===R){let W=performance.now();if(W-q<40)return;q=W}dt(C,{volume:U})}function B(C,W={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(C);let ce=()=>{C&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(C):C.remove())};if(l||je){ce();return}let me="translate3d(0,0,0)";W.transform?W.transform!=="none"&&(me=W.transform):me=C.style.transform||"translate3d(0,0,0)",C.style.setProperty("--ccc-start",me),C.classList.add("coin--collected");let Z=!1,re=()=>{Z||(Z=!0,C.removeEventListener("animationend",re),ce())};C.addEventListener("animationend",re),setTimeout(re,600)}function M(C){if(!C||!C.length)return;let W=R,ce=-1,me=!1;for(let se of C){let ne=se.coin||se.el&&se.el._coinObj;ne&&(ne.sizeIndex!==void 0?ne.sizeIndex>ce&&(ce=ne.sizeIndex,ne.soundSrc&&(W=ne.soundSrc,me=!0)):ne.soundSrc&&!me&&(W=ne.soundSrc,me=!0))}x(W);let Z=null,re=null,ye=null,Le=0,ie=Bn(Me.COINS),Se=typeof cn=="function"?cn():!0,Ne=typeof _o=="function"&&_o(),_e=15,Re=0;for(let se of C){let ne=se.el,Ie=se.coin;if(!Ie&&ne&&ne._coinObj&&(Ie=ne._coinObj),ne&&!T(ne)||Ie&&Ie.isRemoved)continue;Le++,ne&&(ne.dataset.collected="1"),Re<_e?(!ne&&Ie&&e&&e.ensureCoinVisual&&(ne=e.ensureCoinVisual(Ie),ne&&(ne.dataset.collected="1")),ne?(B(ne,se.opts||{}),Re++):Ie&&e&&e.removeCoinTarget&&e.removeCoinTarget(Ie)):Ie&&e&&e.removeCoinTarget?e.removeCoinTarget(Ie):ne&&(e&&e.detachCoin&&e.detachCoin(ne),e&&e.recycleCoin?e.recycleCoin(ne):ne.remove());let w=ne?pw(ne):Yd,V=Ie?.mutationLevel??(ne?.dataset?.mutationLevel||null),z=gy(w),oe=lo(fy),ge=lo(vs);if(Ie&&Ie.valueMultiplier&&Ie.valueMultiplier>1){try{z=z.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{ge=ge.mulDecimalFloor(Ie.valueMultiplier)}catch{}}let ae=yy(V);if(ae){try{z=z.mulBigNumInteger(ae)}catch{}try{oe=oe.mulBigNumInteger(ae)}catch{}}ie||(Z=bs(Z,z)),Se&&(re=bs(re,oe)),Ne&&(ye=bs(ye,ge))}if(Le!==0){if(Z&&!Z.isZero?.()){try{Cn=Cn?.add?Cn.add(Z):lo(Z)}catch{Cn=lo(Z)}dy(Z),Ha()}if(re&&!re.isZero?.()&&py(re),ye&&!ye.isZero?.()&&my(ye),localStorage.getItem(h)!=="1"){let ne=parseInt(localStorage.getItem(b)||"0",10)+Le;if(localStorage.setItem(b,String(ne)),ne>=10){try{ci()}catch{}localStorage.setItem(h,"1")}}}}function _(C,W={}){return M([{el:C,opts:W}]),!0}f=hw({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:M,spawner:e}),p=ay(a);let X=C=>{if(C.target===u)return;let W=C.target.closest(r);if(W&&T(W)){let ce={};e&&typeof e.getCoinTransform=="function"&&(ce.transform=e.getCoinTransform(W)),_(W,ce)}};u.addEventListener("pointerdown",X,{passive:!0}),je||u.addEventListener("mouseover",X,{passive:!0});let Q=25,fe=null,K=()=>{let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;fe={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}};window.addEventListener("resize",K),window.addEventListener("scroll",K,{passive:!0}),K();let ee=null,ve=null,he=()=>{ee=null,ve=null};a.addEventListener("pointerleave",he,{passive:!0}),a.addEventListener("pointerenter",he,{passive:!0}),window.addEventListener("blur",he,{passive:!0});function Y(C,W){if(e&&typeof e.findCoinTargetsInRadius=="function"){fe||K();let ce=C,me=W,Z=[];if(typeof e.findCoinTargetsInPath=="function"&&ee!==null&&ve!==null?Z=e.findCoinTargetsInPath(ee,ve,ce,me,Q,!0):Z=e.findCoinTargetsInRadius(ce,me,Q,!0),ee=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye=0;ye<Z.length;ye++){let Le=Z[ye],ie={coin:Le};Le.el&&e.getCoinTransform&&(ie.opts={transform:e.getCoinTransform(Le.el)}),re.push(ie)}M(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){fe||K();let ce=C,me=W,Z=e.findCoinsInRadius(ce,me,Q);if(ee=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye of Z){let Le=e.getCoinTransform?e.getCoinTransform(ye):ye.style.transform;re.push({el:ye,opts:{transform:Le}})}M(re)}}else{let ce=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],me=new Set;for(let Z=0;Z<ce.length;Z++){let re=C+ce[Z][0],ye=W+ce[Z][1],Le=document.elementsFromPoint(re,ye);for(let ie=0;ie<Le.length;ie++){let Se=Le[ie];T(Se)&&!me.has(Se)&&me.add(Se)}}if(me.size>0){let Z=[];me.forEach(re=>Z.push({el:re})),M(Z)}}}let te=null,$=!1;function G(C,W){te={x:C,y:W},$||($=!0,requestAnimationFrame(()=>{te&&(Y(te.x,te.y),te=null),$=!1}))}a.addEventListener("pointerdown",C=>{G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointermove",C=>{C.pointerType!=="mouse"&&G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointerup",C=>{C.pointerType!=="mouse"&&G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("mousemove",C=>{G(C.clientX,C.clientY)},{passive:!0});function j(C){}let le=setInterval(K,1e3),ue=()=>{if(clearInterval(le),Yc(),Hd=()=>{},typeof window<"u"&&(window.removeEventListener("resize",K),window.removeEventListener("beforeunload",Yc),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",g),window.removeEventListener("blur",he)),typeof ui=="function"){try{ui()}catch{}ui=null}if(f?.destroy){try{f.destroy()}catch{}f=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",X),je||u.removeEventListener("mouseover",X)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(C=>a.replaceWith(a.cloneNode(!0)))}catch{}};return Ud={destroy:ue},{get count(){return Cn},set count(C){Cn=c.fromAny?c.fromAny(C):c.fromInt(Number(C)||0),Ha()},setMobileVolume:j,destroy:ue,collectBatch:M,getMagnetUnitPx:Xd}}var Xa,Hc,Xc,ui,Ud,fy,Yd,cw,ys,di,uw,vs,uy,Ya,Va,Wa,Dd,Cn,Hd,$d,Ha,mw,Gd,lo,bs,Yc,Vd,dy,py,my,Xn,fi,hy,gy,yy,Ra=De(()=>{bt();Ct();zt();Gc();qn();wo();Eo();un();ly();Pn();Xa=!1,Hc=!1,Xc="0",ui=null;Ud=null,fy=c.fromInt(1),Yd=c.fromInt(1),cw=c.fromInt(1);try{ys=c.fromAny("Infinity")}catch{ys=null}di=new Map,uw="1",vs=c.fromInt(1),uy=!1,Ya=null,Va=null,Wa=null,Dd=!1,Cn=null,Hd=()=>{},$d=!1,Ha=()=>{$d||($d=!0,requestAnimationFrame(()=>{$d=!1,Hd()}))};mw=.05,Gd=8;lo=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},bs=(e,t)=>{if(!t)return e;if(!e)return lo(t);try{return e.add(t)}catch{try{return lo(e).add(t)}catch{return lo(t)}}},Yc=()=>{let e=Ya;if(Ya=null,e&&!e.isZero?.())try{O.coins.add(e)}catch{}let t=Va;if(Va=null,t&&!t.isZero?.())try{qi(t)}catch{}let n=Wa;if(Wa=null,n&&!n.isZero?.())try{ls(n)}catch{}},Vd=()=>{Dd||(Dd=!0,requestAnimationFrame(()=>{Dd=!1,Yc()}))},dy=e=>{Ya=bs(Ya,e),Vd()},py=e=>{Va=bs(Va,e),Vd()},my=e=>{Wa=bs(Wa,e),Vd()};typeof window<"u"&&window.addEventListener("beforeunload",Yc,{passive:!0});Xn=null,fi=!1,hy=()=>{try{let e=O?.coins?.mult;if(!e||typeof e.get!="function"){Xn=null,fi=!1;return}let t=e.get();if(!t){Xn=c.fromInt(1),fi=!1;return}Xn=t.clone?.()??c.fromAny(t),fi=!!Xn?.isInfinite?.()}catch{Xn=null,fi=!1}},gy=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Xn||hy();let n=Xn;if(!n)try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(fi||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},yy=e=>{if(!Xa)return null;if(Hc){if(ys)try{return ys.clone?.()??ys}catch{return ys}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=di.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{di.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=Ss(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(cw)===0,s=r.clone?.()??r;if(di.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function Iy(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let i=Number(e.toString());isNaN(i)||(t=i),(e==="Infinity"||i===1/0)&&(n=!0)}catch{}let o=[],r=[];for(let i of Sy){let s=i;if(n){s={...i,description:[...i.description]};let l=Ft(),a=Sn(),u=l+a;if(u>1&&(u=1),i.id===1){let d=Math.pow(10,u),f=J(c.fromAny(d));Math.abs(d-Math.round(d))>.001?(f=d.toFixed(2),f.endsWith(".00")&&(f=f.slice(0,-3))):d<1e3&&(f=String(Math.round(d))),s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===2){let d=Math.pow(10,u),f=J(c.fromAny(d));Math.abs(d-Math.round(d))>.001?(f=d.toFixed(2),f.endsWith(".00")&&(f=f.slice(0,-3))):d<1e3&&(f=String(Math.round(d))),s.description[1]=s.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===4){let d=Math.log10(4444e9),f=Ae(d*u),p=J(f);s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${p}x</span>`)}}i.surgeLevel<=t?o.push(s):r.push(s)}return[...o,...r.slice(0,2)]}var Sy,zd,wy=De(()=>{zt();Ct();un();so();ni();Sy=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${J(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]}],zd=Sy.filter(e=>e.affectedByTsunami).map(e=>e.id)});function Ey(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=dt("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function d(w,V){w.style.position="absolute",w.style.left="50%";let z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ge=!!o.mpHTML;V==="coin"?(w.style.top="77%",w.style.transform=`translateX(-50%) ${z}`):oe&&ge?(w.style.top="72.5%",V==="mp"?w.style.transform=`translateX(calc(-100% - 44px)) ${z}`:w.style.transform=`translateX(44px) ${z}`):(V==="mp"?w.style.top="66%":V==="xp"&&(w.style.top="72%"),w.style.transform=`translateX(-50%) ${z}`),w.style.transformOrigin="center center";let ae=w.firstElementChild;ae&&(ae.removeAttribute("hidden"),ae.style.display="flex")}if(o.coinHTML){let w=document.createElement("div");w.innerHTML=o.coinHTML,d(w,"coin"),u.appendChild(w)}if(o.xpHTML){let w=document.createElement("div");w.innerHTML=o.xpHTML,d(w,"xp"),u.appendChild(w)}if(o.mpHTML){let w=document.createElement("div");w.innerHTML=o.mpHTML,d(w,"mp"),u.appendChild(w)}e.appendChild(u);let f=document.createElement("canvas");f.id="tsunami-fg-canvas",f.style.position="absolute",f.style.inset="0",f.style.width="100%",f.style.height="100%",f.style.zIndex="2147483646",f.style.pointerEvents="none",e.appendChild(f);let p=new Image;p.src="img/misc/merchant.webp";let g=!1;p.onload=()=>{g=!0},p.onerror=w=>{console.error("Tsunami: Merchant load failed",w)};let m,y,h=[],b=[],E=0;function L(){h=[],b=[];let w=y*.65,V=w+y*.15,oe=300*(Math.min(m,y)*5e-4),ge=m*.8,ae=ge-oe*.6,qe=ge+oe*.6;for(let st=0;st<100;st++){let rn=Math.random()*m,Tt=V+Math.random()*(y-V);b.push({x:rn,y:Tt})}let tt=(st,rn,Tt)=>{if(st>m*.1&&st<m*.9){let gn=y-w,ho=w+gn*.15;if(rn>ho)return!1}else if(Tt==="tree"){let gn=y-w,ho=w+gn*.5;if(rn>ho)return!1}return!(Tt==="tree"&&st>ae&&st<qe)},be=(st,rn,Tt,gn,ho)=>{for(let nr=0;nr<rn;nr++){let ko,To,or=!1,S=0;for(;!or&&S<50;){ho?ko=ho():ko=Math.random()*m;let k=y,P=Math.random();if(To=w+20+P*P*(k-w-20),tt(ko,To,st)&&(or=!0,st==="tree")){for(let A of h)if(A.type==="tree"){let N=A.x-ko,pe=A.y-To;if(Math.sqrt(N*N+pe*pe)<Math.max(m*.08,100)){or=!1;break}}}S++}if(or){let P=.6+(To-w)/(y-w)*.6,A=(Tt+Math.random()*gn)*P;h.push({type:st,x:ko,y:To,scale:A})}}},Be=3+Math.floor(Math.random()*3);be("tree",Be,.8,.4,()=>Math.random()*(m*.1)),be("tree",Be,.8,.4,()=>m*.9+Math.random()*(m*.1));let Gt=5+Math.floor(Math.random()*3);be("tree",Gt,.8,.4,()=>m*.1+Math.random()*(m*.8)),be("rock",20,.6,.4),be("shell",30,.3,.3),h.sort((st,rn)=>st.y-rn.y)}let R=a.getContext("2d",{alpha:!1}),T=f.getContext("2d",{alpha:!0});function F(){let w=window.devicePixelRatio||1;m=window.innerWidth,y=window.innerHeight,a.width=m*w,a.height=y*w,a.style.width=m+"px",a.style.height=y+"px",f.width=m*w,f.height=y*w,f.style.width=m+"px",f.style.height=y+"px",R.scale(w,w),T.scale(w,w),L(),E=-50}window.addEventListener("resize",F),F();let U=Date.now(),q=!0,x,B=!1,M={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},X=!1,Q=[],fe=0,K=!1,ee=0,ve=5e3,he=!1,Y=0,te=[],$=6;for(let w=0;w<$;w++)te.push({offset:Math.random()*1e3,speedBase:.001+w*5e-4,amplitudeBase:10+w*5});let G=[],j=400;function le(w,V,z){return w*(1-z)+V*z}function ue(w){let V=parseInt(w.slice(1),16);return{r:V>>16&255,g:V>>8&255,b:V&255}}function C(w,V,z){let oe=ue(w),ge=ue(V),ae=Math.round(le(oe.r,ge.r,z)),qe=Math.round(le(oe.g,ge.g,z)),tt=Math.round(le(oe.b,ge.b,z));return`rgb(${ae},${qe},${tt})`}function W(w,V,z){let oe=[],ge=w,ae=V,qe=20;for(;ae<z;){let tt=ge+(Math.random()-.5)*60,be=ae+qe+Math.random()*30;oe.push({x1:ge,y1:ae,x2:tt,y2:be}),ge=tt,ae=be}return oe}function ce(w,V,z,oe,ge,ae){w.beginPath(),w.moveTo(V+ae,z),w.lineTo(V+oe-ae,z),w.quadraticCurveTo(V+oe,z,V+oe,z+ae),w.lineTo(V+oe,z+ge-ae),w.quadraticCurveTo(V+oe,z+ge,V+oe-ae,z+ge),w.lineTo(V+ae,z+ge),w.quadraticCurveTo(V,z+ge,V,z+ge-ae),w.lineTo(V,z+ae),w.quadraticCurveTo(V,z,V+ae,z),w.closePath()}function me(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(10,-40,-5,-80),w.lineTo(5,-80),w.quadraticCurveTo(20,-40,10,0),w.fillStyle=ge.rock,w.fill(),w.translate(0,-80),w.fillStyle=ge.leaf;for(let ae=0;ae<7;ae++)w.save(),w.rotate(ae/7*Math.PI*2-Math.PI/2),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(30,-10,60,0),w.quadraticCurveTo(30,10,0,0),w.fill(),w.restore();w.restore()}function Z(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.fillStyle=ge.rock,w.beginPath(),w.moveTo(-20,0),w.bezierCurveTo(-20,-15,-10,-25,0,-25),w.bezierCurveTo(10,-25,20,-15,20,0),w.fill(),w.fillStyle="rgba(0,0,0,0.2)",w.beginPath(),w.ellipse(0,0,20,5,0,0,Math.PI*2),w.fill(),w.restore()}function re(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.fillStyle=ge.shell,w.beginPath(),w.arc(0,0,10,Math.PI,0),w.lineTo(0,0),w.fill(),w.strokeStyle=ge.sandDark,w.lineWidth=1,w.beginPath();for(let ae=1;ae<5;ae++){let qe=Math.PI+ae/5*Math.PI;w.moveTo(0,0),w.lineTo(Math.cos(qe)*10,Math.sin(qe)*10)}w.stroke(),w.restore()}function ye(w,V,z,oe,ge){w.fillStyle=ge.sandDark,w.fillRect(-50,oe,V+100,z-oe),w.fillStyle=ge.sandDark,w.save(),w.fillStyle=ge.sandLight,w.globalAlpha=.3,w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,oe),w.bezierCurveTo(V*.3,oe-20,V*.7,oe+20,V+50,oe),w.lineTo(V+50,z+100),w.fill(),w.globalAlpha=.6;let ae=oe+z*.05;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,ae),w.bezierCurveTo(V*.4,ae+40,V*.6,ae-10,V+50,ae+20),w.lineTo(V+50,z+100),w.fill(),w.globalAlpha=1;let qe=oe+z*.15;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,qe),w.bezierCurveTo(V*.2,qe-10,V*.8,qe+30,V+50,qe+10),w.lineTo(V+50,z+100),w.fill(),w.fillStyle=ge.sandDark,w.globalAlpha=.1,b.forEach(tt=>{w.fillRect(tt.x,tt.y,2,2)}),w.restore()}function Le(w,V,z,oe=null){let ge=oe||1,ae=!!oe&&oe>5;X&&!ae&&!he&&dt("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),Q.push({x:ae?V/2:Math.random()*V,y:ae?z/2:Math.random()*z,radius:0,maxRadius:ae?Math.max(V,z)*1.5:(100+Math.random()*400)*ge,speed:ae?40:(5+Math.random()*15)*ge,opacity:1,hue:225+Math.random()*15,life:1})}function ie(w,V,z,oe=.5,ge=!0){let ae=.1+oe*.7,qe=Math.floor(1+oe*4);if(ge&&!he){for(let tt=0;tt<qe;tt++)if(Q.length<50&&Math.random()<ae){let be=1+oe*2;Le(w,V,z,be)}}w.save(),w.globalCompositeOperation="lighter";for(let tt=Q.length-1;tt>=0;tt--){let be=Q[tt];if(be.radius+=be.speed,be.opacity-=.015,be.life-=.015,be.opacity<=0||be.radius>be.maxRadius){Q.splice(tt,1);continue}let Be=w.createRadialGradient(be.x,be.y,0,be.x,be.y,be.radius),Gt=be.opacity;Be.addColorStop(0,`hsla(${be.hue}, 100%, 80%, ${Gt})`),Be.addColorStop(.3,`hsla(${be.hue}, 100%, 40%, ${Gt*.9})`),Be.addColorStop(.7,`hsla(${be.hue}, 100%, 15%, ${Gt*.6})`),Be.addColorStop(1,`hsla(${be.hue}, 100%, 5%, 0)`),w.fillStyle=Be,w.beginPath(),w.arc(be.x,be.y,be.radius,0,Math.PI*2),w.fill()}w.restore()}function Se(){if(!q)return;let w=Date.now(),V=w-U;Math.min(V/t,1)>=1&&!B&&(B=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ge=6e3,ae=5e4,qe=5e4,tt=5e3,be=4e4,Be=0;V<ge?Be=0:V<ae?Be=(V-ge)/(ae-ge):Be=1;let Gt=0;V>be&&(Gt=Math.max(0,(V-be)/(ae-be))),V>ae&&(Gt=1),Gt>.1&&!i&&(i=dt("sounds/tsu_rumble.ogg",{volume:.8}));let st={skyTop:C(M.skyTop,_.skyTop,Be),skyBottom:C(M.skyBottom,_.skyBottom,Be),sun:C(M.sun,_.sun,Be),waterDeep:C(M.waterDeep,_.waterDeep,Be),waterMid:C(M.waterMid,_.waterMid,Be),waterPeak:C(M.waterPeak,_.waterPeak,Be),foam:C(M.foam,_.foam,Be),sandLight:C(M.sandLight,_.sandLight,Be),sandDark:C(M.sandDark,_.sandDark,Be),rock:C(M.rock,_.rock,Be),leaf:C(M.leaf,_.leaf,Be),shell:C(M.shell,_.shell,Be)},rn=0,Tt=0;if(Be>.5||he){let S=(Be-.5)*2*5+Gt*25;Y>0&&(S+=50),rn=(Math.random()-.5)*S,Tt=(Math.random()-.5)*S}T.clearRect(0,0,m,y),R.save(),R.translate(rn,Tt),T.save(),T.translate(rn,Tt);let gn=R.createLinearGradient(0,0,0,y);if(gn.addColorStop(0,st.skyTop),gn.addColorStop(1,st.skyBottom),R.fillStyle=gn,R.fillRect(-50,-50,m+100,y+100),Be<1){let S=y*.15+Be*50;R.beginPath(),R.arc(m*.7,S,40,0,Math.PI*2),R.fillStyle=st.sun,R.globalAlpha=1-Be,R.shadowColor=st.sun,R.shadowBlur=20,R.fill(),R.globalAlpha=1,R.shadowBlur=0}let ho=y*.65;if(g&&Be<1){R.save();let S=Math.min(m,y)*5e-4,k=300*S,P=300*S,A=m*.8,N=P*.15,pe=ho-P/2+N;R.translate(A,pe),R.rotate(.1),R.drawImage(p,-k/2,-P/2,k,P),R.restore()}if(ye(R,m,y,ho,st),h.forEach(S=>{S.type==="tree"?me(R,S.x,S.y,S.scale,st):S.type==="rock"?Z(R,S.x,S.y,S.scale,st):S.type==="shell"&&re(R,S.x,S.y,S.scale,st)}),Be>.3){let S=(Be-.3)/.7,k=Math.floor(j*S);if(T.strokeStyle=`rgba(120, 180, 255, ${.1+S*.3})`,T.lineWidth=1+S,T.beginPath(),G.length<k)for(let A=0;A<10;A++)G.push({x:Math.random()*m*1.5,y:E,speed:20+Math.random()*20,len:10+Math.random()*20});let P=10+S*20;for(let A=0;A<G.length;A++){let N=G[A];N.y+=N.speed,N.x-=P,T.moveTo(N.x,N.y),T.lineTo(N.x-P*.5,N.y+N.len),(N.y>y||N.x<-100)&&(A<k?(N.x=Math.random()*m*1.5,N.y=E):(G.splice(A,1),A--))}T.stroke()}let nr=.3;if(Be>nr){let S=(Be-nr)/(1-nr),k=le(0,y*1.5,S*S);T.fillStyle=st.waterDeep,T.beginPath(),T.moveTo(-50,y+100),T.lineTo(-50,y-k*.3),T.bezierCurveTo(m*.3,y-k*.4,m*.6,y-k*1.2,m+50,y-k*.8),T.lineTo(m+50,y+100),T.fill()}let ko=le(0,y*.5,Be),To=le(0,y*1.5,Gt*Gt),or=y*.85-ko-To;if(te.forEach((S,k)=>{let P;k===$-1?P=st.waterPeak:k%2===0?P=st.waterDeep:P=st.waterMid,T.fillStyle=P,T.beginPath();let A=S.amplitudeBase*(1+Be*2+Gt*5),N=.003+Be*.005,pe=S.speedBase*(1+Be*5+Gt*10),de=V*pe+S.offset,ke=k*15*(1-Gt),Oe=or+ke;T.moveTo(-50,y+100),T.lineTo(-50,Oe);for(let Pe=-50;Pe<=m+50;Pe+=15){let Te=Oe+Math.sin(Pe*N+de)*A+Math.cos(Pe*N*2.3+de)*(A*.5);T.lineTo(Pe,Te)}if(T.lineTo(m+50,y+100),T.fill(),k===$-1||Be>.6&&k>$-3){T.save(),T.globalAlpha=.1+Be*.3,T.fillStyle=st.foam,T.beginPath();for(let Pe=-50;Pe<=m+50;Pe+=10){let Te=Oe+Math.sin(Pe*N+de)*A+Math.cos(Pe*N*2.3+de)*(A*.5);Math.random()>.5&&(Te-=5),Pe===-50?T.moveTo(Pe,Te):T.lineTo(Pe,Te)}T.lineTo(m+50,y+100),T.lineTo(-50,y+100),T.fill(),T.restore()}}),V<oe){let S=1;V>1e3&&(S=1-(V-1e3)/(oe-1e3)),T.fillStyle=`rgba(0, 0, 0, ${S})`,T.fillRect(-50,-50,m+100,y+100)}if(V>qe){let S=Math.min(1,(V-qe)/tt);T.fillStyle=`rgba(0, 0, 0, ${S})`,T.fillRect(-50,-50,m+100,y+100)}if(X){let S=w-fe,k=12e3,P=0,A=!0;S<k?P=S/k:(P=1,he||(he=!0,Le(T,m,y,25),Y=60,l||(l=!0,dt("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),K&&(A=!1),ie(T,m,y,P,A)}if(K){let S=w-ee,k=Math.min(1,S/ve);T.fillStyle=`rgba(0, 0, 0, ${k})`,T.fillRect(-50,-50,m+100,y+100)}if(Y>0){let S=Y/60,k=S*S;T.fillStyle=`rgba(255, 255, 255, ${k})`,T.fillRect(-50,-50,m+100,y+100),Y--}R.restore(),T.restore(),x=requestAnimationFrame(Se)}function Ne(){q=!1,e.style.cursor="",x&&cancelAnimationFrame(x),window.removeEventListener("resize",F),a.parentNode&&a.parentNode.removeChild(a),f.parentNode&&f.parentNode.removeChild(f),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function _e(){X=!0,fe=Date.now(),he=!1,Y=0,s||(s=dt("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Re(){K=!0,ee=Date.now(),s&&s.stop()}function se(){e.style.cursor=""}function ne(){e.style.cursor="none"}function Ie(){s&&(s.stop(),s=null)}return Se(),{cleanup:Ne,triggerBeacons:_e,triggerFinalFade:Re,showCursor:se,hideCursor:ne,stopHumLoop:Ie}}var xy=De(()=>{Pn()});var sv={};vt(sv,{canPerformForgeReset:()=>tv,canPerformInfuseReset:()=>nv,computeForgeGoldFromInputs:()=>$y,computeInfuseMagicFromInputs:()=>qy,computePendingForgeGold:()=>ev,computeSurgeWavesFromInputs:()=>Gy,getCurrentSurgeLevel:()=>wn,getForgeDebugOverrideState:()=>Vy,getInfuseDebugOverrideState:()=>zy,getSurgeBarLevelKey:()=>Is,getSurgeDebugOverrideState:()=>Zy,hasDoneExperimentReset:()=>Qy,hasDoneForgeReset:()=>Er,hasDoneInfuseReset:()=>$t,hasDoneSurgeReset:()=>xo,initResetPanel:()=>Ld,initResetSystem:()=>Ho,isExperimentUnlocked:()=>su,isForgeUnlocked:()=>ms,isInfuseUnlocked:()=>iu,isSurgeUnlocked:()=>ws,onForgeUpgradeUnlocked:()=>xp,onInfuseUpgradeUnlocked:()=>Lp,onSurgeUpgradeUnlocked:()=>_p,performForgeReset:()=>Sp,performInfuseReset:()=>Ip,performSurgeReset:()=>wp,recomputePendingMagic:()=>Wn,setExperimentResetCompleted:()=>Yy,setForgeDebugOverride:()=>Wy,setForgeResetCompleted:()=>up,setInfuseDebugOverride:()=>jy,setInfuseResetCompleted:()=>fp,setInfuseUnlockedForDebug:()=>Ky,setSurgeResetCompleted:()=>dp,setSurgeUnlockedForDebug:()=>Jy,shouldBlockBigCoins:()=>Ja,updateResetPanel:()=>Ve});function op(e){return!xw.includes(e)}function Lw(){dt(Iw,{volume:.4})}function _w(){dt(ww,{volume:.45})}function Cw(){dt(Ew,{volume:.5})}function Ja(){return By}function Fy(){let e=kn(),t=O.waves?.value??St(),n=0n;try{n=el(e)}catch{}let o=I.pendingWaves,r=Ep(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),By=i&&!In()}function Za(){Zd=null}function tu(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function nu(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function Jd(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Tw(e=null){try{if(e){let t=e instanceof xt?e:xt.fromAny(e??1);return t.isInfinite?.()?xt.fromAny("Infinity"):I.pendingGold.mulBigNumInteger(t)}return O.gold?.mult?.applyTo?.(I.pendingGold)??I.pendingGold}catch{return I.pendingGold}}function Aw(){for(;Yn.length;){let e=Yn.pop();try{e?.()}catch{}}}function jd(){!My&&typeof Rl=="function"&&(My=Rl((e={})=>{e?.key&&e.key!==Me.COINS&&e.key!==Me.WAVES||e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(e?.key===Me.WAVES?(au(),Ve()):(Mn(),Wn(),Vn()))})),!ky&&typeof Xl=="function"&&(ky=Xl((e={})=>{e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(Mn(),Vn(),Cr(),Ve())}))}function cp(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=$e(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Qa(){try{let e=Qe();if(e&&e.xpLevel)return e.xpLevel}catch{}return St()}function Uy(e,t){if(!e||typeof e!="object")return St();let n=$e(e);if(!Number.isFinite(n)&&n>0)return xt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return St();let r=Ae(o*Math.log10(2)),i=Math.max(0,cp(t)),s=Math.max(0,(i-30)/5),l=s<=0?Ly():Ae(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?Ly():Ae(a*Math.log10(1.15)),d=xt.fromInt(10);d=d.mulBigNumInteger(r),d=d.mulBigNumInteger(l),d=d.mulBigNumInteger(u);let f=d.floorToInteger();return f.isZero?.()?St():f}function Nw(e,t){if(!e)return St();let n=$e(e);if(!Number.isFinite(n)&&n>0)return xt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let g=$e(t);Number.isFinite(g)&&(a=Math.max(0,g-4))}let u=o*i,d=Math.floor(o)*s,f=a*l,p=r+u+d+f;return Number.isFinite(p)?Ae(p).floorToInteger():xt.fromAny("Infinity")}function Dy(e,t,n=null){let o=Nw(e,t);if(n){let r=n instanceof xt?n:xt.fromAny(n??1);return r.isInfinite?.()?xt.fromAny("Infinity"):o.mulBigNumInteger(r)}return O.magic?.mult?.applyTo?.(o)??o}function $y(e,t){return Uy(e,t)}function qy(e,t){return Dy(e,t)}function Gy(e,t,n,o,r){return Hy(e,t,n,o,r)}function Hy(e,t,n,o,r){let i=cp(e);if(i<201)return St();let s=(i-201)/35,l=$e(t),a=$e(n),u=$e(o),d=$e(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||d===Number.POSITIVE_INFINITY)return xt.fromAny("Infinity");let f=0;Number.isFinite(l)&&l>24&&(f+=(l-24)*zc),Number.isFinite(a)&&a>13&&(f+=(a-13)*zc),Number.isFinite(u)&&u>5&&(f+=(u-5)*zc),Number.isFinite(d)&&d>12&&(f+=(d-12)*zc);let p=1+f+s;return Number.isFinite(p)?Ae(p).floorToInteger():xt.fromAny("Infinity")}function Xy(){return Math.max(0,cp(Qa()))}function kn(){if(I.slot!=null)return I.slot;let e=v();return I.slot=e,e}function up(e){let t=kn();if(t!=null){I.hasDoneForgeReset=!!e;try{localStorage.setItem(rp(t),I.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function fp(e){let t=kn();if(t!=null){I.hasDoneInfuseReset=!!e;try{localStorage.setItem(ip(t),I.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function dp(e){let t=kn();if(t!=null){I.hasDoneSurgeReset=!!e;try{localStorage.setItem(sp(t),I.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Yy(e){let t=kn();if(t!=null){I.hasDoneExperimentReset=!!e;try{localStorage.setItem(lp(t),I.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function ru(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Ka(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Vy(e=v()){return ru(e)}function Wy(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(I.forgeDebugOverride!==n){if(I.forgeDebugOverride=n,n==null)try{localStorage.removeItem(Ka(t))}catch{}else try{localStorage.setItem(Ka(t),n?"1":"0")}catch{}rt(Ka(t)),tu(),Ve()}}function pp(e=v()){if(e==null)return null;try{let t=localStorage.getItem(ja(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function zy(e=v()){return pp(e)}function Ky(e){mp(e)}function jy(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(I.infuseDebugOverride!==n){if(I.infuseDebugOverride=n,n==null)try{localStorage.removeItem(ja(t))}catch{}else try{localStorage.setItem(ja(t),n?"1":"0")}catch{}rt(ja(t)),nu(),Ve()}}function mp(e){let t=kn();if(t==null)return;let n=!!e;if(I.infuseUnlocked!==n){I.infuseUnlocked=n;try{localStorage.setItem(Qc(t),I.infuseUnlocked?"1":"0")}catch{}rt(Qc(t)),nu()}}function ou(e){let t=kn();if(t==null)return;let n=!!e;if(I.forgeUnlocked!==n){I.forgeUnlocked=n;try{localStorage.setItem(Jc(t),I.forgeUnlocked?"1":"0")}catch{}rt(Jc(t)),tu()}}function hp(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Py(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Zy(e=v()){return hp(e)}function Jy(e){gp(e)}function gp(e){let t=kn();if(t==null)return;let n=!!e;if(I.surgeUnlocked!==n){I.surgeUnlocked=n;try{localStorage.setItem(eu(t),I.surgeUnlocked?"1":"0")}catch{}rt(eu(t)),Jd()}}function Qd(e){if(e==null){I.forgeUnlocked=!1,I.forgeDebugOverride=null,I.hasDoneForgeReset=!1,I.infuseUnlocked=!1,I.infuseDebugOverride=null,I.hasDoneInfuseReset=!1,I.surgeUnlocked=!1,I.surgeDebugOverride=null,I.hasDoneSurgeReset=!1,I.hasDoneExperimentReset=!1,I.flagsPrimed=!1;return}try{I.forgeUnlocked=localStorage.getItem(Jc(e))==="1"}catch{I.forgeUnlocked=!1}I.forgeDebugOverride=ru(e);try{I.hasDoneForgeReset=localStorage.getItem(rp(e))==="1"}catch{I.hasDoneForgeReset=!1}try{I.infuseUnlocked=localStorage.getItem(Qc(e))==="1"}catch{I.infuseUnlocked=!1}try{I.hasDoneInfuseReset=localStorage.getItem(ip(e))==="1"}catch{I.hasDoneInfuseReset=!1}I.infuseDebugOverride=pp(e);try{I.surgeUnlocked=localStorage.getItem(eu(e))==="1"}catch{I.surgeUnlocked=!1}I.surgeDebugOverride=hp(e);try{I.hasDoneSurgeReset=localStorage.getItem(sp(e))==="1"}catch{I.hasDoneSurgeReset=!1}try{I.hasDoneExperimentReset=localStorage.getItem(lp(e))==="1"}catch{I.hasDoneExperimentReset=!1}I.flagsPrimed=!0}function co(){let e=v();if(e==null){I.flagsPrimed=!1;return}I.slot!==e&&(I.slot=e,Za(),I.flagsPrimed=!1),I.flagsPrimed||Qd(e)}function Ty(e){_y!==e&&(Aw(),_y=e,e!=null&&(Yn.push(_t(Jc(e),{onChange(t){let n=t==="1";I.forgeUnlocked!==n&&(I.forgeUnlocked=n,tu(),Ve())}})),Yn.push(_t(rp(e),{onChange(t){let n=t==="1";I.hasDoneForgeReset!==n&&(I.hasDoneForgeReset=n,Ve())}})),Yn.push(_t(Ka(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.forgeDebugOverride!==n&&(I.forgeDebugOverride=n,tu(),Ve())}})),Yn.push(_t(Qc(e),{onChange(t){let n=t==="1";I.infuseUnlocked!==n&&(I.infuseUnlocked=n,nu(),Ve())}})),Yn.push(_t(ip(e),{onChange(t){let n=t==="1";I.hasDoneInfuseReset!==n&&(I.hasDoneInfuseReset=n,Ve())}})),Yn.push(_t(ja(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.infuseDebugOverride!==n&&(I.infuseDebugOverride=n,nu(),Ve())}})),Yn.push(_t(eu(e),{onChange(t){let n=t==="1";I.surgeUnlocked!==n&&(I.surgeUnlocked=n,Jd(),Ve())}})),Yn.push(_t(Py(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.surgeDebugOverride!==n&&(I.surgeDebugOverride=n,Jd(),Ve())}})),Yn.push(_t(sp(e),{onChange(t){let n=t==="1";I.hasDoneSurgeReset!==n&&(I.hasDoneSurgeReset=n,Ve())}})),Yn.push(_t(lp(e),{onChange(t){let n=t==="1";I.hasDoneExperimentReset!==n&&(I.hasDoneExperimentReset=n,Ve())}}))))}function Rw(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function Mn(e=!1){let t=O.coins?.value??St(),n=Qa(),o=Rw(t,n);!e&&Zd===o||(Zd=o,yp()?I.pendingGold=Uy(t,n):I.pendingGold=St(),Ve())}function Wn(e=null){let t=O.coins?.value??St(),n=tl();vp()?I.pendingMagic=Dy(t,n,e):I.pendingMagic=St(),Vn(),Ve()}function Vn(){if(!ws()){I.pendingWaves=St(),Cr();return}let e=Qa(),t=O.coins?.value??St(),n=O.gold?.value??St(),o=O.magic?.value??St(),r=tl();I.pendingWaves=Hy(e,t,n,o,r),xo()||I.pendingWaves.cmp(xt.fromInt(10))>0&&(I.pendingWaves=xt.fromInt(10)),Cr(),Fy()}function Cr(){if(!su()){I.pendingDna=St();return}let e=fn?fn():St(),t=Qa();try{I.pendingDna=e.add(t)}catch{I.pendingDna=St()}}function ep(){let e=ru();return e!=null?!!e:I.forgeUnlocked||Mt(xe.STARTER_COVE,we.UNLOCK_FORGE)>=1}function yp(){try{let e=Qa();if(e&&typeof e.cmp=="function")return e.cmp(Mw)>=0}catch{}return!1}function vp(){try{let e=lt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(kw)>=0}catch{}return!1}function ms(){co();let e=ru();return e!=null?!!e:!!I.forgeUnlocked||ep()}function iu(){co();let e=pp();return e!=null?!!e:!!I.infuseUnlocked}function ws(){co();let e=hp();return e!=null?!!e:!!I.surgeUnlocked}function su(){return tg()}function wn(){let e=kn();return e==null?0n:el(e)}function Er(){return co(),!!I.hasDoneForgeReset}function $t(){return co(),!!I.hasDoneInfuseReset}function xo(){return co(),!!I.hasDoneSurgeReset}function Qy(){return co(),!!I.hasDoneExperimentReset}function ev(){return Mn(),I.pendingGold.clone?.()??I.pendingGold}function tv(){return!(!ms()||!yp()||I.pendingGold.isZero?.())}function nv(){return!(!iu()||!vp()||I.pendingMagic.isZero?.())}function Ow({resetGold:e=!1,resetMagic:t=!1}={}){let n=Ut(xe.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===we.UNLOCK_XP||r===we.UNLOCK_FORGE||r===we.UNLOCK_INFUSE||r===we.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||Wo(xe.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function bp({resetGold:e=!1,resetMagic:t=!1}={}){try{O.coins.set(0)}catch{}try{O.books.set(0)}catch{}try{$i({keepUnlock:!0})}catch{}try{Wd()}catch{}Ow({resetGold:e,resetMagic:t})}function Sp(){if(!tv())return!1;let e=I.pendingGold.clone?.()??I.pendingGold;try{let t=O.gold?.mult?.applyTo?.(e)??e;O.gold?.add&&O.gold.add(t)}catch{}if(bp({resetGold:!1}),Mn(),ou(!0),I.hasDoneForgeReset||up(!0),Vt(),Mr(),op("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return Ve(),!0}function Ip(){if(!nv())return!1;let e=I.pendingMagic.clone?.()??I.pendingMagic;try{O.magic?.add&&O.magic.add(e)}catch{}bp({resetGold:!0});try{O.gold.set(0)}catch{}try{let t=v(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Vt({forceReload:!0})}catch{}if(Mn(),Wn(),op("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return mp(!0),I.hasDoneInfuseReset||fp(!0),Ve(),!0}function tp(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=kn();try{O.waves?.add&&e&&!e.isZero?.()&&O.waves.add(e)}catch{}bp({resetGold:!0,resetMagic:!0});try{O.gold.set(0)}catch{}try{O.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Vt({forceReload:!0})}catch{}if(au(),gp(!0),I.hasDoneSurgeReset||dp(!0),Mn(),Wn(),Vn(),t&&(n||Cw(),n||Fw()),op("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}Ve()}function Pw(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{ny(!0)}catch{}try{Ec()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,hr(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=Ey(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),qg(e,()=>{setTimeout(Bw,0)},i)},r);Zc=i.cleanup}function Bw(){Zc&&(Zc(),Zc=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),tp(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=v();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function wp(){if(!ws()||Xy()<201)return!1;let e=I.pendingWaves.clone?.()??I.pendingWaves;if(e.isZero?.())return!1;let t=kn(),n=O.waves?.value??St(),o=el(t),r=Ep(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!In()?(Pw(),tp(e,{playEffects:!1}),!0):(tp(e,{playEffects:!0}),!0)}function Fw(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function el(e){let t=0n;try{let n=localStorage.getItem(ap(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function Uw(e){let t=ap(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function Ay(e){if(!(e instanceof xt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function ov(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=Ay(n),l=Ay(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let d=new c(10n,{base:0,offset:u}),f=d.sub(r).div(c.fromInt(9));n.cmp(f)>=0&&(n=n.sub(f),o=u,i=!0,r=d)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function au(){let e=kn();if(e==null||!ws()||Kd||Uw(e))return;let t=O.waves?.value??St(),n=el(e);if(n===1/0)return;let o=ov(n,t);if(o.changed){n=o.level;try{localStorage.setItem(ap(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}Kd=!0;try{O.waves.set(o.remainingWaves)}finally{Kd=!1}Ve(),o.safety>=100&&setTimeout(au,0)}Fy()}function za(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=xt.fromInt(e)}catch{}try{return J(t)}catch{return e?.toString?.()??"0"}}function Dw(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${yw}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${vw}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${bw}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${Sw}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Ny}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Ry}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${jc}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Oy}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,I.panel=e,I.elements.forge.card=e.querySelector("#reset-card-forge"),I.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),I.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),I.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),I.elements.infuse.card=e.querySelector("#reset-card-infuse"),I.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),I.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),I.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),I.elements.surge.card=e.querySelector("#reset-card-surge"),I.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),I.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),I.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),I.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),I.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),I.elements.surge.headerVal=e.querySelector("[data-surge-level]"),I.elements.surge.header=e.querySelector(".surge-header"),I.elements.experiment.card=e.querySelector("#reset-card-experiment"),I.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),I.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");I.elements.surge.milestones&&t&&ss(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),I.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(I.layerButtons).forEach(([n,o])=>{if(!o)return;let r=null,i=s=>{if(s&&s.isTrusted&&to(o))return;let l=I.elements[n]?.card;if(l){let a=l.closest(".merchant-content");n==="forge"&&a?a.scrollTo({top:0,behavior:"smooth"}):l.scrollIntoView({behavior:"smooth",block:"start"})}};o.addEventListener("click",s=>{if(r&&r!=="mouse"){r=null;return}r=null,i(s)})}),I.elements.forge.btn&&I.elements.forge.btn.addEventListener("click",()=>{Sp()&&(Lw(),Ve())}),I.elements.infuse.btn&&I.elements.infuse.btn.addEventListener("click",()=>{Ip()&&(_w(),Ve())}),I.elements.surge.btn&&I.elements.surge.btn.addEventListener("click",()=>{wp()&&Ve()}),Ve()}function Ld(e){!e||e.__resetInit||(e.__resetInit=!0,Dw(e))}function Vo(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=za(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let d=e.querySelector(".merchant-reset__action-icon img");d&&!d.src.includes(n)&&(d.src=n)}}function rv({goldMult:e=null}={}){let t=I.elements.forge;if(!(!t.card||!t.btn)){if(!ms()){Vo(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(co(),t.card.classList.toggle("is-forge-complete",!!I.hasDoneForgeReset),t.status)if(I.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!yp()){Vo(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Vo(t.btn,{disabled:!1},Ny,Tw(e))}}function iv(){let e=I.elements.infuse;if(!(!e.card||!e.btn)){if(!iu()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="none"&&(I.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="flex"&&(I.layerButtons.infuse.style.display="flex"),co(),e.card.classList.toggle("is-complete",!!I.hasDoneInfuseReset),e.status)if(I.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!vp()){Vo(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Vo(e.btn,{disabled:!1},Ry,I.pendingMagic)}}function Ep(e,t,n){let o=t.add(n);return ov(e,o).level}function np(){let e=I.elements.surge;if(!e.card||!e.btn)return;if(!ws()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="none"&&(I.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="flex"&&(I.layerButtons.surge.style.display="flex"),co();let t=kn(),n=O.waves?.value??St(),o=0n;try{o=el(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':za(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=I.pendingWaves;if(u&&!u.isZero?.()){let d=Ep(o,n,u),f=!1;if(d===1/0)f=!0;else try{f=d>o}catch{}if(f){let p=d===1/0?'<span class="surge-infinity-symbol">\u221E</span>':za(d);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${jc}">${za(n)} / <img src="${jc}">${za(r)}</span>`),e.milestones){let s=Iy(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let d=BigInt(a.surgeLevel)<=o,f=d?"is-reached":"",p=a.description.map(F=>F.includes("Invokes the Tsunami")&&!d?`<div class="tsunami-text">- ${F}</div>`:`<div>- ${F}</div>`).join("");if(d&&a.surgeLevel===3){let F=gr?gr():xt.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${J(F)}</div>`}if(d&&a.surgeLevel===6){let F=lc();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${at(F.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${at(F.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${at(F.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${at(F.magic)}x</span></div>`}let g=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(g=!0);let m=Ft(),y=Sn(),h=m+y;h>1&&(h=1);let b=!1;d&&g&&h<1&&zd.includes(a.id)&&(b=!0);let E=b?" is-nerfed":"",L=l[u];if(!L)L=document.createElement("div"),L.className=`surge-milestone-item ${f}${E}`,L.dataset.isReached=String(d),L.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(L);else{L.className!==`surge-milestone-item ${f}${E}`&&(L.className=`surge-milestone-item ${f}${E}`);let F=String(d);L.dataset.isReached!==F&&(L.dataset.isReached=F)}let R=L.querySelector(".surge-milestone-desc");R&&R.innerHTML!==p&&(R.innerHTML=p);let T=L.querySelector(".surge-milestone-nerf-arrow");if(T){let F=!1;g&&h<1&&zd.includes(a.id)&&(F=!0);let U=F?"":"none";T.style.display!==U&&(T.style.display=U)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();I.lastRenderedSurgeLevel!==o&&(I.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],d=e.milestones.children;u===d[d.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!I.hasDoneSurgeReset),e.status)if(I.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(Xy()<201){Vo(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(I.pendingWaves.isZero?.()){Vo(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Vo(e.btn,{disabled:!1},jc,I.pendingWaves)}function $w(){let e=I.elements.experiment;if(!(!e.card||!e.btn)){if(!su()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="none"&&(I.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="flex"&&(I.layerButtons.experiment.style.display="flex"),co(),e.card.classList.toggle("is-complete",!!I.hasDoneExperimentReset),e.status)if(I.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==t&&(e.status.innerHTML=t)}Vo(e.btn,{disabled:!1},Oy,I.pendingDna)}}function Ve({goldMult:e=null}={}){I.panel&&(rv({goldMult:e}),iv(),np(),$w())}function xp(){Ho(),ou(!0),Ve()}function Lp(){Ho(),mp(!0),Ve()}function _p(){Ho(),gp(!0),Ve()}function qw(){if(!I.panel)return;let e=I.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!I.panel.classList.contains("is-active")||!I.elements.surge.barFill)return;let t=I.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",np(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",np()},{once:!0}))}function Gw(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{qw()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(Mn(),Wn(),Vn()),e.detail?.key==="waves"&&(au(),Ve()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Vn(),Ve())}),window.addEventListener("surge:bookResidue",()=>{if(I.panel&&I.panel.offsetParent!==null){let e=I.elements.surge.card;e&&e.style.display!=="none"&&Ve()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Me.GOLD){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;Mn(!0);let n=t.mult instanceof c?t.mult:xt.fromAny(t.mult??1);I.panel&&rv({goldMult:n});return}if(t.key===Me.MAGIC){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;let n=t.mult instanceof c?t.mult:xt.fromAny(t.mult??1);Wn(n),I.panel&&iv();return}}}),window.addEventListener("xp:change",()=>{Mn(),Vn(),Cr(),Ve()}),window.addEventListener("mutation:change",()=>{Wn(),Vn(),Ve()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&I.slot!=null&&e.detail.slot!==I.slot||(Za(),Mn(!0),Wn(),Vn(),Cr(),Ve())}))}function Ho(){if(Cy){I.slot=v(),Za(),jd(),Mn(!0),Wn(),Vn(),Cr();return}try{Vt()}catch{return}Cy=!0;let e=v();if(I.slot=e,Za(),Qd(e),I.hasDoneForgeReset&&!_o())try{Mr()}catch{}if(!I.forgeUnlocked&&ep()&&ou(!0),Ty(e),jd(),Gw(),Mn(!0),Wn(),Vn(),Cr(),Kc){try{Kc()}catch{}Kc=null}Kc=pi(()=>{let t=Cp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=v();if(I.slot=t,Za(),Qd(t),I.hasDoneForgeReset&&!_o())try{Mr()}catch{}!I.forgeUnlocked&&ep()&&ou(!0),Ty(t),jd(),Mn(!0),Wn(),Vn(),Cr(),Ve()})}var xt,zc,St,Ly,Ny,Ry,Oy,yw,vw,bw,Sw,jc,Iw,ww,Ew,xw,Jc,rp,Ka,Qc,ip,ja,eu,Py,sp,Is,ap,lp,Mw,kw,Kd,By,I,Yn,_y,Cy,Kc,Zd,My,ky,Zc,Io=De(()=>{Ct();bt();zt();qn();un();Eo();Xi();Ra();wy();Qr();Pn();so();ni();oi();Lc();xy();xt=c,zc=Math.log10(1.1),St=()=>xt.fromInt(0),Ly=()=>xt.fromInt(1),Ny="img/currencies/gold/gold.webp",Ry="img/currencies/magic/magic.webp",Oy="img/currencies/dna/dna.webp",yw="img/misc/forge.webp",vw="img/misc/infuse.webp",bw="img/misc/surge.webp",Sw="img/misc/experiment.webp",jc="img/currencies/wave/wave.webp",Iw="sounds/forge_reset.ogg",ww="sounds/infuse_reset.ogg",Ew="sounds/surge_reset.ogg",xw=[];Jc=e=>`ccc:reset:forge:${e}`,rp=e=>`ccc:reset:forge:completed:${e}`,Ka=e=>`ccc:debug:forgeUnlocked:${e}`,Qc=e=>`ccc:reset:infuse:${e}`,ip=e=>`ccc:reset:infuse:completed:${e}`,ja=e=>`ccc:debug:infuseUnlocked:${e}`,eu=e=>`ccc:reset:surge:${e}`,Py=e=>`ccc:debug:surgeUnlocked:${e}`,sp=e=>`ccc:reset:surge:completed:${e}`,Is=e=>`ccc:reset:surge:barLevel:${e}`,ap=Is,lp=e=>`ccc:reset:experiment:completed:${e}`,Mw=xt.fromInt(31),kw=xt.fromInt(7),Kd=!1,By=!1;I={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:St(),pendingMagic:St(),pendingWaves:St(),pendingDna:St(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},Yn=[],_y=null,Cy=!1,Kc=null,Zd=null,My=null,ky=null;Zc=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Ho,performForgeReset:Sp,performInfuseReset:Ip,performSurgeReset:wp,computePendingForgeGold:ev,computeForgeGoldFromInputs:$y,computeInfuseMagicFromInputs:qy,computeSurgeWavesFromInputs:Gy,getForgeDebugOverrideState:Vy,hasDoneForgeReset:Er,isForgeUnlocked:ms,setForgeDebugOverride:Wy,setForgeResetCompleted:up,updateResetPanel:Ve,isInfuseUnlocked:iu,setInfuseDebugOverride:jy,getInfuseDebugOverrideState:zy,recomputePendingMagic:Wn,setInfuseUnlockedForDebug:Ky,setInfuseResetCompleted:fp,hasDoneInfuseReset:$t,isSurgeUnlocked:ws,setSurgeUnlockedForDebug:Jy,getSurgeDebugOverrideState:Zy,setSurgeResetCompleted:dp,hasDoneSurgeReset:xo,getCurrentSurgeLevel:wn,shouldBlockBigCoins:Ja,hasDoneExperimentReset:Qy,setExperimentResetCompleted:Yy,isExperimentUnlocked:su}))});function Mp(){nl=null}function av(){nl=null;try{lu.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{jt()}catch{}}function lv(e){return typeof e=="function"&&lu.push(e),()=>{lu=lu.filter(t=>t!==e)}}function Xw(e){let t=ut(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Ae(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function Yw(){try{return!!cn()}catch{return!1}}function ol(e){let t=O?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(Yw())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=Mt(xe.STARTER_COVE,we.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=Xw(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function Es(e=xe.STARTER_COVE){if(nl)return nl;let t=Ut(e),n={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let o of t){if(!o.effectType)continue;let r=_n(e,o.id),i=Fe(r),s=null;if(typeof o.effectMultiplier=="function"?(s=o.effectMultiplier(i),!(s instanceof c)&&typeof s!="number"&&(s=c.fromAny(s??1))):s=c.fromInt(1),o.upgType==="HM"){let{selfMult:l,xpMult:a,coinMult:u,mpMult:d}=kr(o,r,e);n.xpValue=Lt(n.xpValue,a),n.coinValue=Lt(n.coinValue,u),n.mpValue=Lt(n.mpValue,d),s=Lt(s,l)}if(o.effectType==="coin_spawn"){let l=1;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=1}else l=Number(s);n.coinSpawn*=l}else if(o.effectType==="coin_value")n.coinValue=Lt(n.coinValue,s);else if(o.effectType==="xp_value")n.xpValue=Lt(n.xpValue,s);else if(o.effectType==="mp_value")n.mpValue=Lt(n.mpValue,s);else if(o.effectType==="book_value")n.bookValue=Lt(n.bookValue,s);else if(o.effectType==="magnet_radius"){let l=0;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=0}else l=Number(s);Number.isFinite(l)&&(n.magnetRadius+=l)}}return nl=n,n}function as(e){let t=Es(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:Hw*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue}}function Vc(){try{let{mpValue:e}=Es(xe.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Wc(){try{let{magnetRadius:e}=Es(xe.STARTER_COVE);return e||0}catch{return 0}}function cv(){try{Ho()}catch{}try{Ro(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=Es(xe.STARTER_COVE);return Lt(n,o)})}catch{}try{ur(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=Es(xe.STARTER_COVE);return Lt(n,o)})}catch{}try{ri(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=Es(xe.STARTER_COVE);return Lt(n,o)})}catch{}ol(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{ol()}catch{}try{jt()}catch{}})}var Hw,nl,lu,uv=De(()=>{Ct();bt();Io();qn();Eo();un();Hw=1,nl=null,lu=[]});var Pv={};vt(Pv,{AREA_KEYS:()=>xe,HM_EVOLUTION_INTERVAL:()=>qt,MAX_LEVEL_DELTA:()=>As,REGISTRY:()=>Lu,UPGRADE_TIES:()=>we,approxLog10BigNum:()=>$e,batchUpgradeOperations:()=>il,bigNumFromLog10:()=>Ae,buyCheap:()=>Nd,buyMax:()=>Bc,buyOne:()=>$a,buyTowards:()=>qa,clearPermanentUpgradeUnlock:()=>Wp,computeDefaultUpgradeCost:()=>zp,computeHmMultipliers:()=>kr,computeUpgradeEffects:()=>as,costToBuyOne:()=>yE,ensureLevelBigNum:()=>ut,estimateFlatBulk:()=>$p,estimateGeometricBulk:()=>fE,evaluateBulkPurchase:()=>li,evolveUpgrade:()=>Ad,formatMultForUi:()=>at,getCurrentAreaKey:()=>Hn,getHmEvolutions:()=>Hp,getHmNextMilestoneLevel:()=>vE,getIconUrl:()=>Fc,getLevel:()=>_n,getLevelNumber:()=>Mt,getMagnetLevel:()=>Wc,getMpValueMultiplierBn:()=>Vc,getUpgrade:()=>Ps,getUpgradeLockState:()=>Xo,getUpgradeStorageKey:()=>hi,getUpgradesForArea:()=>Ut,levelBigNumToNumber:()=>Fe,markUpgradePermanentlyUnlocked:()=>mi,normalizeBigNum:()=>bE,normalizedUpgradeLevel:()=>gu,onUpgradesChanged:()=>lv,peekNextPrice:()=>Ov,performFreeAutobuy:()=>kd,safeMultiplyBigNum:()=>Lt,setLevel:()=>Wo,syncBookCurrencyMultiplierFromUpgrade:()=>ol,upgradeUiModel:()=>Ga});function cu(){Tr.size!==0&&(Tr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{rt(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Tr.clear())}function Ww(){if(!(typeof window>"u")&&!dv){dv=setInterval(cu,2e3);try{window.addEventListener("beforeunload",cu)}catch{}try{window.addEventListener("pagehide",cu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&cu()})}catch{}}}function il(e){if(_s)return e();_s=!0;try{return e()}finally{_s=!1,rl.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{Ms(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),rl.clear(),fv.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{hE(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),fv.clear(),Op&&(Op=!1,uo())}}function zw(e){try{let t=Os(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function hv(e,t){if(!zw(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=$e(n);return Number.isFinite(o)&&o>=Kw}catch{return!1}}function Cs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>kp)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>kp/2||i.length>kp/2)return"Infinity"}return n}function $e(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let g=Math.log10(p),m=e.e||0,y=Number(e._eOffset||0n);return g+m+y}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let d;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)+(u.length-15)}let f=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return d+f}function Ae(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function fu(e){return tE[e]??0}function Tp(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Ns(e,t){let n=jo(e||t?.area);if(!n)return null;let o=Zo(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=jn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function sl(e,t){let n=jo(e||t?.area);if(!n)return null;let o=jn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function xs(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function Fp(e=v()){let t=String(e??"default");if(pu.has(t))return pu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${vv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),pu.set(t,n),n}function Up(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),pu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${vv}:${n}`,JSON.stringify(e))}catch{}}function wu(e=v()){let t=String(e??"default");if(mu.has(t))return mu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${bv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),mu.set(t,n),n}function Eu(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),mu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${bv}:${n}`,JSON.stringify(e))}catch{}}function Yp(e=v()){let t=String(e??"default");if(hu.has(t))return hu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Sv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),hu.set(t,n),n}function Vp(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),hu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Sv}:${n}`,JSON.stringify(e))}catch{}}function Dp(e,t,n=v()){let o=Ns(e,t);if(!o)return;let r=sl(e,t),i=Yp(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Vp(i,n))}function Iv(e,t,n=v()){let o=Ns(e,t);if(!o)return!1;let r=sl(e,t),i=Yp(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Vp(i,n),!0):!1}function mi(e,t,n=v()){let o=Ns(e,t);if(!o)return;let r=sl(e,t),i=wu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Eu(i,n))}function Wp(e,t,n=v()){let o=Ns(e,t);if(!o)return;let r=wu(n);r.upgrades[o]&&(delete r.upgrades[o],Eu(r,n));let i=Fp(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},Up(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&Jo(e,s,n),uo()}function bu(e,t,n=v()){let o=Ns(e,t);if(!o)return!1;let r=sl(e,t),i=wu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Eu(i,n),!0):!1}function dn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=Zo(t?.tie??t?.tieKey),o=e?.areaKey||xe.STARTER_COVE;if(!n||!Zw.has(n))return{locked:!0,iconOverride:Tn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?Mt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:wv()}catch{}function s(){if(Ev())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:pn,titleOverride:en,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===we.UNLOCK_XP)return s();if(n===we.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Tn,useLockedBase:!0};let a=!1;try{let u=mn();a=Fe(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:pn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:en,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_INFUSE){if(!Er())return{locked:!0,iconOverride:Tn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Kn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=mn();a=Fe(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:pn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:en,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_SURGE){if(!$t())return{locked:!0,iconOverride:Tn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Kn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=mn();a=Fe(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:pn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:en,descOverride:u,reason:u}}return{locked:!1}}if(Xp.has(n)){if($t()||bu(o,t)){try{mi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let d=mn();a=Fe(d)>=101}catch{}if(!a)return{locked:!0,iconOverride:Tn,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{Dp(o,t)}catch{}return{locked:!0,iconOverride:pn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:en,descOverride:u,reason:u}}if(Er()||bu(o,t)){try{mi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Tn,useLockedBase:!0};if(Iv(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:pn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:en,descOverride:a,reason:a}}let l=!1;try{let a=mn();l=Fe(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Tn,useLockedBase:!0,titleOverride:Kn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{Dp(o,t)}catch{}return{locked:!0,iconOverride:pn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function jo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function Zo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function nE(e,t){let n=Zo(t?.tie??t?.tieKey);if(n&&Jw.has(n))return!0;let o=jn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=jo(l);if(a&&Qw.has(`${a}:${i}`))return!0}return!1}function wv(){try{return!!cn()}catch{return!1}}function Ev(e=v()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${eE}:${t}`)==="1"}catch{return!1}}function mn(){try{let e=typeof Qe=="function"?Qe():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function gu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function Ap(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function jn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function ut(e){try{if(e=Cs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Ae(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=$e(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Fe(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=$e(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let f=Number(r);return Number.isFinite(f)?f:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let f=Math.floor(Math.log10(a));Number.isFinite(f)&&f>0&&(a/=Math.pow(10,f),u+=f)}else if(a<1){let f=Math.ceil(Math.log10(1/a));Number.isFinite(f)&&f>0&&(a*=Math.pow(10,f),u-=f)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let d=a*Math.pow(10,u);return Number.isFinite(d)?d:u>0?Number.MAX_VALUE:0}catch{let o=$e(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function oE(e,t){let n=ut(e),o=ut(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor($e(n))+1,i=Math.floor($e(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function xv(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function Rs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Su(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:Rs(e.numUpgEvolutions)}function zp(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Fe(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let d=Math.max(0,Math.floor(r/qt));Number.isFinite(d)&&(i.numUpgEvolutions=d)}let s=Mv(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:$e(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:xv(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,zn(i,r)}function Lv(e){let t=Rs(e),n=qt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Ar(o),capFmtText:ks(o)}}function _v(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor($e(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(qt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}}function iE(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Kp(e,t=vu){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=jo(t||e?.area||vu);return jw[n]||gv}function Lt(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function xu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=Lv(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function kr(e,t,n=vu){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Kp(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let d=_v(t,Number(u?.level??u?.lvl??0));if(!(d>0))continue;let f=iE(u.multiplier??u.mult??u.value??1,d),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=Lt(i,f):p==="coin"||p==="coins"?s=Lt(s,f):p==="mp"?l=Lt(l,f):r=Lt(r,f)}let a=Su(e);if(a>0){let u=Vw*a,d=Ae(u);r=Lt(r,d)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function Cv(e,t,n=vu){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Kp(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=_v(t,s),a=null;try{let u=BigInt(s),d=BigInt(Math.max(0,l)),f=u+BigInt(qt)*d;f>0n&&(a=c.fromAny(f.toString()))}catch{}if(!a){let u=c.fromAny(qt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+qt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(qt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function Mv(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=rE[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Os(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let f=Number(i);Number.isFinite(f)&&f>0&&(r=f)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let f=Math.pow(10,s);Number.isFinite(f)&&f>0&&(r=f)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let f=Math.exp(l);Number.isFinite(f)&&f>0&&(r=f)}if(!r){let f=Number(o.ratioMinus1);Number.isFinite(f)&&f>0&&(r=f+1)}let a=null;if(!r){let f=Mv(e);f&&(r=f.ratio,f.ratioLog10!=null&&(s=f.ratioLog10),a=f.preset)}if(r>1){r=Number(r),i=xv(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=$e(n),d=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=d;try{let f=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),g=c.fromAny(e.costAtLevel?.(32)??0);f.cmp(p)===0&&f.cmp(g)===0&&(d.ratio=1,d.ratioMinus1=0,d.ratioLog10=0,d.ratioLn=0,d.ratioStr="1")}catch{}return d}catch{return null}}function zn(e,t){let n=Os(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Ae(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Ae(n.baseLog10+o*n.ratioLog10).floorToInteger()}function sE(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function zo(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Os(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Ls+t*o.ratioLn)/Ls;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Ls+t*o.ratioLn,i=o.ratioLn*n,s=sE(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Ls}function yu(e,t,n){if(!(n>0))return c.fromInt(0);let o=Os(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=zo(e,t,l);a=a.add(Ae(u))}if(s>0){let u=t+l,d=c.fromAny(e.costAtLevel(u));for(let f=0;f<s;f+=1)a=a.add(d),f+1<s&&(d=d.mulDecimalFloor(o.ratioStr))}return a}let i=zo(e,t,n);return Ae(i)}function aE(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/Ls;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/Ls:e>0?e:0}function Tv(e){if(!(e>0)||!Number.isFinite(e))return e;if(Rp[0]=e,Rp[0]<=0)return 0;lE[0]-=1n;let t=Rp[0];return t>0?t:0}function cE(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=Tv(e);return n<e?n:e>1?e/2:0}function du(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function al(e,t,n,o=As,r={}){let i=Os(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Fe(t))),d=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,f=typeof o=="number"?o:Fe(o),p=Number.isFinite(d)?Math.max(0,d-u):Np,g=Number.isFinite(f)?Math.max(0,Math.floor(f)):Np;if(g=Math.min(g,Np,p),!(g>0)){let te=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:te,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let te=Math.min(g,m),$=c.fromAny(e.costAtLevel(u)),G=s,j=0;for(;j<te;){$=c.fromAny(e.costAtLevel(u+j));let ye=G.add($);if(ye.cmp(n)>0)break;G=ye,j+=1}let le=u+j,ue=Number.isFinite(d)&&le>=d,C=du(j);if(j<te||ue||g<=j){let ye=ue?s:c.fromAny(e.costAtLevel(le));return{count:C,spent:G,nextPrice:ye,numericCount:j}}let W=(()=>{try{return Ko(t??u,u).add(C)}catch{return u+j}})(),ce=al(e,W,n.sub(G),g-j,r),me=ce?.count instanceof c?ce.count:du(ce?.numericCount??0),Z=C.add(me),re=(ce?.spent??s).add(G);return{count:Z,spent:re,nextPrice:ce?.nextPrice??s,numericCount:j+(ce?.numericCount??0)}}let y=$e(n),h=i.ratioLog10,b=i.ratioMinus1,E=c.fromAny(e.costAtLevel(u)),L=i.baseLog10+u*h;if(b>0&&(!Number.isFinite(y)||Math.abs(y)>1e6&&Math.abs(L)>1e6)){let te=c.fromAny(e.costAtLevel(u));if(n.cmp(te)<0)return{count:s,spent:s,nextPrice:te,numericCount:0};let $=Number.isFinite(g)?Math.max(1,Math.floor(g)):Number.MAX_VALUE,G=1,j=1;for(;j<$;){let me=zo(e,u,j);if(Ae(me).cmp(n)<=0){let re=j*2;if(!Number.isFinite(re)||re<=j){j=$;break}G=j,j=Math.min(re,$)}else break}let le=0;for(;G<j&&le<256;){let me=Math.max(G+1,Math.floor((G+j+1)/2)),Z=zo(e,u,me);Ae(Z).cmp(n)<=0?G=me:j=me-1,le++}let ue=Math.max(1,G),C=du(ue),W=s,ce=s;if(!a)if(W=yu(e,u,ue),Number.isFinite(d)){let me=Math.max(0,Math.floor(d-Math.min(u,d)));ue>=me?ce=s:ce=Ae(L+ue*h)}else ce=Ae(L+ue*h);return{count:C,spent:W,nextPrice:ce,numericCount:ue}}if(n.cmp(E)<0)return{count:s,spent:s,nextPrice:E,numericCount:0};let T=!1,F=null,U=null;try{F=c.fromAny(e.costAtLevel(u+1))}catch{}try{let te=Math.min(Number.isFinite(d)?Math.max(u+1,Math.floor(d)):u+32,u+32);U=c.fromAny(e.costAtLevel(te))}catch{}!T&&!(i.ratioMinus1>0)&&(T=!0),F&&U&&(T=F.cmp(E)===0&&U.cmp(E)===0),!T&&!(i.ratioMinus1>0)&&(T=!0);let q=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.MAX_VALUE;if(T){let te=Ko(e.lvlCapBn??"Infinity","Infinity"),$=Ko(t??0,0),G=te.isInfinite?.()?c.fromAny("Infinity"):te.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=$p(E,n,G);return{count:le,spent:ue,nextPrice:C,numericCount:j}}if(!(h>0)||!(b>0)){let te=Ko(e.lvlCapBn??"Infinity","Infinity"),$=Ko(t??0,0),G=te.isInfinite?.()?c.fromAny("Infinity"):te.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=$p(E,n,G);return{count:le,spent:ue,nextPrice:C,numericCount:j}}let x=Math.log10(b);if(!Number.isFinite(x))return{count:s,spent:s,nextPrice:E,numericCount:0};let M=aE(y+x-L)/h;(!Number.isFinite(M)||M<0)&&(M=0);let _=Math.floor(Math.min(q,M));Number.isFinite(_)||(_=q),_<=0&&(_=1);let X=1e-7,Q=zo(e,u,_),fe=0,K=2048;for(;_>0&&(!Number.isFinite(Q)||Q>y+X)&&fe<K;){let te=Number.isFinite(Q)?Math.max(1,Math.ceil((Q-y)/Math.max(h,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-te));if($<_)_=$;else{let G=Tv(_);if(!(G<_))break;_=G}Q=_>0?zo(e,u,_):Number.NEGATIVE_INFINITY,fe+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(E)>=0)_=1,Q=$e(E);else return{count:s,spent:s,nextPrice:E,numericCount:0};if(_<q){let te=C=>{let W=C*2;return Number.isFinite(W)?W:Number.MAX_VALUE},$=_,G=Math.min(q,Math.max(_+1,te(_))),j=zo(e,u,G);for(;$<G&&Number.isFinite(j)&&j<=y+X&&G<q;)$=G,G=Math.min(q,te(G)),j=zo(e,u,G);let le=$,ue=G;for(let C=0;C<256&&le<ue;C+=1){let W=Math.floor((le+ue+1)/2),ce=zo(e,u,W);Number.isFinite(ce)&&ce<=y+X?(le=W,Q=ce):ue=W-1}_=le}let ee=null;if(!a){ee=yu(e,u,_);let te=0;for(;ee.cmp(n)>0&&_>0&&te<K;){let $=cE(_);if(!($<_))break;_=$,ee=yu(e,u,_),te+=1}if(_<=0)return{count:s,spent:s,nextPrice:E,numericCount:0};if(_<q&&te<K)for(;_<q&&te<K;){let $=u+_,G;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)G=c.fromAny(e.costAtLevel($));else{let le=L+_*h;G=Ae(le).floorToInteger()}}catch{break}let j=ee.add(G);if(j.cmp(n)>0)break;ee=j,_+=1,te+=1}}let ve=s,he=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(d)){let te=Math.max(0,Math.floor(d-Math.min(u,d)));if(_>=te)ve=s;else if(he){let $=Math.floor(u+_);ve=c.fromAny(e.costAtLevel($))}else{let $=L+_*h;ve=Ae($)}}else if(he){let te=Math.floor(u+_);ve=c.fromAny(e.costAtLevel(te))}else{let te=L+_*h;ve=Ae(te)}return{count:du(_),spent:ee,nextPrice:ve,numericCount:_}}function uE(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=$e(t),r=$e(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function $p(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let d=BigInt(o)/BigInt(r),f=c.fromAny(d.toString());!n.isInfinite?.()&&f.cmp(n)>0&&(f=n);let p=e.mulBigNumInteger(f);return{count:qp(f),countBn:f,spent:p,nextPrice:e}}let i=$e(t),s=$e(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Ae(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:qp(l),countBn:l,spent:a,nextPrice:u}}function fE(e,t,n,o){if(!n||o<=0)return{count:0};let r=$e(t),i=$e(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let y=0;y<64&&a<u;y+=1){let h=Math.max(0,Math.floor((a+u+1)/2));i+h*n.ratioLog-n.logDenom<=r?a=h:u=h-1}let d=Math.min(a,o);if(d<=0)return{count:0};let f=i+d*n.ratioLog-n.logDenom;if(f>r)return{count:0};let p=i+d*n.ratioLog,g=Ae(f),m=Ae(p);return{count:d,spent:g,nextPrice:m,spentLog:f,nextPriceLog:p}}function Ko(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function qp(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Ar(e){return J(e instanceof c?e:c.fromAny(e??0))}function at(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=$e(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return J(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):J(c.fromAny(t))}catch{return"1"}}function ks(e){return Ar(e).replace(/<[^>]*>/g,"")}function Iu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Ts(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=Iu(n??t??0),s=Iu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Fe(i),newLevel:Number.isFinite(o)?o:Fe(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Bt(e,t){return zn(e,t)}function Av(e,t=v()){return t==null?null:`ccc:upgrades:${e}:${t}`}function hi(e,t,n=v()){if(n==null)return null;let o=jo(e),r=jp(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function dE(){pv.forEach(e=>{try{e?.()}catch{}}),pv.clear()}function mv(e){dE()}function pE(e,t){if(typeof localStorage>"u")return;let n=Av(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=hi(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}}),console.log(`[UpgradeMigration] Migrated ${i} upgrades for area ${e} slot ${t}`)}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function mE(e,t,n){pE(e,n);let o=hi(e,t,n);if(!o)return null;if(_s&&rl.has(o))try{let r=rl.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Tr.has(o))try{let r=Tr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function Ms(e,t,n,o=v(),r={}){let i=hi(e,t,o);if(i){if(_s){rl.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Tr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Tr.has(i)&&Tr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{rt(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function hE(e,t,n=v()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&Ms(e,o.id,o,n)})}function jp(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return jn(t.id);let n=jn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=Zo(n);if(o){let r=Pp.get(o);if(r){let i=jo(e);if(!i||jo(r.area)===i)return jn(r.id)}}}return n}function Nv(e,t,n=v()){let o=n==null?"null":String(n),r=jp(e,t);return`${o}:${e}:${jn(r)}`}function fo(e,t){let n=jp(e,t),o=jn(n),r=v(),i=Nv(e,o,r),s=Gp.get(i);if(s)return s;let l=Ps(e,o),a=mE(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,Ms(e,o,a,r)}let d=a.lvl,f=a.nextCost,p=a.nextCostLvl;a.lvl=Cs(a.lvl),a.nextCost=Cs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Cs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==d||a.nextCost!==f||a.nextCostLvl!==p)&&(u=!0);let g=0;l?.upgType==="HM"&&(g=Rs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),xu(l,g));let m=ut(a.lvl),y=Fe(m);try{let R=l?.lvlCapBn??c.fromAny("Infinity");if(!R.isInfinite?.()&&m.cmp(R)>0){let T=R.clone?.()??R;y=Fe(T);let F=T.toStorage();a.lvl=F,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=F,Ms(e,o,a,r)}}catch{}let h=null;try{h=m?.toStorage?.()??ut(y).toStorage()}catch{}h&&a.lvl!==h&&(a.lvl=h,u=!0);let b=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,E=!b||b!==h,L=null;if(!E&&a.nextCost!=null)try{L=c.fromAny(a.nextCost)}catch{L=null,E=!0}if(!L||E){if(l)try{L=c.fromAny(l.costAtLevel(y))}catch{L=c.fromInt(0)}else L=c.fromInt(0);try{a.nextCost=L.toStorage(),h?a.nextCostLvl=h:delete a.nextCostLvl,u=!0}catch{}}if(u)try{Ms(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let R=c.fromAny("Infinity");l.lvlCapBn=R,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Ar(R),l.lvlCapFmtText=ks(R)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:y,lvlBn:m,nextCostBn:L,slot:r,hmEvolutions:g},Gp.set(i,s),s}function Nr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??v();if(!n||o==null)return;let r=jn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??ut(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Fe(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??ut(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=ut(e.lvl??0).toStorage()}i.lvl=Cs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Cs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=Rs(e.hmEvolutions)),Ms(n,r,i,o,t),e.slot=o}function Jo(e,t,n=v()){Gp.delete(Nv(e,t,n))}function Mt(e,t){return fo(e,t).lvl}function Hp(e,t){return fo(e,t).hmEvolutions??0}function Rv(e,t){if(!t)return{locked:!1};let n=wv(),o=n?mn():c.fromInt(0),r=n?Fe(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let d=nE(e,t),f="Unlock the XP system to reveal this upgrade",p=Ev();if(d)if(p)i={locked:!0,iconOverride:pn,titleOverride:en,descOverride:f,reason:f,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let g='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Tn,titleOverride:Kn,descOverride:g,reason:g,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Tn,titleOverride:Kn,descOverride:f,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=Ap({locked:!1},i);if(typeof t.computeLockState=="function")try{let d={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,baseLocked:s.locked,getUpgradeLevel(p){return Mt(e,p)}},f=t.computeLockState(d);s=Ap(s,f)}catch{}let l=v(),a=Ns(e,t),u=a?bu(e,t,l):!1;if(a){let d=Fp(l),f=wu(l),p=Yp(l),g=a.replace(/_/g,"-"),m=sl(e,t),y=!1;xs(d,g,a)&&(y=!0),m&&xs(d,m,a)&&(y=!0),y&&Up(d,l);let h=!1;xs(f,g,a)&&(h=!0),m&&xs(f,m,a)&&(h=!0),h&&Eu(f,l);let b=!1;xs(p,g,a)&&(b=!0),m&&xs(p,m,a)&&(b=!0),b&&Vp(p,l)}if(s.locked){let d=!!s.hidden;s.iconOverride||(s.iconOverride=Tn),d?s.titleOverride||(s.titleOverride=en):(!s.titleOverride||s.titleOverride===en)&&(s.titleOverride=Kn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:d&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Tn||s.iconOverride===pn)&&delete s.iconOverride,(s.titleOverride===en||s.titleOverride===Kn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Tn),a){let d=Fp(l),f=d.upgrades[a]||{},p=Zo(t?.tie??t?.tieKey),g=p&&yv.has(p),m=p&&Xp.has(p),y=f.status||"locked";if(bu(e,t,l))y="unlocked";else if(Iv(e,t,l)&&y==="locked"){let x=!1;try{x=Fe(mn())>=31}catch{}let B=!1;try{B=Fe(mn())>=101}catch{}g&&!x||m&&!B?y="locked":y="mysterious"}let h=fu(y),b=Tp(s),E=fu(b),L=()=>{s.locked=!0;let x=f.snapshot;x&&typeof x=="object"&&(s=Ap(s,x)),s.iconOverride=pn,s.titleOverride=en;let B=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=B,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};h>E&&(y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):y==="mysterious"&&L(),b=Tp(s),E=fu(b));let R=!1,T=f&&typeof f=="object"&&typeof f.status=="string"?f.status:"locked",F=g,U=!1;try{U=Fe(mn())>=31}catch{}let q=!1;try{q=Fe(mn())>=101}catch{}if((F&&!U&&T==="mysterious"||m&&!q&&T==="mysterious")&&(T="locked"),(!f||typeof f!="object"||Object.keys(f).length!==1||f.status!==T)&&(d.upgrades[a]={status:T},R=!0),E>h){if(f.status=b,d.upgrades[a]={status:f.status},R=!0,y=b,h=E,b==="unlocked")mi(e,t,l);else if(b==="mysterious"){let x=!1;try{x=Fe(mn())>=31}catch{}(!g||x)&&Dp(e,t,l)}}y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Tn||s.iconOverride===pn)&&delete s.iconOverride,(s.titleOverride===en||s.titleOverride===Kn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,f.status!=="unlocked"&&(d.upgrades[a]={status:"unlocked"},R=!0),mi(e,t,l)):y==="mysterious"&&b!=="mysterious"&&(L(),b=Tp(s),E=fu(b)),R&&Up(d,l)}return s}function ll(e,t){return!!Rv(e,t).locked}function Zp(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Su(e),{capBn:r,cap:i}=Lv(o);try{return t?.cmp?.(r)>=0}catch{}let s=Fe(t);return Number.isFinite(s)&&s>=i}function _n(e,t){let n=fo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():ut(n.lvl??0)}function Ov(e,t){let n=fo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??ut(n.lvl??0),i=Fe(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function Wo(e,t,n,o=!0,r={}){let i=fo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,xu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,d=Iu(i.lvlBn??ut(i.lvl??0)),f=ut(n);f.isInfinite?.()&&(f=c.fromAny("Infinity"));let p=f;try{s&&hv(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=ut(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=ut(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let g=Fe(p);if(!s)return i.lvl=g,i.lvlBn=p,i.nextCostBn=c.fromInt(0),Nr(i),Jo(e,t),uo(),i.lvl;i.lvl=g,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(g))}catch{i.nextCostBn=c.fromInt(0)}return Nr(i,{deferSave:r?.deferSave}),Jo(e,t),Ts(s,u,d,i.lvl,i.lvlBn),uo(),i.lvl}function Ut(e){return Lu.filter(t=>t.area===e)}function Ps(e,t){let n=jo(e),o=jn(t),r=Zo(typeof o=="string"?o:t);return Lu.find(i=>n&&jo(i.area)!==n?!1:!!(jn(i.id)===o||r&&i.tieKey===r))||null}function Xo(e,t){let n=typeof t=="object"&&t?t:Ps(e,t);return Rv(e,n)}function gE(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function Fc(e){return e?gE(e.icon):""}function yE(e,t){let n=Ps(e,t),o=_n(e,t),r=Fe(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function $a(e,t){let n=fo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(ll(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??ut(r),s=Iu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(hv(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Nr(n),Jo(e,t),uo(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,d=u?O[u]:null,f=c.fromInt(0);if(d&&!a.isZero?.()){let g=d.value;if((g instanceof c?g:c.fromAny(g??0)).cmp(a)<0)return{bought:0,spent:0};f=a.clone?.()??c.fromAny(a),d.sub(f)}else{if(!a.isZero?.())return{bought:0,spent:0};f=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=Fe(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(f,n.lvl):o.costAtLevel(n.lvl)),Nr(n),Jo(e,t),Ts(o,r,s,n.lvl,n.lvlBn),uo(),{bought:1,spent:f}}function Ad(e,t){let n=fo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??ut(n.lvl);if(!Zp(o,r,n.hmEvolutions))return{evolved:!1};let i=Rs(n.hmEvolutions)+1;n.hmEvolutions=i,xu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Nr(n),Jo(e,t),Ts(o,n.lvl,r,n.lvl,r),uo(),{evolved:!0}}function Bc(e,t){let n=fo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(ll(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??ut(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=O[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return $a(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let b=i.clone?.()??ut(i),E=Fe(b),L=b.toStorage?.(),R;if(o.upgType==="HM"){if(R=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let F=c.fromAny("Infinity");o.lvlCapBn=F,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Ar(F),o.lvlCapFmtText=ks(F)}}else{let F=o.lvlCapBn?.clone?.()??Ko(o.lvlCap??1/0,1/0);R=F?.clone?.()??F}let T=R.sub(b);if(T.isZero?.()){let F=oE(R,b);F.isZero?.()||(T=F)}if(T.isZero?.()){let F=R.toStorage?.();if(L&&F&&L!==F)if(R.isInfinite?.())try{T=c.fromAny("Infinity")}catch{T=c.fromInt(1)}else T=c.fromInt(1)}return n.lvlBn=R.clone?.()??R,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),O[o.costType].set(u),Nr(n),Jo(e,t),Ts(o,E,b,n.lvl,n.lvlBn),uo(),{bought:T,spent:c.fromInt(0)}}let d=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(d)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(s)?Math.max(0,s-r):As;if(!(f>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=al(o,i,u,f),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),y=u.sub(m);O[o.costType].set(y);let h=i.add(g);return n.lvlBn=h,n.lvl=Fe(h),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Nr(n),Jo(e,t),Ts(o,r,i,n.lvl,n.lvlBn),uo(),{bought:g,spent:m}}function qa(e,t,n){let o=fo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(ll(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??ut(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=O[r.costType]?.value,d=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(d.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Fe(n):void 0,g=Number.isFinite(f)?Number.isFinite(p)?Math.min(f,p):f:p,m=al(r,s,d,g),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let h=m.spent??c.fromInt(0),b=d.sub(h);O[r.costType].set(b);let E=s.add(y);return o.lvlBn=E,o.lvl=Fe(E),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Nr(o),Jo(e,t),Ts(r,i,s,o.lvl,o.lvlBn),uo(),{bought:y,spent:h}}function li(e,t,n,o=As,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=al(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function uo(){if(_s){Op=!0,Mp();return}Mp(),av()}function Hn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),xe.STARTER_COVE}function Ga(e,t){let n=Ps(e,t);if(!n)return null;let o=_n(e,t),r=Fe(o),i=Ar(o),s=ks(o),l=n.lvlCapBn??Ko(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Ar(l),u=n.lvlCapFmtText??ks(l),d=r<n.lvlCap?Ov(e,t):c.fromInt(0),f=Ar(d),p=O[n.costType]?.value,g=p instanceof c?p:c.fromAny(p??0),m=Xo(e,t),y=!!m.locked,h=m.titleOverride??n.title,b=m.descOverride??n.desc;if(e===Ke&&jn(t)===zr){let T=wn(),F=!1;if(T===1/0||typeof T=="string"&&T==="Infinity"?F=!0:typeof T=="bigint"?F=T>=2n:typeof T=="number"&&(F=T>=2),F&&b){let U=10,q=!1,x=wn();if(x===1/0||typeof x=="string"&&x==="Infinity"||x===Number.POSITIVE_INFINITY?q=!0:typeof x=="bigint"?q=x>=8n:typeof x=="number"&&(q=x>=8),q){let B=Ft();U=Math.pow(10,B)}if(Math.abs(U-1)>1e-4){let B="10";U!==10&&(B=at(U)),b=b.replace("Generates the equivalent of picking up a Coin on an interval",`Generates the equivalent of picking up ${B} Coins (Surge 2!) on an interval`)}}}let E=Kp(n,e),L="";typeof n.effectSummary=="function"&&!(y&&m.hideEffect)&&(L=n.effectSummary(r),typeof L=="string"&&(L=L.trim()));let R=m.iconOverride??Fc(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:d,nextPriceFmt:f,have:g,haveFmt:O[n.costType]?.fmt(g)??String(g),effect:L,iconUrl:R,lockState:m,locked:y,areaKey:e,hmMilestones:E,displayTitle:h,displayDesc:b,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?Hp(e,t):0,hmReadyToEvolve:n.upgType==="HM"?Zp(n,o,Hp(e,t)):!1,hmNextMilestone:n.upgType==="HM"?Cv(n,o,e):null}}function vE(e,t){let n=Ps(e,t);if(!n||n.upgType!=="HM")return null;let o=_n(e,t);return Cv(n,o,e)}function bE(e){return Ae($e(e??0))}function kd(e,t){let n=fo(e,t),o=n.upg;if(!o)return{bought:0};let r=Av(e,n.slot);if(an(r))return{bought:0};let i=hi(e,t,n.slot);if(an(i))return{bought:0};if(ll(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??ut(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&Zp(o,l,n.hmEvolutions))return{bought:0};let d=O[o.costType]?.value,f=d instanceof c?d.clone?.()??c.fromAny(d):c.fromAny(d??0);if(f.isZero?.())return{bought:0};let p=al(o,l,f,As),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:0};let m=l.add(g);return Ww(),Wo(e,t,m,!0,{deferSave:!0}),{bought:g}}function Nd(e,t){let n=fo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(ll(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??ut(n.lvl),i=Fe(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=O[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=li(o,r,a,c.fromAny("Infinity")),d=u.numericCount;if(d<=0)return{bought:0,spent:c.fromInt(0)};let f=g=>{if(g<=0)return!0;let m=yu(o,i,g-1),y=a.sub(m),h=i+g-1,b=c.fromAny(o.costAtLevel(h)),E=y.div(10);return b.cmp(E)<=0},p=0;if(d<2e3){let g=u.spent,m=d;for(;m>0;){let y=i+m-1,h=c.fromAny(o.costAtLevel(y)),b=g.sub(h),L=a.sub(b).div(10);if(h.cmp(L)<=0){p=m;break}g=b,m--}}else{let g=0,m=d;for(;g<m;){let y=Math.ceil((g+m)/2);f(y)?g=y:m=y-1}p=g}return p<=0?{bought:0,spent:c.fromInt(0)}:qa(e,t,p)}var As,qt,iM,Vw,vu,xe,_s,fv,rl,Op,Tr,dv,Kw,kp,we,gv,jw,Tn,pn,en,Kn,yv,Xp,Zw,Jw,Qw,eE,vv,bv,Sv,tE,pu,mu,hu,Pp,sM,Bp,uu,Wt,Ls,rE,Np,kv,Rp,lE,Lu,Gp,pv,un=De(()=>{bt();Ct();zt();qn();Eo();Io();so();Kr();uv();As=c.fromAny("Infinity"),qt=1e3,iM=c.fromInt(1e3),Vw=3,vu="",xe={STARTER_COVE:"starter_cove",AUTOMATION:Ke},_s=!1,fv=new Map,rl=new Map,Op=!1,Tr=new Map,dv=null;Kw=308;kp=1024;we={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},gv=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],jw={[xe.STARTER_COVE]:gv},Tn="img/misc/locked.webp",pn="img/misc/mysterious.webp",en="Hidden Upgrade",Kn="Locked Upgrade",yv=new Set([we.COIN_VALUE_II,we.XP_VALUE_II,we.MP_VALUE_I,we.MAGNET,we.ENDLESS_XP]),Xp=new Set([we.COIN_VALUE_III,we.XP_VALUE_III,we.MP_VALUE_II,we.FASTER_COINS_III,we.ENDLESS_MP]),Zw=new Set([we.UNLOCK_XP,we.UNLOCK_FORGE,we.UNLOCK_INFUSE,we.UNLOCK_SURGE,...yv,...Xp]),Jw=new Set([we.FASTER_COINS_II,we.COIN_VALUE_I,we.BOOK_VALUE_I,we.XP_VALUE_I]),Qw=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),eE="ccc:merchantMet",vv="ccc:shop:reveals",bv="ccc:shop:permaUnlocks",Sv="ccc:shop:permaMyst",tE={locked:0,mysterious:1,unlocked:2},pu=new Map,mu=new Map,hu=new Map,Pp=new Map,sM=Zo(we.BOOK_VALUE_I),Bp=c,uu=e=>Bp.fromAny(e??0),Wt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=uu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Bp.fromInt(1).add(r.mulDecimal(n))}catch{let i=$e(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Ae(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=uu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Bp.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(uu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=uu(i);if(o>0){let l=$e(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let d=Math.pow(n,a);if(Number.isFinite(d))return d}return Ae(u)}}catch{}try{let l=Fe(s),a=o*l;return Ae(a)}catch{return c.fromInt(1)}}}};Ls=Math.log(10);rE={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Su(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Su(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};Np=(()=>{try{let e=Fe(As);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),kv=new ArrayBuffer(8),Rp=new Float64Array(kv),lE=new BigInt64Array(kv);Lu=[{area:xe.STARTER_COVE,id:1,tie:we.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:2,tie:we.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:dn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Hr()}catch{}}},{area:xe.STARTER_COVE,id:3,tie:we.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:4,tie:we.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(.5),onLevelChange(){try{jt()}catch{}}},{area:xe.STARTER_COVE,id:5,tie:we.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>gu(e)>0?2:1,onLevelChange({newLevel:e}){ol(e)}},{area:xe.STARTER_COVE,id:6,tie:we.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${at(t)}x`},effectMultiplier:Wt.addFlatPerLevel(2)},{area:xe.STARTER_COVE,id:7,tie:we.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:dn,onLevelChange({newLevel:e}){if((e??0)>=1)try{xp()}catch{}}},{area:xe.STARTER_COVE,id:8,tie:we.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${J(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(10),onLevelChange(){try{jt()}catch{}}},{area:xe.STARTER_COVE,id:9,tie:we.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:10,tie:we.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:11,tie:we.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=gu(e),n=at(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>gu(e)},{area:xe.STARTER_COVE,id:12,tie:we.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:qt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState:dn,effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=kr(this,t,this.area),r=Lt(n,o);return`XP value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:13,tie:we.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:dn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Lp()}catch{}}},{area:xe.STARTER_COVE,id:14,tie:we.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${J(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1e3)},{area:xe.STARTER_COVE,id:15,tie:we.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:16,tie:we.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:17,tie:we.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:dn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:18,tie:we.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:qt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState:dn,effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=kr(this,t,this.area),r=Lt(n,o);return`MP value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:19,tie:we.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:dn,onLevelChange({newLevel:e}){if((e??0)>=1)try{_p()}catch{}}},{area:xe.STARTER_COVE,id:20,tie:we.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState(e){let t=wn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=mn();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:pn,titleOverride:en,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked"}},onLevelChange(){try{jt()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=kr(this,t,this.area),r=Lt(n,o);return`Coin value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:21,tie:we.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState(e){let t=wn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=mn();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:pn,titleOverride:en,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked"}},onLevelChange(){try{jt()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=kr(this,t,this.area),r=Lt(n,o);return`Coin value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:22,tie:we.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState(e){let t=wn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=mn();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:pn,titleOverride:en,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked"}},onLevelChange(){try{jt()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=kr(this,t,this.area),r=Lt(n,o);return`Coin value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},...Hh];for(let e of Lu){let t=Zo(e.tie??e.tieKey);t&&!Pp.has(t)&&Pp.set(t,e),e.baseCost=Ko(e.baseCost??0,0),e.baseCostBn=e.baseCost,e.numUpgEvolutions=Rs(e.numUpgEvolutions),e.upgType==="HM"?xu(e,e.numUpgEvolutions):(e.lvlCapBn=Ko(e.lvlCap??1/0,1/0),e.lvlCap=qp(e.lvlCapBn),e.lvlCapFmtHtml=Ar(e.lvlCapBn),e.lvlCapFmtText=ks(e.lvlCapBn)),e.bulkMeta=uE(e),Os(e)}Gp=new Map;pv=new Map;typeof window<"u"&&(mv(v()),window.addEventListener("saveSlot:change",()=>{mv(v()),uo()}));cv()});var c0={};vt(c0,{applyAllCurrencyOverridesForActiveSlot:()=>yl,applyStatMultiplierOverride:()=>Gn,getDebugCurrencyMultiplierOverride:()=>fl,getDebugStatMultiplierOverride:()=>PE,setDebugCurrencyMultiplierOverride:()=>Qv,setDebugPanelAccess:()=>gx,setDebugStatMultiplierOverride:()=>An});function gl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function xE(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function hn(e){typeof e=="function"&&em.push(e)}function Ru(){return{sections:new Set,subsections:new Set}}function LE(){let e=document.getElementById(pl);if(!e)return Ru();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function _E(e){let{sections:t,subsections:n}=Xv??Ru();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function Wv(){em.forEach(e=>{try{e?.()}catch{}}),em=[],im.length=0}function Dt(e){!e||typeof e.refresh!="function"||im.push(e)}function ct(e){im.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function CE(){if(typeof window>"u")return;let e=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();ct(b=>b.type==="currency"&&b.key===m&&b.slot===h)};window.addEventListener("currency:change",e,{passive:!0}),hn(()=>window.removeEventListener("currency:change",e));let t=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();ct(b=>b.type==="currency-mult"&&b.key===m&&b.slot===h)};window.addEventListener("currency:multiplier",t,{passive:!0}),hn(()=>window.removeEventListener("currency:multiplier",t));let n=g=>{let{slot:m,changeType:y,unlocked:h}=g?.detail??{},b=m??v();ct(E=>E.type==="xp"&&E.slot===b),ct(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===b),(y==="unlock"||typeof h=="boolean")&&ct(E=>E.type==="unlock"&&(E.slot==null||E.slot===b))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),hn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=g=>{let{changeType:m,slot:y}=g?.detail??{},h=y??v();ct(b=>b.type==="mutation"&&b.slot===h),ct(b=>b.type==="stat-mult"&&b.key==="mutation"&&b.slot===h),m==="unlock"&&ct(b=>b.type==="unlock"&&(b.slot==null||b.slot===h))};window.addEventListener("mutation:change",o,{passive:!0}),hn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let g=v();ct(m=>m.type==="upgrade"&&m.slot===g),ct(m=>m.type==="currency-mult"&&m.slot===g),ct(m=>m.type==="stat-mult"&&m.slot===g)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),hn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let g=v();ct(m=>m.slot===g)};window.addEventListener("saveSlot:change",i,{passive:!0}),hn(()=>window.removeEventListener("saveSlot:change",i));let s=g=>{let{slot:m,key:y}=g?.detail??{},h=m??v();ct(b=>b.type==="unlock"&&(b.slot==null||b.slot===h)&&(b.key==null||b.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),hn(()=>window.removeEventListener("unlock:change",s));let l=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="workshop-level"&&h.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),hn(()=>window.removeEventListener("workshop:change",l));let a=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="surge-level"&&h.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),hn(()=>window.removeEventListener("surge:level:change",a));let u=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="tsunami-nerf"&&(h.slot==null||h.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),hn(()=>window.removeEventListener("surge:nerf:change",u));let d=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="lab-level"&&(h.slot==null||h.slot===y)),ct(h=>h.type==="stat-mult"&&h.key==="rp"&&(h.slot==null||h.slot===y))};window.addEventListener("lab:level:change",d,{passive:!0}),hn(()=>window.removeEventListener("lab:level:change",d));let f=g=>{let{id:m,level:y}=g?.detail??{},h=v();ct(b=>b.type==="lab-node-level"&&b.slot===h&&b.id===m),m===1&&ct(b=>b.type==="tsunami-nerf"&&(b.slot==null||b.slot===h))};window.addEventListener("lab:node:change",f,{passive:!0}),hn(()=>window.removeEventListener("lab:node:change",f));let p=g=>{let{id:m,rp:y}=g?.detail??{},h=v();ct(b=>b.type==="lab-node-rp"&&b.slot===h&&b.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),hn(()=>window.removeEventListener("lab:node:rp",p))}function Ou(){return[{key:xe.STARTER_COVE,title:"The Cove",currencies:[{key:Me.COINS,label:"Coins"},{key:Me.BOOKS,label:"Books"},{key:Me.GOLD,label:"Gold"},{key:Me.MAGIC,label:"Magic"},{key:Me.GEARS,label:"Gears"},{key:Me.WAVES,label:"Waves"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function zv(){if(document.getElementById(_u))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=_u;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=_u,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=_u,document.head.appendChild(n)}function nm(){let e=document.getElementById(Hv);e&&e.remove()}function ME(){return Si&&je&&v()!=null&&!gl()&&xE()}function kE(e){e?.detail?.visible&&Co(),Fu()}function Mu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${Yv++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Zn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${Vv++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function kt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function sm(e,t=v()){let n=t??v();return n==null?null:`${gt.CURRENCY[e]}:${n}`}function ul(e,t=v()){let n=t??v();if(n==null)return c.fromInt(0);let o=O?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return sa(n,e)}catch{return c.fromInt(0)}}function TE(e,t,n=v()){let o=n??v(),r=ul(e,o);if(o==null||o!==v())return{previous:r,next:r};let i=sm(e,o),s=i&&po(i);s&&$s(i);let l=r;try{yn(o),l=Ai(e,t,{previous:r})??r,i&&rt(i)}catch{}finally{s&&Ei(i)}return ct(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function Jn(e,t){return`${e??"null"}::${t}`}function am(e,t){return ml.get(Jn(e,t))??null}function AE(e,t=v()){let n=t??v();return!e||n==null?null:`${gt.MULTIPLIER[e]}:${n}`}function NE(e,t=v()){let n=Jn(t,e);ml.delete(n),Us.delete(n),ct(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function lm(e,t){let n=!Pu(t,e),o=Jn(e,t),r=dl.get(o);if(!n&&r)return r;let i=RE(t,e);return i?(dl.set(o,i),i):(n&&dl.delete(o),null)}function Kv(e,t){ct(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function jv(e,t=v()){let n=wi(e,t);if(dl.delete(Jn(t,e)),gi.delete(Jn(t,e)),!(!n||typeof localStorage>"u")&&!po(n)){try{localStorage.removeItem(n)}catch{}Kv(e,t)}}function Pu(e,t=v()){return po(wi(e,t))}function Zv(e,t){return Pu(t,e)?lm(e,t):null}function Nn(e,t=v()){let n=Ii(e);return Bu(e,t,n)??n}function wi(e,t=v()){if(!e)return null;let n=t??v();return n==null?null:`${SE}:${e}:${n}`}function Ii(e){try{if(e==="xp"){let t=zl();if(t)return t}else if(e==="mutation"){let t=Du?.();if(t)return t;let n=Uu();if(n)return n}else if(e==="spawnRate"){let t=as(xe.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return fc()}catch{}return c.fromInt(1)}function RE(e,t=v()){let n=wi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function OE(e,t,n){let o=wi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=po(o),s=i&&Fs?Fs:localStorage.setItem.bind(localStorage);i&&!Fs&&$s(o),s(o,r.toStorage?.()??String(r)),i&&!Fs&&Ei(o)}catch{}}function cm(e,t=v()){if(t==null)return;let n=am(t,e);if(!n||t!==v())return;let o=Jn(t,e);if(!Tu.has(o)){Tu.add(o);try{let r=O?.[e]?.mult?.get?.();kt(r,n)||O?.[e]?.mult?.set?.(n)}catch{}finally{Tu.delete(o)}}}function Jv(){if(!(Uv||typeof window>"u")){Uv=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??v(),i=Jn(r,t);if(!r||!ml.has(i)||Tu.has(i))return;let s=Us.get(i),l=am(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let d=u.div(a),f=d.sig===1n&&d.e===0&&d._eOffset===0n?1:null,p=l.mulBigNumInteger(d);ml.set(i,p)}}catch{}Us.set(i,o)}else o&&Us.set(i,o);cm(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{yl()},{passive:!0})}catch{}}}function yl(){let e=v();e!=null&&Object.values(Me).forEach(t=>{cm(t,e)})}function Qv(e,t,n=v()){if(!e||n==null)return null;Jv();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=Jn(n,e);if(ml.set(r,o),!Us.has(r)){let i=O?.[e]?.mult?.get?.();Us.set(r,i)}return cm(e,n),o}function fl(e,t=v()){return!e||t==null?null:am(t,e)}function An(e,t,n=v()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return dl.set(Jn(n,e),o),gi.set(Jn(n,e),Ii(e)),OE(e,n,o),Kv(e,n),o}function PE(e,t=v()){return!e||t==null?null:lm(t,e)}function Gn(e,t,n=v()){let o=Ii(e),r=Bu(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(kt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=Jn(n,e),l=gi.get(s),a=Pu(e,n)&&l?l:o,u=null;try{let d=c.fromAny(r),f=c.fromAny(a);f.isZero()||(u=d.div(f))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function Bu(e,t,n){let o=lm(t,e),r=Jn(t,e);if(!o)return gi.delete(r),null;let i=gi.get(r),s=Pu(e,t);if(!i)gi.set(r,n);else if(!kt(i,n))return s?(gi.set(r,n),o):(jv(e,t),null);return o}function BE(){if(!(Bv||typeof localStorage>"u")){Bv=!0;try{Fs=localStorage.setItem.bind(localStorage),Fv=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!Ds.has(e))return Fs(e,t)},localStorage.removeItem=e=>{if(!Ds.has(e))return Fv(e)}}catch{}}}function po(e){return e!=null&&Ds.has(e)}function Ei(e){e&&(BE(),Ds.add(e))}function $s(e){e&&Ds.delete(e)}function FE(e){return e?po(e)?($s(e),!1):(Ei(e),!0):!1}function UE(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=po(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(FE(e),typeof t=="function")try{t(po(e))}catch{}o()}),o(),{button:n,refresh:o}}function DE(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>po(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>po(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?$s(u):Ei(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function $E(){let e=document.getElementById(pl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function qE(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{po(r)&&(o.push(r),$s(r))});try{return t?.()}finally{o.forEach(r=>Ei(r))}}function GE(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function um(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function om(e,t){e.classList.toggle("debug-invalid",!t)}function Ze(){let e=v();try{yn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function e0(e=v()){return e==null?null:`${IE}:${e}`}function t0(e=v()){let t=e0(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function n0(e,t=v()){let n=e0(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,tm);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function HE(e,t=v()){let n=t0(t);return n.unshift(e),n.length>tm&&(n.length=tm),n0(n,t),n}function Je(e){let t=v();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};HE(o,t),fm()}function fm(){if(!Bs)return;let e=t0();if(e.length===0){Bs.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",Bs.appendChild(t);return}Bs.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function o0(e=v()){return e==null?null:`${Ba}:${e}`}function r0(e,t=v()){let n=o0(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function i0(e=v()){let t=o0(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function XE(e){if(e){if(Object.values(Me).includes(e.type)){try{e.type===Me.BOOKS?O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount):O[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function YE(){let e=v();if(e==null)return{completed:0};let t=i0(e),n=0;return Object.entries(wc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,XE(r.reward))}),r0(t,e),{completed:n}}function VE(){let e=v();if(e==null)return{restored:0};let t=i0(e),n=0;return Object.entries(wc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),r0(t,e),{restored:n}}function tn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let h=document.createElement("span");h.className="debug-panel-id",h.textContent=`(ID: ${o})`,a.appendChild(h)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let d=!1,f=null,p=!1,g=r?UE(r,{onToggle:i}):null,m=h=>{if(d){f=h;return}f=null,u.value=typeof s=="function"?s(h):GE(h)};l.appendChild(u),g&&l.appendChild(g.button);let y=()=>{let h=um(u.value);if(!h){om(u,!1);return}om(u,!0);let b=r&&po(r);b&&$s(r);try{n(h,{input:u,setValue:m})}finally{b&&Ei(r),g&&g.refresh()}};return u.addEventListener("focus",()=>{d=!0}),u.addEventListener("change",y),u.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),p=!0,y(),u.blur())}),u.addEventListener("blur",()=>{if(d=!1,p||y(),p=!1,f!=null){let h=f;f=null,m(h)}}),m(t),g&&g.refresh(),{row:l,input:u,setValue:m,isEditing:()=>d}}function WE({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let d=document.createElement("div");d.className="debug-unlock-text";let f=document.createElement("span");if(f.className="debug-unlock-title",f.textContent=e,d.appendChild(f),t){let y=document.createElement("span");y.className="debug-unlock-desc",y.textContent=`- ${t}`,d.appendChild(y)}s.appendChild(l),s.appendChild(d);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",y=>{l.contains(y.target)||p()});let g=!1,m=()=>{let y=!1;try{y=typeof n=="function"?!!n():!1}catch{}return a.checked=y,g=y,y};return a.addEventListener("change",()=>{let y=g,h=a.checked;try{h?o?.():r?.()}catch{}Ze();let b=m();y!==b&&Je(`Toggled ${e} [GOLD]${y?"True":"False"}[/GOLD] \u2192 [GOLD]${b?"True":"False"}[/GOLD]`)}),m(),Dt({type:"unlock",slot:i,refresh:m}),s}function zE(e){try{if(e instanceof c||typeof e?.toScientific=="function")return J(e);let t=Number(e);return Number.isFinite(t)?J(t):String(e??"\u2014")}catch{return"\u2014"}}function KE({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},d=!1;if(l.forEach(({config:f,el:p})=>{if(f.type==="select"){u[f.key]=p.value;return}let g=um(p.value),m=g instanceof c;if(om(p,m),!m){d=!0;return}u[f.key]=g}),d||typeof n!="function"){s.textContent="\u2014";return}try{let f=n(u);s.innerHTML=zE(f)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let d=Object.assign({type:"text",defaultValue:""},u);if(d.key)if(d.type==="select"){let f=document.createElement("select");f.className="debug-panel-input",(d.options||[]).forEach(({value:p,label:g})=>{let m=document.createElement("option");m.value=p,m.textContent=g??p,d.defaultValue!=null&&d.defaultValue===p&&(m.selected=!0),f.appendChild(m)}),f.addEventListener("change",a),i.appendChild(f),l.push({config:d,el:f})}else{let f=document.createElement("input");f.type="text",f.className="debug-panel-input",f.placeholder=d.label||"",f.value=d.defaultValue??"",f.addEventListener("input",a),f.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(f),l.push({config:d,el:f})}}),a(),o}function Rr({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return Qe()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Hr()}catch{}let d=yi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),s!=null)try{let f=s.toStorage?.()??c.fromAny(s).toStorage(),p=yi.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(l!=null)try{let f=l.toStorage?.()??c.fromAny(l).toStorage(),p=yi.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Di({forceReload:!0})}catch{}try{Vl({changeType:"debug-panel",slot:n})}catch{}try{ct()}catch{}}function Or({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return lt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let f=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!f&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{hl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Vt()}catch{}try{Mr()}catch{}let d=vi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),e!=null)try{let f=e.toStorage?.()??c.fromAny(e).toStorage(),p=vi.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(t!=null)try{let f=t.toStorage?.()??c.fromAny(t).toStorage(),p=vi.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Vt({forceReload:!0})}catch{}try{dm({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ct()}catch{}}function jE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=sm(r.key,n),s=ul(r.key,n),l=tn(r.label,s,(a,{setValue:u})=>{let d=v();if(d==null)return;let f=ul(r.key,d),{next:p}=TE(r.key,a,d);u(p),kt(f,p)||(Ze(),Je(`Modified ${r.label} (${o}) ${J(f)} \u2192 ${J(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(ul(r.key,v()))});Dt({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let a=ul(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function ZE(e,t){let n=v();if(n==null){let U=document.createElement("div");U.className="debug-panel-empty",U.textContent="Select a save slot to edit stats.",e.appendChild(U);return}let o="spawnRate",r=wi(o,n),i=tn("Coin Spawn Rate",Nn(o,n),(U,{setValue:q})=>{let x=v();if(x==null)return;let B=Nn(o,x);try{An(o,U,x)}catch{}let M=Nn(o,x);q(M),kt(B,M)||(Ze(),Je(`Modified Spawn Rate (${a}) ${J(B)} \u2192 ${J(M)}`))},{storageKey:r,onLockChange:U=>{let q=v();if(q!=null){if(U){if(Zv(q,o))return;try{An(o,Ii(o),q)}catch{}}else Bu(o,q,Ii(o));i.setValue(Nn(o,q))}}});Dt({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==v())return;let U=Nn(o,n);i.setValue(U)}}),Dt({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==v())return;let U=Nn(o,n);i.setValue(U)}}),e.appendChild(i.row);let s=Qe(),l=lt(),a=t?.title??t?.key??"Unknown Area",u=yi.level(n),d=tn("XP Level",s.xpLevel,(U,{setValue:q})=>{let x=Qe().xpLevel;Rr({level:U});let B=Qe();q(B.xpLevel),kt(x,B.xpLevel)||(Ze(),Je(`Modified XP Level (${a}) ${J(x)} \u2192 ${J(B.xpLevel)}`))},{storageKey:u});Dt({type:"xp",slot:n,refresh:()=>{n===v()&&d.setValue(Qe().xpLevel)}}),e.appendChild(d.row);let f=yi.progress(n),p=tn("XP Progress",s.progress,(U,{setValue:q})=>{let x=Qe(),B=x?.xpLevel?.clone?.()??x?.xpLevel,M=x?.progress?.clone?.()??x?.progress;Rr({progress:U});let _=Qe();q(_.progress),d.setValue(_.xpLevel),(!kt(M,_.progress)||!kt(B,_.xpLevel))&&(Ze(),Je(`Modified XP Progress (${a}) ${J(M)} \u2192 ${J(_.progress)}`))},{storageKey:f});Dt({type:"xp",slot:n,refresh:()=>{n===v()&&p.setValue(Qe().progress)}}),e.appendChild(p.row);let g=vi.level(n),m=tn("MP Level",l.level,(U,{setValue:q})=>{let x=lt().level;Or({level:U});let B=lt();q(B.level),kt(x,B.level)||(Ze(),Je(`Modified MP Level (${a}) ${J(x)} \u2192 ${J(B.level)}`))},{storageKey:g});Dt({type:"mutation",slot:n,refresh:()=>{n===v()&&m.setValue(lt().level)}}),e.appendChild(m.row);let y=vi.progress(n),h=tn("MP Progress",l.progress,(U,{setValue:q})=>{let x=lt(),B=x?.level?.clone?.()??x?.level,M=x?.progress?.clone?.()??x?.progress;Or({progress:U});let _=lt();q(_.progress),m.setValue(_.level),(!kt(M,_.progress)||!kt(B,_.level))&&(Ze(),Je(`Modified MP Progress (${a}) ${J(M)} \u2192 ${J(_.progress)}`))},{storageKey:y});Dt({type:"mutation",slot:n,refresh:()=>{n===v()&&h.setValue(lt().progress)}}),e.appendChild(h.row);let b=Jr(n);if(b){let U=0;try{let x=localStorage.getItem(b),B=c.fromAny(x||"0");if(B.isInfinite())U=1/0;else try{U=Number(B.toScientific(20))}catch{U=0}}catch{}let q=tn("Workshop Level",U,(x,{setValue:B})=>{let M=Number(x);if(console.log("[DebugPanel] Workshop Level Commit. Value type:",typeof x,"IsBigNum:",x instanceof c,"Value:",x),x instanceof c)if(x.isInfinite())M=1/0;else try{M=Number(x.toScientific(20))}catch{M=NaN}if(Number.isNaN(M)||M<0)return;let _=M===1/0?"Infinity":String(Math.floor(M));try{localStorage.setItem(b,_),Ze(),Je(`Modified Workshop Level (The Cove) ${J(U)} \u2192 ${_}`),U=M}catch{}B(M)},{storageKey:b,onLockChange:()=>{let x=0;try{let B=localStorage.getItem(b),M=c.fromAny(B||"0");M.isInfinite()?x=1/0:x=Number(M.toScientific(20))}catch{}q.setValue(x)}});e.appendChild(q.row),Dt({type:"workshop-level",slot:n,refresh:()=>{if(n!==v())return;let x=0;try{let B=localStorage.getItem(b),M=c.fromAny(B||"0");M.isInfinite()?x=1/0:x=Number(M.toScientific(20))}catch{}q.setValue(x)}})}let E=Is(n);if(E){let U=0;try{let x=localStorage.getItem(E);x==="Infinity"?U=1/0:U=c.fromAny(x||"0")}catch{U=c.fromInt(0)}let q=tn("Surge Level",U,(x,{setValue:B})=>{let M="0",_=0;x instanceof c?x.isInfinite()?(M="Infinity",_=1/0):(M=x.toPlainIntegerString(),_=x):x===1/0||typeof x=="string"&&/infinity/i.test(x)?(M="Infinity",_=1/0):(M=String(x),_=x);try{localStorage.setItem(E,M),Ze();let X=_===1/0?"Infinity":J(_),Q=U===1/0||U instanceof c&&U.isInfinite()?"Infinity":J(U);Je(`Modified Surge Level (The Cove) ${Q} \u2192 ${X}`),_===1/0?U=1/0:_ instanceof c?U=_:U=c.fromAny(_)}catch{}B(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let X=U;if(X!==1/0&&X instanceof c)try{X=BigInt(X.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:X}}))}catch{}},{storageKey:E,onLockChange:x=>{let B=c.fromInt(0);try{let M=localStorage.getItem(E);M==="Infinity"?B=1/0:B=c.fromAny(M||"0")}catch{}q.setValue(B)}});Dt({type:"surge-level",slot:n,refresh:()=>{if(n!==v())return;let x=c.fromInt(0);try{let B=localStorage.getItem(E);B==="Infinity"?x=1/0:x=c.fromAny(B||"0")}catch{}q.setValue(x)}}),e.appendChild(q.row)}let L=fn(),R=tn("Lab Level",L,(U,{setValue:q})=>{let x;try{x=U instanceof c?U:c.fromAny(U),x.isNegative&&x.isNegative()&&(x=c.fromInt(0))}catch{q(fn());return}let B=fn();Na(x),Ze(),kt(B,x)||Je(`Modified Lab Level (The Cove) ${J(B)} \u2192 ${J(x)}`),q(x)},{storageKey:nd(n)});Dt({type:"lab-level",slot:n,refresh:()=>{n===v()&&R.setValue(fn())}}),e.appendChild(R.row);let T=()=>{let U=Ft(),q=Sn(),x=U+q;return x>1&&(x=1),x},F=tn("Tsunami Exponent",T().toFixed(2),(U,{setValue:q})=>{let x=Number(U);if(U instanceof c?U.isInfinite()?x=1/0:x=Number(U.toScientific(10)):typeof U=="string"&&/infinity/i.test(U)&&(x=1/0),Number.isNaN(x)){q(T().toFixed(2));return}let B=Sn(),M=x-B;M>1&&(M=1),M<0&&(M=0),M=Math.round(M*100)/100;let _=Ft();es(M),Ze(),Math.abs(_-M)>1e-4&&Je(`Modified Tsunami Exponent (The Cove) Base:${_.toFixed(2)} \u2192 ${M.toFixed(2)} (Effective: ${x.toFixed(2)})`),q(T().toFixed(2))},{storageKey:ed(n),format:U=>{let q=Number(U);return Number.isFinite(q)?q.toFixed(2):String(U)}});Dt({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==v())return;let U=T();F.setValue(U.toFixed(2))}}),e.appendChild(F.row)}function Dv(e,t){let n=v();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Ut(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=_n(t.key,i.id??i.tie),u=hi(t.key,i.id??i.tie,n),d=tn(l,a,(f,{setValue:p})=>{if(v()==null)return;let m=_n(t.key,i.id??i.tie);try{Wo(t.key,i.id??i.tie,f,!1)}catch{}let y=_n(t.key,i.id??i.tie);p(y),kt(m,y)||(Ze(),Je(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${J(m)} \u2192 Lv${J(y)}`))},{idLabel:s,storageKey:u});Dt({type:"upgrade",slot:n,refresh:()=>{if(n!==v())return;let f=_n(t.key,i.id??i.tie);d.setValue(f)}}),e.appendChild(d.row)})}function JE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=O?.[r.key]?.mult,l=fl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${gt.MULTIPLIER[r.key]}:${n}`,u=tn(`${r.label} Multiplier`,l,(d,{setValue:f})=>{let p=v();if(p==null)return;let g=fl(r.key,p)??i?.get?.()??c.fromInt(1);try{Qv(r.key,d,p)}catch{}yl();let y=fl(r.key,p)??i?.get?.()??c.fromInt(1);f(y),kt(g,y)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${J(g)} \u2192 ${J(y)}`))},{storageKey:a});Dt({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let f=fl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(f)}}),e.appendChild(u.row)})}function QE(){if(v()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Me).forEach(o=>{let r=O?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||kt(i,t))return;r.set(t),n+=1}catch{}}),n}function ex(){if(v()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Me).forEach(o=>{let r=O?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function tx(){let e=v();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=Qe()}catch{}try{r=lt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||kt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||kt(o?.progress,t);(!i||!s)&&(Rr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||kt(r?.level,t),s=r?.progress?.isInfinite?.()||kt(r?.progress,t);(!i||!s)&&(Or({level:t,progress:t}),n+=1)}}catch{}try{let i=Jr(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Is(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ct()}catch{}return n}function nx(){let e=v();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=Qe()}catch{}try{r=lt()}catch{}try{o?.unlocked&&(Rr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Or({level:t,progress:t}),n+=1)}catch{}try{let i=Jr(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Is(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ct()}catch{}return n}function s0(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Qe()?.unlocked}catch{return!1}},onEnable:()=>{try{Hr()}catch{}try{Di({forceReload:!0})}catch{}},onDisable:()=>{try{$i({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{hl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{hl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return Pd()}catch{return!1}},onEnable:()=>{try{ci()}catch{}},onDisable:()=>{try{$c()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return Bd()}catch{return!1}},onEnable:()=>{try{Dc()}catch{}},onDisable:()=>{try{qc()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return wd()}catch{return!1}},onEnable:()=>{try{Sc(!0)}catch{}},onDisable:()=>{try{Sc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!In()}catch{return!1}},onEnable:()=>{try{hr(!0)}catch{}},onDisable:()=>{try{hr(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return Pt(4)>=1}catch{return!1}},onEnable:()=>{try{ti(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{ti(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function a0(e){let t=v();if(t==null)return 0;let n=0;s0(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{ct()}catch{}return n}function ox(){let e=v();if(e==null)return{unlocks:0,toggles:0};let t=0;Ou().forEach(o=>{Ut(o.key).forEach(r=>{if(r?.unlockUpgrade)try{mi(o.key,r,e),t+=1}catch{}})});try{ci()}catch{}try{Dc()}catch{}let n=a0(!0);return{unlocks:t,toggles:n}}function rx(){let e=v();if(e==null)return{locks:0,toggles:0};let t=0;Ou().forEach(o=>{Ut(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Wp(o.key,r,e),t+=1}catch{}})});try{$c()}catch{}try{qc()}catch{}let n=a0(!1);return{locks:t,toggles:n}}function ix(e,t=v()){let n=t??v();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(sm(a,n)),r(AE(a,n))},s=a=>r(wi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(yi.level(n)),r(yi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(vi.level(n)),r(vi.progress(n)))};return e==="all"?(Object.values(Me).forEach(i),l("xp"),l("mutation"),Nu.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Me).forEach(i),Array.from(o)):e==="allUnlockedStats"?(Qe()?.unlocked&&l("xp"),lt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Me).forEach(i),Qe()?.unlocked&&l("xp"),lt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function ku(e){try{O?.[e]?.set?.(c.fromInt(0))}catch{}try{NE(e)}catch{}try{Fl(e,c.fromInt(1))}catch{}}function sx(e){if(e==="all"){Object.values(Me).forEach(i=>ku(i));let o=c.fromInt(0);return Rr({level:o,progress:o}),Or({level:o,progress:o}),Nu.forEach(({key:i})=>{try{An(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Me).length+Nu.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Me).forEach(i=>{ku(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(Qe()?.unlocked){Rr({level:o,progress:o});try{An("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(lt()?.unlocked){Or({level:o,progress:o});try{An("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Me).forEach(l=>{ku(l),o+=1});let r=c.fromInt(0),i=0;try{if(Qe()?.unlocked){Rr({level:r,progress:r});try{An("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(lt()?.unlocked){Or({level:r,progress:r});try{An("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return ku(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{jv(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Rr({level:n,progress:n});try{An("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Or({level:n,progress:n});try{An("mutation",c.fromInt(1))}catch{}return"MP"}try{An(t,c.fromInt(1))}catch{}return`stat ${t}`}function ax(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";Nu.forEach(r=>{if(r.key==="spawnRate")return;let i=wi(r.key,n),s=tn(`${r.label} Multiplier`,Nn(r.key,n),(l,{setValue:a})=>{let u=v();if(u==null)return;let d=Nn(r.key,u);try{An(r.key,l,u)}catch{}let f=Nn(r.key,u);a(f),kt(d,f)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${J(d)} \u2192 ${J(f)}`))},{storageKey:i,onLockChange:l=>{let a=v();if(a!=null){if(l){if(Zv(a,r.key))return;try{An(r.key,Ii(r.key),a)}catch{}}else Bu(r.key,a,Ii(r.key));s.setValue(Nn(r.key,a))}}});Dt({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Nn(r.key,n);s.setValue(l)}}),Dt({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Nn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Dt({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Nn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function lx(e){let t=v();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!wt||wt.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}wt.forEach(n=>{let o=Zn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=ic(t,n.id),s=tn("Level",Pt(n.id),(u,{setValue:d})=>{let f=Number(u);if(u instanceof c&&(f=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(f)||f<0)return;f>n.maxLevel&&(f=n.maxLevel),f=Math.floor(f);let p=Pt(n.id);ti(n.id,f),Ze(),p!==f&&Je(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${f}`),d(f)},{storageKey:i});Dt({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===v()&&s.setValue(Pt(n.id))}}),r.appendChild(s.row);let l=sc(t,n.id),a=tn("Current RP",ro(n.id),(u,{setValue:d})=>{let f;try{f=u instanceof c?u:c.fromAny(u),f.isNegative&&f.isNegative()&&(f=c.fromInt(0))}catch{d(ro(n.id));return}let p=ro(n.id);ka(n.id,f),Ze(),kt(p,f)||Je(`Modified Node ${n.id} RP (The Cove) ${J(p)} \u2192 ${J(f)}`),d(f)},{storageKey:l});Dt({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===v()&&a.setValue(ro(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function cx(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Wl(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Nf(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>pm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Ss(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>dr(n)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>zp(n,o,r)}]}].forEach(n=>{let o=Zn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=KE({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function ux(e){if(e.innerHTML="",v()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}yl(),Ou().forEach(o=>{let r=Zn(o.title,i=>{let s=Zn("Currencies",g=>{jE(g,o)}),l=Zn("Stats",g=>{ZE(g,o)}),a=Zn("Multipliers",g=>{let m=Zn("Currencies",h=>{JE(h,o)}),y=Zn("Stats",h=>{ax(h,o)});g.appendChild(m),g.appendChild(y)}),u=Zn("Upgrades",g=>{Dv(g,o)}),d=null,f=null;o.key===xe.STARTER_COVE&&(d=Zn("Automation Upgrades",g=>{Dv(g,{key:xe.AUTOMATION,title:"Automation"})}),f=Zn("Lab Nodes",g=>{lx(g)}));let p=Zn("Calculators",g=>{cx(g)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),d&&i.appendChild(d),f&&i.appendChild(f),i.appendChild(p)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function $v(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];return o.forEach(i=>{Ut(i).forEach(l=>{e&&Xo(i,l.id).locked||r.push({areaKey:i,upg:l})})}),il(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;Wo(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function qv(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];o.forEach(s=>{Ut(s).forEach(a=>{e&&Xo(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{il(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Lr(s,l.id,"0"),Wo(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function Gv(e){let t=v();if(t==null)return 0;let n=e?"1":"0",o=0,r=Ut(Ke);il(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;Wo(Ke,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(Wi),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(xe).forEach(l=>{if(l===Ke)return;Ut(l).forEach(u=>{s.has(u.costType)&&(Lr(l,u.id,n),o++)})}),Lr(Ke,no,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function fx(e){e.innerHTML="";let t=v();if(t==null){let h=document.createElement("div");h.className="debug-panel-empty",h.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(h);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:h}=YE();Ze(),Je(`Completed all dialogues (${h} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:h}=VE();Ze(),Je(`Restored dialogues to unclaimed state (${h} ${h===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let h=QE();Ze(),Je(`Set all currencies to Infinity (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let h=tx();Ze(),Je(`Set all stats to Infinity (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let h=ex();Ze(),Je(`Set all currencies to 0 (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let h=nx();Ze(),Je(`Set all unlocked stats to 0 (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let h=$v(!0);Ze(),Je(`Maxed ${h} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let h=qv(!0);Ze(),Je(`Reset ${h} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let h=$v(!1);Ze(),Je(`Maxed all ${h} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let h=qv(!1);Ze(),Je(`Reset all ${h} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let h=Gv(!0);Ze(),Je(`Enabled automation for ${h} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let h=Gv(!1);Ze(),Je(`Disabled automation for ${h} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:h,toggles:b}=ox();Ze(),Je(`Unlocked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:h,toggles:b}=rx();Ze(),Je(`Locked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{n0([],t),fm(),Ze(),Je("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let h=v();if(h!=null)try{localStorage.setItem(wE(h),String(EE)),Uo(!0),Ze(),Je("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let h=window.prompt("Enter amount of seconds to warp:");if(h==null)return;let b=um(h);if(!b||typeof b.isZero=="function"&&b.isZero()||typeof b.isNegative=="function"&&b.isNegative())return;let E,L=!1;$t()?E=is(b):(E=pc(b),L=!0),ii(E);let R=b.mulSmall?b.mulSmall(1e3):b.mulBigNumInteger(c.fromInt(1e3));vr(E,R,L),Ze(),Je(`Performed OP Time Warp for ${J(b)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(h=>{let b=document.createElement("button");b.type="button",b.className="debug-panel-toggle debug-misc-button",b.textContent=h.label,b.addEventListener("click",h.onClick),o.appendChild(b)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",Ou().forEach(h=>{let b=document.createElement("optgroup");b.label=h.title||h.key,h.currencies.forEach(E=>{let L=document.createElement("option");L.value=`currency:${E.key}`,L.textContent=`${h.title||h.key} \u2192 ${E.label}`,b.appendChild(L)}),h.stats.forEach(E=>{let L=document.createElement("option");L.value=`stat:${E.key}`,L.textContent=`${h.title||h.key} \u2192 ${E.label}`,b.appendChild(L)}),s.appendChild(b)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let d=document.createElement("option");d.value="all",d.textContent="All",s.appendChild(d),s.querySelector(`option[value="${Cu}"]`)||(Cu=cl),s.value=Cu;let f=()=>ix(s.value||cl,v()),p=DE(f);s.addEventListener("change",()=>{Cu=s.value||cl,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let g=document.createElement("button");g.type="button",g.className="debug-panel-toggle reset-check",g.textContent="\u2705",g.addEventListener("click",()=>{let h=s.value||cl,b=f(),E=p.isLocked(),L=(R=!0)=>{let T=qE(b,()=>sx(h))??{label:h,count:0};if(E&&b.forEach(F=>Ei(F)),p.refresh(),Ze(),R){let{label:F,count:U}=T;Je(`Reset ${U===1?"value and multiplier":"values and multipliers"} for ${F} to defaults.`)}};L(!0),setTimeout(()=>L(!1),100)}),r.appendChild(g),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-danger-button",y.textContent="Wipe Slot & Refresh",y.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let b=document.querySelector(".menu-root"),E=document.getElementById("game-root");b&&(b.hidden=!1,b.style.display="",b.style.visibility=""),E&&(E.hidden=!0,E.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(y),e.appendChild(m)}function dx(e){e.innerHTML="";let t=v();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Di()}catch{}let n=s0(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(WE(o))})}function l0(){if(!Si||gl())return;Wv(),zv(),Yv=0,Vv=0;let e=document.getElementById(pl);e&&e.remove();let t=document.createElement("div");t.id=pl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Co({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Co()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:d,hideOnMobile:f})=>{let p=document.createElement("div");p.className="debug-panel-info-line",f&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=d,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(Mu("Areas: main currency/stat/upgrade management for each area","debug-areas",d=>{ux(d)})),t.appendChild(Mu("Unlocks: modify specific unlock flags","debug-unlocks",d=>{dx(d)})),t.appendChild(Mu("Action Log: keep track of everything you do","debug-action-log",d=>{let f=document.createElement("div");f.id="action-log-entries",f.className="debug-panel-action-log",f.style.maxHeight="240px",f.style.overflowY="auto",d.appendChild(f),Bs=f,fm(),hn(()=>{Bs=null})})),t.appendChild(Mu("Miscellaneous: helpful miscellaneous functions","debug-misc",d=>{fx(d)})),_E(t),document.body.appendChild(t),Au>0)try{t.scrollTop=Au}catch{}CE(),bi=!0}function rm(){if(!(!Si||gl())){if(v()==null){Co();return}bi||l0()}}function Co({preserveExpansionState:e=!1}={}){Xv=e?LE():Ru();let t=document.getElementById(pl);if(t){try{Au=t.scrollTop??0}catch{Au=0}t.remove()}Wv(),bi=!1}function px(){if(!Si||gl()||v()==null){Co();return}bi?Co({preserveExpansionState:!0}):rm()}function mx(){Co(),nm()}function Fu(){if(!ME()){nm(),Co();return}zv(),nm();let e=document.createElement("button");e.id=Hv,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{px()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function hx(e){if(Si=!!e,!Si){mx();return}Fu()}function gx(e){hx(e)}var _u,pl,Hv,cl,bi,Si,em,Xv,Au,Cu,Yv,Vv,im,Bs,ml,Us,Tu,dl,gi,Ds,Bv,Fs,Fv,SE,IE,tm,wE,EE,Jp,yi,Qp,vi,Nu,Uv,Gi=De(()=>{Ct();zt();bt();qn();Eo();wo();un();Gc();Lc();Zi();Io();so();Mc();Kr();fd();oi();ni();mc();_u="debug-panel-style",pl="debug-panel",Hv="debug-panel-toggle",cl=`currency:${Me.COINS}`,bi=!1,Si=!1,em=[],Xv=Ru(),Au=0,Cu=cl,Yv=0,Vv=0,im=[],Bs=null,ml=new Map,Us=new Map,Tu=new Set,dl=new Map,gi=new Map,Ds=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=Ds);Bv=!1,Fs=null,Fv=null,SE="ccc:debug:stat-mult",IE="ccc:actionLog",tm=100,wE=e=>`ccc:warp:charges:${e}`,EE=24;Jp="ccc:xp",yi={unlock:e=>`${Jp}:unlocked:${e}`,level:e=>`${Jp}:level:${e}`,progress:e=>`${Jp}:progress:${e}`},Qp="ccc:mutation",vi={unlock:e=>`${Qp}:unlocked:${e}`,level:e=>`${Qp}:level:${e}`,progress:e=>`${Qp}:progress:${e}`},Nu=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];Uv=!1;yl();Jv();document.addEventListener("keydown",e=>{if(!(!Si||gl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&v()!=null){if(e.shiftKey){bi?($E(),Co()):rm(),e.preventDefault();return}bi?Co({preserveExpansionState:!0}):rm(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Fu()});window.addEventListener("menu:visibilitychange",kE);window.addEventListener("saveSlot:change",()=>{Fu(),bi&&l0()})});var p0={};vt(p0,{addExternalMutationGainMultiplierProvider:()=>ri,addMutationPower:()=>ls,broadcastMutationChange:()=>dm,computeMutationMultiplierForLevel:()=>Ss,computeMutationRequirementForLevel:()=>pm,getMutationCoinSprite:()=>Cp,getMutationGainMultiplier:()=>Du,getMutationMultiplier:()=>Uu,getMutationState:()=>lt,getTotalCumulativeMp:()=>tl,initMutationSystem:()=>Vt,isMutationUnlocked:()=>_o,onMutationChange:()=>pi,setMutationUnlockedForDebug:()=>hl,unlockMutationSystem:()=>Mr});function $u(e){try{return e?.toStorage?.()}catch{return null}}function Ci(){try{jt()}catch{}}function d0(e){let t=e;if(!t.isZero?.()){let n=_i.size>0?Array.from(_i):typeof Sl=="function"?[Sl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof We?t=r.clone?.()??r:r!=null&&(t=We.fromAny(r))}catch{}}return t}function bx(){if(typeof mm=="function"){try{mm()}catch{}mm=null}if(typeof hm=="function"){try{hm()}catch{}hm=null}}function Il(e){if(e instanceof We)try{return e.clone?.()??We.fromAny(e)}catch{return ft()}try{return We.fromAny(e??0)}catch{return ft()}}function Sx(e){if(!e||typeof e!="object")return ft();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?We.fromInt(100):We.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function Gu(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=$e(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function wm(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let d=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(d+=vx*(p-1),!Number.isFinite(d)))return Number.POSITIVE_INFINITY}let f=u*d;return Number.isFinite(f)?f:Number.POSITIVE_INFINITY}let n=Gu(e);if(!Number.isFinite(n))return We.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return We.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),d=Math.pow(l/u,1/a),f=o-9;r=u*Math.pow(d,f)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return We.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return We.fromAny("Infinity");let i=Ae(r);return Sx(i)}function Pr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=wm(D.level);D.requirement=n}function Ix(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=$e(e),l=$e(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function bm(){return Rn.container&&Rn.container.isConnected?!0:(Rn.container=document.querySelector("[data-mp-hud].mp-counter"),Rn.container?(Rn.bar=Rn.container.querySelector(".mp-bar"),Rn.fill=Rn.container.querySelector(".mp-bar__fill"),Rn.levelValue=Rn.container.querySelector(".mp-level-value"),Rn.progress=Rn.container.querySelector("[data-mp-progress]"),!0):!1)}function xi(e){try{return J(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function Qo(){if(!bm())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Rn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=xi(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=xi(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Pi();return}e.removeAttribute("hidden");let i=D.requirement,s=Ix(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=xi(D.level)),r){let a=xi(D.progress),u=xi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=xi(D.progress).replace(/<[^>]*>/g,""),u=xi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Pi()}function er(e="update",t={}){let n=lt(),o={...n,slot:D.slot??v(),changeType:e,...t};if(vm.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function Em(){let e=D.slot;if(e==null&&(e=v(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(vl(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Li(e),D.level.toStorage())}catch{}try{localStorage.setItem(qs(e),D.progress.toStorage())}catch{}rt(vl(e)),rt(Li(e)),rt(qs(e));let t=(()=>{let u=D.unlocked,d=D.level,f=D.progress;try{u=localStorage.getItem(vl(e))==="1"}catch{}try{let p=localStorage.getItem(Li(e));p&&(d=We.fromAny(p))}catch{}try{let p=localStorage.getItem(qs(e));p&&(f=We.fromAny(p))}catch{}return{unlocked:u,level:d,progress:f}})(),n=$u(t.level),o=$u(t.progress),r=$u(D.level),i=$u(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&qu(t,{skipPersist:!0})}function Sm(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function wx(){if(!D.unlocked)return;let e=D.slot??v();if(e!=null&&Sm(Li(e))){Pr();return}Pr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(Gs()),Pr(),t=D.requirement,!t||typeof t!="object"){D.progress=ft();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=ft())}function qu(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=Il(e.level),D.progress=Il(e.progress),D.unlocked||(D.level=ft(),D.progress=ft()),Pr(),t||Em(),Qo(),er("load"),Ci()}function gm(e){let t=e??v();if(t==null){qu({unlocked:!1,level:ft(),progress:ft()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=ft(),r=ft();try{n=localStorage.getItem(vl(t))==="1"}catch{}try{let i=localStorage.getItem(Li(t));i&&(o=We.fromAny(i))}catch{}try{let i=localStorage.getItem(qs(t));i&&(r=We.fromAny(i))}catch{}qu({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function Ex(){for(;bl.length;){let e=bl.pop();try{e?.()}catch{}}}function ym(e){u0!==e&&(Ex(),u0=e,e!=null&&(bl.push(_t(vl(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=ft(),D.progress=ft()),Pr(),Qo(),er("storage"),Ci())}})),bl.push(_t(Li(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Pr(),Qo(),er("storage"),Ci())}catch{}}})),bl.push(_t(qs(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Pr(),Qo(),er("storage"))}catch{}}}))))}function Vt({forceReload:e=!1}={}){if(bx(),f0){let n=v();return(n!==D.slot||e)&&gm(n),ym(n),bm(),Qo(),lt()}f0=!0,bm();let t=v();return D.slot=t,gm(t),ym(t),Qo(),Ci(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=v();D.slot=n,gm(n),ym(n),Qo(),Ci(),er("slot")}),lt()}function lt(){return{unlocked:D.unlocked,level:Il(D.level),progress:Il(D.progress),requirement:Il(D.requirement)}}function _o(){return!!D.unlocked}function Mr(){return Vt(),D.unlocked?!1:(D.unlocked=!0,Pr(),Em(),Qo(),er("unlock"),Ci(),!0)}function hl(e){Vt();let t=!!e;qu({unlocked:t,level:t?D.level:ft(),progress:t?D.progress:ft()})}function ls(e){Vt();let t=D.slot??v();if(t!=null&&Sm(qs(t))||!D.unlocked)return lt();let n=t!=null&&Sm(Li(t));if(D.level&&D.level.isInfinite?.()){let d=D.level.clone?.()??D.level,f=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=We.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=We.fromAny("Infinity")}catch{}let p;try{p=e instanceof We?e:We.fromAny(e??0)}catch{p=ft()}return p=d0(p),p=Gn("mutation",p),er("progress",{delta:p.clone?.()??p,levelsGained:ft(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:d.clone?.()??d,previousProgress:f.clone?.()??f})}let o;try{o=e instanceof We?e:We.fromAny(e??0)}catch{o=ft()}if(o=d0(o),o=Gn("mutation",o),o.isZero?.())return lt();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=We.fromAny("Infinity")}catch{}try{D.progress=We.fromAny("Infinity")}catch{D.progress=ft()}try{D.requirement=We.fromAny("Infinity")}catch{}}else wx();Em(),Qo();let a=D.level.sub(i);return a.isZero?.()||Ci(),er("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function dm(e={}){Vt();let t=e.changeType??"manual";return er(t,e)}function Ss(e){let t;if(e instanceof We)try{t=e.clone?.()??e}catch{t=ft()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=ft()}else try{t=c.fromAny(e??0)}catch{t=ft()}if(t&&t.isInfinite?.())try{return We.fromAny("Infinity")}catch{return Gs()}let n=Gu(t);if(!Number.isFinite(n))try{return We.fromAny("Infinity")}catch{return Gs()}if(n<=0)return Gs();let o=n*yx;return Ae(o)}function pm(e){let t;try{t=e instanceof We?e:We.fromAny(e??0)}catch{t=ft()}try{return wm(t)}catch{return ft()}}function Uu(){if(Vt(),!D.unlocked)return Gs();try{return Ss(D.level)}catch{return Gs()}}function Du(){let e=c.fromInt(1);if(_i.size>0||Sl){let t=_i.size>0?Array.from(_i):typeof Sl=="function"?[Sl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof We?e=o.clone?.()??o:o!=null&&(e=We.fromAny(o))}catch{}}return e}function Cp(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=Gu(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function pi(e){return typeof e!="function"?()=>{}:(vm.add(e),()=>{vm.delete(e)})}function ri(e){return typeof e!="function"?()=>{}:(_i.add(e),()=>{_i.delete(e)})}function tl(){if(Vt(),!D.unlocked)return ft();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=Gu(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=wm(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Im,vl,Li,qs,We,ft,Gs,yx,vx,D,Rn,vm,bl,u0,f0,mm,hm,_i,Sl,Eo=De(()=>{Ct();bt();Gi();zt();un();If();qn();Im="ccc:mutation",vl=e=>`${Im}:unlocked:${e}`,Li=e=>`${Im}:level:${e}`,qs=e=>`${Im}:progress:${e}`,We=c,ft=()=>We.fromInt(0),Gs=()=>We.fromInt(1),yx=Math.log10(2),vx=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:ft(),progress:ft(),requirement:ft(),slot:null},Rn={container:null,bar:null,fill:null,levelValue:null,progress:null},vm=new Set,bl=[],u0=null,f0=!1,mm=null,hm=null,_i=new Set,Sl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Vt,unlockMutationSystem:Mr,addMutationPower:ls,getMutationState:lt,getMutationMultiplier:Uu,isMutationUnlocked:_o,getTotalCumulativeMp:tl,addExternalMutationGainMultiplierProvider:ri,getMutationGainMultiplier:Du}))});var wl,m0,h0,xm,Lm,_m,g0=De(()=>{wl=`attribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,m0='precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform vec3 uColorDeep; uniform vec3 uColorShallow; void main() { /* Wave animation settings */ float speed = 1.2; float time = uTime * speed; /* Combine sine waves for a more natural look */ /* vUv.x is 0..1 across the screen width */ float wave1 = sin(vUv.x * 8.0 - time) * 0.0285; float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; /* Define the shoreline height (baseline) */ /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */ /* We want to discard pixels below this threshold */ float threshold = 0.428 + wave; if (vUv.y < threshold) { discard; } /* Recalculate gradient based on the new "bottom" */ /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */ float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0); vec3 col = mix(uColorShallow, uColorDeep, gradientY); /* Add a subtle "foam" or highlight at the edge */ float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold); col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4); gl_FragColor = vec4(col, 1.0); }',h0="precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform sampler2D uWaveMap; uniform vec3 uColorDeep; uniform vec3 uColorShallow; uniform vec3 uColorWaveDeep; uniform vec3 uColorWave; /* Simple noise for foam breakup */ float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); } float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f*f*(3.0-2.0*f); return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x), mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y); } void main() { vec2 uv = vUv; /* Sample the simulation (physics) */ /* Wave Logic */ vec2 waveUV = uv - vec2(0.0, 0.0285); float intensity = texture2D(uWaveMap, waveUV).r; /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */ float shadowOffset = 8.0 / uResolution.y; float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r; /* Discard only if BOTH are empty */ if (intensity < 0.01 && shadowIntensity < 0.01) discard; /* Directional Noise: Streaky vertical noise for rushing water effect */ /* Stretch heavily along Y-axis to simulate speed/motion blur */ float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0)); /* Define Zones based on Intensity */ /* Body (Medium Intensity): Darker/turbulent blue with noise */ /* Edge (High Intensity): Bright white foam */ float foamThreshold = 0.5; float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity); /* Base Colors */ vec3 bodyColor = uColorWaveDeep; vec3 foamColor = uColorWave; /* Mix Colors */ vec3 finalColor = mix(bodyColor, foamColor, foamMix); /* Add streaks to the body part */ if (foamMix < 0.9) { finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix); } /* Hard Edge & Opacity */ /* Ensure the front (bottom) remains sharp, back trails off */ /* Calculate Alpha based on Intensity */ /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */ /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */ /* Low Intensity (Top/Tail): Fades to 0.0 */ float finalAlpha = smoothstep(0.02, 0.15, intensity); /* Screen Fade */ /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */ /* Dynamic Shoreline Fade */ /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */ /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */ float speed = 1.2; float time = uTime * speed; float wave1 = sin(uv.x * 8.0 - time) * 0.0285; float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; float threshold = 0.428 + wave; /* Fade out quickly after exiting the water body (below threshold) */ /* Fade starts slightly higher than the threshold to soften the transition */ /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */ float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y); float screenFade = shoreFade; /* --- Composite Shadow & Wave --- */ float waveAlpha = finalAlpha * screenFade; /* Shadow Alpha */ float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity); /* Shadow is weaker (40% opacity) */ float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade; /* Mix: Wave over Shadow */ /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */ float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha); /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */ /* Shadow is black (RGB=0), so second term is 0 */ vec3 outRGB = finalColor * waveAlpha; gl_FragColor = vec4(outRGB, outAlpha); }",xm=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,Lm=`precision mediump float;\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,_m=`precision mediump float;\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var b0={};vt(b0,{WaterSystem:()=>Hu,waterSystem:()=>Xu});function v0(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function Hs(e,t,n){let o=v0(e,e.VERTEX_SHADER,t),r=v0(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var xx,y0,Lx,_x,Hu,Xu,Cm=De(()=>{g0();xx=[.2,.5,.9],y0=[.2,.9,1],Lx=[1,1,1],_x=[.45,.8,1];Hu=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:Hs(s,wl,h0),simProgram:Hs(s,wl,_m),brushProgram:Hs(s,xm,Lm),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=Hs(this.glBg,wl,m0),this.bgSimProgram=Hs(this.glBg,wl,_m),this.bgBrushProgram=Hs(this.glBg,xm,Lm)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,d=-(s/this.height*2-1),f=l/this.width,p=a/this.height,g=new Float32Array([u-f,d-p,0,0,1,u+f,d-p,1,0,1,u-f,d+p,0,1,1,u+f,d+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,g,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),y=t.getAttribLocation(n,"aUv"),h=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(y),t.vertexAttribPointer(y,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let d=r;for(;d>0;){let f=Math.min(d,s);l.push(f),d-=f}}l.forEach(d=>{let f=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,d);this.bgReadFBO=f.readFBO,this.bgWriteFBO=f.writeFBO,this.bgReadTexture=f.readTex,this.bgWriteTexture=f.writeTex}),this.fgLayers.forEach(d=>{l.forEach(f=>{let p=this.runSimStep(d.gl,d.simProgram,d.quadBuffer,d.readFBO,d.writeFBO,d.readTexture,d.writeTexture,f);d.readFBO=p.readFBO,d.writeFBO=p.writeFBO,d.readTexture=p.readTex,d.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),xx),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),y0),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(d=>{let f=d.gl;f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,d.canvas.width,d.canvas.height),f.useProgram(d.program),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,d.readTexture),f.uniform1i(f.getUniformLocation(d.program,"uWaveMap"),0),f.uniform3fv(f.getUniformLocation(d.program,"uColorShallow"),y0),f.uniform3fv(f.getUniformLocation(d.program,"uColorWave"),Lx),f.uniform3fv(f.getUniformLocation(d.program,"uColorWaveDeep"),_x),f.uniform1f(f.getUniformLocation(d.program,"uTime"),o),f.uniform2f(f.getUniformLocation(d.program,"uResolution"),d.canvas.width,d.canvas.height),f.bindBuffer(f.ARRAY_BUFFER,d.quadBuffer);let p=f.getAttribLocation(d.program,"position");f.enableVertexAttribArray(p),f.vertexAttribPointer(p,2,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLE_STRIP,0,4)})}},Xu=new Hu});var L0={};vt(L0,{createSpawner:()=>Ox});function x0(e){if(!e||typeof e!="object"){Xs=!1,Mi=0n;return}Xs=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Mi=n&&n!=="Infinity"?BigInt(n):0n}catch{Mi=0n}}function Mx(e){let t=1-e;return 1-t*t*t}function Tx(e){if(!e)return null;let t=S0.get(e);return t||(t=new Image,t.src=e,S0.set(e,t)),t}function Ox({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:d=je?Cx:1e4,initialBurst:f=1,coinTtlMs:p=1e99,waveSoundSrc:g="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:y=.2,waveSoundMinIntervalMs:h=160,enableDropShadow:b=!1}={}){let E=o,L={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function R(){return!!(L.pf&&L.w&&L.c)}R()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let T=7,F=[],U=[],q=!1;if(L.c)for(let S=0;S<T;S++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+S*10}`,L.c.appendChild(k);let P=k.getContext("2d",{alpha:!0});F.push(k),U.push(P)}let x=null,B=null;L.c&&(x=document.createElement("canvas"),x.style.position="absolute",x.style.inset="0",x.style.pointerEvents="none",x.style.zIndex="100",L.c.appendChild(x),B=x.getContext("2d",{alpha:!0}));let M={collectBatch:null,getMagnetUnit:null};function _(S){M={...M,...S}}let X={pfRect:null,wRect:null,safeBottom:0,pfW:0};function Q(){if(!R())return!1;let S=L.pf.getBoundingClientRect(),k=L.w.getBoundingClientRect(),P=L.hud?L.hud.getBoundingClientRect().height:0;X={pfRect:S,wRect:k,safeBottom:S.height-P,pfW:S.width};let A=window.devicePixelRatio||1;return F.forEach((N,pe)=>{if(N){N.width=S.width*A,N.height=S.height*A,N.style.width=S.width+"px",N.style.height=S.height+"px";let de=U[pe];de&&(de.setTransform(1,0,0,1,0,0),de.scale(A,A),de.imageSmoothingEnabled=!0,de.imageSmoothingQuality="high")}}),q=!0,x&&(x.width=S.width*A,x.height=S.height*A,x.style.width=S.width+"px",x.style.height=S.height+"px",B&&(B.setTransform(1,0,0,1,0,0),B.scale(A,A))),!0}Q();let fe="ResizeObserver"in window?new ResizeObserver(()=>Q()):null;fe&&L.pf&&fe.observe(L.pf),document.addEventListener("visibilitychange",()=>{document.hidden||Q()});let K=(S,k,P)=>Math.max(k,Math.min(P,S)),ee=Math.max(2e3,d*3),ve=12,he=[],Y=[],te=0,$=[];function G(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=E,k.style.objectFit="contain",k.style.borderRadius="50%",S.appendChild(k),b&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let j=()=>he.length?he.pop():G();function le(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let k=0;k<=6;k++)S.classList.remove(`coin--size-${k}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),he.length<ee&&he.push(S)}function ue(S,k=-1){if(S.isRemoved)return;S.isRemoved=!0;let P=k;(P===-1||Y[P]!==S)&&(S.index!==void 0&&Y[S.index]===S?P=S.index:P=Y.indexOf(S)),P!==-1&&(Y[P]=null,te++),S.el?(le(S.el),S.el=null):q=!0}function C(S){let k=S._coinObj;if(k){let P=-1;k.index!==void 0&&Y[k.index]===k?P=k.index:P=Y.indexOf(k),P!==-1&&(Y[P]=null,te++),S._coinObj=null}}let W=new URL(g,document.baseURI).href,ce=0;function me(){let S=performance.now();if(S-ce<h)return;ce=S,dt(W,{volume:je?y:m,type:"music"})}function Z(){if(!R())return null;if((!X.pfRect||!X.wRect)&&Q(),d!==1/0&&Y.length-te>=d){let Et=-1;if(mt(2))for(let Rt=0;Rt<Y.length;Rt++){let go=Y[Rt];if(go&&go.sizeIndex<4){Et=Rt;break}}else for(let Rt=0;Rt<Y.length;Rt++)if(Y[Rt]){Et=Rt;break}if(Et===-1)return null;let Nt=Y[Et];Nt&&ue(Nt,Et)}let S=X.pfW,k=X.wRect.top-X.pfRect.top,P=Math.max(0,k),A=0;if(mt(2)){let Et=Math.random();for(let Nt=6;Nt>=1;Nt--)if(Et<Nx[Nt]){A=Nt;break}}A>=4&&Ja&&Ja()&&(A=3);let N=I0[A],pe=ve+(A>=3?15*(A-2):0),de=pe,ke=Math.max(de,S-N-pe),Oe=de+Math.random()*(ke-de),Pe=Math.random()*100-50,Te;if(N>=X.pfW)Te=(X.pfW-N)/2;else{let Et=X.pfW-N-pe;de>=Et?Te=(X.pfW-N)/2:Te=K(Oe+Pe,de,Et)}let Ue=Math.min(X.wRect.height,X.pfRect.height*.3),Ce=Math.max(Ue+80,120),Xe=Math.max(Ce+40,X.safeBottom-N-6),Ee=K(Ce+Math.random()*(Xe-Ce),Ce,Xe),He={x0:Oe,y0:P,x1:Te,y1:Ee,jitterMs:0},nt=X.pfRect.left-X.wRect.left,Ge=Rx[A],At=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),ot=.85+Math.random()*.3,yt=At*(Ge.w/100)*ot,Ht=At*(Ge.h/100)*ot,Xt=Oe+N/2+nt,On=P-k;return{wave:{x:Xt,y:On,width:yt,height:Ht},coin:He,sizeIndex:A}}function re(S){if(!S.length||!R())return;let k=document.createDocumentFragment(),P=[],A=performance.now(),N=!1;for(let{wave:pe,coin:de,sizeIndex:ke}of S){if(pe&&(N=!0,Xu)){let Xe=ke>=4;Xu.addWave(pe.x,pe.y,pe.width,pe.height,Xe)}let Oe=I0[ke],Pe=1;if(mt(8)){let Xe=Ft(),Ee=Math.pow(25,Xe);Pe=Math.pow(Ee,ke)}else Pe=Ax[ke];let Te=ke>=4,Ue=j();Ue.style.width=`${Oe}px`,Ue.style.height=`${Oe}px`,Ue.className=`coin coin--size-${ke}`,Ue.firstChild&&(Ue.firstChild.src=E),Ue.style.transform=`translate3d(${de.x0}px, ${de.y0}px, 0) rotate(-10deg) scale(0.96)`,Ue.style.opacity="0",Xs?Ue.dataset.mutationLevel=Mi.toString():Ue.dataset.mutationLevel="0";let Ce={mutationLevel:Xs?Mi.toString():"0",el:Ue,src:E,x:de.x0,y:de.y0,rot:-10,scale:.96,startX:de.x0,startY:de.y0,endX:de.x1,endY:de.y1,startTime:A+de.jitterMs,duration:i,dieAt:A+p,jitterMs:de.jitterMs,isRemoved:!1,settled:!1,size:Oe,sizeIndex:ke,valueMultiplier:Pe,forceDom:Te,soundSrc:E0[ke]?`sounds/coin_pickup${E0[ke]}`:null,bMinX:Math.min(de.x0,de.x1)-Oe,bMaxX:Math.max(de.x0,de.x1)+Oe,bMinY:Math.min(de.y0,de.y1)-Oe,bMaxY:Math.max(de.y0,de.y1)+Oe};Ue._coinObj=Ce,Ce.index=Y.length,Y.push(Ce),P.push(Ce),k.appendChild(Ue)}L.c.appendChild(k),P.length>0&&requestAnimationFrame(()=>{for(let pe of P)pe.el&&(pe.el.style.transition=`transform ${i}ms ${kx} ${pe.jitterMs}ms`,pe.el.style.transform=`translate3d(${pe.endX}px, ${pe.endY}px, 0) rotate(0deg) scale(1)`,pe.el.style.opacity="1")}),N&&requestAnimationFrame(()=>{me()})}function ye(S=1){if(!R())return;(!X.pfRect||!X.wRect)&&Q();let k=[];for(let P=0;P<S;P++){let A=Z();A&&k.push(A)}k.length&&re(k)}function Le(S,k){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let P=k-S.startTime;if(P<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let A=P/S.duration;if(A>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let N=Mx(A),pe=S.startX+(S.endX-S.startX)*N,de=S.startY+(S.endY-S.startY)*N,ke=-10+10*N,Oe=.96+.04*N;return{x:pe,y:de,rot:ke,scale:Oe}}function ie(S,k){let P=Tx(k.src);if(P&&P.complete&&P.naturalWidth>0){let A=k.size||r;S.drawImage(P,k.x,k.y,A,A)}}function Se(){if(U.length){if(q){U.forEach((k,P)=>{F[P]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,F[P].width,F[P].height),k.restore(),b&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let S=Y.length;for(let k=0;k<S;k++){let P=Y[k];if(P&&P&&P.settled&&!P.isRemoved&&!P.el){let A=P.sizeIndex||0;U[A]&&ie(U[A],P)}}b&&U.forEach(k=>k.restore()),q=!1,$.length=0}else if($.length>0){b&&U.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let k=$[S];if(!k.isRemoved&&k.settled&&!k.el){let P=k.sizeIndex||0;U[P]&&ie(U[P],k)}}b&&U.forEach(S=>S.restore()),$.length=0}}}let Ne=a,_e=null,Re=performance.now(),se=0;function ne(S){(!X.pfRect||!X.wRect)&&Q();let k=(S-Re)/1e3;Re=S,k>.1&&(k=.1);for(let A=Y.length-1;A>=0;A--){let N=Y[A];if(!N||!N)continue;if(S>=N.dieAt){ue(N,A);continue}if(N.sizeIndex===5&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval)){N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100;for(let ke=0;ke<3;ke++)ko(N,S)}if(N.sizeIndex===6&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval&&(N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100,M.collectBatch))){let ke=Le(N,S),Oe=ke.x+N.size/2,Pe=ke.y+N.size/2,Te=[],Ue=N.size/2*(N.size/2),Ce=Y.length;for(let Xe=0;Xe<Ce;Xe++){let Ee=Y[Xe];if(!Ee||Ee===N||Ee.isRemoved||Ee.settled===!1||Ee.sizeIndex>3)continue;let ze=Ee.x+(Ee.size||r)/2,He=Ee.y+(Ee.size||r)/2,nt=ze-Oe,Ge=He-Pe;nt*nt+Ge*Ge>Ue&&Te.push(Ee)}if(Te.length>0){for(let He=Te.length-1;He>0;He--){let nt=Math.floor(Math.random()*(He+1));[Te[He],Te[nt]]=[Te[nt],Te[He]]}let Xe=Te.slice(0,3),Ee=[],ze=!1;for(let He of Xe){let nt=He.size||r,Ge=He.x+nt/2,At=He.y+nt/2;To(N,Ge,At),nr(Ge,At,nt),Ee.push({coin:He}),ze||(dt("sounds/lightning_strike.ogg",{volume:.25}),ze=!0)}Ee.length>0&&M.collectBatch(Ee)}}if(N.settled)continue;let pe=S-N.startTime;if(pe<0)continue;if(pe/N.duration>=1){N.settled=!0,N.x=N.endX,N.y=N.endY,N.rot=0,N.scale=1,N.el&&!N.forceDom?(le(N.el),N.el=null,$.push(N)):N.el&&(N.el.style.transition="none",N.el.style.transform=`translate3d(${N.x}px, ${N.y}px, 0) rotate(0deg) scale(1)`);continue}}se+=Ne*k;let P=Math.floor(se);if(P>0){se-=P;let A=Math.min(P,u);if(A>0){let N=performance.now(),pe=[],de=5;for(let ke=0;ke<A&&!(performance.now()-N>de);ke++){let Oe=Z();Oe&&pe.push(Oe)}pe.length&&re(pe)}}if(Se(),te>50){let A=0;for(let N=0;N<Y.length;N++){let pe=Y[N];pe!==null&&(pe.index=A,Y[A++]=pe)}Y.length=A,te=0}or(k),_e=requestAnimationFrame(ne)}function Ie(){if(!_e){if(!R()){console.warn("[Spawner] start() called but required nodes are missing.");return}Q(),f>0&&_e===null&&ye(f),Re=performance.now(),_e=requestAnimationFrame(ne)}}function w(){_e&&(cancelAnimationFrame(_e),_e=null)}function V(S){Ne=Math.max(0,Number(S)||0)}function z(){se=0,Re=performance.now()}function oe(S){let k=mt(2)&&!!S;for(let P=Y.length-1;P>=0;P--){let A=Y[P];if(A&&A){if(k&&A.sizeIndex>=4){A.mutationLevel=Xs?Mi.toString():"0",A.el&&(A.el.dataset.mutationLevel=A.mutationLevel);continue}ue(Y[P],P)}}z()}function ge(S){S&&(E=S)}function ae(S){let k=S._coinObj;if(!k)return S.style.transform||"translate3d(0,0,0)";let{x:P,y:A,rot:N,scale:pe}=Le(k,performance.now());return`translate3d(${P}px, ${A}px, 0) rotate(${N}deg) scale(${pe})`}function qe(S){if(S.el)return S.el;if(S.isRemoved)return null;let k=j(),P=S.size||r;return k.style.width=`${P}px`,k.style.height=`${P}px`,k.className=`coin coin--size-${S.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=S.src),k.style.opacity="1",k.dataset.mutationLevel=S.mutationLevel,k._coinObj=S,S.el=k,L.c.appendChild(k),q=!0,k}function tt(S,k,P,A){let N=P;A&&(N=Math.max(P,260));let pe=P*P,de=[],ke=Y.length,Oe=S-N,Pe=S+N,Te=k-N,Ue=k+N,Ce=performance.now();for(let Xe=0;Xe<ke;Xe++){let Ee=Y[Xe];if(!Ee||Ee.bMaxX<Oe||Ee.bMinX>Pe||Ee.bMaxY<Te||Ee.bMinY>Ue)continue;let ze=Ee.size||r,He,nt;if(Ee.settled)He=Ee.x+ze/2,nt=Ee.y+ze/2;else{let yt=Le(Ee,Ce);He=yt.x+ze/2,nt=yt.y+ze/2}if(He<Oe||He>Pe||nt<Te||nt>Ue)continue;let Ge=He-S,At=nt-k,ot=pe;if(A&&(Ee.sizeIndex||0)>0){let yt=ze/2;ot=yt*yt}Ge*Ge+At*At<=ot&&(Ee.isRemoved||de.push(Ee))}return de}function be(S,k,P,A,N,pe){let de=N;pe&&(de=Math.max(N,260));let ke=N*N,Oe=[],Pe=Y.length,Te=Math.min(S,P)-de,Ue=Math.max(S,P)+de,Ce=Math.min(k,A)-de,Xe=Math.max(k,A)+de,Ee=P-S,ze=A-k,He=Ee*Ee+ze*ze,nt=ke*He,Ge=performance.now();for(let At=0;At<Pe;At++){let ot=Y[At];if(!ot||ot.bMaxX<Te||ot.bMinX>Ue||ot.bMaxY<Ce||ot.bMinY>Xe)continue;let yt=ot.size||r,Ht,Xt;if(ot.settled)Ht=ot.x+yt/2,Xt=ot.y+yt/2;else{let sn=Le(ot,Ge);Ht=sn.x+yt/2,Xt=sn.y+yt/2}if(Ht<Te||Ht>Ue||Xt<Ce||Xt>Xe)continue;let On=Ht-S,Et=Xt-k,Nt=On*Ee+Et*ze,Rt=ke;if(pe&&(ot.sizeIndex||0)>0){let sn=yt/2;Rt=sn*sn}let go=!1;if(Nt<=0)On*On+Et*Et<=Rt&&(go=!0);else if(Nt>=He){let sn=Ht-P,Qs=Xt-A;sn*sn+Qs*Qs<=Rt&&(go=!0)}else{let sn=On*ze-Et*Ee;sn*sn<=Rt*He&&(go=!0)}go&&!ot.isRemoved&&Oe.push(ot)}return Oe}function Be(S){ue(S)}function Gt(S,k,P){let A=P*P,N=[],pe=Y.length,de=S-P,ke=S+P,Oe=k-P,Pe=k+P,Te=performance.now();for(let Ue=0;Ue<pe;Ue++){let Ce=Y[Ue];if(!Ce||Ce.bMaxX<de||Ce.bMinX>ke||Ce.bMaxY<Oe||Ce.bMinY>Pe)continue;let Xe=Ce.size||r,Ee,ze;if(Ce.settled)Ee=Ce.x+Xe/2,ze=Ce.y+Xe/2;else{let Ge=Le(Ce,Te);Ee=Ge.x+Xe/2,ze=Ge.y+Xe/2}if(Ee<de||Ee>ke||ze<Oe||ze>Pe)continue;let He=Ee-S,nt=ze-k;He*He+nt*nt<=A&&(!Ce.el&&!Ce.isRemoved&&qe(Ce),Ce.el&&N.push(Ce.el))}return N}function st(S,k,P,A,N){let pe=N*N,de=[],ke=Y.length,Oe=Math.min(S,P)-N,Pe=Math.max(S,P)+N,Te=Math.min(k,A)-N,Ue=Math.max(k,A)+N,Ce=P-S,Xe=A-k,Ee=Ce*Ce+Xe*Xe,ze=pe*Ee,He=performance.now();for(let nt=0;nt<ke;nt++){let Ge=Y[nt];if(!Ge||Ge.bMaxX<Oe||Ge.bMinX>Pe||Ge.bMaxY<Te||Ge.bMinY>Ue)continue;let At=Ge.size||r,ot,yt;if(Ge.settled)ot=Ge.x+At/2,yt=Ge.y+At/2;else{let Nt=Le(Ge,He);ot=Nt.x+At/2,yt=Nt.y+At/2}if(ot<Oe||ot>Pe||yt<Te||yt>Ue)continue;let Ht=ot-S,Xt=yt-k,On=Ht*Ce+Xt*Xe,Et=!1;if(On<=0)Ht*Ht+Xt*Xt<=pe&&(Et=!0);else if(On>=Ee){let Nt=ot-P,Rt=yt-A;Nt*Nt+Rt*Rt<=pe&&(Et=!0)}else{let Nt=Ht*Xe-Xt*Ce;Nt*Nt<=ze&&(Et=!0)}Et&&(!Ge.el&&!Ge.isRemoved&&qe(Ge),Ge.el&&de.push(Ge.el))}return de}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;_e||Ie()}});function rn(){R()&&ye(1)}let Tt=[],gn=[];function ho(S,k){if(!S||!k)return;let P=S.size||r,A=k.size||r,N=S.x+P/2,pe=S.y+P/2,de=k.x+A/2,ke=k.y+A/2;Tt.push({x1:N,y1:pe,x2:de,y2:ke,age:0,life:.15})}function nr(S,k,P){if(!L.pf)return;let A=document.createElement("div");A.className="coin-stain";let N=P*1.2;A.style.width=`${N}px`,A.style.height=`${N}px`,A.style.left=`${S-N/2}px`,A.style.top=`${k-N/2}px`,L.pf.appendChild(A),setTimeout(()=>{A.style.opacity="0",setTimeout(()=>{A.parentNode&&A.remove()},1e3)},2500)}function ko(S,k){let P=Math.random()*Math.PI*2,A=(S.size||r)/2,N=A*w0,pe=Math.cos(P)*N,de=Math.sin(P)*N,ke=A*(.7+Math.random()*.6),Oe=Math.cos(P)*(N+ke),Pe=Math.sin(P)*(N+ke);Tt.push({parentCoin:S,relX1:pe,relY1:de,relX2:Oe,relY2:Pe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let Te=3+Math.floor(Math.random()*3);for(let Ue=0;Ue<Te;Ue++){let Ce=.3+Math.random()*.5,Xe=pe+(Oe-pe)*Ce,Ee=de+(Pe-de)*Ce,ze=P+(Math.random()*1.2-.6),He=ke*(.4+Math.random()*.4),nt=Xe+Math.cos(ze)*He,Ge=Ee+Math.sin(ze)*He;Tt.push({parentCoin:S,relX1:Xe,relY1:Ee,relX2:nt,relY2:Ge,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}dt("sounds/lightning_zap.ogg",{volume:.25})}function To(S,k,P){if(!S)return;let A=S.size||r,N=performance.now(),pe=Le(S,N),de=pe.x+A/2,ke=pe.y+A/2,Oe=k-de,Pe=P-ke,Te=Math.atan2(Pe,Oe),Ue=Math.sqrt(Oe*Oe+Pe*Pe),Ce=A/2*w0,Xe=Math.cos(Te)*Ce,Ee=Math.sin(Te)*Ce;Tt.push({parentCoin:S,relX1:Xe,relY1:Ee,x2:k,y2:P,age:0,life:.25,width:6,jaggedScale:25});let ze=de+Xe,He=ke+Ee,nt=6+Math.floor(Math.random()*5);for(let Ge=0;Ge<nt;Ge++){let At=.1+Math.random()*.8,ot=ze+(k-ze)*At,yt=He+(P-He)*At,Ht=Te+(Math.random()*1.6-.8),Xt=Ue*(.1+Math.random()*.3),On=ot+Math.cos(Ht)*Xt,Et=yt+Math.sin(Ht)*Xt;if(Tt.push({x1:ot,y1:yt,x2:On,y2:Et,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Rt=ot+(On-ot)*.5,go=yt+(Et-yt)*.5,sn=Ht+(Math.random()*1-.5),Qs=Xt*.5;Tt.push({x1:Rt,y1:go,x2:Rt+Math.cos(sn)*Qs,y2:go+Math.sin(sn)*Qs,age:0,life:.25,width:1.5,jaggedScale:10})}}}function or(S){if(!B||!x)return;B.clearRect(0,0,x.width,x.height);let k=performance.now();B.lineCap="round",B.lineJoin="round";for(let P=Tt.length-1;P>=0;P--){let A=Tt[P];if(A.age+=S,A.age>=A.life){Tt.splice(P,1);continue}let N=A.x1,pe=A.y1,de=A.x2,ke=A.y2;if(A.parentCoin){let Te=Le(A.parentCoin,k),Ue=Te.x+(A.parentCoin.size||r)/2,Ce=Te.y+(A.parentCoin.size||r)/2;N=Ue+A.relX1,pe=Ce+A.relY1,A.relX2!==void 0&&(de=Ue+A.relX2,ke=Ce+A.relY2)}let Oe=1-A.age/A.life;B.strokeStyle=`rgba(200, 240, 255, ${Oe})`,B.lineWidth=A.width||3,B.shadowColor="rgba(220, 245, 255, 0.9)",B.shadowBlur=20;let Pe=6;B.beginPath(),B.moveTo(N,pe);for(let Te=1;Te<=Pe;Te++){let Ue=Te/Pe,Ce=N+(de-N)*Ue,Xe=pe+(ke-pe)*Ue;if(Te===Pe)B.lineTo(de,ke);else{let Ee=-(ke-pe),ze=de-N,He=Math.sqrt(Ee*Ee+ze*ze),nt=A.jaggedScale||40;if(He>0){let Ge=(Math.random()-.5)*nt*(1-Math.abs(Ue-.5));B.lineTo(Ce+Ee/He*Ge,Xe+ze/He*Ge)}else B.lineTo(Ce,Xe)}}B.stroke(),B.shadowBlur=0}for(let P=gn.length-1;P>=0;P--){let A=gn[P];if(A.age+=S,A.age>=A.life){gn.splice(P,1);continue}A.x+=A.vx*S,A.y+=A.vy*S;let N=1-A.age/A.life;B.fillStyle=A.color,B.globalAlpha=N,B.beginPath(),B.arc(A.x,A.y,A.size,0,Math.PI*2),B.fill(),B.globalAlpha=1}}return{start:Ie,stop:w,setRate:V,clearBacklog:z,clearPlayfield:oe,setCoinSprite:ge,getCoinTransform:ae,findCoinsInRadius:Gt,findCoinsInPath:st,findCoinTargetsInRadius:tt,findCoinTargetsInPath:be,ensureCoinVisual:qe,removeCoinTarget:Be,detachCoin:C,recycleCoin:le,playEntranceWave:rn,setDependencies:_,hasBigCoins:()=>mt(2)&&Y.some(S=>S&&S.sizeIndex>=4)}}var Xs,Mi,Cx,S0,kx,I0,w0,Ax,Nx,E0,Rx,_0=De(()=>{$l();Eo();wo();so();Pn();Cm();Io();Xs=!1,Mi=0n,Cx=2500,S0=new Map;try{x0(lt())}catch{Xs=!1,Mi=0n}try{pi(e=>{x0(e)})}catch{}kx="cubic-bezier(0.215, 0.61, 0.355, 1)";I0=[40,55,80,125,200,320,512],w0=.78,Ax=[1,25,625,15625,390625,9765625,244140625],Nx=[0,.1,.01,.001,1e-4,1e-5,1e-6],E0=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],Rx=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var O0={};vt(O0,{afterSlotWrite:()=>Nm,beforeSlotWrite:()=>Am});function A0(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Ux(e,t=Bx){!e||e<=0||El.set(e,A0()+t)}function M0(e){if(!e||e<=0)return!1;let t=El.get(e);return t==null?!1:t<=A0()?(El.delete(e),!1):!0}function Dx(){El.clear()}function Vu(){try{return typeof localStorage<"u"}catch{return!1}}function Tm(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function N0(e){let t=new Map;if(!Vu())return xl.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Ri))continue;let r=Tm(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return xl.set(e,t),t}function R0(e){return!Number.isFinite(e)||e<=0?null:xl.has(e)?xl.get(e):N0(e)}function Am(e){if(!Vu()||Yu>0)return;let t=String(e);if(!t.startsWith(Ri))return;let n=Tm(t);if(n==null)return;let o=R0(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(Yu===0){Yu+=1;try{yn(n)}finally{Yu-=1}}N0(n);return}}}catch{}}function Nm(e,t){let n=String(e);if(!n.startsWith(Ri))return;let o=Tm(n);if(o==null)return;let r=R0(o)||new Map;r.set(n,String(t??"")),xl.set(o,r)}function $x(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function qx(){let e=new Map;if(!Vu())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Ri))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=mf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function Gx(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=v();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function Hx(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=hf(e);if(n.length===0){o&&(M0(e)||yn(e),Pl(e,null));return}let r=$x(n);o&&r!==o&&!M0(e)&&yn(e),r!==o&&Pl(e,r)}function Vs(){if(!Vu())return;let e=qx();Gx(e).forEach(n=>{let o=e.get(n)??[];Hx(n,o)})}function Xx(){if(Mm!=null)return;Mm=(typeof window<"u"?window:globalThis).setTimeout(()=>{Mm=null,Vs()},Fx)}function Yx(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){Ux(o),Xx();return}El.delete(o),Vs()}}function Vx(){typeof window>"u"||C0==null&&(C0=window.setInterval(Vs,Px))}function Wx(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function Ys(){let e=Wx();if(!e)return;if(!Oi()){(e.dataset.poopShopApplied===km||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==k0||e.dataset.poopShopApplied!==km)&&(e.style.backgroundImage=k0,e.dataset.poopShopApplied=km)}function zx(){typeof window>"u"||T0==null&&(Ys(),T0=window.setInterval(Ys,50),window.addEventListener("saveSlot:change",Ys),window.addEventListener("saveSlot:modified",e=>{try{let t=v();e?.detail?.slot===t&&Ys()}catch{Ys()}}))}function Kx(){typeof window>"u"||(Vs(),Vx(),zx(),window.addEventListener("saveSlot:change",()=>Vs()),window.addEventListener("saveIntegrity:storageMutation",Yx,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(Dx(),Vs(),Ys())}))}var Px,Bx,Fx,C0,Mm,El,xl,Yu,k0,km,T0,Rm=De(()=>{bt();Px=1e4,Bx=750,Fx=50,C0=null,Mm=null,El=new Map;xl=new Map,Yu=0;k0="linear-gradient(180deg,#a9793d,#7b5534)",km="1",T0=null;Kx()});var X0={};vt(X0,{initPopups:()=>eL,teardownpopups:()=>tL});function Om(){return mo||(mo=document.createElement("div"),mo.className="currency-popups",mo.setAttribute("aria-live","polite"),mo.setAttribute("aria-atomic","false"),document.body.appendChild(mo),mo)}function ki(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function Pm(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function B0(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):J(n);t&&(t.innerHTML=r)}function Zx(e,t=F0){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Ll.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function Jx(e,t,n){Om();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function Bm(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=v();if(o!=null){if(["xp"].includes(e)){if(an(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(an(`ccc:mutation:progress:${o}`))return}else if(Object.values(Me).includes(e)&&Bn(e,o))return}let r=jx[e],i=Object.assign({duration:F0,accumulate:!0},r||{},n);if(!i.icon)return;let s=ki(t);if(!s||Pm(s))return;let l=i.accumulate!==!1?Ll.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,B0(l);return}let a=Jx(e,i,s);a.meta=i,B0(a),Ll.set(e,a);let u=Om(),d=P0.indexOf(e),f=null;if(d>=0){let p=Array.from(u.children);for(let g of p){let m=g.dataset.type;if(P0.indexOf(m)>d){f=g;break}}}f?u.insertBefore(a.element,f):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),Zx(a,i.duration)}function Qx(){let e={};for(let t of Object.values(Me))e[t]=ia(t);return e}function U0(){try{let e=Qx();Object.entries(e).forEach(([t,n])=>{let o=ki(n)||c.fromInt(0);Br.set(t,o.clone?.()??o)}),Br.has("mp")||Br.set("mp",c.fromInt(0))}catch{Br.clear()}}function D0(){Ll.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Ll.clear()}function $0(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=ki(t.value)||c.fromInt(0),r=Br.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?ki(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&Bm(n,s),Br.set(n,o.clone?.()??o)}function q0(e){let t=e?.detail;if(!t)return;let n=ki(t.xpAdded);n&&!Pm(n)&&Bm("xp",n)}function G0(e){let t=e?.detail;if(!t)return;let n=ki(t.delta);n&&!Pm(n)&&Bm("mp",n);let o=ki(t.progress);o&&Br.set("mp",o.clone?.()??o)}function H0(){D0(),U0()}function eL(){Wu||(Wu=!0,Om(),U0(),window.addEventListener("currency:change",$0),window.addEventListener("xp:change",q0),window.addEventListener("mutation:change",G0),window.addEventListener("saveSlot:change",H0))}function tL(){Wu&&(window.removeEventListener("currency:change",$0),window.removeEventListener("xp:change",q0),window.removeEventListener("mutation:change",G0),window.removeEventListener("saveSlot:change",H0),D0(),Br.clear(),mo&&mo.remove(),mo=null,Wu=!1)}var F0,P0,jx,mo,Wu,Br,Ll,Y0=De(()=>{Ct();zt();bt();F0=6767,P0=["coins","xp","books","gold","mp","magic","gears"],jx={[Me.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Me.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Me.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Me.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Me.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"}},mo=null,Wu=!1,Br=new Map,Ll=new Map});var Q0={};vt(Q0,{flushBackupSnapshot:()=>J0,getSuspendMetadata:()=>vL,installSuspendSafeguards:()=>yL,markProgressDirty:()=>Mo,restoreFromBackupIfNeeded:()=>gL});function _l(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function Zs(){if(typeof localStorage>"u")return!1;try{let e=`${Qn}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function K0(){if(!_l())throw new Error("IndexedDB unavailable");return Ws||(Ws=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(nL,oL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(js)||r.createObjectStore(js)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}Ws=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw Ws=null,e}),Ws)}function aL(){if(!Zs())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(Qn))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function lL(e){try{let t=await K0();return await new Promise((n,o)=>{let r=!1,i=t.transaction(js,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(js).put(e,z0);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function cL(){try{let e=await K0();return await new Promise((t,n)=>{let o=!1,r=e.transaction(js,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(js).get(z0);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function uL(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function Fm(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function fL(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function pL(e){return!(typeof e!="string"||e.length===0||dL.test(e))}function Um(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(Qn)||n.startsWith(rL)||n.startsWith(iL))return;let o=fL(n);if(o!=null)try{let r={key:n,slot:o,trusted:pL(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function mL(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=Fm(),a=String(i),u=this===localStorage&&a.startsWith(Qn);if(u)try{Am(a)}catch{}let d;try{d=t.apply(this,arguments)}finally{try{if(u){Mo("setItem");try{Nm(a,s)}catch{}}this===localStorage&&a.startsWith(Qn)&&Um(a,l)}catch{}}return d}),typeof n=="function"&&(e.removeItem=function(i){let s=Fm(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(Qn)&&(Mo("removeItem"),Um(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=Fm(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Mo("clear"),Um(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function j0(e="idle"){Ks=e||Ks,Fr=!0,!zs&&(zs=setTimeout(()=>{if(zs=null,!Fr)return;let t=Ks;Fr=!1,J0(t)},sL))}function Z0(){zs&&(clearTimeout(zs),zs=null)}function Mo(e="dirty"){try{j0(e)}catch{}}async function Dm(e="manual"){if(!Zs()||!_l())return!1;let t=aL();if(!t)return!1;t.reason=e,Ku=!1;let n=await lL(t);return n||(Fr=!0,j0("retry")),n}async function J0(e="manual",{immediate:t=!1}={}){return!Zs()||!_l()?!1:t?(Z0(),Fr=!1,Ku=!0,Dm(e)):(Fr=!0,Ks=e||Ks,Dm(e))}function zu(e){!_l()||!Zs()||(Z0(),Fr=!1,Ku=!0,Dm(e))}function hL(){if(!Zs())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(Qn))return!0}}catch{}return!1}async function gL(){if(W0||(W0=!0,!Zs()||!_l()))return!1;let e=!1;try{if(!hL())e=!0;else{let o=localStorage.getItem(`${Qn}saveSlot`);if(o){let r=`${Qn}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await cL();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Mo("restored"),n}function yL(){if(V0||(V0=!0,typeof window>"u"))return;uL(),mL();let e=()=>{document.hidden?zu("visibility-hidden"):Mo("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>zu("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>zu("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>zu("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Mo("pageshow"))}catch{}try{window.addEventListener("focus",()=>Mo("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(Qn)||Mo("storage-event"))})}catch{}Mo("boot")}function vL(){return{pendingImmediateFlush:Ku,dirty:Fr,lastDirtyReason:Ks}}var Qn,nL,oL,js,z0,rL,iL,sL,Ws,zs,Fr,Ks,V0,W0,Ku,dL,eb=De(()=>{Rm();Qn="ccc:",nL="ccc:safety",oL=1,js="snapshots",z0="latest",rL=`${Qn}slotSig`,iL=`${Qn}slotMod`,sL=1e3,Ws=null,zs=null,Fr=!1,Ks="init",V0=!1,W0=!1,Ku=!1;dL=/\bat <anonymous>:\d+:\d+\b/});var tb={};vt(tb,{initGlobalOverlayEsc:()=>IL});function SL(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i}of bL){let s=document.querySelectorAll(o);if(s.length>0){if(i){t=!0;continue}let a=s[s.length-1].querySelector(r||".shop-close");a&&(a.click(),n=!0)}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function IL(){window.addEventListener("keydown",SL,!0)}var bL,nb=De(()=>{bL=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".automation-shop-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close"}]});var ob={};vt(ob,{ensureGameDom:()=>wL});function wL(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var rb=De(()=>{});function LL(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function _L(){if(!je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function ML(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let d=document.createElement("div");d.textContent=je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(d.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),d.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),d.textContent="Loading skipped",d.style.textDecoration="none",d.style.cursor="default",t())}),o.appendChild(d)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function kL(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function TL(e){if(!e||e.__done)return;e.__done=!0;let t=500;e.__label&&(e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let n=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,450)},t)}async function Hm(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function AL(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function NL(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Pn(),kl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function RL(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function OL({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...AL(e,s),...NL(t,s),...n?RL(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function PL(e){if(Js===e)return;on&&(on.stop(),on=null),Js=e;let t=document.querySelector(".menu-root");switch(e){case tr.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Js===tr.STARTER_COVE&&(on=dt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},25)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof jm=="function"&&jm(n,80),Ti){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(Ti.init("water-background",i),Zu){try{Zu()}catch{}Zu=null}if(Ju){try{Ju()}catch{}Ju=null}typeof zm=="function"&&(Zu=zm(s=>Ti.update(s))),typeof Km=="function"&&(Ju=Km((s,l)=>Ti.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,Ti&&requestAnimationFrame(()=>Ti.resize()),Sb()),typeof Ym=="function")try{Ym()}catch{}if(typeof Vm=="function")try{Vm()}catch{}if(!nn){nn=vb({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=nn;let i=()=>{if(!(!nn||typeof nn.setCoinSprite!="function"))try{nn.setCoinSprite(xb?.())}catch{}};i(),Lb?.(i);let s=bb({spawner:nn});nn&&typeof nn.setDependencies=="function"&&nn.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=Ib(),u=wb(a);if(nn&&u?.coinsPerSecondMult){let d=1*u.coinsPerSecondMult;if(typeof Wm=="function"){let f=Wm("spawnRate",d);try{f&&typeof f.toScientific=="function"?d=Number(f.toScientific(6)):d=Number(f)}catch{}}Number.isFinite(d)&&nn.setRate(d)}}catch{}};if(l(),typeof Gm=="function")try{Gm()}catch{}Gm=Eb(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof Xm=="function")try{Xm()}catch{}nn.start();break}case tr.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),nn&&nn.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===tr.MENU}}))}catch{}}var EL,je,ib,vb,bb,Sb,sb,ab,lb,cb,ub,fb,db,Ib,wb,Xm,Eb,xL,pb,mb,hb,$m,qm,Ym,Vm,xb,Lb,ju,Wm,gb,zm,Km,yb,jm,Ti,Zu,Ju,tr,Js,on,nn,Gm,Qu,CL,wo=De(()=>{Pn();EL=!0,je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia?window.matchMedia("(pointer: coarse)").matches:"ontouchstart"in window;return window.IS_MOBILE=e,e})();je&&document.documentElement.classList.add("is-mobile");Zu=null,Ju=null;_L();tr={MENU:0,STARTER_COVE:1},Js=tr.MENU,on=null,nn=null,Gm=null,Qu=()=>new Promise(e=>requestAnimationFrame(e)),CL=async()=>{await Qu(),await Qu()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(G=>{e=G}),n=ML("Loading assets...",e);await Qu();let{initAudio:o}=await Promise.resolve().then(()=>(Pn(),kl));o();let r=Promise.all([Promise.resolve().then(()=>(bf(),hh)),Promise.resolve().then(()=>(_0(),L0)),Promise.resolve().then(()=>(Ra(),by)),Promise.resolve().then(()=>(Gc(),sy)),Promise.resolve().then(()=>(bt(),fh)),Promise.resolve().then(()=>(Rm(),O0)),Promise.resolve().then(()=>(un(),Pv)),Promise.resolve().then(()=>($l(),yh)),Promise.resolve().then(()=>(qn(),Rh)),Promise.resolve().then(()=>(Io(),sv)),Promise.resolve().then(()=>(Eo(),p0)),Promise.resolve().then(()=>(Y0(),X0)),Promise.resolve().then(()=>(eb(),Q0)),Promise.resolve().then(()=>(Xi(),$h)),Promise.resolve().then(()=>(nb(),tb)),Promise.resolve().then(()=>(Gi(),c0)),Promise.resolve().then(()=>(Wr(),Gh)),Promise.resolve().then(()=>(mc(),yg)),Promise.resolve().then(()=>(Zi(),Zh)),Promise.resolve().then(()=>(Mc(),Xg)),Promise.resolve().then(()=>(rb(),ob)),Promise.resolve().then(()=>(so(),cg)),Promise.resolve().then(()=>(Cm(),b0)),Promise.resolve().then(()=>(oi(),mg))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(G,j)=>`img/mutations/m${j+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=OL(i,G=>{s=G,kL(n,G)}),[a,u,d,f,p,g,m,y,h,b,E,L,R,T,F,U,q,x,B,M,_,X,Q,fe]=await r;({initSlots:ib}=a),{createSpawner:vb}=u,{initCoinPickup:bb}=d,{initHudButtons:Sb}=f,{bank:cb,getHasOpenedSaveSlot:ub,setHasOpenedSaveSlot:fb,ensureStorageDefaults:db,notifyGameSessionStarted:yb}=p,{getCurrentAreaKey:Ib,computeUpgradeEffects:wb,onUpgradesChanged:Eb}=m,{registerPreloadedAudio:xL}=y,{initXpSystem:Xm}=h,{initResetSystem:Ym}=b,{initMutationSystem:Vm,getMutationCoinSprite:xb,onMutationChange:Lb}=E,{initPopups:pb}=L,{installSuspendSafeguards:mb,restoreFromBackupIfNeeded:hb,markProgressDirty:$m,flushBackupSnapshot:qm}=R,{installGhostTapGuard:sb,initGlobalGhostTap:ab}=T,{initGlobalOverlayEsc:lb}=F,{setDebugPanelAccess:ju,applyStatMultiplierOverride:Wm}=U,{startGameLoop:gb,registerTick:zm,registerFrame:Km}=q;let{initOfflineTracker:K,processOfflineProgress:ee}=x,{initWorkshopSystem:ve}=B,{initAutomationEffects:he}=M;({ensureGameDom:jm}=_);let{initSurgeEffects:Y}=X;({waterSystem:Ti}=Q);let{initLabLogic:te}=fe;window.bank=cb,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(on){try{on.stop()}catch{}on=null}}),window.addEventListener("audio:restartMusic",()=>{if(on){try{on.stop()}catch{}on=null}Js===tr.STARTER_COVE&&(on=dt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",G=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return G.preventDefault(),G.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let G=document.hidden;tf(G),on&&on.element&&(G?on.element.pause():on.element.play().catch(()=>{}))}),sb?.(),ab?.(),lb?.(),mb?.(),typeof ju=="function"&&(ju(EL),window.setDebugPanelAccess=ju);try{await hb?.()}catch{}await Promise.race([l,t]),await CL(),document.documentElement.classList.remove("booting"),await Qu(),TL(n),await Promise.all([Hm("img/currencies/coin/coin_plus_base.webp"),Hm("img/stats/xp/xp_plus_base.webp"),Hm("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}gb(),K(()=>Js===tr.STARTER_COVE);try{ve()}catch(G){console.error("Workshop init failed",G)}try{he()}catch(G){console.error("Automation init failed",G)}try{Y()}catch(G){console.error("Surge effects init failed",G)}try{te()}catch(G){console.error("Lab system init failed",G)}LL(),db(),$m?.("ensure-defaults"),pb();let $=document.getElementById("panel-title");if(ub()?(document.body.classList.add("has-opened"),$&&($.style.opacity="0")):$&&($.style.opacity="1"),ib(()=>{Js!==tr.STARTER_COVE&&(fb(!0),document.body.classList.add("has-opened"),$&&($.style.opacity="0"),PL(tr.STARTER_COVE),ee(),window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave(),yb?.(),$m?.("slot-entered"))}),typeof window<"u"&&qm)try{window.cccRequestBackup=()=>qm("manual",{immediate:!0})}catch{}})});wo();})();
