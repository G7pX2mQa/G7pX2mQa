(()=>{var hb=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var vt=(e,t)=>{for(var n in t)hb(e,n,{get:t[n],enumerable:!0})};var xl={};vt(xl,{initAudio:()=>gb,loadAudio:()=>Xm,playAudio:()=>dt,registerPreloadedBuffer:()=>vb,setAudioSuspended:()=>Ku,setMusicUnderwater:()=>Pr});function zu(){if(Vt)return Vt;let e=window.AudioContext||window.webkitAudioContext;return e?(Vt=new e,Ks=Vt.createGain(),Ks.connect(Vt.destination),Ks.gain.value=1,wl=Vt.createGain(),wl.gain.value=1,wl.connect(Ks),go=Vt.createBiquadFilter(),go.type="lowpass",go.frequency.value=22050,go.Q.value=1,go.connect(wl),Vt):null}function gb(){zu()}function yb(){Vt&&Vt.state==="suspended"&&Vt.resume().catch(()=>{})}async function Xm(e){let t=zu();if(!t)return null;let n=new URL(e,document.baseURI).href;if(js.has(n))return js.get(n);if(El.has(n))return El.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return js.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{El.delete(n)}})();return El.set(n,o),o}function dt(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=zu(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=js.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let d=s.createGain();return d.gain.value=t,u.connect(d),i==="music"?d.connect(go):d.connect(Ks),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:d,element:null}}else Xm(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function vb(e,t){let n=new URL(e,document.baseURI).href;js.set(n,t)}function Ku(e){Vt&&(e?Vt.state==="running"&&Vt.suspend().catch(()=>{}):Vt.state==="suspended"&&Vt.resume().catch(()=>{}))}function Pr(e){if(!go)return;let t=e?600:22050;try{let n=Vt.currentTime;go.frequency.cancelScheduledValues(n),go.frequency.setValueAtTime(t,n)}catch{go.frequency.value=t}}var Vt,Ks,wl,go,js,El,Rn=De(()=>{Vt=null,Ks=null,wl=null,go=null,js=new Map,El=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,yb,{capture:!0,passive:!0})})});var c,Lt=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",d=i+s;d.startsWith("-")?(u="-",d=d.slice(1)):d.startsWith("+")&&(d=d.slice(1));let f=d.replace(/^0+/,"")||"0",p=BigInt(u+f);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let f=i.slice(u+1)||"0";try{a=BigInt(f)}catch{a=0n}}let d=Number(l);return Number.isFinite(d)||(d=e.MAX_E),new e(BigInt(r),{base:d,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,d=Number(u),f=l;return Number.isSafeInteger(d)||(f+=u,d=0),new e(i,{base:d,offset:f},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let d=Math.min(n,18);o=u.toFixed(d).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}}});function Wm(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return Ym.format(t)}catch{return String(e)}}function Zs(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function ju(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Wm(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+Ym.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,d=Zu.get(u)||"",p=o-u+1,g=4-p,m=p+g;n.length<m+1&&(n+="0".repeat(m+1-n.length));let y=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(y=Zs(y));let b,w;return y.length>m?(b=y.slice(0,p+1),w="0".repeat(g)):(b=y.slice(0,p),w=y.slice(p)),t+`${b}${g?"."+w:""}${d}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Zs(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+ju(String(o))}function Sb(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+ju(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let d=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(d=Zs(d)),l){let R=d.slice(0,1)+"."+d.slice(1),k=i==="-"?"-":"";return t+R+"e"+ju(s,k)}let p=Math.floor(a/3)*3,g=Zu.get(p)||"",y=a-p+1,h=4-y,b,w;return d.length>4?(b=d.slice(0,y+1),w="0".repeat(h)):(b=d.slice(0,y),w=d.slice(y)),t+(i==="-"?"-":"")+b+(h?"."+w:"")+g}function Vm(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Zs(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+Sb(l)}function J(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return Vm(e.toScientific(3));if(t<6)return Wm(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=Zu.get(n);if(!o)return Vm(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Zs(u));let f,p;return u.length>l?(f=u.slice(0,i+1),p="0".repeat(s)):(f=u.slice(0,i),p=u.slice(i)),`${f}${s?"."+p:""}${o}`}var bb,Zu,Ym,zt=De(()=>{Lt();bb=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],Zu=new Map(bb),Ym=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var rh={};vt(rh,{CURRENCIES:()=>Me,KEYS:()=>gt,STORAGE_PREFIX:()=>Ti,bank:()=>O,clearActiveSlot:()=>Nb,clearAllStorage:()=>Bb,ensureCurrencyDefaults:()=>uf,ensureMultiplierDefaults:()=>ff,ensureStorageDefaults:()=>Pb,getActiveSlot:()=>v,getCurrency:()=>ea,getCurrencyMultiplierBN:()=>oh,getHasOpenedSaveSlot:()=>Ob,getLastSaveTime:()=>sf,getLastSaveTimeKey:()=>Tl,getSlotModifiedFlagKey:()=>Rb,getSlotSignature:()=>cf,getSlotSignatureKey:()=>lf,hasModifiedSave:()=>ki,isCurrencyLocked:()=>On,isStorageKeyLocked:()=>sn,markSaveSlotModified:()=>hn,notifyGameSessionStarted:()=>kb,onCurrencyChange:()=>Ml,peekCurrency:()=>ta,primeStorageWatcherSnapshot:()=>rt,setActiveSlot:()=>af,setCurrency:()=>Ci,setCurrencyMultiplierBN:()=>Nl,setHasOpenedSaveSlot:()=>Al,setSlotSignature:()=>kl,updateLastSaveTime:()=>th,watchStorageKey:()=>_t});function ef(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function tf(e){let t=ef(e);return t==null?null:`${Ib}:${t}`}function nf(e){let t=ef(e);return t==null?null:`${wb}:${t}`}function Jm(e={}){Ll.size!==0&&Ll.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Ml(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Ll.add(o),()=>{Ll.delete(o)}}function xb(){if(Js!=null||ko.size===0)return;Js=(typeof window<"u"?window:globalThis).setInterval(_b,Eb)}function Qm(){if(ko.size!==0||Js==null)return;(typeof window<"u"?window:globalThis).clearInterval(Js),Js=null}function eh(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function Lb(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function _b(){if(ko.size===0){Qm();return}ko.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=eh(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!Lb(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function _t(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=ko.get(e);return s||(s=new Set,ko.set(e,s)),s.add(i),xb(),()=>{let l=ko.get(e);l&&(l.delete(i),l.size===0&&(ko.delete(e),Qm()))}}function rt(e,t){if(!e)return;let n=ko.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=eh(r,o),r.initialized=!0)})}function of(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function Cb(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function Mb(){Ju.forEach(e=>{try{e?.()}catch{}}),Ju.clear()}function Km(e){if(e!==zm&&(Mb(),zm=e??null,e!=null))for(let t of Object.values(Me)){let n=`${gt.CURRENCY[t]}:${e}`,o=_t(n,{parse:Cb,equals:of,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};Jm(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Ju.set(n,o)}}function Tb(){typeof window>"u"||(Km(v()),window.addEventListener("saveSlot:change",()=>{Km(v())}))}function kb(){rf=!0}function Tl(e=v()){return e==null?null:`${ir}lastSaveTime:${e}`}function th(){if(!rf||document.hidden)return;let e=v();if(e==null)return;let t=Date.now();try{localStorage.setItem(Tl(e),String(t))}catch{}}function sf(){let e=v();if(e==null)return 0;try{let t=localStorage.getItem(Tl(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function Ab(){typeof window>"u"||(jm||(jm=setInterval(th,1e3)),window.addEventListener("beforeunload",()=>{if(!rf)return;let e=v();if(e!=null)try{localStorage.setItem(Tl(e),String(Date.now()))}catch{}}))}function v(){if(or!==void 0)return or;let e=localStorage.getItem(gt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return or=n,n}function af(e){let t=Math.max(1,parseInt(e,10)||1);or=t,localStorage.setItem(gt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function Nb(){or=null,localStorage.removeItem(gt.SAVE_SLOT)}function Qs(e,t=v()){return t==null?null:`${e}:${t}`}function nh(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function sn(e){return nh(e)}function lf(e=v()){return tf(e)}function Rb(e=v()){return nf(e)}function cf(e=v()){if(typeof localStorage>"u")return null;let t=tf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function kl(e,t){if(typeof localStorage>"u")return;let n=tf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function ki(e=v()){if(typeof localStorage>"u")return!1;let t=nf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function hn(e=v()){if(typeof localStorage>"u")return;let t=ef(e);if(t==null||ki(t))return;let n=nf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function Ob(){return localStorage.getItem(gt.HAS_OPENED_SAVE_SLOT)==="true"}function Al(e){localStorage.setItem(gt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function Pb(){localStorage.getItem(gt.HAS_OPENED_SAVE_SLOT)===null&&Al(!1)}function uf(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${gt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function ff(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${gt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Cl(t);else{let o=rr(c.fromInt(1));Mi(t,o)}}}function ea(e){let t=Qs(gt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Ci(e,t,{delta:n=null,previous:o=null}={}){let r=v(),i=Qs(gt.CURRENCY[e],r),s=o??ea(e),l=c.fromInt(0);if(!i||On(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let d=null;try{d=localStorage.getItem(i)}catch{}let f=d??u,p=a;try{d!=null&&(p=c.fromAny(d),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}rt(i,f);let g=!of(s,p),y=(b=>{if(b==null)return null;try{let w=b instanceof c?b.clone?.()??b:c.fromAny(b);if(typeof w.cmp=="function")return w.cmp(l)>0?w:null;if(!w.isZero?.())return w}catch{}return null})(n),h=null;if(g)try{h=p.sub?.(s)}catch{}if((!h||h.isZero?.()||typeof h.cmp=="function"&&h.cmp(l)<=0)&&(h=y),g||h){let b={key:e,value:p,slot:r,delta:h??void 0};Jm(b);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:b}))}catch{}}return p}function rr(e){return e.mulScaledIntFloor(1n,-Qu)}function _l(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,Qu)}function Cl(e){let t=Qs(gt.MULTIPLIER[e]);if(!t)return rr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Br)){let r=rr(c.fromInt(1));return Mi(e,r),r}let o=n.slice(Br.length);try{return c.fromAny(o)}catch{let r=rr(c.fromInt(1));return Mi(e,r),r}}function Mi(e,t,n=v()){let o=Qs(gt.MULTIPLIER[e],n);if(!o||On(e,n))return;let r=rr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Br))try{r=c.fromAny(i.slice(Br.length))}catch{}let s=c.fromAny(t),l=Br+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,d=s;try{let f=u?.startsWith?.(Br)?u.slice(Br.length):null;f!=null&&(d=c.fromAny(f))}catch{}try{rt(o,u)}catch{}if(!of(r,d))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:_l(d),slot:n}}))}catch{}}function oh(e){return _l(Cl(e))}function On(e,t=v()){let n=Qs(gt.CURRENCY[e],t);return nh(n)}function Nl(e,t){let n=c.fromAny(t),o=rr(n);return Mi(e,o,v()),n}function ta(e,t){let n=localStorage.getItem(`${gt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Bb(){Object.values(gt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Zm(e){let t=n=>{try{let o=c.fromAny(n);return typeof J=="function"?J(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return ea(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Ci(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Ci(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Ci(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof J=="function"?J(r):r.toString()},t.mult={get(){return oh(e)},set(n){return Nl(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Cl(e).mulBigNumInteger(o);return r.isZero()&&(r=rr(c.fromInt(1))),Mi(e,r),_l(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),Qu)}catch{o={numer:1n,scale:0}}let r=Cl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=rr(c.fromInt(1))),Mi(e,r);let i=_l(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var ir,Ti,Ib,wb,Qu,Br,Eb,ko,Js,Ll,Ju,zm,jm,rf,gt,Me,or,O,bt=De(()=>{Lt();zt();ir="ccc:",Ti=ir,Ib=`${ir}slotSig`,wb=`${ir}slotMod`,Qu=18,Br="XM:",Eb=140,ko=new Map,Js=null,Ll=new Set;Ju=new Map,zm=null;jm=null,rf=!1;Ab();gt={HAS_OPENED_SAVE_SLOT:`${ir}hasOpenedSaveSlot`,SAVE_SLOT:`${ir}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Me={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===gt.SAVE_SLOT){if(e.newValue===null)or=null;else{let t=parseInt(e.newValue,10);or=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:or}}))}catch{}}});for(let e of Object.values(Me))gt.CURRENCY[e]=`${ir}${e}`,gt.MULTIPLIER[e]=`${ir}mult:${e}`;Tb();O=new Proxy({},{get(e,t){if(Object.values(Me).includes(t))return Zm(t);if(typeof t=="string"&&Me[t.toUpperCase?.()])return Zm(Me[t.toUpperCase()])}});if(typeof window<"u"){window.bank=O;for(let e of Object.values(Me))window[e]=O[e]}});function sh(){return yo}function Rl(e){yo=!!e,document.body.classList.toggle("slots-delete-mode",yo);let t=document.getElementById("manage-saves");t&&(t.textContent=yo?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",yo),n.setAttribute("aria-pressed",yo?"true":"false")})}function Fb(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function Ub(){if(ih)return;ih=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),Rl(!yo)}),window.addEventListener("keydown",r=>{yo&&r.key==="Escape"&&Rl(!1)});let n=r=>{!yo||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!yo)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(Fb(s),v()===s)try{localStorage.removeItem(gt.SAVE_SLOT)}catch{}df(),Rl(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),Rl(!1)}var yo,ih,ah=De(()=>{bt();pf();yo=!1,ih=!1;document.addEventListener("DOMContentLoaded",()=>{try{Ub()}catch{}})});var lh={};vt(lh,{initSlots:()=>qb,refreshSlotsView:()=>df});function Db(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function $b(e){if(!Db(e))return"No Save Data";try{let t=ta(e,"coins");return J(t)}catch{return"0"}}function mf(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=$b(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function qb(e){let t=document.querySelectorAll(".slot-card");mf(),t.forEach((n,o)=>{let r=o+1,i=s=>{af(r),uf(),ff(),Al(!0),typeof e=="function"&&e(r,s),mf()};n.addEventListener("click",s=>{sh()||(s.preventDefault(),i(s))})})}function df(){mf()}var pf=De(()=>{Lt();zt();ah();bt()});var uh={};vt(uh,{registerPreloadedAudio:()=>Gb,takePreloadedAudio:()=>Hb});function Gb(e,t){let n=ch(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}Ol.set(n,t)}}function Hb(e){let t=ch(e);if(!Ol.has(t))return null;let n=Ol.get(t);return Ol.delete(t),n}var Ol,ch,Pl=De(()=>{Ol=new Map,ch=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Ai(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var hf=De(()=>{});var _h={};vt(_h,{addExternalCoinMultiplierProvider:()=>No,addExternalXpGainMultiplierProvider:()=>cr,addXp:()=>Fi,broadcastXpChange:()=>ql,computeCoinMultiplierForXpLevel:()=>_f,getXpGainMultiplier:()=>Hl,getXpLevelStorageKey:()=>Xb,getXpRequirementForXpLevel:()=>Gl,getXpState:()=>Qe,initXpSystem:()=>Pi,isXpSystemUnlocked:()=>ln,onXpChange:()=>Dl,refreshCoinMultiplierFromXpLevel:()=>vn,resetXpProgress:()=>Bi,setExternalBookRewardProvider:()=>Xl,setExternalCoinMultiplierProvider:()=>xh,setExternalXpGainMultiplierProvider:()=>Lh,unlockXpSystem:()=>$r});function Xb(e=v()){let t=e??v();return t==null?null:Fr(t)}function Wb(e){if(e===0n)return 0;let t=e.toString(),n=t.length,o=Math.min(n,15),r=Number(t.slice(0,o)),i=n-o;if(!Number.isFinite(r))return Number.POSITIVE_INFINITY;let s=r*Math.pow(10,i);return Number.isFinite(s)?s:Number.POSITIVE_INFINITY}function an(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function Bl(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function vh(e){if(!e||typeof e!="object")return 0;if(an(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function zb(e){return!e||typeof e!="object"?0:an(e)||typeof e.cmp=="function"&&e.cmp(yh)>=0?Number.POSITIVE_INFINITY:vh(e)}function dh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(Yb,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(aa())??c.fromInt(0):n}function Kb(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(gh,18)}function jb(e){if(an(e)||typeof e.cmp=="function"&&e.cmp(yh)>=0)return pt.clone?.()??pt;let t=e.floorToInteger(),n=e.sub(t),o=vh(n);if(!Number.isFinite(o))return pt.clone?.()??pt;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return pt.clone?.()??pt;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function bh(e){if(!e||typeof e!="object")return pt.clone?.()??pt;let n=Kb(e),o=jb(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return pt.clone?.()??pt;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function Sh(){let e=an(H.xpLevel),t=an(H.progress);if(!e&&!t)return!1;let n=pt.clone?.()??pt;if(H.xpLevel=n.clone?.()??n,H.progress=n.clone?.()??n,It=n.clone?.()??n,O?.books)try{typeof O.books.set=="function"?O.books.set(n.clone?.()??n):typeof O.books.add=="function"&&O.books.add(n.clone?.()??n)}catch{}return!0}function ra(e={}){sa.size!==0&&sa.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Dl(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return sa.add(n),()=>{sa.delete(n)}}function Ot(){return c.fromInt(0)}function aa(){return c.fromInt(1)}function Ni(e){if(!e)return Ot();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ot()}}function Fl(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Zb(){for(;Ef.length>0;){let e=Ef.pop();try{e?.()}catch{}}}function mh(e){if(e==null)return Ot();try{return c.fromAny(e)}catch{return Ot()}}function vf(e){if(!yf){yf=!0;try{let t=xf??v(),n={unlocked:H.unlocked,xpLevel:Ni(H.xpLevel),progress:Ni(H.progress),requirement:Ni(It)};Kt(!0),Jn(),yn(!0);let o={unlocked:H.unlocked,xpLevel:Ni(H.xpLevel),progress:Ni(H.progress),requirement:Ni(It)},r=n.unlocked!==o.unlocked,i=!Fl(n.xpLevel,o.xpLevel),s=!Fl(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ot();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ot()}catch{l=Ot()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||sa.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(ra(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{yf=!1}}}function bf(e){if(e===xf||(Zb(),xf=e??null,e==null))return;let t=(n,o)=>{let r=_t(n,o);typeof r=="function"&&Ef.push(r)};t(na(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>vf("unlock")}),t(Fr(e),{parse:mh,equals:Fl,onChange:()=>vf("xpLevel")}),t(Oi(e),{parse:mh,equals:Fl,onChange:()=>vf("progress")})}function Ih(){if(ph){bf(v());return}ph=!0,bf(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{bf(v()),Kt(!0),Jn(),yn(!0)})}function Sf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function la(e){if(!e||typeof e!="object")return Number.NEGATIVE_INFINITY;if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return Number.POSITIVE_INFINITY;if(e.isZero?.()||typeof e.isZero=="function"&&e.isZero())return Number.NEGATIVE_INFINITY;let t=e.sig,n=typeof e.e=="number"?e.e:Number(e.e??0),o=typeof e._eOffset=="bigint"?Wb(e._eOffset):Number(e._eOffset??0);if(!Number.isFinite(n))return n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(!Number.isFinite(o))return o>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let r=n+o;if(!Number.isFinite(r))return r>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let i=0;if(typeof t=="bigint"){let l=t.toString().replace(/^0+/,"");if(!l)return Number.NEGATIVE_INFINITY;let a=l.length,u=Math.min(a,15),d=l.slice(0,u),f=Number.parseFloat(d);Number.isFinite(f)&&f>0?i=Math.log10(f)+(a-u):i=a-1}else try{let s=typeof e.toScientific=="function"?e.toScientific(12):String(e);if(!s||s==="0")return Number.NEGATIVE_INFINITY;if(s==="Infinity")return Number.POSITIVE_INFINITY;let l=s.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(l){let a=parseFloat(l[1]),u=parseInt(l[2],10)||0;if(!(a>0)||!Number.isFinite(a))return Number.NEGATIVE_INFINITY;i=Math.log10(a)+u}else{let a=Number(s);if(!Number.isFinite(a)||a<=0)return Number.NEGATIVE_INFINITY;i=Math.log10(a)}}catch{return Number.NEGATIVE_INFINITY}return r+i}function Jb(e){let t=e<fh?e:fh;if(t<=Ri)return;let n=Ri,o=sr.get(n.toString());for(o||(o=c.fromInt(10),sr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),sr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Ri=n;return}}Ri=n}function Qb(e){if(!Number.isFinite(e)||e>=c.MAX_E)return pt.clone?.()??pt;let t=Math.floor(e),n=e-t;Number.isFinite(n)||(n=0);let o=Math.pow(10,n);(!Number.isFinite(o)||o<=0)&&(o=1),o>=10&&(o/=10,t+=1);let r;try{r=Number.isFinite(t)?t.toLocaleString("en",{useGrouping:!1}):String(t)}catch{r=String(t)}let i=`${o.toPrecision(18)}e${r}`;try{return c.fromScientific(i).floorToInteger()}catch{return pt.clone?.()??pt}}function eS(e){let t=Ri>0n?Ri:0n,n=sr.get(t.toString());if(!n||an(n))return pt.clone?.()??pt;let o=c.fromAny(t.toString()),r=la(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);Bl(s)||(i=i.add?.(s.mulDecimal(gh,18))??i);let l=dh(e),a=dh(o),u=l.sub?.(a)??c.fromInt(0);Bl(u)||(i=i.add?.(u.mulDecimal(Vb,18))??i);let d=zb(i);return Number.isFinite(d)?Qb(d):pt.clone?.()??pt}function tS(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=an(t),o=an(e);if(n)return o?1:0;if(Bl(t)||Bl(e))return 0;let s=la(e),l=la(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function wh(){return gn.container&&gn.container.isConnected?!0:(gn.container=document.querySelector(".xp-counter[data-xp-hud]"),gn.container?(gn.bar=gn.container.querySelector(".xp-bar"),gn.fill=gn.container.querySelector(".xp-bar__fill"),gn.xpLevelValue=gn.container.querySelector(".xp-level-value"),gn.progress=gn.container.querySelector("[data-xp-progress]"),!0):!1)}function Eh(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=sr.get("0");return a.clone?.()??a}if(r.bigInt!=null){Jb(i);let a=i.toString(),u=sr.get(a);if(u)return u.clone?.()??u}let s=eS(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?pt.clone?.()??pt:(r.bigInt!=null&&sr.set(r.bigInt.toString(),s),s.clone?.()??s)}function Ao(){It=Eh(H.xpLevel)}function Ul(){H.xpLevel=Ot(),H.progress=Ot(),Ao(),yn(!0)}function hh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function $l(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function yn(e=!1){let t=O?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=$l(H.xpLevel),o=n.bigInt,r=!n.finite,i=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null;if(!e&&(r&&Bn||!r&&o!=null&&!Bn&&!Fn&&Pn!=null&&o===Pn||!r&&o==null&&Fn&&i&&Un&&i===Un))return;if(r){try{t.set(pt)}catch{}Pn=null,Bn=!0,Fn=!1,Un=null;return}let s;if(o!=null&&o<=wf){let d=c.fromInt(1),f=Number(o);for(let g=0;g<f;g+=1)d=d.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(f)}typeof d.add=="function"?d=d.add(p):typeof p.add=="function"&&(d=p.add(d)),s=d.clone?.()??d}else s=bh(H.xpLevel);let l=s.clone?.()??s,a=ar.size>0?Array.from(ar):typeof Ur=="function"?[Ur]:[];for(let d of a)if(typeof d=="function")try{let f=d({baseMultiplier:l.clone?.()??l,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});f instanceof c?l=f.clone?.()??f:f!=null&&(l=c.fromAny(f))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Pn=null,Bn=!0,Fn=!1,Un=null):o!=null&&o<=wf?(Pn=o,Bn=!1,Fn=!1,Un=null):(Pn=null,Bn=!1,Fn=!0,Un=i)}function Kt(e=!1){let t=v();if(t==null)return oa=null,gf=!1,H.unlocked=!1,Ul(),H;if(!e&&gf&&t===oa)return H;oa=t,gf=!0;try{let n=localStorage.getItem(na(t));H.unlocked=n==="1"}catch{H.unlocked=!1}try{H.xpLevel=c.fromAny(localStorage.getItem(Fr(t))??"0")}catch{H.xpLevel=Ot()}try{H.progress=c.fromAny(localStorage.getItem(Oi(t))??"0")}catch{H.progress=Ot()}return(an(H.xpLevel)||an(H.progress))&&(H.unlocked=!0),H.unlocked?(Sh(),Ao(),yn(!0),Ih(),H):(Ul(),H)}function ia(){let e=v();if(e==null)return;let t={unlocked:H.unlocked?"1":"0",level:H.xpLevel.toStorage(),progress:H.progress.toStorage()};try{localStorage.setItem(na(e),t.unlocked)}catch{}try{localStorage.setItem(Fr(e),t.level)}catch{}try{localStorage.setItem(Oi(e),t.progress)}catch{}let n=(()=>{let r=H.unlocked,i=H.xpLevel,s=H.progress;try{r=localStorage.getItem(na(e))==="1"}catch{}try{let l=localStorage.getItem(Fr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(Oi(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();rt(na(e),n.unlocked?"1":"0"),rt(Fr(e),n.level?.toStorage?.()??t.level),rt(Oi(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==H.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(H.unlocked=n.unlocked,H.xpLevel=n.level,H.progress=n.progress,Ao(),yn(!0),Jn())}function nS(){yn(!0);let e=aa();if(typeof If=="function")try{let n=If({baseReward:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{O?.books?.addWithMultiplier?O.books.addWithMultiplier(e):O?.books?.add&&O.books.add(e)}catch{}let t=$l(H.xpLevel);t.finite?t.bigInt!=null?(Pn=t.bigInt,Bn=!1,Fn=!1,Un=null):(Pn=null,Bn=!1,Fn=!0,Un=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Pn=null,Bn=!0,Fn=!1,Un=null)}function Jn(){if(!wh())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=gn;if(!e)return;if(!H.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=J(It);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Sf(J(It));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Ai();return}e.removeAttribute("hidden");let i=It,s=tS(H.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=J(H.xpLevel)),r){let a=J(H.progress),u=J(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Sf(J(H.progress)),u=Sf(J(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Ai()}function Pi({forceReload:e=!1}={}){return wh(),Kt(e),Ao(),Jn(),Ih(),Qe()}function $r(){if(Kt(),H.unlocked)return Jn(),!1;Ul(),H.unlocked=!0,ia(),Jn(),yn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Qe()}))}catch{}return!0}function Bi({keepUnlock:e=!0}={}){Kt();let t=H.unlocked;return Ul(),H.unlocked=e?t||H.unlocked:!1,ia(),Jn(),yn(!0),Qe()}function Fi(e,{silent:t=!1}={}){Kt();let n=oa??v();if(n!=null&&hh(Oi(n)))return{unlocked:H.unlocked,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,progress:H.progress,requirement:It,slot:n};if(!H.unlocked)return{unlocked:!1,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,requirement:It};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ot()}if(!o.isZero?.()){let f=lr.size>0?Array.from(lr):typeof Dr=="function"?[Dr]:[];for(let p of f)if(typeof p=="function")try{let g=p({baseGain:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});g instanceof c?o=g.clone?.()??g:g!=null&&(o=c.fromAny(g))}catch{}}if(o=$n("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return Jn(),{unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,requirement:It};H.progress=H.progress.add(o),Ao();let r=n!=null&&hh(Fr(n)),i=an(H.progress),s=an(H.xpLevel),l=an(o);if(i||s||l){let f=pt.clone?.()??pt;r||(H.xpLevel=f.clone?.()??f),H.progress=f.clone?.()??f,Ao(),Sh(),ia(),Jn(),yn(!0);let p={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:It.clone?.()??It,slot:n};if(ra(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Ot();if(H.progress.cmp(It)<0){ia(),Jn();let f={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,progress:H.progress,requirement:It,slot:n};if(ra(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}if(!r){let f=la(H.progress),p=.08118668602542883,g=la(It);if(f-g>2){let h=H.xpLevel,b=f-g,w=Math.floor(b/p);if(w>500){let L=BigInt(Math.max(0,w-5));if(L>0n){let R=c.fromAny(L.toString());if(H.xpLevel=H.xpLevel.add(R),a=a.add(R),Ao(),O?.books?.add)try{let k=R.clone();O.books.add(k)}catch{}}}}let m=0,y=500;for(;H.progress.cmp?.(It)>=0&&m<y&&(H.progress=H.progress.sub(It),H.xpLevel=H.xpLevel.add(aa()),a=a.add(aa()),nS(),Ao(),!an(It));)m+=1;m>=y&&H.progress.cmp(It)>=0&&Ao()}ia(),Jn();let u=$l(H.xpLevel);u.finite?u.bigInt!=null?(Pn=u.bigInt,Bn=!1,Fn=!1,Un=null):(Pn=null,Bn=!1,Fn=!0,Un=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Pn=null,Bn=!0,Fn=!1,Un=null);let d={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:It.clone?.()??It,slot:n};if(ra(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}function Qe(){return Kt(),{unlocked:H.unlocked,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:It.clone?.()??It}}function ql(e={}){Kt();let t=oa??v(),n={...Qe(),slot:t,...e};if(ra(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function ln(){return Kt(),!!H.unlocked}function Gl(e){return Eh(e)}function Hl(){Kt();let e=aa(),t=lr.size>0?Array.from(lr):typeof Dr=="function"?[Dr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function _f(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=$l(t),o=n.bigInt;if(!n.finite)return pt.clone?.()??pt;let i;if(o!=null&&o<=wf){let a=c.fromInt(1),u=Number(o);for(let f=0;f<u;f+=1)a=a.mulDecimal("1.1",18);let d;try{d=c.fromAny(o.toString())}catch{d=c.fromInt(u)}typeof a.add=="function"?a=a.add(d):typeof d.add=="function"&&(a=d.add(a)),i=a.clone?.()??a}else i=bh(t);let s=i.clone?.()??i,l=ar.size>0?Array.from(ar):typeof Ur=="function"?[Ur]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!H.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function xh(e){Ur=typeof e=="function"?e:null,ar.clear(),Ur&&ar.add(Ur),Kt(),yn(!0)}function vn(){Kt(),yn(!0)}function Lh(e){Dr=typeof e=="function"?e:null,lr.clear(),Dr&&lr.add(Dr)}function No(e){return typeof e!="function"?()=>{}:(ar.add(e),Kt(),yn(!0),()=>{ar.delete(e),Kt(),yn(!0)})}function cr(e){return typeof e!="function"?()=>{}:(lr.add(e),Kt(),()=>{lr.delete(e)})}function Xl(e){If=typeof e=="function"?e:null}var Lf,na,Fr,Oi,oa,gf,It,sr,Ri,pt,Pn,Bn,Fn,Un,Ur,Dr,ar,lr,If,fh,HL,XL,wf,gh,Vb,Yb,yh,H,sa,gn,Ef,ph,xf,yf,Dn=De(()=>{Lt();bt();Ui();zt();hf();Lf="ccc:xp",na=e=>`${Lf}:unlocked:${e}`,Fr=e=>`${Lf}:level:${e}`,Oi=e=>`${Lf}:progress:${e}`;oa=null,gf=!1,It=c.fromInt(10),sr=new Map;sr.set("0",It);Ri=0n,pt=c.fromAny("Infinity"),Pn=null,Bn=!1,Fn=!1,Un=null,Ur=null,Dr=null,ar=new Set,lr=new Set,If=null,fh=5000n,HL=Math.log10(11/10),XL=Math.log10(5/2),wf=200n,gh="0.04139268515822507",Vb="0.3979400086720376",Yb="0.1",yh=c.fromScientific(String(c.MAX_E));H={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};sa=new Set;gn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};Ef=[],ph=!1,xf=null,yf=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Pi,unlockXpSystem:$r,addXp:Fi,getXpState:Qe,broadcastXpChange:ql,isXpSystemUnlocked:ln,getXpRequirementForXpLevel:Gl,getXpGainMultiplier:Hl,setExternalCoinMultiplierProvider:xh,addExternalCoinMultiplierProvider:No,refreshCoinMultiplierFromXpLevel:vn,setExternalXpGainMultiplierProvider:Lh,addExternalXpGainMultiplierProvider:cr,setExternalBookRewardProvider:Xl,resetXpProgress:Bi}))});var Rh={};vt(Rh,{GHOST_TAP_TIMEOUT_MS:()=>oS,clearGhostTapTarget:()=>ca,consumeGhostTapGuard:()=>Nh,initGlobalGhostTap:()=>pS,installGhostTapGuard:()=>dS,markGhostTapTarget:()=>Ah,setGhostTapSelector:()=>mS,shouldSkipGhostTap:()=>Qn,suppressNextGhostTap:()=>vo});function Oo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Tf(){return typeof document>"u"?null:document}function sS(e){if(!Tf())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(Mf)}function ca(e){e&&(e[Vl]=0)}function Ah(e,t=0,n=null){if(!e)return;let o=Oo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[Vl]=o+r:e[Vl]=0,iS=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&vo(i)}function Nh(e){if(typeof window>"u")return!1;let t=window[Di];return typeof t!="number"?!1:Oo()<=t?!0:(window[Di]=null,!1)}function Qn(e){if(!e)return!1;let t=Number(e[Vl]||0);return!Number.isFinite(t)||t<=0?!1:Oo()<=t?(ca(e),!0):(ca(e),!1)}function vo(e=0){if(typeof window>"u")return;let t=Oo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[Di]=null;return}let o=t+n,r=typeof window[Di]=="number"?window[Di]:0;window[Di]=Math.max(r,o)}function aS(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Wl=ur=Oo(),Ro=0))}function lS(e){Wl=ur=Oo(),Ro=0}function cS(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Oo();ur>0&&(Ro=t-ur),Wl=t}function uS(){let e=Oo();ur>0&&(Ro=e-ur),Wl=e}function fS(e){if(!e.isTrusted)return;let t=Oo(),n=ur>0?t-ur:-1,o=sS(e.target);if(Qn(o)){Ro=0,e.preventDefault(),e.stopImmediatePropagation();return}if(Nh(o)){o&&ca(o),Ro=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Ro||n)>=kh){ca(o),Ro=0,e.preventDefault(),e.stopImmediatePropagation();return}Ro=0}function dS(e={}){if(Ch)return;let t=Tf();!t||typeof window>"u"||(Ch=!0,Cf="PointerEvent"in window,Mh=!Cf&&"ontouchstart"in window,e.selector&&(Mf=`${e.selector}, ${Yl}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(kh=e.longPressMs),t.addEventListener("click",fS,!0),Cf?(t.addEventListener("pointerdown",aS,{capture:!0,passive:!1}),t.addEventListener("pointerup",cS,{capture:!0,passive:!0})):Mh&&(t.addEventListener("touchstart",lS,{capture:!0,passive:!1}),t.addEventListener("touchend",uS,{capture:!0,passive:!0})))}function Th(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Yl);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(Ah(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function pS(){let e=Tf();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",Th,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",Th,{capture:!1,passive:!1})}function mS(e){e&&(Mf=`${e}, ${Yl}`)}var oS,Vl,Di,Yl,rS,Ch,Mf,Cf,Mh,iS,Wl,ur,Ro,kh,$i=De(()=>{oS=0,Vl=Symbol("ccc:ghostTap:skipUntil"),Di="__cccGhostTapSkipUntil",Yl='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',rS=80,Ch=!1,Mf=Yl,Cf=!1,Mh=!1,iS=null,Wl=0,ur=0,Ro=0,kh=rS});var kf,Oh=De(()=>{kf={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var Ph={};vt(Ph,{RateAccumulator:()=>fa,pauseGameLoop:()=>Pf,registerFrame:()=>bS,registerTick:()=>bo,resumeGameLoop:()=>Bf,startGameLoop:()=>yS,stopGameLoop:()=>vS});function Rf(e){e||(e=performance.now());let t=e;if(Of){qr=t,Hr=requestAnimationFrame(Rf);return}qr||(qr=t);let n=(t-qr)/1e3;qr=t,n>60&&(n=60),n<0&&(n=0),Gr+=n;let o=0,r=250;for(;Gr>=ua;){if(o>=r){Gr=Gr%ua;break}Af.forEach(i=>{try{i(ua)}catch(s){console.error("Error in game tick listener:",s)}}),Gr-=ua,o++}if(Nf.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),qi===0||Gi===0)qi=Date.now(),Gi=t;else{let i=t-Gi;if(i>gS){let s=Date.now(),l=s-qi;l<-1e3?hn():l>i+1e4&&hn(),qi=s,Gi=t}}Hr=requestAnimationFrame(Rf)}function Pf(){Of=!0}function Bf(){Of=!1,qr=performance.now(),Gr=0,qi=0,Gi=0}function yS(){Hr||(qr=performance.now(),Gr=0,qi=0,Gi=0,Hr=requestAnimationFrame(Rf))}function vS(){Hr&&(cancelAnimationFrame(Hr),Hr=null)}function bo(e){return typeof e!="function"?()=>{}:(Af.add(e),()=>{Af.delete(e)})}function bS(e){return typeof e!="function"?()=>{}:(Nf.add(e),()=>{Nf.delete(e)})}var hS,ua,Af,Nf,Hr,Of,qr,Gr,qi,Gi,gS,fa,Xr=De(()=>{bt();hS=20,ua=1/hS,Af=new Set,Nf=new Set,Hr=null,Of=!1,qr=0,Gr=0,qi=0,Gi=0,gS=2e3;fa=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*ua;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ke,Vr,da,pa,ma,ha,eo,Hi,SS,Bh,Yr=De(()=>{Lt();Ke="automation",Vr=1,da=2,pa=3,ma=4,ha=5,eo=6,Hi={[da]:"coins",[pa]:"books",[ma]:"gold",[ha]:"magic"},SS=[{area:Ke,id:Vr,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ke,id:da,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ke,id:pa,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ke,id:ma,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ke,id:ha,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ke,id:eo,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],Bh=SS.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var Xh={};vt(Xh,{getGearsProductionRate:()=>Zl,getGenerationLevelKey:()=>Kr,getGenerationUpgradeCost:()=>fr,initWorkshopSystem:()=>Hh,initWorkshopTab:()=>Xf,performFreeGenerationUpgrade:()=>Jl,updateWorkshopTab:()=>to});function Vi(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*CS}function Kr(e){return`ccc:workshop:genLevel:${e}`}function va(){let e=v();if(!e)return c.zero();let t=localStorage.getItem(Kr(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function Sa(e){let t=v();if(!t)return!1;let n=Kr(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function Ia(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let f=e.toPlainIntegerString();t=parseFloat(f)}catch{return 1/0}if(t<=0)return Uf;if(t<=Wr)return Uf+t*Uh;Kl===null&&(Kl=Uf+Wr*Uh);let n=t-Wr;if(t<=ga)return Kl+n+Vi(n,Xi);if(jl===null){let f=ga-Wr;jl=Kl+f+Vi(f,Xi)}let o=t-ga,r=t-Wr,i=ga-Wr,s=o+(Vi(r,Xi)-Vi(i,Xi)),l=xS/ES,a=.5*l*o*o;if(t<=zl)return jl+s+a;if($f===null){let f=zl-ga,p=zl-Wr,g=f+(Vi(p,Xi)-Vi(i,Xi)),m=.5*l*f*f;$f=jl+g+m}let u=LS*(t-zl);if(u>709)return 1/0;let d=$f*Math.exp(u);return!Number.isFinite(d)||d>179e306?1/0:d}function fr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=Ia(t);return Ae(n)}function Hf(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(Df);if(n.cmp(9e15)<=0){let s=Number(n.toString())*Df;t=Ae(s)}else{let i=n.mulDecimal(Df);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Ae(s)}catch{t=c.fromAny("Infinity")}}}let o=O?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function kS(){let e=fr(et);if(O.coins.value.cmp(e)<0)return;let t=et.add(1);Sa(t)&&(et=t,O.coins.sub(e),to(),Zt())}function AS(){if(!Dt())return;let n=Hf(et).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&O.gears&&O.gears.add(n),et.cmp(20)<0){let r=Number(et.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(zr+=a,zr>=1){let u=Math.floor(zr);zr-=u,O.gears&&O.gears.add(u)}}else zr=0}function Gf(){O.gears&&O.gears.set(0),Sa(c.zero())&&(et=c.zero()),zr=0,to()}function $h(e){if(!e)return;let t=ba.get(e);if(!t){let s=e.getBoundingClientRect();t={gears:[],width:s.width,height:s.height,needsDistribution:!s.width||!s.height},ba.set(e,t)}let n=e.getBoundingClientRect();n.width>0&&n.height>0&&(t.width=n.width,t.height=n.height);let o=0;et.cmp(Ff)>0?o=Ff:o=Number(et.toPlainIntegerString());let r=Math.min(Math.floor(o),Ff),i=t.gears;for(;i.length<r;){let s=document.createElement("img");s.src=qh,s.classList.add("workshop-bg-gear"),s.alt="",s.setAttribute("aria-hidden","true");let l=32+Math.random()*48,a=0,u=0;t.width>0&&t.height>0?(a=Math.random()*(t.width-l),u=Math.random()*(t.height-l),a<0&&(a=0),u<0&&(u=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,f=Math.cos(d)*Dh,p=Math.sin(d)*Dh,g=Math.random()*360,m=(Math.random()<.5?-1:1)*(MS+Math.random()*TS);s.style.width=`${l}px`,s.style.transform=`translate3d(${a}px, ${u}px, 0) rotate(${g}deg)`,s.style.willChange="transform",e.appendChild(s),i.push({element:s,x:a,y:u,dx:f,dy:p,rotation:g,rotationSpeed:m,size:l})}for(;i.length>r;){let s=i.pop();s.element.parentNode&&s.element.parentNode.removeChild(s.element)}}function NS(e){let t="Click the big red button below to open the Automation Shop";je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${IS}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${qh}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${wS}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{kS()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),OS()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{Ql("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(jt&&jt.isConnected){let a=jt.querySelector(".workshop-side-left"),u=jt.querySelector(".workshop-side-right"),d=f=>{if(!f)return;let p=ba.get(f);if(p){let g=f.getBoundingClientRect();if(p.width=g.width,p.height=g.height,p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let m of p.gears)m.x=Math.random()*(p.width-m.size),m.x<0&&(m.x=0),m.y=Math.random()*(p.height-m.size),m.y<0&&(m.y=0),m.element.style.transform=`translate3d(${m.x}px, ${m.y}px, 0) rotate(${m.rotation}deg)`}}};d(a),d(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Gh():RS()},{root:null,threshold:0}).observe(e),jt=e}function to(){if(!jt)return;let e=jt.querySelector('[data-workshop="gears-amount"]'),t=jt.querySelector('[data-workshop="gears-rate"]'),n=jt.querySelector('[data-workshop="upgrade-cost"]'),o=jt.querySelector('[data-workshop="upgrade-gen"]'),r=Hf(et),i=fr(et);if(e&&(e.innerHTML=O.gears.fmt(O.gears.value)),t&&(t.innerHTML=J(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${J(i)} ${l}`}if(o){let l=O.coins.value.cmp(i)>=0;o.disabled=!l;let a=Ct(Ke,eo),u=!1;if(a>0){let d=v(),f=d!=null?`:${d}`:"",p=`ccc:autobuy:${Ke}:${eo}${f}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(et.isInfinite()?s="Infinity":s=et.floorToInteger().toStorage(),s!==qf){qf=s;let l=jt.querySelector(".workshop-side-left"),a=jt.querySelector(".workshop-side-right");l&&$h(l),a&&$h(a)}}function RS(){Yi&&(cancelAnimationFrame(Yi),Yi=null)}function Gh(){if(Yi)return;ya=0;let e=t=>{if(jt&&jt.isConnected){let n=jt.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=O.gears.fmt(O.gears.value)),ya||(ya=t);let o=(t-ya)/1e3;ya=t,o>.1&&(o=.1);for(let[r,i]of ba){if(!r.isConnected)continue;let{gears:s,width:l,height:a}=i;if(!(!l||!a))for(let u of s)u.x+=u.dx*o,u.y+=u.dy*o,u.x<0?(u.x=0,u.dx=-u.dx):u.x+u.size>l&&(u.x=l-u.size,u.dx=-u.dx),u.y<0?(u.y=0,u.dy=-u.dy):u.y+u.size>a&&(u.y=a-u.size,u.dy=-u.dy),u.rotation+=u.rotationSpeed*o,u.element.style.transform=`translate3d(${u.x}px, ${u.y}px, 0) rotate(${u.rotation}deg)`}}Yi=requestAnimationFrame(e)};Yi=requestAnimationFrame(e)}function Hh(){Fh||(Fh=!0,et=va(),bo(AS),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{et=va(),zr=0,Dt()||Gf(),to()}),window.addEventListener("currency:change",e=>{e.detail.key===Me.COINS&&to()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Me.GEARS&&to()}),window.addEventListener("debug:change",()=>{et=va(),to()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Dt()||Gf())})))}function Xf(e){Hh(),!e.__workshopInit&&(e.__workshopInit=!0,et=va(),ba.clear(),qf=-1,NS(e),typeof IntersectionObserver>"u"&&Gh(),Dt()||Gf(),to())}function Zl(){let e=va();return Hf(e)}function Jl(){let e=O.coins.value.isInfinite(),n=fr(et).isInfinite();if(e&&n&&!et.isInfinite())return et=c.fromAny("Infinity"),Sa(et),to(),!0;if(O.coins.value.isZero())return!1;let o=$e(O.coins.value);if(!Number.isFinite(o))if(O.coins.value.inf)o=1/0;else return!1;if(Ia(et)>o||et.cmp(9e15)>0)return!1;let r=Number(et.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);Ia(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(et)>0&&Sa(a)?(et=a,to(),!0):!1}function OS(){if(O.coins.value.isInfinite()){Jl()&&Zt();return}let e=$e(O.coins.value);if(!Number.isFinite(e)&&O.coins.value.isZero()||Ia(et)>e||et.cmp(9e15)>0)return;let t=Number(et.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);Ia(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(et.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(fr(c.fromInt(u)));if(l.cmp(O.coins.value)>0){let u=fr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(et)>0&&Sa(a)&&(et=a,O.coins.sub(l),to(),Zt())}var qh,IS,wS,Ff,jt,Fh,zr,et,qf,Yi,Uf,Df,Wr,ga,zl,Uh,Xi,ES,xS,LS,_S,CS,Kl,jl,$f,ba,Dh,MS,TS,ya,Wi=De(()=>{Lt();zt();bt();Xr();jr();So();cn();Io();Yr();qh="img/currencies/gear/gear.webp",IS="img/currencies/gear/gear_plus_base.webp",wS="img/currencies/coin/coin.webp",Ff=100,jt=null,Fh=!1,zr=0,et=c.zero(),qf=-1,Yi=null,Uf=12,Df=.3010299956639812,Wr=1e6,ga=1e9,zl=1e12,Uh=1,Xi=.001,ES=1e3,xS=Math.log10(1.00001),LS=23e-11,_S=Math.log(10),CS=1/_S;Kl=null,jl=null,$f=null;ba=new Map,Dh=67,MS=67,TS=67;ya=0});function Zr(e){return wa.nodes[e]||(wa.nodes[e]={rp:c.fromInt(0),level:0,active:!1}),wa.nodes[e]}function PS(e,t){let n=Zr(t);try{let o=localStorage.getItem(ec(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(tc(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(Wh(e,t));n.active=i==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1}}function Vh(){let e=v();wa.nodes={},e!=null&&St.forEach(t=>PS(e,t.id))}function Yh(){let e=v();e!=null&&St.forEach(t=>{let n=wa.nodes[t.id];if(n)try{localStorage.setItem(tc(e,t.id),n.rp.toStorage())}catch{}})}function $t(e){return Zr(e).level}function xa(e,t){let n=v();if(n==null)return;let o=Zr(e);o.level=t;try{localStorage.setItem(ec(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}}function no(e){return Zr(e).rp}function La(e,t){let n=Zr(e);n.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:n.rp}}))}catch{}}function Po(e){return Zr(e).active}function nc(e,t){let n=v();if(n==null)return;t&&St.forEach(r=>{r.id!==e&&Po(r.id)&&nc(r.id,!1)});let o=Zr(e);o.active=!!t;try{localStorage.setItem(Wh(n,e),o.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:o.active}}))}catch{}}function Jr(e){let t=St.find(r=>r.id===e);if(!t)return!1;if(!t.parentId)return!0;let n=$t(t.parentId),o=St.find(r=>r.id===t.parentId);return o?n>=o.maxLevel:!0}function Ea(e){let t=St.find(u=>u.id===e);if(!t)return c.fromAny("Infinity");let n=$t(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function bn(){let e=St.find(n=>n.id===1),t=$t(1);return e?t*e.effectPerLevel:0}function zh(e){let t=zi();if(t.isZero?.())return;let o=t.mulDecimal(e.toString(),18);St.forEach(r=>{if(Jr(r.id)&&Po(r.id)){let i=no(r.id),s=Ea(r.id);if($t(r.id)>=r.maxLevel)return;let l=i.add(o);for(;;){let a=Ea(r.id);if(l.cmp(a)<0||$t(r.id)>=r.maxLevel)break;l=l.sub(a);let u=$t(r.id);xa(r.id,u+1)}La(r.id,l)}})}function Vf(){let e=St.find(o=>o.id===2);if(!e)return c.fromInt(1);let t=$t(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.5,t);return c.fromAny(n)}function Yf(){let e=St.find(o=>o.id===3);if(!e)return c.fromInt(1);let t=$t(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.5,t);return c.fromAny(n)}function Kh(){No(({baseMultiplier:e})=>{let t=Vf();return e.mul(t)}),cr(({baseGain:e})=>{let t=Yf();return e.mul(t)})}var ec,tc,Wh,St,wa,Qr=De(()=>{Lt();bt();Ki();Dn();ec=(e,t)=>`ccc:lab:node:level:${t}:${e}`,tc=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,Wh=(e,t)=>`ccc:lab:node:active:${t}:${e}`,St=[{id:1,title:"Tsunami Exponent Restoration",desc:"Increases the Tsunami exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"img/lab_icons/tsunami_exponent_buff.webp",effectPerLevel:.01},{id:2,title:"Experimental Coin Value",desc:"Multiplies Coin value by 1.5x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentId:1,x:-1e3,y:1e3,icon:"img/lab_icons/coin_val0.webp",effectPerLevel:0},{id:3,title:"Experimental XP Value",desc:"Multiplies XP value by 1.5x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentId:1,x:1e3,y:1e3,icon:"img/sc_upg_icons/xp_val1.webp",effectPerLevel:0}],wa={nodes:{}};typeof window<"u"&&(window.addEventListener("saveSlot:change",Vh),setInterval(Yh,1e3),window.addEventListener("beforeunload",Yh),Vh())});var tg={};vt(tg,{getBookProductionRate:()=>mr,getSurge6WealthMultipliers:()=>oc,getTsunamiNerf:()=>Bt,getTsunamiNerfKey:()=>zf,getTsunamiSequenceSeen:()=>Sn,initSurgeEffects:()=>US,isSurgeActive:()=>mt,setTsunamiNerf:()=>Zi,setTsunamiSequenceSeen:()=>pr});function zf(e){return Wf(e)}function Sn(){let e=v();if(e==null)return!1;try{return localStorage.getItem(eg(e))==="1"}catch{return!1}}function pr(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(eg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Bt(){return dr}function Zi(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=v();if(n!=null){let o=Wf(n);if(sn(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}dr=t,ji();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function mt(e){return oo===1/0||typeof oo=="string"&&oo==="Infinity"||oo===Number.POSITIVE_INFINITY?!0:typeof oo=="bigint"?oo>=BigInt(e):typeof oo=="number"?oo>=e:!1}function _a(e){if(!mt(8))return e;let t=$e(e);if(!Number.isFinite(t))return e;let o=Bt()+bn();return o>1&&(o=1),Ae(t*o)}function ji(){let e=In();oo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(mt(8)){let o=Bt()+bn();o>1&&(o=1);let r=Math.log10(jh);Bo=Ae(r*o)}else Bo=c.fromInt(jh);else Bo=c.fromInt(1)}function oc(){if(!mt(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,g=0)=>{if(!p){if(g<=0)return c.fromInt(1);let L=Math.log10(g)/3;if(L<=0)return c.fromInt(1);let R=L*Math.log10(2);return Ae(R)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=$e(p),y=m;if(Number.isFinite(m)){if(m<15&&g>0)try{let w=Number(p.toPlainIntegerString());if(Number.isFinite(w)){let L=w+g;L>0&&(y=Math.log10(L))}}catch{}}else if(g>0)y=Math.log10(g);else return c.fromInt(1);let h=y/6;if(h<=0)return c.fromInt(1);let b=h*Math.log10(2);return Ae(b)},t=e(O.coins?.value),n=O.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(O.gold?.value),s=e(O.magic?.value),l=t,a=r,u=i,d=s;mt(8)&&(l=_a(t),a=_a(r),u=_a(i),d=_a(s));let f=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return f=f.mulBigNumInteger?f.mulBigNumInteger(u):f,f=f.mulBigNumInteger?f.mulBigNumInteger(d):f,{coins:l,books:a,gold:u,magic:d,total:f}}function mr(){if(!mt(3))return c.fromInt(0);let t=Qe().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(Zh),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Ae(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*Zh;n=Ae(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),O.books?.mult){let o=O.books.mult.get();n=n.mulBigNumInteger(o)}return mt(8)&&(n=_a(n)),n}function BS(e){if(!mt(3))return;Jh||(Jh=new fa("books",O));let t=mr();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);O.books&&O.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,O.books&&O.books.add(c.fromInt(o))}}}function Qh(e){if(e==null)return;let t=localStorage.getItem(Wf(e));t!==null?(dr=Number(t),(Number.isNaN(dr)||!Number.isFinite(dr))&&(dr=mt(8)?0:1)):mt(8)?dr=0:dr=1}function FS(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function US(){let e=v();ji(),Qh(e),ji(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=oo,n=mt(8);ji();let o=oo,r=mt(8);!n&&r?(Zi(0),Sn()||pr(!0)):r?FS(t,o)>0&&(Zi(0),Sn()||pr(!0)):n&&!r&&Zi(1)}),window.addEventListener("lab:node:change",()=>{ji()}),window.addEventListener("saveSlot:change",()=>{Qh(v()),ji()})),No(({baseMultiplier:t})=>Bo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Bo)),cr(({baseGain:t})=>Bo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Bo)),ei(({baseGain:t})=>Bo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Bo)),ei(({baseGain:t})=>{if(!mt(4))return t;let n=c.fromInt(4444e9);if(mt(8)){let r=Bt()+bn();r>1&&(r=1);let i=Math.log10(4444e9);n=Ae(i*r)}return t.mulBigNumInteger(n)}),No(({baseMultiplier:t})=>{if(!mt(6))return t;let n=oc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),Xl(({baseReward:t})=>mt(3)?c.fromInt(0):t),bo(BS)}var jh,Zh,Wf,eg,Bo,oo,Jh,dr,ro=De(()=>{Lt();bt();Dn();wo();So();Xr();cn();Qr();jh=10,Zh=.08685889638,Wf=e=>`ccc:surge:tsunamiNerf:${e}`,eg=e=>`ccc:unlock:tsunami:${e}`;Bo=c.fromInt(1),oo=0n,Jh=null,dr=0});var sg={};vt(sg,{getLabCost:()=>rg,getLabLevel:()=>io,getLabLevelFromCoins:()=>ig,getLabLevelKey:()=>jf,getRpMult:()=>zi,getRpMultBase:()=>ic,hasVisitedLab:()=>Qi,initLabLogic:()=>DS,initLabTab:()=>Qf,setLabLevel:()=>Ma,setLabVisited:()=>og,updateLabLevel:()=>Zf,updateLabTab:()=>ed});function Qi(){let e=v();if(e==null)return!1;try{return localStorage.getItem(ng(e))==="1"}catch{return!1}}function og(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(ng(t),n?"1":"0")}catch{}}function io(){let e=v();if(e==null)return c.fromInt(0);if(O.coins.value.isInfinite())return c.fromAny("Infinity");try{let t=localStorage.getItem(rc(e));return t?c.fromAny(t):c.fromInt(0)}catch{return c.fromInt(0)}}function Ma(e){let t=v();if(t!=null)try{let n=c.fromAny(e),o=io();if(n.cmp(o)===0)return;localStorage.setItem(rc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function rg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function ig(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),d=s-20n+BigInt(u);return d<0n?c.fromInt(0):c.fromInt(d)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Zf(){let e=v();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(rc(e)))return;let t=O.coins.value,n=io();if(t.isInfinite()){n.isInfinite()||Ma(c.fromAny("Infinity"));return}let o=ig(t);o.cmp(n)>0&&Ma(o)}function DS(){bo(Zf),bo(zh),Kh()}function Jf(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function $S(e){if(!e||typeof e!="object")return 0;if(Jf(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function GS(e){if(Jf(e)||typeof e.cmp=="function"&&e.cmp(qS)>=0)return Ji.clone?.()??Ji;let t=e.floorToInteger(),n=e.sub(t),o=$S(n);if(!Number.isFinite(o))return Ji.clone?.()??Ji;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return Ji.clone?.()??Ji;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function ic(){let e=io();if(Jf(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return GS(n)}function zi(){let e=ic();return typeof $n=="function"?$n("rp",e):e}function Qf(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",Ca&&Ca.destroy(),Ca=new Kf(e))}function ed(){og(!0),Ca&&Ca.resize()}var ng,rc,jf,Ji,qS,Ca,Kf,Ki=De(()=>{bt();Io();Lt();zt();ro();Xr();Ui();Qr();jr();cn();ng=e=>`ccc:lab:visited:${e}`,rc=e=>`ccc:lab:level:${e}`;jf=e=>rc(e);Ji=c.fromAny("Infinity"),qS=c.fromScientific(String(c.MAX_E));Ca=null;Kf=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${J(io())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Zf()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none"}update(t){this.checkBounds();let n=io(),o=rg(n.add(1)),r=Bt(),i=bn(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${J(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${J(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let f=this.bursts.length-1;f>=0;f--){let p=this.bursts[f];p.time+=t;for(let g of p.particles)g.x+=g.vx*t,g.y+=g.vy*t,g.vx*=.95,g.vy*=.95;p.time>=p.life&&this.bursts.splice(f,1)}let a=500/this.zoom,u=0,d=0;if(this.keys.KeyW&&(d-=1),this.keys.KeyS&&(d+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||d!==0){let f=Math.sqrt(u*u+d*d);u/=f,d/=f,this.camX+=u*a*t,this.camY+=d*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){let n=t.x,o=t.y,r=t;for(;r.parentId;){let i=St.find(s=>s.id===r.parentId);if(!i)break;n+=i.x,o+=i.y,r=i}return{x:n,y:o}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,d=Math.floor(Math.log10(u)),f=Math.pow(10,d),p=(x,P)=>{if(P<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*P})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/x)*x,_=Math.ceil((this.camX+n/2/r)/x)*x;if((_-M)/x>1e3)return;for(let pe=M;pe<=_;pe+=x){let K=(pe-this.camX)*r+n/2;t.moveTo(K,0),t.lineTo(K,o)}let X=Math.floor((this.camY-o/2/r)/x)*x,Q=Math.ceil((this.camY+o/2/r)/x)*x;for(let pe=X;pe<=Q;pe+=x){let K=(pe-this.camY)*r+o/2;t.moveTo(0,K),t.lineTo(n,K)}t.stroke()},g=f*r,m=Math.max(0,Math.min(1,(g-15)/25));p(f,m),p(f*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let y=(0-this.camY)*r+o/2;y>=-10&&y<=o+10&&(t.moveTo(0,y),t.lineTo(n,y));let h=(0-this.camX)*r+n/2;h>=-10&&h<=n+10&&(t.moveTo(h,0),t.lineTo(h,o)),t.stroke();let b=[],w=new Map;for(let x of St)Jr(x.id)&&(b.push(x),w.set(x.id,this.getNodePosition(x)));t.strokeStyle="#2a5298",t.lineWidth=10*r,t.lineCap="round",t.beginPath();for(let x of b)if(x.parentId){let P=St.find(M=>M.id===x.parentId);if(P&&w.has(P.id)){let M=w.get(P.id),_=w.get(x.id),X=(M.x-this.camX)*r+n/2,Q=(M.y-this.camY)*r+o/2,pe=(_.x-this.camX)*r+n/2,K=(_.y-this.camY)*r+o/2;t.moveTo(X,Q),t.lineTo(pe,K)}}t.stroke();let L=512,R=L*r,F=L*1.6*r;for(let x of b){let P=w.get(x.id),M=(P.x-this.camX)*r+n/2,_=(P.y-this.camY)*r+o/2,X=$t(x.id),Q=X>=x.maxLevel,pe=!0;if(M+F/2<0||M-F/2>n||_+F*.8<0||_-F/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,M-F/2,_-F/2,F,F),Q?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,M-F/2,_-F/2,F,F):Po(x.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,M-F/2,_-F/2,F,F);let ne=this.nodeImages[x.id];if(ne||(ne=new Image,ne.src=x.icon,this.nodeImages[x.id]=ne),ne.complete&&ne.naturalWidth!==0&&t.drawImage(ne,M-R/2,_-R/2,R,R),pe){let ve=Ea(x.id),he=0;if(Q)he=1;else if(ve.isInfinite?.()||typeof ve.cmp=="function"&&ve.cmp(c.fromAny("Infinity"))===0)he=0;else{let W=no(x.id);if(W.isZero?.())he=0;else try{if(ve.isZero?.())he=1;else{let me=W.div(ve).toScientific(5);he=Number(me)}}catch{he=0}}he=Math.max(0,Math.min(1,he));let V=F*.96,ee=F*.18,$=M-V/2,G=_+F/2+F*.05;t.fillStyle="#111",t.fillRect($,G,V,ee);let j=t.createLinearGradient($,G,$,G+ee);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,G,V*he,ee),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,G,V,ee),t.fillStyle="#fff",t.font=`bold ${ee*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,ee*.08);let le=`Level ${X}`;Q&&(le="MAXED");let ue=t.measureText(le),C=G+ee/2+(ue.actualBoundingBoxAscent-ue.actualBoundingBoxDescent)/2;t.strokeText(le,$+V/2,C),t.fillText(le,$+V/2,C)}}let U=35,q=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let x of this.bursts){let P=(x.x-this.camX)*this.zoom+n/2,M=(x.y-this.camY)*this.zoom+o/2;for(let _=0;_<q.length;_++){let X=q[_],Q=x.time-X.delay;if(Q>0&&Q<X.dur){let pe=Q/X.dur,K=1-Math.pow(1-pe,3),ne=U*K,ve=Math.max(0,1-Math.pow(pe,2)),he=1+_*.5,V=t.createRadialGradient(P,M,ne*.6,P,M,ne);V.addColorStop(0,"rgba(255, 200, 50, 0)"),V.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,ve*.15*he)})`),V.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,ve*.2*he)})`),V.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=V,t.beginPath(),t.arc(P,M,ne,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let _ of x.particles)if(x.time<_.life){let X=1-x.time/_.life,Q=P+_.x,pe=M+_.y;t.fillStyle=`rgba(255, 255, 150, ${X})`,t.beginPath(),t.arc(Q,pe,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=512/2*1.6;for(let u of St){if(!Jr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=St.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.textContent=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let d=document.createElement("div");d.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=Po(t);nc(t,!p),this.updateNodeOverlay()};let f=document.createElement("button");f.className="shop-close",f.textContent="Close",f.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},d.append(f,this.overlayToggleBtn),o.append(r,i,l,d),this.overlay.appendChild(o),document.body.appendChild(this.overlay),td(r,o,()=>!!this.overlay,()=>f.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=St.find(l=>l.id===this.activeOverlayId);if(!t||!Jr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=$t(t.id),o=no(t.id),r=Ea(t.id),i=Po(t.id),s=n>=t.maxLevel;if(s?(this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} (MAXED)`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")):(this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="")),t.id===2){let l=Vf();this.overlayBonus.textContent=`Coin value bonus: ${at(l)}x`}else if(t.id===3){let l=Yf();this.overlayBonus.textContent=`XP value bonus: ${at(l)}x`}else{let l=n*t.effectPerLevel;this.overlayBonus.textContent=`Tsunami exponent bonus: +${l.toFixed(2)}`}if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?J(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?J(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${J(o)} / ${J(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=512/2*1.6;for(let u of St){if(!Jr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){if($t(u.id)>=u.maxLevel)return;let y=Po(u.id);nc(u.id,!y),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,d=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=d/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=512/2*1.6;for(let u of St){if(!Jr(u.id))continue;let d=this.getNodePosition(u),f=i-d.x,p=s-d.y;if(Math.sqrt(f*f+p*p)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<Number.MIN_VALUE&&(i=Number.MIN_VALUE),i>Number.MAX_VALUE&&(i=Number.MAX_VALUE);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,d=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=d-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<Number.MIN_VALUE&&(i=Number.MIN_VALUE),i>Number.MAX_VALUE&&(i=Number.MAX_VALUE);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,d=this.camX+(a-this.width/2)/r,f=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=d-(a-this.width/2)/i,this.camY=f-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var cg={};vt(cg,{calculateOfflineRewards:()=>es,calculatePreAutomationRewards:()=>ac,formatTimeCompact:()=>sc,grantOfflineRewards:()=>ti,initOfflineTracker:()=>VS,processOfflineProgress:()=>lg,showOfflinePanel:()=>hr});function sc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let h=t.div(l).floorToInteger(),b=h.mulBigNumInteger(l),w=t.sub(b),L=0;try{let R=w.div(c.fromInt(i)).floorToInteger();L=Number(R.toPlainIntegerString())}catch{L=0}return L===0?`${J(h)}y`:`${J(h)}y ${L}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let d=Math.floor(u/60),f=u%60;if(d<60)return f===0?`${d}m`:`${d}m ${f}s`;let p=Math.floor(d/60),g=d%60;if(p<24)return g===0?`${p}h`:`${p}h ${g}m`;let m=Math.floor(p/24),y=p%24;return y===0?`${m}d`:`${m}d ${y}h`}function hr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${sc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let d=document.createElement("div");d.className="offline-list",HS.forEach(m=>{let y=m.key,h=e[y];if(!h||typeof h.isZero=="function"&&h.isZero())return;if(y==="research_levels"){Array.isArray(h)&&h.forEach(U=>{let q=document.createElement("div");q.className="offline-row";let x=document.createElement("span");x.className="offline-plus",x.style.color="#004F96",x.textContent="+";let P=document.createElement("img");P.className="offline-icon",P.src=m.icon,P.alt="RP";let M=document.createElement("span");M.className="offline-text",M.style.color="#004F96";let _=c.fromInt(U.levels),X=_.cmp(c.fromInt(1))===0?"Level":"Levels";M.textContent=`${J(_)} ${X} of ${U.name}`,q.appendChild(x),q.appendChild(P),q.appendChild(M),d.appendChild(q)});return}let b=document.createElement("div");b.className="offline-row";let w=document.createElement("span");w.className="offline-plus",w.classList.add(`text-${y}`),w.textContent="+";let L=document.createElement("img");L.className="offline-icon",L.src=m.icon,L.alt=y;let R=document.createElement("span");R.className="offline-text",R.classList.add(`text-${y}`);let k=!1;h instanceof c?k=!h.isInfinite()&&h.cmp(c.fromInt(1))===0:k=Number(h)===1;let F=k?m.singular:m.plural;R.innerHTML=`${J(h)} ${F}`,b.appendChild(w),b.appendChild(L),b.appendChild(R),d.appendChild(b)}),u.appendChild(d),a.appendChild(u);let f=document.createElement("div");f.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let g=()=>{r.remove()};return p.addEventListener("click",g),r.addEventListener("click",m=>{m.target===r&&g()}),f.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(f),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{ts(i,a,".offline-scroll-container")}),r}function XS(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function es(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=zi?zi():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),d=St.filter(g=>Po(g.id)),f=[],p={};for(let g of d){let m=$t(g.id),y=no(g.id).add(u),h=0,b=g.maxLevel;for(;m<b;){let w=XS(g,m);if(w.isInfinite&&w.isInfinite()||y.cmp(w)<0)break;y=y.sub(w),m++,h++}h>0&&f.push({name:g.title,levels:h}),p[g.id]={level:m,rp:y}}f.length>0&&(o.research_levels=f),Object.keys(p).length>0&&(o.research_progress=p)}let s=(Zl?Zl():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||On("gears",t)||(o.gears=s);let l=mr?mr():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||On("books",t)||(o.books=u)}let a=Ct(Ke,Vr)||0;if(a>0){let u=1;mt(2)&&(u=10);let d=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!d.isZero()){let f=cc(),p=f.coins.mulBigNumInteger(d),g=f.xp.mulBigNumInteger(d),m=f.mp.mulBigNumInteger(d);p.isZero()||On("coins",t)||(o.coins=p),g.isZero()||sn(`ccc:xp:progress:${t}`)||(o.xp=g),m.isZero()||sn(`ccc:mutation:progress:${t}`)||(o.mp=m)}}return o}function ti(e){if(v()!=null){if(e.xp)try{let n=Fi(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=os(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(xa(r,o.level),La(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||O[n]&&typeof O[n].add=="function"&&O[n].add(e[n])}}function ac(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=qn(),i=c.fromInt(1);try{let l=ns(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof $n=="function"){let l=$n("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=cc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),d=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||sn(`ccc:xp:progress:${t}`)||(o.xp=u),d.isZero()||sn(`ccc:mutation:progress:${t}`)||(o.mp=d)}return o}function lg(){let e=v();if(e==null)return;let t=sf(),n=Date.now();if(t<=0)return;if(n<t-1e4){hn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Dt()){let l=ac(r),a=Object.keys(l).length>0;return a&&(ti(l),hr(l,o,!0)),a}let i=es(r),s=Object.keys(i).length>0;return s&&(ti(i),hr(i,o)),s}function VS(e,t){ag||(ag=!0,document.addEventListener("visibilitychange",()=>{v()!=null&&(e&&!e()||(document.hidden?Pf():(Bf(),lg()&&typeof t=="function"&&t())))}))}var ag,HS,lc=De(()=>{bt();Wi();So();Xr();bt();Lt();zt();jr();Io();cn();Ki();Qr();Yr();Ta();Dn();wo();ro();Ui();ag=!1;HS=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=hr});function rd(e){let t=24,n=Date.now();try{let o=localStorage.getItem(nd(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(od(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(nd(e),"24"),localStorage.setItem(od(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function fg(e,t,n){try{localStorage.setItem(nd(e),String(t)),localStorage.setItem(od(e),String(n))}catch{}}function dg(){let e=v();if(e==null)return;let{charges:t,lastCharge:n}=rd(e);if(t>=rs)return;let o=Date.now(),r=o-n;if(r>=uc){let i=Math.floor(r/uc);t+=i,t>=rs?(t=rs,n=o):n+=i*uc,fg(e,t,n),gr&&gr.classList.contains("is-active")&&Fo(!0)}}function WS(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function zS(){let e=v();if(e==null)return;dg();let{charges:t,lastCharge:n}=rd(e);t<=0||(t>=rs&&(n=Date.now()-50),t--,fg(e,t,n),Fo(!0),ka&&clearInterval(ka),ka=setInterval(()=>{Fo()},1e3),dt(YS,{volume:.5}),WS(),setTimeout(()=>{let o=es(ug);ti(o),hr(o,ug*1e3)},7250))}function Fo(e=!1){if(!gr||!gr.classList.contains("is-active"))return;let t=v();if(t==null)return;e||dg();let{charges:n,lastCharge:o}=rd(t),r=gr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${rs}</span>`);let i=gr.querySelector(".warp-timer");if(i)if(n>=rs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+uc,u=Math.max(0,a-l);i.textContent=`Next warp in ${sc(u)}`}let s=gr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function pg(e){if(!e||e.__warpInit)return;e.__warpInit=!0,gr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",zS),ka||(ka=setInterval(()=>{Fo()},1e3)),Fo()}var nd,od,rs,uc,ug,YS,gr,ka,id=De(()=>{bt();lc();Rn();nd=e=>`ccc:warp:charges:${e}`,od=e=>`ccc:warp:lastCharge:${e}`,rs=24,uc=3600*1e3,ug=150,YS="sounds/warp.ogg",gr=null,ka=null});function Eg(){try{return localStorage.getItem(vr(md))==="1"}catch{return!1}}function gd(){try{return localStorage.getItem(vr(xg))==="1"}catch{return!1}}function mc(e){let t=v();if(t==null)return;let n=`${xg}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),KS()}catch{}}function hc(){return gd()?"Jeff":"Merchant"}function KS(){let e=hc();Ve&&Ve.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function Aa(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=h=>{if(!(n&&o)){if(h?.type==="click"&&h.isTrusted&&Qn(e)){h.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(h)).catch(b=>console.error(b)),n&&y()}},l=()=>{r=!1,i=null},a=h=>{r&&l(),s(h)},u=h=>{h.pointerType!=="mouse"&&(typeof h.button=="number"&&h.button!==0||(r=!0,i=typeof h.pointerId=="number"?h.pointerId:null,vo(160)))},d=h=>{r&&(i!=null&&typeof h.pointerId=="number"&&h.pointerId!==i||l())},f=()=>{r&&l()},p=h=>{r=!0,vo(160)},g=h=>{r&&l()},m=()=>{r&&l()},y=()=>{e.removeEventListener("click",a),Lg?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",f)):eI&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",g),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function fc(e){return JS[e]??0}function mg(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function tI(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function Ra(e,t){let n=ni.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;ss.set(e,r),n.unlocked=r;let i=wn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&wn.buttons[e]?.classList.contains("is-active")&&vc("dialogue")}function sd(){let e=!1;try{e=!!cs?.()}catch{}Ra("reset",e)}function ad(){let e=!1;try{e=!!Dt?.()}catch{}Ra("workshop",e)}function vg(){let e=!1;try{typeof Eo=="function"&&(e=Eo())}catch{}Ra("warp",e)}function nI(){let e=v();if(e==null)return!1;try{return typeof Sn=="function"&&Sn()?!0:localStorage.getItem(_g(e))==="1"}catch{return!1}}function fd(){Ra("lab",nI())}function oI(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function rI(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof ln=="function"&&ln()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Qe=="function"?Qe():null;t&&typeof t=="object"&&(e.xpLevel=oI(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Sr=="function"&&Sr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Dt=="function"&&Dt()}catch{e.hasInfuseReset=!1}return e}function iI(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?cd:ud,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?cd:ud),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?yd:""),i.icon=o?.icon??(r==="mysterious"?yr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Uo:ZS),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function sI(){if(hg)return;hg=!0;let e=aI;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==v()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=v();if(t!=null){let n=`${QS}:${t}`;_t(n,{onChange:e})}}function aI(){Do()}function lI(e,t){let n=vd(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,Cg(n),cI(t.reward),!0)}function cI(e){if(e){if(e.type==="coins"){try{O.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{O.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{O.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function uI(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function vd(){try{return JSON.parse(localStorage.getItem(vr(Na))||"{}")}catch{return{}}}function Cg(e){let t=vr(Na);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{rt(t,n)}catch{}}catch{}}function fI(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function dI(){let e=dd;if(dd=null,typeof e=="function")try{e()}catch{}}function pI(e,t={}){t?.rawChanged&&Do()}function ld(e){if(e===bg)return;if(dI(),bg=e??null,e==null){Do();return}let t=`${Na}:${e}`;dd=_t(t,{parse:fI,onChange:pI});try{rt(t)}catch{}Do()}function mI(){if(gg){ld(v());return}gg=!0,ld(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{ld(v())})}function Ir(){Promise.resolve().then(()=>(Rn(),xl)).then(({loadAudio:e})=>{e(Mg)})}function hI(){if(is)return;is=dt(Mg,{volume:je?.15:.3,loop:!0})}function qo(){is&&(is.stop&&is.stop(),is=null)}function gI(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let w=0;w<t.length;w++){let L=t[w];L==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=L):L===">"&&l?(s+=L,i.push({type:"tag",content:s}),s="",l=!1):s+=L}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,d=!1,f=!1,p="";$o=!0,hI();let g=w=>{f&&(w.preventDefault(),d=!0)},m=w=>{f&&(w.key==="Enter"||w.key===" ")&&(d=!0)},y=o.length?o:[e];requestAnimationFrame(()=>{f=!0,y.forEach(w=>w.addEventListener("click",g,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let h=()=>{y.forEach(w=>w.removeEventListener("click",g)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),qo(),$o=!1},b=()=>{if(d){e.innerHTML=t,h(),r();return}if(a>=i.length){h(),r();return}let w=i[a];w.type==="tag"?(p+=w.content,e.innerHTML=p,a++,b()):(p+=w.content[u],e.innerHTML=p,u++,u>=w.content.length&&(a++,u=0),setTimeout(b,n))};b()})}function yI(e={}){if(!Ve)return;Ir();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Uo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||yr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,Ve.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Uo,r.textContent=e.message||yd,requestAnimationFrame(()=>t.classList.add("is-visible")),Ve.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),qo(),$o=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=d=>{d.key==="Escape"&&(d.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",d=>{n.contains(d.target)||(d.preventDefault(),xn(160),l())});let u=d=>{(!d||d.pointerType!=="mouse")&&xn(160),l()};Aa(i,()=>{u()},{once:!0}),i.focus?.()}function vI(e,t){Ir();let n=t.scriptId;String(e)==="6"&&typeof Qi=="function"&&!Qi()&&(n=7),Pr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${as}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,Ve.appendChild(o);let r=h=>{h.key==="Escape"&&o.isConnected&&f()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),Ve.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,d=()=>{Pr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),qo(),$o=!1,o.remove()},f=()=>{u||(u=!0,d(),Do())};o.addEventListener("pointerdown",h=>{l.contains(h.target)||(h.preventDefault(),h.pointerType!=="mouse"&&xn(160),f())});let p=new br({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(h,b)=>{t.scriptId===4&&h==="c4b"&&mc(!0)},onEnd:h=>{if(!u){if(u=!0,h&&h.noReward){Do(),d();return}lI(e,t),Do(),d()}}}),m=!!vd()[e]?.claimed,y=structuredClone(kf[n]);m&&y.nodes.m2b&&y.nodes.c2a&&t.scriptId===1&&(y.nodes.m2b.say="I've already given you Coins, goodbye.",y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&y.nodes.m3a&&(y.nodes.m3a.say="I've already given you Books, goodbye.",y.nodes.c2a&&(y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&y.nodes.m5a&&(y.nodes.m5a.say="I've already given you Gold, goodbye.",y.nodes.c5a&&(y.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&y.nodes.m7a&&(y.nodes.m7a.say="I've already given you Magic, goodbye.",y.nodes.c7a&&(y.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(y),p.start()}function bI(){if(document.getElementById(Ig))return;let e=document.createElement("style");e.id=Ig,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function SI(){let e=Ve?.querySelector(".merchant-content");if(!e||e.__customScroll||!ht)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),ht.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){bI();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;ht.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let d=null,f=()=>{let M=(e.scrollTop||0)>0;d!==M&&(d=M,ht?.classList.toggle("has-scroll-shadow",M))},p=()=>{let M=Ve.querySelector(".merchant-grabber"),_=Ve.querySelector(".merchant-header"),X=Ve.querySelector(".merchant-actions"),Q=(M?.offsetHeight||0)+(_?.offsetHeight||0)|0,pe=(X?.offsetHeight||0)|0;t.style.top=Q+"px",t.style.bottom=pe+"px"},g={},m=()=>{let{scrollHeight:M,clientHeight:_,scrollTop:X}=e,Q=t.clientHeight||e.clientHeight||1;if(g.scrollHeight===M&&g.clientHeight===_&&g.barH===Q&&(u||g.scrollTop===X))return;g={scrollHeight:M,clientHeight:_,scrollTop:X,barH:Q};let pe=_/Math.max(1,M),K=Math.max(28,Math.round(Q*pe)),ne=Math.max(1,M-_),ve=Math.max(0,Q-K);if(n.style.height=K+"px",u)n.style.setProperty("--thumb-y",`${ve}px`),n.style.setProperty("--thumb-x","0px");else{let he=Math.round(X/ne*ve);n.style.transform=`translateY(${he}px)`}t.style.display=M<=_+1?"none":""},y=()=>{p(),m(),f()},h=()=>{o&&(ht.classList.add("is-scrolling"),l&&clearTimeout(l))},b=M=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{ht.classList.remove("is-scrolling")},M))},w=()=>{m(),f(),o&&h(),s||b(r)},L=()=>b(r);e.addEventListener("scroll",w,{passive:!0}),s&&e.addEventListener("scrollend",L,{passive:!0});let R=new ResizeObserver(y);R.observe(e),window.addEventListener("resize",y),requestAnimationFrame(y);let k=!1,F=0,U=0,q=M=>{k=!0,F=M.clientY,U=e.scrollTop,n.classList.add("dragging"),h();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},x=M=>{if(!k)return;let _=t.clientHeight||1,X=n.clientHeight||1,Q=Math.max(1,_-X),pe=Math.max(1,e.scrollHeight-e.clientHeight),ne=(M.clientY-F)/Q*pe;e.scrollTop=U+ne},P=M=>{if(k){k=!1,n.classList.remove("dragging"),b(i);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",q),window.addEventListener("pointermove",x,{passive:!0}),window.addEventListener("pointerup",P),window.addEventListener("pointercancel",P),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let _=t.getBoundingClientRect(),X=M.clientY-_.top,Q=t.clientHeight||1,pe=n.clientHeight||1,K=Math.max(0,Q-pe),ne=Math.max(0,Math.min(X-pe/2,K)),ve=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ne/Math.max(1,K)*ve,h(),b(r)}),e.__customScroll={bar:t,thumb:n,ro:R,updateAll:y},y()}function II(){if(Ve)return;Ve=document.createElement("div"),Ve.className="merchant-overlay",Ve.id="merchant-overlay",Ve.setAttribute("inert",""),ht=document.createElement("div"),ht.className="merchant-sheet",ht.setAttribute("role","dialog"),ht.setAttribute("aria-modal","false"),ht.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",sd(),ad(),vg(),fd(),ni.forEach(g=>{g.key==="dialogue"&&ss.set("dialogue",!0);let m=ss.get(g.key),y=m??!!g.unlocked,h=document.createElement("button");h.type="button",h.className="merchant-tab",h.dataset.tab=g.key;let b=g.lockedLabel||"???";h.textContent=y?g.label:b,y?h.title=g.label||"Tab":(h.classList.add("is-locked"),h.disabled=!0,h.title="???"),g.unlocked=y,ss.set(g.key,y),Aa(h,w=>{if(h.disabled){w?.preventDefault?.();return}vc(g.key)}),o.appendChild(h),wn.buttons[g.key]=h}),wn.panels.dialogue=i,wn.panels.reset=s,wn.panels.workshop=l,wn.panels.warp=a,wn.panels.lab=u,wn.tablist=o,r.append(i,s,l,a,u),n.append(o,r),sd(),ad();try{Go()}catch{}try{bd(s)}catch{}try{Ye()}catch{}try{Xf(l)}catch{}try{pg(a)}catch{}try{Qf(u)}catch{}if(!yg&&typeof window<"u"){let g=m=>{let{key:y,slot:h}=m?.detail??{};h!=null&&h!==v()||((y==="forge"||!y)&&sd(),(y==="infuse"||!y)&&ad(),(y==="surge_completed"||!y)&&vg(),(y==="lab"||y==="tsunami"||!y)&&fd())};window.addEventListener("unlock:change",g,{passive:!0}),window.addEventListener("saveSlot:change",g,{passive:!0}),yg=!0}let d=document.createElement("div");d.className="merchant-actions";let f=document.createElement("button");f.type="button",f.className="merchant-close",f.textContent="Close",dc=f,d.appendChild(f);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${as}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,ht.append(e,t,n,d,p),Ve.appendChild(ht),document.body.appendChild(Ve),wI(),SI(),Sg||(Sg=!0,Aa(f,()=>{yc()},{once:!1}),document.addEventListener("keydown",_I),e.addEventListener("pointerdown",CI),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),Ve.addEventListener("pointerdown",Ir,{once:!0}))}function wI(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,sI(),Do()}function EI(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?vI(n.id,n.meta):n.isMysterious&&yI(n.lockInfo)}}function Do(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=rI(),o=vd(),r=!1,i=new Set;Object.entries(gc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",d=fc(u),f=iI(l,n),p=f.status,g=fc(p);if(g>d)a.status=p,p==="mysterious"?a.lockSnapshot=mg(f):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(g<d){if(u==="unlocked")f=tI(l),p="unlocked",g=fc(p);else if(u==="mysterious"){let M=a.lockSnapshot||mg(f)||{};f={status:"mysterious",unlocked:!1,title:M.title??f.title??"???",blurb:M.blurb??f.blurb??cd,tooltip:M.tooltip??f.tooltip??"Hidden Dialogue",message:M.message??f.message??yd,icon:M.icon??f.icon??yr,headerTitle:M.headerTitle??f.headerTitle??Uo,ariaLabel:M.ariaLabel??f.ariaLabel??"Hidden merchant dialogue"},p="mysterious",g=fc(p)}}let m=p==="unlocked",y=p==="mysterious",h=p==="locked",b=!!a.claimed,w=m&&!!(l.once&&b),L=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!L){L=document.createElement("button"),L.type="button",L.className="dlg-card",L.dataset.dlgId=String(s);let M=document.createElement("div");M.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let X=document.createElement("div");X.className="dlg-reward",L.append(M,_,X),t.appendChild(L),Aa(L,EI)}L._dlgCtx={id:s,meta:l,lockInfo:f,unlocked:m,isMysterious:y},L.dataset.dlgStatus=p,L.disabled!==!!h&&(L.disabled=!!h),L.classList.toggle("is-locked",h),L.classList.toggle("is-mysterious",y),L.classList.toggle("is-complete",!!w),L.classList.toggle("has-again",!!w),h?(L.getAttribute("aria-disabled")!=="true"&&L.setAttribute("aria-disabled","true"),L.getAttribute("tabindex")!=="-1"&&L.setAttribute("tabindex","-1")):(L.hasAttribute("aria-disabled")&&L.removeAttribute("aria-disabled"),L.hasAttribute("tabindex")&&L.removeAttribute("tabindex"));let R=L.querySelector(".dlg-title"),k=m?l.title:f.title??"???";R.textContent!==k&&(R.textContent=k);let F=L.querySelector(".dlg-blurb"),U=m?l.blurb:f.blurb??"";F.textContent!==U&&(F.textContent=U);let q=L.querySelector(".dlg-reward");if(m&&l.reward){let M=jS[l.reward.type];if(M){q.classList.contains("has-reward")||(q.classList.add("has-reward"),q.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),q.style.getPropertyValue("--reward-icon")!==`url('${M}')`&&q.style.setProperty("--reward-icon",`url('${M}')`);let _=q.querySelector(".amt"),X=String(l.reward.amount);_&&_.textContent!==X&&(_.textContent=X);let Q=q.querySelector(".currency-name");if(Q){let K=String(l.reward.type||""),ne=K.charAt(0).toUpperCase()+K.slice(1);Q.textContent!==ne&&(Q.textContent=ne)}let pe=`Reward: ${l.reward.amount} ${l.reward.type}`;q.getAttribute("aria-label")!==pe&&q.setAttribute("aria-label",pe)}else{q.classList.remove("has-reward");let _=uI(l.reward);q.textContent!==_&&(q.textContent=_),q.style.display!==""&&(q.style.display=""),q.removeAttribute("aria-label")}q.style.display==="none"&&(q.style.display="")}else q.textContent!==""&&(q.textContent=""),q.style.display!=="none"&&(q.style.display="none");let x=m?`${l.title}${w?" (completed)":""}`:f.ariaLabel||(y?"Hidden merchant dialogue":"Locked merchant dialogue");if(L.getAttribute("aria-label")!==x&&L.setAttribute("aria-label",x),f.tooltip)L.title!==f.tooltip&&(L.title=f.tooltip);else if(m){let M="Left-click: Start Dialogue";L.title!==M&&(L.title=M)}else L.hasAttribute("title")&&L.removeAttribute("title");let P=L.querySelector(".dlg-again");w?P||(P=document.createElement("div"),P.className="dlg-again",P.textContent="Ask Again?",L.appendChild(P)):P&&P.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&Cg(o)}function xI(){let e=Ve.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Pr(!0);let i=new br({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Pr(!1);try{localStorage.setItem(vr(md),"1")}catch{}try{window.dispatchEvent(new Event(hd))}catch{}e.classList.remove("is-visible"),Ve.classList.remove("firstchat-active")}});i.load(kf[0]),i.start()}function LI(){if(!Ve)return;let e=Ve.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),Ve.classList.remove("firstchat-active")}function Tg(){if(II(),ls)return;let e=document.activeElement;e instanceof HTMLElement&&!Ve.contains(e)?pc=e:pc=null,ls=!0;let t=v(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(_g(t),"1")}catch{}fd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(vr(md))==="1"}catch{o=!1}o||Ve.classList.add("firstchat-instant"),ht.style.transition="none",ht.style.transform="",Ve.removeAttribute("inert"),ht.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ve.classList.contains("firstchat-instant")||(ht.style.transition=""),Ve.classList.add("is-open"),xn(140),dc&&typeof dc.focus=="function")try{dc.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(vr(wg))||"dialogue"}catch{}n&&(r="dialogue"),vc(r),qo(),o||(Ve.querySelector(".merchant-firstchat")?.classList.add("is-visible"),Ve.classList.add("firstchat-active"),xI())})})}function yc(){if(!ls)return;if(Pr(!1),je){try{vo(100)}catch{}try{xn(80)}catch{}}ls=!1,ht.style.transition="",ht.style.transform="",Ve.classList.remove("is-open"),Ve.classList.remove("firstchat-instant"),LI();let e=document.activeElement;if(e&&Ve.contains(e)){let t=pc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}Ve.setAttribute("inert",""),pc=null,qo(),$o=!1}function _I(e){if(ls&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<ni.length;i++)ss.get(ni[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<ni.length&&(e.preventDefault(),vc(ni[r].key))}}function CI(e){if(!ls)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;En={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},ht.style.transition="none",window.addEventListener("pointermove",kg,{passive:!0}),window.addEventListener("pointerup",Ag),window.addEventListener("pointercancel",Ng)}function kg(e){if(!En||En.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-En.startY);En.lastY=t,En.moved=n,ht.style.transform=`translateY(${n}px)`}function Ag(){if(!En||En.canceled){pd();return}let e=Math.max(1,performance.now()-En.startT),t=En.moved;t/e>.55&&t>40||t>140?(vo(160),ht.style.transition="transform 140ms ease-out",ht.style.transform="translateY(100%)",setTimeout(()=>{yc()},150)):(ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)"),pd()}function Ng(){En&&(En.canceled=!0,ht.style.transition="transform 180ms ease",ht.style.transform="translateY(0)",pd())}function pd(){window.removeEventListener("pointermove",kg),window.removeEventListener("pointerup",Ag),window.removeEventListener("pointercancel",Ng),En=null}function vc(e){let t=ni.find(o=>o.key===e),n=ss.get(e);(!t||!n)&&(e="dialogue");for(let o in wn.buttons)wn.buttons[o].classList.toggle("is-active",o===e);for(let o in wn.panels)wn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Do()}catch{}if(e==="warp")try{Fo()}catch{}if(e==="lab"){typeof Qi=="function"&&!Qi()&&MI();try{ed()}catch{}}try{localStorage.setItem(vr(wg),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=Ve?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function Oa(e=[]){e.forEach(t=>Ra(t,!0))}function Rg(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${as}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Ir();let u=g=>{g.key==="Escape"&&(g.stopImmediatePropagation(),g.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let d=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{f()},5e3)},15e3)},1e3)},f=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${as}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let g=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),y=r.querySelector(".merchant-firstchat__row"),h=r.querySelector(".merchant-firstchat__card"),b={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},w=new br({textEl:g,choicesEl:m,skipTargets:[g,y,h],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),qo(),$o=!1,r.remove(),t&&t()},5e3)}});w.load(b),w.start()},p=new br({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",qo(),$o=!1,n&&n.hideCursor&&n.hideCursor(),d()}});p.load(o),p.start()}function MI(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${as}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Ir();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new br({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{qo(),$o=!1,e.remove()}});s.load(i),s.start()}function Og(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${hc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${as}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Ir();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new br({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{qo(),$o=!1,t.remove(),e&&e()}});l.load(s),l.start()}var as,md,wg,Na,hd,vr,xg,ni,ss,jS,yr,Uo,ZS,cd,ud,yd,JS,QS,Lg,eI,hg,gg,yg,_g,bg,dd,gc,Ve,ht,dc,ls,En,pc,Sg,wn,Mg,is,$o,br,Ig,bc=De(()=>{bt();Lt();Oh();Dn();So();Wi();id();Ki();ro();jr();$i();Io();Rn();as="img/misc/merchant.webp",md="ccc:merchantMet",wg="ccc:merchantTab",Na="ccc:merchant:dlgState",hd="ccc:merchant:met",vr=e=>`${e}:${v()}`;xg="ccc:unlock:jeff";ni=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],ss=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),jS={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},yr="img/misc/mysterious.webp",Uo="Hidden Dialogue",ZS="Locked Dialogue",cd="Hidden Dialogue",ud="Locked",yd="Locked Dialogue",JS={locked:0,mysterious:1,unlocked:2},QS="ccc:reset:forge:completed",Lg=typeof window<"u"&&"PointerEvent"in window,eI=!Lg&&typeof window<"u"&&"ontouchstart"in window;hg=!1,gg=!1,yg=!1;_g=e=>`ccc:unlock:lab:${e}`;bg=null,dd=null;gc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:yr,headerTitle:Uo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:ud,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:yr,headerTitle:Uo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof Eo=="function"&&Eo()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:yr,headerTitle:Uo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof Sn=="function"&&Sn())return!0;let t=typeof In=="function"?In():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof Eo=="function"&&Eo()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:yr,headerTitle:Uo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:yr,headerTitle:Uo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};mI();Ve=null,ht=null,dc=null,ls=!1,En=null,pc=null,Sg=!1,wn={buttons:{},panels:{},tablist:null},Mg="sounds/merchant_typing.ogg",is=null,$o=!1;br=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await gI(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=Aa(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};Ig="ccc-scroll-timeline-styles"});var Bg={};vt(Bg,{getAutobuyerToggle:()=>oi,initAutomationEffects:()=>RI,setAutobuyerToggle:()=>wr,updateAutomation:()=>Pg});function Id(e){Ic!==e&&(us.clear(),Ic=e)}function oi(e,t){let n=v();Id(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(us.has(r))return us.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return us.set(r,i),i}function wr(e,t,n){let o=v();Id(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);us.set(i,s);try{localStorage.setItem(i,s)}catch{}}function TI(e){Pg(e),NI(e)}function kI(){if(Sc)return Sc;let e=Ft(xe.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Sc=t,Sc}function AI(e){if(!(!e||e.length===0)){for(let t of e)if(oi(xe.STARTER_COVE,t.id)!=="0"){let o=Ct(xe.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&Ed(xe.STARTER_COVE,t.id)}}}function NI(e){let t=v();Id(t);let n=kI();for(let[r,i]of Object.entries(Hi)){let s=Number(r);Ct(Ke,s)>0&&n[i]&&AI(n[i])}Ct(Ke,eo)>0&&(Sd++,Sd>=5&&(Sd=0,oi(Ke,eo)!=="0"&&Jl()))}function Pg(e){let n=Ct(Ke,Vr);if(n<=0){Pa=0;return}Pa+=e;let o=1/n;if(Pa>=o){let r=Math.floor(Pa/o);if(r>0){let i=r;if(mt(2))if(mt(8)){let s=Bt();i*=Math.pow(10,s)}else i*=10;wd(i),Pa-=r*o}}}function RI(){bo(TI),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Ic&&(us.clear(),Ic=t)})}var Pa,Sd,us,Ic,Sc,wc=De(()=>{Xr();cn();Ta();Yr();Wi();bt();ro();Pa=0,Sd=0,us=new Map,Ic=null;Sc=null});function Hg(e){if(!e||!e.costType)return!1;let t=UI[e.costType];return!t||Ct(Ke,t)<=0?!1:oi(e.area,e.id)!=="0"}function xd(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function xc(e,t){return t==="standard"&&xd(e)===FI}function Dg(e){let t=Ft(e),n={};for(let o of t){let r=Ln(e,o.id),i=Ct(e,o.id),s=Ho(e,o.id),l=s.iconOverride??Ac(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,d=!!s.locked,f=o.upgType==="HM"?!!Ua(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:d,lockState:s,useLockedBase:!!s.useLockedBase||d,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:f}}return n}function Xg(e){return $g[e]||$g.standard}function xn(e=140){if(!je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function _c(e){return String(e??"").replace(/<[^>]*>/g,"")}function Ec(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function Zt(){dt($I,{volume:je?Vg:Yg})}function Wg(){let e=je?Vg*2:Yg*2;dt(qI,{volume:e})}function GI(e){return`<img alt="" src="${Ug[e]||Ug.coins}" class="currency-ico">`}function XI(){if(document.getElementById(qg))return;let e=document.createElement("style");e.id=qg,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function ts(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,d=150,f=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){XI();let ne=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=ne,s.style.scrollTimelineName=ne,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=ne,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let y=null,h=()=>{let ne=((i?s.scrollTop:s.scrollLeft)||0)>0;y!==ne&&(y=ne,t?.classList.toggle("has-scroll-shadow",ne))},b=()=>{if(!s.isConnected||!t.isConnected)return;let K=s.getBoundingClientRect(),ne=t.getBoundingClientRect();if(i){let ve=Math.max(0,K.top-ne.top),he=Math.max(0,ne.bottom-K.bottom);l.style.top=ve+"px",l.style.bottom=he+"px",l.style.left="",l.style.right=""}else{let ve=Math.max(0,K.left-ne.left),he=Math.max(0,ne.right-K.right);l.style.left=ve+"px",l.style.right=he+"px",l.style.top="",l.style.bottom="",l.style.height=""}},w={},L=()=>{let K=i?s.scrollHeight:s.scrollWidth,ne=i?s.clientHeight:s.clientWidth,ve=i?s.scrollTop:s.scrollLeft,he=i?l.clientHeight||ne:l.clientWidth||ne;if(w.scrollSize===K&&w.clientSize===ne&&w.barSize===he&&(m||w.scrollPos===ve))return;w={scrollSize:K,clientSize:ne,scrollPos:ve,barSize:he};let V=ne/Math.max(1,K),ee=Math.max(28,Math.round(he*V)),$=Math.max(1,K-ne),G=Math.max(0,he-ee);if(i?(a.style.height=ee+"px",a.style.width="100%"):(a.style.width=ee+"px",a.style.height="100%"),m)i?(a.style.setProperty("--thumb-y",`${G}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${G}px`),a.style.setProperty("--thumb-y","0px"));else{let le=Math.round(ve/$*G);i?a.style.transform=`translateY(${le}px)`:a.style.transform=`translateX(${le}px)`}let j=K>ne+1;l.style.display=j?"":"none",t?.classList.toggle("has-active-scrollbar",j)},R=()=>{b(),L(),h()};typeof MutationObserver<"u"&&new MutationObserver(()=>R()).observe(s,{childList:!0,subtree:!0,characterData:!0});let k=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},F=K=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},K))},U=()=>{L(),h(),u&&k(),p||F(d)},q=()=>F(d);s.addEventListener("scroll",U,{passive:!0}),p&&s.addEventListener("scrollend",q,{passive:!0}),new ResizeObserver(R).observe(s),window.addEventListener("resize",R),requestAnimationFrame(R);let P=!1,M=0,_=0,X=K=>{P=!0,M=i?K.clientY:K.clientX,_=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),k();try{a.setPointerCapture(K.pointerId)}catch{}K.preventDefault()},Q=K=>{if(!P)return;let ne=i?l.clientHeight:l.clientWidth,ve=i?a.clientHeight:a.clientWidth,he=Math.max(1,ne-ve),V=i?s.scrollHeight:s.scrollWidth,ee=i?s.clientHeight:s.clientWidth,$=Math.max(1,V-ee),j=(i?K.clientY:K.clientX)-M,le=_+j/he*$;i?s.scrollTop=le:s.scrollLeft=le},pe=K=>{if(P){P=!1,a.classList.remove("dragging"),F(f);try{a.releasePointerCapture(K.pointerId)}catch{}}};a.addEventListener("pointerdown",X),window.addEventListener("pointermove",Q,{passive:!0}),window.addEventListener("pointerup",pe),window.addEventListener("pointercancel",pe),l.addEventListener("pointerdown",K=>{if(K.target===a)return;let ne=l.getBoundingClientRect(),ve=i?K.clientY-ne.top:K.clientX-ne.left,he=i?a.clientHeight:a.clientWidth,V=i?l.clientHeight:l.clientWidth,ee=Math.max(0,V-he),$=Math.max(0,Math.min(ve-he/2,ee)),G=i?s.scrollHeight:s.scrollWidth,j=i?s.clientHeight:s.clientWidth,le=Math.max(1,G-j),ue=$/Math.max(1,ee)*le;i?s.scrollTop=ue:s.scrollLeft=ue,k(),F(d)}),R()}function Gg(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let d=BigInt(a)-BigInt(u);return d>0n?c.fromAny(d.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function VI(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let f=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(f)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=O[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let f=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return f&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):Gg(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let f=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),g=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(g));if(f.cmp(p)===0&&f.cmp(m)===0){let h=Gg(e,o,r),b=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(h.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,w=0,L=Math.max(0,b);for(;w<L;){let R=Math.floor((w+L+1)/2),k=c.fromInt(R);(typeof f.mulBigNumInteger=="function"?f.mulBigNumInteger(k):c.fromAny(f??0).mulBigNumInteger(k)).cmp(a)<=0?w=R:L=R-1}return c.fromInt(w)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:d}=ri(e,o,a,u,{fastOnly:!0});return d??c.fromInt(0)}function Ql(e="standard"){(Mc[e]||Mc.standard).open()}function zg(e=!1){Object.values(Mc).forEach(t=>t.close(e))}function Er(e=!1){Object.values(Mc).forEach(t=>t.update(e))}function YI(){if(Jt)return;Jt=document.createElement("div"),Jt.className="upg-overlay",it=document.createElement("div"),it.className="upg-sheet",it.setAttribute("role","dialog"),it.setAttribute("aria-modal","false"),it.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",it.append(e,t,n,o,r),Jt.appendChild(it),document.body.appendChild(Jt),Jt.addEventListener("pointerdown",u=>{je&&u.pointerType!=="mouse"&&u.target===Jt&&(u.preventDefault(),u.stopPropagation())},!0),Jt.addEventListener("click",u=>{je&&u.target===Jt&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Tc)return;let d=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:d,lastY:d,moved:0},it.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let d=u.clientY;if(typeof d!="number")return;let f=Math.max(0,d-i.startY);i.lastY=d,i.moved=f,it.style.transform=`translateY(${f}px)`}function a(u){if(!i)return;let d=i.moved>140;if(it.style.transition="transform 160ms ease",it.style.transform=d?"translateY(100%)":"translateY(0)",d){if(je&&(!u||u.pointerType!=="mouse"))try{xn(120)}catch{}setTimeout(Kg,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function Kg(){if(je)try{xn(160)}catch{}if(typeof Lc=="function"){let e=Lc;Lc=null;try{e()}catch{}}Tc=!1,!(!Jt||!it)&&(it.style.transition="",it.style.transform="",Jt.classList.remove("is-open"),Jt.style.pointerEvents="none")}function WI(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let d=document.createElement("li"),f=document.createElement("span");f.className="hm-milestone-text",u&&typeof u=="object"?(f.textContent=u.text??"",u.achieved&&d.classList.add("hm-milestone-achieved")):f.textContent=u,d.appendChild(f),i.appendChild(d)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function zI(e,t="standard"){YI(),Tc=!0;let n=!0,o=Xg(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Tc=!1;return}let l=e.upgType==="HM",a=e.tie===we.ENDLESS_XP;function u(m,y,h="div"){let b=y.split(" ").filter(R=>R.length>0),w=null,L=[];for(let R=0;R<m.children.length;R++){let k=m.children[R];h&&k.tagName.toLowerCase()!==h.toLowerCase()||b.every(F=>k.classList.contains(F))&&(w?L.push(k):w=k)}return L.forEach(R=>R.remove()),w||(w=document.createElement(h),w.className=y,m.appendChild(w)),w}let d=m=>{let y=document.createElement("div");return y.className="upg-line",y.innerHTML=m,y},f=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let y=m.lockState||o.getLockState(e.id),h=!!y?.locked,b=h&&(y?.hidden||y?.hideEffect||y?.hideCost),w=!!m.unlockUpgrade&&!b;it.classList.toggle("is-locked-hidden",b);let L=it.querySelector(".upg-header"),R=u(L,"upg-title");R.textContent!==(m.displayTitle||m.upg.title)&&(R.textContent=m.displayTitle||m.upg.title);let k=!!m.hmReadyToEvolve,F=k?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,U=u(L,"upg-level"),q=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??J(m.lvlCapBn),x=m.lvlCapFmtText??m.upg.lvlCapFmtText??_c(q),P=k?`Level ${m.lvlFmtHtml} / ${q} (EVOLVE READY)`:F?`Level ${m.lvlFmtHtml} / ${q} (MAXED)`:`Level ${m.lvlFmtHtml} / ${q}`,M=_c(P);U.innerHTML!==P&&(U.innerHTML=P),U.getAttribute("aria-label")!==M&&U.setAttribute("aria-label",M),U.hidden=b,b||U.removeAttribute("aria-hidden"),it.classList.toggle("is-maxed",F),it.classList.toggle("hm-evolve-ready",k),it.classList.toggle("is-unlock-upgrade",w),it.classList.toggle("is-hm-upgrade",l&&!b),it.classList.toggle("is-endless-xp",a),it.classList.toggle("is-magnet-upgrade",e.tie===we.MAGNET),it.classList.toggle("is-no-effect",!m.effect);let _=L.querySelector(".auto-toggle-wrapper"),X=t==="automation"?Hi[e.id]:null,Q=t==="automation"&&e.id===eo,pe=!!X,K=t==="standard"?DI[e.costType]:null,ne=0;K?ne=Ct(Ke,K):(pe||Q)&&(ne=Ct(Ke,e.id));let he=ne>0&&(pe||K||Q)&&!b;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",L.appendChild(_));let V=_.querySelector("button");if(V||(V=document.createElement("button"),V.type="button",V.style.padding="10px 14px",V.style.fontSize="16px",V.style.width="auto",V.style.minWidth="180px",V.addEventListener("click",ie=>{typeof V._onClick=="function"&&V._onClick(ie)}),_.appendChild(V)),he){V.style.visibility="",V.style.pointerEvents="auto";let ie=v(),Se=ie!=null?`:${ie}`:"",Ne=!0;if(pe){let _e=`ccc:autobuy:master:${X}${Se}`,Re=Ft(xe.STARTER_COVE),se=!1;for(let te of Re)if(te.costType===X){let Ie=`ccc:autobuy:${te.area}:${te.id}${Se}`;if(oi(te.area,te.id)!=="0"){se=!0;break}}Ne=se}else Ne=oi(e.area,e.id)!=="0";Ne?(V.className="shop-delve",V.textContent="Automation: ON",V.style.backgroundColor=""):(V.className="shop-close",V.textContent="Automation: OFF",V.style.backgroundColor=""),V._onClick=_e=>{_e.preventDefault(),_e.stopPropagation(),je&&xn(50);let se=!Ne?"1":"0";pe?(localStorage.setItem(`ccc:autobuy:master:${X}${Se}`,se),Ft(xe.STARTER_COVE).forEach(Ie=>{Ie.costType===X&&wr(Ie.area,Ie.id,se)})):wr(e.area,e.id,se),p()}}else V.style.visibility="hidden",V.style.pointerEvents="none",V.className="shop-delve",V.textContent="Automation: ON",V._onClick=null;let ee=it.querySelector(".upg-content");f&&(ee.scrollTop=0,f=!1);let $=u(ee,"upg-desc centered");$.classList.toggle("lock-desc",b);let G=(m.displayDesc||m.upg.desc||"").trim();k?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):G?($.classList.remove("hm-evolve-note"),$.textContent!==G&&($.textContent=G),$.hidden=!1):$.hidden=!0;let j=u(ee,"upg-info"),le=null,ue=ie=>{le?le.nextElementSibling!==ie&&j.insertBefore(ie,le.nextSibling):j.firstElementChild!==ie&&j.prepend(ie),le=ie};if(h&&y?.reason&&!b){let ie=(m.displayDesc||"").trim(),Se=String(y.reason??"").trim();if(ie!==Se){let Ne=j.querySelector(".lock-wrapper");if(!Ne){Ne=document.createElement("div"),Ne.className="lock-wrapper";let se=document.createElement("div");se.className="upg-line lock-note",Ne.append(se)}let _e=Array.from(Ne.children);for(let se of _e)se.tagName==="DIV"&&!se.className&&se.style.height==="12px"&&se.remove();let Re=Ne.querySelector(".lock-note");Re.textContent!==y.reason&&(Re.textContent=y.reason),ue(Ne)}else{let Ne=j.querySelector(".lock-wrapper");Ne&&Ne.remove()}}else{let ie=j.querySelector(".lock-wrapper");ie&&ie.remove()}if(m.effect&&!(h&&y?.hideEffect)){let ie=j.querySelector(".effect-wrapper");if(!ie){ie=document.createElement("div"),ie.className="effect-wrapper";let Re=document.createElement("div");Re.className="upg-line",ie.append(Re)}let Se=Array.from(ie.children);for(let Re of Se)Re.tagName==="DIV"&&!Re.className&&Re.style.height==="12px"&&Re.remove();let Ne=ie.querySelector(".upg-line"),_e=`<span class="bonus-line">${m.effect}</span>`;Ne.innerHTML!==_e&&(Ne.innerHTML=_e),ue(ie)}else{let ie=j.querySelector(".effect-wrapper");ie&&ie.remove()}let C=GI(m.upg.costType),W=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ce=F||k;if(!m.unlockUpgrade&&!ce&&(!h||!y?.hideCost)){let ie=u(j,"upg-costs");ue(ie);let Se=Ec(m.upg.costType,W),Ne=`Cost: ${C} ${O[m.upg.costType].fmt(W)} ${Se}`,_e=u(ie,"cost-line","div");if(_e.className.includes("upg-line")||(_e.className="upg-line cost-line"),_e.innerHTML!==Ne&&(_e.innerHTML=Ne),l){let Ie=u(ie,"milestone-line","div");Ie.className.includes("upg-line")||(Ie.className="upg-line milestone-line");let I="\u2014",Y="",z=Hg(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(z){let ae=m.hmNextMilestone.sub(c.fromInt(1)),qe=0;try{let be=ae.toPlainIntegerString?.();be&&be!=="Infinity"?qe=Number(be):qe=Number(ae.toString())}catch{qe=0}let tt=c.fromInt(0);try{tt=c.fromAny(m.upg.costAtLevel(qe))}catch{}I=O[m.upg.costType].fmt(tt),Y=Ec(m.upg.costType,tt)}else{let ae=m.hmNextMilestone.sub(m.lvlBn),qe=ae.toPlainIntegerString?.(),tt=Math.max(0,Math.floor(Number(qe&&qe!=="Infinity"?qe:Number(ae.toString()||0)))),{spent:be}=ri(m.upg,m.lvlBn,c.fromAny("Infinity"),tt);I=O[m.upg.costType].fmt(be),Y=Ec(m.upg.costType,be)}}catch{}let ge=`${z?"Cost at next milestone:":"Cost to next milestone:"} ${C} ${I} ${Y}`;Ie.innerHTML!==ge&&(Ie.innerHTML=ge)}else{let Ie=ie.querySelector(".milestone-line");Ie&&Ie.remove()}let Re=Ec(m.upg.costType,m.have),se=`You have: ${C} ${O[m.upg.costType].fmt(m.have)} ${Re}`,te=u(ie,"have-line","div");te.className.includes("upg-line")||(te.className="upg-line have-line"),te.innerHTML!==se&&(te.innerHTML=se)}else{let ie=j.querySelector(".upg-costs");ie&&ie.remove()}let me=it.querySelector(".upg-milestones"),Z=me.querySelector(".hm-view-milestones-row");if(!Z){Z=document.createElement("div"),Z.className="hm-view-milestones-row";let ie=document.createElement("button");ie.type="button",ie.className="shop-delve hm-view-milestones",ie.textContent="View Milestones",ie.addEventListener("click",Se=>{ie._onClick&&ie._onClick(Se)}),Z.appendChild(ie),me.appendChild(Z)}let re=Z.querySelector("button");l&&!b?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ie=Array.isArray(m.hmMilestones)?m.hmMilestones:[],Se=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Ne=(()=>{try{return BigInt(qt)*BigInt(Se)}catch{return 0n}})(),_e=ie.sort((Re,se)=>Number(Re?.level||0)-Number(se?.level||0)).map(Re=>{let se=Math.max(0,Math.floor(Number(Re?.level||0))),te=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(se)+Ne).toString())}catch{return c.fromAny(se+qt*Se)}})(),Ie=te?.isInfinite?.()?"Infinity":J(te),I=at(Re?.multiplier??Re?.mult??Re?.value??1),Y=`${Re?.target??Re?.type??"self"}`.toLowerCase(),z=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(te)>=0}catch{}return!1})(),oe=`Level ${Ie}: Multiplies this upgrade\u2019s effect by ${I}x`;return Y==="xp"&&(oe=`Level ${Ie}: Multiplies XP value by ${I}x`),(Y==="coin"||Y==="coins")&&(oe=`Level ${Ie}: Multiplies Coin value by ${I}x`),Y==="mp"&&(oe=`Level ${Ie}: Multiplies MP value by ${I}x`),{text:oe,achieved:z}});WI(_e)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ye=it.querySelector(".upg-actions"),Le=ye.querySelector(".shop-close");if(Le||(Le=document.createElement("button"),Le.type="button",Le.className="shop-close",Le.textContent="Close",Le.addEventListener("click",()=>{n=!1,Kg()}),ye.appendChild(Le)),h||F)ye.querySelectorAll("button:not(.shop-close)").forEach(ie=>ie.remove()),document.activeElement&&document.activeElement!==Le&&!ye.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Le.focus();else{let ie=m.have.cmp(W)>=0,Se=(se,te,Ie,I,Y=!1)=>{let z=ye.querySelector(`.${se.split(" ").join(".")}`);if(!z){z=document.createElement("button"),z.type="button",z.className=se,z.textContent=te;let oe=()=>{typeof z._onClick=="function"&&z._onClick()};"PointerEvent"in window?z.addEventListener("pointerdown",ae=>{ae.pointerType==="mouse"||typeof ae.button=="number"&&ae.button!==0||(oe(),ae.preventDefault())},{passive:!1}):z.addEventListener("touchstart",ae=>{oe(),ae.preventDefault()},{passive:!1}),z.addEventListener("click",()=>{je||oe()});let ge=ye.children;I>=ge.length?ye.appendChild(z):ye.insertBefore(z,ge[I])}return z._onClick=Ie,z.textContent!==te&&(z.textContent=te),z.disabled!==Y&&(z.disabled=Y),z};if(k){ye.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(se=>se.remove()),Se("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:se}=o.evolve(e.id);se&&(Wg(),Er(),p())},1,!1);return}if(m.unlockUpgrade){ye.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(se=>se.remove()),Se("shop-delve btn-unlock","Unlock",()=>{let{bought:se}=o.buyOne(e.id);if(!(se instanceof c?se:c.fromAny(se??0)).isZero?.()){if(Zt(),xc(e,t))try{Oa(["reset"])}catch{}Er(),p()}},1,!ie);return}if(ye.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(se=>se.remove()),Se("shop-delve btn-buy-one","Buy",()=>{let se=o.getUiModel(e.id);if(se.have.cmp(se.nextPrice instanceof c?se.nextPrice:c.fromAny(se.nextPrice||0))<0)return;let{bought:te}=o.buyOne(e.id);(te instanceof c?te:c.fromAny(te??0)).isZero?.()||(Zt(),Er(),p())},1,!ie),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let se=ye.querySelector(".btn-buy-max");se&&se.remove();let te=ye.querySelector(".btn-buy-cheap");te&&te.remove()}else{Se("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:I}=o.buyMax(e.id);(I instanceof c?I:c.fromAny(I??0)).isZero?.()||(Zt(),Er(),p())},2,!ie);let te=[1,3,4,5,6].includes(xd(m.upg));if(!l&&!te)Se("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let Y=o.buyCheap;if(!Y)return;let{bought:z}=Y(e.id);(z instanceof c?z:c.fromAny(z??0)).isZero?.()||(Zt(),Er(),p())},3,!ie);else{let Ie=ye.querySelector(".btn-buy-cheap");Ie&&Ie.remove()}}if(l)Se("shop-delve btn-buy-next","Buy Next",()=>{let te=o.getUiModel(e.id);if(te.hmReadyToEvolve)return;let Ie=te.hmNextMilestone;if(!Ie||!te.lvlBn||Ie.cmp(te.lvlBn)<=0){let{bought:be}=o.buyMax(e.id);if((be instanceof c?be:c.fromAny(be??0)).isZero?.())return;Zt(),Er(),p();return}let I=0;try{let be=Ie.sub(te.lvlBn).toPlainIntegerString?.();I=Math.max(0,Math.floor(Number(be&&be!=="Infinity"?be:Ie.sub(te.lvlBn).toString())))}catch{}let Y=O[te.upg.costType]?.value,z=Y instanceof c?Y:c.fromAny(Y??0),ge=ri(te.upg,te.lvlBn,z,I).count,ae=!1;try{let be=ge?.toPlainIntegerString?.();ae=be&&be!=="Infinity"?Number(be)>=I:Number(ge??0)>=I}catch{}let qe=ae?o.buyNext(e.id,I):o.buyMax(e.id);(qe.bought instanceof c?qe.bought:c.fromAny(qe.bought??0)).isZero?.()||(Zt(),Er(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let se=ye.querySelector(".btn-buy-next");se&&se.remove()}}},g=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,g)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",g),p(),Jt.classList.add("is-open"),Jt.classList.toggle("is-automation-upgrade",t==="automation"),Jt.style.pointerEvents="auto",xn(140),it.style.transition="none",it.style.transform="translateY(100%)",it.offsetHeight,requestAnimationFrame(()=>{it.style.transition="",it.style.transform=""}),Lc=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,g)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",g)}}function td(e,t,n,o){let r=null;function i(d){if(!n())return;let f=typeof d.clientY=="number"?d.clientY:d.touches?.[0]?.clientY||0;r={startY:f,lastY:f,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(d){if(!r||r.canceled)return;let f=d.clientY;if(typeof f!="number")return;let p=Math.max(0,f-r.startY);r.lastY=f,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let d=Math.max(1,performance.now()-r.startT),f=r.moved;f/d>.55&&f>40||f>140?(vo(100),xn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",d=>d.preventDefault(),{passive:!1})}var Fg,OI,PI,BI,Ug,FI,UI,DI,$g,$I,qI,Vg,Yg,HI,qg,Cc,Mc,Jt,it,Tc,Lc,jr=De(()=>{bt();Lt();zt();Io();bc();Pl();Rn();cn();$i();Yr();wc();Fg={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp"},OI="img/misc/locked_base.webp",PI="img/misc/maxed.webp",BI="img/misc/green_border.webp",Ug={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp"},FI=7,UI={coins:da,books:pa,gold:ma,magic:ha};DI={coins:da,books:pa,gold:ma,magic:ha};$g={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Dg(qn()),getUiModel:e=>Ua(qn(),e),buyOne:e=>Ba(qn(),e),buyMax:e=>kc(qn(),e),buyCheap:e=>_d(qn(),e),buyNext:(e,t)=>Fa(qn(),e,t),getLockState:e=>Ho(qn(),e),evolve:e=>Ld(qn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",hd,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Dg(Ke),getUiModel:e=>Ua(Ke,e),buyOne:e=>Ba(Ke,e),buyMax:e=>kc(Ke,e),buyNext:(e,t)=>Fa(Ke,e,t),getLockState:e=>Ho(Ke,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof v=="function"?v():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||Er(!0)});$I="sounds/purchase_upg.ogg",qI="sounds/evolve_upg.ogg",Vg=.12,Yg=.3;HI="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",qg="ccc-scroll-timeline-styles";Cc=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return Xg(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!Eg(),o=v();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let W=document.createElement("div");W.className="shop-tile";let ce=document.createElement("img");ce.className="base",ce.alt="";let me=document.createElement("img");me.className="icon",me.alt="",me.addEventListener("error",()=>{me.src=HI}),W.appendChild(ce),W.appendChild(me),i.appendChild(W),t.appendChild(i),i.addEventListener("click",Z=>{let re=Z.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){Z.preventDefault(),Z.stopImmediatePropagation();return}if(Qn(re)){Z.preventDefault(),Z.stopImmediatePropagation();return}if(Z.shiftKey||Z.ctrlKey){if(Z.preventDefault(),Z.stopImmediatePropagation(),!re.upgMeta)return;let ye=re.upgMeta.id,Le=re.upgMeta.upgType==="HM",ie=[1,3,4,5,6].includes(xd(re.upgMeta));if(Z.shiftKey){if(!ie&&this.adapter.buyCheap){let{bought:_e}=this.adapter.buyCheap(ye);(_e instanceof c?_e:c.fromAny(_e??0)).isZero?.()||(Zt(),this.update());return}let{bought:Se}=this.adapter.buyMax(ye);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Zt(),xc(re.upgMeta,this.mode))try{Oa(["reset"])}catch{}this.update()}return}if(Z.ctrlKey){if(Le){let _e=this.adapter.getUiModel(ye);if(_e&&!_e.hmReadyToEvolve){let Re=_e.hmNextMilestone;if(Re&&_e.lvlBn&&Re.cmp(_e.lvlBn)>0){let se=0;try{let oe=Re.sub(_e.lvlBn).toPlainIntegerString?.();se=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Re.sub(_e.lvlBn).toString())))}catch{}let te=O[_e.upg.costType]?.value,Ie=te instanceof c?te:c.fromAny(te??0),Y=ri(_e.upg,_e.lvlBn,Ie,se).count,z=!1;try{let oe=Y?.toPlainIntegerString?.();z=oe&&oe!=="Infinity"?Number(oe)>=se:Number(Y??0)>=se}catch{}if(z){let oe=this.adapter.buyNext(ye,se);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(Zt(),this.update());return}}}}let{bought:Se}=this.adapter.buyMax(ye);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Zt(),xc(re.upgMeta,this.mode))try{Oa(["reset"])}catch{}this.update()}return}}re.upgMeta&&zI(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",Z=>{if(je)return;let re=Z.currentTarget;if(re.dataset.locked==="1"||(Z.preventDefault(),Z.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:Se}=this.adapter.evolve(re.upgMeta.id);Se&&(Wg(),this.update());return}let{bought:Le}=this.adapter.buyMax(re.upgMeta.id);if(!(Le instanceof c?Le:c.fromAny(Le??0)).isZero?.()){if(Zt(),xc(re.upgMeta,this.mode))try{Oa(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),d=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",d),i.disabled=d,d?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=d?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let g=s?c.fromInt(0):VI(r.meta,r.levelNumeric,r.level),m=g instanceof c?g:c.fromAny(g),y=J(r.level),h=_c(y),b=J(m),w=_c(b),L=!m.isZero?.(),R=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,k=Number.isFinite(R)?Math.max(0,Math.floor(R)):1/0,F=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,U=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(k)&&Number.isFinite(F)?F>=k:!1,q=Number.isFinite(k)&&k===1,x=!!r.meta?.unlockUpgrade,P=!s&&x&&!U,M=!s&&x&&!P&&U,_,X,Q=!1,pe=!1;if(s){_="",X="";let W=u?(r.lockState?.reason||"").trim():"",ce=W?`${r.title} (Locked, ${W})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ce)}else{if(P||M)_=P?"Unlockable":"Unlocked",X=_,pe=!0;else if(!s&&q&&!x)U?(_="Owned",X="Owned"):L?(_="Purchasable",X="Purchasable"):(_="Not Owned",X="Not Owned"),pe=!0;else{let W=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ce=String(h||"").replace(/,/g,""),me=/|Infinity/i.test(ce),Z=Number.isFinite(W)?W>=1e3:me||/^\d{4,}$/.test(ce);Q=L&&Z,Q?(_=`<span class="badge-lvl">${y}</span><span class="badge-plus">(+${b})</span>`,X=`${h} (+${w})`):(_=L?`${y} (+${b})`:y,X=L?`${h} (+${w})`:h)}i.setAttribute("aria-label",`${r.title}, ${X}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let K=i.firstElementChild,ne=K.querySelector(".base"),ve=K.querySelector(".icon"),he=r.meta?.costType||"coins",ee=r.useLockedBase||s?OI:r.baseIconOverride||Fg[he]||Fg.coins;ne.src!==ee&&(ne.src=ee);let $=r.icon;if(!$)ve.hidden||(ve.hidden=!0);else{ve.hidden&&(ve.hidden=!1);let W=$;ve._lastSrc!==W&&(ve.src=W,ve._lastSrc=W)}let G=K.querySelector(".maxed-overlay"),j=!s&&Hg(r.meta),le=!s&&U;if(le||!s&&!U&&!p&&j){G||(G=document.createElement("img"),G.className="maxed-overlay",G.alt="",K.insertBefore(G,ve));let W=le?PI:BI;G.src!==W&&(G.src=W)}else G&&G.remove();let C=K.querySelector(".level-badge");s?C&&C.remove():(C||(C=document.createElement("span"),C.className="level-badge",K.appendChild(C)),C.className="level-badge",pe&&C.classList.add("text-badge"),Q&&C.classList.add("two-line"),(L||P)&&C.classList.add("can-buy"),U&&C.classList.add("is-maxed"),_===X?C.textContent!==_&&(C.textContent=_):C.innerHTML!==_&&(C.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),ts(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&Qn(a)||(Ir(),Tg())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{je&&xn(80),this.close()},{passive:!0}),td(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=v();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&Og(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,je)try{setTimeout(()=>vo(240),120)}catch{}xn(10),ts(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},Mc={standard:new Cc("standard"),automation:new Cc("automation")};Jt=null,it=null,Tc=!1,Lc=null});var Jg={};vt(Jg,{applyHudLayout:()=>Xo,initHudButtons:()=>jI,isMapUnlocked:()=>kd,isShopUnlocked:()=>Td,lockMap:()=>Pc,lockShop:()=>Oc,unlockMap:()=>Rc,unlockShop:()=>ii});function Md(e){let t=v();return t==null?e:`${e}:${t}`}function fs(e){let t=Md(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function Td(){return Ad(),fs(so.SHOP)}function kd(){return Ad(),fs(so.MAP)}function Nc(e,t){let n=t?"1":"0",o=Md(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:v()}}))}catch{}}function Ad(){for(let e of Object.values(so)){let t=Md(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function xo(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function Cd(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",ki())}function KI(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function Xo(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=KI(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(g=>e.querySelector(`.game-btn[data-btn="${g}"]`)).filter(Boolean),a=[...e.children].filter(g=>!l.includes(g)),u=[...l,...a];if(u.length&&u.some((g,m)=>e.children[m]!==g)){let g=document.createDocumentFragment();u.forEach(m=>g.appendChild(m)),e.appendChild(g)}let p=[...e.querySelectorAll(".game-btn")].filter(g=>!g.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(g=>{g.style.gridColumn="",g.style.gridRow="",g.classList.remove("span-2"),g.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let g=getComputedStyle(e),m=parseFloat(g.columnGap||g.gap||"0")||0,y=e.clientWidth,h=Math.max(180,Math.floor((y-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${h}px ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let g=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),y=e.querySelector('[data-btn="shop"]:not([hidden])');g&&m&&y&&(g.style.gridColumn="1",g.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",y.style.gridColumn="1 / -1",y.style.gridRow="2")}}function jI(){if(Ad(),xo("help",!0),xo("stats",!0),xo("shop",fs(so.SHOP)),xo("map",fs(so.MAP)),Cd(),Xo(),jg||(jg=!0,window.addEventListener("resize",Xo),window.addEventListener("orientationchange",Xo),window.addEventListener("saveSlot:change",()=>{xo("shop",fs(so.SHOP)),xo("map",fs(so.MAP)),Cd(),Xo()}),window.addEventListener("saveSlot:modified",e=>{let t=v(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||Cd()})),!Zg){Zg=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&Ql()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&Qn(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function ii(){Nc(so.SHOP,!0),xo("shop",!0),Xo()}function Rc(){Nc(so.MAP,!0),xo("map",!0),Xo()}function Oc(){Nc(so.SHOP,!1),xo("shop",!1),Xo()}function Pc(){Nc(so.MAP,!1),xo("map",!1),Xo()}var so,jg,Zg,Bc=De(()=>{jr();bt();$i();so={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};jg=!1,Zg=!1});function Qg(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(W=>W.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,d=4,f=new Float32Array(t*d);for(let C=0;C<t;C++)f[C*d+2]=1/0;let p=new Int16Array(t),g=t;for(let C=0;C<t;C++)p[C]=t-1-C;let m=-1,y=document.createElement("canvas");y.className="cursor-trail-canvas",Object.assign(y.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(y);let h=y.getContext("2d",{alpha:!0,desynchronized:!0}),b=document.createElement("canvas");b.width=a,b.height=a;let w=b.getContext("2d");w.shadowColor="#FFEB3B",w.shadowBlur=l,w.fillStyle="#FFEB3B",w.beginPath(),w.arc(u,u,s,0,Math.PI*2),w.fill();let L=!1,R=null,k=null,F={left:0,top:0,width:0,height:0},U=1,q=!1,x=0,P=0,M=!1,_=null,X=[],Q=()=>{if(q)return;let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;F={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}},pe=()=>{if(q)return;Q();let C=Math.min(window.devicePixelRatio||1,2);U=F.width>0?Math.min(C,512/F.width):C,y.width=F.width*U,y.height=F.height*U,h.scale(U,U),_=null},K=null;typeof ResizeObserver<"u"&&(K=new ResizeObserver(()=>{pe()}),K.observe(e));let ne=(C,W)=>{if(g<=0)return;let ce=p[--g];ce>m&&(m=ce);let me=ce*d;f[me]=C,f[me+1]=W,f[me+2]=0,f[me+3]=n},ve=(C,W,ce)=>{if(R===null||k===null)ce.count<r&&(ne(C,W),ce.count++);else{let me=C-R,Z=W-k,re=Math.hypot(me,Z);if(re>=o){let ye=Math.floor(re/o);for(let Le=1;Le<=ye&&!(ce.count>=r);Le++){let ie=Le*o/re;ne(R+me*ie,k+Z*ie),ce.count++}}ce.count<r&&(ne(C,W),ce.count++)}R=C,k=W},he=C=>{if(q)return;x||(P=0,x=requestAnimationFrame(ee)),F.width||Q();let W=0,ce=0,me=(Z,re)=>Z>=0&&Z<=F.width&&re>=0&&re<=F.height;if(C.getCoalescedEvents){let Z=C.getCoalescedEvents();if(Z.length>0)for(let re of Z){let ye=re.clientX-W,Le=re.clientY-ce;X.push({x:ye,y:Le,inside:me(ye,Le)})}else{let re=C.clientX-W,ye=C.clientY-ce;X.push({x:re,y:ye,inside:me(re,ye)})}}else{let Z=C.clientX-W,re=C.clientY-ce;X.push({x:Z,y:re,inside:me(Z,re)})}},V=()=>{L=!1,R=null,k=null,X.length=0},ee=()=>{if(q)return;let C=performance.now();P||(P=C);let W=C-P;P=C,W>100&&(W=100);let ce={count:0};if(X.length>0){for(let Ne of X)Ne.inside?(L=!0,ve(Ne.x,Ne.y,ce)):(L=!1,R=null,k=null);let Se=X[X.length-1];Se.inside&&(R!==Se.x||k!==Se.y)&&(ne(Se.x,Se.y),R=Se.x,k=Se.y),X.length=0}else L&&R!==null&&k!==null&&ne(R,k);let me=t-g;if(me===0&&!M){x=0;return}_?h.clearRect(_.x,_.y,_.w,_.h):h.clearRect(0,0,F.width,F.height),M=!1;let Z=1/0,re=1/0,ye=-1/0,Le=-1/0,ie=-1;if(me>0)for(let Se=0;Se<=m;Se++){let Ne=Se*d,_e=f[Ne+2];if(_e>=f[Ne+3])continue;if(_e+=W,f[Ne+2]=_e,_e>=f[Ne+3]){p[g++]=Se;continue}ie=Se;let Re=f[Ne+3],se=_e/Re,te=1-se,Ie=1-.4*se;M=!0,h.globalAlpha=te;let I=a*Ie,Y=I/2,z=f[Ne],oe=f[Ne+1],ge=Math.round(z-Y),ae=Math.round(oe-Y),qe=Math.round(I);h.drawImage(b,ge,ae,qe,qe),ge<Z&&(Z=ge),ae<re&&(re=ae);let tt=ge+qe,be=ae+qe;tt>ye&&(ye=tt),be>Le&&(Le=be)}m=ie,Z!==1/0?(Z-=2,re-=2,ye+=2,Le+=2,_={x:Z,y:re,w:ye-Z,h:Le-re}):_=null,x=requestAnimationFrame(ee)};window.addEventListener("resize",pe),window.addEventListener("scroll",Q,{passive:!0}),window.addEventListener("focus",Q,{passive:!0}),document.addEventListener("visibilitychange",Q,{passive:!0});let $={passive:!0},G=C=>{Q(),he(C)},j=C=>{Q(),he(C)};e.addEventListener("pointermove",he,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",G,$),e.addEventListener("pointerleave",V,$),e.addEventListener("pointercancel",V,$),pe(),x=requestAnimationFrame(ee);let le=setInterval(Q,1e3);return{destroy:()=>{q=!0,x&&cancelAnimationFrame(x),le&&clearInterval(le),K&&(K.disconnect(),K=null);try{window.removeEventListener("resize",pe)}catch{}try{window.removeEventListener("scroll",Q)}catch{}try{window.removeEventListener("focus",Q)}catch{}try{document.removeEventListener("visibilitychange",Q)}catch{}try{e.removeEventListener("pointermove",he),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",G),e.removeEventListener("pointerleave",V),e.removeEventListener("pointercancel",V)}catch{}y.remove()}}}var ey=De(()=>{});var fy={};vt(fy,{clearPendingGains:()=>qd,getPassiveCoinReward:()=>cc,initCoinPickup:()=>iw,setCoinMultiplier:()=>ew,triggerPassiveCollect:()=>wd});function ty(e){if(!e||typeof e!="object"){$a=!1,Fc=!1,Uc="0",li.clear();return}$a=!!e.unlocked,Fc=!!e.level?.isInfinite?.();try{Uc=e.level?.toPlainIntegerString?.()??"0"}catch{Uc="0"}$a?Fc&&li.clear():li.clear()}function ZI(){if(typeof si=="function")try{si()}catch{}try{ty(lt())}catch{$a=!1,li.clear()}try{si=ci(e=>{ty(e)})}catch{si=null}}function ew(e){QI=e;try{O.coins?.mult?.set&&O.coins.mult.set(e)}catch{}}function Pd(){try{let e=$c();e instanceof c?ps=e.clone?.()??e:e!=null?ps=c.fromAny(e):ps=c.fromInt(1)}catch{ps=c.fromInt(1)}}function tw(){ny||(ny=!0,Pd(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",Pd),typeof window<"u"&&window.addEventListener("saveSlot:change",Pd))}function nw(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Dd.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function Ud(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*ow:0}function rw({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,d=0,f=0,p=0,g=null,m=null,y=Ud(),h=0,b=0,w=0,L=!1,R=null,k=null,F=()=>{if(L)return;let $=document.documentElement.clientWidth,G=document.documentElement.clientHeight;R={left:0,top:0,width:$,height:G,right:$,bottom:G,x:0,y:0}},U=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",g=null,m=null},q=()=>{if(!l||b<=0){U();return}let $=b*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${f-b}px, ${p-b}px, 0)`,s.classList.add("is-visible")},x=()=>{if(!(!l||b<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=b+Bd,G=[];if(typeof i.findCoinTargetsInPath=="function"&&g!==null&&m!==null?G=i.findCoinTargetsInPath(g,m,f,p,$):G=i.findCoinTargetsInRadius(f,p,$),g=f,m=p,G&&G.length>0)if(typeof r=="function"){let j=[];for(let le=0;le<G.length;le++){let ue=G[le],C={coin:ue};ue.el&&i.getCoinTransform&&(C.opts={transform:i.getCoinTransform(ue.el)}),j.push(C)}r(j)}else for(let j=0;j<G.length;j++){let le=G[j],ue=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(ue){let C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform||"";o(ue,{transform:C})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=b+Bd,G=i.findCoinsInRadius(f,p,$);if(g=f,m=p,G&&G.length>0){let j=[];for(let le=0;le<G.length;le++){let ue=G[le],C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform;j.push({el:ue,opts:{transform:C}})}typeof r=="function"&&r(j)}}else{let $=t.children,G=b+Bd,j=[];for(let le=$.length-1;le>=0;le--){let ue=$[le];if(ue.dataset.collected==="1"||!ue.matches(n))continue;let C=ue.getBoundingClientRect(),W=C.left+C.width/2,ce=C.top+C.height/2,me=W-u,Z=ce-d;Math.hypot(me,Z)<=G&&j.push(ue)}if(!j.length)return;if(typeof r=="function"){let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push({el:C,opts:{transform:W.transform}})}r(le)}else{let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push(W.transform)}for(let ue=0;ue<j.length;ue++)o(j[ue],{transform:le[ue]})}}},P=()=>{w=0,q(),!(!l||b<=0||L)&&(x(),M())},M=()=>{!l||b<=0||w||L||(w=requestAnimationFrame(P))},_=$=>{if(!$||L||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,d=$.clientY,R||F();let G=R;f=u,p=d,l=f>=0&&f<=G.width&&p>=0&&p<=G.height,M()},X=()=>{l=!1,U(),g=null,m=null},Q=()=>{g=null,m=null},pe=()=>{h=qc(),b=h*y,q(),M()},K=()=>{if(!(L||!a)){if(F(),R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()}},ne=()=>{if(y=Ud(),b=h*y,F(),a&&R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()},ve=$=>{F(),_($)},he=$=>{Q(),ve($)},V=()=>{L=!0,w&&(cancelAnimationFrame(w),w=0),k&&clearInterval(k);try{window.removeEventListener("scroll",K)}catch{}try{window.removeEventListener("resize",ne)}catch{}try{window.removeEventListener("saveSlot:change",pe)}catch{}try{document.removeEventListener("ccc:upgrades:changed",pe)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",ve)}catch{}try{e.removeEventListener("pointerenter",he)}catch{}try{e.removeEventListener("pointerleave",X)}catch{}try{e.removeEventListener("pointercancel",X)}catch{}try{window.removeEventListener("blur",Q)}catch{}try{s.remove()}catch{}},ee={passive:!0};return e.addEventListener("pointermove",_,ee),e.addEventListener("pointerdown",ve,ee),e.addEventListener("pointerenter",he,ee),e.addEventListener("pointerleave",X,ee),e.addEventListener("pointercancel",X,ee),window.addEventListener("resize",ne),window.addEventListener("scroll",K,{passive:!0}),window.addEventListener("focus",F,{passive:!0}),window.addEventListener("blur",Q,{passive:!0}),document.addEventListener("visibilitychange",()=>{F(),document.hidden&&Q()},{passive:!0}),window.addEventListener("saveSlot:change",pe),document.addEventListener("ccc:upgrades:changed",pe),k=setInterval(F,1e3),pe(),{destroy:V}}function qd(){qa=null,Ga=null,Ha=null}function uy(e){let t=Dd.clone?.()??c.fromInt(1),n=ly(t),o=ao(oy),i=cy(e??Uc);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Lo=="function"&&Lo()?ao(ps):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function cc(){let{coinGain:e,xpGain:t,mpGain:n}=uy(null);return{coins:e,xp:t,mp:n}}function wd(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=uy(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=On(Me.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{_n=_n?.add?_n.add(r):ao(r)}catch{_n=ao(r)}Da(),a||ry(r);let u=typeof ln=="function"?ln():!0,d=typeof i?.isZero=="function"?i.isZero():!1;u&&!d&&iy(i),s.isZero?.()||sy(s)}function iw({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){Nd?.destroy&&Nd.destroy();let a=document.querySelector(t),u=document.querySelector(n),d=document.querySelector(o);if(!a||!u||!d)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!d}),{destroy(){}};ZI(),tw(),a.style.touchAction="none";let f=null,p=null;_n=O.coins.value,Fd=()=>{let C=J(_n);C.includes("<span")?d.innerHTML=C:d.textContent=C},ay(),Da();let g=C=>{C?.detail&&C.detail.key==="coins"&&(_n=C.detail.value,Da())};window.addEventListener("currency:change",g);let m=C=>{if(!(!C?.detail||C.detail.key!=="coins"))try{let{mult:W}=C.detail;W instanceof c?Gn=W.clone?.()??W:W!=null?Gn=c.fromAny(W):Gn=c.fromInt(1),ai=!!Gn?.isInfinite?.()}catch{Gn=null,ai=!1}};window.addEventListener("currency:multiplier",m);let y=v();if(y==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let h=`ccc:unlock:shop:${y}`,b=`ccc:unlock:shop:progress:${y}`,w=localStorage.getItem("ccc:unlock:shop:progress"),L=localStorage.getItem("ccc:unlock:shop");w!=null&&localStorage.getItem(b)==null&&localStorage.setItem(b,w),L!=null&&localStorage.getItem(h)==null&&localStorage.setItem(h,L),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let C=parseInt(localStorage.getItem(b)||"0",10);if(localStorage.setItem(b,String(C)),C>=10&&localStorage.getItem(h)!=="1"){try{ii()}catch{}localStorage.setItem(h,"1")}}let R=new URL(i,document.baseURI).href,k=C=>C instanceof HTMLElement?C._coinObj?!C._coinObj.isRemoved&&C.dataset.collected!=="1":C.dataset.collected!=="1"&&C.matches(r):!1;function F(C){try{C.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(F);let U=je?.12:.3,q=0;function x(C=R){if(C===R){let W=performance.now();if(W-q<40)return;q=W}dt(C,{volume:U})}function P(C,W={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(C);let ce=()=>{C&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(C):C.remove())};if(l||je){ce();return}let me="translate3d(0,0,0)";W.transform?W.transform!=="none"&&(me=W.transform):me=C.style.transform||"translate3d(0,0,0)",C.style.setProperty("--ccc-start",me),C.classList.add("coin--collected");let Z=!1,re=()=>{Z||(Z=!0,C.removeEventListener("animationend",re),ce())};C.addEventListener("animationend",re),setTimeout(re,600)}function M(C){if(!C||!C.length)return;let W=R,ce=-1,me=!1;for(let se of C){let te=se.coin||se.el&&se.el._coinObj;te&&(te.sizeIndex!==void 0?te.sizeIndex>ce&&(ce=te.sizeIndex,te.soundSrc&&(W=te.soundSrc,me=!0)):te.soundSrc&&!me&&(W=te.soundSrc,me=!0))}x(W);let Z=null,re=null,ye=null,Le=0,ie=On(Me.COINS),Se=typeof ln=="function"?ln():!0,Ne=typeof Lo=="function"&&Lo(),_e=15,Re=0;for(let se of C){let te=se.el,Ie=se.coin;if(!Ie&&te&&te._coinObj&&(Ie=te._coinObj),te&&!k(te)||Ie&&Ie.isRemoved)continue;Le++,te&&(te.dataset.collected="1"),Re<_e?(!te&&Ie&&e&&e.ensureCoinVisual&&(te=e.ensureCoinVisual(Ie),te&&(te.dataset.collected="1")),te?(P(te,se.opts||{}),Re++):Ie&&e&&e.removeCoinTarget&&e.removeCoinTarget(Ie)):Ie&&e&&e.removeCoinTarget?e.removeCoinTarget(Ie):te&&(e&&e.detachCoin&&e.detachCoin(te),e&&e.recycleCoin?e.recycleCoin(te):te.remove());let I=te?nw(te):Dd,Y=Ie?.mutationLevel??(te?.dataset?.mutationLevel||null),z=ly(I),oe=ao(oy),ge=ao(ps);if(Ie&&Ie.valueMultiplier&&Ie.valueMultiplier>1){try{z=z.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{ge=ge.mulDecimalFloor(Ie.valueMultiplier)}catch{}}let ae=cy(Y);if(ae){try{z=z.mulBigNumInteger(ae)}catch{}try{oe=oe.mulBigNumInteger(ae)}catch{}}ie||(Z=ms(Z,z)),Se&&(re=ms(re,oe)),Ne&&(ye=ms(ye,ge))}if(Le!==0){if(Z&&!Z.isZero?.()){try{_n=_n?.add?_n.add(Z):ao(Z)}catch{_n=ao(Z)}ry(Z),Da()}if(re&&!re.isZero?.()&&iy(re),ye&&!ye.isZero?.()&&sy(ye),localStorage.getItem(h)!=="1"){let te=parseInt(localStorage.getItem(b)||"0",10)+Le;if(localStorage.setItem(b,String(te)),te>=10){try{ii()}catch{}localStorage.setItem(h,"1")}}}}function _(C,W={}){return M([{el:C,opts:W}]),!0}f=rw({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:M,spawner:e}),p=Qg(a);let X=C=>{if(C.target===u)return;let W=C.target.closest(r);if(W&&k(W)){let ce={};e&&typeof e.getCoinTransform=="function"&&(ce.transform=e.getCoinTransform(W)),_(W,ce)}};u.addEventListener("pointerdown",X,{passive:!0}),je||u.addEventListener("mouseover",X,{passive:!0});let Q=25,pe=null,K=()=>{let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;pe={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}};window.addEventListener("resize",K),window.addEventListener("scroll",K,{passive:!0}),K();let ne=null,ve=null,he=()=>{ne=null,ve=null};a.addEventListener("pointerleave",he,{passive:!0}),a.addEventListener("pointerenter",he,{passive:!0}),window.addEventListener("blur",he,{passive:!0});function V(C,W){if(e&&typeof e.findCoinTargetsInRadius=="function"){pe||K();let ce=C,me=W,Z=[];if(typeof e.findCoinTargetsInPath=="function"&&ne!==null&&ve!==null?Z=e.findCoinTargetsInPath(ne,ve,ce,me,Q,!0):Z=e.findCoinTargetsInRadius(ce,me,Q,!0),ne=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye=0;ye<Z.length;ye++){let Le=Z[ye],ie={coin:Le};Le.el&&e.getCoinTransform&&(ie.opts={transform:e.getCoinTransform(Le.el)}),re.push(ie)}M(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){pe||K();let ce=C,me=W,Z=e.findCoinsInRadius(ce,me,Q);if(ne=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye of Z){let Le=e.getCoinTransform?e.getCoinTransform(ye):ye.style.transform;re.push({el:ye,opts:{transform:Le}})}M(re)}}else{let ce=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],me=new Set;for(let Z=0;Z<ce.length;Z++){let re=C+ce[Z][0],ye=W+ce[Z][1],Le=document.elementsFromPoint(re,ye);for(let ie=0;ie<Le.length;ie++){let Se=Le[ie];k(Se)&&!me.has(Se)&&me.add(Se)}}if(me.size>0){let Z=[];me.forEach(re=>Z.push({el:re})),M(Z)}}}let ee=null,$=!1;function G(C,W){ee={x:C,y:W},$||($=!0,requestAnimationFrame(()=>{ee&&(V(ee.x,ee.y),ee=null),$=!1}))}a.addEventListener("pointerdown",C=>{G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointermove",C=>{C.pointerType!=="mouse"&&G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointerup",C=>{C.pointerType!=="mouse"&&G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("mousemove",C=>{G(C.clientX,C.clientY)},{passive:!0});function j(C){}let le=setInterval(K,1e3),ue=()=>{if(clearInterval(le),Dc(),Fd=()=>{},typeof window<"u"&&(window.removeEventListener("resize",K),window.removeEventListener("beforeunload",Dc),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",g),window.removeEventListener("blur",he)),typeof si=="function"){try{si()}catch{}si=null}if(f?.destroy){try{f.destroy()}catch{}f=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",X),je||u.removeEventListener("mouseover",X)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(C=>a.replaceWith(a.cloneNode(!0)))}catch{}};return Nd={destroy:ue},{get count(){return _n},set count(C){_n=c.fromAny?c.fromAny(C):c.fromInt(Number(C)||0),Da()},setMobileVolume:j,destroy:ue,collectBatch:M,getMagnetUnitPx:Ud}}var $a,Fc,Uc,si,Nd,oy,Dd,JI,ds,li,QI,ps,ny,qa,Ga,Ha,Rd,_n,Fd,Od,Da,ow,Bd,ao,ms,Dc,$d,ry,iy,sy,Gn,ai,ay,ly,cy,Ta=De(()=>{bt();Lt();zt();Bc();Dn();Io();wo();cn();ey();Rn();$a=!1,Fc=!1,Uc="0",si=null;Nd=null,oy=c.fromInt(1),Dd=c.fromInt(1),JI=c.fromInt(1);try{ds=c.fromAny("Infinity")}catch{ds=null}li=new Map,QI="1",ps=c.fromInt(1),ny=!1,qa=null,Ga=null,Ha=null,Rd=!1,_n=null,Fd=()=>{},Od=!1,Da=()=>{Od||(Od=!0,requestAnimationFrame(()=>{Od=!1,Fd()}))};ow=.05,Bd=8;ao=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},ms=(e,t)=>{if(!t)return e;if(!e)return ao(t);try{return e.add(t)}catch{try{return ao(e).add(t)}catch{return ao(t)}}},Dc=()=>{let e=qa;if(qa=null,e&&!e.isZero?.())try{O.coins.add(e)}catch{}let t=Ga;if(Ga=null,t&&!t.isZero?.())try{Fi(t)}catch{}let n=Ha;if(Ha=null,n&&!n.isZero?.())try{os(n)}catch{}},$d=()=>{Rd||(Rd=!0,requestAnimationFrame(()=>{Rd=!1,Dc()}))},ry=e=>{qa=ms(qa,e),$d()},iy=e=>{Ga=ms(Ga,e),$d()},sy=e=>{Ha=ms(Ha,e),$d()};typeof window<"u"&&window.addEventListener("beforeunload",Dc,{passive:!0});Gn=null,ai=!1,ay=()=>{try{let e=O?.coins?.mult;if(!e||typeof e.get!="function"){Gn=null,ai=!1;return}let t=e.get();if(!t){Gn=c.fromInt(1),ai=!1;return}Gn=t.clone?.()??c.fromAny(t),ai=!!Gn?.isInfinite?.()}catch{Gn=null,ai=!1}},ly=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Gn||ay();let n=Gn;if(!n)try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(ai||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},cy=e=>{if(!$a)return null;if(Fc){if(ds)try{return ds.clone?.()??ds}catch{return ds}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=li.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{li.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=hs(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(JI)===0,s=r.clone?.()??r;if(li.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function py(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let i=Number(e.toString());isNaN(i)||(t=i),(e==="Infinity"||i===1/0)&&(n=!0)}catch{}let o=[],r=[];for(let i of dy){let s=i;if(n){s={...i,description:[...i.description]};let l=Bt(),a=bn(),u=l+a;if(u>1&&(u=1),i.id===1){let d=Math.pow(10,u),f=J(c.fromAny(d));Math.abs(d-Math.round(d))>.001?(f=d.toFixed(2),f.endsWith(".00")&&(f=f.slice(0,-3))):d<1e3&&(f=String(Math.round(d))),s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===2){let d=Math.pow(10,u),f=J(c.fromAny(d));Math.abs(d-Math.round(d))>.001?(f=d.toFixed(2),f.endsWith(".00")&&(f=f.slice(0,-3))):d<1e3&&(f=String(Math.round(d))),s.description[1]=s.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===4){let d=Math.log10(4444e9),f=Ae(d*u),p=J(f);s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${p}x</span>`)}}i.surgeLevel<=t?o.push(s):r.push(s)}return[...o,...r.slice(0,2)]}var dy,Gd,my=De(()=>{zt();Lt();cn();ro();Qr();dy=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${J(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]}],Gd=dy.filter(e=>e.affectedByTsunami).map(e=>e.id)});function hy(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=dt("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function d(I,Y){I.style.position="absolute",I.style.left="50%";let z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ge=!!o.mpHTML;Y==="coin"?(I.style.top="77%",I.style.transform=`translateX(-50%) ${z}`):oe&&ge?(I.style.top="72.5%",Y==="mp"?I.style.transform=`translateX(calc(-100% - 44px)) ${z}`:I.style.transform=`translateX(44px) ${z}`):(Y==="mp"?I.style.top="66%":Y==="xp"&&(I.style.top="72%"),I.style.transform=`translateX(-50%) ${z}`),I.style.transformOrigin="center center";let ae=I.firstElementChild;ae&&(ae.removeAttribute("hidden"),ae.style.display="flex")}if(o.coinHTML){let I=document.createElement("div");I.innerHTML=o.coinHTML,d(I,"coin"),u.appendChild(I)}if(o.xpHTML){let I=document.createElement("div");I.innerHTML=o.xpHTML,d(I,"xp"),u.appendChild(I)}if(o.mpHTML){let I=document.createElement("div");I.innerHTML=o.mpHTML,d(I,"mp"),u.appendChild(I)}e.appendChild(u);let f=document.createElement("canvas");f.id="tsunami-fg-canvas",f.style.position="absolute",f.style.inset="0",f.style.width="100%",f.style.height="100%",f.style.zIndex="2147483646",f.style.pointerEvents="none",e.appendChild(f);let p=new Image;p.src="img/misc/merchant.webp";let g=!1;p.onload=()=>{g=!0},p.onerror=I=>{console.error("Tsunami: Merchant load failed",I)};let m,y,h=[],b=[],w=0;function L(){h=[],b=[];let I=y*.65,Y=I+y*.15,oe=300*(Math.min(m,y)*5e-4),ge=m*.8,ae=ge-oe*.6,qe=ge+oe*.6;for(let st=0;st<100;st++){let on=Math.random()*m,kt=Y+Math.random()*(y-Y);b.push({x:on,y:kt})}let tt=(st,on,kt)=>{if(st>m*.1&&st<m*.9){let mn=y-I,mo=I+mn*.15;if(on>mo)return!1}else if(kt==="tree"){let mn=y-I,mo=I+mn*.5;if(on>mo)return!1}return!(kt==="tree"&&st>ae&&st<qe)},be=(st,on,kt,mn,mo)=>{for(let tr=0;tr<on;tr++){let Mo,To,nr=!1,S=0;for(;!nr&&S<50;){mo?Mo=mo():Mo=Math.random()*m;let T=y,B=Math.random();if(To=I+20+B*B*(T-I-20),tt(Mo,To,st)&&(nr=!0,st==="tree")){for(let A of h)if(A.type==="tree"){let N=A.x-Mo,de=A.y-To;if(Math.sqrt(N*N+de*de)<Math.max(m*.08,100)){nr=!1;break}}}S++}if(nr){let B=.6+(To-I)/(y-I)*.6,A=(kt+Math.random()*mn)*B;h.push({type:st,x:Mo,y:To,scale:A})}}},Be=3+Math.floor(Math.random()*3);be("tree",Be,.8,.4,()=>Math.random()*(m*.1)),be("tree",Be,.8,.4,()=>m*.9+Math.random()*(m*.1));let Gt=5+Math.floor(Math.random()*3);be("tree",Gt,.8,.4,()=>m*.1+Math.random()*(m*.8)),be("rock",20,.6,.4),be("shell",30,.3,.3),h.sort((st,on)=>st.y-on.y)}let R=a.getContext("2d",{alpha:!1}),k=f.getContext("2d",{alpha:!0});function F(){let I=window.devicePixelRatio||1;m=window.innerWidth,y=window.innerHeight,a.width=m*I,a.height=y*I,a.style.width=m+"px",a.style.height=y+"px",f.width=m*I,f.height=y*I,f.style.width=m+"px",f.style.height=y+"px",R.scale(I,I),k.scale(I,I),L(),w=-50}window.addEventListener("resize",F),F();let U=Date.now(),q=!0,x,P=!1,M={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},X=!1,Q=[],pe=0,K=!1,ne=0,ve=5e3,he=!1,V=0,ee=[],$=6;for(let I=0;I<$;I++)ee.push({offset:Math.random()*1e3,speedBase:.001+I*5e-4,amplitudeBase:10+I*5});let G=[],j=400;function le(I,Y,z){return I*(1-z)+Y*z}function ue(I){let Y=parseInt(I.slice(1),16);return{r:Y>>16&255,g:Y>>8&255,b:Y&255}}function C(I,Y,z){let oe=ue(I),ge=ue(Y),ae=Math.round(le(oe.r,ge.r,z)),qe=Math.round(le(oe.g,ge.g,z)),tt=Math.round(le(oe.b,ge.b,z));return`rgb(${ae},${qe},${tt})`}function W(I,Y,z){let oe=[],ge=I,ae=Y,qe=20;for(;ae<z;){let tt=ge+(Math.random()-.5)*60,be=ae+qe+Math.random()*30;oe.push({x1:ge,y1:ae,x2:tt,y2:be}),ge=tt,ae=be}return oe}function ce(I,Y,z,oe,ge,ae){I.beginPath(),I.moveTo(Y+ae,z),I.lineTo(Y+oe-ae,z),I.quadraticCurveTo(Y+oe,z,Y+oe,z+ae),I.lineTo(Y+oe,z+ge-ae),I.quadraticCurveTo(Y+oe,z+ge,Y+oe-ae,z+ge),I.lineTo(Y+ae,z+ge),I.quadraticCurveTo(Y,z+ge,Y,z+ge-ae),I.lineTo(Y,z+ae),I.quadraticCurveTo(Y,z,Y+ae,z),I.closePath()}function me(I,Y,z,oe,ge){I.save(),I.translate(Y,z),I.scale(oe,oe),I.beginPath(),I.moveTo(0,0),I.quadraticCurveTo(10,-40,-5,-80),I.lineTo(5,-80),I.quadraticCurveTo(20,-40,10,0),I.fillStyle=ge.rock,I.fill(),I.translate(0,-80),I.fillStyle=ge.leaf;for(let ae=0;ae<7;ae++)I.save(),I.rotate(ae/7*Math.PI*2-Math.PI/2),I.beginPath(),I.moveTo(0,0),I.quadraticCurveTo(30,-10,60,0),I.quadraticCurveTo(30,10,0,0),I.fill(),I.restore();I.restore()}function Z(I,Y,z,oe,ge){I.save(),I.translate(Y,z),I.scale(oe,oe),I.fillStyle=ge.rock,I.beginPath(),I.moveTo(-20,0),I.bezierCurveTo(-20,-15,-10,-25,0,-25),I.bezierCurveTo(10,-25,20,-15,20,0),I.fill(),I.fillStyle="rgba(0,0,0,0.2)",I.beginPath(),I.ellipse(0,0,20,5,0,0,Math.PI*2),I.fill(),I.restore()}function re(I,Y,z,oe,ge){I.save(),I.translate(Y,z),I.scale(oe,oe),I.fillStyle=ge.shell,I.beginPath(),I.arc(0,0,10,Math.PI,0),I.lineTo(0,0),I.fill(),I.strokeStyle=ge.sandDark,I.lineWidth=1,I.beginPath();for(let ae=1;ae<5;ae++){let qe=Math.PI+ae/5*Math.PI;I.moveTo(0,0),I.lineTo(Math.cos(qe)*10,Math.sin(qe)*10)}I.stroke(),I.restore()}function ye(I,Y,z,oe,ge){I.fillStyle=ge.sandDark,I.fillRect(-50,oe,Y+100,z-oe),I.fillStyle=ge.sandDark,I.save(),I.fillStyle=ge.sandLight,I.globalAlpha=.3,I.beginPath(),I.moveTo(-50,z+100),I.lineTo(-50,oe),I.bezierCurveTo(Y*.3,oe-20,Y*.7,oe+20,Y+50,oe),I.lineTo(Y+50,z+100),I.fill(),I.globalAlpha=.6;let ae=oe+z*.05;I.beginPath(),I.moveTo(-50,z+100),I.lineTo(-50,ae),I.bezierCurveTo(Y*.4,ae+40,Y*.6,ae-10,Y+50,ae+20),I.lineTo(Y+50,z+100),I.fill(),I.globalAlpha=1;let qe=oe+z*.15;I.beginPath(),I.moveTo(-50,z+100),I.lineTo(-50,qe),I.bezierCurveTo(Y*.2,qe-10,Y*.8,qe+30,Y+50,qe+10),I.lineTo(Y+50,z+100),I.fill(),I.fillStyle=ge.sandDark,I.globalAlpha=.1,b.forEach(tt=>{I.fillRect(tt.x,tt.y,2,2)}),I.restore()}function Le(I,Y,z,oe=null){let ge=oe||1,ae=!!oe&&oe>5;X&&!ae&&!he&&dt("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),Q.push({x:ae?Y/2:Math.random()*Y,y:ae?z/2:Math.random()*z,radius:0,maxRadius:ae?Math.max(Y,z)*1.5:(100+Math.random()*400)*ge,speed:ae?40:(5+Math.random()*15)*ge,opacity:1,hue:225+Math.random()*15,life:1})}function ie(I,Y,z,oe=.5,ge=!0){let ae=.1+oe*.7,qe=Math.floor(1+oe*4);if(ge&&!he){for(let tt=0;tt<qe;tt++)if(Q.length<50&&Math.random()<ae){let be=1+oe*2;Le(I,Y,z,be)}}I.save(),I.globalCompositeOperation="lighter";for(let tt=Q.length-1;tt>=0;tt--){let be=Q[tt];if(be.radius+=be.speed,be.opacity-=.015,be.life-=.015,be.opacity<=0||be.radius>be.maxRadius){Q.splice(tt,1);continue}let Be=I.createRadialGradient(be.x,be.y,0,be.x,be.y,be.radius),Gt=be.opacity;Be.addColorStop(0,`hsla(${be.hue}, 100%, 80%, ${Gt})`),Be.addColorStop(.3,`hsla(${be.hue}, 100%, 40%, ${Gt*.9})`),Be.addColorStop(.7,`hsla(${be.hue}, 100%, 15%, ${Gt*.6})`),Be.addColorStop(1,`hsla(${be.hue}, 100%, 5%, 0)`),I.fillStyle=Be,I.beginPath(),I.arc(be.x,be.y,be.radius,0,Math.PI*2),I.fill()}I.restore()}function Se(){if(!q)return;let I=Date.now(),Y=I-U;Math.min(Y/t,1)>=1&&!P&&(P=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ge=6e3,ae=5e4,qe=5e4,tt=5e3,be=4e4,Be=0;Y<ge?Be=0:Y<ae?Be=(Y-ge)/(ae-ge):Be=1;let Gt=0;Y>be&&(Gt=Math.max(0,(Y-be)/(ae-be))),Y>ae&&(Gt=1),Gt>.1&&!i&&(i=dt("sounds/tsu_rumble.ogg",{volume:.8}));let st={skyTop:C(M.skyTop,_.skyTop,Be),skyBottom:C(M.skyBottom,_.skyBottom,Be),sun:C(M.sun,_.sun,Be),waterDeep:C(M.waterDeep,_.waterDeep,Be),waterMid:C(M.waterMid,_.waterMid,Be),waterPeak:C(M.waterPeak,_.waterPeak,Be),foam:C(M.foam,_.foam,Be),sandLight:C(M.sandLight,_.sandLight,Be),sandDark:C(M.sandDark,_.sandDark,Be),rock:C(M.rock,_.rock,Be),leaf:C(M.leaf,_.leaf,Be),shell:C(M.shell,_.shell,Be)},on=0,kt=0;if(Be>.5||he){let S=(Be-.5)*2*5+Gt*25;V>0&&(S+=50),on=(Math.random()-.5)*S,kt=(Math.random()-.5)*S}k.clearRect(0,0,m,y),R.save(),R.translate(on,kt),k.save(),k.translate(on,kt);let mn=R.createLinearGradient(0,0,0,y);if(mn.addColorStop(0,st.skyTop),mn.addColorStop(1,st.skyBottom),R.fillStyle=mn,R.fillRect(-50,-50,m+100,y+100),Be<1){let S=y*.15+Be*50;R.beginPath(),R.arc(m*.7,S,40,0,Math.PI*2),R.fillStyle=st.sun,R.globalAlpha=1-Be,R.shadowColor=st.sun,R.shadowBlur=20,R.fill(),R.globalAlpha=1,R.shadowBlur=0}let mo=y*.65;if(g&&Be<1){R.save();let S=Math.min(m,y)*5e-4,T=300*S,B=300*S,A=m*.8,N=B*.15,de=mo-B/2+N;R.translate(A,de),R.rotate(.1),R.drawImage(p,-T/2,-B/2,T,B),R.restore()}if(ye(R,m,y,mo,st),h.forEach(S=>{S.type==="tree"?me(R,S.x,S.y,S.scale,st):S.type==="rock"?Z(R,S.x,S.y,S.scale,st):S.type==="shell"&&re(R,S.x,S.y,S.scale,st)}),Be>.3){let S=(Be-.3)/.7,T=Math.floor(j*S);if(k.strokeStyle=`rgba(120, 180, 255, ${.1+S*.3})`,k.lineWidth=1+S,k.beginPath(),G.length<T)for(let A=0;A<10;A++)G.push({x:Math.random()*m*1.5,y:w,speed:20+Math.random()*20,len:10+Math.random()*20});let B=10+S*20;for(let A=0;A<G.length;A++){let N=G[A];N.y+=N.speed,N.x-=B,k.moveTo(N.x,N.y),k.lineTo(N.x-B*.5,N.y+N.len),(N.y>y||N.x<-100)&&(A<T?(N.x=Math.random()*m*1.5,N.y=w):(G.splice(A,1),A--))}k.stroke()}let tr=.3;if(Be>tr){let S=(Be-tr)/(1-tr),T=le(0,y*1.5,S*S);k.fillStyle=st.waterDeep,k.beginPath(),k.moveTo(-50,y+100),k.lineTo(-50,y-T*.3),k.bezierCurveTo(m*.3,y-T*.4,m*.6,y-T*1.2,m+50,y-T*.8),k.lineTo(m+50,y+100),k.fill()}let Mo=le(0,y*.5,Be),To=le(0,y*1.5,Gt*Gt),nr=y*.85-Mo-To;if(ee.forEach((S,T)=>{let B;T===$-1?B=st.waterPeak:T%2===0?B=st.waterDeep:B=st.waterMid,k.fillStyle=B,k.beginPath();let A=S.amplitudeBase*(1+Be*2+Gt*5),N=.003+Be*.005,de=S.speedBase*(1+Be*5+Gt*10),fe=Y*de+S.offset,Te=T*15*(1-Gt),Oe=nr+Te;k.moveTo(-50,y+100),k.lineTo(-50,Oe);for(let Pe=-50;Pe<=m+50;Pe+=15){let ke=Oe+Math.sin(Pe*N+fe)*A+Math.cos(Pe*N*2.3+fe)*(A*.5);k.lineTo(Pe,ke)}if(k.lineTo(m+50,y+100),k.fill(),T===$-1||Be>.6&&T>$-3){k.save(),k.globalAlpha=.1+Be*.3,k.fillStyle=st.foam,k.beginPath();for(let Pe=-50;Pe<=m+50;Pe+=10){let ke=Oe+Math.sin(Pe*N+fe)*A+Math.cos(Pe*N*2.3+fe)*(A*.5);Math.random()>.5&&(ke-=5),Pe===-50?k.moveTo(Pe,ke):k.lineTo(Pe,ke)}k.lineTo(m+50,y+100),k.lineTo(-50,y+100),k.fill(),k.restore()}}),Y<oe){let S=1;Y>1e3&&(S=1-(Y-1e3)/(oe-1e3)),k.fillStyle=`rgba(0, 0, 0, ${S})`,k.fillRect(-50,-50,m+100,y+100)}if(Y>qe){let S=Math.min(1,(Y-qe)/tt);k.fillStyle=`rgba(0, 0, 0, ${S})`,k.fillRect(-50,-50,m+100,y+100)}if(X){let S=I-pe,T=12e3,B=0,A=!0;S<T?B=S/T:(B=1,he||(he=!0,Le(k,m,y,25),V=60,l||(l=!0,dt("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),K&&(A=!1),ie(k,m,y,B,A)}if(K){let S=I-ne,T=Math.min(1,S/ve);k.fillStyle=`rgba(0, 0, 0, ${T})`,k.fillRect(-50,-50,m+100,y+100)}if(V>0){let S=V/60,T=S*S;k.fillStyle=`rgba(255, 255, 255, ${T})`,k.fillRect(-50,-50,m+100,y+100),V--}R.restore(),k.restore(),x=requestAnimationFrame(Se)}function Ne(){q=!1,e.style.cursor="",x&&cancelAnimationFrame(x),window.removeEventListener("resize",F),a.parentNode&&a.parentNode.removeChild(a),f.parentNode&&f.parentNode.removeChild(f),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function _e(){X=!0,pe=Date.now(),he=!1,V=0,s||(s=dt("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Re(){K=!0,ne=Date.now(),s&&s.stop()}function se(){e.style.cursor=""}function te(){e.style.cursor="none"}function Ie(){s&&(s.stop(),s=null)}return Se(),{cleanup:Ne,triggerBeacons:_e,triggerFinalFade:Re,showCursor:se,hideCursor:te,stopHumLoop:Ie}}var gy=De(()=>{Rn()});var Ky={};vt(Ky,{canPerformForgeReset:()=>Xy,canPerformInfuseReset:()=>Vy,computeForgeGoldFromInputs:()=>Ay,computeInfuseMagicFromInputs:()=>Ny,computePendingForgeGold:()=>Hy,computeSurgeWavesFromInputs:()=>Ry,getCurrentSurgeLevel:()=>In,getForgeDebugOverrideState:()=>By,getInfuseDebugOverrideState:()=>Uy,getSurgeBarLevelKey:()=>gs,getSurgeDebugOverrideState:()=>qy,hasDoneForgeReset:()=>Sr,hasDoneInfuseReset:()=>Dt,hasDoneSurgeReset:()=>Eo,initResetPanel:()=>bd,initResetSystem:()=>Go,isForgeUnlocked:()=>cs,isInfuseUnlocked:()=>eu,isSurgeUnlocked:()=>ys,onForgeUpgradeUnlocked:()=>yp,onInfuseUpgradeUnlocked:()=>vp,onSurgeUpgradeUnlocked:()=>bp,performForgeReset:()=>pp,performInfuseReset:()=>mp,performSurgeReset:()=>hp,recomputePendingMagic:()=>Xn,setForgeDebugOverride:()=>Fy,setForgeResetCompleted:()=>op,setInfuseDebugOverride:()=>$y,setInfuseResetCompleted:()=>rp,setInfuseUnlockedForDebug:()=>Dy,setSurgeResetCompleted:()=>ip,setSurgeUnlockedForDebug:()=>Gy,shouldBlockBigCoins:()=>za,updateResetPanel:()=>Ye});function Zd(e){return!dw.includes(e)}function pw(){dt(cw,{volume:.4})}function mw(){dt(uw,{volume:.45})}function hw(){dt(fw,{volume:.5})}function za(){return Cy}function My(){let e=Vn(),t=O.waves?.value??Mt(),n=0n;try{n=Ka(e)}catch{}let o=E.pendingWaves,r=gp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),Cy=i&&!Sn()}function Wa(){Vd=null}function Kc(){let e=E.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function jc(){let e=E.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function Yd(){let e=E.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function vw(e=null){try{if(e){let t=e instanceof Et?e:Et.fromAny(e??1);return t.isInfinite?.()?Et.fromAny("Infinity"):E.pendingGold.mulBigNumInteger(t)}return O.gold?.mult?.applyTo?.(E.pendingGold)??E.pendingGold}catch{return E.pendingGold}}function bw(){for(;lo.length;){let e=lo.pop();try{e?.()}catch{}}}function Xd(){!Sy&&typeof Ml=="function"&&(Sy=Ml((e={})=>{e?.key&&e.key!==Me.COINS&&e.key!==Me.WAVES||e?.slot!=null&&E.slot!=null&&e.slot!==E.slot||(e?.key===Me.WAVES?(tu(),Ye()):(Cn(),Xn(),Hn()))})),!Iy&&typeof Dl=="function"&&(Iy=Dl((e={})=>{e?.slot!=null&&E.slot!=null&&e.slot!==E.slot||(Cn(),Hn(),Ye())}))}function np(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=$e(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Jc(){try{let e=Qe();if(e&&e.xpLevel)return e.xpLevel}catch{}return Mt()}function Ty(e,t){if(!e||typeof e!="object")return Mt();let n=$e(e);if(!Number.isFinite(n)&&n>0)return Et.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return Mt();let r=Ae(o*Math.log10(2)),i=Math.max(0,np(t)),s=Math.max(0,(i-30)/5),l=s<=0?yy():Ae(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?yy():Ae(a*Math.log10(1.15)),d=Et.fromInt(10);d=d.mulBigNumInteger(r),d=d.mulBigNumInteger(l),d=d.mulBigNumInteger(u);let f=d.floorToInteger();return f.isZero?.()?Mt():f}function Sw(e,t){if(!e)return Mt();let n=$e(e);if(!Number.isFinite(n)&&n>0)return Et.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let g=$e(t);Number.isFinite(g)&&(a=Math.max(0,g-4))}let u=o*i,d=Math.floor(o)*s,f=a*l,p=r+u+d+f;return Number.isFinite(p)?Ae(p).floorToInteger():Et.fromAny("Infinity")}function ky(e,t,n=null){let o=Sw(e,t);if(n){let r=n instanceof Et?n:Et.fromAny(n??1);return r.isInfinite?.()?Et.fromAny("Infinity"):o.mulBigNumInteger(r)}return O.magic?.mult?.applyTo?.(o)??o}function Ay(e,t){return Ty(e,t)}function Ny(e,t){return ky(e,t)}function Ry(e,t,n,o,r){return Oy(e,t,n,o,r)}function Oy(e,t,n,o,r){let i=np(e);if(i<201)return Mt();let s=(i-201)/35,l=$e(t),a=$e(n),u=$e(o),d=$e(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||d===Number.POSITIVE_INFINITY)return Et.fromAny("Infinity");let f=0;Number.isFinite(l)&&l>24&&(f+=(l-24)*Gc),Number.isFinite(a)&&a>13&&(f+=(a-13)*Gc),Number.isFinite(u)&&u>5&&(f+=(u-5)*Gc),Number.isFinite(d)&&d>12&&(f+=(d-12)*Gc);let p=1+f+s;return Number.isFinite(p)?Ae(p).floorToInteger():Et.fromAny("Infinity")}function Py(){return Math.max(0,np(Jc()))}function Vn(){if(E.slot!=null)return E.slot;let e=v();return E.slot=e,e}function op(e){let t=Vn();if(t!=null){E.hasDoneForgeReset=!!e;try{localStorage.setItem(Jd(t),E.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function rp(e){let t=Vn();if(t!=null){E.hasDoneInfuseReset=!!e;try{localStorage.setItem(Qd(t),E.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function ip(e){let t=Vn();if(t!=null){E.hasDoneSurgeReset=!!e;try{localStorage.setItem(ep(t),E.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Qc(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Va(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function By(e=v()){return Qc(e)}function Fy(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(E.forgeDebugOverride!==n){if(E.forgeDebugOverride=n,n==null)try{localStorage.removeItem(Va(t))}catch{}else try{localStorage.setItem(Va(t),n?"1":"0")}catch{}rt(Va(t)),Kc(),Ye()}}function sp(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Ya(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Uy(e=v()){return sp(e)}function Dy(e){ap(e)}function $y(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(E.infuseDebugOverride!==n){if(E.infuseDebugOverride=n,n==null)try{localStorage.removeItem(Ya(t))}catch{}else try{localStorage.setItem(Ya(t),n?"1":"0")}catch{}rt(Ya(t)),jc(),Ye()}}function ap(e){let t=Vn();if(t==null)return;let n=!!e;if(E.infuseUnlocked!==n){E.infuseUnlocked=n;try{localStorage.setItem(Wc(t),E.infuseUnlocked?"1":"0")}catch{}rt(Wc(t)),jc()}}function Zc(e){let t=Vn();if(t==null)return;let n=!!e;if(E.forgeUnlocked!==n){E.forgeUnlocked=n;try{localStorage.setItem(Yc(t),E.forgeUnlocked?"1":"0")}catch{}rt(Yc(t)),Kc()}}function lp(e=v()){if(e==null)return null;try{let t=localStorage.getItem(_y(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function qy(e=v()){return lp(e)}function Gy(e){cp(e)}function cp(e){let t=Vn();if(t==null)return;let n=!!e;if(E.surgeUnlocked!==n){E.surgeUnlocked=n;try{localStorage.setItem(zc(t),E.surgeUnlocked?"1":"0")}catch{}rt(zc(t)),Yd()}}function Wd(e){if(e==null){E.forgeUnlocked=!1,E.forgeDebugOverride=null,E.hasDoneForgeReset=!1,E.infuseUnlocked=!1,E.infuseDebugOverride=null,E.hasDoneInfuseReset=!1,E.surgeUnlocked=!1,E.surgeDebugOverride=null,E.hasDoneSurgeReset=!1,E.flagsPrimed=!1;return}try{E.forgeUnlocked=localStorage.getItem(Yc(e))==="1"}catch{E.forgeUnlocked=!1}E.forgeDebugOverride=Qc(e);try{E.hasDoneForgeReset=localStorage.getItem(Jd(e))==="1"}catch{E.hasDoneForgeReset=!1}try{E.infuseUnlocked=localStorage.getItem(Wc(e))==="1"}catch{E.infuseUnlocked=!1}try{E.hasDoneInfuseReset=localStorage.getItem(Qd(e))==="1"}catch{E.hasDoneInfuseReset=!1}E.infuseDebugOverride=sp(e);try{E.surgeUnlocked=localStorage.getItem(zc(e))==="1"}catch{E.surgeUnlocked=!1}E.surgeDebugOverride=lp(e);try{E.hasDoneSurgeReset=localStorage.getItem(ep(e))==="1"}catch{E.hasDoneSurgeReset=!1}E.flagsPrimed=!0}function Vo(){let e=v();if(e==null){E.flagsPrimed=!1;return}E.slot!==e&&(E.slot=e,Wa(),E.flagsPrimed=!1),E.flagsPrimed||Wd(e)}function wy(e){vy!==e&&(bw(),vy=e,e!=null&&(lo.push(_t(Yc(e),{onChange(t){let n=t==="1";E.forgeUnlocked!==n&&(E.forgeUnlocked=n,Kc(),Ye())}})),lo.push(_t(Jd(e),{onChange(t){let n=t==="1";E.hasDoneForgeReset!==n&&(E.hasDoneForgeReset=n,Ye())}})),lo.push(_t(Va(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),E.forgeDebugOverride!==n&&(E.forgeDebugOverride=n,Kc(),Ye())}})),lo.push(_t(Wc(e),{onChange(t){let n=t==="1";E.infuseUnlocked!==n&&(E.infuseUnlocked=n,jc(),Ye())}})),lo.push(_t(Qd(e),{onChange(t){let n=t==="1";E.hasDoneInfuseReset!==n&&(E.hasDoneInfuseReset=n,Ye())}})),lo.push(_t(Ya(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),E.infuseDebugOverride!==n&&(E.infuseDebugOverride=n,jc(),Ye())}})),lo.push(_t(zc(e),{onChange(t){let n=t==="1";E.surgeUnlocked!==n&&(E.surgeUnlocked=n,Yd(),Ye())}})),lo.push(_t(_y(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),E.surgeDebugOverride!==n&&(E.surgeDebugOverride=n,Yd(),Ye())}})),lo.push(_t(ep(e),{onChange(t){let n=t==="1";E.hasDoneSurgeReset!==n&&(E.hasDoneSurgeReset=n,Ye())}}))))}function Iw(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function Cn(e=!1){let t=O.coins?.value??Mt(),n=Jc(),o=Iw(t,n);!e&&Vd===o||(Vd=o,up()?E.pendingGold=Ty(t,n):E.pendingGold=Mt(),Ye())}function Xn(e=null){let t=O.coins?.value??Mt(),n=ja();fp()?E.pendingMagic=ky(t,n,e):E.pendingMagic=Mt(),Hn(),Ye()}function Hn(){if(!ys()){E.pendingWaves=Mt();return}let e=Jc(),t=O.coins?.value??Mt(),n=O.gold?.value??Mt(),o=O.magic?.value??Mt(),r=ja();E.pendingWaves=Oy(e,t,n,o,r),Eo()||E.pendingWaves.cmp(Et.fromInt(10))>0&&(E.pendingWaves=Et.fromInt(10)),My()}function zd(){let e=Qc();return e!=null?!!e:E.forgeUnlocked||Ct(xe.STARTER_COVE,we.UNLOCK_FORGE)>=1}function up(){try{let e=Jc();if(e&&typeof e.cmp=="function")return e.cmp(gw)>=0}catch{}return!1}function fp(){try{let e=lt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(yw)>=0}catch{}return!1}function cs(){Vo();let e=Qc();return e!=null?!!e:!!E.forgeUnlocked||zd()}function eu(){Vo();let e=sp();return e!=null?!!e:!!E.infuseUnlocked}function ys(){Vo();let e=lp();return e!=null?!!e:!!E.surgeUnlocked}function In(){let e=Vn();return e==null?0n:Ka(e)}function Sr(){return Vo(),!!E.hasDoneForgeReset}function Dt(){return Vo(),!!E.hasDoneInfuseReset}function Eo(){return Vo(),!!E.hasDoneSurgeReset}function Hy(){return Cn(),E.pendingGold.clone?.()??E.pendingGold}function Xy(){return!(!cs()||!up()||E.pendingGold.isZero?.())}function Vy(){return!(!eu()||!fp()||E.pendingMagic.isZero?.())}function ww({resetGold:e=!1,resetMagic:t=!1}={}){let n=Ft(xe.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===we.UNLOCK_XP||r===we.UNLOCK_FORGE||r===we.UNLOCK_INFUSE||r===we.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||Yo(xe.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function dp({resetGold:e=!1,resetMagic:t=!1}={}){try{O.coins.set(0)}catch{}try{O.books.set(0)}catch{}try{Bi({keepUnlock:!0})}catch{}try{qd()}catch{}ww({resetGold:e,resetMagic:t})}function pp(){if(!Xy())return!1;let e=E.pendingGold.clone?.()??E.pendingGold;try{let t=O.gold?.mult?.applyTo?.(e)??e;O.gold?.add&&O.gold.add(t)}catch{}if(dp({resetGold:!1}),Cn(),Zc(!0),E.hasDoneForgeReset||op(!0),Yt(),Lr(),Zd("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return Ye(),!0}function mp(){if(!Vy())return!1;let e=E.pendingMagic.clone?.()??E.pendingMagic;try{O.magic?.add&&O.magic.add(e)}catch{}dp({resetGold:!0});try{O.gold.set(0)}catch{}try{let t=v(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Yt({forceReload:!0})}catch{}if(Cn(),Xn(),Zd("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return ap(!0),E.hasDoneInfuseReset||rp(!0),Ye(),!0}function Kd(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Vn();try{O.waves?.add&&e&&!e.isZero?.()&&O.waves.add(e)}catch{}dp({resetGold:!0,resetMagic:!0});try{O.gold.set(0)}catch{}try{O.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Yt({forceReload:!0})}catch{}if(tu(),cp(!0),E.hasDoneSurgeReset||ip(!0),Cn(),Xn(),Hn(),t&&(n||hw(),n||Lw()),Zd("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}Ye()}function Ew(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{zg(!0)}catch{}try{yc()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,pr(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=hy(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Rg(e,()=>{setTimeout(xw,0)},i)},r);Vc=i.cleanup}function xw(){Vc&&(Vc(),Vc=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Kd(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=v();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function hp(){if(!ys()||Py()<201)return!1;let e=E.pendingWaves.clone?.()??E.pendingWaves;if(e.isZero?.())return!1;let t=Vn(),n=O.waves?.value??Mt(),o=Ka(t),r=gp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!Sn()?(Ew(),Kd(e,{playEffects:!1}),!0):(Kd(e,{playEffects:!0}),!0)}function Lw(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function Ka(e){let t=0n;try{let n=localStorage.getItem(tp(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function _w(e){let t=tp(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function Ey(e){if(!(e instanceof Et)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function Yy(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=Ey(n),l=Ey(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let d=new c(10n,{base:0,offset:u}),f=d.sub(r).div(c.fromInt(9));n.cmp(f)>=0&&(n=n.sub(f),o=u,i=!0,r=d)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function tu(){let e=Vn();if(e==null||!ys()||Hd||_w(e))return;let t=O.waves?.value??Mt(),n=Ka(e);if(n===1/0)return;let o=Yy(n,t);if(o.changed){n=o.level;try{localStorage.setItem(tp(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}Hd=!0;try{O.waves.set(o.remainingWaves)}finally{Hd=!1}Ye(),o.safety>=100&&setTimeout(tu,0)}My()}function Xa(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Et.fromInt(e)}catch{}try{return J(t)}catch{return e?.toString?.()??"0"}}function Cw(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${sw}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${aw}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${lw}" alt=""><span>Surge</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${xy}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Ly}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Xc}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,E.panel=e,E.elements.forge.card=e.querySelector("#reset-card-forge"),E.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),E.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),E.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),E.elements.infuse.card=e.querySelector("#reset-card-infuse"),E.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),E.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),E.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),E.elements.surge.card=e.querySelector("#reset-card-surge"),E.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),E.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),E.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),E.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),E.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),E.elements.surge.headerVal=e.querySelector("[data-surge-level]"),E.elements.surge.header=e.querySelector(".surge-header");let t=e.querySelector(".surge-milestone-wrapper");E.elements.surge.milestones&&t&&ts(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),E.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]')},Object.entries(E.layerButtons).forEach(([n,o])=>{if(!o)return;let r=null,i=s=>{if(s&&s.isTrusted&&Qn(o))return;let l=E.elements[n]?.card;if(l){let a=l.closest(".merchant-content");n==="forge"&&a?a.scrollTo({top:0,behavior:"smooth"}):l.scrollIntoView({behavior:"smooth",block:"start"})}};o.addEventListener("click",s=>{if(r&&r!=="mouse"){r=null;return}r=null,i(s)})}),E.elements.forge.btn&&E.elements.forge.btn.addEventListener("click",()=>{pp()&&(pw(),Ye())}),E.elements.infuse.btn&&E.elements.infuse.btn.addEventListener("click",()=>{mp()&&(mw(),Ye())}),E.elements.surge.btn&&E.elements.surge.btn.addEventListener("click",()=>{hp()&&Ye()}),Ye()}function bd(e){!e||e.__resetInit||(e.__resetInit=!0,Cw(e))}function xr(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=Xa(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let d=e.querySelector(".merchant-reset__action-icon img");d&&!d.src.includes(n)&&(d.src=n)}}function Wy({goldMult:e=null}={}){let t=E.elements.forge;if(!(!t.card||!t.btn)){if(!cs()){xr(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(Vo(),t.card.classList.toggle("is-forge-complete",!!E.hasDoneForgeReset),t.status)if(E.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!up()){xr(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}xr(t.btn,{disabled:!1},xy,vw(e))}}function zy(){let e=E.elements.infuse;if(!(!e.card||!e.btn)){if(!eu()){e.card.style.display!=="none"&&(e.card.style.display="none"),E.layerButtons.infuse&&E.layerButtons.infuse.style.display!=="none"&&(E.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),E.layerButtons.infuse&&E.layerButtons.infuse.style.display!=="flex"&&(E.layerButtons.infuse.style.display="flex"),Vo(),e.card.classList.toggle("is-complete",!!E.hasDoneInfuseReset),e.status)if(E.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!fp()){xr(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}xr(e.btn,{disabled:!1},Ly,E.pendingMagic)}}function gp(e,t,n){let o=t.add(n);return Yy(e,o).level}function jd(){let e=E.elements.surge;if(!e.card||!e.btn)return;if(!ys()){e.card.style.display!=="none"&&(e.card.style.display="none"),E.layerButtons.surge&&E.layerButtons.surge.style.display!=="none"&&(E.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),E.layerButtons.surge&&E.layerButtons.surge.style.display!=="flex"&&(E.layerButtons.surge.style.display="flex"),Vo();let t=Vn(),n=O.waves?.value??Mt(),o=0n;try{o=Ka(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':Xa(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=E.pendingWaves;if(u&&!u.isZero?.()){let d=gp(o,n,u),f=!1;if(d===1/0)f=!0;else try{f=d>o}catch{}if(f){let p=d===1/0?'<span class="surge-infinity-symbol">\u221E</span>':Xa(d);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${Xc}">${Xa(n)} / <img src="${Xc}">${Xa(r)}</span>`),e.milestones){let s=py(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let d=BigInt(a.surgeLevel)<=o,f=d?"is-reached":"",p=a.description.map(F=>F.includes("Invokes the Tsunami")&&!d?`<div class="tsunami-text">- ${F}</div>`:`<div>- ${F}</div>`).join("");if(d&&a.surgeLevel===3){let F=mr?mr():Et.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${J(F)}</div>`}if(d&&a.surgeLevel===6){let F=oc();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${at(F.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${at(F.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${at(F.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${at(F.magic)}x</span></div>`}let g=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(g=!0);let m=Bt(),y=bn(),h=m+y;h>1&&(h=1);let b=!1;d&&g&&h<1&&Gd.includes(a.id)&&(b=!0);let w=b?" is-nerfed":"",L=l[u];if(!L)L=document.createElement("div"),L.className=`surge-milestone-item ${f}${w}`,L.dataset.isReached=String(d),L.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(L);else{L.className!==`surge-milestone-item ${f}${w}`&&(L.className=`surge-milestone-item ${f}${w}`);let F=String(d);L.dataset.isReached!==F&&(L.dataset.isReached=F)}let R=L.querySelector(".surge-milestone-desc");R&&R.innerHTML!==p&&(R.innerHTML=p);let k=L.querySelector(".surge-milestone-nerf-arrow");if(k){let F=!1;g&&h<1&&Gd.includes(a.id)&&(F=!0);let U=F?"":"none";k.style.display!==U&&(k.style.display=U)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();E.lastRenderedSurgeLevel!==o&&(E.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],d=e.milestones.children;u===d[d.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!E.hasDoneSurgeReset),e.status)if(E.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(Py()<201){xr(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(E.pendingWaves.isZero?.()){xr(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}xr(e.btn,{disabled:!1},Xc,E.pendingWaves)}function Ye({goldMult:e=null}={}){E.panel&&(Wy({goldMult:e}),zy(),jd())}function yp(){Go(),Zc(!0),Ye()}function vp(){Go(),ap(!0),Ye()}function bp(){Go(),cp(!0),Ye()}function Mw(){if(!E.panel)return;let e=E.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!E.panel.classList.contains("is-active")||!E.elements.surge.barFill)return;let t=E.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",jd(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",jd()},{once:!0}))}function Tw(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{Mw()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(Cn(),Xn(),Hn()),e.detail?.key==="waves"&&(tu(),Ye()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Hn(),Ye())}),window.addEventListener("surge:bookResidue",()=>{if(E.panel&&E.panel.offsetParent!==null){let e=E.elements.surge.card;e&&e.style.display!=="none"&&Ye()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Me.GOLD){if(t.slot!=null&&E.slot!=null&&t.slot!==E.slot)return;Cn(!0);let n=t.mult instanceof c?t.mult:Et.fromAny(t.mult??1);E.panel&&Wy({goldMult:n});return}if(t.key===Me.MAGIC){if(t.slot!=null&&E.slot!=null&&t.slot!==E.slot)return;let n=t.mult instanceof c?t.mult:Et.fromAny(t.mult??1);Xn(n),E.panel&&zy();return}}}),window.addEventListener("xp:change",()=>{Cn(),Hn(),Ye()}),window.addEventListener("mutation:change",()=>{Xn(),Hn(),Ye()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&E.slot!=null&&e.detail.slot!==E.slot||(Wa(),Cn(!0),Xn(),Hn(),Ye())}))}function Go(){if(by){E.slot=v(),Wa(),Xd(),Cn(!0),Xn(),Hn();return}try{Yt()}catch{return}by=!0;let e=v();if(E.slot=e,Wa(),Wd(e),E.hasDoneForgeReset&&!Lo())try{Lr()}catch{}if(!E.forgeUnlocked&&zd()&&Zc(!0),wy(e),Xd(),Tw(),Cn(!0),Xn(),Hn(),Hc){try{Hc()}catch{}Hc=null}Hc=ci(()=>{let t=Sp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=v();if(E.slot=t,Wa(),Wd(t),E.hasDoneForgeReset&&!Lo())try{Lr()}catch{}!E.forgeUnlocked&&zd()&&Zc(!0),wy(t),Xd(),Cn(!0),Xn(),Hn(),Ye()})}var Et,Gc,Mt,yy,xy,Ly,sw,aw,lw,Xc,cw,uw,fw,dw,Yc,Jd,Va,Wc,Qd,Ya,zc,_y,ep,gs,tp,gw,yw,Hd,Cy,E,lo,vy,by,Hc,Vd,Sy,Iy,Vc,So=De(()=>{Lt();bt();zt();Dn();cn();wo();$i();Ta();my();jr();Rn();ro();Qr();bc();gy();Et=c,Gc=Math.log10(1.1),Mt=()=>Et.fromInt(0),yy=()=>Et.fromInt(1),xy="img/currencies/gold/gold.webp",Ly="img/currencies/magic/magic.webp",sw="img/misc/forge.webp",aw="img/misc/infuse.webp",lw="img/misc/surge.webp",Xc="img/currencies/wave/wave.webp",cw="sounds/forge_reset.ogg",uw="sounds/infuse_reset.ogg",fw="sounds/surge_reset.ogg",dw=[];Yc=e=>`ccc:reset:forge:${e}`,Jd=e=>`ccc:reset:forge:completed:${e}`,Va=e=>`ccc:debug:forgeUnlocked:${e}`,Wc=e=>`ccc:reset:infuse:${e}`,Qd=e=>`ccc:reset:infuse:completed:${e}`,Ya=e=>`ccc:debug:infuseUnlocked:${e}`,zc=e=>`ccc:reset:surge:${e}`,_y=e=>`ccc:debug:surgeUnlocked:${e}`,ep=e=>`ccc:reset:surge:completed:${e}`,gs=e=>`ccc:reset:surge:barLevel:${e}`,tp=gs,gw=Et.fromInt(31),yw=Et.fromInt(7),Hd=!1,Cy=!1;E={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,pendingGold:Mt(),pendingMagic:Mt(),pendingWaves:Mt(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},lo=[],vy=null,by=!1,Hc=null,Vd=null,Sy=null,Iy=null;Vc=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Go,performForgeReset:pp,performInfuseReset:mp,performSurgeReset:hp,computePendingForgeGold:Hy,computeForgeGoldFromInputs:Ay,computeInfuseMagicFromInputs:Ny,computeSurgeWavesFromInputs:Ry,getForgeDebugOverrideState:By,hasDoneForgeReset:Sr,isForgeUnlocked:cs,setForgeDebugOverride:Fy,setForgeResetCompleted:op,updateResetPanel:Ye,isInfuseUnlocked:eu,setInfuseDebugOverride:$y,getInfuseDebugOverrideState:Uy,recomputePendingMagic:Xn,setInfuseUnlockedForDebug:Dy,setInfuseResetCompleted:rp,hasDoneInfuseReset:Dt,isSurgeUnlocked:ys,setSurgeUnlockedForDebug:Gy,getSurgeDebugOverrideState:qy,setSurgeResetCompleted:ip,hasDoneSurgeReset:Eo,getCurrentSurgeLevel:In,shouldBlockBigCoins:za}))});function Ip(){Za=null}function jy(){Za=null;try{nu.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{vn()}catch{}}function Zy(e){return typeof e=="function"&&nu.push(e),()=>{nu=nu.filter(t=>t!==e)}}function Aw(e){let t=ut(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Ae(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function Nw(){try{return!!ln()}catch{return!1}}function Ja(e){let t=O?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(Nw())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=Ct(xe.STARTER_COVE,we.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=Aw(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function vs(e=xe.STARTER_COVE){if(Za)return Za;let t=Ft(e),n={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let o of t){if(!o.effectType)continue;let r=Ln(e,o.id),i=Fe(r),s=null;if(typeof o.effectMultiplier=="function"?(s=o.effectMultiplier(i),!(s instanceof c)&&typeof s!="number"&&(s=c.fromAny(s??1))):s=c.fromInt(1),o.upgType==="HM"){let{selfMult:l,xpMult:a,coinMult:u,mpMult:d}=_r(o,r,e);n.xpValue=xt(n.xpValue,a),n.coinValue=xt(n.coinValue,u),n.mpValue=xt(n.mpValue,d),s=xt(s,l)}if(o.effectType==="coin_spawn"){let l=1;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=1}else l=Number(s);n.coinSpawn*=l}else if(o.effectType==="coin_value")n.coinValue=xt(n.coinValue,s);else if(o.effectType==="xp_value")n.xpValue=xt(n.xpValue,s);else if(o.effectType==="mp_value")n.mpValue=xt(n.mpValue,s);else if(o.effectType==="book_value")n.bookValue=xt(n.bookValue,s);else if(o.effectType==="magnet_radius"){let l=0;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=0}else l=Number(s);Number.isFinite(l)&&(n.magnetRadius+=l)}}return Za=n,n}function ns(e){let t=vs(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:kw*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue}}function $c(){try{let{mpValue:e}=vs(xe.STARTER_COVE);return e}catch{return c.fromInt(1)}}function qc(){try{let{magnetRadius:e}=vs(xe.STARTER_COVE);return e||0}catch{return 0}}function Jy(){try{Go()}catch{}try{No(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=vs(xe.STARTER_COVE);return xt(n,o)})}catch{}try{cr(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=vs(xe.STARTER_COVE);return xt(n,o)})}catch{}try{ei(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=vs(xe.STARTER_COVE);return xt(n,o)})}catch{}Ja(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{Ja()}catch{}try{vn()}catch{}})}var kw,Za,nu,Qy=De(()=>{Lt();bt();So();Dn();wo();cn();kw=1,Za=null,nu=[]});var xv={};vt(xv,{AREA_KEYS:()=>xe,HM_EVOLUTION_INTERVAL:()=>qt,MAX_LEVEL_DELTA:()=>_s,REGISTRY:()=>bu,UPGRADE_TIES:()=>we,approxLog10BigNum:()=>$e,batchUpgradeOperations:()=>el,bigNumFromLog10:()=>Ae,buyCheap:()=>_d,buyMax:()=>kc,buyOne:()=>Ba,buyTowards:()=>Fa,clearPermanentUpgradeUnlock:()=>$p,computeDefaultUpgradeCost:()=>qp,computeHmMultipliers:()=>_r,computeUpgradeEffects:()=>ns,costToBuyOne:()=>rE,ensureLevelBigNum:()=>ut,estimateFlatBulk:()=>Rp,estimateGeometricBulk:()=>Jw,evaluateBulkPurchase:()=>ri,evolveUpgrade:()=>Ld,formatMultForUi:()=>at,getCurrentAreaKey:()=>qn,getHmEvolutions:()=>Bp,getHmNextMilestoneLevel:()=>iE,getIconUrl:()=>Ac,getLevel:()=>Ln,getLevelNumber:()=>Ct,getMagnetLevel:()=>qc,getMpValueMultiplierBn:()=>$c,getUpgrade:()=>ks,getUpgradeLockState:()=>Ho,getUpgradeStorageKey:()=>fi,getUpgradesForArea:()=>Ft,levelBigNumToNumber:()=>Fe,markUpgradePermanentlyUnlocked:()=>ui,normalizeBigNum:()=>sE,normalizedUpgradeLevel:()=>uu,onUpgradesChanged:()=>Zy,peekNextPrice:()=>Ev,performFreeAutobuy:()=>Ed,safeMultiplyBigNum:()=>xt,setLevel:()=>Yo,syncBookCurrencyMultiplierFromUpgrade:()=>Ja,upgradeUiModel:()=>Ua});function ou(){Cr.size!==0&&(Cr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{rt(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Cr.clear())}function Ow(){if(!(typeof window>"u")&&!tv){tv=setInterval(ou,2e3);try{window.addEventListener("beforeunload",ou)}catch{}try{window.addEventListener("pagehide",ou)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&ou()})}catch{}}}function el(e){if(Is)return e();Is=!0;try{return e()}finally{Is=!1,Qa.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{Es(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),Qa.clear(),ev.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{nE(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),ev.clear(),Cp&&(Cp=!1,co())}}function Pw(e){try{let t=Ts(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function rv(e,t){if(!Pw(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=$e(n);return Number.isFinite(o)&&o>=Bw}catch{return!1}}function ws(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>wp)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>wp/2||i.length>wp/2)return"Infinity"}return n}function $e(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let g=Math.log10(p),m=e.e||0,y=Number(e._eOffset||0n);return g+m+y}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let d;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)+(u.length-15)}let f=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return d+f}function Ae(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function iu(e){return Gw[e]??0}function Ep(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Cs(e,t){let n=Ko(e||t?.area);if(!n)return null;let o=jo(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=zn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function tl(e,t){let n=Ko(e||t?.area);if(!n)return null;let o=zn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function bs(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function kp(e=v()){let t=String(e??"default");if(au.has(t))return au.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${av}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),au.set(t,n),n}function Ap(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),au.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${av}:${n}`,JSON.stringify(e))}catch{}}function gu(e=v()){let t=String(e??"default");if(lu.has(t))return lu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${lv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),lu.set(t,n),n}function yu(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),lu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${lv}:${n}`,JSON.stringify(e))}catch{}}function Up(e=v()){let t=String(e??"default");if(cu.has(t))return cu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${cv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),cu.set(t,n),n}function Dp(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),cu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${cv}:${n}`,JSON.stringify(e))}catch{}}function Np(e,t,n=v()){let o=Cs(e,t);if(!o)return;let r=tl(e,t),i=Up(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Dp(i,n))}function uv(e,t,n=v()){let o=Cs(e,t);if(!o)return!1;let r=tl(e,t),i=Up(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Dp(i,n),!0):!1}function ui(e,t,n=v()){let o=Cs(e,t);if(!o)return;let r=tl(e,t),i=gu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],yu(i,n))}function $p(e,t,n=v()){let o=Cs(e,t);if(!o)return;let r=gu(n);r.upgrades[o]&&(delete r.upgrades[o],yu(r,n));let i=kp(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},Ap(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&Zo(e,s,n),co()}function pu(e,t,n=v()){let o=Cs(e,t);if(!o)return!1;let r=tl(e,t),i=gu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],yu(i,n),!0):!1}function un(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=jo(t?.tie??t?.tieKey),o=e?.areaKey||xe.STARTER_COVE;if(!n||!Uw.has(n))return{locked:!0,iconOverride:Mn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?Ct(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:fv()}catch{}function s(){if(dv())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:fn,titleOverride:Qt,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===we.UNLOCK_XP)return s();if(n===we.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Mn,useLockedBase:!0};let a=!1;try{let u=dn();a=Fe(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:fn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qt,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_INFUSE){if(!Sr())return{locked:!0,iconOverride:Mn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Wn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=dn();a=Fe(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:fn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qt,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_SURGE){if(!Dt())return{locked:!0,iconOverride:Mn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Wn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=dn();a=Fe(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:fn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qt,descOverride:u,reason:u}}return{locked:!1}}if(Fp.has(n)){if(Dt()||pu(o,t)){try{ui(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let d=dn();a=Fe(d)>=101}catch{}if(!a)return{locked:!0,iconOverride:Mn,useLockedBase:!0,titleOverride:Wn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{Np(o,t)}catch{}return{locked:!0,iconOverride:fn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qt,descOverride:u,reason:u}}if(Sr()||pu(o,t)){try{ui(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Mn,useLockedBase:!0};if(uv(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:fn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Qt,descOverride:a,reason:a}}let l=!1;try{let a=dn();l=Fe(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Mn,useLockedBase:!0,titleOverride:Wn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{Np(o,t)}catch{}return{locked:!0,iconOverride:fn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function Ko(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function jo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function Hw(e,t){let n=jo(t?.tie??t?.tieKey);if(n&&Dw.has(n))return!0;let o=zn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=Ko(l);if(a&&$w.has(`${a}:${i}`))return!0}return!1}function fv(){try{return!!ln()}catch{return!1}}function dv(e=v()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${qw}:${t}`)==="1"}catch{return!1}}function dn(){try{let e=typeof Qe=="function"?Qe():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function uu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function xp(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function zn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function ut(e){try{if(e=ws(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Ae(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=$e(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Fe(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=$e(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let f=Number(r);return Number.isFinite(f)?f:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let f=Math.floor(Math.log10(a));Number.isFinite(f)&&f>0&&(a/=Math.pow(10,f),u+=f)}else if(a<1){let f=Math.ceil(Math.log10(1/a));Number.isFinite(f)&&f>0&&(a*=Math.pow(10,f),u-=f)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let d=a*Math.pow(10,u);return Number.isFinite(d)?d:u>0?Number.MAX_VALUE:0}catch{let o=$e(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function Xw(e,t){let n=ut(e),o=ut(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor($e(n))+1,i=Math.floor($e(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function pv(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function Ms(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function mu(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:Ms(e.numUpgEvolutions)}function qp(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Fe(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let d=Math.max(0,Math.floor(r/qt));Number.isFinite(d)&&(i.numUpgEvolutions=d)}let s=yv(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:$e(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:pv(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,Yn(i,r)}function mv(e){let t=Ms(e),n=qt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Mr(o),capFmtText:xs(o)}}function hv(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor($e(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(qt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/qt)+1)}}function Yw(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Gp(e,t=du){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=Ko(t||e?.area||du);return Fw[n]||iv}function xt(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function vu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=mv(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function _r(e,t,n=du){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Gp(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let d=hv(t,Number(u?.level??u?.lvl??0));if(!(d>0))continue;let f=Yw(u.multiplier??u.mult??u.value??1,d),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=xt(i,f):p==="coin"||p==="coins"?s=xt(s,f):p==="mp"?l=xt(l,f):r=xt(r,f)}let a=mu(e);if(a>0){let u=Rw*a,d=Ae(u);r=xt(r,d)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function gv(e,t,n=du){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Gp(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=hv(t,s),a=null;try{let u=BigInt(s),d=BigInt(Math.max(0,l)),f=u+BigInt(qt)*d;f>0n&&(a=c.fromAny(f.toString()))}catch{}if(!a){let u=c.fromAny(qt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+qt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(qt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function yv(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=Vw[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Ts(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let f=Number(i);Number.isFinite(f)&&f>0&&(r=f)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let f=Math.pow(10,s);Number.isFinite(f)&&f>0&&(r=f)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let f=Math.exp(l);Number.isFinite(f)&&f>0&&(r=f)}if(!r){let f=Number(o.ratioMinus1);Number.isFinite(f)&&f>0&&(r=f+1)}let a=null;if(!r){let f=yv(e);f&&(r=f.ratio,f.ratioLog10!=null&&(s=f.ratioLog10),a=f.preset)}if(r>1){r=Number(r),i=pv(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=$e(n),d=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=d;try{let f=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),g=c.fromAny(e.costAtLevel?.(32)??0);f.cmp(p)===0&&f.cmp(g)===0&&(d.ratio=1,d.ratioMinus1=0,d.ratioLog10=0,d.ratioLn=0,d.ratioStr="1")}catch{}return d}catch{return null}}function Yn(e,t){let n=Ts(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Ae(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Ae(n.baseLog10+o*n.ratioLog10).floorToInteger()}function Ww(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function Wo(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Ts(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Ss+t*o.ratioLn)/Ss;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Ss+t*o.ratioLn,i=o.ratioLn*n,s=Ww(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Ss}function fu(e,t,n){if(!(n>0))return c.fromInt(0);let o=Ts(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=Wo(e,t,l);a=a.add(Ae(u))}if(s>0){let u=t+l,d=c.fromAny(e.costAtLevel(u));for(let f=0;f<s;f+=1)a=a.add(d),f+1<s&&(d=d.mulDecimalFloor(o.ratioStr))}return a}let i=Wo(e,t,n);return Ae(i)}function zw(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/Ss;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/Ss:e>0?e:0}function bv(e){if(!(e>0)||!Number.isFinite(e))return e;if(_p[0]=e,_p[0]<=0)return 0;Kw[0]-=1n;let t=_p[0];return t>0?t:0}function jw(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=bv(e);return n<e?n:e>1?e/2:0}function su(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function nl(e,t,n,o=_s,r={}){let i=Ts(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Fe(t))),d=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,f=typeof o=="number"?o:Fe(o),p=Number.isFinite(d)?Math.max(0,d-u):Lp,g=Number.isFinite(f)?Math.max(0,Math.floor(f)):Lp;if(g=Math.min(g,Lp,p),!(g>0)){let ee=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:ee,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let ee=Math.min(g,m),$=c.fromAny(e.costAtLevel(u)),G=s,j=0;for(;j<ee;){$=c.fromAny(e.costAtLevel(u+j));let ye=G.add($);if(ye.cmp(n)>0)break;G=ye,j+=1}let le=u+j,ue=Number.isFinite(d)&&le>=d,C=su(j);if(j<ee||ue||g<=j){let ye=ue?s:c.fromAny(e.costAtLevel(le));return{count:C,spent:G,nextPrice:ye,numericCount:j}}let W=(()=>{try{return zo(t??u,u).add(C)}catch{return u+j}})(),ce=nl(e,W,n.sub(G),g-j,r),me=ce?.count instanceof c?ce.count:su(ce?.numericCount??0),Z=C.add(me),re=(ce?.spent??s).add(G);return{count:Z,spent:re,nextPrice:ce?.nextPrice??s,numericCount:j+(ce?.numericCount??0)}}let y=$e(n),h=i.ratioLog10,b=i.ratioMinus1,w=c.fromAny(e.costAtLevel(u)),L=i.baseLog10+u*h;if(b>0&&(!Number.isFinite(y)||Math.abs(y)>1e6&&Math.abs(L)>1e6)){let ee=c.fromAny(e.costAtLevel(u));if(n.cmp(ee)<0)return{count:s,spent:s,nextPrice:ee,numericCount:0};let $=Number.isFinite(g)?Math.max(1,Math.floor(g)):Number.MAX_VALUE,G=1,j=1;for(;j<$;){let me=Wo(e,u,j);if(Ae(me).cmp(n)<=0){let re=j*2;if(!Number.isFinite(re)||re<=j){j=$;break}G=j,j=Math.min(re,$)}else break}let le=0;for(;G<j&&le<256;){let me=Math.max(G+1,Math.floor((G+j+1)/2)),Z=Wo(e,u,me);Ae(Z).cmp(n)<=0?G=me:j=me-1,le++}let ue=Math.max(1,G),C=su(ue),W=s,ce=s;if(!a)if(W=fu(e,u,ue),Number.isFinite(d)){let me=Math.max(0,Math.floor(d-Math.min(u,d)));ue>=me?ce=s:ce=Ae(L+ue*h)}else ce=Ae(L+ue*h);return{count:C,spent:W,nextPrice:ce,numericCount:ue}}if(n.cmp(w)<0)return{count:s,spent:s,nextPrice:w,numericCount:0};let k=!1,F=null,U=null;try{F=c.fromAny(e.costAtLevel(u+1))}catch{}try{let ee=Math.min(Number.isFinite(d)?Math.max(u+1,Math.floor(d)):u+32,u+32);U=c.fromAny(e.costAtLevel(ee))}catch{}!k&&!(i.ratioMinus1>0)&&(k=!0),F&&U&&(k=F.cmp(w)===0&&U.cmp(w)===0),!k&&!(i.ratioMinus1>0)&&(k=!0);let q=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.MAX_VALUE;if(k){let ee=zo(e.lvlCapBn??"Infinity","Infinity"),$=zo(t??0,0),G=ee.isInfinite?.()?c.fromAny("Infinity"):ee.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=Rp(w,n,G);return{count:le,spent:ue,nextPrice:C,numericCount:j}}if(!(h>0)||!(b>0)){let ee=zo(e.lvlCapBn??"Infinity","Infinity"),$=zo(t??0,0),G=ee.isInfinite?.()?c.fromAny("Infinity"):ee.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=Rp(w,n,G);return{count:le,spent:ue,nextPrice:C,numericCount:j}}let x=Math.log10(b);if(!Number.isFinite(x))return{count:s,spent:s,nextPrice:w,numericCount:0};let M=zw(y+x-L)/h;(!Number.isFinite(M)||M<0)&&(M=0);let _=Math.floor(Math.min(q,M));Number.isFinite(_)||(_=q),_<=0&&(_=1);let X=1e-7,Q=Wo(e,u,_),pe=0,K=2048;for(;_>0&&(!Number.isFinite(Q)||Q>y+X)&&pe<K;){let ee=Number.isFinite(Q)?Math.max(1,Math.ceil((Q-y)/Math.max(h,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-ee));if($<_)_=$;else{let G=bv(_);if(!(G<_))break;_=G}Q=_>0?Wo(e,u,_):Number.NEGATIVE_INFINITY,pe+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(w)>=0)_=1,Q=$e(w);else return{count:s,spent:s,nextPrice:w,numericCount:0};if(_<q){let ee=C=>{let W=C*2;return Number.isFinite(W)?W:Number.MAX_VALUE},$=_,G=Math.min(q,Math.max(_+1,ee(_))),j=Wo(e,u,G);for(;$<G&&Number.isFinite(j)&&j<=y+X&&G<q;)$=G,G=Math.min(q,ee(G)),j=Wo(e,u,G);let le=$,ue=G;for(let C=0;C<256&&le<ue;C+=1){let W=Math.floor((le+ue+1)/2),ce=Wo(e,u,W);Number.isFinite(ce)&&ce<=y+X?(le=W,Q=ce):ue=W-1}_=le}let ne=null;if(!a){ne=fu(e,u,_);let ee=0;for(;ne.cmp(n)>0&&_>0&&ee<K;){let $=jw(_);if(!($<_))break;_=$,ne=fu(e,u,_),ee+=1}if(_<=0)return{count:s,spent:s,nextPrice:w,numericCount:0};if(_<q&&ee<K)for(;_<q&&ee<K;){let $=u+_,G;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)G=c.fromAny(e.costAtLevel($));else{let le=L+_*h;G=Ae(le).floorToInteger()}}catch{break}let j=ne.add(G);if(j.cmp(n)>0)break;ne=j,_+=1,ee+=1}}let ve=s,he=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(d)){let ee=Math.max(0,Math.floor(d-Math.min(u,d)));if(_>=ee)ve=s;else if(he){let $=Math.floor(u+_);ve=c.fromAny(e.costAtLevel($))}else{let $=L+_*h;ve=Ae($)}}else if(he){let ee=Math.floor(u+_);ve=c.fromAny(e.costAtLevel(ee))}else{let ee=L+_*h;ve=Ae(ee)}return{count:su(_),spent:ne,nextPrice:ve,numericCount:_}}function Zw(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=$e(t),r=$e(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function Rp(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let d=BigInt(o)/BigInt(r),f=c.fromAny(d.toString());!n.isInfinite?.()&&f.cmp(n)>0&&(f=n);let p=e.mulBigNumInteger(f);return{count:Op(f),countBn:f,spent:p,nextPrice:e}}let i=$e(t),s=$e(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Ae(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:Op(l),countBn:l,spent:a,nextPrice:u}}function Jw(e,t,n,o){if(!n||o<=0)return{count:0};let r=$e(t),i=$e(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let y=0;y<64&&a<u;y+=1){let h=Math.max(0,Math.floor((a+u+1)/2));i+h*n.ratioLog-n.logDenom<=r?a=h:u=h-1}let d=Math.min(a,o);if(d<=0)return{count:0};let f=i+d*n.ratioLog-n.logDenom;if(f>r)return{count:0};let p=i+d*n.ratioLog,g=Ae(f),m=Ae(p);return{count:d,spent:g,nextPrice:m,spentLog:f,nextPriceLog:p}}function zo(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function Op(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Mr(e){return J(e instanceof c?e:c.fromAny(e??0))}function at(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=$e(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return J(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):J(c.fromAny(t))}catch{return"1"}}function xs(e){return Mr(e).replace(/<[^>]*>/g,"")}function hu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Ls(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=hu(n??t??0),s=hu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Fe(i),newLevel:Number.isFinite(o)?o:Fe(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Pt(e,t){return Yn(e,t)}function Sv(e,t=v()){return t==null?null:`ccc:upgrades:${e}:${t}`}function fi(e,t,n=v()){if(n==null)return null;let o=Ko(e),r=Hp(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function Qw(){nv.forEach(e=>{try{e?.()}catch{}}),nv.clear()}function ov(e){Qw()}function eE(e,t){if(typeof localStorage>"u")return;let n=Sv(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=fi(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}}),console.log(`[UpgradeMigration] Migrated ${i} upgrades for area ${e} slot ${t}`)}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function tE(e,t,n){eE(e,n);let o=fi(e,t,n);if(!o)return null;if(Is&&Qa.has(o))try{let r=Qa.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Cr.has(o))try{let r=Cr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function Es(e,t,n,o=v(),r={}){let i=fi(e,t,o);if(i){if(Is){Qa.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Cr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Cr.has(i)&&Cr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{rt(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function nE(e,t,n=v()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&Es(e,o.id,o,n)})}function Hp(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return zn(t.id);let n=zn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=jo(n);if(o){let r=Mp.get(o);if(r){let i=Ko(e);if(!i||Ko(r.area)===i)return zn(r.id)}}}return n}function Iv(e,t,n=v()){let o=n==null?"null":String(n),r=Hp(e,t);return`${o}:${e}:${zn(r)}`}function uo(e,t){let n=Hp(e,t),o=zn(n),r=v(),i=Iv(e,o,r),s=Pp.get(i);if(s)return s;let l=ks(e,o),a=tE(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,Es(e,o,a,r)}let d=a.lvl,f=a.nextCost,p=a.nextCostLvl;a.lvl=ws(a.lvl),a.nextCost=ws(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=ws(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==d||a.nextCost!==f||a.nextCostLvl!==p)&&(u=!0);let g=0;l?.upgType==="HM"&&(g=Ms(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),vu(l,g));let m=ut(a.lvl),y=Fe(m);try{let R=l?.lvlCapBn??c.fromAny("Infinity");if(!R.isInfinite?.()&&m.cmp(R)>0){let k=R.clone?.()??R;y=Fe(k);let F=k.toStorage();a.lvl=F,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=F,Es(e,o,a,r)}}catch{}let h=null;try{h=m?.toStorage?.()??ut(y).toStorage()}catch{}h&&a.lvl!==h&&(a.lvl=h,u=!0);let b=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,w=!b||b!==h,L=null;if(!w&&a.nextCost!=null)try{L=c.fromAny(a.nextCost)}catch{L=null,w=!0}if(!L||w){if(l)try{L=c.fromAny(l.costAtLevel(y))}catch{L=c.fromInt(0)}else L=c.fromInt(0);try{a.nextCost=L.toStorage(),h?a.nextCostLvl=h:delete a.nextCostLvl,u=!0}catch{}}if(u)try{Es(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let R=c.fromAny("Infinity");l.lvlCapBn=R,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Mr(R),l.lvlCapFmtText=xs(R)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:y,lvlBn:m,nextCostBn:L,slot:r,hmEvolutions:g},Pp.set(i,s),s}function Tr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??v();if(!n||o==null)return;let r=zn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??ut(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Fe(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??ut(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=ut(e.lvl??0).toStorage()}i.lvl=ws(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=ws(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=Ms(e.hmEvolutions)),Es(n,r,i,o,t),e.slot=o}function Zo(e,t,n=v()){Pp.delete(Iv(e,t,n))}function Ct(e,t){return uo(e,t).lvl}function Bp(e,t){return uo(e,t).hmEvolutions??0}function wv(e,t){if(!t)return{locked:!1};let n=fv(),o=n?dn():c.fromInt(0),r=n?Fe(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let d=Hw(e,t),f="Unlock the XP system to reveal this upgrade",p=dv();if(d)if(p)i={locked:!0,iconOverride:fn,titleOverride:Qt,descOverride:f,reason:f,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let g='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Mn,titleOverride:Wn,descOverride:g,reason:g,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Mn,titleOverride:Wn,descOverride:f,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=xp({locked:!1},i);if(typeof t.computeLockState=="function")try{let d={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,baseLocked:s.locked,getUpgradeLevel(p){return Ct(e,p)}},f=t.computeLockState(d);s=xp(s,f)}catch{}let l=v(),a=Cs(e,t),u=a?pu(e,t,l):!1;if(a){let d=kp(l),f=gu(l),p=Up(l),g=a.replace(/_/g,"-"),m=tl(e,t),y=!1;bs(d,g,a)&&(y=!0),m&&bs(d,m,a)&&(y=!0),y&&Ap(d,l);let h=!1;bs(f,g,a)&&(h=!0),m&&bs(f,m,a)&&(h=!0),h&&yu(f,l);let b=!1;bs(p,g,a)&&(b=!0),m&&bs(p,m,a)&&(b=!0),b&&Dp(p,l)}if(s.locked){let d=!!s.hidden;s.iconOverride||(s.iconOverride=Mn),d?s.titleOverride||(s.titleOverride=Qt):(!s.titleOverride||s.titleOverride===Qt)&&(s.titleOverride=Wn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:d&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Mn||s.iconOverride===fn)&&delete s.iconOverride,(s.titleOverride===Qt||s.titleOverride===Wn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Mn),a){let d=kp(l),f=d.upgrades[a]||{},p=jo(t?.tie??t?.tieKey),g=p&&sv.has(p),m=p&&Fp.has(p),y=f.status||"locked";if(pu(e,t,l))y="unlocked";else if(uv(e,t,l)&&y==="locked"){let x=!1;try{x=Fe(dn())>=31}catch{}let P=!1;try{P=Fe(dn())>=101}catch{}g&&!x||m&&!P?y="locked":y="mysterious"}let h=iu(y),b=Ep(s),w=iu(b),L=()=>{s.locked=!0;let x=f.snapshot;x&&typeof x=="object"&&(s=xp(s,x)),s.iconOverride=fn,s.titleOverride=Qt;let P=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=P,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};h>w&&(y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):y==="mysterious"&&L(),b=Ep(s),w=iu(b));let R=!1,k=f&&typeof f=="object"&&typeof f.status=="string"?f.status:"locked",F=g,U=!1;try{U=Fe(dn())>=31}catch{}let q=!1;try{q=Fe(dn())>=101}catch{}if((F&&!U&&k==="mysterious"||m&&!q&&k==="mysterious")&&(k="locked"),(!f||typeof f!="object"||Object.keys(f).length!==1||f.status!==k)&&(d.upgrades[a]={status:k},R=!0),w>h){if(f.status=b,d.upgrades[a]={status:f.status},R=!0,y=b,h=w,b==="unlocked")ui(e,t,l);else if(b==="mysterious"){let x=!1;try{x=Fe(dn())>=31}catch{}(!g||x)&&Np(e,t,l)}}y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Mn||s.iconOverride===fn)&&delete s.iconOverride,(s.titleOverride===Qt||s.titleOverride===Wn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,f.status!=="unlocked"&&(d.upgrades[a]={status:"unlocked"},R=!0),ui(e,t,l)):y==="mysterious"&&b!=="mysterious"&&(L(),b=Ep(s),w=iu(b)),R&&Ap(d,l)}return s}function ol(e,t){return!!wv(e,t).locked}function Xp(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:mu(e),{capBn:r,cap:i}=mv(o);try{return t?.cmp?.(r)>=0}catch{}let s=Fe(t);return Number.isFinite(s)&&s>=i}function Ln(e,t){let n=uo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():ut(n.lvl??0)}function Ev(e,t){let n=uo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??ut(n.lvl??0),i=Fe(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function Yo(e,t,n,o=!0,r={}){let i=uo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,vu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,d=hu(i.lvlBn??ut(i.lvl??0)),f=ut(n);f.isInfinite?.()&&(f=c.fromAny("Infinity"));let p=f;try{s&&rv(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=ut(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=ut(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let g=Fe(p);if(!s)return i.lvl=g,i.lvlBn=p,i.nextCostBn=c.fromInt(0),Tr(i),Zo(e,t),co(),i.lvl;i.lvl=g,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(g))}catch{i.nextCostBn=c.fromInt(0)}return Tr(i,{deferSave:r?.deferSave}),Zo(e,t),Ls(s,u,d,i.lvl,i.lvlBn),co(),i.lvl}function Ft(e){return bu.filter(t=>t.area===e)}function ks(e,t){let n=Ko(e),o=zn(t),r=jo(typeof o=="string"?o:t);return bu.find(i=>n&&Ko(i.area)!==n?!1:!!(zn(i.id)===o||r&&i.tieKey===r))||null}function Ho(e,t){let n=typeof t=="object"&&t?t:ks(e,t);return wv(e,n)}function oE(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function Ac(e){return e?oE(e.icon):""}function rE(e,t){let n=ks(e,t),o=Ln(e,t),r=Fe(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Ba(e,t){let n=uo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(ol(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??ut(r),s=hu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(rv(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Tr(n),Zo(e,t),co(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,d=u?O[u]:null,f=c.fromInt(0);if(d&&!a.isZero?.()){let g=d.value;if((g instanceof c?g:c.fromAny(g??0)).cmp(a)<0)return{bought:0,spent:0};f=a.clone?.()??c.fromAny(a),d.sub(f)}else{if(!a.isZero?.())return{bought:0,spent:0};f=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=Fe(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(f,n.lvl):o.costAtLevel(n.lvl)),Tr(n),Zo(e,t),Ls(o,r,s,n.lvl,n.lvlBn),co(),{bought:1,spent:f}}function Ld(e,t){let n=uo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??ut(n.lvl);if(!Xp(o,r,n.hmEvolutions))return{evolved:!1};let i=Ms(n.hmEvolutions)+1;n.hmEvolutions=i,vu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Tr(n),Zo(e,t),Ls(o,n.lvl,r,n.lvl,r),co(),{evolved:!0}}function kc(e,t){let n=uo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(ol(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??ut(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=O[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Ba(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let b=i.clone?.()??ut(i),w=Fe(b),L=b.toStorage?.(),R;if(o.upgType==="HM"){if(R=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let F=c.fromAny("Infinity");o.lvlCapBn=F,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Mr(F),o.lvlCapFmtText=xs(F)}}else{let F=o.lvlCapBn?.clone?.()??zo(o.lvlCap??1/0,1/0);R=F?.clone?.()??F}let k=R.sub(b);if(k.isZero?.()){let F=Xw(R,b);F.isZero?.()||(k=F)}if(k.isZero?.()){let F=R.toStorage?.();if(L&&F&&L!==F)if(R.isInfinite?.())try{k=c.fromAny("Infinity")}catch{k=c.fromInt(1)}else k=c.fromInt(1)}return n.lvlBn=R.clone?.()??R,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),O[o.costType].set(u),Tr(n),Zo(e,t),Ls(o,w,b,n.lvl,n.lvlBn),co(),{bought:k,spent:c.fromInt(0)}}let d=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(d)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(s)?Math.max(0,s-r):_s;if(!(f>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=nl(o,i,u,f),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),y=u.sub(m);O[o.costType].set(y);let h=i.add(g);return n.lvlBn=h,n.lvl=Fe(h),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Tr(n),Zo(e,t),Ls(o,r,i,n.lvl,n.lvlBn),co(),{bought:g,spent:m}}function Fa(e,t,n){let o=uo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(ol(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??ut(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=O[r.costType]?.value,d=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(d.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Fe(n):void 0,g=Number.isFinite(f)?Number.isFinite(p)?Math.min(f,p):f:p,m=nl(r,s,d,g),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let h=m.spent??c.fromInt(0),b=d.sub(h);O[r.costType].set(b);let w=s.add(y);return o.lvlBn=w,o.lvl=Fe(w),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Tr(o),Zo(e,t),Ls(r,i,s,o.lvl,o.lvlBn),co(),{bought:y,spent:h}}function ri(e,t,n,o=_s,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=nl(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function co(){if(Is){Cp=!0,Ip();return}Ip(),jy()}function qn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),xe.STARTER_COVE}function Ua(e,t){let n=ks(e,t);if(!n)return null;let o=Ln(e,t),r=Fe(o),i=Mr(o),s=xs(o),l=n.lvlCapBn??zo(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Mr(l),u=n.lvlCapFmtText??xs(l),d=r<n.lvlCap?Ev(e,t):c.fromInt(0),f=Mr(d),p=O[n.costType]?.value,g=p instanceof c?p:c.fromAny(p??0),m=Ho(e,t),y=!!m.locked,h=m.titleOverride??n.title,b=m.descOverride??n.desc;if(e===Ke&&zn(t)===Vr){let k=In(),F=!1;if(k===1/0||typeof k=="string"&&k==="Infinity"?F=!0:typeof k=="bigint"?F=k>=2n:typeof k=="number"&&(F=k>=2),F&&b){let U=10,q=!1,x=In();if(x===1/0||typeof x=="string"&&x==="Infinity"||x===Number.POSITIVE_INFINITY?q=!0:typeof x=="bigint"?q=x>=8n:typeof x=="number"&&(q=x>=8),q){let P=Bt();U=Math.pow(10,P)}if(Math.abs(U-1)>1e-4){let P="10";U!==10&&(P=at(U)),b=b.replace("Generates the equivalent of picking up a Coin on an interval",`Generates the equivalent of picking up ${P} Coins (Surge 2!) on an interval`)}}}let w=Gp(n,e),L="";typeof n.effectSummary=="function"&&!(y&&m.hideEffect)&&(L=n.effectSummary(r),typeof L=="string"&&(L=L.trim()));let R=m.iconOverride??Ac(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:d,nextPriceFmt:f,have:g,haveFmt:O[n.costType]?.fmt(g)??String(g),effect:L,iconUrl:R,lockState:m,locked:y,areaKey:e,hmMilestones:w,displayTitle:h,displayDesc:b,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?Bp(e,t):0,hmReadyToEvolve:n.upgType==="HM"?Xp(n,o,Bp(e,t)):!1,hmNextMilestone:n.upgType==="HM"?gv(n,o,e):null}}function iE(e,t){let n=ks(e,t);if(!n||n.upgType!=="HM")return null;let o=Ln(e,t);return gv(n,o,e)}function sE(e){return Ae($e(e??0))}function Ed(e,t){let n=uo(e,t),o=n.upg;if(!o)return{bought:0};let r=Sv(e,n.slot);if(sn(r))return{bought:0};let i=fi(e,t,n.slot);if(sn(i))return{bought:0};if(ol(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??ut(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&Xp(o,l,n.hmEvolutions))return{bought:0};let d=O[o.costType]?.value,f=d instanceof c?d.clone?.()??c.fromAny(d):c.fromAny(d??0);if(f.isZero?.())return{bought:0};let p=nl(o,l,f,_s),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:0};let m=l.add(g);return Ow(),Yo(e,t,m,!0,{deferSave:!0}),{bought:g}}function _d(e,t){let n=uo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(ol(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??ut(n.lvl),i=Fe(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=O[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=ri(o,r,a,c.fromAny("Infinity")),d=u.numericCount;if(d<=0)return{bought:0,spent:c.fromInt(0)};let f=g=>{if(g<=0)return!0;let m=fu(o,i,g-1),y=a.sub(m),h=i+g-1,b=c.fromAny(o.costAtLevel(h)),w=y.div(10);return b.cmp(w)<=0},p=0;if(d<2e3){let g=u.spent,m=d;for(;m>0;){let y=i+m-1,h=c.fromAny(o.costAtLevel(y)),b=g.sub(h),L=a.sub(b).div(10);if(h.cmp(L)<=0){p=m;break}g=b,m--}}else{let g=0,m=d;for(;g<m;){let y=Math.ceil((g+m)/2);f(y)?g=y:m=y-1}p=g}return p<=0?{bought:0,spent:c.fromInt(0)}:Fa(e,t,p)}var _s,qt,VC,Rw,du,xe,Is,ev,Qa,Cp,Cr,tv,Bw,wp,we,iv,Fw,Mn,fn,Qt,Wn,sv,Fp,Uw,Dw,$w,qw,av,lv,cv,Gw,au,lu,cu,Mp,YC,Tp,ru,Wt,Ss,Vw,Lp,vv,_p,Kw,bu,Pp,nv,cn=De(()=>{bt();Lt();zt();Dn();wo();So();ro();Yr();Qy();_s=c.fromAny("Infinity"),qt=1e3,VC=c.fromInt(1e3),Rw=3,du="",xe={STARTER_COVE:"starter_cove",AUTOMATION:Ke},Is=!1,ev=new Map,Qa=new Map,Cp=!1,Cr=new Map,tv=null;Bw=308;wp=1024;we={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},iv=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],Fw={[xe.STARTER_COVE]:iv},Mn="img/misc/locked.webp",fn="img/misc/mysterious.webp",Qt="Hidden Upgrade",Wn="Locked Upgrade",sv=new Set([we.COIN_VALUE_II,we.XP_VALUE_II,we.MP_VALUE_I,we.MAGNET,we.ENDLESS_XP]),Fp=new Set([we.COIN_VALUE_III,we.XP_VALUE_III,we.MP_VALUE_II,we.FASTER_COINS_III,we.ENDLESS_MP]),Uw=new Set([we.UNLOCK_XP,we.UNLOCK_FORGE,we.UNLOCK_INFUSE,we.UNLOCK_SURGE,...sv,...Fp]),Dw=new Set([we.FASTER_COINS_II,we.COIN_VALUE_I,we.BOOK_VALUE_I,we.XP_VALUE_I]),$w=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),qw="ccc:merchantMet",av="ccc:shop:reveals",lv="ccc:shop:permaUnlocks",cv="ccc:shop:permaMyst",Gw={locked:0,mysterious:1,unlocked:2},au=new Map,lu=new Map,cu=new Map,Mp=new Map,YC=jo(we.BOOK_VALUE_I),Tp=c,ru=e=>Tp.fromAny(e??0),Wt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=ru(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Tp.fromInt(1).add(r.mulDecimal(n))}catch{let i=$e(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Ae(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=ru(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Tp.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(ru(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=ru(i);if(o>0){let l=$e(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let d=Math.pow(n,a);if(Number.isFinite(d))return d}return Ae(u)}}catch{}try{let l=Fe(s),a=o*l;return Ae(a)}catch{return c.fromInt(1)}}}};Ss=Math.log(10);Vw={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=mu(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=mu(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};Lp=(()=>{try{let e=Fe(_s);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),vv=new ArrayBuffer(8),_p=new Float64Array(vv),Kw=new BigInt64Array(vv);bu=[{area:xe.STARTER_COVE,id:1,tie:we.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:2,tie:we.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:un,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{$r()}catch{}}},{area:xe.STARTER_COVE,id:3,tie:we.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:4,tie:we.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(.5),onLevelChange(){try{vn()}catch{}}},{area:xe.STARTER_COVE,id:5,tie:we.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>uu(e)>0?2:1,onLevelChange({newLevel:e}){Ja(e)}},{area:xe.STARTER_COVE,id:6,tie:we.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${at(t)}x`},effectMultiplier:Wt.addFlatPerLevel(2)},{area:xe.STARTER_COVE,id:7,tie:we.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:un,onLevelChange({newLevel:e}){if((e??0)>=1)try{yp()}catch{}}},{area:xe.STARTER_COVE,id:8,tie:we.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${J(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(10),onLevelChange(){try{vn()}catch{}}},{area:xe.STARTER_COVE,id:9,tie:we.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:10,tie:we.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:11,tie:we.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=uu(e),n=at(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>uu(e)},{area:xe.STARTER_COVE,id:12,tie:we.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:qt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return Yn(this,e)},nextCostAfter(e,t){return Yn(this,t)},computeLockState:un,effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=_r(this,t,this.area),r=xt(n,o);return`XP value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:13,tie:we.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:un,onLevelChange({newLevel:e}){if((e??0)>=1)try{vp()}catch{}}},{area:xe.STARTER_COVE,id:14,tie:we.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${J(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1e3)},{area:xe.STARTER_COVE,id:15,tie:we.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:16,tie:we.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:17,tie:we.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:un,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${at(t)}x`},effectMultiplier:Wt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:18,tie:we.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:qt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return Yn(this,e)},nextCostAfter(e,t){return Yn(this,t)},computeLockState:un,effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=_r(this,t,this.area),r=xt(n,o);return`MP value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:19,tie:we.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:un,onLevelChange({newLevel:e}){if((e??0)>=1)try{bp()}catch{}}},{area:xe.STARTER_COVE,id:20,tie:we.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return Yn(this,e)},nextCostAfter(e,t){return Yn(this,t)},computeLockState(e){let t=In(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=dn();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:fn,titleOverride:Qt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Wn,descOverride:"Locked"}},onLevelChange(){try{vn()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=_r(this,t,this.area),r=xt(n,o);return`Coin value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:21,tie:we.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return Yn(this,e)},nextCostAfter(e,t){return Yn(this,t)},computeLockState(e){let t=In(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=dn();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:fn,titleOverride:Qt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Wn,descOverride:"Locked"}},onLevelChange(){try{vn()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=_r(this,t,this.area),r=xt(n,o);return`Coin value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:22,tie:we.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:qt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return Yn(this,e)},nextCostAfter(e,t){return Yn(this,t)},computeLockState(e){let t=In(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=dn();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:fn,titleOverride:Qt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Wn,descOverride:"Locked"}},onLevelChange(){try{vn()}catch{}},effectSummary(e){let t=ut(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=_r(this,t,this.area),r=xt(n,o);return`Coin value bonus: ${at(r)}x`},effectMultiplier:Wt.powPerLevel(1.1)},...Bh];for(let e of bu){let t=jo(e.tie??e.tieKey);t&&!Mp.has(t)&&Mp.set(t,e),e.baseCost=zo(e.baseCost??0,0),e.baseCostBn=e.baseCost,e.numUpgEvolutions=Ms(e.numUpgEvolutions),e.upgType==="HM"?vu(e,e.numUpgEvolutions):(e.lvlCapBn=zo(e.lvlCap??1/0,1/0),e.lvlCap=Op(e.lvlCapBn),e.lvlCapFmtHtml=Mr(e.lvlCapBn),e.lvlCapFmtText=xs(e.lvlCapBn)),e.bulkMeta=Zw(e),Ts(e)}Pp=new Map;nv=new Map;typeof window<"u"&&(ov(v()),window.addEventListener("saveSlot:change",()=>{ov(v()),co()}));Jy()});var Jv={};vt(Jv,{applyAllCurrencyOverridesForActiveSlot:()=>dl,applyStatMultiplierOverride:()=>$n,getDebugCurrencyMultiplierOverride:()=>sl,getDebugStatMultiplierOverride:()=>wE,setDebugCurrencyMultiplierOverride:()=>Gv,setDebugPanelAccess:()=>ox,setDebugStatMultiplierOverride:()=>Tn});function fl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function fE(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function pn(e){typeof e=="function"&&Wp.push(e)}function Cu(){return{sections:new Set,subsections:new Set}}function dE(){let e=document.getElementById(ll);if(!e)return Cu();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function pE(e){let{sections:t,subsections:n}=Rv??Cu();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function Bv(){Wp.forEach(e=>{try{e?.()}catch{}}),Wp=[],Jp.length=0}function Ut(e){!e||typeof e.refresh!="function"||Jp.push(e)}function ct(e){Jp.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function mE(){if(typeof window>"u")return;let e=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();ct(b=>b.type==="currency"&&b.key===m&&b.slot===h)};window.addEventListener("currency:change",e,{passive:!0}),pn(()=>window.removeEventListener("currency:change",e));let t=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();ct(b=>b.type==="currency-mult"&&b.key===m&&b.slot===h)};window.addEventListener("currency:multiplier",t,{passive:!0}),pn(()=>window.removeEventListener("currency:multiplier",t));let n=g=>{let{slot:m,changeType:y,unlocked:h}=g?.detail??{},b=m??v();ct(w=>w.type==="xp"&&w.slot===b),ct(w=>w.type==="stat-mult"&&w.key==="xp"&&w.slot===b),(y==="unlock"||typeof h=="boolean")&&ct(w=>w.type==="unlock"&&(w.slot==null||w.slot===b))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),pn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=g=>{let{changeType:m,slot:y}=g?.detail??{},h=y??v();ct(b=>b.type==="mutation"&&b.slot===h),ct(b=>b.type==="stat-mult"&&b.key==="mutation"&&b.slot===h),m==="unlock"&&ct(b=>b.type==="unlock"&&(b.slot==null||b.slot===h))};window.addEventListener("mutation:change",o,{passive:!0}),pn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let g=v();ct(m=>m.type==="upgrade"&&m.slot===g),ct(m=>m.type==="currency-mult"&&m.slot===g),ct(m=>m.type==="stat-mult"&&m.slot===g)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),pn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let g=v();ct(m=>m.slot===g)};window.addEventListener("saveSlot:change",i,{passive:!0}),pn(()=>window.removeEventListener("saveSlot:change",i));let s=g=>{let{slot:m,key:y}=g?.detail??{},h=m??v();ct(b=>b.type==="unlock"&&(b.slot==null||b.slot===h)&&(b.key==null||b.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),pn(()=>window.removeEventListener("unlock:change",s));let l=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="workshop-level"&&h.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),pn(()=>window.removeEventListener("workshop:change",l));let a=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="surge-level"&&h.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),pn(()=>window.removeEventListener("surge:level:change",a));let u=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="tsunami-nerf"&&(h.slot==null||h.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),pn(()=>window.removeEventListener("surge:nerf:change",u));let d=g=>{let{slot:m}=g?.detail??{},y=m??v();ct(h=>h.type==="lab-level"&&(h.slot==null||h.slot===y)),ct(h=>h.type==="stat-mult"&&h.key==="rp"&&(h.slot==null||h.slot===y))};window.addEventListener("lab:level:change",d,{passive:!0}),pn(()=>window.removeEventListener("lab:level:change",d));let f=g=>{let{id:m,level:y}=g?.detail??{},h=v();ct(b=>b.type==="lab-node-level"&&b.slot===h&&b.id===m),m===1&&ct(b=>b.type==="tsunami-nerf"&&(b.slot==null||b.slot===h))};window.addEventListener("lab:node:change",f,{passive:!0}),pn(()=>window.removeEventListener("lab:node:change",f));let p=g=>{let{id:m,rp:y}=g?.detail??{},h=v();ct(b=>b.type==="lab-node-rp"&&b.slot===h&&b.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),pn(()=>window.removeEventListener("lab:node:rp",p))}function Mu(){return[{key:xe.STARTER_COVE,title:"The Cove",currencies:[{key:Me.COINS,label:"Coins"},{key:Me.BOOKS,label:"Books"},{key:Me.GOLD,label:"Gold"},{key:Me.MAGIC,label:"Magic"},{key:Me.GEARS,label:"Gears"},{key:Me.WAVES,label:"Waves"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function Fv(){if(document.getElementById(Su))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Su;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Su,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Su,document.head.appendChild(n)}function Kp(){let e=document.getElementById(Nv);e&&e.remove()}function hE(){return gi&&je&&v()!=null&&!fl()&&fE()}function gE(e){e?.detail?.visible&&_o(),Au()}function wu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${Ov++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Kn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${Pv++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Tt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Qp(e,t=v()){let n=t??v();return n==null?null:`${gt.CURRENCY[e]}:${n}`}function il(e,t=v()){let n=t??v();if(n==null)return c.fromInt(0);let o=O?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return ta(n,e)}catch{return c.fromInt(0)}}function yE(e,t,n=v()){let o=n??v(),r=il(e,o);if(o==null||o!==v())return{previous:r,next:r};let i=Qp(e,o),s=i&&fo(i);s&&Ps(i);let l=r;try{hn(o),l=Ci(e,t,{previous:r})??r,i&&rt(i)}catch{}finally{s&&bi(i)}return ct(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function jn(e,t){return`${e??"null"}::${t}`}function em(e,t){return cl.get(jn(e,t))??null}function vE(e,t=v()){let n=t??v();return!e||n==null?null:`${gt.MULTIPLIER[e]}:${n}`}function bE(e,t=v()){let n=jn(t,e);cl.delete(n),Rs.delete(n),ct(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function tm(e,t){let n=!Tu(t,e),o=jn(e,t),r=al.get(o);if(!n&&r)return r;let i=SE(t,e);return i?(al.set(o,i),i):(n&&al.delete(o),null)}function Uv(e,t){ct(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function Dv(e,t=v()){let n=vi(e,t);if(al.delete(jn(t,e)),di.delete(jn(t,e)),!(!n||typeof localStorage>"u")&&!fo(n)){try{localStorage.removeItem(n)}catch{}Uv(e,t)}}function Tu(e,t=v()){return fo(vi(e,t))}function $v(e,t){return Tu(t,e)?tm(e,t):null}function kn(e,t=v()){let n=yi(e);return ku(e,t,n)??n}function vi(e,t=v()){if(!e)return null;let n=t??v();return n==null?null:`${aE}:${e}:${n}`}function yi(e){try{if(e==="xp"){let t=Hl();if(t)return t}else if(e==="mutation"){let t=Ru?.();if(t)return t;let n=Nu();if(n)return n}else if(e==="spawnRate"){let t=ns(xe.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return ic()}catch{}return c.fromInt(1)}function SE(e,t=v()){let n=vi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function IE(e,t,n){let o=vi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=fo(o),s=i&&Ns?Ns:localStorage.setItem.bind(localStorage);i&&!Ns&&Ps(o),s(o,r.toStorage?.()??String(r)),i&&!Ns&&bi(o)}catch{}}function nm(e,t=v()){if(t==null)return;let n=em(t,e);if(!n||t!==v())return;let o=jn(t,e);if(!xu.has(o)){xu.add(o);try{let r=O?.[e]?.mult?.get?.();Tt(r,n)||O?.[e]?.mult?.set?.(n)}catch{}finally{xu.delete(o)}}}function qv(){if(!(Cv||typeof window>"u")){Cv=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??v(),i=jn(r,t);if(!r||!cl.has(i)||xu.has(i))return;let s=Rs.get(i),l=em(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let d=u.div(a),f=d.sig===1n&&d.e===0&&d._eOffset===0n?1:null,p=l.mulBigNumInteger(d);cl.set(i,p)}}catch{}Rs.set(i,o)}else o&&Rs.set(i,o);nm(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{dl()},{passive:!0})}catch{}}}function dl(){let e=v();e!=null&&Object.values(Me).forEach(t=>{nm(t,e)})}function Gv(e,t,n=v()){if(!e||n==null)return null;qv();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=jn(n,e);if(cl.set(r,o),!Rs.has(r)){let i=O?.[e]?.mult?.get?.();Rs.set(r,i)}return nm(e,n),o}function sl(e,t=v()){return!e||t==null?null:em(t,e)}function Tn(e,t,n=v()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return al.set(jn(n,e),o),di.set(jn(n,e),yi(e)),IE(e,n,o),Uv(e,n),o}function wE(e,t=v()){return!e||t==null?null:tm(t,e)}function $n(e,t,n=v()){let o=yi(e),r=ku(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Tt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=jn(n,e),l=di.get(s),a=Tu(e,n)&&l?l:o,u=null;try{let d=c.fromAny(r),f=c.fromAny(a);f.isZero()||(u=d.div(f))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function ku(e,t,n){let o=tm(t,e),r=jn(t,e);if(!o)return di.delete(r),null;let i=di.get(r),s=Tu(e,t);if(!i)di.set(r,n);else if(!Tt(i,n))return s?(di.set(r,n),o):(Dv(e,t),null);return o}function EE(){if(!(Lv||typeof localStorage>"u")){Lv=!0;try{Ns=localStorage.setItem.bind(localStorage),_v=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!Os.has(e))return Ns(e,t)},localStorage.removeItem=e=>{if(!Os.has(e))return _v(e)}}catch{}}}function fo(e){return e!=null&&Os.has(e)}function bi(e){e&&(EE(),Os.add(e))}function Ps(e){e&&Os.delete(e)}function xE(e){return e?fo(e)?(Ps(e),!1):(bi(e),!0):!1}function LE(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=fo(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(xE(e),typeof t=="function")try{t(fo(e))}catch{}o()}),o(),{button:n,refresh:o}}function _E(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>fo(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>fo(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?Ps(u):bi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function CE(){let e=document.getElementById(ll);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function ME(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{fo(r)&&(o.push(r),Ps(r))});try{return t?.()}finally{o.forEach(r=>bi(r))}}function TE(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function om(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function jp(e,t){e.classList.toggle("debug-invalid",!t)}function Ze(){let e=v();try{hn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function Hv(e=v()){return e==null?null:`${lE}:${e}`}function Xv(e=v()){let t=Hv(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function Vv(e,t=v()){let n=Hv(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,zp);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function kE(e,t=v()){let n=Xv(t);return n.unshift(e),n.length>zp&&(n.length=zp),Vv(n,t),n}function Je(e){let t=v();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};kE(o,t),rm()}function rm(){if(!As)return;let e=Xv();if(e.length===0){As.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",As.appendChild(t);return}As.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function Yv(e=v()){return e==null?null:`${Na}:${e}`}function Wv(e,t=v()){let n=Yv(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function zv(e=v()){let t=Yv(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function AE(e){if(e){if(Object.values(Me).includes(e.type)){try{e.type===Me.BOOKS?O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount):O[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function NE(){let e=v();if(e==null)return{completed:0};let t=zv(e),n=0;return Object.entries(gc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,AE(r.reward))}),Wv(t,e),{completed:n}}function RE(){let e=v();if(e==null)return{restored:0};let t=zv(e),n=0;return Object.entries(gc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),Wv(t,e),{restored:n}}function en(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let h=document.createElement("span");h.className="debug-panel-id",h.textContent=`(ID: ${o})`,a.appendChild(h)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let d=!1,f=null,p=!1,g=r?LE(r,{onToggle:i}):null,m=h=>{if(d){f=h;return}f=null,u.value=typeof s=="function"?s(h):TE(h)};l.appendChild(u),g&&l.appendChild(g.button);let y=()=>{let h=om(u.value);if(!h){jp(u,!1);return}jp(u,!0);let b=r&&fo(r);b&&Ps(r);try{n(h,{input:u,setValue:m})}finally{b&&bi(r),g&&g.refresh()}};return u.addEventListener("focus",()=>{d=!0}),u.addEventListener("change",y),u.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),p=!0,y(),u.blur())}),u.addEventListener("blur",()=>{if(d=!1,p||y(),p=!1,f!=null){let h=f;f=null,m(h)}}),m(t),g&&g.refresh(),{row:l,input:u,setValue:m,isEditing:()=>d}}function OE({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let d=document.createElement("div");d.className="debug-unlock-text";let f=document.createElement("span");if(f.className="debug-unlock-title",f.textContent=e,d.appendChild(f),t){let y=document.createElement("span");y.className="debug-unlock-desc",y.textContent=`- ${t}`,d.appendChild(y)}s.appendChild(l),s.appendChild(d);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",y=>{l.contains(y.target)||p()});let g=!1,m=()=>{let y=!1;try{y=typeof n=="function"?!!n():!1}catch{}return a.checked=y,g=y,y};return a.addEventListener("change",()=>{let y=g,h=a.checked;try{h?o?.():r?.()}catch{}Ze();let b=m();y!==b&&Je(`Toggled ${e} [GOLD]${y?"True":"False"}[/GOLD] \u2192 [GOLD]${b?"True":"False"}[/GOLD]`)}),m(),Ut({type:"unlock",slot:i,refresh:m}),s}function PE(e){try{if(e instanceof c||typeof e?.toScientific=="function")return J(e);let t=Number(e);return Number.isFinite(t)?J(t):String(e??"\u2014")}catch{return"\u2014"}}function BE({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},d=!1;if(l.forEach(({config:f,el:p})=>{if(f.type==="select"){u[f.key]=p.value;return}let g=om(p.value),m=g instanceof c;if(jp(p,m),!m){d=!0;return}u[f.key]=g}),d||typeof n!="function"){s.textContent="\u2014";return}try{let f=n(u);s.innerHTML=PE(f)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let d=Object.assign({type:"text",defaultValue:""},u);if(d.key)if(d.type==="select"){let f=document.createElement("select");f.className="debug-panel-input",(d.options||[]).forEach(({value:p,label:g})=>{let m=document.createElement("option");m.value=p,m.textContent=g??p,d.defaultValue!=null&&d.defaultValue===p&&(m.selected=!0),f.appendChild(m)}),f.addEventListener("change",a),i.appendChild(f),l.push({config:d,el:f})}else{let f=document.createElement("input");f.type="text",f.className="debug-panel-input",f.placeholder=d.label||"",f.value=d.defaultValue??"",f.addEventListener("input",a),f.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(f),l.push({config:d,el:f})}}),a(),o}function kr({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return Qe()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{$r()}catch{}let d=pi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),s!=null)try{let f=s.toStorage?.()??c.fromAny(s).toStorage(),p=pi.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(l!=null)try{let f=l.toStorage?.()??c.fromAny(l).toStorage(),p=pi.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Pi({forceReload:!0})}catch{}try{ql({changeType:"debug-panel",slot:n})}catch{}try{ct()}catch{}}function Ar({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return lt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let f=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!f&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{ul(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Yt()}catch{}try{Lr()}catch{}let d=mi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),e!=null)try{let f=e.toStorage?.()??c.fromAny(e).toStorage(),p=mi.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(t!=null)try{let f=t.toStorage?.()??c.fromAny(t).toStorage(),p=mi.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Yt({forceReload:!0})}catch{}try{im({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ct()}catch{}}function FE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=Qp(r.key,n),s=il(r.key,n),l=en(r.label,s,(a,{setValue:u})=>{let d=v();if(d==null)return;let f=il(r.key,d),{next:p}=yE(r.key,a,d);u(p),Tt(f,p)||(Ze(),Je(`Modified ${r.label} (${o}) ${J(f)} \u2192 ${J(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(il(r.key,v()))});Ut({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let a=il(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function UE(e,t){let n=v();if(n==null){let U=document.createElement("div");U.className="debug-panel-empty",U.textContent="Select a save slot to edit stats.",e.appendChild(U);return}let o="spawnRate",r=vi(o,n),i=en("Coin Spawn Rate",kn(o,n),(U,{setValue:q})=>{let x=v();if(x==null)return;let P=kn(o,x);try{Tn(o,U,x)}catch{}let M=kn(o,x);q(M),Tt(P,M)||(Ze(),Je(`Modified Spawn Rate (${a}) ${J(P)} \u2192 ${J(M)}`))},{storageKey:r,onLockChange:U=>{let q=v();if(q!=null){if(U){if($v(q,o))return;try{Tn(o,yi(o),q)}catch{}}else ku(o,q,yi(o));i.setValue(kn(o,q))}}});Ut({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==v())return;let U=kn(o,n);i.setValue(U)}}),Ut({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==v())return;let U=kn(o,n);i.setValue(U)}}),e.appendChild(i.row);let s=Qe(),l=lt(),a=t?.title??t?.key??"Unknown Area",u=pi.level(n),d=en("XP Level",s.xpLevel,(U,{setValue:q})=>{let x=Qe().xpLevel;kr({level:U});let P=Qe();q(P.xpLevel),Tt(x,P.xpLevel)||(Ze(),Je(`Modified XP Level (${a}) ${J(x)} \u2192 ${J(P.xpLevel)}`))},{storageKey:u});Ut({type:"xp",slot:n,refresh:()=>{n===v()&&d.setValue(Qe().xpLevel)}}),e.appendChild(d.row);let f=pi.progress(n),p=en("XP Progress",s.progress,(U,{setValue:q})=>{let x=Qe(),P=x?.xpLevel?.clone?.()??x?.xpLevel,M=x?.progress?.clone?.()??x?.progress;kr({progress:U});let _=Qe();q(_.progress),d.setValue(_.xpLevel),(!Tt(M,_.progress)||!Tt(P,_.xpLevel))&&(Ze(),Je(`Modified XP Progress (${a}) ${J(M)} \u2192 ${J(_.progress)}`))},{storageKey:f});Ut({type:"xp",slot:n,refresh:()=>{n===v()&&p.setValue(Qe().progress)}}),e.appendChild(p.row);let g=mi.level(n),m=en("MP Level",l.level,(U,{setValue:q})=>{let x=lt().level;Ar({level:U});let P=lt();q(P.level),Tt(x,P.level)||(Ze(),Je(`Modified MP Level (${a}) ${J(x)} \u2192 ${J(P.level)}`))},{storageKey:g});Ut({type:"mutation",slot:n,refresh:()=>{n===v()&&m.setValue(lt().level)}}),e.appendChild(m.row);let y=mi.progress(n),h=en("MP Progress",l.progress,(U,{setValue:q})=>{let x=lt(),P=x?.level?.clone?.()??x?.level,M=x?.progress?.clone?.()??x?.progress;Ar({progress:U});let _=lt();q(_.progress),m.setValue(_.level),(!Tt(M,_.progress)||!Tt(P,_.level))&&(Ze(),Je(`Modified MP Progress (${a}) ${J(M)} \u2192 ${J(_.progress)}`))},{storageKey:y});Ut({type:"mutation",slot:n,refresh:()=>{n===v()&&h.setValue(lt().progress)}}),e.appendChild(h.row);let b=Kr(n);if(b){let U=0;try{let x=localStorage.getItem(b),P=c.fromAny(x||"0");if(P.isInfinite())U=1/0;else try{U=Number(P.toScientific(20))}catch{U=0}}catch{}let q=en("Workshop Level",U,(x,{setValue:P})=>{let M=Number(x);if(console.log("[DebugPanel] Workshop Level Commit. Value type:",typeof x,"IsBigNum:",x instanceof c,"Value:",x),x instanceof c)if(x.isInfinite())M=1/0;else try{M=Number(x.toScientific(20))}catch{M=NaN}if(Number.isNaN(M)||M<0)return;let _=M===1/0?"Infinity":String(Math.floor(M));try{localStorage.setItem(b,_),Ze(),Je(`Modified Workshop Level (The Cove) ${J(U)} \u2192 ${_}`),U=M}catch{}P(M)},{storageKey:b,onLockChange:()=>{let x=0;try{let P=localStorage.getItem(b),M=c.fromAny(P||"0");M.isInfinite()?x=1/0:x=Number(M.toScientific(20))}catch{}q.setValue(x)}});e.appendChild(q.row),Ut({type:"workshop-level",slot:n,refresh:()=>{if(n!==v())return;let x=0;try{let P=localStorage.getItem(b),M=c.fromAny(P||"0");M.isInfinite()?x=1/0:x=Number(M.toScientific(20))}catch{}q.setValue(x)}})}let w=gs(n);if(w){let U=0;try{let x=localStorage.getItem(w);x==="Infinity"?U=1/0:U=c.fromAny(x||"0")}catch{U=c.fromInt(0)}let q=en("Surge Level",U,(x,{setValue:P})=>{let M="0",_=0;x instanceof c?x.isInfinite()?(M="Infinity",_=1/0):(M=x.toPlainIntegerString(),_=x):x===1/0||typeof x=="string"&&/infinity/i.test(x)?(M="Infinity",_=1/0):(M=String(x),_=x);try{localStorage.setItem(w,M),Ze();let X=_===1/0?"Infinity":J(_),Q=U===1/0||U instanceof c&&U.isInfinite()?"Infinity":J(U);Je(`Modified Surge Level (The Cove) ${Q} \u2192 ${X}`),_===1/0?U=1/0:_ instanceof c?U=_:U=c.fromAny(_)}catch{}P(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let X=U;if(X!==1/0&&X instanceof c)try{X=BigInt(X.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:X}}))}catch{}},{storageKey:w,onLockChange:x=>{let P=c.fromInt(0);try{let M=localStorage.getItem(w);M==="Infinity"?P=1/0:P=c.fromAny(M||"0")}catch{}q.setValue(P)}});Ut({type:"surge-level",slot:n,refresh:()=>{if(n!==v())return;let x=c.fromInt(0);try{let P=localStorage.getItem(w);P==="Infinity"?x=1/0:x=c.fromAny(P||"0")}catch{}q.setValue(x)}}),e.appendChild(q.row)}let L=io(),R=en("Lab Level",L,(U,{setValue:q})=>{let x;try{x=U instanceof c?U:c.fromAny(U),x.isNegative&&x.isNegative()&&(x=c.fromInt(0))}catch{q(io());return}let P=io();Ma(x),Ze(),Tt(P,x)||Je(`Modified Lab Level (The Cove) ${J(P)} \u2192 ${J(x)}`),q(x)},{storageKey:jf(n)});Ut({type:"lab-level",slot:n,refresh:()=>{n===v()&&R.setValue(io())}}),e.appendChild(R.row);let k=()=>{let U=Bt(),q=bn(),x=U+q;return x>1&&(x=1),x},F=en("Tsunami Exponent",k().toFixed(2),(U,{setValue:q})=>{let x=Number(U);if(U instanceof c?U.isInfinite()?x=1/0:x=Number(U.toScientific(10)):typeof U=="string"&&/infinity/i.test(U)&&(x=1/0),Number.isNaN(x)){q(k().toFixed(2));return}let P=bn(),M=x-P;M>1&&(M=1),M<0&&(M=0),M=Math.round(M*100)/100;let _=Bt();Zi(M),Ze(),Math.abs(_-M)>1e-4&&Je(`Modified Tsunami Exponent (The Cove) Base:${_.toFixed(2)} \u2192 ${M.toFixed(2)} (Effective: ${x.toFixed(2)})`),q(k().toFixed(2))},{storageKey:zf(n),format:U=>{let q=Number(U);return Number.isFinite(q)?q.toFixed(2):String(U)}});Ut({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==v())return;let U=k();F.setValue(U.toFixed(2))}}),e.appendChild(F.row)}function Mv(e,t){let n=v();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Ft(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=Ln(t.key,i.id??i.tie),u=fi(t.key,i.id??i.tie,n),d=en(l,a,(f,{setValue:p})=>{if(v()==null)return;let m=Ln(t.key,i.id??i.tie);try{Yo(t.key,i.id??i.tie,f,!1)}catch{}let y=Ln(t.key,i.id??i.tie);p(y),Tt(m,y)||(Ze(),Je(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${J(m)} \u2192 Lv${J(y)}`))},{idLabel:s,storageKey:u});Ut({type:"upgrade",slot:n,refresh:()=>{if(n!==v())return;let f=Ln(t.key,i.id??i.tie);d.setValue(f)}}),e.appendChild(d.row)})}function DE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=O?.[r.key]?.mult,l=sl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${gt.MULTIPLIER[r.key]}:${n}`,u=en(`${r.label} Multiplier`,l,(d,{setValue:f})=>{let p=v();if(p==null)return;let g=sl(r.key,p)??i?.get?.()??c.fromInt(1);try{Gv(r.key,d,p)}catch{}dl();let y=sl(r.key,p)??i?.get?.()??c.fromInt(1);f(y),Tt(g,y)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${J(g)} \u2192 ${J(y)}`))},{storageKey:a});Ut({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let f=sl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(f)}}),e.appendChild(u.row)})}function $E(){if(v()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Me).forEach(o=>{let r=O?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Tt(i,t))return;r.set(t),n+=1}catch{}}),n}function qE(){if(v()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Me).forEach(o=>{let r=O?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function GE(){let e=v();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=Qe()}catch{}try{r=lt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Tt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Tt(o?.progress,t);(!i||!s)&&(kr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Tt(r?.level,t),s=r?.progress?.isInfinite?.()||Tt(r?.progress,t);(!i||!s)&&(Ar({level:t,progress:t}),n+=1)}}catch{}try{let i=Kr(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=gs(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ct()}catch{}return n}function HE(){let e=v();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=Qe()}catch{}try{r=lt()}catch{}try{o?.unlocked&&(kr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Ar({level:t,progress:t}),n+=1)}catch{}try{let i=Kr(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=gs(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{ct()}catch{}return n}function Kv(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Qe()?.unlocked}catch{return!1}},onEnable:()=>{try{$r()}catch{}try{Pi({forceReload:!0})}catch{}},onDisable:()=>{try{Bi({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{ul(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{ul(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return Td()}catch{return!1}},onEnable:()=>{try{ii()}catch{}},onDisable:()=>{try{Oc()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return kd()}catch{return!1}},onEnable:()=>{try{Rc()}catch{}},onDisable:()=>{try{Pc()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return gd()}catch{return!1}},onEnable:()=>{try{mc(!0)}catch{}},onDisable:()=>{try{mc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!Sn()}catch{return!1}},onEnable:()=>{try{pr(!0)}catch{}},onDisable:()=>{try{pr(!1)}catch{}},slot:e}]}function jv(e){let t=v();if(t==null)return 0;let n=0;Kv(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{ct()}catch{}return n}function XE(){let e=v();if(e==null)return{unlocks:0,toggles:0};let t=0;Mu().forEach(o=>{Ft(o.key).forEach(r=>{if(r?.unlockUpgrade)try{ui(o.key,r,e),t+=1}catch{}})});try{ii()}catch{}try{Rc()}catch{}let n=jv(!0);return{unlocks:t,toggles:n}}function VE(){let e=v();if(e==null)return{locks:0,toggles:0};let t=0;Mu().forEach(o=>{Ft(o.key).forEach(r=>{if(r?.unlockUpgrade)try{$p(o.key,r,e),t+=1}catch{}})});try{Oc()}catch{}try{Pc()}catch{}let n=jv(!1);return{locks:t,toggles:n}}function YE(e,t=v()){let n=t??v();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(Qp(a,n)),r(vE(a,n))},s=a=>r(vi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(pi.level(n)),r(pi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(mi.level(n)),r(mi.progress(n)))};return e==="all"?(Object.values(Me).forEach(i),l("xp"),l("mutation"),_u.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Me).forEach(i),Array.from(o)):e==="allUnlockedStats"?(Qe()?.unlocked&&l("xp"),lt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Me).forEach(i),Qe()?.unlocked&&l("xp"),lt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function Eu(e){try{O?.[e]?.set?.(c.fromInt(0))}catch{}try{bE(e)}catch{}try{Nl(e,c.fromInt(1))}catch{}}function WE(e){if(e==="all"){Object.values(Me).forEach(i=>Eu(i));let o=c.fromInt(0);return kr({level:o,progress:o}),Ar({level:o,progress:o}),_u.forEach(({key:i})=>{try{Tn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Me).length+_u.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Me).forEach(i=>{Eu(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(Qe()?.unlocked){kr({level:o,progress:o});try{Tn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(lt()?.unlocked){Ar({level:o,progress:o});try{Tn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Me).forEach(l=>{Eu(l),o+=1});let r=c.fromInt(0),i=0;try{if(Qe()?.unlocked){kr({level:r,progress:r});try{Tn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(lt()?.unlocked){Ar({level:r,progress:r});try{Tn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return Eu(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{Dv(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){kr({level:n,progress:n});try{Tn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Ar({level:n,progress:n});try{Tn("mutation",c.fromInt(1))}catch{}return"MP"}try{Tn(t,c.fromInt(1))}catch{}return`stat ${t}`}function zE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";_u.forEach(r=>{if(r.key==="spawnRate")return;let i=vi(r.key,n),s=en(`${r.label} Multiplier`,kn(r.key,n),(l,{setValue:a})=>{let u=v();if(u==null)return;let d=kn(r.key,u);try{Tn(r.key,l,u)}catch{}let f=kn(r.key,u);a(f),Tt(d,f)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${J(d)} \u2192 ${J(f)}`))},{storageKey:i,onLockChange:l=>{let a=v();if(a!=null){if(l){if($v(a,r.key))return;try{Tn(r.key,yi(r.key),a)}catch{}}else ku(r.key,a,yi(r.key));s.setValue(kn(r.key,a))}}});Ut({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=kn(r.key,n);s.setValue(l)}}),Ut({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=kn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Ut({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=kn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function KE(e){let t=v();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!St||St.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}St.forEach(n=>{let o=Kn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=ec(t,n.id),s=en("Level",$t(n.id),(u,{setValue:d})=>{let f=Number(u);if(u instanceof c&&(f=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(f)||f<0)return;f>n.maxLevel&&(f=n.maxLevel),f=Math.floor(f);let p=$t(n.id);xa(n.id,f),Ze(),p!==f&&Je(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${f}`),d(f)},{storageKey:i});Ut({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===v()&&s.setValue($t(n.id))}}),r.appendChild(s.row);let l=tc(t,n.id),a=en("Current RP",no(n.id),(u,{setValue:d})=>{let f;try{f=u instanceof c?u:c.fromAny(u),f.isNegative&&f.isNegative()&&(f=c.fromInt(0))}catch{d(no(n.id));return}let p=no(n.id);La(n.id,f),Ze(),Tt(p,f)||Je(`Modified Node ${n.id} RP (The Cove) ${J(p)} \u2192 ${J(f)}`),d(f)},{storageKey:l});Ut({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===v()&&a.setValue(no(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function jE(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Gl(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>_f(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>sm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>hs(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>fr(n)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>qp(n,o,r)}]}].forEach(n=>{let o=Kn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=BE({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function ZE(e){if(e.innerHTML="",v()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}dl(),Mu().forEach(o=>{let r=Kn(o.title,i=>{let s=Kn("Currencies",g=>{FE(g,o)}),l=Kn("Stats",g=>{UE(g,o)}),a=Kn("Multipliers",g=>{let m=Kn("Currencies",h=>{DE(h,o)}),y=Kn("Stats",h=>{zE(h,o)});g.appendChild(m),g.appendChild(y)}),u=Kn("Upgrades",g=>{Mv(g,o)}),d=null,f=null;o.key===xe.STARTER_COVE&&(d=Kn("Automation Upgrades",g=>{Mv(g,{key:xe.AUTOMATION,title:"Automation"})}),f=Kn("Lab Nodes",g=>{KE(g)}));let p=Kn("Calculators",g=>{jE(g)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),d&&i.appendChild(d),f&&i.appendChild(f),i.appendChild(p)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function Tv(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];return o.forEach(i=>{Ft(i).forEach(l=>{e&&Ho(i,l.id).locked||r.push({areaKey:i,upg:l})})}),el(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;Yo(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function kv(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];o.forEach(s=>{Ft(s).forEach(a=>{e&&Ho(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{el(()=>{r.forEach(({areaKey:s,upg:l})=>{try{wr(s,l.id,"0"),Yo(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function Av(e){let t=v();if(t==null)return 0;let n=e?"1":"0",o=0,r=Ft(Ke);el(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;Yo(Ke,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(Hi),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(xe).forEach(l=>{if(l===Ke)return;Ft(l).forEach(u=>{s.has(u.costType)&&(wr(l,u.id,n),o++)})}),wr(Ke,eo,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function JE(e){e.innerHTML="";let t=v();if(t==null){let h=document.createElement("div");h.className="debug-panel-empty",h.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(h);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:h}=NE();Ze(),Je(`Completed all dialogues (${h} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:h}=RE();Ze(),Je(`Restored dialogues to unclaimed state (${h} ${h===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let h=$E();Ze(),Je(`Set all currencies to Infinity (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let h=GE();Ze(),Je(`Set all stats to Infinity (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let h=qE();Ze(),Je(`Set all currencies to 0 (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let h=HE();Ze(),Je(`Set all unlocked stats to 0 (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let h=Tv(!0);Ze(),Je(`Maxed ${h} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let h=kv(!0);Ze(),Je(`Reset ${h} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let h=Tv(!1);Ze(),Je(`Maxed all ${h} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let h=kv(!1);Ze(),Je(`Reset all ${h} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let h=Av(!0);Ze(),Je(`Enabled automation for ${h} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let h=Av(!1);Ze(),Je(`Disabled automation for ${h} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:h,toggles:b}=XE();Ze(),Je(`Unlocked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:h,toggles:b}=VE();Ze(),Je(`Locked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{Vv([],t),rm(),Ze(),Je("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let h=v();if(h!=null)try{localStorage.setItem(cE(h),String(uE)),Fo(!0),Ze(),Je("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let h=window.prompt("Enter amount of seconds to warp:");if(h==null)return;let b=om(h);if(!b||typeof b.isZero=="function"&&b.isZero()||typeof b.isNegative=="function"&&b.isNegative())return;let w,L=!1;Dt()?w=es(b):(w=ac(b),L=!0),ti(w);let R=b.mulSmall?b.mulSmall(1e3):b.mulBigNumInteger(c.fromInt(1e3));hr(w,R,L),Ze(),Je(`Performed OP Time Warp for ${J(b)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(h=>{let b=document.createElement("button");b.type="button",b.className="debug-panel-toggle debug-misc-button",b.textContent=h.label,b.addEventListener("click",h.onClick),o.appendChild(b)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",Mu().forEach(h=>{let b=document.createElement("optgroup");b.label=h.title||h.key,h.currencies.forEach(w=>{let L=document.createElement("option");L.value=`currency:${w.key}`,L.textContent=`${h.title||h.key} \u2192 ${w.label}`,b.appendChild(L)}),h.stats.forEach(w=>{let L=document.createElement("option");L.value=`stat:${w.key}`,L.textContent=`${h.title||h.key} \u2192 ${w.label}`,b.appendChild(L)}),s.appendChild(b)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let d=document.createElement("option");d.value="all",d.textContent="All",s.appendChild(d),s.querySelector(`option[value="${Iu}"]`)||(Iu=rl),s.value=Iu;let f=()=>YE(s.value||rl,v()),p=_E(f);s.addEventListener("change",()=>{Iu=s.value||rl,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let g=document.createElement("button");g.type="button",g.className="debug-panel-toggle reset-check",g.textContent="\u2705",g.addEventListener("click",()=>{let h=s.value||rl,b=f(),w=p.isLocked(),L=(R=!0)=>{let k=ME(b,()=>WE(h))??{label:h,count:0};if(w&&b.forEach(F=>bi(F)),p.refresh(),Ze(),R){let{label:F,count:U}=k;Je(`Reset ${U===1?"value and multiplier":"values and multipliers"} for ${F} to defaults.`)}};L(!0),setTimeout(()=>L(!1),100)}),r.appendChild(g),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-danger-button",y.textContent="Wipe Slot & Refresh",y.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let b=document.querySelector(".menu-root"),w=document.getElementById("game-root");b&&(b.hidden=!1,b.style.display="",b.style.visibility=""),w&&(w.hidden=!0,w.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(y),e.appendChild(m)}function QE(e){e.innerHTML="";let t=v();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Pi()}catch{}let n=Kv(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(OE(o))})}function Zv(){if(!gi||fl())return;Bv(),Fv(),Ov=0,Pv=0;let e=document.getElementById(ll);e&&e.remove();let t=document.createElement("div");t.id=ll,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>_o({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>_o()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:d,hideOnMobile:f})=>{let p=document.createElement("div");p.className="debug-panel-info-line",f&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=d,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(wu("Areas: main currency/stat/upgrade management for each area","debug-areas",d=>{ZE(d)})),t.appendChild(wu("Unlocks: modify specific unlock flags","debug-unlocks",d=>{QE(d)})),t.appendChild(wu("Action Log: keep track of everything you do","debug-action-log",d=>{let f=document.createElement("div");f.id="action-log-entries",f.className="debug-panel-action-log",f.style.maxHeight="240px",f.style.overflowY="auto",d.appendChild(f),As=f,rm(),pn(()=>{As=null})})),t.appendChild(wu("Miscellaneous: helpful miscellaneous functions","debug-misc",d=>{JE(d)})),pE(t),document.body.appendChild(t),Lu>0)try{t.scrollTop=Lu}catch{}mE(),hi=!0}function Zp(){if(!(!gi||fl())){if(v()==null){_o();return}hi||Zv()}}function _o({preserveExpansionState:e=!1}={}){Rv=e?dE():Cu();let t=document.getElementById(ll);if(t){try{Lu=t.scrollTop??0}catch{Lu=0}t.remove()}Bv(),hi=!1}function ex(){if(!gi||fl()||v()==null){_o();return}hi?_o({preserveExpansionState:!0}):Zp()}function tx(){_o(),Kp()}function Au(){if(!hE()){Kp(),_o();return}Fv(),Kp();let e=document.createElement("button");e.id=Nv,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{ex()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function nx(e){if(gi=!!e,!gi){tx();return}Au()}function ox(e){nx(e)}var Su,ll,Nv,rl,hi,gi,Wp,Rv,Lu,Iu,Ov,Pv,Jp,As,cl,Rs,xu,al,di,Os,Lv,Ns,_v,aE,lE,zp,cE,uE,Vp,pi,Yp,mi,_u,Cv,Ui=De(()=>{Lt();zt();bt();Dn();wo();Io();cn();Bc();bc();Wi();So();ro();wc();Yr();id();Ki();Qr();lc();Su="debug-panel-style",ll="debug-panel",Nv="debug-panel-toggle",rl=`currency:${Me.COINS}`,hi=!1,gi=!1,Wp=[],Rv=Cu(),Lu=0,Iu=rl,Ov=0,Pv=0,Jp=[],As=null,cl=new Map,Rs=new Map,xu=new Set,al=new Map,di=new Map,Os=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=Os);Lv=!1,Ns=null,_v=null,aE="ccc:debug:stat-mult",lE="ccc:actionLog",zp=100,cE=e=>`ccc:warp:charges:${e}`,uE=24;Vp="ccc:xp",pi={unlock:e=>`${Vp}:unlocked:${e}`,level:e=>`${Vp}:level:${e}`,progress:e=>`${Vp}:progress:${e}`},Yp="ccc:mutation",mi={unlock:e=>`${Yp}:unlocked:${e}`,level:e=>`${Yp}:level:${e}`,progress:e=>`${Yp}:progress:${e}`},_u=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];Cv=!1;dl();qv();document.addEventListener("keydown",e=>{if(!(!gi||fl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&v()!=null){if(e.shiftKey){hi?(CE(),_o()):Zp(),e.preventDefault();return}hi?_o({preserveExpansionState:!0}):Zp(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Au()});window.addEventListener("menu:visibilitychange",gE);window.addEventListener("saveSlot:change",()=>{Au(),hi&&Zv()})});var n0={};vt(n0,{addExternalMutationGainMultiplierProvider:()=>ei,addMutationPower:()=>os,broadcastMutationChange:()=>im,computeMutationMultiplierForLevel:()=>hs,computeMutationRequirementForLevel:()=>sm,getMutationCoinSprite:()=>Sp,getMutationGainMultiplier:()=>Ru,getMutationMultiplier:()=>Nu,getMutationState:()=>lt,getTotalCumulativeMp:()=>ja,initMutationSystem:()=>Yt,isMutationUnlocked:()=>Lo,onMutationChange:()=>ci,setMutationUnlockedForDebug:()=>ul,unlockMutationSystem:()=>Lr});function Ou(e){try{return e?.toStorage?.()}catch{return null}}function Ei(){try{vn()}catch{}}function t0(e){let t=e;if(!t.isZero?.()){let n=wi.size>0?Array.from(wi):typeof hl=="function"?[hl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof We?t=r.clone?.()??r:r!=null&&(t=We.fromAny(r))}catch{}}return t}function sx(){if(typeof am=="function"){try{am()}catch{}am=null}if(typeof lm=="function"){try{lm()}catch{}lm=null}}function gl(e){if(e instanceof We)try{return e.clone?.()??We.fromAny(e)}catch{return ft()}try{return We.fromAny(e??0)}catch{return ft()}}function ax(e){if(!e||typeof e!="object")return ft();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?We.fromInt(100):We.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function Bu(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=$e(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function hm(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let d=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(d+=ix*(p-1),!Number.isFinite(d)))return Number.POSITIVE_INFINITY}let f=u*d;return Number.isFinite(f)?f:Number.POSITIVE_INFINITY}let n=Bu(e);if(!Number.isFinite(n))return We.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return We.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),d=Math.pow(l/u,1/a),f=o-9;r=u*Math.pow(d,f)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return We.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return We.fromAny("Infinity");let i=Ae(r);return ax(i)}function Nr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=hm(D.level);D.requirement=n}function lx(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=$e(e),l=$e(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function dm(){return An.container&&An.container.isConnected?!0:(An.container=document.querySelector("[data-mp-hud].mp-counter"),An.container?(An.bar=An.container.querySelector(".mp-bar"),An.fill=An.container.querySelector(".mp-bar__fill"),An.levelValue=An.container.querySelector(".mp-level-value"),An.progress=An.container.querySelector("[data-mp-progress]"),!0):!1)}function Si(e){try{return J(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function Jo(){if(!dm())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=An;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Si(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Si(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Ai();return}e.removeAttribute("hidden");let i=D.requirement,s=lx(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Si(D.level)),r){let a=Si(D.progress),u=Si(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Si(D.progress).replace(/<[^>]*>/g,""),u=Si(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Ai()}function Qo(e="update",t={}){let n=lt(),o={...n,slot:D.slot??v(),changeType:e,...t};if(fm.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function gm(){let e=D.slot;if(e==null&&(e=v(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(pl(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Ii(e),D.level.toStorage())}catch{}try{localStorage.setItem(Bs(e),D.progress.toStorage())}catch{}rt(pl(e)),rt(Ii(e)),rt(Bs(e));let t=(()=>{let u=D.unlocked,d=D.level,f=D.progress;try{u=localStorage.getItem(pl(e))==="1"}catch{}try{let p=localStorage.getItem(Ii(e));p&&(d=We.fromAny(p))}catch{}try{let p=localStorage.getItem(Bs(e));p&&(f=We.fromAny(p))}catch{}return{unlocked:u,level:d,progress:f}})(),n=Ou(t.level),o=Ou(t.progress),r=Ou(D.level),i=Ou(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&Pu(t,{skipPersist:!0})}function pm(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function cx(){if(!D.unlocked)return;let e=D.slot??v();if(e!=null&&pm(Ii(e))){Nr();return}Nr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(Fs()),Nr(),t=D.requirement,!t||typeof t!="object"){D.progress=ft();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=ft())}function Pu(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=gl(e.level),D.progress=gl(e.progress),D.unlocked||(D.level=ft(),D.progress=ft()),Nr(),t||gm(),Jo(),Qo("load"),Ei()}function cm(e){let t=e??v();if(t==null){Pu({unlocked:!1,level:ft(),progress:ft()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=ft(),r=ft();try{n=localStorage.getItem(pl(t))==="1"}catch{}try{let i=localStorage.getItem(Ii(t));i&&(o=We.fromAny(i))}catch{}try{let i=localStorage.getItem(Bs(t));i&&(r=We.fromAny(i))}catch{}Pu({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function ux(){for(;ml.length;){let e=ml.pop();try{e?.()}catch{}}}function um(e){Qv!==e&&(ux(),Qv=e,e!=null&&(ml.push(_t(pl(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=ft(),D.progress=ft()),Nr(),Jo(),Qo("storage"),Ei())}})),ml.push(_t(Ii(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Nr(),Jo(),Qo("storage"),Ei())}catch{}}})),ml.push(_t(Bs(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Nr(),Jo(),Qo("storage"))}catch{}}}))))}function Yt({forceReload:e=!1}={}){if(sx(),e0){let n=v();return(n!==D.slot||e)&&cm(n),um(n),dm(),Jo(),lt()}e0=!0,dm();let t=v();return D.slot=t,cm(t),um(t),Jo(),Ei(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=v();D.slot=n,cm(n),um(n),Jo(),Ei(),Qo("slot")}),lt()}function lt(){return{unlocked:D.unlocked,level:gl(D.level),progress:gl(D.progress),requirement:gl(D.requirement)}}function Lo(){return!!D.unlocked}function Lr(){return Yt(),D.unlocked?!1:(D.unlocked=!0,Nr(),gm(),Jo(),Qo("unlock"),Ei(),!0)}function ul(e){Yt();let t=!!e;Pu({unlocked:t,level:t?D.level:ft(),progress:t?D.progress:ft()})}function os(e){Yt();let t=D.slot??v();if(t!=null&&pm(Bs(t))||!D.unlocked)return lt();let n=t!=null&&pm(Ii(t));if(D.level&&D.level.isInfinite?.()){let d=D.level.clone?.()??D.level,f=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=We.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=We.fromAny("Infinity")}catch{}let p;try{p=e instanceof We?e:We.fromAny(e??0)}catch{p=ft()}return p=t0(p),p=$n("mutation",p),Qo("progress",{delta:p.clone?.()??p,levelsGained:ft(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:d.clone?.()??d,previousProgress:f.clone?.()??f})}let o;try{o=e instanceof We?e:We.fromAny(e??0)}catch{o=ft()}if(o=t0(o),o=$n("mutation",o),o.isZero?.())return lt();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=We.fromAny("Infinity")}catch{}try{D.progress=We.fromAny("Infinity")}catch{D.progress=ft()}try{D.requirement=We.fromAny("Infinity")}catch{}}else cx();gm(),Jo();let a=D.level.sub(i);return a.isZero?.()||Ei(),Qo("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function im(e={}){Yt();let t=e.changeType??"manual";return Qo(t,e)}function hs(e){let t;if(e instanceof We)try{t=e.clone?.()??e}catch{t=ft()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=ft()}else try{t=c.fromAny(e??0)}catch{t=ft()}if(t&&t.isInfinite?.())try{return We.fromAny("Infinity")}catch{return Fs()}let n=Bu(t);if(!Number.isFinite(n))try{return We.fromAny("Infinity")}catch{return Fs()}if(n<=0)return Fs();let o=n*rx;return Ae(o)}function sm(e){let t;try{t=e instanceof We?e:We.fromAny(e??0)}catch{t=ft()}try{return hm(t)}catch{return ft()}}function Nu(){if(Yt(),!D.unlocked)return Fs();try{return hs(D.level)}catch{return Fs()}}function Ru(){let e=c.fromInt(1);if(wi.size>0||hl){let t=wi.size>0?Array.from(wi):typeof hl=="function"?[hl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof We?e=o.clone?.()??o:o!=null&&(e=We.fromAny(o))}catch{}}return e}function Sp(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=Bu(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function ci(e){return typeof e!="function"?()=>{}:(fm.add(e),()=>{fm.delete(e)})}function ei(e){return typeof e!="function"?()=>{}:(wi.add(e),()=>{wi.delete(e)})}function ja(){if(Yt(),!D.unlocked)return ft();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=Bu(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=hm(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var mm,pl,Ii,Bs,We,ft,Fs,rx,ix,D,An,fm,ml,Qv,e0,am,lm,wi,hl,wo=De(()=>{Lt();bt();Ui();zt();cn();hf();Dn();mm="ccc:mutation",pl=e=>`${mm}:unlocked:${e}`,Ii=e=>`${mm}:level:${e}`,Bs=e=>`${mm}:progress:${e}`,We=c,ft=()=>We.fromInt(0),Fs=()=>We.fromInt(1),rx=Math.log10(2),ix=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:ft(),progress:ft(),requirement:ft(),slot:null},An={container:null,bar:null,fill:null,levelValue:null,progress:null},fm=new Set,ml=[],Qv=null,e0=!1,am=null,lm=null,wi=new Set,hl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Yt,unlockMutationSystem:Lr,addMutationPower:os,getMutationState:lt,getMutationMultiplier:Nu,isMutationUnlocked:Lo,getTotalCumulativeMp:ja,addExternalMutationGainMultiplierProvider:ei,getMutationGainMultiplier:Ru}))});var yl,o0,r0,ym,vm,bm,i0=De(()=>{yl=`attribute vec2 position;
varying vec2 vUv;
void main() {
    vUv = position * 0.5 + 0.5;
    gl_Position = vec4(position, 0.0, 1.0);
}`,o0='precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform vec3 uColorDeep; uniform vec3 uColorShallow; void main() { /* Wave animation settings */ float speed = 1.2; float time = uTime * speed; /* Combine sine waves for a more natural look */ /* vUv.x is 0..1 across the screen width */ float wave1 = sin(vUv.x * 8.0 - time) * 0.0285; float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; /* Define the shoreline height (baseline) */ /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */ /* We want to discard pixels below this threshold */ float threshold = 0.428 + wave; if (vUv.y < threshold) { discard; } /* Recalculate gradient based on the new "bottom" */ /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */ float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0); vec3 col = mix(uColorShallow, uColorDeep, gradientY); /* Add a subtle "foam" or highlight at the edge */ float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold); col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4); gl_FragColor = vec4(col, 1.0); }',r0="precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform sampler2D uWaveMap; uniform vec3 uColorDeep; uniform vec3 uColorShallow; uniform vec3 uColorWaveDeep; uniform vec3 uColorWave; /* Simple noise for foam breakup */ float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); } float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f*f*(3.0-2.0*f); return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x), mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y); } void main() { vec2 uv = vUv; /* Sample the simulation (physics) */ /* Wave Logic */ vec2 waveUV = uv - vec2(0.0, 0.0285); float intensity = texture2D(uWaveMap, waveUV).r; /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */ float shadowOffset = 8.0 / uResolution.y; float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r; /* Discard only if BOTH are empty */ if (intensity < 0.01 && shadowIntensity < 0.01) discard; /* Directional Noise: Streaky vertical noise for rushing water effect */ /* Stretch heavily along Y-axis to simulate speed/motion blur */ float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0)); /* Define Zones based on Intensity */ /* Body (Medium Intensity): Darker/turbulent blue with noise */ /* Edge (High Intensity): Bright white foam */ float foamThreshold = 0.5; float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity); /* Base Colors */ vec3 bodyColor = uColorWaveDeep; vec3 foamColor = uColorWave; /* Mix Colors */ vec3 finalColor = mix(bodyColor, foamColor, foamMix); /* Add streaks to the body part */ if (foamMix < 0.9) { finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix); } /* Hard Edge & Opacity */ /* Ensure the front (bottom) remains sharp, back trails off */ /* Calculate Alpha based on Intensity */ /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */ /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */ /* Low Intensity (Top/Tail): Fades to 0.0 */ float finalAlpha = smoothstep(0.02, 0.15, intensity); /* Screen Fade */ /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */ /* Dynamic Shoreline Fade */ /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */ /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */ float speed = 1.2; float time = uTime * speed; float wave1 = sin(uv.x * 8.0 - time) * 0.0285; float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; float threshold = 0.428 + wave; /* Fade out quickly after exiting the water body (below threshold) */ /* Fade starts slightly higher than the threshold to soften the transition */ /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */ float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y); float screenFade = shoreFade; /* --- Composite Shadow & Wave --- */ float waveAlpha = finalAlpha * screenFade; /* Shadow Alpha */ float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity); /* Shadow is weaker (40% opacity) */ float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade; /* Mix: Wave over Shadow */ /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */ float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha); /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */ /* Shadow is black (RGB=0), so second term is 0 */ vec3 outRGB = finalColor * waveAlpha; gl_FragColor = vec4(outRGB, outAlpha); }",ym=`attribute vec2 aPosition;
attribute vec2 aUv;
attribute float aAlpha; 

varying vec2 vUv;
varying float vAlpha;

void main() {
    vUv = aUv;
    vAlpha = aAlpha;
    gl_Position = vec4(aPosition, 0.0, 1.0);
}`,vm=`precision mediump float;
varying vec2 vUv;
varying float vAlpha;

float sdRoundedBox(vec2 p, vec2 b, float r) {
    vec2 q = abs(p) - b;
    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;
}

void main() {
    vec2 p = vUv - 0.5;
    
    /* Shape: Rounded Box (Pill) */
    vec2 b = vec2(0.35, 0.15);
    float r = 0.05;
    float d = sdRoundedBox(p, b, r);
    
    float shape = 1.0 - smoothstep(0.0, 0.02, d);
    shape = clamp(shape, 0.0, 1.0);

    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */
    /* vUv.y: 0=Bottom, 1=Top */
    /* We want foam only at the very bottom, rapidly fading to blue body */
    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */
    /* Reducing 0.45 to 0.42 shrinks the foam cap height */
    float foam = smoothstep(0.45, 0.24, vUv.y);
    
    /* Body Gradient: Fade out towards the tail */
    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */
    float bodyFade = smoothstep(0.4, 0.7, vUv.y);
    float bodyBase = mix(0.45, 0.0, bodyFade);

    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */
    float intensity = mix(bodyBase, 1.0, foam);

    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);
}`,bm=`precision mediump float;

uniform sampler2D uLastFrame;
uniform vec2 uResolution;
uniform float uDt;

void main() {
    vec2 uv = gl_FragCoord.xy / uResolution;
    
    /* Flow Downwards */
    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */
    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); 
    
    vec2 sourceUv = uv + flow;

    if (sourceUv.y > 1.0) {
        gl_FragColor = vec4(0.0);
        return;
    }
    
    vec4 center = texture2D(uLastFrame, sourceUv);
    
    /* Decay */
    /* Correct decay for variable timestep */
    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */
    float decay = pow(0.99, uDt * 60.0);
    
    gl_FragColor = center * decay;
}`});var l0={};vt(l0,{WaterSystem:()=>Fu,waterSystem:()=>Uu});function a0(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function Us(e,t,n){let o=a0(e,e.VERTEX_SHADER,t),r=a0(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var fx,s0,dx,px,Fu,Uu,Sm=De(()=>{i0();fx=[.2,.5,.9],s0=[.2,.9,1],dx=[1,1,1],px=[.45,.8,1];Fu=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:Us(s,yl,r0),simProgram:Us(s,yl,bm),brushProgram:Us(s,ym,vm),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=Us(this.glBg,yl,o0),this.bgSimProgram=Us(this.glBg,yl,bm),this.bgBrushProgram=Us(this.glBg,ym,vm)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,d=-(s/this.height*2-1),f=l/this.width,p=a/this.height,g=new Float32Array([u-f,d-p,0,0,1,u+f,d-p,1,0,1,u-f,d+p,0,1,1,u+f,d+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,g,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),y=t.getAttribLocation(n,"aUv"),h=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(y),t.vertexAttribPointer(y,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let d=r;for(;d>0;){let f=Math.min(d,s);l.push(f),d-=f}}l.forEach(d=>{let f=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,d);this.bgReadFBO=f.readFBO,this.bgWriteFBO=f.writeFBO,this.bgReadTexture=f.readTex,this.bgWriteTexture=f.writeTex}),this.fgLayers.forEach(d=>{l.forEach(f=>{let p=this.runSimStep(d.gl,d.simProgram,d.quadBuffer,d.readFBO,d.writeFBO,d.readTexture,d.writeTexture,f);d.readFBO=p.readFBO,d.writeFBO=p.writeFBO,d.readTexture=p.readTex,d.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),fx),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),s0),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(d=>{let f=d.gl;f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,d.canvas.width,d.canvas.height),f.useProgram(d.program),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,d.readTexture),f.uniform1i(f.getUniformLocation(d.program,"uWaveMap"),0),f.uniform3fv(f.getUniformLocation(d.program,"uColorShallow"),s0),f.uniform3fv(f.getUniformLocation(d.program,"uColorWave"),dx),f.uniform3fv(f.getUniformLocation(d.program,"uColorWaveDeep"),px),f.uniform1f(f.getUniformLocation(d.program,"uTime"),o),f.uniform2f(f.getUniformLocation(d.program,"uResolution"),d.canvas.width,d.canvas.height),f.bindBuffer(f.ARRAY_BUFFER,d.quadBuffer);let p=f.getAttribLocation(d.program,"position");f.enableVertexAttribArray(p),f.vertexAttribPointer(p,2,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLE_STRIP,0,4)})}},Uu=new Fu});var m0={};vt(m0,{createSpawner:()=>Ix});function p0(e){if(!e||typeof e!="object"){Ds=!1,xi=0n;return}Ds=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;xi=n&&n!=="Infinity"?BigInt(n):0n}catch{xi=0n}}function hx(e){let t=1-e;return 1-t*t*t}function yx(e){if(!e)return null;let t=c0.get(e);return t||(t=new Image,t.src=e,c0.set(e,t)),t}function Ix({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:d=je?mx:1e4,initialBurst:f=1,coinTtlMs:p=1e99,waveSoundSrc:g="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:y=.2,waveSoundMinIntervalMs:h=160,enableDropShadow:b=!1}={}){let w=o,L={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function R(){return!!(L.pf&&L.w&&L.c)}R()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let k=7,F=[],U=[],q=!1;if(L.c)for(let S=0;S<k;S++){let T=document.createElement("canvas");T.style.position="absolute",T.style.inset="0",T.style.pointerEvents="none",T.style.zIndex=`${10+S*10}`,L.c.appendChild(T);let B=T.getContext("2d",{alpha:!0});F.push(T),U.push(B)}let x=null,P=null;L.c&&(x=document.createElement("canvas"),x.style.position="absolute",x.style.inset="0",x.style.pointerEvents="none",x.style.zIndex="100",L.c.appendChild(x),P=x.getContext("2d",{alpha:!0}));let M={collectBatch:null,getMagnetUnit:null};function _(S){M={...M,...S}}let X={pfRect:null,wRect:null,safeBottom:0,pfW:0};function Q(){if(!R())return!1;let S=L.pf.getBoundingClientRect(),T=L.w.getBoundingClientRect(),B=L.hud?L.hud.getBoundingClientRect().height:0;X={pfRect:S,wRect:T,safeBottom:S.height-B,pfW:S.width};let A=window.devicePixelRatio||1;return F.forEach((N,de)=>{if(N){N.width=S.width*A,N.height=S.height*A,N.style.width=S.width+"px",N.style.height=S.height+"px";let fe=U[de];fe&&(fe.setTransform(1,0,0,1,0,0),fe.scale(A,A),fe.imageSmoothingEnabled=!0,fe.imageSmoothingQuality="high")}}),q=!0,x&&(x.width=S.width*A,x.height=S.height*A,x.style.width=S.width+"px",x.style.height=S.height+"px",P&&(P.setTransform(1,0,0,1,0,0),P.scale(A,A))),!0}Q();let pe="ResizeObserver"in window?new ResizeObserver(()=>Q()):null;pe&&L.pf&&pe.observe(L.pf),document.addEventListener("visibilitychange",()=>{document.hidden||Q()});let K=(S,T,B)=>Math.max(T,Math.min(B,S)),ne=Math.max(2e3,d*3),ve=12,he=[],V=[],ee=0,$=[];function G(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let T=document.createElement("img");return T.className="coin-inner",T.draggable=!1,T.alt="",T.style.width="100%",T.style.height="100%",T.src=w,T.style.objectFit="contain",T.style.borderRadius="50%",S.appendChild(T),b&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let j=()=>he.length?he.pop():G();function le(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let T=0;T<=6;T++)S.classList.remove(`coin--size-${T}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),he.length<ne&&he.push(S)}function ue(S,T=-1){if(S.isRemoved)return;S.isRemoved=!0;let B=T;(B===-1||V[B]!==S)&&(S.index!==void 0&&V[S.index]===S?B=S.index:B=V.indexOf(S)),B!==-1&&(V[B]=null,ee++),S.el?(le(S.el),S.el=null):q=!0}function C(S){let T=S._coinObj;if(T){let B=-1;T.index!==void 0&&V[T.index]===T?B=T.index:B=V.indexOf(T),B!==-1&&(V[B]=null,ee++),S._coinObj=null}}let W=new URL(g,document.baseURI).href,ce=0;function me(){let S=performance.now();if(S-ce<h)return;ce=S,dt(W,{volume:je?y:m,type:"music"})}function Z(){if(!R())return null;if((!X.pfRect||!X.wRect)&&Q(),d!==1/0&&V.length-ee>=d){let wt=-1;if(mt(2))for(let Rt=0;Rt<V.length;Rt++){let ho=V[Rt];if(ho&&ho.sizeIndex<4){wt=Rt;break}}else for(let Rt=0;Rt<V.length;Rt++)if(V[Rt]){wt=Rt;break}if(wt===-1)return null;let Nt=V[wt];Nt&&ue(Nt,wt)}let S=X.pfW,T=X.wRect.top-X.pfRect.top,B=Math.max(0,T),A=0;if(mt(2)){let wt=Math.random();for(let Nt=6;Nt>=1;Nt--)if(wt<bx[Nt]){A=Nt;break}}A>=4&&za&&za()&&(A=3);let N=u0[A],de=ve+(A>=3?15*(A-2):0),fe=de,Te=Math.max(fe,S-N-de),Oe=fe+Math.random()*(Te-fe),Pe=Math.random()*100-50,ke;if(N>=X.pfW)ke=(X.pfW-N)/2;else{let wt=X.pfW-N-de;fe>=wt?ke=(X.pfW-N)/2:ke=K(Oe+Pe,fe,wt)}let Ue=Math.min(X.wRect.height,X.pfRect.height*.3),Ce=Math.max(Ue+80,120),Xe=Math.max(Ce+40,X.safeBottom-N-6),Ee=K(Ce+Math.random()*(Xe-Ce),Ce,Xe),He={x0:Oe,y0:B,x1:ke,y1:Ee,jitterMs:0},nt=X.pfRect.left-X.wRect.left,Ge=Sx[A],At=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),ot=.85+Math.random()*.3,yt=At*(Ge.w/100)*ot,Ht=At*(Ge.h/100)*ot,Xt=Oe+N/2+nt,Nn=B-T;return{wave:{x:Xt,y:Nn,width:yt,height:Ht},coin:He,sizeIndex:A}}function re(S){if(!S.length||!R())return;let T=document.createDocumentFragment(),B=[],A=performance.now(),N=!1;for(let{wave:de,coin:fe,sizeIndex:Te}of S){if(de&&(N=!0,Uu)){let Xe=Te>=4;Uu.addWave(de.x,de.y,de.width,de.height,Xe)}let Oe=u0[Te],Pe=1;if(mt(8)){let Xe=Bt(),Ee=Math.pow(25,Xe);Pe=Math.pow(Ee,Te)}else Pe=vx[Te];let ke=Te>=4,Ue=j();Ue.style.width=`${Oe}px`,Ue.style.height=`${Oe}px`,Ue.className=`coin coin--size-${Te}`,Ue.firstChild&&(Ue.firstChild.src=w),Ue.style.transform=`translate3d(${fe.x0}px, ${fe.y0}px, 0) rotate(-10deg) scale(0.96)`,Ue.style.opacity="0",Ds?Ue.dataset.mutationLevel=xi.toString():Ue.dataset.mutationLevel="0";let Ce={mutationLevel:Ds?xi.toString():"0",el:Ue,src:w,x:fe.x0,y:fe.y0,rot:-10,scale:.96,startX:fe.x0,startY:fe.y0,endX:fe.x1,endY:fe.y1,startTime:A+fe.jitterMs,duration:i,dieAt:A+p,jitterMs:fe.jitterMs,isRemoved:!1,settled:!1,size:Oe,sizeIndex:Te,valueMultiplier:Pe,forceDom:ke,soundSrc:d0[Te]?`sounds/coin_pickup${d0[Te]}`:null,bMinX:Math.min(fe.x0,fe.x1)-Oe,bMaxX:Math.max(fe.x0,fe.x1)+Oe,bMinY:Math.min(fe.y0,fe.y1)-Oe,bMaxY:Math.max(fe.y0,fe.y1)+Oe};Ue._coinObj=Ce,Ce.index=V.length,V.push(Ce),B.push(Ce),T.appendChild(Ue)}L.c.appendChild(T),B.length>0&&requestAnimationFrame(()=>{for(let de of B)de.el&&(de.el.style.transition=`transform ${i}ms ${gx} ${de.jitterMs}ms`,de.el.style.transform=`translate3d(${de.endX}px, ${de.endY}px, 0) rotate(0deg) scale(1)`,de.el.style.opacity="1")}),N&&requestAnimationFrame(()=>{me()})}function ye(S=1){if(!R())return;(!X.pfRect||!X.wRect)&&Q();let T=[];for(let B=0;B<S;B++){let A=Z();A&&T.push(A)}T.length&&re(T)}function Le(S,T){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let B=T-S.startTime;if(B<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let A=B/S.duration;if(A>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let N=hx(A),de=S.startX+(S.endX-S.startX)*N,fe=S.startY+(S.endY-S.startY)*N,Te=-10+10*N,Oe=.96+.04*N;return{x:de,y:fe,rot:Te,scale:Oe}}function ie(S,T){let B=yx(T.src);if(B&&B.complete&&B.naturalWidth>0){let A=T.size||r;S.drawImage(B,T.x,T.y,A,A)}}function Se(){if(U.length){if(q){U.forEach((T,B)=>{F[B]&&(T.save(),T.setTransform(1,0,0,1,0,0),T.clearRect(0,0,F[B].width,F[B].height),T.restore(),b&&(T.save(),T.shadowColor="rgba(0,0,0,0.35)",T.shadowBlur=2,T.shadowOffsetY=2))});let S=V.length;for(let T=0;T<S;T++){let B=V[T];if(B&&B&&B.settled&&!B.isRemoved&&!B.el){let A=B.sizeIndex||0;U[A]&&ie(U[A],B)}}b&&U.forEach(T=>T.restore()),q=!1,$.length=0}else if($.length>0){b&&U.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let T=$[S];if(!T.isRemoved&&T.settled&&!T.el){let B=T.sizeIndex||0;U[B]&&ie(U[B],T)}}b&&U.forEach(S=>S.restore()),$.length=0}}}let Ne=a,_e=null,Re=performance.now(),se=0;function te(S){(!X.pfRect||!X.wRect)&&Q();let T=(S-Re)/1e3;Re=S,T>.1&&(T=.1);for(let A=V.length-1;A>=0;A--){let N=V[A];if(!N||!N)continue;if(S>=N.dieAt){ue(N,A);continue}if(N.sizeIndex===5&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval)){N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100;for(let Te=0;Te<3;Te++)Mo(N,S)}if(N.sizeIndex===6&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval&&(N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100,M.collectBatch))){let Te=Le(N,S),Oe=Te.x+N.size/2,Pe=Te.y+N.size/2,ke=[],Ue=N.size/2*(N.size/2),Ce=V.length;for(let Xe=0;Xe<Ce;Xe++){let Ee=V[Xe];if(!Ee||Ee===N||Ee.isRemoved||Ee.settled===!1||Ee.sizeIndex>3)continue;let ze=Ee.x+(Ee.size||r)/2,He=Ee.y+(Ee.size||r)/2,nt=ze-Oe,Ge=He-Pe;nt*nt+Ge*Ge>Ue&&ke.push(Ee)}if(ke.length>0){for(let He=ke.length-1;He>0;He--){let nt=Math.floor(Math.random()*(He+1));[ke[He],ke[nt]]=[ke[nt],ke[He]]}let Xe=ke.slice(0,3),Ee=[],ze=!1;for(let He of Xe){let nt=He.size||r,Ge=He.x+nt/2,At=He.y+nt/2;To(N,Ge,At),tr(Ge,At,nt),Ee.push({coin:He}),ze||(dt("sounds/lightning_strike.ogg",{volume:.25}),ze=!0)}Ee.length>0&&M.collectBatch(Ee)}}if(N.settled)continue;let de=S-N.startTime;if(de<0)continue;if(de/N.duration>=1){N.settled=!0,N.x=N.endX,N.y=N.endY,N.rot=0,N.scale=1,N.el&&!N.forceDom?(le(N.el),N.el=null,$.push(N)):N.el&&(N.el.style.transition="none",N.el.style.transform=`translate3d(${N.x}px, ${N.y}px, 0) rotate(0deg) scale(1)`);continue}}se+=Ne*T;let B=Math.floor(se);if(B>0){se-=B;let A=Math.min(B,u);if(A>0){let N=performance.now(),de=[],fe=5;for(let Te=0;Te<A&&!(performance.now()-N>fe);Te++){let Oe=Z();Oe&&de.push(Oe)}de.length&&re(de)}}if(Se(),ee>50){let A=0;for(let N=0;N<V.length;N++){let de=V[N];de!==null&&(de.index=A,V[A++]=de)}V.length=A,ee=0}nr(T),_e=requestAnimationFrame(te)}function Ie(){if(!_e){if(!R()){console.warn("[Spawner] start() called but required nodes are missing.");return}Q(),f>0&&_e===null&&ye(f),Re=performance.now(),_e=requestAnimationFrame(te)}}function I(){_e&&(cancelAnimationFrame(_e),_e=null)}function Y(S){Ne=Math.max(0,Number(S)||0)}function z(){se=0,Re=performance.now()}function oe(S){let T=mt(2)&&!!S;for(let B=V.length-1;B>=0;B--){let A=V[B];if(A&&A){if(T&&A.sizeIndex>=4){A.mutationLevel=Ds?xi.toString():"0",A.el&&(A.el.dataset.mutationLevel=A.mutationLevel);continue}ue(V[B],B)}}z()}function ge(S){S&&(w=S)}function ae(S){let T=S._coinObj;if(!T)return S.style.transform||"translate3d(0,0,0)";let{x:B,y:A,rot:N,scale:de}=Le(T,performance.now());return`translate3d(${B}px, ${A}px, 0) rotate(${N}deg) scale(${de})`}function qe(S){if(S.el)return S.el;if(S.isRemoved)return null;let T=j(),B=S.size||r;return T.style.width=`${B}px`,T.style.height=`${B}px`,T.className=`coin coin--size-${S.sizeIndex||0}`,T.style.transition="",T.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,T.firstChild&&(T.firstChild.src=S.src),T.style.opacity="1",T.dataset.mutationLevel=S.mutationLevel,T._coinObj=S,S.el=T,L.c.appendChild(T),q=!0,T}function tt(S,T,B,A){let N=B;A&&(N=Math.max(B,260));let de=B*B,fe=[],Te=V.length,Oe=S-N,Pe=S+N,ke=T-N,Ue=T+N,Ce=performance.now();for(let Xe=0;Xe<Te;Xe++){let Ee=V[Xe];if(!Ee||Ee.bMaxX<Oe||Ee.bMinX>Pe||Ee.bMaxY<ke||Ee.bMinY>Ue)continue;let ze=Ee.size||r,He,nt;if(Ee.settled)He=Ee.x+ze/2,nt=Ee.y+ze/2;else{let yt=Le(Ee,Ce);He=yt.x+ze/2,nt=yt.y+ze/2}if(He<Oe||He>Pe||nt<ke||nt>Ue)continue;let Ge=He-S,At=nt-T,ot=de;if(A&&(Ee.sizeIndex||0)>0){let yt=ze/2;ot=yt*yt}Ge*Ge+At*At<=ot&&(Ee.isRemoved||fe.push(Ee))}return fe}function be(S,T,B,A,N,de){let fe=N;de&&(fe=Math.max(N,260));let Te=N*N,Oe=[],Pe=V.length,ke=Math.min(S,B)-fe,Ue=Math.max(S,B)+fe,Ce=Math.min(T,A)-fe,Xe=Math.max(T,A)+fe,Ee=B-S,ze=A-T,He=Ee*Ee+ze*ze,nt=Te*He,Ge=performance.now();for(let At=0;At<Pe;At++){let ot=V[At];if(!ot||ot.bMaxX<ke||ot.bMinX>Ue||ot.bMaxY<Ce||ot.bMinY>Xe)continue;let yt=ot.size||r,Ht,Xt;if(ot.settled)Ht=ot.x+yt/2,Xt=ot.y+yt/2;else{let rn=Le(ot,Ge);Ht=rn.x+yt/2,Xt=rn.y+yt/2}if(Ht<ke||Ht>Ue||Xt<Ce||Xt>Xe)continue;let Nn=Ht-S,wt=Xt-T,Nt=Nn*Ee+wt*ze,Rt=Te;if(de&&(ot.sizeIndex||0)>0){let rn=yt/2;Rt=rn*rn}let ho=!1;if(Nt<=0)Nn*Nn+wt*wt<=Rt&&(ho=!0);else if(Nt>=He){let rn=Ht-B,zs=Xt-A;rn*rn+zs*zs<=Rt&&(ho=!0)}else{let rn=Nn*ze-wt*Ee;rn*rn<=Rt*He&&(ho=!0)}ho&&!ot.isRemoved&&Oe.push(ot)}return Oe}function Be(S){ue(S)}function Gt(S,T,B){let A=B*B,N=[],de=V.length,fe=S-B,Te=S+B,Oe=T-B,Pe=T+B,ke=performance.now();for(let Ue=0;Ue<de;Ue++){let Ce=V[Ue];if(!Ce||Ce.bMaxX<fe||Ce.bMinX>Te||Ce.bMaxY<Oe||Ce.bMinY>Pe)continue;let Xe=Ce.size||r,Ee,ze;if(Ce.settled)Ee=Ce.x+Xe/2,ze=Ce.y+Xe/2;else{let Ge=Le(Ce,ke);Ee=Ge.x+Xe/2,ze=Ge.y+Xe/2}if(Ee<fe||Ee>Te||ze<Oe||ze>Pe)continue;let He=Ee-S,nt=ze-T;He*He+nt*nt<=A&&(!Ce.el&&!Ce.isRemoved&&qe(Ce),Ce.el&&N.push(Ce.el))}return N}function st(S,T,B,A,N){let de=N*N,fe=[],Te=V.length,Oe=Math.min(S,B)-N,Pe=Math.max(S,B)+N,ke=Math.min(T,A)-N,Ue=Math.max(T,A)+N,Ce=B-S,Xe=A-T,Ee=Ce*Ce+Xe*Xe,ze=de*Ee,He=performance.now();for(let nt=0;nt<Te;nt++){let Ge=V[nt];if(!Ge||Ge.bMaxX<Oe||Ge.bMinX>Pe||Ge.bMaxY<ke||Ge.bMinY>Ue)continue;let At=Ge.size||r,ot,yt;if(Ge.settled)ot=Ge.x+At/2,yt=Ge.y+At/2;else{let Nt=Le(Ge,He);ot=Nt.x+At/2,yt=Nt.y+At/2}if(ot<Oe||ot>Pe||yt<ke||yt>Ue)continue;let Ht=ot-S,Xt=yt-T,Nn=Ht*Ce+Xt*Xe,wt=!1;if(Nn<=0)Ht*Ht+Xt*Xt<=de&&(wt=!0);else if(Nn>=Ee){let Nt=ot-B,Rt=yt-A;Nt*Nt+Rt*Rt<=de&&(wt=!0)}else{let Nt=Ht*Xe-Xt*Ce;Nt*Nt<=ze&&(wt=!0)}wt&&(!Ge.el&&!Ge.isRemoved&&qe(Ge),Ge.el&&fe.push(Ge.el))}return fe}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;_e||Ie()}});function on(){R()&&ye(1)}let kt=[],mn=[];function mo(S,T){if(!S||!T)return;let B=S.size||r,A=T.size||r,N=S.x+B/2,de=S.y+B/2,fe=T.x+A/2,Te=T.y+A/2;kt.push({x1:N,y1:de,x2:fe,y2:Te,age:0,life:.15})}function tr(S,T,B){if(!L.pf)return;let A=document.createElement("div");A.className="coin-stain";let N=B*1.2;A.style.width=`${N}px`,A.style.height=`${N}px`,A.style.left=`${S-N/2}px`,A.style.top=`${T-N/2}px`,L.pf.appendChild(A),setTimeout(()=>{A.style.opacity="0",setTimeout(()=>{A.parentNode&&A.remove()},1e3)},2500)}function Mo(S,T){let B=Math.random()*Math.PI*2,A=(S.size||r)/2,N=A*f0,de=Math.cos(B)*N,fe=Math.sin(B)*N,Te=A*(.7+Math.random()*.6),Oe=Math.cos(B)*(N+Te),Pe=Math.sin(B)*(N+Te);kt.push({parentCoin:S,relX1:de,relY1:fe,relX2:Oe,relY2:Pe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let ke=3+Math.floor(Math.random()*3);for(let Ue=0;Ue<ke;Ue++){let Ce=.3+Math.random()*.5,Xe=de+(Oe-de)*Ce,Ee=fe+(Pe-fe)*Ce,ze=B+(Math.random()*1.2-.6),He=Te*(.4+Math.random()*.4),nt=Xe+Math.cos(ze)*He,Ge=Ee+Math.sin(ze)*He;kt.push({parentCoin:S,relX1:Xe,relY1:Ee,relX2:nt,relY2:Ge,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}dt("sounds/lightning_zap.ogg",{volume:.25})}function To(S,T,B){if(!S)return;let A=S.size||r,N=performance.now(),de=Le(S,N),fe=de.x+A/2,Te=de.y+A/2,Oe=T-fe,Pe=B-Te,ke=Math.atan2(Pe,Oe),Ue=Math.sqrt(Oe*Oe+Pe*Pe),Ce=A/2*f0,Xe=Math.cos(ke)*Ce,Ee=Math.sin(ke)*Ce;kt.push({parentCoin:S,relX1:Xe,relY1:Ee,x2:T,y2:B,age:0,life:.25,width:6,jaggedScale:25});let ze=fe+Xe,He=Te+Ee,nt=6+Math.floor(Math.random()*5);for(let Ge=0;Ge<nt;Ge++){let At=.1+Math.random()*.8,ot=ze+(T-ze)*At,yt=He+(B-He)*At,Ht=ke+(Math.random()*1.6-.8),Xt=Ue*(.1+Math.random()*.3),Nn=ot+Math.cos(Ht)*Xt,wt=yt+Math.sin(Ht)*Xt;if(kt.push({x1:ot,y1:yt,x2:Nn,y2:wt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Rt=ot+(Nn-ot)*.5,ho=yt+(wt-yt)*.5,rn=Ht+(Math.random()*1-.5),zs=Xt*.5;kt.push({x1:Rt,y1:ho,x2:Rt+Math.cos(rn)*zs,y2:ho+Math.sin(rn)*zs,age:0,life:.25,width:1.5,jaggedScale:10})}}}function nr(S){if(!P||!x)return;P.clearRect(0,0,x.width,x.height);let T=performance.now();P.lineCap="round",P.lineJoin="round";for(let B=kt.length-1;B>=0;B--){let A=kt[B];if(A.age+=S,A.age>=A.life){kt.splice(B,1);continue}let N=A.x1,de=A.y1,fe=A.x2,Te=A.y2;if(A.parentCoin){let ke=Le(A.parentCoin,T),Ue=ke.x+(A.parentCoin.size||r)/2,Ce=ke.y+(A.parentCoin.size||r)/2;N=Ue+A.relX1,de=Ce+A.relY1,A.relX2!==void 0&&(fe=Ue+A.relX2,Te=Ce+A.relY2)}let Oe=1-A.age/A.life;P.strokeStyle=`rgba(200, 240, 255, ${Oe})`,P.lineWidth=A.width||3,P.shadowColor="rgba(220, 245, 255, 0.9)",P.shadowBlur=20;let Pe=6;P.beginPath(),P.moveTo(N,de);for(let ke=1;ke<=Pe;ke++){let Ue=ke/Pe,Ce=N+(fe-N)*Ue,Xe=de+(Te-de)*Ue;if(ke===Pe)P.lineTo(fe,Te);else{let Ee=-(Te-de),ze=fe-N,He=Math.sqrt(Ee*Ee+ze*ze),nt=A.jaggedScale||40;if(He>0){let Ge=(Math.random()-.5)*nt*(1-Math.abs(Ue-.5));P.lineTo(Ce+Ee/He*Ge,Xe+ze/He*Ge)}else P.lineTo(Ce,Xe)}}P.stroke(),P.shadowBlur=0}for(let B=mn.length-1;B>=0;B--){let A=mn[B];if(A.age+=S,A.age>=A.life){mn.splice(B,1);continue}A.x+=A.vx*S,A.y+=A.vy*S;let N=1-A.age/A.life;P.fillStyle=A.color,P.globalAlpha=N,P.beginPath(),P.arc(A.x,A.y,A.size,0,Math.PI*2),P.fill(),P.globalAlpha=1}}return{start:Ie,stop:I,setRate:Y,clearBacklog:z,clearPlayfield:oe,setCoinSprite:ge,getCoinTransform:ae,findCoinsInRadius:Gt,findCoinsInPath:st,findCoinTargetsInRadius:tt,findCoinTargetsInPath:be,ensureCoinVisual:qe,removeCoinTarget:Be,detachCoin:C,recycleCoin:le,playEntranceWave:on,setDependencies:_,hasBigCoins:()=>mt(2)&&V.some(S=>S&&S.sizeIndex>=4)}}var Ds,xi,mx,c0,gx,u0,f0,vx,bx,d0,Sx,h0=De(()=>{Pl();wo();Io();ro();Rn();Sm();So();Ds=!1,xi=0n,mx=2500,c0=new Map;try{p0(lt())}catch{Ds=!1,xi=0n}try{ci(e=>{p0(e)})}catch{}gx="cubic-bezier(0.215, 0.61, 0.355, 1)";u0=[40,55,80,125,200,320,512],f0=.78,vx=[1,25,625,15625,390625,9765625,244140625],bx=[0,.1,.01,.001,1e-4,1e-5,1e-6],d0=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],Sx=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var E0={};vt(E0,{afterSlotWrite:()=>Lm,beforeSlotWrite:()=>xm});function S0(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Lx(e,t=Ex){!e||e<=0||vl.set(e,S0()+t)}function y0(e){if(!e||e<=0)return!1;let t=vl.get(e);return t==null?!1:t<=S0()?(vl.delete(e),!1):!0}function _x(){vl.clear()}function $u(){try{return typeof localStorage<"u"}catch{return!1}}function Em(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function I0(e){let t=new Map;if(!$u())return bl.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Ti))continue;let r=Em(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return bl.set(e,t),t}function w0(e){return!Number.isFinite(e)||e<=0?null:bl.has(e)?bl.get(e):I0(e)}function xm(e){if(!$u()||Du>0)return;let t=String(e);if(!t.startsWith(Ti))return;let n=Em(t);if(n==null)return;let o=w0(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(Du===0){Du+=1;try{hn(n)}finally{Du-=1}}I0(n);return}}}catch{}}function Lm(e,t){let n=String(e);if(!n.startsWith(Ti))return;let o=Em(n);if(o==null)return;let r=w0(o)||new Map;r.set(n,String(t??"")),bl.set(o,r)}function Cx(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function Mx(){let e=new Map;if(!$u())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Ti))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=lf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function Tx(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=v();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function kx(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=cf(e);if(n.length===0){o&&(y0(e)||hn(e),kl(e,null));return}let r=Cx(n);o&&r!==o&&!y0(e)&&hn(e),r!==o&&kl(e,r)}function qs(){if(!$u())return;let e=Mx();Tx(e).forEach(n=>{let o=e.get(n)??[];kx(n,o)})}function Ax(){if(Im!=null)return;Im=(typeof window<"u"?window:globalThis).setTimeout(()=>{Im=null,qs()},xx)}function Nx(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){Lx(o),Ax();return}vl.delete(o),qs()}}function Rx(){typeof window>"u"||g0==null&&(g0=window.setInterval(qs,wx))}function Ox(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function $s(){let e=Ox();if(!e)return;if(!ki()){(e.dataset.poopShopApplied===wm||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==v0||e.dataset.poopShopApplied!==wm)&&(e.style.backgroundImage=v0,e.dataset.poopShopApplied=wm)}function Px(){typeof window>"u"||b0==null&&($s(),b0=window.setInterval($s,50),window.addEventListener("saveSlot:change",$s),window.addEventListener("saveSlot:modified",e=>{try{let t=v();e?.detail?.slot===t&&$s()}catch{$s()}}))}function Bx(){typeof window>"u"||(qs(),Rx(),Px(),window.addEventListener("saveSlot:change",()=>qs()),window.addEventListener("saveIntegrity:storageMutation",Nx,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(_x(),qs(),$s())}))}var wx,Ex,xx,g0,Im,vl,bl,Du,v0,wm,b0,_m=De(()=>{bt();wx=1e4,Ex=750,xx=50,g0=null,Im=null,vl=new Map;bl=new Map,Du=0;v0="linear-gradient(180deg,#a9793d,#7b5534)",wm="1",b0=null;Bx()});var R0={};vt(R0,{initPopups:()=>qx,teardownpopups:()=>Gx});function Cm(){return po||(po=document.createElement("div"),po.className="currency-popups",po.setAttribute("aria-live","polite"),po.setAttribute("aria-atomic","false"),document.body.appendChild(po),po)}function Li(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function Mm(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function L0(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):J(n);t&&(t.innerHTML=r)}function Ux(e,t=_0){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Sl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function Dx(e,t,n){Cm();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function Tm(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=v();if(o!=null){if(["xp"].includes(e)){if(sn(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(sn(`ccc:mutation:progress:${o}`))return}else if(Object.values(Me).includes(e)&&On(e,o))return}let r=Fx[e],i=Object.assign({duration:_0,accumulate:!0},r||{},n);if(!i.icon)return;let s=Li(t);if(!s||Mm(s))return;let l=i.accumulate!==!1?Sl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,L0(l);return}let a=Dx(e,i,s);a.meta=i,L0(a),Sl.set(e,a);let u=Cm(),d=x0.indexOf(e),f=null;if(d>=0){let p=Array.from(u.children);for(let g of p){let m=g.dataset.type;if(x0.indexOf(m)>d){f=g;break}}}f?u.insertBefore(a.element,f):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),Ux(a,i.duration)}function $x(){let e={};for(let t of Object.values(Me))e[t]=ea(t);return e}function C0(){try{let e=$x();Object.entries(e).forEach(([t,n])=>{let o=Li(n)||c.fromInt(0);Rr.set(t,o.clone?.()??o)}),Rr.has("mp")||Rr.set("mp",c.fromInt(0))}catch{Rr.clear()}}function M0(){Sl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Sl.clear()}function T0(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Li(t.value)||c.fromInt(0),r=Rr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Li(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&Tm(n,s),Rr.set(n,o.clone?.()??o)}function k0(e){let t=e?.detail;if(!t)return;let n=Li(t.xpAdded);n&&!Mm(n)&&Tm("xp",n)}function A0(e){let t=e?.detail;if(!t)return;let n=Li(t.delta);n&&!Mm(n)&&Tm("mp",n);let o=Li(t.progress);o&&Rr.set("mp",o.clone?.()??o)}function N0(){M0(),C0()}function qx(){qu||(qu=!0,Cm(),C0(),window.addEventListener("currency:change",T0),window.addEventListener("xp:change",k0),window.addEventListener("mutation:change",A0),window.addEventListener("saveSlot:change",N0))}function Gx(){qu&&(window.removeEventListener("currency:change",T0),window.removeEventListener("xp:change",k0),window.removeEventListener("mutation:change",A0),window.removeEventListener("saveSlot:change",N0),M0(),Rr.clear(),po&&po.remove(),po=null,qu=!1)}var _0,x0,Fx,po,qu,Rr,Sl,O0=De(()=>{Lt();zt();bt();_0=6767,x0=["coins","xp","books","gold","mp","magic","gears"],Fx={[Me.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Me.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Me.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Me.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Me.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"}},po=null,qu=!1,Rr=new Map,Sl=new Map});var G0={};vt(G0,{flushBackupSnapshot:()=>q0,getSuspendMetadata:()=>iL,installSuspendSafeguards:()=>rL,markProgressDirty:()=>Co,restoreFromBackupIfNeeded:()=>oL});function Il(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function Ys(){if(typeof localStorage>"u")return!1;try{let e=`${Zn}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function U0(){if(!Il())throw new Error("IndexedDB unavailable");return Gs||(Gs=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(Hx,Xx);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(Vs)||r.createObjectStore(Vs)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}Gs=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw Gs=null,e}),Gs)}function zx(){if(!Ys())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(Zn))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function Kx(e){try{let t=await U0();return await new Promise((n,o)=>{let r=!1,i=t.transaction(Vs,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(Vs).put(e,F0);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function jx(){try{let e=await U0();return await new Promise((t,n)=>{let o=!1,r=e.transaction(Vs,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(Vs).get(F0);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function Zx(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function km(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function Jx(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function eL(e){return!(typeof e!="string"||e.length===0||Qx.test(e))}function Am(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(Zn)||n.startsWith(Vx)||n.startsWith(Yx))return;let o=Jx(n);if(o!=null)try{let r={key:n,slot:o,trusted:eL(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function tL(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=km(),a=String(i),u=this===localStorage&&a.startsWith(Zn);if(u)try{xm(a)}catch{}let d;try{d=t.apply(this,arguments)}finally{try{if(u){Co("setItem");try{Lm(a,s)}catch{}}this===localStorage&&a.startsWith(Zn)&&Am(a,l)}catch{}}return d}),typeof n=="function"&&(e.removeItem=function(i){let s=km(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(Zn)&&(Co("removeItem"),Am(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=km(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Co("clear"),Am(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function D0(e="idle"){Xs=e||Xs,Or=!0,!Hs&&(Hs=setTimeout(()=>{if(Hs=null,!Or)return;let t=Xs;Or=!1,q0(t)},Wx))}function $0(){Hs&&(clearTimeout(Hs),Hs=null)}function Co(e="dirty"){try{D0(e)}catch{}}async function Nm(e="manual"){if(!Ys()||!Il())return!1;let t=zx();if(!t)return!1;t.reason=e,Hu=!1;let n=await Kx(t);return n||(Or=!0,D0("retry")),n}async function q0(e="manual",{immediate:t=!1}={}){return!Ys()||!Il()?!1:t?($0(),Or=!1,Hu=!0,Nm(e)):(Or=!0,Xs=e||Xs,Nm(e))}function Gu(e){!Il()||!Ys()||($0(),Or=!1,Hu=!0,Nm(e))}function nL(){if(!Ys())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(Zn))return!0}}catch{}return!1}async function oL(){if(B0||(B0=!0,!Ys()||!Il()))return!1;let e=!1;try{if(!nL())e=!0;else{let o=localStorage.getItem(`${Zn}saveSlot`);if(o){let r=`${Zn}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await jx();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Co("restored"),n}function rL(){if(P0||(P0=!0,typeof window>"u"))return;Zx(),tL();let e=()=>{document.hidden?Gu("visibility-hidden"):Co("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>Gu("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>Gu("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>Gu("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Co("pageshow"))}catch{}try{window.addEventListener("focus",()=>Co("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(Zn)||Co("storage-event"))})}catch{}Co("boot")}function iL(){return{pendingImmediateFlush:Hu,dirty:Or,lastDirtyReason:Xs}}var Zn,Hx,Xx,Vs,F0,Vx,Yx,Wx,Gs,Hs,Or,Xs,P0,B0,Hu,Qx,H0=De(()=>{_m();Zn="ccc:",Hx="ccc:safety",Xx=1,Vs="snapshots",F0="latest",Vx=`${Zn}slotSig`,Yx=`${Zn}slotMod`,Wx=1e3,Gs=null,Hs=null,Or=!1,Xs="init",P0=!1,B0=!1,Hu=!1;Qx=/\bat <anonymous>:\d+:\d+\b/});var X0={};vt(X0,{initGlobalOverlayEsc:()=>lL});function aL(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i}of sL){let s=document.querySelectorAll(o);if(s.length>0){if(i){t=!0;continue}let a=s[s.length-1].querySelector(r||".shop-close");a&&(a.click(),n=!0)}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function lL(){window.addEventListener("keydown",aL,!0)}var sL,V0=De(()=>{sL=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".automation-shop-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close"}]});var Y0={};vt(Y0,{ensureGameDom:()=>cL});function cL(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>
`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var W0=De(()=>{});function dL(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function pL(){if(!je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function hL(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let d=document.createElement("div");d.textContent=je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(d.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),d.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),d.textContent="Loading skipped",d.style.textDecoration="none",d.style.cursor="default",t())}),o.appendChild(d)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function gL(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function yL(e){if(!e||e.__done)return;e.__done=!0;let t=500;e.__label&&(e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let n=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,450)},t)}async function Bm(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function vL(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function bL(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Rn(),xl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function SL(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function IL({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...vL(e,s),...bL(t,s),...n?SL(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function wL(e){if(Ws===e)return;nn&&(nn.stop(),nn=null),Ws=e;let t=document.querySelector(".menu-root");switch(e){case er.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Ws===er.STARTER_COVE&&(nn=dt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},25)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Hm=="function"&&Hm(n,80),_i){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(_i.init("water-background",i),Vu){try{Vu()}catch{}Vu=null}if(Yu){try{Yu()}catch{}Yu=null}typeof qm=="function"&&(Vu=qm(s=>_i.update(s))),typeof Gm=="function"&&(Yu=Gm((s,l)=>_i.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,_i&&requestAnimationFrame(()=>_i.resize()),cb()),typeof Um=="function")try{Um()}catch{}if(typeof Dm=="function")try{Dm()}catch{}if(!tn){tn=ab({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=tn;let i=()=>{if(!(!tn||typeof tn.setCoinSprite!="function"))try{tn.setCoinSprite(pb?.())}catch{}};i(),mb?.(i);let s=lb({spawner:tn});tn&&typeof tn.setDependencies=="function"&&tn.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=ub(),u=fb(a);if(tn&&u?.coinsPerSecondMult){let d=1*u.coinsPerSecondMult;if(typeof $m=="function"){let f=$m("spawnRate",d);try{f&&typeof f.toScientific=="function"?d=Number(f.toScientific(6)):d=Number(f)}catch{}}Number.isFinite(d)&&tn.setRate(d)}}catch{}};if(l(),typeof Pm=="function")try{Pm()}catch{}Pm=db(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof Fm=="function")try{Fm()}catch{}tn.start();break}case er.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),tn&&tn.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===er.MENU}}))}catch{}}var uL,je,z0,ab,lb,cb,K0,j0,Z0,J0,Q0,eb,tb,ub,fb,Fm,db,fL,nb,ob,rb,Rm,Om,Um,Dm,pb,mb,Xu,$m,ib,qm,Gm,sb,Hm,_i,Vu,Yu,er,Ws,nn,tn,Pm,Wu,mL,Io=De(()=>{Rn();uL=!0,je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia?window.matchMedia("(pointer: coarse)").matches:"ontouchstart"in window;return window.IS_MOBILE=e,e})();je&&document.documentElement.classList.add("is-mobile");Vu=null,Yu=null;pL();er={MENU:0,STARTER_COVE:1},Ws=er.MENU,nn=null,tn=null,Pm=null,Wu=()=>new Promise(e=>requestAnimationFrame(e)),mL=async()=>{await Wu(),await Wu()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(G=>{e=G}),n=hL("Loading assets...",e);await Wu();let{initAudio:o}=await Promise.resolve().then(()=>(Rn(),xl));o();let r=Promise.all([Promise.resolve().then(()=>(pf(),lh)),Promise.resolve().then(()=>(h0(),m0)),Promise.resolve().then(()=>(Ta(),fy)),Promise.resolve().then(()=>(Bc(),Jg)),Promise.resolve().then(()=>(bt(),rh)),Promise.resolve().then(()=>(_m(),E0)),Promise.resolve().then(()=>(cn(),xv)),Promise.resolve().then(()=>(Pl(),uh)),Promise.resolve().then(()=>(Dn(),_h)),Promise.resolve().then(()=>(So(),Ky)),Promise.resolve().then(()=>(wo(),n0)),Promise.resolve().then(()=>(O0(),R0)),Promise.resolve().then(()=>(H0(),G0)),Promise.resolve().then(()=>($i(),Rh)),Promise.resolve().then(()=>(V0(),X0)),Promise.resolve().then(()=>(Ui(),Jv)),Promise.resolve().then(()=>(Xr(),Ph)),Promise.resolve().then(()=>(lc(),cg)),Promise.resolve().then(()=>(Wi(),Xh)),Promise.resolve().then(()=>(wc(),Bg)),Promise.resolve().then(()=>(W0(),Y0)),Promise.resolve().then(()=>(ro(),tg)),Promise.resolve().then(()=>(Sm(),l0)),Promise.resolve().then(()=>(Ki(),sg))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(G,j)=>`img/mutations/m${j+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=IL(i,G=>{s=G,gL(n,G)}),[a,u,d,f,p,g,m,y,h,b,w,L,R,k,F,U,q,x,P,M,_,X,Q,pe]=await r;({initSlots:z0}=a),{createSpawner:ab}=u,{initCoinPickup:lb}=d,{initHudButtons:cb}=f,{bank:J0,getHasOpenedSaveSlot:Q0,setHasOpenedSaveSlot:eb,ensureStorageDefaults:tb,notifyGameSessionStarted:sb}=p,{getCurrentAreaKey:ub,computeUpgradeEffects:fb,onUpgradesChanged:db}=m,{registerPreloadedAudio:fL}=y,{initXpSystem:Fm}=h,{initResetSystem:Um}=b,{initMutationSystem:Dm,getMutationCoinSprite:pb,onMutationChange:mb}=w,{initPopups:nb}=L,{installSuspendSafeguards:ob,restoreFromBackupIfNeeded:rb,markProgressDirty:Rm,flushBackupSnapshot:Om}=R,{installGhostTapGuard:K0,initGlobalGhostTap:j0}=k,{initGlobalOverlayEsc:Z0}=F,{setDebugPanelAccess:Xu,applyStatMultiplierOverride:$m}=U,{startGameLoop:ib,registerTick:qm,registerFrame:Gm}=q;let{initOfflineTracker:K,processOfflineProgress:ne}=x,{initWorkshopSystem:ve}=P,{initAutomationEffects:he}=M;({ensureGameDom:Hm}=_);let{initSurgeEffects:V}=X;({waterSystem:_i}=Q);let{initLabLogic:ee}=pe;window.bank=J0,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(nn){try{nn.stop()}catch{}nn=null}}),window.addEventListener("audio:restartMusic",()=>{if(nn){try{nn.stop()}catch{}nn=null}Ws===er.STARTER_COVE&&(nn=dt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",G=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return G.preventDefault(),G.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let G=document.hidden;Ku(G),nn&&nn.element&&(G?nn.element.pause():nn.element.play().catch(()=>{}))}),K0?.(),j0?.(),Z0?.(),ob?.(),typeof Xu=="function"&&(Xu(uL),window.setDebugPanelAccess=Xu);try{await rb?.()}catch{}await Promise.race([l,t]),await mL(),document.documentElement.classList.remove("booting"),await Wu(),yL(n),await Promise.all([Bm("img/currencies/coin/coin_plus_base.webp"),Bm("img/stats/xp/xp_plus_base.webp"),Bm("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}ib(),K(()=>Ws===er.STARTER_COVE);try{ve()}catch(G){console.error("Workshop init failed",G)}try{he()}catch(G){console.error("Automation init failed",G)}try{V()}catch(G){console.error("Surge effects init failed",G)}try{ee()}catch(G){console.error("Lab system init failed",G)}dL(),tb(),Rm?.("ensure-defaults"),nb();let $=document.getElementById("panel-title");if(Q0()?(document.body.classList.add("has-opened"),$&&($.style.opacity="0")):$&&($.style.opacity="1"),z0(()=>{Ws!==er.STARTER_COVE&&(eb(!0),document.body.classList.add("has-opened"),$&&($.style.opacity="0"),wL(er.STARTER_COVE),ne(),window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave(),sb?.(),Rm?.("slot-entered"))}),typeof window<"u"&&Om)try{window.cccRequestBackup=()=>Om("manual",{immediate:!0})}catch{}})});Io();})();
