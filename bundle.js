(()=>{var nI=Object.defineProperty;var Ue=(e,t)=>()=>(e&&(t=e(e=0)),t);var bt=(e,t)=>{for(var n in t)nI(e,n,{get:t[n],enumerable:!0})};var uc={};bt(uc,{initAudio:()=>oI,loadAudio:()=>Jh,playAudio:()=>ft,registerPreloadedBuffer:()=>iI,setAudioSuspended:()=>Df,setMusicUnderwater:()=>jr});function Ff(){if(Kt)return Kt;let e=window.AudioContext||window.webkitAudioContext;return e?(Kt=new e,Ca=Kt.createGain(),Ca.connect(Kt.destination),Ca.gain.value=1,lc=Kt.createGain(),lc.gain.value=1,lc.connect(Ca),Mo=Kt.createBiquadFilter(),Mo.type="lowpass",Mo.frequency.value=22050,Mo.Q.value=1,Mo.connect(lc),Kt):null}function oI(){Ff()}function rI(){Kt&&Kt.state==="suspended"&&Kt.resume().catch(()=>{})}async function Jh(e){let t=Ff();if(!t)return null;let n=new URL(e,document.baseURI).href;if(Ta.has(n))return Ta.get(n);if(cc.has(n))return cc.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return Ta.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{cc.delete(n)}})();return cc.set(n,o),o}function ft(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=Ff(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=Ta.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(Mo):f.connect(Ca),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else Jh(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function iI(e,t){let n=new URL(e,document.baseURI).href;Ta.set(n,t)}function Df(e){Kt&&(e?Kt.state==="running"&&Kt.suspend().catch(()=>{}):Kt.state==="suspended"&&Kt.resume().catch(()=>{}))}function jr(e){if(!Mo)return;let t=e?600:22050;try{let n=Kt.currentTime;Mo.frequency.cancelScheduledValues(n),Mo.frequency.setValueAtTime(t,n)}catch{Mo.frequency.value=t}}var Kt,Ca,lc,Mo,Ta,cc,Ln=Ue(()=>{Kt=null,Ca=null,lc=null,Mo=null,Ta=new Map,cc=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,rI,{capture:!0,passive:!0})})});function we(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let m=Number(e.sig);if(m>0){let y=Math.log10(m),p=e.e||0,h=Number(e._eOffset||0n);return y+p+h}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let m=Number(u);if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)}else{let m=Number(u.slice(0,15));if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function ie(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function Uf(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/Qh;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/Qh:e>0?e:0}var c,Qh,xt=Ue(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",m=BigInt(u+d);return new e(m,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,{base:this.e-(n|0),offset:this._eOffset},this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};Qh=Math.log(10)});function ng(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return tg.format(t)}catch{return String(e)}}function Aa(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function $f(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+ng(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+tg.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=qf.get(u)||"",m=o-u+1,y=4-m,p=m+y;n.length<p+1&&(n+="0".repeat(p+1-n.length));let h=n.slice(0,p);(n.charCodeAt(p)||48)>=53&&(h=Aa(h));let v,w;return h.length>p?(v=h.slice(0,m+1),w="0".repeat(y)):(v=h.slice(0,m),w=h.slice(m)),t+`${v}${y?"."+w:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Aa(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+$f(String(o))}function aI(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+$f(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=Aa(f)),l){let C=f.slice(0,1)+"."+f.slice(1),k=i==="-"?"-":"";return t+C+"e"+$f(s,k)}let m=Math.floor(a/3)*3,y=qf.get(m)||"",h=a-m+1,g=4-h,v,w;return f.length>4?(v=f.slice(0,h+1),w="0".repeat(g)):(v=f.slice(0,h),w=f.slice(h)),t+(i==="-"?"-":"")+v+(g?"."+w:"")+y}function eg(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Aa(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+aI(l)}function K(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return eg(e.toScientific(3));if(t<6)return ng(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=qf.get(n);if(!o)return eg(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Aa(u));let d,m;return u.length>l?(d=u.slice(0,i+1),m="0".repeat(s)):(d=u.slice(0,i),m=u.slice(i)),`${d}${s?"."+m:""}${o}`}function Te(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=we(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return K(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):K(c.fromAny(t))}catch{return"1"}}var sI,qf,tg,qt=Ue(()=>{xt();sI=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],qf=new Map(sI),tg=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var pg={};bt(pg,{CURRENCIES:()=>Re,KEYS:()=>wt,STORAGE_PREFIX:()=>Qi,bank:()=>R,clearActiveSlot:()=>bI,clearAllStorage:()=>EI,ensureCurrencyDefaults:()=>Qf,ensureMultiplierDefaults:()=>ed,ensureStorageDefaults:()=>wI,getActiveSlot:()=>b,getCurrency:()=>Ra,getCurrencyMultiplierBN:()=>dg,getHasOpenedSaveSlot:()=>II,getLastSaveTime:()=>Kf,getLastSaveTimeKey:()=>hc,getSlotModifiedFlagKey:()=>SI,getSlotSignature:()=>Jf,getSlotSignatureKey:()=>Zf,hasModifiedSave:()=>es,isCurrencyLocked:()=>dn,isStorageKeyLocked:()=>jt,markSaveSlotModified:()=>_n,notifyGameSessionStarted:()=>yI,onCurrencyChange:()=>mc,peekCurrency:()=>Oa,primeStorageWatcherSnapshot:()=>ct,setActiveSlot:()=>jf,setCurrency:()=>Zi,setCurrencyMultiplierBN:()=>vc,setHasOpenedSaveSlot:()=>yc,setSlotSignature:()=>gc,updateLastSaveTime:()=>ug,watchStorageKey:()=>At});function Xf(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Vf(e){let t=Xf(e);return t==null?null:`${lI}:${t}`}function Yf(e){let t=Xf(e);return t==null?null:`${cI}:${t}`}function ag(e={}){fc.size!==0&&fc.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function mc(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return fc.add(o),()=>{fc.delete(o)}}function fI(){if(ka!=null||Go.size===0)return;ka=(typeof window<"u"?window:globalThis).setInterval(pI,uI)}function lg(){if(Go.size!==0||ka==null)return;(typeof window<"u"?window:globalThis).clearInterval(ka),ka=null}function cg(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function dI(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function pI(){if(Go.size===0){lg();return}Go.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=cg(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!dI(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function At(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Go.get(e);return s||(s=new Set,Go.set(e,s)),s.add(i),fI(),()=>{let l=Go.get(e);l&&(l.delete(i),l.size===0&&(Go.delete(e),lg()))}}function ct(e,t){if(!e)return;let n=Go.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=cg(r,o),r.initialized=!0)})}function Wf(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function mI(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function hI(){Gf.forEach(e=>{try{e?.()}catch{}}),Gf.clear()}function rg(e){if(e!==og&&(hI(),og=e??null,e!=null))for(let t of Object.values(Re)){let n=`${wt.CURRENCY[t]}:${e}`,o=At(n,{parse:mI,equals:Wf,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};ag(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Gf.set(n,o)}}function gI(){typeof window>"u"||(rg(b()),window.addEventListener("saveSlot:change",()=>{rg(b())}))}function yI(){zf=!0}function hc(e=b()){return e==null?null:`${Sr}lastSaveTime:${e}`}function ug(){if(!zf||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(hc(e),String(t))}catch{}}function Kf(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(hc(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function vI(){typeof window>"u"||(ig||(ig=setInterval(ug,1e3)),window.addEventListener("beforeunload",()=>{if(!zf)return;let e=b();if(e!=null)try{localStorage.setItem(hc(e),String(Date.now()))}catch{}}))}function b(){if(vr!==void 0)return vr;let e=localStorage.getItem(wt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return vr=n,n}function jf(e){let t=Math.max(1,parseInt(e,10)||1);vr=t,localStorage.setItem(wt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function bI(){vr=null,localStorage.removeItem(wt.SAVE_SLOT)}function Na(e,t=b()){return t==null?null:`${e}:${t}`}function fg(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function jt(e){return fg(e)}function Zf(e=b()){return Vf(e)}function SI(e=b()){return Yf(e)}function Jf(e=b()){if(typeof localStorage>"u")return null;let t=Vf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function gc(e,t){if(typeof localStorage>"u")return;let n=Vf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function es(e=b()){if(typeof localStorage>"u")return!1;let t=Yf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function _n(e=b()){if(typeof localStorage>"u")return;let t=Xf(e);if(t==null||es(t))return;let n=Yf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function II(){return localStorage.getItem(wt.HAS_OPENED_SAVE_SLOT)==="true"}function yc(e){localStorage.setItem(wt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function wI(){localStorage.getItem(wt.HAS_OPENED_SAVE_SLOT)===null&&yc(!1)}function Qf(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${wt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function ed(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${wt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))pc(t);else{let o=br(c.fromInt(1));Ji(t,o)}}}function Ra(e){let t=Na(wt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Zi(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=Na(wt.CURRENCY[e],r),s=o??Ra(e),l=c.fromInt(0);if(!i||dn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,m=a;try{f!=null&&(m=c.fromAny(f),m.isNegative?.()&&(m=c.fromInt(0)))}catch{}ct(i,d);let y=!Wf(s,m),h=(v=>{if(v==null)return null;try{let w=v instanceof c?v.clone?.()??v:c.fromAny(v);if(typeof w.cmp=="function")return w.cmp(l)>0?w:null;if(!w.isZero?.())return w}catch{}return null})(n),g=null;if(y)try{g=m.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=h),y||g){let v={key:e,value:m,slot:r,delta:g??void 0};ag(v);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:v}))}catch{}}return m}function br(e){return e.mulScaledIntFloor(1n,-Hf)}function dc(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,Hf)}function pc(e){let t=Na(wt.MULTIPLIER[e]);if(!t)return br(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Zr)){let r=br(c.fromInt(1));return Ji(e,r),r}let o=n.slice(Zr.length);try{return c.fromAny(o)}catch{let r=br(c.fromInt(1));return Ji(e,r),r}}function Ji(e,t,n=b()){let o=Na(wt.MULTIPLIER[e],n);if(!o||dn(e,n))return;let r=br(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Zr))try{r=c.fromAny(i.slice(Zr.length))}catch{}let s=c.fromAny(t),l=Zr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(Zr)?u.slice(Zr.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{ct(o,u)}catch{}if(!Wf(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:dc(f),slot:n}}))}catch{}}function dg(e){return dc(pc(e))}function dn(e,t=b()){let n=Na(wt.CURRENCY[e],t);return fg(n)}function vc(e,t){let n=c.fromAny(t),o=br(n);return Ji(e,o,b()),n}function Oa(e,t){let n=localStorage.getItem(`${wt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function EI(){Object.values(wt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function sg(e){let t=n=>{try{let o=c.fromAny(n);return typeof K=="function"?K(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return Ra(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Zi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Zi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Zi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof K=="function"?K(r):r.toString()},t.mult={get(){return dg(e)},set(n){return vc(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=pc(e).mulBigNumInteger(o);return r.isZero()&&(r=br(c.fromInt(1))),Ji(e,r),dc(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),Hf)}catch{o={numer:1n,scale:0}}let r=pc(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=br(c.fromInt(1))),Ji(e,r);let i=dc(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var Sr,Qi,lI,cI,Hf,Zr,uI,Go,ka,fc,Gf,og,ig,zf,wt,Re,vr,R,St=Ue(()=>{xt();qt();Sr="ccc:",Qi=Sr,lI=`${Sr}slotSig`,cI=`${Sr}slotMod`,Hf=18,Zr="XM:",uI=140,Go=new Map,ka=null,fc=new Set;Gf=new Map,og=null;ig=null,zf=!1;vI();wt={HAS_OPENED_SAVE_SLOT:`${Sr}hasOpenedSaveSlot`,SAVE_SLOT:`${Sr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Re={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===wt.SAVE_SLOT){if(e.newValue===null)vr=null;else{let t=parseInt(e.newValue,10);vr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:vr}}))}catch{}}});for(let e of Object.values(Re))wt.CURRENCY[e]=`${Sr}${e}`,wt.MULTIPLIER[e]=`${Sr}mult:${e}`;gI();R=new Proxy({},{get(e,t){if(Object.values(Re).includes(t))return sg(t);if(typeof t=="string"&&Re[t.toUpperCase?.()])return sg(Re[t.toUpperCase()])}});if(typeof window<"u"){window.bank=R;for(let e of Object.values(Re))window[e]=R[e]}});function hg(){return Co}function bc(e){Co=!!e,document.body.classList.toggle("slots-delete-mode",Co);let t=document.getElementById("manage-saves");t&&(t.textContent=Co?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",Co),n.setAttribute("aria-pressed",Co?"true":"false")})}function xI(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function LI(){if(mg)return;mg=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),bc(!Co)}),window.addEventListener("keydown",r=>{Co&&r.key==="Escape"&&bc(!1)});let n=r=>{!Co||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!Co)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(xI(s),b()===s)try{localStorage.removeItem(wt.SAVE_SLOT)}catch{}td(),bc(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),bc(!1)}var Co,mg,gg=Ue(()=>{St();nd();Co=!1,mg=!1;document.addEventListener("DOMContentLoaded",()=>{try{LI()}catch{}})});var yg={};bt(yg,{initSlots:()=>CI,refreshSlotsView:()=>td});function _I(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function MI(e){if(!_I(e))return"No Save Data";try{let t=Oa(e,"coins");return K(t)}catch{return"0"}}function od(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=MI(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function CI(e){let t=document.querySelectorAll(".slot-card");od(),t.forEach((n,o)=>{let r=o+1,i=s=>{jf(r),Qf(),ed(),yc(!0),typeof e=="function"&&e(r,s),od()};n.addEventListener("click",s=>{hg()||(s.preventDefault(),i(s))})})}function td(){od()}var nd=Ue(()=>{xt();qt();gg();St()});var bg={};bt(bg,{registerPreloadedAudio:()=>TI,takePreloadedAudio:()=>AI});function TI(e,t){let n=vg(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}Sc.set(n,t)}}function AI(e){let t=vg(e);if(!Sc.has(t))return null;let n=Sc.get(t);return Sc.delete(t),n}var Sc,vg,Ic=Ue(()=>{Sc=new Map,vg=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function ts(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var rd=Ue(()=>{});var Pg={};bt(Pg,{addExternalCoinMultiplierProvider:()=>co,addExternalXpGainMultiplierProvider:()=>Xo,addXp:()=>as,broadcastXpChange:()=>Mc,computeCoinMultiplierForXpLevel:()=>hd,getXpGainMultiplier:()=>Tc,getXpLevelStorageKey:()=>kI,getXpRequirementForXpLevel:()=>Cc,getXpState:()=>Qe,initXpSystem:()=>is,isXpSystemUnlocked:()=>mn,onXpChange:()=>Lc,refreshCoinMultiplierFromXpLevel:()=>Zt,resetXpProgress:()=>ss,setExternalBookRewardProvider:()=>Ac,setExternalCoinMultiplierProvider:()=>Rg,setExternalXpGainMultiplierProvider:()=>Og,unlockXpSystem:()=>ti});function kI(e=b()){let t=e??b();return t==null?null:Jr(t)}function pn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function wc(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function Mg(e){if(!e||typeof e!="object")return 0;if(pn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function OI(e){return!e||typeof e!="object"?0:pn(e)||typeof e.cmp=="function"&&e.cmp(_g)>=0?Number.POSITIVE_INFINITY:Mg(e)}function Ig(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(RI,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.($a())??c.fromInt(0):n}function PI(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(Lg,18)}function BI(e){if(pn(e)||typeof e.cmp=="function"&&e.cmp(_g)>=0)return Mt.clone?.()??Mt;let t=e.floorToInteger(),n=e.sub(t),o=Mg(n);if(!Number.isFinite(o))return Mt.clone?.()??Mt;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return Mt.clone?.()??Mt;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),p=Number(y),h=d-y;return new c(a,{base:p,offset:h})}function Cg(e){if(!e||typeof e!="object")return Mt.clone?.()??Mt;let n=PI(e),o=BI(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return Mt.clone?.()??Mt;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function Tg(){let e=pn(V.xpLevel),t=pn(V.progress);if(!e&&!t)return!1;let n=Mt.clone?.()??Mt;if(V.xpLevel=n.clone?.()??n,V.progress=n.clone?.()??n,Lt=n.clone?.()??n,R?.books)try{typeof R.books.set=="function"?R.books.set(n.clone?.()??n):typeof R.books.add=="function"&&R.books.add(n.clone?.()??n)}catch{}return!0}function Fa(e={}){Ua.size!==0&&Ua.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Lc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return Ua.add(n),()=>{Ua.delete(n)}}function Ft(){return c.fromInt(0)}function $a(){return c.fromInt(1)}function ns(e){if(!e)return Ft();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ft()}}function Ec(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function FI(){for(;dd.length>0;){let e=dd.pop();try{e?.()}catch{}}}function Eg(e){if(e==null)return Ft();try{return c.fromAny(e)}catch{return Ft()}}function ad(e){if(!sd){sd=!0;try{let t=pd??b(),n={unlocked:V.unlocked,xpLevel:ns(V.xpLevel),progress:ns(V.progress),requirement:ns(Lt)};on(!0),lo(),Cn(!0);let o={unlocked:V.unlocked,xpLevel:ns(V.xpLevel),progress:ns(V.progress),requirement:ns(Lt)},r=n.unlocked!==o.unlocked,i=!Ec(n.xpLevel,o.xpLevel),s=!Ec(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ft();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ft()}catch{l=Ft()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||Ua.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(Fa(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{sd=!1}}}function ld(e){if(e===pd||(FI(),pd=e??null,e==null))return;let t=(n,o)=>{let r=At(n,o);typeof r=="function"&&dd.push(r)};t(Pa(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>ad("unlock")}),t(Jr(e),{parse:Eg,equals:Ec,onChange:()=>ad("xpLevel")}),t(rs(e),{parse:Eg,equals:Ec,onChange:()=>ad("progress")})}function Ag(){if(wg){ld(b());return}wg=!0,ld(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{ld(b()),on(!0),lo(),Cn(!0)})}function cd(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function DI(e){let t=e<Sg?e:Sg;if(t<=os)return;let n=os,o=Ir.get(n.toString());for(o||(o=c.fromInt(10),Ir.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),Ir.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){os=n;return}}os=n}function UI(e){let t=os>0n?os:0n,n=Ir.get(t.toString());if(!n||pn(n))return Mt.clone?.()??Mt;let o=c.fromAny(t.toString()),r=we(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);wc(s)||(i=i.add?.(s.mulDecimal(Lg,18))??i);let l=Ig(e),a=Ig(o),u=l.sub?.(a)??c.fromInt(0);wc(u)||(i=i.add?.(u.mulDecimal(NI,18))??i);let f=OI(i);return Number.isFinite(f)?ie(f):Mt.clone?.()??Mt}function $I(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=pn(t),o=pn(e);if(n)return o?1:0;if(wc(t)||wc(e))return 0;let s=we(e),l=we(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function kg(){return Mn.container&&Mn.container.isConnected?!0:(Mn.container=document.querySelector(".xp-counter[data-xp-hud]"),Mn.container?(Mn.bar=Mn.container.querySelector(".xp-bar"),Mn.fill=Mn.container.querySelector(".xp-bar__fill"),Mn.xpLevelValue=Mn.container.querySelector(".xp-level-value"),Mn.progress=Mn.container.querySelector("[data-xp-progress]"),!0):!1)}function Ng(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=Ir.get("0");return a.clone?.()??a}if(r.bigInt!=null){DI(i);let a=i.toString(),u=Ir.get(a);if(u)return u.clone?.()??u}let s=UI(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?Mt.clone?.()??Mt:(r.bigInt!=null&&Ir.set(r.bigInt.toString(),s),s.clone?.()??s)}function Ho(){Lt=Ng(V.xpLevel)}function xc(){V.xpLevel=Ft(),V.progress=Ft(),Ho(),Cn(!0)}function xg(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function _c(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function Cn(e=!1){let t=R?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=_c(V.xpLevel),o=n.bigInt,r=!n.finite,i=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null;if(!e&&(r&&Wn||!r&&o!=null&&!Wn&&!zn&&Yn!=null&&o===Yn||!r&&o==null&&zn&&i&&Kn&&i===Kn))return;if(r){try{t.set(Mt)}catch{}Yn=null,Wn=!0,zn=!1,Kn=null;return}let s;if(o!=null&&o<=fd){let f=c.fromInt(1),d=Number(o);for(let y=0;y<d;y+=1)f=f.mulDecimal("1.1",18);let m;try{m=c.fromAny(o.toString())}catch{m=c.fromInt(d)}typeof f.add=="function"?f=f.add(m):typeof m.add=="function"&&(f=m.add(f)),s=f.clone?.()??f}else s=Cg(V.xpLevel);let l=s.clone?.()??s,a=wr.size>0?Array.from(wr):typeof Qr=="function"?[Qr]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Yn=null,Wn=!0,zn=!1,Kn=null):o!=null&&o<=fd?(Yn=o,Wn=!1,zn=!1,Kn=null):(Yn=null,Wn=!1,zn=!0,Kn=i)}function on(e=!1){let t=b();if(t==null)return Ba=null,id=!1,V.unlocked=!1,xc(),V;if(!e&&id&&t===Ba)return V;Ba=t,id=!0;try{let n=localStorage.getItem(Pa(t));V.unlocked=n==="1"}catch{V.unlocked=!1}try{V.xpLevel=c.fromAny(localStorage.getItem(Jr(t))??"0")}catch{V.xpLevel=Ft()}try{V.progress=c.fromAny(localStorage.getItem(rs(t))??"0")}catch{V.progress=Ft()}return(pn(V.xpLevel)||pn(V.progress))&&(V.unlocked=!0),V.unlocked?(Tg(),Ho(),Cn(!0),Ag(),V):(xc(),V)}function Da(){let e=b();if(e==null)return;let t={unlocked:V.unlocked?"1":"0",level:V.xpLevel.toStorage(),progress:V.progress.toStorage()};try{localStorage.setItem(Pa(e),t.unlocked)}catch{}try{localStorage.setItem(Jr(e),t.level)}catch{}try{localStorage.setItem(rs(e),t.progress)}catch{}let n=(()=>{let r=V.unlocked,i=V.xpLevel,s=V.progress;try{r=localStorage.getItem(Pa(e))==="1"}catch{}try{let l=localStorage.getItem(Jr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(rs(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();ct(Pa(e),n.unlocked?"1":"0"),ct(Jr(e),n.level?.toStorage?.()??t.level),ct(rs(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==V.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(V.unlocked=n.unlocked,V.xpLevel=n.level,V.progress=n.progress,Ho(),Cn(!0),lo())}function qI(){Cn(!0);let e=$a();if(typeof ud=="function")try{let n=ud({baseReward:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{R?.books?.addWithMultiplier?R.books.addWithMultiplier(e):R?.books?.add&&R.books.add(e)}catch{}let t=_c(V.xpLevel);t.finite?t.bigInt!=null?(Yn=t.bigInt,Wn=!1,zn=!1,Kn=null):(Yn=null,Wn=!1,zn=!0,Kn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(Yn=null,Wn=!0,zn=!1,Kn=null)}function lo(){if(!kg())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=Mn;if(!e)return;if(!V.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=K(Lt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=cd(K(Lt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}ts();return}e.removeAttribute("hidden");let i=Lt,s=$I(V.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=K(V.xpLevel)),r){let a=K(V.progress),u=K(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=cd(K(V.progress)),u=cd(K(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}ts()}function is({forceReload:e=!1}={}){return kg(),on(e),Ho(),lo(),Ag(),Qe()}function ti(){if(on(),V.unlocked)return lo(),!1;xc(),V.unlocked=!0,Da(),lo(),Cn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Qe()}))}catch{}return!0}function ss({keepUnlock:e=!0}={}){on();let t=V.unlocked;return xc(),V.unlocked=e?t||V.unlocked:!1,Da(),lo(),Cn(!0),Qe()}function as(e,{silent:t=!1}={}){on();let n=Ba??b();if(n!=null&&xg(rs(n)))return{unlocked:V.unlocked,xpLevelsGained:Ft(),xpAdded:Ft(),xpLevel:V.xpLevel,progress:V.progress,requirement:Lt,slot:n};if(!V.unlocked)return{unlocked:!1,xpLevelsGained:Ft(),xpAdded:Ft(),xpLevel:V.xpLevel,requirement:Lt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ft()}if(!o.isZero?.()){let d=Er.size>0?Array.from(Er):typeof ei=="function"?[ei]:[];for(let m of d)if(typeof m=="function")try{let y=m({baseGain:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});y instanceof c?o=y.clone?.()??y:y!=null&&(o=c.fromAny(y))}catch{}}if(o=jn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return lo(),{unlocked:!0,xpLevelsGained:Ft(),xpAdded:o,xpLevel:V.xpLevel,requirement:Lt};V.progress=V.progress.add(o),Ho();let r=n!=null&&xg(Jr(n)),i=pn(V.progress),s=pn(V.xpLevel),l=pn(o);if(i||s||l){let d=Mt.clone?.()??Mt;r||(V.xpLevel=d.clone?.()??d),V.progress=d.clone?.()??d,Ho(),Tg(),Da(),lo(),Cn(!0);let m={unlocked:!0,xpLevelsGained:Ft(),xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:Lt.clone?.()??Lt,slot:n};if(Fa(m),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:m}))}catch{}return m}let a=Ft();if(V.progress.cmp(Lt)<0){Da(),lo();let d={unlocked:!0,xpLevelsGained:Ft(),xpAdded:o,xpLevel:V.xpLevel,progress:V.progress,requirement:Lt,slot:n};if(Fa(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=we(V.progress),m=.08118668602542883,y=we(Lt);if(d-y>2){let g=V.xpLevel,v=d-y,w=Math.floor(v/m);if(w>10){let x=BigInt(Math.max(0,w-5));if(x>0n){let C=c.fromAny(x.toString());if(V.xpLevel=V.xpLevel.add(C),a=a.add(C),Ho(),R?.books?.add)try{let k=C.clone();R.books.add(k)}catch{}}}}let p=0,h=500;for(;V.progress.cmp?.(Lt)>=0&&p<h&&(V.progress=V.progress.sub(Lt),V.xpLevel=V.xpLevel.add($a()),a=a.add($a()),qI(),Ho(),!pn(Lt));)p+=1;p>=h&&V.progress.cmp(Lt)>=0&&Ho()}Da(),lo();let u=_c(V.xpLevel);u.finite?u.bigInt!=null?(Yn=u.bigInt,Wn=!1,zn=!1,Kn=null):(Yn=null,Wn=!1,zn=!0,Kn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(Yn=null,Wn=!0,zn=!1,Kn=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:Lt.clone?.()??Lt,slot:n};if(Fa(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function Qe(){return on(),{unlocked:V.unlocked,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:Lt.clone?.()??Lt}}function Mc(e={}){on();let t=Ba??b(),n={...Qe(),slot:t,...e};if(Fa(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function mn(){return on(),!!V.unlocked}function Cc(e){return Ng(e)}function Tc(){on();let e=$a(),t=Er.size>0?Array.from(Er):typeof ei=="function"?[ei]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function hd(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=_c(t),o=n.bigInt;if(!n.finite)return Mt.clone?.()??Mt;let i;if(o!=null&&o<=fd){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=Cg(t);let s=i.clone?.()??i,l=wr.size>0?Array.from(wr):typeof Qr=="function"?[Qr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!V.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function Rg(e){Qr=typeof e=="function"?e:null,wr.clear(),Qr&&wr.add(Qr),on(),Cn(!0)}function Zt(){on(),Cn(!0)}function Og(e){ei=typeof e=="function"?e:null,Er.clear(),ei&&Er.add(ei)}function co(e){return typeof e!="function"?()=>{}:(wr.add(e),on(),Cn(!0),()=>{wr.delete(e),on(),Cn(!0)})}function Xo(e){return typeof e!="function"?()=>{}:(Er.add(e),on(),()=>{Er.delete(e)})}function Ac(e){ud=typeof e=="function"?e:null}var md,Pa,Jr,rs,Ba,id,Lt,Ir,os,Mt,Yn,Wn,zn,Kn,Qr,ei,wr,Er,ud,Sg,j_,Z_,fd,Lg,NI,RI,_g,V,Ua,Mn,dd,wg,pd,sd,Tn=Ue(()=>{xt();St();ls();qt();rd();md="ccc:xp",Pa=e=>`${md}:unlocked:${e}`,Jr=e=>`${md}:level:${e}`,rs=e=>`${md}:progress:${e}`;Ba=null,id=!1,Lt=c.fromInt(10),Ir=new Map;Ir.set("0",Lt);os=0n,Mt=c.fromAny("Infinity"),Yn=null,Wn=!1,zn=!1,Kn=null,Qr=null,ei=null,wr=new Set,Er=new Set,ud=null,Sg=5000n,j_=Math.log10(11/10),Z_=Math.log10(5/2),fd=200n,Lg="0.04139268515822507",NI="0.3979400086720376",RI="0.1",_g=c.fromScientific(String(c.MAX_E));V={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};Ua=new Set;Mn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};dd=[],wg=!1,pd=null,sd=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:is,unlockXpSystem:ti,addXp:as,getXpState:Qe,broadcastXpChange:Mc,isXpSystemUnlocked:mn,getXpRequirementForXpLevel:Cc,getXpGainMultiplier:Tc,setExternalCoinMultiplierProvider:Rg,addExternalCoinMultiplierProvider:co,refreshCoinMultiplierFromXpLevel:Zt,setExternalXpGainMultiplierProvider:Og,addExternalXpGainMultiplierProvider:Xo,setExternalBookRewardProvider:Ac,resetXpProgress:ss}))});var Gg={};bt(Gg,{GHOST_TAP_TIMEOUT_MS:()=>GI,clearGhostTapTarget:()=>qa,consumeGhostTapGuard:()=>qg,initGlobalGhostTap:()=>JI,installGhostTapGuard:()=>ZI,markGhostTapTarget:()=>$g,setGhostTapSelector:()=>QI,shouldSkipGhostTap:()=>uo,suppressNextGhostTap:()=>To});function Yo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function vd(){return typeof document>"u"?null:document}function VI(e){if(!vd())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(yd)}function qa(e){e&&(e[kc]=0)}function $g(e,t=0,n=null){if(!e)return;let o=Yo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[kc]=o+r:e[kc]=0,XI=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&To(i)}function qg(e){if(typeof window>"u")return!1;let t=window[cs];return typeof t!="number"?!1:Yo()<=t?!0:(window[cs]=null,!1)}function uo(e){if(!e)return!1;let t=Number(e[kc]||0);return!Number.isFinite(t)||t<=0?!1:Yo()<=t?(qa(e),!0):(qa(e),!1)}function To(e=0){if(typeof window>"u")return;let t=Yo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[cs]=null;return}let o=t+n,r=typeof window[cs]=="number"?window[cs]:0;window[cs]=Math.max(r,o)}function YI(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Rc=xr=Yo(),Vo=0))}function WI(e){Rc=xr=Yo(),Vo=0}function zI(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Yo();xr>0&&(Vo=t-xr),Rc=t}function KI(){let e=Yo();xr>0&&(Vo=e-xr),Rc=e}function jI(e){if(!e.isTrusted)return;let t=Yo(),n=xr>0?t-xr:-1,o=VI(e.target);if(uo(o)){Vo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(qg(o)){o&&qa(o),Vo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Vo||n)>=Ug){qa(o),Vo=0,e.preventDefault(),e.stopImmediatePropagation();return}Vo=0}function ZI(e={}){if(Bg)return;let t=vd();!t||typeof window>"u"||(Bg=!0,gd="PointerEvent"in window,Fg=!gd&&"ontouchstart"in window,e.selector&&(yd=`${e.selector}, ${Nc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(Ug=e.longPressMs),t.addEventListener("click",jI,!0),gd?(t.addEventListener("pointerdown",YI,{capture:!0,passive:!1}),t.addEventListener("pointerup",zI,{capture:!0,passive:!0})):Fg&&(t.addEventListener("touchstart",WI,{capture:!0,passive:!1}),t.addEventListener("touchend",KI,{capture:!0,passive:!0})))}function Dg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Nc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&($g(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function JI(){let e=vd();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",Dg,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",Dg,{capture:!1,passive:!1})}function QI(e){e&&(yd=`${e}, ${Nc}`)}var GI,kc,cs,Nc,HI,Bg,yd,gd,Fg,XI,Rc,xr,Vo,Ug,us=Ue(()=>{GI=0,kc=Symbol("ccc:ghostTap:skipUntil"),cs="__cccGhostTapSkipUntil",Nc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',HI=80,Bg=!1,yd=Nc,gd=!1,Fg=!1,XI=null,Rc=0,xr=0,Vo=0,Ug=HI});var bd,Hg=Ue(()=>{bd={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var Xg={};bt(Xg,{RateAccumulator:()=>Ha,pauseGameLoop:()=>xd,registerFrame:()=>rw,registerTick:()=>Ao,resumeGameLoop:()=>Ld,startGameLoop:()=>nw,stopGameLoop:()=>ow});function wd(e){e||(e=performance.now());let t=e;if(Ed){ni=t,ri=requestAnimationFrame(wd);return}ni||(ni=t);let n=(t-ni)/1e3;ni=t,n>60&&(n=60),n<0&&(n=0),oi+=n;let o=0,r=250;for(;oi>=Ga;){if(o>=r){oi=oi%Ga;break}Sd.forEach(i=>{try{i(Ga)}catch(s){console.error("Error in game tick listener:",s)}}),oi-=Ga,o++}if(Id.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),fs===0||ds===0)fs=Date.now(),ds=t;else{let i=t-ds;if(i>tw){let s=Date.now(),l=s-fs;l<-1e3?_n():l>i+1e4&&_n(),fs=s,ds=t}}ri=requestAnimationFrame(wd)}function xd(){Ed=!0}function Ld(){Ed=!1,ni=performance.now(),oi=0,fs=0,ds=0}function nw(){ri||(ni=performance.now(),oi=0,fs=0,ds=0,ri=requestAnimationFrame(wd))}function ow(){ri&&(cancelAnimationFrame(ri),ri=null)}function Ao(e){return typeof e!="function"?()=>{}:(Sd.add(e),()=>{Sd.delete(e)})}function rw(e){return typeof e!="function"?()=>{}:(Id.add(e),()=>{Id.delete(e)})}var ew,Ga,Sd,Id,ri,Ed,ni,oi,fs,ds,tw,Ha,ii=Ue(()=>{St();ew=20,Ga=1/ew,Sd=new Set,Id=new Set,ri=null,Ed=!1,ni=0,oi=0,fs=0,ds=0,tw=2e3;Ha=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Ga;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ze,si,Xa,Va,Ya,Wa,fo,za,ps,iw,sw,aw,lw,cw,Vg,ai=Ue(()=>{xt();Ze="automation",si=1,Xa=2,Va=3,Ya=4,Wa=5,fo=6,za=7,ps={[Xa]:"coins",[Va]:"books",[Ya]:"gold",[Wa]:"magic",[za]:"dna"},iw="img/misc/mysterious.webp",sw="img/misc/locked.webp",aw="Hidden Upgrade",lw="Locked Upgrade",cw=[{area:Ze,id:si,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ze,id:Xa,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ze,id:Va,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ze,id:Ya,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ze,id:Wa,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ze,id:fo,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}},{area:Ze,id:za,title:"Autobuy DNA Upgrades",desc:"Automatically buys DNA upgrades",icon:"sc_upg_icons/autobuy_dna.webp",lvlCap:1,baseCost:1e27,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e27")},effectSummary(){return null},computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=11||t===1/0)&&(n=!0):typeof t=="bigint"?t>=11n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=11)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};if(!e.surgeUnlocked)return{locked:!0,iconOverride:sw,titleOverride:lw,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0};let o="Reach Surge 11 to reveal this upgrade";return{locked:!0,iconOverride:iw,titleOverride:aw,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}],Vg=cw.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});function Wg(e){typeof e=="function"&&Yg.push(e)}function _d(){Ka=null}function Pc(){Ka=null;try{Oc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{Zt()}catch{}}function Md(e){return typeof e=="function"&&Oc.push(e),()=>{Oc=Oc.filter(t=>t!==e)}}function fw(e){let t=ht(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return ie(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function dw(){try{return!!mn()}catch{return!1}}function ja(e){let t=R?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(dw())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=kt(Ee.STARTER_COVE,_e.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=fw(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function ci(e=Ee.STARTER_COVE){if(Ka)return Ka;let t=Ct(e),n=[];if(e===Ee.STARTER_COVE&&Ee.DNA){let i=Ct(Ee.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),goldValue:c.fromInt(1),magicValue:c.fromInt(1),waveValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=An(s,i.id),a=Ve(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:m,mpMult:y}=zo(i,l,s);r.xpValue=yt(r.xpValue,d),r.coinValue=yt(r.coinValue,m),r.mpValue=yt(r.mpValue,y),u=yt(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=yt(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=yt(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=yt(r.mpValue,u);else if(i.effectType==="gold_value")r.goldValue=yt(r.goldValue,u);else if(i.effectType==="magic_value")r.magicValue=yt(r.magicValue,u);else if(i.effectType==="wave_value")r.waveValue=yt(r.waveValue,u);else if(i.effectType==="book_value")r.bookValue=yt(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of Yg)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return Ka=r,r}function ms(e){let t=ci(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:uw*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue,goldValueMultiplier:t.goldValue,magicValueMultiplier:t.magicValue}}function li(){let{goldValue:e,magicValue:t,waveValue:n}=ci(Ee.STARTER_COVE);try{R.gold?.mult?.set&&R.gold.mult.set(e)}catch{}try{if(R.magic?.mult?.set){let o=Cd(),r=yt(t,o);R.magic.mult.set(r)}}catch{}try{R.waves?.mult?.set&&R.waves.mult.set(n)}catch{}}function Bc(){try{let{mpValue:e}=ci(Ee.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Fc(){try{let{magnetRadius:e}=ci(Ee.STARTER_COVE);return e||0}catch{return 0}}function zg(){try{Wo()}catch{}li(),Md(li);try{co(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=ci(Ee.STARTER_COVE);return yt(n,o)})}catch{}try{Xo(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=ci(Ee.STARTER_COVE);return yt(n,o)})}catch{}try{ui(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=ci(Ee.STARTER_COVE);return yt(n,o)})}catch{}ja(),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{try{ja()}catch{}try{Zt()}catch{}try{li()}catch{}}),window.addEventListener("surge:level:change",()=>{try{li()}catch{}}),window.addEventListener("surge:nerf:change",()=>{try{li()}catch{}}))}var uw,Ka,Oc,Yg,Dc=Ue(()=>{xt();St();po();Tn();ho();mo();hn();uw=1,Ka=null,Oc=[],Yg=[]});var ey={};bt(ey,{getLabCost:()=>Jg,getLabLevel:()=>Jt,getLabLevelFromCoins:()=>Qg,getLabLevelKey:()=>Ad,getRpMult:()=>bs,getRpMultBase:()=>qc,hasVisitedLab:()=>vs,initLabLogic:()=>pw,initLabTab:()=>Rd,setLabLevel:()=>di,setLabVisited:()=>Zg,updateLabLevel:()=>kd,updateLabTab:()=>Od});function Ja(){let e=b();if(el=e,e==null){Ko=c.fromInt(0),fi=!1;return}try{let t=localStorage.getItem($c(e));t?Ko=c.fromAny(t):Ko=c.fromInt(0)}catch{Ko=c.fromInt(0)}try{fi=localStorage.getItem(jg(e))==="1"}catch{fi=!1}}function vs(){let e=b();return e==null?!1:((el!==e||fi===null)&&Ja(),fi)}function Zg(e){let t=b();if(t==null)return;let n=!!e;if(!(fi===n&&el===t)){fi=n;try{localStorage.setItem(jg(t),n?"1":"0")}catch{}}}function Jt(){let e=b();return e==null?c.fromInt(0):R.coins.value.isInfinite()?c.fromAny("Infinity"):((el!==e||Ko===null)&&Ja(),Ko)}function di(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((el!==t||Ko===null)&&Ja(),n.cmp(Ko)===0)return;Ko=n,localStorage.setItem($c(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function Jg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Qg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function kd(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has($c(e)))return;let t=R.coins.value,n=Jt();if(t.isInfinite()){n.isInfinite()||di(c.fromAny("Infinity"));return}let o=Qg(t);o.cmp(n)>0&&di(o)}function pw(){Ja(),typeof window<"u"&&window.addEventListener("saveSlot:change",Ja),Ao(kd),Ao(ty),ny()}function Nd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function mw(e){if(!e||typeof e!="object")return 0;if(Nd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function Kg(e){if(Nd(e)||typeof e.cmp=="function"&&e.cmp(hw)>=0)return ys.clone?.()??ys;let t=e.floorToInteger(),n=e.sub(t),o=mw(n);if(!Number.isFinite(o))return ys.clone?.()??ys;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return ys.clone?.()??ys;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),p=Number(y),h=d-y;return new c(a,{base:p,offset:h})}function qc(){let e=Jt();if(Nd(e))return c.fromAny("Infinity");if(se(12)){let o=dt(),r=5*o,i=2+o/2,s=Math.log10(i).toFixed(18),a=e.mulDecimal(s,18).add(c.fromAny(String(r)));return Kg(a)}let n=e.mulDecimal("0.3010299956639812",18);return Kg(n)}function bs(){let e=qc();return typeof jn=="function"?jn("rp",e):e}function Rd(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",Za&&Za.destroy(),Za=new Td(e))}function Od(){Zg(!0),Za&&Za.resize()}var Lr,hs,gs,jg,$c,Ko,fi,el,Ad,ys,hw,Za,Uc,Td,mi=Ue(()=>{St();yo();xt();qt();hn();ii();ls();Zo();hi();mo();Lr=1e308,hs=1e300,gs=1e-300,jg=e=>`ccc:lab:visited:${e}`,$c=e=>`ccc:lab:level:${e}`,Ko=null,fi=null,el=null;Ad=e=>$c(e);ys=c.fromAny("Infinity"),hw=c.fromScientific(String(c.MAX_E));Za=null;Uc=512*.95,Td=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${K(Jt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),kd()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami Exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=Je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>Lr&&(this.camX=Lr),this.camX<-Lr&&(this.camX=-Lr),this.camY>Lr&&(this.camY=Lr),this.camY<-Lr&&(this.camY=-Lr),this.zoom>hs&&(this.zoom=hs),this.zoom<gs&&(this.zoom=gs)}update(t){this.checkBounds();let n=Jt(),o=Jg(n.add(1)),r=kn(),i=Zn(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${K(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${K(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami Exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let m=this.bursts[d];m.time+=t;for(let y of m.particles)y.x+=y.vx*t,y.y+=y.vy*t,y.vx*=.95,y.vy*=.95;m.time>=m.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),m=(M,D)=>{if(D<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*D})`,t.lineWidth=1,t.beginPath();let T=Math.floor((this.camX-n/2/r)/M)*M,_=Math.ceil((this.camX+n/2/r)/M)*M;if((_-T)/M>1e3)return;for(let ae=T;ae<=_&&!(ae+M<=ae);ae+=M){let he=(ae-this.camX)*r+n/2;t.moveTo(he,0),t.lineTo(he,o)}let Y=Math.floor((this.camY-o/2/r)/M)*M,Q=Math.ceil((this.camY+o/2/r)/M)*M;for(let ae=Y;ae<=Q&&!(ae+M<=ae);ae+=M){let he=(ae-this.camY)*r+o/2;t.moveTo(0,he),t.lineTo(n,he)}t.stroke()},y=d*r,p=Math.max(0,Math.min(1,(y-15)/25));m(d,p),m(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let h=(0-this.camY)*r+o/2;h>=-10&&h<=o+10&&(t.moveTo(0,h),t.lineTo(n,h));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let v=[],w=new Map;for(let M of Nt)_r(M.id)&&(v.push(M),w.set(M.id,this.getNodePosition(M)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let M of v)if(M.parentIds&&M.parentIds.length>0)for(let D of M.parentIds){let T=Nt.find(_=>_.id===D);if(T&&w.has(T.id)){let _=w.get(T.id),Y=w.get(M.id),Q=(_.x-this.camX)*r+n/2,ae=(_.y-this.camY)*r+o/2,he=(Y.x-this.camX)*r+n/2,be=(Y.y-this.camY)*r+o/2;t.moveTo(Q,ae),t.lineTo(he,be)}}t.stroke();let x=Uc,C=x*r,q=x*1.6*r;for(let M of v){let D=w.get(M.id),T=(D.x-this.camX)*r+n/2,_=(D.y-this.camY)*r+o/2,Y=it(M.id),Q=Y>=M.maxLevel,ae=!0;if(T+q/2<0||T-q/2>n||_+q*.8<0||_-q/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,T-q/2,_-q/2,q,q),Q?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,T-q/2,_-q/2,q,q):jo(M.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,T-q/2,_-q/2,q,q);let be=this.nodeImages[M.id];if(be||(be=new Image,be.src="img/"+M.icon,this.nodeImages[M.id]=be),be.complete&&be.naturalWidth!==0&&t.drawImage(be,T-C/2,_-C/2,C,C),ae){let Oe=Qa(M.id),Ae=0;if(Q)Ae=1;else if(Oe.isInfinite?.()||typeof Oe.cmp=="function"&&Oe.cmp(c.fromAny("Infinity"))===0)Ae=0;else{let H=go(M.id);if(H.isZero?.())Ae=0;else try{if(Oe.isZero?.())Ae=1;else{let de=H.div(Oe).toScientific(5);Ae=Number(de)}}catch{Ae=0}}Ae=Math.max(0,Math.min(1,Ae));let F=q*.96,W=q*.18,$=T-F/2,X=_+q/2+q*.05;t.fillStyle="#111",t.fillRect($,X,F,W);let J=t.createLinearGradient($,X,$,X+W);J.addColorStop(0,"#2a5298"),J.addColorStop(1,"#1e3c72"),t.fillStyle=J,t.fillRect($,X,F*Ae,W),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,X,F,W),t.fillStyle="#fff",t.font=`bold ${W*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,W*.08);let le="";{let H=K(c.fromAny(Y));H.indexOf("<")>=0&&(H="\u221E"),le=`Level ${H}`}Q&&(le=M.maxLevel===1?"UNLOCKED":"MAXED");let fe=t.measureText(le),L=X+W/2+(fe.actualBoundingBoxAscent-fe.actualBoundingBoxDescent)/2;t.strokeText(le,$+F/2,L),t.fillText(le,$+F/2,L)}}let P=35,G=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let M of this.bursts){let D=(M.x-this.camX)*this.zoom+n/2,T=(M.y-this.camY)*this.zoom+o/2;for(let _=0;_<G.length;_++){let Y=G[_],Q=M.time-Y.delay;if(Q>0&&Q<Y.dur){let ae=Q/Y.dur,he=1-Math.pow(1-ae,3),be=P*he,Oe=Math.max(0,1-Math.pow(ae,2)),Ae=1+_*.5,F=t.createRadialGradient(D,T,be*.6,D,T,be);F.addColorStop(0,"rgba(255, 200, 50, 0)"),F.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,Oe*.15*Ae)})`),F.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,Oe*.2*Ae)})`),F.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=F,t.beginPath(),t.arc(D,T,be,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let _ of M.particles)if(M.time<_.life){let Y=1-M.time/_.life,Q=D+_.x,ae=T+_.y;t.fillStyle=`rgba(255, 255, 150, ${Y})`,t.beginPath(),t.arc(Q,ae,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Uc/2*1.6;for(let u of Nt){if(!_r(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Nt.find(m=>m.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.innerHTML=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let m=jo(t);pi(t,!m),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Pd(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Nt.find(l=>l.id===this.activeOverlayId);if(!t||!_r(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=it(t.id),o=go(t.id),r=Qa(t.id),i=jo(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.innerHTML=`Level ${K(c.fromAny(n))} / ${K(c.fromAny(t.maxLevel))} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.innerHTML=`Level ${K(c.fromAny(n))} / ${K(c.fromAny(t.maxLevel))}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.innerHTML=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?K(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?K(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${K(o)} / ${K(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Uc/2*1.6;for(let u of Nt){if(!_r(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){if(it(u.id)>=u.maxLevel)return;let h=jo(u.id);pi(u.id,!h),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=Uc/2*1.6;for(let u of Nt){if(!_r(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,m=s-f.y;if(Math.sqrt(d*d+m*m)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<gs&&(i=gs),i>hs&&(i=hs);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<gs&&(i=gs),i>hs&&(i=hs);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var ay={};bt(ay,{addExternalEacAmountMultiplierProvider:()=>Dd,addExternalEacMultiplierProvider:()=>gw,getAutobuyerToggle:()=>gi,getEacAmountMultiplier:()=>Xc,initAutomationEffects:()=>Iw,setAutobuyerToggle:()=>Mr,setTsunamiBonusProvider:()=>Fd,updateAutomation:()=>sy});function Fd(e){oy=e}function gw(e){typeof e=="function"&&ry.push(e)}function Dd(e){typeof e=="function"&&iy.push(e)}function Xc(){let e=1;if(se(2))if(se(8)){let t=kn(),n=oy(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of iy)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function Ud(e){Hc!==e&&(Ss.clear(),Hc=e)}function gi(e,t){let n=b();Ud(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(Ss.has(r))return Ss.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return Ss.set(r,i),i}function Mr(e,t,n){let o=b();Ud(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);Ss.set(i,s);try{localStorage.setItem(i,s)}catch{}}function yw(e){sy(e),Sw(e)}function vw(){if(Gc)return Gc;let e=[...Ct(Ee.STARTER_COVE),...Ct(Ee.DNA)],t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Gc=t,Gc}function bw(e){if(!(!e||e.length===0))for(let t of e){let n=t.area||Ee.STARTER_COVE;if(gi(n,t.id)!=="0"){let r=kt(n,t.id),i=t.lvlCap??1/0;r<i&&qd(n,t.id)}}}function Sw(e){let t=b();Ud(t);let n=vw();for(let[r,i]of Object.entries(ps)){let s=Number(r);kt(Ze,s)>0&&n[i]&&bw(n[i])}kt(Ze,fo)>0&&(Bd++,Bd>=5&&(Bd=0,gi(Ze,fo)!=="0"&&Vc()))}function sy(e){let n=kt(Ze,si);for(let r of ry)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){tl=0;return}tl+=e;let o=1/n;if(tl>=o){let r=Math.floor(tl/o);if(r>0){let i=r;i*=Xc(),$d(i),tl-=r*o}}}function Iw(){Ao(yw),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Hc&&(Ss.clear(),Hc=t)})}var tl,Bd,oy,ry,iy,Ss,Hc,Gc,Is=Ue(()=>{ii();mo();nl();ai();ws();St();hn();tl=0,Bd=0,oy=()=>0;ry=[];iy=[];Ss=new Map,Hc=null;Gc=null});function Gd(){let e=b();if(py=e,e==null){ol=!1;return}try{ol=localStorage.getItem(ww(e))==="1"}catch{ol=!1}}function Jo(e){return Es.nodes[e]||(Es.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),Es.nodes[e]}function Ew(e,t){let n=Jo(t);try{let o=localStorage.getItem(rl(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(il(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(fy(e,t));n.active=i==="1";let s=localStorage.getItem(dy(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function ly(){Gd();let e=b();Es.nodes={},Jn=null,e!=null&&Nt.forEach(t=>{Ew(e,t.id),Es.nodes[t.id].active&&(Jn=t.id)})}function cy(){let e=b();e!=null&&Nt.forEach(t=>{let n=Es.nodes[t.id];if(n)try{localStorage.setItem(il(e,t.id),n.rp.toStorage())}catch{}})}function it(e){return Jo(e).level}function vo(e,t){let n=b();if(n==null||jt(rl(n,e)))return!1;let o=Jo(e);if(o.level===t)return!0;o.level=t;try{localStorage.setItem(rl(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function go(e){return Jo(e).rp}function yi(e,t){let n=b();if(n!=null&&jt(il(n,e)))return;let o=Jo(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function jo(e){return Jo(e).active}function pi(e,t){let n=b();if(n==null)return;let o=!!t;o?(Jn!==null&&Jn!==e&&pi(Jn,!1),Jn=e):Jn===e&&(Jn=null);let r=Jo(e);if(r.active!==o){r.active=o;try{localStorage.setItem(fy(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function uy(e,t){let n=b();if(n==null)return;let o=Jo(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(dy(n,e),o.discovered?"1":"0")}catch{}}}function _r(e){let t=Nn.get(e);if(!t)return!1;if(Jo(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return uy(e,!0),!0;if((e===5||e===6)&&((py!==b()||ol===null)&&Gd(),!ol))return!1;for(let o of t.parentIds){let r=Nn.get(o);if(!r)continue;if(it(o)<r.maxLevel)return!1}return uy(e,!0),!0}function Qa(e){let t=Nn.get(e);if(!t)return c.fromAny("Infinity");let n=it(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=c.fromAny(t.scale),r=we(o),i=c.fromAny(t.baseRpReq),l=we(i)+n*r;return ie(l)}function Zn(){let e=0,t=it(1);t>0&&(e+=t*.01);let n=it(10);return n>0&&(e+=n*.01),e}function my(){return it(4)>=1}function hy(e=[]){if(b()!=null){try{di(0)}catch{}Jn!==null&&pi(Jn,!1),Nt.forEach(n=>{e.includes(n.id)||(vo(n.id,0),yi(n.id,c.fromInt(0)))})}}function ty(e){let t=bs();if(t.isZero?.()||Jn===null)return;let n=Nn.get(Jn);if(!n||!_r(n.id))return;let r=t.mulDecimal(e.toString(),18),i=go(n.id);if(it(n.id)>=n.maxLevel)return;let s=i.add(r),l=it(n.id);if(l<n.maxLevel||!Number.isFinite(n.maxLevel)){let a=Qa(n.id),u=we(s),f=we(a);if(u-f>2){let d=0n,m=c.zero(),y=c.fromAny(n.scale),p=y.sub(1),h=!1;if((p.isZero()||Math.abs(Number(y.toScientific())-1)<1e-9)&&(h=!0),h){let v=s.div(a).floorToInteger().toPlainIntegerString();(v==="Infinity"||v.length>15)&&(v="9007199254740991");try{d=BigInt(v)}catch{d=0n}if(Number.isFinite(n.maxLevel)){let w=BigInt(n.maxLevel)-BigInt(l);d>w&&(d=w)}d>0n&&(m=a.mulScaledInt(d,0))}else if(p.isZero()===!1&&(p.sig>0n||p.isInfinite())){let g=we(y),v=we(p),w=u-f+v,x=Math.floor(w/g);if(x>5){let C=BigInt(Math.max(0,x-5));if(Number.isFinite(n.maxLevel)){let k=BigInt(n.maxLevel)-BigInt(l);C>k&&(C=k)}if(C>0n){d=C;let k=Number(d)*g,P=ie(k).sub(1).div(p);m=a.mulBigNumInteger(P)}}}if(d>0n){s=s.sub(m);let g=l+Number(d);vo(n.id,g)}}}for(;;){let a=Qa(n.id);if(s.cmp(a)<0||it(n.id)>=n.maxLevel)break;s=s.sub(a);let u=it(n.id),f=u+1;if(f<=u||!vo(n.id,f))break}yi(n.id,s)}function vy(){let e=Nn.get(2);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*gy)}function by(){let e=Nn.get(3);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*gy)}function vi(){let e=Nn.get(5);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*yy)}function Hd(){let e=Nn.get(6);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*yy)}function Lw(){let e=Nn.get(7);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*xw)}function Sy(){let e=Nn.get(8);return e?1+it(e.id)*.1:1}function Iy(){let e=Nn.get(9);return e?1+it(e.id)*.1:1}function ny(){co(({baseMultiplier:e})=>{let t=vy();return e.mulDecimal(t.toScientific())}),Xo(({baseGain:e})=>{let t=by();return e.mulDecimal(t.toScientific())}),Wg(()=>Sy()),Dd(()=>Iy()),Fd(()=>Zn()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&Zt(),e&&e.id===8&&Pc()})}var rl,il,fy,dy,ww,Nt,Nn,ol,py,Es,Jn,gy,yy,xw,Zo=Ue(()=>{xt();St();mi();qt();Tn();Dc();Is();rl=(e,t)=>`ccc:lab:node:level:${t}:${e}`,il=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,fy=(e,t)=>`ccc:lab:node:active:${t}:${e}`,dy=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,ww=e=>`ccc:reset:experiment:completed:${e}`,Nt=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Te(vy())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Te(by())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Te(vi())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Te(Hd())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e8,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Te(Lw())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Te(Sy())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Te(Iy())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:`Increases the Tsunami Exponent by +0.01 per level\nThis node scales <strong>10x</strong> RP each level`,baseRpReq:1e12,scale:10,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`}],Nn=new Map(Nt.map(e=>[e.id,e])),ol=null,py=null,Es={nodes:{}},Jn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",ly),setInterval(cy,1e3),window.addEventListener("beforeunload",cy),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&Gd()}),ly());gy=Math.log10(2),yy=Math.log10(3),xw=Math.log10(1.1);window.RESEARCH_NODES=Nt;window.isResearchNodeVisible=_r});function wy(){xs=0,Cr=0,al=0,Vd=0}function Ey(){if(!Yc())return;let e=performance.now();Cr=0,al=0,e-Vd>=1e3&&(xs+=1,xs>Xd&&(xs=Xd),Vd=e)}function xy(e){if(Yc()&&Cr<sl)for(al+=e;al>=1;)al-=1,Cr<sl&&(Cr+=1,Cr>=sl&&(xs=0))}function Yd(){if(!Yc())return 0;let e=Math.min(1,Math.max(0,xs/Xd)),t=0;return Cr<sl&&(t=Math.max(0,1-Cr/sl)),e*t}function Ly(e){typeof e=="function"&&(Yc=e),typeof window<"u"&&(window.addEventListener("saveSlot:change",wy),wy())}var Xd,sl,xs,Cr,al,Yc,Vd,Wd=Ue(()=>{St();Xd=1e3,sl=60,xs=0,Cr=0,al=0,Yc=()=>!1,Vd=0});var ky={};bt(ky,{getBookProductionRate:()=>Ar,getComboUiString:()=>Zd,getEffectiveTsunamiNerf:()=>dt,getEffectiveTsunamiNerfWithCombo:()=>jd,getSurge15Divisor:()=>ll,getSurge15Multiplier:()=>Wc,getSurge6WealthMultipliers:()=>zc,getSurgeMagicMultiplier:()=>Cd,getTsunamiNerf:()=>kn,getTsunamiNerfKey:()=>Kd,getTsunamiSequenceSeen:()=>gn,initSurgeEffects:()=>Cw,isSurgeActive:()=>se,setTsunamiNerf:()=>Si,setTsunamiSequenceSeen:()=>er});function Kd(e){return zd(e)}function gn(){let e=b();if(e==null)return!1;try{return localStorage.getItem(Ay(e))==="1"}catch{return!1}}function er(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(Ay(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function kn(){return Tr}function dt(){let t=kn()+Zn();return t>1&&(t=1),t}function jd(){let e=dt();if(se(14)){let t=Yd(),n=1-e;e+=n*t}return e}function Zd(){if(!se(14))return"";let t=kn()+Zn();t>1&&(t=1);let n=Yd(),r=(1-t)*n;if(n<=0)return"";let i=Te(r);i==="0"&&(i="0.000");let s=` (+^${i})`;return n>=1&&(s=`<span style="color: #02e815">${s}</span>`),s}function Si(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=zd(n);if(jt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}Tr=t,Ls();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function se(e){return bo===1/0||typeof bo=="string"&&bo==="Infinity"||bo===Number.POSITIVE_INFINITY?!0:typeof bo=="bigint"?bo>=BigInt(e):typeof bo=="number"?bo>=e:!1}function bi(e){if(!se(8))return e;let t=we(e);if(!Number.isFinite(t))return e;let n=dt();return ie(t*n)}function Ls(){let e=Qn();bo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(se(8)){let n=dt(),o=Math.log10(_y);Qo=ie(o*n)}else Qo=c.fromInt(_y);else Qo=c.fromInt(1)}function Wc(e=!1){if(!e&&!se(15))return c.fromInt(1);let t=R.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=we(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return ie(l)})(t);return se(8)?bi(o):o}function ll(e=!1){if(!e&&!se(15))return c.fromInt(1);let t=R.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=we(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i/2;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return ie(l)})(t);return se(8)?bi(o):o}function zc(){if(!se(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(m,y=0)=>{if(!m){if(y<=0)return c.fromInt(1);let x=Math.log10(y)/3;if(x<=0)return c.fromInt(1);let C=x*Math.log10(2);return ie(C)}if(m.isInfinite?.())return c.fromAny("Infinity");let p=we(m),h=p;if(Number.isFinite(p)){if(p<15&&y>0)try{let w=Number(m.toPlainIntegerString());if(Number.isFinite(w)){let x=w+y;x>0&&(h=Math.log10(x))}}catch{}}else if(y>0)h=Math.log10(y);else return c.fromInt(1);let g=h/6;if(g<=0)return c.fromInt(1);let v=g*Math.log10(2);return ie(v)},t=e(R.coins?.value),n=R.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(R.gold?.value),s=e(R.magic?.value),l=t,a=r,u=i,f=s;se(8)&&(l=bi(t),a=bi(r),u=bi(i),f=bi(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function Ar(){if(!se(3))return c.fromInt(0);let t=Qe().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(My),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=ie(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*My;n=ie(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),R.books?.mult){let o=R.books.mult.get();n=n.mulBigNumInteger(o)}return se(8)&&(n=bi(n)),n}function _w(e){if(se(14)&&xy(e),se(3)){Cy||(Cy=new Ha("books",R));let t=Ar();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);R.books&&R.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,R.books&&R.books.add(c.fromInt(o))}}}if(se(13)){let o=2*(dt()*1.5-.5)-2,r=ie(o),i=R.coins?.value,s=Qe(),l=_s(i,s.xpLevel),a=R.gold?.mult?.applyTo?.(l)??l,u=vi();a=a.mulDecimal(u.toScientific());let d=a.mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.gold&&R.gold.add(d)}if(se(16)){let o=2*(dt()*1.5-.5)-2,r=ie(o),i=R.coins?.value,s=tr(),u=Ms(i,s).mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.magic&&R.magic.add(u)}}function Ty(e){if(e==null)return;let t=localStorage.getItem(zd(e));t!==null?(Tr=Number(t),(Number.isNaN(Tr)||!Number.isFinite(Tr))&&(Tr=se(8)?0:1)):se(8)?Tr=0:Tr=1}function Mw(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function Cw(){Ly(()=>se(14)&&kn()+Zn()<1);let e=b();Ls(),Ty(e),Ls(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=bo,n=se(8);Ls();let o=bo,r=se(8);!n&&r?(Si(0),gn()||er(!0)):r?Mw(t,o)>0&&(Si(0),gn()||er(!0)):n&&!r&&Si(1)}),window.addEventListener("lab:node:change",()=>{Ls()}),window.addEventListener("saveSlot:change",()=>{Ty(b()),Ls()}),window.addEventListener("currency:change",t=>{if(t.detail?.key==="dna"){try{Zt()}catch{}try{li()}catch{}}})),co(({baseMultiplier:t})=>Qo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Qo)),Xo(({baseGain:t})=>Qo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Qo)),Xo(({baseGain:t})=>se(19)?t.mulSmall(2):t),ui(({baseGain:t})=>Qo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Qo)),ui(({baseGain:t})=>{if(!se(4))return t;let n=c.fromInt(4444e9);if(se(8)){let o=dt(),r=Math.log10(4444e9);n=ie(r*o)}return t.mulBigNumInteger(n)}),co(({baseMultiplier:t})=>{if(!se(6))return t;let n=zc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),co(({baseMultiplier:t})=>{if(!se(15))return t;let n=t,o=Wc();o.cmp(1)>0&&(n=n.mulBigNumInteger(o));let r=ll();return r.cmp(1)>0&&(n=n.div(r)),n}),co(({baseMultiplier:t})=>{let n=0;if(se(17)&&(n-=5),se(18)&&(n+=15),n===0)return t;if(se(8)){let r=dt();n*=r}let o=ie(n);return t.mulBigNumInteger(o)}),Ac(({baseReward:t})=>se(3)?c.fromInt(0):t),Ao(_w)}function Cd(){let e=0;if(se(17)&&(e+=15),se(18)&&(e-=5),se(8)){let n=dt();e*=n}let t=c.fromInt(1);if(e!==0&&(t=ie(e)),se(15)){let n=ll();n.cmp(1)>0&&(t=t.div(n))}return t}var _y,My,zd,Ay,Qo,bo,Cy,Tr,hn=Ue(()=>{xt();St();Tn();Dc();ho();po();ii();xt();Zo();Wd();qt();_y=10,My=.08685889638,zd=e=>`ccc:surge:tsunamiNerf:${e}`,Ay=e=>`ccc:unlock:tsunami:${e}`;Qo=c.fromInt(1),bo=0n,Cy=null,Tr=0});var Uy={};bt(Uy,{getGearsProductionRate:()=>Qc,getGenerationLevelKey:()=>Ei,getGenerationUpgradeCost:()=>kr,initWorkshopSystem:()=>Dy,initWorkshopTab:()=>rp,performFreeGenerationUpgrade:()=>Vc,updateWorkshopTab:()=>Rn});function Ts(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*Dw}function Ei(e){return`ccc:workshop:genLevel:${e}`}function fl(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(Ei(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function pl(e){let t=b();if(!t)return!1;let n=Ei(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function ml(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return Qd;if(t<=Ii)return Qd+t*Ry;jc===null&&(jc=Qd+Ii*Ry);let n=t-Ii;if(t<=cl)return jc+n+Ts(n,Cs);if(Zc===null){let d=cl-Ii;Zc=jc+d+Ts(d,Cs)}let o=t-cl,r=t-Ii,i=cl-Ii,s=o+(Ts(r,Cs)-Ts(i,Cs)),l=Pw/Ow,a=.5*l*o*o;if(t<=Kc)return Zc+s+a;if(ep===null){let d=Kc-cl,m=Kc-Ii,y=d+(Ts(m,Cs)-Ts(i,Cs)),p=.5*l*d*d;ep=Zc+y+p}let u=Bw*(t-Kc);if(u>709)return 1/0;let f=ep*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function kr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=ml(t);return ie(n)}function op(e){let t,n=e;e instanceof c||(n=c.fromAny(e));let o=se(11)?Rw:se(7)?Nw:kw;if(n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let i=n.mulDecimal(o);if(n.cmp(9e15)<=0){let l=Number(n.toString())*o;t=ie(l)}else{let s=n.mulDecimal(o);if(s.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let l=Number(s.toScientific(10));l===1/0?t=c.fromAny("Infinity"):t=ie(l)}catch{t=c.fromAny("Infinity")}}}let r=R?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(r)}function qw(){let e=kr(st);if(R.coins.value.cmp(e)<0)return;let t=st.add(1);pl(t)&&(st=t,R.coins.sub(e),Rn(),rn())}function Gw(){if(!Gt())return;let n=op(st).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&R.gears&&R.gears.add(n),st.cmp(20)<0){let r=Number(st.toPlainIntegerString()),s=Math.pow(se(11)?4:se(7)?3:2,r)/20,l=Math.floor(s),a=s-l;if(wi+=a,wi>=1){let u=Math.floor(wi);wi-=u,R.gears&&R.gears.add(u)}}else wi=0}function np(){R.gears&&R.gears.set(0),pl(c.zero())&&(st=c.zero()),wi=0,Rn()}function Py(e){if(!e)return;let t=dl.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),dl.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;st.cmp(Jd)>0?i=Jd:i=Number(st.toPlainIntegerString());let s=Math.min(Math.floor(i),Jd),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,m=Math.cos(d)*Oy,y=Math.sin(d)*Oy,p=Math.random()*360,h=(Math.random()<.5?-1:1)*(Uw+Math.random()*$w);l.push({x:u,y:f,dx:m,dy:y,rotation:p,rotationSpeed:h,size:a})}for(;l.length>s;)l.pop()}function Hw(e){let t="Click the big red button below to open the Automation Shop";Je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${Tw}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${By}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will <span data-workshop="production-verb">double</span> the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${Aw}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{qw()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),Vw()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{ks("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(en&&en.isConnected){let a=en.querySelector(".workshop-side-left"),u=en.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let m=dl.get(d);if(m){let y=d.getBoundingClientRect(),p=window.devicePixelRatio||1;m.width=y.width,m.height=y.height;let h=Math.round(y.width*p),g=Math.round(y.height*p);if(m.canvas&&(m.canvas.width!==h||m.canvas.height!==g)&&(m.canvas.width=h,m.canvas.height=g,m.ctx.scale(p,p)),m.needsDistribution&&m.width>0&&m.height>0){m.needsDistribution=!1;for(let v of m.gears)v.x=Math.random()*(m.width-v.size),v.x<0&&(v.x=0),v.y=Math.random()*(m.height-v.size),v.y<0&&(v.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Fy():Xw()},{root:null,threshold:0}).observe(e),en=e}function Rn(){if(!en)return;let e=en.querySelector('[data-workshop="production-verb"]');if(e){let a=se(11)?"quadruple":se(7)?"triple":"double";e.textContent!==a&&(e.textContent=a)}let t=en.querySelector('[data-workshop="gears-amount"]'),n=en.querySelector('[data-workshop="gears-rate"]'),o=en.querySelector('[data-workshop="upgrade-cost"]'),r=en.querySelector('[data-workshop="upgrade-gen"]'),i=op(st),s=kr(st);if(t&&(t.innerHTML=R.gears.fmt(R.gears.value)),n&&(n.innerHTML=K(i)),o){let a="Coins";try{a=!s.isInfinite()&&s.cmp(1)===0?"Coin":"Coins"}catch{}o.innerHTML=`${K(s)} ${a}`}if(r){let a=R.coins.value.cmp(s)>=0;r.disabled=!a;let u=kt(Ze,fo),f=!1;if(u>0){let d=b(),m=d!=null?`:${d}`:"",y=`ccc:autobuy:${Ze}:${fo}${m}`;f=localStorage.getItem(y)!=="0"}f?r.classList.add("is-automated"):r.classList.remove("is-automated")}let l="";if(st.isInfinite()?l="Infinity":l=st.floorToInteger().toStorage(),l!==tp){tp=l;let a=en.querySelector(".workshop-side-left"),u=en.querySelector(".workshop-side-right");a&&Py(a),u&&Py(u)}}function Xw(){As&&(cancelAnimationFrame(As),As=null)}function Fy(){if(As)return;ul=0;let e=t=>{if(en&&en.isConnected){let n=en.querySelector('[data-workshop="gears-amount"]');n&&!ip()&&(n.innerHTML=R.gears.fmt(R.gears.value)),ul||(ul=t);let o=(t-ul)/1e3;ul=t,o>.1&&(o=.1);for(let[r,i]of dl){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!Jc.complete||Jc.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,m=f.y+f.size/2;u.save(),u.translate(d,m),u.rotate(f.rotation*Math.PI/180),u.drawImage(Jc,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}As=requestAnimationFrame(e)};As=requestAnimationFrame(e)}function Dy(){Ny||(Ny=!0,st=fl(),Ao(Gw),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{st=fl(),wi=0,Gt()||np(),Rn()}),window.addEventListener("currency:change",e=>{e.detail.key===Re.COINS&&Rn()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Re.GEARS&&Rn()}),window.addEventListener("debug:change",()=>{st=fl(),Rn()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Gt()||np())})))}function rp(e){Dy(),!e.__workshopInit&&(e.__workshopInit=!0,st=fl(),dl.clear(),tp=-1,Hw(e),typeof IntersectionObserver>"u"&&Fy(),Gt()||np(),Rn())}function Qc(){let e=fl();return op(e)}function Vc(){let e=R.coins.value.isInfinite(),n=kr(st).isInfinite();if(e&&n&&!st.isInfinite())return st=c.fromAny("Infinity"),pl(st),Rn(),!0;if(R.coins.value.isZero())return!1;let o=we(R.coins.value);if(!Number.isFinite(o))if(R.coins.value.inf)o=1/0;else return!1;if(ml(st)>o||st.cmp(9e15)>0)return!1;let r=Number(st.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);ml(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(st)>0&&pl(a)?(st=a,Rn(),!0):!1}function Vw(){if(R.coins.value.isInfinite()){Vc()&&rn();return}let e=we(R.coins.value);if(!Number.isFinite(e)&&R.coins.value.isZero()||ml(st)>e||st.cmp(9e15)>0)return;let t=Number(st.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);ml(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(st.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(kr(c.fromInt(u)));if(l.cmp(R.coins.value)>0){let u=kr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(st)>0&&pl(a)&&(st=a,R.coins.sub(l),Rn(),rn())}var By,Tw,Jc,Aw,Jd,en,Ny,wi,st,tp,As,Qd,kw,Nw,Rw,Ii,cl,Kc,Ry,Cs,Ow,Pw,Bw,Fw,Dw,jc,Zc,ep,dl,Oy,Uw,$w,ul,ws=Ue(()=>{xt();qt();St();ii();hi();po();mo();yo();ai();hn();By="img/currencies/gear/gear.webp",Tw="img/currencies/gear/gear_plus_base.webp",Jc=new Image;Jc.src=By;Aw="img/currencies/coin/coin.webp",Jd=100,en=null,Ny=!1,wi=0,st=c.zero(),tp=-1,As=null,Qd=12,kw=.3010299956639812,Nw=.47712125471966244,Rw=.6020599913279624,Ii=1e6,cl=1e9,Kc=1e12,Ry=1,Cs=.001,Ow=1e3,Pw=Math.log10(1.00001),Bw=23e-11,Fw=Math.log(10),Dw=1/Fw;jc=null,Zc=null,ep=null;dl=new Map,Oy=67,Uw=67,$w=67;ul=0});var Gy={};bt(Gy,{calculateOfflineRewards:()=>Ns,calculatePreAutomationRewards:()=>tu,formatTimeCompact:()=>eu,grantOfflineRewards:()=>xi,initOfflineTracker:()=>zw,processOfflineProgress:()=>qy,showOfflinePanel:()=>Nr});function eu(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),v=g.mulBigNumInteger(l),w=t.sub(v),x=0;try{let C=w.div(c.fromInt(i)).floorToInteger();x=Number(C.toPlainIntegerString())}catch{x=0}return x===0?`${K(g)}y`:`${K(g)}y ${x}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let m=Math.floor(f/60),y=f%60;if(m<24)return y===0?`${m}h`:`${m}h ${y}m`;let p=Math.floor(m/24),h=m%24;return h===0?`${p}d`:`${p}d ${h}h`}function Nr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${eu(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let p=document.createElement("div");p.className="offline-pre-auto-note",p.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(p)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",Yw.forEach(p=>{let h=p.key,g=e[h];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(h==="research_levels"){Array.isArray(g)&&g.forEach(P=>{let G=document.createElement("div");G.className="offline-row";let M=document.createElement("span");M.className="offline-plus",M.style.color="#004F96",M.textContent="+";let D=document.createElement("img");D.className="offline-icon",D.src=p.icon,D.alt="RP";let T=document.createElement("span");T.className="offline-text",T.style.color="#004F96";let _=c.fromInt(P.levels),Y=_.cmp(c.fromInt(1))===0?"Level":"Levels";T.textContent=`${K(_)} ${Y} of ${P.name}`,G.appendChild(M),G.appendChild(D),G.appendChild(T),f.appendChild(G)});return}let v=document.createElement("div");v.className="offline-row";let w=document.createElement("span");w.className="offline-plus",w.classList.add(`text-${h}`),w.textContent="+";let x=document.createElement("img");x.className="offline-icon",x.src=p.icon,x.alt=h;let C=document.createElement("span");C.className="offline-text",C.classList.add(`text-${h}`);let k=!1;g instanceof c?k=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:k=Number(g)===1;let q=k?p.singular:p.plural;C.innerHTML=`${K(g)} ${q}`,v.appendChild(w),v.appendChild(x),v.appendChild(C),f.appendChild(v)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let m=document.createElement("button");m.type="button",m.className="offline-close-btn",m.textContent="Close";let y=()=>{r.remove()};return m.addEventListener("click",y),r.addEventListener("click",p=>{p.target===r&&y()}),d.appendChild(m),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{Rs(i,a,".offline-scroll-container")}),r}function Ww(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function Ns(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=bs?bs():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Nt.filter(y=>jo(y.id)),d=[],m={};for(let y of f){let p=it(y.id),h=go(y.id).add(u),g=0,v=y.maxLevel;for(;p<v;){let w=Ww(y,p);if(w.isInfinite&&w.isInfinite()||h.cmp(w)<0)break;h=h.sub(w),p++,g++}g>0&&d.push({name:y.title,levels:g}),m[y.id]={level:p,rp:h}}d.length>0&&(o.research_levels=d),Object.keys(m).length>0&&(o.research_progress=m)}let s=(Qc?Qc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||dn("gears",t)||(o.gears=s);let l=Ar?Ar():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||dn("books",t)||(o.books=u)}if(se(13)||se(16)){let d=2*(dt()*1.5-.5)-2,y=ie(d).mulDecimal(String(e));if(se(13)){let p=R.coins?.value,h=Qe(),g=_s(p,h.xpLevel),v=R.gold?.mult?.applyTo?.(g)??g,w=vi();v=v.mulDecimal(w.toScientific());let x=v.mulDecimal(y.toScientific());x.cmp(0)>0&&!dn("gold",t)&&(o.gold=x)}if(se(16)){let p=R.coins?.value,h=tr(),v=Ms(p,h).mulDecimal(y.toScientific());v.cmp(0)>0&&!dn("magic",t)&&(o.magic=v)}}let a=kt(Ze,si)||0;if(a>0){let u=1;se(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=ou(),m=d.coins.mulBigNumInteger(f),y=d.xp.mulBigNumInteger(f),p=d.mp.mulBigNumInteger(f);m.isZero()||dn("coins",t)||(o.coins=m),y.isZero()||jt(`ccc:xp:progress:${t}`)||(o.xp=y),p.isZero()||jt(`ccc:mutation:progress:${t}`)||(o.mp=p)}}return o}function xi(e){if(b()!=null){if(e.xp)try{let n=as(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Os(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(vo(r,o.level),yi(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||R[n]&&typeof R[n].add=="function"&&R[n].add(e[n])}}function tu(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=eo(),i=c.fromInt(1);try{let l=ms(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof jn=="function"){let l=jn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=ou(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||jt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||jt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function qy(){let e=b();if(e==null)return;let t=Kf(),n=Date.now();if(t<=0)return;if(n<t-1e4){_n(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Gt()){let l=tu(r),a=Object.keys(l).length>0;return a&&(xi(l),Nr(l,o,!0)),a}let i=Ns(r),s=Object.keys(i).length>0;return s&&(xi(i),Nr(i,o)),s}function zw(e,t){$y||($y=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?xd():(Ld(),qy()&&typeof t=="function"&&t())))}))}var $y,Yw,nu=Ue(()=>{St();ws();po();ii();St();xt();qt();hi();yo();mo();mi();Zo();ai();nl();Tn();ho();hn();ls();Tn();ho();po();Zo();xt();$y=!1;Yw=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Nr});function lp(e){let t=24,n=Date.now();try{let o=localStorage.getItem(sp(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(ap(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(sp(e),"24"),localStorage.setItem(ap(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function Xy(e,t,n){try{localStorage.setItem(sp(e),String(t)),localStorage.setItem(ap(e),String(n))}catch{}}function Vy(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=lp(e);if(t>=Ps)return;let o=Date.now(),r=o-n;if(r>=ru){let i=Math.floor(r/ru);t+=i,t>=Ps?(t=Ps,n=o):n+=i*ru,Xy(e,t,n),Rr&&Rr.classList.contains("is-active")&&nr(!0)}}function jw(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function Zw(){let e=b();if(e==null)return;Vy();let{charges:t,lastCharge:n}=lp(e);t<=0||(t>=Ps&&(n=Date.now()-50),t--,Xy(e,t,n),nr(!0),hl&&clearInterval(hl),hl=setInterval(()=>{nr()},1e3),ft(Kw,{volume:.5}),jw(),setTimeout(()=>{let o=Ns(Hy);xi(o),Nr(o,Hy*1e3)},7250))}function nr(e=!1){if(!Rr||!Rr.classList.contains("is-active"))return;let t=b();if(t==null)return;e||Vy();let{charges:n,lastCharge:o}=lp(t),r=Rr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${Ps}</span>`);let i=Rr.querySelector(".warp-timer");if(i)if(n>=Ps)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+ru,u=Math.max(0,a-l);i.textContent=`Next warp in ${eu(u)}`}let s=Rr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function Yy(e){if(!e||e.__warpInit)return;e.__warpInit=!0,Rr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",Zw),hl||(hl=setInterval(()=>{nr()},1e3)),nr()}var sp,ap,Ps,ru,Hy,Kw,Rr,hl,cp=Ue(()=>{St();nu();Ln();sp=e=>`ccc:warp:charges:${e}`,ap=e=>`ccc:warp:lastCharge:${e}`,Ps=24,ru=3600*1e3,Hy=150,Kw="sounds/warp.ogg",Rr=null,hl=null});function nv(){try{return localStorage.getItem(Pr(vp))==="1"}catch{return!1}}function Sp(){try{return localStorage.getItem(Pr(ov))==="1"}catch{return!1}}function lu(e){let t=b();if(t==null)return;let n=`${ov}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),Jw()}catch{}}function cu(){return Sp()?"Jeff":"Merchant"}function Jw(){let e=cu();ze&&ze.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function gl(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&uo(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(v=>console.error(v)),n&&h()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,To(160)))},f=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},d=()=>{r&&l()},m=g=>{r=!0,To(160)},y=g=>{r&&l()},p=()=>{r&&l()},h=()=>{e.removeEventListener("click",a),rv?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):oE&&(e.removeEventListener("touchstart",m),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",p))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function iu(e){return tE[e]??0}function Wy(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function rE(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function vl(e,t){let n=Li.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;Fs.set(e,r),n.unlocked=r;let i=Ht.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&Ht.buttons[e]?.classList.contains("is-active")&&pu("dialogue")}function up(){let e=!1;try{e=!!$s?.()}catch{}vl("reset",e)}function fp(){let e=!1;try{e=!!Gt?.()}catch{}vl("workshop",e)}function Zy(){let e=!1;try{typeof ko=="function"&&(e=ko())}catch{}vl("warp",e)}function iE(){let e=b();if(e==null)return!1;try{return typeof gn=="function"&&gn()?!0:localStorage.getItem(iv(e))==="1"}catch{return!1}}function hp(){vl("lab",iE())}function sE(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function aE(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof mn=="function"&&mn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Qe=="function"?Qe():null;t&&typeof t=="object"&&(e.xpLevel=sE(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Fr=="function"&&Fr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Gt=="function"&&Gt()}catch{e.hasInfuseReset=!1}return e}function lE(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?pp:mp,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?pp:mp),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Ip:""),i.icon=o?.icon??(r==="mysterious"?Or:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?or:eE),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function cE(){if(zy)return;zy=!0;let e=uE;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${nE}:${t}`;At(n,{onChange:e})}}function uE(){rr()}function fE(e,t){let n=wp(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,sv(n),dE(t.reward),!0)}function dE(e){if(e){if(e.type==="coins"){try{R.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{R.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{R.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function pE(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function wp(){try{return JSON.parse(localStorage.getItem(Pr(yl))||"{}")}catch{return{}}}function sv(e){let t=Pr(yl);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{ct(t,n)}catch{}}catch{}}function mE(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function hE(){let e=gp;if(gp=null,typeof e=="function")try{e()}catch{}}function gE(e,t={}){t?.rawChanged&&rr()}function dp(e){if(e===Jy)return;if(hE(),Jy=e??null,e==null){rr();return}let t=`${yl}:${e}`;gp=At(t,{parse:mE,onChange:gE});try{ct(t)}catch{}rr()}function yE(){if(Ky){dp(b());return}Ky=!0,dp(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{dp(b())})}function Dr(){Promise.resolve().then(()=>(Ln(),uc)).then(({loadAudio:e})=>{e(av)})}function vE(){if(Bs)return;Bs=ft(av,{volume:Je?.15:.3,loop:!0})}function sr(){Bs&&(Bs.stop&&Bs.stop(),Bs=null)}function bE(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let w=0;w<t.length;w++){let x=t[w];x==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=x):x===">"&&l?(s+=x,i.push({type:"tag",content:s}),s="",l=!1):s+=x}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,m="";ir=!0,vE();let y=w=>{d&&(w.preventDefault(),f=!0)},p=w=>{d&&(w.key==="Enter"||w.key===" ")&&(f=!0)},h=o.length?o:[e];requestAnimationFrame(()=>{d=!0,h.forEach(w=>w.addEventListener("click",y,{once:!0})),document.addEventListener("keydown",p,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{h.forEach(w=>w.removeEventListener("click",y)),document.removeEventListener("keydown",p),e.classList.remove("is-typing"),sr(),ir=!1},v=()=>{if(f){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let w=i[a];w.type==="tag"?(m+=w.content,e.innerHTML=m,a++,v()):(m+=w.content[u],e.innerHTML=m,u++,u>=w.content.length&&(a++,u=0),setTimeout(v,n))};v()})}function SE(e={}){if(!ze)return;Dr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||or}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Or}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,ze.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||or,r.textContent=e.message||Ip,requestAnimationFrame(()=>t.classList.add("is-visible")),ze.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),sr(),ir=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),Pn(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&Pn(160),l()};gl(i,()=>{u()},{once:!0}),i.focus?.()}function IE(e,t){Dr();let n=t.scriptId;String(e)==="6"&&typeof vs=="function"&&!vs()&&(n=7),jr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${cu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,ze.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),ze.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{jr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),sr(),ir=!1,o.remove()},d=()=>{u||(u=!0,f(),rr())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&Pn(160),d())});let m=new Br({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,v)=>{t.scriptId===4&&g==="c4b"&&lu(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){rr(),f();return}fE(e,t),rr(),f()}}}),p=!!wp()[e]?.claimed,h=structuredClone(bd[n]);p&&h.nodes.m2b&&h.nodes.c2a&&t.scriptId===1&&(h.nodes.m2b.say="I've already given you Coins, goodbye.",h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),p&&t.scriptId===2&&h.nodes.m3a&&(h.nodes.m3a.say="I've already given you Books, goodbye.",h.nodes.c2a&&(h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===3&&h.nodes.m5a&&(h.nodes.m5a.say="I've already given you Gold, goodbye.",h.nodes.c5a&&(h.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===4&&h.nodes.m7a&&(h.nodes.m7a.say="I've already given you Magic, goodbye.",h.nodes.c7a&&(h.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m.load(h),m.start()}function wE(){if(document.getElementById(ev))return;let e=document.createElement("style");e.id=ev,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function EE(){let e=ze?.querySelector(".merchant-content");if(!e||e.__customScroll||!It)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),It.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){wE();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;It.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let T=(e.scrollTop||0)>0;f!==T&&(f=T,It?.classList.toggle("has-scroll-shadow",T))},m=()=>{let T=ze.querySelector(".merchant-grabber"),_=ze.querySelector(".merchant-header"),Y=ze.querySelector(".merchant-actions"),Q=(T?.offsetHeight||0)+(_?.offsetHeight||0)|0,ae=(Y?.offsetHeight||0)|0;t.style.top=Q+"px",t.style.bottom=ae+"px"},y={},p=()=>{let{scrollHeight:T,clientHeight:_,scrollTop:Y}=e,Q=t.clientHeight||e.clientHeight||1;if(y.scrollHeight===T&&y.clientHeight===_&&y.barH===Q&&(u||y.scrollTop===Y))return;y={scrollHeight:T,clientHeight:_,scrollTop:Y,barH:Q};let ae=_/Math.max(1,T),he=Math.max(28,Math.round(Q*ae)),be=Math.max(1,T-_),Oe=Math.max(0,Q-he);if(n.style.height=he+"px",u)n.style.setProperty("--thumb-y",`${Oe}px`),n.style.setProperty("--thumb-x","0px");else{let Ae=Math.round(Y/be*Oe);n.style.transform=`translateY(${Ae}px)`}t.style.display=T<=_+1?"none":""},h=()=>{m(),p(),d()},g=()=>{o&&(It.classList.add("is-scrolling"),l&&clearTimeout(l))},v=T=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{It.classList.remove("is-scrolling")},T))},w=()=>{p(),d(),o&&g(),s||v(r)},x=()=>v(r);e.addEventListener("scroll",w,{passive:!0}),s&&e.addEventListener("scrollend",x,{passive:!0});let C=new ResizeObserver(h);C.observe(e),window.addEventListener("resize",h),requestAnimationFrame(h);let k=!1,q=0,P=0,G=T=>{k=!0,q=T.clientY,P=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(T.pointerId)}catch{}T.preventDefault()},M=T=>{if(!k)return;let _=t.clientHeight||1,Y=n.clientHeight||1,Q=Math.max(1,_-Y),ae=Math.max(1,e.scrollHeight-e.clientHeight),be=(T.clientY-q)/Q*ae;e.scrollTop=P+be},D=T=>{if(k){k=!1,n.classList.remove("dragging"),v(i);try{n.releasePointerCapture(T.pointerId)}catch{}}};n.addEventListener("pointerdown",G),window.addEventListener("pointermove",M,{passive:!0}),window.addEventListener("pointerup",D),window.addEventListener("pointercancel",D),t.addEventListener("pointerdown",T=>{if(T.target===n)return;let _=t.getBoundingClientRect(),Y=T.clientY-_.top,Q=t.clientHeight||1,ae=n.clientHeight||1,he=Math.max(0,Q-ae),be=Math.max(0,Math.min(Y-ae/2,he)),Oe=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=be/Math.max(1,he)*Oe,g(),v(r)}),e.__customScroll={bar:t,thumb:n,ro:C,updateAll:h},h()}function fu(){if(ze)return;ze=document.createElement("div"),ze.className="merchant-overlay",ze.id="merchant-overlay",ze.setAttribute("inert",""),It=document.createElement("div"),It.className="merchant-sheet",It.setAttribute("role","dialog"),It.setAttribute("aria-modal","false"),It.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",up(),fp(),Zy(),hp(),Li.forEach(y=>{y.key==="dialogue"&&Fs.set("dialogue",!0);let p=Fs.get(y.key),h=p??!!y.unlocked,g=document.createElement("button");g.type="button",g.className="merchant-tab",g.dataset.tab=y.key;let v=y.lockedLabel||"???";g.textContent=h?y.label:v,h?g.title=y.label||"Tab":(g.classList.add("is-locked"),g.disabled=!0,g.title="???"),y.unlocked=h,Fs.set(y.key,h),gl(g,w=>{if(g.disabled){w?.preventDefault?.();return}pu(y.key)}),o.appendChild(g),Ht.buttons[y.key]=g}),Ht.panels.dialogue=i,Ht.panels.reset=s,Ht.panels.workshop=l,Ht.panels.warp=a,Ht.panels.lab=u,Ht.tablist=o,r.append(i,s,l,a,u),n.append(o,r),up(),fp();try{Wo()}catch{}if(!jy&&typeof window<"u"){let y=p=>{let{key:h,slot:g}=p?.detail??{};g!=null&&g!==b()||((h==="forge"||!h)&&up(),(h==="infuse"||!h)&&fp(),(h==="surge_completed"||!h)&&Zy(),(h==="lab"||h==="tsunami"||!h)&&hp())};window.addEventListener("unlock:change",y,{passive:!0}),window.addEventListener("saveSlot:change",y,{passive:!0}),jy=!0}let f=document.createElement("div");f.className="merchant-actions";let d=document.createElement("button");d.type="button",d.className="merchant-close",d.textContent="Close",su=d,f.appendChild(d);let m=document.createElement("div");m.className="merchant-firstchat merchant-firstchat--initial",m.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,It.append(e,t,n,f,m),ze.appendChild(It),document.body.appendChild(ze),xE(),EE(),Qy||(Qy=!0,gl(d,()=>{du()},{once:!1}),document.addEventListener("keydown",CE),e.addEventListener("pointerdown",TE),e.addEventListener("touchstart",p=>p.preventDefault(),{passive:!1}),ze.addEventListener("pointerdown",Dr,{once:!0}))}function xE(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,cE(),rr()}function LE(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?IE(n.id,n.meta):n.isMysterious&&SE(n.lockInfo)}}function rr(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=aE(),o=wp(),r=!1,i=new Set;Object.entries(uu).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=iu(u),d=lE(l,n),m=d.status,y=iu(m);if(y>f)a.status=m,m==="mysterious"?a.lockSnapshot=Wy(d):m==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(y<f){if(u==="unlocked")d=rE(l),m="unlocked",y=iu(m);else if(u==="mysterious"){let T=a.lockSnapshot||Wy(d)||{};d={status:"mysterious",unlocked:!1,title:T.title??d.title??"???",blurb:T.blurb??d.blurb??pp,tooltip:T.tooltip??d.tooltip??"Hidden Dialogue",message:T.message??d.message??Ip,icon:T.icon??d.icon??Or,headerTitle:T.headerTitle??d.headerTitle??or,ariaLabel:T.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},m="mysterious",y=iu(m)}}let p=m==="unlocked",h=m==="mysterious",g=m==="locked",v=!!a.claimed,w=p&&!!(l.once&&v),x=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!x){x=document.createElement("button"),x.type="button",x.className="dlg-card",x.dataset.dlgId=String(s);let T=document.createElement("div");T.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let Y=document.createElement("div");Y.className="dlg-reward",x.append(T,_,Y),t.appendChild(x),gl(x,LE)}x._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:p,isMysterious:h},x.dataset.dlgStatus=m,x.disabled!==!!g&&(x.disabled=!!g),x.classList.toggle("is-locked",g),x.classList.toggle("is-mysterious",h),x.classList.toggle("is-complete",!!w),x.classList.toggle("has-again",!!w),g?(x.getAttribute("aria-disabled")!=="true"&&x.setAttribute("aria-disabled","true"),x.getAttribute("tabindex")!=="-1"&&x.setAttribute("tabindex","-1")):(x.hasAttribute("aria-disabled")&&x.removeAttribute("aria-disabled"),x.hasAttribute("tabindex")&&x.removeAttribute("tabindex"));let C=x.querySelector(".dlg-title"),k=p?l.title:d.title??"???";C.textContent!==k&&(C.textContent=k);let q=x.querySelector(".dlg-blurb"),P=p?l.blurb:d.blurb??"";q.textContent!==P&&(q.textContent=P);let G=x.querySelector(".dlg-reward");if(p&&l.reward){let T=Qw[l.reward.type];if(T){G.classList.contains("has-reward")||(G.classList.add("has-reward"),G.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),G.style.getPropertyValue("--reward-icon")!==`url('${T}')`&&G.style.setProperty("--reward-icon",`url('${T}')`);let _=G.querySelector(".amt"),Y=String(l.reward.amount);_&&_.textContent!==Y&&(_.textContent=Y);let Q=G.querySelector(".currency-name");if(Q){let he=String(l.reward.type||""),be=he.charAt(0).toUpperCase()+he.slice(1);Q.textContent!==be&&(Q.textContent=be)}let ae=`Reward: ${l.reward.amount} ${l.reward.type}`;G.getAttribute("aria-label")!==ae&&G.setAttribute("aria-label",ae)}else{G.classList.remove("has-reward");let _=pE(l.reward);G.textContent!==_&&(G.textContent=_),G.style.display!==""&&(G.style.display=""),G.removeAttribute("aria-label")}G.style.display==="none"&&(G.style.display="")}else G.textContent!==""&&(G.textContent=""),G.style.display!=="none"&&(G.style.display="none");let M=p?`${l.title}${w?" (completed)":""}`:d.ariaLabel||(h?"Hidden merchant dialogue":"Locked merchant dialogue");if(x.getAttribute("aria-label")!==M&&x.setAttribute("aria-label",M),d.tooltip)x.title!==d.tooltip&&(x.title=d.tooltip);else if(p){let T="Left-click: Start Dialogue";x.title!==T&&(x.title=T)}else x.hasAttribute("title")&&x.removeAttribute("title");let D=x.querySelector(".dlg-again");w?D||(D=document.createElement("div"),D.className="dlg-again",D.textContent="Ask Again?",x.appendChild(D)):D&&D.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&sv(o)}function _E(){let e=ze.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");jr(!0);let i=new Br({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{jr(!1);try{localStorage.setItem(Pr(vp),"1")}catch{}try{window.dispatchEvent(new Event(bp))}catch{}e.classList.remove("is-visible"),ze.classList.remove("firstchat-active")}});i.load(bd[0]),i.start()}function ME(){if(!ze)return;let e=ze.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),ze.classList.remove("firstchat-active")}function lv(){if(fu(),_i)return;let e=document.activeElement;e instanceof HTMLElement&&!ze.contains(e)?au=e:au=null,_i=!0;let t=b(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(iv(t),"1")}catch{}hp();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Pr(vp))==="1"}catch{o=!1}o||ze.classList.add("firstchat-instant"),It.style.transition="none",It.style.transform="",ze.removeAttribute("inert"),It.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ze.classList.contains("firstchat-instant")||(It.style.transition=""),ze.classList.add("is-open"),Pn(140),su&&typeof su.focus=="function")try{su.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(Pr(tv))||"dialogue"}catch{}n&&(r="dialogue"),pu(r),sr(),o||(ze.querySelector(".merchant-firstchat")?.classList.add("is-visible"),ze.classList.add("firstchat-active"),_E())})})}function du(){if(!_i)return;if(jr(!1),Je){try{To(100)}catch{}try{Pn(80)}catch{}}_i=!1,It.style.transition="",It.style.transform="",ze.classList.remove("is-open"),ze.classList.remove("firstchat-instant"),ME();let e=document.activeElement;if(e&&ze.contains(e)){let t=au;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}ze.setAttribute("inert",""),au=null,sr(),ir=!1}function CE(e){if(_i&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<Li.length;i++)Fs.get(Li[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<Li.length&&(e.preventDefault(),hv(),pu(Li[r].key))}}function TE(e){if(!_i)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;On={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},It.style.transition="none",window.addEventListener("pointermove",cv,{passive:!0}),window.addEventListener("pointerup",uv),window.addEventListener("pointercancel",fv)}function cv(e){if(!On||On.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-On.startY);On.lastY=t,On.moved=n,It.style.transform=`translateY(${n}px)`}function uv(){if(!On||On.canceled){yp();return}let e=Math.max(1,performance.now()-On.startT),t=On.moved;t/e>.55&&t>40||t>140?(To(160),It.style.transition="transform 140ms ease-out",It.style.transform="translateY(100%)",setTimeout(()=>{du()},150)):(It.style.transition="transform 180ms ease",It.style.transform="translateY(0)"),yp()}function fv(){On&&(On.canceled=!0,It.style.transition="transform 180ms ease",It.style.transform="translateY(0)",yp())}function yp(){window.removeEventListener("pointermove",cv),window.removeEventListener("pointerup",uv),window.removeEventListener("pointercancel",fv),On=null}function pu(e){let t=Li.find(o=>o.key===e),n=Fs.get(e);(!t||!n)&&(e="dialogue");for(let o in Ht.buttons)Ht.buttons[o].classList.toggle("is-active",o===e);for(let o in Ht.panels)Ht.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{rr()}catch{}if(e==="reset"){let o=Ht.panels.reset;if(o&&!o.__resetInit)try{Ep(o)}catch{}else try{qe()}catch{}}if(e==="workshop"){let o=Ht.panels.workshop;if(o&&!o.__workshopInit)try{rp(o)}catch{}else try{Rn()}catch{}}if(e==="warp"){let o=Ht.panels.warp;if(o&&!o.__warpInit)try{Yy(o)}catch{}else try{nr()}catch{}}if(e==="lab"){let o=Ht.panels.lab;if(o&&!o.__labInit)try{Rd(o),o.__labInit=!0}catch{}typeof vs=="function"&&!vs()&&AE();try{Od()}catch{}}try{localStorage.setItem(Pr(tv),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=ze?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function dv(){if(!_i)return!1;let e=Ht.buttons.lab;return e&&e.classList.contains("is-active")}function bl(e=[]){e.forEach(t=>vl(t,!0))}function pv(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Dr();let u=y=>{y.key==="Escape"&&(y.stopImmediatePropagation(),y.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let y=r.querySelector("#tsunami-dlg-line-2"),p=r.querySelector("#tsunami-dlg-choices-2"),h=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),v={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},w=new Br({textEl:y,choicesEl:p,skipTargets:[y,h,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),sr(),ir=!1,r.remove(),t&&t()},5e3)}});w.load(v),w.start()},m=new Br({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",sr(),ir=!1,n&&n.hideCursor&&n.hideCursor(),f()}});m.load(o),m.start()}function AE(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${cu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Dr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Br({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{sr(),ir=!1,e.remove()}});s.load(i),s.start()}function mv(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${cu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Dr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Br({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{sr(),ir=!1,t.remove(),e&&e()}});l.load(s),l.start()}var Ds,vp,tv,yl,bp,Pr,ov,Li,Fs,Qw,Or,or,eE,pp,mp,Ip,tE,nE,rv,oE,zy,Ky,jy,iv,Jy,gp,uu,ze,It,su,_i,On,au,Qy,Ht,av,Bs,ir,Br,ev,Us=Ue(()=>{St();xt();Hg();Tn();po();ws();cp();mi();hn();hi();us();yo();Ln();Ds="img/misc/merchant.webp",vp="ccc:merchantMet",tv="ccc:merchantTab",yl="ccc:merchant:dlgState",bp="ccc:merchant:met",Pr=e=>`${e}:${b()}`;ov="ccc:unlock:jeff";Li=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],Fs=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),Qw={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Or="img/misc/mysterious.webp",or="Hidden Dialogue",eE="Locked Dialogue",pp="Hidden Dialogue",mp="Locked",Ip="Locked Dialogue",tE={locked:0,mysterious:1,unlocked:2},nE="ccc:reset:forge:completed",rv=typeof window<"u"&&"PointerEvent"in window,oE=!rv&&typeof window<"u"&&"ontouchstart"in window;zy=!1,Ky=!1,jy=!1;iv=e=>`ccc:unlock:lab:${e}`;Jy=null,gp=null;uu={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Or,headerTitle:or,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:mp,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Or,headerTitle:or,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof ko=="function"&&ko()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Or,headerTitle:or,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof gn=="function"&&gn())return!0;let t=typeof Qn=="function"?Qn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof ko=="function"&&ko()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Or,headerTitle:or,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Or,headerTitle:or,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};yE();ze=null,It=null,su=null,_i=!1,On=null,au=null,Qy=!1,Ht={buttons:{},panels:{},tablist:null},av="sounds/merchant_typing.ogg",Bs=null,ir=!1;Br=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await bE(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=gl(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};ev="ccc-scroll-timeline-styles"});var Xt,xp,Lp,gv,_p=Ue(()=>{qt();Xt="dna",xp="img/misc/mysterious.webp",Lp="Hidden Upgrade",gv=[{area:Xt,id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Coin value bonus: ${Te(t)}x`},{area:Xt,id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`XP value bonus: ${Te(t)}x`},{area:Xt,id:3,title:"DNA Gold Value",desc:"Multiplies Gold value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/gold_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"gold_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Gold value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:xp,titleOverride:Lp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Xt,id:4,title:"DNA Magic Value",desc:"Multiplies Magic value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/magic_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"magic_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Magic value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:xp,titleOverride:Lp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Xt,id:5,title:"DNA Wave Value",desc:"Multiplies Wave value by 1.1x per level",lvlCap:1e3,baseCost:1e39,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/wave_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"wave_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Wave value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=19||t===1/0)&&(n=!0):typeof t=="bigint"?t>=19n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=19)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 19 to reveal this upgrade";return{locked:!0,iconOverride:xp,titleOverride:Lp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}]});function ip(){return Sl.size>0}function wv(e){if(!e||!e.costType)return!1;let t=PE[e.costType];return!t||kt(Ze,t)<=0?!1:gi(e.area,e.id)!=="0"}function Cp(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function hu(e,t){return t==="standard"&&Cp(e)===OE}function Mp(e){let t=Ct(e),n={};for(let o of t){let r=An(e,o.id),i=kt(e,o.id),s=No(e,o.id),l=s.iconOverride??Su(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Hs(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:bu(o.baseIconOverride||s.baseIconOverride),hmReady:d}}return n}function Ev(e){return bv[e]||bv.standard}function Pn(e=140){if(!Je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function yu(e){return String(e??"").replace(/<[^>]*>/g,"")}function mu(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function rn(){ft(FE,{volume:Je?xv:Lv})}function _v(){let e=Je?xv*2:Lv*2;ft(DE,{volume:e})}function UE(e){return`<img alt="" src="${vv[e]||vv.coins}" class="currency-ico">`}function qE(){if(document.getElementById(Sv))return;let e=document.createElement("style");e.id=Sv,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function Rs(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,m="onscrollend"in window,p=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(p){qE();let W=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=W,s.style.scrollTimelineName=W,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=W,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let h={scrollSize:0,clientSize:0,barSize:0,thumbSize:0,maxScroll:1,range:0,visibleRatio:1},g=null,v=!1,w=null,x=()=>{if(!s.isConnected||!t.isConnected)return;let F=s.getBoundingClientRect(),W=t.getBoundingClientRect();if(i){let $=Math.max(0,F.top-W.top),X=Math.max(0,W.bottom-F.bottom);l.style.top=$+"px",l.style.bottom=X+"px",l.style.left="",l.style.right=""}else{let $=Math.max(0,F.left-W.left),X=Math.max(0,W.right-F.right);l.style.left=$+"px",l.style.right=X+"px",l.style.top="",l.style.bottom="",l.style.height=""}},C=()=>{let F=i?s.scrollHeight:s.scrollWidth,W=i?s.clientHeight:s.clientWidth,$=i?l.clientHeight||W:l.clientWidth||W,X=W/Math.max(1,F),J=Math.max(28,Math.round($*X)),le=Math.max(1,F-W),fe=Math.max(0,$-J);h={scrollSize:F,clientSize:W,barSize:$,thumbSize:J,maxScroll:le,range:fe,visibleRatio:X},i?(a.style.height=J+"px",a.style.width="100%"):(a.style.width=J+"px",a.style.height="100%"),p&&(i?(a.style.setProperty("--thumb-y",`${fe}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${fe}px`),a.style.setProperty("--thumb-y","0px")));let L=F>W+1;l.style.display=L?"":"none",t?.classList.toggle("has-active-scrollbar",L),k()},k=()=>{v=!1;let F=i?s.scrollTop:s.scrollLeft,W=(F||0)>0;if(g!==W&&(g=W,t?.classList.toggle("has-scroll-shadow",W)),!p){let{maxScroll:$,range:X}=h,J=Math.round(F/$*X);i?a.style.transform=`translateY(${J}px)`:a.style.transform=`translateX(${J}px)`}u&&M()},q=()=>{x(),C()};s.__customScroll&&(s.__customScroll.update=q);let P,G=()=>{clearTimeout(P),P=setTimeout(q,100)};typeof MutationObserver<"u"&&new MutationObserver(()=>G()).observe(s,{childList:!0,subtree:!0,characterData:!0});let M=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},D=F=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},F))},T=()=>{Sl.has(s)||Sl.add(s),clearTimeout(w),w=setTimeout(()=>{Sl.has(s)&&(Sl.delete(s),window.dispatchEvent(new CustomEvent("menu:scrollStop")))},150),v||(v=!0,window.requestAnimationFrame(k)),m||D(f)},_=()=>D(f);s.addEventListener("scroll",T,{passive:!0}),m&&s.addEventListener("scrollend",_,{passive:!0}),new ResizeObserver(()=>{q()}).observe(s),window.addEventListener("resize",q),requestAnimationFrame(q);let Q=!1,ae=0,he=0,be=F=>{Q=!0,ae=i?F.clientY:F.clientX,he=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),M();try{a.setPointerCapture(F.pointerId)}catch{}F.preventDefault()},Oe=F=>{if(!Q)return;let{range:W,maxScroll:$}=h;if(W<=0)return;let J=(i?F.clientY:F.clientX)-ae,le=he+J/W*$;i?s.scrollTop=le:s.scrollLeft=le},Ae=F=>{if(Q){Q=!1,a.classList.remove("dragging"),D(d);try{a.releasePointerCapture(F.pointerId)}catch{}}};a.addEventListener("pointerdown",be),window.addEventListener("pointermove",Oe,{passive:!0}),window.addEventListener("pointerup",Ae),window.addEventListener("pointercancel",Ae),l.addEventListener("pointerdown",F=>{if(F.target===a)return;let W=l.getBoundingClientRect(),$=i?F.clientY-W.top:F.clientX-W.left,{thumbSize:X,range:J,maxScroll:le}=h,L=Math.max(0,Math.min($-X/2,J))/Math.max(1,J)*le;i?s.scrollTop=L:s.scrollLeft=L,M(),D(f)}),q()}function Iv(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function GE(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=R[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",m=Number.isFinite(i)&&r>=i;return d&&!m||!Number.isFinite(i)?c.fromAny("Infinity"):Iv(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),m=c.fromAny(e.costAtLevel(r+1)),y=Math.min(Number.isFinite(i)?i:r+32,r+32),p=c.fromAny(e.costAtLevel(y));if(d.cmp(m)===0&&d.cmp(p)===0){let g=Iv(e,o,r),v=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,w=0,x=Math.max(0,v);for(;w<x;){let C=Math.floor((w+x+1)/2),k=c.fromInt(C);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(k):c.fromAny(d??0).mulBigNumInteger(k)).cmp(a)<=0?w=C:x=C-1}return c.fromInt(w)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=Mi(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function ks(e="standard"){(xl[e]||xl.standard).open()}function Mv(e=!1){Object.values(xl).forEach(t=>t.close(e))}function hv(){if(Object.entries(xl).forEach(([e,t])=>{e!=="standard"&&t.close()}),Ll&&Cv!=="standard"){Tp();let e=document.querySelector(".hm-milestones-overlay");e&&e.remove()}}function ar(e=!1){Object.values(xl).forEach(t=>t.update(e))}function HE(){if(sn)return;sn=document.createElement("div"),sn.className="upg-overlay",ut=document.createElement("div"),ut.className="upg-sheet",ut.setAttribute("role","dialog"),ut.setAttribute("aria-modal","false"),ut.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",ut.append(e,t,n,o,r),sn.appendChild(ut),document.body.appendChild(sn),sn.addEventListener("pointerdown",u=>{Je&&u.pointerType!=="mouse"&&u.target===sn&&(u.preventDefault(),u.stopPropagation())},!0),sn.addEventListener("click",u=>{Je&&u.target===sn&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Ll)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},ut.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,ut.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(ut.style.transition="transform 160ms ease",ut.style.transform=f?"translateY(100%)":"translateY(0)",f){if(Je&&(!u||u.pointerType!=="mouse"))try{Pn(120)}catch{}setTimeout(Tp,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function Tp(){if(Je)try{Pn(160)}catch{}if(typeof gu=="function"){let e=gu;gu=null;try{e()}catch{}}Ll=!1,!(!sn||!ut)&&(ut.style.transition="",ut.style.transform="",sn.classList.remove("is-open"),sn.style.pointerEvents="none")}function XE(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function VE(e,t="standard"){HE(),Ll=!0,Cv=t;let n=!0,o=Ev(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Ll=!1;return}let l=e.upgType==="HM",a=e.tie===_e.ENDLESS_XP;function u(p,h,g="div"){let v=h.split(" ").filter(C=>C.length>0),w=null,x=[];for(let C=0;C<p.children.length;C++){let k=p.children[C];g&&k.tagName.toLowerCase()!==g.toLowerCase()||v.every(q=>k.classList.contains(q))&&(w?x.push(k):w=k)}return x.forEach(C=>C.remove()),w||(w=document.createElement(g),w.className=h,p.appendChild(w)),w}let f=p=>{let h=document.createElement("div");return h.className="upg-line",h.innerHTML=p,h},d=!0,m=()=>{let p=o.getUiModel(e.id);if(!p)return;let h=p.lockState||o.getLockState(e.id),g=!!h?.locked,v=g&&(h?.hidden||h?.hideEffect||h?.hideCost),w=!!p.unlockUpgrade&&!v;ut.classList.toggle("is-locked-hidden",v);let x=ut.querySelector(".upg-header"),C=u(x,"upg-title");C.textContent!==(p.displayTitle||p.upg.title)&&(C.textContent=p.displayTitle||p.upg.title);let k=!!p.hmReadyToEvolve,q=k?!1:p.lvlBn?.isInfinite?.()?!0:Number.isFinite(p.upg.lvlCap)?p.lvl>=p.upg.lvlCap:!1,P=u(x,"upg-level"),G=p.lvlCapFmtHtml??p.upg.lvlCapFmtHtml??K(p.lvlCapBn),M=p.lvlCapFmtText??p.upg.lvlCapFmtText??yu(G),D=k?`Level ${p.lvlFmtHtml} / ${G} (EVOLVE READY)`:q?`Level ${p.lvlFmtHtml} / ${G} (MAXED)`:`Level ${p.lvlFmtHtml} / ${G}`,T=yu(D);P.innerHTML!==D&&(P.innerHTML=D),P.getAttribute("aria-label")!==T&&P.setAttribute("aria-label",T),P.hidden=v,v||P.removeAttribute("aria-hidden"),ut.classList.toggle("is-maxed",q),ut.classList.toggle("hm-evolve-ready",k),ut.classList.toggle("is-unlock-upgrade",w),ut.classList.toggle("is-hm-upgrade",l&&!v),ut.classList.toggle("is-endless-xp",a),ut.classList.toggle("is-magnet-upgrade",e.tie===_e.MAGNET),ut.classList.toggle("is-no-effect",!p.effect);let _=x.querySelector(".auto-toggle-wrapper"),Y=t==="automation"?ps[e.id]:null,Q=t==="automation"&&e.id===fo,ae=!!Y,he=t==="standard"||t==="dna"?BE[e.costType]:null,be=0;he?be=kt(Ze,he):(ae||Q)&&(be=kt(Ze,e.id));let Ae=be>0&&(ae||he||Q)&&!v;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",x.appendChild(_));let F=_.querySelector("button");if(F||(F=document.createElement("button"),F.type="button",F.style.padding="10px 14px",F.style.fontSize="16px",F.style.width="auto",F.style.minWidth="180px",F.addEventListener("click",ne=>{typeof F._onClick=="function"&&F._onClick(ne)}),_.appendChild(F)),Ae){F.style.visibility="",F.style.pointerEvents="auto";let ne=b(),ve=ne!=null?`:${ne}`:"",De=!0;if(ae){let ke=`ccc:autobuy:master:${Y}${ve}`,Fe=[...Ct(Ee.STARTER_COVE),...Ct(Xt)],ce=!1;for(let te of Fe)if(te.costType===Y){let xe=`ccc:autobuy:${te.area}:${te.id}${ve}`;if(gi(te.area,te.id)!=="0"){ce=!0;break}}De=ce}else De=gi(e.area,e.id)!=="0";De?(F.className="shop-delve",F.textContent="Automation: ON",F.style.backgroundColor=""):(F.className="shop-close",F.textContent="Automation: OFF",F.style.backgroundColor=""),F._onClick=ke=>{ke.preventDefault(),ke.stopPropagation(),Je&&Pn(50);let ce=!De?"1":"0";ae?(localStorage.setItem(`ccc:autobuy:master:${Y}${ve}`,ce),[...Ct(Ee.STARTER_COVE),...Ct(Xt)].forEach(xe=>{xe.costType===Y&&Mr(xe.area,xe.id,ce)})):Mr(e.area,e.id,ce),m()}}else F.style.visibility="hidden",F.style.pointerEvents="none",F.className="shop-delve",F.textContent="Automation: ON",F._onClick=null;let W=ut.querySelector(".upg-content");d&&(W.scrollTop=0,d=!1);let $=u(W,"upg-desc centered");$.classList.toggle("lock-desc",v);let X=(p.displayDesc||p.upg.desc||"").trim();k?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):X?($.classList.remove("hm-evolve-note"),$.textContent!==X&&($.textContent=X),$.hidden=!1):$.hidden=!0;let J=u(W,"upg-info"),le=null,fe=ne=>{le?le.nextElementSibling!==ne&&J.insertBefore(ne,le.nextSibling):J.firstElementChild!==ne&&J.prepend(ne),le=ne};if(g&&h?.reason&&!v){let ne=(p.displayDesc||"").trim(),ve=String(h.reason??"").trim();if(ne!==ve){let De=J.querySelector(".lock-wrapper");if(!De){De=document.createElement("div"),De.className="lock-wrapper";let ce=document.createElement("div");ce.className="upg-line lock-note",De.append(ce)}let ke=Array.from(De.children);for(let ce of ke)ce.tagName==="DIV"&&!ce.className&&ce.style.height==="12px"&&ce.remove();let Fe=De.querySelector(".lock-note");Fe.textContent!==h.reason&&(Fe.textContent=h.reason),fe(De)}else{let De=J.querySelector(".lock-wrapper");De&&De.remove()}}else{let ne=J.querySelector(".lock-wrapper");ne&&ne.remove()}if(p.effect&&!(g&&h?.hideEffect)){let ne=J.querySelector(".effect-wrapper");if(!ne){ne=document.createElement("div"),ne.className="effect-wrapper";let Fe=document.createElement("div");Fe.className="upg-line",ne.append(Fe)}let ve=Array.from(ne.children);for(let Fe of ve)Fe.tagName==="DIV"&&!Fe.className&&Fe.style.height==="12px"&&Fe.remove();let De=ne.querySelector(".upg-line"),ke=`<span class="bonus-line">${p.effect}</span>`;De.innerHTML!==ke&&(De.innerHTML=ke),fe(ne)}else{let ne=J.querySelector(".effect-wrapper");ne&&ne.remove()}let L=UE(p.upg.costType),H=p.nextPrice instanceof c?p.nextPrice:c.fromAny(p.nextPrice||0),z=q||k;if(!p.unlockUpgrade&&!z&&(!g||!h?.hideCost)){let ne=u(J,"upg-costs");fe(ne);let ve=mu(p.upg.costType,H),De=`Cost: ${L} ${R[p.upg.costType].fmt(H)} ${ve}`,ke=u(ne,"cost-line","div");if(ke.className.includes("upg-line")||(ke.className="upg-line cost-line"),ke.innerHTML!==De&&(ke.innerHTML=De),l){let xe=u(ne,"milestone-line","div");xe.className.includes("upg-line")||(xe.className="upg-line milestone-line");let E="\u2014",j="",Z=wv(p.upg);try{if(p.hmNextMilestone&&p.hmNextMilestone.cmp(p.lvlBn)>0)if(Z){let ue=p.hmNextMilestone.sub(c.fromInt(1)),We=0;try{let Se=ue.toPlainIntegerString?.();Se&&Se!=="Infinity"?We=Number(Se):We=Number(ue.toString())}catch{We=0}let ot=c.fromInt(0);try{ot=c.fromAny(p.upg.costAtLevel(We))}catch{}E=R[p.upg.costType].fmt(ot),j=mu(p.upg.costType,ot)}else{let ue=p.hmNextMilestone.sub(p.lvlBn),We=ue.toPlainIntegerString?.(),ot=Math.max(0,Math.floor(Number(We&&We!=="Infinity"?We:Number(ue.toString()||0)))),{spent:Se}=Mi(p.upg,p.lvlBn,c.fromAny("Infinity"),ot);E=R[p.upg.costType].fmt(Se),j=mu(p.upg.costType,Se)}}catch{}let ye=`${Z?"Cost at next milestone:":"Cost to next milestone:"} ${L} ${E} ${j}`;xe.innerHTML!==ye&&(xe.innerHTML=ye)}else{let xe=ne.querySelector(".milestone-line");xe&&xe.remove()}let Fe=mu(p.upg.costType,p.have),ce=`You have: ${L} ${R[p.upg.costType].fmt(p.have)} ${Fe}`,te=u(ne,"have-line","div");te.className.includes("upg-line")||(te.className="upg-line have-line"),te.innerHTML!==ce&&(te.innerHTML=ce)}else{let ne=J.querySelector(".upg-costs");ne&&ne.remove()}let de=ut.querySelector(".upg-milestones"),ee=de.querySelector(".hm-view-milestones-row");if(!ee){ee=document.createElement("div"),ee.className="hm-view-milestones-row";let ne=document.createElement("button");ne.type="button",ne.className="shop-delve hm-view-milestones",ne.textContent="View Milestones",ne.addEventListener("click",ve=>{ne._onClick&&ne._onClick(ve)}),ee.appendChild(ne),de.appendChild(ee)}let re=ee.querySelector("button");l&&!v?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ne=Array.isArray(p.hmMilestones)?p.hmMilestones:[],ve=Math.max(0,Math.floor(Number(p.hmEvolutions??0))),De=(()=>{try{return BigInt(Vt)*BigInt(ve)}catch{return 0n}})(),ke=ne.sort((Fe,ce)=>Number(Fe?.level||0)-Number(ce?.level||0)).map(Fe=>{let ce=Math.max(0,Math.floor(Number(Fe?.level||0))),te=(()=>{if(p.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ce)+De).toString())}catch{return c.fromAny(ce+Vt*ve)}})(),xe=te?.isInfinite?.()?"Infinity":K(te),E=Te(Fe?.multiplier??Fe?.mult??Fe?.value??1),j=`${Fe?.target??Fe?.type??"self"}`.toLowerCase(),Z=(()=>{if(p.lvlBn?.isInfinite?.())return!0;try{return p.lvlBn?.cmp?.(te)>=0}catch{}return!1})(),oe=`Level ${xe}: Multiplies this upgrade\u2019s effect by ${E}x`;return j==="xp"&&(oe=`Level ${xe}: Multiplies XP value by ${E}x`),(j==="coin"||j==="coins")&&(oe=`Level ${xe}: Multiplies Coin value by ${E}x`),j==="mp"&&(oe=`Level ${xe}: Multiplies MP value by ${E}x`),{text:oe,achieved:Z}});XE(ke)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ge=ut.querySelector(".upg-actions"),Be=ge.querySelector(".shop-close");if(Be||(Be=document.createElement("button"),Be.type="button",Be.className="shop-close",Be.textContent="Close",Be.addEventListener("click",()=>{n=!1,Tp()}),ge.appendChild(Be)),g||q)ge.querySelectorAll("button:not(.shop-close)").forEach(ne=>ne.remove()),document.activeElement&&document.activeElement!==Be&&!ge.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Be.focus();else{let ne=p.have.cmp(H)>=0,ve=(ce,te,xe,E,j=!1)=>{let Z=ge.querySelector(`.${ce.split(" ").join(".")}`);if(!Z){Z=document.createElement("button"),Z.type="button",Z.className=ce,Z.textContent=te;let oe=()=>{typeof Z._onClick=="function"&&Z._onClick()};"PointerEvent"in window?Z.addEventListener("pointerdown",ue=>{ue.pointerType==="mouse"||typeof ue.button=="number"&&ue.button!==0||(oe(),ue.preventDefault())},{passive:!1}):Z.addEventListener("touchstart",ue=>{oe(),ue.preventDefault()},{passive:!1}),Z.addEventListener("click",()=>{Je||oe()});let ye=ge.children;E>=ye.length?ge.appendChild(Z):ge.insertBefore(Z,ye[E])}return Z._onClick=xe,Z.textContent!==te&&(Z.textContent=te),Z.disabled!==j&&(Z.disabled=j),Z};if(k){ge.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ce=>ce.remove()),ve("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ce}=o.evolve(e.id);ce&&(_v(),ar(),m())},1,!1);return}if(p.unlockUpgrade){ge.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ce=>ce.remove()),ve("shop-delve btn-unlock","Unlock",()=>{let{bought:ce}=o.buyOne(e.id);if(!(ce instanceof c?ce:c.fromAny(ce??0)).isZero?.()){if(rn(),hu(e,t))try{bl(["reset"])}catch{}ar(),m()}},1,!ne);return}if(ge.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ce=>ce.remove()),ve("shop-delve btn-buy-one","Buy",()=>{let ce=o.getUiModel(e.id);if(ce.have.cmp(ce.nextPrice instanceof c?ce.nextPrice:c.fromAny(ce.nextPrice||0))<0)return;let{bought:te}=o.buyOne(e.id);(te instanceof c?te:c.fromAny(te??0)).isZero?.()||(rn(),ar(),m())},1,!ne),(Number.isFinite(p.upg.lvlCap)?p.upg.lvlCap:1/0)===1){let ce=ge.querySelector(".btn-buy-max");ce&&ce.remove();let te=ge.querySelector(".btn-buy-cheap");te&&te.remove()}else{ve("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:E}=o.buyMax(e.id);(E instanceof c?E:c.fromAny(E??0)).isZero?.()||(rn(),ar(),m())},2,!ne);let te=[1,3,4,5,6].includes(Cp(p.upg));if(!l&&!te)ve("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let j=o.buyCheap;if(!j)return;let{bought:Z}=j(e.id);(Z instanceof c?Z:c.fromAny(Z??0)).isZero?.()||(rn(),ar(),m())},3,!ne);else{let xe=ge.querySelector(".btn-buy-cheap");xe&&xe.remove()}}if(l)ve("shop-delve btn-buy-next","Buy Next",()=>{let te=o.getUiModel(e.id);if(te.hmReadyToEvolve)return;let xe=te.hmNextMilestone;if(!xe||!te.lvlBn||xe.cmp(te.lvlBn)<=0){let{bought:Se}=o.buyMax(e.id);if((Se instanceof c?Se:c.fromAny(Se??0)).isZero?.())return;rn(),ar(),m();return}let E=0;try{let Se=xe.sub(te.lvlBn).toPlainIntegerString?.();E=Math.max(0,Math.floor(Number(Se&&Se!=="Infinity"?Se:xe.sub(te.lvlBn).toString())))}catch{}let j=R[te.upg.costType]?.value,Z=j instanceof c?j:c.fromAny(j??0),ye=Mi(te.upg,te.lvlBn,Z,E).count,ue=!1;try{let Se=ye?.toPlainIntegerString?.();ue=Se&&Se!=="Infinity"?Number(Se)>=E:Number(ye??0)>=E}catch{}let We=ue?o.buyNext(e.id,E):o.buyMax(e.id);(We.bought instanceof c?We.bought:c.fromAny(We.bought??0)).isZero?.()||(rn(),ar(),m())},3,p.have.cmp(c.fromInt(1))<0);else{let ce=ge.querySelector(".btn-buy-next");ce&&ce.remove()}}},y=()=>{n&&m()};o.events.forEach(p=>window.addEventListener(p,y)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",y),m(),sn.classList.add("is-open"),sn.classList.toggle("is-automation-upgrade",t==="automation"),sn.style.pointerEvents="auto",Pn(140),ut.style.transition="none",ut.style.transform="translateY(100%)",ut.offsetHeight,requestAnimationFrame(()=>{ut.style.transition="",ut.style.transform=""}),gu=()=>{n=!1,o.events.forEach(p=>window.removeEventListener(p,y)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",y)}}function Pd(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let m=Math.max(0,d-r.startY);r.lastY=d,r.moved=m,t.style.transform=`translateY(${m}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(To(100),Pn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var Sl,yv,kE,NE,RE,vv,OE,PE,BE,bv,FE,DE,xv,Lv,$E,Sv,Il,xl,sn,ut,Ll,gu,Cv,hi=Ue(()=>{St();xt();qt();yo();Us();Ic();Ln();mo();us();ai();Is();_p();Sl=new Set;yv={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},kE="img/misc/locked_base.webp",NE="img/misc/maxed.webp",RE="img/misc/green_border.webp",vv={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},OE=7,PE={coins:Xa,books:Va,gold:Ya,magic:Wa,dna:za};BE={coins:Xa,books:Va,gold:Ya,magic:Wa,dna:za};bv={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Mp(eo()),getUiModel:e=>Hs(eo(),e),buyOne:e=>qs(eo(),e),buyMax:e=>wl(eo(),e),buyCheap:e=>El(eo(),e),buyNext:(e,t)=>Gs(eo(),e,t),getLockState:e=>No(eo(),e),evolve:e=>vu(eo(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",bp,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Mp(Ze),getUiModel:e=>Hs(Ze,e),buyOne:e=>qs(Ze,e),buyMax:e=>wl(Ze,e),buyCheap:e=>El(Ze,e),buyNext:(e,t)=>Gs(Ze,e,t),getLockState:e=>No(Ze,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>Mp(Xt),getUiModel:e=>Hs(Xt,e),buyOne:e=>qs(Xt,e),buyMax:e=>wl(Xt,e),buyCheap:e=>El(Xt,e),buyNext:(e,t)=>Gs(Xt,e,t),getLockState:e=>No(Xt,e),evolve:e=>vu(Xt,e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||ar(!0)});FE="sounds/purchase_upg.ogg",DE="sounds/evolve_upg.ogg",xv=.12,Lv=.3;$E="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",Sv="ccc-scroll-timeline-styles";Il=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return Ev(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!nv(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let H=document.createElement("div");H.className="shop-tile";let z=document.createElement("img");z.className="base",z.alt="";let de=document.createElement("img");de.className="icon",de.alt="",de.addEventListener("error",()=>{de.src=$E}),H.appendChild(z),H.appendChild(de),i.appendChild(H),t.appendChild(i),i.addEventListener("click",ee=>{let re=ee.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){ee.preventDefault(),ee.stopImmediatePropagation();return}if(uo(re)){ee.preventDefault(),ee.stopImmediatePropagation();return}if(ee.shiftKey||ee.ctrlKey){if(ee.preventDefault(),ee.stopImmediatePropagation(),!re.upgMeta)return;let ge=re.upgMeta.id,Be=re.upgMeta.upgType==="HM",ne=[1,3,4,5,6].includes(Cp(re.upgMeta));if(ee.shiftKey){if((Be||!ne)&&this.adapter.buyCheap){let{bought:ke}=this.adapter.buyCheap(ge);(ke instanceof c?ke:c.fromAny(ke??0)).isZero?.()||(rn(),this.update());return}let{bought:ve}=this.adapter.buyMax(ge);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(rn(),hu(re.upgMeta,this.mode))try{bl(["reset"])}catch{}this.update()}return}if(ee.ctrlKey){if(Be){let ke=this.adapter.getUiModel(ge);if(ke&&!ke.hmReadyToEvolve){let Fe=ke.hmNextMilestone;if(Fe&&ke.lvlBn&&Fe.cmp(ke.lvlBn)>0){let ce=0;try{let oe=Fe.sub(ke.lvlBn).toPlainIntegerString?.();ce=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Fe.sub(ke.lvlBn).toString())))}catch{}let te=R[ke.upg.costType]?.value,xe=te instanceof c?te:c.fromAny(te??0),j=Mi(ke.upg,ke.lvlBn,xe,ce).count,Z=!1;try{let oe=j?.toPlainIntegerString?.();Z=oe&&oe!=="Infinity"?Number(oe)>=ce:Number(j??0)>=ce}catch{}if(Z){let oe=this.adapter.buyNext(ge,ce);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(rn(),this.update());return}}}}let{bought:ve}=this.adapter.buyMax(ge);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(rn(),hu(re.upgMeta,this.mode))try{bl(["reset"])}catch{}this.update()}return}}re.upgMeta&&VE(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",ee=>{if(Je)return;let re=ee.currentTarget;if(re.dataset.locked==="1"||(ee.preventDefault(),ee.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:ve}=this.adapter.evolve(re.upgMeta.id);ve&&(_v(),this.update());return}let{bought:Be}=this.adapter.buyMax(re.upgMeta.id);if(!(Be instanceof c?Be:c.fromAny(Be??0)).isZero?.()){if(rn(),hu(re.upgMeta,this.mode))try{bl(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let m=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",m);let y=s?c.fromInt(0):GE(r.meta,r.levelNumeric,r.level),p=y instanceof c?y:c.fromAny(y),h=K(r.level),g=yu(h),v=K(p),w=yu(v),x=!p.isZero?.(),C=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,k=Number.isFinite(C)?Math.max(0,Math.floor(C)):1/0,q=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,P=m?!1:r.level?.isInfinite?.()?!0:Number.isFinite(k)&&Number.isFinite(q)?q>=k:!1,G=Number.isFinite(k)&&k===1,M=!!r.meta?.unlockUpgrade,D=!s&&M&&!P,T=!s&&M&&!D&&P,_,Y,Q=!1,ae=!1;if(s){_="",Y="";let H=u?(r.lockState?.reason||"").trim():"",z=H?`${r.title} (Locked, ${H})`:`${r.title} (Locked)`;i.setAttribute("aria-label",z)}else{if(D||T)_=D?"Unlockable":"Unlocked",Y=_,ae=!0;else if(!s&&G&&!M)P?(_="Owned",Y="Owned"):x?(_="Purchasable",Y="Purchasable"):(_="Not Owned",Y="Not Owned"),ae=!0;else{let H=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,z=String(g||"").replace(/,/g,""),de=/|Infinity/i.test(z),ee=Number.isFinite(H)?H>=1e3:de||/^\d{4,}$/.test(z);Q=x&&ee,Q?(_=`<span class="badge-lvl">${h}</span><span class="badge-plus">(+${v})</span>`,Y=`${g} (+${w})`):(_=x?`${h} (+${v})`:h,Y=x?`${g} (+${w})`:g)}i.setAttribute("aria-label",`${r.title}, ${Y}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let he=i.firstElementChild,be=he.querySelector(".base"),Oe=he.querySelector(".icon"),Ae=r.meta?.costType||"coins",W=r.useLockedBase||s?kE:r.baseIconOverride||yv[Ae]||yv.coins;be.src!==W&&(be.src=W);let $=r.icon;if(!$)Oe.hidden||(Oe.hidden=!0);else{Oe.hidden&&(Oe.hidden=!1);let H=$;Oe._lastSrc!==H&&(Oe.src=H,Oe._lastSrc=H)}let X=he.querySelector(".maxed-overlay"),J=!s&&wv(r.meta),le=!s&&P;if(le||!s&&!P&&!m&&J){X||(X=document.createElement("img"),X.className="maxed-overlay",X.alt="",he.insertBefore(X,Oe));let H=le?NE:RE;X.src!==H&&(X.src=H)}else X&&X.remove();let L=he.querySelector(".level-badge");s?L&&L.remove():(L||(L=document.createElement("span"),L.className="level-badge",he.appendChild(L)),L.className="level-badge",ae&&L.classList.add("text-badge"),Q&&L.classList.add("two-line"),(x||D)&&L.classList.add("can-buy"),P&&L.classList.add("is-maxed"),_===Y?L.textContent!==_&&(L.textContent=_):L.innerHTML!==_&&(L.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),Rs(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&uo(a)||(Dr(),lv())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(Je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{Je&&Pn(80),this.close()},{passive:!0}),Pd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&mv(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,Je)try{setTimeout(()=>To(240),120)}catch{}Pn(10),Rs(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||!t&&ip()||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}};typeof window<"u"&&window.addEventListener("menu:scrollStop",()=>{ar(!0)});xl={standard:new Il("standard"),automation:new Il("automation"),dna:new Il("dna")};sn=null,ut=null,Ll=!1,gu=null,Cv="standard"});var kv={};bt(kv,{applyHudLayout:()=>lr,initHudButtons:()=>WE,isMapUnlocked:()=>Rp,isShopUnlocked:()=>Np,lockMap:()=>xu,lockShop:()=>Eu,unlockMap:()=>wu,unlockShop:()=>Ci});function kp(e){let t=b();return t==null?e:`${e}:${t}`}function Xs(e){let t=kp(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function Np(){return Op(),Xs(So.SHOP)}function Rp(){return Op(),Xs(So.MAP)}function Iu(e,t){let n=t?"1":"0",o=kp(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function Op(){for(let e of Object.values(So)){let t=kp(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function Ro(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function Ap(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",es())}function YE(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function lr(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=YE(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(y=>e.querySelector(`.game-btn[data-btn="${y}"]`)).filter(Boolean),a=[...e.children].filter(y=>!l.includes(y)),u=[...l,...a];if(u.length&&u.some((y,p)=>e.children[p]!==y)){let y=document.createDocumentFragment();u.forEach(p=>y.appendChild(p)),e.appendChild(y)}let m=[...e.querySelectorAll(".game-btn")].filter(y=>!y.hidden);if(e.classList.remove("is-2","is-3","is-4"),m.forEach(y=>{y.style.gridColumn="",y.style.gridRow="",y.classList.remove("span-2"),y.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${m.length}`),!o){let y=getComputedStyle(e),p=parseFloat(y.columnGap||y.gap||"0")||0,h=e.clientWidth,g=Math.max(180,Math.floor((h-3*p)/4));if(m.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3";return}if(m.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3",m[2].style.gridColumn="4";return}}if(o&&m.length===3){let y=e.querySelector('[data-btn="help"]:not([hidden])'),p=e.querySelector('[data-btn="stats"]:not([hidden])'),h=e.querySelector('[data-btn="shop"]:not([hidden])');y&&p&&h&&(y.style.gridColumn="1",y.style.gridRow="1",p.style.gridColumn="2",p.style.gridRow="1",h.style.gridColumn="1 / -1",h.style.gridRow="2")}}function WE(){if(Op(),Ro("help",!0),Ro("stats",!0),Ro("shop",Xs(So.SHOP)),Ro("map",Xs(So.MAP)),Ap(),lr(),typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>fu(),{timeout:5e3}):setTimeout(()=>fu(),100),Tv||(Tv=!0,window.addEventListener("resize",lr),window.addEventListener("orientationchange",lr),window.addEventListener("saveSlot:change",()=>{Ro("shop",Xs(So.SHOP)),Ro("map",Xs(So.MAP)),Ap(),lr()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||Ap()})),!Av){Av=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&ks()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&uo(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function Ci(){Iu(So.SHOP,!0),Ro("shop",!0),lr()}function wu(){Iu(So.MAP,!0),Ro("map",!0),lr()}function Eu(){Iu(So.SHOP,!1),Ro("shop",!1),lr()}function xu(){Iu(So.MAP,!1),Ro("map",!1),lr()}var So,Tv,Av,Lu=Ue(()=>{hi();Us();St();us();So={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Tv=!1,Av=!1});function Nv(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(H=>H.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let L=0;L<t;L++)d[L*f+2]=1/0;let m=new Int16Array(t),y=t;for(let L=0;L<t;L++)m[L]=t-1-L;let p=-1,h=document.createElement("canvas");h.className="cursor-trail-canvas",Object.assign(h.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(h);let g=h.getContext("2d",{alpha:!0,desynchronized:!0}),v=document.createElement("canvas");v.width=a,v.height=a;let w=v.getContext("2d");w.shadowColor="#FFEB3B",w.shadowBlur=l,w.fillStyle="#FFEB3B",w.beginPath(),w.arc(u,u,s,0,Math.PI*2),w.fill();let x=!1,C=null,k=null,q={left:0,top:0,width:0,height:0},P=1,G=!1,M=0,D=0,T=!1,_=null,Y=[],Q=()=>{if(G)return;let L=document.documentElement.clientWidth,H=document.documentElement.clientHeight;q={left:0,top:0,width:L,height:H,right:L,bottom:H,x:0,y:0}},ae=()=>{if(G)return;Q();let L=Math.min(window.devicePixelRatio||1,2);P=q.width>0?Math.min(L,512/q.width):L,h.width=q.width*P,h.height=q.height*P,g.scale(P,P),_=null},he=null;typeof ResizeObserver<"u"&&(he=new ResizeObserver(()=>{ae()}),he.observe(e));let be=(L,H)=>{if(y<=0)return;let z=m[--y];z>p&&(p=z);let de=z*f;d[de]=L,d[de+1]=H,d[de+2]=0,d[de+3]=n},Oe=(L,H,z)=>{if(C===null||k===null)z.count<r&&(be(L,H),z.count++);else{let de=L-C,ee=H-k,re=Math.hypot(de,ee);if(re>=o){let ge=Math.floor(re/o);for(let Be=1;Be<=ge&&!(z.count>=r);Be++){let ne=Be*o/re;be(C+de*ne,k+ee*ne),z.count++}}z.count<r&&(be(L,H),z.count++)}C=L,k=H},Ae=L=>{if(G)return;M||(D=0,M=requestAnimationFrame(W)),q.width||Q();let H=0,z=0,de=(ee,re)=>ee>=0&&ee<=q.width&&re>=0&&re<=q.height;if(L.getCoalescedEvents){let ee=L.getCoalescedEvents();if(ee.length>0)for(let re of ee){let ge=re.clientX-H,Be=re.clientY-z;Y.push({x:ge,y:Be,inside:de(ge,Be)})}else{let re=L.clientX-H,ge=L.clientY-z;Y.push({x:re,y:ge,inside:de(re,ge)})}}else{let ee=L.clientX-H,re=L.clientY-z;Y.push({x:ee,y:re,inside:de(ee,re)})}},F=()=>{x=!1,C=null,k=null,Y.length=0},W=()=>{if(G)return;let L=performance.now();D||(D=L);let H=L-D;D=L,H>100&&(H=100);let z={count:0};if(Y.length>0){for(let De of Y)De.inside?(x=!0,Oe(De.x,De.y,z)):(x=!1,C=null,k=null);let ve=Y[Y.length-1];ve.inside&&(C!==ve.x||k!==ve.y)&&(be(ve.x,ve.y),C=ve.x,k=ve.y),Y.length=0}else x&&C!==null&&k!==null&&be(C,k);let de=t-y;if(de===0&&!T){M=0;return}_?g.clearRect(_.x,_.y,_.w,_.h):g.clearRect(0,0,q.width,q.height),T=!1;let ee=1/0,re=1/0,ge=-1/0,Be=-1/0,ne=-1;if(de>0)for(let ve=0;ve<=p;ve++){let De=ve*f,ke=d[De+2];if(ke>=d[De+3])continue;if(ke+=H,d[De+2]=ke,ke>=d[De+3]){m[y++]=ve;continue}ne=ve;let Fe=d[De+3],ce=ke/Fe,te=1-ce,xe=1-.4*ce;T=!0,g.globalAlpha=te;let E=a*xe,j=E/2,Z=d[De],oe=d[De+1],ye=Math.round(Z-j),ue=Math.round(oe-j),We=Math.round(E);g.drawImage(v,ye,ue,We,We),ye<ee&&(ee=ye),ue<re&&(re=ue);let ot=ye+We,Se=ue+We;ot>ge&&(ge=ot),Se>Be&&(Be=Se)}p=ne,ee!==1/0?(ee-=2,re-=2,ge+=2,Be+=2,_={x:ee,y:re,w:ge-ee,h:Be-re}):_=null,M=requestAnimationFrame(W)};window.addEventListener("resize",ae),window.addEventListener("scroll",Q,{passive:!0}),window.addEventListener("focus",Q,{passive:!0}),document.addEventListener("visibilitychange",Q,{passive:!0});let $={passive:!0},X=L=>{Q(),Ae(L)},J=L=>{Q(),Ae(L)};e.addEventListener("pointermove",Ae,$),e.addEventListener("pointerdown",J,$),e.addEventListener("pointerenter",X,$),e.addEventListener("pointerleave",F,$),e.addEventListener("pointercancel",F,$),ae(),M=requestAnimationFrame(W);let le=setInterval(Q,1e3);return{destroy:()=>{G=!0,M&&cancelAnimationFrame(M),le&&clearInterval(le),he&&(he.disconnect(),he=null);try{window.removeEventListener("resize",ae)}catch{}try{window.removeEventListener("scroll",Q)}catch{}try{window.removeEventListener("focus",Q)}catch{}try{document.removeEventListener("visibilitychange",Q)}catch{}try{e.removeEventListener("pointermove",Ae),e.removeEventListener("pointerdown",J),e.removeEventListener("pointerenter",X),e.removeEventListener("pointerleave",F),e.removeEventListener("pointercancel",F)}catch{}h.remove()}}}var Rv=Ue(()=>{});var Xv={};bt(Xv,{clearPendingGains:()=>Xp,getPassiveCoinReward:()=>ou,initCoinPickup:()=>nx,setCoinMultiplier:()=>ZE,triggerPassiveCollect:()=>$d});function Ov(e){if(!e||typeof e!="object"){Ml=!1,_u=!1,Mu="0",ki.clear();return}Ml=!!e.unlocked,_u=!!e.level?.isInfinite?.();try{Mu=e.level?.toPlainIntegerString?.()??"0"}catch{Mu="0"}Ml?_u&&ki.clear():ki.clear()}function zE(){if(typeof Ti=="function")try{Ti()}catch{}try{Ov(gt())}catch{Ml=!1,ki.clear()}try{Ti=Ni(e=>{Ov(e)})}catch{Ti=null}}function ZE(e){jE=e;try{R.coins?.mult?.set&&R.coins.mult.set(e)}catch{}}function Dp(){try{let e=Bc();e instanceof c?Ys=e.clone?.()??e:e!=null?Ys=c.fromAny(e):Ys=c.fromInt(1)}catch{Ys=c.fromInt(1)}}function JE(){Pv||(Pv=!0,Dp(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",Dp),typeof window<"u"&&window.addEventListener("saveSlot:change",Dp))}function QE(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Gp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function qp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*ex:0}function tx({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,m=0,y=null,p=null,h=qp(),g=0,v=0,w=0,x=!1,C=null,k=null,q=()=>{if(x)return;let $=document.documentElement.clientWidth,X=document.documentElement.clientHeight;C={left:0,top:0,width:$,height:X,right:$,bottom:X,x:0,y:0}},P=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",y=null,p=null},G=()=>{if(!l||v<=0){P();return}let $=v*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${d-v}px, ${m-v}px, 0)`,s.classList.add("is-visible")},M=()=>{if(!(!l||v<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=v+Up,X=[];if(typeof i.findCoinTargetsInPath=="function"&&y!==null&&p!==null?X=i.findCoinTargetsInPath(y,p,d,m,$):X=i.findCoinTargetsInRadius(d,m,$),y=d,p=m,X&&X.length>0)if(typeof r=="function"){let J=[];for(let le=0;le<X.length;le++){let fe=X[le],L={coin:fe};fe.el&&i.getCoinTransform&&(L.opts={transform:i.getCoinTransform(fe.el)}),J.push(L)}r(J)}else for(let J=0;J<X.length;J++){let le=X[J],fe=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(fe){let L=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform||"";o(fe,{transform:L})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=v+Up,X=i.findCoinsInRadius(d,m,$);if(y=d,p=m,X&&X.length>0){let J=[];for(let le=0;le<X.length;le++){let fe=X[le],L=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform;J.push({el:fe,opts:{transform:L}})}typeof r=="function"&&r(J)}}else{let $=t.children,X=v+Up,J=[];for(let le=$.length-1;le>=0;le--){let fe=$[le];if(fe.dataset.collected==="1"||!fe.matches(n))continue;let L=fe.getBoundingClientRect(),H=L.left+L.width/2,z=L.top+L.height/2,de=H-u,ee=z-f;Math.hypot(de,ee)<=X&&J.push(fe)}if(!J.length)return;if(typeof r=="function"){let le=[];for(let fe=0;fe<J.length;fe++){let L=J[fe],H=window.getComputedStyle(L);le.push({el:L,opts:{transform:H.transform}})}r(le)}else{let le=[];for(let fe=0;fe<J.length;fe++){let L=J[fe],H=window.getComputedStyle(L);le.push(H.transform)}for(let fe=0;fe<J.length;fe++)o(J[fe],{transform:le[fe]})}}},D=()=>{w=0,G(),!(!l||v<=0||x)&&(M(),T())},T=()=>{!l||v<=0||w||x||(w=requestAnimationFrame(D))},_=$=>{if(!$||x||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,f=$.clientY,C||q();let X=C;d=u,m=f,l=d>=0&&d<=X.width&&m>=0&&m<=X.height,T()},Y=()=>{l=!1,P(),y=null,p=null},Q=()=>{y=null,p=null},ae=()=>{g=Fc(),v=g*h,G(),T()},he=()=>{if(!(x||!a)){if(q(),C){let $=C;d=u-$.left,m=f-$.top,l=d>=0&&d<=$.width&&m>=0&&m<=$.height}T()}},be=()=>{if(h=qp(),v=g*h,q(),a&&C){let $=C;d=u-$.left,m=f-$.top,l=d>=0&&d<=$.width&&m>=0&&m<=$.height}T()},Oe=$=>{q(),_($)},Ae=$=>{Q(),Oe($)},F=()=>{x=!0,w&&(cancelAnimationFrame(w),w=0),k&&clearInterval(k);try{window.removeEventListener("scroll",he)}catch{}try{window.removeEventListener("resize",be)}catch{}try{window.removeEventListener("saveSlot:change",ae)}catch{}try{document.removeEventListener("ccc:upgrades:changed",ae)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",Oe)}catch{}try{e.removeEventListener("pointerenter",Ae)}catch{}try{e.removeEventListener("pointerleave",Y)}catch{}try{e.removeEventListener("pointercancel",Y)}catch{}try{window.removeEventListener("blur",Q)}catch{}try{s.remove()}catch{}},W={passive:!0};return e.addEventListener("pointermove",_,W),e.addEventListener("pointerdown",Oe,W),e.addEventListener("pointerenter",Ae,W),e.addEventListener("pointerleave",Y,W),e.addEventListener("pointercancel",Y,W),window.addEventListener("resize",be),window.addEventListener("scroll",he,{passive:!0}),window.addEventListener("focus",q,{passive:!0}),window.addEventListener("blur",Q,{passive:!0}),document.addEventListener("visibilitychange",()=>{q(),document.hidden&&Q()},{passive:!0}),window.addEventListener("saveSlot:change",ae),document.addEventListener("ccc:upgrades:changed",ae),k=setInterval(q,1e3),ae(),{destroy:F}}function Xp(){Cl=null,Tl=null,Al=null}function Hv(e){let t=Gp.clone?.()??c.fromInt(1),n=qv(t),o=Io(Bv),i=Gv(e??Mu);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Oo=="function"&&Oo()?Io(Ys):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function ou(){let{coinGain:e,xpGain:t,mpGain:n}=Hv(null);return{coins:e,xp:t,mp:n}}function $d(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=Hv(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=dn(Re.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{Bn=Bn?.add?Bn.add(r):Io(r)}catch{Bn=Io(r)}_l(),a||Fv(r);let u=typeof mn=="function"?mn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&Dv(i),s.isZero?.()||Uv(s)}function nx({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){Pp?.destroy&&Pp.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};zE(),JE(),a.style.touchAction="none";let d=null,m=null;Bn=R.coins.value,$p=()=>{let L=K(Bn),H=Zd(),z=L+H;z.includes("<span")?f.innerHTML=z:f.textContent=z},$v(),_l();let y=L=>{L?.detail&&L.detail.key==="coins"&&(Bn=L.detail.value,_l())};window.addEventListener("currency:change",y);let p=L=>{if(!(!L?.detail||L.detail.key!=="coins"))try{let{mult:H}=L.detail;H instanceof c?to=H.clone?.()??H:H!=null?to=c.fromAny(H):to=c.fromInt(1),Ai=!!to?.isInfinite?.()}catch{to=null,Ai=!1}};window.addEventListener("currency:multiplier",p);let h=b();if(h==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${h}`,v=`ccc:unlock:shop:progress:${h}`,w=localStorage.getItem("ccc:unlock:shop:progress"),x=localStorage.getItem("ccc:unlock:shop");w!=null&&localStorage.getItem(v)==null&&localStorage.setItem(v,w),x!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,x),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let L=parseInt(localStorage.getItem(v)||"0",10);if(localStorage.setItem(v,String(L)),L>=10&&localStorage.getItem(g)!=="1"){try{Ci()}catch{}localStorage.setItem(g,"1")}}let C=new URL(i,document.baseURI).href,k=L=>L instanceof HTMLElement?L._coinObj?!L._coinObj.isRemoved&&L.dataset.collected!=="1":L.dataset.collected!=="1"&&L.matches(r):!1;function q(L){try{L.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(q);let P=Je?.12:.3,G=0;function M(L=C){if(L===C){let H=performance.now();if(H-G<40)return;G=H}ft(L,{volume:P})}function D(L,H={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(L);let z=()=>{L&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(L):L.remove())};if(l||Je){z();return}let de="translate3d(0,0,0)";H.transform?H.transform!=="none"&&(de=H.transform):de=L.style.transform||"translate3d(0,0,0)",L.style.setProperty("--ccc-start",de),L.classList.add("coin--collected");let ee=!1,re=()=>{ee||(ee=!0,L.removeEventListener("animationend",re),z())};L.addEventListener("animationend",re),setTimeout(re,600)}function T(L){if(!L||!L.length)return;let H=C,z=-1,de=!1;for(let ce of L){let te=ce.coin||ce.el&&ce.el._coinObj;te&&(te.sizeIndex!==void 0?te.sizeIndex>z&&(z=te.sizeIndex,te.soundSrc&&(H=te.soundSrc,de=!0)):te.soundSrc&&!de&&(H=te.soundSrc,de=!0))}M(H);let ee=null,re=null,ge=null,Be=0,ne=dn(Re.COINS),ve=typeof mn=="function"?mn():!0,De=typeof Oo=="function"&&Oo(),ke=15,Fe=0;for(let ce of L){let te=ce.el,xe=ce.coin;if(!xe&&te&&te._coinObj&&(xe=te._coinObj),te&&!k(te)||xe&&xe.isRemoved)continue;Be++,te&&(te.dataset.collected="1"),Fe<ke?(!te&&xe&&e&&e.ensureCoinVisual&&(te=e.ensureCoinVisual(xe),te&&(te.dataset.collected="1")),te?(D(te,ce.opts||{}),Fe++):xe&&e&&e.removeCoinTarget&&e.removeCoinTarget(xe)):xe&&e&&e.removeCoinTarget?e.removeCoinTarget(xe):te&&(e&&e.detachCoin&&e.detachCoin(te),e&&e.recycleCoin?e.recycleCoin(te):te.remove());let E=te?QE(te):Gp,j=xe?.mutationLevel??(te?.dataset?.mutationLevel||null),Z=qv(E),oe=Io(Bv),ye=Io(Ys);if(xe&&xe.valueMultiplier&&xe.valueMultiplier>1){try{Z=Z.mulDecimalFloor(xe.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(xe.valueMultiplier)}catch{}try{ye=ye.mulDecimalFloor(xe.valueMultiplier)}catch{}}let ue=Gv(j);if(ue){try{Z=Z.mulBigNumInteger(ue)}catch{}try{oe=oe.mulBigNumInteger(ue)}catch{}}ne||(ee=Ws(ee,Z)),ve&&(re=Ws(re,oe)),De&&(ge=Ws(ge,ye))}if(Be!==0){if(Ey(),ee&&!ee.isZero?.()){try{Bn=Bn?.add?Bn.add(ee):Io(ee)}catch{Bn=Io(ee)}Fv(ee),_l()}if(re&&!re.isZero?.()&&Dv(re),ge&&!ge.isZero?.()&&Uv(ge),localStorage.getItem(g)!=="1"){let te=parseInt(localStorage.getItem(v)||"0",10)+Be;if(localStorage.setItem(v,String(te)),te>=10){try{Ci()}catch{}localStorage.setItem(g,"1")}}}}function _(L,H={}){return T([{el:L,opts:H}]),!0}d=tx({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:T,spawner:e}),m=Nv(a);let Y=L=>{if(L.target===u)return;let H=L.target.closest(r);if(H&&k(H)){let z={};e&&typeof e.getCoinTransform=="function"&&(z.transform=e.getCoinTransform(H)),_(H,z)}};u.addEventListener("pointerdown",Y,{passive:!0}),Je||u.addEventListener("mouseover",Y,{passive:!0});let Q=25,ae=null,he=()=>{let L=document.documentElement.clientWidth,H=document.documentElement.clientHeight;ae={left:0,top:0,width:L,height:H,right:L,bottom:H,x:0,y:0}};window.addEventListener("resize",he),window.addEventListener("scroll",he,{passive:!0}),he();let be=null,Oe=null,Ae=()=>{be=null,Oe=null};a.addEventListener("pointerleave",Ae,{passive:!0}),a.addEventListener("pointerenter",Ae,{passive:!0}),window.addEventListener("blur",Ae,{passive:!0});function F(L,H){if(e&&typeof e.findCoinTargetsInRadius=="function"){ae||he();let z=L,de=H,ee=[];if(typeof e.findCoinTargetsInPath=="function"&&be!==null&&Oe!==null?ee=e.findCoinTargetsInPath(be,Oe,z,de,Q,!0):ee=e.findCoinTargetsInRadius(z,de,Q,!0),be=z,Oe=de,ee&&ee.length>0){let re=[];for(let ge=0;ge<ee.length;ge++){let Be=ee[ge],ne={coin:Be};Be.el&&e.getCoinTransform&&(ne.opts={transform:e.getCoinTransform(Be.el)}),re.push(ne)}T(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){ae||he();let z=L,de=H,ee=e.findCoinsInRadius(z,de,Q);if(be=z,Oe=de,ee&&ee.length>0){let re=[];for(let ge of ee){let Be=e.getCoinTransform?e.getCoinTransform(ge):ge.style.transform;re.push({el:ge,opts:{transform:Be}})}T(re)}}else{let z=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],de=new Set;for(let ee=0;ee<z.length;ee++){let re=L+z[ee][0],ge=H+z[ee][1],Be=document.elementsFromPoint(re,ge);for(let ne=0;ne<Be.length;ne++){let ve=Be[ne];k(ve)&&!de.has(ve)&&de.add(ve)}}if(de.size>0){let ee=[];de.forEach(re=>ee.push({el:re})),T(ee)}}}let W=null,$=!1;function X(L,H){W={x:L,y:H},$||($=!0,requestAnimationFrame(()=>{W&&(F(W.x,W.y),W=null),$=!1}))}a.addEventListener("pointerdown",L=>{X(L.clientX,L.clientY)},{passive:!0}),a.addEventListener("pointermove",L=>{L.pointerType!=="mouse"&&X(L.clientX,L.clientY)},{passive:!0}),a.addEventListener("pointerup",L=>{L.pointerType!=="mouse"&&X(L.clientX,L.clientY)},{passive:!0}),a.addEventListener("mousemove",L=>{X(L.clientX,L.clientY)},{passive:!0});function J(L){}let le=setInterval(he,1e3),fe=()=>{if(clearInterval(le),Cu(),$p=()=>{},typeof window<"u"&&(window.removeEventListener("resize",he),window.removeEventListener("beforeunload",Cu),window.removeEventListener("currency:multiplier",p),window.removeEventListener("currency:change",y),window.removeEventListener("blur",Ae)),typeof Ti=="function"){try{Ti()}catch{}Ti=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(m?.destroy){try{m.destroy()}catch{}m=null}try{u.removeEventListener("pointerdown",Y),Je||u.removeEventListener("mouseover",Y)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(L=>a.replaceWith(a.cloneNode(!0)))}catch{}};return Pp={destroy:fe},{get count(){return Bn},set count(L){Bn=c.fromAny?c.fromAny(L):c.fromInt(Number(L)||0),_l()},setMobileVolume:J,destroy:fe,collectBatch:T,getMagnetUnitPx:qp}}var Ml,_u,Mu,Ti,Pp,Bv,Gp,KE,Vs,ki,jE,Ys,Pv,Cl,Tl,Al,Bp,Bn,$p,Fp,_l,ex,Up,Io,Ws,Cu,Hp,Fv,Dv,Uv,to,Ai,$v,qv,Gv,nl=Ue(()=>{St();xt();qt();Lu();Tn();yo();ho();mo();Rv();Ln();Wd();hn();Ml=!1,_u=!1,Mu="0",Ti=null;Pp=null,Bv=c.fromInt(1),Gp=c.fromInt(1),KE=c.fromInt(1);try{Vs=c.fromAny("Infinity")}catch{Vs=null}ki=new Map,jE="1",Ys=c.fromInt(1),Pv=!1,Cl=null,Tl=null,Al=null,Bp=!1,Bn=null,$p=()=>{},Fp=!1,_l=()=>{Fp||(Fp=!0,requestAnimationFrame(()=>{Fp=!1,$p()}))};ex=.05,Up=8;Io=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Ws=(e,t)=>{if(!t)return e;if(!e)return Io(t);try{return e.add(t)}catch{try{return Io(e).add(t)}catch{return Io(t)}}},Cu=()=>{let e=Cl;if(Cl=null,e&&!e.isZero?.())try{R.coins.add(e)}catch{}let t=Tl;if(Tl=null,t&&!t.isZero?.())try{as(t)}catch{}let n=Al;if(Al=null,n&&!n.isZero?.())try{Os(n)}catch{}},Hp=()=>{Bp||(Bp=!0,requestAnimationFrame(()=>{Bp=!1,Cu()}))},Fv=e=>{Cl=Ws(Cl,e),Hp()},Dv=e=>{Tl=Ws(Tl,e),Hp()},Uv=e=>{Al=Ws(Al,e),Hp()};typeof window<"u"&&window.addEventListener("beforeunload",Cu,{passive:!0});to=null,Ai=!1,$v=()=>{try{let e=R?.coins?.mult;if(!e||typeof e.get!="function"){to=null,Ai=!1;return}let t=e.get();if(!t){to=c.fromInt(1),Ai=!1;return}to=t.clone?.()??c.fromAny(t),Ai=!!to?.isInfinite?.()}catch{to=null,Ai=!1}},qv=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}to||$v();let n=to;if(!n)try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(Ai||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},Gv=e=>{if(!Ml)return null;if(_u){if(Vs)try{return Vs.clone?.()??Vs}catch{return Vs}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=ki.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{ki.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=zs(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(KE)===0,s=r.clone?.()??r;if(ki.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function ox(e){if(e==null)return 0;try{let t=localStorage.getItem(Yv(e));return t?parseInt(t,10):0}catch{return 0}}function rx(e,t){if(e!=null)try{localStorage.setItem(Yv(e),t.toString())}catch{}}function ix(e){if(e==null)return 0;try{let t=localStorage.getItem(Wv(e));return t?parseInt(t,10):0}catch{return 0}}function sx(e,t){if(e!=null)try{localStorage.setItem(Wv(e),t.toString())}catch{}}function ax(e){if(e==null)return 0;try{let t=localStorage.getItem(zv(e));return t?parseInt(t,10):0}catch{return 0}}function lx(e,t){if(e!=null)try{localStorage.setItem(zv(e),t.toString())}catch{}}function cx(e){if(e==null)return 0;try{let t=localStorage.getItem(Kv(e));return t?parseInt(t,10):0}catch{return 0}}function ux(e,t){if(e!=null)try{localStorage.setItem(Kv(e),t.toString())}catch{}}function jv(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let p=Number(e.toString());isNaN(p)||(t=p),(e==="Infinity"||p===1/0)&&(n=!0)}catch{}let o=b(),r=ox(o),i=r;i<1&&n&&(i=1),i<2&&it(4)>=1&&(i=2),i!==r&&(r=i,rx(o,r));let s=ix(o),l=s;l<1&&it(4)>=1&&(l=1),l!==s&&(s=l,sx(o,s));let a=ax(o),u=a;u<1&&it(4)>=1&&(u=1),u!==a&&(a=u,lx(o,a));let f=cx(o),d=f;d<1&&it(4)>=1&&(d=1),d!==f&&(f=d,ux(o,f));let m=[],y=[];for(let p of Vv){let h=p;if(n){h={...p,description:[...p.description]};let g=kn(),v=Zn(),w=g+v;if(w>1&&(w=1),p.id===1){let x=Math.pow(10,w),C=Te(x);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${C}x</span>`)}else if(p.id===2){let x=Math.pow(10,w),C=Te(x);h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${C}x</span>`)}else if(p.id===4){let x=Math.log10(4444e9),C=ie(x*w),k=K(C);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${k}x</span>`)}else if(p.id===14){let x=Math.log10(1414e16),C=ie(x*w),k=K(C);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${k}x</span>`)}else if(p.id===17){let k=ie(15*w),q=ie(5*w),P=K(k),G=K(q);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${G}x</span>`),h.description[2]=h.description[2].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${G}x</span>`)}else if(p.id===18){let k=ie(15*w),q=ie(5*w),P=K(k),G=K(q);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${G}x</span>`),h.description[2]=h.description[2].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${G}x</span>`)}}if(p.id===9&&(h===p&&(h={...p,description:[...p.description]}),r===0?h.description=["This milestone is hidden for now"]:r===1&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===10&&(h===p&&(h={...p,description:[...p.description]}),s===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===13){h===p&&(h={...p,description:[...p.description]});let v=dt()*1.5-.5,w=Math.pow(100,v),x=Te(w);h.description[0]=`Activates generator: Passively generates <span style="color:#00e5ff">${x}%</span> of pending Gold every second`}if(p.id===14&&(h===p&&(h={...p,description:[...p.description]}),a===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===15)if(h===p&&(h={...p,description:[...p.description]}),f===0)h.description=["This milestone is hidden until you research Lab Node 4"];else{let g=Wc(!0),v=Te(g);h.description[0]=`Unspent DNA boosts Coins: <span style="color:#00e5ff">${v}x</span>`;let w=ll(!0),x=Te(w);h.description.push(`Unspent DNA also divides the value of Coins and the value of Magic by <span style="color:#00e5ff">${x}x</span>`)}if(p.id===16){h===p&&(h={...p,description:[...p.description]});let v=dt()*1.5-.5,w=Math.pow(100,v),x=Te(w);h.description[0]=`Activates generator: Passively generates <span style="color:#00e5ff">${x}%</span> of pending Magic every second`}p.surgeLevel<=t?m.push(h):y.push(h)}return[...m,...y.slice(0,2)]}var Vv,Vp,Yv,Wv,zv,Kv,Zv=Ue(()=>{qt();xt();xt();hn();Zo();St();Vv=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${K(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade","Makes each Workshop Level triple Gear production instead of doubling it"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]},{id:10,surgeLevel:10,description:["Unlocks new DNA upgrades"]},{id:11,surgeLevel:11,description:["Unlocks a new automation upgrade","Makes each Workshop Level quadruple Gear production instead of tripling it"]},{id:12,surgeLevel:12,affectedByTsunami:!0,description:["Adequately boosts the effect Lab Level has on RP multiplier"]},{id:13,surgeLevel:13,affectedByTsunami:!0,description:['Activates generator: Passively generates <span style="color:#00e5ff">0.1%</span> of pending Gold every second']},{id:14,surgeLevel:14,affectedByTsunami:!0,description:[`Multiplies DNA value by <span style="color:#00e5ff">${K(c.fromInt(1414e16))}x</span>`,"Unlocks Combo: Collecting Coins increases a Combo which alleviates the exponent effect on larger Coins (beware, Combo decays)","Combo effect is shown in the Coin Counter"]},{id:15,surgeLevel:15,affectedByTsunami:!0,description:['Unspent DNA boosts Coins: <span style="color:#00e5ff">1x</span>']},{id:16,surgeLevel:16,affectedByTsunami:!0,description:['Activates generator: Passively generates <span style="color:#00e5ff">0.1%</span> of pending Magic every second']},{id:17,surgeLevel:17,affectedByTsunami:!0,description:[`Multiplies Magic value by <span style="color:#00e5ff">${K(c.fromInt(1e15))}x</span>`,`Divides Coin value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,`Divides DNA value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,"Halves Wave value (immune to exponent)"]},{id:18,surgeLevel:18,affectedByTsunami:!0,description:[`Multiplies Coin value by <span style="color:#00e5ff">${K(c.fromInt(1e15))}x</span>`,`Divides Magic value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,`Divides DNA value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,"Halves Wave value (immune to exponent)"]},{id:19,surgeLevel:19,description:["Unlocks a new DNA upgrade","Doubles XP value (immune to exponent)"]}],Vp=Vv.filter(e=>e.affectedByTsunami).map(e=>e.id),Yv=e=>`ccc:surge:milestone9:state:${e}`,Wv=e=>`ccc:surge:milestone10:state:${e}`,zv=e=>`ccc:surge:milestone14:state:${e}`,Kv=e=>`ccc:surge:milestone15:state:${e}`});function Jv(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ft("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(E,j){E.style.position="absolute",E.style.left="50%";let Z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ye=!!o.mpHTML;j==="coin"?(E.style.top="77%",E.style.transform=`translateX(-50%) ${Z}`):oe&&ye?(E.style.top="72.5%",j==="mp"?E.style.transform=`translateX(calc(-100% - 44px)) ${Z}`:E.style.transform=`translateX(44px) ${Z}`):(j==="mp"?E.style.top="66%":j==="xp"&&(E.style.top="72%"),E.style.transform=`translateX(-50%) ${Z}`),E.style.transformOrigin="center center";let ue=E.firstElementChild;ue&&(ue.removeAttribute("hidden"),ue.style.display="flex")}if(o.coinHTML){let E=document.createElement("div");E.innerHTML=o.coinHTML,f(E,"coin"),u.appendChild(E)}if(o.xpHTML){let E=document.createElement("div");E.innerHTML=o.xpHTML,f(E,"xp"),u.appendChild(E)}if(o.mpHTML){let E=document.createElement("div");E.innerHTML=o.mpHTML,f(E,"mp"),u.appendChild(E)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let m=new Image;m.src="img/misc/merchant.webp";let y=!1;m.onload=()=>{y=!0},m.onerror=E=>{console.error("Tsunami: Merchant load failed",E)};let p,h,g=[],v=[],w=0;function x(){g=[],v=[];let E=h*.65,j=E+h*.15,oe=300*(Math.min(p,h)*5e-4),ye=p*.8,ue=ye-oe*.6,We=ye+oe*.6;for(let mt=0;mt<100;mt++){let un=Math.random()*p,Xn=j+Math.random()*(h-j);v.push({x:un,y:Xn})}let ot=(mt,un,Xn)=>{if(mt>p*.1&&mt<p*.9){let Ut=h-E,xn=E+Ut*.15;if(un>xn)return!1}else if(Xn==="tree"){let Ut=h-E,xn=E+Ut*.5;if(un>xn)return!1}return!(Xn==="tree"&&mt>ue&&mt<We)},Se=(mt,un,Xn,Ut,xn)=>{for(let Kr=0;Kr<un;Kr++){let $o,qo,yr=!1,Ne=0;for(;!yr&&Ne<50;){xn?$o=xn():$o=Math.random()*p;let I=h,A=Math.random();if(qo=E+20+A*A*(I-E-20),ot($o,qo,mt)&&(yr=!0,mt==="tree")){for(let O of g)if(O.type==="tree"){let N=O.x-$o,B=O.y-qo;if(Math.sqrt(N*N+B*B)<Math.max(p*.08,100)){yr=!1;break}}}Ne++}if(yr){let A=.6+(qo-E)/(h-E)*.6,O=(Xn+Math.random()*Ut)*A;g.push({type:mt,x:$o,y:qo,scale:O})}}},Ge=3+Math.floor(Math.random()*3);Se("tree",Ge,.8,.4,()=>Math.random()*(p*.1)),Se("tree",Ge,.8,.4,()=>p*.9+Math.random()*(p*.1));let Yt=5+Math.floor(Math.random()*3);Se("tree",Yt,.8,.4,()=>p*.1+Math.random()*(p*.8)),Se("rock",20,.6,.4),Se("shell",30,.3,.3),g.sort((mt,un)=>mt.y-un.y)}let C=a.getContext("2d",{alpha:!1}),k=d.getContext("2d",{alpha:!0});function q(){let E=window.devicePixelRatio||1;p=window.innerWidth,h=window.innerHeight,a.width=p*E,a.height=h*E,a.style.width=p+"px",a.style.height=h+"px",d.width=p*E,d.height=h*E,d.style.width=p+"px",d.style.height=h+"px",C.scale(E,E),k.scale(E,E),x(),w=-50}window.addEventListener("resize",q),q();let P=Date.now(),G=!0,M,D=!1,T={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},Y=!1,Q=[],ae=0,he=!1,be=0,Oe=5e3,Ae=!1,F=0,W=[],$=6;for(let E=0;E<$;E++)W.push({offset:Math.random()*1e3,speedBase:.001+E*5e-4,amplitudeBase:10+E*5});let X=[],J=400;function le(E,j,Z){return E*(1-Z)+j*Z}function fe(E){let j=parseInt(E.slice(1),16);return{r:j>>16&255,g:j>>8&255,b:j&255}}function L(E,j,Z){let oe=fe(E),ye=fe(j),ue=Math.round(le(oe.r,ye.r,Z)),We=Math.round(le(oe.g,ye.g,Z)),ot=Math.round(le(oe.b,ye.b,Z));return`rgb(${ue},${We},${ot})`}function H(E,j,Z){let oe=[],ye=E,ue=j,We=20;for(;ue<Z;){let ot=ye+(Math.random()-.5)*60,Se=ue+We+Math.random()*30;oe.push({x1:ye,y1:ue,x2:ot,y2:Se}),ye=ot,ue=Se}return oe}function z(E,j,Z,oe,ye,ue){E.beginPath(),E.moveTo(j+ue,Z),E.lineTo(j+oe-ue,Z),E.quadraticCurveTo(j+oe,Z,j+oe,Z+ue),E.lineTo(j+oe,Z+ye-ue),E.quadraticCurveTo(j+oe,Z+ye,j+oe-ue,Z+ye),E.lineTo(j+ue,Z+ye),E.quadraticCurveTo(j,Z+ye,j,Z+ye-ue),E.lineTo(j,Z+ue),E.quadraticCurveTo(j,Z,j+ue,Z),E.closePath()}function de(E,j,Z,oe,ye){E.save(),E.translate(j,Z),E.scale(oe,oe),E.beginPath(),E.moveTo(0,0),E.quadraticCurveTo(10,-40,-5,-80),E.lineTo(5,-80),E.quadraticCurveTo(20,-40,10,0),E.fillStyle=ye.rock,E.fill(),E.translate(0,-80),E.fillStyle=ye.leaf;for(let ue=0;ue<7;ue++)E.save(),E.rotate(ue/7*Math.PI*2-Math.PI/2),E.beginPath(),E.moveTo(0,0),E.quadraticCurveTo(30,-10,60,0),E.quadraticCurveTo(30,10,0,0),E.fill(),E.restore();E.restore()}function ee(E,j,Z,oe,ye){E.save(),E.translate(j,Z),E.scale(oe,oe),E.fillStyle=ye.rock,E.beginPath(),E.moveTo(-20,0),E.bezierCurveTo(-20,-15,-10,-25,0,-25),E.bezierCurveTo(10,-25,20,-15,20,0),E.fill(),E.fillStyle="rgba(0,0,0,0.2)",E.beginPath(),E.ellipse(0,0,20,5,0,0,Math.PI*2),E.fill(),E.restore()}function re(E,j,Z,oe,ye){E.save(),E.translate(j,Z),E.scale(oe,oe),E.fillStyle=ye.shell,E.beginPath(),E.arc(0,0,10,Math.PI,0),E.lineTo(0,0),E.fill(),E.strokeStyle=ye.sandDark,E.lineWidth=1,E.beginPath();for(let ue=1;ue<5;ue++){let We=Math.PI+ue/5*Math.PI;E.moveTo(0,0),E.lineTo(Math.cos(We)*10,Math.sin(We)*10)}E.stroke(),E.restore()}function ge(E,j,Z,oe,ye){E.fillStyle=ye.sandDark,E.fillRect(-50,oe,j+100,Z-oe),E.fillStyle=ye.sandDark,E.save(),E.fillStyle=ye.sandLight,E.globalAlpha=.3,E.beginPath(),E.moveTo(-50,Z+100),E.lineTo(-50,oe),E.bezierCurveTo(j*.3,oe-20,j*.7,oe+20,j+50,oe),E.lineTo(j+50,Z+100),E.fill(),E.globalAlpha=.6;let ue=oe+Z*.05;E.beginPath(),E.moveTo(-50,Z+100),E.lineTo(-50,ue),E.bezierCurveTo(j*.4,ue+40,j*.6,ue-10,j+50,ue+20),E.lineTo(j+50,Z+100),E.fill(),E.globalAlpha=1;let We=oe+Z*.15;E.beginPath(),E.moveTo(-50,Z+100),E.lineTo(-50,We),E.bezierCurveTo(j*.2,We-10,j*.8,We+30,j+50,We+10),E.lineTo(j+50,Z+100),E.fill(),E.fillStyle=ye.sandDark,E.globalAlpha=.1,v.forEach(ot=>{E.fillRect(ot.x,ot.y,2,2)}),E.restore()}function Be(E,j,Z,oe=null){let ye=oe||1,ue=!!oe&&oe>5;Y&&!ue&&!Ae&&ft("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),Q.push({x:ue?j/2:Math.random()*j,y:ue?Z/2:Math.random()*Z,radius:0,maxRadius:ue?Math.max(j,Z)*1.5:(100+Math.random()*400)*ye,speed:ue?40:(5+Math.random()*15)*ye,opacity:1,hue:225+Math.random()*15,life:1})}function ne(E,j,Z,oe=.5,ye=!0){let ue=.1+oe*.7,We=Math.floor(1+oe*4);if(ye&&!Ae){for(let ot=0;ot<We;ot++)if(Q.length<50&&Math.random()<ue){let Se=1+oe*2;Be(E,j,Z,Se)}}E.save(),E.globalCompositeOperation="lighter";for(let ot=Q.length-1;ot>=0;ot--){let Se=Q[ot];if(Se.radius+=Se.speed,Se.opacity-=.015,Se.life-=.015,Se.opacity<=0||Se.radius>Se.maxRadius){Q.splice(ot,1);continue}let Ge=E.createRadialGradient(Se.x,Se.y,0,Se.x,Se.y,Se.radius),Yt=Se.opacity;Ge.addColorStop(0,`hsla(${Se.hue}, 100%, 80%, ${Yt})`),Ge.addColorStop(.3,`hsla(${Se.hue}, 100%, 40%, ${Yt*.9})`),Ge.addColorStop(.7,`hsla(${Se.hue}, 100%, 15%, ${Yt*.6})`),Ge.addColorStop(1,`hsla(${Se.hue}, 100%, 5%, 0)`),E.fillStyle=Ge,E.beginPath(),E.arc(Se.x,Se.y,Se.radius,0,Math.PI*2),E.fill()}E.restore()}function ve(){if(!G)return;let E=Date.now(),j=E-P;Math.min(j/t,1)>=1&&!D&&(D=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ye=6e3,ue=5e4,We=5e4,ot=5e3,Se=4e4,Ge=0;j<ye?Ge=0:j<ue?Ge=(j-ye)/(ue-ye):Ge=1;let Yt=0;j>Se&&(Yt=Math.max(0,(j-Se)/(ue-Se))),j>ue&&(Yt=1),Yt>.1&&!i&&(i=ft("sounds/tsu_rumble.ogg",{volume:.8}));let mt={skyTop:L(T.skyTop,_.skyTop,Ge),skyBottom:L(T.skyBottom,_.skyBottom,Ge),sun:L(T.sun,_.sun,Ge),waterDeep:L(T.waterDeep,_.waterDeep,Ge),waterMid:L(T.waterMid,_.waterMid,Ge),waterPeak:L(T.waterPeak,_.waterPeak,Ge),foam:L(T.foam,_.foam,Ge),sandLight:L(T.sandLight,_.sandLight,Ge),sandDark:L(T.sandDark,_.sandDark,Ge),rock:L(T.rock,_.rock,Ge),leaf:L(T.leaf,_.leaf,Ge),shell:L(T.shell,_.shell,Ge)},un=0,Xn=0;if(Ge>.5||Ae){let Ne=(Ge-.5)*2*5+Yt*25;F>0&&(Ne+=50),un=(Math.random()-.5)*Ne,Xn=(Math.random()-.5)*Ne}k.clearRect(0,0,p,h),C.save(),C.translate(un,Xn),k.save(),k.translate(un,Xn);let Ut=C.createLinearGradient(0,0,0,h);if(Ut.addColorStop(0,mt.skyTop),Ut.addColorStop(1,mt.skyBottom),C.fillStyle=Ut,C.fillRect(-50,-50,p+100,h+100),Ge<1){let Ne=h*.15+Ge*50;C.beginPath(),C.arc(p*.7,Ne,40,0,Math.PI*2),C.fillStyle=mt.sun,C.globalAlpha=1-Ge,C.shadowColor=mt.sun,C.shadowBlur=20,C.fill(),C.globalAlpha=1,C.shadowBlur=0}let xn=h*.65;if(y&&Ge<1){C.save();let Ne=Math.min(p,h)*5e-4,I=300*Ne,A=300*Ne,O=p*.8,N=A*.15,B=xn-A/2+N;C.translate(O,B),C.rotate(.1),C.drawImage(m,-I/2,-A/2,I,A),C.restore()}if(ge(C,p,h,xn,mt),g.forEach(Ne=>{Ne.type==="tree"?de(C,Ne.x,Ne.y,Ne.scale,mt):Ne.type==="rock"?ee(C,Ne.x,Ne.y,Ne.scale,mt):Ne.type==="shell"&&re(C,Ne.x,Ne.y,Ne.scale,mt)}),Ge>.3){let Ne=(Ge-.3)/.7,I=Math.floor(J*Ne);if(k.strokeStyle=`rgba(120, 180, 255, ${.1+Ne*.3})`,k.lineWidth=1+Ne,k.beginPath(),X.length<I)for(let O=0;O<10;O++)X.push({x:Math.random()*p*1.5,y:w,speed:20+Math.random()*20,len:10+Math.random()*20});let A=10+Ne*20;for(let O=0;O<X.length;O++){let N=X[O];N.y+=N.speed,N.x-=A,k.moveTo(N.x,N.y),k.lineTo(N.x-A*.5,N.y+N.len),(N.y>h||N.x<-100)&&(O<I?(N.x=Math.random()*p*1.5,N.y=w):(X.splice(O,1),O--))}k.stroke()}let Kr=.3;if(Ge>Kr){let Ne=(Ge-Kr)/(1-Kr),I=le(0,h*1.5,Ne*Ne);k.fillStyle=mt.waterDeep,k.beginPath(),k.moveTo(-50,h+100),k.lineTo(-50,h-I*.3),k.bezierCurveTo(p*.3,h-I*.4,p*.6,h-I*1.2,p+50,h-I*.8),k.lineTo(p+50,h+100),k.fill()}let $o=le(0,h*.5,Ge),qo=le(0,h*1.5,Yt*Yt),yr=h*.85-$o-qo;if(W.forEach((Ne,I)=>{let A;I===$-1?A=mt.waterPeak:I%2===0?A=mt.waterDeep:A=mt.waterMid,k.fillStyle=A,k.beginPath();let O=Ne.amplitudeBase*(1+Ge*2+Yt*5),N=.003+Ge*.005,B=Ne.speedBase*(1+Ge*5+Yt*10),pe=j*B+Ne.offset,me=I*15*(1-Yt),Le=yr+me;k.moveTo(-50,h+100),k.lineTo(-50,Le);for(let Me=-50;Me<=p+50;Me+=15){let Ke=Le+Math.sin(Me*N+pe)*O+Math.cos(Me*N*2.3+pe)*(O*.5);k.lineTo(Me,Ke)}if(k.lineTo(p+50,h+100),k.fill(),I===$-1||Ge>.6&&I>$-3){k.save(),k.globalAlpha=.1+Ge*.3,k.fillStyle=mt.foam,k.beginPath();for(let Me=-50;Me<=p+50;Me+=10){let Ke=Le+Math.sin(Me*N+pe)*O+Math.cos(Me*N*2.3+pe)*(O*.5);Math.random()>.5&&(Ke-=5),Me===-50?k.moveTo(Me,Ke):k.lineTo(Me,Ke)}k.lineTo(p+50,h+100),k.lineTo(-50,h+100),k.fill(),k.restore()}}),j<oe){let Ne=1;j>1e3&&(Ne=1-(j-1e3)/(oe-1e3)),k.fillStyle=`rgba(0, 0, 0, ${Ne})`,k.fillRect(-50,-50,p+100,h+100)}if(j>We){let Ne=Math.min(1,(j-We)/ot);k.fillStyle=`rgba(0, 0, 0, ${Ne})`,k.fillRect(-50,-50,p+100,h+100)}if(Y){let Ne=E-ae,I=12e3,A=0,O=!0;Ne<I?A=Ne/I:(A=1,Ae||(Ae=!0,Be(k,p,h,25),F=60,l||(l=!0,ft("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),he&&(O=!1),ne(k,p,h,A,O)}if(he){let Ne=E-be,I=Math.min(1,Ne/Oe);k.fillStyle=`rgba(0, 0, 0, ${I})`,k.fillRect(-50,-50,p+100,h+100)}if(F>0){let Ne=F/60,I=Ne*Ne;k.fillStyle=`rgba(255, 255, 255, ${I})`,k.fillRect(-50,-50,p+100,h+100),F--}C.restore(),k.restore(),M=requestAnimationFrame(ve)}function De(){G=!1,e.style.cursor="",M&&cancelAnimationFrame(M),window.removeEventListener("resize",q),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function ke(){Y=!0,ae=Date.now(),Ae=!1,F=0,s||(s=ft("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Fe(){he=!0,be=Date.now(),s&&s.stop()}function ce(){e.style.cursor=""}function te(){e.style.cursor="none"}function xe(){s&&(s.stop(),s=null)}return ve(),{cleanup:De,triggerBeacons:ke,triggerFinalFade:Fe,showCursor:ce,hideCursor:te,stopHumLoop:xe}}var Qv=Ue(()=>{Ln()});var R0={};bt(R0,{canPerformForgeReset:()=>C0,canPerformInfuseReset:()=>T0,computeForgeGoldFromInputs:()=>_s,computeInfuseMagicFromInputs:()=>Ms,computePendingDnaFromInputs:()=>g0,computePendingForgeGold:()=>M0,computeSurgeWavesFromInputs:()=>h0,getCurrentSurgeLevel:()=>Qn,getForgeDebugOverrideState:()=>b0,getInfuseDebugOverrideState:()=>I0,getSurgeBarLevelKey:()=>Ks,getSurgeDebugOverrideState:()=>x0,hasDoneExperimentReset:()=>_0,hasDoneForgeReset:()=>Fr,hasDoneInfuseReset:()=>Gt,hasDoneSurgeReset:()=>ko,initResetPanel:()=>Ep,initResetSystem:()=>Wo,isExperimentUnlocked:()=>Dl,isForgeUnlocked:()=>$s,isInfuseUnlocked:()=>qu,isSurgeUnlocked:()=>$r,onForgeUpgradeUnlocked:()=>Em,onInfuseUpgradeUnlocked:()=>xm,onSurgeUpgradeUnlocked:()=>Lm,performForgeReset:()=>ym,performInfuseReset:()=>vm,performSurgeReset:()=>bm,recomputePendingMagic:()=>yn,setExperimentResetCompleted:()=>cm,setForgeDebugOverride:()=>S0,setForgeResetCompleted:()=>sm,setInfuseDebugOverride:()=>E0,setInfuseResetCompleted:()=>am,setInfuseUnlockedForDebug:()=>w0,setSurgeResetCompleted:()=>lm,setSurgeUnlockedForDebug:()=>L0,shouldBlockBigCoins:()=>Bl,updateResetPanel:()=>qe});function Jp(e){return!bx.includes(e)}function Sx(){ft(hx,{volume:.4})}function Ix(){ft(gx,{volume:.45})}function wx(){ft(yx,{volume:.5})}function Ex(){ft(vx,{volume:.8})}function Bl(){return f0}function d0(){let e=Dn(),t=R.waves?.value??at(),n=0n;try{n=Ul(e)}catch{}let o=S.pendingWaves,r=wm(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),f0=i&&!gn()}function Ol(){zp=null}function Bu(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function Fu(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function Kp(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function rm(e=null){try{let t=vi(),n=S.pendingGold.clone?.()??S.pendingGold;if(e){let o=e instanceof Tt?e:Tt.fromAny(e??1);if(o.isInfinite?.())return Tt.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=R.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return S.pendingGold}}function _x(){for(;no.length;){let e=no.pop();try{e?.()}catch{}}}function Wp(){!o0&&typeof mc=="function"&&(o0=mc((e={})=>{e?.key&&e.key!==Re.COINS&&e.key!==Re.WAVES||e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(e?.key===Re.WAVES?(Gu(),qe()):(vn(),yn(),Fn()))})),!r0&&typeof Lc=="function"&&(r0=Lc((e={})=>{e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(vn(),Fn(),Po(),qe())}))}function im(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=we(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Fl(){try{let e=Qe();if(e&&e.xpLevel)return e.xpLevel}catch{}return at()}function p0(e,t){if(!e||typeof e!="object")return at();let n=we(e);if(!Number.isFinite(n)&&n>0)return Tt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return at();let r=ie(o*Math.log10(2)),i=Math.max(0,im(t)),s=Math.max(0,(i-30)/5),l=s<=0?e0():ie(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?e0():ie(a*Math.log10(1.15)),f=Tt.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?at():d}function Mx(e,t){if(!e)return at();let n=we(e);if(!Number.isFinite(n)&&n>0)return Tt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let y=we(t);Number.isFinite(y)&&(a=Math.max(0,y-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,m=r+u+f+d;return Number.isFinite(m)?ie(m).floorToInteger():Tt.fromAny("Infinity")}function m0(e,t,n=null){let o=Mx(e,t),r=Hd(),i;if(n){let s=n instanceof Tt?n:Tt.fromAny(n??1);if(s.isInfinite?.())return Tt.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=R.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function _s(e,t){return p0(e,t)}function Ms(e,t){return m0(e,t)}function h0(e,t,n,o,r){return y0(e,t,n,o,r)}function g0(e,t,n=null){e||(e=at()),t||(t=at());let o=.30103,r=0;if(n!==null?!!n:se(9)){let l=dt();o=Math.log10(2+l*.5),r=30*l}if(se(14))if(se(8)){let l=dt(),a=Math.log10(1414e16);r+=a*l}else r+=Math.log10(1414e16);if(se(17))if(se(8)){let l=dt();r-=5*l}else r-=5;if(se(18))if(se(8)){let l=dt();r-=5*l}else r-=5;let s=o.toFixed(18);try{let l=e.mulDecimal(s,18),u=t.div(c.fromInt(20)).mulDecimal(s,18),f=l.add(u);r>0&&(f=f.add(c.fromAny(r)));let d=0;return f.isInfinite()?d=1/0:d=Number(f.toScientific(10)),ie(d).floorToInteger()}catch{return at()}}function y0(e,t,n,o,r){let i=im(e);if(i<201)return at();let s=(i-201)/35,l=we(t),a=we(n),u=we(o),f=we(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return Tt.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*Tu),Number.isFinite(a)&&a>13&&(d+=(a-13)*Tu),Number.isFinite(u)&&u>5&&(d+=(u-5)*Tu),Number.isFinite(f)&&f>12&&(d+=(f-12)*Tu);let m=1+d+s;if(se(17)&&(m-=Math.log10(2)),se(18)&&(m-=Math.log10(2)),!Number.isFinite(m))return Tt.fromAny("Infinity");let y=ie(m).floorToInteger();return R.waves?.mult?.applyTo?.(y)??y}function v0(){return Math.max(0,im(Fl()))}function Dn(){if(S.slot!=null)return S.slot;let e=b();return S.slot=e,e}function sm(e){let t=Dn();if(t!=null){S.hasDoneForgeReset=!!e;try{localStorage.setItem(Qp(t),S.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function am(e){let t=Dn();if(t!=null){S.hasDoneInfuseReset=!!e;try{localStorage.setItem(em(t),S.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function lm(e){let t=Dn();if(t!=null){S.hasDoneSurgeReset=!!e;try{localStorage.setItem(tm(t),S.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function cm(e){let t=Dn();if(t!=null){S.hasDoneExperimentReset=!!e;try{localStorage.setItem(om(t),S.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function $u(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Nl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function b0(e=b()){return $u(e)}function S0(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.forgeDebugOverride!==n){if(S.forgeDebugOverride=n,n==null)try{localStorage.removeItem(Nl(t))}catch{}else try{localStorage.setItem(Nl(t),n?"1":"0")}catch{}ct(Nl(t)),Bu(),qe()}}function um(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Rl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function I0(e=b()){return um(e)}function w0(e){fm(e)}function E0(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.infuseDebugOverride!==n){if(S.infuseDebugOverride=n,n==null)try{localStorage.removeItem(Rl(t))}catch{}else try{localStorage.setItem(Rl(t),n?"1":"0")}catch{}ct(Rl(t)),Fu(),qe()}}function fm(e){let t=Dn();if(t==null)return;let n=!!e;if(S.infuseUnlocked!==n){S.infuseUnlocked=n;try{localStorage.setItem(Ou(t),S.infuseUnlocked?"1":"0")}catch{}ct(Ou(t)),Fu()}}function Du(e){let t=Dn();if(t==null)return;let n=!!e;if(S.forgeUnlocked!==n){S.forgeUnlocked=n;try{localStorage.setItem(Ru(t),S.forgeUnlocked?"1":"0")}catch{}ct(Ru(t)),Bu()}}function dm(e=b()){if(e==null)return null;try{let t=localStorage.getItem(u0(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function x0(e=b()){return dm(e)}function L0(e){pm(e)}function pm(e){let t=Dn();if(t==null)return;let n=!!e;if(S.surgeUnlocked!==n){S.surgeUnlocked=n;try{localStorage.setItem(Pu(t),S.surgeUnlocked?"1":"0")}catch{}ct(Pu(t)),Kp()}}function jp(e){if(e==null){S.forgeUnlocked=!1,S.forgeDebugOverride=null,S.hasDoneForgeReset=!1,S.infuseUnlocked=!1,S.infuseDebugOverride=null,S.hasDoneInfuseReset=!1,S.surgeUnlocked=!1,S.surgeDebugOverride=null,S.hasDoneSurgeReset=!1,S.hasDoneExperimentReset=!1,S.flagsPrimed=!1;return}try{S.forgeUnlocked=localStorage.getItem(Ru(e))==="1"}catch{S.forgeUnlocked=!1}S.forgeDebugOverride=$u(e);try{S.hasDoneForgeReset=localStorage.getItem(Qp(e))==="1"}catch{S.hasDoneForgeReset=!1}try{S.infuseUnlocked=localStorage.getItem(Ou(e))==="1"}catch{S.infuseUnlocked=!1}try{S.hasDoneInfuseReset=localStorage.getItem(em(e))==="1"}catch{S.hasDoneInfuseReset=!1}S.infuseDebugOverride=um(e);try{S.surgeUnlocked=localStorage.getItem(Pu(e))==="1"}catch{S.surgeUnlocked=!1}S.surgeDebugOverride=dm(e);try{S.hasDoneSurgeReset=localStorage.getItem(tm(e))==="1"}catch{S.hasDoneSurgeReset=!1}try{S.hasDoneExperimentReset=localStorage.getItem(om(e))==="1"}catch{S.hasDoneExperimentReset=!1}S.flagsPrimed=!0}function wo(){let e=b();if(e==null){S.flagsPrimed=!1;return}S.slot!==e&&(S.slot=e,Ol(),S.flagsPrimed=!1),S.flagsPrimed||jp(e)}function i0(e){t0!==e&&(_x(),t0=e,e!=null&&(no.push(At(Ru(e),{onChange(t){let n=t==="1";S.forgeUnlocked!==n&&(S.forgeUnlocked=n,Bu(),qe())}})),no.push(At(Qp(e),{onChange(t){let n=t==="1";S.hasDoneForgeReset!==n&&(S.hasDoneForgeReset=n,qe())}})),no.push(At(Nl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.forgeDebugOverride!==n&&(S.forgeDebugOverride=n,Bu(),qe())}})),no.push(At(Ou(e),{onChange(t){let n=t==="1";S.infuseUnlocked!==n&&(S.infuseUnlocked=n,Fu(),qe())}})),no.push(At(em(e),{onChange(t){let n=t==="1";S.hasDoneInfuseReset!==n&&(S.hasDoneInfuseReset=n,qe())}})),no.push(At(Rl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.infuseDebugOverride!==n&&(S.infuseDebugOverride=n,Fu(),qe())}})),no.push(At(Pu(e),{onChange(t){let n=t==="1";S.surgeUnlocked!==n&&(S.surgeUnlocked=n,Kp(),qe())}})),no.push(At(u0(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.surgeDebugOverride!==n&&(S.surgeDebugOverride=n,Kp(),qe())}})),no.push(At(tm(e),{onChange(t){let n=t==="1";S.hasDoneSurgeReset!==n&&(S.hasDoneSurgeReset=n,qe())}})),no.push(At(om(e),{onChange(t){let n=t==="1";S.hasDoneExperimentReset!==n&&(S.hasDoneExperimentReset=n,qe())}}))))}function Cx(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function vn(e=!1){let t=R.coins?.value??at(),n=Fl(),o=Cx(t,n);!e&&zp===o||(zp=o,mm()?S.pendingGold=p0(t,n):S.pendingGold=at(),qe())}function yn(e=null){let t=R.coins?.value??at(),n=tr();hm()?S.pendingMagic=m0(t,n,e):S.pendingMagic=at(),Fn(),qe()}function Fn(){if(!$r()){S.pendingWaves=at(),Po();return}let e=Fl(),t=R.coins?.value??at(),n=R.gold?.value??at(),o=R.magic?.value??at(),r=tr();S.pendingWaves=y0(e,t,n,o,r),ko()||S.pendingWaves.cmp(Tt.fromInt(10))>0&&(S.pendingWaves=Tt.fromInt(10)),Po(),d0()}function Po(){if(!Dl()){S.pendingDna=at();return}let e=.30103,t=0;if(se(9)){let i=dt();e=Math.log10(2+i*.5),t=30*i}if(se(14))if(se(8)){let i=dt(),s=Math.log10(1414e4);t+=s*i}else t+=Math.log10(1414e4);if(se(17))if(se(8)){let i=dt();t-=5*i}else t-=5;if(se(18))if(se(8)){let i=dt();t-=5*i}else t-=5;let n=e.toFixed(18),o=Jt?Jt():at(),r=Fl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),S.pendingDna=ie(u).floorToInteger()}catch{try{S.pendingDna=at()}catch{S.pendingDna=at()}}}function Zp(){let e=$u();return e!=null?!!e:S.forgeUnlocked||kt(Ee.STARTER_COVE,_e.UNLOCK_FORGE)>=1}function mm(){try{let e=Fl();if(e&&typeof e.cmp=="function")return e.cmp(xx)>=0}catch{}return!1}function hm(){try{let e=gt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(Lx)>=0}catch{}return!1}function $s(){wo();let e=$u();return e!=null?!!e:!!S.forgeUnlocked||Zp()}function qu(){wo();let e=um();return e!=null?!!e:!!S.infuseUnlocked}function $r(){wo();let e=dm();return e!=null?!!e:!!S.surgeUnlocked}function Dl(){return my()}function Qn(){let e=Dn();return e==null?0n:Ul(e)}function Fr(){return wo(),!!S.hasDoneForgeReset}function Gt(){return wo(),!!S.hasDoneInfuseReset}function ko(){return wo(),!!S.hasDoneSurgeReset}function _0(){return wo(),!!S.hasDoneExperimentReset}function M0(){return vn(),S.pendingGold.clone?.()??S.pendingGold}function C0(){return!(!$s()||!mm()||S.pendingGold.isZero?.())}function T0(){return!(!qu()||!hm()||S.pendingMagic.isZero?.())}function Tx({resetGold:e=!1,resetMagic:t=!1}={}){let n=Ct(Ee.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===_e.UNLOCK_XP||r===_e.UNLOCK_FORGE||r===_e.UNLOCK_INFUSE||r===_e.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||cr(Ee.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function gm({resetGold:e=!1,resetMagic:t=!1}={}){try{R.coins.set(0)}catch{}try{R.books.set(0)}catch{}try{ss({keepUnlock:!0})}catch{}try{Xp()}catch{}Tx({resetGold:e,resetMagic:t})}function ym(){if(!C0())return!1;let e=rm();try{R.gold?.add&&R.gold.add(e)}catch{}if(gm({resetGold:!1}),vn(),Du(!0),S.hasDoneForgeReset||sm(!0),tn(),Ur(),Jp("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return qe(),!0}function vm(){if(!T0())return!1;let e=S.pendingMagic.clone?.()??S.pendingMagic;try{R.magic?.add&&R.magic.add(e)}catch{}gm({resetGold:!0});try{R.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),tn({forceReload:!0})}catch{}if(vn(),yn(),Jp("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return fm(!0),S.hasDoneInfuseReset||am(!0),qe(),!0}function Uu(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Dn();try{R.waves?.add&&e&&!e.isZero?.()&&R.waves.add(e)}catch{}gm({resetGold:!0,resetMagic:!0});try{R.gold.set(0)}catch{}try{R.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),tn({forceReload:!0})}catch{}if(Gu(),pm(!0),S.hasDoneSurgeReset||lm(!0),vn(),yn(),Fn(),t&&(n||wx(),n||Nx()),Jp("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}qe()}function A0(){if(!Dl()||(Jt?Jt():at()).cmp(10)<0)return!1;let t=S.pendingDna.clone?.()??S.pendingDna;try{R.DNA?.add&&R.DNA.add(t)}catch{}return Uu(at(),{playEffects:!1}),Ex(),hy([4]),S.hasDoneExperimentReset||cm(!0),vn(),yn(),Fn(),Po(),qe(),!0}function Ax(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{Mv(!0)}catch{}try{du()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,er(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=Jv(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),pv(e,()=>{setTimeout(kx,0)},i)},r);Nu=i.cleanup}function kx(){Nu&&(Nu(),Nu=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Uu(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function bm(){if(!$r()||v0()<201)return!1;let e=S.pendingWaves.clone?.()??S.pendingWaves;if(e.isZero?.())return!1;let t=Dn(),n=R.waves?.value??at(),o=Ul(t),r=wm(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!gn()?(Ax(),Uu(e,{playEffects:!1}),!0):(Uu(e,{playEffects:!0}),!0)}function Nx(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function Ul(e){let t=0n;try{let n=localStorage.getItem(nm(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function Rx(e){let t=nm(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function s0(e){if(!(e instanceof Tt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function k0(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=s0(n),l=s0(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function Gu(){let e=Dn();if(e==null||!$r()||Yp||Rx(e))return;let t=R.waves?.value??at(),n=Ul(e);if(n===1/0)return;let o=k0(n,t);if(o.changed){n=o.level;try{localStorage.setItem(nm(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}Yp=!0;try{R.waves.set(o.remainingWaves)}finally{Yp=!1}qe(),o.safety>=100&&setTimeout(Gu,0)}d0()}function kl(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Tt.fromInt(e)}catch{}try{return K(t)}catch{return e?.toString?.()??"0"}}function Ox(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),m=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${m.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let m="";for(let y=0;y<=r;y++){let p=y/r,h=a+p*(u-a),g=h/(Math.PI*2)*120,v=50+30*Math.sin(h+d);m+=(y===0?"M":"L")+` ${g.toFixed(1)} ${v.toFixed(1)}`}return`<path d="${m}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function Px(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${fx}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${dx}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${px}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${mx}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${a0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${l0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${ku}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${Je?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${c0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,S.panel=e,S.elements.forge.card=e.querySelector("#reset-card-forge"),S.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),S.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),S.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),S.elements.infuse.card=e.querySelector("#reset-card-infuse"),S.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),S.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),S.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),S.elements.surge.card=e.querySelector("#reset-card-surge"),S.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),S.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),S.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),S.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),S.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),S.elements.surge.headerVal=e.querySelector("[data-surge-level]"),S.elements.surge.header=e.querySelector(".surge-header"),S.elements.experiment.card=e.querySelector("#reset-card-experiment"),S.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),S.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");if(S.elements.surge.milestones&&t&&Rs(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),typeof IntersectionObserver<"u"){let o=new IntersectionObserver(r=>{r.forEach(i=>{let s=i.target,l=i.isIntersecting;s===S.elements.forge.card?(S.visible.forge=l,l&&Sm()):s===S.elements.infuse.card?(S.visible.infuse=l,l&&Im()):s===S.elements.surge.card?(S.visible.surge=l,l&&Pl()):s===S.elements.experiment.card?(S.visible.experiment=l,l&&N0()):s===S.elements.surge.milestones&&(S.visible.surgeMilestones=l,l&&Pl())})},{threshold:0});S.elements.forge.card&&o.observe(S.elements.forge.card),S.elements.infuse.card&&o.observe(S.elements.infuse.card),S.elements.surge.card&&o.observe(S.elements.surge.card),S.elements.experiment.card&&o.observe(S.elements.experiment.card),S.elements.surge.milestones&&o.observe(S.elements.surge.milestones)}else S.visible.forge=!0,S.visible.infuse=!0,S.visible.surge=!0,S.visible.experiment=!0,S.visible.surgeMilestones=!0;S.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(S.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&uo(r))return;let a=S.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),S.elements.forge.btn&&S.elements.forge.btn.addEventListener("click",()=>{ym()&&(Sx(),qe())}),S.elements.infuse.btn&&S.elements.infuse.btn.addEventListener("click",()=>{vm()&&(Ix(),qe())}),S.elements.surge.btn&&S.elements.surge.btn.addEventListener("click",()=>{bm()&&qe()}),S.elements.experiment.btn&&S.elements.experiment.btn.addEventListener("click",()=>{A0()&&qe()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=Ox();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{ks("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}qe()}function Ep(e){!e||e.__resetInit||(e.__resetInit=!0,Px(e))}function Bo(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=kl(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function Sm({goldMult:e=null}={}){let t=S.elements.forge;if(!(!t.card||!t.btn)){if(!$s()){if(!S.visible.forge)return;Bo(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(S.visible.forge){if(wo(),t.card.classList.toggle("is-forge-complete",!!S.hasDoneForgeReset),t.status)if(S.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!mm()){Bo(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Bo(t.btn,{disabled:!1},a0,rm(e))}}}function Im(){let e=S.elements.infuse;if(!(!e.card||!e.btn)){if(!qu()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="none"&&(S.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="flex"&&(S.layerButtons.infuse.style.display="flex"),!!S.visible.infuse){if(wo(),e.card.classList.toggle("is-complete",!!S.hasDoneInfuseReset),e.status)if(S.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!hm()){Bo(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Bo(e.btn,{disabled:!1},l0,S.pendingMagic)}}}function wm(e,t,n){let o=t.add(n);return k0(e,o).level}function Pl(){let e=S.elements.surge;if(!e.card||!e.btn)return;if(!$r()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="none"&&(S.layerButtons.surge.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="flex"&&(S.layerButtons.surge.style.display="flex"),!S.visible.surge)return;wo();let t=Dn(),n=R.waves?.value??at(),o=0n;try{o=Ul(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':kl(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=S.pendingWaves;if(u&&!u.isZero?.()){let f=wm(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let m=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':kl(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${m}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${ku}">${kl(n)} / <img src="${ku}">${kl(r)}</span>`),e.milestones&&S.visible.surgeMilestones){let s=jv(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",m=a.description.map(C=>C.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${C}</div>`:`<div>- ${C}</div>`).join("");if(f&&a.surgeLevel===3){let C=Ar?Ar():Tt.fromInt(0);m+=`<div style="color:#02e815">- Current Books/sec: ${K(C.floorToInteger())}</div>`}if(f&&a.surgeLevel===6){let C=zc();m=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Te(C.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Te(C.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Te(C.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Te(C.magic)}x</span></div>`}if(f&&a.surgeLevel===13){let q=2*(dt()*1.5-.5)-2,P=ie(q),M=rm().mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Gold/sec: ${K(M.floorToInteger())}</div>`}if(f&&a.surgeLevel===16){let q=2*(dt()*1.5-.5)-2,P=ie(q),G=S.pendingMagic.mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Magic/sec: ${K(G.floorToInteger())}</div>`}let y=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(y=!0);let p=dt(),h=!1;f&&y&&p<1&&Vp.includes(a.id)&&(h=!0);let g=h?" is-nerfed":"",v=l[u];if(!v)v=document.createElement("div"),v.className=`surge-milestone-item ${d}${g}`,v.dataset.isReached=String(f),v.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(v);else{v.className!==`surge-milestone-item ${d}${g}`&&(v.className=`surge-milestone-item ${d}${g}`);let C=String(f);v.dataset.isReached!==C&&(v.dataset.isReached=C)}let w=v.querySelector(".surge-milestone-desc");w&&w.innerHTML!==m&&(w.innerHTML=m);let x=v.querySelector(".surge-milestone-nerf-arrow");if(x){let C=!1;y&&p<1&&Vp.includes(a.id)&&(C=!0);let k=C?"":"none";x.style.display!==k&&(x.style.display=k)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();requestAnimationFrame(()=>{e.milestones&&e.milestones.__customScroll&&typeof e.milestones.__customScroll.update=="function"&&e.milestones.__customScroll.update()}),S.lastRenderedSurgeLevel!==o&&(S.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!S.hasDoneSurgeReset),e.status)if(S.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(v0()<201){Bo(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(S.pendingWaves.isZero?.()){Bo(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Bo(e.btn,{disabled:!1},ku,S.pendingWaves)}function N0(){let e=S.elements.experiment;if(!e.card||!e.btn)return;if(!Dl()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="none"&&(S.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="flex"&&(S.layerButtons.experiment.style.display="flex"),!S.visible.experiment)return;if(wo(),e.card.classList.toggle("is-complete",!!S.hasDoneExperimentReset),e.status)if(S.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((Jt?Jt():at()).cmp(10)<0){Bo(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}Bo(e.btn,{disabled:!1},c0,S.pendingDna)}function qe({goldMult:e=null}={}){S.panel&&(Sm({goldMult:e}),Im(),Pl(),N0())}function Em(){Wo(),Du(!0),qe()}function xm(){Wo(),fm(!0),qe()}function Lm(){Wo(),pm(!0),qe()}function Bx(){if(!S.panel)return;let e=S.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!S.panel.classList.contains("is-active")||!S.elements.surge.barFill)return;let t=S.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Pl(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Pl()},{once:!0}))}function Fx(){typeof window>"u"||(window.addEventListener("menu:scrollStop",()=>{qe()}),window.addEventListener("surge:level:change",()=>{Bx()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(vn(),yn(),Fn()),e.detail?.key==="waves"&&(Gu(),qe()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Fn(),qe())}),window.addEventListener("surge:bookResidue",()=>{if(S.panel&&S.panel.offsetParent!==null){let e=S.elements.surge.card;e&&e.style.display!=="none"&&qe()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Re.GOLD){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;vn(!0);let n=t.mult instanceof c?t.mult:Tt.fromAny(t.mult??1);S.panel&&Sm({goldMult:n});return}if(t.key===Re.MAGIC){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;let n=t.mult instanceof c?t.mult:Tt.fromAny(t.mult??1);yn(n),S.panel&&Im();return}}}),window.addEventListener("xp:change",()=>{vn(),Fn(),Po(),qe()}),window.addEventListener("mutation:change",()=>{yn(),Fn(),qe()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&S.slot!=null&&e.detail.slot!==S.slot||(Ol(),vn(!0),yn(),Fn(),Po(),qe())}),window.addEventListener("lab:level:change",()=>{Po(),qe()}),window.addEventListener("lab:node:change",()=>{yn(),qe()}))}function Wo(){if(n0){S.slot=b(),Ol(),Wp(),vn(!0),yn(),Fn(),Po();return}try{tn()}catch{return}n0=!0;let e=b();if(S.slot=e,Ol(),jp(e),S.hasDoneForgeReset&&!Oo())try{Ur()}catch{}if(!S.forgeUnlocked&&Zp()&&Du(!0),i0(e),Wp(),Fx(),vn(!0),yn(),Fn(),Po(),Au){try{Au()}catch{}Au=null}Au=Ni(()=>{let t=_m();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(S.slot=t,Ol(),jp(t),S.hasDoneForgeReset&&!Oo())try{Ur()}catch{}!S.forgeUnlocked&&Zp()&&Du(!0),i0(t),Wp(),vn(!0),yn(),Fn(),Po(),qe()})}var Tt,Tu,at,e0,a0,l0,c0,fx,dx,px,mx,ku,hx,gx,yx,vx,bx,Ru,Qp,Nl,Ou,em,Rl,Pu,u0,tm,Ks,nm,om,xx,Lx,Yp,f0,S,no,t0,n0,Au,zp,o0,r0,Nu,po=Ue(()=>{xt();yo();St();qt();Tn();mo();ho();us();nl();Zv();hi();Ln();hn();Zo();mi();Us();Qv();Tt=c,Tu=Math.log10(1.1),at=()=>Tt.fromInt(0),e0=()=>Tt.fromInt(1),a0="img/currencies/gold/gold.webp",l0="img/currencies/magic/magic.webp",c0="img/currencies/dna/dna.webp",fx="img/misc/forge.webp",dx="img/misc/infuse.webp",px="img/misc/surge.webp",mx="img/misc/experiment.webp",ku="img/currencies/wave/wave.webp",hx="sounds/forge_reset.ogg",gx="sounds/infuse_reset.ogg",yx="sounds/surge_reset.ogg",vx="sounds/experiment_reset.ogg",bx=[];Ru=e=>`ccc:reset:forge:${e}`,Qp=e=>`ccc:reset:forge:completed:${e}`,Nl=e=>`ccc:debug:forgeUnlocked:${e}`,Ou=e=>`ccc:reset:infuse:${e}`,em=e=>`ccc:reset:infuse:completed:${e}`,Rl=e=>`ccc:debug:infuseUnlocked:${e}`,Pu=e=>`ccc:reset:surge:${e}`,u0=e=>`ccc:debug:surgeUnlocked:${e}`,tm=e=>`ccc:reset:surge:completed:${e}`,Ks=e=>`ccc:reset:surge:barLevel:${e}`,nm=Ks,om=e=>`ccc:reset:experiment:completed:${e}`,xx=Tt.fromInt(31),Lx=Tt.fromInt(7),Yp=!1,f0=!1;S={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:at(),pendingMagic:at(),pendingWaves:at(),pendingDna:at(),panel:null,visible:{forge:!1,infuse:!1,surge:!1,experiment:!1,surgeMilestones:!1},elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},no=[],t0=null,n0=!1,Au=null,zp=null,o0=null,r0=null;Nu=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Wo,performForgeReset:ym,performInfuseReset:vm,performSurgeReset:bm,performExperimentReset:A0,computePendingForgeGold:M0,computeForgeGoldFromInputs:_s,computeInfuseMagicFromInputs:Ms,computeSurgeWavesFromInputs:h0,computePendingDnaFromInputs:g0,getForgeDebugOverrideState:b0,hasDoneForgeReset:Fr,isForgeUnlocked:$s,setForgeDebugOverride:S0,setForgeResetCompleted:sm,updateResetPanel:qe,isInfuseUnlocked:qu,setInfuseDebugOverride:E0,getInfuseDebugOverrideState:I0,recomputePendingMagic:yn,setInfuseUnlockedForDebug:w0,setInfuseResetCompleted:am,hasDoneInfuseReset:Gt,isSurgeUnlocked:$r,setSurgeUnlockedForDebug:L0,getSurgeDebugOverrideState:x0,setSurgeResetCompleted:lm,hasDoneSurgeReset:ko,getCurrentSurgeLevel:Qn,shouldBlockBigCoins:Bl,hasDoneExperimentReset:_0,setExperimentResetCompleted:cm,isExperimentUnlocked:Dl}))});var rb={};bt(rb,{AREA_KEYS:()=>Ee,HM_EVOLUTION_INTERVAL:()=>Vt,MAX_LEVEL_DELTA:()=>ra,REGISTRY:()=>sf,UPGRADE_TIES:()=>_e,approxLog10BigNum:()=>we,batchUpgradeOperations:()=>ql,bigNumFromLog10:()=>ie,buyCheap:()=>El,buyMax:()=>wl,buyOne:()=>qs,buyTowards:()=>Gs,clearPermanentUpgradeUnlock:()=>Vm,computeDefaultUpgradeCost:()=>Ym,computeHmMultipliers:()=>zo,computeUpgradeEffects:()=>ms,costToBuyOne:()=>a1,ensureLevelBigNum:()=>ht,estimateFlatBulk:()=>Dm,estimateGeometricBulk:()=>n1,evaluateBulkPurchase:()=>Mi,evolveUpgrade:()=>vu,formatMultForUi:()=>Te,getCurrentAreaKey:()=>eo,getHmEvolutions:()=>qm,getHmNextMilestoneLevel:()=>l1,getIconUrl:()=>Su,getLevel:()=>An,getLevelNumber:()=>kt,getMagnetLevel:()=>Fc,getMpValueMultiplierBn:()=>Bc,getUpgrade:()=>la,getUpgradeLockState:()=>No,getUpgradeStorageKey:()=>Oi,getUpgradesForArea:()=>Ct,levelBigNumToNumber:()=>Ve,log10OnePlusPow10:()=>Uf,markUpgradePermanentlyUnlocked:()=>Ri,normalizeBigNum:()=>c1,normalizeUpgradeIconPath:()=>bu,normalizedUpgradeLevel:()=>ju,onUpgradesChanged:()=>Md,peekNextPrice:()=>ob,performFreeAutobuy:()=>qd,safeMultiplyBigNum:()=>yt,setLevel:()=>cr,syncBookCurrencyMultiplierFromUpgrade:()=>ja,upgradeUiModel:()=>Hs});function Hu(){qr.size!==0&&(qr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{ct(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),qr.clear())}function Ux(){if(!(typeof window>"u")&&!P0){P0=setInterval(Hu,2e3);try{window.addEventListener("beforeunload",Hu)}catch{}try{window.addEventListener("pagehide",Hu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&Hu()})}catch{}}}function ql(e){if(Js)return e();Js=!0;try{return e()}finally{Js=!1,$l.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{ea(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),$l.clear(),O0.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{s1(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),O0.clear(),Nm&&(Nm=!1,io())}}function $x(e){try{let t=aa(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function D0(e,t){if(!$x(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=we(n);return Number.isFinite(o)&&o>=qx}catch{return!1}}function Qs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>Mm)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>Mm/2||i.length>Mm/2)return"Infinity"}return n}function Vu(e){return Wx[e]??0}function Cm(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function ia(e,t){let n=dr(e||t?.area);if(!n)return null;let o=pr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=ro(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function Gl(e,t){let n=dr(e||t?.area);if(!n)return null;let o=ro(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function js(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function Pm(e=b()){let t=String(e??"default");if(Wu.has(t))return Wu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${q0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Wu.set(t,n),n}function Bm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Wu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${q0}:${n}`,JSON.stringify(e))}catch{}}function nf(e=b()){let t=String(e??"default");if(zu.has(t))return zu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${G0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),zu.set(t,n),n}function of(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),zu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${G0}:${n}`,JSON.stringify(e))}catch{}}function Hm(e=b()){let t=String(e??"default");if(Ku.has(t))return Ku.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${H0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Ku.set(t,n),n}function Xm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Ku.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${H0}:${n}`,JSON.stringify(e))}catch{}}function Fm(e,t,n=b()){let o=ia(e,t);if(!o)return;let r=Gl(e,t),i=Hm(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Xm(i,n))}function X0(e,t,n=b()){let o=ia(e,t);if(!o)return!1;let r=Gl(e,t),i=Hm(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Xm(i,n),!0):!1}function Ri(e,t,n=b()){let o=ia(e,t);if(!o)return;let r=Gl(e,t),i=nf(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],of(i,n))}function Vm(e,t,n=b()){let o=ia(e,t);if(!o)return;let r=nf(n);r.upgrades[o]&&(delete r.upgrades[o],of(r,n));let i=Pm(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},Bm(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&mr(e,s,n),io()}function Qu(e,t,n=b()){let o=ia(e,t);if(!o)return!1;let r=Gl(e,t),i=nf(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],of(i,n),!0):!1}function bn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=pr(t?.tie??t?.tieKey),o=e?.areaKey||Ee.STARTER_COVE;if(!n||!Hx.has(n))return{locked:!0,iconOverride:Un,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?kt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:V0()}catch{}function s(){if(Y0())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:In,titleOverride:an,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===_e.UNLOCK_XP)return s();if(n===_e.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Un,useLockedBase:!0};let a=!1;try{let u=wn();a=Ve(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:In,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:an,descOverride:u,reason:u}}return{locked:!1}}if(n===_e.UNLOCK_INFUSE){if(!Fr())return{locked:!0,iconOverride:Un,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:oo,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=wn();a=Ve(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:In,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:an,descOverride:u,reason:u}}return{locked:!1}}if(n===_e.UNLOCK_SURGE){if(!Gt())return{locked:!0,iconOverride:Un,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:oo,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=wn();a=Ve(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:In,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:an,descOverride:u,reason:u}}return{locked:!1}}if(Gm.has(n)){if(Gt()||Qu(o,t)){try{Ri(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=wn();a=Ve(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:Un,useLockedBase:!0,titleOverride:oo,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{Fm(o,t)}catch{}return{locked:!0,iconOverride:In,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:an,descOverride:u,reason:u}}if(Fr()||Qu(o,t)){try{Ri(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Un,useLockedBase:!0};if(X0(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:In,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:an,descOverride:a,reason:a}}let l=!1;try{let a=wn();l=Ve(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Un,useLockedBase:!0,titleOverride:oo,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{Fm(o,t)}catch{}return{locked:!0,iconOverride:In,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function dr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function pr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function zx(e,t){let n=pr(t?.tie??t?.tieKey);if(n&&Xx.has(n))return!0;let o=ro(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=dr(l);if(a&&Vx.has(`${a}:${i}`))return!0}return!1}function V0(){try{return!!mn()}catch{return!1}}function Y0(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${Yx}:${t}`)==="1"}catch{return!1}}function wn(){try{let e=typeof Qe=="function"?Qe():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function ju(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function Tm(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function ro(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function ht(e){try{if(e=Qs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return ie(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=we(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Ve(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=we(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=we(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function Kx(e,t){let n=ht(e),o=ht(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(we(n))+1,i=Math.floor(we(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function W0(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function sa(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function ef(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:sa(e.numUpgEvolutions)}function Ym(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Ve(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/Vt));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=Z0(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:we(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:W0(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,Sn(i,r)}function z0(e){let t=sa(e),n=Vt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Gr(o),capFmtText:na(o)}}function K0(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(we(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Vt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Vt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Vt)+1)}}function Zx(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Wm(e,t=Ju){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=dr(t||e?.area||Ju);return Gx[n]||U0}function yt(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function rf(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=z0(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function zo(e,t,n=Ju){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Wm(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=K0(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=Zx(u.multiplier??u.mult??u.value??1,f),m=`${u.target??u.type??"self"}`.toLowerCase();m==="xp"?i=yt(i,d):m==="coin"||m==="coins"?s=yt(s,d):m==="mp"?l=yt(l,d):r=yt(r,d)}let a=ef(e);if(a>0){let u=Dx*a,f=ie(u);r=yt(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function j0(e,t,n=Ju){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Wm(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=K0(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt(Vt)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny(Vt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Vt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Vt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function Z0(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=jx[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function aa(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=Z0(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=W0(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=we(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),m=c.fromAny(e.costAtLevel?.(1)??0),y=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(m)===0&&d.cmp(y)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function Sn(e,t){let n=aa(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=ie(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return ie(n.baseLog10+o*n.ratioLog10).floorToInteger()}function Jx(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function ur(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=aa(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Yu+t*o.ratioLn)/Yu;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Yu+t*o.ratioLn,i=o.ratioLn*n,s=Jx(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Yu}function Zu(e,t,n){if(!(n>0))return c.fromInt(0);let o=aa(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=ur(e,t,l);a=a.add(ie(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=ur(e,t,n);return ie(i)}function Q0(e){if(!(e>0)||!Number.isFinite(e))return e;if(km[0]=e,km[0]<=0)return 0;Qx[0]-=1n;let t=km[0];return t>0?t:0}function e1(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=Q0(e);return n<e?n:e>1?e/2:0}function Zs(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function ta(e,t,n,o=ra,r={}){let i=aa(e),s=c.fromInt(0),l=r||{},a=!!l.fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Ve(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:Ve(o),m=Number.isFinite(f)?Math.max(0,f-u):Am,y=Number.isFinite(d)?Math.max(0,Math.floor(d)):Am;if(y=Math.min(y,Am,m),!(y>0)){let W=m<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:W,numericCount:0}}let p=100-u;if(Number.isFinite(u)&&p>0){let W=Math.min(y,p);if(l.fastOnly&&i&&Number.isFinite(i.ratioLog10)&&Number.isFinite(i.baseLog10)){let ge=we(n),Be=u+W,ne=i.baseLog10+Be*i.ratioLog10;if(ge>ne+5){let ve=Zs(W),De=u+W,ke=ta(e,De,n,y-W,r),Fe=ke?.count instanceof c?ke.count:Zs(ke?.numericCount??0);return{count:ve.add(Fe),spent:s,nextPrice:ke?.nextPrice??s,numericCount:W+(ke?.numericCount??0)}}}let $=c.fromAny(e.costAtLevel(u)),X=s,J=0;for(;J<W;){$=c.fromAny(e.costAtLevel(u+J));let ge=X.add($);if(ge.cmp(n)>0)break;X=ge,J+=1}let le=u+J,fe=Number.isFinite(f)&&le>=f,L=Zs(J);if(J<W||fe||y<=J){let ge=fe?s:c.fromAny(e.costAtLevel(le));return{count:L,spent:X,nextPrice:ge,numericCount:J}}let H=(()=>{try{return fr(t??u,u).add(L)}catch{return u+J}})(),z=ta(e,H,n.sub(X),y-J,r),de=z?.count instanceof c?z.count:Zs(z?.numericCount??0),ee=L.add(de),re=(z?.spent??s).add(X);return{count:ee,spent:re,nextPrice:z?.nextPrice??s,numericCount:J+(z?.numericCount??0)}}let h=we(n),g=i.ratioLog10,v=i.ratioMinus1,w=c.fromAny(e.costAtLevel(u)),x=i.baseLog10+u*g;if(v>0&&(!Number.isFinite(h)||Math.abs(h)>1e6&&Math.abs(x)>1e6)){let W=c.fromAny(e.costAtLevel(u));if(n.cmp(W)<0)return{count:s,spent:s,nextPrice:W,numericCount:0};let $=Number.isFinite(y)?Math.max(1,Math.floor(y)):Number.MAX_VALUE,X=1,J=1;for(;J<$;){let de=ur(e,u,J);if(ie(de).cmp(n)<=0){let re=J*2;if(!Number.isFinite(re)||re<=J){J=$;break}X=J,J=Math.min(re,$)}else break}let le=0;for(;X<J&&le<256;){let de=Math.max(X+1,Math.floor((X+J+1)/2)),ee=ur(e,u,de);ie(ee).cmp(n)<=0?X=de:J=de-1,le++}let fe=Math.max(1,X),L=Zs(fe),H=s,z=s;if(!a)if(H=Zu(e,u,fe),Number.isFinite(f)){let de=Math.max(0,Math.floor(f-Math.min(u,f)));fe>=de?z=s:z=ie(x+fe*g)}else z=ie(x+fe*g);return{count:L,spent:H,nextPrice:z,numericCount:fe}}if(n.cmp(w)<0)return{count:s,spent:s,nextPrice:w,numericCount:0};let k=!1,q=null,P=null;try{q=c.fromAny(e.costAtLevel(u+1))}catch{}try{let W=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);P=c.fromAny(e.costAtLevel(W))}catch{}!k&&!(i.ratioMinus1>0)&&(k=!0),q&&P&&(k=q.cmp(w)===0&&P.cmp(w)===0),!k&&!(i.ratioMinus1>0)&&(k=!0);let G=Number.isFinite(y)?Math.max(0,Math.floor(y)):Number.MAX_VALUE;if(k){let W=fr(e.lvlCapBn??"Infinity","Infinity"),$=fr(t??0,0),X=W.isInfinite?.()?c.fromAny("Infinity"):W.sub($).floorToInteger(),{count:J,countBn:le,spent:fe,nextPrice:L}=Dm(w,n,X);return{count:le,spent:fe,nextPrice:L,numericCount:J}}if(!(g>0)||!(v>0)){let W=fr(e.lvlCapBn??"Infinity","Infinity"),$=fr(t??0,0),X=W.isInfinite?.()?c.fromAny("Infinity"):W.sub($).floorToInteger(),{count:J,countBn:le,spent:fe,nextPrice:L}=Dm(w,n,X);return{count:le,spent:fe,nextPrice:L,numericCount:J}}let M=Math.log10(v);if(!Number.isFinite(M))return{count:s,spent:s,nextPrice:w,numericCount:0};let T=Uf(h+M-x)/g;(!Number.isFinite(T)||T<0)&&(T=0);let _=Math.floor(Math.min(G,T));Number.isFinite(_)||(_=G),_<=0&&(_=1);let Y=1e-7,Q=ur(e,u,_),ae=0,he=2048;for(;_>0&&(!Number.isFinite(Q)||Q>h+Y)&&ae<he;){let W=Number.isFinite(Q)?Math.max(1,Math.ceil((Q-h)/Math.max(g,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-W));if($<_)_=$;else{let X=Q0(_);if(!(X<_))break;_=X}Q=_>0?ur(e,u,_):Number.NEGATIVE_INFINITY,ae+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(w)>=0)_=1,Q=we(w);else return{count:s,spent:s,nextPrice:w,numericCount:0};if(_<G){let W=L=>{let H=L*2;return Number.isFinite(H)?H:Number.MAX_VALUE},$=_,X=Math.min(G,Math.max(_+1,W(_))),J=ur(e,u,X);for(;$<X&&Number.isFinite(J)&&J<=h+Y&&X<G;)$=X,X=Math.min(G,W(X)),J=ur(e,u,X);let le=$,fe=X;for(let L=0;L<256&&le<fe;L+=1){let H=Math.floor((le+fe+1)/2),z=ur(e,u,H);Number.isFinite(z)&&z<=h+Y?(le=H,Q=z):fe=H-1}_=le}let be=null;if(!a){be=Zu(e,u,_);let W=0;for(;be.cmp(n)>0&&_>0&&W<he;){let $=e1(_);if(!($<_))break;_=$,be=Zu(e,u,_),W+=1}if(_<=0)return{count:s,spent:s,nextPrice:w,numericCount:0};if(_<G&&W<he)for(;_<G&&W<he;){let $=u+_,X;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)X=c.fromAny(e.costAtLevel($));else{let le=x+_*g;X=ie(le).floorToInteger()}}catch{break}let J=be.add(X);if(J.cmp(n)>0)break;be=J,_+=1,W+=1}}let Oe=s,Ae=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let W=Math.max(0,Math.floor(f-Math.min(u,f)));if(_>=W)Oe=s;else if(Ae){let $=Math.floor(u+_);Oe=c.fromAny(e.costAtLevel($))}else{let $=x+_*g;Oe=ie($)}}else if(Ae){let W=Math.floor(u+_);Oe=c.fromAny(e.costAtLevel(W))}else{let W=x+_*g;Oe=ie(W)}return{count:Zs(_),spent:be,nextPrice:Oe,numericCount:_}}function t1(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=we(t),r=we(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function Dm(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let m=e.mulBigNumInteger(d);return{count:Um(d),countBn:d,spent:m,nextPrice:e}}let i=we(t),s=we(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=ie(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:Um(l),countBn:l,spent:a,nextPrice:u}}function n1(e,t,n,o){if(!n||o<=0)return{count:0};let r=we(t),i=we(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let h=0;h<64&&a<u;h+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let m=i+f*n.ratioLog,y=ie(d),p=ie(m);return{count:f,spent:y,nextPrice:p,spentLog:d,nextPriceLog:m}}function fr(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function Um(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Gr(e){return K(e instanceof c?e:c.fromAny(e??0))}function na(e){return Gr(e).replace(/<[^>]*>/g,"")}function tf(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function oa(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=tf(n??t??0),s=tf(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Ve(i),newLevel:Number.isFinite(o)?o:Ve(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Dt(e,t){return Sn(e,t)}function eb(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Oi(e,t,n=b()){if(n==null)return null;let o=dr(e),r=zm(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function o1(){B0.forEach(e=>{try{e?.()}catch{}}),B0.clear()}function F0(e){o1()}function r1(e,t){if(typeof localStorage>"u")return;let n=eb(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=Oi(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}})}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function i1(e,t,n){r1(e,n);let o=Oi(e,t,n);if(!o)return null;if(Js&&$l.has(o))try{let r=$l.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(qr.has(o))try{let r=qr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function ea(e,t,n,o=b(),r={}){let i=Oi(e,t,o);if(i){if(Js){$l.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){qr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}qr.has(i)&&qr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{ct(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function s1(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&ea(e,o.id,o,n)})}function zm(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return ro(t.id);let n=ro(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=pr(n);if(o){let r=Rm.get(o);if(r){let i=dr(e);if(!i||dr(r.area)===i)return ro(r.id)}}}return n}function tb(e,t,n=b()){let o=n==null?"null":String(n),r=zm(e,t);return`${o}:${e}:${ro(r)}`}function Eo(e,t){let n=zm(e,t),o=ro(n),r=b(),i=tb(e,o,r),s=$m.get(i);if(s)return s;let l=la(e,o),a=i1(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,ea(e,o,a,r)}let f=a.lvl,d=a.nextCost,m=a.nextCostLvl;a.lvl=Qs(a.lvl),a.nextCost=Qs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Qs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==m)&&(u=!0);let y=0;l?.upgType==="HM"&&(y=sa(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),rf(l,y));let p=ht(a.lvl),h=Ve(p);try{let C=l?.lvlCapBn??c.fromAny("Infinity");if(!C.isInfinite?.()&&p.cmp(C)>0){let k=C.clone?.()??C;h=Ve(k);let q=k.toStorage();a.lvl=q,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=q,ea(e,o,a,r)}}catch{}let g=null;try{g=p?.toStorage?.()??ht(h).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let v=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,w=!v||v!==g,x=null;if(!x||w){if(l)try{x=c.fromAny(l.costAtLevel(h))}catch{x=c.fromInt(0)}else x=c.fromInt(0);try{a.nextCost=x.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{ea(e,o,a,r)}catch{}if(l?.upgType==="HM"&&p?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let C=c.fromAny("Infinity");l.lvlCapBn=C,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Gr(C),l.lvlCapFmtText=na(C)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:h,lvlBn:p,nextCostBn:x,slot:r,hmEvolutions:y},$m.set(i,s),s}function Hr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=ro(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??ht(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Ve(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??ht(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=ht(e.lvl??0).toStorage()}i.lvl=Qs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Qs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=sa(e.hmEvolutions)),ea(n,r,i,o,t),e.slot=o}function mr(e,t,n=b()){$m.delete(tb(e,t,n))}function kt(e,t){return Eo(e,t).lvl}function qm(e,t){return Eo(e,t).hmEvolutions??0}function nb(e,t){if(!t)return{locked:!1};let n=V0(),o=n?wn():c.fromInt(0),r=n?Ve(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=zx(e,t),d="Unlock the XP system to reveal this upgrade",m=Y0();if(f)if(m)i={locked:!0,iconOverride:In,titleOverride:an,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let y='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Un,titleOverride:oo,descOverride:y,reason:y,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Un,titleOverride:oo,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=Tm({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,surgeLevel:Qn(),surgeUnlocked:$r(),baseLocked:s.locked,getUpgradeLevel(m){return kt(e,m)}},d=t.computeLockState(f);s=Tm(s,d)}catch{}let l=b(),a=ia(e,t),u=a?Qu(e,t,l):!1;if(a){let f=Pm(l),d=nf(l),m=Hm(l),y=a.replace(/_/g,"-"),p=Gl(e,t),h=!1;js(f,y,a)&&(h=!0),p&&js(f,p,a)&&(h=!0),h&&Bm(f,l);let g=!1;js(d,y,a)&&(g=!0),p&&js(d,p,a)&&(g=!0),g&&of(d,l);let v=!1;js(m,y,a)&&(v=!0),p&&js(m,p,a)&&(v=!0),v&&Xm(m,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=Un),f?s.titleOverride||(s.titleOverride=an):(!s.titleOverride||s.titleOverride===an)&&(s.titleOverride=oo),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Un||s.iconOverride===In)&&delete s.iconOverride,(s.titleOverride===an||s.titleOverride===oo)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Un),a){let f=Pm(l),d=f.upgrades[a]||{},m=pr(t?.tie??t?.tieKey),y=m&&$0.has(m),p=m&&Gm.has(m),h=d.status||"locked";if(Qu(e,t,l))h="unlocked";else if(X0(e,t,l)&&h==="locked"){let M=!1;try{M=Ve(wn())>=31}catch{}let D=!1;try{D=Ve(wn())>=101}catch{}y&&!M||p&&!D?h="locked":h="mysterious"}let g=Vu(h),v=Cm(s),w=Vu(v),x=()=>{s.locked=!0;let M=d.snapshot;M&&typeof M=="object"&&(s=Tm(s,M)),s.iconOverride=In,s.titleOverride=an;let D=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=D,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>w&&(h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):h==="mysterious"&&x(),v=Cm(s),w=Vu(v));let C=!1,k=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",q=y,P=!1;try{P=Ve(wn())>=31}catch{}let G=!1;try{G=Ve(wn())>=101}catch{}if((q&&!P&&k==="mysterious"||p&&!G&&k==="mysterious")&&(k="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==k)&&(f.upgrades[a]={status:k},C=!0),w>g){if(d.status=v,f.upgrades[a]={status:d.status},C=!0,h=v,g=w,v==="unlocked")Ri(e,t,l);else if(v==="mysterious"){let M=!1;try{M=Ve(wn())>=31}catch{}(!y||M)&&Fm(e,t,l)}}h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Un||s.iconOverride===In)&&delete s.iconOverride,(s.titleOverride===an||s.titleOverride===oo)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},C=!0),Ri(e,t,l)):h==="mysterious"&&v!=="mysterious"&&(x(),v=Cm(s),w=Vu(v)),C&&Bm(f,l)}return s}function Hl(e,t){return!!nb(e,t).locked}function Km(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:ef(e),{capBn:r,cap:i}=z0(o);try{return t?.cmp?.(r)>=0}catch{}let s=Ve(t);return Number.isFinite(s)&&s>=i}function An(e,t){let n=Eo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():ht(n.lvl??0)}function ob(e,t){let n=Eo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??ht(n.lvl??0),i=Ve(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function cr(e,t,n,o=!0,r={}){let i=Eo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,rf(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=tf(i.lvlBn??ht(i.lvl??0)),d=ht(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let m=d;try{s&&D0(s,m)&&(m=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let p=ht(a);m.cmp(p)>0&&(m=p)}if(o&&Number.isFinite(a)){let p=ht(a);m.cmp(p)>0&&(m=p)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(m)===0)return i.lvl;let y=Ve(m);if(!s)return i.lvl=y,i.lvlBn=m,i.nextCostBn=c.fromInt(0),Hr(i),mr(e,t),io(),i.lvl;i.lvl=y,i.lvlBn=m;try{i.nextCostBn=c.fromAny(s.costAtLevel(y))}catch{i.nextCostBn=c.fromInt(0)}return Hr(i,{deferSave:r?.deferSave}),mr(e,t),oa(s,u,f,i.lvl,i.lvlBn),io(),i.lvl}function Ct(e){return sf.filter(t=>t.area===e)}function la(e,t){let n=dr(e),o=ro(t),r=pr(typeof o=="string"?o:t);return sf.find(i=>n&&dr(i.area)!==n?!1:!!(ro(i.id)===o||r&&i.tieKey===r))||null}function No(e,t){let n=typeof t=="object"&&t?t:la(e,t);return nb(e,n)}function bu(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function Su(e){return e?bu(e.icon):""}function a1(e,t){let n=la(e,t),o=An(e,t),r=Ve(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function qs(e,t){let n=Eo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Hl(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??ht(r),s=tf(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(D0(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Hr(n),mr(e,t),io(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?R[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let y=f.value;if((y instanceof c?y:c.fromAny(y??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let m=i.add(c.fromInt(1));return n.lvlBn=m,n.lvl=Ve(m),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),Hr(n),mr(e,t),oa(o,r,s,n.lvl,n.lvlBn),io(),{bought:1,spent:d}}function vu(e,t){let n=Eo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??ht(n.lvl);if(!Km(o,r,n.hmEvolutions))return{evolved:!1};let i=sa(n.hmEvolutions)+1;n.hmEvolutions=i,rf(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Hr(n),mr(e,t),oa(o,n.lvl,r,n.lvl,r),io(),{evolved:!0}}function wl(e,t){let n=Eo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Hl(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??ht(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=R[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return qs(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let v=i.clone?.()??ht(i),w=Ve(v),x=v.toStorage?.(),C;if(o.upgType==="HM"){if(C=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let q=c.fromAny("Infinity");o.lvlCapBn=q,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Gr(q),o.lvlCapFmtText=na(q)}}else{let q=o.lvlCapBn?.clone?.()??fr(o.lvlCap??1/0,1/0);C=q?.clone?.()??q}let k=C.sub(v);if(k.isZero?.()){let q=Kx(C,v);q.isZero?.()||(k=q)}if(k.isZero?.()){let q=C.toStorage?.();if(x&&q&&x!==q)if(C.isInfinite?.())try{k=c.fromAny("Infinity")}catch{k=c.fromInt(1)}else k=c.fromInt(1)}return n.lvlBn=C.clone?.()??C,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),R[o.costType].set(u),Hr(n),mr(e,t),oa(o,w,v,n.lvl,n.lvlBn),io(),{bought:k,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):ra;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=ta(o,i,u,d),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=m.spent??c.fromInt(0),h=u.sub(p);R[o.costType].set(h);let g=i.add(y);return n.lvlBn=g,n.lvl=Ve(g),m.nextPrice?n.nextCostBn=m.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Hr(n),mr(e,t),oa(o,r,i,n.lvl,n.lvlBn),io(),{bought:y,spent:p}}function Gs(e,t,n){let o=Eo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Hl(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??ht(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=R[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,m=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Ve(n):void 0,y=Number.isFinite(d)?Number.isFinite(m)?Math.min(d,m):d:m,p=ta(r,s,f,y),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=p.spent??c.fromInt(0),v=f.sub(g);R[r.costType].set(v);let w=s.add(h);return o.lvlBn=w,o.lvl=Ve(w),p.nextPrice?o.nextCostBn=p.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Hr(o),mr(e,t),oa(r,i,s,o.lvl,o.lvlBn),io(),{bought:h,spent:g}}function Mi(e,t,n,o=ra,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=ta(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function io(){if(Js){Nm=!0,_d();return}_d(),Pc()}function eo(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Ee.STARTER_COVE}function Hs(e,t){let n=la(e,t);if(!n)return null;let o=An(e,t),r=Ve(o),i=Gr(o),s=na(o),l=n.lvlCapBn??fr(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Gr(l),u=n.lvlCapFmtText??na(l),f=r<n.lvlCap?ob(e,t):c.fromInt(0),d=Gr(f),m=R[n.costType]?.value,y=m instanceof c?m:c.fromAny(m??0),p=No(e,t),h=!!p.locked,g=p.titleOverride??n.title,v=p.descOverride??n.desc;if(e===Ze&&ro(t)===si){let k=Xc();if(Math.abs(k-1)>1e-4&&v){let q=Te(k);v=v.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+q+" Coins on an interval")}}let w=Wm(n,e),x="";typeof n.effectSummary=="function"&&!(h&&p.hideEffect)&&(x=n.effectSummary(r),typeof x=="string"&&(x=x.trim()));let C=p.iconOverride??Su(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:y,haveFmt:R[n.costType]?.fmt(y)??String(y),effect:x,iconUrl:C,lockState:p,locked:h,areaKey:e,hmMilestones:w,displayTitle:g,displayDesc:v,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?qm(e,t):0,hmReadyToEvolve:n.upgType==="HM"?Km(n,o,qm(e,t)):!1,hmNextMilestone:n.upgType==="HM"?j0(n,o,e):null}}function l1(e,t){let n=la(e,t);if(!n||n.upgType!=="HM")return null;let o=An(e,t);return j0(n,o,e)}function c1(e){return ie(we(e??0))}function qd(e,t){let n=Eo(e,t),o=n.upg;if(!o)return{bought:0};let r=eb(e,n.slot);if(jt(r))return{bought:0};let i=Oi(e,t,n.slot);if(jt(i))return{bought:0};if(Hl(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??ht(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&Km(o,l,n.hmEvolutions))return{bought:0};let f=R[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let m=ta(o,l,d,ra),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:0};let p=l.add(y);return Ux(),cr(e,t,p,!0,{deferSave:!0}),{bought:y}}function El(e,t){let n=Eo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Hl(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??ht(n.lvl),i=Ve(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=R[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=Mi(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=y=>{if(y<=0)return!0;let p=Zu(o,i,y-1),h=a.sub(p),g=i+y-1,v=c.fromAny(o.costAtLevel(g)),w=h.div(10);return v.cmp(w)<=0},m=0;if(f<2e3){let y=u.spent,p=f;for(;p>0;){let h=i+p-1,g=c.fromAny(o.costAtLevel(h)),v=y.sub(g),x=a.sub(v).div(10);if(g.cmp(x)<=0){m=p;break}y=v,p--}}else{let y=0,p=f;for(;y<p;){let h=Math.ceil((y+p)/2);d(h)?y=h:p=h-1}m=y}return m<=0?{bought:0,spent:c.fromInt(0)}:Gs(e,t,m)}var ra,Vt,kA,Dx,Ju,Ee,Js,O0,$l,Nm,qr,P0,qx,Mm,_e,U0,Gx,Un,In,an,oo,$0,Gm,Hx,Xx,Vx,Yx,q0,G0,H0,Wx,Wu,zu,Ku,Rm,NA,Om,Xu,Qt,Yu,jx,Am,J0,km,Qx,sf,$m,B0,mo=Ue(()=>{St();xt();qt();Tn();ho();po();hn();ai();Is();_p();Dc();ra=c.fromAny("Infinity"),Vt=1e3,kA=c.fromInt(1e3),Dx=3,Ju="",Ee={STARTER_COVE:"starter_cove",AUTOMATION:Ze,DNA:Xt},Js=!1,O0=new Map,$l=new Map,Nm=!1,qr=new Map,P0=null;qx=308;Mm=1024;_e={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},U0=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],Gx={[Ee.STARTER_COVE]:U0},Un="img/misc/locked.webp",In="img/misc/mysterious.webp",an="Hidden Upgrade",oo="Locked Upgrade",$0=new Set([_e.COIN_VALUE_II,_e.XP_VALUE_II,_e.MP_VALUE_I,_e.MAGNET,_e.ENDLESS_XP]),Gm=new Set([_e.COIN_VALUE_III,_e.XP_VALUE_III,_e.MP_VALUE_II,_e.FASTER_COINS_III,_e.ENDLESS_MP]),Hx=new Set([_e.UNLOCK_XP,_e.UNLOCK_FORGE,_e.UNLOCK_INFUSE,_e.UNLOCK_SURGE,...$0,...Gm]),Xx=new Set([_e.FASTER_COINS_II,_e.COIN_VALUE_I,_e.BOOK_VALUE_I,_e.XP_VALUE_I]),Vx=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),Yx="ccc:merchantMet",q0="ccc:shop:reveals",G0="ccc:shop:permaUnlocks",H0="ccc:shop:permaMyst",Wx={locked:0,mysterious:1,unlocked:2},Wu=new Map,zu=new Map,Ku=new Map,Rm=new Map,NA=pr(_e.BOOK_VALUE_I),Om=c,Xu=e=>Om.fromAny(e??0),Qt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Xu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Om.fromInt(1).add(r.mulDecimal(n))}catch{let i=we(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return ie(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Xu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Om.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Xu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Xu(i);if(o>0){let l=we(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return ie(u)}}catch{}try{let l=Ve(s),a=o*l;return ie(a)}catch{return c.fromInt(1)}}}};Yu=Math.log(10);jx={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=ef(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=ef(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};Am=(()=>{try{let e=Ve(ra);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),J0=new ArrayBuffer(8),km=new Float64Array(J0),Qx=new BigInt64Array(J0);sf=[{area:Ee.STARTER_COVE,id:1,tie:_e.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(.1)},{area:Ee.STARTER_COVE,id:2,tie:_e.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:bn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{ti()}catch{}}},{area:Ee.STARTER_COVE,id:3,tie:_e.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(.1)},{area:Ee.STARTER_COVE,id:4,tie:_e.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(.5),onLevelChange(){try{Zt()}catch{}}},{area:Ee.STARTER_COVE,id:5,tie:_e.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>ju(e)>0?2:1,onLevelChange({newLevel:e}){ja(e)}},{area:Ee.STARTER_COVE,id:6,tie:_e.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:Qt.addFlatPerLevel(2)},{area:Ee.STARTER_COVE,id:7,tie:_e.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:bn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Em()}catch{}}},{area:Ee.STARTER_COVE,id:8,tie:_e.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${K(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(10),onLevelChange(){try{Zt()}catch{}}},{area:Ee.STARTER_COVE,id:9,tie:_e.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:10,tie:_e.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:11,tie:_e.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=ju(e),n=Te(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>ju(e)},{area:Ee.STARTER_COVE,id:12,tie:_e.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach certain upgrade levels for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Vt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return Sn(this,e)},nextCostAfter(e,t){return Sn(this,t)},computeLockState:bn,effectSummary(e){let t=ht(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=zo(this,t,this.area),r=yt(n,o);return`XP value bonus: ${Te(r)}x`},effectMultiplier:Qt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:13,tie:_e.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:bn,onLevelChange({newLevel:e}){if((e??0)>=1)try{xm()}catch{}}},{area:Ee.STARTER_COVE,id:14,tie:_e.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${K(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(1e3)},{area:Ee.STARTER_COVE,id:15,tie:_e.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:16,tie:_e.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:17,tie:_e.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Dt(this,e)},nextCostAfter(e,t){return Dt(this,t)},computeLockState:bn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:Qt.addPctPerLevel(1)},{area:Ee.STARTER_COVE,id:18,tie:_e.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Vt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return Sn(this,e)},nextCostAfter(e,t){return Sn(this,t)},computeLockState:bn,effectSummary(e){let t=ht(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=zo(this,t,this.area),r=yt(n,o);return`MP value bonus: ${Te(r)}x`},effectMultiplier:Qt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:19,tie:_e.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:bn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Lm()}catch{}}},{area:Ee.STARTER_COVE,id:20,tie:_e.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Vt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return Sn(this,e)},nextCostAfter(e,t){return Sn(this,t)},computeLockState(e){let t=Qn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=wn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:In,titleOverride:an,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:oo,descOverride:"Locked"}},onLevelChange(){try{Zt()}catch{}},effectSummary(e){let t=ht(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=zo(this,t,this.area),r=yt(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:Qt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:21,tie:_e.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Vt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return Sn(this,e)},nextCostAfter(e,t){return Sn(this,t)},computeLockState(e){let t=Qn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=wn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:In,titleOverride:an,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:oo,descOverride:"Locked"}},onLevelChange(){try{Zt()}catch{}},effectSummary(e){let t=ht(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=zo(this,t,this.area),r=yt(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:Qt.powPerLevel(1.1)},{area:Ee.STARTER_COVE,id:22,tie:_e.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Vt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return Sn(this,e)},nextCostAfter(e,t){return Sn(this,t)},computeLockState(e){let t=Qn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=wn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:In,titleOverride:an,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:oo,descOverride:"Locked"}},onLevelChange(){try{Zt()}catch{}},effectSummary(e){let t=ht(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=zo(this,t,this.area),r=yt(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:Qt.powPerLevel(1.1)},...Vg,...gv];for(let e of sf){let t=pr(e.tie??e.tieKey);t&&!Rm.has(t)&&Rm.set(t,e),e.baseCost=fr(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return Sn(this,n)},e.nextCostAfter=function(n,o){return Sn(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=Qt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=ht(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=zo(this,o,this.area),s=yt(r,i);if(typeof this.bonusLine=="function")return this.bonusLine(n,s);let l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Te(s)}x`})),e.numUpgEvolutions=sa(e.numUpgEvolutions),e.upgType==="HM"?rf(e,e.numUpgEvolutions):(e.lvlCapBn=fr(e.lvlCap??1/0,1/0),e.lvlCap=Um(e.lvlCapBn),e.lvlCapFmtHtml=Gr(e.lvlCapBn),e.lvlCapFmtText=na(e.lvlCapBn)),e.bulkMeta=t1(e),aa(e)}$m=new Map;B0=new Map;typeof window<"u"&&(F0(b()),window.addEventListener("saveSlot:change",()=>{F0(b()),io()}),window.addEventListener("surge:level:change",()=>{io()}));zg()});var Tb={};bt(Tb,{applyAllCurrencyOverridesForActiveSlot:()=>Jl,applyStatMultiplierOverride:()=>jn,getDebugCurrencyMultiplierOverride:()=>Yl,getDebugStatMultiplierOverride:()=>L1,setDebugCurrencyMultiplierOverride:()=>bb,setDebugPanelAccess:()=>lL,setDebugStatMultiplierOverride:()=>qn});function Zl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function m1(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function En(e){typeof e=="function"&&Qm.push(e)}function mf(){return{sections:new Set,subsections:new Set}}function h1(){let e=document.getElementById(zl);if(!e)return mf();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function g1(e){let{sections:t,subsections:n}=ub??mf();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function pb(){Qm.forEach(e=>{try{e?.()}catch{}}),Qm=[],rh.length=0}function $t(e){!e||typeof e.refresh!="function"||rh.push(e)}function pt(e){rh.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function y1(){if(typeof window>"u")return;let e=y=>{let{key:p,slot:h}=y?.detail??{},g=h??b();pt(v=>v.type==="currency"&&v.key===p&&v.slot===g)};window.addEventListener("currency:change",e,{passive:!0}),En(()=>window.removeEventListener("currency:change",e));let t=y=>{let{key:p,slot:h}=y?.detail??{},g=h??b();pt(v=>v.type==="currency-mult"&&v.key===p&&v.slot===g)};window.addEventListener("currency:multiplier",t,{passive:!0}),En(()=>window.removeEventListener("currency:multiplier",t));let n=y=>{let{slot:p,changeType:h,unlocked:g}=y?.detail??{},v=p??b();pt(w=>w.type==="xp"&&w.slot===v),pt(w=>w.type==="stat-mult"&&w.key==="xp"&&w.slot===v),(h==="unlock"||typeof g=="boolean")&&pt(w=>w.type==="unlock"&&(w.slot==null||w.slot===v))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),En(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=y=>{let{changeType:p,slot:h}=y?.detail??{},g=h??b();pt(v=>v.type==="mutation"&&v.slot===g),pt(v=>v.type==="stat-mult"&&v.key==="mutation"&&v.slot===g),p==="unlock"&&pt(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("mutation:change",o,{passive:!0}),En(()=>window.removeEventListener("mutation:change",o));let r=()=>{let y=b();pt(p=>p.type==="upgrade"&&p.slot===y),pt(p=>p.type==="currency-mult"&&p.slot===y),pt(p=>p.type==="stat-mult"&&p.slot===y)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),En(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let y=b();pt(p=>p.slot===y)};window.addEventListener("saveSlot:change",i,{passive:!0}),En(()=>window.removeEventListener("saveSlot:change",i));let s=y=>{let{slot:p,key:h}=y?.detail??{},g=p??b();pt(v=>v.type==="unlock"&&(v.slot==null||v.slot===g)&&(v.key==null||v.key===h))};window.addEventListener("unlock:change",s,{passive:!0}),En(()=>window.removeEventListener("unlock:change",s));let l=y=>{let{slot:p}=y?.detail??{},h=p??b();pt(g=>g.type==="workshop-level"&&g.slot===h)};window.addEventListener("workshop:change",l,{passive:!0}),En(()=>window.removeEventListener("workshop:change",l));let a=y=>{let{slot:p}=y?.detail??{},h=p??b();pt(g=>g.type==="surge-level"&&g.slot===h)};window.addEventListener("surge:level:change",a,{passive:!0}),En(()=>window.removeEventListener("surge:level:change",a));let u=y=>{let{slot:p}=y?.detail??{},h=p??b();pt(g=>g.type==="tsunami-nerf"&&(g.slot==null||g.slot===h))};window.addEventListener("surge:nerf:change",u,{passive:!0}),En(()=>window.removeEventListener("surge:nerf:change",u));let f=y=>{let{slot:p}=y?.detail??{},h=p??b();pt(g=>g.type==="lab-level"&&(g.slot==null||g.slot===h)),pt(g=>g.type==="stat-mult"&&g.key==="rp"&&(g.slot==null||g.slot===h))};window.addEventListener("lab:level:change",f,{passive:!0}),En(()=>window.removeEventListener("lab:level:change",f));let d=y=>{let{id:p,level:h}=y?.detail??{},g=b();pt(v=>v.type==="lab-node-level"&&v.slot===g&&v.id===p),p===1&&pt(v=>v.type==="tsunami-nerf"&&(v.slot==null||v.slot===g)),p===4&&pt(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("lab:node:change",d,{passive:!0}),En(()=>window.removeEventListener("lab:node:change",d));let m=y=>{let{id:p,rp:h}=y?.detail??{},g=b();pt(v=>v.type==="lab-node-rp"&&v.slot===g&&v.id===p)};window.addEventListener("lab:node:rp",m,{passive:!0}),En(()=>window.removeEventListener("lab:node:rp",m))}function hf(){return[{key:Ee.STARTER_COVE,title:"The Cove",currencies:[{key:Re.COINS,label:"Coins"},{key:Re.BOOKS,label:"Books"},{key:Re.GOLD,label:"Gold"},{key:Re.MAGIC,label:"Magic"},{key:Re.GEARS,label:"Gears"},{key:Re.WAVES,label:"Waves"},{key:Re.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function mb(){if(document.getElementById(af))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=af;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=af,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=af,document.head.appendChild(n)}function th(){let e=document.getElementById(cb);e&&e.remove()}function v1(){return Ui&&Je&&b()!=null&&!Zl()&&m1()}function b1(e){e?.detail?.visible&&Fo(),vf()}function cf(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${fb++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function $n(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${db++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Rt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function ih(e,t=b()){let n=t??b();return n==null?null:`${wt.CURRENCY[e]}:${n}`}function Vl(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=R?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Oa(n,e)}catch{return c.fromInt(0)}}function S1(e,t,n=b()){let o=n??b(),r=Vl(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=ih(e,o),s=i&&xo(i);s&&pa(i);let l=r;try{_n(o),l=Zi(e,t,{previous:r})??r,i&&ct(i)}catch{}finally{s&&Gi(i)}return pt(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function so(e,t){return`${e??"null"}::${t}`}function sh(e,t){return Kl.get(so(e,t))??null}function I1(e,t=b()){let n=t??b();return!e||n==null?null:`${wt.MULTIPLIER[e]}:${n}`}function w1(e,t=b()){let n=so(t,e);Kl.delete(n),fa.delete(n),pt(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function ah(e,t){let n=!gf(t,e),o=so(e,t),r=Wl.get(o);if(!n&&r)return r;let i=E1(t,e);return i?(Wl.set(o,i),i):(n&&Wl.delete(o),null)}function hb(e,t){pt(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function gb(e,t=b()){let n=qi(e,t);if(Wl.delete(so(t,e)),Pi.delete(so(t,e)),!(!n||typeof localStorage>"u")&&!xo(n)){try{localStorage.removeItem(n)}catch{}hb(e,t)}}function gf(e,t=b()){return xo(qi(e,t))}function yb(e,t){return gf(t,e)?ah(e,t):null}function Gn(e,t=b()){let n=$i(e);return yf(e,t,n)??n}function qi(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${u1}:${e}:${n}`}function $i(e){try{if(e==="xp"){let t=Tc();if(t)return t}else if(e==="mutation"){let t=Sf?.();if(t)return t;let n=bf();if(n)return n}else if(e==="spawnRate"){let t=ms(Ee.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return qc()}catch{}return c.fromInt(1)}function E1(e,t=b()){let n=qi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function x1(e,t,n){let o=qi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=xo(o),s=i&&ua?ua:localStorage.setItem.bind(localStorage);i&&!ua&&pa(o),s(o,r.toStorage?.()??String(r)),i&&!ua&&Gi(o)}catch{}}function lh(e,t=b()){if(t==null)return;let n=sh(t,e);if(!n||t!==b())return;let o=so(t,e);if(!ff.has(o)){ff.add(o);try{let r=R?.[e]?.mult?.get?.();Rt(r,n)||R?.[e]?.mult?.set?.(n)}catch{}finally{ff.delete(o)}}}function vb(){if(!(ab||typeof window>"u")){ab=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=so(r,t);if(!r||!Kl.has(i)||ff.has(i))return;let s=fa.get(i),l=sh(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,m=l.mulBigNumInteger(f);Kl.set(i,m)}}catch{}fa.set(i,o)}else o&&fa.set(i,o);lh(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Jl()},{passive:!0})}catch{}}}function Jl(){let e=b();e!=null&&Object.values(Re).forEach(t=>{lh(t,e)})}function bb(e,t,n=b()){if(!e||n==null)return null;vb();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=so(n,e);if(Kl.set(r,o),!fa.has(r)){let i=R?.[e]?.mult?.get?.();fa.set(r,i)}return lh(e,n),o}function Yl(e,t=b()){return!e||t==null?null:sh(t,e)}function qn(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Wl.set(so(n,e),o),Pi.set(so(n,e),$i(e)),x1(e,n,o),hb(e,n),o}function L1(e,t=b()){return!e||t==null?null:ah(t,e)}function jn(e,t,n=b()){let o=$i(e),r=yf(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Rt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=so(n,e),l=Pi.get(s),a=gf(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function yf(e,t,n){let o=ah(t,e),r=so(t,e);if(!o)return Pi.delete(r),null;let i=Pi.get(r),s=gf(e,t);if(!i)Pi.set(r,n);else if(!Rt(i,n))return s?(Pi.set(r,n),o):(gb(e,t),null);return o}function _1(){if(!(ib||typeof localStorage>"u")){ib=!0;try{ua=localStorage.setItem.bind(localStorage),sb=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!da.has(e))return ua(e,t)},localStorage.removeItem=e=>{if(!da.has(e))return sb(e)}}catch{}}}function xo(e){return e!=null&&da.has(e)}function Gi(e){e&&(_1(),da.add(e))}function pa(e){e&&da.delete(e)}function M1(e){return e?xo(e)?(pa(e),!1):(Gi(e),!0):!1}function C1(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=xo(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(M1(e),typeof t=="function")try{t(xo(e))}catch{}o()}),o(),{button:n,refresh:o}}function T1(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>xo(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>xo(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?pa(u):Gi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function A1(){let e=document.getElementById(zl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function k1(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{xo(r)&&(o.push(r),pa(r))});try{return t?.()}finally{o.forEach(r=>Gi(r))}}function N1(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function ch(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function nh(e,t){e.classList.toggle("debug-invalid",!t)}function tt(){let e=b();try{_n(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function Sb(e=b()){return e==null?null:`${f1}:${e}`}function Ib(e=b()){let t=Sb(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function wb(e,t=b()){let n=Sb(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,eh);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function R1(e,t=b()){let n=Ib(t);return n.unshift(e),n.length>eh&&(n.length=eh),wb(n,t),n}function nt(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};R1(o,t),uh()}function uh(){if(!ca)return;let e=Ib();if(e.length===0){ca.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",ca.appendChild(t);return}ca.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function Eb(e=b()){return e==null?null:`${yl}:${e}`}function xb(e,t=b()){let n=Eb(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function Lb(e=b()){let t=Eb(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function O1(e){if(e){if(Object.values(Re).includes(e.type)){try{e.type===Re.BOOKS?R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount):R[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function P1(){let e=b();if(e==null)return{completed:0};let t=Lb(e),n=0;return Object.entries(uu).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,O1(r.reward))}),xb(t,e),{completed:n}}function B1(){let e=b();if(e==null)return{restored:0};let t=Lb(e),n=0;return Object.entries(uu).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),xb(t,e),{restored:n}}function ln(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,m=!1,y=r?C1(r,{onToggle:i}):null,p=g=>{if(f){d=g;return}d=null,u.value=typeof s=="function"?s(g):N1(g)};l.appendChild(u),y&&l.appendChild(y.button);let h=()=>{let g=ch(u.value);if(!g){nh(u,!1);return}nh(u,!0);let v=r&&xo(r);v&&pa(r);try{n(g,{input:u,setValue:p})}finally{v&&Gi(r),y&&y.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",h),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),m=!0,h(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,m||h(),m=!1,d!=null){let g=d;d=null,p(g)}}),p(t),y&&y.refresh(),{row:l,input:u,setValue:p,isEditing:()=>f}}function F1({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let h=document.createElement("span");h.className="debug-unlock-desc",h.textContent=`- ${t}`,f.appendChild(h)}s.appendChild(l),s.appendChild(f);let m=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",h=>{l.contains(h.target)||m()});let y=!1,p=()=>{let h=!1;try{h=typeof n=="function"?!!n():!1}catch{}return a.checked=h,y=h,h};return a.addEventListener("change",()=>{let h=y,g=a.checked;try{g?o?.():r?.()}catch{}tt();let v=p();h!==v&&nt(`Toggled ${e} [GOLD]${h?"True":"False"}[/GOLD] \u2192 [GOLD]${v?"True":"False"}[/GOLD]`)}),p(),$t({type:"unlock",slot:i,refresh:p}),s}function D1(e){try{if(e instanceof c||typeof e?.toScientific=="function")return K(e);let t=Number(e);return Number.isFinite(t)?K(t):String(e??"\u2014")}catch{return"\u2014"}}function U1({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:m})=>{if(d.type==="select"){u[d.key]=m.value;return}let y=ch(m.value),p=y instanceof c;if(nh(m,p),!p){f=!0;return}u[d.key]=y}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=D1(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:m,label:y})=>{let p=document.createElement("option");p.value=m,p.textContent=y??m,f.defaultValue!=null&&f.defaultValue===m&&(p.selected=!0),d.appendChild(p)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function Xr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return Qe()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{ti()}catch{}let f=Bi.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ct(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),m=Bi.level(n);localStorage.setItem(m,d),ct(m,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),m=Bi.progress(n);localStorage.setItem(m,d),ct(m,d)}catch{}try{is({forceReload:!0})}catch{}try{Mc({changeType:"debug-panel",slot:n})}catch{}try{pt()}catch{}}function Vr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return gt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,m=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&m!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{jl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{tn()}catch{}try{Ur()}catch{}let f=Fi.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ct(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),m=Fi.level(n);localStorage.setItem(m,d),ct(m,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),m=Fi.progress(n);localStorage.setItem(m,d),ct(m,d)}catch{}try{tn({forceReload:!0})}catch{}try{fh({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{pt()}catch{}}function $1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=ih(r.key,n),s=Vl(r.key,n),l=ln(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=Vl(r.key,f),{next:m}=S1(r.key,a,f);u(m),Rt(d,m)||(tt(),nt(`Modified ${r.label} (${o}) ${K(d)} \u2192 ${K(m)}`))},{storageKey:i,onLockChange:()=>l.setValue(Vl(r.key,b()))});$t({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=Vl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function q1(e,t){let n=b();if(n==null){let P=document.createElement("div");P.className="debug-panel-empty",P.textContent="Select a save slot to edit stats.",e.appendChild(P);return}let o="spawnRate",r=qi(o,n),i=ln("Coin Spawn Rate",Gn(o,n),(P,{setValue:G})=>{let M=b();if(M==null)return;let D=Gn(o,M);try{qn(o,P,M)}catch{}let T=Gn(o,M);G(T),Rt(D,T)||(tt(),nt(`Modified Spawn Rate (${a}) ${K(D)} \u2192 ${K(T)}`))},{storageKey:r,onLockChange:P=>{let G=b();if(G!=null){if(P){if(yb(G,o))return;try{qn(o,$i(o),G)}catch{}}else yf(o,G,$i(o));i.setValue(Gn(o,G))}}});$t({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Gn(o,n);i.setValue(P)}}),$t({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Gn(o,n);i.setValue(P)}}),e.appendChild(i.row);let s=Qe(),l=gt(),a=t?.title??t?.key??"Unknown Area",u=Bi.level(n),f=ln("XP Level",s.xpLevel,(P,{setValue:G})=>{let M=Qe().xpLevel;Xr({level:P});let D=Qe();G(D.xpLevel),Rt(M,D.xpLevel)||(tt(),nt(`Modified XP Level (${a}) ${K(M)} \u2192 ${K(D.xpLevel)}`))},{storageKey:u});$t({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(Qe().xpLevel)}}),e.appendChild(f.row);let d=Bi.progress(n),m=ln("XP Progress",s.progress,(P,{setValue:G})=>{let M=Qe(),D=M?.xpLevel?.clone?.()??M?.xpLevel,T=M?.progress?.clone?.()??M?.progress;Xr({progress:P});let _=Qe();G(_.progress),f.setValue(_.xpLevel),(!Rt(T,_.progress)||!Rt(D,_.xpLevel))&&(tt(),nt(`Modified XP Progress (${a}) ${K(T)} \u2192 ${K(_.progress)}`))},{storageKey:d});$t({type:"xp",slot:n,refresh:()=>{n===b()&&m.setValue(Qe().progress)}}),e.appendChild(m.row);let y=Fi.level(n),p=ln("MP Level",l.level,(P,{setValue:G})=>{let M=gt().level;Vr({level:P});let D=gt();G(D.level),Rt(M,D.level)||(tt(),nt(`Modified MP Level (${a}) ${K(M)} \u2192 ${K(D.level)}`))},{storageKey:y});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&p.setValue(gt().level)}}),e.appendChild(p.row);let h=Fi.progress(n),g=ln("MP Progress",l.progress,(P,{setValue:G})=>{let M=gt(),D=M?.level?.clone?.()??M?.level,T=M?.progress?.clone?.()??M?.progress;Vr({progress:P});let _=gt();G(_.progress),p.setValue(_.level),(!Rt(T,_.progress)||!Rt(D,_.level))&&(tt(),nt(`Modified MP Progress (${a}) ${K(T)} \u2192 ${K(_.progress)}`))},{storageKey:h});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&g.setValue(gt().progress)}}),e.appendChild(g.row);let v=Ei(n);if(v){let P=0;try{let M=localStorage.getItem(v),D=c.fromAny(M||"0");if(D.isInfinite())P=1/0;else try{P=Number(D.toScientific(20))}catch{P=0}}catch{}let G=ln("Workshop Level",P,(M,{setValue:D})=>{let T=Number(M);if(M instanceof c)if(M.isInfinite())T=1/0;else try{T=Number(M.toScientific(20))}catch{T=NaN}if(Number.isNaN(T)||T<0)return;let _=T===1/0?"Infinity":String(Math.floor(T));try{localStorage.setItem(v,_),tt(),nt(`Modified Workshop Level (The Cove) ${K(P)} \u2192 ${_}`),P=T}catch{}D(T)},{storageKey:v,onLockChange:()=>{let M=0;try{let D=localStorage.getItem(v),T=c.fromAny(D||"0");T.isInfinite()?M=1/0:M=Number(T.toScientific(20))}catch{}G.setValue(M)}});e.appendChild(G.row),$t({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let M=0;try{let D=localStorage.getItem(v),T=c.fromAny(D||"0");T.isInfinite()?M=1/0:M=Number(T.toScientific(20))}catch{}G.setValue(M)}})}let w=Ks(n);if(w){let P=0;try{let M=localStorage.getItem(w);M==="Infinity"?P=1/0:P=c.fromAny(M||"0")}catch{P=c.fromInt(0)}let G=ln("Surge Level",P,(M,{setValue:D})=>{let T="0",_=0;M instanceof c?M.isInfinite()?(T="Infinity",_=1/0):(T=M.toPlainIntegerString(),_=M):M===1/0||typeof M=="string"&&/infinity/i.test(M)?(T="Infinity",_=1/0):(T=String(M),_=M);try{localStorage.setItem(w,T),tt();let Y=_===1/0?"Infinity":K(_),Q=P===1/0||P instanceof c&&P.isInfinite()?"Infinity":K(P);nt(`Modified Surge Level (The Cove) ${Q} \u2192 ${Y}`),_===1/0?P=1/0:_ instanceof c?P=_:P=c.fromAny(_);let ae=!1;P===1/0?ae=!0:P instanceof c?typeof P.cmp=="function"&&P.cmp(8)>=0&&(ae=!0):typeof P=="number"&&P>=8&&(ae=!0),ae&&(Si(0),gn()||er(!0))}catch{}D(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let Y=P;if(Y!==1/0&&Y instanceof c)try{Y=BigInt(Y.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:Y}}))}catch{}},{storageKey:w,onLockChange:M=>{let D=c.fromInt(0);try{let T=localStorage.getItem(w);T==="Infinity"?D=1/0:D=c.fromAny(T||"0")}catch{}G.setValue(D)}});$t({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let M=c.fromInt(0);try{let D=localStorage.getItem(w);D==="Infinity"?M=1/0:M=c.fromAny(D||"0")}catch{}G.setValue(M)}}),e.appendChild(G.row)}let x=Jt(),C=ln("Lab Level",x,(P,{setValue:G})=>{let M;try{M=P instanceof c?P:c.fromAny(P),M.isNegative&&M.isNegative()&&(M=c.fromInt(0))}catch{G(Jt());return}let D=Jt();di(M),tt(),Rt(D,M)||nt(`Modified Lab Level (The Cove) ${K(D)} \u2192 ${K(M)}`),G(M)},{storageKey:Ad(n)});$t({type:"lab-level",slot:n,refresh:()=>{n===b()&&C.setValue(Jt())}}),e.appendChild(C.row);let k=()=>{let P=kn(),G=Zn(),M=P+G;return M>1&&(M=1),M},q=ln("Tsunami Exponent",k().toFixed(2),(P,{setValue:G})=>{let M=Number(P);if(P instanceof c?P.isInfinite()?M=1/0:M=Number(P.toScientific(10)):typeof P=="string"&&/infinity/i.test(P)&&(M=1/0),Number.isNaN(M)){G(k().toFixed(2));return}let D=Zn(),T=M-D;T>1&&(T=1),T<0&&(T=0),T=Math.round(T*100)/100;let _=kn();Si(T),tt(),Math.abs(_-T)>1e-4&&nt(`Modified Tsunami Exponent (The Cove) Base:${_.toFixed(2)} \u2192 ${T.toFixed(2)} (Effective: ${M.toFixed(2)})`),G(k().toFixed(2))},{storageKey:Kd(n),format:P=>{let G=Number(P);return Number.isFinite(G)?G.toFixed(2):String(P)}});$t({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let P=k();q.setValue(P.toFixed(2))}}),e.appendChild(q.row)}function Jm(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Ct(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=An(t.key,i.id??i.tie),u=Oi(t.key,i.id??i.tie,n),f=ln(l,a,(d,{setValue:m})=>{if(b()==null)return;let p=An(t.key,i.id??i.tie);try{cr(t.key,i.id??i.tie,d,!1)}catch{}let h=An(t.key,i.id??i.tie);m(h),Rt(p,h)||(tt(),nt(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${K(p)} \u2192 Lv${K(h)}`))},{idLabel:s,storageKey:u});$t({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=An(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function G1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=R?.[r.key]?.mult,l=Yl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${wt.MULTIPLIER[r.key]}:${n}`,u=ln(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let m=b();if(m==null)return;let y=Yl(r.key,m)??i?.get?.()??c.fromInt(1);try{bb(r.key,f,m)}catch{}Jl();let h=Yl(r.key,m)??i?.get?.()??c.fromInt(1);d(h),Rt(y,h)||(tt(),nt(`Modified ${r.label} Multiplier (${o}) ${K(y)} \u2192 ${K(h)}`))},{storageKey:a});$t({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=Yl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function H1(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Re).forEach(o=>{let r=R?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Rt(i,t))return;r.set(t),n+=1}catch{}}),n}function X1(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Re).forEach(o=>{let r=R?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function V1(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=Qe()}catch{}try{r=gt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Rt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Rt(o?.progress,t);(!i||!s)&&(Xr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Rt(r?.level,t),s=r?.progress?.isInfinite?.()||Rt(r?.progress,t);(!i||!s)&&(Vr({level:t,progress:t}),n+=1)}}catch{}try{let i=Ei(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Ks(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{pt()}catch{}return n}function Y1(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=Qe()}catch{}try{r=gt()}catch{}try{o?.unlocked&&(Xr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Vr({level:t,progress:t}),n+=1)}catch{}try{let i=Ei(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Ks(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{pt()}catch{}return n}function _b(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Qe()?.unlocked}catch{return!1}},onEnable:()=>{try{ti()}catch{}try{is({forceReload:!0})}catch{}},onDisable:()=>{try{ss({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{jl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{jl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return Np()}catch{return!1}},onEnable:()=>{try{Ci()}catch{}},onDisable:()=>{try{Eu()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return Rp()}catch{return!1}},onEnable:()=>{try{wu()}catch{}},onDisable:()=>{try{xu()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return Sp()}catch{return!1}},onEnable:()=>{try{lu(!0)}catch{}},onDisable:()=>{try{lu(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!gn()}catch{return!1}},onEnable:()=>{try{er(!0)}catch{}},onDisable:()=>{try{er(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return it(4)>=1}catch{return!1}},onEnable:()=>{try{vo(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{vo(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function Mb(e){let t=b();if(t==null)return 0;let n=0;_b(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{pt()}catch{}return n}function W1(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;hf().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Ri(o.key,r,e),t+=1}catch{}})});try{Ci()}catch{}try{wu()}catch{}let n=Mb(!0);return{unlocks:t,toggles:n}}function z1(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;hf().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Vm(o.key,r,e),t+=1}catch{}})});try{Eu()}catch{}try{xu()}catch{}let n=Mb(!1);return{locks:t,toggles:n}}function K1(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(ih(a,n)),r(I1(a,n))},s=a=>r(qi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(Bi.level(n)),r(Bi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(Fi.level(n)),r(Fi.progress(n)))};return e==="all"?(Object.values(Re).forEach(i),l("xp"),l("mutation"),pf.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Re).forEach(i),Array.from(o)):e==="allUnlockedStats"?(Qe()?.unlocked&&l("xp"),gt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Re).forEach(i),Qe()?.unlocked&&l("xp"),gt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function uf(e){try{R?.[e]?.set?.(c.fromInt(0))}catch{}try{w1(e)}catch{}try{vc(e,c.fromInt(1))}catch{}}function j1(e){if(e==="all"){Object.values(Re).forEach(i=>uf(i));let o=c.fromInt(0);return Xr({level:o,progress:o}),Vr({level:o,progress:o}),pf.forEach(({key:i})=>{try{qn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Re).length+pf.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Re).forEach(i=>{uf(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(Qe()?.unlocked){Xr({level:o,progress:o});try{qn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(gt()?.unlocked){Vr({level:o,progress:o});try{qn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Re).forEach(l=>{uf(l),o+=1});let r=c.fromInt(0),i=0;try{if(Qe()?.unlocked){Xr({level:r,progress:r});try{qn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(gt()?.unlocked){Vr({level:r,progress:r});try{qn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return uf(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{gb(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Xr({level:n,progress:n});try{qn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Vr({level:n,progress:n});try{qn("mutation",c.fromInt(1))}catch{}return"MP"}try{qn(t,c.fromInt(1))}catch{}return`stat ${t}`}function Z1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";pf.forEach(r=>{if(r.key==="spawnRate")return;let i=qi(r.key,n),s=ln(`${r.label} Multiplier`,Gn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Gn(r.key,u);try{qn(r.key,l,u)}catch{}let d=Gn(r.key,u);a(d),Rt(f,d)||(tt(),nt(`Modified ${r.label} Multiplier (${o}) ${K(f)} \u2192 ${K(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if(yb(a,r.key))return;try{qn(r.key,$i(r.key),a)}catch{}}else yf(r.key,a,$i(r.key));s.setValue(Gn(r.key,a))}}});$t({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Gn(r.key,n);s.setValue(l)}}),$t({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Gn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&$t({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Gn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function J1(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Nt||Nt.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Nt.forEach(n=>{let o=$n(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=rl(t,n.id),s=ln("Level",it(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let m=it(n.id);vo(n.id,d),tt(),m!==d&&nt(`Modified Node ${n.id} Level (The Cove) ${m} \u2192 ${d}`),f(d)},{storageKey:i});$t({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(it(n.id))}}),r.appendChild(s.row);let l=il(t,n.id),a=ln("Current RP",go(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(go(n.id));return}let m=go(n.id);yi(n.id,d),tt(),Rt(m,d)||nt(`Modified Node ${n.id} RP (The Cove) ${K(m)} \u2192 ${K(d)}`),f(d)},{storageKey:l});$t({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(go(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function Q1(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)},{label:"Pending DNA (Experiment)",inputs:[{key:"labLevel",label:"Lab Level"},{key:"xpLevel",label:"XP Level"},{key:"isSurge9",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 9? No"},{value:"Yes",label:"Surge 9? Yes"}]}],compute:({labLevel:n,xpLevel:o,isSurge9:r})=>window.resetSystem?.computePendingDnaFromInputs?.(n,o,r==="Yes")}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Cc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>hd(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>dh(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>zs(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>kr(n)},{label:"Lab Level RP Boost",inputs:[{key:"level",label:"Lab Level"},{key:"isSurge12",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 12? No"},{value:"Yes",label:"Surge 12? Yes"}]}],compute:({level:n,isSurge12:o})=>{let r=0;if(n instanceof c){if(n.isInfinite())return c.fromAny("Infinity");try{r=Number(n.toScientific(10))}catch{r=0}}else r=Number(n);if(!Number.isFinite(r))return c.fromInt(1);if(o==="Yes"){let s=dt(),l=5*s,a=2+s/2,u=Math.log10(a),f=r*u+l;return ie(f)}let i=r*Math.log10(2);return ie(i)}}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>Ym(n,o,r)},{label:"Currency Generation Percentage",inputs:[{key:"tsunamiExp",label:"Tsunami Exponent"}],compute:({tsunamiExp:n})=>{let o=Number(n);if(n instanceof c&&(o=n.isInfinite()?1/0:Number(n.toScientific(10))),!Number.isFinite(o))return"\u2014";let r=o*1.5-.5,i=Math.pow(100,r);return Te(i)+"%"}}]}].forEach(n=>{let o=$n(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=U1({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function eL(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Jl(),hf().forEach(o=>{let r=$n(o.title,i=>{let s=$n("Currencies",p=>{$1(p,o)}),l=$n("Stats",p=>{q1(p,o)}),a=$n("Multipliers",p=>{let h=$n("Currencies",v=>{G1(v,o)}),g=$n("Stats",v=>{Z1(v,o)});p.appendChild(h),p.appendChild(g)}),u=$n("Upgrades",p=>{Jm(p,o)}),f=null,d=null,m=null;o.key===Ee.STARTER_COVE&&(f=$n("Automation Upgrades",p=>{Jm(p,{key:Ee.AUTOMATION,title:"Automation"})}),d=$n("DNA Upgrades",p=>{Jm(p,{key:Ee.DNA,title:"DNA"})}),m=$n("Lab Nodes",p=>{J1(p)}));let y=$n("Calculators",p=>{Q1(p)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),m&&i.appendChild(m),i.appendChild(y)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function tL(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ee),r=[];return o.forEach(i=>{Ct(i).forEach(l=>{e&&No(i,l.id).locked||r.push({areaKey:i,upg:l})})}),ql(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;cr(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function nL(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ee),r=[];o.forEach(s=>{Ct(s).forEach(a=>{e&&No(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{ql(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Mr(s,l.id,"0"),cr(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function lb(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Ct(Ze);ql(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;cr(Ze,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(ps),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Ee).forEach(l=>{if(l===Ze)return;Ct(l).forEach(u=>{s.has(u.costType)&&(Mr(l,u.id,n),o++)})}),Mr(Ze,fo,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function oL(e){e.innerHTML="";let t=b();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=P1();tt(),nt(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=B1();tt(),nt(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=H1();tt(),nt(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=V1();tt(),nt(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=X1();tt(),nt(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=Y1();tt(),nt(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"Max All Upgs",onClick:()=>{let g=tL(!1);tt(),nt(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=nL(!1);tt(),nt(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=lb(!0);tt(),nt(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=lb(!1);tt(),nt(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:v}=W1();tt(),nt(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:v}=z1();tt(),nt(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Max All Lab Nodes",onClick:()=>{let g=0;Nt.forEach(v=>{Number.isFinite(v.maxLevel)&&(vo(v.id,v.maxLevel),g++)}),tt(),nt(`Maxed ${g} Lab Nodes.`)}},{label:"All Lab Nodes 0",onClick:()=>{let g=0;Nt.forEach(v=>{vo(v.id,0),yi(v.id,0),jo(v.id)&&pi(v.id,!1),g++}),tt(),nt(`Reset ${g} Lab Nodes to 0 (Level & RP).`)}},{label:"Wipe Action Log",onClick:()=>{wb([],t),uh(),tt(),nt("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=b();if(g!=null)try{localStorage.setItem(d1(g),String(p1)),nr(!0),tt(),nt("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let v=ch(g);if(!v||typeof v.isZero=="function"&&v.isZero()||typeof v.isNegative=="function"&&v.isNegative())return;let w,x=!1;Gt()?w=Ns(v):(w=tu(v),x=!0),xi(w);let C=v.mulSmall?v.mulSmall(1e3):v.mulBigNumInteger(c.fromInt(1e3));Nr(w,C,x),tt(),nt(`Performed OP Time Warp for ${K(v)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle debug-misc-button",v.textContent=g.label,v.addEventListener("click",g.onClick),o.appendChild(v)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",hf().forEach(g=>{let v=document.createElement("optgroup");v.label=g.title||g.key,g.currencies.forEach(w=>{let x=document.createElement("option");x.value=`currency:${w.key}`,x.textContent=`${g.title||g.key} \u2192 ${w.label}`,v.appendChild(x)}),g.stats.forEach(w=>{let x=document.createElement("option");x.value=`stat:${w.key}`,x.textContent=`${g.title||g.key} \u2192 ${w.label}`,v.appendChild(x)}),s.appendChild(v)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${lf}"]`)||(lf=Xl),s.value=lf;let d=()=>K1(s.value||Xl,b()),m=T1(d);s.addEventListener("change",()=>{lf=s.value||Xl,m.refresh()}),m.refresh(),r.appendChild(s),r.appendChild(m.button);let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle reset-check",y.textContent="\u2705",y.addEventListener("click",()=>{let g=s.value||Xl,v=d(),w=m.isLocked(),x=(C=!0)=>{let k=k1(v,()=>j1(g))??{label:g,count:0};if(w&&v.forEach(q=>Gi(q)),m.refresh(),tt(),C){let{label:q,count:P}=k;nt(`Reset ${P===1?"value and multiplier":"values and multipliers"} for ${q} to defaults.`)}};x(!0),setTimeout(()=>x(!1),100)}),r.appendChild(y),e.appendChild(r);let p=document.createElement("div");p.className="debug-panel-row";let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle debug-danger-button",h.textContent="Wipe Slot & Refresh",h.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let v=document.querySelector(".menu-root"),w=document.getElementById("game-root");v&&(v.hidden=!1,v.style.display="",v.style.visibility=""),w&&(w.hidden=!0,w.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),p.appendChild(h),e.appendChild(p)}function rL(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{is()}catch{}let n=_b(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(F1(o))})}function Cb(){if(!Ui||Zl())return;pb(),mb(),fb=0,db=0;let e=document.getElementById(zl);e&&e.remove();let t=document.createElement("div");t.id=zl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Fo({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Fo()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let m=document.createElement("div");m.className="debug-panel-info-line",d&&m.classList.add("debug-panel-info-mobile-hidden"),m.textContent=f,a.appendChild(m)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(cf("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{eL(f)})),t.appendChild(cf("Unlocks: modify specific unlock flags","debug-unlocks",f=>{rL(f)})),t.appendChild(cf("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),ca=d,uh(),En(()=>{ca=null})})),t.appendChild(cf("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{oL(f)})),g1(t),document.body.appendChild(t),df>0)try{t.scrollTop=df}catch{}y1(),Di=!0}function oh(){if(!(!Ui||Zl())){if(b()==null){Fo();return}Di||Cb()}}function Fo({preserveExpansionState:e=!1}={}){ub=e?h1():mf();let t=document.getElementById(zl);if(t){try{df=t.scrollTop??0}catch{df=0}t.remove()}pb(),Di=!1}function iL(){if(!Ui||Zl()||b()==null){Fo();return}Di?Fo({preserveExpansionState:!0}):oh()}function sL(){Fo(),th()}function vf(){if(!v1()){th(),Fo();return}mb(),th();let e=document.createElement("button");e.id=cb,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{iL()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function aL(e){if(Ui=!!e,!Ui){sL();return}vf()}function lL(e){aL(e)}var af,zl,cb,Xl,Di,Ui,Qm,ub,df,lf,fb,db,rh,ca,Kl,fa,ff,Wl,Pi,da,ib,ua,sb,u1,f1,eh,d1,p1,jm,Bi,Zm,Fi,pf,ab,ls=Ue(()=>{xt();qt();St();Tn();ho();yo();mo();Lu();Us();ws();po();hn();Is();ai();cp();mi();Zo();nu();af="debug-panel-style",zl="debug-panel",cb="debug-panel-toggle",Xl=`currency:${Re.COINS}`,Di=!1,Ui=!1,Qm=[],ub=mf(),df=0,lf=Xl,fb=0,db=0,rh=[],ca=null,Kl=new Map,fa=new Map,ff=new Set,Wl=new Map,Pi=new Map,da=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=da);ib=!1,ua=null,sb=null,u1="ccc:debug:stat-mult",f1="ccc:actionLog",eh=100,d1=e=>`ccc:warp:charges:${e}`,p1=24;jm="ccc:xp",Bi={unlock:e=>`${jm}:unlocked:${e}`,level:e=>`${jm}:level:${e}`,progress:e=>`${jm}:progress:${e}`},Zm="ccc:mutation",Fi={unlock:e=>`${Zm}:unlocked:${e}`,level:e=>`${Zm}:level:${e}`,progress:e=>`${Zm}:progress:${e}`},pf=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];ab=!1;Jl();vb();document.addEventListener("keydown",e=>{if(!(!Ui||Zl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){Di?(A1(),Fo()):oh(),e.preventDefault();return}Di?Fo({preserveExpansionState:!0}):oh(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{vf()});window.addEventListener("menu:visibilitychange",b1);window.addEventListener("saveSlot:change",()=>{vf(),Di&&Cb()})});var Rb={};bt(Rb,{addExternalMutationGainMultiplierProvider:()=>ui,addMutationPower:()=>Os,broadcastMutationChange:()=>fh,computeMutationMultiplierForLevel:()=>zs,computeMutationRequirementForLevel:()=>dh,getMutationCoinSprite:()=>_m,getMutationGainMultiplier:()=>Sf,getMutationMultiplier:()=>bf,getMutationState:()=>gt,getTotalCumulativeMp:()=>tr,initMutationSystem:()=>tn,isMutationUnlocked:()=>Oo,onMutationChange:()=>Ni,setMutationUnlockedForDebug:()=>jl,unlockMutationSystem:()=>Ur});function If(e){try{return e?.toStorage?.()}catch{return null}}function Yi(){try{Zt()}catch{}}function Nb(e){let t=e;if(!t.isZero?.()){let n=Vi.size>0?Array.from(Vi):typeof tc=="function"?[tc]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:U.level.clone?.()??U.level,mutationUnlocked:U.unlocked});r instanceof et?t=r.clone?.()??r:r!=null&&(t=et.fromAny(r))}catch{}}return t}function fL(){if(typeof ph=="function"){try{ph()}catch{}ph=null}if(typeof mh=="function"){try{mh()}catch{}mh=null}}function nc(e){if(e instanceof et)try{return e.clone?.()??et.fromAny(e)}catch{return vt()}try{return et.fromAny(e??0)}catch{return vt()}}function dL(e){if(!e||typeof e!="object")return vt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?et.fromInt(100):et.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function Ef(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=we(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Ih(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let m=Math.pow(1.12,l-10);if(!Number.isFinite(m)||(f+=uL*(m-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=Ef(e);if(!Number.isFinite(n))return et.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return et.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return et.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return et.fromAny("Infinity");let i=ie(r);return dL(i)}function Yr(){let e=U.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");U.requirement=o.clone?.()??o,U.progress=o.clone?.()??o}catch{(!U.requirement||typeof U.requirement!="object")&&(U.requirement=c.fromInt(0)),(!U.progress||typeof U.progress!="object")&&(U.progress=c.fromInt(0))}return}let n=Ih(U.level);U.requirement=n}function pL(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=we(e),l=we(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function vh(){return Hn.container&&Hn.container.isConnected?!0:(Hn.container=document.querySelector("[data-mp-hud].mp-counter"),Hn.container?(Hn.bar=Hn.container.querySelector(".mp-bar"),Hn.fill=Hn.container.querySelector(".mp-bar__fill"),Hn.levelValue=Hn.container.querySelector(".mp-level-value"),Hn.progress=Hn.container.querySelector("[data-mp-progress]"),!0):!1)}function Hi(e){try{return K(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function hr(){if(!vh())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Hn;if(!e)return;if(!U.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Hi(U.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Hi(U.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}ts();return}e.removeAttribute("hidden");let i=U.requirement,s=pL(U.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Hi(U.level)),r){let a=Hi(U.progress),u=Hi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Hi(U.progress).replace(/<[^>]*>/g,""),u=Hi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}ts()}function gr(e="update",t={}){let n=gt(),o={...n,slot:U.slot??b(),changeType:e,...t};if(yh.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function wh(){let e=U.slot;if(e==null&&(e=b(),e!=null&&(U.slot=e)),e==null)return;try{localStorage.setItem(Ql(e),U.unlocked?"1":"0")}catch{}try{localStorage.setItem(Xi(e),U.level.toStorage())}catch{}try{localStorage.setItem(ma(e),U.progress.toStorage())}catch{}ct(Ql(e)),ct(Xi(e)),ct(ma(e));let t=(()=>{let u=U.unlocked,f=U.level,d=U.progress;try{u=localStorage.getItem(Ql(e))==="1"}catch{}try{let m=localStorage.getItem(Xi(e));m&&(f=et.fromAny(m))}catch{}try{let m=localStorage.getItem(ma(e));m&&(d=et.fromAny(m))}catch{}return{unlocked:u,level:f,progress:d}})(),n=If(t.level),o=If(t.progress),r=If(U.level),i=If(U.progress),s=t.unlocked!==U.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&wf(t,{skipPersist:!0})}function bh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function mL(){if(!U.unlocked)return;let e=U.slot??b();if(e!=null&&bh(Xi(e))){Yr();return}Yr();let t=U.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;U.progress.cmp?.(t)>=0&&n<o;){if(U.progress=U.progress.sub(t),U.level=U.level.add(ha()),Yr(),t=U.requirement,!t||typeof t!="object"){U.progress=vt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(U.progress=vt())}function wf(e,{skipPersist:t=!1}={}){U.unlocked=!!e.unlocked,U.level=nc(e.level),U.progress=nc(e.progress),U.unlocked||(U.level=vt(),U.progress=vt()),Yr(),t||wh(),hr(),gr("load"),Yi()}function hh(e){let t=e??b();if(t==null){wf({unlocked:!1,level:vt(),progress:vt()},{skipPersist:!0}),U.slot=null;return}let n=!1,o=vt(),r=vt();try{n=localStorage.getItem(Ql(t))==="1"}catch{}try{let i=localStorage.getItem(Xi(t));i&&(o=et.fromAny(i))}catch{}try{let i=localStorage.getItem(ma(t));i&&(r=et.fromAny(i))}catch{}wf({unlocked:n,level:o,progress:r},{skipPersist:!0}),U.slot=t}function hL(){for(;ec.length;){let e=ec.pop();try{e?.()}catch{}}}function gh(e){Ab!==e&&(hL(),Ab=e,e!=null&&(ec.push(At(Ql(e),{onChange(t){let n=t==="1";U.unlocked!==n&&(U.unlocked=n,n||(U.level=vt(),U.progress=vt()),Yr(),hr(),gr("storage"),Yi())}})),ec.push(At(Xi(e),{onChange(t){if(t)try{let n=et.fromAny(t);U.level.cmp?.(n)!==0&&(U.level=n,Yr(),hr(),gr("storage"),Yi())}catch{}}})),ec.push(At(ma(e),{onChange(t){if(t)try{let n=et.fromAny(t);U.progress.cmp?.(n)!==0&&(U.progress=n,Yr(),hr(),gr("storage"))}catch{}}}))))}function tn({forceReload:e=!1}={}){if(fL(),kb){let n=b();return(n!==U.slot||e)&&hh(n),gh(n),vh(),hr(),gt()}kb=!0,vh();let t=b();return U.slot=t,hh(t),gh(t),hr(),Yi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();U.slot=n,hh(n),gh(n),hr(),Yi(),gr("slot")}),gt()}function gt(){return{unlocked:U.unlocked,level:nc(U.level),progress:nc(U.progress),requirement:nc(U.requirement)}}function Oo(){return!!U.unlocked}function Ur(){return tn(),U.unlocked?!1:(U.unlocked=!0,Yr(),wh(),hr(),gr("unlock"),Yi(),!0)}function jl(e){tn();let t=!!e;wf({unlocked:t,level:t?U.level:vt(),progress:t?U.progress:vt()})}function Os(e){tn();let t=U.slot??b();if(t!=null&&bh(ma(t))||!U.unlocked)return gt();let n=t!=null&&bh(Xi(t));if(U.level&&U.level.isInfinite?.()){let f=U.level.clone?.()??U.level,d=U.progress.clone?.()??U.progress;if(!U.progress?.isInfinite?.())try{U.progress=et.fromAny("Infinity")}catch{}if(!U.requirement?.isInfinite?.())try{U.requirement=et.fromAny("Infinity")}catch{}let m;try{m=e instanceof et?e:et.fromAny(e??0)}catch{m=vt()}return m=Nb(m),m=jn("mutation",m),gr("progress",{delta:m.clone?.()??m,levelsGained:vt(),level:U.level.clone?.()??U.level,progress:U.progress.clone?.()??U.progress,requirement:U.requirement.clone?.()??U.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof et?e:et.fromAny(e??0)}catch{o=vt()}if(o=Nb(o),o=jn("mutation",o),o.isZero?.())return gt();let r=o.clone?.()??o,i=U.level.clone?.()??U.level,s=U.progress.clone?.()??U.progress;if(U.progress=U.progress.add(r),U.progress.isInfinite?.()){if(!n)try{U.level=et.fromAny("Infinity")}catch{}try{U.progress=et.fromAny("Infinity")}catch{U.progress=vt()}try{U.requirement=et.fromAny("Infinity")}catch{}}else mL();wh(),hr();let a=U.level.sub(i);return a.isZero?.()||Yi(),gr("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:U.level.clone?.()??U.level,progress:U.progress.clone?.()??U.progress,requirement:U.requirement.clone?.()??U.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function fh(e={}){tn();let t=e.changeType??"manual";return gr(t,e)}function zs(e){let t;if(e instanceof et)try{t=e.clone?.()??e}catch{t=vt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=vt()}else try{t=c.fromAny(e??0)}catch{t=vt()}if(t&&t.isInfinite?.())try{return et.fromAny("Infinity")}catch{return ha()}let n=Ef(t);if(!Number.isFinite(n))try{return et.fromAny("Infinity")}catch{return ha()}if(n<=0)return ha();let o=n*cL;return ie(o)}function dh(e){let t;try{t=e instanceof et?e:et.fromAny(e??0)}catch{t=vt()}try{return Ih(t)}catch{return vt()}}function bf(){if(tn(),!U.unlocked)return ha();try{return zs(U.level)}catch{return ha()}}function Sf(){let e=c.fromInt(1);if(Vi.size>0||tc){let t=Vi.size>0?Array.from(Vi):typeof tc=="function"?[tc]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:U.level.clone?.()??U.level,mutationUnlocked:U.unlocked});o instanceof et?e=o.clone?.()??o:o!=null&&(e=et.fromAny(o))}catch{}}return e}function _m(){if(!U.unlocked||U.level.isZero?.())return"img/currencies/coin/coin.webp";let e=Ef(U.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function Ni(e){return typeof e!="function"?()=>{}:(yh.add(e),()=>{yh.delete(e)})}function ui(e){return typeof e!="function"?()=>{}:(Vi.add(e),()=>{Vi.delete(e)})}function tr(){if(tn(),!U.unlocked)return vt();if(U.level.isInfinite?.()||U.progress.isInfinite?.())return c.fromAny("Infinity");let e=Ef(U.level);if(Number.isFinite(e)&&e>100)return U.progress.clone?.()??U.progress;let t=U.progress.clone?.()??U.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=Ih(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Sh,Ql,Xi,ma,et,vt,ha,cL,uL,U,Hn,yh,ec,Ab,kb,ph,mh,Vi,tc,ho=Ue(()=>{xt();St();ls();qt();xt();rd();Tn();Sh="ccc:mutation",Ql=e=>`${Sh}:unlocked:${e}`,Xi=e=>`${Sh}:level:${e}`,ma=e=>`${Sh}:progress:${e}`,et=c,vt=()=>et.fromInt(0),ha=()=>et.fromInt(1),cL=Math.log10(2),uL=9/(Math.pow(1.12,50)-1);U={unlocked:!1,level:vt(),progress:vt(),requirement:vt(),slot:null},Hn={container:null,bar:null,fill:null,levelValue:null,progress:null},yh=new Set,ec=[],Ab=null,kb=!1,ph=null,mh=null,Vi=new Set,tc=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:tn,unlockMutationSystem:Ur,addMutationPower:Os,getMutationState:gt,getMutationMultiplier:bf,isMutationUnlocked:Oo,getTotalCumulativeMp:tr,addExternalMutationGainMultiplierProvider:ui,getMutationGainMultiplier:Sf}))});var oc,Ob,Pb,Eh,xh,Lh,Bb=Ue(()=>{oc=`precision highp float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,Ob=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\n\nvoid main() {\n    /* Wave animation settings */\n    float speed = 1.2;\n    float time = uTime * speed;\n    \n    /* Combine sine waves for a more natural look */\n    /* vUv.x is 0..1 across the screen width */\n    float wave1 = sin(vUv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n\n    /* Define the shoreline height (baseline) */\n    /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */\n    /* We want to discard pixels below this threshold */\n    float threshold = 0.428 + wave; \n\n    if (threshold > vUv.y) {\n        discard;\n    }\n\n    /* Recalculate gradient based on the new "bottom" */\n    /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */\n    float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0);\n    \n    vec3 col = mix(uColorShallow, uColorDeep, gradientY);\n    \n    /* Add a subtle "foam" or highlight at the edge */\n    float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold);\n    col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4);\n    \n    gl_FragColor = vec4(col, 1.0);\n}`,Pb=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uWaveMap; \nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\nuniform vec3 uColorWaveDeep;  \nuniform vec3 uColorWave;      \n\n/* Simple noise for foam breakup */\nfloat hash(vec2 p) {\n    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\n}\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f*f*(3.0-2.0*f);\n    return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),\n               mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y);\n}\n\nvoid main() {\n    vec2 uv = vUv;\n    \n    /* Sample the simulation (physics) */\n    /* Wave Logic */\n    vec2 waveUV = uv - vec2(0.0, 0.0285);\n    float intensity = texture2D(uWaveMap, waveUV).r;\n    \n    /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */\n    float shadowOffset = 8.0 / uResolution.y; \n    float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r;\n    \n    /* Discard only if BOTH are empty */\n    if (0.01 > intensity && 0.01 > shadowIntensity) discard;\n    \n    /* Directional Noise: Streaky vertical noise for rushing water effect */\n    /* Stretch heavily along Y-axis to simulate speed/motion blur */\n    float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0));\n    \n    /* Define Zones based on Intensity */\n    /* Body (Medium Intensity): Darker/turbulent blue with noise */\n    /* Edge (High Intensity): Bright white foam */\n    \n    float foamThreshold = 0.5;\n    float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity);\n    \n    /* Base Colors */\n    vec3 bodyColor = uColorWaveDeep;\n    vec3 foamColor = uColorWave;\n    \n    /* Mix Colors */\n    vec3 finalColor = mix(bodyColor, foamColor, foamMix);\n    \n    /* Add streaks to the body part */\n    if (0.9 > foamMix) {\n        finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix);\n    }\n    \n    /* Hard Edge & Opacity */\n    /* Ensure the front (bottom) remains sharp, back trails off */\n    \n    /* Calculate Alpha based on Intensity */\n    /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */\n    /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */\n    /* Low Intensity (Top/Tail): Fades to 0.0 */\n    \n    float finalAlpha = smoothstep(0.02, 0.15, intensity);\n    \n    /* Screen Fade */\n    /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */\n    \n    /* Dynamic Shoreline Fade */\n    /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */\n    /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */\n    float speed = 1.2;\n    float time = uTime * speed;\n    float wave1 = sin(uv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n    float threshold = 0.428 + wave;\n    \n    /* Fade out quickly after exiting the water body (below threshold) */\n    /* Fade starts slightly higher than the threshold to soften the transition */\n    /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */\n    float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y);\n    \n    float screenFade = shoreFade;\n    \n    /* --- Composite Shadow & Wave --- */\n    float waveAlpha = finalAlpha * screenFade;\n    \n    /* Shadow Alpha */\n    float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity);\n    /* Shadow is weaker (40% opacity) */\n    float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade;\n    \n    /* Mix: Wave over Shadow */\n    /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */\n    float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha);\n    \n    /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */\n    /* Shadow is black (RGB=0), so second term is 0 */\n    vec3 outRGB = finalColor * waveAlpha; \n    \n    gl_FragColor = vec4(outRGB, outAlpha);\n}`,Eh=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,xh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Lh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var Ub={};bt(Ub,{WaterSystem:()=>xf,waterSystem:()=>Lf});function Db(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function ga(e,t,n){let o=Db(e,e.VERTEX_SHADER,t),r=Db(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var gL,Fb,yL,vL,xf,Lf,_h=Ue(()=>{Bb();gL=[.2,.5,.9],Fb=[.2,.9,1],yL=[1,1,1],vL=[.45,.8,1];xf=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:ga(s,oc,Pb),simProgram:ga(s,oc,Lh),brushProgram:ga(s,Eh,xh),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=ga(this.glBg,oc,Ob),this.bgSimProgram=ga(this.glBg,oc,Lh),this.bgBrushProgram=ga(this.glBg,Eh,xh)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,m=a/this.height,y=new Float32Array([u-d,f-m,0,0,1,u+d,f-m,1,0,1,u-d,f+m,0,1,1,u+d,f+m,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,y,t.DYNAMIC_DRAW);let p=t.getAttribLocation(n,"aPosition"),h=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(p),t.vertexAttribPointer(p,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let m=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=m.readFBO,f.writeFBO=m.writeFBO,f.readTexture=m.readTex,f.writeTexture=m.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),gL),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),Fb),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),Fb),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),yL),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),vL),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let m=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(m),d.vertexAttribPointer(m,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},Lf=new xf});var Vb={};bt(Vb,{createSpawner:()=>_L});function Xb(e){if(!e||typeof e!="object"){ya=!1,Wi=0n;return}ya=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Wi=n&&n!=="Infinity"?BigInt(n):0n}catch{Wi=0n}}function SL(e){let t=1-e;return 1-t*t*t}function wL(e){if(!e)return null;let t=$b.get(e);return t||(t=new Image,t.src=e,$b.set(e,t)),t}function _L({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=Je?bL:1e4,initialBurst:d=1,coinTtlMs:m=1e99,waveSoundSrc:y="sounds/wave_spawn.ogg",waveSoundDesktopVolume:p=.45,waveSoundMobileVolume:h=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:v=!1}={}){let w=o,x={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function C(){return!!(x.pf&&x.w&&x.c)}C()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let k=7,q=[],P=[],G=!1;if(x.c)for(let I=0;I<k;I++){let A=document.createElement("canvas");A.style.position="absolute",A.style.inset="0",A.style.pointerEvents="none",A.style.zIndex=`${10+I*10}`,x.c.appendChild(A);let O=A.getContext("2d",{alpha:!0});q.push(A),P.push(O)}let M=null,D=null;x.c&&(M=document.createElement("canvas"),M.style.position="absolute",M.style.inset="0",M.style.pointerEvents="none",M.style.zIndex="100",x.c.appendChild(M),D=M.getContext("2d",{alpha:!0}));let T={collectBatch:null,getMagnetUnit:null};function _(I){T={...T,...I}}let Y={pfRect:null,wRect:null,safeBottom:0,pfW:0};function Q(){if(!C())return!1;let I=x.pf.getBoundingClientRect(),A=x.w.getBoundingClientRect(),O=x.hud?x.hud.getBoundingClientRect().height:0;Y={pfRect:I,wRect:A,safeBottom:I.height-O,pfW:I.width};let N=window.devicePixelRatio||1;return q.forEach((B,pe)=>{if(B){B.width=I.width*N,B.height=I.height*N,B.style.width=I.width+"px",B.style.height=I.height+"px";let me=P[pe];me&&(me.setTransform(1,0,0,1,0,0),me.scale(N,N),me.imageSmoothingEnabled=!0,me.imageSmoothingQuality="high")}}),G=!0,M&&(M.width=I.width*N,M.height=I.height*N,M.style.width=I.width+"px",M.style.height=I.height+"px",D&&(D.setTransform(1,0,0,1,0,0),D.scale(N,N))),!0}Q();let ae="ResizeObserver"in window?new ResizeObserver(()=>Q()):null;ae&&x.pf&&ae.observe(x.pf),document.addEventListener("visibilitychange",()=>{document.hidden||Q()});let he=(I,A,O)=>Math.max(A,Math.min(O,I)),be=Math.max(2e3,f*3),Oe=12,Ae=[],F=[],W=0,$=[],X=[];function J(){let I=document.createElement("div");I.className="coin",I.style.position="absolute",I.style.pointerEvents="auto",I.style.borderRadius="50%",I.style.willChange="transform",I.style.contain="layout style size";let A=document.createElement("img");return A.className="coin-inner",A.draggable=!1,A.alt="",A.style.width="100%",A.style.height="100%",A.src=w,A.style.objectFit="contain",A.style.borderRadius="50%",I.appendChild(A),v&&(I.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),I}let le=()=>Ae.length?Ae.pop():J();function fe(I){I.style.transition="",I.style.transform="",I.style.opacity="1",I.classList.remove("coin--collected");for(let A=0;A<=6;A++)I.classList.remove(`coin--size-${A}`);I.style.removeProperty("--ccc-start"),delete I.dataset.dieAt,delete I.dataset.mutationLevel,delete I.dataset.collected,I.style.willChange="transform",I.parentNode&&I.remove(),Ae.length<be&&Ae.push(I)}function L(I,A=-1){if(I.isRemoved)return;I.isRemoved=!0;let O=A;(O===-1||F[O]!==I)&&(I.index!==void 0&&F[I.index]===I?O=I.index:O=F.indexOf(I)),O!==-1&&(F[O]=null,W++),I.el?(fe(I.el),I.el=null):X.push({layer:I.sizeIndex||0,x:I.x,y:I.y,size:I.size||r})}function H(I){let A=I._coinObj;if(A){let O=-1;A.index!==void 0&&F[A.index]===A?O=A.index:O=F.indexOf(A),O!==-1&&(F[O]=null,W++),I._coinObj=null}}let z=new URL(y,document.baseURI).href,de=0;function ee(){let I=performance.now();if(I-de<g)return;de=I,ft(z,{volume:Je?h:p,type:"music"})}function re(){if(!C())return null;if((!Y.pfRect||!Y.wRect)&&Q(),f!==1/0&&F.length-W>=f){let _t=-1;if(se(2))for(let Bt=0;Bt<F.length;Bt++){let _o=F[Bt];if(_o&&_o.sizeIndex<4){_t=Bt;break}}else for(let Bt=0;Bt<F.length;Bt++)if(F[Bt]){_t=Bt;break}if(_t===-1)return null;let Pt=F[_t];Pt&&L(Pt,_t)}let I=Y.pfW,A=Y.wRect.top-Y.pfRect.top,O=Math.max(0,A),N=0;if(se(2)){let _t=Math.random();for(let Pt=6;Pt>=1;Pt--)if(_t<xL[Pt]){N=Pt;break}}N>=4&&Bl&&Bl()&&(N=3);let B=qb[N],pe=Oe+(N>=3?15*(N-2):0),me=pe,Le=Math.max(me,I-B-pe),Me=me+Math.random()*(Le-me),Ke=Math.random()*100-50,He;if(B>=Y.pfW)He=(Y.pfW-B)/2;else{let _t=Y.pfW-B-pe;me>=_t?He=(Y.pfW-B)/2:He=he(Me+Ke,me,_t)}let $e=Math.min(Y.wRect.height,Y.pfRect.height*.3),Ce=Math.max($e+80,120),Pe=Math.max(Ce+40,Y.safeBottom-B-6),Ie=he(Ce+Math.random()*(Pe-Ce),Ce,Pe),Ye={x0:Me,y0:O,x1:He,y1:Ie,jitterMs:0},rt=Y.pfRect.left-Y.wRect.left,Xe=LL[N],Ot=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),lt=.85+Math.random()*.3,Et=Ot*(Xe.w/100)*lt,Wt=Ot*(Xe.h/100)*lt,zt=Me+B/2+rt,Vn=O-A;return{wave:{x:zt,y:Vn,width:Et,height:Wt},coin:Ye,sizeIndex:N}}function ge(I){if(!I.length||!C())return;let A=document.createDocumentFragment(),O=[],N=performance.now(),B=!1;for(let{wave:pe,coin:me,sizeIndex:Le}of I){if(pe&&(B=!0,Lf)){let Pe=Le>=4;Lf.addWave(pe.x,pe.y,pe.width,pe.height,Pe)}let Me=qb[Le],Ke=1;if(se(8)){let Pe=jd(),Ie=Math.pow(25,Pe);Ke=Math.pow(Ie,Le)}else Ke=EL[Le];let He=Le>=4,$e=le();$e.style.width=`${Me}px`,$e.style.height=`${Me}px`,$e.className=`coin coin--size-${Le}`,$e.firstChild&&($e.firstChild.src=w),$e.style.transform=`translate3d(${me.x0}px, ${me.y0}px, 0) rotate(-10deg) scale(0.96)`,$e.style.opacity="0",ya?$e.dataset.mutationLevel=Wi.toString():$e.dataset.mutationLevel="0";let Ce={mutationLevel:ya?Wi.toString():"0",el:$e,src:w,x:me.x0,y:me.y0,rot:-10,scale:.96,startX:me.x0,startY:me.y0,endX:me.x1,endY:me.y1,startTime:N+me.jitterMs,duration:i,dieAt:N+m,jitterMs:me.jitterMs,isRemoved:!1,settled:!1,size:Me,sizeIndex:Le,valueMultiplier:Ke,forceDom:He,soundSrc:Hb[Le]?`sounds/coin_pickup${Hb[Le]}`:null,bMinX:Math.min(me.x0,me.x1)-Me,bMaxX:Math.max(me.x0,me.x1)+Me,bMinY:Math.min(me.y0,me.y1)-Me,bMaxY:Math.max(me.y0,me.y1)+Me};$e._coinObj=Ce,Ce.index=F.length,F.push(Ce),O.push(Ce),A.appendChild($e)}x.c.appendChild(A),O.length>0&&(O[0].el&&O[0].el.offsetHeight,requestAnimationFrame(()=>{for(let pe of O)pe.el&&(pe.el.style.transition=`transform ${i}ms ${IL} ${pe.jitterMs}ms`,pe.el.style.transform=`translate3d(${pe.endX}px, ${pe.endY}px, 0) rotate(0deg) scale(1)`,pe.el.style.opacity="1")})),B&&requestAnimationFrame(()=>{ee()})}function Be(I=1){if(!C())return;(!Y.pfRect||!Y.wRect)&&Q();let A=[];for(let O=0;O<I;O++){let N=re();N&&A.push(N)}A.length&&ge(A)}function ne(I,A){if(I.settled||I.isRemoved)return{x:I.x,y:I.y,rot:0,scale:1};let O=A-I.startTime;if(O<0)return{x:I.startX,y:I.startY,rot:-10,scale:.96};let N=O/I.duration;if(N>=1)return{x:I.endX,y:I.endY,rot:0,scale:1};let B=SL(N),pe=I.startX+(I.endX-I.startX)*B,me=I.startY+(I.endY-I.startY)*B,Le=-10+10*B,Me=.96+.04*B;return{x:pe,y:me,rot:Le,scale:Me}}function ve(I,A){let O=wL(A.src);if(O&&O.complete&&O.naturalWidth>0){let N=A.size||r;I.drawImage(O,A.x,A.y,N,N)}}function De(){if(P.length)if(G){P.forEach((A,O)=>{q[O]&&(A.save(),A.setTransform(1,0,0,1,0,0),A.clearRect(0,0,q[O].width,q[O].height),A.restore(),v&&(A.save(),A.shadowColor="rgba(0,0,0,0.35)",A.shadowBlur=2,A.shadowOffsetY=2))});let I=F.length;for(let A=0;A<I;A++){let O=F[A];if(O&&O&&O.settled&&!O.isRemoved&&!O.el){let N=O.sizeIndex||0;P[N]&&ve(P[N],O)}}v&&P.forEach(A=>A.restore()),G=!1,$.length=0,X.length=0}else{if(X.length>0){v&&P.forEach(A=>{A.save(),A.shadowColor="rgba(0,0,0,0.35)",A.shadowBlur=2,A.shadowOffsetY=2});let I=F.length;for(let A=0;A<X.length;A++){let O=X[A],N=P[O.layer];if(!N)continue;let B=8,pe=O.x-B,me=O.y-B,Le=O.size+B*2;N.save(),N.beginPath(),N.rect(pe,me,Le,Le),N.clip(),N.clearRect(pe,me,Le,Le);let Me=pe,Ke=pe+Le,He=me,$e=me+Le;for(let Ce=0;Ce<I;Ce++){let Pe=F[Ce];if(!Pe||!Pe.settled||Pe.isRemoved||Pe.el||(Pe.sizeIndex||0)!==O.layer)continue;let Ie=Pe.size||r,je=Pe.x,Ye=Pe.x+Ie,rt=Pe.y,Xe=Pe.y+Ie;Ye>Me&&je<Ke&&Xe>He&&rt<$e&&ve(N,Pe)}N.restore()}v&&P.forEach(A=>A.restore()),X.length=0}if($.length>0){v&&P.forEach(I=>{I.save(),I.shadowColor="rgba(0,0,0,0.35)",I.shadowBlur=2,I.shadowOffsetY=2});for(let I=0;I<$.length;I++){let A=$[I];if(!A.isRemoved&&A.settled&&!A.el){let O=A.sizeIndex||0;P[O]&&ve(P[O],A)}}v&&P.forEach(I=>I.restore()),$.length=0}}}let ke=a,Fe=null,ce=performance.now(),te=0;function xe(I){(!Y.pfRect||!Y.wRect)&&Q();let A=(I-ce)/1e3;ce=I,A>.1&&(A=.1);for(let N=F.length-1;N>=0;N--){let B=F[N];if(!B||!B)continue;if(I>=B.dieAt){L(B,N);continue}if(B.sizeIndex===5&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=I-1e3,B.nextLightningInterval=0),I-B.lastLightningTime>B.nextLightningInterval)){B.lastLightningTime=I,B.nextLightningInterval=200+Math.random()*100;for(let Le=0;Le<3;Le++)qo(B,I)}if(B.sizeIndex===6&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=I-1e3,B.nextLightningInterval=0),I-B.lastLightningTime>B.nextLightningInterval&&(B.lastLightningTime=I,B.nextLightningInterval=200+Math.random()*100,T.collectBatch))){let Le=ne(B,I),Me=Le.x+B.size/2,Ke=Le.y+B.size/2,He=[],$e=B.size/2*(B.size/2),Ce=F.length;for(let Pe=0;Pe<Ce;Pe++){let Ie=F[Pe];if(!Ie||Ie===B||Ie.isRemoved||Ie.settled===!1||Ie.sizeIndex>3)continue;let je=Ie.x+(Ie.size||r)/2,Ye=Ie.y+(Ie.size||r)/2,rt=je-Me,Xe=Ye-Ke;rt*rt+Xe*Xe>$e&&He.push(Ie)}if(He.length>0){for(let Ye=He.length-1;Ye>0;Ye--){let rt=Math.floor(Math.random()*(Ye+1));[He[Ye],He[rt]]=[He[rt],He[Ye]]}let Pe=He.slice(0,3),Ie=[],je=!1;for(let Ye of Pe){let rt=Ye.size||r,Xe=Ye.x+rt/2,Ot=Ye.y+rt/2;yr(B,Xe,Ot),$o(Xe,Ot,rt),Ie.push({coin:Ye}),je||(ft("sounds/lightning_strike.ogg",{volume:.25}),je=!0)}Ie.length>0&&T.collectBatch(Ie)}}if(B.settled)continue;let pe=I-B.startTime;if(pe<0)continue;if(pe/B.duration>=1){B.settled=!0,B.x=B.endX,B.y=B.endY,B.rot=0,B.scale=1,B.el&&!B.forceDom?(fe(B.el),B.el=null,$.push(B)):B.el&&(B.el.style.transition="none",B.el.style.transform=`translate3d(${B.x}px, ${B.y}px, 0) rotate(0deg) scale(1)`);continue}}te+=ke*A;let O=Math.floor(te);if(O>0){te-=O;let N=Math.min(O,u);if(N>0){let B=performance.now(),pe=[],me=5;for(let Le=0;Le<N&&!(performance.now()-B>me);Le++){let Me=re();Me&&pe.push(Me)}pe.length&&ge(pe)}}if(De(),W>50){let N=0;for(let B=0;B<F.length;B++){let pe=F[B];pe!==null&&(pe.index=N,F[N++]=pe)}F.length=N,W=0}Ne(A),Fe=requestAnimationFrame(xe)}function E(){if(!Fe){if(!C()){console.warn("[Spawner] start() called but required nodes are missing.");return}Q(),d>0&&Fe===null&&Be(d),ce=performance.now(),Fe=requestAnimationFrame(xe)}}function j(){Fe&&(cancelAnimationFrame(Fe),Fe=null)}function Z(I){ke=Math.max(0,Number(I)||0)}function oe(){te=0,ce=performance.now()}function ye(I){let A=se(2)&&!!I;for(let O=F.length-1;O>=0;O--){let N=F[O];if(N&&N){if(A&&N.sizeIndex>=4){N.mutationLevel=ya?Wi.toString():"0",N.el&&(N.el.dataset.mutationLevel=N.mutationLevel);continue}L(F[O],O)}}oe()}function ue(I){I&&(w=I)}function We(I){let A=I._coinObj;if(!A)return I.style.transform||"translate3d(0,0,0)";let{x:O,y:N,rot:B,scale:pe}=ne(A,performance.now());return`translate3d(${O}px, ${N}px, 0) rotate(${B}deg) scale(${pe})`}function ot(I){if(I.el)return I.el;if(I.isRemoved)return null;let A=le(),O=I.size||r;return A.style.width=`${O}px`,A.style.height=`${O}px`,A.className=`coin coin--size-${I.sizeIndex||0}`,A.style.transition="",A.style.transform=`translate3d(${I.x}px, ${I.y}px, 0) rotate(0deg) scale(1)`,A.firstChild&&(A.firstChild.src=I.src),A.style.opacity="1",A.dataset.mutationLevel=I.mutationLevel,A._coinObj=I,I.el=A,x.c.appendChild(A),X.push({layer:I.sizeIndex||0,x:I.x,y:I.y,size:I.size||r}),A}function Se(I,A,O,N){let B=O;N&&(B=Math.max(O,260));let pe=O*O,me=[],Le=F.length,Me=I-B,Ke=I+B,He=A-B,$e=A+B,Ce=performance.now();for(let Pe=0;Pe<Le;Pe++){let Ie=F[Pe];if(!Ie||Ie.bMaxX<Me||Ie.bMinX>Ke||Ie.bMaxY<He||Ie.bMinY>$e)continue;let je=Ie.size||r,Ye,rt;if(Ie.settled)Ye=Ie.x+je/2,rt=Ie.y+je/2;else{let Et=ne(Ie,Ce);Ye=Et.x+je/2,rt=Et.y+je/2}if(Ye<Me||Ye>Ke||rt<He||rt>$e)continue;let Xe=Ye-I,Ot=rt-A,lt=pe;if(N&&(Ie.sizeIndex||0)>0){let Et=je/2;lt=Et*Et}Xe*Xe+Ot*Ot<=lt&&(Ie.isRemoved||me.push(Ie))}return me}function Ge(I,A,O,N,B,pe){let me=B;pe&&(me=Math.max(B,260));let Le=B*B,Me=[],Ke=F.length,He=Math.min(I,O)-me,$e=Math.max(I,O)+me,Ce=Math.min(A,N)-me,Pe=Math.max(A,N)+me,Ie=O-I,je=N-A,Ye=Ie*Ie+je*je,rt=Le*Ye,Xe=performance.now();for(let Ot=0;Ot<Ke;Ot++){let lt=F[Ot];if(!lt||lt.bMaxX<He||lt.bMinX>$e||lt.bMaxY<Ce||lt.bMinY>Pe)continue;let Et=lt.size||r,Wt,zt;if(lt.settled)Wt=lt.x+Et/2,zt=lt.y+Et/2;else{let fn=ne(lt,Xe);Wt=fn.x+Et/2,zt=fn.y+Et/2}if(Wt<He||Wt>$e||zt<Ce||zt>Pe)continue;let Vn=Wt-I,_t=zt-A,Pt=Vn*Ie+_t*je,Bt=Le;if(pe&&(lt.sizeIndex||0)>0){let fn=Et/2;Bt=fn*fn}let _o=!1;if(Pt<=0)Vn*Vn+_t*_t<=Bt&&(_o=!0);else if(Pt>=Ye){let fn=Wt-O,Ma=zt-N;fn*fn+Ma*Ma<=Bt&&(_o=!0)}else{let fn=Vn*je-_t*Ie;fn*fn<=Bt*Ye&&(_o=!0)}_o&&!lt.isRemoved&&Me.push(lt)}return Me}function Yt(I){L(I)}function mt(I,A,O){let N=O*O,B=[],pe=F.length,me=I-O,Le=I+O,Me=A-O,Ke=A+O,He=performance.now();for(let $e=0;$e<pe;$e++){let Ce=F[$e];if(!Ce||Ce.bMaxX<me||Ce.bMinX>Le||Ce.bMaxY<Me||Ce.bMinY>Ke)continue;let Pe=Ce.size||r,Ie,je;if(Ce.settled)Ie=Ce.x+Pe/2,je=Ce.y+Pe/2;else{let Xe=ne(Ce,He);Ie=Xe.x+Pe/2,je=Xe.y+Pe/2}if(Ie<me||Ie>Le||je<Me||je>Ke)continue;let Ye=Ie-I,rt=je-A;Ye*Ye+rt*rt<=N&&(!Ce.el&&!Ce.isRemoved&&ot(Ce),Ce.el&&B.push(Ce.el))}return B}function un(I,A,O,N,B){let pe=B*B,me=[],Le=F.length,Me=Math.min(I,O)-B,Ke=Math.max(I,O)+B,He=Math.min(A,N)-B,$e=Math.max(A,N)+B,Ce=O-I,Pe=N-A,Ie=Ce*Ce+Pe*Pe,je=pe*Ie,Ye=performance.now();for(let rt=0;rt<Le;rt++){let Xe=F[rt];if(!Xe||Xe.bMaxX<Me||Xe.bMinX>Ke||Xe.bMaxY<He||Xe.bMinY>$e)continue;let Ot=Xe.size||r,lt,Et;if(Xe.settled)lt=Xe.x+Ot/2,Et=Xe.y+Ot/2;else{let Pt=ne(Xe,Ye);lt=Pt.x+Ot/2,Et=Pt.y+Ot/2}if(lt<Me||lt>Ke||Et<He||Et>$e)continue;let Wt=lt-I,zt=Et-A,Vn=Wt*Ce+zt*Pe,_t=!1;if(Vn<=0)Wt*Wt+zt*zt<=pe&&(_t=!0);else if(Vn>=Ie){let Pt=lt-O,Bt=Et-N;Pt*Pt+Bt*Bt<=pe&&(_t=!0)}else{let Pt=Wt*Pe-zt*Ce;Pt*Pt<=je&&(_t=!0)}_t&&(!Xe.el&&!Xe.isRemoved&&ot(Xe),Xe.el&&me.push(Xe.el))}return me}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;Fe||E()}});function Xn(){C()&&Be(1)}let Ut=[],xn=[];function Kr(I,A){if(!I||!A)return;let O=I.size||r,N=A.size||r,B=I.x+O/2,pe=I.y+O/2,me=A.x+N/2,Le=A.y+N/2;Ut.push({x1:B,y1:pe,x2:me,y2:Le,age:0,life:.15})}function $o(I,A,O){if(!x.pf)return;let N=document.createElement("div");N.className="coin-stain";let B=O*1.2;N.style.width=`${B}px`,N.style.height=`${B}px`,N.style.left=`${I-B/2}px`,N.style.top=`${A-B/2}px`,x.pf.appendChild(N),setTimeout(()=>{N.style.opacity="0",setTimeout(()=>{N.parentNode&&N.remove()},1e3)},2500)}function qo(I,A){let O=Math.random()*Math.PI*2,N=(I.size||r)/2,B=N*Gb,pe=Math.cos(O)*B,me=Math.sin(O)*B,Le=N*(.7+Math.random()*.6),Me=Math.cos(O)*(B+Le),Ke=Math.sin(O)*(B+Le);Ut.push({parentCoin:I,relX1:pe,relY1:me,relX2:Me,relY2:Ke,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let He=3+Math.floor(Math.random()*3);for(let $e=0;$e<He;$e++){let Ce=.3+Math.random()*.5,Pe=pe+(Me-pe)*Ce,Ie=me+(Ke-me)*Ce,je=O+(Math.random()*1.2-.6),Ye=Le*(.4+Math.random()*.4),rt=Pe+Math.cos(je)*Ye,Xe=Ie+Math.sin(je)*Ye;Ut.push({parentCoin:I,relX1:Pe,relY1:Ie,relX2:rt,relY2:Xe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ft("sounds/lightning_zap.ogg",{volume:.25})}function yr(I,A,O){if(!I)return;let N=I.size||r,B=performance.now(),pe=ne(I,B),me=pe.x+N/2,Le=pe.y+N/2,Me=A-me,Ke=O-Le,He=Math.atan2(Ke,Me),$e=Math.sqrt(Me*Me+Ke*Ke),Ce=N/2*Gb,Pe=Math.cos(He)*Ce,Ie=Math.sin(He)*Ce;Ut.push({parentCoin:I,relX1:Pe,relY1:Ie,x2:A,y2:O,age:0,life:.25,width:6,jaggedScale:25});let je=me+Pe,Ye=Le+Ie,rt=6+Math.floor(Math.random()*5);for(let Xe=0;Xe<rt;Xe++){let Ot=.1+Math.random()*.8,lt=je+(A-je)*Ot,Et=Ye+(O-Ye)*Ot,Wt=He+(Math.random()*1.6-.8),zt=$e*(.1+Math.random()*.3),Vn=lt+Math.cos(Wt)*zt,_t=Et+Math.sin(Wt)*zt;if(Ut.push({x1:lt,y1:Et,x2:Vn,y2:_t,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Bt=lt+(Vn-lt)*.5,_o=Et+(_t-Et)*.5,fn=Wt+(Math.random()*1-.5),Ma=zt*.5;Ut.push({x1:Bt,y1:_o,x2:Bt+Math.cos(fn)*Ma,y2:_o+Math.sin(fn)*Ma,age:0,life:.25,width:1.5,jaggedScale:10})}}}function Ne(I){if(!D||!M)return;D.clearRect(0,0,M.width,M.height);let A=performance.now();D.lineCap="round",D.lineJoin="round";for(let O=Ut.length-1;O>=0;O--){let N=Ut[O];if(N.age+=I,N.age>=N.life){Ut.splice(O,1);continue}let B=N.x1,pe=N.y1,me=N.x2,Le=N.y2;if(N.parentCoin){let He=ne(N.parentCoin,A),$e=He.x+(N.parentCoin.size||r)/2,Ce=He.y+(N.parentCoin.size||r)/2;B=$e+N.relX1,pe=Ce+N.relY1,N.relX2!==void 0&&(me=$e+N.relX2,Le=Ce+N.relY2)}let Me=1-N.age/N.life;D.strokeStyle=`rgba(200, 240, 255, ${Me})`,D.lineWidth=N.width||3,D.shadowColor="rgba(220, 245, 255, 0.9)",D.shadowBlur=20;let Ke=6;D.beginPath(),D.moveTo(B,pe);for(let He=1;He<=Ke;He++){let $e=He/Ke,Ce=B+(me-B)*$e,Pe=pe+(Le-pe)*$e;if(He===Ke)D.lineTo(me,Le);else{let Ie=-(Le-pe),je=me-B,Ye=Math.sqrt(Ie*Ie+je*je),rt=N.jaggedScale||40;if(Ye>0){let Xe=(Math.random()-.5)*rt*(1-Math.abs($e-.5));D.lineTo(Ce+Ie/Ye*Xe,Pe+je/Ye*Xe)}else D.lineTo(Ce,Pe)}}D.stroke(),D.shadowBlur=0}for(let O=xn.length-1;O>=0;O--){let N=xn[O];if(N.age+=I,N.age>=N.life){xn.splice(O,1);continue}N.x+=N.vx*I,N.y+=N.vy*I;let B=1-N.age/N.life;D.fillStyle=N.color,D.globalAlpha=B,D.beginPath(),D.arc(N.x,N.y,N.size,0,Math.PI*2),D.fill(),D.globalAlpha=1}}return{start:E,stop:j,setRate:Z,clearBacklog:oe,clearPlayfield:ye,setCoinSprite:ue,getCoinTransform:We,findCoinsInRadius:mt,findCoinsInPath:un,findCoinTargetsInRadius:Se,findCoinTargetsInPath:Ge,ensureCoinVisual:ot,removeCoinTarget:Yt,detachCoin:H,recycleCoin:fe,playEntranceWave:Xn,setDependencies:_,hasBigCoins:()=>se(2)&&F.some(I=>I&&I.sizeIndex>=4)}}var ya,Wi,bL,$b,IL,qb,Gb,EL,xL,Hb,LL,Yb=Ue(()=>{Ic();ho();yo();hn();Ln();_h();po();ya=!1,Wi=0n,bL=2500,$b=new Map;try{Xb(gt())}catch{ya=!1,Wi=0n}try{Ni(e=>{Xb(e)})}catch{}IL="cubic-bezier(0.215, 0.61, 0.355, 1)";qb=[40,55,80,125,200,320,512],Gb=.78,EL=[1,25,625,15625,390625,9765625,244140625],xL=[0,.1,.01,.001,1e-4,1e-5,1e-6],Hb=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],LL=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var eS={};bt(eS,{afterSlotWrite:()=>kh,beforeSlotWrite:()=>Ah});function Zb(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function AL(e,t=CL){!e||e<=0||rc.set(e,Zb()+t)}function zb(e){if(!e||e<=0)return!1;let t=rc.get(e);return t==null?!1:t<=Zb()?(rc.delete(e),!1):!0}function kL(){rc.clear()}function Mf(){try{return typeof localStorage<"u"}catch{return!1}}function Th(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function Jb(e){let t=new Map;if(!Mf())return ic.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Qi))continue;let r=Th(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return ic.set(e,t),t}function Qb(e){return!Number.isFinite(e)||e<=0?null:ic.has(e)?ic.get(e):Jb(e)}function Ah(e){if(!Mf()||_f>0)return;let t=String(e);if(!t.startsWith(Qi))return;let n=Th(t);if(n==null)return;let o=Qb(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(_f===0){_f+=1;try{_n(n)}finally{_f-=1}}Jb(n);return}}}catch{}}function kh(e,t){let n=String(e);if(!n.startsWith(Qi))return;let o=Th(n);if(o==null)return;let r=Qb(o)||new Map;r.set(n,String(t??"")),ic.set(o,r)}function NL(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function RL(){let e=new Map;if(!Mf())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Qi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=Zf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function OL(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function PL(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=Jf(e);if(n.length===0){o&&(zb(e)||_n(e),gc(e,null));return}let r=NL(n);o&&r!==o&&!zb(e)&&_n(e),r!==o&&gc(e,r)}function ba(){if(!Mf())return;let e=RL();OL(e).forEach(n=>{let o=e.get(n)??[];PL(n,o)})}function BL(){if(Mh!=null)return;Mh=(typeof window<"u"?window:globalThis).setTimeout(()=>{Mh=null,ba()},TL)}function FL(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){AL(o),BL();return}rc.delete(o),ba()}}function DL(){typeof window>"u"||Wb==null&&(Wb=window.setInterval(ba,ML))}function UL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function va(){let e=UL();if(!e)return;if(!es()){(e.dataset.poopShopApplied===Ch||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==Kb||e.dataset.poopShopApplied!==Ch)&&(e.style.backgroundImage=Kb,e.dataset.poopShopApplied=Ch)}function $L(){typeof window>"u"||jb==null&&(va(),jb=window.setInterval(va,50),window.addEventListener("saveSlot:change",va),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&va()}catch{va()}}))}function qL(){typeof window>"u"||(ba(),DL(),$L(),window.addEventListener("saveSlot:change",()=>ba()),window.addEventListener("saveIntegrity:storageMutation",FL,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(kL(),ba(),va())}))}var ML,CL,TL,Wb,Mh,rc,ic,_f,Kb,Ch,jb,Nh=Ue(()=>{St();ML=1e4,CL=750,TL=50,Wb=null,Mh=null,rc=new Map;ic=new Map,_f=0;Kb="linear-gradient(180deg,#a9793d,#7b5534)",Ch="1",jb=null;qL()});var uS={};bt(uS,{initPopups:()=>YL,teardownpopups:()=>WL});function Rh(){return Lo||(Lo=document.createElement("div"),Lo.className="currency-popups",Lo.setAttribute("aria-live","polite"),Lo.setAttribute("aria-atomic","false"),document.body.appendChild(Lo),Lo)}function zi(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function Oh(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function nS(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):K(n);t&&(t.innerHTML=r)}function HL(e,t=oS){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{sc.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function XL(e,t,n){Rh();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function Ph(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(jt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(jt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Re).includes(e)&&dn(e,o))return}let r=GL[e],i=Object.assign({duration:oS,accumulate:!0},r||{},n);if(!i.icon)return;let s=zi(t);if(!s||Oh(s))return;let l=i.accumulate!==!1?sc.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,nS(l);return}let a=XL(e,i,s);a.meta=i,nS(a),sc.set(e,a);let u=Rh(),f=tS.indexOf(e),d=null;if(f>=0){let m=Array.from(u.children);for(let y of m){let p=y.dataset.type;if(tS.indexOf(p)>f){d=y;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),HL(a,i.duration)}function VL(){let e={};for(let t of Object.values(Re))e[t]=Ra(t);return e}function rS(){try{let e=VL();Object.entries(e).forEach(([t,n])=>{let o=zi(n)||c.fromInt(0);Wr.set(t,o.clone?.()??o)}),Wr.has("mp")||Wr.set("mp",c.fromInt(0))}catch{Wr.clear()}}function iS(){sc.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),sc.clear()}function sS(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=zi(t.value)||c.fromInt(0),r=Wr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?zi(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&Ph(n,s),Wr.set(n,o.clone?.()??o)}function aS(e){let t=e?.detail;if(!t)return;let n=zi(t.xpAdded);n&&!Oh(n)&&Ph("xp",n)}function lS(e){let t=e?.detail;if(!t)return;let n=zi(t.delta);n&&!Oh(n)&&Ph("mp",n);let o=zi(t.progress);o&&Wr.set("mp",o.clone?.()??o)}function cS(){iS(),rS()}function YL(){Cf||(Cf=!0,Rh(),rS(),window.addEventListener("currency:change",sS),window.addEventListener("xp:change",aS),window.addEventListener("mutation:change",lS),window.addEventListener("saveSlot:change",cS))}function WL(){Cf&&(window.removeEventListener("currency:change",sS),window.removeEventListener("xp:change",aS),window.removeEventListener("mutation:change",lS),window.removeEventListener("saveSlot:change",cS),iS(),Wr.clear(),Lo&&Lo.remove(),Lo=null,Cf=!1)}var oS,tS,GL,Lo,Cf,Wr,sc,fS=Ue(()=>{xt();qt();St();oS=6767,tS=["coins","xp","books","gold","mp","magic","gears","dna"],GL={[Re.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Re.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Re.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Re.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Re.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Re.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},Lo=null,Cf=!1,Wr=new Map,sc=new Map});var bS={};bt(bS,{flushBackupSnapshot:()=>vS,getSuspendMetadata:()=>u_,installSuspendSafeguards:()=>c_,markProgressDirty:()=>Do,restoreFromBackupIfNeeded:()=>l_});function ac(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function xa(){if(typeof localStorage>"u")return!1;try{let e=`${ao}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function hS(){if(!ac())throw new Error("IndexedDB unavailable");return Sa||(Sa=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(zL,KL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(Ea)||r.createObjectStore(Ea)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}Sa=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw Sa=null,e}),Sa)}function QL(){if(!xa())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(ao))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function e_(e){try{let t=await hS();return await new Promise((n,o)=>{let r=!1,i=t.transaction(Ea,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(Ea).put(e,mS);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function t_(){try{let e=await hS();return await new Promise((t,n)=>{let o=!1,r=e.transaction(Ea,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(Ea).get(mS);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function n_(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function Bh(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function o_(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function i_(e){return!(typeof e!="string"||e.length===0||r_.test(e))}function Fh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(ao)||n.startsWith(jL)||n.startsWith(ZL))return;let o=o_(n);if(o!=null)try{let r={key:n,slot:o,trusted:i_(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function s_(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=Bh(),a=String(i),u=this===localStorage&&a.startsWith(ao);if(u)try{Ah(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Do("setItem");try{kh(a,s)}catch{}}this===localStorage&&a.startsWith(ao)&&Fh(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=Bh(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(ao)&&(Do("removeItem"),Fh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=Bh(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Do("clear"),Fh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function gS(e="idle"){wa=e||wa,zr=!0,!Ia&&(Ia=setTimeout(()=>{if(Ia=null,!zr)return;let t=wa;zr=!1,vS(t)},JL))}function yS(){Ia&&(clearTimeout(Ia),Ia=null)}function Do(e="dirty"){try{gS(e)}catch{}}async function Dh(e="manual"){if(!xa()||!ac())return!1;let t=QL();if(!t)return!1;t.reason=e,Af=!1;let n=await e_(t);return n||(zr=!0,gS("retry")),n}async function vS(e="manual",{immediate:t=!1}={}){return!xa()||!ac()?!1:t?(yS(),zr=!1,Af=!0,Dh(e)):(zr=!0,wa=e||wa,Dh(e))}function Tf(e){!ac()||!xa()||(yS(),zr=!1,Af=!0,Dh(e))}function a_(){if(!xa())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(ao))return!0}}catch{}return!1}async function l_(){if(pS||(pS=!0,!xa()||!ac()))return!1;let e=!1;try{if(!a_())e=!0;else{let o=localStorage.getItem(`${ao}saveSlot`);if(o){let r=`${ao}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await t_();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Do("restored"),n}function c_(){if(dS||(dS=!0,typeof window>"u"))return;n_(),s_();let e=()=>{document.hidden?Tf("visibility-hidden"):Do("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>Tf("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>Tf("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>Tf("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Do("pageshow"))}catch{}try{window.addEventListener("focus",()=>Do("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(ao)||Do("storage-event"))})}catch{}Do("boot")}function u_(){return{pendingImmediateFlush:Af,dirty:zr,lastDirtyReason:wa}}var ao,zL,KL,Ea,mS,jL,ZL,JL,Sa,Ia,zr,wa,dS,pS,Af,r_,SS=Ue(()=>{Nh();ao="ccc:",zL="ccc:safety",KL=1,Ea="snapshots",mS="latest",jL=`${ao}slotSig`,ZL=`${ao}slotMod`,JL=1e3,Sa=null,Ia=null,zr=!1,wa="init",dS=!1,pS=!1,Af=!1;r_=/\bat <anonymous>:\d+:\d+\b/});var IS={};bt(IS,{initGlobalOverlayEsc:()=>p_});function d_(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i,closeAll:s}of f_){let l=document.querySelectorAll(o);if(l.length>0){if(i){t=!0;continue}if(s)l.forEach(a=>{let u=a.querySelector(r||".shop-close");u&&(u.click(),n=!0)});else{let u=l[l.length-1].querySelector(r||".shop-close");u&&(u.click(),n=!0)}}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function p_(){window.addEventListener("keydown",d_,!0)}var f_,wS=Ue(()=>{f_=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close",closeAll:!0}]});var ES={};bt(ES,{ensureGameDom:()=>m_});function m_(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var xS=Ue(()=>{});var LS={};bt(LS,{SHOW_FPS:()=>h_,initFpsTracker:()=>g_});function g_(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var h_,_S=Ue(()=>{h_=!0});var TS={};bt(TS,{initNotifications:()=>S_,showNotification:()=>CS,unpauseNotifications:()=>v_});function y_(){return La||(La=document.createElement("div"),La.className="notification-container",document.body.appendChild(La),La)}function v_(){MS=!1,$h()}async function $h(){if(Uh||MS||kf.length===0)return;Uh=!0;let{text:e,iconSrc:t,duration:n}=kf.shift();await b_(e,t,n),Uh=!1,kf.length>0&&$h()}function b_(e,t,n){return new Promise(o=>{let r=y_(),i=document.createElement("div");if(i.className="notification",t){let l=document.createElement("img");l.src=t,l.className="notification-icon",l.alt="",i.appendChild(l)}let s=document.createElement("div");s.className="notification-text",s.innerHTML=e,i.appendChild(s),r.appendChild(i),ft("sounds/notif_ding.ogg",{volume:.5}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.classList.add("is-visible")})}),setTimeout(()=>{i.classList.remove("is-visible"),i.classList.add("is-leaving");let l=()=>{i.remove(),o()};i.addEventListener("transitionend",l,{once:!0}),setTimeout(()=>{i.isConnected&&(i.remove(),o())},600)},n)})}function CS(e,t,n=5e3){kf.push({text:e,iconSrc:t,duration:n}),$h()}function S_(){typeof window>"u"||window.addEventListener("lab:node:change",e=>{let{id:t,level:n}=e.detail||{};if(!t||n==null)return;let o=Nn.get(t);if(!o)return;let r=o.maxLevel;if(n<r||dv())return;let i=o.title||"Node";CS(`${i}<br>Maxed!`,"img/"+o.icon)})}var La,kf,Uh,MS,AS=Ue(()=>{Zo();Ln();Us();La=null,kf=[],Uh=!1,MS=!0});function E_(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function x_(){if(!Je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function VS(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=Je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function _a(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function YS(e,t,n,o=500){!e||e.__done||(e.__done=!0,e.__label&&(n?e.__label.textContent=n:e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(async()=>{if(typeof t=="function")try{t()}catch(i){console.error(i)}await tI(),e.style.opacity="0";let r=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",r,{once:!0}),setTimeout(r,450)},o))}async function Xh(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function L_(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function __(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Ln(),uc));await o(n)}catch{}try{t?.(n)}catch{}return n})}function M_(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function C_({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...L_(e,s),...__(t,s),...n?M_(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function T_(e){if(ji===e)return;cn&&(cn.stop(),cn=null),ji=e;let t=document.querySelector(".menu-root");switch(e){case Uo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{ji===Uo.STARTER_COVE&&(cn=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}),typeof Pf=="function"&&Pf())},300)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Zh=="function"&&Zh(n,80),Ki){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(Ki.init("water-background",i),Rf){try{Rf()}catch{}Rf=null}if(Of){try{Of()}catch{}Of=null}typeof Kh=="function"&&(Rf=Kh(s=>Ki.update(s))),typeof jh=="function"&&(Of=jh((s,l)=>Ki.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,Ki&&requestAnimationFrame(()=>Ki.resize()),KS()),typeof Yh=="function")try{Yh()}catch{}if(typeof Wh=="function")try{Wh()}catch{}if(!nn){nn=WS({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=nn;let i=()=>{if(!(!nn||typeof nn.setCoinSprite!="function"))try{nn.setCoinSprite(QS?.())}catch{}};i(),eI?.(i);let s=zS({spawner:nn});nn&&typeof nn.setDependencies=="function"&&nn.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=jS(),u=ZS(a);if(nn&&u?.coinsPerSecondMult){let f=1*u.coinsPerSecondMult;if(typeof zh=="function"){let d=zh("spawnRate",f);try{d&&typeof d.toScientific=="function"?f=Number(d.toScientific(6)):f=Number(d)}catch{}}Number.isFinite(f)&&nn.setRate(f)}}catch{}};if(l(),typeof Hh=="function")try{Hh()}catch{}Hh=JS(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof Vh=="function")try{Vh()}catch{}setTimeout(()=>{ji===Uo.STARTER_COVE&&nn&&nn.start()},300);break}case Uo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),nn&&nn.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Uo.MENU}}))}catch{}}var I_,Je,kS,WS,zS,KS,NS,RS,OS,PS,BS,FS,DS,US,jS,ZS,Vh,JS,w_,$S,qS,GS,qh,Gh,Yh,Wh,QS,eI,Nf,zh,HS,Kh,jh,XS,Zh,Ki,Rf,Of,Pf,Uo,ji,cn,nn,Hh,Bf,tI,yo=Ue(()=>{Ln();I_=!0,Je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();Je&&document.documentElement.classList.add("is-mobile");Rf=null,Of=null,Pf=null;x_();Uo={MENU:0,STARTER_COVE:1},ji=Uo.MENU,cn=null,nn=null,Hh=null,Bf=()=>new Promise(e=>requestAnimationFrame(e)),tI=async()=>{await Bf(),await Bf()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(z=>{e=z}),n=VS("Loading assets...",e);await Bf();let{initAudio:o}=await Promise.resolve().then(()=>(Ln(),uc));o();let r=Promise.all([Promise.resolve().then(()=>(nd(),yg)),Promise.resolve().then(()=>(Yb(),Vb)),Promise.resolve().then(()=>(nl(),Xv)),Promise.resolve().then(()=>(Lu(),kv)),Promise.resolve().then(()=>(St(),pg)),Promise.resolve().then(()=>(Nh(),eS)),Promise.resolve().then(()=>(mo(),rb)),Promise.resolve().then(()=>(Ic(),bg)),Promise.resolve().then(()=>(Tn(),Pg)),Promise.resolve().then(()=>(po(),R0)),Promise.resolve().then(()=>(ho(),Rb)),Promise.resolve().then(()=>(fS(),uS)),Promise.resolve().then(()=>(SS(),bS)),Promise.resolve().then(()=>(us(),Gg)),Promise.resolve().then(()=>(wS(),IS)),Promise.resolve().then(()=>(ls(),Tb)),Promise.resolve().then(()=>(ii(),Xg)),Promise.resolve().then(()=>(nu(),Gy)),Promise.resolve().then(()=>(ws(),Uy)),Promise.resolve().then(()=>(Is(),ay)),Promise.resolve().then(()=>(xS(),ES)),Promise.resolve().then(()=>(hn(),ky)),Promise.resolve().then(()=>(_h(),Ub)),Promise.resolve().then(()=>(mi(),ey)),Promise.resolve().then(()=>(_S(),LS)),Promise.resolve().then(()=>(AS(),TS))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(z,de)=>`img/mutations/m${de+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/gold_val_dna.webp","img/sc_upg_icons/magic_val_dna.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/wave_val_dna.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_dna.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg","sounds/notif_ding.ogg"],fonts:!0},s=0,l=C_(i,z=>{s=z,_a(n,z)}),[a,u,f,d,m,y,p,h,g,v,w,x,C,k,q,P,G,M,D,T,_,Y,Q,ae,he,be]=await r;({initSlots:kS}=a),{createSpawner:WS}=u,{initCoinPickup:zS}=f,{initHudButtons:KS}=d,{bank:PS,getHasOpenedSaveSlot:BS,setHasOpenedSaveSlot:FS,ensureStorageDefaults:DS,notifyGameSessionStarted:XS,ensureMultiplierDefaults:US}=m,{getCurrentAreaKey:jS,computeUpgradeEffects:ZS,onUpgradesChanged:JS}=p,{registerPreloadedAudio:w_}=h,{initXpSystem:Vh}=g,{initResetSystem:Yh}=v,{initMutationSystem:Wh,getMutationCoinSprite:QS,onMutationChange:eI}=w,{initPopups:$S}=x,{installSuspendSafeguards:qS,restoreFromBackupIfNeeded:GS,markProgressDirty:qh,flushBackupSnapshot:Gh}=C,{installGhostTapGuard:NS,initGlobalGhostTap:RS}=k,{initGlobalOverlayEsc:OS}=q,{setDebugPanelAccess:Nf,applyStatMultiplierOverride:zh}=P,{startGameLoop:HS,registerTick:Kh,registerFrame:jh}=G;let{initOfflineTracker:Oe,processOfflineProgress:Ae}=M,{initWorkshopSystem:F}=D,{initAutomationEffects:W}=T;({ensureGameDom:Zh}=_);let{initSurgeEffects:$}=Y;({waterSystem:Ki}=Q);let{initLabLogic:X}=ae,{initFpsTracker:J}=he,{initNotifications:le,unpauseNotifications:fe,showNotification:L}=be;Pf=fe,window.bank=PS,window.unpauseNotifications=Pf,window.showNotification=L,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(cn){try{cn.stop()}catch{}cn=null}}),window.addEventListener("audio:restartMusic",()=>{if(cn){try{cn.stop()}catch{}cn=null}ji===Uo.STARTER_COVE&&(cn=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",z=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return z.preventDefault(),z.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let z=document.hidden;Df(z),cn&&cn.element&&(z?cn.element.pause():cn.element.play().catch(()=>{}))}),NS?.(),RS?.(),OS?.(),qS?.(),typeof Nf=="function"&&(Nf(I_),window.setDebugPanelAccess=Nf);try{await GS?.()}catch{}await Promise.race([l,t]),await tI(),document.documentElement.classList.remove("booting"),await Bf(),YS(n),await Promise.all([Xh("img/currencies/coin/coin_plus_base.webp"),Xh("img/stats/xp/xp_plus_base.webp"),Xh("img/stats/mp/mp_plus_base.webp")]);try{typeof m.clearActiveSlot=="function"?m.clearActiveSlot():m&&m.KEYS&&m.KEYS.SAVE_SLOT&&localStorage.removeItem(m.KEYS.SAVE_SLOT)}catch{}HS(),Oe(()=>ji===Uo.STARTER_COVE);try{F()}catch(z){console.error("Workshop init failed",z)}try{W()}catch(z){console.error("Automation init failed",z)}try{$()}catch(z){console.error("Surge effects init failed",z)}try{X()}catch(z){console.error("Lab system init failed",z)}try{J()}catch(z){console.error("FPS tracker init failed",z)}E_(),DS(),qh?.("ensure-defaults"),$S(),le();let H=document.getElementById("panel-title");if(BS()?(document.body.classList.add("has-opened"),H&&(H.style.opacity="0")):H&&(H.style.opacity="1"),kS(async()=>{if(ji===Uo.STARTER_COVE)return;FS(!0),document.body.classList.add("has-opened"),H&&(H.style.opacity="0");let z=VS("Loading game..."),de=()=>new Promise(ee=>setTimeout(ee,120));_a(z,.2),await de(),US(),_a(z,.4),await de(),Ae(),_a(z,.65),await de(),XS?.(),_a(z,.9),await de(),qh?.("slot-entered"),_a(z,1),YS(z,()=>{T_(Uo.STARTER_COVE),setTimeout(()=>{window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave()},300)},"Finished loading game",200)}),typeof window<"u"&&Gh)try{window.cccRequestBackup=()=>Gh("manual",{immediate:!0})}catch{}})});yo();})();
