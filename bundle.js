(()=>{var fb=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var vt=(e,t)=>{for(var n in t)fb(e,n,{get:t[n],enumerable:!0})};var bl={};vt(bl,{initAudio:()=>db,loadAudio:()=>$m,playAudio:()=>ft,registerPreloadedBuffer:()=>mb,setAudioSuspended:()=>Xu,setMusicUnderwater:()=>Nr});function Hu(){if(Ht)return Ht;let e=window.AudioContext||window.webkitAudioContext;return e?(Ht=new e,Vs=Ht.createGain(),Vs.connect(Ht.destination),Vs.gain.value=1,yl=Ht.createGain(),yl.gain.value=1,yl.connect(Vs),mo=Ht.createBiquadFilter(),mo.type="lowpass",mo.frequency.value=22050,mo.Q.value=1,mo.connect(yl),Ht):null}function db(){Hu()}function pb(){Ht&&Ht.state==="suspended"&&Ht.resume().catch(()=>{})}async function $m(e){let t=Hu();if(!t)return null;let n=new URL(e,document.baseURI).href;if(Ys.has(n))return Ys.get(n);if(vl.has(n))return vl.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return Ys.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{vl.delete(n)}})();return vl.set(n,o),o}function ft(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=Hu(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=Ys.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let d=s.createGain();return d.gain.value=t,u.connect(d),i==="music"?d.connect(mo):d.connect(Vs),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:d,element:null}}else $m(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function mb(e,t){let n=new URL(e,document.baseURI).href;Ys.set(n,t)}function Xu(e){Ht&&(e?Ht.state==="running"&&Ht.suspend().catch(()=>{}):Ht.state==="suspended"&&Ht.resume().catch(()=>{}))}function Nr(e){if(!mo)return;let t=e?600:22050;try{let n=Ht.currentTime;mo.frequency.cancelScheduledValues(n),mo.frequency.setValueAtTime(t,n)}catch{mo.frequency.value=t}}var Ht,Vs,yl,mo,Ys,vl,An=De(()=>{Ht=null,Vs=null,yl=null,mo=null,Ys=new Map,vl=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,pb,{capture:!0,passive:!0})})});var c,xt=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",d=i+s;d.startsWith("-")?(u="-",d=d.slice(1)):d.startsWith("+")&&(d=d.slice(1));let f=d.replace(/^0+/,"")||"0",p=BigInt(u+f);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let f=i.slice(u+1)||"0";try{a=BigInt(f)}catch{a=0n}}let d=Number(l);return Number.isFinite(d)||(d=e.MAX_E),new e(BigInt(r),{base:d,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,d=Number(u),f=l;return Number.isSafeInteger(d)||(f+=u,d=0),new e(i,{base:d,offset:f},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let d=Math.min(n,18);o=u.toFixed(d).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}}});function Hm(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return Gm.format(t)}catch{return String(e)}}function Ws(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function Vu(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Hm(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+Gm.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,d=Yu.get(u)||"",p=o-u+1,g=4-p,m=p+g;n.length<m+1&&(n+="0".repeat(m+1-n.length));let y=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(y=Ws(y));let b,x;return y.length>m?(b=y.slice(0,p+1),x="0".repeat(g)):(b=y.slice(0,p),x=y.slice(p)),t+`${b}${g?"."+x:""}${d}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Ws(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+Vu(String(o))}function gb(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Vu(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let d=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(d=Ws(d)),l){let C=d.slice(0,1)+"."+d.slice(1),A=i==="-"?"-":"";return t+C+"e"+Vu(s,A)}let p=Math.floor(a/3)*3,g=Yu.get(p)||"",y=a-p+1,h=4-y,b,x;return d.length>4?(b=d.slice(0,y+1),x="0".repeat(h)):(b=d.slice(0,y),x=d.slice(y)),t+(i==="-"?"-":"")+b+(h?"."+x:"")+g}function qm(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Ws(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+gb(l)}function Q(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return qm(e.toScientific(3));if(t<6)return Hm(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=Yu.get(n);if(!o)return qm(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Ws(u));let f,p;return u.length>l?(f=u.slice(0,i+1),p="0".repeat(s)):(f=u.slice(0,i),p=u.slice(i)),`${f}${s?"."+p:""}${o}`}var hb,Yu,Gm,Yt=De(()=>{xt();hb=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],Yu=new Map(hb),Gm=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var eh={};vt(eh,{CURRENCIES:()=>Me,KEYS:()=>ht,STORAGE_PREFIX:()=>Li,bank:()=>P,clearActiveSlot:()=>Mb,clearAllStorage:()=>Nb,ensureCurrencyDefaults:()=>rf,ensureMultiplierDefaults:()=>sf,ensureStorageDefaults:()=>Ab,getActiveSlot:()=>v,getCurrency:()=>js,getCurrencyMultiplierBN:()=>Qm,getHasOpenedSaveSlot:()=>kb,getLastSaveTime:()=>ef,getLastSaveTimeKey:()=>xl,getSlotModifiedFlagKey:()=>Tb,getSlotSignature:()=>of,getSlotSignatureKey:()=>nf,hasModifiedSave:()=>_i,isCurrencyLocked:()=>Nn,isStorageKeyLocked:()=>rn,markSaveSlotModified:()=>pn,notifyGameSessionStarted:()=>_b,onCurrencyChange:()=>El,peekCurrency:()=>Zs,primeStorageWatcherSnapshot:()=>rt,setActiveSlot:()=>tf,setCurrency:()=>Ei,setCurrencyMultiplierBN:()=>Cl,setHasOpenedSaveSlot:()=>_l,setSlotSignature:()=>Ll,updateLastSaveTime:()=>Zm,watchStorageKey:()=>Lt});function Ku(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function ju(e){let t=Ku(e);return t==null?null:`${yb}:${t}`}function Zu(e){let t=Ku(e);return t==null?null:`${vb}:${t}`}function zm(e={}){Sl.size!==0&&Sl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function El(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Sl.add(o),()=>{Sl.delete(o)}}function Sb(){if(zs!=null||Mo.size===0)return;zs=(typeof window<"u"?window:globalThis).setInterval(wb,bb)}function Km(){if(Mo.size!==0||zs==null)return;(typeof window<"u"?window:globalThis).clearInterval(zs),zs=null}function jm(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function Ib(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function wb(){if(Mo.size===0){Km();return}Mo.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=jm(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!Ib(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function Lt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Mo.get(e);return s||(s=new Set,Mo.set(e,s)),s.add(i),Sb(),()=>{let l=Mo.get(e);l&&(l.delete(i),l.size===0&&(Mo.delete(e),Km()))}}function rt(e,t){if(!e)return;let n=Mo.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=jm(r,o),r.initialized=!0)})}function Ju(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function Eb(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function xb(){Wu.forEach(e=>{try{e?.()}catch{}}),Wu.clear()}function Vm(e){if(e!==Xm&&(xb(),Xm=e??null,e!=null))for(let t of Object.values(Me)){let n=`${ht.CURRENCY[t]}:${e}`,o=Lt(n,{parse:Eb,equals:Ju,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};zm(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Wu.set(n,o)}}function Lb(){typeof window>"u"||(Vm(v()),window.addEventListener("saveSlot:change",()=>{Vm(v())}))}function _b(){Qu=!0}function xl(e=v()){return e==null?null:`${or}lastSaveTime:${e}`}function Zm(){if(!Qu||document.hidden)return;let e=v();if(e==null)return;let t=Date.now();try{localStorage.setItem(xl(e),String(t))}catch{}}function ef(){let e=v();if(e==null)return 0;try{let t=localStorage.getItem(xl(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function Cb(){typeof window>"u"||(Ym||(Ym=setInterval(Zm,1e3)),window.addEventListener("beforeunload",()=>{if(!Qu)return;let e=v();if(e!=null)try{localStorage.setItem(xl(e),String(Date.now()))}catch{}}))}function v(){if(tr!==void 0)return tr;let e=localStorage.getItem(ht.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return tr=n,n}function tf(e){let t=Math.max(1,parseInt(e,10)||1);tr=t,localStorage.setItem(ht.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function Mb(){tr=null,localStorage.removeItem(ht.SAVE_SLOT)}function Ks(e,t=v()){return t==null?null:`${e}:${t}`}function Jm(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function rn(e){return Jm(e)}function nf(e=v()){return ju(e)}function Tb(e=v()){return Zu(e)}function of(e=v()){if(typeof localStorage>"u")return null;let t=ju(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function Ll(e,t){if(typeof localStorage>"u")return;let n=ju(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function _i(e=v()){if(typeof localStorage>"u")return!1;let t=Zu(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function pn(e=v()){if(typeof localStorage>"u")return;let t=Ku(e);if(t==null||_i(t))return;let n=Zu(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function kb(){return localStorage.getItem(ht.HAS_OPENED_SAVE_SLOT)==="true"}function _l(e){localStorage.setItem(ht.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function Ab(){localStorage.getItem(ht.HAS_OPENED_SAVE_SLOT)===null&&_l(!1)}function rf(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${ht.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function sf(){let e=v();if(e!=null)for(let t of Object.values(Me)){let n=`${ht.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))wl(t);else{let o=nr(c.fromInt(1));xi(t,o)}}}function js(e){let t=Ks(ht.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Ei(e,t,{delta:n=null,previous:o=null}={}){let r=v(),i=Ks(ht.CURRENCY[e],r),s=o??js(e),l=c.fromInt(0);if(!i||Nn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let d=null;try{d=localStorage.getItem(i)}catch{}let f=d??u,p=a;try{d!=null&&(p=c.fromAny(d),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}rt(i,f);let g=!Ju(s,p),y=(b=>{if(b==null)return null;try{let x=b instanceof c?b.clone?.()??b:c.fromAny(b);if(typeof x.cmp=="function")return x.cmp(l)>0?x:null;if(!x.isZero?.())return x}catch{}return null})(n),h=null;if(g)try{h=p.sub?.(s)}catch{}if((!h||h.isZero?.()||typeof h.cmp=="function"&&h.cmp(l)<=0)&&(h=y),g||h){let b={key:e,value:p,slot:r,delta:h??void 0};zm(b);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:b}))}catch{}}return p}function nr(e){return e.mulScaledIntFloor(1n,-zu)}function Il(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,zu)}function wl(e){let t=Ks(ht.MULTIPLIER[e]);if(!t)return nr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Rr)){let r=nr(c.fromInt(1));return xi(e,r),r}let o=n.slice(Rr.length);try{return c.fromAny(o)}catch{let r=nr(c.fromInt(1));return xi(e,r),r}}function xi(e,t,n=v()){let o=Ks(ht.MULTIPLIER[e],n);if(!o||Nn(e,n))return;let r=nr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Rr))try{r=c.fromAny(i.slice(Rr.length))}catch{}let s=c.fromAny(t),l=Rr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,d=s;try{let f=u?.startsWith?.(Rr)?u.slice(Rr.length):null;f!=null&&(d=c.fromAny(f))}catch{}try{rt(o,u)}catch{}if(!Ju(r,d))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:Il(d),slot:n}}))}catch{}}function Qm(e){return Il(wl(e))}function Nn(e,t=v()){let n=Ks(ht.CURRENCY[e],t);return Jm(n)}function Cl(e,t){let n=c.fromAny(t),o=nr(n);return xi(e,o,v()),n}function Zs(e,t){let n=localStorage.getItem(`${ht.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Nb(){Object.values(ht).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Wm(e){let t=n=>{try{let o=c.fromAny(n);return typeof Q=="function"?Q(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return js(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Ei(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Ei(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Ei(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof Q=="function"?Q(r):r.toString()},t.mult={get(){return Qm(e)},set(n){return Cl(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=wl(e).mulBigNumInteger(o);return r.isZero()&&(r=nr(c.fromInt(1))),xi(e,r),Il(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),zu)}catch{o={numer:1n,scale:0}}let r=wl(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=nr(c.fromInt(1))),xi(e,r);let i=Il(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var or,Li,yb,vb,zu,Rr,bb,Mo,zs,Sl,Wu,Xm,Ym,Qu,ht,Me,tr,P,bt=De(()=>{xt();Yt();or="ccc:",Li=or,yb=`${or}slotSig`,vb=`${or}slotMod`,zu=18,Rr="XM:",bb=140,Mo=new Map,zs=null,Sl=new Set;Wu=new Map,Xm=null;Ym=null,Qu=!1;Cb();ht={HAS_OPENED_SAVE_SLOT:`${or}hasOpenedSaveSlot`,SAVE_SLOT:`${or}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Me={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===ht.SAVE_SLOT){if(e.newValue===null)tr=null;else{let t=parseInt(e.newValue,10);tr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:tr}}))}catch{}}});for(let e of Object.values(Me))ht.CURRENCY[e]=`${or}${e}`,ht.MULTIPLIER[e]=`${or}mult:${e}`;Lb();P=new Proxy({},{get(e,t){if(Object.values(Me).includes(t))return Wm(t);if(typeof t=="string"&&Me[t.toUpperCase?.()])return Wm(Me[t.toUpperCase()])}});if(typeof window<"u"){window.bank=P;for(let e of Object.values(Me))window[e]=P[e]}});function nh(){return ho}function Ml(e){ho=!!e,document.body.classList.toggle("slots-delete-mode",ho);let t=document.getElementById("manage-saves");t&&(t.textContent=ho?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",ho),n.setAttribute("aria-pressed",ho?"true":"false")})}function Rb(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function Ob(){if(th)return;th=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),Ml(!ho)}),window.addEventListener("keydown",r=>{ho&&r.key==="Escape"&&Ml(!1)});let n=r=>{!ho||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!ho)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(Rb(s),v()===s)try{localStorage.removeItem(ht.SAVE_SLOT)}catch{}af(),Ml(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),Ml(!1)}var ho,th,oh=De(()=>{bt();lf();ho=!1,th=!1;document.addEventListener("DOMContentLoaded",()=>{try{Ob()}catch{}})});var rh={};vt(rh,{initSlots:()=>Fb,refreshSlotsView:()=>af});function Pb(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function Bb(e){if(!Pb(e))return"No Save Data";try{let t=Zs(e,"coins");return Q(t)}catch{return"0"}}function cf(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=Bb(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function Fb(e){let t=document.querySelectorAll(".slot-card");cf(),t.forEach((n,o)=>{let r=o+1,i=s=>{tf(r),rf(),sf(),_l(!0),typeof e=="function"&&e(r,s),cf()};n.addEventListener("click",s=>{nh()||(s.preventDefault(),i(s))})})}function af(){cf()}var lf=De(()=>{xt();Yt();oh();bt()});var sh={};vt(sh,{registerPreloadedAudio:()=>Ub,takePreloadedAudio:()=>Db});function Ub(e,t){let n=ih(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}Tl.set(n,t)}}function Db(e){let t=ih(e);if(!Tl.has(t))return null;let n=Tl.get(t);return Tl.delete(t),n}var Tl,ih,kl=De(()=>{Tl=new Map,ih=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Ci(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var uf=De(()=>{});var wh={};vt(wh,{addExternalCoinMultiplierProvider:()=>Ur,addExternalXpGainMultiplierProvider:()=>Oi,addXp:()=>Ri,broadcastXpChange:()=>Bl,computeCoinMultiplierForXpLevel:()=>If,getXpGainMultiplier:()=>Ul,getXpLevelStorageKey:()=>$b,getXpRequirementForXpLevel:()=>Fl,getXpState:()=>Qe,initXpSystem:()=>Ai,isXpSystemUnlocked:()=>an,onXpChange:()=>Ol,refreshCoinMultiplierFromXpLevel:()=>gn,resetXpProgress:()=>Ni,setExternalBookRewardProvider:()=>Dl,setExternalCoinMultiplierProvider:()=>Sh,setExternalXpGainMultiplierProvider:()=>Ih,unlockXpSystem:()=>Fr});function $b(e=v()){let t=e??v();return t==null?null:Or(t)}function Hb(e){if(e===0n)return 0;let t=e.toString(),n=t.length,o=Math.min(n,15),r=Number(t.slice(0,o)),i=n-o;if(!Number.isFinite(r))return Number.POSITIVE_INFINITY;let s=r*Math.pow(10,i);return Number.isFinite(s)?s:Number.POSITIVE_INFINITY}function sn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function Al(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function mh(e){if(!e||typeof e!="object")return 0;if(sn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function Xb(e){return!e||typeof e!="object"?0:sn(e)||typeof e.cmp=="function"&&e.cmp(ph)>=0?Number.POSITIVE_INFINITY:mh(e)}function lh(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(Gb,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(oa())??c.fromInt(0):n}function Vb(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(dh,18)}function Yb(e){if(sn(e)||typeof e.cmp=="function"&&e.cmp(ph)>=0)return dt.clone?.()??dt;let t=e.floorToInteger(),n=e.sub(t),o=mh(n);if(!Number.isFinite(o))return dt.clone?.()??dt;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return dt.clone?.()??dt;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function hh(e){if(!e||typeof e!="object")return dt.clone?.()??dt;let n=Vb(e),o=Yb(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return dt.clone?.()??dt;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function gh(){let e=sn(G.xpLevel),t=sn(G.progress);if(!e&&!t)return!1;let n=dt.clone?.()??dt;if(G.xpLevel=n.clone?.()??n,G.progress=n.clone?.()??n,St=n.clone?.()??n,P?.books)try{typeof P.books.set=="function"?P.books.set(n.clone?.()??n):typeof P.books.add=="function"&&P.books.add(n.clone?.()??n)}catch{}return!0}function ea(e={}){na.size!==0&&na.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Ol(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return na.add(n),()=>{na.delete(n)}}function Rt(){return c.fromInt(0)}function oa(){return c.fromInt(1)}function Mi(e){if(!e)return Rt();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Rt()}}function Nl(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Wb(){for(;vf.length>0;){let e=vf.pop();try{e?.()}catch{}}}function uh(e){if(e==null)return Rt();try{return c.fromAny(e)}catch{return Rt()}}function pf(e){if(!df){df=!0;try{let t=bf??v(),n={unlocked:G.unlocked,xpLevel:Mi(G.xpLevel),progress:Mi(G.progress),requirement:Mi(St)};Wt(!0),jn(),hn(!0);let o={unlocked:G.unlocked,xpLevel:Mi(G.xpLevel),progress:Mi(G.progress),requirement:Mi(St)},r=n.unlocked!==o.unlocked,i=!Nl(n.xpLevel,o.xpLevel),s=!Nl(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Rt();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Rt()}catch{l=Rt()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||na.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(ea(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{df=!1}}}function mf(e){if(e===bf||(Wb(),bf=e??null,e==null))return;let t=(n,o)=>{let r=Lt(n,o);typeof r=="function"&&vf.push(r)};t(Js(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>pf("unlock")}),t(Or(e),{parse:uh,equals:Nl,onChange:()=>pf("xpLevel")}),t(ki(e),{parse:uh,equals:Nl,onChange:()=>pf("progress")})}function yh(){if(ch){mf(v());return}ch=!0,mf(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{mf(v()),Wt(!0),jn(),hn(!0)})}function hf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function ra(e){if(!e||typeof e!="object")return Number.NEGATIVE_INFINITY;if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return Number.POSITIVE_INFINITY;if(e.isZero?.()||typeof e.isZero=="function"&&e.isZero())return Number.NEGATIVE_INFINITY;let t=e.sig,n=typeof e.e=="number"?e.e:Number(e.e??0),o=typeof e._eOffset=="bigint"?Hb(e._eOffset):Number(e._eOffset??0);if(!Number.isFinite(n))return n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(!Number.isFinite(o))return o>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let r=n+o;if(!Number.isFinite(r))return r>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let i=0;if(typeof t=="bigint"){let l=t.toString().replace(/^0+/,"");if(!l)return Number.NEGATIVE_INFINITY;let a=l.length,u=Math.min(a,15),d=l.slice(0,u),f=Number.parseFloat(d);Number.isFinite(f)&&f>0?i=Math.log10(f)+(a-u):i=a-1}else try{let s=typeof e.toScientific=="function"?e.toScientific(12):String(e);if(!s||s==="0")return Number.NEGATIVE_INFINITY;if(s==="Infinity")return Number.POSITIVE_INFINITY;let l=s.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(l){let a=parseFloat(l[1]),u=parseInt(l[2],10)||0;if(!(a>0)||!Number.isFinite(a))return Number.NEGATIVE_INFINITY;i=Math.log10(a)+u}else{let a=Number(s);if(!Number.isFinite(a)||a<=0)return Number.NEGATIVE_INFINITY;i=Math.log10(a)}}catch{return Number.NEGATIVE_INFINITY}return r+i}function zb(e){let t=e<ah?e:ah;if(t<=Ti)return;let n=Ti,o=rr.get(n.toString());for(o||(o=c.fromInt(10),rr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),rr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Ti=n;return}}Ti=n}function Kb(e){if(!Number.isFinite(e)||e>=c.MAX_E)return dt.clone?.()??dt;let t=Math.floor(e),n=e-t;Number.isFinite(n)||(n=0);let o=Math.pow(10,n);(!Number.isFinite(o)||o<=0)&&(o=1),o>=10&&(o/=10,t+=1);let r;try{r=Number.isFinite(t)?t.toLocaleString("en",{useGrouping:!1}):String(t)}catch{r=String(t)}let i=`${o.toPrecision(18)}e${r}`;try{return c.fromScientific(i).floorToInteger()}catch{return dt.clone?.()??dt}}function jb(e){let t=Ti>0n?Ti:0n,n=rr.get(t.toString());if(!n||sn(n))return dt.clone?.()??dt;let o=c.fromAny(t.toString()),r=ra(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);Al(s)||(i=i.add?.(s.mulDecimal(dh,18))??i);let l=lh(e),a=lh(o),u=l.sub?.(a)??c.fromInt(0);Al(u)||(i=i.add?.(u.mulDecimal(qb,18))??i);let d=Xb(i);return Number.isFinite(d)?Kb(d):dt.clone?.()??dt}function Zb(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=sn(t),o=sn(e);if(n)return o?1:0;if(Al(t)||Al(e))return 0;let s=ra(e),l=ra(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function vh(){return mn.container&&mn.container.isConnected?!0:(mn.container=document.querySelector(".xp-counter[data-xp-hud]"),mn.container?(mn.bar=mn.container.querySelector(".xp-bar"),mn.fill=mn.container.querySelector(".xp-bar__fill"),mn.xpLevelValue=mn.container.querySelector(".xp-level-value"),mn.progress=mn.container.querySelector("[data-xp-progress]"),!0):!1)}function bh(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=rr.get("0");return a.clone?.()??a}if(r.bigInt!=null){zb(i);let a=i.toString(),u=rr.get(a);if(u)return u.clone?.()??u}let s=jb(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?dt.clone?.()??dt:(r.bigInt!=null&&rr.set(r.bigInt.toString(),s),s.clone?.()??s)}function To(){St=bh(G.xpLevel)}function Rl(){G.xpLevel=Rt(),G.progress=Rt(),To(),hn(!0)}function fh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function Pl(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function hn(e=!1){let t=P?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=Pl(G.xpLevel),o=n.bigInt,r=!n.finite,i=typeof G.xpLevel?.toStorage=="function"?G.xpLevel.toStorage():null;if(!e&&(r&&On||!r&&o!=null&&!On&&!Pn&&Rn!=null&&o===Rn||!r&&o==null&&Pn&&i&&Bn&&i===Bn))return;if(r){try{t.set(dt)}catch{}Rn=null,On=!0,Pn=!1,Bn=null;return}let s;if(o!=null&&o<=yf){let d=c.fromInt(1),f=Number(o);for(let g=0;g<f;g+=1)d=d.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(f)}typeof d.add=="function"?d=d.add(p):typeof p.add=="function"&&(d=p.add(d)),s=d.clone?.()??d}else s=hh(G.xpLevel);let l=s.clone?.()??s,a=ir.size>0?Array.from(ir):typeof Pr=="function"?[Pr]:[];for(let d of a)if(typeof d=="function")try{let f=d({baseMultiplier:l.clone?.()??l,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});f instanceof c?l=f.clone?.()??f:f!=null&&(l=c.fromAny(f))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Rn=null,On=!0,Pn=!1,Bn=null):o!=null&&o<=yf?(Rn=o,On=!1,Pn=!1,Bn=null):(Rn=null,On=!1,Pn=!0,Bn=i)}function Wt(e=!1){let t=v();if(t==null)return Qs=null,ff=!1,G.unlocked=!1,Rl(),G;if(!e&&ff&&t===Qs)return G;Qs=t,ff=!0;try{let n=localStorage.getItem(Js(t));G.unlocked=n==="1"}catch{G.unlocked=!1}try{G.xpLevel=c.fromAny(localStorage.getItem(Or(t))??"0")}catch{G.xpLevel=Rt()}try{G.progress=c.fromAny(localStorage.getItem(ki(t))??"0")}catch{G.progress=Rt()}return(sn(G.xpLevel)||sn(G.progress))&&(G.unlocked=!0),G.unlocked?(gh(),To(),hn(!0),yh(),G):(Rl(),G)}function ta(){let e=v();if(e==null)return;let t={unlocked:G.unlocked?"1":"0",level:G.xpLevel.toStorage(),progress:G.progress.toStorage()};try{localStorage.setItem(Js(e),t.unlocked)}catch{}try{localStorage.setItem(Or(e),t.level)}catch{}try{localStorage.setItem(ki(e),t.progress)}catch{}let n=(()=>{let r=G.unlocked,i=G.xpLevel,s=G.progress;try{r=localStorage.getItem(Js(e))==="1"}catch{}try{let l=localStorage.getItem(Or(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(ki(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();rt(Js(e),n.unlocked?"1":"0"),rt(Or(e),n.level?.toStorage?.()??t.level),rt(ki(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==G.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(G.unlocked=n.unlocked,G.xpLevel=n.level,G.progress=n.progress,To(),hn(!0),jn())}function Jb(){hn(!0);let e=oa();if(typeof gf=="function")try{let n=gf({baseReward:e.clone?.()??e,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{P?.books?.addWithMultiplier?P.books.addWithMultiplier(e):P?.books?.add&&P.books.add(e)}catch{}let t=Pl(G.xpLevel);t.finite?t.bigInt!=null?(Rn=t.bigInt,On=!1,Pn=!1,Bn=null):(Rn=null,On=!1,Pn=!0,Bn=typeof G.xpLevel?.toStorage=="function"?G.xpLevel.toStorage():null):(Rn=null,On=!0,Pn=!1,Bn=null)}function jn(){if(!vh())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=mn;if(!e)return;if(!G.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Q(St);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=hf(Q(St));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Ci();return}e.removeAttribute("hidden");let i=St,s=Zb(G.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=Q(G.xpLevel)),r){let a=Q(G.progress),u=Q(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=hf(Q(G.progress)),u=hf(Q(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Ci()}function Ai({forceReload:e=!1}={}){return vh(),Wt(e),To(),jn(),yh(),Qe()}function Fr(){if(Wt(),G.unlocked)return jn(),!1;Rl(),G.unlocked=!0,ta(),jn(),hn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Qe()}))}catch{}return!0}function Ni({keepUnlock:e=!0}={}){Wt();let t=G.unlocked;return Rl(),G.unlocked=e?t||G.unlocked:!1,ta(),jn(),hn(!0),Qe()}function Ri(e,{silent:t=!1}={}){Wt();let n=Qs??v();if(n!=null&&fh(ki(n)))return{unlocked:G.unlocked,xpLevelsGained:Rt(),xpAdded:Rt(),xpLevel:G.xpLevel,progress:G.progress,requirement:St,slot:n};if(!G.unlocked)return{unlocked:!1,xpLevelsGained:Rt(),xpAdded:Rt(),xpLevel:G.xpLevel,requirement:St};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Rt()}if(!o.isZero?.()){let f=sr.size>0?Array.from(sr):typeof Br=="function"?[Br]:[];for(let p of f)if(typeof p=="function")try{let g=p({baseGain:o.clone?.()??o,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});g instanceof c?o=g.clone?.()??g:g!=null&&(o=c.fromAny(g))}catch{}}if(o=Fn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return jn(),{unlocked:!0,xpLevelsGained:Rt(),xpAdded:o,xpLevel:G.xpLevel,requirement:St};G.progress=G.progress.add(o),To();let r=n!=null&&fh(Or(n)),i=sn(G.progress),s=sn(G.xpLevel),l=sn(o);if(i||s||l){let f=dt.clone?.()??dt;r||(G.xpLevel=f.clone?.()??f),G.progress=f.clone?.()??f,To(),gh(),ta(),jn(),hn(!0);let p={unlocked:!0,xpLevelsGained:Rt(),xpAdded:o.clone?.()??o,xpLevel:G.xpLevel.clone?.()??G.xpLevel,progress:G.progress.clone?.()??G.progress,requirement:St.clone?.()??St,slot:n};if(ea(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Rt();if(G.progress.cmp(St)<0){ta(),jn();let f={unlocked:!0,xpLevelsGained:Rt(),xpAdded:o,xpLevel:G.xpLevel,progress:G.progress,requirement:St,slot:n};if(ea(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}if(!r){let f=ra(G.progress),p=.08118668602542883,g=ra(St);if(f-g>2){let h=G.xpLevel,b=f-g,x=Math.floor(b/p);if(x>500){let E=BigInt(Math.max(0,x-5));if(E>0n){let C=c.fromAny(E.toString());if(G.xpLevel=G.xpLevel.add(C),a=a.add(C),To(),P?.books?.add)try{let A=C.clone();P.books.add(A)}catch{}}}}let m=0,y=500;for(;G.progress.cmp?.(St)>=0&&m<y&&(G.progress=G.progress.sub(St),G.xpLevel=G.xpLevel.add(oa()),a=a.add(oa()),Jb(),To(),!sn(St));)m+=1;m>=y&&G.progress.cmp(St)>=0&&To()}ta(),jn();let u=Pl(G.xpLevel);u.finite?u.bigInt!=null?(Rn=u.bigInt,On=!1,Pn=!1,Bn=null):(Rn=null,On=!1,Pn=!0,Bn=typeof G.xpLevel?.toStorage=="function"?G.xpLevel.toStorage():null):(Rn=null,On=!0,Pn=!1,Bn=null);let d={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:G.xpLevel.clone?.()??G.xpLevel,progress:G.progress.clone?.()??G.progress,requirement:St.clone?.()??St,slot:n};if(ea(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}function Qe(){return Wt(),{unlocked:G.unlocked,xpLevel:G.xpLevel.clone?.()??G.xpLevel,progress:G.progress.clone?.()??G.progress,requirement:St.clone?.()??St}}function Bl(e={}){Wt();let t=Qs??v(),n={...Qe(),slot:t,...e};if(ea(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function an(){return Wt(),!!G.unlocked}function Fl(e){return bh(e)}function Ul(){Wt();let e=oa(),t=sr.size>0?Array.from(sr):typeof Br=="function"?[Br]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:G.xpLevel.clone?.()??G.xpLevel,xpUnlocked:G.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function If(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=Pl(t),o=n.bigInt;if(!n.finite)return dt.clone?.()??dt;let i;if(o!=null&&o<=yf){let a=c.fromInt(1),u=Number(o);for(let f=0;f<u;f+=1)a=a.mulDecimal("1.1",18);let d;try{d=c.fromAny(o.toString())}catch{d=c.fromInt(u)}typeof a.add=="function"?a=a.add(d):typeof d.add=="function"&&(a=d.add(a)),i=a.clone?.()??a}else i=hh(t);let s=i.clone?.()??i,l=ir.size>0?Array.from(ir):typeof Pr=="function"?[Pr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!G.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function Sh(e){Pr=typeof e=="function"?e:null,ir.clear(),Pr&&ir.add(Pr),Wt(),hn(!0)}function gn(){Wt(),hn(!0)}function Ih(e){Br=typeof e=="function"?e:null,sr.clear(),Br&&sr.add(Br)}function Ur(e){return typeof e!="function"?()=>{}:(ir.add(e),Wt(),hn(!0),()=>{ir.delete(e),Wt(),hn(!0)})}function Oi(e){return typeof e!="function"?()=>{}:(sr.add(e),Wt(),()=>{sr.delete(e)})}function Dl(e){gf=typeof e=="function"?e:null}var Sf,Js,Or,ki,Qs,ff,St,rr,Ti,dt,Rn,On,Pn,Bn,Pr,Br,ir,sr,gf,ah,UL,DL,yf,dh,qb,Gb,ph,G,na,mn,vf,ch,bf,df,Zn=De(()=>{xt();bt();Pi();Yt();uf();Sf="ccc:xp",Js=e=>`${Sf}:unlocked:${e}`,Or=e=>`${Sf}:level:${e}`,ki=e=>`${Sf}:progress:${e}`;Qs=null,ff=!1,St=c.fromInt(10),rr=new Map;rr.set("0",St);Ti=0n,dt=c.fromAny("Infinity"),Rn=null,On=!1,Pn=!1,Bn=null,Pr=null,Br=null,ir=new Set,sr=new Set,gf=null,ah=5000n,UL=Math.log10(11/10),DL=Math.log10(5/2),yf=200n,dh="0.04139268515822507",qb="0.3979400086720376",Gb="0.1",ph=c.fromScientific(String(c.MAX_E));G={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};na=new Set;mn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};vf=[],ch=!1,bf=null,df=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Ai,unlockXpSystem:Fr,addXp:Ri,getXpState:Qe,broadcastXpChange:Bl,isXpSystemUnlocked:an,getXpRequirementForXpLevel:Fl,getXpGainMultiplier:Ul,setExternalCoinMultiplierProvider:Sh,addExternalCoinMultiplierProvider:Ur,refreshCoinMultiplierFromXpLevel:gn,setExternalXpGainMultiplierProvider:Ih,addExternalXpGainMultiplierProvider:Oi,setExternalBookRewardProvider:Dl,resetXpProgress:Ni}))});var Th={};vt(Th,{GHOST_TAP_TIMEOUT_MS:()=>Qb,clearGhostTapTarget:()=>ia,consumeGhostTapGuard:()=>Mh,initGlobalGhostTap:()=>cS,installGhostTapGuard:()=>lS,markGhostTapTarget:()=>Ch,setGhostTapSelector:()=>uS,shouldSkipGhostTap:()=>Jn,suppressNextGhostTap:()=>go});function Ao(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function xf(){return typeof document>"u"?null:document}function nS(e){if(!xf())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(Ef)}function ia(e){e&&(e[$l]=0)}function Ch(e,t=0,n=null){if(!e)return;let o=Ao(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[$l]=o+r:e[$l]=0,tS=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&go(i)}function Mh(e){if(typeof window>"u")return!1;let t=window[Bi];return typeof t!="number"?!1:Ao()<=t?!0:(window[Bi]=null,!1)}function Jn(e){if(!e)return!1;let t=Number(e[$l]||0);return!Number.isFinite(t)||t<=0?!1:Ao()<=t?(ia(e),!0):(ia(e),!1)}function go(e=0){if(typeof window>"u")return;let t=Ao(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[Bi]=null;return}let o=t+n,r=typeof window[Bi]=="number"?window[Bi]:0;window[Bi]=Math.max(r,o)}function oS(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Gl=ar=Ao(),ko=0))}function rS(e){Gl=ar=Ao(),ko=0}function iS(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Ao();ar>0&&(ko=t-ar),Gl=t}function sS(){let e=Ao();ar>0&&(ko=e-ar),Gl=e}function aS(e){if(!e.isTrusted)return;let t=Ao(),n=ar>0?t-ar:-1,o=nS(e.target);if(Jn(o)){ko=0,e.preventDefault(),e.stopImmediatePropagation();return}if(Mh(o)){o&&ia(o),ko=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((ko||n)>=_h){ia(o),ko=0,e.preventDefault(),e.stopImmediatePropagation();return}ko=0}function lS(e={}){if(Eh)return;let t=xf();!t||typeof window>"u"||(Eh=!0,wf="PointerEvent"in window,xh=!wf&&"ontouchstart"in window,e.selector&&(Ef=`${e.selector}, ${ql}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(_h=e.longPressMs),t.addEventListener("click",aS,!0),wf?(t.addEventListener("pointerdown",oS,{capture:!0,passive:!1}),t.addEventListener("pointerup",iS,{capture:!0,passive:!0})):xh&&(t.addEventListener("touchstart",rS,{capture:!0,passive:!1}),t.addEventListener("touchend",sS,{capture:!0,passive:!0})))}function Lh(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(ql);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(Ch(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function cS(){let e=xf();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",Lh,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",Lh,{capture:!1,passive:!1})}function uS(e){e&&(Ef=`${e}, ${ql}`)}var Qb,$l,Bi,ql,eS,Eh,Ef,wf,xh,tS,Gl,ar,ko,_h,Fi=De(()=>{Qb=0,$l=Symbol("ccc:ghostTap:skipUntil"),Bi="__cccGhostTapSkipUntil",ql='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',eS=80,Eh=!1,Ef=ql,wf=!1,xh=!1,tS=null,Gl=0,ar=0,ko=0,_h=eS});var Lf,kh=De(()=>{Lf={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var Ah={};vt(Ah,{RateAccumulator:()=>aa,pauseGameLoop:()=>kf,registerFrame:()=>hS,registerTick:()=>yo,resumeGameLoop:()=>Af,startGameLoop:()=>pS,stopGameLoop:()=>mS});function Mf(e){e||(e=performance.now());let t=e;if(Tf){Dr=t,qr=requestAnimationFrame(Mf);return}Dr||(Dr=t);let n=(t-Dr)/1e3;Dr=t,n>60&&(n=60),n<0&&(n=0),$r+=n;let o=0,r=250;for(;$r>=sa;){if(o>=r){$r=$r%sa;break}_f.forEach(i=>{try{i(sa)}catch(s){console.error("Error in game tick listener:",s)}}),$r-=sa,o++}if(Cf.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),Ui===0||Di===0)Ui=Date.now(),Di=t;else{let i=t-Di;if(i>dS){let s=Date.now(),l=s-Ui;l<-1e3?pn():l>i+1e4&&pn(),Ui=s,Di=t}}qr=requestAnimationFrame(Mf)}function kf(){Tf=!0}function Af(){Tf=!1,Dr=performance.now(),$r=0,Ui=0,Di=0}function pS(){qr||(Dr=performance.now(),$r=0,Ui=0,Di=0,qr=requestAnimationFrame(Mf))}function mS(){qr&&(cancelAnimationFrame(qr),qr=null)}function yo(e){return typeof e!="function"?()=>{}:(_f.add(e),()=>{_f.delete(e)})}function hS(e){return typeof e!="function"?()=>{}:(Cf.add(e),()=>{Cf.delete(e)})}var fS,sa,_f,Cf,qr,Tf,Dr,$r,Ui,Di,dS,aa,Gr=De(()=>{bt();fS=20,sa=1/fS,_f=new Set,Cf=new Set,qr=null,Tf=!1,Dr=0,$r=0,Ui=0,Di=0,dS=2e3;aa=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*sa;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ke,Hr,la,ca,ua,fa,Qn,$i,gS,Nh,Xr=De(()=>{xt();Ke="automation",Hr=1,la=2,ca=3,ua=4,fa=5,Qn=6,$i={[la]:"coins",[ca]:"books",[ua]:"gold",[fa]:"magic"},gS=[{area:Ke,id:Hr,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ke,id:la,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ke,id:ca,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ke,id:ua,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ke,id:fa,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ke,id:Qn,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],Nh=gS.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var $h={};vt($h,{getGearsProductionRate:()=>Yl,getGenerationLevelKey:()=>Wr,getGenerationUpgradeCost:()=>lr,initWorkshopSystem:()=>Dh,initWorkshopTab:()=>Df,performFreeGenerationUpgrade:()=>Wl,updateWorkshopTab:()=>eo});function Gi(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*ES}function Wr(e){return`ccc:workshop:genLevel:${e}`}function ma(){let e=v();if(!e)return c.zero();let t=localStorage.getItem(Wr(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function ga(e){let t=v();if(!t)return!1;let n=Wr(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function ya(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let f=e.toPlainIntegerString();t=parseFloat(f)}catch{return 1/0}if(t<=0)return Rf;if(t<=Vr)return Rf+t*Oh;Xl===null&&(Xl=Rf+Vr*Oh);let n=t-Vr;if(t<=da)return Xl+n+Gi(n,qi);if(Vl===null){let f=da-Vr;Vl=Xl+f+Gi(f,qi)}let o=t-da,r=t-Vr,i=da-Vr,s=o+(Gi(r,qi)-Gi(i,qi)),l=SS/bS,a=.5*l*o*o;if(t<=Hl)return Vl+s+a;if(Pf===null){let f=Hl-da,p=Hl-Vr,g=f+(Gi(p,qi)-Gi(i,qi)),m=.5*l*f*f;Pf=Vl+g+m}let u=IS*(t-Hl);if(u>709)return 1/0;let d=Pf*Math.exp(u);return!Number.isFinite(d)||d>179e306?1/0:d}function lr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=ya(t);return Ae(n)}function Uf(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(Of);if(n.cmp(9e15)<=0){let s=Number(n.toString())*Of;t=Ae(s)}else{let i=n.mulDecimal(Of);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Ae(s)}catch{t=c.fromAny("Infinity")}}}let o=P?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function _S(){let e=lr(et);if(P.coins.value.cmp(e)<0)return;let t=et.add(1);ga(t)&&(et=t,P.coins.sub(e),eo(),Kt())}function CS(){if(!Ut())return;let n=Uf(et).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&P.gears&&P.gears.add(n),et.cmp(20)<0){let r=Number(et.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(Yr+=a,Yr>=1){let u=Math.floor(Yr);Yr-=u,P.gears&&P.gears.add(u)}}else Yr=0}function Ff(){P.gears&&P.gears.set(0),ga(c.zero())&&(et=c.zero()),Yr=0,eo()}function Bh(e){if(!e)return;let t=ha.get(e);if(!t){let s=e.getBoundingClientRect();t={gears:[],width:s.width,height:s.height,needsDistribution:!s.width||!s.height},ha.set(e,t)}let n=e.getBoundingClientRect();n.width>0&&n.height>0&&(t.width=n.width,t.height=n.height);let o=0;et.cmp(Nf)>0?o=Nf:o=Number(et.toPlainIntegerString());let r=Math.min(Math.floor(o),Nf),i=t.gears;for(;i.length<r;){let s=document.createElement("img");s.src=Fh,s.classList.add("workshop-bg-gear"),s.alt="",s.setAttribute("aria-hidden","true");let l=32+Math.random()*48,a=0,u=0;t.width>0&&t.height>0?(a=Math.random()*(t.width-l),u=Math.random()*(t.height-l),a<0&&(a=0),u<0&&(u=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,f=Math.cos(d)*Ph,p=Math.sin(d)*Ph,g=Math.random()*360,m=(Math.random()<.5?-1:1)*(xS+Math.random()*LS);s.style.width=`${l}px`,s.style.transform=`translate3d(${a}px, ${u}px, 0) rotate(${g}deg)`,s.style.willChange="transform",e.appendChild(s),i.push({element:s,x:a,y:u,dx:f,dy:p,rotation:g,rotationSpeed:m,size:l})}for(;i.length>r;){let s=i.pop();s.element.parentNode&&s.element.parentNode.removeChild(s.element)}}function MS(e){let t="Click the big red button below to open the Automation Shop";je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${yS}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${Fh}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${vS}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{_S()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),kS()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{zl("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(zt&&zt.isConnected){let a=zt.querySelector(".workshop-side-left"),u=zt.querySelector(".workshop-side-right"),d=f=>{if(!f)return;let p=ha.get(f);if(p){let g=f.getBoundingClientRect();if(p.width=g.width,p.height=g.height,p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let m of p.gears)m.x=Math.random()*(p.width-m.size),m.x<0&&(m.x=0),m.y=Math.random()*(p.height-m.size),m.y<0&&(m.y=0),m.element.style.transform=`translate3d(${m.x}px, ${m.y}px, 0) rotate(${m.rotation}deg)`}}};d(a),d(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Uh():TS()},{root:null,threshold:0}).observe(e),zt=e}function eo(){if(!zt)return;let e=zt.querySelector('[data-workshop="gears-amount"]'),t=zt.querySelector('[data-workshop="gears-rate"]'),n=zt.querySelector('[data-workshop="upgrade-cost"]'),o=zt.querySelector('[data-workshop="upgrade-gen"]'),r=Uf(et),i=lr(et);if(e&&(e.innerHTML=P.gears.fmt(P.gears.value)),t&&(t.innerHTML=Q(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${Q(i)} ${l}`}if(o){let l=P.coins.value.cmp(i)>=0;o.disabled=!l;let a=_t(Ke,Qn),u=!1;if(a>0){let d=v(),f=d!=null?`:${d}`:"",p=`ccc:autobuy:${Ke}:${Qn}${f}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(et.isInfinite()?s="Infinity":s=et.floorToInteger().toStorage(),s!==Bf){Bf=s;let l=zt.querySelector(".workshop-side-left"),a=zt.querySelector(".workshop-side-right");l&&Bh(l),a&&Bh(a)}}function TS(){Hi&&(cancelAnimationFrame(Hi),Hi=null)}function Uh(){if(Hi)return;pa=0;let e=t=>{if(zt&&zt.isConnected){let n=zt.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=P.gears.fmt(P.gears.value)),pa||(pa=t);let o=(t-pa)/1e3;pa=t,o>.1&&(o=.1);for(let[r,i]of ha){if(!r.isConnected)continue;let{gears:s,width:l,height:a}=i;if(!(!l||!a))for(let u of s)u.x+=u.dx*o,u.y+=u.dy*o,u.x<0?(u.x=0,u.dx=-u.dx):u.x+u.size>l&&(u.x=l-u.size,u.dx=-u.dx),u.y<0?(u.y=0,u.dy=-u.dy):u.y+u.size>a&&(u.y=a-u.size,u.dy=-u.dy),u.rotation+=u.rotationSpeed*o,u.element.style.transform=`translate3d(${u.x}px, ${u.y}px, 0) rotate(${u.rotation}deg)`}}Hi=requestAnimationFrame(e)};Hi=requestAnimationFrame(e)}function Dh(){Rh||(Rh=!0,et=ma(),yo(CS),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{et=ma(),Yr=0,Ut()||Ff(),eo()}),window.addEventListener("currency:change",e=>{e.detail.key===Me.COINS&&eo()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Me.GEARS&&eo()}),window.addEventListener("debug:change",()=>{et=ma(),eo()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Ut()||Ff())})))}function Df(e){Dh(),!e.__workshopInit&&(e.__workshopInit=!0,et=ma(),ha.clear(),Bf=-1,MS(e),typeof IntersectionObserver>"u"&&Uh(),Ut()||Ff(),eo())}function Yl(){let e=ma();return Uf(e)}function Wl(){let e=P.coins.value.isInfinite(),n=lr(et).isInfinite();if(e&&n&&!et.isInfinite())return et=c.fromAny("Infinity"),ga(et),eo(),!0;if(P.coins.value.isZero())return!1;let o=$e(P.coins.value);if(!Number.isFinite(o))if(P.coins.value.inf)o=1/0;else return!1;if(ya(et)>o||et.cmp(9e15)>0)return!1;let r=Number(et.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);ya(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(et)>0&&ga(a)?(et=a,eo(),!0):!1}function kS(){if(P.coins.value.isInfinite()){Wl()&&Kt();return}let e=$e(P.coins.value);if(!Number.isFinite(e)&&P.coins.value.isZero()||ya(et)>e||et.cmp(9e15)>0)return;let t=Number(et.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);ya(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(et.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(lr(c.fromInt(u)));if(l.cmp(P.coins.value)>0){let u=lr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(et)>0&&ga(a)&&(et=a,P.coins.sub(l),eo(),Kt())}var Fh,yS,vS,Nf,zt,Rh,Yr,et,Bf,Hi,Rf,Of,Vr,da,Hl,Oh,qi,bS,SS,IS,wS,ES,Xl,Vl,Pf,ha,Ph,xS,LS,pa,Xi=De(()=>{xt();Yt();bt();Gr();zr();vo();yn();bo();Xr();Fh="img/currencies/gear/gear.webp",yS="img/currencies/gear/gear_plus_base.webp",vS="img/currencies/coin/coin.webp",Nf=100,zt=null,Rh=!1,Yr=0,et=c.zero(),Bf=-1,Hi=null,Rf=12,Of=.3010299956639812,Vr=1e6,da=1e9,Hl=1e12,Oh=1,qi=.001,bS=1e3,SS=Math.log10(1.00001),IS=23e-11,wS=Math.log(10),ES=1/wS;Xl=null,Vl=null,Pf=null;ha=new Map,Ph=67,xS=67,LS=67;pa=0});var Vh={};vt(Vh,{getLabCost:()=>Hh,getLabLevel:()=>to,getLabLevelFromCoins:()=>Xh,getLabLevelKey:()=>qf,getRpMult:()=>Xf,getRpMultBase:()=>jl,hasVisitedLab:()=>Wi,initLabLogic:()=>AS,initLabTab:()=>Vf,setLabLevel:()=>ba,setLabVisited:()=>Gh,updateLabLevel:()=>Gf,updateLabTab:()=>Yf});function Wi(){let e=v();if(e==null)return!1;try{return localStorage.getItem(qh(e))==="1"}catch{return!1}}function Gh(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(qh(t),n?"1":"0")}catch{}}function to(){let e=v();if(e==null)return c.fromInt(0);if(P.coins.value.isInfinite())return c.fromAny("Infinity");try{let t=localStorage.getItem(Kl(e));return t?c.fromAny(t):c.fromInt(0)}catch{return c.fromInt(0)}}function ba(e){let t=v();if(t!=null)try{let n=c.fromAny(e),o=to();if(n.cmp(o)===0)return;localStorage.setItem(Kl(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function Hh(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=29+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=29n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Xh(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),d=s-29n+BigInt(u);return d<0n?c.fromInt(0):c.fromInt(d)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-29;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Gf(){let e=v();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Kl(e)))return;let t=P.coins.value,n=to();if(t.isInfinite()){n.isInfinite()||ba(c.fromAny("Infinity"));return}let o=Xh(t);o.cmp(n)>0&&ba(o)}function AS(){yo(Gf),yo(Wh)}function Hf(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function NS(e){if(!e||typeof e!="object")return 0;if(Hf(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function OS(e){if(Hf(e)||typeof e.cmp=="function"&&e.cmp(RS)>=0)return Vi.clone?.()??Vi;let t=e.floorToInteger(),n=e.sub(t),o=NS(n);if(!Number.isFinite(o))return Vi.clone?.()??Vi;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return Vi.clone?.()??Vi;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function jl(){let e=to();if(Hf(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return OS(n)}function Xf(){let e=jl();return typeof Fn=="function"?Fn("rp",e):e}function Vf(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",va&&va.destroy(),va=new $f(e))}function Yf(){Gh(!0),va&&va.resize()}var qh,Kl,qf,Vi,RS,va,$f,Ia=De(()=>{bt();bo();xt();Yt();no();Gr();Pi();Zl();zr();qh=e=>`ccc:lab:visited:${e}`,Kl=e=>`ccc:lab:level:${e}`;qf=e=>Kl(e);Vi=c.fromAny("Infinity"),RS=c.fromScientific(String(c.MAX_E));va=null;$f=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${Q(to())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Gf()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none"}update(t){this.checkBounds();let n=to(),o=Hh(n.add(1)),r=Ot(),i=Ro(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${Q(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${Q(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let f=this.bursts.length-1;f>=0;f--){let p=this.bursts[f];p.time+=t;for(let g of p.particles)g.x+=g.vx*t,g.y+=g.vy*t,g.vx*=.95,g.vy*=.95;p.time>=p.life&&this.bursts.splice(f,1)}let a=500/this.zoom,u=0,d=0;if(this.keys.KeyW&&(d-=1),this.keys.KeyS&&(d+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||d!==0){let f=Math.sqrt(u*u+d*d);u/=f,d/=f,this.camX+=u*a*t,this.camY+=d*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,d=Math.floor(Math.log10(u)),f=Math.pow(10,d),p=(k,U)=>{if(U<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*U})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/k)*k,F=Math.ceil((this.camX+n/2/r)/k)*k;if((F-M)/k>1e3)return;for(let H=M;H<=F;H+=k){let j=(H-this.camX)*r+n/2;t.moveTo(j,0),t.lineTo(j,o)}let R=Math.floor((this.camY-o/2/r)/k)*k,_=Math.ceil((this.camY+o/2/r)/k)*k;for(let H=R;H<=_;H+=k){let j=(H-this.camY)*r+o/2;t.moveTo(0,j),t.lineTo(n,j)}t.stroke()},g=f*r,m=Math.max(0,Math.min(1,(g-15)/25));p(f,m),p(f*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let y=(0-this.camY)*r+o/2;y>=-10&&y<=o+10&&(t.moveTo(0,y),t.lineTo(n,y));let h=(0-this.camX)*r+n/2;h>=-10&&h<=n+10&&(t.moveTo(h,0),t.lineTo(h,o)),t.stroke();let b=512,x=b*r,C=b*1.6*r;for(let k of jt){let U=(k.x-this.camX)*r+n/2,M=(k.y-this.camY)*r+o/2,F=Un(k.id),R=F>=k.maxLevel,_=!R&&Yi(k.id),H=_?.8:.5;if(U+C/2<0||U-C/2>n||M+C*H<0||M-C/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,U-C/2,M-C/2,C,C),R?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,U-C/2,M-C/2,C,C):Yi(k.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,U-C/2,M-C/2,C,C);let j=this.nodeImages[k.id];if(j||(j=new Image,j.src=k.icon,this.nodeImages[k.id]=j),j.complete&&j.naturalWidth!==0&&t.drawImage(j,U-x/2,M-x/2,x,x),_){let ye=Sa(k.id),K=0;if(ye.isInfinite?.()||typeof ye.cmp=="function"&&ye.cmp(c.fromAny("Infinity"))===0)K=0;else{let q=No(k.id);if(q.isZero?.())K=0;else try{if(ye.isZero?.())K=1;else{let le=q.div(ye).toScientific(5);K=Number(le)}}catch{K=0}}K=Math.max(0,Math.min(1,K));let ne=C*.96,pe=C*.18,be=U-ne/2,V=M+C/2+C*.05;t.fillStyle="#111",t.fillRect(be,V,ne,pe);let oe=t.createLinearGradient(be,V,be,V+pe);oe.addColorStop(0,"#2a5298"),oe.addColorStop(1,"#1e3c72"),t.fillStyle=oe,t.fillRect(be,V,ne*K,pe),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect(be,V,ne,pe),t.fillStyle="#fff",t.font=`bold ${pe*.7}px system-ui`,t.textAlign="center",t.textBaseline="middle",t.strokeStyle="#000",t.lineWidth=Math.max(.5,pe*.08);let $=`Level ${F}`;t.strokeText($,be+ne/2,V+pe/2),t.fillText($,be+ne/2,V+pe/2)}}let A=35,z=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let k of this.bursts){let U=(k.x-this.camX)*this.zoom+n/2,M=(k.y-this.camY)*this.zoom+o/2;for(let F=0;F<z.length;F++){let R=z[F],_=k.time-R.delay;if(_>0&&_<R.dur){let H=_/R.dur,j=1-Math.pow(1-H,3),ye=A*j,K=Math.max(0,1-Math.pow(H,2)),ne=1+F*.5,pe=t.createRadialGradient(U,M,ye*.6,U,M,ye);pe.addColorStop(0,"rgba(255, 200, 50, 0)"),pe.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,K*.15*ne)})`),pe.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,K*.2*ne)})`),pe.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=pe,t.beginPath(),t.arc(U,M,ye,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let F of k.particles)if(k.time<F.life){let R=1-k.time/F.life,_=U+F.x,H=M+F.y;t.fillStyle=`rgba(255, 255, 150, ${R})`,t.beginPath(),t.arc(_,H,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=512/2*1.6;for(let u of jt){let d=s-u.x,f=l-u.y;if(Math.sqrt(d*d+f*f)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=jt.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.textContent=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let d=document.createElement("div");d.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=Yi(t);Yh(t,!p),this.updateNodeOverlay()};let f=document.createElement("button");f.className="shop-close",f.textContent="Close",f.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},d.append(f,this.overlayToggleBtn),o.append(r,i,l,d),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Wf(r,o,()=>!!this.overlay,()=>f.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=jt.find(a=>a.id===this.activeOverlayId);if(!t)return;let n=Un(t.id),o=No(t.id),r=Sa(t.id),i=Yi(t.id),s=n>=t.maxLevel;s?(this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} (MAXED)`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")):(this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display=""));let l=n*t.effectPerLevel;if(this.overlayBonus.textContent=`Tsunami exponent bonus: +${l.toFixed(2)}`,!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let a=o.cmp(1e9)>0?Q(o):o.toString(),u=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?Q(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${Q(o)} / ${Q(r)}`}}onMouseDown(t){t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,d=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=d/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=512/2*1.6;for(let u of jt){let d=i-u.x,f=s-u.y;if(Math.sqrt(d*d+f*f)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<Number.MIN_VALUE&&(i=Number.MIN_VALUE),i>Number.MAX_VALUE&&(i=Number.MAX_VALUE);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,d=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=d-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<Number.MIN_VALUE&&(i=Number.MIN_VALUE),i>Number.MAX_VALUE&&(i=Number.MAX_VALUE);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,d=this.camX+(a-this.width/2)/r,f=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=d-(a-this.width/2)/i,this.camY=f-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});function Kr(e){return wa.nodes[e]||(wa.nodes[e]={rp:c.fromInt(0),level:0,active:!1}),wa.nodes[e]}function PS(e,t){let n=Kr(t);try{let o=localStorage.getItem(Jl(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(Ql(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(jh(e,t));n.active=i==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1}}function zh(){let e=v();wa.nodes={},e!=null&&jt.forEach(t=>PS(e,t.id))}function Kh(){let e=v();e!=null&&jt.forEach(t=>{let n=wa.nodes[t.id];if(n)try{localStorage.setItem(Ql(e,t.id),n.rp.toStorage())}catch{}})}function Un(e){return Kr(e).level}function zf(e,t){let n=v();if(n==null)return;let o=Kr(e);o.level=t;try{localStorage.setItem(Jl(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}}function No(e){return Kr(e).rp}function Kf(e,t){let n=Kr(e);n.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:n.rp}}))}catch{}}function Yi(e){return Kr(e).active}function Yh(e,t){let n=v();if(n==null)return;let o=Kr(e);o.active=!!t;try{localStorage.setItem(jh(n,e),o.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:o.active}}))}catch{}}function Sa(e){let t=jt.find(u=>u.id===e);if(!t)return c.fromAny("Infinity");let n=Un(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function Ro(){let e=jt.find(n=>n.id===1),t=Un(1);return e?t*e.effectPerLevel:0}function Wh(e){let t=Xf();if(t.isZero?.())return;let o=t.mulDecimal(e.toString(),18);jt.forEach(r=>{if(Yi(r.id)){let i=No(r.id),s=Sa(r.id);if(Un(r.id)>=r.maxLevel)return;let l=i.add(o);for(;;){let a=Sa(r.id);if(l.cmp(a)<0||Un(r.id)>=r.maxLevel)break;l=l.sub(a);let u=Un(r.id);zf(r.id,u+1)}Kf(r.id,l)}})}var Jl,Ql,jh,jt,wa,Zl=De(()=>{xt();bt();Ia();Jl=(e,t)=>`ccc:lab:node:level:${t}:${e}`,Ql=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,jh=(e,t)=>`ccc:lab:node:active:${t}:${e}`,jt=[{id:1,title:"Tsunami Exponent Restoration",desc:"Increases Tsunami exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"img/lab_icons/tsunami_exponent_buff.webp",effectPerLevel:.01}],wa={nodes:{}};typeof window<"u"&&(window.addEventListener("saveSlot:change",zh),setInterval(Kh,1e3),window.addEventListener("beforeunload",Kh),zh())});var ng={};vt(ng,{getBookProductionRate:()=>fr,getSurge6WealthMultipliers:()=>ec,getTsunamiNerf:()=>Ot,getTsunamiNerfKey:()=>Zf,getTsunamiSequenceSeen:()=>vn,initSurgeEffects:()=>US,isSurgeActive:()=>pt,setTsunamiNerf:()=>Ki,setTsunamiSequenceSeen:()=>ur});function Zf(e){return jf(e)}function vn(){let e=v();if(e==null)return!1;try{return localStorage.getItem(tg(e))==="1"}catch{return!1}}function ur(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(tg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Ot(){return cr}function Ki(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=v();if(n!=null){let o=jf(n);if(rn(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}cr=t,zi();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function pt(e){return oo===1/0||typeof oo=="string"&&oo==="Infinity"||oo===Number.POSITIVE_INFINITY?!0:typeof oo=="bigint"?oo>=BigInt(e):typeof oo=="number"?oo>=e:!1}function Ea(e){if(!pt(8))return e;let t=$e(e);if(!Number.isFinite(t))return e;let o=Ot()+Ro();return o>1&&(o=1),Ae(t*o)}function zi(){let e=bn();oo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(pt(8)){let o=Ot()+Ro();o>1&&(o=1);let r=Math.log10(Zh);Oo=Ae(r*o)}else Oo=c.fromInt(Zh);else Oo=c.fromInt(1)}function ec(){if(!pt(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,g=0)=>{if(!p){if(g<=0)return c.fromInt(1);let E=Math.log10(g)/3;if(E<=0)return c.fromInt(1);let C=E*Math.log10(2);return Ae(C)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=$e(p),y=m;if(Number.isFinite(m)){if(m<15&&g>0)try{let x=Number(p.toPlainIntegerString());if(Number.isFinite(x)){let E=x+g;E>0&&(y=Math.log10(E))}}catch{}}else if(g>0)y=Math.log10(g);else return c.fromInt(1);let h=y/6;if(h<=0)return c.fromInt(1);let b=h*Math.log10(2);return Ae(b)},t=e(P.coins?.value),n=P.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(P.gold?.value),s=e(P.magic?.value),l=t,a=r,u=i,d=s;pt(8)&&(l=Ea(t),a=Ea(r),u=Ea(i),d=Ea(s));let f=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return f=f.mulBigNumInteger?f.mulBigNumInteger(u):f,f=f.mulBigNumInteger?f.mulBigNumInteger(d):f,{coins:l,books:a,gold:u,magic:d,total:f}}function fr(){if(!pt(3))return c.fromInt(0);let t=Qe().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(Jh),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Ae(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*Jh;n=Ae(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),P.books?.mult){let o=P.books.mult.get();n=n.mulBigNumInteger(o)}return pt(8)&&(n=Ea(n)),n}function BS(e){if(!pt(3))return;Qh||(Qh=new aa("books",P));let t=fr();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);P.books&&P.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,P.books&&P.books.add(c.fromInt(o))}}}function eg(e){if(e==null)return;let t=localStorage.getItem(jf(e));t!==null?(cr=Number(t),(Number.isNaN(cr)||!Number.isFinite(cr))&&(cr=pt(8)?0:1)):pt(8)?cr=0:cr=1}function FS(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function US(){let e=v();zi(),eg(e),zi(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=oo,n=pt(8);zi();let o=oo,r=pt(8);!n&&r?(Ki(0),vn()||ur(!0)):r?FS(t,o)>0&&(Ki(0),vn()||ur(!0)):n&&!r&&Ki(1)}),window.addEventListener("lab:node:change",()=>{zi()}),window.addEventListener("saveSlot:change",()=>{eg(v()),zi()})),Ur(({baseMultiplier:t})=>Oo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Oo)),Oi(({baseGain:t})=>Oo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Oo)),jr(({baseGain:t})=>Oo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(Oo)),jr(({baseGain:t})=>{if(!pt(4))return t;let n=c.fromInt(4444e9);if(pt(8)){let r=Ot()+Ro();r>1&&(r=1);let i=Math.log10(4444e9);n=Ae(i*r)}return t.mulBigNumInteger(n)}),Ur(({baseMultiplier:t})=>{if(!pt(6))return t;let n=ec();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),Dl(({baseReward:t})=>pt(3)?c.fromInt(0):t),yo(BS)}var Zh,Jh,jf,tg,Oo,oo,Qh,cr,no=De(()=>{xt();bt();Zn();So();vo();Gr();yn();Zl();Zh=10,Jh=.08685889638,jf=e=>`ccc:surge:tsunamiNerf:${e}`,tg=e=>`ccc:unlock:tsunami:${e}`;Oo=c.fromInt(1),oo=0n,Qh=null,cr=0});var ig={};vt(ig,{calculateOfflineRewards:()=>ji,calculatePreAutomationRewards:()=>nc,formatTimeCompact:()=>tc,grantOfflineRewards:()=>Zr,initOfflineTracker:()=>$S,processOfflineProgress:()=>rg,showOfflinePanel:()=>dr});function tc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let h=t.div(l).floorToInteger(),b=h.mulBigNumInteger(l),x=t.sub(b),E=0;try{let C=x.div(c.fromInt(i)).floorToInteger();E=Number(C.toPlainIntegerString())}catch{E=0}return E===0?`${Q(h)}y`:`${Q(h)}y ${E}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let d=Math.floor(u/60),f=u%60;if(d<60)return f===0?`${d}m`:`${d}m ${f}s`;let p=Math.floor(d/60),g=d%60;if(p<24)return g===0?`${p}h`:`${p}h ${g}m`;let m=Math.floor(p/24),y=p%24;return y===0?`${m}d`:`${m}d ${y}h`}function dr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${tc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let d=document.createElement("div");d.className="offline-list",DS.forEach(m=>{let y=m.key,h=e[y];if(!h||h.isZero())return;let b=document.createElement("div");b.className="offline-row";let x=document.createElement("span");x.className="offline-plus",x.classList.add(`text-${y}`),x.textContent="+";let E=document.createElement("img");E.className="offline-icon",E.src=m.icon,E.alt=y;let C=document.createElement("span");C.className="offline-text",C.classList.add(`text-${y}`);let A=!1;h instanceof c?A=!h.isInfinite()&&h.cmp(c.fromInt(1))===0:A=Number(h)===1;let z=A?m.singular:m.plural;C.innerHTML=`${Q(h)} ${z}`,b.appendChild(x),b.appendChild(E),b.appendChild(C),d.appendChild(b)}),u.appendChild(d),a.appendChild(u);let f=document.createElement("div");f.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let g=()=>{r.remove()};return p.addEventListener("click",g),r.addEventListener("click",m=>{m.target===r&&g()}),f.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(f),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{Zi(i,a,".offline-scroll-container")}),r}function ji(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},i=(Yl?Yl():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();i.isZero()||Nn("gears",t)||(o.gears=i);let s=fr?fr():c.fromInt(0);if(!s.isZero()){let a=s.mulBigNumInteger(n).floorToInteger();a.isZero()||Nn("books",t)||(o.books=a)}let l=_t(Ke,Hr)||0;if(l>0){let a=1;pt(2)&&(a=10);let u=c.fromInt(l).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(a)).floorToInteger();if(!u.isZero()){let d=rc(),f=d.coins.mulBigNumInteger(u),p=d.xp.mulBigNumInteger(u),g=d.mp.mulBigNumInteger(u);f.isZero()||Nn("coins",t)||(o.coins=f),p.isZero()||rn(`ccc:xp:progress:${t}`)||(o.xp=p),g.isZero()||rn(`ccc:mutation:progress:${t}`)||(o.mp=g)}}return o}function Zr(e){if(v()!=null){if(e.xp)try{let n=Ri(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Qi(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||P[n]&&typeof P[n].add=="function"&&P[n].add(e[n])}}function nc(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=Dn(),i=c.fromInt(1);try{let l=Ji(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Fn=="function"){let l=Fn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=rc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),d=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||rn(`ccc:xp:progress:${t}`)||(o.xp=u),d.isZero()||rn(`ccc:mutation:progress:${t}`)||(o.mp=d)}return o}function rg(){let e=v();if(e==null)return;let t=ef(),n=Date.now();if(t<=0)return;if(n<t-1e4){pn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Ut()){let l=nc(r),a=Object.keys(l).length>0;return a&&(Zr(l),dr(l,o,!0)),a}let i=ji(r),s=Object.keys(i).length>0;return s&&(Zr(i),dr(i,o)),s}function $S(e,t){og||(og=!0,document.addEventListener("visibilitychange",()=>{v()!=null&&(e&&!e()||(document.hidden?kf():(Af(),rg()&&typeof t=="function"&&t())))}))}var og,DS,oc=De(()=>{bt();Xi();vo();Gr();bt();xt();Yt();zr();bo();yn();Xr();xa();Zn();So();no();Pi();og=!1;DS=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"}];window.createOfflinePanel=dr});function ed(e){let t=24,n=Date.now();try{let o=localStorage.getItem(Jf(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Qf(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(Jf(e),"24"),localStorage.setItem(Qf(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function ag(e,t,n){try{localStorage.setItem(Jf(e),String(t)),localStorage.setItem(Qf(e),String(n))}catch{}}function lg(){let e=v();if(e==null)return;let{charges:t,lastCharge:n}=ed(e);if(t>=es)return;let o=Date.now(),r=o-n;if(r>=ic){let i=Math.floor(r/ic);t+=i,t>=es?(t=es,n=o):n+=i*ic,ag(e,t,n),pr&&pr.classList.contains("is-active")&&Po(!0)}}function GS(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function HS(){let e=v();if(e==null)return;lg();let{charges:t,lastCharge:n}=ed(e);t<=0||(t>=es&&(n=Date.now()-50),t--,ag(e,t,n),Po(!0),La&&clearInterval(La),La=setInterval(()=>{Po()},1e3),ft(qS,{volume:.5}),GS(),setTimeout(()=>{let o=ji(sg);Zr(o),dr(o,sg*1e3)},7250))}function Po(e=!1){if(!pr||!pr.classList.contains("is-active"))return;let t=v();if(t==null)return;e||lg();let{charges:n,lastCharge:o}=ed(t),r=pr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${es}</span>`);let i=pr.querySelector(".warp-timer");if(i)if(n>=es)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+ic,u=Math.max(0,a-l);i.textContent=`Next warp in ${tc(u)}`}let s=pr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function cg(e){if(!e||e.__warpInit)return;e.__warpInit=!0,pr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",HS),La||(La=setInterval(()=>{Po()},1e3)),Po()}var Jf,Qf,es,ic,sg,qS,pr,La,td=De(()=>{bt();oc();An();Jf=e=>`ccc:warp:charges:${e}`,Qf=e=>`ccc:warp:lastCharge:${e}`,es=24,ic=3600*1e3,sg=150,qS="sounds/warp.ogg",pr=null,La=null});function bg(){try{return localStorage.getItem(hr(ud))==="1"}catch{return!1}}function dd(){try{return localStorage.getItem(hr(Sg))==="1"}catch{return!1}}function cc(e){let t=v();if(t==null)return;let n=`${Sg}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),XS()}catch{}}function uc(){return dd()?"Jeff":"Merchant"}function XS(){let e=uc();Ve&&Ve.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function _a(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=h=>{if(!(n&&o)){if(h?.type==="click"&&h.isTrusted&&Jn(e)){h.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(h)).catch(b=>console.error(b)),n&&y()}},l=()=>{r=!1,i=null},a=h=>{r&&l(),s(h)},u=h=>{h.pointerType!=="mouse"&&(typeof h.button=="number"&&h.button!==0||(r=!0,i=typeof h.pointerId=="number"?h.pointerId:null,go(160)))},d=h=>{r&&(i!=null&&typeof h.pointerId=="number"&&h.pointerId!==i||l())},f=()=>{r&&l()},p=h=>{r=!0,go(160)},g=h=>{r&&l()},m=()=>{r&&l()},y=()=>{e.removeEventListener("click",a),Ig?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",f)):KS&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",g),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function sc(e){return WS[e]??0}function ug(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function jS(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function Ma(e,t){let n=Jr.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;ns.set(e,r),n.unlocked=r;let i=Sn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&Sn.buttons[e]?.classList.contains("is-active")&&pc("dialogue")}function nd(){let e=!1;try{e=!!is?.()}catch{}Ma("reset",e)}function od(){let e=!1;try{e=!!Ut?.()}catch{}Ma("workshop",e)}function mg(){let e=!1;try{typeof Io=="function"&&(e=Io())}catch{}Ma("warp",e)}function ZS(){let e=v();if(e==null)return!1;try{return typeof vn=="function"&&vn()?!0:localStorage.getItem(wg(e))==="1"}catch{return!1}}function ad(){Ma("lab",ZS())}function JS(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function QS(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof an=="function"&&an()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Qe=="function"?Qe():null;t&&typeof t=="object"&&(e.xpLevel=JS(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof yr=="function"&&yr()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Ut=="function"&&Ut()}catch{e.hasInfuseReset=!1}return e}function eI(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?id:sd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?id:sd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?pd:""),i.icon=o?.icon??(r==="mysterious"?mr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Bo:YS),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function tI(){if(fg)return;fg=!0;let e=nI;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==v()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=v();if(t!=null){let n=`${zS}:${t}`;Lt(n,{onChange:e})}}function nI(){Fo()}function oI(e,t){let n=md(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,Eg(n),rI(t.reward),!0)}function rI(e){if(e){if(e.type==="coins"){try{P.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{P.books.addWithMultiplier?.(e.amount)??P.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{P.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{P.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function iI(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function md(){try{return JSON.parse(localStorage.getItem(hr(Ca))||"{}")}catch{return{}}}function Eg(e){let t=hr(Ca);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{rt(t,n)}catch{}}catch{}}function sI(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function aI(){let e=ld;if(ld=null,typeof e=="function")try{e()}catch{}}function lI(e,t={}){t?.rawChanged&&Fo()}function rd(e){if(e===hg)return;if(aI(),hg=e??null,e==null){Fo();return}let t=`${Ca}:${e}`;ld=Lt(t,{parse:sI,onChange:lI});try{rt(t)}catch{}Fo()}function cI(){if(dg){rd(v());return}dg=!0,rd(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{rd(v())})}function vr(){Promise.resolve().then(()=>(An(),bl)).then(({loadAudio:e})=>{e(xg)})}function uI(){if(ts)return;ts=ft(xg,{volume:je?.15:.3,loop:!0})}function Do(){ts&&(ts.stop&&ts.stop(),ts=null)}function fI(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let x=0;x<t.length;x++){let E=t[x];E==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=E):E===">"&&l?(s+=E,i.push({type:"tag",content:s}),s="",l=!1):s+=E}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,d=!1,f=!1,p="";Uo=!0,uI();let g=x=>{f&&(x.preventDefault(),d=!0)},m=x=>{f&&(x.key==="Enter"||x.key===" ")&&(d=!0)},y=o.length?o:[e];requestAnimationFrame(()=>{f=!0,y.forEach(x=>x.addEventListener("click",g,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let h=()=>{y.forEach(x=>x.removeEventListener("click",g)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),Do(),Uo=!1},b=()=>{if(d){e.innerHTML=t,h(),r();return}if(a>=i.length){h(),r();return}let x=i[a];x.type==="tag"?(p+=x.content,e.innerHTML=p,a++,b()):(p+=x.content[u],e.innerHTML=p,u++,u>=x.content.length&&(a++,u=0),setTimeout(b,n))};b()})}function dI(e={}){if(!Ve)return;vr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Bo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||mr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,Ve.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Bo,r.textContent=e.message||pd,requestAnimationFrame(()=>t.classList.add("is-visible")),Ve.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),Do(),Uo=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=d=>{d.key==="Escape"&&(d.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",d=>{n.contains(d.target)||(d.preventDefault(),wn(160),l())});let u=d=>{(!d||d.pointerType!=="mouse")&&wn(160),l()};_a(i,()=>{u()},{once:!0}),i.focus?.()}function pI(e,t){vr();let n=t.scriptId;String(e)==="6"&&typeof Wi=="function"&&!Wi()&&(n=7),Nr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${uc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${os}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,Ve.appendChild(o);let r=h=>{h.key==="Escape"&&o.isConnected&&f()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),Ve.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,d=()=>{Nr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),Do(),Uo=!1,o.remove()},f=()=>{u||(u=!0,d(),Fo())};o.addEventListener("pointerdown",h=>{l.contains(h.target)||(h.preventDefault(),h.pointerType!=="mouse"&&wn(160),f())});let p=new gr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(h,b)=>{t.scriptId===4&&h==="c4b"&&cc(!0)},onEnd:h=>{if(!u){if(u=!0,h&&h.noReward){Fo(),d();return}oI(e,t),Fo(),d()}}}),m=!!md()[e]?.claimed,y=structuredClone(Lf[n]);m&&y.nodes.m2b&&y.nodes.c2a&&t.scriptId===1&&(y.nodes.m2b.say="I've already given you Coins, goodbye.",y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&y.nodes.m3a&&(y.nodes.m3a.say="I've already given you Books, goodbye.",y.nodes.c2a&&(y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&y.nodes.m5a&&(y.nodes.m5a.say="I've already given you Gold, goodbye.",y.nodes.c5a&&(y.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&y.nodes.m7a&&(y.nodes.m7a.say="I've already given you Magic, goodbye.",y.nodes.c7a&&(y.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(y),p.start()}function mI(){if(document.getElementById(yg))return;let e=document.createElement("style");e.id=yg,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function hI(){let e=Ve?.querySelector(".merchant-content");if(!e||e.__customScroll||!mt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),mt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){mI();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;mt.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let d=null,f=()=>{let R=(e.scrollTop||0)>0;d!==R&&(d=R,mt?.classList.toggle("has-scroll-shadow",R))},p=()=>{let R=Ve.querySelector(".merchant-grabber"),_=Ve.querySelector(".merchant-header"),H=Ve.querySelector(".merchant-actions"),j=(R?.offsetHeight||0)+(_?.offsetHeight||0)|0,ye=(H?.offsetHeight||0)|0;t.style.top=j+"px",t.style.bottom=ye+"px"},g={},m=()=>{let{scrollHeight:R,clientHeight:_,scrollTop:H}=e,j=t.clientHeight||e.clientHeight||1;if(g.scrollHeight===R&&g.clientHeight===_&&g.barH===j&&(u||g.scrollTop===H))return;g={scrollHeight:R,clientHeight:_,scrollTop:H,barH:j};let ye=_/Math.max(1,R),K=Math.max(28,Math.round(j*ye)),ne=Math.max(1,R-_),pe=Math.max(0,j-K);if(n.style.height=K+"px",u)n.style.setProperty("--thumb-y",`${pe}px`),n.style.setProperty("--thumb-x","0px");else{let be=Math.round(H/ne*pe);n.style.transform=`translateY(${be}px)`}t.style.display=R<=_+1?"none":""},y=()=>{p(),m(),f()},h=()=>{o&&(mt.classList.add("is-scrolling"),l&&clearTimeout(l))},b=R=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{mt.classList.remove("is-scrolling")},R))},x=()=>{m(),f(),o&&h(),s||b(r)},E=()=>b(r);e.addEventListener("scroll",x,{passive:!0}),s&&e.addEventListener("scrollend",E,{passive:!0});let C=new ResizeObserver(y);C.observe(e),window.addEventListener("resize",y),requestAnimationFrame(y);let A=!1,z=0,k=0,U=R=>{A=!0,z=R.clientY,k=e.scrollTop,n.classList.add("dragging"),h();try{n.setPointerCapture(R.pointerId)}catch{}R.preventDefault()},M=R=>{if(!A)return;let _=t.clientHeight||1,H=n.clientHeight||1,j=Math.max(1,_-H),ye=Math.max(1,e.scrollHeight-e.clientHeight),ne=(R.clientY-z)/j*ye;e.scrollTop=k+ne},F=R=>{if(A){A=!1,n.classList.remove("dragging"),b(i);try{n.releasePointerCapture(R.pointerId)}catch{}}};n.addEventListener("pointerdown",U),window.addEventListener("pointermove",M,{passive:!0}),window.addEventListener("pointerup",F),window.addEventListener("pointercancel",F),t.addEventListener("pointerdown",R=>{if(R.target===n)return;let _=t.getBoundingClientRect(),H=R.clientY-_.top,j=t.clientHeight||1,ye=n.clientHeight||1,K=Math.max(0,j-ye),ne=Math.max(0,Math.min(H-ye/2,K)),pe=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ne/Math.max(1,K)*pe,h(),b(r)}),e.__customScroll={bar:t,thumb:n,ro:C,updateAll:y},y()}function gI(){if(Ve)return;Ve=document.createElement("div"),Ve.className="merchant-overlay",Ve.id="merchant-overlay",Ve.setAttribute("inert",""),mt=document.createElement("div"),mt.className="merchant-sheet",mt.setAttribute("role","dialog"),mt.setAttribute("aria-modal","false"),mt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",nd(),od(),mg(),ad(),Jr.forEach(g=>{g.key==="dialogue"&&ns.set("dialogue",!0);let m=ns.get(g.key),y=m??!!g.unlocked,h=document.createElement("button");h.type="button",h.className="merchant-tab",h.dataset.tab=g.key;let b=g.lockedLabel||"???";h.textContent=y?g.label:b,y?h.title=g.label||"Tab":(h.classList.add("is-locked"),h.disabled=!0,h.title="???"),g.unlocked=y,ns.set(g.key,y),_a(h,x=>{if(h.disabled){x?.preventDefault?.();return}pc(g.key)}),o.appendChild(h),Sn.buttons[g.key]=h}),Sn.panels.dialogue=i,Sn.panels.reset=s,Sn.panels.workshop=l,Sn.panels.warp=a,Sn.panels.lab=u,Sn.tablist=o,r.append(i,s,l,a,u),n.append(o,r),nd(),od();try{$o()}catch{}try{hd(s)}catch{}try{Ye()}catch{}try{Df(l)}catch{}try{cg(a)}catch{}try{Vf(u)}catch{}if(!pg&&typeof window<"u"){let g=m=>{let{key:y,slot:h}=m?.detail??{};h!=null&&h!==v()||((y==="forge"||!y)&&nd(),(y==="infuse"||!y)&&od(),(y==="surge_completed"||!y)&&mg(),(y==="lab"||y==="tsunami"||!y)&&ad())};window.addEventListener("unlock:change",g,{passive:!0}),window.addEventListener("saveSlot:change",g,{passive:!0}),pg=!0}let d=document.createElement("div");d.className="merchant-actions";let f=document.createElement("button");f.type="button",f.className="merchant-close",f.textContent="Close",ac=f,d.appendChild(f);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${os}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,mt.append(e,t,n,d,p),Ve.appendChild(mt),document.body.appendChild(Ve),yI(),hI(),gg||(gg=!0,_a(f,()=>{dc()},{once:!1}),document.addEventListener("keydown",II),e.addEventListener("pointerdown",wI),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),Ve.addEventListener("pointerdown",vr,{once:!0}))}function yI(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,tI(),Fo()}function vI(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?pI(n.id,n.meta):n.isMysterious&&dI(n.lockInfo)}}function Fo(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=QS(),o=md(),r=!1,i=new Set;Object.entries(fc).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",d=sc(u),f=eI(l,n),p=f.status,g=sc(p);if(g>d)a.status=p,p==="mysterious"?a.lockSnapshot=ug(f):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(g<d){if(u==="unlocked")f=jS(l),p="unlocked",g=sc(p);else if(u==="mysterious"){let R=a.lockSnapshot||ug(f)||{};f={status:"mysterious",unlocked:!1,title:R.title??f.title??"???",blurb:R.blurb??f.blurb??id,tooltip:R.tooltip??f.tooltip??"Hidden Dialogue",message:R.message??f.message??pd,icon:R.icon??f.icon??mr,headerTitle:R.headerTitle??f.headerTitle??Bo,ariaLabel:R.ariaLabel??f.ariaLabel??"Hidden merchant dialogue"},p="mysterious",g=sc(p)}}let m=p==="unlocked",y=p==="mysterious",h=p==="locked",b=!!a.claimed,x=m&&!!(l.once&&b),E=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!E){E=document.createElement("button"),E.type="button",E.className="dlg-card",E.dataset.dlgId=String(s);let R=document.createElement("div");R.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let H=document.createElement("div");H.className="dlg-reward",E.append(R,_,H),t.appendChild(E),_a(E,vI)}E._dlgCtx={id:s,meta:l,lockInfo:f,unlocked:m,isMysterious:y},E.dataset.dlgStatus=p,E.disabled!==!!h&&(E.disabled=!!h),E.classList.toggle("is-locked",h),E.classList.toggle("is-mysterious",y),E.classList.toggle("is-complete",!!x),E.classList.toggle("has-again",!!x),h?(E.getAttribute("aria-disabled")!=="true"&&E.setAttribute("aria-disabled","true"),E.getAttribute("tabindex")!=="-1"&&E.setAttribute("tabindex","-1")):(E.hasAttribute("aria-disabled")&&E.removeAttribute("aria-disabled"),E.hasAttribute("tabindex")&&E.removeAttribute("tabindex"));let C=E.querySelector(".dlg-title"),A=m?l.title:f.title??"???";C.textContent!==A&&(C.textContent=A);let z=E.querySelector(".dlg-blurb"),k=m?l.blurb:f.blurb??"";z.textContent!==k&&(z.textContent=k);let U=E.querySelector(".dlg-reward");if(m&&l.reward){let R=VS[l.reward.type];if(R){U.classList.contains("has-reward")||(U.classList.add("has-reward"),U.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),U.style.getPropertyValue("--reward-icon")!==`url('${R}')`&&U.style.setProperty("--reward-icon",`url('${R}')`);let _=U.querySelector(".amt"),H=String(l.reward.amount);_&&_.textContent!==H&&(_.textContent=H);let j=U.querySelector(".currency-name");if(j){let K=String(l.reward.type||""),ne=K.charAt(0).toUpperCase()+K.slice(1);j.textContent!==ne&&(j.textContent=ne)}let ye=`Reward: ${l.reward.amount} ${l.reward.type}`;U.getAttribute("aria-label")!==ye&&U.setAttribute("aria-label",ye)}else{U.classList.remove("has-reward");let _=iI(l.reward);U.textContent!==_&&(U.textContent=_),U.style.display!==""&&(U.style.display=""),U.removeAttribute("aria-label")}U.style.display==="none"&&(U.style.display="")}else U.textContent!==""&&(U.textContent=""),U.style.display!=="none"&&(U.style.display="none");let M=m?`${l.title}${x?" (completed)":""}`:f.ariaLabel||(y?"Hidden merchant dialogue":"Locked merchant dialogue");if(E.getAttribute("aria-label")!==M&&E.setAttribute("aria-label",M),f.tooltip)E.title!==f.tooltip&&(E.title=f.tooltip);else if(m){let R="Left-click: Start Dialogue";E.title!==R&&(E.title=R)}else E.hasAttribute("title")&&E.removeAttribute("title");let F=E.querySelector(".dlg-again");x?F||(F=document.createElement("div"),F.className="dlg-again",F.textContent="Ask Again?",E.appendChild(F)):F&&F.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&Eg(o)}function bI(){let e=Ve.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Nr(!0);let i=new gr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Nr(!1);try{localStorage.setItem(hr(ud),"1")}catch{}try{window.dispatchEvent(new Event(fd))}catch{}e.classList.remove("is-visible"),Ve.classList.remove("firstchat-active")}});i.load(Lf[0]),i.start()}function SI(){if(!Ve)return;let e=Ve.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),Ve.classList.remove("firstchat-active")}function Lg(){if(gI(),rs)return;let e=document.activeElement;e instanceof HTMLElement&&!Ve.contains(e)?lc=e:lc=null,rs=!0;let t=v(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(wg(t),"1")}catch{}ad();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(hr(ud))==="1"}catch{o=!1}o||Ve.classList.add("firstchat-instant"),mt.style.transition="none",mt.style.transform="",Ve.removeAttribute("inert"),mt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ve.classList.contains("firstchat-instant")||(mt.style.transition=""),Ve.classList.add("is-open"),wn(140),ac&&typeof ac.focus=="function")try{ac.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(hr(vg))||"dialogue"}catch{}n&&(r="dialogue"),pc(r),Do(),o||(Ve.querySelector(".merchant-firstchat")?.classList.add("is-visible"),Ve.classList.add("firstchat-active"),bI())})})}function dc(){if(!rs)return;if(Nr(!1),je){try{go(100)}catch{}try{wn(80)}catch{}}rs=!1,mt.style.transition="",mt.style.transform="",Ve.classList.remove("is-open"),Ve.classList.remove("firstchat-instant"),SI();let e=document.activeElement;if(e&&Ve.contains(e)){let t=lc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}Ve.setAttribute("inert",""),lc=null,Do(),Uo=!1}function II(e){if(rs&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<Jr.length;i++)ns.get(Jr[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<Jr.length&&(e.preventDefault(),pc(Jr[r].key))}}function wI(e){if(!rs)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;In={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},mt.style.transition="none",window.addEventListener("pointermove",_g,{passive:!0}),window.addEventListener("pointerup",Cg),window.addEventListener("pointercancel",Mg)}function _g(e){if(!In||In.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-In.startY);In.lastY=t,In.moved=n,mt.style.transform=`translateY(${n}px)`}function Cg(){if(!In||In.canceled){cd();return}let e=Math.max(1,performance.now()-In.startT),t=In.moved;t/e>.55&&t>40||t>140?(go(160),mt.style.transition="transform 140ms ease-out",mt.style.transform="translateY(100%)",setTimeout(()=>{dc()},150)):(mt.style.transition="transform 180ms ease",mt.style.transform="translateY(0)"),cd()}function Mg(){In&&(In.canceled=!0,mt.style.transition="transform 180ms ease",mt.style.transform="translateY(0)",cd())}function cd(){window.removeEventListener("pointermove",_g),window.removeEventListener("pointerup",Cg),window.removeEventListener("pointercancel",Mg),In=null}function pc(e){let t=Jr.find(o=>o.key===e),n=ns.get(e);(!t||!n)&&(e="dialogue");for(let o in Sn.buttons)Sn.buttons[o].classList.toggle("is-active",o===e);for(let o in Sn.panels)Sn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Fo()}catch{}if(e==="warp")try{Po()}catch{}if(e==="lab"){typeof Wi=="function"&&!Wi()&&EI();try{Yf()}catch{}}try{localStorage.setItem(hr(vg),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=Ve?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function Ta(e=[]){e.forEach(t=>Ma(t,!0))}function Tg(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${os}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");vr();let u=g=>{g.key==="Escape"&&(g.stopImmediatePropagation(),g.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let d=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{f()},5e3)},15e3)},1e3)},f=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${os}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let g=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),y=r.querySelector(".merchant-firstchat__row"),h=r.querySelector(".merchant-firstchat__card"),b={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},x=new gr({textEl:g,choicesEl:m,skipTargets:[g,y,h],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),Do(),Uo=!1,r.remove(),t&&t()},5e3)}});x.load(b),x.start()},p=new gr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",Do(),Uo=!1,n&&n.hideCursor&&n.hideCursor(),d()}});p.load(o),p.start()}function EI(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${uc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${os}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");vr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"What???",to:"end_nr"},{label:"Tsunami sacrifice???",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new gr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{Do(),Uo=!1,e.remove()}});s.load(i),s.start()}function kg(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${uc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${os}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");vr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new gr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{Do(),Uo=!1,t.remove(),e&&e()}});l.load(s),l.start()}var os,ud,vg,Ca,fd,hr,Sg,Jr,ns,VS,mr,Bo,YS,id,sd,pd,WS,zS,Ig,KS,fg,dg,pg,wg,hg,ld,fc,Ve,mt,ac,rs,In,lc,gg,Sn,xg,ts,Uo,gr,yg,mc=De(()=>{bt();xt();kh();Zn();vo();Xi();td();Ia();no();zr();Fi();bo();An();os="img/misc/merchant.webp",ud="ccc:merchantMet",vg="ccc:merchantTab",Ca="ccc:merchant:dlgState",fd="ccc:merchant:met",hr=e=>`${e}:${v()}`;Sg="ccc:unlock:jeff";Jr=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],ns=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),VS={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},mr="img/misc/mysterious.webp",Bo="Hidden Dialogue",YS="Locked Dialogue",id="Hidden Dialogue",sd="Locked",pd="Locked Dialogue",WS={locked:0,mysterious:1,unlocked:2},zS="ccc:reset:forge:completed",Ig=typeof window<"u"&&"PointerEvent"in window,KS=!Ig&&typeof window<"u"&&"ontouchstart"in window;fg=!1,dg=!1,pg=!1;wg=e=>`ccc:unlock:lab:${e}`;hg=null,ld=null;fc={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:mr,headerTitle:Bo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:sd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:mr,headerTitle:Bo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof Io=="function"&&Io()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:mr,headerTitle:Bo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof vn=="function"&&vn())return!0;let t=typeof bn=="function"?bn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof Io=="function"&&Io()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:mr,headerTitle:Bo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:mr,headerTitle:Bo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};cI();Ve=null,mt=null,ac=null,rs=!1,In=null,lc=null,gg=!1,Sn={buttons:{},panels:{},tablist:null},xg="sounds/merchant_typing.ogg",ts=null,Uo=!1;gr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await fI(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=_a(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};yg="ccc-scroll-timeline-styles"});var Ng={};vt(Ng,{getAutobuyerToggle:()=>Qr,initAutomationEffects:()=>MI,setAutobuyerToggle:()=>br,updateAutomation:()=>Ag});function yd(e){gc!==e&&(ss.clear(),gc=e)}function Qr(e,t){let n=v();yd(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(ss.has(r))return ss.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return ss.set(r,i),i}function br(e,t,n){let o=v();yd(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);ss.set(i,s);try{localStorage.setItem(i,s)}catch{}}function xI(e){Ag(e),CI(e)}function LI(){if(hc)return hc;let e=Bt(xe.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return hc=t,hc}function _I(e){if(!(!e||e.length===0)){for(let t of e)if(Qr(xe.STARTER_COVE,t.id)!=="0"){let o=_t(xe.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&bd(xe.STARTER_COVE,t.id)}}}function CI(e){let t=v();yd(t);let n=LI();for(let[r,i]of Object.entries($i)){let s=Number(r);_t(Ke,s)>0&&n[i]&&_I(n[i])}_t(Ke,Qn)>0&&(gd++,gd>=5&&(gd=0,Qr(Ke,Qn)!=="0"&&Wl()))}function Ag(e){let n=_t(Ke,Hr);if(n<=0){ka=0;return}ka+=e;let o=1/n;if(ka>=o){let r=Math.floor(ka/o);if(r>0){let i=r;if(pt(2))if(pt(8)){let s=Ot();i*=Math.pow(10,s)}else i*=10;vd(i),ka-=r*o}}}function MI(){yo(xI),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==gc&&(ss.clear(),gc=t)})}var ka,gd,ss,gc,hc,yc=De(()=>{Gr();yn();xa();Xr();Xi();bt();no();ka=0,gd=0,ss=new Map,gc=null;hc=null});function Dg(e){if(!e||!e.costType)return!1;let t=RI[e.costType];return!t||_t(Ke,t)<=0?!1:Qr(e.area,e.id)!=="0"}function Sd(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function bc(e,t){return t==="standard"&&Sd(e)===NI}function Pg(e){let t=Bt(e),n={};for(let o of t){let r=En(e,o.id),i=_t(e,o.id),s=qo(e,o.id),l=s.iconOverride??_c(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,d=!!s.locked,f=o.upgType==="HM"?!!Ra(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:d,lockState:s,useLockedBase:!!s.useLockedBase||d,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:f}}return n}function $g(e){return Bg[e]||Bg.standard}function wn(e=140){if(!je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Ic(e){return String(e??"").replace(/<[^>]*>/g,"")}function vc(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function Kt(){ft(PI,{volume:je?qg:Gg})}function Hg(){let e=je?qg*2:Gg*2;ft(BI,{volume:e})}function FI(e){return`<img alt="" src="${Og[e]||Og.coins}" class="currency-ico">`}function DI(){if(document.getElementById(Fg))return;let e=document.createElement("style");e.id=Fg,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function Zi(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,d=150,f=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){DI();let ne=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=ne,s.style.scrollTimelineName=ne,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=ne,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let y=null,h=()=>{let ne=((i?s.scrollTop:s.scrollLeft)||0)>0;y!==ne&&(y=ne,t?.classList.toggle("has-scroll-shadow",ne))},b=()=>{if(!s.isConnected||!t.isConnected)return;let K=s.getBoundingClientRect(),ne=t.getBoundingClientRect();if(i){let pe=Math.max(0,K.top-ne.top),be=Math.max(0,ne.bottom-K.bottom);l.style.top=pe+"px",l.style.bottom=be+"px",l.style.left="",l.style.right=""}else{let pe=Math.max(0,K.left-ne.left),be=Math.max(0,ne.right-K.right);l.style.left=pe+"px",l.style.right=be+"px",l.style.top="",l.style.bottom="",l.style.height=""}},x={},E=()=>{let K=i?s.scrollHeight:s.scrollWidth,ne=i?s.clientHeight:s.clientWidth,pe=i?s.scrollTop:s.scrollLeft,be=i?l.clientHeight||ne:l.clientWidth||ne;if(x.scrollSize===K&&x.clientSize===ne&&x.barSize===be&&(m||x.scrollPos===pe))return;x={scrollSize:K,clientSize:ne,scrollPos:pe,barSize:be};let V=ne/Math.max(1,K),oe=Math.max(28,Math.round(be*V)),$=Math.max(1,K-ne),q=Math.max(0,be-oe);if(i?(a.style.height=oe+"px",a.style.width="100%"):(a.style.width=oe+"px",a.style.height="100%"),m)i?(a.style.setProperty("--thumb-y",`${q}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${q}px`),a.style.setProperty("--thumb-y","0px"));else{let le=Math.round(pe/$*q);i?a.style.transform=`translateY(${le}px)`:a.style.transform=`translateX(${le}px)`}let Z=K>ne+1;l.style.display=Z?"":"none",t?.classList.toggle("has-active-scrollbar",Z)},C=()=>{b(),E(),h()};typeof MutationObserver<"u"&&new MutationObserver(()=>C()).observe(s,{childList:!0,subtree:!0,characterData:!0});let A=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},z=K=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},K))},k=()=>{E(),h(),u&&A(),p||z(d)},U=()=>z(d);s.addEventListener("scroll",k,{passive:!0}),p&&s.addEventListener("scrollend",U,{passive:!0}),new ResizeObserver(C).observe(s),window.addEventListener("resize",C),requestAnimationFrame(C);let F=!1,R=0,_=0,H=K=>{F=!0,R=i?K.clientY:K.clientX,_=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),A();try{a.setPointerCapture(K.pointerId)}catch{}K.preventDefault()},j=K=>{if(!F)return;let ne=i?l.clientHeight:l.clientWidth,pe=i?a.clientHeight:a.clientWidth,be=Math.max(1,ne-pe),V=i?s.scrollHeight:s.scrollWidth,oe=i?s.clientHeight:s.clientWidth,$=Math.max(1,V-oe),Z=(i?K.clientY:K.clientX)-R,le=_+Z/be*$;i?s.scrollTop=le:s.scrollLeft=le},ye=K=>{if(F){F=!1,a.classList.remove("dragging"),z(f);try{a.releasePointerCapture(K.pointerId)}catch{}}};a.addEventListener("pointerdown",H),window.addEventListener("pointermove",j,{passive:!0}),window.addEventListener("pointerup",ye),window.addEventListener("pointercancel",ye),l.addEventListener("pointerdown",K=>{if(K.target===a)return;let ne=l.getBoundingClientRect(),pe=i?K.clientY-ne.top:K.clientX-ne.left,be=i?a.clientHeight:a.clientWidth,V=i?l.clientHeight:l.clientWidth,oe=Math.max(0,V-be),$=Math.max(0,Math.min(pe-be/2,oe)),q=i?s.scrollHeight:s.scrollWidth,Z=i?s.clientHeight:s.clientWidth,le=Math.max(1,q-Z),fe=$/Math.max(1,oe)*le;i?s.scrollTop=fe:s.scrollLeft=fe,A(),z(d)}),C()}function Ug(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let d=BigInt(a)-BigInt(u);return d>0n?c.fromAny(d.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function $I(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let f=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(f)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=P[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let f=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return f&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):Ug(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let f=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),g=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(g));if(f.cmp(p)===0&&f.cmp(m)===0){let h=Ug(e,o,r),b=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(h.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,x=0,E=Math.max(0,b);for(;x<E;){let C=Math.floor((x+E+1)/2),A=c.fromInt(C);(typeof f.mulBigNumInteger=="function"?f.mulBigNumInteger(A):c.fromAny(f??0).mulBigNumInteger(A)).cmp(a)<=0?x=C:E=C-1}return c.fromInt(x)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:d}=ei(e,o,a,u,{fastOnly:!0});return d??c.fromInt(0)}function zl(e="standard"){(Ec[e]||Ec.standard).open()}function Xg(e=!1){Object.values(Ec).forEach(t=>t.close(e))}function Sr(e=!1){Object.values(Ec).forEach(t=>t.update(e))}function qI(){if(Zt)return;Zt=document.createElement("div"),Zt.className="upg-overlay",it=document.createElement("div"),it.className="upg-sheet",it.setAttribute("role","dialog"),it.setAttribute("aria-modal","false"),it.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",it.append(e,t,n,o,r),Zt.appendChild(it),document.body.appendChild(Zt),Zt.addEventListener("pointerdown",u=>{je&&u.pointerType!=="mouse"&&u.target===Zt&&(u.preventDefault(),u.stopPropagation())},!0),Zt.addEventListener("click",u=>{je&&u.target===Zt&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!xc)return;let d=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:d,lastY:d,moved:0},it.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let d=u.clientY;if(typeof d!="number")return;let f=Math.max(0,d-i.startY);i.lastY=d,i.moved=f,it.style.transform=`translateY(${f}px)`}function a(u){if(!i)return;let d=i.moved>140;if(it.style.transition="transform 160ms ease",it.style.transform=d?"translateY(100%)":"translateY(0)",d){if(je&&(!u||u.pointerType!=="mouse"))try{wn(120)}catch{}setTimeout(Vg,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function Vg(){if(je)try{wn(160)}catch{}if(typeof Sc=="function"){let e=Sc;Sc=null;try{e()}catch{}}xc=!1,!(!Zt||!it)&&(it.style.transition="",it.style.transform="",Zt.classList.remove("is-open"),Zt.style.pointerEvents="none")}function GI(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let d=document.createElement("li"),f=document.createElement("span");f.className="hm-milestone-text",u&&typeof u=="object"?(f.textContent=u.text??"",u.achieved&&d.classList.add("hm-milestone-achieved")):f.textContent=u,d.appendChild(f),i.appendChild(d)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function HI(e,t="standard"){qI(),xc=!0;let n=!0,o=$g(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){xc=!1;return}let l=e.upgType==="HM",a=e.tie===we.ENDLESS_XP;function u(m,y,h="div"){let b=y.split(" ").filter(C=>C.length>0),x=null,E=[];for(let C=0;C<m.children.length;C++){let A=m.children[C];h&&A.tagName.toLowerCase()!==h.toLowerCase()||b.every(z=>A.classList.contains(z))&&(x?E.push(A):x=A)}return E.forEach(C=>C.remove()),x||(x=document.createElement(h),x.className=y,m.appendChild(x)),x}let d=m=>{let y=document.createElement("div");return y.className="upg-line",y.innerHTML=m,y},f=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let y=m.lockState||o.getLockState(e.id),h=!!y?.locked,b=h&&(y?.hidden||y?.hideEffect||y?.hideCost),x=!!m.unlockUpgrade&&!b;it.classList.toggle("is-locked-hidden",b);let E=it.querySelector(".upg-header"),C=u(E,"upg-title");C.textContent!==(m.displayTitle||m.upg.title)&&(C.textContent=m.displayTitle||m.upg.title);let A=!!m.hmReadyToEvolve,z=A?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,k=u(E,"upg-level"),U=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??Q(m.lvlCapBn),M=m.lvlCapFmtText??m.upg.lvlCapFmtText??Ic(U),F=A?`Level ${m.lvlFmtHtml} / ${U} (EVOLVE READY)`:z?`Level ${m.lvlFmtHtml} / ${U} (MAXED)`:`Level ${m.lvlFmtHtml} / ${U}`,R=Ic(F);k.innerHTML!==F&&(k.innerHTML=F),k.getAttribute("aria-label")!==R&&k.setAttribute("aria-label",R),k.hidden=b,b||k.removeAttribute("aria-hidden"),it.classList.toggle("is-maxed",z),it.classList.toggle("hm-evolve-ready",A),it.classList.toggle("is-unlock-upgrade",x),it.classList.toggle("is-hm-upgrade",l&&!b),it.classList.toggle("is-endless-xp",a),it.classList.toggle("is-magnet-upgrade",e.tie===we.MAGNET),it.classList.toggle("is-no-effect",!m.effect);let _=E.querySelector(".auto-toggle-wrapper"),H=t==="automation"?$i[e.id]:null,j=t==="automation"&&e.id===Qn,ye=!!H,K=t==="standard"?OI[e.costType]:null,ne=0;K?ne=_t(Ke,K):(ye||j)&&(ne=_t(Ke,e.id));let be=ne>0&&(ye||K||j)&&!b;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",E.appendChild(_));let V=_.querySelector("button");if(V||(V=document.createElement("button"),V.type="button",V.style.padding="10px 14px",V.style.fontSize="16px",V.style.width="auto",V.style.minWidth="180px",V.addEventListener("click",ie=>{typeof V._onClick=="function"&&V._onClick(ie)}),_.appendChild(V)),be){V.style.visibility="",V.style.pointerEvents="auto";let ie=v(),Se=ie!=null?`:${ie}`:"",Ne=!0;if(ye){let _e=`ccc:autobuy:master:${H}${Se}`,Re=Bt(xe.STARTER_COVE),se=!1;for(let ee of Re)if(ee.costType===H){let Ie=`ccc:autobuy:${ee.area}:${ee.id}${Se}`;if(Qr(ee.area,ee.id)!=="0"){se=!0;break}}Ne=se}else Ne=Qr(e.area,e.id)!=="0";Ne?(V.className="shop-delve",V.textContent="Automation: ON",V.style.backgroundColor=""):(V.className="shop-close",V.textContent="Automation: OFF",V.style.backgroundColor=""),V._onClick=_e=>{_e.preventDefault(),_e.stopPropagation(),je&&wn(50);let se=!Ne?"1":"0";ye?(localStorage.setItem(`ccc:autobuy:master:${H}${Se}`,se),Bt(xe.STARTER_COVE).forEach(Ie=>{Ie.costType===H&&br(Ie.area,Ie.id,se)})):br(e.area,e.id,se),p()}}else V.style.visibility="hidden",V.style.pointerEvents="none",V.className="shop-delve",V.textContent="Automation: ON",V._onClick=null;let oe=it.querySelector(".upg-content");f&&(oe.scrollTop=0,f=!1);let $=u(oe,"upg-desc centered");$.classList.toggle("lock-desc",b);let q=(m.displayDesc||m.upg.desc||"").trim();A?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):q?($.classList.remove("hm-evolve-note"),$.textContent!==q&&($.textContent=q),$.hidden=!1):$.hidden=!0;let Z=u(oe,"upg-info"),le=null,fe=ie=>{le?le.nextElementSibling!==ie&&Z.insertBefore(ie,le.nextSibling):Z.firstElementChild!==ie&&Z.prepend(ie),le=ie};if(h&&y?.reason&&!b){let ie=(m.displayDesc||"").trim(),Se=String(y.reason??"").trim();if(ie!==Se){let Ne=Z.querySelector(".lock-wrapper");if(!Ne){Ne=document.createElement("div"),Ne.className="lock-wrapper";let se=document.createElement("div");se.className="upg-line lock-note",Ne.append(se)}let _e=Array.from(Ne.children);for(let se of _e)se.tagName==="DIV"&&!se.className&&se.style.height==="12px"&&se.remove();let Re=Ne.querySelector(".lock-note");Re.textContent!==y.reason&&(Re.textContent=y.reason),fe(Ne)}else{let Ne=Z.querySelector(".lock-wrapper");Ne&&Ne.remove()}}else{let ie=Z.querySelector(".lock-wrapper");ie&&ie.remove()}if(m.effect&&!(h&&y?.hideEffect)){let ie=Z.querySelector(".effect-wrapper");if(!ie){ie=document.createElement("div"),ie.className="effect-wrapper";let Re=document.createElement("div");Re.className="upg-line",ie.append(Re)}let Se=Array.from(ie.children);for(let Re of Se)Re.tagName==="DIV"&&!Re.className&&Re.style.height==="12px"&&Re.remove();let Ne=ie.querySelector(".upg-line"),_e=`<span class="bonus-line">${m.effect}</span>`;Ne.innerHTML!==_e&&(Ne.innerHTML=_e),fe(ie)}else{let ie=Z.querySelector(".effect-wrapper");ie&&ie.remove()}let L=FI(m.upg.costType),Y=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ce=z||A;if(!m.unlockUpgrade&&!ce&&(!h||!y?.hideCost)){let ie=u(Z,"upg-costs");fe(ie);let Se=vc(m.upg.costType,Y),Ne=`Cost: ${L} ${P[m.upg.costType].fmt(Y)} ${Se}`,_e=u(ie,"cost-line","div");if(_e.className.includes("upg-line")||(_e.className="upg-line cost-line"),_e.innerHTML!==Ne&&(_e.innerHTML=Ne),l){let Ie=u(ie,"milestone-line","div");Ie.className.includes("upg-line")||(Ie.className="upg-line milestone-line");let I="\u2014",X="",W=Dg(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(W){let ae=m.hmNextMilestone.sub(c.fromInt(1)),qe=0;try{let ve=ae.toPlainIntegerString?.();ve&&ve!=="Infinity"?qe=Number(ve):qe=Number(ae.toString())}catch{qe=0}let tt=c.fromInt(0);try{tt=c.fromAny(m.upg.costAtLevel(qe))}catch{}I=P[m.upg.costType].fmt(tt),X=vc(m.upg.costType,tt)}else{let ae=m.hmNextMilestone.sub(m.lvlBn),qe=ae.toPlainIntegerString?.(),tt=Math.max(0,Math.floor(Number(qe&&qe!=="Infinity"?qe:Number(ae.toString()||0)))),{spent:ve}=ei(m.upg,m.lvlBn,c.fromAny("Infinity"),tt);I=P[m.upg.costType].fmt(ve),X=vc(m.upg.costType,ve)}}catch{}let me=`${W?"Cost at next milestone:":"Cost to next milestone:"} ${L} ${I} ${X}`;Ie.innerHTML!==me&&(Ie.innerHTML=me)}else{let Ie=ie.querySelector(".milestone-line");Ie&&Ie.remove()}let Re=vc(m.upg.costType,m.have),se=`You have: ${L} ${P[m.upg.costType].fmt(m.have)} ${Re}`,ee=u(ie,"have-line","div");ee.className.includes("upg-line")||(ee.className="upg-line have-line"),ee.innerHTML!==se&&(ee.innerHTML=se)}else{let ie=Z.querySelector(".upg-costs");ie&&ie.remove()}let he=it.querySelector(".upg-milestones"),J=he.querySelector(".hm-view-milestones-row");if(!J){J=document.createElement("div"),J.className="hm-view-milestones-row";let ie=document.createElement("button");ie.type="button",ie.className="shop-delve hm-view-milestones",ie.textContent="View Milestones",ie.addEventListener("click",Se=>{ie._onClick&&ie._onClick(Se)}),J.appendChild(ie),he.appendChild(J)}let re=J.querySelector("button");l&&!b?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ie=Array.isArray(m.hmMilestones)?m.hmMilestones:[],Se=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Ne=(()=>{try{return BigInt(Dt)*BigInt(Se)}catch{return 0n}})(),_e=ie.sort((Re,se)=>Number(Re?.level||0)-Number(se?.level||0)).map(Re=>{let se=Math.max(0,Math.floor(Number(Re?.level||0))),ee=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(se)+Ne).toString())}catch{return c.fromAny(se+Dt*Se)}})(),Ie=ee?.isInfinite?.()?"Infinity":Q(ee),I=gt(Re?.multiplier??Re?.mult??Re?.value??1),X=`${Re?.target??Re?.type??"self"}`.toLowerCase(),W=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(ee)>=0}catch{}return!1})(),te=`Level ${Ie}: Multiplies this upgrade\u2019s effect by ${I}x`;return X==="xp"&&(te=`Level ${Ie}: Multiplies XP value by ${I}x`),(X==="coin"||X==="coins")&&(te=`Level ${Ie}: Multiplies Coin value by ${I}x`),X==="mp"&&(te=`Level ${Ie}: Multiplies MP value by ${I}x`),{text:te,achieved:W}});GI(_e)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ge=it.querySelector(".upg-actions"),Le=ge.querySelector(".shop-close");if(Le||(Le=document.createElement("button"),Le.type="button",Le.className="shop-close",Le.textContent="Close",Le.addEventListener("click",()=>{n=!1,Vg()}),ge.appendChild(Le)),h||z)ge.querySelectorAll("button:not(.shop-close)").forEach(ie=>ie.remove()),document.activeElement&&document.activeElement!==Le&&!ge.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Le.focus();else{let ie=m.have.cmp(Y)>=0,Se=(se,ee,Ie,I,X=!1)=>{let W=ge.querySelector(`.${se.split(" ").join(".")}`);if(!W){W=document.createElement("button"),W.type="button",W.className=se,W.textContent=ee;let te=()=>{typeof W._onClick=="function"&&W._onClick()};"PointerEvent"in window?W.addEventListener("pointerdown",ae=>{ae.pointerType==="mouse"||typeof ae.button=="number"&&ae.button!==0||(te(),ae.preventDefault())},{passive:!1}):W.addEventListener("touchstart",ae=>{te(),ae.preventDefault()},{passive:!1}),W.addEventListener("click",()=>{je||te()});let me=ge.children;I>=me.length?ge.appendChild(W):ge.insertBefore(W,me[I])}return W._onClick=Ie,W.textContent!==ee&&(W.textContent=ee),W.disabled!==X&&(W.disabled=X),W};if(A){ge.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(se=>se.remove()),Se("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:se}=o.evolve(e.id);se&&(Hg(),Sr(),p())},1,!1);return}if(m.unlockUpgrade){ge.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(se=>se.remove()),Se("shop-delve btn-unlock","Unlock",()=>{let{bought:se}=o.buyOne(e.id);if(!(se instanceof c?se:c.fromAny(se??0)).isZero?.()){if(Kt(),bc(e,t))try{Ta(["reset"])}catch{}Sr(),p()}},1,!ie);return}if(ge.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(se=>se.remove()),Se("shop-delve btn-buy-one","Buy",()=>{let se=o.getUiModel(e.id);if(se.have.cmp(se.nextPrice instanceof c?se.nextPrice:c.fromAny(se.nextPrice||0))<0)return;let{bought:ee}=o.buyOne(e.id);(ee instanceof c?ee:c.fromAny(ee??0)).isZero?.()||(Kt(),Sr(),p())},1,!ie),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let se=ge.querySelector(".btn-buy-max");se&&se.remove();let ee=ge.querySelector(".btn-buy-cheap");ee&&ee.remove()}else{Se("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:I}=o.buyMax(e.id);(I instanceof c?I:c.fromAny(I??0)).isZero?.()||(Kt(),Sr(),p())},2,!ie);let ee=[1,3,4,5,6].includes(Sd(m.upg));if(!l&&!ee)Se("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let X=o.buyCheap;if(!X)return;let{bought:W}=X(e.id);(W instanceof c?W:c.fromAny(W??0)).isZero?.()||(Kt(),Sr(),p())},3,!ie);else{let Ie=ge.querySelector(".btn-buy-cheap");Ie&&Ie.remove()}}if(l)Se("shop-delve btn-buy-next","Buy Next",()=>{let ee=o.getUiModel(e.id);if(ee.hmReadyToEvolve)return;let Ie=ee.hmNextMilestone;if(!Ie||!ee.lvlBn||Ie.cmp(ee.lvlBn)<=0){let{bought:ve}=o.buyMax(e.id);if((ve instanceof c?ve:c.fromAny(ve??0)).isZero?.())return;Kt(),Sr(),p();return}let I=0;try{let ve=Ie.sub(ee.lvlBn).toPlainIntegerString?.();I=Math.max(0,Math.floor(Number(ve&&ve!=="Infinity"?ve:Ie.sub(ee.lvlBn).toString())))}catch{}let X=P[ee.upg.costType]?.value,W=X instanceof c?X:c.fromAny(X??0),me=ei(ee.upg,ee.lvlBn,W,I).count,ae=!1;try{let ve=me?.toPlainIntegerString?.();ae=ve&&ve!=="Infinity"?Number(ve)>=I:Number(me??0)>=I}catch{}let qe=ae?o.buyNext(e.id,I):o.buyMax(e.id);(qe.bought instanceof c?qe.bought:c.fromAny(qe.bought??0)).isZero?.()||(Kt(),Sr(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let se=ge.querySelector(".btn-buy-next");se&&se.remove()}}},g=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,g)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",g),p(),Zt.classList.add("is-open"),Zt.classList.toggle("is-automation-upgrade",t==="automation"),Zt.style.pointerEvents="auto",wn(140),it.style.transition="none",it.style.transform="translateY(100%)",it.offsetHeight,requestAnimationFrame(()=>{it.style.transition="",it.style.transform=""}),Sc=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,g)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",g)}}function Wf(e,t,n,o){let r=null;function i(d){if(!n())return;let f=typeof d.clientY=="number"?d.clientY:d.touches?.[0]?.clientY||0;r={startY:f,lastY:f,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(d){if(!r||r.canceled)return;let f=d.clientY;if(typeof f!="number")return;let p=Math.max(0,f-r.startY);r.lastY=f,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let d=Math.max(1,performance.now()-r.startT),f=r.moved;f/d>.55&&f>40||f>140?(go(100),wn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",d=>d.preventDefault(),{passive:!1})}var Rg,TI,kI,AI,Og,NI,RI,OI,Bg,PI,BI,qg,Gg,UI,Fg,wc,Ec,Zt,it,xc,Sc,zr=De(()=>{bt();xt();Yt();bo();mc();kl();An();yn();Fi();Xr();yc();Rg={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp"},TI="img/misc/locked_base.webp",kI="img/misc/maxed.webp",AI="img/misc/green_border.webp",Og={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp"},NI=7,RI={coins:la,books:ca,gold:ua,magic:fa};OI={coins:la,books:ca,gold:ua,magic:fa};Bg={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Pg(Dn()),getUiModel:e=>Ra(Dn(),e),buyOne:e=>Aa(Dn(),e),buyMax:e=>Lc(Dn(),e),buyCheap:e=>wd(Dn(),e),buyNext:(e,t)=>Na(Dn(),e,t),getLockState:e=>qo(Dn(),e),evolve:e=>Id(Dn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",fd,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Pg(Ke),getUiModel:e=>Ra(Ke,e),buyOne:e=>Aa(Ke,e),buyMax:e=>Lc(Ke,e),buyNext:(e,t)=>Na(Ke,e,t),getLockState:e=>qo(Ke,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof v=="function"?v():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||Sr(!0)});PI="sounds/purchase_upg.ogg",BI="sounds/evolve_upg.ogg",qg=.12,Gg=.3;UI="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",Fg="ccc-scroll-timeline-styles";wc=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return $g(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!bg(),o=v();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let Y=document.createElement("div");Y.className="shop-tile";let ce=document.createElement("img");ce.className="base",ce.alt="";let he=document.createElement("img");he.className="icon",he.alt="",he.addEventListener("error",()=>{he.src=UI}),Y.appendChild(ce),Y.appendChild(he),i.appendChild(Y),t.appendChild(i),i.addEventListener("click",J=>{let re=J.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){J.preventDefault(),J.stopImmediatePropagation();return}if(Jn(re)){J.preventDefault(),J.stopImmediatePropagation();return}if(J.shiftKey||J.ctrlKey){if(J.preventDefault(),J.stopImmediatePropagation(),!re.upgMeta)return;let ge=re.upgMeta.id,Le=re.upgMeta.upgType==="HM",ie=[1,3,4,5,6].includes(Sd(re.upgMeta));if(J.shiftKey){if(!ie&&this.adapter.buyCheap){let{bought:_e}=this.adapter.buyCheap(ge);(_e instanceof c?_e:c.fromAny(_e??0)).isZero?.()||(Kt(),this.update());return}let{bought:Se}=this.adapter.buyMax(ge);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Kt(),bc(re.upgMeta,this.mode))try{Ta(["reset"])}catch{}this.update()}return}if(J.ctrlKey){if(Le){let _e=this.adapter.getUiModel(ge);if(_e&&!_e.hmReadyToEvolve){let Re=_e.hmNextMilestone;if(Re&&_e.lvlBn&&Re.cmp(_e.lvlBn)>0){let se=0;try{let te=Re.sub(_e.lvlBn).toPlainIntegerString?.();se=Math.max(0,Math.floor(Number(te&&te!=="Infinity"?te:Re.sub(_e.lvlBn).toString())))}catch{}let ee=P[_e.upg.costType]?.value,Ie=ee instanceof c?ee:c.fromAny(ee??0),X=ei(_e.upg,_e.lvlBn,Ie,se).count,W=!1;try{let te=X?.toPlainIntegerString?.();W=te&&te!=="Infinity"?Number(te)>=se:Number(X??0)>=se}catch{}if(W){let te=this.adapter.buyNext(ge,se);(te.bought instanceof c?te.bought:c.fromAny(te.bought??0)).isZero?.()||(Kt(),this.update());return}}}}let{bought:Se}=this.adapter.buyMax(ge);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Kt(),bc(re.upgMeta,this.mode))try{Ta(["reset"])}catch{}this.update()}return}}re.upgMeta&&HI(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",J=>{if(je)return;let re=J.currentTarget;if(re.dataset.locked==="1"||(J.preventDefault(),J.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:Se}=this.adapter.evolve(re.upgMeta.id);Se&&(Hg(),this.update());return}let{bought:Le}=this.adapter.buyMax(re.upgMeta.id);if(!(Le instanceof c?Le:c.fromAny(Le??0)).isZero?.()){if(Kt(),bc(re.upgMeta,this.mode))try{Ta(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),d=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",d),i.disabled=d,d?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=d?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let g=s?c.fromInt(0):$I(r.meta,r.levelNumeric,r.level),m=g instanceof c?g:c.fromAny(g),y=Q(r.level),h=Ic(y),b=Q(m),x=Ic(b),E=!m.isZero?.(),C=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,A=Number.isFinite(C)?Math.max(0,Math.floor(C)):1/0,z=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,k=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(A)&&Number.isFinite(z)?z>=A:!1,U=Number.isFinite(A)&&A===1,M=!!r.meta?.unlockUpgrade,F=!s&&M&&!k,R=!s&&M&&!F&&k,_,H,j=!1,ye=!1;if(s){_="",H="";let Y=u?(r.lockState?.reason||"").trim():"",ce=Y?`${r.title} (Locked, ${Y})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ce)}else{if(F||R)_=F?"Unlockable":"Unlocked",H=_,ye=!0;else if(!s&&U&&!M)k?(_="Owned",H="Owned"):E?(_="Purchasable",H="Purchasable"):(_="Not Owned",H="Not Owned"),ye=!0;else{let Y=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ce=String(h||"").replace(/,/g,""),he=/|Infinity/i.test(ce),J=Number.isFinite(Y)?Y>=1e3:he||/^\d{4,}$/.test(ce);j=E&&J,j?(_=`<span class="badge-lvl">${y}</span><span class="badge-plus">(+${b})</span>`,H=`${h} (+${x})`):(_=E?`${y} (+${b})`:y,H=E?`${h} (+${x})`:h)}i.setAttribute("aria-label",`${r.title}, ${H}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let K=i.firstElementChild,ne=K.querySelector(".base"),pe=K.querySelector(".icon"),be=r.meta?.costType||"coins",oe=r.useLockedBase||s?TI:r.baseIconOverride||Rg[be]||Rg.coins;ne.src!==oe&&(ne.src=oe);let $=r.icon;if(!$)pe.hidden||(pe.hidden=!0);else{pe.hidden&&(pe.hidden=!1);let Y=$;pe._lastSrc!==Y&&(pe.src=Y,pe._lastSrc=Y)}let q=K.querySelector(".maxed-overlay"),Z=!s&&Dg(r.meta),le=!s&&k;if(le||!s&&!k&&!p&&Z){q||(q=document.createElement("img"),q.className="maxed-overlay",q.alt="",K.insertBefore(q,pe));let Y=le?kI:AI;q.src!==Y&&(q.src=Y)}else q&&q.remove();let L=K.querySelector(".level-badge");s?L&&L.remove():(L||(L=document.createElement("span"),L.className="level-badge",K.appendChild(L)),L.className="level-badge",ye&&L.classList.add("text-badge"),j&&L.classList.add("two-line"),(E||F)&&L.classList.add("can-buy"),k&&L.classList.add("is-maxed"),_===H?L.textContent!==_&&(L.textContent=_):L.innerHTML!==_&&(L.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),Zi(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&Jn(a)||(vr(),Lg())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{je&&wn(80),this.close()},{passive:!0}),Wf(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=v();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&kg(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,je)try{setTimeout(()=>go(240),120)}catch{}wn(10),Zi(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},Ec={standard:new wc("standard"),automation:new wc("automation")};Zt=null,it=null,xc=!1,Sc=null});var zg={};vt(zg,{applyHudLayout:()=>Go,initHudButtons:()=>VI,isMapUnlocked:()=>_d,isShopUnlocked:()=>Ld,lockMap:()=>kc,lockShop:()=>Tc,unlockMap:()=>Mc,unlockShop:()=>ti});function xd(e){let t=v();return t==null?e:`${e}:${t}`}function as(e){let t=xd(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function Ld(){return Cd(),as(ro.SHOP)}function _d(){return Cd(),as(ro.MAP)}function Cc(e,t){let n=t?"1":"0",o=xd(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:v()}}))}catch{}}function Cd(){for(let e of Object.values(ro)){let t=xd(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function wo(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function Ed(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",_i())}function XI(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function Go(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=XI(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(g=>e.querySelector(`.game-btn[data-btn="${g}"]`)).filter(Boolean),a=[...e.children].filter(g=>!l.includes(g)),u=[...l,...a];if(u.length&&u.some((g,m)=>e.children[m]!==g)){let g=document.createDocumentFragment();u.forEach(m=>g.appendChild(m)),e.appendChild(g)}let p=[...e.querySelectorAll(".game-btn")].filter(g=>!g.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(g=>{g.style.gridColumn="",g.style.gridRow="",g.classList.remove("span-2"),g.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let g=getComputedStyle(e),m=parseFloat(g.columnGap||g.gap||"0")||0,y=e.clientWidth,h=Math.max(180,Math.floor((y-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${h}px ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let g=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),y=e.querySelector('[data-btn="shop"]:not([hidden])');g&&m&&y&&(g.style.gridColumn="1",g.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",y.style.gridColumn="1 / -1",y.style.gridRow="2")}}function VI(){if(Cd(),wo("help",!0),wo("stats",!0),wo("shop",as(ro.SHOP)),wo("map",as(ro.MAP)),Ed(),Go(),Yg||(Yg=!0,window.addEventListener("resize",Go),window.addEventListener("orientationchange",Go),window.addEventListener("saveSlot:change",()=>{wo("shop",as(ro.SHOP)),wo("map",as(ro.MAP)),Ed(),Go()}),window.addEventListener("saveSlot:modified",e=>{let t=v(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||Ed()})),!Wg){Wg=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&zl()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&Jn(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function ti(){Cc(ro.SHOP,!0),wo("shop",!0),Go()}function Mc(){Cc(ro.MAP,!0),wo("map",!0),Go()}function Tc(){Cc(ro.SHOP,!1),wo("shop",!1),Go()}function kc(){Cc(ro.MAP,!1),wo("map",!1),Go()}var ro,Yg,Wg,Ac=De(()=>{zr();bt();Fi();ro={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Yg=!1,Wg=!1});function Kg(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(Y=>Y.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,d=4,f=new Float32Array(t*d);for(let L=0;L<t;L++)f[L*d+2]=1/0;let p=new Int16Array(t),g=t;for(let L=0;L<t;L++)p[L]=t-1-L;let m=-1,y=document.createElement("canvas");y.className="cursor-trail-canvas",Object.assign(y.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(y);let h=y.getContext("2d",{alpha:!0,desynchronized:!0}),b=document.createElement("canvas");b.width=a,b.height=a;let x=b.getContext("2d");x.shadowColor="#FFEB3B",x.shadowBlur=l,x.fillStyle="#FFEB3B",x.beginPath(),x.arc(u,u,s,0,Math.PI*2),x.fill();let E=!1,C=null,A=null,z={left:0,top:0,width:0,height:0},k=1,U=!1,M=0,F=0,R=!1,_=null,H=[],j=()=>{if(U)return;let L=document.documentElement.clientWidth,Y=document.documentElement.clientHeight;z={left:0,top:0,width:L,height:Y,right:L,bottom:Y,x:0,y:0}},ye=()=>{if(U)return;j();let L=Math.min(window.devicePixelRatio||1,2);k=z.width>0?Math.min(L,512/z.width):L,y.width=z.width*k,y.height=z.height*k,h.scale(k,k),_=null},K=null;typeof ResizeObserver<"u"&&(K=new ResizeObserver(()=>{ye()}),K.observe(e));let ne=(L,Y)=>{if(g<=0)return;let ce=p[--g];ce>m&&(m=ce);let he=ce*d;f[he]=L,f[he+1]=Y,f[he+2]=0,f[he+3]=n},pe=(L,Y,ce)=>{if(C===null||A===null)ce.count<r&&(ne(L,Y),ce.count++);else{let he=L-C,J=Y-A,re=Math.hypot(he,J);if(re>=o){let ge=Math.floor(re/o);for(let Le=1;Le<=ge&&!(ce.count>=r);Le++){let ie=Le*o/re;ne(C+he*ie,A+J*ie),ce.count++}}ce.count<r&&(ne(L,Y),ce.count++)}C=L,A=Y},be=L=>{if(U)return;M||(F=0,M=requestAnimationFrame(oe)),z.width||j();let Y=0,ce=0,he=(J,re)=>J>=0&&J<=z.width&&re>=0&&re<=z.height;if(L.getCoalescedEvents){let J=L.getCoalescedEvents();if(J.length>0)for(let re of J){let ge=re.clientX-Y,Le=re.clientY-ce;H.push({x:ge,y:Le,inside:he(ge,Le)})}else{let re=L.clientX-Y,ge=L.clientY-ce;H.push({x:re,y:ge,inside:he(re,ge)})}}else{let J=L.clientX-Y,re=L.clientY-ce;H.push({x:J,y:re,inside:he(J,re)})}},V=()=>{E=!1,C=null,A=null,H.length=0},oe=()=>{if(U)return;let L=performance.now();F||(F=L);let Y=L-F;F=L,Y>100&&(Y=100);let ce={count:0};if(H.length>0){for(let Ne of H)Ne.inside?(E=!0,pe(Ne.x,Ne.y,ce)):(E=!1,C=null,A=null);let Se=H[H.length-1];Se.inside&&(C!==Se.x||A!==Se.y)&&(ne(Se.x,Se.y),C=Se.x,A=Se.y),H.length=0}else E&&C!==null&&A!==null&&ne(C,A);let he=t-g;if(he===0&&!R){M=0;return}_?h.clearRect(_.x,_.y,_.w,_.h):h.clearRect(0,0,z.width,z.height),R=!1;let J=1/0,re=1/0,ge=-1/0,Le=-1/0,ie=-1;if(he>0)for(let Se=0;Se<=m;Se++){let Ne=Se*d,_e=f[Ne+2];if(_e>=f[Ne+3])continue;if(_e+=Y,f[Ne+2]=_e,_e>=f[Ne+3]){p[g++]=Se;continue}ie=Se;let Re=f[Ne+3],se=_e/Re,ee=1-se,Ie=1-.4*se;R=!0,h.globalAlpha=ee;let I=a*Ie,X=I/2,W=f[Ne],te=f[Ne+1],me=Math.round(W-X),ae=Math.round(te-X),qe=Math.round(I);h.drawImage(b,me,ae,qe,qe),me<J&&(J=me),ae<re&&(re=ae);let tt=me+qe,ve=ae+qe;tt>ge&&(ge=tt),ve>Le&&(Le=ve)}m=ie,J!==1/0?(J-=2,re-=2,ge+=2,Le+=2,_={x:J,y:re,w:ge-J,h:Le-re}):_=null,M=requestAnimationFrame(oe)};window.addEventListener("resize",ye),window.addEventListener("scroll",j,{passive:!0}),window.addEventListener("focus",j,{passive:!0}),document.addEventListener("visibilitychange",j,{passive:!0});let $={passive:!0},q=L=>{j(),be(L)},Z=L=>{j(),be(L)};e.addEventListener("pointermove",be,$),e.addEventListener("pointerdown",Z,$),e.addEventListener("pointerenter",q,$),e.addEventListener("pointerleave",V,$),e.addEventListener("pointercancel",V,$),ye(),M=requestAnimationFrame(oe);let le=setInterval(j,1e3);return{destroy:()=>{U=!0,M&&cancelAnimationFrame(M),le&&clearInterval(le),K&&(K.disconnect(),K=null);try{window.removeEventListener("resize",ye)}catch{}try{window.removeEventListener("scroll",j)}catch{}try{window.removeEventListener("focus",j)}catch{}try{document.removeEventListener("visibilitychange",j)}catch{}try{e.removeEventListener("pointermove",be),e.removeEventListener("pointerdown",Z),e.removeEventListener("pointerenter",q),e.removeEventListener("pointerleave",V),e.removeEventListener("pointercancel",V)}catch{}y.remove()}}}var jg=De(()=>{});var ay={};vt(ay,{clearPendingGains:()=>Fd,getPassiveCoinReward:()=>rc,initCoinPickup:()=>ew,setCoinMultiplier:()=>KI,triggerPassiveCollect:()=>vd});function Zg(e){if(!e||typeof e!="object"){Pa=!1,Nc=!1,Rc="0",ri.clear();return}Pa=!!e.unlocked,Nc=!!e.level?.isInfinite?.();try{Rc=e.level?.toPlainIntegerString?.()??"0"}catch{Rc="0"}Pa?Nc&&ri.clear():ri.clear()}function YI(){if(typeof ni=="function")try{ni()}catch{}try{Zg(at())}catch{Pa=!1,ri.clear()}try{ni=ii(e=>{Zg(e)})}catch{ni=null}}function KI(e){zI=e;try{P.coins?.mult?.set&&P.coins.mult.set(e)}catch{}}function Ad(){try{let e=Pc();e instanceof c?cs=e.clone?.()??e:e!=null?cs=c.fromAny(e):cs=c.fromInt(1)}catch{cs=c.fromInt(1)}}function jI(){Jg||(Jg=!0,Ad(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",Ad),typeof window<"u"&&window.addEventListener("saveSlot:change",Ad))}function ZI(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Pd.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function Od(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*JI:0}function QI({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,d=0,f=0,p=0,g=null,m=null,y=Od(),h=0,b=0,x=0,E=!1,C=null,A=null,z=()=>{if(E)return;let $=document.documentElement.clientWidth,q=document.documentElement.clientHeight;C={left:0,top:0,width:$,height:q,right:$,bottom:q,x:0,y:0}},k=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",g=null,m=null},U=()=>{if(!l||b<=0){k();return}let $=b*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${f-b}px, ${p-b}px, 0)`,s.classList.add("is-visible")},M=()=>{if(!(!l||b<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=b+Nd,q=[];if(typeof i.findCoinTargetsInPath=="function"&&g!==null&&m!==null?q=i.findCoinTargetsInPath(g,m,f,p,$):q=i.findCoinTargetsInRadius(f,p,$),g=f,m=p,q&&q.length>0)if(typeof r=="function"){let Z=[];for(let le=0;le<q.length;le++){let fe=q[le],L={coin:fe};fe.el&&i.getCoinTransform&&(L.opts={transform:i.getCoinTransform(fe.el)}),Z.push(L)}r(Z)}else for(let Z=0;Z<q.length;Z++){let le=q[Z],fe=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(fe){let L=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform||"";o(fe,{transform:L})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=b+Nd,q=i.findCoinsInRadius(f,p,$);if(g=f,m=p,q&&q.length>0){let Z=[];for(let le=0;le<q.length;le++){let fe=q[le],L=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform;Z.push({el:fe,opts:{transform:L}})}typeof r=="function"&&r(Z)}}else{let $=t.children,q=b+Nd,Z=[];for(let le=$.length-1;le>=0;le--){let fe=$[le];if(fe.dataset.collected==="1"||!fe.matches(n))continue;let L=fe.getBoundingClientRect(),Y=L.left+L.width/2,ce=L.top+L.height/2,he=Y-u,J=ce-d;Math.hypot(he,J)<=q&&Z.push(fe)}if(!Z.length)return;if(typeof r=="function"){let le=[];for(let fe=0;fe<Z.length;fe++){let L=Z[fe],Y=window.getComputedStyle(L);le.push({el:L,opts:{transform:Y.transform}})}r(le)}else{let le=[];for(let fe=0;fe<Z.length;fe++){let L=Z[fe],Y=window.getComputedStyle(L);le.push(Y.transform)}for(let fe=0;fe<Z.length;fe++)o(Z[fe],{transform:le[fe]})}}},F=()=>{x=0,U(),!(!l||b<=0||E)&&(M(),R())},R=()=>{!l||b<=0||x||E||(x=requestAnimationFrame(F))},_=$=>{if(!$||E||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,d=$.clientY,C||z();let q=C;f=u,p=d,l=f>=0&&f<=q.width&&p>=0&&p<=q.height,R()},H=()=>{l=!1,k(),g=null,m=null},j=()=>{g=null,m=null},ye=()=>{h=Bc(),b=h*y,U(),R()},K=()=>{if(!(E||!a)){if(z(),C){let $=C;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}R()}},ne=()=>{if(y=Od(),b=h*y,z(),a&&C){let $=C;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}R()},pe=$=>{z(),_($)},be=$=>{j(),pe($)},V=()=>{E=!0,x&&(cancelAnimationFrame(x),x=0),A&&clearInterval(A);try{window.removeEventListener("scroll",K)}catch{}try{window.removeEventListener("resize",ne)}catch{}try{window.removeEventListener("saveSlot:change",ye)}catch{}try{document.removeEventListener("ccc:upgrades:changed",ye)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",pe)}catch{}try{e.removeEventListener("pointerenter",be)}catch{}try{e.removeEventListener("pointerleave",H)}catch{}try{e.removeEventListener("pointercancel",H)}catch{}try{window.removeEventListener("blur",j)}catch{}try{s.remove()}catch{}},oe={passive:!0};return e.addEventListener("pointermove",_,oe),e.addEventListener("pointerdown",pe,oe),e.addEventListener("pointerenter",be,oe),e.addEventListener("pointerleave",H,oe),e.addEventListener("pointercancel",H,oe),window.addEventListener("resize",ne),window.addEventListener("scroll",K,{passive:!0}),window.addEventListener("focus",z,{passive:!0}),window.addEventListener("blur",j,{passive:!0}),document.addEventListener("visibilitychange",()=>{z(),document.hidden&&j()},{passive:!0}),window.addEventListener("saveSlot:change",ye),document.addEventListener("ccc:upgrades:changed",ye),A=setInterval(z,1e3),ye(),{destroy:V}}function Fd(){Ba=null,Fa=null,Ua=null}function sy(e){let t=Pd.clone?.()??c.fromInt(1),n=ry(t),o=io(Qg),i=iy(e??Rc);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Eo=="function"&&Eo()?io(cs):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function rc(){let{coinGain:e,xpGain:t,mpGain:n}=sy(null);return{coins:e,xp:t,mp:n}}function vd(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=sy(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=Nn(Me.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{xn=xn?.add?xn.add(r):io(r)}catch{xn=io(r)}Oa(),a||ey(r);let u=typeof an=="function"?an():!0,d=typeof i?.isZero=="function"?i.isZero():!1;u&&!d&&ty(i),s.isZero?.()||ny(s)}function ew({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){Md?.destroy&&Md.destroy();let a=document.querySelector(t),u=document.querySelector(n),d=document.querySelector(o);if(!a||!u||!d)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!d}),{destroy(){}};YI(),jI(),a.style.touchAction="none";let f=null,p=null;xn=P.coins.value,Rd=()=>{let L=Q(xn);L.includes("<span")?d.innerHTML=L:d.textContent=L},oy(),Oa();let g=L=>{L?.detail&&L.detail.key==="coins"&&(xn=L.detail.value,Oa())};window.addEventListener("currency:change",g);let m=L=>{if(!(!L?.detail||L.detail.key!=="coins"))try{let{mult:Y}=L.detail;Y instanceof c?$n=Y.clone?.()??Y:Y!=null?$n=c.fromAny(Y):$n=c.fromInt(1),oi=!!$n?.isInfinite?.()}catch{$n=null,oi=!1}};window.addEventListener("currency:multiplier",m);let y=v();if(y==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let h=`ccc:unlock:shop:${y}`,b=`ccc:unlock:shop:progress:${y}`,x=localStorage.getItem("ccc:unlock:shop:progress"),E=localStorage.getItem("ccc:unlock:shop");x!=null&&localStorage.getItem(b)==null&&localStorage.setItem(b,x),E!=null&&localStorage.getItem(h)==null&&localStorage.setItem(h,E),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let L=parseInt(localStorage.getItem(b)||"0",10);if(localStorage.setItem(b,String(L)),L>=10&&localStorage.getItem(h)!=="1"){try{ti()}catch{}localStorage.setItem(h,"1")}}let C=new URL(i,document.baseURI).href,A=L=>L instanceof HTMLElement?L._coinObj?!L._coinObj.isRemoved&&L.dataset.collected!=="1":L.dataset.collected!=="1"&&L.matches(r):!1;function z(L){try{L.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(z);let k=je?.12:.3,U=0;function M(L=C){if(L===C){let Y=performance.now();if(Y-U<40)return;U=Y}ft(L,{volume:k})}function F(L,Y={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(L);let ce=()=>{L&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(L):L.remove())};if(l||je){ce();return}let he="translate3d(0,0,0)";Y.transform?Y.transform!=="none"&&(he=Y.transform):he=L.style.transform||"translate3d(0,0,0)",L.style.setProperty("--ccc-start",he),L.classList.add("coin--collected");let J=!1,re=()=>{J||(J=!0,L.removeEventListener("animationend",re),ce())};L.addEventListener("animationend",re),setTimeout(re,600)}function R(L){if(!L||!L.length)return;let Y=C,ce=-1,he=!1;for(let se of L){let ee=se.coin||se.el&&se.el._coinObj;ee&&(ee.sizeIndex!==void 0?ee.sizeIndex>ce&&(ce=ee.sizeIndex,ee.soundSrc&&(Y=ee.soundSrc,he=!0)):ee.soundSrc&&!he&&(Y=ee.soundSrc,he=!0))}M(Y);let J=null,re=null,ge=null,Le=0,ie=Nn(Me.COINS),Se=typeof an=="function"?an():!0,Ne=typeof Eo=="function"&&Eo(),_e=15,Re=0;for(let se of L){let ee=se.el,Ie=se.coin;if(!Ie&&ee&&ee._coinObj&&(Ie=ee._coinObj),ee&&!A(ee)||Ie&&Ie.isRemoved)continue;Le++,ee&&(ee.dataset.collected="1"),Re<_e?(!ee&&Ie&&e&&e.ensureCoinVisual&&(ee=e.ensureCoinVisual(Ie),ee&&(ee.dataset.collected="1")),ee?(F(ee,se.opts||{}),Re++):Ie&&e&&e.removeCoinTarget&&e.removeCoinTarget(Ie)):Ie&&e&&e.removeCoinTarget?e.removeCoinTarget(Ie):ee&&(e&&e.detachCoin&&e.detachCoin(ee),e&&e.recycleCoin?e.recycleCoin(ee):ee.remove());let I=ee?ZI(ee):Pd,X=Ie?.mutationLevel??(ee?.dataset?.mutationLevel||null),W=ry(I),te=io(Qg),me=io(cs);if(Ie&&Ie.valueMultiplier&&Ie.valueMultiplier>1){try{W=W.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{te=te.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{me=me.mulDecimalFloor(Ie.valueMultiplier)}catch{}}let ae=iy(X);if(ae){try{W=W.mulBigNumInteger(ae)}catch{}try{te=te.mulBigNumInteger(ae)}catch{}}ie||(J=us(J,W)),Se&&(re=us(re,te)),Ne&&(ge=us(ge,me))}if(Le!==0){if(J&&!J.isZero?.()){try{xn=xn?.add?xn.add(J):io(J)}catch{xn=io(J)}ey(J),Oa()}if(re&&!re.isZero?.()&&ty(re),ge&&!ge.isZero?.()&&ny(ge),localStorage.getItem(h)!=="1"){let ee=parseInt(localStorage.getItem(b)||"0",10)+Le;if(localStorage.setItem(b,String(ee)),ee>=10){try{ti()}catch{}localStorage.setItem(h,"1")}}}}function _(L,Y={}){return R([{el:L,opts:Y}]),!0}f=QI({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:R,spawner:e}),p=Kg(a);let H=L=>{if(L.target===u)return;let Y=L.target.closest(r);if(Y&&A(Y)){let ce={};e&&typeof e.getCoinTransform=="function"&&(ce.transform=e.getCoinTransform(Y)),_(Y,ce)}};u.addEventListener("pointerdown",H,{passive:!0}),je||u.addEventListener("mouseover",H,{passive:!0});let j=25,ye=null,K=()=>{let L=document.documentElement.clientWidth,Y=document.documentElement.clientHeight;ye={left:0,top:0,width:L,height:Y,right:L,bottom:Y,x:0,y:0}};window.addEventListener("resize",K),window.addEventListener("scroll",K,{passive:!0}),K();let ne=null,pe=null,be=()=>{ne=null,pe=null};a.addEventListener("pointerleave",be,{passive:!0}),a.addEventListener("pointerenter",be,{passive:!0}),window.addEventListener("blur",be,{passive:!0});function V(L,Y){if(e&&typeof e.findCoinTargetsInRadius=="function"){ye||K();let ce=L,he=Y,J=[];if(typeof e.findCoinTargetsInPath=="function"&&ne!==null&&pe!==null?J=e.findCoinTargetsInPath(ne,pe,ce,he,j,!0):J=e.findCoinTargetsInRadius(ce,he,j,!0),ne=ce,pe=he,J&&J.length>0){let re=[];for(let ge=0;ge<J.length;ge++){let Le=J[ge],ie={coin:Le};Le.el&&e.getCoinTransform&&(ie.opts={transform:e.getCoinTransform(Le.el)}),re.push(ie)}R(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){ye||K();let ce=L,he=Y,J=e.findCoinsInRadius(ce,he,j);if(ne=ce,pe=he,J&&J.length>0){let re=[];for(let ge of J){let Le=e.getCoinTransform?e.getCoinTransform(ge):ge.style.transform;re.push({el:ge,opts:{transform:Le}})}R(re)}}else{let ce=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],he=new Set;for(let J=0;J<ce.length;J++){let re=L+ce[J][0],ge=Y+ce[J][1],Le=document.elementsFromPoint(re,ge);for(let ie=0;ie<Le.length;ie++){let Se=Le[ie];A(Se)&&!he.has(Se)&&he.add(Se)}}if(he.size>0){let J=[];he.forEach(re=>J.push({el:re})),R(J)}}}let oe=null,$=!1;function q(L,Y){oe={x:L,y:Y},$||($=!0,requestAnimationFrame(()=>{oe&&(V(oe.x,oe.y),oe=null),$=!1}))}a.addEventListener("pointerdown",L=>{q(L.clientX,L.clientY)},{passive:!0}),a.addEventListener("pointermove",L=>{L.pointerType!=="mouse"&&q(L.clientX,L.clientY)},{passive:!0}),a.addEventListener("pointerup",L=>{L.pointerType!=="mouse"&&q(L.clientX,L.clientY)},{passive:!0}),a.addEventListener("mousemove",L=>{q(L.clientX,L.clientY)},{passive:!0});function Z(L){}let le=setInterval(K,1e3),fe=()=>{if(clearInterval(le),Oc(),Rd=()=>{},typeof window<"u"&&(window.removeEventListener("resize",K),window.removeEventListener("beforeunload",Oc),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",g),window.removeEventListener("blur",be)),typeof ni=="function"){try{ni()}catch{}ni=null}if(f?.destroy){try{f.destroy()}catch{}f=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",H),je||u.removeEventListener("mouseover",H)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(L=>a.replaceWith(a.cloneNode(!0)))}catch{}};return Md={destroy:fe},{get count(){return xn},set count(L){xn=c.fromAny?c.fromAny(L):c.fromInt(Number(L)||0),Oa()},setMobileVolume:Z,destroy:fe,collectBatch:R,getMagnetUnitPx:Od}}var Pa,Nc,Rc,ni,Md,Qg,Pd,WI,ls,ri,zI,cs,Jg,Ba,Fa,Ua,Td,xn,Rd,kd,Oa,JI,Nd,io,us,Oc,Bd,ey,ty,ny,$n,oi,oy,ry,iy,xa=De(()=>{bt();xt();Yt();Ac();Zn();bo();So();yn();jg();An();Pa=!1,Nc=!1,Rc="0",ni=null;Md=null,Qg=c.fromInt(1),Pd=c.fromInt(1),WI=c.fromInt(1);try{ls=c.fromAny("Infinity")}catch{ls=null}ri=new Map,zI="1",cs=c.fromInt(1),Jg=!1,Ba=null,Fa=null,Ua=null,Td=!1,xn=null,Rd=()=>{},kd=!1,Oa=()=>{kd||(kd=!0,requestAnimationFrame(()=>{kd=!1,Rd()}))};JI=.05,Nd=8;io=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},us=(e,t)=>{if(!t)return e;if(!e)return io(t);try{return e.add(t)}catch{try{return io(e).add(t)}catch{return io(t)}}},Oc=()=>{let e=Ba;if(Ba=null,e&&!e.isZero?.())try{P.coins.add(e)}catch{}let t=Fa;if(Fa=null,t&&!t.isZero?.())try{Ri(t)}catch{}let n=Ua;if(Ua=null,n&&!n.isZero?.())try{Qi(n)}catch{}},Bd=()=>{Td||(Td=!0,requestAnimationFrame(()=>{Td=!1,Oc()}))},ey=e=>{Ba=us(Ba,e),Bd()},ty=e=>{Fa=us(Fa,e),Bd()},ny=e=>{Ua=us(Ua,e),Bd()};typeof window<"u"&&window.addEventListener("beforeunload",Oc,{passive:!0});$n=null,oi=!1,oy=()=>{try{let e=P?.coins?.mult;if(!e||typeof e.get!="function"){$n=null,oi=!1;return}let t=e.get();if(!t){$n=c.fromInt(1),oi=!1;return}$n=t.clone?.()??c.fromAny(t),oi=!!$n?.isInfinite?.()}catch{$n=null,oi=!1}},ry=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}$n||oy();let n=$n;if(!n)try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(oi||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return P?.coins?.mult?.applyTo?P.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},iy=e=>{if(!Pa)return null;if(Nc){if(ls)try{return ls.clone?.()??ls}catch{return ls}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=ri.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{ri.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=fs(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(WI)===0,s=r.clone?.()??r;if(ri.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function cy(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let i=Number(e.toString());isNaN(i)||(t=i),(e==="Infinity"||i===1/0)&&(n=!0)}catch{}let o=[],r=[];for(let i of ly){let s=i;if(n){s={...i,description:[...i.description]};let l=Ot();if(i.id===1){let a=Math.pow(10,l),u=Q(c.fromAny(a));Math.abs(a-Math.round(a))>.001?(u=a.toFixed(2),u.endsWith(".00")&&(u=u.slice(0,-3))):a<1e3&&(u=String(Math.round(a))),s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${u}x</span>`)}else if(i.id===2){let a=Math.pow(10,l),u=Q(c.fromAny(a));Math.abs(a-Math.round(a))>.001?(u=a.toFixed(2),u.endsWith(".00")&&(u=u.slice(0,-3))):a<1e3&&(u=String(Math.round(a))),s.description[1]=s.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${u}x</span>`)}else if(i.id===4){let a=Math.log10(4444e9),u=Ae(a*l),d=Q(u);s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${d}x</span>`)}}i.surgeLevel<=t?o.push(s):r.push(s)}return[...o,...r.slice(0,2)]}var ly,Ud,uy=De(()=>{Yt();xt();yn();no();ly=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${Q(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]}],Ud=ly.filter(e=>e.affectedByTsunami).map(e=>e.id)});function fy(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ft("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function d(I,X){I.style.position="absolute",I.style.left="50%";let W="perspective(600px) rotateX(50deg) rotateZ(180deg)",te=!!o.xpHTML,me=!!o.mpHTML;X==="coin"?(I.style.top="77%",I.style.transform=`translateX(-50%) ${W}`):te&&me?(I.style.top="72.5%",X==="mp"?I.style.transform=`translateX(calc(-100% - 44px)) ${W}`:I.style.transform=`translateX(44px) ${W}`):(X==="mp"?I.style.top="66%":X==="xp"&&(I.style.top="72%"),I.style.transform=`translateX(-50%) ${W}`),I.style.transformOrigin="center center";let ae=I.firstElementChild;ae&&(ae.removeAttribute("hidden"),ae.style.display="flex")}if(o.coinHTML){let I=document.createElement("div");I.innerHTML=o.coinHTML,d(I,"coin"),u.appendChild(I)}if(o.xpHTML){let I=document.createElement("div");I.innerHTML=o.xpHTML,d(I,"xp"),u.appendChild(I)}if(o.mpHTML){let I=document.createElement("div");I.innerHTML=o.mpHTML,d(I,"mp"),u.appendChild(I)}e.appendChild(u);let f=document.createElement("canvas");f.id="tsunami-fg-canvas",f.style.position="absolute",f.style.inset="0",f.style.width="100%",f.style.height="100%",f.style.zIndex="2147483646",f.style.pointerEvents="none",e.appendChild(f);let p=new Image;p.src="img/misc/merchant.webp";let g=!1;p.onload=()=>{g=!0},p.onerror=I=>{console.error("Tsunami: Merchant load failed",I)};let m,y,h=[],b=[],x=0;function E(){h=[],b=[];let I=y*.65,X=I+y*.15,te=300*(Math.min(m,y)*5e-4),me=m*.8,ae=me-te*.6,qe=me+te*.6;for(let st=0;st<100;st++){let nn=Math.random()*m,Tt=X+Math.random()*(y-X);b.push({x:nn,y:Tt})}let tt=(st,nn,Tt)=>{if(st>m*.1&&st<m*.9){let dn=y-I,fo=I+dn*.15;if(nn>fo)return!1}else if(Tt==="tree"){let dn=y-I,fo=I+dn*.5;if(nn>fo)return!1}return!(Tt==="tree"&&st>ae&&st<qe)},ve=(st,nn,Tt,dn,fo)=>{for(let Qo=0;Qo<nn;Qo++){let _o,Co,er=!1,S=0;for(;!er&&S<50;){fo?_o=fo():_o=Math.random()*m;let T=y,B=Math.random();if(Co=I+20+B*B*(T-I-20),tt(_o,Co,st)&&(er=!0,st==="tree")){for(let N of h)if(N.type==="tree"){let O=N.x-_o,de=N.y-Co;if(Math.sqrt(O*O+de*de)<Math.max(m*.08,100)){er=!1;break}}}S++}if(er){let B=.6+(Co-I)/(y-I)*.6,N=(Tt+Math.random()*dn)*B;h.push({type:st,x:_o,y:Co,scale:N})}}},Be=3+Math.floor(Math.random()*3);ve("tree",Be,.8,.4,()=>Math.random()*(m*.1)),ve("tree",Be,.8,.4,()=>m*.9+Math.random()*(m*.1));let $t=5+Math.floor(Math.random()*3);ve("tree",$t,.8,.4,()=>m*.1+Math.random()*(m*.8)),ve("rock",20,.6,.4),ve("shell",30,.3,.3),h.sort((st,nn)=>st.y-nn.y)}let C=a.getContext("2d",{alpha:!1}),A=f.getContext("2d",{alpha:!0});function z(){let I=window.devicePixelRatio||1;m=window.innerWidth,y=window.innerHeight,a.width=m*I,a.height=y*I,a.style.width=m+"px",a.style.height=y+"px",f.width=m*I,f.height=y*I,f.style.width=m+"px",f.style.height=y+"px",C.scale(I,I),A.scale(I,I),E(),x=-50}window.addEventListener("resize",z),z();let k=Date.now(),U=!0,M,F=!1,R={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},H=!1,j=[],ye=0,K=!1,ne=0,pe=5e3,be=!1,V=0,oe=[],$=6;for(let I=0;I<$;I++)oe.push({offset:Math.random()*1e3,speedBase:.001+I*5e-4,amplitudeBase:10+I*5});let q=[],Z=400;function le(I,X,W){return I*(1-W)+X*W}function fe(I){let X=parseInt(I.slice(1),16);return{r:X>>16&255,g:X>>8&255,b:X&255}}function L(I,X,W){let te=fe(I),me=fe(X),ae=Math.round(le(te.r,me.r,W)),qe=Math.round(le(te.g,me.g,W)),tt=Math.round(le(te.b,me.b,W));return`rgb(${ae},${qe},${tt})`}function Y(I,X,W){let te=[],me=I,ae=X,qe=20;for(;ae<W;){let tt=me+(Math.random()-.5)*60,ve=ae+qe+Math.random()*30;te.push({x1:me,y1:ae,x2:tt,y2:ve}),me=tt,ae=ve}return te}function ce(I,X,W,te,me,ae){I.beginPath(),I.moveTo(X+ae,W),I.lineTo(X+te-ae,W),I.quadraticCurveTo(X+te,W,X+te,W+ae),I.lineTo(X+te,W+me-ae),I.quadraticCurveTo(X+te,W+me,X+te-ae,W+me),I.lineTo(X+ae,W+me),I.quadraticCurveTo(X,W+me,X,W+me-ae),I.lineTo(X,W+ae),I.quadraticCurveTo(X,W,X+ae,W),I.closePath()}function he(I,X,W,te,me){I.save(),I.translate(X,W),I.scale(te,te),I.beginPath(),I.moveTo(0,0),I.quadraticCurveTo(10,-40,-5,-80),I.lineTo(5,-80),I.quadraticCurveTo(20,-40,10,0),I.fillStyle=me.rock,I.fill(),I.translate(0,-80),I.fillStyle=me.leaf;for(let ae=0;ae<7;ae++)I.save(),I.rotate(ae/7*Math.PI*2-Math.PI/2),I.beginPath(),I.moveTo(0,0),I.quadraticCurveTo(30,-10,60,0),I.quadraticCurveTo(30,10,0,0),I.fill(),I.restore();I.restore()}function J(I,X,W,te,me){I.save(),I.translate(X,W),I.scale(te,te),I.fillStyle=me.rock,I.beginPath(),I.moveTo(-20,0),I.bezierCurveTo(-20,-15,-10,-25,0,-25),I.bezierCurveTo(10,-25,20,-15,20,0),I.fill(),I.fillStyle="rgba(0,0,0,0.2)",I.beginPath(),I.ellipse(0,0,20,5,0,0,Math.PI*2),I.fill(),I.restore()}function re(I,X,W,te,me){I.save(),I.translate(X,W),I.scale(te,te),I.fillStyle=me.shell,I.beginPath(),I.arc(0,0,10,Math.PI,0),I.lineTo(0,0),I.fill(),I.strokeStyle=me.sandDark,I.lineWidth=1,I.beginPath();for(let ae=1;ae<5;ae++){let qe=Math.PI+ae/5*Math.PI;I.moveTo(0,0),I.lineTo(Math.cos(qe)*10,Math.sin(qe)*10)}I.stroke(),I.restore()}function ge(I,X,W,te,me){I.fillStyle=me.sandDark,I.fillRect(-50,te,X+100,W-te),I.fillStyle=me.sandDark,I.save(),I.fillStyle=me.sandLight,I.globalAlpha=.3,I.beginPath(),I.moveTo(-50,W+100),I.lineTo(-50,te),I.bezierCurveTo(X*.3,te-20,X*.7,te+20,X+50,te),I.lineTo(X+50,W+100),I.fill(),I.globalAlpha=.6;let ae=te+W*.05;I.beginPath(),I.moveTo(-50,W+100),I.lineTo(-50,ae),I.bezierCurveTo(X*.4,ae+40,X*.6,ae-10,X+50,ae+20),I.lineTo(X+50,W+100),I.fill(),I.globalAlpha=1;let qe=te+W*.15;I.beginPath(),I.moveTo(-50,W+100),I.lineTo(-50,qe),I.bezierCurveTo(X*.2,qe-10,X*.8,qe+30,X+50,qe+10),I.lineTo(X+50,W+100),I.fill(),I.fillStyle=me.sandDark,I.globalAlpha=.1,b.forEach(tt=>{I.fillRect(tt.x,tt.y,2,2)}),I.restore()}function Le(I,X,W,te=null){let me=te||1,ae=!!te&&te>5;H&&!ae&&!be&&ft("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),j.push({x:ae?X/2:Math.random()*X,y:ae?W/2:Math.random()*W,radius:0,maxRadius:ae?Math.max(X,W)*1.5:(100+Math.random()*400)*me,speed:ae?40:(5+Math.random()*15)*me,opacity:1,hue:225+Math.random()*15,life:1})}function ie(I,X,W,te=.5,me=!0){let ae=.1+te*.7,qe=Math.floor(1+te*4);if(me&&!be){for(let tt=0;tt<qe;tt++)if(j.length<50&&Math.random()<ae){let ve=1+te*2;Le(I,X,W,ve)}}I.save(),I.globalCompositeOperation="lighter";for(let tt=j.length-1;tt>=0;tt--){let ve=j[tt];if(ve.radius+=ve.speed,ve.opacity-=.015,ve.life-=.015,ve.opacity<=0||ve.radius>ve.maxRadius){j.splice(tt,1);continue}let Be=I.createRadialGradient(ve.x,ve.y,0,ve.x,ve.y,ve.radius),$t=ve.opacity;Be.addColorStop(0,`hsla(${ve.hue}, 100%, 80%, ${$t})`),Be.addColorStop(.3,`hsla(${ve.hue}, 100%, 40%, ${$t*.9})`),Be.addColorStop(.7,`hsla(${ve.hue}, 100%, 15%, ${$t*.6})`),Be.addColorStop(1,`hsla(${ve.hue}, 100%, 5%, 0)`),I.fillStyle=Be,I.beginPath(),I.arc(ve.x,ve.y,ve.radius,0,Math.PI*2),I.fill()}I.restore()}function Se(){if(!U)return;let I=Date.now(),X=I-k;Math.min(X/t,1)>=1&&!F&&(F=!0,r&&r.stop(),i&&i.stop(),n&&n());let te=5e3,me=6e3,ae=5e4,qe=5e4,tt=5e3,ve=4e4,Be=0;X<me?Be=0:X<ae?Be=(X-me)/(ae-me):Be=1;let $t=0;X>ve&&($t=Math.max(0,(X-ve)/(ae-ve))),X>ae&&($t=1),$t>.1&&!i&&(i=ft("sounds/tsu_rumble.ogg",{volume:.8}));let st={skyTop:L(R.skyTop,_.skyTop,Be),skyBottom:L(R.skyBottom,_.skyBottom,Be),sun:L(R.sun,_.sun,Be),waterDeep:L(R.waterDeep,_.waterDeep,Be),waterMid:L(R.waterMid,_.waterMid,Be),waterPeak:L(R.waterPeak,_.waterPeak,Be),foam:L(R.foam,_.foam,Be),sandLight:L(R.sandLight,_.sandLight,Be),sandDark:L(R.sandDark,_.sandDark,Be),rock:L(R.rock,_.rock,Be),leaf:L(R.leaf,_.leaf,Be),shell:L(R.shell,_.shell,Be)},nn=0,Tt=0;if(Be>.5||be){let S=(Be-.5)*2*5+$t*25;V>0&&(S+=50),nn=(Math.random()-.5)*S,Tt=(Math.random()-.5)*S}A.clearRect(0,0,m,y),C.save(),C.translate(nn,Tt),A.save(),A.translate(nn,Tt);let dn=C.createLinearGradient(0,0,0,y);if(dn.addColorStop(0,st.skyTop),dn.addColorStop(1,st.skyBottom),C.fillStyle=dn,C.fillRect(-50,-50,m+100,y+100),Be<1){let S=y*.15+Be*50;C.beginPath(),C.arc(m*.7,S,40,0,Math.PI*2),C.fillStyle=st.sun,C.globalAlpha=1-Be,C.shadowColor=st.sun,C.shadowBlur=20,C.fill(),C.globalAlpha=1,C.shadowBlur=0}let fo=y*.65;if(g&&Be<1){C.save();let S=Math.min(m,y)*5e-4,T=300*S,B=300*S,N=m*.8,O=B*.15,de=fo-B/2+O;C.translate(N,de),C.rotate(.1),C.drawImage(p,-T/2,-B/2,T,B),C.restore()}if(ge(C,m,y,fo,st),h.forEach(S=>{S.type==="tree"?he(C,S.x,S.y,S.scale,st):S.type==="rock"?J(C,S.x,S.y,S.scale,st):S.type==="shell"&&re(C,S.x,S.y,S.scale,st)}),Be>.3){let S=(Be-.3)/.7,T=Math.floor(Z*S);if(A.strokeStyle=`rgba(120, 180, 255, ${.1+S*.3})`,A.lineWidth=1+S,A.beginPath(),q.length<T)for(let N=0;N<10;N++)q.push({x:Math.random()*m*1.5,y:x,speed:20+Math.random()*20,len:10+Math.random()*20});let B=10+S*20;for(let N=0;N<q.length;N++){let O=q[N];O.y+=O.speed,O.x-=B,A.moveTo(O.x,O.y),A.lineTo(O.x-B*.5,O.y+O.len),(O.y>y||O.x<-100)&&(N<T?(O.x=Math.random()*m*1.5,O.y=x):(q.splice(N,1),N--))}A.stroke()}let Qo=.3;if(Be>Qo){let S=(Be-Qo)/(1-Qo),T=le(0,y*1.5,S*S);A.fillStyle=st.waterDeep,A.beginPath(),A.moveTo(-50,y+100),A.lineTo(-50,y-T*.3),A.bezierCurveTo(m*.3,y-T*.4,m*.6,y-T*1.2,m+50,y-T*.8),A.lineTo(m+50,y+100),A.fill()}let _o=le(0,y*.5,Be),Co=le(0,y*1.5,$t*$t),er=y*.85-_o-Co;if(oe.forEach((S,T)=>{let B;T===$-1?B=st.waterPeak:T%2===0?B=st.waterDeep:B=st.waterMid,A.fillStyle=B,A.beginPath();let N=S.amplitudeBase*(1+Be*2+$t*5),O=.003+Be*.005,de=S.speedBase*(1+Be*5+$t*10),ue=X*de+S.offset,Te=T*15*(1-$t),Oe=er+Te;A.moveTo(-50,y+100),A.lineTo(-50,Oe);for(let Pe=-50;Pe<=m+50;Pe+=15){let ke=Oe+Math.sin(Pe*O+ue)*N+Math.cos(Pe*O*2.3+ue)*(N*.5);A.lineTo(Pe,ke)}if(A.lineTo(m+50,y+100),A.fill(),T===$-1||Be>.6&&T>$-3){A.save(),A.globalAlpha=.1+Be*.3,A.fillStyle=st.foam,A.beginPath();for(let Pe=-50;Pe<=m+50;Pe+=10){let ke=Oe+Math.sin(Pe*O+ue)*N+Math.cos(Pe*O*2.3+ue)*(N*.5);Math.random()>.5&&(ke-=5),Pe===-50?A.moveTo(Pe,ke):A.lineTo(Pe,ke)}A.lineTo(m+50,y+100),A.lineTo(-50,y+100),A.fill(),A.restore()}}),X<te){let S=1;X>1e3&&(S=1-(X-1e3)/(te-1e3)),A.fillStyle=`rgba(0, 0, 0, ${S})`,A.fillRect(-50,-50,m+100,y+100)}if(X>qe){let S=Math.min(1,(X-qe)/tt);A.fillStyle=`rgba(0, 0, 0, ${S})`,A.fillRect(-50,-50,m+100,y+100)}if(H){let S=I-ye,T=12e3,B=0,N=!0;S<T?B=S/T:(B=1,be||(be=!0,Le(A,m,y,25),V=60,l||(l=!0,ft("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),K&&(N=!1),ie(A,m,y,B,N)}if(K){let S=I-ne,T=Math.min(1,S/pe);A.fillStyle=`rgba(0, 0, 0, ${T})`,A.fillRect(-50,-50,m+100,y+100)}if(V>0){let S=V/60,T=S*S;A.fillStyle=`rgba(255, 255, 255, ${T})`,A.fillRect(-50,-50,m+100,y+100),V--}C.restore(),A.restore(),M=requestAnimationFrame(Se)}function Ne(){U=!1,e.style.cursor="",M&&cancelAnimationFrame(M),window.removeEventListener("resize",z),a.parentNode&&a.parentNode.removeChild(a),f.parentNode&&f.parentNode.removeChild(f),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function _e(){H=!0,ye=Date.now(),be=!1,V=0,s||(s=ft("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Re(){K=!0,ne=Date.now(),s&&s.stop()}function se(){e.style.cursor=""}function ee(){e.style.cursor="none"}function Ie(){s&&(s.stop(),s=null)}return Se(),{cleanup:Ne,triggerBeacons:_e,triggerFinalFade:Re,showCursor:se,hideCursor:ee,stopHumLoop:Ie}}var dy=De(()=>{An()});var Vy={};vt(Vy,{canPerformForgeReset:()=>$y,canPerformInfuseReset:()=>qy,computeForgeGoldFromInputs:()=>Cy,computeInfuseMagicFromInputs:()=>My,computePendingForgeGold:()=>Dy,computeSurgeWavesFromInputs:()=>Ty,getCurrentSurgeLevel:()=>bn,getForgeDebugOverrideState:()=>Ny,getInfuseDebugOverrideState:()=>Oy,getSurgeBarLevelKey:()=>ds,getSurgeDebugOverrideState:()=>Fy,hasDoneForgeReset:()=>yr,hasDoneInfuseReset:()=>Ut,hasDoneSurgeReset:()=>Io,initResetPanel:()=>hd,initResetSystem:()=>$o,isForgeUnlocked:()=>is,isInfuseUnlocked:()=>Kc,isSurgeUnlocked:()=>ps,onForgeUpgradeUnlocked:()=>pp,onInfuseUpgradeUnlocked:()=>mp,onSurgeUpgradeUnlocked:()=>hp,performForgeReset:()=>cp,performInfuseReset:()=>up,performSurgeReset:()=>fp,recomputePendingMagic:()=>Gn,setForgeDebugOverride:()=>Ry,setForgeResetCompleted:()=>Qd,setInfuseDebugOverride:()=>By,setInfuseResetCompleted:()=>ep,setInfuseUnlockedForDebug:()=>Py,setSurgeResetCompleted:()=>tp,setSurgeUnlockedForDebug:()=>Uy,shouldBlockBigCoins:()=>Ha,updateResetPanel:()=>Ye});function Wd(e){return!aw.includes(e)}function lw(){ft(rw,{volume:.4})}function cw(){ft(iw,{volume:.45})}function uw(){ft(sw,{volume:.5})}function Ha(){return Ey}function xy(){let e=Hn(),t=P.waves?.value??Ct(),n=0n;try{n=Xa(e)}catch{}let o=w.pendingWaves,r=dp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),Ey=i&&!vn()}function Ga(){qd=null}function Xc(){let e=w.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function Vc(){let e=w.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function Gd(){let e=w.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function pw(e=null){try{if(e){let t=e instanceof wt?e:wt.fromAny(e??1);return t.isInfinite?.()?wt.fromAny("Infinity"):w.pendingGold.mulBigNumInteger(t)}return P.gold?.mult?.applyTo?.(w.pendingGold)??w.pendingGold}catch{return w.pendingGold}}function mw(){for(;so.length;){let e=so.pop();try{e?.()}catch{}}}function $d(){!gy&&typeof El=="function"&&(gy=El((e={})=>{e?.key&&e.key!==Me.COINS&&e.key!==Me.WAVES||e?.slot!=null&&w.slot!=null&&e.slot!==w.slot||(e?.key===Me.WAVES?(jc(),Ye()):(Ln(),Gn(),qn()))})),!yy&&typeof Ol=="function"&&(yy=Ol((e={})=>{e?.slot!=null&&w.slot!=null&&e.slot!==w.slot||(Ln(),qn(),Ye())}))}function Jd(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=$e(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Wc(){try{let e=Qe();if(e&&e.xpLevel)return e.xpLevel}catch{}return Ct()}function Ly(e,t){if(!e||typeof e!="object")return Ct();let n=$e(e);if(!Number.isFinite(n)&&n>0)return wt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return Ct();let r=Ae(o*Math.log10(2)),i=Math.max(0,Jd(t)),s=Math.max(0,(i-30)/5),l=s<=0?py():Ae(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?py():Ae(a*Math.log10(1.15)),d=wt.fromInt(10);d=d.mulBigNumInteger(r),d=d.mulBigNumInteger(l),d=d.mulBigNumInteger(u);let f=d.floorToInteger();return f.isZero?.()?Ct():f}function hw(e,t){if(!e)return Ct();let n=$e(e);if(!Number.isFinite(n)&&n>0)return wt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let g=$e(t);Number.isFinite(g)&&(a=Math.max(0,g-4))}let u=o*i,d=Math.floor(o)*s,f=a*l,p=r+u+d+f;return Number.isFinite(p)?Ae(p).floorToInteger():wt.fromAny("Infinity")}function _y(e,t,n=null){let o=hw(e,t);if(n){let r=n instanceof wt?n:wt.fromAny(n??1);return r.isInfinite?.()?wt.fromAny("Infinity"):o.mulBigNumInteger(r)}return P.magic?.mult?.applyTo?.(o)??o}function Cy(e,t){return Ly(e,t)}function My(e,t){return _y(e,t)}function Ty(e,t,n,o,r){return ky(e,t,n,o,r)}function ky(e,t,n,o,r){let i=Jd(e);if(i<201)return Ct();let s=(i-201)/35,l=$e(t),a=$e(n),u=$e(o),d=$e(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||d===Number.POSITIVE_INFINITY)return wt.fromAny("Infinity");let f=0;Number.isFinite(l)&&l>24&&(f+=(l-24)*Fc),Number.isFinite(a)&&a>13&&(f+=(a-13)*Fc),Number.isFinite(u)&&u>5&&(f+=(u-5)*Fc),Number.isFinite(d)&&d>12&&(f+=(d-12)*Fc);let p=1+f+s;return Number.isFinite(p)?Ae(p).floorToInteger():wt.fromAny("Infinity")}function Ay(){return Math.max(0,Jd(Wc()))}function Hn(){if(w.slot!=null)return w.slot;let e=v();return w.slot=e,e}function Qd(e){let t=Hn();if(t!=null){w.hasDoneForgeReset=!!e;try{localStorage.setItem(zd(t),w.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function ep(e){let t=Hn();if(t!=null){w.hasDoneInfuseReset=!!e;try{localStorage.setItem(Kd(t),w.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function tp(e){let t=Hn();if(t!=null){w.hasDoneSurgeReset=!!e;try{localStorage.setItem(jd(t),w.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function zc(e=v()){if(e==null)return null;try{let t=localStorage.getItem($a(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Ny(e=v()){return zc(e)}function Ry(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(w.forgeDebugOverride!==n){if(w.forgeDebugOverride=n,n==null)try{localStorage.removeItem($a(t))}catch{}else try{localStorage.setItem($a(t),n?"1":"0")}catch{}rt($a(t)),Xc(),Ye()}}function np(e=v()){if(e==null)return null;try{let t=localStorage.getItem(qa(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Oy(e=v()){return np(e)}function Py(e){op(e)}function By(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(w.infuseDebugOverride!==n){if(w.infuseDebugOverride=n,n==null)try{localStorage.removeItem(qa(t))}catch{}else try{localStorage.setItem(qa(t),n?"1":"0")}catch{}rt(qa(t)),Vc(),Ye()}}function op(e){let t=Hn();if(t==null)return;let n=!!e;if(w.infuseUnlocked!==n){w.infuseUnlocked=n;try{localStorage.setItem(Gc(t),w.infuseUnlocked?"1":"0")}catch{}rt(Gc(t)),Vc()}}function Yc(e){let t=Hn();if(t==null)return;let n=!!e;if(w.forgeUnlocked!==n){w.forgeUnlocked=n;try{localStorage.setItem(qc(t),w.forgeUnlocked?"1":"0")}catch{}rt(qc(t)),Xc()}}function rp(e=v()){if(e==null)return null;try{let t=localStorage.getItem(wy(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Fy(e=v()){return rp(e)}function Uy(e){ip(e)}function ip(e){let t=Hn();if(t==null)return;let n=!!e;if(w.surgeUnlocked!==n){w.surgeUnlocked=n;try{localStorage.setItem(Hc(t),w.surgeUnlocked?"1":"0")}catch{}rt(Hc(t)),Gd()}}function Hd(e){if(e==null){w.forgeUnlocked=!1,w.forgeDebugOverride=null,w.hasDoneForgeReset=!1,w.infuseUnlocked=!1,w.infuseDebugOverride=null,w.hasDoneInfuseReset=!1,w.surgeUnlocked=!1,w.surgeDebugOverride=null,w.hasDoneSurgeReset=!1,w.flagsPrimed=!1;return}try{w.forgeUnlocked=localStorage.getItem(qc(e))==="1"}catch{w.forgeUnlocked=!1}w.forgeDebugOverride=zc(e);try{w.hasDoneForgeReset=localStorage.getItem(zd(e))==="1"}catch{w.hasDoneForgeReset=!1}try{w.infuseUnlocked=localStorage.getItem(Gc(e))==="1"}catch{w.infuseUnlocked=!1}try{w.hasDoneInfuseReset=localStorage.getItem(Kd(e))==="1"}catch{w.hasDoneInfuseReset=!1}w.infuseDebugOverride=np(e);try{w.surgeUnlocked=localStorage.getItem(Hc(e))==="1"}catch{w.surgeUnlocked=!1}w.surgeDebugOverride=rp(e);try{w.hasDoneSurgeReset=localStorage.getItem(jd(e))==="1"}catch{w.hasDoneSurgeReset=!1}w.flagsPrimed=!0}function Ho(){let e=v();if(e==null){w.flagsPrimed=!1;return}w.slot!==e&&(w.slot=e,Ga(),w.flagsPrimed=!1),w.flagsPrimed||Hd(e)}function vy(e){my!==e&&(mw(),my=e,e!=null&&(so.push(Lt(qc(e),{onChange(t){let n=t==="1";w.forgeUnlocked!==n&&(w.forgeUnlocked=n,Xc(),Ye())}})),so.push(Lt(zd(e),{onChange(t){let n=t==="1";w.hasDoneForgeReset!==n&&(w.hasDoneForgeReset=n,Ye())}})),so.push(Lt($a(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),w.forgeDebugOverride!==n&&(w.forgeDebugOverride=n,Xc(),Ye())}})),so.push(Lt(Gc(e),{onChange(t){let n=t==="1";w.infuseUnlocked!==n&&(w.infuseUnlocked=n,Vc(),Ye())}})),so.push(Lt(Kd(e),{onChange(t){let n=t==="1";w.hasDoneInfuseReset!==n&&(w.hasDoneInfuseReset=n,Ye())}})),so.push(Lt(qa(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),w.infuseDebugOverride!==n&&(w.infuseDebugOverride=n,Vc(),Ye())}})),so.push(Lt(Hc(e),{onChange(t){let n=t==="1";w.surgeUnlocked!==n&&(w.surgeUnlocked=n,Gd(),Ye())}})),so.push(Lt(wy(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),w.surgeDebugOverride!==n&&(w.surgeDebugOverride=n,Gd(),Ye())}})),so.push(Lt(jd(e),{onChange(t){let n=t==="1";w.hasDoneSurgeReset!==n&&(w.hasDoneSurgeReset=n,Ye())}}))))}function gw(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function Ln(e=!1){let t=P.coins?.value??Ct(),n=Wc(),o=gw(t,n);!e&&qd===o||(qd=o,sp()?w.pendingGold=Ly(t,n):w.pendingGold=Ct(),Ye())}function Gn(e=null){let t=P.coins?.value??Ct(),n=Va();ap()?w.pendingMagic=_y(t,n,e):w.pendingMagic=Ct(),qn(),Ye()}function qn(){if(!ps()){w.pendingWaves=Ct();return}let e=Wc(),t=P.coins?.value??Ct(),n=P.gold?.value??Ct(),o=P.magic?.value??Ct(),r=Va();w.pendingWaves=ky(e,t,n,o,r),Io()||w.pendingWaves.cmp(wt.fromInt(10))>0&&(w.pendingWaves=wt.fromInt(10)),xy()}function Xd(){let e=zc();return e!=null?!!e:w.forgeUnlocked||_t(xe.STARTER_COVE,we.UNLOCK_FORGE)>=1}function sp(){try{let e=Wc();if(e&&typeof e.cmp=="function")return e.cmp(fw)>=0}catch{}return!1}function ap(){try{let e=at();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(dw)>=0}catch{}return!1}function is(){Ho();let e=zc();return e!=null?!!e:!!w.forgeUnlocked||Xd()}function Kc(){Ho();let e=np();return e!=null?!!e:!!w.infuseUnlocked}function ps(){Ho();let e=rp();return e!=null?!!e:!!w.surgeUnlocked}function bn(){let e=Hn();return e==null?0n:Xa(e)}function yr(){return Ho(),!!w.hasDoneForgeReset}function Ut(){return Ho(),!!w.hasDoneInfuseReset}function Io(){return Ho(),!!w.hasDoneSurgeReset}function Dy(){return Ln(),w.pendingGold.clone?.()??w.pendingGold}function $y(){return!(!is()||!sp()||w.pendingGold.isZero?.())}function qy(){return!(!Kc()||!ap()||w.pendingMagic.isZero?.())}function yw({resetGold:e=!1,resetMagic:t=!1}={}){let n=Bt(xe.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===we.UNLOCK_XP||r===we.UNLOCK_FORGE||r===we.UNLOCK_INFUSE||r===we.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||Xo(xe.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function lp({resetGold:e=!1,resetMagic:t=!1}={}){try{P.coins.set(0)}catch{}try{P.books.set(0)}catch{}try{Ni({keepUnlock:!0})}catch{}try{Fd()}catch{}yw({resetGold:e,resetMagic:t})}function cp(){if(!$y())return!1;let e=w.pendingGold.clone?.()??w.pendingGold;try{let t=P.gold?.mult?.applyTo?.(e)??e;P.gold?.add&&P.gold.add(t)}catch{}if(lp({resetGold:!1}),Ln(),Yc(!0),w.hasDoneForgeReset||Qd(!0),Xt(),wr(),Wd("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return Ye(),!0}function up(){if(!qy())return!1;let e=w.pendingMagic.clone?.()??w.pendingMagic;try{P.magic?.add&&P.magic.add(e)}catch{}lp({resetGold:!0});try{P.gold.set(0)}catch{}try{let t=v(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Xt({forceReload:!0})}catch{}if(Ln(),Gn(),Wd("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return op(!0),w.hasDoneInfuseReset||ep(!0),Ye(),!0}function Vd(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Hn();try{P.waves?.add&&e&&!e.isZero?.()&&P.waves.add(e)}catch{}lp({resetGold:!0,resetMagic:!0});try{P.gold.set(0)}catch{}try{P.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Xt({forceReload:!0})}catch{}if(jc(),ip(!0),w.hasDoneSurgeReset||tp(!0),Ln(),Gn(),qn(),t&&(n||uw(),n||Sw()),Wd("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}Ye()}function vw(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{Xg(!0)}catch{}try{dc()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,ur(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=fy(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Tg(e,()=>{setTimeout(bw,0)},i)},r);$c=i.cleanup}function bw(){$c&&($c(),$c=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Vd(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=v();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function fp(){if(!ps()||Ay()<201)return!1;let e=w.pendingWaves.clone?.()??w.pendingWaves;if(e.isZero?.())return!1;let t=Hn(),n=P.waves?.value??Ct(),o=Xa(t),r=dp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!vn()?(vw(),Vd(e,{playEffects:!1}),!0):(Vd(e,{playEffects:!0}),!0)}function Sw(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function Xa(e){let t=0n;try{let n=localStorage.getItem(Zd(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function Iw(e){let t=Zd(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function by(e){if(!(e instanceof wt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function Gy(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=by(n),l=by(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let d=new c(10n,{base:0,offset:u}),f=d.sub(r).div(c.fromInt(9));n.cmp(f)>=0&&(n=n.sub(f),o=u,i=!0,r=d)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function jc(){let e=Hn();if(e==null||!ps()||Dd||Iw(e))return;let t=P.waves?.value??Ct(),n=Xa(e);if(n===1/0)return;let o=Gy(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Zd(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}Dd=!0;try{P.waves.set(o.remainingWaves)}finally{Dd=!1}Ye(),o.safety>=100&&setTimeout(jc,0)}xy()}function Da(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=wt.fromInt(e)}catch{}try{return Q(t)}catch{return e?.toString?.()??"0"}}function ww(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${tw}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${nw}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${ow}" alt=""><span>Surge</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Sy}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Iy}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Dc}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,w.panel=e,w.elements.forge.card=e.querySelector("#reset-card-forge"),w.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),w.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),w.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),w.elements.infuse.card=e.querySelector("#reset-card-infuse"),w.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),w.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),w.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),w.elements.surge.card=e.querySelector("#reset-card-surge"),w.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),w.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),w.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),w.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),w.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),w.elements.surge.headerVal=e.querySelector("[data-surge-level]"),w.elements.surge.header=e.querySelector(".surge-header");let t=e.querySelector(".surge-milestone-wrapper");w.elements.surge.milestones&&t&&Zi(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),w.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]')},Object.entries(w.layerButtons).forEach(([n,o])=>{if(!o)return;let r=null,i=s=>{if(s&&s.isTrusted&&Jn(o))return;let l=w.elements[n]?.card;if(l){let a=l.closest(".merchant-content");n==="forge"&&a?a.scrollTo({top:0,behavior:"smooth"}):l.scrollIntoView({behavior:"smooth",block:"start"})}};o.addEventListener("click",s=>{if(r&&r!=="mouse"){r=null;return}r=null,i(s)})}),w.elements.forge.btn&&w.elements.forge.btn.addEventListener("click",()=>{cp()&&(lw(),Ye())}),w.elements.infuse.btn&&w.elements.infuse.btn.addEventListener("click",()=>{up()&&(cw(),Ye())}),w.elements.surge.btn&&w.elements.surge.btn.addEventListener("click",()=>{fp()&&Ye()}),Ye()}function hd(e){!e||e.__resetInit||(e.__resetInit=!0,ww(e))}function Ir(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=Da(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let d=e.querySelector(".merchant-reset__action-icon img");d&&!d.src.includes(n)&&(d.src=n)}}function Hy({goldMult:e=null}={}){let t=w.elements.forge;if(!(!t.card||!t.btn)){if(!is()){Ir(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(Ho(),t.card.classList.toggle("is-forge-complete",!!w.hasDoneForgeReset),t.status)if(w.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!sp()){Ir(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Ir(t.btn,{disabled:!1},Sy,pw(e))}}function Xy(){let e=w.elements.infuse;if(!(!e.card||!e.btn)){if(!Kc()){e.card.style.display!=="none"&&(e.card.style.display="none"),w.layerButtons.infuse&&w.layerButtons.infuse.style.display!=="none"&&(w.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),w.layerButtons.infuse&&w.layerButtons.infuse.style.display!=="flex"&&(w.layerButtons.infuse.style.display="flex"),Ho(),e.card.classList.toggle("is-complete",!!w.hasDoneInfuseReset),e.status)if(w.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!ap()){Ir(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Ir(e.btn,{disabled:!1},Iy,w.pendingMagic)}}function dp(e,t,n){let o=t.add(n);return Gy(e,o).level}function Yd(){let e=w.elements.surge;if(!e.card||!e.btn)return;if(!ps()){e.card.style.display!=="none"&&(e.card.style.display="none"),w.layerButtons.surge&&w.layerButtons.surge.style.display!=="none"&&(w.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),w.layerButtons.surge&&w.layerButtons.surge.style.display!=="flex"&&(w.layerButtons.surge.style.display="flex"),Ho();let t=Hn(),n=P.waves?.value??Ct(),o=0n;try{o=Xa(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':Da(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=w.pendingWaves;if(u&&!u.isZero?.()){let d=dp(o,n,u),f=!1;if(d===1/0)f=!0;else try{f=d>o}catch{}if(f){let p=d===1/0?'<span class="surge-infinity-symbol">\u221E</span>':Da(d);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${Dc}">${Da(n)} / <img src="${Dc}">${Da(r)}</span>`),e.milestones){let s=cy(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let d=BigInt(a.surgeLevel)<=o,f=d?"is-reached":"",p=a.description.map(E=>E.includes("Invokes the Tsunami")&&!d?`<div class="tsunami-text">- ${E}</div>`:`<div>- ${E}</div>`).join("");if(d&&a.surgeLevel===3){let E=fr?fr():wt.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${Q(E)}</div>`}if(d&&a.surgeLevel===6){let E=ec();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${gt(E.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${gt(E.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${gt(E.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${gt(E.magic)}x</span></div>`}let g=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(g=!0);let m=!1;d&&g&&Ot()<1&&Ud.includes(a.id)&&(m=!0);let y=m?" is-nerfed":"",h=l[u];if(!h)h=document.createElement("div"),h.className=`surge-milestone-item ${f}${y}`,h.dataset.isReached=String(d),h.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(h);else{h.className!==`surge-milestone-item ${f}${y}`&&(h.className=`surge-milestone-item ${f}${y}`);let E=String(d);h.dataset.isReached!==E&&(h.dataset.isReached=E)}let b=h.querySelector(".surge-milestone-desc");b&&b.innerHTML!==p&&(b.innerHTML=p);let x=h.querySelector(".surge-milestone-nerf-arrow");if(x){let E=!1;g&&Ot()!==1&&Ud.includes(a.id)&&(E=!0);let C=E?"":"none";x.style.display!==C&&(x.style.display=C)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();w.lastRenderedSurgeLevel!==o&&(w.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],d=e.milestones.children;u===d[d.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!w.hasDoneSurgeReset),e.status)if(w.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(Ay()<201){Ir(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(w.pendingWaves.isZero?.()){Ir(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Ir(e.btn,{disabled:!1},Dc,w.pendingWaves)}function Ye({goldMult:e=null}={}){w.panel&&(Hy({goldMult:e}),Xy(),Yd())}function pp(){$o(),Yc(!0),Ye()}function mp(){$o(),op(!0),Ye()}function hp(){$o(),ip(!0),Ye()}function Ew(){if(!w.panel)return;let e=w.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!w.panel.classList.contains("is-active")||!w.elements.surge.barFill)return;let t=w.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Yd(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Yd()},{once:!0}))}function xw(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{Ew()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(Ln(),Gn(),qn()),e.detail?.key==="waves"&&(jc(),Ye()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(qn(),Ye())}),window.addEventListener("surge:bookResidue",()=>{if(w.panel&&w.panel.offsetParent!==null){let e=w.elements.surge.card;e&&e.style.display!=="none"&&Ye()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Me.GOLD){if(t.slot!=null&&w.slot!=null&&t.slot!==w.slot)return;Ln(!0);let n=t.mult instanceof c?t.mult:wt.fromAny(t.mult??1);w.panel&&Hy({goldMult:n});return}if(t.key===Me.MAGIC){if(t.slot!=null&&w.slot!=null&&t.slot!==w.slot)return;let n=t.mult instanceof c?t.mult:wt.fromAny(t.mult??1);Gn(n),w.panel&&Xy();return}}}),window.addEventListener("xp:change",()=>{Ln(),qn(),Ye()}),window.addEventListener("mutation:change",()=>{Gn(),qn(),Ye()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&w.slot!=null&&e.detail.slot!==w.slot||(Ga(),Ln(!0),Gn(),qn(),Ye())}))}function $o(){if(hy){w.slot=v(),Ga(),$d(),Ln(!0),Gn(),qn();return}try{Xt()}catch{return}hy=!0;let e=v();if(w.slot=e,Ga(),Hd(e),w.hasDoneForgeReset&&!Eo())try{wr()}catch{}if(!w.forgeUnlocked&&Xd()&&Yc(!0),vy(e),$d(),xw(),Ln(!0),Gn(),qn(),Uc){try{Uc()}catch{}Uc=null}Uc=ii(()=>{let t=gp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=v();if(w.slot=t,Ga(),Hd(t),w.hasDoneForgeReset&&!Eo())try{wr()}catch{}!w.forgeUnlocked&&Xd()&&Yc(!0),vy(t),$d(),Ln(!0),Gn(),qn(),Ye()})}var wt,Fc,Ct,py,Sy,Iy,tw,nw,ow,Dc,rw,iw,sw,aw,qc,zd,$a,Gc,Kd,qa,Hc,wy,jd,ds,Zd,fw,dw,Dd,Ey,w,so,my,hy,Uc,qd,gy,yy,$c,vo=De(()=>{xt();bt();Yt();Zn();yn();So();Fi();xa();uy();zr();An();no();mc();dy();wt=c,Fc=Math.log10(1.1),Ct=()=>wt.fromInt(0),py=()=>wt.fromInt(1),Sy="img/currencies/gold/gold.webp",Iy="img/currencies/magic/magic.webp",tw="img/misc/forge.webp",nw="img/misc/infuse.webp",ow="img/misc/surge.webp",Dc="img/currencies/wave/wave.webp",rw="sounds/forge_reset.ogg",iw="sounds/infuse_reset.ogg",sw="sounds/surge_reset.ogg",aw=[];qc=e=>`ccc:reset:forge:${e}`,zd=e=>`ccc:reset:forge:completed:${e}`,$a=e=>`ccc:debug:forgeUnlocked:${e}`,Gc=e=>`ccc:reset:infuse:${e}`,Kd=e=>`ccc:reset:infuse:completed:${e}`,qa=e=>`ccc:debug:infuseUnlocked:${e}`,Hc=e=>`ccc:reset:surge:${e}`,wy=e=>`ccc:debug:surgeUnlocked:${e}`,jd=e=>`ccc:reset:surge:completed:${e}`,ds=e=>`ccc:reset:surge:barLevel:${e}`,Zd=ds,fw=wt.fromInt(31),dw=wt.fromInt(7),Dd=!1,Ey=!1;w={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,pendingGold:Ct(),pendingMagic:Ct(),pendingWaves:Ct(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},so=[],my=null,hy=!1,Uc=null,qd=null,gy=null,yy=null;$c=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:$o,performForgeReset:cp,performInfuseReset:up,performSurgeReset:fp,computePendingForgeGold:Dy,computeForgeGoldFromInputs:Cy,computeInfuseMagicFromInputs:My,computeSurgeWavesFromInputs:Ty,getForgeDebugOverrideState:Ny,hasDoneForgeReset:yr,isForgeUnlocked:is,setForgeDebugOverride:Ry,setForgeResetCompleted:Qd,updateResetPanel:Ye,isInfuseUnlocked:Kc,setInfuseDebugOverride:By,getInfuseDebugOverrideState:Oy,recomputePendingMagic:Gn,setInfuseUnlockedForDebug:Py,setInfuseResetCompleted:ep,hasDoneInfuseReset:Ut,isSurgeUnlocked:ps,setSurgeUnlockedForDebug:Uy,getSurgeDebugOverrideState:Fy,setSurgeResetCompleted:tp,hasDoneSurgeReset:Io,getCurrentSurgeLevel:bn,shouldBlockBigCoins:Ha}))});function yp(){Ya=null}function Yy(){Ya=null;try{Zc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{gn()}catch{}}function Wy(e){return typeof e=="function"&&Zc.push(e),()=>{Zc=Zc.filter(t=>t!==e)}}function _w(e){let t=ct(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Ae(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function Cw(){try{return!!an()}catch{return!1}}function Wa(e){let t=P?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(Cw())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=_t(xe.STARTER_COVE,we.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=_w(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function ms(e=xe.STARTER_COVE){if(Ya)return Ya;let t=Bt(e),n={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let o of t){if(!o.effectType)continue;let r=En(e,o.id),i=Fe(r),s=null;if(typeof o.effectMultiplier=="function"?(s=o.effectMultiplier(i),!(s instanceof c)&&typeof s!="number"&&(s=c.fromAny(s??1))):s=c.fromInt(1),o.upgType==="HM"){let{selfMult:l,xpMult:a,coinMult:u,mpMult:d}=Er(o,r,e);n.xpValue=Et(n.xpValue,a),n.coinValue=Et(n.coinValue,u),n.mpValue=Et(n.mpValue,d),s=Et(s,l)}if(o.effectType==="coin_spawn"){let l=1;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=1}else l=Number(s);n.coinSpawn*=l}else if(o.effectType==="coin_value")n.coinValue=Et(n.coinValue,s);else if(o.effectType==="xp_value")n.xpValue=Et(n.xpValue,s);else if(o.effectType==="mp_value")n.mpValue=Et(n.mpValue,s);else if(o.effectType==="book_value")n.bookValue=Et(n.bookValue,s);else if(o.effectType==="magnet_radius"){let l=0;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=0}else l=Number(s);Number.isFinite(l)&&(n.magnetRadius+=l)}}return Ya=n,n}function Ji(e){let t=ms(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:Lw*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue}}function Pc(){try{let{mpValue:e}=ms(xe.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Bc(){try{let{magnetRadius:e}=ms(xe.STARTER_COVE);return e||0}catch{return 0}}function zy(){try{$o()}catch{}try{Ur(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=ms(xe.STARTER_COVE);return Et(n,o)})}catch{}try{Oi(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=ms(xe.STARTER_COVE);return Et(n,o)})}catch{}try{jr(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=ms(xe.STARTER_COVE);return Et(n,o)})}catch{}Wa(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{Wa()}catch{}try{gn()}catch{}})}var Lw,Ya,Zc,Ky=De(()=>{xt();bt();vo();Zn();So();yn();Lw=1,Ya=null,Zc=[]});var Sv={};vt(Sv,{AREA_KEYS:()=>xe,HM_EVOLUTION_INTERVAL:()=>Dt,MAX_LEVEL_DELTA:()=>ws,REGISTRY:()=>mu,UPGRADE_TIES:()=>we,approxLog10BigNum:()=>$e,batchUpgradeOperations:()=>Ka,bigNumFromLog10:()=>Ae,buyCheap:()=>wd,buyMax:()=>Lc,buyOne:()=>Aa,buyTowards:()=>Na,clearPermanentUpgradeUnlock:()=>Bp,computeDefaultUpgradeCost:()=>Fp,computeHmMultipliers:()=>Er,computeUpgradeEffects:()=>Ji,costToBuyOne:()=>Qw,ensureLevelBigNum:()=>ct,estimateFlatBulk:()=>Tp,estimateGeometricBulk:()=>Ww,evaluateBulkPurchase:()=>ei,evolveUpgrade:()=>Id,formatMultForUi:()=>gt,getCurrentAreaKey:()=>Dn,getHmEvolutions:()=>Np,getHmNextMilestoneLevel:()=>eE,getIconUrl:()=>_c,getLevel:()=>En,getLevelNumber:()=>_t,getMagnetLevel:()=>Bc,getMpValueMultiplierBn:()=>Pc,getUpgrade:()=>_s,getUpgradeLockState:()=>qo,getUpgradeStorageKey:()=>ai,getUpgradesForArea:()=>Bt,levelBigNumToNumber:()=>Fe,markUpgradePermanentlyUnlocked:()=>si,normalizeBigNum:()=>tE,normalizedUpgradeLevel:()=>iu,onUpgradesChanged:()=>Wy,peekNextPrice:()=>bv,performFreeAutobuy:()=>bd,safeMultiplyBigNum:()=>Et,setLevel:()=>Xo,syncBookCurrencyMultiplierFromUpgrade:()=>Wa,upgradeUiModel:()=>Ra});function Jc(){xr.size!==0&&(xr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{rt(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),xr.clear())}function Tw(){if(!(typeof window>"u")&&!Zy){Zy=setInterval(Jc,2e3);try{window.addEventListener("beforeunload",Jc)}catch{}try{window.addEventListener("pagehide",Jc)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&Jc()})}catch{}}}function Ka(e){if(ys)return e();ys=!0;try{return e()}finally{ys=!1,za.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{bs(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),za.clear(),jy.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{Zw(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),jy.clear(),Ep&&(Ep=!1,ao())}}function kw(e){try{let t=Ls(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function ev(e,t){if(!kw(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=$e(n);return Number.isFinite(o)&&o>=Aw}catch{return!1}}function vs(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>vp)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>vp/2||i.length>vp/2)return"Infinity"}return n}function $e(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let g=Math.log10(p),m=e.e||0,y=Number(e._eOffset||0n);return g+m+y}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let d;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)+(u.length-15)}let f=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return d+f}function Ae(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function eu(e){return Fw[e]??0}function bp(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Es(e,t){let n=Wo(e||t?.area);if(!n)return null;let o=zo(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=Yn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function ja(e,t){let n=Wo(e||t?.area);if(!n)return null;let o=Yn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function hs(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function _p(e=v()){let t=String(e??"default");if(nu.has(t))return nu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${ov}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),nu.set(t,n),n}function Cp(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),nu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${ov}:${n}`,JSON.stringify(e))}catch{}}function fu(e=v()){let t=String(e??"default");if(ou.has(t))return ou.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${rv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),ou.set(t,n),n}function du(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),ou.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${rv}:${n}`,JSON.stringify(e))}catch{}}function Op(e=v()){let t=String(e??"default");if(ru.has(t))return ru.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${iv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),ru.set(t,n),n}function Pp(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),ru.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${iv}:${n}`,JSON.stringify(e))}catch{}}function Mp(e,t,n=v()){let o=Es(e,t);if(!o)return;let r=ja(e,t),i=Op(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Pp(i,n))}function sv(e,t,n=v()){let o=Es(e,t);if(!o)return!1;let r=ja(e,t),i=Op(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Pp(i,n),!0):!1}function si(e,t,n=v()){let o=Es(e,t);if(!o)return;let r=ja(e,t),i=fu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],du(i,n))}function Bp(e,t,n=v()){let o=Es(e,t);if(!o)return;let r=fu(n);r.upgrades[o]&&(delete r.upgrades[o],du(r,n));let i=_p(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},Cp(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&Ko(e,s,n),ao()}function lu(e,t,n=v()){let o=Es(e,t);if(!o)return!1;let r=ja(e,t),i=fu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],du(i,n),!0):!1}function ln(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=zo(t?.tie??t?.tieKey),o=e?.areaKey||xe.STARTER_COVE;if(!n||!Rw.has(n))return{locked:!0,iconOverride:_n,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?_t(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:av()}catch{}function s(){if(lv())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:cn,titleOverride:Jt,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===we.UNLOCK_XP)return s();if(n===we.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:_n,useLockedBase:!0};let a=!1;try{let u=un();a=Fe(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jt,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_INFUSE){if(!yr())return{locked:!0,iconOverride:_n,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Vn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=un();a=Fe(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jt,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_SURGE){if(!Ut())return{locked:!0,iconOverride:_n,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Vn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=un();a=Fe(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jt,descOverride:u,reason:u}}return{locked:!1}}if(Rp.has(n)){if(Ut()||lu(o,t)){try{si(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let d=un();a=Fe(d)>=101}catch{}if(!a)return{locked:!0,iconOverride:_n,useLockedBase:!0,titleOverride:Vn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{Mp(o,t)}catch{}return{locked:!0,iconOverride:cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jt,descOverride:u,reason:u}}if(yr()||lu(o,t)){try{si(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:_n,useLockedBase:!0};if(sv(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Jt,descOverride:a,reason:a}}let l=!1;try{let a=un();l=Fe(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:_n,useLockedBase:!0,titleOverride:Vn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{Mp(o,t)}catch{}return{locked:!0,iconOverride:cn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function Wo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function zo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function Uw(e,t){let n=zo(t?.tie??t?.tieKey);if(n&&Ow.has(n))return!0;let o=Yn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=Wo(l);if(a&&Pw.has(`${a}:${i}`))return!0}return!1}function av(){try{return!!an()}catch{return!1}}function lv(e=v()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${Bw}:${t}`)==="1"}catch{return!1}}function un(){try{let e=typeof Qe=="function"?Qe():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function iu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function Sp(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function Yn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function ct(e){try{if(e=vs(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Ae(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=$e(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Fe(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=$e(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let f=Number(r);return Number.isFinite(f)?f:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let f=Math.floor(Math.log10(a));Number.isFinite(f)&&f>0&&(a/=Math.pow(10,f),u+=f)}else if(a<1){let f=Math.ceil(Math.log10(1/a));Number.isFinite(f)&&f>0&&(a*=Math.pow(10,f),u-=f)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let d=a*Math.pow(10,u);return Number.isFinite(d)?d:u>0?Number.MAX_VALUE:0}catch{let o=$e(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function Dw(e,t){let n=ct(e),o=ct(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor($e(n))+1,i=Math.floor($e(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function cv(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function xs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function cu(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:xs(e.numUpgEvolutions)}function Fp(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Fe(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let d=Math.max(0,Math.floor(r/Dt));Number.isFinite(d)&&(i.numUpgEvolutions=d)}let s=pv(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:$e(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:cv(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,Xn(i,r)}function uv(e){let t=xs(e),n=Dt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Lr(o),capFmtText:Ss(o)}}function fv(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor($e(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Dt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Dt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Fe(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Dt)+1)}}function qw(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Up(e,t=au){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=Wo(t||e?.area||au);return Nw[n]||tv}function Et(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function pu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=uv(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Er(e,t,n=au){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Up(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let d=fv(t,Number(u?.level??u?.lvl??0));if(!(d>0))continue;let f=qw(u.multiplier??u.mult??u.value??1,d),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=Et(i,f):p==="coin"||p==="coins"?s=Et(s,f):p==="mp"?l=Et(l,f):r=Et(r,f)}let a=cu(e);if(a>0){let u=Mw*a,d=Ae(u);r=Et(r,d)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function dv(e,t,n=au){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Up(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=fv(t,s),a=null;try{let u=BigInt(s),d=BigInt(Math.max(0,l)),f=u+BigInt(Dt)*d;f>0n&&(a=c.fromAny(f.toString()))}catch{}if(!a){let u=c.fromAny(Dt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Dt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Dt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function pv(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=$w[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Ls(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let f=Number(i);Number.isFinite(f)&&f>0&&(r=f)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let f=Math.pow(10,s);Number.isFinite(f)&&f>0&&(r=f)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let f=Math.exp(l);Number.isFinite(f)&&f>0&&(r=f)}if(!r){let f=Number(o.ratioMinus1);Number.isFinite(f)&&f>0&&(r=f+1)}let a=null;if(!r){let f=pv(e);f&&(r=f.ratio,f.ratioLog10!=null&&(s=f.ratioLog10),a=f.preset)}if(r>1){r=Number(r),i=cv(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=$e(n),d=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=d;try{let f=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),g=c.fromAny(e.costAtLevel?.(32)??0);f.cmp(p)===0&&f.cmp(g)===0&&(d.ratio=1,d.ratioMinus1=0,d.ratioLog10=0,d.ratioLn=0,d.ratioStr="1")}catch{}return d}catch{return null}}function Xn(e,t){let n=Ls(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Ae(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Ae(n.baseLog10+o*n.ratioLog10).floorToInteger()}function Gw(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function Vo(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Ls(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*gs+t*o.ratioLn)/gs;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*gs+t*o.ratioLn,i=o.ratioLn*n,s=Gw(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/gs}function su(e,t,n){if(!(n>0))return c.fromInt(0);let o=Ls(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=Vo(e,t,l);a=a.add(Ae(u))}if(s>0){let u=t+l,d=c.fromAny(e.costAtLevel(u));for(let f=0;f<s;f+=1)a=a.add(d),f+1<s&&(d=d.mulDecimalFloor(o.ratioStr))}return a}let i=Vo(e,t,n);return Ae(i)}function Hw(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/gs;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/gs:e>0?e:0}function hv(e){if(!(e>0)||!Number.isFinite(e))return e;if(wp[0]=e,wp[0]<=0)return 0;Xw[0]-=1n;let t=wp[0];return t>0?t:0}function Vw(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=hv(e);return n<e?n:e>1?e/2:0}function tu(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function Za(e,t,n,o=ws,r={}){let i=Ls(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Fe(t))),d=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,f=typeof o=="number"?o:Fe(o),p=Number.isFinite(d)?Math.max(0,d-u):Ip,g=Number.isFinite(f)?Math.max(0,Math.floor(f)):Ip;if(g=Math.min(g,Ip,p),!(g>0)){let oe=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:oe,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let oe=Math.min(g,m),$=c.fromAny(e.costAtLevel(u)),q=s,Z=0;for(;Z<oe;){$=c.fromAny(e.costAtLevel(u+Z));let ge=q.add($);if(ge.cmp(n)>0)break;q=ge,Z+=1}let le=u+Z,fe=Number.isFinite(d)&&le>=d,L=tu(Z);if(Z<oe||fe||g<=Z){let ge=fe?s:c.fromAny(e.costAtLevel(le));return{count:L,spent:q,nextPrice:ge,numericCount:Z}}let Y=(()=>{try{return Yo(t??u,u).add(L)}catch{return u+Z}})(),ce=Za(e,Y,n.sub(q),g-Z,r),he=ce?.count instanceof c?ce.count:tu(ce?.numericCount??0),J=L.add(he),re=(ce?.spent??s).add(q);return{count:J,spent:re,nextPrice:ce?.nextPrice??s,numericCount:Z+(ce?.numericCount??0)}}let y=$e(n),h=i.ratioLog10,b=i.ratioMinus1,x=c.fromAny(e.costAtLevel(u)),E=i.baseLog10+u*h;if(b>0&&(!Number.isFinite(y)||Math.abs(y)>1e6&&Math.abs(E)>1e6)){let oe=c.fromAny(e.costAtLevel(u));if(n.cmp(oe)<0)return{count:s,spent:s,nextPrice:oe,numericCount:0};let $=Number.isFinite(g)?Math.max(1,Math.floor(g)):Number.MAX_VALUE,q=1,Z=1;for(;Z<$;){let he=Vo(e,u,Z);if(Ae(he).cmp(n)<=0){let re=Z*2;if(!Number.isFinite(re)||re<=Z){Z=$;break}q=Z,Z=Math.min(re,$)}else break}let le=0;for(;q<Z&&le<256;){let he=Math.max(q+1,Math.floor((q+Z+1)/2)),J=Vo(e,u,he);Ae(J).cmp(n)<=0?q=he:Z=he-1,le++}let fe=Math.max(1,q),L=tu(fe),Y=s,ce=s;if(!a)if(Y=su(e,u,fe),Number.isFinite(d)){let he=Math.max(0,Math.floor(d-Math.min(u,d)));fe>=he?ce=s:ce=Ae(E+fe*h)}else ce=Ae(E+fe*h);return{count:L,spent:Y,nextPrice:ce,numericCount:fe}}if(n.cmp(x)<0)return{count:s,spent:s,nextPrice:x,numericCount:0};let A=!1,z=null,k=null;try{z=c.fromAny(e.costAtLevel(u+1))}catch{}try{let oe=Math.min(Number.isFinite(d)?Math.max(u+1,Math.floor(d)):u+32,u+32);k=c.fromAny(e.costAtLevel(oe))}catch{}!A&&!(i.ratioMinus1>0)&&(A=!0),z&&k&&(A=z.cmp(x)===0&&k.cmp(x)===0),!A&&!(i.ratioMinus1>0)&&(A=!0);let U=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.MAX_VALUE;if(A){let oe=Yo(e.lvlCapBn??"Infinity","Infinity"),$=Yo(t??0,0),q=oe.isInfinite?.()?c.fromAny("Infinity"):oe.sub($).floorToInteger(),{count:Z,countBn:le,spent:fe,nextPrice:L}=Tp(x,n,q);return{count:le,spent:fe,nextPrice:L,numericCount:Z}}if(!(h>0)||!(b>0)){let oe=Yo(e.lvlCapBn??"Infinity","Infinity"),$=Yo(t??0,0),q=oe.isInfinite?.()?c.fromAny("Infinity"):oe.sub($).floorToInteger(),{count:Z,countBn:le,spent:fe,nextPrice:L}=Tp(x,n,q);return{count:le,spent:fe,nextPrice:L,numericCount:Z}}let M=Math.log10(b);if(!Number.isFinite(M))return{count:s,spent:s,nextPrice:x,numericCount:0};let R=Hw(y+M-E)/h;(!Number.isFinite(R)||R<0)&&(R=0);let _=Math.floor(Math.min(U,R));Number.isFinite(_)||(_=U),_<=0&&(_=1);let H=1e-7,j=Vo(e,u,_),ye=0,K=2048;for(;_>0&&(!Number.isFinite(j)||j>y+H)&&ye<K;){let oe=Number.isFinite(j)?Math.max(1,Math.ceil((j-y)/Math.max(h,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-oe));if($<_)_=$;else{let q=hv(_);if(!(q<_))break;_=q}j=_>0?Vo(e,u,_):Number.NEGATIVE_INFINITY,ye+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(x)>=0)_=1,j=$e(x);else return{count:s,spent:s,nextPrice:x,numericCount:0};if(_<U){let oe=L=>{let Y=L*2;return Number.isFinite(Y)?Y:Number.MAX_VALUE},$=_,q=Math.min(U,Math.max(_+1,oe(_))),Z=Vo(e,u,q);for(;$<q&&Number.isFinite(Z)&&Z<=y+H&&q<U;)$=q,q=Math.min(U,oe(q)),Z=Vo(e,u,q);let le=$,fe=q;for(let L=0;L<256&&le<fe;L+=1){let Y=Math.floor((le+fe+1)/2),ce=Vo(e,u,Y);Number.isFinite(ce)&&ce<=y+H?(le=Y,j=ce):fe=Y-1}_=le}let ne=null;if(!a){ne=su(e,u,_);let oe=0;for(;ne.cmp(n)>0&&_>0&&oe<K;){let $=Vw(_);if(!($<_))break;_=$,ne=su(e,u,_),oe+=1}if(_<=0)return{count:s,spent:s,nextPrice:x,numericCount:0};if(_<U&&oe<K)for(;_<U&&oe<K;){let $=u+_,q;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)q=c.fromAny(e.costAtLevel($));else{let le=E+_*h;q=Ae(le).floorToInteger()}}catch{break}let Z=ne.add(q);if(Z.cmp(n)>0)break;ne=Z,_+=1,oe+=1}}let pe=s,be=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(d)){let oe=Math.max(0,Math.floor(d-Math.min(u,d)));if(_>=oe)pe=s;else if(be){let $=Math.floor(u+_);pe=c.fromAny(e.costAtLevel($))}else{let $=E+_*h;pe=Ae($)}}else if(be){let oe=Math.floor(u+_);pe=c.fromAny(e.costAtLevel(oe))}else{let oe=E+_*h;pe=Ae(oe)}return{count:tu(_),spent:ne,nextPrice:pe,numericCount:_}}function Yw(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=$e(t),r=$e(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function Tp(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let d=BigInt(o)/BigInt(r),f=c.fromAny(d.toString());!n.isInfinite?.()&&f.cmp(n)>0&&(f=n);let p=e.mulBigNumInteger(f);return{count:kp(f),countBn:f,spent:p,nextPrice:e}}let i=$e(t),s=$e(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Ae(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:kp(l),countBn:l,spent:a,nextPrice:u}}function Ww(e,t,n,o){if(!n||o<=0)return{count:0};let r=$e(t),i=$e(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let y=0;y<64&&a<u;y+=1){let h=Math.max(0,Math.floor((a+u+1)/2));i+h*n.ratioLog-n.logDenom<=r?a=h:u=h-1}let d=Math.min(a,o);if(d<=0)return{count:0};let f=i+d*n.ratioLog-n.logDenom;if(f>r)return{count:0};let p=i+d*n.ratioLog,g=Ae(f),m=Ae(p);return{count:d,spent:g,nextPrice:m,spentLog:f,nextPriceLog:p}}function Yo(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function kp(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Lr(e){return Q(e instanceof c?e:c.fromAny(e??0))}function gt(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=$e(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return Q(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):Q(c.fromAny(t))}catch{return"1"}}function Ss(e){return Lr(e).replace(/<[^>]*>/g,"")}function uu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Is(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=uu(n??t??0),s=uu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Fe(i),newLevel:Number.isFinite(o)?o:Fe(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Pt(e,t){return Xn(e,t)}function gv(e,t=v()){return t==null?null:`ccc:upgrades:${e}:${t}`}function ai(e,t,n=v()){if(n==null)return null;let o=Wo(e),r=Dp(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function zw(){Jy.forEach(e=>{try{e?.()}catch{}}),Jy.clear()}function Qy(e){zw()}function Kw(e,t){if(typeof localStorage>"u")return;let n=gv(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=ai(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}}),console.log(`[UpgradeMigration] Migrated ${i} upgrades for area ${e} slot ${t}`)}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function jw(e,t,n){Kw(e,n);let o=ai(e,t,n);if(!o)return null;if(ys&&za.has(o))try{let r=za.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(xr.has(o))try{let r=xr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function bs(e,t,n,o=v(),r={}){let i=ai(e,t,o);if(i){if(ys){za.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){xr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}xr.has(i)&&xr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{rt(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function Zw(e,t,n=v()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&bs(e,o.id,o,n)})}function Dp(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return Yn(t.id);let n=Yn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=zo(n);if(o){let r=xp.get(o);if(r){let i=Wo(e);if(!i||Wo(r.area)===i)return Yn(r.id)}}}return n}function yv(e,t,n=v()){let o=n==null?"null":String(n),r=Dp(e,t);return`${o}:${e}:${Yn(r)}`}function lo(e,t){let n=Dp(e,t),o=Yn(n),r=v(),i=yv(e,o,r),s=Ap.get(i);if(s)return s;let l=_s(e,o),a=jw(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,bs(e,o,a,r)}let d=a.lvl,f=a.nextCost,p=a.nextCostLvl;a.lvl=vs(a.lvl),a.nextCost=vs(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=vs(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==d||a.nextCost!==f||a.nextCostLvl!==p)&&(u=!0);let g=0;l?.upgType==="HM"&&(g=xs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),pu(l,g));let m=ct(a.lvl),y=Fe(m);try{let C=l?.lvlCapBn??c.fromAny("Infinity");if(!C.isInfinite?.()&&m.cmp(C)>0){let A=C.clone?.()??C;y=Fe(A);let z=A.toStorage();a.lvl=z,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=z,bs(e,o,a,r)}}catch{}let h=null;try{h=m?.toStorage?.()??ct(y).toStorage()}catch{}h&&a.lvl!==h&&(a.lvl=h,u=!0);let b=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,x=!b||b!==h,E=null;if(!x&&a.nextCost!=null)try{E=c.fromAny(a.nextCost)}catch{E=null,x=!0}if(!E||x){if(l)try{E=c.fromAny(l.costAtLevel(y))}catch{E=c.fromInt(0)}else E=c.fromInt(0);try{a.nextCost=E.toStorage(),h?a.nextCostLvl=h:delete a.nextCostLvl,u=!0}catch{}}if(u)try{bs(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let C=c.fromAny("Infinity");l.lvlCapBn=C,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Lr(C),l.lvlCapFmtText=Ss(C)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:y,lvlBn:m,nextCostBn:E,slot:r,hmEvolutions:g},Ap.set(i,s),s}function _r(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??v();if(!n||o==null)return;let r=Yn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??ct(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Fe(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??ct(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=ct(e.lvl??0).toStorage()}i.lvl=vs(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=vs(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=xs(e.hmEvolutions)),bs(n,r,i,o,t),e.slot=o}function Ko(e,t,n=v()){Ap.delete(yv(e,t,n))}function _t(e,t){return lo(e,t).lvl}function Np(e,t){return lo(e,t).hmEvolutions??0}function vv(e,t){if(!t)return{locked:!1};let n=av(),o=n?un():c.fromInt(0),r=n?Fe(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let d=Uw(e,t),f="Unlock the XP system to reveal this upgrade",p=lv();if(d)if(p)i={locked:!0,iconOverride:cn,titleOverride:Jt,descOverride:f,reason:f,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let g='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:_n,titleOverride:Vn,descOverride:g,reason:g,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:_n,titleOverride:Vn,descOverride:f,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=Sp({locked:!1},i);if(typeof t.computeLockState=="function")try{let d={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,baseLocked:s.locked,getUpgradeLevel(p){return _t(e,p)}},f=t.computeLockState(d);s=Sp(s,f)}catch{}let l=v(),a=Es(e,t),u=a?lu(e,t,l):!1;if(a){let d=_p(l),f=fu(l),p=Op(l),g=a.replace(/_/g,"-"),m=ja(e,t),y=!1;hs(d,g,a)&&(y=!0),m&&hs(d,m,a)&&(y=!0),y&&Cp(d,l);let h=!1;hs(f,g,a)&&(h=!0),m&&hs(f,m,a)&&(h=!0),h&&du(f,l);let b=!1;hs(p,g,a)&&(b=!0),m&&hs(p,m,a)&&(b=!0),b&&Pp(p,l)}if(s.locked){let d=!!s.hidden;s.iconOverride||(s.iconOverride=_n),d?s.titleOverride||(s.titleOverride=Jt):(!s.titleOverride||s.titleOverride===Jt)&&(s.titleOverride=Vn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:d&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===_n||s.iconOverride===cn)&&delete s.iconOverride,(s.titleOverride===Jt||s.titleOverride===Vn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=_n),a){let d=_p(l),f=d.upgrades[a]||{},p=zo(t?.tie??t?.tieKey),g=p&&nv.has(p),m=p&&Rp.has(p),y=f.status||"locked";if(lu(e,t,l))y="unlocked";else if(sv(e,t,l)&&y==="locked"){let M=!1;try{M=Fe(un())>=31}catch{}let F=!1;try{F=Fe(un())>=101}catch{}g&&!M||m&&!F?y="locked":y="mysterious"}let h=eu(y),b=bp(s),x=eu(b),E=()=>{s.locked=!0;let M=f.snapshot;M&&typeof M=="object"&&(s=Sp(s,M)),s.iconOverride=cn,s.titleOverride=Jt;let F=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=F,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};h>x&&(y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):y==="mysterious"&&E(),b=bp(s),x=eu(b));let C=!1,A=f&&typeof f=="object"&&typeof f.status=="string"?f.status:"locked",z=g,k=!1;try{k=Fe(un())>=31}catch{}let U=!1;try{U=Fe(un())>=101}catch{}if((z&&!k&&A==="mysterious"||m&&!U&&A==="mysterious")&&(A="locked"),(!f||typeof f!="object"||Object.keys(f).length!==1||f.status!==A)&&(d.upgrades[a]={status:A},C=!0),x>h){if(f.status=b,d.upgrades[a]={status:f.status},C=!0,y=b,h=x,b==="unlocked")si(e,t,l);else if(b==="mysterious"){let M=!1;try{M=Fe(un())>=31}catch{}(!g||M)&&Mp(e,t,l)}}y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===_n||s.iconOverride===cn)&&delete s.iconOverride,(s.titleOverride===Jt||s.titleOverride===Vn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,f.status!=="unlocked"&&(d.upgrades[a]={status:"unlocked"},C=!0),si(e,t,l)):y==="mysterious"&&b!=="mysterious"&&(E(),b=bp(s),x=eu(b)),C&&Cp(d,l)}return s}function Ja(e,t){return!!vv(e,t).locked}function $p(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:cu(e),{capBn:r,cap:i}=uv(o);try{return t?.cmp?.(r)>=0}catch{}let s=Fe(t);return Number.isFinite(s)&&s>=i}function En(e,t){let n=lo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():ct(n.lvl??0)}function bv(e,t){let n=lo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??ct(n.lvl??0),i=Fe(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function Xo(e,t,n,o=!0,r={}){let i=lo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,pu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,d=uu(i.lvlBn??ct(i.lvl??0)),f=ct(n);f.isInfinite?.()&&(f=c.fromAny("Infinity"));let p=f;try{s&&ev(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=ct(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=ct(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let g=Fe(p);if(!s)return i.lvl=g,i.lvlBn=p,i.nextCostBn=c.fromInt(0),_r(i),Ko(e,t),ao(),i.lvl;i.lvl=g,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(g))}catch{i.nextCostBn=c.fromInt(0)}return _r(i,{deferSave:r?.deferSave}),Ko(e,t),Is(s,u,d,i.lvl,i.lvlBn),ao(),i.lvl}function Bt(e){return mu.filter(t=>t.area===e)}function _s(e,t){let n=Wo(e),o=Yn(t),r=zo(typeof o=="string"?o:t);return mu.find(i=>n&&Wo(i.area)!==n?!1:!!(Yn(i.id)===o||r&&i.tieKey===r))||null}function qo(e,t){let n=typeof t=="object"&&t?t:_s(e,t);return vv(e,n)}function Jw(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function _c(e){return e?Jw(e.icon):""}function Qw(e,t){let n=_s(e,t),o=En(e,t),r=Fe(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Aa(e,t){let n=lo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Ja(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??ct(r),s=uu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(ev(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),_r(n),Ko(e,t),ao(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,d=u?P[u]:null,f=c.fromInt(0);if(d&&!a.isZero?.()){let g=d.value;if((g instanceof c?g:c.fromAny(g??0)).cmp(a)<0)return{bought:0,spent:0};f=a.clone?.()??c.fromAny(a),d.sub(f)}else{if(!a.isZero?.())return{bought:0,spent:0};f=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=Fe(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(f,n.lvl):o.costAtLevel(n.lvl)),_r(n),Ko(e,t),Is(o,r,s,n.lvl,n.lvlBn),ao(),{bought:1,spent:f}}function Id(e,t){let n=lo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??ct(n.lvl);if(!$p(o,r,n.hmEvolutions))return{evolved:!1};let i=xs(n.hmEvolutions)+1;n.hmEvolutions=i,pu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return _r(n),Ko(e,t),Is(o,n.lvl,r,n.lvl,r),ao(),{evolved:!0}}function Lc(e,t){let n=lo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ja(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??ct(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=P[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Aa(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let b=i.clone?.()??ct(i),x=Fe(b),E=b.toStorage?.(),C;if(o.upgType==="HM"){if(C=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let z=c.fromAny("Infinity");o.lvlCapBn=z,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Lr(z),o.lvlCapFmtText=Ss(z)}}else{let z=o.lvlCapBn?.clone?.()??Yo(o.lvlCap??1/0,1/0);C=z?.clone?.()??z}let A=C.sub(b);if(A.isZero?.()){let z=Dw(C,b);z.isZero?.()||(A=z)}if(A.isZero?.()){let z=C.toStorage?.();if(E&&z&&E!==z)if(C.isInfinite?.())try{A=c.fromAny("Infinity")}catch{A=c.fromInt(1)}else A=c.fromInt(1)}return n.lvlBn=C.clone?.()??C,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Fe(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),P[o.costType].set(u),_r(n),Ko(e,t),Is(o,x,b,n.lvl,n.lvlBn),ao(),{bought:A,spent:c.fromInt(0)}}let d=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(d)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(s)?Math.max(0,s-r):ws;if(!(f>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=Za(o,i,u,f),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),y=u.sub(m);P[o.costType].set(y);let h=i.add(g);return n.lvlBn=h,n.lvl=Fe(h),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),_r(n),Ko(e,t),Is(o,r,i,n.lvl,n.lvlBn),ao(),{bought:g,spent:m}}function Na(e,t,n){let o=lo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Ja(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??ct(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=P[r.costType]?.value,d=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(d.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Fe(n):void 0,g=Number.isFinite(f)?Number.isFinite(p)?Math.min(f,p):f:p,m=Za(r,s,d,g),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let h=m.spent??c.fromInt(0),b=d.sub(h);P[r.costType].set(b);let x=s.add(y);return o.lvlBn=x,o.lvl=Fe(x),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),_r(o),Ko(e,t),Is(r,i,s,o.lvl,o.lvlBn),ao(),{bought:y,spent:h}}function ei(e,t,n,o=ws,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=Za(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function ao(){if(ys){Ep=!0,yp();return}yp(),Yy()}function Dn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),xe.STARTER_COVE}function Ra(e,t){let n=_s(e,t);if(!n)return null;let o=En(e,t),r=Fe(o),i=Lr(o),s=Ss(o),l=n.lvlCapBn??Yo(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Lr(l),u=n.lvlCapFmtText??Ss(l),d=r<n.lvlCap?bv(e,t):c.fromInt(0),f=Lr(d),p=P[n.costType]?.value,g=p instanceof c?p:c.fromAny(p??0),m=qo(e,t),y=!!m.locked,h=m.titleOverride??n.title,b=m.descOverride??n.desc;if(e===Ke&&Yn(t)===Hr){let A=bn(),z=!1;if(A===1/0||typeof A=="string"&&A==="Infinity"?z=!0:typeof A=="bigint"?z=A>=2n:typeof A=="number"&&(z=A>=2),z&&b){let k=10,U=!1,M=bn();if(M===1/0||typeof M=="string"&&M==="Infinity"||M===Number.POSITIVE_INFINITY?U=!0:typeof M=="bigint"?U=M>=8n:typeof M=="number"&&(U=M>=8),U){let F=Ot();k=Math.pow(10,F)}if(Math.abs(k-1)>1e-4){let F="10";k!==10&&(F=gt(k)),b=b.replace("Generates the equivalent of picking up a Coin on an interval",`Generates the equivalent of picking up ${F} Coins (Surge 2!) on an interval`)}}}let x=Up(n,e),E="";typeof n.effectSummary=="function"&&!(y&&m.hideEffect)&&(E=n.effectSummary(r),typeof E=="string"&&(E=E.trim()));let C=m.iconOverride??_c(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:d,nextPriceFmt:f,have:g,haveFmt:P[n.costType]?.fmt(g)??String(g),effect:E,iconUrl:C,lockState:m,locked:y,areaKey:e,hmMilestones:x,displayTitle:h,displayDesc:b,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?Np(e,t):0,hmReadyToEvolve:n.upgType==="HM"?$p(n,o,Np(e,t)):!1,hmNextMilestone:n.upgType==="HM"?dv(n,o,e):null}}function eE(e,t){let n=_s(e,t);if(!n||n.upgType!=="HM")return null;let o=En(e,t);return dv(n,o,e)}function tE(e){return Ae($e(e??0))}function bd(e,t){let n=lo(e,t),o=n.upg;if(!o)return{bought:0};let r=gv(e,n.slot);if(rn(r))return{bought:0};let i=ai(e,t,n.slot);if(rn(i))return{bought:0};if(Ja(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??ct(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&$p(o,l,n.hmEvolutions))return{bought:0};let d=P[o.costType]?.value,f=d instanceof c?d.clone?.()??c.fromAny(d):c.fromAny(d??0);if(f.isZero?.())return{bought:0};let p=Za(o,l,f,ws),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:0};let m=l.add(g);return Tw(),Xo(e,t,m,!0,{deferSave:!0}),{bought:g}}function wd(e,t){let n=lo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ja(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??ct(n.lvl),i=Fe(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=P[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=ei(o,r,a,c.fromAny("Infinity")),d=u.numericCount;if(d<=0)return{bought:0,spent:c.fromInt(0)};let f=g=>{if(g<=0)return!0;let m=su(o,i,g-1),y=a.sub(m),h=i+g-1,b=c.fromAny(o.costAtLevel(h)),x=y.div(10);return b.cmp(x)<=0},p=0;if(d<2e3){let g=u.spent,m=d;for(;m>0;){let y=i+m-1,h=c.fromAny(o.costAtLevel(y)),b=g.sub(h),E=a.sub(b).div(10);if(h.cmp(E)<=0){p=m;break}g=b,m--}}else{let g=0,m=d;for(;g<m;){let y=Math.ceil((g+m)/2);f(y)?g=y:m=y-1}p=g}return p<=0?{bought:0,spent:c.fromInt(0)}:Na(e,t,p)}var ws,Dt,OC,Mw,au,xe,ys,jy,za,Ep,xr,Zy,Aw,vp,we,tv,Nw,_n,cn,Jt,Vn,nv,Rp,Rw,Ow,Pw,Bw,ov,rv,iv,Fw,nu,ou,ru,xp,PC,Lp,Qc,Vt,gs,$w,Ip,mv,wp,Xw,mu,Ap,Jy,yn=De(()=>{bt();xt();Yt();Zn();So();vo();no();Xr();Ky();ws=c.fromAny("Infinity"),Dt=1e3,OC=c.fromInt(1e3),Mw=3,au="",xe={STARTER_COVE:"starter_cove",AUTOMATION:Ke},ys=!1,jy=new Map,za=new Map,Ep=!1,xr=new Map,Zy=null;Aw=308;vp=1024;we={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},tv=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],Nw={[xe.STARTER_COVE]:tv},_n="img/misc/locked.webp",cn="img/misc/mysterious.webp",Jt="Hidden Upgrade",Vn="Locked Upgrade",nv=new Set([we.COIN_VALUE_II,we.XP_VALUE_II,we.MP_VALUE_I,we.MAGNET,we.ENDLESS_XP]),Rp=new Set([we.COIN_VALUE_III,we.XP_VALUE_III,we.MP_VALUE_II,we.FASTER_COINS_III,we.ENDLESS_MP]),Rw=new Set([we.UNLOCK_XP,we.UNLOCK_FORGE,we.UNLOCK_INFUSE,we.UNLOCK_SURGE,...nv,...Rp]),Ow=new Set([we.FASTER_COINS_II,we.COIN_VALUE_I,we.BOOK_VALUE_I,we.XP_VALUE_I]),Pw=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),Bw="ccc:merchantMet",ov="ccc:shop:reveals",rv="ccc:shop:permaUnlocks",iv="ccc:shop:permaMyst",Fw={locked:0,mysterious:1,unlocked:2},nu=new Map,ou=new Map,ru=new Map,xp=new Map,PC=zo(we.BOOK_VALUE_I),Lp=c,Qc=e=>Lp.fromAny(e??0),Vt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Qc(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Lp.fromInt(1).add(r.mulDecimal(n))}catch{let i=$e(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Ae(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Qc(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Lp.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Qc(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Qc(i);if(o>0){let l=$e(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let d=Math.pow(n,a);if(Number.isFinite(d))return d}return Ae(u)}}catch{}try{let l=Fe(s),a=o*l;return Ae(a)}catch{return c.fromInt(1)}}}};gs=Math.log(10);$w={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=cu(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=cu(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};Ip=(()=>{try{let e=Fe(ws);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),mv=new ArrayBuffer(8),wp=new Float64Array(mv),Xw=new BigInt64Array(mv);mu=[{area:xe.STARTER_COVE,id:1,tie:we.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:2,tie:we.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:ln,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Fr()}catch{}}},{area:xe.STARTER_COVE,id:3,tie:we.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:4,tie:we.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(.5),onLevelChange(){try{gn()}catch{}}},{area:xe.STARTER_COVE,id:5,tie:we.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>iu(e)>0?2:1,onLevelChange({newLevel:e}){Wa(e)}},{area:xe.STARTER_COVE,id:6,tie:we.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${gt(t)}x`},effectMultiplier:Vt.addFlatPerLevel(2)},{area:xe.STARTER_COVE,id:7,tie:we.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:ln,onLevelChange({newLevel:e}){if((e??0)>=1)try{pp()}catch{}}},{area:xe.STARTER_COVE,id:8,tie:we.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${Q(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(10),onLevelChange(){try{gn()}catch{}}},{area:xe.STARTER_COVE,id:9,tie:we.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:10,tie:we.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:11,tie:we.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=iu(e),n=gt(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>iu(e)},{area:xe.STARTER_COVE,id:12,tie:we.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Dt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return Xn(this,e)},nextCostAfter(e,t){return Xn(this,t)},computeLockState:ln,effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Er(this,t,this.area),r=Et(n,o);return`XP value bonus: ${gt(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:13,tie:we.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:ln,onLevelChange({newLevel:e}){if((e??0)>=1)try{mp()}catch{}}},{area:xe.STARTER_COVE,id:14,tie:we.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${Q(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(1e3)},{area:xe.STARTER_COVE,id:15,tie:we.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:16,tie:we.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:17,tie:we.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Pt(this,e)},nextCostAfter(e,t){return Pt(this,t)},computeLockState:ln,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${gt(t)}x`},effectMultiplier:Vt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:18,tie:we.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Dt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return Xn(this,e)},nextCostAfter(e,t){return Xn(this,t)},computeLockState:ln,effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Er(this,t,this.area),r=Et(n,o);return`MP value bonus: ${gt(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:19,tie:we.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:ln,onLevelChange({newLevel:e}){if((e??0)>=1)try{hp()}catch{}}},{area:xe.STARTER_COVE,id:20,tie:we.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Dt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return Xn(this,e)},nextCostAfter(e,t){return Xn(this,t)},computeLockState(e){let t=bn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=un();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:cn,titleOverride:Jt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Vn,descOverride:"Locked"}},onLevelChange(){try{gn()}catch{}},effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Er(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${gt(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:21,tie:we.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Dt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return Xn(this,e)},nextCostAfter(e,t){return Xn(this,t)},computeLockState(e){let t=bn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=un();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:cn,titleOverride:Jt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Vn,descOverride:"Locked"}},onLevelChange(){try{gn()}catch{}},effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Er(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${gt(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:22,tie:we.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Dt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return Xn(this,e)},nextCostAfter(e,t){return Xn(this,t)},computeLockState(e){let t=bn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=un();o=Fe(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:cn,titleOverride:Jt,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Vn,descOverride:"Locked"}},onLevelChange(){try{gn()}catch{}},effectSummary(e){let t=ct(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Er(this,t,this.area),r=Et(n,o);return`Coin value bonus: ${gt(r)}x`},effectMultiplier:Vt.powPerLevel(1.1)},...Nh];for(let e of mu){let t=zo(e.tie??e.tieKey);t&&!xp.has(t)&&xp.set(t,e),e.baseCost=Yo(e.baseCost??0,0),e.baseCostBn=e.baseCost,e.numUpgEvolutions=xs(e.numUpgEvolutions),e.upgType==="HM"?pu(e,e.numUpgEvolutions):(e.lvlCapBn=Yo(e.lvlCap??1/0,1/0),e.lvlCap=kp(e.lvlCapBn),e.lvlCapFmtHtml=Lr(e.lvlCapBn),e.lvlCapFmtText=Ss(e.lvlCapBn)),e.bulkMeta=Yw(e),Ls(e)}Ap=new Map;Jy=new Map;typeof window<"u"&&(Qy(v()),window.addEventListener("saveSlot:change",()=>{Qy(v()),ao()}));zy()});var zv={};vt(zv,{applyAllCurrencyOverridesForActiveSlot:()=>al,applyStatMultiplierOverride:()=>Fn,getDebugCurrencyMultiplierOverride:()=>tl,getDebugStatMultiplierOverride:()=>yE,setDebugCurrencyMultiplierOverride:()=>Uv,setDebugPanelAccess:()=>JE,setDebugStatMultiplierOverride:()=>Cn});function sl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function sE(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function fn(e){typeof e=="function"&&Hp.push(e)}function wu(){return{sections:new Set,subsections:new Set}}function aE(){let e=document.getElementById(ol);if(!e)return wu();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function lE(e){let{sections:t,subsections:n}=Tv??wu();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function Nv(){Hp.forEach(e=>{try{e?.()}catch{}}),Hp=[],zp.length=0}function Ft(e){!e||typeof e.refresh!="function"||zp.push(e)}function lt(e){zp.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function cE(){if(typeof window>"u")return;let e=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();lt(b=>b.type==="currency"&&b.key===m&&b.slot===h)};window.addEventListener("currency:change",e,{passive:!0}),fn(()=>window.removeEventListener("currency:change",e));let t=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();lt(b=>b.type==="currency-mult"&&b.key===m&&b.slot===h)};window.addEventListener("currency:multiplier",t,{passive:!0}),fn(()=>window.removeEventListener("currency:multiplier",t));let n=g=>{let{slot:m,changeType:y,unlocked:h}=g?.detail??{},b=m??v();lt(x=>x.type==="xp"&&x.slot===b),lt(x=>x.type==="stat-mult"&&x.key==="xp"&&x.slot===b),(y==="unlock"||typeof h=="boolean")&&lt(x=>x.type==="unlock"&&(x.slot==null||x.slot===b))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),fn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=g=>{let{changeType:m,slot:y}=g?.detail??{},h=y??v();lt(b=>b.type==="mutation"&&b.slot===h),lt(b=>b.type==="stat-mult"&&b.key==="mutation"&&b.slot===h),m==="unlock"&&lt(b=>b.type==="unlock"&&(b.slot==null||b.slot===h))};window.addEventListener("mutation:change",o,{passive:!0}),fn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let g=v();lt(m=>m.type==="upgrade"&&m.slot===g),lt(m=>m.type==="currency-mult"&&m.slot===g),lt(m=>m.type==="stat-mult"&&m.slot===g)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),fn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let g=v();lt(m=>m.slot===g)};window.addEventListener("saveSlot:change",i,{passive:!0}),fn(()=>window.removeEventListener("saveSlot:change",i));let s=g=>{let{slot:m,key:y}=g?.detail??{},h=m??v();lt(b=>b.type==="unlock"&&(b.slot==null||b.slot===h)&&(b.key==null||b.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),fn(()=>window.removeEventListener("unlock:change",s));let l=g=>{let{slot:m}=g?.detail??{},y=m??v();lt(h=>h.type==="workshop-level"&&h.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),fn(()=>window.removeEventListener("workshop:change",l));let a=g=>{let{slot:m}=g?.detail??{},y=m??v();lt(h=>h.type==="surge-level"&&h.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),fn(()=>window.removeEventListener("surge:level:change",a));let u=g=>{let{slot:m}=g?.detail??{},y=m??v();lt(h=>h.type==="tsunami-nerf"&&(h.slot==null||h.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),fn(()=>window.removeEventListener("surge:nerf:change",u));let d=g=>{let{slot:m}=g?.detail??{},y=m??v();lt(h=>h.type==="lab-level"&&(h.slot==null||h.slot===y)),lt(h=>h.type==="stat-mult"&&h.key==="rp"&&(h.slot==null||h.slot===y))};window.addEventListener("lab:level:change",d,{passive:!0}),fn(()=>window.removeEventListener("lab:level:change",d));let f=g=>{let{id:m,level:y}=g?.detail??{},h=v();lt(b=>b.type==="lab-node-level"&&b.slot===h&&b.id===m),m===1&&lt(b=>b.type==="tsunami-nerf"&&(b.slot==null||b.slot===h))};window.addEventListener("lab:node:change",f,{passive:!0}),fn(()=>window.removeEventListener("lab:node:change",f));let p=g=>{let{id:m,rp:y}=g?.detail??{},h=v();lt(b=>b.type==="lab-node-rp"&&b.slot===h&&b.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),fn(()=>window.removeEventListener("lab:node:rp",p))}function Eu(){return[{key:xe.STARTER_COVE,title:"The Cove",currencies:[{key:Me.COINS,label:"Coins"},{key:Me.BOOKS,label:"Books"},{key:Me.GOLD,label:"Gold"},{key:Me.MAGIC,label:"Magic"},{key:Me.GEARS,label:"Gears"},{key:Me.WAVES,label:"Waves"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function Rv(){if(document.getElementById(hu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=hu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=hu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=hu,document.head.appendChild(n)}function Vp(){let e=document.getElementById(Mv);e&&e.remove()}function uE(){return di&&je&&v()!=null&&!sl()&&sE()}function fE(e){e?.detail?.visible&&xo(),_u()}function yu(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${kv++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Wn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${Av++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Mt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Kp(e,t=v()){let n=t??v();return n==null?null:`${ht.CURRENCY[e]}:${n}`}function el(e,t=v()){let n=t??v();if(n==null)return c.fromInt(0);let o=P?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Zs(n,e)}catch{return c.fromInt(0)}}function dE(e,t,n=v()){let o=n??v(),r=el(e,o);if(o==null||o!==v())return{previous:r,next:r};let i=Kp(e,o),s=i&&co(i);s&&As(i);let l=r;try{pn(o),l=Ei(e,t,{previous:r})??r,i&&rt(i)}catch{}finally{s&&hi(i)}return lt(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function zn(e,t){return`${e??"null"}::${t}`}function jp(e,t){return rl.get(zn(e,t))??null}function pE(e,t=v()){let n=t??v();return!e||n==null?null:`${ht.MULTIPLIER[e]}:${n}`}function mE(e,t=v()){let n=zn(t,e);rl.delete(n),Ts.delete(n),lt(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function Zp(e,t){let n=!xu(t,e),o=zn(e,t),r=nl.get(o);if(!n&&r)return r;let i=hE(t,e);return i?(nl.set(o,i),i):(n&&nl.delete(o),null)}function Ov(e,t){lt(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function Pv(e,t=v()){let n=mi(e,t);if(nl.delete(zn(t,e)),li.delete(zn(t,e)),!(!n||typeof localStorage>"u")&&!co(n)){try{localStorage.removeItem(n)}catch{}Ov(e,t)}}function xu(e,t=v()){return co(mi(e,t))}function Bv(e,t){return xu(t,e)?Zp(e,t):null}function Mn(e,t=v()){let n=pi(e);return Lu(e,t,n)??n}function mi(e,t=v()){if(!e)return null;let n=t??v();return n==null?null:`${nE}:${e}:${n}`}function pi(e){try{if(e==="xp"){let t=Ul();if(t)return t}else if(e==="mutation"){let t=Mu?.();if(t)return t;let n=Cu();if(n)return n}else if(e==="spawnRate"){let t=Ji(xe.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return jl()}catch{}return c.fromInt(1)}function hE(e,t=v()){let n=mi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function gE(e,t,n){let o=mi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=co(o),s=i&&Ms?Ms:localStorage.setItem.bind(localStorage);i&&!Ms&&As(o),s(o,r.toStorage?.()??String(r)),i&&!Ms&&hi(o)}catch{}}function Jp(e,t=v()){if(t==null)return;let n=jp(t,e);if(!n||t!==v())return;let o=zn(t,e);if(!bu.has(o)){bu.add(o);try{let r=P?.[e]?.mult?.get?.();Mt(r,n)||P?.[e]?.mult?.set?.(n)}catch{}finally{bu.delete(o)}}}function Fv(){if(!(Ev||typeof window>"u")){Ev=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??v(),i=zn(r,t);if(!r||!rl.has(i)||bu.has(i))return;let s=Ts.get(i),l=jp(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let d=u.div(a),f=d.sig===1n&&d.e===0&&d._eOffset===0n?1:null,p=l.mulBigNumInteger(d);rl.set(i,p)}}catch{}Ts.set(i,o)}else o&&Ts.set(i,o);Jp(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{al()},{passive:!0})}catch{}}}function al(){let e=v();e!=null&&Object.values(Me).forEach(t=>{Jp(t,e)})}function Uv(e,t,n=v()){if(!e||n==null)return null;Fv();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=zn(n,e);if(rl.set(r,o),!Ts.has(r)){let i=P?.[e]?.mult?.get?.();Ts.set(r,i)}return Jp(e,n),o}function tl(e,t=v()){return!e||t==null?null:jp(t,e)}function Cn(e,t,n=v()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return nl.set(zn(n,e),o),li.set(zn(n,e),pi(e)),gE(e,n,o),Ov(e,n),o}function yE(e,t=v()){return!e||t==null?null:Zp(t,e)}function Fn(e,t,n=v()){let o=pi(e),r=Lu(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Mt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=zn(n,e),l=li.get(s),a=xu(e,n)&&l?l:o,u=null;try{let d=c.fromAny(r),f=c.fromAny(a);f.isZero()||(u=d.div(f))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function Lu(e,t,n){let o=Zp(t,e),r=zn(t,e);if(!o)return li.delete(r),null;let i=li.get(r),s=xu(e,t);if(!i)li.set(r,n);else if(!Mt(i,n))return s?(li.set(r,n),o):(Pv(e,t),null);return o}function vE(){if(!(Iv||typeof localStorage>"u")){Iv=!0;try{Ms=localStorage.setItem.bind(localStorage),wv=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ks.has(e))return Ms(e,t)},localStorage.removeItem=e=>{if(!ks.has(e))return wv(e)}}catch{}}}function co(e){return e!=null&&ks.has(e)}function hi(e){e&&(vE(),ks.add(e))}function As(e){e&&ks.delete(e)}function bE(e){return e?co(e)?(As(e),!1):(hi(e),!0):!1}function SE(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=co(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(bE(e),typeof t=="function")try{t(co(e))}catch{}o()}),o(),{button:n,refresh:o}}function IE(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>co(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>co(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?As(u):hi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function wE(){let e=document.getElementById(ol);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function EE(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{co(r)&&(o.push(r),As(r))});try{return t?.()}finally{o.forEach(r=>hi(r))}}function xE(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function Qp(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Yp(e,t){e.classList.toggle("debug-invalid",!t)}function Ze(){let e=v();try{pn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function Dv(e=v()){return e==null?null:`${oE}:${e}`}function $v(e=v()){let t=Dv(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function qv(e,t=v()){let n=Dv(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,Xp);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function LE(e,t=v()){let n=$v(t);return n.unshift(e),n.length>Xp&&(n.length=Xp),qv(n,t),n}function Je(e){let t=v();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};LE(o,t),em()}function em(){if(!Cs)return;let e=$v();if(e.length===0){Cs.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",Cs.appendChild(t);return}Cs.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function Gv(e=v()){return e==null?null:`${Ca}:${e}`}function Hv(e,t=v()){let n=Gv(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function Xv(e=v()){let t=Gv(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function _E(e){if(e){if(Object.values(Me).includes(e.type)){try{e.type===Me.BOOKS?P.books.addWithMultiplier?.(e.amount)??P.books.add(e.amount):P[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function CE(){let e=v();if(e==null)return{completed:0};let t=Xv(e),n=0;return Object.entries(fc).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,_E(r.reward))}),Hv(t,e),{completed:n}}function ME(){let e=v();if(e==null)return{restored:0};let t=Xv(e),n=0;return Object.entries(fc).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),Hv(t,e),{restored:n}}function Qt(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let h=document.createElement("span");h.className="debug-panel-id",h.textContent=`(ID: ${o})`,a.appendChild(h)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let d=!1,f=null,p=!1,g=r?SE(r,{onToggle:i}):null,m=h=>{if(d){f=h;return}f=null,u.value=typeof s=="function"?s(h):xE(h)};l.appendChild(u),g&&l.appendChild(g.button);let y=()=>{let h=Qp(u.value);if(!h){Yp(u,!1);return}Yp(u,!0);let b=r&&co(r);b&&As(r);try{n(h,{input:u,setValue:m})}finally{b&&hi(r),g&&g.refresh()}};return u.addEventListener("focus",()=>{d=!0}),u.addEventListener("change",y),u.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),p=!0,y(),u.blur())}),u.addEventListener("blur",()=>{if(d=!1,p||y(),p=!1,f!=null){let h=f;f=null,m(h)}}),m(t),g&&g.refresh(),{row:l,input:u,setValue:m,isEditing:()=>d}}function TE({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let d=document.createElement("div");d.className="debug-unlock-text";let f=document.createElement("span");if(f.className="debug-unlock-title",f.textContent=e,d.appendChild(f),t){let y=document.createElement("span");y.className="debug-unlock-desc",y.textContent=`- ${t}`,d.appendChild(y)}s.appendChild(l),s.appendChild(d);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",y=>{l.contains(y.target)||p()});let g=!1,m=()=>{let y=!1;try{y=typeof n=="function"?!!n():!1}catch{}return a.checked=y,g=y,y};return a.addEventListener("change",()=>{let y=g,h=a.checked;try{h?o?.():r?.()}catch{}Ze();let b=m();y!==b&&Je(`Toggled ${e} [GOLD]${y?"True":"False"}[/GOLD] \u2192 [GOLD]${b?"True":"False"}[/GOLD]`)}),m(),Ft({type:"unlock",slot:i,refresh:m}),s}function kE(e){try{if(e instanceof c||typeof e?.toScientific=="function")return Q(e);let t=Number(e);return Number.isFinite(t)?Q(t):String(e??"\u2014")}catch{return"\u2014"}}function AE({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},d=!1;if(l.forEach(({config:f,el:p})=>{if(f.type==="select"){u[f.key]=p.value;return}let g=Qp(p.value),m=g instanceof c;if(Yp(p,m),!m){d=!0;return}u[f.key]=g}),d||typeof n!="function"){s.textContent="\u2014";return}try{let f=n(u);s.innerHTML=kE(f)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let d=Object.assign({type:"text",defaultValue:""},u);if(d.key)if(d.type==="select"){let f=document.createElement("select");f.className="debug-panel-input",(d.options||[]).forEach(({value:p,label:g})=>{let m=document.createElement("option");m.value=p,m.textContent=g??p,d.defaultValue!=null&&d.defaultValue===p&&(m.selected=!0),f.appendChild(m)}),f.addEventListener("change",a),i.appendChild(f),l.push({config:d,el:f})}else{let f=document.createElement("input");f.type="text",f.className="debug-panel-input",f.placeholder=d.label||"",f.value=d.defaultValue??"",f.addEventListener("input",a),f.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(f),l.push({config:d,el:f})}}),a(),o}function Cr({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return Qe()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Fr()}catch{}let d=ci.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),s!=null)try{let f=s.toStorage?.()??c.fromAny(s).toStorage(),p=ci.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(l!=null)try{let f=l.toStorage?.()??c.fromAny(l).toStorage(),p=ci.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Ai({forceReload:!0})}catch{}try{Bl({changeType:"debug-panel",slot:n})}catch{}try{lt()}catch{}}function Mr({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return at()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let f=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!f&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{il(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Xt()}catch{}try{wr()}catch{}let d=ui.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),e!=null)try{let f=e.toStorage?.()??c.fromAny(e).toStorage(),p=ui.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(t!=null)try{let f=t.toStorage?.()??c.fromAny(t).toStorage(),p=ui.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Xt({forceReload:!0})}catch{}try{tm({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{lt()}catch{}}function NE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=Kp(r.key,n),s=el(r.key,n),l=Qt(r.label,s,(a,{setValue:u})=>{let d=v();if(d==null)return;let f=el(r.key,d),{next:p}=dE(r.key,a,d);u(p),Mt(f,p)||(Ze(),Je(`Modified ${r.label} (${o}) ${Q(f)} \u2192 ${Q(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(el(r.key,v()))});Ft({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let a=el(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function RE(e,t){let n=v();if(n==null){let k=document.createElement("div");k.className="debug-panel-empty",k.textContent="Select a save slot to edit stats.",e.appendChild(k);return}let o="spawnRate",r=mi(o,n),i=Qt("Coin Spawn Rate",Mn(o,n),(k,{setValue:U})=>{let M=v();if(M==null)return;let F=Mn(o,M);try{Cn(o,k,M)}catch{}let R=Mn(o,M);U(R),Mt(F,R)||(Ze(),Je(`Modified Spawn Rate (${a}) ${Q(F)} \u2192 ${Q(R)}`))},{storageKey:r,onLockChange:k=>{let U=v();if(U!=null){if(k){if(Bv(U,o))return;try{Cn(o,pi(o),U)}catch{}}else Lu(o,U,pi(o));i.setValue(Mn(o,U))}}});Ft({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==v())return;let k=Mn(o,n);i.setValue(k)}}),Ft({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==v())return;let k=Mn(o,n);i.setValue(k)}}),e.appendChild(i.row);let s=Qe(),l=at(),a=t?.title??t?.key??"Unknown Area",u=ci.level(n),d=Qt("XP Level",s.xpLevel,(k,{setValue:U})=>{let M=Qe().xpLevel;Cr({level:k});let F=Qe();U(F.xpLevel),Mt(M,F.xpLevel)||(Ze(),Je(`Modified XP Level (${a}) ${Q(M)} \u2192 ${Q(F.xpLevel)}`))},{storageKey:u});Ft({type:"xp",slot:n,refresh:()=>{n===v()&&d.setValue(Qe().xpLevel)}}),e.appendChild(d.row);let f=ci.progress(n),p=Qt("XP Progress",s.progress,(k,{setValue:U})=>{let M=Qe(),F=M?.xpLevel?.clone?.()??M?.xpLevel,R=M?.progress?.clone?.()??M?.progress;Cr({progress:k});let _=Qe();U(_.progress),d.setValue(_.xpLevel),(!Mt(R,_.progress)||!Mt(F,_.xpLevel))&&(Ze(),Je(`Modified XP Progress (${a}) ${Q(R)} \u2192 ${Q(_.progress)}`))},{storageKey:f});Ft({type:"xp",slot:n,refresh:()=>{n===v()&&p.setValue(Qe().progress)}}),e.appendChild(p.row);let g=ui.level(n),m=Qt("MP Level",l.level,(k,{setValue:U})=>{let M=at().level;Mr({level:k});let F=at();U(F.level),Mt(M,F.level)||(Ze(),Je(`Modified MP Level (${a}) ${Q(M)} \u2192 ${Q(F.level)}`))},{storageKey:g});Ft({type:"mutation",slot:n,refresh:()=>{n===v()&&m.setValue(at().level)}}),e.appendChild(m.row);let y=ui.progress(n),h=Qt("MP Progress",l.progress,(k,{setValue:U})=>{let M=at(),F=M?.level?.clone?.()??M?.level,R=M?.progress?.clone?.()??M?.progress;Mr({progress:k});let _=at();U(_.progress),m.setValue(_.level),(!Mt(R,_.progress)||!Mt(F,_.level))&&(Ze(),Je(`Modified MP Progress (${a}) ${Q(R)} \u2192 ${Q(_.progress)}`))},{storageKey:y});Ft({type:"mutation",slot:n,refresh:()=>{n===v()&&h.setValue(at().progress)}}),e.appendChild(h.row);let b=Wr(n);if(b){let k=0;try{let M=localStorage.getItem(b),F=c.fromAny(M||"0");if(F.isInfinite())k=1/0;else try{k=Number(F.toScientific(20))}catch{k=0}}catch{}let U=Qt("Workshop Level",k,(M,{setValue:F})=>{let R=Number(M);if(console.log("[DebugPanel] Workshop Level Commit. Value type:",typeof M,"IsBigNum:",M instanceof c,"Value:",M),M instanceof c)if(M.isInfinite())R=1/0;else try{R=Number(M.toScientific(20))}catch{R=NaN}if(Number.isNaN(R)||R<0)return;let _=R===1/0?"Infinity":String(Math.floor(R));try{localStorage.setItem(b,_),Ze(),Je(`Modified Workshop Level (The Cove) ${Q(k)} \u2192 ${_}`),k=R}catch{}F(R)},{storageKey:b,onLockChange:()=>{let M=0;try{let F=localStorage.getItem(b),R=c.fromAny(F||"0");R.isInfinite()?M=1/0:M=Number(R.toScientific(20))}catch{}U.setValue(M)}});e.appendChild(U.row),Ft({type:"workshop-level",slot:n,refresh:()=>{if(n!==v())return;let M=0;try{let F=localStorage.getItem(b),R=c.fromAny(F||"0");R.isInfinite()?M=1/0:M=Number(R.toScientific(20))}catch{}U.setValue(M)}})}let x=ds(n);if(x){let k=0;try{let M=localStorage.getItem(x);M==="Infinity"?k=1/0:k=c.fromAny(M||"0")}catch{k=c.fromInt(0)}let U=Qt("Surge Level",k,(M,{setValue:F})=>{let R="0",_=0;M instanceof c?M.isInfinite()?(R="Infinity",_=1/0):(R=M.toPlainIntegerString(),_=M):M===1/0||typeof M=="string"&&/infinity/i.test(M)?(R="Infinity",_=1/0):(R=String(M),_=M);try{localStorage.setItem(x,R),Ze();let H=_===1/0?"Infinity":Q(_),j=k===1/0||k instanceof c&&k.isInfinite()?"Infinity":Q(k);Je(`Modified Surge Level (The Cove) ${j} \u2192 ${H}`),_===1/0?k=1/0:_ instanceof c?k=_:k=c.fromAny(_)}catch{}F(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let H=k;if(H!==1/0&&H instanceof c)try{H=BigInt(H.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:H}}))}catch{}},{storageKey:x,onLockChange:M=>{let F=c.fromInt(0);try{let R=localStorage.getItem(x);R==="Infinity"?F=1/0:F=c.fromAny(R||"0")}catch{}U.setValue(F)}});Ft({type:"surge-level",slot:n,refresh:()=>{if(n!==v())return;let M=c.fromInt(0);try{let F=localStorage.getItem(x);F==="Infinity"?M=1/0:M=c.fromAny(F||"0")}catch{}U.setValue(M)}}),e.appendChild(U.row)}let E=to(),C=Qt("Lab Level",E,(k,{setValue:U})=>{let M;try{M=k instanceof c?k:c.fromAny(k),M.isNegative&&M.isNegative()&&(M=c.fromInt(0))}catch{U(to());return}let F=to();ba(M),Ze(),Mt(F,M)||Je(`Modified Lab Level (The Cove) ${Q(F)} \u2192 ${Q(M)}`),U(M)},{storageKey:qf(n)});Ft({type:"lab-level",slot:n,refresh:()=>{n===v()&&C.setValue(to())}}),e.appendChild(C.row);let A=()=>{let k=Ot(),U=Ro(),M=k+U;return M>1&&(M=1),M},z=Qt("Tsunami Exponent",A().toFixed(2),(k,{setValue:U})=>{let M=Number(k);if(k instanceof c?k.isInfinite()?M=1/0:M=Number(k.toScientific(10)):typeof k=="string"&&/infinity/i.test(k)&&(M=1/0),Number.isNaN(M)){U(A().toFixed(2));return}let F=Ro(),R=M-F;R>1&&(R=1),R<0&&(R=0),R=Math.round(R*100)/100;let _=Ot();Ki(R),Ze(),Math.abs(_-R)>1e-4&&Je(`Modified Tsunami Exponent (The Cove) Base:${_.toFixed(2)} \u2192 ${R.toFixed(2)} (Effective: ${M.toFixed(2)})`),U(A().toFixed(2))},{storageKey:Zf(n),format:k=>{let U=Number(k);return Number.isFinite(U)?U.toFixed(2):String(k)}});Ft({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==v())return;let k=A();z.setValue(k.toFixed(2))}}),e.appendChild(z.row)}function xv(e,t){let n=v();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Bt(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=En(t.key,i.id??i.tie),u=ai(t.key,i.id??i.tie,n),d=Qt(l,a,(f,{setValue:p})=>{if(v()==null)return;let m=En(t.key,i.id??i.tie);try{Xo(t.key,i.id??i.tie,f,!1)}catch{}let y=En(t.key,i.id??i.tie);p(y),Mt(m,y)||(Ze(),Je(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${Q(m)} \u2192 Lv${Q(y)}`))},{idLabel:s,storageKey:u});Ft({type:"upgrade",slot:n,refresh:()=>{if(n!==v())return;let f=En(t.key,i.id??i.tie);d.setValue(f)}}),e.appendChild(d.row)})}function OE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=P?.[r.key]?.mult,l=tl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${ht.MULTIPLIER[r.key]}:${n}`,u=Qt(`${r.label} Multiplier`,l,(d,{setValue:f})=>{let p=v();if(p==null)return;let g=tl(r.key,p)??i?.get?.()??c.fromInt(1);try{Uv(r.key,d,p)}catch{}al();let y=tl(r.key,p)??i?.get?.()??c.fromInt(1);f(y),Mt(g,y)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${Q(g)} \u2192 ${Q(y)}`))},{storageKey:a});Ft({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let f=tl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(f)}}),e.appendChild(u.row)})}function PE(){if(v()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Me).forEach(o=>{let r=P?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Mt(i,t))return;r.set(t),n+=1}catch{}}),n}function BE(){if(v()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Me).forEach(o=>{let r=P?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function FE(){let e=v();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=Qe()}catch{}try{r=at()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Mt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Mt(o?.progress,t);(!i||!s)&&(Cr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Mt(r?.level,t),s=r?.progress?.isInfinite?.()||Mt(r?.progress,t);(!i||!s)&&(Mr({level:t,progress:t}),n+=1)}}catch{}try{let i=Wr(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=ds(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{lt()}catch{}return n}function UE(){let e=v();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=Qe()}catch{}try{r=at()}catch{}try{o?.unlocked&&(Cr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Mr({level:t,progress:t}),n+=1)}catch{}try{let i=Wr(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=ds(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{lt()}catch{}return n}function Vv(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Qe()?.unlocked}catch{return!1}},onEnable:()=>{try{Fr()}catch{}try{Ai({forceReload:!0})}catch{}},onDisable:()=>{try{Ni({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{il(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{il(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return Ld()}catch{return!1}},onEnable:()=>{try{ti()}catch{}},onDisable:()=>{try{Tc()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return _d()}catch{return!1}},onEnable:()=>{try{Mc()}catch{}},onDisable:()=>{try{kc()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return dd()}catch{return!1}},onEnable:()=>{try{cc(!0)}catch{}},onDisable:()=>{try{cc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!vn()}catch{return!1}},onEnable:()=>{try{ur(!0)}catch{}},onDisable:()=>{try{ur(!1)}catch{}},slot:e}]}function Yv(e){let t=v();if(t==null)return 0;let n=0;Vv(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{lt()}catch{}return n}function DE(){let e=v();if(e==null)return{unlocks:0,toggles:0};let t=0;Eu().forEach(o=>{Bt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{si(o.key,r,e),t+=1}catch{}})});try{ti()}catch{}try{Mc()}catch{}let n=Yv(!0);return{unlocks:t,toggles:n}}function $E(){let e=v();if(e==null)return{locks:0,toggles:0};let t=0;Eu().forEach(o=>{Bt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Bp(o.key,r,e),t+=1}catch{}})});try{Tc()}catch{}try{kc()}catch{}let n=Yv(!1);return{locks:t,toggles:n}}function qE(e,t=v()){let n=t??v();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(Kp(a,n)),r(pE(a,n))},s=a=>r(mi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(ci.level(n)),r(ci.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(ui.level(n)),r(ui.progress(n)))};return e==="all"?(Object.values(Me).forEach(i),l("xp"),l("mutation"),Iu.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Me).forEach(i),Array.from(o)):e==="allUnlockedStats"?(Qe()?.unlocked&&l("xp"),at()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Me).forEach(i),Qe()?.unlocked&&l("xp"),at()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function vu(e){try{P?.[e]?.set?.(c.fromInt(0))}catch{}try{mE(e)}catch{}try{Cl(e,c.fromInt(1))}catch{}}function GE(e){if(e==="all"){Object.values(Me).forEach(i=>vu(i));let o=c.fromInt(0);return Cr({level:o,progress:o}),Mr({level:o,progress:o}),Iu.forEach(({key:i})=>{try{Cn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Me).length+Iu.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Me).forEach(i=>{vu(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(Qe()?.unlocked){Cr({level:o,progress:o});try{Cn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(at()?.unlocked){Mr({level:o,progress:o});try{Cn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Me).forEach(l=>{vu(l),o+=1});let r=c.fromInt(0),i=0;try{if(Qe()?.unlocked){Cr({level:r,progress:r});try{Cn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(at()?.unlocked){Mr({level:r,progress:r});try{Cn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return vu(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{Pv(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Cr({level:n,progress:n});try{Cn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Mr({level:n,progress:n});try{Cn("mutation",c.fromInt(1))}catch{}return"MP"}try{Cn(t,c.fromInt(1))}catch{}return`stat ${t}`}function HE(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";Iu.forEach(r=>{if(r.key==="spawnRate")return;let i=mi(r.key,n),s=Qt(`${r.label} Multiplier`,Mn(r.key,n),(l,{setValue:a})=>{let u=v();if(u==null)return;let d=Mn(r.key,u);try{Cn(r.key,l,u)}catch{}let f=Mn(r.key,u);a(f),Mt(d,f)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${Q(d)} \u2192 ${Q(f)}`))},{storageKey:i,onLockChange:l=>{let a=v();if(a!=null){if(l){if(Bv(a,r.key))return;try{Cn(r.key,pi(r.key),a)}catch{}}else Lu(r.key,a,pi(r.key));s.setValue(Mn(r.key,a))}}});Ft({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Mn(r.key,n);s.setValue(l)}}),Ft({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Mn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Ft({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=Mn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function XE(e){let t=v();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!jt||jt.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}jt.forEach(n=>{let o=Wn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=Jl(t,n.id),s=Qt("Level",Un(n.id),(u,{setValue:d})=>{let f=Number(u);if(u instanceof c&&(f=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(f)||f<0)return;f>n.maxLevel&&(f=n.maxLevel),f=Math.floor(f);let p=Un(n.id);zf(n.id,f),Ze(),p!==f&&Je(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${f}`),d(f)},{storageKey:i});Ft({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===v()&&s.setValue(Un(n.id))}}),r.appendChild(s.row);let l=Ql(t,n.id),a=Qt("Current RP",No(n.id),(u,{setValue:d})=>{let f;try{f=u instanceof c?u:c.fromAny(u),f.isNegative&&f.isNegative()&&(f=c.fromInt(0))}catch{d(No(n.id));return}let p=No(n.id);Kf(n.id,f),Ze(),Mt(p,f)||Je(`Modified Node ${n.id} RP (The Cove) ${Q(p)} \u2192 ${Q(f)}`),d(f)},{storageKey:l});Ft({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===v()&&a.setValue(No(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function VE(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Fl(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>If(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>nm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>fs(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>lr(n)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>Fp(n,o,r)}]}].forEach(n=>{let o=Wn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=AE({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function YE(e){if(e.innerHTML="",v()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}al(),Eu().forEach(o=>{let r=Wn(o.title,i=>{let s=Wn("Currencies",g=>{NE(g,o)}),l=Wn("Stats",g=>{RE(g,o)}),a=Wn("Multipliers",g=>{let m=Wn("Currencies",h=>{OE(h,o)}),y=Wn("Stats",h=>{HE(h,o)});g.appendChild(m),g.appendChild(y)}),u=Wn("Upgrades",g=>{xv(g,o)}),d=null,f=null;o.key===xe.STARTER_COVE&&(d=Wn("Automation Upgrades",g=>{xv(g,{key:xe.AUTOMATION,title:"Automation"})}),f=Wn("Lab Nodes",g=>{XE(g)}));let p=Wn("Calculators",g=>{VE(g)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),d&&i.appendChild(d),f&&i.appendChild(f),i.appendChild(p)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function Lv(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];return o.forEach(i=>{Bt(i).forEach(l=>{e&&qo(i,l.id).locked||r.push({areaKey:i,upg:l})})}),Ka(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;Xo(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function _v(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];o.forEach(s=>{Bt(s).forEach(a=>{e&&qo(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{Ka(()=>{r.forEach(({areaKey:s,upg:l})=>{try{br(s,l.id,"0"),Xo(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function Cv(e){let t=v();if(t==null)return 0;let n=e?"1":"0",o=0,r=Bt(Ke);Ka(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;Xo(Ke,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values($i),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(xe).forEach(l=>{if(l===Ke)return;Bt(l).forEach(u=>{s.has(u.costType)&&(br(l,u.id,n),o++)})}),br(Ke,Qn,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function WE(e){e.innerHTML="";let t=v();if(t==null){let h=document.createElement("div");h.className="debug-panel-empty",h.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(h);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:h}=CE();Ze(),Je(`Completed all dialogues (${h} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:h}=ME();Ze(),Je(`Restored dialogues to unclaimed state (${h} ${h===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let h=PE();Ze(),Je(`Set all currencies to Infinity (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let h=FE();Ze(),Je(`Set all stats to Infinity (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let h=BE();Ze(),Je(`Set all currencies to 0 (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let h=UE();Ze(),Je(`Set all unlocked stats to 0 (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let h=Lv(!0);Ze(),Je(`Maxed ${h} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let h=_v(!0);Ze(),Je(`Reset ${h} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let h=Lv(!1);Ze(),Je(`Maxed all ${h} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let h=_v(!1);Ze(),Je(`Reset all ${h} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let h=Cv(!0);Ze(),Je(`Enabled automation for ${h} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let h=Cv(!1);Ze(),Je(`Disabled automation for ${h} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:h,toggles:b}=DE();Ze(),Je(`Unlocked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:h,toggles:b}=$E();Ze(),Je(`Locked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{qv([],t),em(),Ze(),Je("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let h=v();if(h!=null)try{localStorage.setItem(rE(h),String(iE)),Po(!0),Ze(),Je("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let h=window.prompt("Enter amount of seconds to warp:");if(h==null)return;let b=Qp(h);if(!b||typeof b.isZero=="function"&&b.isZero()||typeof b.isNegative=="function"&&b.isNegative())return;let x,E=!1;Ut()?x=ji(b):(x=nc(b),E=!0),Zr(x);let C=b.mulSmall?b.mulSmall(1e3):b.mulBigNumInteger(c.fromInt(1e3));dr(x,C,E),Ze(),Je(`Performed OP Time Warp for ${Q(b)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(h=>{let b=document.createElement("button");b.type="button",b.className="debug-panel-toggle debug-misc-button",b.textContent=h.label,b.addEventListener("click",h.onClick),o.appendChild(b)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",Eu().forEach(h=>{let b=document.createElement("optgroup");b.label=h.title||h.key,h.currencies.forEach(x=>{let E=document.createElement("option");E.value=`currency:${x.key}`,E.textContent=`${h.title||h.key} \u2192 ${x.label}`,b.appendChild(E)}),h.stats.forEach(x=>{let E=document.createElement("option");E.value=`stat:${x.key}`,E.textContent=`${h.title||h.key} \u2192 ${x.label}`,b.appendChild(E)}),s.appendChild(b)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let d=document.createElement("option");d.value="all",d.textContent="All",s.appendChild(d),s.querySelector(`option[value="${gu}"]`)||(gu=Qa),s.value=gu;let f=()=>qE(s.value||Qa,v()),p=IE(f);s.addEventListener("change",()=>{gu=s.value||Qa,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let g=document.createElement("button");g.type="button",g.className="debug-panel-toggle reset-check",g.textContent="\u2705",g.addEventListener("click",()=>{let h=s.value||Qa,b=f(),x=p.isLocked(),E=(C=!0)=>{let A=EE(b,()=>GE(h))??{label:h,count:0};if(x&&b.forEach(z=>hi(z)),p.refresh(),Ze(),C){let{label:z,count:k}=A;Je(`Reset ${k===1?"value and multiplier":"values and multipliers"} for ${z} to defaults.`)}};E(!0),setTimeout(()=>E(!1),100)}),r.appendChild(g),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-danger-button",y.textContent="Wipe Slot & Refresh",y.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let b=document.querySelector(".menu-root"),x=document.getElementById("game-root");b&&(b.hidden=!1,b.style.display="",b.style.visibility=""),x&&(x.hidden=!0,x.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(y),e.appendChild(m)}function zE(e){e.innerHTML="";let t=v();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Ai()}catch{}let n=Vv(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(TE(o))})}function Wv(){if(!di||sl())return;Nv(),Rv(),kv=0,Av=0;let e=document.getElementById(ol);e&&e.remove();let t=document.createElement("div");t.id=ol,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>xo({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>xo()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:d,hideOnMobile:f})=>{let p=document.createElement("div");p.className="debug-panel-info-line",f&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=d,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(yu("Areas: main currency/stat/upgrade management for each area","debug-areas",d=>{YE(d)})),t.appendChild(yu("Unlocks: modify specific unlock flags","debug-unlocks",d=>{zE(d)})),t.appendChild(yu("Action Log: keep track of everything you do","debug-action-log",d=>{let f=document.createElement("div");f.id="action-log-entries",f.className="debug-panel-action-log",f.style.maxHeight="240px",f.style.overflowY="auto",d.appendChild(f),Cs=f,em(),fn(()=>{Cs=null})})),t.appendChild(yu("Miscellaneous: helpful miscellaneous functions","debug-misc",d=>{WE(d)})),lE(t),document.body.appendChild(t),Su>0)try{t.scrollTop=Su}catch{}cE(),fi=!0}function Wp(){if(!(!di||sl())){if(v()==null){xo();return}fi||Wv()}}function xo({preserveExpansionState:e=!1}={}){Tv=e?aE():wu();let t=document.getElementById(ol);if(t){try{Su=t.scrollTop??0}catch{Su=0}t.remove()}Nv(),fi=!1}function KE(){if(!di||sl()||v()==null){xo();return}fi?xo({preserveExpansionState:!0}):Wp()}function jE(){xo(),Vp()}function _u(){if(!uE()){Vp(),xo();return}Rv(),Vp();let e=document.createElement("button");e.id=Mv,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{KE()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function ZE(e){if(di=!!e,!di){jE();return}_u()}function JE(e){ZE(e)}var hu,ol,Mv,Qa,fi,di,Hp,Tv,Su,gu,kv,Av,zp,Cs,rl,Ts,bu,nl,li,ks,Iv,Ms,wv,nE,oE,Xp,rE,iE,qp,ci,Gp,ui,Iu,Ev,Pi=De(()=>{xt();Yt();bt();Zn();So();bo();yn();Ac();mc();Xi();vo();no();yc();Xr();td();Ia();Zl();oc();hu="debug-panel-style",ol="debug-panel",Mv="debug-panel-toggle",Qa=`currency:${Me.COINS}`,fi=!1,di=!1,Hp=[],Tv=wu(),Su=0,gu=Qa,kv=0,Av=0,zp=[],Cs=null,rl=new Map,Ts=new Map,bu=new Set,nl=new Map,li=new Map,ks=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=ks);Iv=!1,Ms=null,wv=null,nE="ccc:debug:stat-mult",oE="ccc:actionLog",Xp=100,rE=e=>`ccc:warp:charges:${e}`,iE=24;qp="ccc:xp",ci={unlock:e=>`${qp}:unlocked:${e}`,level:e=>`${qp}:level:${e}`,progress:e=>`${qp}:progress:${e}`},Gp="ccc:mutation",ui={unlock:e=>`${Gp}:unlocked:${e}`,level:e=>`${Gp}:level:${e}`,progress:e=>`${Gp}:progress:${e}`},Iu=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];Ev=!1;al();Fv();document.addEventListener("keydown",e=>{if(!(!di||sl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&v()!=null){if(e.shiftKey){fi?(wE(),xo()):Wp(),e.preventDefault();return}fi?xo({preserveExpansionState:!0}):Wp(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{_u()});window.addEventListener("menu:visibilitychange",fE);window.addEventListener("saveSlot:change",()=>{_u(),fi&&Wv()})});var Jv={};vt(Jv,{addExternalMutationGainMultiplierProvider:()=>jr,addMutationPower:()=>Qi,broadcastMutationChange:()=>tm,computeMutationMultiplierForLevel:()=>fs,computeMutationRequirementForLevel:()=>nm,getMutationCoinSprite:()=>gp,getMutationGainMultiplier:()=>Mu,getMutationMultiplier:()=>Cu,getMutationState:()=>at,getTotalCumulativeMp:()=>Va,initMutationSystem:()=>Xt,isMutationUnlocked:()=>Eo,onMutationChange:()=>ii,setMutationUnlockedForDebug:()=>il,unlockMutationSystem:()=>wr});function Tu(e){try{return e?.toStorage?.()}catch{return null}}function bi(){try{gn()}catch{}}function Zv(e){let t=e;if(!t.isZero?.()){let n=vi.size>0?Array.from(vi):typeof ul=="function"?[ul]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof We?t=r.clone?.()??r:r!=null&&(t=We.fromAny(r))}catch{}}return t}function tx(){if(typeof om=="function"){try{om()}catch{}om=null}if(typeof rm=="function"){try{rm()}catch{}rm=null}}function fl(e){if(e instanceof We)try{return e.clone?.()??We.fromAny(e)}catch{return ut()}try{return We.fromAny(e??0)}catch{return ut()}}function nx(e){if(!e||typeof e!="object")return ut();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?We.fromInt(100):We.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function Au(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=$e(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function fm(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let d=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(d+=ex*(p-1),!Number.isFinite(d)))return Number.POSITIVE_INFINITY}let f=u*d;return Number.isFinite(f)?f:Number.POSITIVE_INFINITY}let n=Au(e);if(!Number.isFinite(n))return We.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return We.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),d=Math.pow(l/u,1/a),f=o-9;r=u*Math.pow(d,f)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return We.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return We.fromAny("Infinity");let i=Ae(r);return nx(i)}function Tr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=fm(D.level);D.requirement=n}function ox(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=$e(e),l=$e(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function lm(){return Tn.container&&Tn.container.isConnected?!0:(Tn.container=document.querySelector("[data-mp-hud].mp-counter"),Tn.container?(Tn.bar=Tn.container.querySelector(".mp-bar"),Tn.fill=Tn.container.querySelector(".mp-bar__fill"),Tn.levelValue=Tn.container.querySelector(".mp-level-value"),Tn.progress=Tn.container.querySelector("[data-mp-progress]"),!0):!1)}function gi(e){try{return Q(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function jo(){if(!lm())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Tn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=gi(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=gi(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Ci();return}e.removeAttribute("hidden");let i=D.requirement,s=ox(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=gi(D.level)),r){let a=gi(D.progress),u=gi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=gi(D.progress).replace(/<[^>]*>/g,""),u=gi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Ci()}function Zo(e="update",t={}){let n=at(),o={...n,slot:D.slot??v(),changeType:e,...t};if(am.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function dm(){let e=D.slot;if(e==null&&(e=v(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(ll(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(yi(e),D.level.toStorage())}catch{}try{localStorage.setItem(Ns(e),D.progress.toStorage())}catch{}rt(ll(e)),rt(yi(e)),rt(Ns(e));let t=(()=>{let u=D.unlocked,d=D.level,f=D.progress;try{u=localStorage.getItem(ll(e))==="1"}catch{}try{let p=localStorage.getItem(yi(e));p&&(d=We.fromAny(p))}catch{}try{let p=localStorage.getItem(Ns(e));p&&(f=We.fromAny(p))}catch{}return{unlocked:u,level:d,progress:f}})(),n=Tu(t.level),o=Tu(t.progress),r=Tu(D.level),i=Tu(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&ku(t,{skipPersist:!0})}function cm(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function rx(){if(!D.unlocked)return;let e=D.slot??v();if(e!=null&&cm(yi(e))){Tr();return}Tr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(Rs()),Tr(),t=D.requirement,!t||typeof t!="object"){D.progress=ut();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=ut())}function ku(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=fl(e.level),D.progress=fl(e.progress),D.unlocked||(D.level=ut(),D.progress=ut()),Tr(),t||dm(),jo(),Zo("load"),bi()}function im(e){let t=e??v();if(t==null){ku({unlocked:!1,level:ut(),progress:ut()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=ut(),r=ut();try{n=localStorage.getItem(ll(t))==="1"}catch{}try{let i=localStorage.getItem(yi(t));i&&(o=We.fromAny(i))}catch{}try{let i=localStorage.getItem(Ns(t));i&&(r=We.fromAny(i))}catch{}ku({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function ix(){for(;cl.length;){let e=cl.pop();try{e?.()}catch{}}}function sm(e){Kv!==e&&(ix(),Kv=e,e!=null&&(cl.push(Lt(ll(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=ut(),D.progress=ut()),Tr(),jo(),Zo("storage"),bi())}})),cl.push(Lt(yi(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Tr(),jo(),Zo("storage"),bi())}catch{}}})),cl.push(Lt(Ns(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Tr(),jo(),Zo("storage"))}catch{}}}))))}function Xt({forceReload:e=!1}={}){if(tx(),jv){let n=v();return(n!==D.slot||e)&&im(n),sm(n),lm(),jo(),at()}jv=!0,lm();let t=v();return D.slot=t,im(t),sm(t),jo(),bi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=v();D.slot=n,im(n),sm(n),jo(),bi(),Zo("slot")}),at()}function at(){return{unlocked:D.unlocked,level:fl(D.level),progress:fl(D.progress),requirement:fl(D.requirement)}}function Eo(){return!!D.unlocked}function wr(){return Xt(),D.unlocked?!1:(D.unlocked=!0,Tr(),dm(),jo(),Zo("unlock"),bi(),!0)}function il(e){Xt();let t=!!e;ku({unlocked:t,level:t?D.level:ut(),progress:t?D.progress:ut()})}function Qi(e){Xt();let t=D.slot??v();if(t!=null&&cm(Ns(t))||!D.unlocked)return at();let n=t!=null&&cm(yi(t));if(D.level&&D.level.isInfinite?.()){let d=D.level.clone?.()??D.level,f=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=We.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=We.fromAny("Infinity")}catch{}let p;try{p=e instanceof We?e:We.fromAny(e??0)}catch{p=ut()}return p=Zv(p),p=Fn("mutation",p),Zo("progress",{delta:p.clone?.()??p,levelsGained:ut(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:d.clone?.()??d,previousProgress:f.clone?.()??f})}let o;try{o=e instanceof We?e:We.fromAny(e??0)}catch{o=ut()}if(o=Zv(o),o=Fn("mutation",o),o.isZero?.())return at();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=We.fromAny("Infinity")}catch{}try{D.progress=We.fromAny("Infinity")}catch{D.progress=ut()}try{D.requirement=We.fromAny("Infinity")}catch{}}else rx();dm(),jo();let a=D.level.sub(i);return a.isZero?.()||bi(),Zo("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function tm(e={}){Xt();let t=e.changeType??"manual";return Zo(t,e)}function fs(e){let t;if(e instanceof We)try{t=e.clone?.()??e}catch{t=ut()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=ut()}else try{t=c.fromAny(e??0)}catch{t=ut()}if(t&&t.isInfinite?.())try{return We.fromAny("Infinity")}catch{return Rs()}let n=Au(t);if(!Number.isFinite(n))try{return We.fromAny("Infinity")}catch{return Rs()}if(n<=0)return Rs();let o=n*QE;return Ae(o)}function nm(e){let t;try{t=e instanceof We?e:We.fromAny(e??0)}catch{t=ut()}try{return fm(t)}catch{return ut()}}function Cu(){if(Xt(),!D.unlocked)return Rs();try{return fs(D.level)}catch{return Rs()}}function Mu(){let e=c.fromInt(1);if(vi.size>0||ul){let t=vi.size>0?Array.from(vi):typeof ul=="function"?[ul]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof We?e=o.clone?.()??o:o!=null&&(e=We.fromAny(o))}catch{}}return e}function gp(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=Au(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function ii(e){return typeof e!="function"?()=>{}:(am.add(e),()=>{am.delete(e)})}function jr(e){return typeof e!="function"?()=>{}:(vi.add(e),()=>{vi.delete(e)})}function Va(){if(Xt(),!D.unlocked)return ut();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=Au(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=fm(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var um,ll,yi,Ns,We,ut,Rs,QE,ex,D,Tn,am,cl,Kv,jv,om,rm,vi,ul,So=De(()=>{xt();bt();Pi();Yt();yn();uf();Zn();um="ccc:mutation",ll=e=>`${um}:unlocked:${e}`,yi=e=>`${um}:level:${e}`,Ns=e=>`${um}:progress:${e}`,We=c,ut=()=>We.fromInt(0),Rs=()=>We.fromInt(1),QE=Math.log10(2),ex=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:ut(),progress:ut(),requirement:ut(),slot:null},Tn={container:null,bar:null,fill:null,levelValue:null,progress:null},am=new Set,cl=[],Kv=null,jv=!1,om=null,rm=null,vi=new Set,ul=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Xt,unlockMutationSystem:wr,addMutationPower:Qi,getMutationState:at,getMutationMultiplier:Cu,isMutationUnlocked:Eo,getTotalCumulativeMp:Va,addExternalMutationGainMultiplierProvider:jr,getMutationGainMultiplier:Mu}))});var dl,Qv,e0,pm,mm,hm,t0=De(()=>{dl=`attribute vec2 position;
varying vec2 vUv;
void main() {
    vUv = position * 0.5 + 0.5;
    gl_Position = vec4(position, 0.0, 1.0);
}`,Qv='precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform vec3 uColorDeep; uniform vec3 uColorShallow; void main() { /* Wave animation settings */ float speed = 1.2; float time = uTime * speed; /* Combine sine waves for a more natural look */ /* vUv.x is 0..1 across the screen width */ float wave1 = sin(vUv.x * 8.0 - time) * 0.0285; float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; /* Define the shoreline height (baseline) */ /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */ /* We want to discard pixels below this threshold */ float threshold = 0.428 + wave; if (vUv.y < threshold) { discard; } /* Recalculate gradient based on the new "bottom" */ /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */ float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0); vec3 col = mix(uColorShallow, uColorDeep, gradientY); /* Add a subtle "foam" or highlight at the edge */ float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold); col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4); gl_FragColor = vec4(col, 1.0); }',e0="precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform sampler2D uWaveMap; uniform vec3 uColorDeep; uniform vec3 uColorShallow; uniform vec3 uColorWaveDeep; uniform vec3 uColorWave; /* Simple noise for foam breakup */ float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); } float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f*f*(3.0-2.0*f); return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x), mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y); } void main() { vec2 uv = vUv; /* Sample the simulation (physics) */ /* Wave Logic */ vec2 waveUV = uv - vec2(0.0, 0.0285); float intensity = texture2D(uWaveMap, waveUV).r; /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */ float shadowOffset = 8.0 / uResolution.y; float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r; /* Discard only if BOTH are empty */ if (intensity < 0.01 && shadowIntensity < 0.01) discard; /* Directional Noise: Streaky vertical noise for rushing water effect */ /* Stretch heavily along Y-axis to simulate speed/motion blur */ float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0)); /* Define Zones based on Intensity */ /* Body (Medium Intensity): Darker/turbulent blue with noise */ /* Edge (High Intensity): Bright white foam */ float foamThreshold = 0.5; float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity); /* Base Colors */ vec3 bodyColor = uColorWaveDeep; vec3 foamColor = uColorWave; /* Mix Colors */ vec3 finalColor = mix(bodyColor, foamColor, foamMix); /* Add streaks to the body part */ if (foamMix < 0.9) { finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix); } /* Hard Edge & Opacity */ /* Ensure the front (bottom) remains sharp, back trails off */ /* Calculate Alpha based on Intensity */ /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */ /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */ /* Low Intensity (Top/Tail): Fades to 0.0 */ float finalAlpha = smoothstep(0.02, 0.15, intensity); /* Screen Fade */ /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */ /* Dynamic Shoreline Fade */ /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */ /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */ float speed = 1.2; float time = uTime * speed; float wave1 = sin(uv.x * 8.0 - time) * 0.0285; float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; float threshold = 0.428 + wave; /* Fade out quickly after exiting the water body (below threshold) */ /* Fade starts slightly higher than the threshold to soften the transition */ /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */ float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y); float screenFade = shoreFade; /* --- Composite Shadow & Wave --- */ float waveAlpha = finalAlpha * screenFade; /* Shadow Alpha */ float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity); /* Shadow is weaker (40% opacity) */ float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade; /* Mix: Wave over Shadow */ /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */ float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha); /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */ /* Shadow is black (RGB=0), so second term is 0 */ vec3 outRGB = finalColor * waveAlpha; gl_FragColor = vec4(outRGB, outAlpha); }",pm=`attribute vec2 aPosition;
attribute vec2 aUv;
attribute float aAlpha; 

varying vec2 vUv;
varying float vAlpha;

void main() {
    vUv = aUv;
    vAlpha = aAlpha;
    gl_Position = vec4(aPosition, 0.0, 1.0);
}`,mm=`precision mediump float;
varying vec2 vUv;
varying float vAlpha;

float sdRoundedBox(vec2 p, vec2 b, float r) {
    vec2 q = abs(p) - b;
    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;
}

void main() {
    vec2 p = vUv - 0.5;
    
    /* Shape: Rounded Box (Pill) */
    vec2 b = vec2(0.35, 0.15);
    float r = 0.05;
    float d = sdRoundedBox(p, b, r);
    
    float shape = 1.0 - smoothstep(0.0, 0.02, d);
    shape = clamp(shape, 0.0, 1.0);

    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */
    /* vUv.y: 0=Bottom, 1=Top */
    /* We want foam only at the very bottom, rapidly fading to blue body */
    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */
    /* Reducing 0.45 to 0.42 shrinks the foam cap height */
    float foam = smoothstep(0.45, 0.24, vUv.y);
    
    /* Body Gradient: Fade out towards the tail */
    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */
    float bodyFade = smoothstep(0.4, 0.7, vUv.y);
    float bodyBase = mix(0.45, 0.0, bodyFade);

    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */
    float intensity = mix(bodyBase, 1.0, foam);

    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);
}`,hm=`precision mediump float;

uniform sampler2D uLastFrame;
uniform vec2 uResolution;
uniform float uDt;

void main() {
    vec2 uv = gl_FragCoord.xy / uResolution;
    
    /* Flow Downwards */
    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */
    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); 
    
    vec2 sourceUv = uv + flow;

    if (sourceUv.y > 1.0) {
        gl_FragColor = vec4(0.0);
        return;
    }
    
    vec4 center = texture2D(uLastFrame, sourceUv);
    
    /* Decay */
    /* Correct decay for variable timestep */
    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */
    float decay = pow(0.99, uDt * 60.0);
    
    gl_FragColor = center * decay;
}`});var r0={};vt(r0,{WaterSystem:()=>Nu,waterSystem:()=>Ru});function o0(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function Os(e,t,n){let o=o0(e,e.VERTEX_SHADER,t),r=o0(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var sx,n0,ax,lx,Nu,Ru,gm=De(()=>{t0();sx=[.2,.5,.9],n0=[.2,.9,1],ax=[1,1,1],lx=[.45,.8,1];Nu=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:Os(s,dl,e0),simProgram:Os(s,dl,hm),brushProgram:Os(s,pm,mm),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=Os(this.glBg,dl,Qv),this.bgSimProgram=Os(this.glBg,dl,hm),this.bgBrushProgram=Os(this.glBg,pm,mm)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,d=-(s/this.height*2-1),f=l/this.width,p=a/this.height,g=new Float32Array([u-f,d-p,0,0,1,u+f,d-p,1,0,1,u-f,d+p,0,1,1,u+f,d+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,g,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),y=t.getAttribLocation(n,"aUv"),h=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(y),t.vertexAttribPointer(y,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let d=r;for(;d>0;){let f=Math.min(d,s);l.push(f),d-=f}}l.forEach(d=>{let f=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,d);this.bgReadFBO=f.readFBO,this.bgWriteFBO=f.writeFBO,this.bgReadTexture=f.readTex,this.bgWriteTexture=f.writeTex}),this.fgLayers.forEach(d=>{l.forEach(f=>{let p=this.runSimStep(d.gl,d.simProgram,d.quadBuffer,d.readFBO,d.writeFBO,d.readTexture,d.writeTexture,f);d.readFBO=p.readFBO,d.writeFBO=p.writeFBO,d.readTexture=p.readTex,d.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),sx),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),n0),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(d=>{let f=d.gl;f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,d.canvas.width,d.canvas.height),f.useProgram(d.program),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,d.readTexture),f.uniform1i(f.getUniformLocation(d.program,"uWaveMap"),0),f.uniform3fv(f.getUniformLocation(d.program,"uColorShallow"),n0),f.uniform3fv(f.getUniformLocation(d.program,"uColorWave"),ax),f.uniform3fv(f.getUniformLocation(d.program,"uColorWaveDeep"),lx),f.uniform1f(f.getUniformLocation(d.program,"uTime"),o),f.uniform2f(f.getUniformLocation(d.program,"uResolution"),d.canvas.width,d.canvas.height),f.bindBuffer(f.ARRAY_BUFFER,d.quadBuffer);let p=f.getAttribLocation(d.program,"position");f.enableVertexAttribArray(p),f.vertexAttribPointer(p,2,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLE_STRIP,0,4)})}},Ru=new Nu});var u0={};vt(u0,{createSpawner:()=>gx});function c0(e){if(!e||typeof e!="object"){Ps=!1,Si=0n;return}Ps=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;Si=n&&n!=="Infinity"?BigInt(n):0n}catch{Si=0n}}function ux(e){let t=1-e;return 1-t*t*t}function dx(e){if(!e)return null;let t=i0.get(e);return t||(t=new Image,t.src=e,i0.set(e,t)),t}function gx({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:d=je?cx:1e4,initialBurst:f=1,coinTtlMs:p=1e99,waveSoundSrc:g="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:y=.2,waveSoundMinIntervalMs:h=160,enableDropShadow:b=!1}={}){let x=o,E={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function C(){return!!(E.pf&&E.w&&E.c)}C()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let A=7,z=[],k=[],U=!1;if(E.c)for(let S=0;S<A;S++){let T=document.createElement("canvas");T.style.position="absolute",T.style.inset="0",T.style.pointerEvents="none",T.style.zIndex=`${10+S*10}`,E.c.appendChild(T);let B=T.getContext("2d",{alpha:!0});z.push(T),k.push(B)}let M=null,F=null;E.c&&(M=document.createElement("canvas"),M.style.position="absolute",M.style.inset="0",M.style.pointerEvents="none",M.style.zIndex="100",E.c.appendChild(M),F=M.getContext("2d",{alpha:!0}));let R={collectBatch:null,getMagnetUnit:null};function _(S){R={...R,...S}}let H={pfRect:null,wRect:null,safeBottom:0,pfW:0};function j(){if(!C())return!1;let S=E.pf.getBoundingClientRect(),T=E.w.getBoundingClientRect(),B=E.hud?E.hud.getBoundingClientRect().height:0;H={pfRect:S,wRect:T,safeBottom:S.height-B,pfW:S.width};let N=window.devicePixelRatio||1;return z.forEach((O,de)=>{if(O){O.width=S.width*N,O.height=S.height*N,O.style.width=S.width+"px",O.style.height=S.height+"px";let ue=k[de];ue&&(ue.setTransform(1,0,0,1,0,0),ue.scale(N,N),ue.imageSmoothingEnabled=!0,ue.imageSmoothingQuality="high")}}),U=!0,M&&(M.width=S.width*N,M.height=S.height*N,M.style.width=S.width+"px",M.style.height=S.height+"px",F&&(F.setTransform(1,0,0,1,0,0),F.scale(N,N))),!0}j();let ye="ResizeObserver"in window?new ResizeObserver(()=>j()):null;ye&&E.pf&&ye.observe(E.pf),document.addEventListener("visibilitychange",()=>{document.hidden||j()});let K=(S,T,B)=>Math.max(T,Math.min(B,S)),ne=Math.max(2e3,d*3),pe=12,be=[],V=[],oe=0,$=[];function q(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let T=document.createElement("img");return T.className="coin-inner",T.draggable=!1,T.alt="",T.style.width="100%",T.style.height="100%",T.src=x,T.style.objectFit="contain",T.style.borderRadius="50%",S.appendChild(T),b&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let Z=()=>be.length?be.pop():q();function le(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let T=0;T<=6;T++)S.classList.remove(`coin--size-${T}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),be.length<ne&&be.push(S)}function fe(S,T=-1){if(S.isRemoved)return;S.isRemoved=!0;let B=T;(B===-1||V[B]!==S)&&(S.index!==void 0&&V[S.index]===S?B=S.index:B=V.indexOf(S)),B!==-1&&(V[B]=null,oe++),S.el?(le(S.el),S.el=null):U=!0}function L(S){let T=S._coinObj;if(T){let B=-1;T.index!==void 0&&V[T.index]===T?B=T.index:B=V.indexOf(T),B!==-1&&(V[B]=null,oe++),S._coinObj=null}}let Y=new URL(g,document.baseURI).href,ce=0;function he(){let S=performance.now();if(S-ce<h)return;ce=S,ft(Y,{volume:je?y:m,type:"music"})}function J(){if(!C())return null;if((!H.pfRect||!H.wRect)&&j(),d!==1/0&&V.length-oe>=d){let It=-1;if(pt(2))for(let Nt=0;Nt<V.length;Nt++){let po=V[Nt];if(po&&po.sizeIndex<4){It=Nt;break}}else for(let Nt=0;Nt<V.length;Nt++)if(V[Nt]){It=Nt;break}if(It===-1)return null;let At=V[It];At&&fe(At,It)}let S=H.pfW,T=H.wRect.top-H.pfRect.top,B=Math.max(0,T),N=0;if(pt(2)){let It=Math.random();for(let At=6;At>=1;At--)if(It<mx[At]){N=At;break}}N>=4&&Ha&&Ha()&&(N=3);let O=s0[N],de=pe+(N>=3?15*(N-2):0),ue=de,Te=Math.max(ue,S-O-de),Oe=ue+Math.random()*(Te-ue),Pe=Math.random()*100-50,ke;if(O>=H.pfW)ke=(H.pfW-O)/2;else{let It=H.pfW-O-de;ue>=It?ke=(H.pfW-O)/2:ke=K(Oe+Pe,ue,It)}let Ue=Math.min(H.wRect.height,H.pfRect.height*.3),Ce=Math.max(Ue+80,120),Xe=Math.max(Ce+40,H.safeBottom-O-6),Ee=K(Ce+Math.random()*(Xe-Ce),Ce,Xe),He={x0:Oe,y0:B,x1:ke,y1:Ee,jitterMs:0},nt=H.pfRect.left-H.wRect.left,Ge=hx[N],kt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),ot=.85+Math.random()*.3,yt=kt*(Ge.w/100)*ot,qt=kt*(Ge.h/100)*ot,Gt=Oe+O/2+nt,kn=B-T;return{wave:{x:Gt,y:kn,width:yt,height:qt},coin:He,sizeIndex:N}}function re(S){if(!S.length||!C())return;let T=document.createDocumentFragment(),B=[],N=performance.now(),O=!1;for(let{wave:de,coin:ue,sizeIndex:Te}of S){if(de&&(O=!0,Ru)){let Xe=Te>=4;Ru.addWave(de.x,de.y,de.width,de.height,Xe)}let Oe=s0[Te],Pe=1;if(pt(8)){let Xe=Ot(),Ee=Math.pow(25,Xe);Pe=Math.pow(Ee,Te)}else Pe=px[Te];let ke=Te>=4,Ue=Z();Ue.style.width=`${Oe}px`,Ue.style.height=`${Oe}px`,Ue.className=`coin coin--size-${Te}`,Ue.firstChild&&(Ue.firstChild.src=x),Ue.style.transform=`translate3d(${ue.x0}px, ${ue.y0}px, 0) rotate(-10deg) scale(0.96)`,Ue.style.opacity="0",Ps?Ue.dataset.mutationLevel=Si.toString():Ue.dataset.mutationLevel="0";let Ce={mutationLevel:Ps?Si.toString():"0",el:Ue,src:x,x:ue.x0,y:ue.y0,rot:-10,scale:.96,startX:ue.x0,startY:ue.y0,endX:ue.x1,endY:ue.y1,startTime:N+ue.jitterMs,duration:i,dieAt:N+p,jitterMs:ue.jitterMs,isRemoved:!1,settled:!1,size:Oe,sizeIndex:Te,valueMultiplier:Pe,forceDom:ke,soundSrc:l0[Te]?`sounds/coin_pickup${l0[Te]}`:null,bMinX:Math.min(ue.x0,ue.x1)-Oe,bMaxX:Math.max(ue.x0,ue.x1)+Oe,bMinY:Math.min(ue.y0,ue.y1)-Oe,bMaxY:Math.max(ue.y0,ue.y1)+Oe};Ue._coinObj=Ce,Ce.index=V.length,V.push(Ce),B.push(Ce),T.appendChild(Ue)}E.c.appendChild(T),B.length>0&&requestAnimationFrame(()=>{for(let de of B)de.el&&(de.el.style.transition=`transform ${i}ms ${fx} ${de.jitterMs}ms`,de.el.style.transform=`translate3d(${de.endX}px, ${de.endY}px, 0) rotate(0deg) scale(1)`,de.el.style.opacity="1")}),O&&requestAnimationFrame(()=>{he()})}function ge(S=1){if(!C())return;(!H.pfRect||!H.wRect)&&j();let T=[];for(let B=0;B<S;B++){let N=J();N&&T.push(N)}T.length&&re(T)}function Le(S,T){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let B=T-S.startTime;if(B<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let N=B/S.duration;if(N>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let O=ux(N),de=S.startX+(S.endX-S.startX)*O,ue=S.startY+(S.endY-S.startY)*O,Te=-10+10*O,Oe=.96+.04*O;return{x:de,y:ue,rot:Te,scale:Oe}}function ie(S,T){let B=dx(T.src);if(B&&B.complete&&B.naturalWidth>0){let N=T.size||r;S.drawImage(B,T.x,T.y,N,N)}}function Se(){if(k.length){if(U){k.forEach((T,B)=>{z[B]&&(T.save(),T.setTransform(1,0,0,1,0,0),T.clearRect(0,0,z[B].width,z[B].height),T.restore(),b&&(T.save(),T.shadowColor="rgba(0,0,0,0.35)",T.shadowBlur=2,T.shadowOffsetY=2))});let S=V.length;for(let T=0;T<S;T++){let B=V[T];if(B&&B&&B.settled&&!B.isRemoved&&!B.el){let N=B.sizeIndex||0;k[N]&&ie(k[N],B)}}b&&k.forEach(T=>T.restore()),U=!1,$.length=0}else if($.length>0){b&&k.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let T=$[S];if(!T.isRemoved&&T.settled&&!T.el){let B=T.sizeIndex||0;k[B]&&ie(k[B],T)}}b&&k.forEach(S=>S.restore()),$.length=0}}}let Ne=a,_e=null,Re=performance.now(),se=0;function ee(S){(!H.pfRect||!H.wRect)&&j();let T=(S-Re)/1e3;Re=S,T>.1&&(T=.1);for(let N=V.length-1;N>=0;N--){let O=V[N];if(!O||!O)continue;if(S>=O.dieAt){fe(O,N);continue}if(O.sizeIndex===5&&!O.isRemoved&&(O.lastLightningTime||(O.lastLightningTime=S-1e3,O.nextLightningInterval=0),S-O.lastLightningTime>O.nextLightningInterval)){O.lastLightningTime=S,O.nextLightningInterval=200+Math.random()*100;for(let Te=0;Te<3;Te++)_o(O,S)}if(O.sizeIndex===6&&!O.isRemoved&&(O.lastLightningTime||(O.lastLightningTime=S-1e3,O.nextLightningInterval=0),S-O.lastLightningTime>O.nextLightningInterval&&(O.lastLightningTime=S,O.nextLightningInterval=200+Math.random()*100,R.collectBatch))){let Te=Le(O,S),Oe=Te.x+O.size/2,Pe=Te.y+O.size/2,ke=[],Ue=O.size/2*(O.size/2),Ce=V.length;for(let Xe=0;Xe<Ce;Xe++){let Ee=V[Xe];if(!Ee||Ee===O||Ee.isRemoved||Ee.settled===!1||Ee.sizeIndex>3)continue;let ze=Ee.x+(Ee.size||r)/2,He=Ee.y+(Ee.size||r)/2,nt=ze-Oe,Ge=He-Pe;nt*nt+Ge*Ge>Ue&&ke.push(Ee)}if(ke.length>0){for(let He=ke.length-1;He>0;He--){let nt=Math.floor(Math.random()*(He+1));[ke[He],ke[nt]]=[ke[nt],ke[He]]}let Xe=ke.slice(0,3),Ee=[],ze=!1;for(let He of Xe){let nt=He.size||r,Ge=He.x+nt/2,kt=He.y+nt/2;Co(O,Ge,kt),Qo(Ge,kt,nt),Ee.push({coin:He}),ze||(ft("sounds/lightning_strike.ogg",{volume:.25}),ze=!0)}Ee.length>0&&R.collectBatch(Ee)}}if(O.settled)continue;let de=S-O.startTime;if(de<0)continue;if(de/O.duration>=1){O.settled=!0,O.x=O.endX,O.y=O.endY,O.rot=0,O.scale=1,O.el&&!O.forceDom?(le(O.el),O.el=null,$.push(O)):O.el&&(O.el.style.transition="none",O.el.style.transform=`translate3d(${O.x}px, ${O.y}px, 0) rotate(0deg) scale(1)`);continue}}se+=Ne*T;let B=Math.floor(se);if(B>0){se-=B;let N=Math.min(B,u);if(N>0){let O=performance.now(),de=[],ue=5;for(let Te=0;Te<N&&!(performance.now()-O>ue);Te++){let Oe=J();Oe&&de.push(Oe)}de.length&&re(de)}}if(Se(),oe>50){let N=0;for(let O=0;O<V.length;O++){let de=V[O];de!==null&&(de.index=N,V[N++]=de)}V.length=N,oe=0}er(T),_e=requestAnimationFrame(ee)}function Ie(){if(!_e){if(!C()){console.warn("[Spawner] start() called but required nodes are missing.");return}j(),f>0&&_e===null&&ge(f),Re=performance.now(),_e=requestAnimationFrame(ee)}}function I(){_e&&(cancelAnimationFrame(_e),_e=null)}function X(S){Ne=Math.max(0,Number(S)||0)}function W(){se=0,Re=performance.now()}function te(S){let T=pt(2)&&!!S;for(let B=V.length-1;B>=0;B--){let N=V[B];if(N&&N){if(T&&N.sizeIndex>=4){N.mutationLevel=Ps?Si.toString():"0",N.el&&(N.el.dataset.mutationLevel=N.mutationLevel);continue}fe(V[B],B)}}W()}function me(S){S&&(x=S)}function ae(S){let T=S._coinObj;if(!T)return S.style.transform||"translate3d(0,0,0)";let{x:B,y:N,rot:O,scale:de}=Le(T,performance.now());return`translate3d(${B}px, ${N}px, 0) rotate(${O}deg) scale(${de})`}function qe(S){if(S.el)return S.el;if(S.isRemoved)return null;let T=Z(),B=S.size||r;return T.style.width=`${B}px`,T.style.height=`${B}px`,T.className=`coin coin--size-${S.sizeIndex||0}`,T.style.transition="",T.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,T.firstChild&&(T.firstChild.src=S.src),T.style.opacity="1",T.dataset.mutationLevel=S.mutationLevel,T._coinObj=S,S.el=T,E.c.appendChild(T),U=!0,T}function tt(S,T,B,N){let O=B;N&&(O=Math.max(B,260));let de=B*B,ue=[],Te=V.length,Oe=S-O,Pe=S+O,ke=T-O,Ue=T+O,Ce=performance.now();for(let Xe=0;Xe<Te;Xe++){let Ee=V[Xe];if(!Ee||Ee.bMaxX<Oe||Ee.bMinX>Pe||Ee.bMaxY<ke||Ee.bMinY>Ue)continue;let ze=Ee.size||r,He,nt;if(Ee.settled)He=Ee.x+ze/2,nt=Ee.y+ze/2;else{let yt=Le(Ee,Ce);He=yt.x+ze/2,nt=yt.y+ze/2}if(He<Oe||He>Pe||nt<ke||nt>Ue)continue;let Ge=He-S,kt=nt-T,ot=de;if(N&&(Ee.sizeIndex||0)>0){let yt=ze/2;ot=yt*yt}Ge*Ge+kt*kt<=ot&&(Ee.isRemoved||ue.push(Ee))}return ue}function ve(S,T,B,N,O,de){let ue=O;de&&(ue=Math.max(O,260));let Te=O*O,Oe=[],Pe=V.length,ke=Math.min(S,B)-ue,Ue=Math.max(S,B)+ue,Ce=Math.min(T,N)-ue,Xe=Math.max(T,N)+ue,Ee=B-S,ze=N-T,He=Ee*Ee+ze*ze,nt=Te*He,Ge=performance.now();for(let kt=0;kt<Pe;kt++){let ot=V[kt];if(!ot||ot.bMaxX<ke||ot.bMinX>Ue||ot.bMaxY<Ce||ot.bMinY>Xe)continue;let yt=ot.size||r,qt,Gt;if(ot.settled)qt=ot.x+yt/2,Gt=ot.y+yt/2;else{let on=Le(ot,Ge);qt=on.x+yt/2,Gt=on.y+yt/2}if(qt<ke||qt>Ue||Gt<Ce||Gt>Xe)continue;let kn=qt-S,It=Gt-T,At=kn*Ee+It*ze,Nt=Te;if(de&&(ot.sizeIndex||0)>0){let on=yt/2;Nt=on*on}let po=!1;if(At<=0)kn*kn+It*It<=Nt&&(po=!0);else if(At>=He){let on=qt-B,Xs=Gt-N;on*on+Xs*Xs<=Nt&&(po=!0)}else{let on=kn*ze-It*Ee;on*on<=Nt*He&&(po=!0)}po&&!ot.isRemoved&&Oe.push(ot)}return Oe}function Be(S){fe(S)}function $t(S,T,B){let N=B*B,O=[],de=V.length,ue=S-B,Te=S+B,Oe=T-B,Pe=T+B,ke=performance.now();for(let Ue=0;Ue<de;Ue++){let Ce=V[Ue];if(!Ce||Ce.bMaxX<ue||Ce.bMinX>Te||Ce.bMaxY<Oe||Ce.bMinY>Pe)continue;let Xe=Ce.size||r,Ee,ze;if(Ce.settled)Ee=Ce.x+Xe/2,ze=Ce.y+Xe/2;else{let Ge=Le(Ce,ke);Ee=Ge.x+Xe/2,ze=Ge.y+Xe/2}if(Ee<ue||Ee>Te||ze<Oe||ze>Pe)continue;let He=Ee-S,nt=ze-T;He*He+nt*nt<=N&&(!Ce.el&&!Ce.isRemoved&&qe(Ce),Ce.el&&O.push(Ce.el))}return O}function st(S,T,B,N,O){let de=O*O,ue=[],Te=V.length,Oe=Math.min(S,B)-O,Pe=Math.max(S,B)+O,ke=Math.min(T,N)-O,Ue=Math.max(T,N)+O,Ce=B-S,Xe=N-T,Ee=Ce*Ce+Xe*Xe,ze=de*Ee,He=performance.now();for(let nt=0;nt<Te;nt++){let Ge=V[nt];if(!Ge||Ge.bMaxX<Oe||Ge.bMinX>Pe||Ge.bMaxY<ke||Ge.bMinY>Ue)continue;let kt=Ge.size||r,ot,yt;if(Ge.settled)ot=Ge.x+kt/2,yt=Ge.y+kt/2;else{let At=Le(Ge,He);ot=At.x+kt/2,yt=At.y+kt/2}if(ot<Oe||ot>Pe||yt<ke||yt>Ue)continue;let qt=ot-S,Gt=yt-T,kn=qt*Ce+Gt*Xe,It=!1;if(kn<=0)qt*qt+Gt*Gt<=de&&(It=!0);else if(kn>=Ee){let At=ot-B,Nt=yt-N;At*At+Nt*Nt<=de&&(It=!0)}else{let At=qt*Xe-Gt*Ce;At*At<=ze&&(It=!0)}It&&(!Ge.el&&!Ge.isRemoved&&qe(Ge),Ge.el&&ue.push(Ge.el))}return ue}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;_e||Ie()}});function nn(){C()&&ge(1)}let Tt=[],dn=[];function fo(S,T){if(!S||!T)return;let B=S.size||r,N=T.size||r,O=S.x+B/2,de=S.y+B/2,ue=T.x+N/2,Te=T.y+N/2;Tt.push({x1:O,y1:de,x2:ue,y2:Te,age:0,life:.15})}function Qo(S,T,B){if(!E.pf)return;let N=document.createElement("div");N.className="coin-stain";let O=B*1.2;N.style.width=`${O}px`,N.style.height=`${O}px`,N.style.left=`${S-O/2}px`,N.style.top=`${T-O/2}px`,E.pf.appendChild(N),setTimeout(()=>{N.style.opacity="0",setTimeout(()=>{N.parentNode&&N.remove()},1e3)},2500)}function _o(S,T){let B=Math.random()*Math.PI*2,N=(S.size||r)/2,O=N*a0,de=Math.cos(B)*O,ue=Math.sin(B)*O,Te=N*(.7+Math.random()*.6),Oe=Math.cos(B)*(O+Te),Pe=Math.sin(B)*(O+Te);Tt.push({parentCoin:S,relX1:de,relY1:ue,relX2:Oe,relY2:Pe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let ke=3+Math.floor(Math.random()*3);for(let Ue=0;Ue<ke;Ue++){let Ce=.3+Math.random()*.5,Xe=de+(Oe-de)*Ce,Ee=ue+(Pe-ue)*Ce,ze=B+(Math.random()*1.2-.6),He=Te*(.4+Math.random()*.4),nt=Xe+Math.cos(ze)*He,Ge=Ee+Math.sin(ze)*He;Tt.push({parentCoin:S,relX1:Xe,relY1:Ee,relX2:nt,relY2:Ge,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ft("sounds/lightning_zap.ogg",{volume:.25})}function Co(S,T,B){if(!S)return;let N=S.size||r,O=performance.now(),de=Le(S,O),ue=de.x+N/2,Te=de.y+N/2,Oe=T-ue,Pe=B-Te,ke=Math.atan2(Pe,Oe),Ue=Math.sqrt(Oe*Oe+Pe*Pe),Ce=N/2*a0,Xe=Math.cos(ke)*Ce,Ee=Math.sin(ke)*Ce;Tt.push({parentCoin:S,relX1:Xe,relY1:Ee,x2:T,y2:B,age:0,life:.25,width:6,jaggedScale:25});let ze=ue+Xe,He=Te+Ee,nt=6+Math.floor(Math.random()*5);for(let Ge=0;Ge<nt;Ge++){let kt=.1+Math.random()*.8,ot=ze+(T-ze)*kt,yt=He+(B-He)*kt,qt=ke+(Math.random()*1.6-.8),Gt=Ue*(.1+Math.random()*.3),kn=ot+Math.cos(qt)*Gt,It=yt+Math.sin(qt)*Gt;if(Tt.push({x1:ot,y1:yt,x2:kn,y2:It,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Nt=ot+(kn-ot)*.5,po=yt+(It-yt)*.5,on=qt+(Math.random()*1-.5),Xs=Gt*.5;Tt.push({x1:Nt,y1:po,x2:Nt+Math.cos(on)*Xs,y2:po+Math.sin(on)*Xs,age:0,life:.25,width:1.5,jaggedScale:10})}}}function er(S){if(!F||!M)return;F.clearRect(0,0,M.width,M.height);let T=performance.now();F.lineCap="round",F.lineJoin="round";for(let B=Tt.length-1;B>=0;B--){let N=Tt[B];if(N.age+=S,N.age>=N.life){Tt.splice(B,1);continue}let O=N.x1,de=N.y1,ue=N.x2,Te=N.y2;if(N.parentCoin){let ke=Le(N.parentCoin,T),Ue=ke.x+(N.parentCoin.size||r)/2,Ce=ke.y+(N.parentCoin.size||r)/2;O=Ue+N.relX1,de=Ce+N.relY1,N.relX2!==void 0&&(ue=Ue+N.relX2,Te=Ce+N.relY2)}let Oe=1-N.age/N.life;F.strokeStyle=`rgba(200, 240, 255, ${Oe})`,F.lineWidth=N.width||3,F.shadowColor="rgba(220, 245, 255, 0.9)",F.shadowBlur=20;let Pe=6;F.beginPath(),F.moveTo(O,de);for(let ke=1;ke<=Pe;ke++){let Ue=ke/Pe,Ce=O+(ue-O)*Ue,Xe=de+(Te-de)*Ue;if(ke===Pe)F.lineTo(ue,Te);else{let Ee=-(Te-de),ze=ue-O,He=Math.sqrt(Ee*Ee+ze*ze),nt=N.jaggedScale||40;if(He>0){let Ge=(Math.random()-.5)*nt*(1-Math.abs(Ue-.5));F.lineTo(Ce+Ee/He*Ge,Xe+ze/He*Ge)}else F.lineTo(Ce,Xe)}}F.stroke(),F.shadowBlur=0}for(let B=dn.length-1;B>=0;B--){let N=dn[B];if(N.age+=S,N.age>=N.life){dn.splice(B,1);continue}N.x+=N.vx*S,N.y+=N.vy*S;let O=1-N.age/N.life;F.fillStyle=N.color,F.globalAlpha=O,F.beginPath(),F.arc(N.x,N.y,N.size,0,Math.PI*2),F.fill(),F.globalAlpha=1}}return{start:Ie,stop:I,setRate:X,clearBacklog:W,clearPlayfield:te,setCoinSprite:me,getCoinTransform:ae,findCoinsInRadius:$t,findCoinsInPath:st,findCoinTargetsInRadius:tt,findCoinTargetsInPath:ve,ensureCoinVisual:qe,removeCoinTarget:Be,detachCoin:L,recycleCoin:le,playEntranceWave:nn,setDependencies:_,hasBigCoins:()=>pt(2)&&V.some(S=>S&&S.sizeIndex>=4)}}var Ps,Si,cx,i0,fx,s0,a0,px,mx,l0,hx,f0=De(()=>{kl();So();bo();no();An();gm();vo();Ps=!1,Si=0n,cx=2500,i0=new Map;try{c0(at())}catch{Ps=!1,Si=0n}try{ii(e=>{c0(e)})}catch{}fx="cubic-bezier(0.215, 0.61, 0.355, 1)";s0=[40,55,80,125,200,320,512],a0=.78,px=[1,25,625,15625,390625,9765625,244140625],mx=[0,.1,.01,.001,1e-4,1e-5,1e-6],l0=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],hx=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var b0={};vt(b0,{afterSlotWrite:()=>Im,beforeSlotWrite:()=>Sm});function g0(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Sx(e,t=vx){!e||e<=0||pl.set(e,g0()+t)}function p0(e){if(!e||e<=0)return!1;let t=pl.get(e);return t==null?!1:t<=g0()?(pl.delete(e),!1):!0}function Ix(){pl.clear()}function Pu(){try{return typeof localStorage<"u"}catch{return!1}}function bm(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function y0(e){let t=new Map;if(!Pu())return ml.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Li))continue;let r=bm(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return ml.set(e,t),t}function v0(e){return!Number.isFinite(e)||e<=0?null:ml.has(e)?ml.get(e):y0(e)}function Sm(e){if(!Pu()||Ou>0)return;let t=String(e);if(!t.startsWith(Li))return;let n=bm(t);if(n==null)return;let o=v0(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(Ou===0){Ou+=1;try{pn(n)}finally{Ou-=1}}y0(n);return}}}catch{}}function Im(e,t){let n=String(e);if(!n.startsWith(Li))return;let o=bm(n);if(o==null)return;let r=v0(o)||new Map;r.set(n,String(t??"")),ml.set(o,r)}function wx(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function Ex(){let e=new Map;if(!Pu())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Li))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=nf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function xx(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=v();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function Lx(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=of(e);if(n.length===0){o&&(p0(e)||pn(e),Ll(e,null));return}let r=wx(n);o&&r!==o&&!p0(e)&&pn(e),r!==o&&Ll(e,r)}function Fs(){if(!Pu())return;let e=Ex();xx(e).forEach(n=>{let o=e.get(n)??[];Lx(n,o)})}function _x(){if(ym!=null)return;ym=(typeof window<"u"?window:globalThis).setTimeout(()=>{ym=null,Fs()},bx)}function Cx(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){Sx(o),_x();return}pl.delete(o),Fs()}}function Mx(){typeof window>"u"||d0==null&&(d0=window.setInterval(Fs,yx))}function Tx(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function Bs(){let e=Tx();if(!e)return;if(!_i()){(e.dataset.poopShopApplied===vm||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==m0||e.dataset.poopShopApplied!==vm)&&(e.style.backgroundImage=m0,e.dataset.poopShopApplied=vm)}function kx(){typeof window>"u"||h0==null&&(Bs(),h0=window.setInterval(Bs,50),window.addEventListener("saveSlot:change",Bs),window.addEventListener("saveSlot:modified",e=>{try{let t=v();e?.detail?.slot===t&&Bs()}catch{Bs()}}))}function Ax(){typeof window>"u"||(Fs(),Mx(),kx(),window.addEventListener("saveSlot:change",()=>Fs()),window.addEventListener("saveIntegrity:storageMutation",Cx,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(Ix(),Fs(),Bs())}))}var yx,vx,bx,d0,ym,pl,ml,Ou,m0,vm,h0,wm=De(()=>{bt();yx=1e4,vx=750,bx=50,d0=null,ym=null,pl=new Map;ml=new Map,Ou=0;m0="linear-gradient(180deg,#a9793d,#7b5534)",vm="1",h0=null;Ax()});var T0={};vt(T0,{initPopups:()=>Bx,teardownpopups:()=>Fx});function Em(){return uo||(uo=document.createElement("div"),uo.className="currency-popups",uo.setAttribute("aria-live","polite"),uo.setAttribute("aria-atomic","false"),document.body.appendChild(uo),uo)}function Ii(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function xm(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function I0(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):Q(n);t&&(t.innerHTML=r)}function Rx(e,t=w0){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{hl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function Ox(e,t,n){Em();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function Lm(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=v();if(o!=null){if(["xp"].includes(e)){if(rn(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(rn(`ccc:mutation:progress:${o}`))return}else if(Object.values(Me).includes(e)&&Nn(e,o))return}let r=Nx[e],i=Object.assign({duration:w0,accumulate:!0},r||{},n);if(!i.icon)return;let s=Ii(t);if(!s||xm(s))return;let l=i.accumulate!==!1?hl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,I0(l);return}let a=Ox(e,i,s);a.meta=i,I0(a),hl.set(e,a);let u=Em(),d=S0.indexOf(e),f=null;if(d>=0){let p=Array.from(u.children);for(let g of p){let m=g.dataset.type;if(S0.indexOf(m)>d){f=g;break}}}f?u.insertBefore(a.element,f):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),Rx(a,i.duration)}function Px(){let e={};for(let t of Object.values(Me))e[t]=js(t);return e}function E0(){try{let e=Px();Object.entries(e).forEach(([t,n])=>{let o=Ii(n)||c.fromInt(0);kr.set(t,o.clone?.()??o)}),kr.has("mp")||kr.set("mp",c.fromInt(0))}catch{kr.clear()}}function x0(){hl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),hl.clear()}function L0(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Ii(t.value)||c.fromInt(0),r=kr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Ii(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&Lm(n,s),kr.set(n,o.clone?.()??o)}function _0(e){let t=e?.detail;if(!t)return;let n=Ii(t.xpAdded);n&&!xm(n)&&Lm("xp",n)}function C0(e){let t=e?.detail;if(!t)return;let n=Ii(t.delta);n&&!xm(n)&&Lm("mp",n);let o=Ii(t.progress);o&&kr.set("mp",o.clone?.()??o)}function M0(){x0(),E0()}function Bx(){Bu||(Bu=!0,Em(),E0(),window.addEventListener("currency:change",L0),window.addEventListener("xp:change",_0),window.addEventListener("mutation:change",C0),window.addEventListener("saveSlot:change",M0))}function Fx(){Bu&&(window.removeEventListener("currency:change",L0),window.removeEventListener("xp:change",_0),window.removeEventListener("mutation:change",C0),window.removeEventListener("saveSlot:change",M0),x0(),kr.clear(),uo&&uo.remove(),uo=null,Bu=!1)}var w0,S0,Nx,uo,Bu,kr,hl,k0=De(()=>{xt();Yt();bt();w0=6767,S0=["coins","xp","books","gold","mp","magic","gears"],Nx={[Me.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Me.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Me.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Me.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Me.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"}},uo=null,Bu=!1,kr=new Map,hl=new Map});var U0={};vt(U0,{flushBackupSnapshot:()=>F0,getSuspendMetadata:()=>eL,installSuspendSafeguards:()=>Qx,markProgressDirty:()=>Lo,restoreFromBackupIfNeeded:()=>Jx});function gl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function Gs(){if(typeof localStorage>"u")return!1;try{let e=`${Kn}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function O0(){if(!gl())throw new Error("IndexedDB unavailable");return Us||(Us=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(Ux,Dx);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(qs)||r.createObjectStore(qs)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}Us=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw Us=null,e}),Us)}function Hx(){if(!Gs())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(Kn))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function Xx(e){try{let t=await O0();return await new Promise((n,o)=>{let r=!1,i=t.transaction(qs,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(qs).put(e,R0);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function Vx(){try{let e=await O0();return await new Promise((t,n)=>{let o=!1,r=e.transaction(qs,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(qs).get(R0);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function Yx(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function _m(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function Wx(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function Kx(e){return!(typeof e!="string"||e.length===0||zx.test(e))}function Cm(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(Kn)||n.startsWith($x)||n.startsWith(qx))return;let o=Wx(n);if(o!=null)try{let r={key:n,slot:o,trusted:Kx(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function jx(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=_m(),a=String(i),u=this===localStorage&&a.startsWith(Kn);if(u)try{Sm(a)}catch{}let d;try{d=t.apply(this,arguments)}finally{try{if(u){Lo("setItem");try{Im(a,s)}catch{}}this===localStorage&&a.startsWith(Kn)&&Cm(a,l)}catch{}}return d}),typeof n=="function"&&(e.removeItem=function(i){let s=_m(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(Kn)&&(Lo("removeItem"),Cm(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=_m(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Lo("clear"),Cm(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function P0(e="idle"){$s=e||$s,Ar=!0,!Ds&&(Ds=setTimeout(()=>{if(Ds=null,!Ar)return;let t=$s;Ar=!1,F0(t)},Gx))}function B0(){Ds&&(clearTimeout(Ds),Ds=null)}function Lo(e="dirty"){try{P0(e)}catch{}}async function Mm(e="manual"){if(!Gs()||!gl())return!1;let t=Hx();if(!t)return!1;t.reason=e,Uu=!1;let n=await Xx(t);return n||(Ar=!0,P0("retry")),n}async function F0(e="manual",{immediate:t=!1}={}){return!Gs()||!gl()?!1:t?(B0(),Ar=!1,Uu=!0,Mm(e)):(Ar=!0,$s=e||$s,Mm(e))}function Fu(e){!gl()||!Gs()||(B0(),Ar=!1,Uu=!0,Mm(e))}function Zx(){if(!Gs())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(Kn))return!0}}catch{}return!1}async function Jx(){if(N0||(N0=!0,!Gs()||!gl()))return!1;let e=!1;try{if(!Zx())e=!0;else{let o=localStorage.getItem(`${Kn}saveSlot`);if(o){let r=`${Kn}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await Vx();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Lo("restored"),n}function Qx(){if(A0||(A0=!0,typeof window>"u"))return;Yx(),jx();let e=()=>{document.hidden?Fu("visibility-hidden"):Lo("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>Fu("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>Fu("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>Fu("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Lo("pageshow"))}catch{}try{window.addEventListener("focus",()=>Lo("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(Kn)||Lo("storage-event"))})}catch{}Lo("boot")}function eL(){return{pendingImmediateFlush:Uu,dirty:Ar,lastDirtyReason:$s}}var Kn,Ux,Dx,qs,R0,$x,qx,Gx,Us,Ds,Ar,$s,A0,N0,Uu,zx,D0=De(()=>{wm();Kn="ccc:",Ux="ccc:safety",Dx=1,qs="snapshots",R0="latest",$x=`${Kn}slotSig`,qx=`${Kn}slotMod`,Gx=1e3,Us=null,Ds=null,Ar=!1,$s="init",A0=!1,N0=!1,Uu=!1;zx=/\bat <anonymous>:\d+:\d+\b/});var $0={};vt($0,{initGlobalOverlayEsc:()=>oL});function nL(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i}of tL){let s=document.querySelectorAll(o);if(s.length>0){if(i){t=!0;continue}let a=s[s.length-1].querySelector(r||".shop-close");a&&(a.click(),n=!0)}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function oL(){window.addEventListener("keydown",nL,!0)}var tL,q0=De(()=>{tL=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".automation-shop-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close"}]});var G0={};vt(G0,{ensureGameDom:()=>rL});function rL(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>
`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var H0=De(()=>{});function aL(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function lL(){if(!je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function uL(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let d=document.createElement("div");d.textContent=je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(d.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),d.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),d.textContent="Loading skipped",d.style.textDecoration="none",d.style.cursor="default",t())}),o.appendChild(d)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function fL(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function dL(e){if(!e||e.__done)return;e.__done=!0;let t=500;e.__label&&(e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let n=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,450)},t)}async function Nm(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function pL(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function mL(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(An(),bl));await o(n)}catch{}try{t?.(n)}catch{}return n})}function hL(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function gL({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...pL(e,s),...mL(t,s),...n?hL(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function yL(e){if(Hs===e)return;tn&&(tn.stop(),tn=null),Hs=e;let t=document.querySelector(".menu-root");switch(e){case Jo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Hs===Jo.STARTER_COVE&&(tn=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},25)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Dm=="function"&&Dm(n,80),wi){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(wi.init("water-background",i),$u){try{$u()}catch{}$u=null}if(qu){try{qu()}catch{}qu=null}typeof Fm=="function"&&($u=Fm(s=>wi.update(s))),typeof Um=="function"&&(qu=Um((s,l)=>wi.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,wi&&requestAnimationFrame(()=>wi.resize()),ib()),typeof Om=="function")try{Om()}catch{}if(typeof Pm=="function")try{Pm()}catch{}if(!en){en=ob({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=en;let i=()=>{if(!(!en||typeof en.setCoinSprite!="function"))try{en.setCoinSprite(cb?.())}catch{}};i(),ub?.(i);let s=rb({spawner:en});en&&typeof en.setDependencies=="function"&&en.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=sb(),u=ab(a);if(en&&u?.coinsPerSecondMult){let d=1*u.coinsPerSecondMult;if(typeof Bm=="function"){let f=Bm("spawnRate",d);try{f&&typeof f.toScientific=="function"?d=Number(f.toScientific(6)):d=Number(f)}catch{}}Number.isFinite(d)&&en.setRate(d)}}catch{}};if(l(),typeof Am=="function")try{Am()}catch{}Am=lb(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof Rm=="function")try{Rm()}catch{}en.start();break}case Jo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),en&&en.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Jo.MENU}}))}catch{}}var iL,je,X0,ob,rb,ib,V0,Y0,W0,z0,K0,j0,Z0,sb,ab,Rm,lb,sL,J0,Q0,eb,Tm,km,Om,Pm,cb,ub,Du,Bm,tb,Fm,Um,nb,Dm,wi,$u,qu,Jo,Hs,tn,en,Am,Gu,cL,bo=De(()=>{An();iL=!0,je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia?window.matchMedia("(pointer: coarse)").matches:"ontouchstart"in window;return window.IS_MOBILE=e,e})();je&&document.documentElement.classList.add("is-mobile");$u=null,qu=null;lL();Jo={MENU:0,STARTER_COVE:1},Hs=Jo.MENU,tn=null,en=null,Am=null,Gu=()=>new Promise(e=>requestAnimationFrame(e)),cL=async()=>{await Gu(),await Gu()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(q=>{e=q}),n=uL("Loading assets...",e);await Gu();let{initAudio:o}=await Promise.resolve().then(()=>(An(),bl));o();let r=Promise.all([Promise.resolve().then(()=>(lf(),rh)),Promise.resolve().then(()=>(f0(),u0)),Promise.resolve().then(()=>(xa(),ay)),Promise.resolve().then(()=>(Ac(),zg)),Promise.resolve().then(()=>(bt(),eh)),Promise.resolve().then(()=>(wm(),b0)),Promise.resolve().then(()=>(yn(),Sv)),Promise.resolve().then(()=>(kl(),sh)),Promise.resolve().then(()=>(Zn(),wh)),Promise.resolve().then(()=>(vo(),Vy)),Promise.resolve().then(()=>(So(),Jv)),Promise.resolve().then(()=>(k0(),T0)),Promise.resolve().then(()=>(D0(),U0)),Promise.resolve().then(()=>(Fi(),Th)),Promise.resolve().then(()=>(q0(),$0)),Promise.resolve().then(()=>(Pi(),zv)),Promise.resolve().then(()=>(Gr(),Ah)),Promise.resolve().then(()=>(oc(),ig)),Promise.resolve().then(()=>(Xi(),$h)),Promise.resolve().then(()=>(yc(),Ng)),Promise.resolve().then(()=>(H0(),G0)),Promise.resolve().then(()=>(no(),ng)),Promise.resolve().then(()=>(gm(),r0)),Promise.resolve().then(()=>(Ia(),Vh))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(q,Z)=>`img/mutations/m${Z+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=gL(i,q=>{s=q,fL(n,q)}),[a,u,d,f,p,g,m,y,h,b,x,E,C,A,z,k,U,M,F,R,_,H,j,ye]=await r;({initSlots:X0}=a),{createSpawner:ob}=u,{initCoinPickup:rb}=d,{initHudButtons:ib}=f,{bank:z0,getHasOpenedSaveSlot:K0,setHasOpenedSaveSlot:j0,ensureStorageDefaults:Z0,notifyGameSessionStarted:nb}=p,{getCurrentAreaKey:sb,computeUpgradeEffects:ab,onUpgradesChanged:lb}=m,{registerPreloadedAudio:sL}=y,{initXpSystem:Rm}=h,{initResetSystem:Om}=b,{initMutationSystem:Pm,getMutationCoinSprite:cb,onMutationChange:ub}=x,{initPopups:J0}=E,{installSuspendSafeguards:Q0,restoreFromBackupIfNeeded:eb,markProgressDirty:Tm,flushBackupSnapshot:km}=C,{installGhostTapGuard:V0,initGlobalGhostTap:Y0}=A,{initGlobalOverlayEsc:W0}=z,{setDebugPanelAccess:Du,applyStatMultiplierOverride:Bm}=k,{startGameLoop:tb,registerTick:Fm,registerFrame:Um}=U;let{initOfflineTracker:K,processOfflineProgress:ne}=M,{initWorkshopSystem:pe}=F,{initAutomationEffects:be}=R;({ensureGameDom:Dm}=_);let{initSurgeEffects:V}=H;({waterSystem:wi}=j);let{initLabLogic:oe}=ye;window.bank=z0,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(tn){try{tn.stop()}catch{}tn=null}}),window.addEventListener("audio:restartMusic",()=>{if(tn){try{tn.stop()}catch{}tn=null}Hs===Jo.STARTER_COVE&&(tn=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",q=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return q.preventDefault(),q.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let q=document.hidden;Xu(q),tn&&tn.element&&(q?tn.element.pause():tn.element.play().catch(()=>{}))}),V0?.(),Y0?.(),W0?.(),Q0?.(),typeof Du=="function"&&(Du(iL),window.setDebugPanelAccess=Du);try{await eb?.()}catch{}await Promise.race([l,t]),await cL(),document.documentElement.classList.remove("booting"),await Gu(),dL(n),await Promise.all([Nm("img/currencies/coin/coin_plus_base.webp"),Nm("img/stats/xp/xp_plus_base.webp"),Nm("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}tb(),K(()=>Hs===Jo.STARTER_COVE);try{pe()}catch(q){console.error("Workshop init failed",q)}try{be()}catch(q){console.error("Automation init failed",q)}try{V()}catch(q){console.error("Surge effects init failed",q)}try{oe()}catch(q){console.error("Lab system init failed",q)}aL(),Z0(),Tm?.("ensure-defaults"),J0();let $=document.getElementById("panel-title");if(K0()?(document.body.classList.add("has-opened"),$&&($.style.opacity="0")):$&&($.style.opacity="1"),X0(()=>{Hs!==Jo.STARTER_COVE&&(j0(!0),document.body.classList.add("has-opened"),$&&($.style.opacity="0"),yL(Jo.STARTER_COVE),ne(),window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave(),nb?.(),Tm?.("slot-entered"))}),typeof window<"u"&&km)try{window.cccRequestBackup=()=>km("manual",{immediate:!0})}catch{}})});bo();})();
