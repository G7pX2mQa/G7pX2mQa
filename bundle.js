(()=>{var $S=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var vt=(e,t)=>{for(var n in t)$S(e,n,{get:t[n],enumerable:!0})};var tc={};vt(tc,{initAudio:()=>qS,loadAudio:()=>Dh,playAudio:()=>ft,registerPreloadedBuffer:()=>HS,setAudioSuspended:()=>Af,setMusicUnderwater:()=>Wr});function kf(){if(Wt)return Wt;let e=window.AudioContext||window.webkitAudioContext;return e?(Wt=new e,Ia=Wt.createGain(),Ia.connect(Wt.destination),Ia.gain.value=1,Ql=Wt.createGain(),Ql.gain.value=1,Ql.connect(Ia),Eo=Wt.createBiquadFilter(),Eo.type="lowpass",Eo.frequency.value=22050,Eo.Q.value=1,Eo.connect(Ql),Wt):null}function qS(){kf()}function GS(){Wt&&Wt.state==="suspended"&&Wt.resume().catch(()=>{})}async function Dh(e){let t=kf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(wa.has(n))return wa.get(n);if(ec.has(n))return ec.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return wa.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{ec.delete(n)}})();return ec.set(n,o),o}function ft(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=kf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=wa.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(Eo):f.connect(Ia),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else Dh(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function HS(e,t){let n=new URL(e,document.baseURI).href;wa.set(n,t)}function Af(e){Wt&&(e?Wt.state==="running"&&Wt.suspend().catch(()=>{}):Wt.state==="suspended"&&Wt.resume().catch(()=>{}))}function Wr(e){if(!Eo)return;let t=e?600:22050;try{let n=Wt.currentTime;Eo.frequency.cancelScheduledValues(n),Eo.frequency.setValueAtTime(t,n)}catch{Eo.frequency.value=t}}var Wt,Ia,Ql,Eo,wa,ec,En=De(()=>{Wt=null,Ia=null,Ql=null,Eo=null,wa=new Map,ec=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,GS,{capture:!0,passive:!0})})});function Ee(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let m=Number(e.sig);if(m>0){let y=Math.log10(m),p=e.e||0,h=Number(e._eOffset||0n);return y+p+h}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let m=Number(u);if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)}else{let m=Number(u.slice(0,15));if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function ue(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function Nf(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/$h;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/$h:e>0?e:0}var c,$h,Et=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",m=BigInt(u+d);return new e(m,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,{base:this.e-(n|0),offset:this._eOffset},this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};$h=Math.log(10)});function Hh(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return Gh.format(t)}catch{return String(e)}}function Ea(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function Rf(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+Hh(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+Gh.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=Of.get(u)||"",m=o-u+1,y=4-m,p=m+y;n.length<p+1&&(n+="0".repeat(p+1-n.length));let h=n.slice(0,p);(n.charCodeAt(p)||48)>=53&&(h=Ea(h));let v,w;return h.length>p?(v=h.slice(0,m+1),w="0".repeat(y)):(v=h.slice(0,m),w=h.slice(m)),t+`${v}${y?"."+w:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Ea(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+Rf(String(o))}function VS(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Rf(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=Ea(f)),l){let C=f.slice(0,1)+"."+f.slice(1),A=i==="-"?"-":"";return t+C+"e"+Rf(s,A)}let m=Math.floor(a/3)*3,y=Of.get(m)||"",h=a-m+1,g=4-h,v,w;return f.length>4?(v=f.slice(0,h+1),w="0".repeat(g)):(v=f.slice(0,h),w=f.slice(h)),t+(i==="-"?"-":"")+v+(g?"."+w:"")+y}function qh(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Ea(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+VS(l)}function j(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return qh(e.toScientific(3));if(t<6)return Hh(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=Of.get(n);if(!o)return qh(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Ea(u));let d,m;return u.length>l?(d=u.slice(0,i+1),m="0".repeat(s)):(d=u.slice(0,i),m=u.slice(i)),`${d}${s?"."+m:""}${o}`}function Pe(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=Ee(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return j(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):j(c.fromAny(t))}catch{return"1"}}var XS,Of,Gh,zt=De(()=>{Et();XS=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],Of=new Map(XS),Gh=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var eg={};vt(eg,{CURRENCIES:()=>Re,KEYS:()=>St,STORAGE_PREFIX:()=>Wi,bank:()=>R,clearActiveSlot:()=>oI,clearAllStorage:()=>aI,ensureCurrencyDefaults:()=>Yf,ensureMultiplierDefaults:()=>Wf,ensureStorageDefaults:()=>sI,getActiveSlot:()=>b,getCurrency:()=>_a,getCurrencyMultiplierBN:()=>Qh,getHasOpenedSaveSlot:()=>iI,getLastSaveTime:()=>Gf,getLastSaveTimeKey:()=>sc,getSlotModifiedFlagKey:()=>rI,getSlotSignature:()=>Vf,getSlotSignatureKey:()=>Xf,hasModifiedSave:()=>zi,isCurrencyLocked:()=>Hn,isStorageKeyLocked:()=>Kt,markSaveSlotModified:()=>xn,notifyGameSessionStarted:()=>tI,onCurrencyChange:()=>ic,peekCurrency:()=>Ma,primeStorageWatcherSnapshot:()=>ct,setActiveSlot:()=>Hf,setCurrency:()=>Vi,setCurrencyMultiplierBN:()=>cc,setHasOpenedSaveSlot:()=>lc,setSlotSignature:()=>ac,updateLastSaveTime:()=>Zh,watchStorageKey:()=>kt});function Ff(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Uf(e){let t=Ff(e);return t==null?null:`${YS}:${t}`}function Df(e){let t=Ff(e);return t==null?null:`${WS}:${t}`}function zh(e={}){nc.size!==0&&nc.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function ic(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return nc.add(o),()=>{nc.delete(o)}}function KS(){if(xa!=null||qo.size===0)return;xa=(typeof window<"u"?window:globalThis).setInterval(ZS,zS)}function Kh(){if(qo.size!==0||xa==null)return;(typeof window<"u"?window:globalThis).clearInterval(xa),xa=null}function jh(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function jS(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function ZS(){if(qo.size===0){Kh();return}qo.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=jh(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!jS(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function kt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=qo.get(e);return s||(s=new Set,qo.set(e,s)),s.add(i),KS(),()=>{let l=qo.get(e);l&&(l.delete(i),l.size===0&&(qo.delete(e),Kh()))}}function ct(e,t){if(!e)return;let n=qo.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=jh(r,o),r.initialized=!0)})}function $f(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function JS(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function QS(){Pf.forEach(e=>{try{e?.()}catch{}}),Pf.clear()}function Vh(e){if(e!==Xh&&(QS(),Xh=e??null,e!=null))for(let t of Object.values(Re)){let n=`${St.CURRENCY[t]}:${e}`,o=kt(n,{parse:JS,equals:$f,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};zh(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Pf.set(n,o)}}function eI(){typeof window>"u"||(Vh(b()),window.addEventListener("saveSlot:change",()=>{Vh(b())}))}function tI(){qf=!0}function sc(e=b()){return e==null?null:`${gr}lastSaveTime:${e}`}function Zh(){if(!qf||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(sc(e),String(t))}catch{}}function Gf(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(sc(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function nI(){typeof window>"u"||(Yh||(Yh=setInterval(Zh,1e3)),window.addEventListener("beforeunload",()=>{if(!qf)return;let e=b();if(e!=null)try{localStorage.setItem(sc(e),String(Date.now()))}catch{}}))}function b(){if(mr!==void 0)return mr;let e=localStorage.getItem(St.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return mr=n,n}function Hf(e){let t=Math.max(1,parseInt(e,10)||1);mr=t,localStorage.setItem(St.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function oI(){mr=null,localStorage.removeItem(St.SAVE_SLOT)}function La(e,t=b()){return t==null?null:`${e}:${t}`}function Jh(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Kt(e){return Jh(e)}function Xf(e=b()){return Uf(e)}function rI(e=b()){return Df(e)}function Vf(e=b()){if(typeof localStorage>"u")return null;let t=Uf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function ac(e,t){if(typeof localStorage>"u")return;let n=Uf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function zi(e=b()){if(typeof localStorage>"u")return!1;let t=Df(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function xn(e=b()){if(typeof localStorage>"u")return;let t=Ff(e);if(t==null||zi(t))return;let n=Df(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function iI(){return localStorage.getItem(St.HAS_OPENED_SAVE_SLOT)==="true"}function lc(e){localStorage.setItem(St.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function sI(){localStorage.getItem(St.HAS_OPENED_SAVE_SLOT)===null&&lc(!1)}function Yf(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${St.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function Wf(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${St.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))rc(t);else{let o=hr(c.fromInt(1));Yi(t,o)}}}function _a(e){let t=La(St.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Vi(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=La(St.CURRENCY[e],r),s=o??_a(e),l=c.fromInt(0);if(!i||Hn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,m=a;try{f!=null&&(m=c.fromAny(f),m.isNegative?.()&&(m=c.fromInt(0)))}catch{}ct(i,d);let y=!$f(s,m),h=(v=>{if(v==null)return null;try{let w=v instanceof c?v.clone?.()??v:c.fromAny(v);if(typeof w.cmp=="function")return w.cmp(l)>0?w:null;if(!w.isZero?.())return w}catch{}return null})(n),g=null;if(y)try{g=m.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=h),y||g){let v={key:e,value:m,slot:r,delta:g??void 0};zh(v);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:v}))}catch{}}return m}function hr(e){return e.mulScaledIntFloor(1n,-Bf)}function oc(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,Bf)}function rc(e){let t=La(St.MULTIPLIER[e]);if(!t)return hr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(zr)){let r=hr(c.fromInt(1));return Yi(e,r),r}let o=n.slice(zr.length);try{return c.fromAny(o)}catch{let r=hr(c.fromInt(1));return Yi(e,r),r}}function Yi(e,t,n=b()){let o=La(St.MULTIPLIER[e],n);if(!o||Hn(e,n))return;let r=hr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(zr))try{r=c.fromAny(i.slice(zr.length))}catch{}let s=c.fromAny(t),l=zr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(zr)?u.slice(zr.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{ct(o,u)}catch{}if(!$f(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:oc(f),slot:n}}))}catch{}}function Qh(e){return oc(rc(e))}function Hn(e,t=b()){let n=La(St.CURRENCY[e],t);return Jh(n)}function cc(e,t){let n=c.fromAny(t),o=hr(n);return Yi(e,o,b()),n}function Ma(e,t){let n=localStorage.getItem(`${St.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function aI(){Object.values(St).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function Wh(e){let t=n=>{try{let o=c.fromAny(n);return typeof j=="function"?j(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return _a(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Vi(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Vi(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Vi(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof j=="function"?j(r):r.toString()},t.mult={get(){return Qh(e)},set(n){return cc(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=rc(e).mulBigNumInteger(o);return r.isZero()&&(r=hr(c.fromInt(1))),Yi(e,r),oc(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),Bf)}catch{o={numer:1n,scale:0}}let r=rc(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=hr(c.fromInt(1))),Yi(e,r);let i=oc(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var gr,Wi,YS,WS,Bf,zr,zS,qo,xa,nc,Pf,Xh,Yh,qf,St,Re,mr,R,It=De(()=>{Et();zt();gr="ccc:",Wi=gr,YS=`${gr}slotSig`,WS=`${gr}slotMod`,Bf=18,zr="XM:",zS=140,qo=new Map,xa=null,nc=new Set;Pf=new Map,Xh=null;Yh=null,qf=!1;nI();St={HAS_OPENED_SAVE_SLOT:`${gr}hasOpenedSaveSlot`,SAVE_SLOT:`${gr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Re={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===St.SAVE_SLOT){if(e.newValue===null)mr=null;else{let t=parseInt(e.newValue,10);mr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:mr}}))}catch{}}});for(let e of Object.values(Re))St.CURRENCY[e]=`${gr}${e}`,St.MULTIPLIER[e]=`${gr}mult:${e}`;eI();R=new Proxy({},{get(e,t){if(Object.values(Re).includes(t))return Wh(t);if(typeof t=="string"&&Re[t.toUpperCase?.()])return Wh(Re[t.toUpperCase()])}});if(typeof window<"u"){window.bank=R;for(let e of Object.values(Re))window[e]=R[e]}});function ng(){return xo}function uc(e){xo=!!e,document.body.classList.toggle("slots-delete-mode",xo);let t=document.getElementById("manage-saves");t&&(t.textContent=xo?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",xo),n.setAttribute("aria-pressed",xo?"true":"false")})}function lI(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function cI(){if(tg)return;tg=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),uc(!xo)}),window.addEventListener("keydown",r=>{xo&&r.key==="Escape"&&uc(!1)});let n=r=>{!xo||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!xo)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(lI(s),b()===s)try{localStorage.removeItem(St.SAVE_SLOT)}catch{}zf(),uc(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),uc(!1)}var xo,tg,og=De(()=>{It();Kf();xo=!1,tg=!1;document.addEventListener("DOMContentLoaded",()=>{try{cI()}catch{}})});var rg={};vt(rg,{initSlots:()=>dI,refreshSlotsView:()=>zf});function uI(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function fI(e){if(!uI(e))return"No Save Data";try{let t=Ma(e,"coins");return j(t)}catch{return"0"}}function jf(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=fI(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function dI(e){let t=document.querySelectorAll(".slot-card");jf(),t.forEach((n,o)=>{let r=o+1,i=s=>{Hf(r),Yf(),Wf(),lc(!0),typeof e=="function"&&e(r,s),jf()};n.addEventListener("click",s=>{ng()||(s.preventDefault(),i(s))})})}function zf(){jf()}var Kf=De(()=>{Et();zt();og();It()});var sg={};vt(sg,{registerPreloadedAudio:()=>pI,takePreloadedAudio:()=>mI});function pI(e,t){let n=ig(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}fc.set(n,t)}}function mI(e){let t=ig(e);if(!fc.has(t))return null;let n=fc.get(t);return fc.delete(t),n}var fc,ig,dc=De(()=>{fc=new Map,ig=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Ki(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var Zf=De(()=>{});var wg={};vt(wg,{addExternalCoinMultiplierProvider:()=>ao,addExternalXpGainMultiplierProvider:()=>Sr,addXp:()=>ts,broadcastXpChange:()=>vc,computeCoinMultiplierForXpLevel:()=>ld,getXpGainMultiplier:()=>Sc,getXpLevelStorageKey:()=>hI,getXpRequirementForXpLevel:()=>bc,getXpState:()=>rt,initXpSystem:()=>Qi,isXpSystemUnlocked:()=>dn,onXpChange:()=>gc,refreshCoinMultiplierFromXpLevel:()=>nn,resetXpProgress:()=>es,setExternalBookRewardProvider:()=>Ic,setExternalCoinMultiplierProvider:()=>Sg,setExternalXpGainMultiplierProvider:()=>Ig,unlockXpSystem:()=>Jr});function hI(e=b()){let t=e??b();return t==null?null:Kr(t)}function fn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function pc(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function mg(e){if(!e||typeof e!="object")return 0;if(fn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function vI(e){return!e||typeof e!="object"?0:fn(e)||typeof e.cmp=="function"&&e.cmp(pg)>=0?Number.POSITIVE_INFINITY:mg(e)}function lg(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(yI,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(Ra())??c.fromInt(0):n}function bI(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(dg,18)}function SI(e){if(fn(e)||typeof e.cmp=="function"&&e.cmp(pg)>=0)return _t.clone?.()??_t;let t=e.floorToInteger(),n=e.sub(t),o=mg(n);if(!Number.isFinite(o))return _t.clone?.()??_t;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return _t.clone?.()??_t;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),p=Number(y),h=d-y;return new c(a,{base:p,offset:h})}function hg(e){if(!e||typeof e!="object")return _t.clone?.()??_t;let n=bI(e),o=SI(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return _t.clone?.()??_t;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function gg(){let e=fn(V.xpLevel),t=fn(V.progress);if(!e&&!t)return!1;let n=_t.clone?.()??_t;if(V.xpLevel=n.clone?.()??n,V.progress=n.clone?.()??n,xt=n.clone?.()??n,R?.books)try{typeof R.books.set=="function"?R.books.set(n.clone?.()??n):typeof R.books.add=="function"&&R.books.add(n.clone?.()??n)}catch{}return!0}function ka(e={}){Na.size!==0&&Na.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function gc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return Na.add(n),()=>{Na.delete(n)}}function Bt(){return c.fromInt(0)}function Ra(){return c.fromInt(1)}function ji(e){if(!e)return Bt();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Bt()}}function mc(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function II(){for(;id.length>0;){let e=id.pop();try{e?.()}catch{}}}function ug(e){if(e==null)return Bt();try{return c.fromAny(e)}catch{return Bt()}}function ed(e){if(!Qf){Qf=!0;try{let t=sd??b(),n={unlocked:V.unlocked,xpLevel:ji(V.xpLevel),progress:ji(V.progress),requirement:ji(xt)};tn(!0),so(),_n(!0);let o={unlocked:V.unlocked,xpLevel:ji(V.xpLevel),progress:ji(V.progress),requirement:ji(xt)},r=n.unlocked!==o.unlocked,i=!mc(n.xpLevel,o.xpLevel),s=!mc(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Bt();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Bt()}catch{l=Bt()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||Na.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(ka(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{Qf=!1}}}function td(e){if(e===sd||(II(),sd=e??null,e==null))return;let t=(n,o)=>{let r=kt(n,o);typeof r=="function"&&id.push(r)};t(Ca(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>ed("unlock")}),t(Kr(e),{parse:ug,equals:mc,onChange:()=>ed("xpLevel")}),t(Ji(e),{parse:ug,equals:mc,onChange:()=>ed("progress")})}function yg(){if(cg){td(b());return}cg=!0,td(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{td(b()),tn(!0),so(),_n(!0)})}function nd(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function wI(e){let t=e<ag?e:ag;if(t<=Zi)return;let n=Zi,o=yr.get(n.toString());for(o||(o=c.fromInt(10),yr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),yr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Zi=n;return}}Zi=n}function EI(e){let t=Zi>0n?Zi:0n,n=yr.get(t.toString());if(!n||fn(n))return _t.clone?.()??_t;let o=c.fromAny(t.toString()),r=Ee(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);pc(s)||(i=i.add?.(s.mulDecimal(dg,18))??i);let l=lg(e),a=lg(o),u=l.sub?.(a)??c.fromInt(0);pc(u)||(i=i.add?.(u.mulDecimal(gI,18))??i);let f=vI(i);return Number.isFinite(f)?ue(f):_t.clone?.()??_t}function xI(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=fn(t),o=fn(e);if(n)return o?1:0;if(pc(t)||pc(e))return 0;let s=Ee(e),l=Ee(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function vg(){return Ln.container&&Ln.container.isConnected?!0:(Ln.container=document.querySelector(".xp-counter[data-xp-hud]"),Ln.container?(Ln.bar=Ln.container.querySelector(".xp-bar"),Ln.fill=Ln.container.querySelector(".xp-bar__fill"),Ln.xpLevelValue=Ln.container.querySelector(".xp-level-value"),Ln.progress=Ln.container.querySelector("[data-xp-progress]"),!0):!1)}function bg(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=yr.get("0");return a.clone?.()??a}if(r.bigInt!=null){wI(i);let a=i.toString(),u=yr.get(a);if(u)return u.clone?.()??u}let s=EI(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?_t.clone?.()??_t:(r.bigInt!=null&&yr.set(r.bigInt.toString(),s),s.clone?.()??s)}function Go(){xt=bg(V.xpLevel)}function hc(){V.xpLevel=Bt(),V.progress=Bt(),Go(),_n(!0)}function fg(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function yc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function _n(e=!1){let t=R?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=yc(V.xpLevel),o=n.bigInt,r=!n.finite,i=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null;if(!e&&(r&&Vn||!r&&o!=null&&!Vn&&!Yn&&Xn!=null&&o===Xn||!r&&o==null&&Yn&&i&&Wn&&i===Wn))return;if(r){try{t.set(_t)}catch{}Xn=null,Vn=!0,Yn=!1,Wn=null;return}let s;if(o!=null&&o<=rd){let f=c.fromInt(1),d=Number(o);for(let y=0;y<d;y+=1)f=f.mulDecimal("1.1",18);let m;try{m=c.fromAny(o.toString())}catch{m=c.fromInt(d)}typeof f.add=="function"?f=f.add(m):typeof m.add=="function"&&(f=m.add(f)),s=f.clone?.()??f}else s=hg(V.xpLevel);let l=s.clone?.()??s,a=vr.size>0?Array.from(vr):typeof jr=="function"?[jr]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Xn=null,Vn=!0,Yn=!1,Wn=null):o!=null&&o<=rd?(Xn=o,Vn=!1,Yn=!1,Wn=null):(Xn=null,Vn=!1,Yn=!0,Wn=i)}function tn(e=!1){let t=b();if(t==null)return Ta=null,Jf=!1,V.unlocked=!1,hc(),V;if(!e&&Jf&&t===Ta)return V;Ta=t,Jf=!0;try{let n=localStorage.getItem(Ca(t));V.unlocked=n==="1"}catch{V.unlocked=!1}try{V.xpLevel=c.fromAny(localStorage.getItem(Kr(t))??"0")}catch{V.xpLevel=Bt()}try{V.progress=c.fromAny(localStorage.getItem(Ji(t))??"0")}catch{V.progress=Bt()}return(fn(V.xpLevel)||fn(V.progress))&&(V.unlocked=!0),V.unlocked?(gg(),Go(),_n(!0),yg(),V):(hc(),V)}function Aa(){let e=b();if(e==null)return;let t={unlocked:V.unlocked?"1":"0",level:V.xpLevel.toStorage(),progress:V.progress.toStorage()};try{localStorage.setItem(Ca(e),t.unlocked)}catch{}try{localStorage.setItem(Kr(e),t.level)}catch{}try{localStorage.setItem(Ji(e),t.progress)}catch{}let n=(()=>{let r=V.unlocked,i=V.xpLevel,s=V.progress;try{r=localStorage.getItem(Ca(e))==="1"}catch{}try{let l=localStorage.getItem(Kr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(Ji(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();ct(Ca(e),n.unlocked?"1":"0"),ct(Kr(e),n.level?.toStorage?.()??t.level),ct(Ji(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==V.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(V.unlocked=n.unlocked,V.xpLevel=n.level,V.progress=n.progress,Go(),_n(!0),so())}function LI(){_n(!0);let e=Ra();if(typeof od=="function")try{let n=od({baseReward:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{R?.books?.addWithMultiplier?R.books.addWithMultiplier(e):R?.books?.add&&R.books.add(e)}catch{}let t=yc(V.xpLevel);t.finite?t.bigInt!=null?(Xn=t.bigInt,Vn=!1,Yn=!1,Wn=null):(Xn=null,Vn=!1,Yn=!0,Wn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(Xn=null,Vn=!0,Yn=!1,Wn=null)}function so(){if(!vg())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=Ln;if(!e)return;if(!V.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=j(xt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=nd(j(xt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Ki();return}e.removeAttribute("hidden");let i=xt,s=xI(V.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=j(V.xpLevel)),r){let a=j(V.progress),u=j(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=nd(j(V.progress)),u=nd(j(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Ki()}function Qi({forceReload:e=!1}={}){return vg(),tn(e),Go(),so(),yg(),rt()}function Jr(){if(tn(),V.unlocked)return so(),!1;hc(),V.unlocked=!0,Aa(),so(),_n(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:rt()}))}catch{}return!0}function es({keepUnlock:e=!0}={}){tn();let t=V.unlocked;return hc(),V.unlocked=e?t||V.unlocked:!1,Aa(),so(),_n(!0),rt()}function ts(e,{silent:t=!1}={}){tn();let n=Ta??b();if(n!=null&&fg(Ji(n)))return{unlocked:V.unlocked,xpLevelsGained:Bt(),xpAdded:Bt(),xpLevel:V.xpLevel,progress:V.progress,requirement:xt,slot:n};if(!V.unlocked)return{unlocked:!1,xpLevelsGained:Bt(),xpAdded:Bt(),xpLevel:V.xpLevel,requirement:xt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Bt()}if(!o.isZero?.()){let d=br.size>0?Array.from(br):typeof Zr=="function"?[Zr]:[];for(let m of d)if(typeof m=="function")try{let y=m({baseGain:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});y instanceof c?o=y.clone?.()??y:y!=null&&(o=c.fromAny(y))}catch{}}if(o=Kn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return so(),{unlocked:!0,xpLevelsGained:Bt(),xpAdded:o,xpLevel:V.xpLevel,requirement:xt};V.progress=V.progress.add(o),Go();let r=n!=null&&fg(Kr(n)),i=fn(V.progress),s=fn(V.xpLevel),l=fn(o);if(i||s||l){let d=_t.clone?.()??_t;r||(V.xpLevel=d.clone?.()??d),V.progress=d.clone?.()??d,Go(),gg(),Aa(),so(),_n(!0);let m={unlocked:!0,xpLevelsGained:Bt(),xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:xt.clone?.()??xt,slot:n};if(ka(m),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:m}))}catch{}return m}let a=Bt();if(V.progress.cmp(xt)<0){Aa(),so();let d={unlocked:!0,xpLevelsGained:Bt(),xpAdded:o,xpLevel:V.xpLevel,progress:V.progress,requirement:xt,slot:n};if(ka(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=Ee(V.progress),m=.08118668602542883,y=Ee(xt);if(d-y>2){let g=V.xpLevel,v=d-y,w=Math.floor(v/m);if(w>10){let L=BigInt(Math.max(0,w-5));if(L>0n){let C=c.fromAny(L.toString());if(V.xpLevel=V.xpLevel.add(C),a=a.add(C),Go(),R?.books?.add)try{let A=C.clone();R.books.add(A)}catch{}}}}let p=0,h=500;for(;V.progress.cmp?.(xt)>=0&&p<h&&(V.progress=V.progress.sub(xt),V.xpLevel=V.xpLevel.add(Ra()),a=a.add(Ra()),LI(),Go(),!fn(xt));)p+=1;p>=h&&V.progress.cmp(xt)>=0&&Go()}Aa(),so();let u=yc(V.xpLevel);u.finite?u.bigInt!=null?(Xn=u.bigInt,Vn=!1,Yn=!1,Wn=null):(Xn=null,Vn=!1,Yn=!0,Wn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(Xn=null,Vn=!0,Yn=!1,Wn=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:xt.clone?.()??xt,slot:n};if(ka(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function rt(){return tn(),{unlocked:V.unlocked,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:xt.clone?.()??xt}}function vc(e={}){tn();let t=Ta??b(),n={...rt(),slot:t,...e};if(ka(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function dn(){return tn(),!!V.unlocked}function bc(e){return bg(e)}function Sc(){tn();let e=Ra(),t=br.size>0?Array.from(br):typeof Zr=="function"?[Zr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function ld(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=yc(t),o=n.bigInt;if(!n.finite)return _t.clone?.()??_t;let i;if(o!=null&&o<=rd){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=hg(t);let s=i.clone?.()??i,l=vr.size>0?Array.from(vr):typeof jr=="function"?[jr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!V.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function Sg(e){jr=typeof e=="function"?e:null,vr.clear(),jr&&vr.add(jr),tn(),_n(!0)}function nn(){tn(),_n(!0)}function Ig(e){Zr=typeof e=="function"?e:null,br.clear(),Zr&&br.add(Zr)}function ao(e){return typeof e!="function"?()=>{}:(vr.add(e),tn(),_n(!0),()=>{vr.delete(e),tn(),_n(!0)})}function Sr(e){return typeof e!="function"?()=>{}:(br.add(e),tn(),()=>{br.delete(e)})}function Ic(e){od=typeof e=="function"?e:null}var ad,Ca,Kr,Ji,Ta,Jf,xt,yr,Zi,_t,Xn,Vn,Yn,Wn,jr,Zr,vr,br,od,ag,N_,R_,rd,dg,gI,yI,pg,V,Na,Ln,id,cg,sd,Qf,zn=De(()=>{Et();It();ns();zt();Zf();ad="ccc:xp",Ca=e=>`${ad}:unlocked:${e}`,Kr=e=>`${ad}:level:${e}`,Ji=e=>`${ad}:progress:${e}`;Ta=null,Jf=!1,xt=c.fromInt(10),yr=new Map;yr.set("0",xt);Zi=0n,_t=c.fromAny("Infinity"),Xn=null,Vn=!1,Yn=!1,Wn=null,jr=null,Zr=null,vr=new Set,br=new Set,od=null,ag=5000n,N_=Math.log10(11/10),R_=Math.log10(5/2),rd=200n,dg="0.04139268515822507",gI="0.3979400086720376",yI="0.1",pg=c.fromScientific(String(c.MAX_E));V={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};Na=new Set;Ln={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};id=[],cg=!1,sd=null,Qf=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:Qi,unlockXpSystem:Jr,addXp:ts,getXpState:rt,broadcastXpChange:vc,isXpSystemUnlocked:dn,getXpRequirementForXpLevel:bc,getXpGainMultiplier:Sc,setExternalCoinMultiplierProvider:Sg,addExternalCoinMultiplierProvider:ao,refreshCoinMultiplierFromXpLevel:nn,setExternalXpGainMultiplierProvider:Ig,addExternalXpGainMultiplierProvider:Sr,setExternalBookRewardProvider:Ic,resetXpProgress:es}))});var Tg={};vt(Tg,{GHOST_TAP_TIMEOUT_MS:()=>_I,clearGhostTapTarget:()=>Oa,consumeGhostTapGuard:()=>Cg,initGlobalGhostTap:()=>BI,installGhostTapGuard:()=>PI,markGhostTapTarget:()=>Mg,setGhostTapSelector:()=>FI,shouldSkipGhostTap:()=>lo,suppressNextGhostTap:()=>Lo});function Xo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function fd(){return typeof document>"u"?null:document}function TI(e){if(!fd())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(ud)}function Oa(e){e&&(e[wc]=0)}function Mg(e,t=0,n=null){if(!e)return;let o=Xo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[wc]=o+r:e[wc]=0,CI=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&Lo(i)}function Cg(e){if(typeof window>"u")return!1;let t=window[os];return typeof t!="number"?!1:Xo()<=t?!0:(window[os]=null,!1)}function lo(e){if(!e)return!1;let t=Number(e[wc]||0);return!Number.isFinite(t)||t<=0?!1:Xo()<=t?(Oa(e),!0):(Oa(e),!1)}function Lo(e=0){if(typeof window>"u")return;let t=Xo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[os]=null;return}let o=t+n,r=typeof window[os]=="number"?window[os]:0;window[os]=Math.max(r,o)}function kI(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(xc=Ir=Xo(),Ho=0))}function AI(e){xc=Ir=Xo(),Ho=0}function NI(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Xo();Ir>0&&(Ho=t-Ir),xc=t}function RI(){let e=Xo();Ir>0&&(Ho=e-Ir),xc=e}function OI(e){if(!e.isTrusted)return;let t=Xo(),n=Ir>0?t-Ir:-1,o=TI(e.target);if(lo(o)){Ho=0,e.preventDefault(),e.stopImmediatePropagation();return}if(Cg(o)){o&&Oa(o),Ho=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Ho||n)>=_g){Oa(o),Ho=0,e.preventDefault(),e.stopImmediatePropagation();return}Ho=0}function PI(e={}){if(Eg)return;let t=fd();!t||typeof window>"u"||(Eg=!0,cd="PointerEvent"in window,xg=!cd&&"ontouchstart"in window,e.selector&&(ud=`${e.selector}, ${Ec}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(_g=e.longPressMs),t.addEventListener("click",OI,!0),cd?(t.addEventListener("pointerdown",kI,{capture:!0,passive:!1}),t.addEventListener("pointerup",NI,{capture:!0,passive:!0})):xg&&(t.addEventListener("touchstart",AI,{capture:!0,passive:!1}),t.addEventListener("touchend",RI,{capture:!0,passive:!0})))}function Lg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Ec);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(Mg(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function BI(){let e=fd();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",Lg,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",Lg,{capture:!1,passive:!1})}function FI(e){e&&(ud=`${e}, ${Ec}`)}var _I,wc,os,Ec,MI,Eg,ud,cd,xg,CI,xc,Ir,Ho,_g,rs=De(()=>{_I=0,wc=Symbol("ccc:ghostTap:skipUntil"),os="__cccGhostTapSkipUntil",Ec='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',MI=80,Eg=!1,ud=Ec,cd=!1,xg=!1,CI=null,xc=0,Ir=0,Ho=0,_g=MI});var dd,kg=De(()=>{dd={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var Ag={};vt(Ag,{RateAccumulator:()=>Ba,pauseGameLoop:()=>yd,registerFrame:()=>GI,registerTick:()=>_o,resumeGameLoop:()=>vd,startGameLoop:()=>$I,stopGameLoop:()=>qI});function hd(e){e||(e=performance.now());let t=e;if(gd){Qr=t,ti=requestAnimationFrame(hd);return}Qr||(Qr=t);let n=(t-Qr)/1e3;Qr=t,n>60&&(n=60),n<0&&(n=0),ei+=n;let o=0,r=250;for(;ei>=Pa;){if(o>=r){ei=ei%Pa;break}pd.forEach(i=>{try{i(Pa)}catch(s){console.error("Error in game tick listener:",s)}}),ei-=Pa,o++}if(md.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),is===0||ss===0)is=Date.now(),ss=t;else{let i=t-ss;if(i>DI){let s=Date.now(),l=s-is;l<-1e3?xn():l>i+1e4&&xn(),is=s,ss=t}}ti=requestAnimationFrame(hd)}function yd(){gd=!0}function vd(){gd=!1,Qr=performance.now(),ei=0,is=0,ss=0}function $I(){ti||(Qr=performance.now(),ei=0,is=0,ss=0,ti=requestAnimationFrame(hd))}function qI(){ti&&(cancelAnimationFrame(ti),ti=null)}function _o(e){return typeof e!="function"?()=>{}:(pd.add(e),()=>{pd.delete(e)})}function GI(e){return typeof e!="function"?()=>{}:(md.add(e),()=>{md.delete(e)})}var UI,Pa,pd,md,ti,gd,Qr,ei,is,ss,DI,Ba,ni=De(()=>{It();UI=20,Pa=1/UI,pd=new Set,md=new Set,ti=null,gd=!1,Qr=0,ei=0,is=0,ss=0,DI=2e3;Ba=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Pa;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ze,oi,Fa,Ua,Da,$a,co,qa,as,HI,XI,VI,YI,WI,Ng,ri=De(()=>{Et();Ze="automation",oi=1,Fa=2,Ua=3,Da=4,$a=5,co=6,qa=7,as={[Fa]:"coins",[Ua]:"books",[Da]:"gold",[$a]:"magic",[qa]:"dna"},HI="img/misc/mysterious.webp",XI="img/misc/locked.webp",VI="Hidden Upgrade",YI="Locked Upgrade",WI=[{area:Ze,id:oi,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ze,id:Fa,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ze,id:Ua,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ze,id:Da,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ze,id:$a,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ze,id:co,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}},{area:Ze,id:qa,title:"Autobuy DNA Upgrades",desc:"Automatically buys DNA upgrades",icon:"sc_upg_icons/autobuy_dna.webp",lvlCap:1,baseCost:1e27,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e27")},effectSummary(){return null},computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=11||t===1/0)&&(n=!0):typeof t=="bigint"?t>=11n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=11)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};if(!e.surgeUnlocked)return{locked:!0,iconOverride:XI,titleOverride:YI,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0};let o="Reach Surge 11 to reveal this upgrade";return{locked:!0,iconOverride:HI,titleOverride:VI,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}],Ng=WI.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var Ug={};vt(Ug,{getLabCost:()=>Bg,getLabLevel:()=>jt,getLabLevelFromCoins:()=>Fg,getLabLevelKey:()=>Sd,getRpMult:()=>ds,getRpMultBase:()=>Mc,hasVisitedLab:()=>fs,initLabLogic:()=>zI,initLabTab:()=>Ed,setLabLevel:()=>ai,setLabVisited:()=>Pg,updateLabLevel:()=>Id,updateLabTab:()=>xd});function Ha(){let e=b();if(Ya=e,e==null){Vo=c.fromInt(0),si=!1;return}try{let t=localStorage.getItem(_c(e));t?Vo=c.fromAny(t):Vo=c.fromInt(0)}catch{Vo=c.fromInt(0)}try{si=localStorage.getItem(Og(e))==="1"}catch{si=!1}}function fs(){let e=b();return e==null?!1:((Ya!==e||si===null)&&Ha(),si)}function Pg(e){let t=b();if(t==null)return;let n=!!e;if(!(si===n&&Ya===t)){si=n;try{localStorage.setItem(Og(t),n?"1":"0")}catch{}}}function jt(){let e=b();return e==null?c.fromInt(0):R.coins.value.isInfinite()?c.fromAny("Infinity"):((Ya!==e||Vo===null)&&Ha(),Vo)}function ai(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((Ya!==t||Vo===null)&&Ha(),n.cmp(Vo)===0)return;Vo=n,localStorage.setItem(_c(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function Bg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function Fg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Id(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(_c(e)))return;let t=R.coins.value,n=jt();if(t.isInfinite()){n.isInfinite()||ai(c.fromAny("Infinity"));return}let o=Fg(t);o.cmp(n)>0&&ai(o)}function zI(){Ha(),typeof window<"u"&&window.addEventListener("saveSlot:change",Ha),_o(Id),_o(Dg),$g()}function wd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function KI(e){if(!e||typeof e!="object")return 0;if(wd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function Rg(e){if(wd(e)||typeof e.cmp=="function"&&e.cmp(jI)>=0)return us.clone?.()??us;let t=e.floorToInteger(),n=e.sub(t),o=KI(n);if(!Number.isFinite(o))return us.clone?.()??us;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return us.clone?.()??us;let d=BigInt(u)+l-BigInt(i),y=d%BigInt(250),p=Number(y),h=d-y;return new c(a,{base:p,offset:h})}function Mc(){let e=jt();if(wd(e))return c.fromAny("Infinity");if(Me(12)){let o=Mt(),r=5*o,i=2+o/2,s=Math.log10(i).toFixed(18),a=e.mulDecimal(s,18).add(c.fromAny(String(r)));return Rg(a)}let n=e.mulDecimal("0.3010299956639812",18);return Rg(n)}function ds(){let e=Mc();return typeof Kn=="function"?Kn("rp",e):e}function Ed(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",Ga&&Ga.destroy(),Ga=new bd(e))}function xd(){Pg(!0),Ga&&Ga.resize()}var wr,ls,cs,Og,_c,Vo,si,Ya,Sd,us,jI,Ga,Lc,bd,li=De(()=>{It();po();Et();zt();Cn();ni();ns();xr();ci();fo();wr=1e308,ls=1e300,cs=1e-300,Og=e=>`ccc:lab:visited:${e}`,_c=e=>`ccc:lab:level:${e}`,Vo=null,si=null,Ya=null;Sd=e=>_c(e);us=c.fromAny("Infinity"),jI=c.fromScientific(String(c.MAX_E));Ga=null;Lc=512*.95,bd=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${j(jt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Id()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami Exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=Je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>wr&&(this.camX=wr),this.camX<-wr&&(this.camX=-wr),this.camY>wr&&(this.camY=wr),this.camY<-wr&&(this.camY=-wr),this.zoom>ls&&(this.zoom=ls),this.zoom<cs&&(this.zoom=cs)}update(t){this.checkBounds();let n=jt(),o=Bg(n.add(1)),r=Mn(),i=Mo(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${j(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${j(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami Exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let m=this.bursts[d];m.time+=t;for(let y of m.particles)y.x+=y.vx*t,y.y+=y.vy*t,y.vx*=.95,y.vy*=.95;m.time>=m.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),m=(M,U)=>{if(U<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*U})`,t.lineWidth=1,t.beginPath();let T=Math.floor((this.camX-n/2/r)/M)*M,_=Math.ceil((this.camX+n/2/r)/M)*M;if((_-T)/M>1e3)return;for(let ie=T;ie<=_&&!(ie+M<=ie);ie+=M){let me=(ie-this.camX)*r+n/2;t.moveTo(me,0),t.lineTo(me,o)}let Y=Math.floor((this.camY-o/2/r)/M)*M,Q=Math.ceil((this.camY+o/2/r)/M)*M;for(let ie=Y;ie<=Q&&!(ie+M<=ie);ie+=M){let me=(ie-this.camY)*r+o/2;t.moveTo(0,me),t.lineTo(n,me)}t.stroke()},y=d*r,p=Math.max(0,Math.min(1,(y-15)/25));m(d,p),m(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let h=(0-this.camY)*r+o/2;h>=-10&&h<=o+10&&(t.moveTo(0,h),t.lineTo(n,h));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let v=[],w=new Map;for(let M of Dt)Er(M.id)&&(v.push(M),w.set(M.id,this.getNodePosition(M)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let M of v)if(M.parentIds&&M.parentIds.length>0)for(let U of M.parentIds){let T=Dt.find(_=>_.id===U);if(T&&w.has(T.id)){let _=w.get(T.id),Y=w.get(M.id),Q=(_.x-this.camX)*r+n/2,ie=(_.y-this.camY)*r+o/2,me=(Y.x-this.camX)*r+n/2,ve=(Y.y-this.camY)*r+o/2;t.moveTo(Q,ie),t.lineTo(me,ve)}}t.stroke();let L=Lc,C=L*r,q=L*1.6*r;for(let M of v){let U=w.get(M.id),T=(U.x-this.camX)*r+n/2,_=(U.y-this.camY)*r+o/2,Y=it(M.id),Q=Y>=M.maxLevel,ie=!0;if(T+q/2<0||T-q/2>n||_+q*.8<0||_-q/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,T-q/2,_-q/2,q,q),Q?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,T-q/2,_-q/2,q,q):ii(M.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,T-q/2,_-q/2,q,q);let ve=this.nodeImages[M.id];if(ve||(ve=new Image,ve.src="img/"+M.icon,this.nodeImages[M.id]=ve),ve.complete&&ve.naturalWidth!==0&&t.drawImage(ve,T-C/2,_-C/2,C,C),ie){let Oe=Va(M.id),Te=0;if(Q)Te=1;else if(Oe.isInfinite?.()||typeof Oe.cmp=="function"&&Oe.cmp(c.fromAny("Infinity"))===0)Te=0;else{let X=uo(M.id);if(X.isZero?.())Te=0;else try{if(Oe.isZero?.())Te=1;else{let fe=X.div(Oe).toScientific(5);Te=Number(fe)}}catch{Te=0}}Te=Math.max(0,Math.min(1,Te));let F=q*.96,W=q*.18,$=T-F/2,H=_+q/2+q*.05;t.fillStyle="#111",t.fillRect($,H,F,W);let J=t.createLinearGradient($,H,$,H+W);J.addColorStop(0,"#2a5298"),J.addColorStop(1,"#1e3c72"),t.fillStyle=J,t.fillRect($,H,F*Te,W),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,H,F,W),t.fillStyle="#fff",t.font=`bold ${W*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,W*.08);let se="";{let X=j(c.fromAny(Y));X.indexOf("<")>=0&&(X="\u221E"),se=`Level ${X}`}Q&&(se=M.maxLevel===1?"UNLOCKED":"MAXED");let ce=t.measureText(se),x=H+W/2+(ce.actualBoundingBoxAscent-ce.actualBoundingBoxDescent)/2;t.strokeText(se,$+F/2,x),t.fillText(se,$+F/2,x)}}let P=35,G=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let M of this.bursts){let U=(M.x-this.camX)*this.zoom+n/2,T=(M.y-this.camY)*this.zoom+o/2;for(let _=0;_<G.length;_++){let Y=G[_],Q=M.time-Y.delay;if(Q>0&&Q<Y.dur){let ie=Q/Y.dur,me=1-Math.pow(1-ie,3),ve=P*me,Oe=Math.max(0,1-Math.pow(ie,2)),Te=1+_*.5,F=t.createRadialGradient(U,T,ve*.6,U,T,ve);F.addColorStop(0,"rgba(255, 200, 50, 0)"),F.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,Oe*.15*Te)})`),F.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,Oe*.2*Te)})`),F.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=F,t.beginPath(),t.arc(U,T,ve,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let _ of M.particles)if(M.time<_.life){let Y=1-M.time/_.life,Q=U+_.x,ie=T+_.y;t.fillStyle=`rgba(255, 255, 150, ${Y})`,t.beginPath(),t.arc(Q,ie,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Lc/2*1.6;for(let u of Dt){if(!Er(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Dt.find(m=>m.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.innerHTML=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let m=ii(t);Xa(t,!m),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Ld(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Dt.find(l=>l.id===this.activeOverlayId);if(!t||!Er(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=it(t.id),o=uo(t.id),r=Va(t.id),i=ii(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.innerHTML=`Level ${j(c.fromAny(n))} / ${j(c.fromAny(t.maxLevel))} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.innerHTML=`Level ${j(c.fromAny(n))} / ${j(c.fromAny(t.maxLevel))}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.innerHTML=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?j(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?j(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${j(o)} / ${j(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=Lc/2*1.6;for(let u of Dt){if(!Er(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){if(it(u.id)>=u.maxLevel)return;let h=ii(u.id);Xa(u.id,!h),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=Lc/2*1.6;for(let u of Dt){if(!Er(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,m=s-f.y;if(Math.sqrt(d*d+m*m)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<cs&&(i=cs),i>ls&&(i=ls);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<cs&&(i=cs),i>ls&&(i=ls);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});function Gg(e){typeof e=="function"&&qg.push(e)}function _d(){za=null}function Tc(){za=null;try{Cc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{nn()}catch{}}function Md(e){return typeof e=="function"&&Cc.push(e),()=>{Cc=Cc.filter(t=>t!==e)}}function JI(e){let t=mt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return ue(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function QI(){try{return!!dn()}catch{return!1}}function Ka(e){let t=R?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(QI())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=At(Ie.STARTER_COVE,Le.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=JI(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function ui(e=Ie.STARTER_COVE){if(za)return za;let t=Ct(e),n=[];if(e===Ie.STARTER_COVE&&Ie.DNA){let i=Ct(Ie.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),goldValue:c.fromInt(1),magicValue:c.fromInt(1),waveValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=Tn(s,i.id),a=Ve(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:m,mpMult:y}=Wo(i,l,s);r.xpValue=gt(r.xpValue,d),r.coinValue=gt(r.coinValue,m),r.mpValue=gt(r.mpValue,y),u=gt(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=gt(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=gt(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=gt(r.mpValue,u);else if(i.effectType==="gold_value")r.goldValue=gt(r.goldValue,u);else if(i.effectType==="magic_value")r.magicValue=gt(r.magicValue,u);else if(i.effectType==="wave_value")r.waveValue=gt(r.waveValue,u);else if(i.effectType==="book_value")r.bookValue=gt(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of qg)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return za=r,r}function ps(e){let t=ui(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:ZI*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue,goldValueMultiplier:t.goldValue,magicValueMultiplier:t.magicValue}}function Wa(){let{goldValue:e,magicValue:t,waveValue:n}=ui(Ie.STARTER_COVE);try{R.gold?.mult?.set&&R.gold.mult.set(e)}catch{}try{if(R.magic?.mult?.set){let o=Td(),r=gt(t,o);R.magic.mult.set(r)}}catch{}try{R.waves?.mult?.set&&R.waves.mult.set(n)}catch{}}function kc(){try{let{mpValue:e}=ui(Ie.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Ac(){try{let{magnetRadius:e}=ui(Ie.STARTER_COVE);return e||0}catch{return 0}}function Hg(){try{Yo()}catch{}Wa(),Md(Wa);try{ao(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=ui(Ie.STARTER_COVE);return gt(n,o)})}catch{}try{Sr(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=ui(Ie.STARTER_COVE);return gt(n,o)})}catch{}try{fi(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=ui(Ie.STARTER_COVE);return gt(n,o)})}catch{}Ka(),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{try{Ka()}catch{}try{nn()}catch{}try{Wa()}catch{}}),window.addEventListener("surge:level:change",()=>{try{Wa()}catch{}}),window.addEventListener("surge:nerf:change",()=>{try{Wa()}catch{}}))}var ZI,za,Cc,qg,Cd=De(()=>{Et();It();Co();zn();To();fo();Cn();ZI=1,za=null,Cc=[],qg=[]});var zg={};vt(zg,{addExternalEacAmountMultiplierProvider:()=>Nd,addExternalEacMultiplierProvider:()=>ew,getAutobuyerToggle:()=>di,getEacAmountMultiplier:()=>Oc,initAutomationEffects:()=>iw,setAutobuyerToggle:()=>Lr,setTsunamiBonusProvider:()=>Ad,updateAutomation:()=>Wg});function Ad(e){Xg=e}function ew(e){typeof e=="function"&&Vg.push(e)}function Nd(e){typeof e=="function"&&Yg.push(e)}function Oc(){let e=1;if(Me(2))if(Me(8)){let t=Mn(),n=Xg(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of Yg)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function Rd(e){Rc!==e&&(ms.clear(),Rc=e)}function di(e,t){let n=b();Rd(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(ms.has(r))return ms.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return ms.set(r,i),i}function Lr(e,t,n){let o=b();Rd(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);ms.set(i,s);try{localStorage.setItem(i,s)}catch{}}function tw(e){Wg(e),rw(e)}function nw(){if(Nc)return Nc;let e=[...Ct(Ie.STARTER_COVE),...Ct(Ie.DNA)],t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Nc=t,Nc}function ow(e){if(!(!e||e.length===0))for(let t of e){let n=t.area||Ie.STARTER_COVE;if(di(n,t.id)!=="0"){let r=At(n,t.id),i=t.lvlCap??1/0;r<i&&Pd(n,t.id)}}}function rw(e){let t=b();Rd(t);let n=nw();for(let[r,i]of Object.entries(as)){let s=Number(r);At(Ze,s)>0&&n[i]&&ow(n[i])}At(Ze,co)>0&&(kd++,kd>=5&&(kd=0,di(Ze,co)!=="0"&&Pc()))}function Wg(e){let n=At(Ze,oi);for(let r of Vg)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){ja=0;return}ja+=e;let o=1/n;if(ja>=o){let r=Math.floor(ja/o);if(r>0){let i=r;i*=Oc(),Od(i),ja-=r*o}}}function iw(){_o(tw),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Rc&&(ms.clear(),Rc=t)})}var ja,kd,Xg,Vg,Yg,ms,Rc,Nc,hs=De(()=>{ni();fo();Za();ri();gs();It();Cn();ja=0,kd=0,Xg=()=>0;Vg=[];Yg=[];ms=new Map,Rc=null;Nc=null});function Bd(){let e=b();if(ey=e,e==null){Ja=!1;return}try{Ja=localStorage.getItem(sw(e))==="1"}catch{Ja=!1}}function Ko(e){return ys.nodes[e]||(ys.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),ys.nodes[e]}function aw(e,t){let n=Ko(t);try{let o=localStorage.getItem(Qa(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(el(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(Jg(e,t));n.active=i==="1";let s=localStorage.getItem(Qg(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function Kg(){Bd();let e=b();ys.nodes={},jn=null,e!=null&&Dt.forEach(t=>{aw(e,t.id),ys.nodes[t.id].active&&(jn=t.id)})}function jg(){let e=b();e!=null&&Dt.forEach(t=>{let n=ys.nodes[t.id];if(n)try{localStorage.setItem(el(e,t.id),n.rp.toStorage())}catch{}})}function it(e){return Ko(e).level}function zo(e,t){let n=b();if(n==null||Kt(Qa(n,e)))return!1;let o=Ko(e);if(o.level===t)return!0;o.level=t;try{localStorage.setItem(Qa(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function uo(e){return Ko(e).rp}function vs(e,t){let n=b();if(n!=null&&Kt(el(n,e)))return;let o=Ko(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function ii(e){return Ko(e).active}function Xa(e,t){let n=b();if(n==null)return;let o=!!t;o?(jn!==null&&jn!==e&&Xa(jn,!1),jn=e):jn===e&&(jn=null);let r=Ko(e);if(r.active!==o){r.active=o;try{localStorage.setItem(Jg(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function Zg(e,t){let n=b();if(n==null)return;let o=Ko(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(Qg(n,e),o.discovered?"1":"0")}catch{}}}function Er(e){let t=kn.get(e);if(!t)return!1;if(Ko(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return Zg(e,!0),!0;if((e===5||e===6)&&((ey!==b()||Ja===null)&&Bd(),!Ja))return!1;for(let o of t.parentIds){let r=kn.get(o);if(!r)continue;if(it(o)<r.maxLevel)return!1}return Zg(e,!0),!0}function Va(e){let t=kn.get(e);if(!t)return c.fromAny("Infinity");let n=it(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=c.fromAny(t.scale),r=Ee(o),i=c.fromAny(t.baseRpReq),l=Ee(i)+n*r;return ue(l)}function Mo(){let e=0,t=it(1);t>0&&(e+=t*.01);let n=it(10);return n>0&&(e+=n*.01),e}function ty(){return it(4)>=1}function ny(e=[]){if(b()!=null){try{ai(0)}catch{}jn!==null&&Xa(jn,!1),Dt.forEach(n=>{e.includes(n.id)||(zo(n.id,0),vs(n.id,c.fromInt(0)))})}}function Dg(e){let t=ds();if(t.isZero?.()||jn===null)return;let n=kn.get(jn);if(!n||!Er(n.id))return;let r=t.mulDecimal(e.toString(),18),i=uo(n.id);if(it(n.id)>=n.maxLevel)return;let s=i.add(r),l=it(n.id);if(l<n.maxLevel||!Number.isFinite(n.maxLevel)){let a=Va(n.id),u=Ee(s),f=Ee(a);if(u-f>2){let d=0n,m=c.zero(),y=c.fromAny(n.scale),p=y.sub(1),h=!1;if((p.isZero()||Math.abs(Number(y.toScientific())-1)<1e-9)&&(h=!0),h){let v=s.div(a).floorToInteger().toPlainIntegerString();(v==="Infinity"||v.length>15)&&(v="9007199254740991");try{d=BigInt(v)}catch{d=0n}if(Number.isFinite(n.maxLevel)){let w=BigInt(n.maxLevel)-BigInt(l);d>w&&(d=w)}d>0n&&(m=a.mulScaledInt(d,0))}else if(p.isZero()===!1&&(p.sig>0n||p.isInfinite())){let g=Ee(y),v=Ee(p),w=u-f+v,L=Math.floor(w/g);if(L>5){let C=BigInt(Math.max(0,L-5));if(Number.isFinite(n.maxLevel)){let A=BigInt(n.maxLevel)-BigInt(l);C>A&&(C=A)}if(C>0n){d=C;let A=Number(d)*g,P=ue(A).sub(1).div(p);m=a.mulBigNumInteger(P)}}}if(d>0n){s=s.sub(m);let g=l+Number(d);zo(n.id,g)}}}for(;;){let a=Va(n.id);if(s.cmp(a)<0||it(n.id)>=n.maxLevel)break;s=s.sub(a);let u=it(n.id),f=u+1;if(f<=u||!zo(n.id,f))break}vs(n.id,s)}function iy(){let e=kn.get(2);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ue(t*oy)}function sy(){let e=kn.get(3);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ue(t*oy)}function tl(){let e=kn.get(5);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ue(t*ry)}function Fd(){let e=kn.get(6);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ue(t*ry)}function cw(){let e=kn.get(7);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ue(t*lw)}function ay(){let e=kn.get(8);return e?1+it(e.id)*.1:1}function ly(){let e=kn.get(9);return e?1+it(e.id)*.1:1}function $g(){ao(({baseMultiplier:e})=>{let t=iy();return e.mulDecimal(t.toScientific())}),Sr(({baseGain:e})=>{let t=sy();return e.mulDecimal(t.toScientific())}),Gg(()=>ay()),Nd(()=>ly()),Ad(()=>Mo()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&nn(),e&&e.id===8&&Tc()})}var Qa,el,Jg,Qg,sw,Dt,kn,Ja,ey,ys,jn,oy,ry,lw,xr=De(()=>{Et();It();li();zt();zn();Cd();hs();Qa=(e,t)=>`ccc:lab:node:level:${t}:${e}`,el=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,Jg=(e,t)=>`ccc:lab:node:active:${t}:${e}`,Qg=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,sw=e=>`ccc:reset:experiment:completed:${e}`,Dt=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Pe(iy())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Pe(sy())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Pe(tl())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Pe(Fd())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e8,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Pe(cw())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Pe(ay())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Pe(ly())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:`Increases the Tsunami Exponent by +0.01 per level\nThis node scales <strong>10x</strong> RP each level`,baseRpReq:1e12,scale:10,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`}],kn=new Map(Dt.map(e=>[e.id,e])),Ja=null,ey=null,ys={nodes:{}},jn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",Kg),setInterval(jg,1e3),window.addEventListener("beforeunload",jg),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&Bd()}),Kg());oy=Math.log10(2),ry=Math.log10(3),lw=Math.log10(1.1);window.RESEARCH_NODES=Dt;window.isResearchNodeVisible=Er});var my={};vt(my,{getBookProductionRate:()=>Mr,getEffectiveTsunamiNerf:()=>Mt,getSurge15Multiplier:()=>Bc,getSurge6WealthMultipliers:()=>Fc,getSurgeMagicMultiplier:()=>Td,getTsunamiNerf:()=>Mn,getTsunamiNerfKey:()=>Dd,getTsunamiSequenceSeen:()=>pn,initSurgeEffects:()=>dw,isSurgeActive:()=>Me,setTsunamiNerf:()=>pi,setTsunamiSequenceSeen:()=>Zo});function Dd(e){return Ud(e)}function pn(){let e=b();if(e==null)return!1;try{return localStorage.getItem(py(e))==="1"}catch{return!1}}function Zo(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(py(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Mn(){return _r}function Mt(){let t=Mn()+Mo();return t>1&&(t=1),t}function pi(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=Ud(n);if(Kt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}_r=t,bs();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function Me(e){return mo===1/0||typeof mo=="string"&&mo==="Infinity"||mo===Number.POSITIVE_INFINITY?!0:typeof mo=="bigint"?mo>=BigInt(e):typeof mo=="number"?mo>=e:!1}function Ss(e){if(!Me(8))return e;let t=Ee(e);if(!Number.isFinite(t))return e;let n=Mt();return ue(t*n)}function bs(){let e=Zn();mo=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(Me(8)){let n=Mt(),o=Math.log10(cy);jo=ue(o*n)}else jo=c.fromInt(cy);else jo=c.fromInt(1)}function Bc(e=!1){if(!e&&!Me(15))return c.fromInt(1);let t=R.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=Ee(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return ue(l)})(t);return Me(8)?Ss(o):o}function Fc(){if(!Me(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(m,y=0)=>{if(!m){if(y<=0)return c.fromInt(1);let L=Math.log10(y)/3;if(L<=0)return c.fromInt(1);let C=L*Math.log10(2);return ue(C)}if(m.isInfinite?.())return c.fromAny("Infinity");let p=Ee(m),h=p;if(Number.isFinite(p)){if(p<15&&y>0)try{let w=Number(m.toPlainIntegerString());if(Number.isFinite(w)){let L=w+y;L>0&&(h=Math.log10(L))}}catch{}}else if(y>0)h=Math.log10(y);else return c.fromInt(1);let g=h/6;if(g<=0)return c.fromInt(1);let v=g*Math.log10(2);return ue(v)},t=e(R.coins?.value),n=R.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(R.gold?.value),s=e(R.magic?.value),l=t,a=r,u=i,f=s;Me(8)&&(l=Ss(t),a=Ss(r),u=Ss(i),f=Ss(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function Mr(){if(!Me(3))return c.fromInt(0);let t=rt().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(uy),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=ue(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*uy;n=ue(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),R.books?.mult){let o=R.books.mult.get();n=n.mulBigNumInteger(o)}return Me(8)&&(n=Ss(n)),n}function uw(e){if(Me(3)){fy||(fy=new Ba("books",R));let t=Mr();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);R.books&&R.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,R.books&&R.books.add(c.fromInt(o))}}}if(Me(13)){let o=2*(Mt()*1.5-.5)-2,r=ue(o),i=R.coins?.value,s=rt(),l=Uc(i,s.xpLevel),a=R.gold?.mult?.applyTo?.(l)??l,u=tl();a=a.mulDecimal(u.toScientific());let d=a.mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.gold&&R.gold.add(d)}if(Me(16)){let o=2*(Mt()*1.5-.5)-2,r=ue(o),i=R.coins?.value,s=mi(),u=Dc(i,s).mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.magic&&R.magic.add(u)}}function dy(e){if(e==null)return;let t=localStorage.getItem(Ud(e));t!==null?(_r=Number(t),(Number.isNaN(_r)||!Number.isFinite(_r))&&(_r=Me(8)?0:1)):Me(8)?_r=0:_r=1}function fw(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function dw(){let e=b();bs(),dy(e),bs(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=mo,n=Me(8);bs();let o=mo,r=Me(8);!n&&r?(pi(0),pn()||Zo(!0)):r?fw(t,o)>0&&(pi(0),pn()||Zo(!0)):n&&!r&&pi(1)}),window.addEventListener("lab:node:change",()=>{bs()}),window.addEventListener("saveSlot:change",()=>{dy(b()),bs()})),ao(({baseMultiplier:t})=>jo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(jo)),Sr(({baseGain:t})=>jo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(jo)),fi(({baseGain:t})=>jo.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(jo)),fi(({baseGain:t})=>{if(!Me(4))return t;let n=c.fromInt(4444e9);if(Me(8)){let o=Mt(),r=Math.log10(4444e9);n=ue(r*o)}return t.mulBigNumInteger(n)}),ao(({baseMultiplier:t})=>{if(!Me(6))return t;let n=Fc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),ao(({baseMultiplier:t})=>{if(!Me(15))return t;let n=Bc();return n.cmp(1)<=0?t:t.mulBigNumInteger(n)}),ao(({baseMultiplier:t})=>{let n=0;if(Me(17)&&(n-=5),Me(18)&&(n+=10),n===0)return t;if(Me(8)){let r=Mt();n*=r}let o=ue(n);return t.mulBigNumInteger(o)}),Ic(({baseReward:t})=>Me(3)?c.fromInt(0):t),_o(uw)}function Td(){let e=0;if(Me(17)&&(e+=10),Me(18)&&(e-=5),e===0)return c.fromInt(1);if(Me(8)){let t=Mt();e*=t}return ue(e)}var cy,uy,Ud,py,jo,mo,fy,_r,Cn=De(()=>{Et();It();zn();To();Co();ni();Et();xr();cy=10,uy=.08685889638,Ud=e=>`ccc:surge:tsunamiNerf:${e}`,py=e=>`ccc:unlock:tsunami:${e}`;jo=c.fromInt(1),mo=0n,fy=null,_r=0});var wy={};vt(wy,{getGearsProductionRate:()=>Xc,getGenerationLevelKey:()=>yi,getGenerationUpgradeCost:()=>Cr,initWorkshopSystem:()=>Iy,initWorkshopTab:()=>Yd,performFreeGenerationUpgrade:()=>Pc,updateWorkshopTab:()=>ho});function ws(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*ww}function yi(e){return`ccc:workshop:genLevel:${e}`}function rl(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(yi(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function sl(e){let t=b();if(!t)return!1;let n=yi(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function al(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return qd;if(t<=hi)return qd+t*gy;qc===null&&(qc=qd+hi*gy);let n=t-hi;if(t<=nl)return qc+n+ws(n,Is);if(Gc===null){let d=nl-hi;Gc=qc+d+ws(d,Is)}let o=t-nl,r=t-hi,i=nl-hi,s=o+(ws(r,Is)-ws(i,Is)),l=bw/vw,a=.5*l*o*o;if(t<=$c)return Gc+s+a;if(Gd===null){let d=$c-nl,m=$c-hi,y=d+(ws(m,Is)-ws(i,Is)),p=.5*l*d*d;Gd=Gc+y+p}let u=Sw*(t-$c);if(u>709)return 1/0;let f=Gd*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function Cr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=al(t);return ue(n)}function Vd(e){let t,n=e;e instanceof c||(n=c.fromAny(e));let o=Me(11)?yw:Me(7)?gw:hw;if(n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let i=n.mulDecimal(o);if(n.cmp(9e15)<=0){let l=Number(n.toString())*o;t=ue(l)}else{let s=n.mulDecimal(o);if(s.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let l=Number(s.toScientific(10));l===1/0?t=c.fromAny("Infinity"):t=ue(l)}catch{t=c.fromAny("Infinity")}}}let r=R?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(r)}function Lw(){let e=Cr(st);if(R.coins.value.cmp(e)<0)return;let t=st.add(1);sl(t)&&(st=t,R.coins.sub(e),ho(),on())}function _w(){if(!qt())return;let n=Vd(st).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&R.gears&&R.gears.add(n),st.cmp(20)<0){let r=Number(st.toPlainIntegerString()),s=Math.pow(Me(11)?4:Me(7)?3:2,r)/20,l=Math.floor(s),a=s-l;if(gi+=a,gi>=1){let u=Math.floor(gi);gi-=u,R.gears&&R.gears.add(u)}}else gi=0}function Xd(){R.gears&&R.gears.set(0),sl(c.zero())&&(st=c.zero()),gi=0,ho()}function vy(e){if(!e)return;let t=il.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),il.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;st.cmp($d)>0?i=$d:i=Number(st.toPlainIntegerString());let s=Math.min(Math.floor(i),$d),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,m=Math.cos(d)*yy,y=Math.sin(d)*yy,p=Math.random()*360,h=(Math.random()<.5?-1:1)*(Ew+Math.random()*xw);l.push({x:u,y:f,dx:m,dy:y,rotation:p,rotationSpeed:h,size:a})}for(;l.length>s;)l.pop()}function Mw(e){let t="Click the big red button below to open the Automation Shop";Je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${pw}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${by}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will <span data-workshop="production-verb">double</span> the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${mw}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{Lw()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),Tw()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{xs("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(Jt&&Jt.isConnected){let a=Jt.querySelector(".workshop-side-left"),u=Jt.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let m=il.get(d);if(m){let y=d.getBoundingClientRect(),p=window.devicePixelRatio||1;m.width=y.width,m.height=y.height;let h=Math.round(y.width*p),g=Math.round(y.height*p);if(m.canvas&&(m.canvas.width!==h||m.canvas.height!==g)&&(m.canvas.width=h,m.canvas.height=g,m.ctx.scale(p,p)),m.needsDistribution&&m.width>0&&m.height>0){m.needsDistribution=!1;for(let v of m.gears)v.x=Math.random()*(m.width-v.size),v.x<0&&(v.x=0),v.y=Math.random()*(m.height-v.size),v.y<0&&(v.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Sy():Cw()},{root:null,threshold:0}).observe(e),Jt=e}function ho(){if(!Jt)return;let e=Jt.querySelector('[data-workshop="production-verb"]');if(e){let a=Me(11)?"quadruple":Me(7)?"triple":"double";e.textContent!==a&&(e.textContent=a)}let t=Jt.querySelector('[data-workshop="gears-amount"]'),n=Jt.querySelector('[data-workshop="gears-rate"]'),o=Jt.querySelector('[data-workshop="upgrade-cost"]'),r=Jt.querySelector('[data-workshop="upgrade-gen"]'),i=Vd(st),s=Cr(st);if(t&&(t.innerHTML=R.gears.fmt(R.gears.value)),n&&(n.innerHTML=j(i)),o){let a="Coins";try{a=!s.isInfinite()&&s.cmp(1)===0?"Coin":"Coins"}catch{}o.innerHTML=`${j(s)} ${a}`}if(r){let a=R.coins.value.cmp(s)>=0;r.disabled=!a;let u=At(Ze,co),f=!1;if(u>0){let d=b(),m=d!=null?`:${d}`:"",y=`ccc:autobuy:${Ze}:${co}${m}`;f=localStorage.getItem(y)!=="0"}f?r.classList.add("is-automated"):r.classList.remove("is-automated")}let l="";if(st.isInfinite()?l="Infinity":l=st.floorToInteger().toStorage(),l!==Hd){Hd=l;let a=Jt.querySelector(".workshop-side-left"),u=Jt.querySelector(".workshop-side-right");a&&vy(a),u&&vy(u)}}function Cw(){Es&&(cancelAnimationFrame(Es),Es=null)}function Sy(){if(Es)return;ol=0;let e=t=>{if(Jt&&Jt.isConnected){let n=Jt.querySelector('[data-workshop="gears-amount"]');n&&!Wd()&&(n.innerHTML=R.gears.fmt(R.gears.value)),ol||(ol=t);let o=(t-ol)/1e3;ol=t,o>.1&&(o=.1);for(let[r,i]of il){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!Hc.complete||Hc.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,m=f.y+f.size/2;u.save(),u.translate(d,m),u.rotate(f.rotation*Math.PI/180),u.drawImage(Hc,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}Es=requestAnimationFrame(e)};Es=requestAnimationFrame(e)}function Iy(){hy||(hy=!0,st=rl(),_o(_w),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{st=rl(),gi=0,qt()||Xd(),ho()}),window.addEventListener("currency:change",e=>{e.detail.key===Re.COINS&&ho()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Re.GEARS&&ho()}),window.addEventListener("debug:change",()=>{st=rl(),ho()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(qt()||Xd())})))}function Yd(e){Iy(),!e.__workshopInit&&(e.__workshopInit=!0,st=rl(),il.clear(),Hd=-1,Mw(e),typeof IntersectionObserver>"u"&&Sy(),qt()||Xd(),ho())}function Xc(){let e=rl();return Vd(e)}function Pc(){let e=R.coins.value.isInfinite(),n=Cr(st).isInfinite();if(e&&n&&!st.isInfinite())return st=c.fromAny("Infinity"),sl(st),ho(),!0;if(R.coins.value.isZero())return!1;let o=Ee(R.coins.value);if(!Number.isFinite(o))if(R.coins.value.inf)o=1/0;else return!1;if(al(st)>o||st.cmp(9e15)>0)return!1;let r=Number(st.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);al(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(st)>0&&sl(a)?(st=a,ho(),!0):!1}function Tw(){if(R.coins.value.isInfinite()){Pc()&&on();return}let e=Ee(R.coins.value);if(!Number.isFinite(e)&&R.coins.value.isZero()||al(st)>e||st.cmp(9e15)>0)return;let t=Number(st.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);al(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(st.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(Cr(c.fromInt(u)));if(l.cmp(R.coins.value)>0){let u=Cr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(st)>0&&sl(a)&&(st=a,R.coins.sub(l),ho(),on())}var by,pw,Hc,mw,$d,Jt,hy,gi,st,Hd,Es,qd,hw,gw,yw,hi,nl,$c,gy,Is,vw,bw,Sw,Iw,ww,qc,Gc,Gd,il,yy,Ew,xw,ol,gs=De(()=>{Et();zt();It();ni();ci();Co();fo();po();ri();Cn();by="img/currencies/gear/gear.webp",pw="img/currencies/gear/gear_plus_base.webp",Hc=new Image;Hc.src=by;mw="img/currencies/coin/coin.webp",$d=300,Jt=null,hy=!1,gi=0,st=c.zero(),Hd=-1,Es=null,qd=12,hw=.3010299956639812,gw=.47712125471966244,yw=.6020599913279624,hi=1e6,nl=1e9,$c=1e12,gy=1,Is=.001,vw=1e3,bw=Math.log10(1.00001),Sw=23e-11,Iw=Math.log(10),ww=1/Iw;qc=null,Gc=null,Gd=null;il=new Map,yy=67,Ew=67,xw=67;ol=0});var Ly={};vt(Ly,{calculateOfflineRewards:()=>Ls,calculatePreAutomationRewards:()=>Yc,formatTimeCompact:()=>Vc,grantOfflineRewards:()=>vi,initOfflineTracker:()=>Nw,processOfflineProgress:()=>xy,showOfflinePanel:()=>Tr});function Vc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),v=g.mulBigNumInteger(l),w=t.sub(v),L=0;try{let C=w.div(c.fromInt(i)).floorToInteger();L=Number(C.toPlainIntegerString())}catch{L=0}return L===0?`${j(g)}y`:`${j(g)}y ${L}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let m=Math.floor(f/60),y=f%60;if(m<24)return y===0?`${m}h`:`${m}h ${y}m`;let p=Math.floor(m/24),h=m%24;return h===0?`${p}d`:`${p}d ${h}h`}function Tr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${Vc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let p=document.createElement("div");p.className="offline-pre-auto-note",p.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(p)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",kw.forEach(p=>{let h=p.key,g=e[h];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(h==="research_levels"){Array.isArray(g)&&g.forEach(P=>{let G=document.createElement("div");G.className="offline-row";let M=document.createElement("span");M.className="offline-plus",M.style.color="#004F96",M.textContent="+";let U=document.createElement("img");U.className="offline-icon",U.src=p.icon,U.alt="RP";let T=document.createElement("span");T.className="offline-text",T.style.color="#004F96";let _=c.fromInt(P.levels),Y=_.cmp(c.fromInt(1))===0?"Level":"Levels";T.textContent=`${j(_)} ${Y} of ${P.name}`,G.appendChild(M),G.appendChild(U),G.appendChild(T),f.appendChild(G)});return}let v=document.createElement("div");v.className="offline-row";let w=document.createElement("span");w.className="offline-plus",w.classList.add(`text-${h}`),w.textContent="+";let L=document.createElement("img");L.className="offline-icon",L.src=p.icon,L.alt=h;let C=document.createElement("span");C.className="offline-text",C.classList.add(`text-${h}`);let A=!1;g instanceof c?A=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:A=Number(g)===1;let q=A?p.singular:p.plural;C.innerHTML=`${j(g)} ${q}`,v.appendChild(w),v.appendChild(L),v.appendChild(C),f.appendChild(v)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let m=document.createElement("button");m.type="button",m.className="offline-close-btn",m.textContent="Close";let y=()=>{r.remove()};return m.addEventListener("click",y),r.addEventListener("click",p=>{p.target===r&&y()}),d.appendChild(m),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{_s(i,a,".offline-scroll-container")}),r}function Aw(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function Ls(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=ds?ds():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Dt.filter(y=>ii(y.id)),d=[],m={};for(let y of f){let p=it(y.id),h=uo(y.id).add(u),g=0,v=y.maxLevel;for(;p<v;){let w=Aw(y,p);if(w.isInfinite&&w.isInfinite()||h.cmp(w)<0)break;h=h.sub(w),p++,g++}g>0&&d.push({name:y.title,levels:g}),m[y.id]={level:p,rp:h}}d.length>0&&(o.research_levels=d),Object.keys(m).length>0&&(o.research_progress=m)}let s=(Xc?Xc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||Hn("gears",t)||(o.gears=s);let l=Mr?Mr():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||Hn("books",t)||(o.books=u)}let a=At(Ze,oi)||0;if(a>0){let u=1;Me(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=zc(),m=d.coins.mulBigNumInteger(f),y=d.xp.mulBigNumInteger(f),p=d.mp.mulBigNumInteger(f);m.isZero()||Hn("coins",t)||(o.coins=m),y.isZero()||Kt(`ccc:xp:progress:${t}`)||(o.xp=y),p.isZero()||Kt(`ccc:mutation:progress:${t}`)||(o.mp=p)}}return o}function vi(e){if(b()!=null){if(e.xp)try{let n=ts(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Ms(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(zo(r,o.level),vs(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||R[n]&&typeof R[n].add=="function"&&R[n].add(e[n])}}function Yc(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=Jn(),i=c.fromInt(1);try{let l=ps(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Kn=="function"){let l=Kn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=zc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||Kt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||Kt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function xy(){let e=b();if(e==null)return;let t=Gf(),n=Date.now();if(t<=0)return;if(n<t-1e4){xn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!qt()){let l=Yc(r),a=Object.keys(l).length>0;return a&&(vi(l),Tr(l,o,!0)),a}let i=Ls(r),s=Object.keys(i).length>0;return s&&(vi(i),Tr(i,o)),s}function Nw(e,t){Ey||(Ey=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?yd():(vd(),xy()&&typeof t=="function"&&t())))}))}var Ey,kw,Wc=De(()=>{It();gs();Co();ni();It();Et();zt();ci();po();fo();li();xr();ri();Za();zn();To();Cn();ns();Ey=!1;kw=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Tr});function jd(e){let t=24,n=Date.now();try{let o=localStorage.getItem(zd(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(Kd(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(zd(e),"24"),localStorage.setItem(Kd(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function My(e,t,n){try{localStorage.setItem(zd(e),String(t)),localStorage.setItem(Kd(e),String(n))}catch{}}function Cy(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=jd(e);if(t>=Cs)return;let o=Date.now(),r=o-n;if(r>=Kc){let i=Math.floor(r/Kc);t+=i,t>=Cs?(t=Cs,n=o):n+=i*Kc,My(e,t,n),kr&&kr.classList.contains("is-active")&&Jo(!0)}}function Ow(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function Pw(){let e=b();if(e==null)return;Cy();let{charges:t,lastCharge:n}=jd(e);t<=0||(t>=Cs&&(n=Date.now()-50),t--,My(e,t,n),Jo(!0),ll&&clearInterval(ll),ll=setInterval(()=>{Jo()},1e3),ft(Rw,{volume:.5}),Ow(),setTimeout(()=>{let o=Ls(_y);vi(o),Tr(o,_y*1e3)},7250))}function Jo(e=!1){if(!kr||!kr.classList.contains("is-active"))return;let t=b();if(t==null)return;e||Cy();let{charges:n,lastCharge:o}=jd(t),r=kr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${Cs}</span>`);let i=kr.querySelector(".warp-timer");if(i)if(n>=Cs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+Kc,u=Math.max(0,a-l);i.textContent=`Next warp in ${Vc(u)}`}let s=kr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function Ty(e){if(!e||e.__warpInit)return;e.__warpInit=!0,kr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",Pw),ll||(ll=setInterval(()=>{Jo()},1e3)),Jo()}var zd,Kd,Cs,Kc,_y,Rw,kr,ll,Zd=De(()=>{It();Wc();En();zd=e=>`ccc:warp:charges:${e}`,Kd=e=>`ccc:warp:lastCharge:${e}`,Cs=24,Kc=3600*1e3,_y=150,Rw="sounds/warp.ogg",kr=null,ll=null});function Dy(){try{return localStorage.getItem(Nr(sp))==="1"}catch{return!1}}function lp(){try{return localStorage.getItem(Nr($y))==="1"}catch{return!1}}function Qc(e){let t=b();if(t==null)return;let n=`${$y}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),Bw()}catch{}}function eu(){return lp()?"Jeff":"Merchant"}function Bw(){let e=eu();ze&&ze.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function cl(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&lo(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(v=>console.error(v)),n&&h()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,Lo(160)))},f=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},d=()=>{r&&l()},m=g=>{r=!0,Lo(160)},y=g=>{r&&l()},p=()=>{r&&l()},h=()=>{e.removeEventListener("click",a),qy?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):qw&&(e.removeEventListener("touchstart",m),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",p))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function jc(e){return Dw[e]??0}function ky(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function Gw(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function fl(e,t){let n=bi.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;ks.set(e,r),n.unlocked=r;let i=mn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&mn.buttons[e]?.classList.contains("is-active")&&ru("dialogue")}function Jd(){let e=!1;try{e=!!Rs?.()}catch{}fl("reset",e)}function Qd(){let e=!1;try{e=!!qt?.()}catch{}fl("workshop",e)}function Oy(){let e=!1;try{typeof ko=="function"&&(e=ko())}catch{}fl("warp",e)}function Hw(){let e=b();if(e==null)return!1;try{return typeof pn=="function"&&pn()?!0:localStorage.getItem(Gy(e))==="1"}catch{return!1}}function op(){fl("lab",Hw())}function Xw(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function Vw(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof dn=="function"&&dn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof rt=="function"?rt():null;t&&typeof t=="object"&&(e.xpLevel=Xw(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Or=="function"&&Or()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof qt=="function"&&qt()}catch{e.hasInfuseReset=!1}return e}function Yw(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?tp:np,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?tp:np),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?cp:""),i.icon=o?.icon??(r==="mysterious"?Ar:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Qo:Uw),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function Ww(){if(Ay)return;Ay=!0;let e=zw;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${$w}:${t}`;kt(n,{onChange:e})}}function zw(){er()}function Kw(e,t){let n=up(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,Hy(n),jw(t.reward),!0)}function jw(e){if(e){if(e.type==="coins"){try{R.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{R.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{R.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function Zw(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function up(){try{return JSON.parse(localStorage.getItem(Nr(ul))||"{}")}catch{return{}}}function Hy(e){let t=Nr(ul);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{ct(t,n)}catch{}}catch{}}function Jw(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function Qw(){let e=rp;if(rp=null,typeof e=="function")try{e()}catch{}}function eE(e,t={}){t?.rawChanged&&er()}function ep(e){if(e===Py)return;if(Qw(),Py=e??null,e==null){er();return}let t=`${ul}:${e}`;rp=kt(t,{parse:Jw,onChange:eE});try{ct(t)}catch{}er()}function tE(){if(Ny){ep(b());return}Ny=!0,ep(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{ep(b())})}function Pr(){Promise.resolve().then(()=>(En(),tc)).then(({loadAudio:e})=>{e(Xy)})}function nE(){if(Ts)return;Ts=ft(Xy,{volume:Je?.15:.3,loop:!0})}function nr(){Ts&&(Ts.stop&&Ts.stop(),Ts=null)}function oE(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let w=0;w<t.length;w++){let L=t[w];L==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=L):L===">"&&l?(s+=L,i.push({type:"tag",content:s}),s="",l=!1):s+=L}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,m="";tr=!0,nE();let y=w=>{d&&(w.preventDefault(),f=!0)},p=w=>{d&&(w.key==="Enter"||w.key===" ")&&(f=!0)},h=o.length?o:[e];requestAnimationFrame(()=>{d=!0,h.forEach(w=>w.addEventListener("click",y,{once:!0})),document.addEventListener("keydown",p,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{h.forEach(w=>w.removeEventListener("click",y)),document.removeEventListener("keydown",p),e.classList.remove("is-typing"),nr(),tr=!1},v=()=>{if(f){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let w=i[a];w.type==="tag"?(m+=w.content,e.innerHTML=m,a++,v()):(m+=w.content[u],e.innerHTML=m,u++,u>=w.content.length&&(a++,u=0),setTimeout(v,n))};v()})}function rE(e={}){if(!ze)return;Pr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Qo}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Ar}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,ze.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Qo,r.textContent=e.message||cp,requestAnimationFrame(()=>t.classList.add("is-visible")),ze.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),nr(),tr=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),Nn(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&Nn(160),l()};cl(i,()=>{u()},{once:!0}),i.focus?.()}function iE(e,t){Pr();let n=t.scriptId;String(e)==="6"&&typeof fs=="function"&&!fs()&&(n=7),Wr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${eu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${As}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,ze.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),ze.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{Wr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),nr(),tr=!1,o.remove()},d=()=>{u||(u=!0,f(),er())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&Nn(160),d())});let m=new Rr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,v)=>{t.scriptId===4&&g==="c4b"&&Qc(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){er(),f();return}Kw(e,t),er(),f()}}}),p=!!up()[e]?.claimed,h=structuredClone(dd[n]);p&&h.nodes.m2b&&h.nodes.c2a&&t.scriptId===1&&(h.nodes.m2b.say="I've already given you Coins, goodbye.",h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),p&&t.scriptId===2&&h.nodes.m3a&&(h.nodes.m3a.say="I've already given you Books, goodbye.",h.nodes.c2a&&(h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===3&&h.nodes.m5a&&(h.nodes.m5a.say="I've already given you Gold, goodbye.",h.nodes.c5a&&(h.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===4&&h.nodes.m7a&&(h.nodes.m7a.say="I've already given you Magic, goodbye.",h.nodes.c7a&&(h.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m.load(h),m.start()}function sE(){if(document.getElementById(Fy))return;let e=document.createElement("style");e.id=Fy,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function aE(){let e=ze?.querySelector(".merchant-content");if(!e||e.__customScroll||!bt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),bt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){sE();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;bt.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let T=(e.scrollTop||0)>0;f!==T&&(f=T,bt?.classList.toggle("has-scroll-shadow",T))},m=()=>{let T=ze.querySelector(".merchant-grabber"),_=ze.querySelector(".merchant-header"),Y=ze.querySelector(".merchant-actions"),Q=(T?.offsetHeight||0)+(_?.offsetHeight||0)|0,ie=(Y?.offsetHeight||0)|0;t.style.top=Q+"px",t.style.bottom=ie+"px"},y={},p=()=>{let{scrollHeight:T,clientHeight:_,scrollTop:Y}=e,Q=t.clientHeight||e.clientHeight||1;if(y.scrollHeight===T&&y.clientHeight===_&&y.barH===Q&&(u||y.scrollTop===Y))return;y={scrollHeight:T,clientHeight:_,scrollTop:Y,barH:Q};let ie=_/Math.max(1,T),me=Math.max(28,Math.round(Q*ie)),ve=Math.max(1,T-_),Oe=Math.max(0,Q-me);if(n.style.height=me+"px",u)n.style.setProperty("--thumb-y",`${Oe}px`),n.style.setProperty("--thumb-x","0px");else{let Te=Math.round(Y/ve*Oe);n.style.transform=`translateY(${Te}px)`}t.style.display=T<=_+1?"none":""},h=()=>{m(),p(),d()},g=()=>{o&&(bt.classList.add("is-scrolling"),l&&clearTimeout(l))},v=T=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{bt.classList.remove("is-scrolling")},T))},w=()=>{p(),d(),o&&g(),s||v(r)},L=()=>v(r);e.addEventListener("scroll",w,{passive:!0}),s&&e.addEventListener("scrollend",L,{passive:!0});let C=new ResizeObserver(h);C.observe(e),window.addEventListener("resize",h),requestAnimationFrame(h);let A=!1,q=0,P=0,G=T=>{A=!0,q=T.clientY,P=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(T.pointerId)}catch{}T.preventDefault()},M=T=>{if(!A)return;let _=t.clientHeight||1,Y=n.clientHeight||1,Q=Math.max(1,_-Y),ie=Math.max(1,e.scrollHeight-e.clientHeight),ve=(T.clientY-q)/Q*ie;e.scrollTop=P+ve},U=T=>{if(A){A=!1,n.classList.remove("dragging"),v(i);try{n.releasePointerCapture(T.pointerId)}catch{}}};n.addEventListener("pointerdown",G),window.addEventListener("pointermove",M,{passive:!0}),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),t.addEventListener("pointerdown",T=>{if(T.target===n)return;let _=t.getBoundingClientRect(),Y=T.clientY-_.top,Q=t.clientHeight||1,ie=n.clientHeight||1,me=Math.max(0,Q-ie),ve=Math.max(0,Math.min(Y-ie/2,me)),Oe=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ve/Math.max(1,me)*Oe,g(),v(r)}),e.__customScroll={bar:t,thumb:n,ro:C,updateAll:h},h()}function nu(){if(ze)return;ze=document.createElement("div"),ze.className="merchant-overlay",ze.id="merchant-overlay",ze.setAttribute("inert",""),bt=document.createElement("div"),bt.className="merchant-sheet",bt.setAttribute("role","dialog"),bt.setAttribute("aria-modal","false"),bt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",Jd(),Qd(),Oy(),op(),bi.forEach(y=>{y.key==="dialogue"&&ks.set("dialogue",!0);let p=ks.get(y.key),h=p??!!y.unlocked,g=document.createElement("button");g.type="button",g.className="merchant-tab",g.dataset.tab=y.key;let v=y.lockedLabel||"???";g.textContent=h?y.label:v,h?g.title=y.label||"Tab":(g.classList.add("is-locked"),g.disabled=!0,g.title="???"),y.unlocked=h,ks.set(y.key,h),cl(g,w=>{if(g.disabled){w?.preventDefault?.();return}ru(y.key)}),o.appendChild(g),mn.buttons[y.key]=g}),mn.panels.dialogue=i,mn.panels.reset=s,mn.panels.workshop=l,mn.panels.warp=a,mn.panels.lab=u,mn.tablist=o,r.append(i,s,l,a,u),n.append(o,r),Jd(),Qd();try{Yo()}catch{}try{fp(s)}catch{}try{qe()}catch{}try{Yd(l)}catch{}try{Ty(a)}catch{}try{Ed(u)}catch{}if(!Ry&&typeof window<"u"){let y=p=>{let{key:h,slot:g}=p?.detail??{};g!=null&&g!==b()||((h==="forge"||!h)&&Jd(),(h==="infuse"||!h)&&Qd(),(h==="surge_completed"||!h)&&Oy(),(h==="lab"||h==="tsunami"||!h)&&op())};window.addEventListener("unlock:change",y,{passive:!0}),window.addEventListener("saveSlot:change",y,{passive:!0}),Ry=!0}let f=document.createElement("div");f.className="merchant-actions";let d=document.createElement("button");d.type="button",d.className="merchant-close",d.textContent="Close",Zc=d,f.appendChild(d);let m=document.createElement("div");m.className="merchant-firstchat merchant-firstchat--initial",m.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${As}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,bt.append(e,t,n,f,m),ze.appendChild(bt),document.body.appendChild(ze),lE(),aE(),By||(By=!0,cl(d,()=>{ou()},{once:!1}),document.addEventListener("keydown",dE),e.addEventListener("pointerdown",pE),e.addEventListener("touchstart",p=>p.preventDefault(),{passive:!1}),ze.addEventListener("pointerdown",Pr,{once:!0}))}function lE(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,Ww(),er()}function cE(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?iE(n.id,n.meta):n.isMysterious&&rE(n.lockInfo)}}function er(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=Vw(),o=up(),r=!1,i=new Set;Object.entries(tu).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=jc(u),d=Yw(l,n),m=d.status,y=jc(m);if(y>f)a.status=m,m==="mysterious"?a.lockSnapshot=ky(d):m==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(y<f){if(u==="unlocked")d=Gw(l),m="unlocked",y=jc(m);else if(u==="mysterious"){let T=a.lockSnapshot||ky(d)||{};d={status:"mysterious",unlocked:!1,title:T.title??d.title??"???",blurb:T.blurb??d.blurb??tp,tooltip:T.tooltip??d.tooltip??"Hidden Dialogue",message:T.message??d.message??cp,icon:T.icon??d.icon??Ar,headerTitle:T.headerTitle??d.headerTitle??Qo,ariaLabel:T.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},m="mysterious",y=jc(m)}}let p=m==="unlocked",h=m==="mysterious",g=m==="locked",v=!!a.claimed,w=p&&!!(l.once&&v),L=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!L){L=document.createElement("button"),L.type="button",L.className="dlg-card",L.dataset.dlgId=String(s);let T=document.createElement("div");T.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let Y=document.createElement("div");Y.className="dlg-reward",L.append(T,_,Y),t.appendChild(L),cl(L,cE)}L._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:p,isMysterious:h},L.dataset.dlgStatus=m,L.disabled!==!!g&&(L.disabled=!!g),L.classList.toggle("is-locked",g),L.classList.toggle("is-mysterious",h),L.classList.toggle("is-complete",!!w),L.classList.toggle("has-again",!!w),g?(L.getAttribute("aria-disabled")!=="true"&&L.setAttribute("aria-disabled","true"),L.getAttribute("tabindex")!=="-1"&&L.setAttribute("tabindex","-1")):(L.hasAttribute("aria-disabled")&&L.removeAttribute("aria-disabled"),L.hasAttribute("tabindex")&&L.removeAttribute("tabindex"));let C=L.querySelector(".dlg-title"),A=p?l.title:d.title??"???";C.textContent!==A&&(C.textContent=A);let q=L.querySelector(".dlg-blurb"),P=p?l.blurb:d.blurb??"";q.textContent!==P&&(q.textContent=P);let G=L.querySelector(".dlg-reward");if(p&&l.reward){let T=Fw[l.reward.type];if(T){G.classList.contains("has-reward")||(G.classList.add("has-reward"),G.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),G.style.getPropertyValue("--reward-icon")!==`url('${T}')`&&G.style.setProperty("--reward-icon",`url('${T}')`);let _=G.querySelector(".amt"),Y=String(l.reward.amount);_&&_.textContent!==Y&&(_.textContent=Y);let Q=G.querySelector(".currency-name");if(Q){let me=String(l.reward.type||""),ve=me.charAt(0).toUpperCase()+me.slice(1);Q.textContent!==ve&&(Q.textContent=ve)}let ie=`Reward: ${l.reward.amount} ${l.reward.type}`;G.getAttribute("aria-label")!==ie&&G.setAttribute("aria-label",ie)}else{G.classList.remove("has-reward");let _=Zw(l.reward);G.textContent!==_&&(G.textContent=_),G.style.display!==""&&(G.style.display=""),G.removeAttribute("aria-label")}G.style.display==="none"&&(G.style.display="")}else G.textContent!==""&&(G.textContent=""),G.style.display!=="none"&&(G.style.display="none");let M=p?`${l.title}${w?" (completed)":""}`:d.ariaLabel||(h?"Hidden merchant dialogue":"Locked merchant dialogue");if(L.getAttribute("aria-label")!==M&&L.setAttribute("aria-label",M),d.tooltip)L.title!==d.tooltip&&(L.title=d.tooltip);else if(p){let T="Left-click: Start Dialogue";L.title!==T&&(L.title=T)}else L.hasAttribute("title")&&L.removeAttribute("title");let U=L.querySelector(".dlg-again");w?U||(U=document.createElement("div"),U.className="dlg-again",U.textContent="Ask Again?",L.appendChild(U)):U&&U.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&Hy(o)}function uE(){let e=ze.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Wr(!0);let i=new Rr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Wr(!1);try{localStorage.setItem(Nr(sp),"1")}catch{}try{window.dispatchEvent(new Event(ap))}catch{}e.classList.remove("is-visible"),ze.classList.remove("firstchat-active")}});i.load(dd[0]),i.start()}function fE(){if(!ze)return;let e=ze.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),ze.classList.remove("firstchat-active")}function Vy(){if(nu(),Si)return;let e=document.activeElement;e instanceof HTMLElement&&!ze.contains(e)?Jc=e:Jc=null,Si=!0;let t=b(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(Gy(t),"1")}catch{}op();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Nr(sp))==="1"}catch{o=!1}o||ze.classList.add("firstchat-instant"),bt.style.transition="none",bt.style.transform="",ze.removeAttribute("inert"),bt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ze.classList.contains("firstchat-instant")||(bt.style.transition=""),ze.classList.add("is-open"),Nn(140),Zc&&typeof Zc.focus=="function")try{Zc.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(Nr(Uy))||"dialogue"}catch{}n&&(r="dialogue"),ru(r),nr(),o||(ze.querySelector(".merchant-firstchat")?.classList.add("is-visible"),ze.classList.add("firstchat-active"),uE())})})}function ou(){if(!Si)return;if(Wr(!1),Je){try{Lo(100)}catch{}try{Nn(80)}catch{}}Si=!1,bt.style.transition="",bt.style.transform="",ze.classList.remove("is-open"),ze.classList.remove("firstchat-instant"),fE();let e=document.activeElement;if(e&&ze.contains(e)){let t=Jc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}ze.setAttribute("inert",""),Jc=null,nr(),tr=!1}function dE(e){if(Si&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<bi.length;i++)ks.get(bi[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<bi.length&&(e.preventDefault(),ru(bi[r].key))}}function pE(e){if(!Si)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;An={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},bt.style.transition="none",window.addEventListener("pointermove",Yy,{passive:!0}),window.addEventListener("pointerup",Wy),window.addEventListener("pointercancel",zy)}function Yy(e){if(!An||An.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-An.startY);An.lastY=t,An.moved=n,bt.style.transform=`translateY(${n}px)`}function Wy(){if(!An||An.canceled){ip();return}let e=Math.max(1,performance.now()-An.startT),t=An.moved;t/e>.55&&t>40||t>140?(Lo(160),bt.style.transition="transform 140ms ease-out",bt.style.transform="translateY(100%)",setTimeout(()=>{ou()},150)):(bt.style.transition="transform 180ms ease",bt.style.transform="translateY(0)"),ip()}function zy(){An&&(An.canceled=!0,bt.style.transition="transform 180ms ease",bt.style.transform="translateY(0)",ip())}function ip(){window.removeEventListener("pointermove",Yy),window.removeEventListener("pointerup",Wy),window.removeEventListener("pointercancel",zy),An=null}function ru(e){let t=bi.find(o=>o.key===e),n=ks.get(e);(!t||!n)&&(e="dialogue");for(let o in mn.buttons)mn.buttons[o].classList.toggle("is-active",o===e);for(let o in mn.panels)mn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{er()}catch{}if(e==="warp")try{Jo()}catch{}if(e==="lab"){typeof fs=="function"&&!fs()&&mE();try{xd()}catch{}}try{localStorage.setItem(Nr(Uy),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=ze?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function Ky(){if(!Si)return!1;let e=mn.buttons.lab;return e&&e.classList.contains("is-active")}function dl(e=[]){e.forEach(t=>fl(t,!0))}function jy(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${As}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Pr();let u=y=>{y.key==="Escape"&&(y.stopImmediatePropagation(),y.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${As}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let y=r.querySelector("#tsunami-dlg-line-2"),p=r.querySelector("#tsunami-dlg-choices-2"),h=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),v={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},w=new Rr({textEl:y,choicesEl:p,skipTargets:[y,h,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),nr(),tr=!1,r.remove(),t&&t()},5e3)}});w.load(v),w.start()},m=new Rr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",nr(),tr=!1,n&&n.hideCursor&&n.hideCursor(),f()}});m.load(o),m.start()}function mE(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${eu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${As}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Pr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Rr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{nr(),tr=!1,e.remove()}});s.load(i),s.start()}function Zy(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${eu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${As}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Pr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Rr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{nr(),tr=!1,t.remove(),e&&e()}});l.load(s),l.start()}var As,sp,Uy,ul,ap,Nr,$y,bi,ks,Fw,Ar,Qo,Uw,tp,np,cp,Dw,$w,qy,qw,Ay,Ny,Ry,Gy,Py,rp,tu,ze,bt,Zc,Si,An,Jc,By,mn,Xy,Ts,tr,Rr,Fy,Ns=De(()=>{It();Et();kg();zn();Co();gs();Zd();li();Cn();ci();rs();po();En();As="img/misc/merchant.webp",sp="ccc:merchantMet",Uy="ccc:merchantTab",ul="ccc:merchant:dlgState",ap="ccc:merchant:met",Nr=e=>`${e}:${b()}`;$y="ccc:unlock:jeff";bi=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],ks=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),Fw={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Ar="img/misc/mysterious.webp",Qo="Hidden Dialogue",Uw="Locked Dialogue",tp="Hidden Dialogue",np="Locked",cp="Locked Dialogue",Dw={locked:0,mysterious:1,unlocked:2},$w="ccc:reset:forge:completed",qy=typeof window<"u"&&"PointerEvent"in window,qw=!qy&&typeof window<"u"&&"ontouchstart"in window;Ay=!1,Ny=!1,Ry=!1;Gy=e=>`ccc:unlock:lab:${e}`;Py=null,rp=null;tu={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Ar,headerTitle:Qo,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:np,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Ar,headerTitle:Qo,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof ko=="function"&&ko()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Ar,headerTitle:Qo,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof pn=="function"&&pn())return!0;let t=typeof Zn=="function"?Zn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof ko=="function"&&ko()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Ar,headerTitle:Qo,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Ar,headerTitle:Qo,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};tE();ze=null,bt=null,Zc=null,Si=!1,An=null,Jc=null,By=!1,mn={buttons:{},panels:{},tablist:null},Xy="sounds/merchant_typing.ogg",Ts=null,tr=!1;Rr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await oE(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=cl(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};Fy="ccc-scroll-timeline-styles"});var Gt,dp,pp,Jy,mp=De(()=>{zt();Gt="dna",dp="img/misc/mysterious.webp",pp="Hidden Upgrade",Jy=[{area:Gt,id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Coin value bonus: ${Pe(t)}x`},{area:Gt,id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`XP value bonus: ${Pe(t)}x`},{area:Gt,id:3,title:"DNA Gold Value",desc:"Multiplies Gold value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/gold_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"gold_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Gold value bonus: ${Pe(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:dp,titleOverride:pp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Gt,id:4,title:"DNA Magic Value",desc:"Multiplies Magic value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/magic_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"magic_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Magic value bonus: ${Pe(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:dp,titleOverride:pp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Gt,id:5,title:"DNA Wave Value",desc:"Multiplies Wave value by 1.1x per level",lvlCap:1e3,baseCost:1e42,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/wave_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"wave_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Wave value bonus: ${Pe(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=19||t===1/0)&&(n=!0):typeof t=="bigint"?t>=19n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=19)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 19 to reveal this upgrade";return{locked:!0,iconOverride:dp,titleOverride:pp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}]});function Wd(){return pl.size>0}function rv(e){if(!e||!e.costType)return!1;let t=bE[e.costType];return!t||At(Ze,t)<=0?!1:di(e.area,e.id)!=="0"}function gp(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function su(e,t){return t==="standard"&&gp(e)===vE}function hp(e){let t=Ct(e),n={};for(let o of t){let r=Tn(e,o.id),i=At(e,o.id),s=Ao(e,o.id),l=s.iconOverride??pu(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Bs(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:du(o.baseIconOverride||s.baseIconOverride),hmReady:d}}return n}function iv(e){return tv[e]||tv.standard}function Nn(e=140){if(!Je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function lu(e){return String(e??"").replace(/<[^>]*>/g,"")}function iu(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function on(){ft(IE,{volume:Je?sv:av})}function lv(){let e=Je?sv*2:av*2;ft(wE,{volume:e})}function EE(e){return`<img alt="" src="${ev[e]||ev.coins}" class="currency-ico">`}function LE(){if(document.getElementById(nv))return;let e=document.createElement("style");e.id=nv,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function _s(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,m="onscrollend"in window,p=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(p){LE();let W=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=W,s.style.scrollTimelineName=W,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=W,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let h={scrollSize:0,clientSize:0,barSize:0,thumbSize:0,maxScroll:1,range:0,visibleRatio:1},g=null,v=!1,w=null,L=()=>{if(!s.isConnected||!t.isConnected)return;let F=s.getBoundingClientRect(),W=t.getBoundingClientRect();if(i){let $=Math.max(0,F.top-W.top),H=Math.max(0,W.bottom-F.bottom);l.style.top=$+"px",l.style.bottom=H+"px",l.style.left="",l.style.right=""}else{let $=Math.max(0,F.left-W.left),H=Math.max(0,W.right-F.right);l.style.left=$+"px",l.style.right=H+"px",l.style.top="",l.style.bottom="",l.style.height=""}},C=()=>{let F=i?s.scrollHeight:s.scrollWidth,W=i?s.clientHeight:s.clientWidth,$=i?l.clientHeight||W:l.clientWidth||W,H=W/Math.max(1,F),J=Math.max(28,Math.round($*H)),se=Math.max(1,F-W),ce=Math.max(0,$-J);h={scrollSize:F,clientSize:W,barSize:$,thumbSize:J,maxScroll:se,range:ce,visibleRatio:H},i?(a.style.height=J+"px",a.style.width="100%"):(a.style.width=J+"px",a.style.height="100%"),p&&(i?(a.style.setProperty("--thumb-y",`${ce}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${ce}px`),a.style.setProperty("--thumb-y","0px")));let x=F>W+1;l.style.display=x?"":"none",t?.classList.toggle("has-active-scrollbar",x),A()},A=()=>{v=!1;let F=i?s.scrollTop:s.scrollLeft,W=(F||0)>0;if(g!==W&&(g=W,t?.classList.toggle("has-scroll-shadow",W)),!p){let{maxScroll:$,range:H}=h,J=Math.round(F/$*H);i?a.style.transform=`translateY(${J}px)`:a.style.transform=`translateX(${J}px)`}u&&M()},q=()=>{L(),C()};s.__customScroll&&(s.__customScroll.update=q);let P,G=()=>{clearTimeout(P),P=setTimeout(q,100)};typeof MutationObserver<"u"&&new MutationObserver(()=>G()).observe(s,{childList:!0,subtree:!0,characterData:!0});let M=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},U=F=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},F))},T=()=>{pl.has(s)||pl.add(s),clearTimeout(w),w=setTimeout(()=>{pl.has(s)&&(pl.delete(s),window.dispatchEvent(new CustomEvent("menu:scrollStop")))},150),v||(v=!0,window.requestAnimationFrame(A)),m||U(f)},_=()=>U(f);s.addEventListener("scroll",T,{passive:!0}),m&&s.addEventListener("scrollend",_,{passive:!0}),new ResizeObserver(()=>{q()}).observe(s),window.addEventListener("resize",q),requestAnimationFrame(q);let Q=!1,ie=0,me=0,ve=F=>{Q=!0,ie=i?F.clientY:F.clientX,me=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),M();try{a.setPointerCapture(F.pointerId)}catch{}F.preventDefault()},Oe=F=>{if(!Q)return;let{range:W,maxScroll:$}=h;if(W<=0)return;let J=(i?F.clientY:F.clientX)-ie,se=me+J/W*$;i?s.scrollTop=se:s.scrollLeft=se},Te=F=>{if(Q){Q=!1,a.classList.remove("dragging"),U(d);try{a.releasePointerCapture(F.pointerId)}catch{}}};a.addEventListener("pointerdown",ve),window.addEventListener("pointermove",Oe,{passive:!0}),window.addEventListener("pointerup",Te),window.addEventListener("pointercancel",Te),l.addEventListener("pointerdown",F=>{if(F.target===a)return;let W=l.getBoundingClientRect(),$=i?F.clientY-W.top:F.clientX-W.left,{thumbSize:H,range:J,maxScroll:se}=h,x=Math.max(0,Math.min($-H/2,J))/Math.max(1,J)*se;i?s.scrollTop=x:s.scrollLeft=x,M(),U(f)}),q()}function ov(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function _E(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=R[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",m=Number.isFinite(i)&&r>=i;return d&&!m||!Number.isFinite(i)?c.fromAny("Infinity"):ov(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),m=c.fromAny(e.costAtLevel(r+1)),y=Math.min(Number.isFinite(i)?i:r+32,r+32),p=c.fromAny(e.costAtLevel(y));if(d.cmp(m)===0&&d.cmp(p)===0){let g=ov(e,o,r),v=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,w=0,L=Math.max(0,v);for(;w<L;){let C=Math.floor((w+L+1)/2),A=c.fromInt(C);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(A):c.fromAny(d??0).mulBigNumInteger(A)).cmp(a)<=0?w=C:L=C-1}return c.fromInt(w)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=Ii(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function xs(e="standard"){(cu[e]||cu.standard).open()}function cv(e=!1){Object.values(cu).forEach(t=>t.close(e))}function or(e=!1){Object.values(cu).forEach(t=>t.update(e))}function ME(){if(rn)return;rn=document.createElement("div"),rn.className="upg-overlay",ut=document.createElement("div"),ut.className="upg-sheet",ut.setAttribute("role","dialog"),ut.setAttribute("aria-modal","false"),ut.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",ut.append(e,t,n,o,r),rn.appendChild(ut),document.body.appendChild(rn),rn.addEventListener("pointerdown",u=>{Je&&u.pointerType!=="mouse"&&u.target===rn&&(u.preventDefault(),u.stopPropagation())},!0),rn.addEventListener("click",u=>{Je&&u.target===rn&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!uu)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},ut.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,ut.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(ut.style.transition="transform 160ms ease",ut.style.transform=f?"translateY(100%)":"translateY(0)",f){if(Je&&(!u||u.pointerType!=="mouse"))try{Nn(120)}catch{}setTimeout(uv,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function uv(){if(Je)try{Nn(160)}catch{}if(typeof au=="function"){let e=au;au=null;try{e()}catch{}}uu=!1,!(!rn||!ut)&&(ut.style.transition="",ut.style.transform="",rn.classList.remove("is-open"),rn.style.pointerEvents="none")}function CE(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function TE(e,t="standard"){ME(),uu=!0;let n=!0,o=iv(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){uu=!1;return}let l=e.upgType==="HM",a=e.tie===Le.ENDLESS_XP;function u(p,h,g="div"){let v=h.split(" ").filter(C=>C.length>0),w=null,L=[];for(let C=0;C<p.children.length;C++){let A=p.children[C];g&&A.tagName.toLowerCase()!==g.toLowerCase()||v.every(q=>A.classList.contains(q))&&(w?L.push(A):w=A)}return L.forEach(C=>C.remove()),w||(w=document.createElement(g),w.className=h,p.appendChild(w)),w}let f=p=>{let h=document.createElement("div");return h.className="upg-line",h.innerHTML=p,h},d=!0,m=()=>{let p=o.getUiModel(e.id);if(!p)return;let h=p.lockState||o.getLockState(e.id),g=!!h?.locked,v=g&&(h?.hidden||h?.hideEffect||h?.hideCost),w=!!p.unlockUpgrade&&!v;ut.classList.toggle("is-locked-hidden",v);let L=ut.querySelector(".upg-header"),C=u(L,"upg-title");C.textContent!==(p.displayTitle||p.upg.title)&&(C.textContent=p.displayTitle||p.upg.title);let A=!!p.hmReadyToEvolve,q=A?!1:p.lvlBn?.isInfinite?.()?!0:Number.isFinite(p.upg.lvlCap)?p.lvl>=p.upg.lvlCap:!1,P=u(L,"upg-level"),G=p.lvlCapFmtHtml??p.upg.lvlCapFmtHtml??j(p.lvlCapBn),M=p.lvlCapFmtText??p.upg.lvlCapFmtText??lu(G),U=A?`Level ${p.lvlFmtHtml} / ${G} (EVOLVE READY)`:q?`Level ${p.lvlFmtHtml} / ${G} (MAXED)`:`Level ${p.lvlFmtHtml} / ${G}`,T=lu(U);P.innerHTML!==U&&(P.innerHTML=U),P.getAttribute("aria-label")!==T&&P.setAttribute("aria-label",T),P.hidden=v,v||P.removeAttribute("aria-hidden"),ut.classList.toggle("is-maxed",q),ut.classList.toggle("hm-evolve-ready",A),ut.classList.toggle("is-unlock-upgrade",w),ut.classList.toggle("is-hm-upgrade",l&&!v),ut.classList.toggle("is-endless-xp",a),ut.classList.toggle("is-magnet-upgrade",e.tie===Le.MAGNET),ut.classList.toggle("is-no-effect",!p.effect);let _=L.querySelector(".auto-toggle-wrapper"),Y=t==="automation"?as[e.id]:null,Q=t==="automation"&&e.id===co,ie=!!Y,me=t==="standard"||t==="dna"?SE[e.costType]:null,ve=0;me?ve=At(Ze,me):(ie||Q)&&(ve=At(Ze,e.id));let Te=ve>0&&(ie||me||Q)&&!v;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",L.appendChild(_));let F=_.querySelector("button");if(F||(F=document.createElement("button"),F.type="button",F.style.padding="10px 14px",F.style.fontSize="16px",F.style.width="auto",F.style.minWidth="180px",F.addEventListener("click",ne=>{typeof F._onClick=="function"&&F._onClick(ne)}),_.appendChild(F)),Te){F.style.visibility="",F.style.pointerEvents="auto";let ne=b(),ye=ne!=null?`:${ne}`:"",Ue=!0;if(ie){let ke=`ccc:autobuy:master:${Y}${ye}`,Fe=[...Ct(Ie.STARTER_COVE),...Ct(Gt)],ae=!1;for(let te of Fe)if(te.costType===Y){let xe=`ccc:autobuy:${te.area}:${te.id}${ye}`;if(di(te.area,te.id)!=="0"){ae=!0;break}}Ue=ae}else Ue=di(e.area,e.id)!=="0";Ue?(F.className="shop-delve",F.textContent="Automation: ON",F.style.backgroundColor=""):(F.className="shop-close",F.textContent="Automation: OFF",F.style.backgroundColor=""),F._onClick=ke=>{ke.preventDefault(),ke.stopPropagation(),Je&&Nn(50);let ae=!Ue?"1":"0";ie?(localStorage.setItem(`ccc:autobuy:master:${Y}${ye}`,ae),[...Ct(Ie.STARTER_COVE),...Ct(Gt)].forEach(xe=>{xe.costType===Y&&Lr(xe.area,xe.id,ae)})):Lr(e.area,e.id,ae),m()}}else F.style.visibility="hidden",F.style.pointerEvents="none",F.className="shop-delve",F.textContent="Automation: ON",F._onClick=null;let W=ut.querySelector(".upg-content");d&&(W.scrollTop=0,d=!1);let $=u(W,"upg-desc centered");$.classList.toggle("lock-desc",v);let H=(p.displayDesc||p.upg.desc||"").trim();A?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):H?($.classList.remove("hm-evolve-note"),$.textContent!==H&&($.textContent=H),$.hidden=!1):$.hidden=!0;let J=u(W,"upg-info"),se=null,ce=ne=>{se?se.nextElementSibling!==ne&&J.insertBefore(ne,se.nextSibling):J.firstElementChild!==ne&&J.prepend(ne),se=ne};if(g&&h?.reason&&!v){let ne=(p.displayDesc||"").trim(),ye=String(h.reason??"").trim();if(ne!==ye){let Ue=J.querySelector(".lock-wrapper");if(!Ue){Ue=document.createElement("div"),Ue.className="lock-wrapper";let ae=document.createElement("div");ae.className="upg-line lock-note",Ue.append(ae)}let ke=Array.from(Ue.children);for(let ae of ke)ae.tagName==="DIV"&&!ae.className&&ae.style.height==="12px"&&ae.remove();let Fe=Ue.querySelector(".lock-note");Fe.textContent!==h.reason&&(Fe.textContent=h.reason),ce(Ue)}else{let Ue=J.querySelector(".lock-wrapper");Ue&&Ue.remove()}}else{let ne=J.querySelector(".lock-wrapper");ne&&ne.remove()}if(p.effect&&!(g&&h?.hideEffect)){let ne=J.querySelector(".effect-wrapper");if(!ne){ne=document.createElement("div"),ne.className="effect-wrapper";let Fe=document.createElement("div");Fe.className="upg-line",ne.append(Fe)}let ye=Array.from(ne.children);for(let Fe of ye)Fe.tagName==="DIV"&&!Fe.className&&Fe.style.height==="12px"&&Fe.remove();let Ue=ne.querySelector(".upg-line"),ke=`<span class="bonus-line">${p.effect}</span>`;Ue.innerHTML!==ke&&(Ue.innerHTML=ke),ce(ne)}else{let ne=J.querySelector(".effect-wrapper");ne&&ne.remove()}let x=EE(p.upg.costType),X=p.nextPrice instanceof c?p.nextPrice:c.fromAny(p.nextPrice||0),K=q||A;if(!p.unlockUpgrade&&!K&&(!g||!h?.hideCost)){let ne=u(J,"upg-costs");ce(ne);let ye=iu(p.upg.costType,X),Ue=`Cost: ${x} ${R[p.upg.costType].fmt(X)} ${ye}`,ke=u(ne,"cost-line","div");if(ke.className.includes("upg-line")||(ke.className="upg-line cost-line"),ke.innerHTML!==Ue&&(ke.innerHTML=Ue),l){let xe=u(ne,"milestone-line","div");xe.className.includes("upg-line")||(xe.className="upg-line milestone-line");let E="\u2014",z="",Z=rv(p.upg);try{if(p.hmNextMilestone&&p.hmNextMilestone.cmp(p.lvlBn)>0)if(Z){let le=p.hmNextMilestone.sub(c.fromInt(1)),We=0;try{let be=le.toPlainIntegerString?.();be&&be!=="Infinity"?We=Number(be):We=Number(le.toString())}catch{We=0}let nt=c.fromInt(0);try{nt=c.fromAny(p.upg.costAtLevel(We))}catch{}E=R[p.upg.costType].fmt(nt),z=iu(p.upg.costType,nt)}else{let le=p.hmNextMilestone.sub(p.lvlBn),We=le.toPlainIntegerString?.(),nt=Math.max(0,Math.floor(Number(We&&We!=="Infinity"?We:Number(le.toString()||0)))),{spent:be}=Ii(p.upg,p.lvlBn,c.fromAny("Infinity"),nt);E=R[p.upg.costType].fmt(be),z=iu(p.upg.costType,be)}}catch{}let ge=`${Z?"Cost at next milestone:":"Cost to next milestone:"} ${x} ${E} ${z}`;xe.innerHTML!==ge&&(xe.innerHTML=ge)}else{let xe=ne.querySelector(".milestone-line");xe&&xe.remove()}let Fe=iu(p.upg.costType,p.have),ae=`You have: ${x} ${R[p.upg.costType].fmt(p.have)} ${Fe}`,te=u(ne,"have-line","div");te.className.includes("upg-line")||(te.className="upg-line have-line"),te.innerHTML!==ae&&(te.innerHTML=ae)}else{let ne=J.querySelector(".upg-costs");ne&&ne.remove()}let fe=ut.querySelector(".upg-milestones"),ee=fe.querySelector(".hm-view-milestones-row");if(!ee){ee=document.createElement("div"),ee.className="hm-view-milestones-row";let ne=document.createElement("button");ne.type="button",ne.className="shop-delve hm-view-milestones",ne.textContent="View Milestones",ne.addEventListener("click",ye=>{ne._onClick&&ne._onClick(ye)}),ee.appendChild(ne),fe.appendChild(ee)}let re=ee.querySelector("button");l&&!v?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ne=Array.isArray(p.hmMilestones)?p.hmMilestones:[],ye=Math.max(0,Math.floor(Number(p.hmEvolutions??0))),Ue=(()=>{try{return BigInt(Ht)*BigInt(ye)}catch{return 0n}})(),ke=ne.sort((Fe,ae)=>Number(Fe?.level||0)-Number(ae?.level||0)).map(Fe=>{let ae=Math.max(0,Math.floor(Number(Fe?.level||0))),te=(()=>{if(p.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ae)+Ue).toString())}catch{return c.fromAny(ae+Ht*ye)}})(),xe=te?.isInfinite?.()?"Infinity":j(te),E=Pe(Fe?.multiplier??Fe?.mult??Fe?.value??1),z=`${Fe?.target??Fe?.type??"self"}`.toLowerCase(),Z=(()=>{if(p.lvlBn?.isInfinite?.())return!0;try{return p.lvlBn?.cmp?.(te)>=0}catch{}return!1})(),oe=`Level ${xe}: Multiplies this upgrade\u2019s effect by ${E}x`;return z==="xp"&&(oe=`Level ${xe}: Multiplies XP value by ${E}x`),(z==="coin"||z==="coins")&&(oe=`Level ${xe}: Multiplies Coin value by ${E}x`),z==="mp"&&(oe=`Level ${xe}: Multiplies MP value by ${E}x`),{text:oe,achieved:Z}});CE(ke)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let he=ut.querySelector(".upg-actions"),Be=he.querySelector(".shop-close");if(Be||(Be=document.createElement("button"),Be.type="button",Be.className="shop-close",Be.textContent="Close",Be.addEventListener("click",()=>{n=!1,uv()}),he.appendChild(Be)),g||q)he.querySelectorAll("button:not(.shop-close)").forEach(ne=>ne.remove()),document.activeElement&&document.activeElement!==Be&&!he.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Be.focus();else{let ne=p.have.cmp(X)>=0,ye=(ae,te,xe,E,z=!1)=>{let Z=he.querySelector(`.${ae.split(" ").join(".")}`);if(!Z){Z=document.createElement("button"),Z.type="button",Z.className=ae,Z.textContent=te;let oe=()=>{typeof Z._onClick=="function"&&Z._onClick()};"PointerEvent"in window?Z.addEventListener("pointerdown",le=>{le.pointerType==="mouse"||typeof le.button=="number"&&le.button!==0||(oe(),le.preventDefault())},{passive:!1}):Z.addEventListener("touchstart",le=>{oe(),le.preventDefault()},{passive:!1}),Z.addEventListener("click",()=>{Je||oe()});let ge=he.children;E>=ge.length?he.appendChild(Z):he.insertBefore(Z,ge[E])}return Z._onClick=xe,Z.textContent!==te&&(Z.textContent=te),Z.disabled!==z&&(Z.disabled=z),Z};if(A){he.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ae=>ae.remove()),ye("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ae}=o.evolve(e.id);ae&&(lv(),or(),m())},1,!1);return}if(p.unlockUpgrade){he.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ae=>ae.remove()),ye("shop-delve btn-unlock","Unlock",()=>{let{bought:ae}=o.buyOne(e.id);if(!(ae instanceof c?ae:c.fromAny(ae??0)).isZero?.()){if(on(),su(e,t))try{dl(["reset"])}catch{}or(),m()}},1,!ne);return}if(he.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ae=>ae.remove()),ye("shop-delve btn-buy-one","Buy",()=>{let ae=o.getUiModel(e.id);if(ae.have.cmp(ae.nextPrice instanceof c?ae.nextPrice:c.fromAny(ae.nextPrice||0))<0)return;let{bought:te}=o.buyOne(e.id);(te instanceof c?te:c.fromAny(te??0)).isZero?.()||(on(),or(),m())},1,!ne),(Number.isFinite(p.upg.lvlCap)?p.upg.lvlCap:1/0)===1){let ae=he.querySelector(".btn-buy-max");ae&&ae.remove();let te=he.querySelector(".btn-buy-cheap");te&&te.remove()}else{ye("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:E}=o.buyMax(e.id);(E instanceof c?E:c.fromAny(E??0)).isZero?.()||(on(),or(),m())},2,!ne);let te=[1,3,4,5,6].includes(gp(p.upg));if(!l&&!te)ye("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let z=o.buyCheap;if(!z)return;let{bought:Z}=z(e.id);(Z instanceof c?Z:c.fromAny(Z??0)).isZero?.()||(on(),or(),m())},3,!ne);else{let xe=he.querySelector(".btn-buy-cheap");xe&&xe.remove()}}if(l)ye("shop-delve btn-buy-next","Buy Next",()=>{let te=o.getUiModel(e.id);if(te.hmReadyToEvolve)return;let xe=te.hmNextMilestone;if(!xe||!te.lvlBn||xe.cmp(te.lvlBn)<=0){let{bought:be}=o.buyMax(e.id);if((be instanceof c?be:c.fromAny(be??0)).isZero?.())return;on(),or(),m();return}let E=0;try{let be=xe.sub(te.lvlBn).toPlainIntegerString?.();E=Math.max(0,Math.floor(Number(be&&be!=="Infinity"?be:xe.sub(te.lvlBn).toString())))}catch{}let z=R[te.upg.costType]?.value,Z=z instanceof c?z:c.fromAny(z??0),ge=Ii(te.upg,te.lvlBn,Z,E).count,le=!1;try{let be=ge?.toPlainIntegerString?.();le=be&&be!=="Infinity"?Number(be)>=E:Number(ge??0)>=E}catch{}let We=le?o.buyNext(e.id,E):o.buyMax(e.id);(We.bought instanceof c?We.bought:c.fromAny(We.bought??0)).isZero?.()||(on(),or(),m())},3,p.have.cmp(c.fromInt(1))<0);else{let ae=he.querySelector(".btn-buy-next");ae&&ae.remove()}}},y=()=>{n&&m()};o.events.forEach(p=>window.addEventListener(p,y)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",y),m(),rn.classList.add("is-open"),rn.classList.toggle("is-automation-upgrade",t==="automation"),rn.style.pointerEvents="auto",Nn(140),ut.style.transition="none",ut.style.transform="translateY(100%)",ut.offsetHeight,requestAnimationFrame(()=>{ut.style.transition="",ut.style.transform=""}),au=()=>{n=!1,o.events.forEach(p=>window.removeEventListener(p,y)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",y)}}function Ld(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let m=Math.max(0,d-r.startY);r.lastY=d,r.moved=m,t.style.transform=`translateY(${m}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(Lo(100),Nn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var pl,Qy,hE,gE,yE,ev,vE,bE,SE,tv,IE,wE,sv,av,xE,nv,ml,cu,rn,ut,uu,au,ci=De(()=>{It();Et();zt();po();Ns();dc();En();fo();rs();ri();hs();mp();pl=new Set;Qy={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},hE="img/misc/locked_base.webp",gE="img/misc/maxed.webp",yE="img/misc/green_border.webp",ev={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},vE=7,bE={coins:Fa,books:Ua,gold:Da,magic:$a,dna:qa};SE={coins:Fa,books:Ua,gold:Da,magic:$a,dna:qa};tv={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>hp(Jn()),getUiModel:e=>Bs(Jn(),e),buyOne:e=>Os(Jn(),e),buyMax:e=>hl(Jn(),e),buyCheap:e=>gl(Jn(),e),buyNext:(e,t)=>Ps(Jn(),e,t),getLockState:e=>Ao(Jn(),e),evolve:e=>fu(Jn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",ap,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>hp(Ze),getUiModel:e=>Bs(Ze,e),buyOne:e=>Os(Ze,e),buyMax:e=>hl(Ze,e),buyCheap:e=>gl(Ze,e),buyNext:(e,t)=>Ps(Ze,e,t),getLockState:e=>Ao(Ze,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>hp(Gt),getUiModel:e=>Bs(Gt,e),buyOne:e=>Os(Gt,e),buyMax:e=>hl(Gt,e),buyCheap:e=>gl(Gt,e),buyNext:(e,t)=>Ps(Gt,e,t),getLockState:e=>Ao(Gt,e),evolve:e=>fu(Gt,e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||or(!0)});IE="sounds/purchase_upg.ogg",wE="sounds/evolve_upg.ogg",sv=.12,av=.3;xE="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",nv="ccc-scroll-timeline-styles";ml=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return iv(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!Dy(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let X=document.createElement("div");X.className="shop-tile";let K=document.createElement("img");K.className="base",K.alt="";let fe=document.createElement("img");fe.className="icon",fe.alt="",fe.addEventListener("error",()=>{fe.src=xE}),X.appendChild(K),X.appendChild(fe),i.appendChild(X),t.appendChild(i),i.addEventListener("click",ee=>{let re=ee.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){ee.preventDefault(),ee.stopImmediatePropagation();return}if(lo(re)){ee.preventDefault(),ee.stopImmediatePropagation();return}if(ee.shiftKey||ee.ctrlKey){if(ee.preventDefault(),ee.stopImmediatePropagation(),!re.upgMeta)return;let he=re.upgMeta.id,Be=re.upgMeta.upgType==="HM",ne=[1,3,4,5,6].includes(gp(re.upgMeta));if(ee.shiftKey){if((Be||!ne)&&this.adapter.buyCheap){let{bought:ke}=this.adapter.buyCheap(he);(ke instanceof c?ke:c.fromAny(ke??0)).isZero?.()||(on(),this.update());return}let{bought:ye}=this.adapter.buyMax(he);if(!(ye instanceof c?ye:c.fromAny(ye??0)).isZero?.()){if(on(),su(re.upgMeta,this.mode))try{dl(["reset"])}catch{}this.update()}return}if(ee.ctrlKey){if(Be){let ke=this.adapter.getUiModel(he);if(ke&&!ke.hmReadyToEvolve){let Fe=ke.hmNextMilestone;if(Fe&&ke.lvlBn&&Fe.cmp(ke.lvlBn)>0){let ae=0;try{let oe=Fe.sub(ke.lvlBn).toPlainIntegerString?.();ae=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Fe.sub(ke.lvlBn).toString())))}catch{}let te=R[ke.upg.costType]?.value,xe=te instanceof c?te:c.fromAny(te??0),z=Ii(ke.upg,ke.lvlBn,xe,ae).count,Z=!1;try{let oe=z?.toPlainIntegerString?.();Z=oe&&oe!=="Infinity"?Number(oe)>=ae:Number(z??0)>=ae}catch{}if(Z){let oe=this.adapter.buyNext(he,ae);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(on(),this.update());return}}}}let{bought:ye}=this.adapter.buyMax(he);if(!(ye instanceof c?ye:c.fromAny(ye??0)).isZero?.()){if(on(),su(re.upgMeta,this.mode))try{dl(["reset"])}catch{}this.update()}return}}re.upgMeta&&TE(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",ee=>{if(Je)return;let re=ee.currentTarget;if(re.dataset.locked==="1"||(ee.preventDefault(),ee.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:ye}=this.adapter.evolve(re.upgMeta.id);ye&&(lv(),this.update());return}let{bought:Be}=this.adapter.buyMax(re.upgMeta.id);if(!(Be instanceof c?Be:c.fromAny(Be??0)).isZero?.()){if(on(),su(re.upgMeta,this.mode))try{dl(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let m=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",m);let y=s?c.fromInt(0):_E(r.meta,r.levelNumeric,r.level),p=y instanceof c?y:c.fromAny(y),h=j(r.level),g=lu(h),v=j(p),w=lu(v),L=!p.isZero?.(),C=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,A=Number.isFinite(C)?Math.max(0,Math.floor(C)):1/0,q=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,P=m?!1:r.level?.isInfinite?.()?!0:Number.isFinite(A)&&Number.isFinite(q)?q>=A:!1,G=Number.isFinite(A)&&A===1,M=!!r.meta?.unlockUpgrade,U=!s&&M&&!P,T=!s&&M&&!U&&P,_,Y,Q=!1,ie=!1;if(s){_="",Y="";let X=u?(r.lockState?.reason||"").trim():"",K=X?`${r.title} (Locked, ${X})`:`${r.title} (Locked)`;i.setAttribute("aria-label",K)}else{if(U||T)_=U?"Unlockable":"Unlocked",Y=_,ie=!0;else if(!s&&G&&!M)P?(_="Owned",Y="Owned"):L?(_="Purchasable",Y="Purchasable"):(_="Not Owned",Y="Not Owned"),ie=!0;else{let X=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,K=String(g||"").replace(/,/g,""),fe=/|Infinity/i.test(K),ee=Number.isFinite(X)?X>=1e3:fe||/^\d{4,}$/.test(K);Q=L&&ee,Q?(_=`<span class="badge-lvl">${h}</span><span class="badge-plus">(+${v})</span>`,Y=`${g} (+${w})`):(_=L?`${h} (+${v})`:h,Y=L?`${g} (+${w})`:g)}i.setAttribute("aria-label",`${r.title}, ${Y}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let me=i.firstElementChild,ve=me.querySelector(".base"),Oe=me.querySelector(".icon"),Te=r.meta?.costType||"coins",W=r.useLockedBase||s?hE:r.baseIconOverride||Qy[Te]||Qy.coins;ve.src!==W&&(ve.src=W);let $=r.icon;if(!$)Oe.hidden||(Oe.hidden=!0);else{Oe.hidden&&(Oe.hidden=!1);let X=$;Oe._lastSrc!==X&&(Oe.src=X,Oe._lastSrc=X)}let H=me.querySelector(".maxed-overlay"),J=!s&&rv(r.meta),se=!s&&P;if(se||!s&&!P&&!m&&J){H||(H=document.createElement("img"),H.className="maxed-overlay",H.alt="",me.insertBefore(H,Oe));let X=se?gE:yE;H.src!==X&&(H.src=X)}else H&&H.remove();let x=me.querySelector(".level-badge");s?x&&x.remove():(x||(x=document.createElement("span"),x.className="level-badge",me.appendChild(x)),x.className="level-badge",ie&&x.classList.add("text-badge"),Q&&x.classList.add("two-line"),(L||U)&&x.classList.add("can-buy"),P&&x.classList.add("is-maxed"),_===Y?x.textContent!==_&&(x.textContent=_):x.innerHTML!==_&&(x.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),_s(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&lo(a)||(Pr(),Vy())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(Je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{Je&&Nn(80),this.close()},{passive:!0}),Ld(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&Zy(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,Je)try{setTimeout(()=>Lo(240),120)}catch{}Nn(10),_s(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||!t&&Wd()||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}};typeof window<"u"&&window.addEventListener("menu:scrollStop",()=>{or(!0)});cu={standard:new ml("standard"),automation:new ml("automation"),dna:new ml("dna")};rn=null,ut=null,uu=!1,au=null});var pv={};vt(pv,{applyHudLayout:()=>rr,initHudButtons:()=>AE,isMapUnlocked:()=>Sp,isShopUnlocked:()=>bp,lockMap:()=>yu,lockShop:()=>gu,unlockMap:()=>hu,unlockShop:()=>wi});function vp(e){let t=b();return t==null?e:`${e}:${t}`}function Fs(e){let t=vp(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function bp(){return Ip(),Fs(go.SHOP)}function Sp(){return Ip(),Fs(go.MAP)}function mu(e,t){let n=t?"1":"0",o=vp(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function Ip(){for(let e of Object.values(go)){let t=vp(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function No(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function yp(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",zi())}function kE(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function rr(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=kE(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(y=>e.querySelector(`.game-btn[data-btn="${y}"]`)).filter(Boolean),a=[...e.children].filter(y=>!l.includes(y)),u=[...l,...a];if(u.length&&u.some((y,p)=>e.children[p]!==y)){let y=document.createDocumentFragment();u.forEach(p=>y.appendChild(p)),e.appendChild(y)}let m=[...e.querySelectorAll(".game-btn")].filter(y=>!y.hidden);if(e.classList.remove("is-2","is-3","is-4"),m.forEach(y=>{y.style.gridColumn="",y.style.gridRow="",y.classList.remove("span-2"),y.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${m.length}`),!o){let y=getComputedStyle(e),p=parseFloat(y.columnGap||y.gap||"0")||0,h=e.clientWidth,g=Math.max(180,Math.floor((h-3*p)/4));if(m.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3";return}if(m.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3",m[2].style.gridColumn="4";return}}if(o&&m.length===3){let y=e.querySelector('[data-btn="help"]:not([hidden])'),p=e.querySelector('[data-btn="stats"]:not([hidden])'),h=e.querySelector('[data-btn="shop"]:not([hidden])');y&&p&&h&&(y.style.gridColumn="1",y.style.gridRow="1",p.style.gridColumn="2",p.style.gridRow="1",h.style.gridColumn="1 / -1",h.style.gridRow="2")}}function AE(){if(Ip(),No("help",!0),No("stats",!0),No("shop",Fs(go.SHOP)),No("map",Fs(go.MAP)),yp(),rr(),typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>nu(),{timeout:5e3}):setTimeout(()=>nu(),100),fv||(fv=!0,window.addEventListener("resize",rr),window.addEventListener("orientationchange",rr),window.addEventListener("saveSlot:change",()=>{No("shop",Fs(go.SHOP)),No("map",Fs(go.MAP)),yp(),rr()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||yp()})),!dv){dv=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&xs()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&lo(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function wi(){mu(go.SHOP,!0),No("shop",!0),rr()}function hu(){mu(go.MAP,!0),No("map",!0),rr()}function gu(){mu(go.SHOP,!1),No("shop",!1),rr()}function yu(){mu(go.MAP,!1),No("map",!1),rr()}var go,fv,dv,vu=De(()=>{ci();Ns();It();rs();go={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};fv=!1,dv=!1});function mv(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(X=>X.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let x=0;x<t;x++)d[x*f+2]=1/0;let m=new Int16Array(t),y=t;for(let x=0;x<t;x++)m[x]=t-1-x;let p=-1,h=document.createElement("canvas");h.className="cursor-trail-canvas",Object.assign(h.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(h);let g=h.getContext("2d",{alpha:!0,desynchronized:!0}),v=document.createElement("canvas");v.width=a,v.height=a;let w=v.getContext("2d");w.shadowColor="#FFEB3B",w.shadowBlur=l,w.fillStyle="#FFEB3B",w.beginPath(),w.arc(u,u,s,0,Math.PI*2),w.fill();let L=!1,C=null,A=null,q={left:0,top:0,width:0,height:0},P=1,G=!1,M=0,U=0,T=!1,_=null,Y=[],Q=()=>{if(G)return;let x=document.documentElement.clientWidth,X=document.documentElement.clientHeight;q={left:0,top:0,width:x,height:X,right:x,bottom:X,x:0,y:0}},ie=()=>{if(G)return;Q();let x=Math.min(window.devicePixelRatio||1,2);P=q.width>0?Math.min(x,512/q.width):x,h.width=q.width*P,h.height=q.height*P,g.scale(P,P),_=null},me=null;typeof ResizeObserver<"u"&&(me=new ResizeObserver(()=>{ie()}),me.observe(e));let ve=(x,X)=>{if(y<=0)return;let K=m[--y];K>p&&(p=K);let fe=K*f;d[fe]=x,d[fe+1]=X,d[fe+2]=0,d[fe+3]=n},Oe=(x,X,K)=>{if(C===null||A===null)K.count<r&&(ve(x,X),K.count++);else{let fe=x-C,ee=X-A,re=Math.hypot(fe,ee);if(re>=o){let he=Math.floor(re/o);for(let Be=1;Be<=he&&!(K.count>=r);Be++){let ne=Be*o/re;ve(C+fe*ne,A+ee*ne),K.count++}}K.count<r&&(ve(x,X),K.count++)}C=x,A=X},Te=x=>{if(G)return;M||(U=0,M=requestAnimationFrame(W)),q.width||Q();let X=0,K=0,fe=(ee,re)=>ee>=0&&ee<=q.width&&re>=0&&re<=q.height;if(x.getCoalescedEvents){let ee=x.getCoalescedEvents();if(ee.length>0)for(let re of ee){let he=re.clientX-X,Be=re.clientY-K;Y.push({x:he,y:Be,inside:fe(he,Be)})}else{let re=x.clientX-X,he=x.clientY-K;Y.push({x:re,y:he,inside:fe(re,he)})}}else{let ee=x.clientX-X,re=x.clientY-K;Y.push({x:ee,y:re,inside:fe(ee,re)})}},F=()=>{L=!1,C=null,A=null,Y.length=0},W=()=>{if(G)return;let x=performance.now();U||(U=x);let X=x-U;U=x,X>100&&(X=100);let K={count:0};if(Y.length>0){for(let Ue of Y)Ue.inside?(L=!0,Oe(Ue.x,Ue.y,K)):(L=!1,C=null,A=null);let ye=Y[Y.length-1];ye.inside&&(C!==ye.x||A!==ye.y)&&(ve(ye.x,ye.y),C=ye.x,A=ye.y),Y.length=0}else L&&C!==null&&A!==null&&ve(C,A);let fe=t-y;if(fe===0&&!T){M=0;return}_?g.clearRect(_.x,_.y,_.w,_.h):g.clearRect(0,0,q.width,q.height),T=!1;let ee=1/0,re=1/0,he=-1/0,Be=-1/0,ne=-1;if(fe>0)for(let ye=0;ye<=p;ye++){let Ue=ye*f,ke=d[Ue+2];if(ke>=d[Ue+3])continue;if(ke+=X,d[Ue+2]=ke,ke>=d[Ue+3]){m[y++]=ye;continue}ne=ye;let Fe=d[Ue+3],ae=ke/Fe,te=1-ae,xe=1-.4*ae;T=!0,g.globalAlpha=te;let E=a*xe,z=E/2,Z=d[Ue],oe=d[Ue+1],ge=Math.round(Z-z),le=Math.round(oe-z),We=Math.round(E);g.drawImage(v,ge,le,We,We),ge<ee&&(ee=ge),le<re&&(re=le);let nt=ge+We,be=le+We;nt>he&&(he=nt),be>Be&&(Be=be)}p=ne,ee!==1/0?(ee-=2,re-=2,he+=2,Be+=2,_={x:ee,y:re,w:he-ee,h:Be-re}):_=null,M=requestAnimationFrame(W)};window.addEventListener("resize",ie),window.addEventListener("scroll",Q,{passive:!0}),window.addEventListener("focus",Q,{passive:!0}),document.addEventListener("visibilitychange",Q,{passive:!0});let $={passive:!0},H=x=>{Q(),Te(x)},J=x=>{Q(),Te(x)};e.addEventListener("pointermove",Te,$),e.addEventListener("pointerdown",J,$),e.addEventListener("pointerenter",H,$),e.addEventListener("pointerleave",F,$),e.addEventListener("pointercancel",F,$),ie(),M=requestAnimationFrame(W);let se=setInterval(Q,1e3);return{destroy:()=>{G=!0,M&&cancelAnimationFrame(M),se&&clearInterval(se),me&&(me.disconnect(),me=null);try{window.removeEventListener("resize",ie)}catch{}try{window.removeEventListener("scroll",Q)}catch{}try{window.removeEventListener("focus",Q)}catch{}try{document.removeEventListener("visibilitychange",Q)}catch{}try{e.removeEventListener("pointermove",Te),e.removeEventListener("pointerdown",J),e.removeEventListener("pointerenter",H),e.removeEventListener("pointerleave",F),e.removeEventListener("pointercancel",F)}catch{}h.remove()}}}var hv=De(()=>{});var _v={};vt(_v,{clearPendingGains:()=>Ap,getPassiveCoinReward:()=>zc,initCoinPickup:()=>$E,setCoinMultiplier:()=>PE,triggerPassiveCollect:()=>Od});function gv(e){if(!e||typeof e!="object"){vl=!1,bu=!1,Su="0",Li.clear();return}vl=!!e.unlocked,bu=!!e.level?.isInfinite?.();try{Su=e.level?.toPlainIntegerString?.()??"0"}catch{Su="0"}vl?bu&&Li.clear():Li.clear()}function NE(){if(typeof Ei=="function")try{Ei()}catch{}try{gv(ht())}catch{vl=!1,Li.clear()}try{Ei=_i(e=>{gv(e)})}catch{Ei=null}}function PE(e){OE=e;try{R.coins?.mult?.set&&R.coins.mult.set(e)}catch{}}function Lp(){try{let e=kc();e instanceof c?Ds=e.clone?.()??e:e!=null?Ds=c.fromAny(e):Ds=c.fromInt(1)}catch{Ds=c.fromInt(1)}}function BE(){yv||(yv=!0,Lp(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",Lp),typeof window<"u"&&window.addEventListener("saveSlot:change",Lp))}function FE(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Tp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function Cp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*UE:0}function DE({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,m=0,y=null,p=null,h=Cp(),g=0,v=0,w=0,L=!1,C=null,A=null,q=()=>{if(L)return;let $=document.documentElement.clientWidth,H=document.documentElement.clientHeight;C={left:0,top:0,width:$,height:H,right:$,bottom:H,x:0,y:0}},P=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",y=null,p=null},G=()=>{if(!l||v<=0){P();return}let $=v*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${d-v}px, ${m-v}px, 0)`,s.classList.add("is-visible")},M=()=>{if(!(!l||v<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=v+_p,H=[];if(typeof i.findCoinTargetsInPath=="function"&&y!==null&&p!==null?H=i.findCoinTargetsInPath(y,p,d,m,$):H=i.findCoinTargetsInRadius(d,m,$),y=d,p=m,H&&H.length>0)if(typeof r=="function"){let J=[];for(let se=0;se<H.length;se++){let ce=H[se],x={coin:ce};ce.el&&i.getCoinTransform&&(x.opts={transform:i.getCoinTransform(ce.el)}),J.push(x)}r(J)}else for(let J=0;J<H.length;J++){let se=H[J],ce=i.ensureCoinVisual?i.ensureCoinVisual(se):se.el;if(ce){let x=i.getCoinTransform?i.getCoinTransform(ce):ce.style.transform||"";o(ce,{transform:x})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=v+_p,H=i.findCoinsInRadius(d,m,$);if(y=d,p=m,H&&H.length>0){let J=[];for(let se=0;se<H.length;se++){let ce=H[se],x=i.getCoinTransform?i.getCoinTransform(ce):ce.style.transform;J.push({el:ce,opts:{transform:x}})}typeof r=="function"&&r(J)}}else{let $=t.children,H=v+_p,J=[];for(let se=$.length-1;se>=0;se--){let ce=$[se];if(ce.dataset.collected==="1"||!ce.matches(n))continue;let x=ce.getBoundingClientRect(),X=x.left+x.width/2,K=x.top+x.height/2,fe=X-u,ee=K-f;Math.hypot(fe,ee)<=H&&J.push(ce)}if(!J.length)return;if(typeof r=="function"){let se=[];for(let ce=0;ce<J.length;ce++){let x=J[ce],X=window.getComputedStyle(x);se.push({el:x,opts:{transform:X.transform}})}r(se)}else{let se=[];for(let ce=0;ce<J.length;ce++){let x=J[ce],X=window.getComputedStyle(x);se.push(X.transform)}for(let ce=0;ce<J.length;ce++)o(J[ce],{transform:se[ce]})}}},U=()=>{w=0,G(),!(!l||v<=0||L)&&(M(),T())},T=()=>{!l||v<=0||w||L||(w=requestAnimationFrame(U))},_=$=>{if(!$||L||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,f=$.clientY,C||q();let H=C;d=u,m=f,l=d>=0&&d<=H.width&&m>=0&&m<=H.height,T()},Y=()=>{l=!1,P(),y=null,p=null},Q=()=>{y=null,p=null},ie=()=>{g=Ac(),v=g*h,G(),T()},me=()=>{if(!(L||!a)){if(q(),C){let $=C;d=u-$.left,m=f-$.top,l=d>=0&&d<=$.width&&m>=0&&m<=$.height}T()}},ve=()=>{if(h=Cp(),v=g*h,q(),a&&C){let $=C;d=u-$.left,m=f-$.top,l=d>=0&&d<=$.width&&m>=0&&m<=$.height}T()},Oe=$=>{q(),_($)},Te=$=>{Q(),Oe($)},F=()=>{L=!0,w&&(cancelAnimationFrame(w),w=0),A&&clearInterval(A);try{window.removeEventListener("scroll",me)}catch{}try{window.removeEventListener("resize",ve)}catch{}try{window.removeEventListener("saveSlot:change",ie)}catch{}try{document.removeEventListener("ccc:upgrades:changed",ie)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",Oe)}catch{}try{e.removeEventListener("pointerenter",Te)}catch{}try{e.removeEventListener("pointerleave",Y)}catch{}try{e.removeEventListener("pointercancel",Y)}catch{}try{window.removeEventListener("blur",Q)}catch{}try{s.remove()}catch{}},W={passive:!0};return e.addEventListener("pointermove",_,W),e.addEventListener("pointerdown",Oe,W),e.addEventListener("pointerenter",Te,W),e.addEventListener("pointerleave",Y,W),e.addEventListener("pointercancel",Y,W),window.addEventListener("resize",ve),window.addEventListener("scroll",me,{passive:!0}),window.addEventListener("focus",q,{passive:!0}),window.addEventListener("blur",Q,{passive:!0}),document.addEventListener("visibilitychange",()=>{q(),document.hidden&&Q()},{passive:!0}),window.addEventListener("saveSlot:change",ie),document.addEventListener("ccc:upgrades:changed",ie),A=setInterval(q,1e3),ie(),{destroy:F}}function Ap(){bl=null,Sl=null,Il=null}function Lv(e){let t=Tp.clone?.()??c.fromInt(1),n=Ev(t),o=yo(vv),i=xv(e??Su);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Ro=="function"&&Ro()?yo(Ds):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function zc(){let{coinGain:e,xpGain:t,mpGain:n}=Lv(null);return{coins:e,xp:t,mp:n}}function Od(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=Lv(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=Hn(Re.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{Rn=Rn?.add?Rn.add(r):yo(r)}catch{Rn=yo(r)}yl(),a||bv(r);let u=typeof dn=="function"?dn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&Sv(i),s.isZero?.()||Iv(s)}function $E({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){wp?.destroy&&wp.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};NE(),BE(),a.style.touchAction="none";let d=null,m=null;Rn=R.coins.value,Mp=()=>{let x=j(Rn);x.includes("<span")?f.innerHTML=x:f.textContent=x},wv(),yl();let y=x=>{x?.detail&&x.detail.key==="coins"&&(Rn=x.detail.value,yl())};window.addEventListener("currency:change",y);let p=x=>{if(!(!x?.detail||x.detail.key!=="coins"))try{let{mult:X}=x.detail;X instanceof c?Qn=X.clone?.()??X:X!=null?Qn=c.fromAny(X):Qn=c.fromInt(1),xi=!!Qn?.isInfinite?.()}catch{Qn=null,xi=!1}};window.addEventListener("currency:multiplier",p);let h=b();if(h==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${h}`,v=`ccc:unlock:shop:progress:${h}`,w=localStorage.getItem("ccc:unlock:shop:progress"),L=localStorage.getItem("ccc:unlock:shop");w!=null&&localStorage.getItem(v)==null&&localStorage.setItem(v,w),L!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,L),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let x=parseInt(localStorage.getItem(v)||"0",10);if(localStorage.setItem(v,String(x)),x>=10&&localStorage.getItem(g)!=="1"){try{wi()}catch{}localStorage.setItem(g,"1")}}let C=new URL(i,document.baseURI).href,A=x=>x instanceof HTMLElement?x._coinObj?!x._coinObj.isRemoved&&x.dataset.collected!=="1":x.dataset.collected!=="1"&&x.matches(r):!1;function q(x){try{x.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(q);let P=Je?.12:.3,G=0;function M(x=C){if(x===C){let X=performance.now();if(X-G<40)return;G=X}ft(x,{volume:P})}function U(x,X={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(x);let K=()=>{x&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(x):x.remove())};if(l||Je){K();return}let fe="translate3d(0,0,0)";X.transform?X.transform!=="none"&&(fe=X.transform):fe=x.style.transform||"translate3d(0,0,0)",x.style.setProperty("--ccc-start",fe),x.classList.add("coin--collected");let ee=!1,re=()=>{ee||(ee=!0,x.removeEventListener("animationend",re),K())};x.addEventListener("animationend",re),setTimeout(re,600)}function T(x){if(!x||!x.length)return;let X=C,K=-1,fe=!1;for(let ae of x){let te=ae.coin||ae.el&&ae.el._coinObj;te&&(te.sizeIndex!==void 0?te.sizeIndex>K&&(K=te.sizeIndex,te.soundSrc&&(X=te.soundSrc,fe=!0)):te.soundSrc&&!fe&&(X=te.soundSrc,fe=!0))}M(X);let ee=null,re=null,he=null,Be=0,ne=Hn(Re.COINS),ye=typeof dn=="function"?dn():!0,Ue=typeof Ro=="function"&&Ro(),ke=15,Fe=0;for(let ae of x){let te=ae.el,xe=ae.coin;if(!xe&&te&&te._coinObj&&(xe=te._coinObj),te&&!A(te)||xe&&xe.isRemoved)continue;Be++,te&&(te.dataset.collected="1"),Fe<ke?(!te&&xe&&e&&e.ensureCoinVisual&&(te=e.ensureCoinVisual(xe),te&&(te.dataset.collected="1")),te?(U(te,ae.opts||{}),Fe++):xe&&e&&e.removeCoinTarget&&e.removeCoinTarget(xe)):xe&&e&&e.removeCoinTarget?e.removeCoinTarget(xe):te&&(e&&e.detachCoin&&e.detachCoin(te),e&&e.recycleCoin?e.recycleCoin(te):te.remove());let E=te?FE(te):Tp,z=xe?.mutationLevel??(te?.dataset?.mutationLevel||null),Z=Ev(E),oe=yo(vv),ge=yo(Ds);if(xe&&xe.valueMultiplier&&xe.valueMultiplier>1){try{Z=Z.mulDecimalFloor(xe.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(xe.valueMultiplier)}catch{}try{ge=ge.mulDecimalFloor(xe.valueMultiplier)}catch{}}let le=xv(z);if(le){try{Z=Z.mulBigNumInteger(le)}catch{}try{oe=oe.mulBigNumInteger(le)}catch{}}ne||(ee=$s(ee,Z)),ye&&(re=$s(re,oe)),Ue&&(he=$s(he,ge))}if(Be!==0){if(ee&&!ee.isZero?.()){try{Rn=Rn?.add?Rn.add(ee):yo(ee)}catch{Rn=yo(ee)}bv(ee),yl()}if(re&&!re.isZero?.()&&Sv(re),he&&!he.isZero?.()&&Iv(he),localStorage.getItem(g)!=="1"){let te=parseInt(localStorage.getItem(v)||"0",10)+Be;if(localStorage.setItem(v,String(te)),te>=10){try{wi()}catch{}localStorage.setItem(g,"1")}}}}function _(x,X={}){return T([{el:x,opts:X}]),!0}d=DE({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:T,spawner:e}),m=mv(a);let Y=x=>{if(x.target===u)return;let X=x.target.closest(r);if(X&&A(X)){let K={};e&&typeof e.getCoinTransform=="function"&&(K.transform=e.getCoinTransform(X)),_(X,K)}};u.addEventListener("pointerdown",Y,{passive:!0}),Je||u.addEventListener("mouseover",Y,{passive:!0});let Q=25,ie=null,me=()=>{let x=document.documentElement.clientWidth,X=document.documentElement.clientHeight;ie={left:0,top:0,width:x,height:X,right:x,bottom:X,x:0,y:0}};window.addEventListener("resize",me),window.addEventListener("scroll",me,{passive:!0}),me();let ve=null,Oe=null,Te=()=>{ve=null,Oe=null};a.addEventListener("pointerleave",Te,{passive:!0}),a.addEventListener("pointerenter",Te,{passive:!0}),window.addEventListener("blur",Te,{passive:!0});function F(x,X){if(e&&typeof e.findCoinTargetsInRadius=="function"){ie||me();let K=x,fe=X,ee=[];if(typeof e.findCoinTargetsInPath=="function"&&ve!==null&&Oe!==null?ee=e.findCoinTargetsInPath(ve,Oe,K,fe,Q,!0):ee=e.findCoinTargetsInRadius(K,fe,Q,!0),ve=K,Oe=fe,ee&&ee.length>0){let re=[];for(let he=0;he<ee.length;he++){let Be=ee[he],ne={coin:Be};Be.el&&e.getCoinTransform&&(ne.opts={transform:e.getCoinTransform(Be.el)}),re.push(ne)}T(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){ie||me();let K=x,fe=X,ee=e.findCoinsInRadius(K,fe,Q);if(ve=K,Oe=fe,ee&&ee.length>0){let re=[];for(let he of ee){let Be=e.getCoinTransform?e.getCoinTransform(he):he.style.transform;re.push({el:he,opts:{transform:Be}})}T(re)}}else{let K=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],fe=new Set;for(let ee=0;ee<K.length;ee++){let re=x+K[ee][0],he=X+K[ee][1],Be=document.elementsFromPoint(re,he);for(let ne=0;ne<Be.length;ne++){let ye=Be[ne];A(ye)&&!fe.has(ye)&&fe.add(ye)}}if(fe.size>0){let ee=[];fe.forEach(re=>ee.push({el:re})),T(ee)}}}let W=null,$=!1;function H(x,X){W={x,y:X},$||($=!0,requestAnimationFrame(()=>{W&&(F(W.x,W.y),W=null),$=!1}))}a.addEventListener("pointerdown",x=>{H(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointermove",x=>{x.pointerType!=="mouse"&&H(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("pointerup",x=>{x.pointerType!=="mouse"&&H(x.clientX,x.clientY)},{passive:!0}),a.addEventListener("mousemove",x=>{H(x.clientX,x.clientY)},{passive:!0});function J(x){}let se=setInterval(me,1e3),ce=()=>{if(clearInterval(se),Iu(),Mp=()=>{},typeof window<"u"&&(window.removeEventListener("resize",me),window.removeEventListener("beforeunload",Iu),window.removeEventListener("currency:multiplier",p),window.removeEventListener("currency:change",y),window.removeEventListener("blur",Te)),typeof Ei=="function"){try{Ei()}catch{}Ei=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(m?.destroy){try{m.destroy()}catch{}m=null}try{u.removeEventListener("pointerdown",Y),Je||u.removeEventListener("mouseover",Y)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(x=>a.replaceWith(a.cloneNode(!0)))}catch{}};return wp={destroy:ce},{get count(){return Rn},set count(x){Rn=c.fromAny?c.fromAny(x):c.fromInt(Number(x)||0),yl()},setMobileVolume:J,destroy:ce,collectBatch:T,getMagnetUnitPx:Cp}}var vl,bu,Su,Ei,wp,vv,Tp,RE,Us,Li,OE,Ds,yv,bl,Sl,Il,Ep,Rn,Mp,xp,yl,UE,_p,yo,$s,Iu,kp,bv,Sv,Iv,Qn,xi,wv,Ev,xv,Za=De(()=>{It();Et();zt();vu();zn();po();To();fo();hv();En();vl=!1,bu=!1,Su="0",Ei=null;wp=null,vv=c.fromInt(1),Tp=c.fromInt(1),RE=c.fromInt(1);try{Us=c.fromAny("Infinity")}catch{Us=null}Li=new Map,OE="1",Ds=c.fromInt(1),yv=!1,bl=null,Sl=null,Il=null,Ep=!1,Rn=null,Mp=()=>{},xp=!1,yl=()=>{xp||(xp=!0,requestAnimationFrame(()=>{xp=!1,Mp()}))};UE=.05,_p=8;yo=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},$s=(e,t)=>{if(!t)return e;if(!e)return yo(t);try{return e.add(t)}catch{try{return yo(e).add(t)}catch{return yo(t)}}},Iu=()=>{let e=bl;if(bl=null,e&&!e.isZero?.())try{R.coins.add(e)}catch{}let t=Sl;if(Sl=null,t&&!t.isZero?.())try{ts(t)}catch{}let n=Il;if(Il=null,n&&!n.isZero?.())try{Ms(n)}catch{}},kp=()=>{Ep||(Ep=!0,requestAnimationFrame(()=>{Ep=!1,Iu()}))},bv=e=>{bl=$s(bl,e),kp()},Sv=e=>{Sl=$s(Sl,e),kp()},Iv=e=>{Il=$s(Il,e),kp()};typeof window<"u"&&window.addEventListener("beforeunload",Iu,{passive:!0});Qn=null,xi=!1,wv=()=>{try{let e=R?.coins?.mult;if(!e||typeof e.get!="function"){Qn=null,xi=!1;return}let t=e.get();if(!t){Qn=c.fromInt(1),xi=!1;return}Qn=t.clone?.()??c.fromAny(t),xi=!!Qn?.isInfinite?.()}catch{Qn=null,xi=!1}},Ev=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Qn||wv();let n=Qn;if(!n)try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(xi||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},xv=e=>{if(!vl)return null;if(bu){if(Us)try{return Us.clone?.()??Us}catch{return Us}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=Li.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{Li.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=qs(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(RE)===0,s=r.clone?.()??r;if(Li.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function qE(e){if(e==null)return 0;try{let t=localStorage.getItem(Cv(e));return t?parseInt(t,10):0}catch{return 0}}function GE(e,t){if(e!=null)try{localStorage.setItem(Cv(e),t.toString())}catch{}}function HE(e){if(e==null)return 0;try{let t=localStorage.getItem(Tv(e));return t?parseInt(t,10):0}catch{return 0}}function XE(e,t){if(e!=null)try{localStorage.setItem(Tv(e),t.toString())}catch{}}function VE(e){if(e==null)return 0;try{let t=localStorage.getItem(kv(e));return t?parseInt(t,10):0}catch{return 0}}function YE(e,t){if(e!=null)try{localStorage.setItem(kv(e),t.toString())}catch{}}function WE(e){if(e==null)return 0;try{let t=localStorage.getItem(Av(e));return t?parseInt(t,10):0}catch{return 0}}function zE(e,t){if(e!=null)try{localStorage.setItem(Av(e),t.toString())}catch{}}function Nv(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let p=Number(e.toString());isNaN(p)||(t=p),(e==="Infinity"||p===1/0)&&(n=!0)}catch{}let o=b(),r=qE(o),i=r;i<1&&n&&(i=1),i<2&&it(4)>=1&&(i=2),i!==r&&(r=i,GE(o,r));let s=HE(o),l=s;l<1&&it(4)>=1&&(l=1),l!==s&&(s=l,XE(o,s));let a=VE(o),u=a;u<1&&it(4)>=1&&(u=1),u!==a&&(a=u,YE(o,a));let f=WE(o),d=f;d<1&&it(4)>=1&&(d=1),d!==f&&(f=d,zE(o,f));let m=[],y=[];for(let p of Mv){let h=p;if(n){h={...p,description:[...p.description]};let g=Mn(),v=Mo(),w=g+v;if(w>1&&(w=1),p.id===1){let L=Math.pow(10,w),C=Pe(L);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${C}x</span>`)}else if(p.id===2){let L=Math.pow(10,w),C=Pe(L);h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${C}x</span>`),w<1&&h.description.push("The largest Coins BYPASS the exponent")}else if(p.id===4){let L=Math.log10(4444e9),C=ue(L*w),A=j(C);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${A}x</span>`)}else if(p.id===14){let L=Math.log10(1414e16),C=ue(L*w),A=j(C);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${A}x</span>`)}else if(p.id===17){let A=ue(10*w),q=ue(5*w),P=j(A),G=j(q);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${G}x</span>`)}else if(p.id===18){let A=ue(10*w),q=ue(5*w),P=j(A),G=j(q);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${G}x</span>`)}}if(p.id===9&&(h===p&&(h={...p,description:[...p.description]}),r===0?h.description=["This milestone is hidden for now"]:r===1&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===10&&(h===p&&(h={...p,description:[...p.description]}),s===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===13){h===p&&(h={...p,description:[...p.description]});let v=Mt()*1.5-.5,w=Math.pow(100,v),L=Pe(w);h.description[0]=`Generates <span style="color:#00e5ff">${L}%</span> of your pending Gold each second`}if(p.id===14&&(h===p&&(h={...p,description:[...p.description]}),a===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===15)if(h===p&&(h={...p,description:[...p.description]}),f===0)h.description=["This milestone is hidden until you research Lab Node 4"];else{let g=Bc(!0),v=Pe(g);h.description[0]=`Unspent DNA boosts Coins: <span style="color:#00e5ff">${v}x</span>`}if(p.id===16){h===p&&(h={...p,description:[...p.description]});let v=Mt()*1.5-.5,w=Math.pow(100,v),L=Pe(w);h.description[0]=`Generates <span style="color:#00e5ff">${L}%</span> of your pending Magic each second`}p.surgeLevel<=t?m.push(h):y.push(h)}return[...m,...y.slice(0,2)]}var Mv,Np,Cv,Tv,kv,Av,Rv=De(()=>{zt();Et();Et();Cn();xr();It();Mv=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${j(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade","Makes each Workshop Level triple Gear production instead of doubling it"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]},{id:10,surgeLevel:10,description:["Unlocks new DNA upgrades"]},{id:11,surgeLevel:11,description:["Unlocks a new automation upgrade","Makes each Workshop Level quadruple Gear production instead of tripling it"]},{id:12,surgeLevel:12,affectedByTsunami:!0,description:["Significantly boosts the effect Lab Level has on RP multiplier"]},{id:13,surgeLevel:13,affectedByTsunami:!0,description:['Generates <span style="color:#00e5ff">0.1%</span> of your pending Gold each second']},{id:14,surgeLevel:14,affectedByTsunami:!0,description:[`Multiplies DNA value by <span style="color:#00e5ff">${j(c.fromInt(1414e16))}x</span>`]},{id:15,surgeLevel:15,affectedByTsunami:!0,description:['Unspent DNA boosts Coins: <span style="color:#00e5ff">1x</span>']},{id:16,surgeLevel:16,affectedByTsunami:!0,description:['Generates <span style="color:#00e5ff">0.1%</span> of your pending Magic each second']},{id:17,surgeLevel:17,affectedByTsunami:!0,description:[`Multiplies Magic value by <span style="color:#00e5ff">${j(c.fromInt(1e10))}x</span>`,`Divides Coin value by <span style="color:#00e5ff">${j(c.fromInt(1e5))}x</span>`]},{id:18,surgeLevel:18,affectedByTsunami:!0,description:[`Multiplies Coin value by <span style="color:#00e5ff">${j(c.fromInt(1e10))}x</span>`,`Divides Magic value by <span style="color:#00e5ff">${j(c.fromInt(1e5))}x</span>`]},{id:19,surgeLevel:19,description:["Unlocks a new DNA upgrade"]}],Np=Mv.filter(e=>e.affectedByTsunami).map(e=>e.id),Cv=e=>`ccc:surge:milestone9:state:${e}`,Tv=e=>`ccc:surge:milestone10:state:${e}`,kv=e=>`ccc:surge:milestone14:state:${e}`,Av=e=>`ccc:surge:milestone15:state:${e}`});function Ov(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ft("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(E,z){E.style.position="absolute",E.style.left="50%";let Z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ge=!!o.mpHTML;z==="coin"?(E.style.top="77%",E.style.transform=`translateX(-50%) ${Z}`):oe&&ge?(E.style.top="72.5%",z==="mp"?E.style.transform=`translateX(calc(-100% - 44px)) ${Z}`:E.style.transform=`translateX(44px) ${Z}`):(z==="mp"?E.style.top="66%":z==="xp"&&(E.style.top="72%"),E.style.transform=`translateX(-50%) ${Z}`),E.style.transformOrigin="center center";let le=E.firstElementChild;le&&(le.removeAttribute("hidden"),le.style.display="flex")}if(o.coinHTML){let E=document.createElement("div");E.innerHTML=o.coinHTML,f(E,"coin"),u.appendChild(E)}if(o.xpHTML){let E=document.createElement("div");E.innerHTML=o.xpHTML,f(E,"xp"),u.appendChild(E)}if(o.mpHTML){let E=document.createElement("div");E.innerHTML=o.mpHTML,f(E,"mp"),u.appendChild(E)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let m=new Image;m.src="img/misc/merchant.webp";let y=!1;m.onload=()=>{y=!0},m.onerror=E=>{console.error("Tsunami: Merchant load failed",E)};let p,h,g=[],v=[],w=0;function L(){g=[],v=[];let E=h*.65,z=E+h*.15,oe=300*(Math.min(p,h)*5e-4),ge=p*.8,le=ge-oe*.6,We=ge+oe*.6;for(let pt=0;pt<100;pt++){let cn=Math.random()*p,qn=z+Math.random()*(h-z);v.push({x:cn,y:qn})}let nt=(pt,cn,qn)=>{if(pt>p*.1&&pt<p*.9){let Ut=h-E,wn=E+Ut*.15;if(cn>wn)return!1}else if(qn==="tree"){let Ut=h-E,wn=E+Ut*.5;if(cn>wn)return!1}return!(qn==="tree"&&pt>le&&pt<We)},be=(pt,cn,qn,Ut,wn)=>{for(let Yr=0;Yr<cn;Yr++){let Do,$o,pr=!1,Ae=0;for(;!pr&&Ae<50;){wn?Do=wn():Do=Math.random()*p;let I=h,k=Math.random();if($o=E+20+k*k*(I-E-20),nt(Do,$o,pt)&&(pr=!0,pt==="tree")){for(let O of g)if(O.type==="tree"){let N=O.x-Do,B=O.y-$o;if(Math.sqrt(N*N+B*B)<Math.max(p*.08,100)){pr=!1;break}}}Ae++}if(pr){let k=.6+($o-E)/(h-E)*.6,O=(qn+Math.random()*Ut)*k;g.push({type:pt,x:Do,y:$o,scale:O})}}},Ge=3+Math.floor(Math.random()*3);be("tree",Ge,.8,.4,()=>Math.random()*(p*.1)),be("tree",Ge,.8,.4,()=>p*.9+Math.random()*(p*.1));let Xt=5+Math.floor(Math.random()*3);be("tree",Xt,.8,.4,()=>p*.1+Math.random()*(p*.8)),be("rock",20,.6,.4),be("shell",30,.3,.3),g.sort((pt,cn)=>pt.y-cn.y)}let C=a.getContext("2d",{alpha:!1}),A=d.getContext("2d",{alpha:!0});function q(){let E=window.devicePixelRatio||1;p=window.innerWidth,h=window.innerHeight,a.width=p*E,a.height=h*E,a.style.width=p+"px",a.style.height=h+"px",d.width=p*E,d.height=h*E,d.style.width=p+"px",d.style.height=h+"px",C.scale(E,E),A.scale(E,E),L(),w=-50}window.addEventListener("resize",q),q();let P=Date.now(),G=!0,M,U=!1,T={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},Y=!1,Q=[],ie=0,me=!1,ve=0,Oe=5e3,Te=!1,F=0,W=[],$=6;for(let E=0;E<$;E++)W.push({offset:Math.random()*1e3,speedBase:.001+E*5e-4,amplitudeBase:10+E*5});let H=[],J=400;function se(E,z,Z){return E*(1-Z)+z*Z}function ce(E){let z=parseInt(E.slice(1),16);return{r:z>>16&255,g:z>>8&255,b:z&255}}function x(E,z,Z){let oe=ce(E),ge=ce(z),le=Math.round(se(oe.r,ge.r,Z)),We=Math.round(se(oe.g,ge.g,Z)),nt=Math.round(se(oe.b,ge.b,Z));return`rgb(${le},${We},${nt})`}function X(E,z,Z){let oe=[],ge=E,le=z,We=20;for(;le<Z;){let nt=ge+(Math.random()-.5)*60,be=le+We+Math.random()*30;oe.push({x1:ge,y1:le,x2:nt,y2:be}),ge=nt,le=be}return oe}function K(E,z,Z,oe,ge,le){E.beginPath(),E.moveTo(z+le,Z),E.lineTo(z+oe-le,Z),E.quadraticCurveTo(z+oe,Z,z+oe,Z+le),E.lineTo(z+oe,Z+ge-le),E.quadraticCurveTo(z+oe,Z+ge,z+oe-le,Z+ge),E.lineTo(z+le,Z+ge),E.quadraticCurveTo(z,Z+ge,z,Z+ge-le),E.lineTo(z,Z+le),E.quadraticCurveTo(z,Z,z+le,Z),E.closePath()}function fe(E,z,Z,oe,ge){E.save(),E.translate(z,Z),E.scale(oe,oe),E.beginPath(),E.moveTo(0,0),E.quadraticCurveTo(10,-40,-5,-80),E.lineTo(5,-80),E.quadraticCurveTo(20,-40,10,0),E.fillStyle=ge.rock,E.fill(),E.translate(0,-80),E.fillStyle=ge.leaf;for(let le=0;le<7;le++)E.save(),E.rotate(le/7*Math.PI*2-Math.PI/2),E.beginPath(),E.moveTo(0,0),E.quadraticCurveTo(30,-10,60,0),E.quadraticCurveTo(30,10,0,0),E.fill(),E.restore();E.restore()}function ee(E,z,Z,oe,ge){E.save(),E.translate(z,Z),E.scale(oe,oe),E.fillStyle=ge.rock,E.beginPath(),E.moveTo(-20,0),E.bezierCurveTo(-20,-15,-10,-25,0,-25),E.bezierCurveTo(10,-25,20,-15,20,0),E.fill(),E.fillStyle="rgba(0,0,0,0.2)",E.beginPath(),E.ellipse(0,0,20,5,0,0,Math.PI*2),E.fill(),E.restore()}function re(E,z,Z,oe,ge){E.save(),E.translate(z,Z),E.scale(oe,oe),E.fillStyle=ge.shell,E.beginPath(),E.arc(0,0,10,Math.PI,0),E.lineTo(0,0),E.fill(),E.strokeStyle=ge.sandDark,E.lineWidth=1,E.beginPath();for(let le=1;le<5;le++){let We=Math.PI+le/5*Math.PI;E.moveTo(0,0),E.lineTo(Math.cos(We)*10,Math.sin(We)*10)}E.stroke(),E.restore()}function he(E,z,Z,oe,ge){E.fillStyle=ge.sandDark,E.fillRect(-50,oe,z+100,Z-oe),E.fillStyle=ge.sandDark,E.save(),E.fillStyle=ge.sandLight,E.globalAlpha=.3,E.beginPath(),E.moveTo(-50,Z+100),E.lineTo(-50,oe),E.bezierCurveTo(z*.3,oe-20,z*.7,oe+20,z+50,oe),E.lineTo(z+50,Z+100),E.fill(),E.globalAlpha=.6;let le=oe+Z*.05;E.beginPath(),E.moveTo(-50,Z+100),E.lineTo(-50,le),E.bezierCurveTo(z*.4,le+40,z*.6,le-10,z+50,le+20),E.lineTo(z+50,Z+100),E.fill(),E.globalAlpha=1;let We=oe+Z*.15;E.beginPath(),E.moveTo(-50,Z+100),E.lineTo(-50,We),E.bezierCurveTo(z*.2,We-10,z*.8,We+30,z+50,We+10),E.lineTo(z+50,Z+100),E.fill(),E.fillStyle=ge.sandDark,E.globalAlpha=.1,v.forEach(nt=>{E.fillRect(nt.x,nt.y,2,2)}),E.restore()}function Be(E,z,Z,oe=null){let ge=oe||1,le=!!oe&&oe>5;Y&&!le&&!Te&&ft("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),Q.push({x:le?z/2:Math.random()*z,y:le?Z/2:Math.random()*Z,radius:0,maxRadius:le?Math.max(z,Z)*1.5:(100+Math.random()*400)*ge,speed:le?40:(5+Math.random()*15)*ge,opacity:1,hue:225+Math.random()*15,life:1})}function ne(E,z,Z,oe=.5,ge=!0){let le=.1+oe*.7,We=Math.floor(1+oe*4);if(ge&&!Te){for(let nt=0;nt<We;nt++)if(Q.length<50&&Math.random()<le){let be=1+oe*2;Be(E,z,Z,be)}}E.save(),E.globalCompositeOperation="lighter";for(let nt=Q.length-1;nt>=0;nt--){let be=Q[nt];if(be.radius+=be.speed,be.opacity-=.015,be.life-=.015,be.opacity<=0||be.radius>be.maxRadius){Q.splice(nt,1);continue}let Ge=E.createRadialGradient(be.x,be.y,0,be.x,be.y,be.radius),Xt=be.opacity;Ge.addColorStop(0,`hsla(${be.hue}, 100%, 80%, ${Xt})`),Ge.addColorStop(.3,`hsla(${be.hue}, 100%, 40%, ${Xt*.9})`),Ge.addColorStop(.7,`hsla(${be.hue}, 100%, 15%, ${Xt*.6})`),Ge.addColorStop(1,`hsla(${be.hue}, 100%, 5%, 0)`),E.fillStyle=Ge,E.beginPath(),E.arc(be.x,be.y,be.radius,0,Math.PI*2),E.fill()}E.restore()}function ye(){if(!G)return;let E=Date.now(),z=E-P;Math.min(z/t,1)>=1&&!U&&(U=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ge=6e3,le=5e4,We=5e4,nt=5e3,be=4e4,Ge=0;z<ge?Ge=0:z<le?Ge=(z-ge)/(le-ge):Ge=1;let Xt=0;z>be&&(Xt=Math.max(0,(z-be)/(le-be))),z>le&&(Xt=1),Xt>.1&&!i&&(i=ft("sounds/tsu_rumble.ogg",{volume:.8}));let pt={skyTop:x(T.skyTop,_.skyTop,Ge),skyBottom:x(T.skyBottom,_.skyBottom,Ge),sun:x(T.sun,_.sun,Ge),waterDeep:x(T.waterDeep,_.waterDeep,Ge),waterMid:x(T.waterMid,_.waterMid,Ge),waterPeak:x(T.waterPeak,_.waterPeak,Ge),foam:x(T.foam,_.foam,Ge),sandLight:x(T.sandLight,_.sandLight,Ge),sandDark:x(T.sandDark,_.sandDark,Ge),rock:x(T.rock,_.rock,Ge),leaf:x(T.leaf,_.leaf,Ge),shell:x(T.shell,_.shell,Ge)},cn=0,qn=0;if(Ge>.5||Te){let Ae=(Ge-.5)*2*5+Xt*25;F>0&&(Ae+=50),cn=(Math.random()-.5)*Ae,qn=(Math.random()-.5)*Ae}A.clearRect(0,0,p,h),C.save(),C.translate(cn,qn),A.save(),A.translate(cn,qn);let Ut=C.createLinearGradient(0,0,0,h);if(Ut.addColorStop(0,pt.skyTop),Ut.addColorStop(1,pt.skyBottom),C.fillStyle=Ut,C.fillRect(-50,-50,p+100,h+100),Ge<1){let Ae=h*.15+Ge*50;C.beginPath(),C.arc(p*.7,Ae,40,0,Math.PI*2),C.fillStyle=pt.sun,C.globalAlpha=1-Ge,C.shadowColor=pt.sun,C.shadowBlur=20,C.fill(),C.globalAlpha=1,C.shadowBlur=0}let wn=h*.65;if(y&&Ge<1){C.save();let Ae=Math.min(p,h)*5e-4,I=300*Ae,k=300*Ae,O=p*.8,N=k*.15,B=wn-k/2+N;C.translate(O,B),C.rotate(.1),C.drawImage(m,-I/2,-k/2,I,k),C.restore()}if(he(C,p,h,wn,pt),g.forEach(Ae=>{Ae.type==="tree"?fe(C,Ae.x,Ae.y,Ae.scale,pt):Ae.type==="rock"?ee(C,Ae.x,Ae.y,Ae.scale,pt):Ae.type==="shell"&&re(C,Ae.x,Ae.y,Ae.scale,pt)}),Ge>.3){let Ae=(Ge-.3)/.7,I=Math.floor(J*Ae);if(A.strokeStyle=`rgba(120, 180, 255, ${.1+Ae*.3})`,A.lineWidth=1+Ae,A.beginPath(),H.length<I)for(let O=0;O<10;O++)H.push({x:Math.random()*p*1.5,y:w,speed:20+Math.random()*20,len:10+Math.random()*20});let k=10+Ae*20;for(let O=0;O<H.length;O++){let N=H[O];N.y+=N.speed,N.x-=k,A.moveTo(N.x,N.y),A.lineTo(N.x-k*.5,N.y+N.len),(N.y>h||N.x<-100)&&(O<I?(N.x=Math.random()*p*1.5,N.y=w):(H.splice(O,1),O--))}A.stroke()}let Yr=.3;if(Ge>Yr){let Ae=(Ge-Yr)/(1-Yr),I=se(0,h*1.5,Ae*Ae);A.fillStyle=pt.waterDeep,A.beginPath(),A.moveTo(-50,h+100),A.lineTo(-50,h-I*.3),A.bezierCurveTo(p*.3,h-I*.4,p*.6,h-I*1.2,p+50,h-I*.8),A.lineTo(p+50,h+100),A.fill()}let Do=se(0,h*.5,Ge),$o=se(0,h*1.5,Xt*Xt),pr=h*.85-Do-$o;if(W.forEach((Ae,I)=>{let k;I===$-1?k=pt.waterPeak:I%2===0?k=pt.waterDeep:k=pt.waterMid,A.fillStyle=k,A.beginPath();let O=Ae.amplitudeBase*(1+Ge*2+Xt*5),N=.003+Ge*.005,B=Ae.speedBase*(1+Ge*5+Xt*10),de=z*B+Ae.offset,pe=I*15*(1-Xt),we=pr+pe;A.moveTo(-50,h+100),A.lineTo(-50,we);for(let _e=-50;_e<=p+50;_e+=15){let Ke=we+Math.sin(_e*N+de)*O+Math.cos(_e*N*2.3+de)*(O*.5);A.lineTo(_e,Ke)}if(A.lineTo(p+50,h+100),A.fill(),I===$-1||Ge>.6&&I>$-3){A.save(),A.globalAlpha=.1+Ge*.3,A.fillStyle=pt.foam,A.beginPath();for(let _e=-50;_e<=p+50;_e+=10){let Ke=we+Math.sin(_e*N+de)*O+Math.cos(_e*N*2.3+de)*(O*.5);Math.random()>.5&&(Ke-=5),_e===-50?A.moveTo(_e,Ke):A.lineTo(_e,Ke)}A.lineTo(p+50,h+100),A.lineTo(-50,h+100),A.fill(),A.restore()}}),z<oe){let Ae=1;z>1e3&&(Ae=1-(z-1e3)/(oe-1e3)),A.fillStyle=`rgba(0, 0, 0, ${Ae})`,A.fillRect(-50,-50,p+100,h+100)}if(z>We){let Ae=Math.min(1,(z-We)/nt);A.fillStyle=`rgba(0, 0, 0, ${Ae})`,A.fillRect(-50,-50,p+100,h+100)}if(Y){let Ae=E-ie,I=12e3,k=0,O=!0;Ae<I?k=Ae/I:(k=1,Te||(Te=!0,Be(A,p,h,25),F=60,l||(l=!0,ft("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),me&&(O=!1),ne(A,p,h,k,O)}if(me){let Ae=E-ve,I=Math.min(1,Ae/Oe);A.fillStyle=`rgba(0, 0, 0, ${I})`,A.fillRect(-50,-50,p+100,h+100)}if(F>0){let Ae=F/60,I=Ae*Ae;A.fillStyle=`rgba(255, 255, 255, ${I})`,A.fillRect(-50,-50,p+100,h+100),F--}C.restore(),A.restore(),M=requestAnimationFrame(ye)}function Ue(){G=!1,e.style.cursor="",M&&cancelAnimationFrame(M),window.removeEventListener("resize",q),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function ke(){Y=!0,ie=Date.now(),Te=!1,F=0,s||(s=ft("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Fe(){me=!0,ve=Date.now(),s&&s.stop()}function ae(){e.style.cursor=""}function te(){e.style.cursor="none"}function xe(){s&&(s.stop(),s=null)}return ye(),{cleanup:Ue,triggerBeacons:ke,triggerFinalFade:Fe,showCursor:ae,hideCursor:te,stopHumLoop:xe}}var Pv=De(()=>{En()});var h0={};vt(h0,{canPerformForgeReset:()=>u0,canPerformInfuseReset:()=>f0,computeForgeGoldFromInputs:()=>Uc,computeInfuseMagicFromInputs:()=>Dc,computePendingDnaFromInputs:()=>Jv,computePendingForgeGold:()=>c0,computeSurgeWavesFromInputs:()=>Zv,getCurrentSurgeLevel:()=>Zn,getForgeDebugOverrideState:()=>t0,getInfuseDebugOverrideState:()=>o0,getSurgeBarLevelKey:()=>Gs,getSurgeDebugOverrideState:()=>s0,hasDoneExperimentReset:()=>l0,hasDoneForgeReset:()=>Or,hasDoneInfuseReset:()=>qt,hasDoneSurgeReset:()=>ko,initResetPanel:()=>fp,initResetSystem:()=>Yo,isExperimentUnlocked:()=>Tl,isForgeUnlocked:()=>Rs,isInfuseUnlocked:()=>Ou,isSurgeUnlocked:()=>Fr,onForgeUpgradeUnlocked:()=>um,onInfuseUpgradeUnlocked:()=>fm,onSurgeUpgradeUnlocked:()=>dm,performForgeReset:()=>rm,performInfuseReset:()=>im,performSurgeReset:()=>sm,recomputePendingMagic:()=>hn,setExperimentResetCompleted:()=>jp,setForgeDebugOverride:()=>n0,setForgeResetCompleted:()=>Wp,setInfuseDebugOverride:()=>i0,setInfuseResetCompleted:()=>zp,setInfuseUnlockedForDebug:()=>r0,setSurgeResetCompleted:()=>Kp,setSurgeUnlockedForDebug:()=>a0,shouldBlockBigCoins:()=>Ml,updateResetPanel:()=>qe});function Dp(e){return!ox.includes(e)}function rx(){ft(QE,{volume:.4})}function ix(){ft(ex,{volume:.45})}function sx(){ft(tx,{volume:.5})}function ax(){ft(nx,{volume:.8})}function Ml(){return Wv}function zv(){let e=Pn(),t=R.waves?.value??at(),n=0n;try{n=kl(e)}catch{}let o=S.pendingWaves,r=cm(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),Wv=i&&!pn()}function Ll(){Pp=null}function Tu(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function ku(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function Bp(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Vp(e=null){try{let t=tl(),n=S.pendingGold.clone?.()??S.pendingGold;if(e){let o=e instanceof Tt?e:Tt.fromAny(e??1);if(o.isInfinite?.())return Tt.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=R.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return S.pendingGold}}function ux(){for(;eo.length;){let e=eo.pop();try{e?.()}catch{}}}function Op(){!Dv&&typeof ic=="function"&&(Dv=ic((e={})=>{e?.key&&e.key!==Re.COINS&&e.key!==Re.WAVES||e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(e?.key===Re.WAVES?(Pu(),qe()):(gn(),hn(),On()))})),!$v&&typeof gc=="function"&&($v=gc((e={})=>{e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(gn(),On(),Oo(),qe())}))}function Yp(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ee(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Cl(){try{let e=rt();if(e&&e.xpLevel)return e.xpLevel}catch{}return at()}function Kv(e,t){if(!e||typeof e!="object")return at();let n=Ee(e);if(!Number.isFinite(n)&&n>0)return Tt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return at();let r=ue(o*Math.log10(2)),i=Math.max(0,Yp(t)),s=Math.max(0,(i-30)/5),l=s<=0?Bv():ue(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?Bv():ue(a*Math.log10(1.15)),f=Tt.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?at():d}function fx(e,t){if(!e)return at();let n=Ee(e);if(!Number.isFinite(n)&&n>0)return Tt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let y=Ee(t);Number.isFinite(y)&&(a=Math.max(0,y-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,m=r+u+f+d;return Number.isFinite(m)?ue(m).floorToInteger():Tt.fromAny("Infinity")}function jv(e,t,n=null){let o=fx(e,t),r=Fd(),i;if(n){let s=n instanceof Tt?n:Tt.fromAny(n??1);if(s.isInfinite?.())return Tt.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=R.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function Uc(e,t){return Kv(e,t)}function Dc(e,t){return jv(e,t)}function Zv(e,t,n,o,r){return Qv(e,t,n,o,r)}function Jv(e,t,n=null){e||(e=at()),t||(t=at());let o=.30103,r=0;if(n!==null?!!n:Me(9)){let l=Mt();o=Math.log10(2+l*.5),r=30*l}if(Me(14))if(Me(8)){let l=Mt(),a=Math.log10(1414e16);r+=a*l}else r+=Math.log10(1414e16);let s=o.toFixed(18);try{let l=e.mulDecimal(s,18),u=t.div(c.fromInt(20)).mulDecimal(s,18),f=l.add(u);r>0&&(f=f.add(c.fromAny(r)));let d=0;return f.isInfinite()?d=1/0:d=Number(f.toScientific(10)),ue(d).floorToInteger()}catch{return at()}}function Qv(e,t,n,o,r){let i=Yp(e);if(i<201)return at();let s=(i-201)/35,l=Ee(t),a=Ee(n),u=Ee(o),f=Ee(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return Tt.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*wu),Number.isFinite(a)&&a>13&&(d+=(a-13)*wu),Number.isFinite(u)&&u>5&&(d+=(u-5)*wu),Number.isFinite(f)&&f>12&&(d+=(f-12)*wu);let m=1+d+s;if(!Number.isFinite(m))return Tt.fromAny("Infinity");let y=ue(m).floorToInteger();return R.waves?.mult?.applyTo?.(y)??y}function e0(){return Math.max(0,Yp(Cl()))}function Pn(){if(S.slot!=null)return S.slot;let e=b();return S.slot=e,e}function Wp(e){let t=Pn();if(t!=null){S.hasDoneForgeReset=!!e;try{localStorage.setItem($p(t),S.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function zp(e){let t=Pn();if(t!=null){S.hasDoneInfuseReset=!!e;try{localStorage.setItem(qp(t),S.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function Kp(e){let t=Pn();if(t!=null){S.hasDoneSurgeReset=!!e;try{localStorage.setItem(Gp(t),S.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function jp(e){let t=Pn();if(t!=null){S.hasDoneExperimentReset=!!e;try{localStorage.setItem(Xp(t),S.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function Ru(e=b()){if(e==null)return null;try{let t=localStorage.getItem(El(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function t0(e=b()){return Ru(e)}function n0(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.forgeDebugOverride!==n){if(S.forgeDebugOverride=n,n==null)try{localStorage.removeItem(El(t))}catch{}else try{localStorage.setItem(El(t),n?"1":"0")}catch{}ct(El(t)),Tu(),qe()}}function Zp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(xl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function o0(e=b()){return Zp(e)}function r0(e){Jp(e)}function i0(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.infuseDebugOverride!==n){if(S.infuseDebugOverride=n,n==null)try{localStorage.removeItem(xl(t))}catch{}else try{localStorage.setItem(xl(t),n?"1":"0")}catch{}ct(xl(t)),ku(),qe()}}function Jp(e){let t=Pn();if(t==null)return;let n=!!e;if(S.infuseUnlocked!==n){S.infuseUnlocked=n;try{localStorage.setItem(Mu(t),S.infuseUnlocked?"1":"0")}catch{}ct(Mu(t)),ku()}}function Au(e){let t=Pn();if(t==null)return;let n=!!e;if(S.forgeUnlocked!==n){S.forgeUnlocked=n;try{localStorage.setItem(_u(t),S.forgeUnlocked?"1":"0")}catch{}ct(_u(t)),Tu()}}function Qp(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Yv(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function s0(e=b()){return Qp(e)}function a0(e){em(e)}function em(e){let t=Pn();if(t==null)return;let n=!!e;if(S.surgeUnlocked!==n){S.surgeUnlocked=n;try{localStorage.setItem(Cu(t),S.surgeUnlocked?"1":"0")}catch{}ct(Cu(t)),Bp()}}function Fp(e){if(e==null){S.forgeUnlocked=!1,S.forgeDebugOverride=null,S.hasDoneForgeReset=!1,S.infuseUnlocked=!1,S.infuseDebugOverride=null,S.hasDoneInfuseReset=!1,S.surgeUnlocked=!1,S.surgeDebugOverride=null,S.hasDoneSurgeReset=!1,S.hasDoneExperimentReset=!1,S.flagsPrimed=!1;return}try{S.forgeUnlocked=localStorage.getItem(_u(e))==="1"}catch{S.forgeUnlocked=!1}S.forgeDebugOverride=Ru(e);try{S.hasDoneForgeReset=localStorage.getItem($p(e))==="1"}catch{S.hasDoneForgeReset=!1}try{S.infuseUnlocked=localStorage.getItem(Mu(e))==="1"}catch{S.infuseUnlocked=!1}try{S.hasDoneInfuseReset=localStorage.getItem(qp(e))==="1"}catch{S.hasDoneInfuseReset=!1}S.infuseDebugOverride=Zp(e);try{S.surgeUnlocked=localStorage.getItem(Cu(e))==="1"}catch{S.surgeUnlocked=!1}S.surgeDebugOverride=Qp(e);try{S.hasDoneSurgeReset=localStorage.getItem(Gp(e))==="1"}catch{S.hasDoneSurgeReset=!1}try{S.hasDoneExperimentReset=localStorage.getItem(Xp(e))==="1"}catch{S.hasDoneExperimentReset=!1}S.flagsPrimed=!0}function vo(){let e=b();if(e==null){S.flagsPrimed=!1;return}S.slot!==e&&(S.slot=e,Ll(),S.flagsPrimed=!1),S.flagsPrimed||Fp(e)}function qv(e){Fv!==e&&(ux(),Fv=e,e!=null&&(eo.push(kt(_u(e),{onChange(t){let n=t==="1";S.forgeUnlocked!==n&&(S.forgeUnlocked=n,Tu(),qe())}})),eo.push(kt($p(e),{onChange(t){let n=t==="1";S.hasDoneForgeReset!==n&&(S.hasDoneForgeReset=n,qe())}})),eo.push(kt(El(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.forgeDebugOverride!==n&&(S.forgeDebugOverride=n,Tu(),qe())}})),eo.push(kt(Mu(e),{onChange(t){let n=t==="1";S.infuseUnlocked!==n&&(S.infuseUnlocked=n,ku(),qe())}})),eo.push(kt(qp(e),{onChange(t){let n=t==="1";S.hasDoneInfuseReset!==n&&(S.hasDoneInfuseReset=n,qe())}})),eo.push(kt(xl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.infuseDebugOverride!==n&&(S.infuseDebugOverride=n,ku(),qe())}})),eo.push(kt(Cu(e),{onChange(t){let n=t==="1";S.surgeUnlocked!==n&&(S.surgeUnlocked=n,Bp(),qe())}})),eo.push(kt(Yv(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.surgeDebugOverride!==n&&(S.surgeDebugOverride=n,Bp(),qe())}})),eo.push(kt(Gp(e),{onChange(t){let n=t==="1";S.hasDoneSurgeReset!==n&&(S.hasDoneSurgeReset=n,qe())}})),eo.push(kt(Xp(e),{onChange(t){let n=t==="1";S.hasDoneExperimentReset!==n&&(S.hasDoneExperimentReset=n,qe())}}))))}function dx(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function gn(e=!1){let t=R.coins?.value??at(),n=Cl(),o=dx(t,n);!e&&Pp===o||(Pp=o,tm()?S.pendingGold=Kv(t,n):S.pendingGold=at(),qe())}function hn(e=null){let t=R.coins?.value??at(),n=mi();nm()?S.pendingMagic=jv(t,n,e):S.pendingMagic=at(),On(),qe()}function On(){if(!Fr()){S.pendingWaves=at(),Oo();return}let e=Cl(),t=R.coins?.value??at(),n=R.gold?.value??at(),o=R.magic?.value??at(),r=mi();S.pendingWaves=Qv(e,t,n,o,r),ko()||S.pendingWaves.cmp(Tt.fromInt(10))>0&&(S.pendingWaves=Tt.fromInt(10)),Oo(),zv()}function Oo(){if(!Tl()){S.pendingDna=at();return}let e=.30103,t=0;if(Me(9)){let i=Mt();e=Math.log10(2+i*.5),t=30*i}if(Me(14))if(Me(8)){let i=Mt(),s=Math.log10(1414e4);t+=s*i}else t+=Math.log10(1414e4);let n=e.toFixed(18),o=jt?jt():at(),r=Cl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),S.pendingDna=ue(u).floorToInteger()}catch{try{S.pendingDna=at()}catch{S.pendingDna=at()}}}function Up(){let e=Ru();return e!=null?!!e:S.forgeUnlocked||At(Ie.STARTER_COVE,Le.UNLOCK_FORGE)>=1}function tm(){try{let e=Cl();if(e&&typeof e.cmp=="function")return e.cmp(lx)>=0}catch{}return!1}function nm(){try{let e=ht();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(cx)>=0}catch{}return!1}function Rs(){vo();let e=Ru();return e!=null?!!e:!!S.forgeUnlocked||Up()}function Ou(){vo();let e=Zp();return e!=null?!!e:!!S.infuseUnlocked}function Fr(){vo();let e=Qp();return e!=null?!!e:!!S.surgeUnlocked}function Tl(){return ty()}function Zn(){let e=Pn();return e==null?0n:kl(e)}function Or(){return vo(),!!S.hasDoneForgeReset}function qt(){return vo(),!!S.hasDoneInfuseReset}function ko(){return vo(),!!S.hasDoneSurgeReset}function l0(){return vo(),!!S.hasDoneExperimentReset}function c0(){return gn(),S.pendingGold.clone?.()??S.pendingGold}function u0(){return!(!Rs()||!tm()||S.pendingGold.isZero?.())}function f0(){return!(!Ou()||!nm()||S.pendingMagic.isZero?.())}function px({resetGold:e=!1,resetMagic:t=!1}={}){let n=Ct(Ie.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===Le.UNLOCK_XP||r===Le.UNLOCK_FORGE||r===Le.UNLOCK_INFUSE||r===Le.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||ir(Ie.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function om({resetGold:e=!1,resetMagic:t=!1}={}){try{R.coins.set(0)}catch{}try{R.books.set(0)}catch{}try{es({keepUnlock:!0})}catch{}try{Ap()}catch{}px({resetGold:e,resetMagic:t})}function rm(){if(!u0())return!1;let e=Vp();try{R.gold?.add&&R.gold.add(e)}catch{}if(om({resetGold:!1}),gn(),Au(!0),S.hasDoneForgeReset||Wp(!0),Qt(),Br(),Dp("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return qe(),!0}function im(){if(!f0())return!1;let e=S.pendingMagic.clone?.()??S.pendingMagic;try{R.magic?.add&&R.magic.add(e)}catch{}om({resetGold:!0});try{R.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Qt({forceReload:!0})}catch{}if(gn(),hn(),Dp("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return Jp(!0),S.hasDoneInfuseReset||zp(!0),qe(),!0}function Nu(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Pn();try{R.waves?.add&&e&&!e.isZero?.()&&R.waves.add(e)}catch{}om({resetGold:!0,resetMagic:!0});try{R.gold.set(0)}catch{}try{R.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Qt({forceReload:!0})}catch{}if(Pu(),em(!0),S.hasDoneSurgeReset||Kp(!0),gn(),hn(),On(),t&&(n||sx(),n||gx()),Dp("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}qe()}function d0(){if(!Tl()||(jt?jt():at()).cmp(10)<0)return!1;let t=S.pendingDna.clone?.()??S.pendingDna;try{R.DNA?.add&&R.DNA.add(t)}catch{}return Nu(at(),{playEffects:!1}),ax(),ny([4]),S.hasDoneExperimentReset||jp(!0),gn(),hn(),On(),Oo(),qe(),!0}function mx(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{cv(!0)}catch{}try{ou()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,Zo(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=Ov(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),jy(e,()=>{setTimeout(hx,0)},i)},r);Lu=i.cleanup}function hx(){Lu&&(Lu(),Lu=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Nu(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function sm(){if(!Fr()||e0()<201)return!1;let e=S.pendingWaves.clone?.()??S.pendingWaves;if(e.isZero?.())return!1;let t=Pn(),n=R.waves?.value??at(),o=kl(t),r=cm(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!pn()?(mx(),Nu(e,{playEffects:!1}),!0):(Nu(e,{playEffects:!0}),!0)}function gx(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function kl(e){let t=0n;try{let n=localStorage.getItem(Hp(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function yx(e){let t=Hp(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function Gv(e){if(!(e instanceof Tt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function p0(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=Gv(n),l=Gv(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function Pu(){let e=Pn();if(e==null||!Fr()||Rp||yx(e))return;let t=R.waves?.value??at(),n=kl(e);if(n===1/0)return;let o=p0(n,t);if(o.changed){n=o.level;try{localStorage.setItem(Hp(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}Rp=!0;try{R.waves.set(o.remainingWaves)}finally{Rp=!1}qe(),o.safety>=100&&setTimeout(Pu,0)}zv()}function wl(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Tt.fromInt(e)}catch{}try{return j(t)}catch{return e?.toString?.()??"0"}}function vx(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),m=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${m.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let m="";for(let y=0;y<=r;y++){let p=y/r,h=a+p*(u-a),g=h/(Math.PI*2)*120,v=50+30*Math.sin(h+d);m+=(y===0?"M":"L")+` ${g.toFixed(1)} ${v.toFixed(1)}`}return`<path d="${m}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function bx(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${KE}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${jE}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${ZE}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${JE}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Hv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Xv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${xu}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${Je?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Vv}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,S.panel=e,S.elements.forge.card=e.querySelector("#reset-card-forge"),S.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),S.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),S.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),S.elements.infuse.card=e.querySelector("#reset-card-infuse"),S.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),S.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),S.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),S.elements.surge.card=e.querySelector("#reset-card-surge"),S.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),S.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),S.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),S.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),S.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),S.elements.surge.headerVal=e.querySelector("[data-surge-level]"),S.elements.surge.header=e.querySelector(".surge-header"),S.elements.experiment.card=e.querySelector("#reset-card-experiment"),S.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),S.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");if(S.elements.surge.milestones&&t&&_s(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),typeof IntersectionObserver<"u"){let o=new IntersectionObserver(r=>{r.forEach(i=>{let s=i.target,l=i.isIntersecting;s===S.elements.forge.card?(S.visible.forge=l,l&&am()):s===S.elements.infuse.card?(S.visible.infuse=l,l&&lm()):s===S.elements.surge.card?(S.visible.surge=l,l&&_l()):s===S.elements.experiment.card?(S.visible.experiment=l,l&&m0()):s===S.elements.surge.milestones&&(S.visible.surgeMilestones=l,l&&_l())})},{threshold:0});S.elements.forge.card&&o.observe(S.elements.forge.card),S.elements.infuse.card&&o.observe(S.elements.infuse.card),S.elements.surge.card&&o.observe(S.elements.surge.card),S.elements.experiment.card&&o.observe(S.elements.experiment.card),S.elements.surge.milestones&&o.observe(S.elements.surge.milestones)}else S.visible.forge=!0,S.visible.infuse=!0,S.visible.surge=!0,S.visible.experiment=!0,S.visible.surgeMilestones=!0;S.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(S.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&lo(r))return;let a=S.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),S.elements.forge.btn&&S.elements.forge.btn.addEventListener("click",()=>{rm()&&(rx(),qe())}),S.elements.infuse.btn&&S.elements.infuse.btn.addEventListener("click",()=>{im()&&(ix(),qe())}),S.elements.surge.btn&&S.elements.surge.btn.addEventListener("click",()=>{sm()&&qe()}),S.elements.experiment.btn&&S.elements.experiment.btn.addEventListener("click",()=>{d0()&&qe()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=vx();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{xs("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}qe()}function fp(e){!e||e.__resetInit||(e.__resetInit=!0,bx(e))}function Po(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=wl(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function am({goldMult:e=null}={}){let t=S.elements.forge;if(!(!t.card||!t.btn)){if(!Rs()){if(!S.visible.forge)return;Po(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(S.visible.forge){if(vo(),t.card.classList.toggle("is-forge-complete",!!S.hasDoneForgeReset),t.status)if(S.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!tm()){Po(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Po(t.btn,{disabled:!1},Hv,Vp(e))}}}function lm(){let e=S.elements.infuse;if(!(!e.card||!e.btn)){if(!Ou()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="none"&&(S.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="flex"&&(S.layerButtons.infuse.style.display="flex"),!!S.visible.infuse){if(vo(),e.card.classList.toggle("is-complete",!!S.hasDoneInfuseReset),e.status)if(S.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!nm()){Po(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Po(e.btn,{disabled:!1},Xv,S.pendingMagic)}}}function cm(e,t,n){let o=t.add(n);return p0(e,o).level}function _l(){let e=S.elements.surge;if(!e.card||!e.btn)return;if(!Fr()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="none"&&(S.layerButtons.surge.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="flex"&&(S.layerButtons.surge.style.display="flex"),!S.visible.surge)return;vo();let t=Pn(),n=R.waves?.value??at(),o=0n;try{o=kl(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':wl(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=S.pendingWaves;if(u&&!u.isZero?.()){let f=cm(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let m=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':wl(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${m}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${xu}">${wl(n)} / <img src="${xu}">${wl(r)}</span>`),e.milestones&&S.visible.surgeMilestones){let s=Nv(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",m=a.description.map(C=>C.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${C}</div>`:`<div>- ${C}</div>`).join("");if(f&&a.surgeLevel===3){let C=Mr?Mr():Tt.fromInt(0);m+=`<div style="color:#02e815">- Current Books/sec: ${j(C.floorToInteger())}</div>`}if(f&&a.surgeLevel===6){let C=Fc();m=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Pe(C.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Pe(C.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Pe(C.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Pe(C.magic)}x</span></div>`}if(f&&a.surgeLevel===13){let q=2*(Mt()*1.5-.5)-2,P=ue(q),M=Vp().mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Gold/sec: ${j(M.floorToInteger())}</div>`}if(f&&a.surgeLevel===16){let q=2*(Mt()*1.5-.5)-2,P=ue(q),G=S.pendingMagic.mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Magic/sec: ${j(G.floorToInteger())}</div>`}let y=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(y=!0);let p=Mt(),h=!1;f&&y&&p<1&&Np.includes(a.id)&&(h=!0);let g=h?" is-nerfed":"",v=l[u];if(!v)v=document.createElement("div"),v.className=`surge-milestone-item ${d}${g}`,v.dataset.isReached=String(f),v.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(v);else{v.className!==`surge-milestone-item ${d}${g}`&&(v.className=`surge-milestone-item ${d}${g}`);let C=String(f);v.dataset.isReached!==C&&(v.dataset.isReached=C)}let w=v.querySelector(".surge-milestone-desc");w&&w.innerHTML!==m&&(w.innerHTML=m);let L=v.querySelector(".surge-milestone-nerf-arrow");if(L){let C=!1;y&&p<1&&Np.includes(a.id)&&(C=!0);let A=C?"":"none";L.style.display!==A&&(L.style.display=A)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();requestAnimationFrame(()=>{e.milestones&&e.milestones.__customScroll&&typeof e.milestones.__customScroll.update=="function"&&e.milestones.__customScroll.update()}),S.lastRenderedSurgeLevel!==o&&(S.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!S.hasDoneSurgeReset),e.status)if(S.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(e0()<201){Po(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(S.pendingWaves.isZero?.()){Po(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Po(e.btn,{disabled:!1},xu,S.pendingWaves)}function m0(){let e=S.elements.experiment;if(!e.card||!e.btn)return;if(!Tl()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="none"&&(S.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="flex"&&(S.layerButtons.experiment.style.display="flex"),!S.visible.experiment)return;if(vo(),e.card.classList.toggle("is-complete",!!S.hasDoneExperimentReset),e.status)if(S.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((jt?jt():at()).cmp(10)<0){Po(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}Po(e.btn,{disabled:!1},Vv,S.pendingDna)}function qe({goldMult:e=null}={}){S.panel&&(am({goldMult:e}),lm(),_l(),m0())}function um(){Yo(),Au(!0),qe()}function fm(){Yo(),Jp(!0),qe()}function dm(){Yo(),em(!0),qe()}function Sx(){if(!S.panel)return;let e=S.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!S.panel.classList.contains("is-active")||!S.elements.surge.barFill)return;let t=S.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",_l(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",_l()},{once:!0}))}function Ix(){typeof window>"u"||(window.addEventListener("menu:scrollStop",()=>{qe()}),window.addEventListener("surge:level:change",()=>{Sx()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(gn(),hn(),On()),e.detail?.key==="waves"&&(Pu(),qe()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(On(),qe())}),window.addEventListener("surge:bookResidue",()=>{if(S.panel&&S.panel.offsetParent!==null){let e=S.elements.surge.card;e&&e.style.display!=="none"&&qe()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Re.GOLD){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;gn(!0);let n=t.mult instanceof c?t.mult:Tt.fromAny(t.mult??1);S.panel&&am({goldMult:n});return}if(t.key===Re.MAGIC){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;let n=t.mult instanceof c?t.mult:Tt.fromAny(t.mult??1);hn(n),S.panel&&lm();return}}}),window.addEventListener("xp:change",()=>{gn(),On(),Oo(),qe()}),window.addEventListener("mutation:change",()=>{hn(),On(),qe()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&S.slot!=null&&e.detail.slot!==S.slot||(Ll(),gn(!0),hn(),On(),Oo(),qe())}),window.addEventListener("lab:level:change",()=>{Oo(),qe()}),window.addEventListener("lab:node:change",()=>{hn(),qe()}))}function Yo(){if(Uv){S.slot=b(),Ll(),Op(),gn(!0),hn(),On(),Oo();return}try{Qt()}catch{return}Uv=!0;let e=b();if(S.slot=e,Ll(),Fp(e),S.hasDoneForgeReset&&!Ro())try{Br()}catch{}if(!S.forgeUnlocked&&Up()&&Au(!0),qv(e),Op(),Ix(),gn(!0),hn(),On(),Oo(),Eu){try{Eu()}catch{}Eu=null}Eu=_i(()=>{let t=pm();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(S.slot=t,Ll(),Fp(t),S.hasDoneForgeReset&&!Ro())try{Br()}catch{}!S.forgeUnlocked&&Up()&&Au(!0),qv(t),Op(),gn(!0),hn(),On(),Oo(),qe()})}var Tt,wu,at,Bv,Hv,Xv,Vv,KE,jE,ZE,JE,xu,QE,ex,tx,nx,ox,_u,$p,El,Mu,qp,xl,Cu,Yv,Gp,Gs,Hp,Xp,lx,cx,Rp,Wv,S,eo,Fv,Uv,Eu,Pp,Dv,$v,Lu,Co=De(()=>{Et();po();It();zt();zn();fo();To();rs();Za();Rv();ci();En();Cn();xr();li();Ns();Pv();Tt=c,wu=Math.log10(1.1),at=()=>Tt.fromInt(0),Bv=()=>Tt.fromInt(1),Hv="img/currencies/gold/gold.webp",Xv="img/currencies/magic/magic.webp",Vv="img/currencies/dna/dna.webp",KE="img/misc/forge.webp",jE="img/misc/infuse.webp",ZE="img/misc/surge.webp",JE="img/misc/experiment.webp",xu="img/currencies/wave/wave.webp",QE="sounds/forge_reset.ogg",ex="sounds/infuse_reset.ogg",tx="sounds/surge_reset.ogg",nx="sounds/experiment_reset.ogg",ox=[];_u=e=>`ccc:reset:forge:${e}`,$p=e=>`ccc:reset:forge:completed:${e}`,El=e=>`ccc:debug:forgeUnlocked:${e}`,Mu=e=>`ccc:reset:infuse:${e}`,qp=e=>`ccc:reset:infuse:completed:${e}`,xl=e=>`ccc:debug:infuseUnlocked:${e}`,Cu=e=>`ccc:reset:surge:${e}`,Yv=e=>`ccc:debug:surgeUnlocked:${e}`,Gp=e=>`ccc:reset:surge:completed:${e}`,Gs=e=>`ccc:reset:surge:barLevel:${e}`,Hp=Gs,Xp=e=>`ccc:reset:experiment:completed:${e}`,lx=Tt.fromInt(31),cx=Tt.fromInt(7),Rp=!1,Wv=!1;S={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:at(),pendingMagic:at(),pendingWaves:at(),pendingDna:at(),panel:null,visible:{forge:!1,infuse:!1,surge:!1,experiment:!1,surgeMilestones:!1},elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},eo=[],Fv=null,Uv=!1,Eu=null,Pp=null,Dv=null,$v=null;Lu=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Yo,performForgeReset:rm,performInfuseReset:im,performSurgeReset:sm,performExperimentReset:d0,computePendingForgeGold:c0,computeForgeGoldFromInputs:Uc,computeInfuseMagicFromInputs:Dc,computeSurgeWavesFromInputs:Zv,computePendingDnaFromInputs:Jv,getForgeDebugOverrideState:t0,hasDoneForgeReset:Or,isForgeUnlocked:Rs,setForgeDebugOverride:n0,setForgeResetCompleted:Wp,updateResetPanel:qe,isInfuseUnlocked:Ou,setInfuseDebugOverride:i0,getInfuseDebugOverrideState:o0,recomputePendingMagic:hn,setInfuseUnlockedForDebug:r0,setInfuseResetCompleted:zp,hasDoneInfuseReset:qt,isSurgeUnlocked:Fr,setSurgeUnlockedForDebug:a0,getSurgeDebugOverrideState:s0,setSurgeResetCompleted:Kp,hasDoneSurgeReset:ko,getCurrentSurgeLevel:Zn,shouldBlockBigCoins:Ml,hasDoneExperimentReset:l0,setExperimentResetCompleted:jp,isExperimentUnlocked:Tl}))});var $0={};vt($0,{AREA_KEYS:()=>Ie,HM_EVOLUTION_INTERVAL:()=>Ht,MAX_LEVEL_DELTA:()=>Zs,REGISTRY:()=>Ju,UPGRADE_TIES:()=>Le,approxLog10BigNum:()=>Ee,batchUpgradeOperations:()=>Nl,bigNumFromLog10:()=>ue,buyCheap:()=>gl,buyMax:()=>hl,buyOne:()=>Os,buyTowards:()=>Ps,clearPermanentUpgradeUnlock:()=>Nm,computeDefaultUpgradeCost:()=>Rm,computeHmMultipliers:()=>Wo,computeUpgradeEffects:()=>ps,costToBuyOne:()=>Vx,ensureLevelBigNum:()=>mt,estimateFlatBulk:()=>Lm,estimateGeometricBulk:()=>$x,evaluateBulkPurchase:()=>Ii,evolveUpgrade:()=>fu,formatMultForUi:()=>Pe,getCurrentAreaKey:()=>Jn,getHmEvolutions:()=>Cm,getHmNextMilestoneLevel:()=>Yx,getIconUrl:()=>pu,getLevel:()=>Tn,getLevelNumber:()=>At,getMagnetLevel:()=>Ac,getMpValueMultiplierBn:()=>kc,getUpgrade:()=>ta,getUpgradeLockState:()=>Ao,getUpgradeStorageKey:()=>Ci,getUpgradesForArea:()=>Ct,levelBigNumToNumber:()=>Ve,log10OnePlusPow10:()=>Nf,markUpgradePermanentlyUnlocked:()=>Mi,normalizeBigNum:()=>Wx,normalizeUpgradeIconPath:()=>du,normalizedUpgradeLevel:()=>Hu,onUpgradesChanged:()=>Md,peekNextPrice:()=>D0,performFreeAutobuy:()=>Pd,safeMultiplyBigNum:()=>gt,setLevel:()=>ir,syncBookCurrencyMultiplierFromUpgrade:()=>Ka,upgradeUiModel:()=>Bs});function Bu(){Ur.size!==0&&(Ur.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{ct(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Ur.clear())}function Ex(){if(!(typeof window>"u")&&!y0){y0=setInterval(Bu,2e3);try{window.addEventListener("beforeunload",Bu)}catch{}try{window.addEventListener("pagehide",Bu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&Bu()})}catch{}}}function Nl(e){if(Vs)return e();Vs=!0;try{return e()}finally{Vs=!1,Al.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{Ws(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),Al.clear(),g0.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{Xx(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),g0.clear(),bm&&(bm=!1,oo())}}function xx(e){try{let t=ea(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function S0(e,t){if(!xx(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=Ee(n);return Number.isFinite(o)&&o>=Lx}catch{return!1}}function Ys(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>mm)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>mm/2||i.length>mm/2)return"Infinity"}return n}function Uu(e){return Ax[e]??0}function hm(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Js(e,t){let n=lr(e||t?.area);if(!n)return null;let o=cr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=no(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function Rl(e,t){let n=lr(e||t?.area);if(!n)return null;let o=no(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function Hs(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function wm(e=b()){let t=String(e??"default");if($u.has(t))return $u.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${E0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),$u.set(t,n),n}function Em(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),$u.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${E0}:${n}`,JSON.stringify(e))}catch{}}function Ku(e=b()){let t=String(e??"default");if(qu.has(t))return qu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${x0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),qu.set(t,n),n}function ju(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),qu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${x0}:${n}`,JSON.stringify(e))}catch{}}function km(e=b()){let t=String(e??"default");if(Gu.has(t))return Gu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${L0}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),Gu.set(t,n),n}function Am(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),Gu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${L0}:${n}`,JSON.stringify(e))}catch{}}function xm(e,t,n=b()){let o=Js(e,t);if(!o)return;let r=Rl(e,t),i=km(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],Am(i,n))}function _0(e,t,n=b()){let o=Js(e,t);if(!o)return!1;let r=Rl(e,t),i=km(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],Am(i,n),!0):!1}function Mi(e,t,n=b()){let o=Js(e,t);if(!o)return;let r=Rl(e,t),i=Ku(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],ju(i,n))}function Nm(e,t,n=b()){let o=Js(e,t);if(!o)return;let r=Ku(n);r.upgrades[o]&&(delete r.upgrades[o],ju(r,n));let i=wm(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},Em(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&ur(e,s,n),oo()}function Yu(e,t,n=b()){let o=Js(e,t);if(!o)return!1;let r=Rl(e,t),i=Ku(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],ju(i,n),!0):!1}function yn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=cr(t?.tie??t?.tieKey),o=e?.areaKey||Ie.STARTER_COVE;if(!n||!Mx.has(n))return{locked:!0,iconOverride:Bn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?At(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:M0()}catch{}function s(){if(C0())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:bn,titleOverride:sn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===Le.UNLOCK_XP)return s();if(n===Le.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Bn,useLockedBase:!0};let a=!1;try{let u=Sn();a=Ve(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:bn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}return{locked:!1}}if(n===Le.UNLOCK_INFUSE){if(!Or())return{locked:!0,iconOverride:Bn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:to,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=Sn();a=Ve(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:bn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}return{locked:!1}}if(n===Le.UNLOCK_SURGE){if(!qt())return{locked:!0,iconOverride:Bn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:to,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=Sn();a=Ve(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:bn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}return{locked:!1}}if(Tm.has(n)){if(qt()||Yu(o,t)){try{Mi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=Sn();a=Ve(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:Bn,useLockedBase:!0,titleOverride:to,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{xm(o,t)}catch{}return{locked:!0,iconOverride:bn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:u,reason:u}}if(Or()||Yu(o,t)){try{Mi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Bn,useLockedBase:!0};if(_0(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:bn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:sn,descOverride:a,reason:a}}let l=!1;try{let a=Sn();l=Ve(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Bn,useLockedBase:!0,titleOverride:to,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{xm(o,t)}catch{}return{locked:!0,iconOverride:bn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function lr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function cr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function Nx(e,t){let n=cr(t?.tie??t?.tieKey);if(n&&Cx.has(n))return!0;let o=no(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=lr(l);if(a&&Tx.has(`${a}:${i}`))return!0}return!1}function M0(){try{return!!dn()}catch{return!1}}function C0(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${kx}:${t}`)==="1"}catch{return!1}}function Sn(){try{let e=typeof rt=="function"?rt():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function Hu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function gm(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function no(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function mt(e){try{if(e=Ys(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return ue(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=Ee(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Ve(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=Ee(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=Ee(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function Rx(e,t){let n=mt(e),o=mt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(Ee(n))+1,i=Math.floor(Ee(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function T0(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function Qs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Wu(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:Qs(e.numUpgEvolutions)}function Rm(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Ve(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/Ht));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=R0(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:Ee(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:T0(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,vn(i,r)}function k0(e){let t=Qs(e),n=Ht*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Dr(o),capFmtText:Ks(o)}}function A0(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(Ee(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Ht)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Ht);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Ht)+1)}}function Px(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Om(e,t=Vu){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=lr(t||e?.area||Vu);return _x[n]||I0}function gt(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function Zu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=k0(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Wo(e,t,n=Vu){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Om(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=A0(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=Px(u.multiplier??u.mult??u.value??1,f),m=`${u.target??u.type??"self"}`.toLowerCase();m==="xp"?i=gt(i,d):m==="coin"||m==="coins"?s=gt(s,d):m==="mp"?l=gt(l,d):r=gt(r,d)}let a=Wu(e);if(a>0){let u=wx*a,f=ue(u);r=gt(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function N0(e,t,n=Vu){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Om(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=A0(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt(Ht)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny(Ht*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Ht*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Ht))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function R0(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=Ox[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function ea(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=R0(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=T0(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=Ee(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),m=c.fromAny(e.costAtLevel?.(1)??0),y=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(m)===0&&d.cmp(y)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function vn(e,t){let n=ea(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=ue(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return ue(n.baseLog10+o*n.ratioLog10).floorToInteger()}function Bx(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function sr(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=ea(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Du+t*o.ratioLn)/Du;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Du+t*o.ratioLn,i=o.ratioLn*n,s=Bx(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Du}function Xu(e,t,n){if(!(n>0))return c.fromInt(0);let o=ea(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=sr(e,t,l);a=a.add(ue(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=sr(e,t,n);return ue(i)}function P0(e){if(!(e>0)||!Number.isFinite(e))return e;if(vm[0]=e,vm[0]<=0)return 0;Fx[0]-=1n;let t=vm[0];return t>0?t:0}function Ux(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=P0(e);return n<e?n:e>1?e/2:0}function Xs(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function zs(e,t,n,o=Zs,r={}){let i=ea(e),s=c.fromInt(0),l=r||{},a=!!l.fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Ve(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:Ve(o),m=Number.isFinite(f)?Math.max(0,f-u):ym,y=Number.isFinite(d)?Math.max(0,Math.floor(d)):ym;if(y=Math.min(y,ym,m),!(y>0)){let W=m<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:W,numericCount:0}}let p=100-u;if(Number.isFinite(u)&&p>0){let W=Math.min(y,p);if(l.fastOnly&&i&&Number.isFinite(i.ratioLog10)&&Number.isFinite(i.baseLog10)){let he=Ee(n),Be=u+W,ne=i.baseLog10+Be*i.ratioLog10;if(he>ne+5){let ye=Xs(W),Ue=u+W,ke=zs(e,Ue,n,y-W,r),Fe=ke?.count instanceof c?ke.count:Xs(ke?.numericCount??0);return{count:ye.add(Fe),spent:s,nextPrice:ke?.nextPrice??s,numericCount:W+(ke?.numericCount??0)}}}let $=c.fromAny(e.costAtLevel(u)),H=s,J=0;for(;J<W;){$=c.fromAny(e.costAtLevel(u+J));let he=H.add($);if(he.cmp(n)>0)break;H=he,J+=1}let se=u+J,ce=Number.isFinite(f)&&se>=f,x=Xs(J);if(J<W||ce||y<=J){let he=ce?s:c.fromAny(e.costAtLevel(se));return{count:x,spent:H,nextPrice:he,numericCount:J}}let X=(()=>{try{return ar(t??u,u).add(x)}catch{return u+J}})(),K=zs(e,X,n.sub(H),y-J,r),fe=K?.count instanceof c?K.count:Xs(K?.numericCount??0),ee=x.add(fe),re=(K?.spent??s).add(H);return{count:ee,spent:re,nextPrice:K?.nextPrice??s,numericCount:J+(K?.numericCount??0)}}let h=Ee(n),g=i.ratioLog10,v=i.ratioMinus1,w=c.fromAny(e.costAtLevel(u)),L=i.baseLog10+u*g;if(v>0&&(!Number.isFinite(h)||Math.abs(h)>1e6&&Math.abs(L)>1e6)){let W=c.fromAny(e.costAtLevel(u));if(n.cmp(W)<0)return{count:s,spent:s,nextPrice:W,numericCount:0};let $=Number.isFinite(y)?Math.max(1,Math.floor(y)):Number.MAX_VALUE,H=1,J=1;for(;J<$;){let fe=sr(e,u,J);if(ue(fe).cmp(n)<=0){let re=J*2;if(!Number.isFinite(re)||re<=J){J=$;break}H=J,J=Math.min(re,$)}else break}let se=0;for(;H<J&&se<256;){let fe=Math.max(H+1,Math.floor((H+J+1)/2)),ee=sr(e,u,fe);ue(ee).cmp(n)<=0?H=fe:J=fe-1,se++}let ce=Math.max(1,H),x=Xs(ce),X=s,K=s;if(!a)if(X=Xu(e,u,ce),Number.isFinite(f)){let fe=Math.max(0,Math.floor(f-Math.min(u,f)));ce>=fe?K=s:K=ue(L+ce*g)}else K=ue(L+ce*g);return{count:x,spent:X,nextPrice:K,numericCount:ce}}if(n.cmp(w)<0)return{count:s,spent:s,nextPrice:w,numericCount:0};let A=!1,q=null,P=null;try{q=c.fromAny(e.costAtLevel(u+1))}catch{}try{let W=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);P=c.fromAny(e.costAtLevel(W))}catch{}!A&&!(i.ratioMinus1>0)&&(A=!0),q&&P&&(A=q.cmp(w)===0&&P.cmp(w)===0),!A&&!(i.ratioMinus1>0)&&(A=!0);let G=Number.isFinite(y)?Math.max(0,Math.floor(y)):Number.MAX_VALUE;if(A){let W=ar(e.lvlCapBn??"Infinity","Infinity"),$=ar(t??0,0),H=W.isInfinite?.()?c.fromAny("Infinity"):W.sub($).floorToInteger(),{count:J,countBn:se,spent:ce,nextPrice:x}=Lm(w,n,H);return{count:se,spent:ce,nextPrice:x,numericCount:J}}if(!(g>0)||!(v>0)){let W=ar(e.lvlCapBn??"Infinity","Infinity"),$=ar(t??0,0),H=W.isInfinite?.()?c.fromAny("Infinity"):W.sub($).floorToInteger(),{count:J,countBn:se,spent:ce,nextPrice:x}=Lm(w,n,H);return{count:se,spent:ce,nextPrice:x,numericCount:J}}let M=Math.log10(v);if(!Number.isFinite(M))return{count:s,spent:s,nextPrice:w,numericCount:0};let T=Nf(h+M-L)/g;(!Number.isFinite(T)||T<0)&&(T=0);let _=Math.floor(Math.min(G,T));Number.isFinite(_)||(_=G),_<=0&&(_=1);let Y=1e-7,Q=sr(e,u,_),ie=0,me=2048;for(;_>0&&(!Number.isFinite(Q)||Q>h+Y)&&ie<me;){let W=Number.isFinite(Q)?Math.max(1,Math.ceil((Q-h)/Math.max(g,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-W));if($<_)_=$;else{let H=P0(_);if(!(H<_))break;_=H}Q=_>0?sr(e,u,_):Number.NEGATIVE_INFINITY,ie+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(w)>=0)_=1,Q=Ee(w);else return{count:s,spent:s,nextPrice:w,numericCount:0};if(_<G){let W=x=>{let X=x*2;return Number.isFinite(X)?X:Number.MAX_VALUE},$=_,H=Math.min(G,Math.max(_+1,W(_))),J=sr(e,u,H);for(;$<H&&Number.isFinite(J)&&J<=h+Y&&H<G;)$=H,H=Math.min(G,W(H)),J=sr(e,u,H);let se=$,ce=H;for(let x=0;x<256&&se<ce;x+=1){let X=Math.floor((se+ce+1)/2),K=sr(e,u,X);Number.isFinite(K)&&K<=h+Y?(se=X,Q=K):ce=X-1}_=se}let ve=null;if(!a){ve=Xu(e,u,_);let W=0;for(;ve.cmp(n)>0&&_>0&&W<me;){let $=Ux(_);if(!($<_))break;_=$,ve=Xu(e,u,_),W+=1}if(_<=0)return{count:s,spent:s,nextPrice:w,numericCount:0};if(_<G&&W<me)for(;_<G&&W<me;){let $=u+_,H;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)H=c.fromAny(e.costAtLevel($));else{let se=L+_*g;H=ue(se).floorToInteger()}}catch{break}let J=ve.add(H);if(J.cmp(n)>0)break;ve=J,_+=1,W+=1}}let Oe=s,Te=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let W=Math.max(0,Math.floor(f-Math.min(u,f)));if(_>=W)Oe=s;else if(Te){let $=Math.floor(u+_);Oe=c.fromAny(e.costAtLevel($))}else{let $=L+_*g;Oe=ue($)}}else if(Te){let W=Math.floor(u+_);Oe=c.fromAny(e.costAtLevel(W))}else{let W=L+_*g;Oe=ue(W)}return{count:Xs(_),spent:ve,nextPrice:Oe,numericCount:_}}function Dx(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=Ee(t),r=Ee(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function Lm(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let m=e.mulBigNumInteger(d);return{count:_m(d),countBn:d,spent:m,nextPrice:e}}let i=Ee(t),s=Ee(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=ue(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:_m(l),countBn:l,spent:a,nextPrice:u}}function $x(e,t,n,o){if(!n||o<=0)return{count:0};let r=Ee(t),i=Ee(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let h=0;h<64&&a<u;h+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let m=i+f*n.ratioLog,y=ue(d),p=ue(m);return{count:f,spent:y,nextPrice:p,spentLog:d,nextPriceLog:m}}function ar(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function _m(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Dr(e){return j(e instanceof c?e:c.fromAny(e??0))}function Ks(e){return Dr(e).replace(/<[^>]*>/g,"")}function zu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function js(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=zu(n??t??0),s=zu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Ve(i),newLevel:Number.isFinite(o)?o:Ve(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Ft(e,t){return vn(e,t)}function B0(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Ci(e,t,n=b()){if(n==null)return null;let o=lr(e),r=Pm(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function qx(){v0.forEach(e=>{try{e?.()}catch{}}),v0.clear()}function b0(e){qx()}function Gx(e,t){if(typeof localStorage>"u")return;let n=B0(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=Ci(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}})}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function Hx(e,t,n){Gx(e,n);let o=Ci(e,t,n);if(!o)return null;if(Vs&&Al.has(o))try{let r=Al.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Ur.has(o))try{let r=Ur.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function Ws(e,t,n,o=b(),r={}){let i=Ci(e,t,o);if(i){if(Vs){Al.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Ur.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Ur.has(i)&&Ur.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{ct(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function Xx(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&Ws(e,o.id,o,n)})}function Pm(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return no(t.id);let n=no(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=cr(n);if(o){let r=Sm.get(o);if(r){let i=lr(e);if(!i||lr(r.area)===i)return no(r.id)}}}return n}function F0(e,t,n=b()){let o=n==null?"null":String(n),r=Pm(e,t);return`${o}:${e}:${no(r)}`}function bo(e,t){let n=Pm(e,t),o=no(n),r=b(),i=F0(e,o,r),s=Mm.get(i);if(s)return s;let l=ta(e,o),a=Hx(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,Ws(e,o,a,r)}let f=a.lvl,d=a.nextCost,m=a.nextCostLvl;a.lvl=Ys(a.lvl),a.nextCost=Ys(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Ys(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==m)&&(u=!0);let y=0;l?.upgType==="HM"&&(y=Qs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),Zu(l,y));let p=mt(a.lvl),h=Ve(p);try{let C=l?.lvlCapBn??c.fromAny("Infinity");if(!C.isInfinite?.()&&p.cmp(C)>0){let A=C.clone?.()??C;h=Ve(A);let q=A.toStorage();a.lvl=q,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=q,Ws(e,o,a,r)}}catch{}let g=null;try{g=p?.toStorage?.()??mt(h).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let v=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,w=!v||v!==g,L=null;if(!L||w){if(l)try{L=c.fromAny(l.costAtLevel(h))}catch{L=c.fromInt(0)}else L=c.fromInt(0);try{a.nextCost=L.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{Ws(e,o,a,r)}catch{}if(l?.upgType==="HM"&&p?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let C=c.fromAny("Infinity");l.lvlCapBn=C,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Dr(C),l.lvlCapFmtText=Ks(C)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:h,lvlBn:p,nextCostBn:L,slot:r,hmEvolutions:y},Mm.set(i,s),s}function $r(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=no(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??mt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Ve(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??mt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=mt(e.lvl??0).toStorage()}i.lvl=Ys(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Ys(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=Qs(e.hmEvolutions)),Ws(n,r,i,o,t),e.slot=o}function ur(e,t,n=b()){Mm.delete(F0(e,t,n))}function At(e,t){return bo(e,t).lvl}function Cm(e,t){return bo(e,t).hmEvolutions??0}function U0(e,t){if(!t)return{locked:!1};let n=M0(),o=n?Sn():c.fromInt(0),r=n?Ve(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=Nx(e,t),d="Unlock the XP system to reveal this upgrade",m=C0();if(f)if(m)i={locked:!0,iconOverride:bn,titleOverride:sn,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let y='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Bn,titleOverride:to,descOverride:y,reason:y,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Bn,titleOverride:to,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=gm({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,surgeLevel:Zn(),surgeUnlocked:Fr(),baseLocked:s.locked,getUpgradeLevel(m){return At(e,m)}},d=t.computeLockState(f);s=gm(s,d)}catch{}let l=b(),a=Js(e,t),u=a?Yu(e,t,l):!1;if(a){let f=wm(l),d=Ku(l),m=km(l),y=a.replace(/_/g,"-"),p=Rl(e,t),h=!1;Hs(f,y,a)&&(h=!0),p&&Hs(f,p,a)&&(h=!0),h&&Em(f,l);let g=!1;Hs(d,y,a)&&(g=!0),p&&Hs(d,p,a)&&(g=!0),g&&ju(d,l);let v=!1;Hs(m,y,a)&&(v=!0),p&&Hs(m,p,a)&&(v=!0),v&&Am(m,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=Bn),f?s.titleOverride||(s.titleOverride=sn):(!s.titleOverride||s.titleOverride===sn)&&(s.titleOverride=to),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Bn||s.iconOverride===bn)&&delete s.iconOverride,(s.titleOverride===sn||s.titleOverride===to)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Bn),a){let f=wm(l),d=f.upgrades[a]||{},m=cr(t?.tie??t?.tieKey),y=m&&w0.has(m),p=m&&Tm.has(m),h=d.status||"locked";if(Yu(e,t,l))h="unlocked";else if(_0(e,t,l)&&h==="locked"){let M=!1;try{M=Ve(Sn())>=31}catch{}let U=!1;try{U=Ve(Sn())>=101}catch{}y&&!M||p&&!U?h="locked":h="mysterious"}let g=Uu(h),v=hm(s),w=Uu(v),L=()=>{s.locked=!0;let M=d.snapshot;M&&typeof M=="object"&&(s=gm(s,M)),s.iconOverride=bn,s.titleOverride=sn;let U=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=U,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>w&&(h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):h==="mysterious"&&L(),v=hm(s),w=Uu(v));let C=!1,A=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",q=y,P=!1;try{P=Ve(Sn())>=31}catch{}let G=!1;try{G=Ve(Sn())>=101}catch{}if((q&&!P&&A==="mysterious"||p&&!G&&A==="mysterious")&&(A="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==A)&&(f.upgrades[a]={status:A},C=!0),w>g){if(d.status=v,f.upgrades[a]={status:d.status},C=!0,h=v,g=w,v==="unlocked")Mi(e,t,l);else if(v==="mysterious"){let M=!1;try{M=Ve(Sn())>=31}catch{}(!y||M)&&xm(e,t,l)}}h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Bn||s.iconOverride===bn)&&delete s.iconOverride,(s.titleOverride===sn||s.titleOverride===to)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},C=!0),Mi(e,t,l)):h==="mysterious"&&v!=="mysterious"&&(L(),v=hm(s),w=Uu(v)),C&&Em(f,l)}return s}function Ol(e,t){return!!U0(e,t).locked}function Bm(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Wu(e),{capBn:r,cap:i}=k0(o);try{return t?.cmp?.(r)>=0}catch{}let s=Ve(t);return Number.isFinite(s)&&s>=i}function Tn(e,t){let n=bo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():mt(n.lvl??0)}function D0(e,t){let n=bo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??mt(n.lvl??0),i=Ve(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function ir(e,t,n,o=!0,r={}){let i=bo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,Zu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=zu(i.lvlBn??mt(i.lvl??0)),d=mt(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let m=d;try{s&&S0(s,m)&&(m=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let p=mt(a);m.cmp(p)>0&&(m=p)}if(o&&Number.isFinite(a)){let p=mt(a);m.cmp(p)>0&&(m=p)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(m)===0)return i.lvl;let y=Ve(m);if(!s)return i.lvl=y,i.lvlBn=m,i.nextCostBn=c.fromInt(0),$r(i),ur(e,t),oo(),i.lvl;i.lvl=y,i.lvlBn=m;try{i.nextCostBn=c.fromAny(s.costAtLevel(y))}catch{i.nextCostBn=c.fromInt(0)}return $r(i,{deferSave:r?.deferSave}),ur(e,t),js(s,u,f,i.lvl,i.lvlBn),oo(),i.lvl}function Ct(e){return Ju.filter(t=>t.area===e)}function ta(e,t){let n=lr(e),o=no(t),r=cr(typeof o=="string"?o:t);return Ju.find(i=>n&&lr(i.area)!==n?!1:!!(no(i.id)===o||r&&i.tieKey===r))||null}function Ao(e,t){let n=typeof t=="object"&&t?t:ta(e,t);return U0(e,n)}function du(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function pu(e){return e?du(e.icon):""}function Vx(e,t){let n=ta(e,t),o=Tn(e,t),r=Ve(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Os(e,t){let n=bo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Ol(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??mt(r),s=zu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(S0(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),$r(n),ur(e,t),oo(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?R[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let y=f.value;if((y instanceof c?y:c.fromAny(y??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let m=i.add(c.fromInt(1));return n.lvlBn=m,n.lvl=Ve(m),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),$r(n),ur(e,t),js(o,r,s,n.lvl,n.lvlBn),oo(),{bought:1,spent:d}}function fu(e,t){let n=bo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??mt(n.lvl);if(!Bm(o,r,n.hmEvolutions))return{evolved:!1};let i=Qs(n.hmEvolutions)+1;n.hmEvolutions=i,Zu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return $r(n),ur(e,t),js(o,n.lvl,r,n.lvl,r),oo(),{evolved:!0}}function hl(e,t){let n=bo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ol(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??mt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=R[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Os(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let v=i.clone?.()??mt(i),w=Ve(v),L=v.toStorage?.(),C;if(o.upgType==="HM"){if(C=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let q=c.fromAny("Infinity");o.lvlCapBn=q,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Dr(q),o.lvlCapFmtText=Ks(q)}}else{let q=o.lvlCapBn?.clone?.()??ar(o.lvlCap??1/0,1/0);C=q?.clone?.()??q}let A=C.sub(v);if(A.isZero?.()){let q=Rx(C,v);q.isZero?.()||(A=q)}if(A.isZero?.()){let q=C.toStorage?.();if(L&&q&&L!==q)if(C.isInfinite?.())try{A=c.fromAny("Infinity")}catch{A=c.fromInt(1)}else A=c.fromInt(1)}return n.lvlBn=C.clone?.()??C,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),R[o.costType].set(u),$r(n),ur(e,t),js(o,w,v,n.lvl,n.lvlBn),oo(),{bought:A,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):Zs;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=zs(o,i,u,d),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=m.spent??c.fromInt(0),h=u.sub(p);R[o.costType].set(h);let g=i.add(y);return n.lvlBn=g,n.lvl=Ve(g),m.nextPrice?n.nextCostBn=m.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),$r(n),ur(e,t),js(o,r,i,n.lvl,n.lvlBn),oo(),{bought:y,spent:p}}function Ps(e,t,n){let o=bo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Ol(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??mt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=R[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,m=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Ve(n):void 0,y=Number.isFinite(d)?Number.isFinite(m)?Math.min(d,m):d:m,p=zs(r,s,f,y),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=p.spent??c.fromInt(0),v=f.sub(g);R[r.costType].set(v);let w=s.add(h);return o.lvlBn=w,o.lvl=Ve(w),p.nextPrice?o.nextCostBn=p.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),$r(o),ur(e,t),js(r,i,s,o.lvl,o.lvlBn),oo(),{bought:h,spent:g}}function Ii(e,t,n,o=Zs,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=zs(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function oo(){if(Vs){bm=!0,_d();return}_d(),Tc()}function Jn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Ie.STARTER_COVE}function Bs(e,t){let n=ta(e,t);if(!n)return null;let o=Tn(e,t),r=Ve(o),i=Dr(o),s=Ks(o),l=n.lvlCapBn??ar(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Dr(l),u=n.lvlCapFmtText??Ks(l),f=r<n.lvlCap?D0(e,t):c.fromInt(0),d=Dr(f),m=R[n.costType]?.value,y=m instanceof c?m:c.fromAny(m??0),p=Ao(e,t),h=!!p.locked,g=p.titleOverride??n.title,v=p.descOverride??n.desc;if(e===Ze&&no(t)===oi){let A=Oc();if(Math.abs(A-1)>1e-4&&v){let q=Pe(A);v=v.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+q+" Coins on an interval")}}let w=Om(n,e),L="";typeof n.effectSummary=="function"&&!(h&&p.hideEffect)&&(L=n.effectSummary(r),typeof L=="string"&&(L=L.trim()));let C=p.iconOverride??pu(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:y,haveFmt:R[n.costType]?.fmt(y)??String(y),effect:L,iconUrl:C,lockState:p,locked:h,areaKey:e,hmMilestones:w,displayTitle:g,displayDesc:v,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?Cm(e,t):0,hmReadyToEvolve:n.upgType==="HM"?Bm(n,o,Cm(e,t)):!1,hmNextMilestone:n.upgType==="HM"?N0(n,o,e):null}}function Yx(e,t){let n=ta(e,t);if(!n||n.upgType!=="HM")return null;let o=Tn(e,t);return N0(n,o,e)}function Wx(e){return ue(Ee(e??0))}function Pd(e,t){let n=bo(e,t),o=n.upg;if(!o)return{bought:0};let r=B0(e,n.slot);if(Kt(r))return{bought:0};let i=Ci(e,t,n.slot);if(Kt(i))return{bought:0};if(Ol(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??mt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&Bm(o,l,n.hmEvolutions))return{bought:0};let f=R[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let m=zs(o,l,d,Zs),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:0};let p=l.add(y);return Ex(),ir(e,t,p,!0,{deferSave:!0}),{bought:y}}function gl(e,t){let n=bo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Ol(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??mt(n.lvl),i=Ve(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=R[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=Ii(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=y=>{if(y<=0)return!0;let p=Xu(o,i,y-1),h=a.sub(p),g=i+y-1,v=c.fromAny(o.costAtLevel(g)),w=h.div(10);return v.cmp(w)<=0},m=0;if(f<2e3){let y=u.spent,p=f;for(;p>0;){let h=i+p-1,g=c.fromAny(o.costAtLevel(h)),v=y.sub(g),L=a.sub(v).div(10);if(g.cmp(L)<=0){m=p;break}y=v,p--}}else{let y=0,p=f;for(;y<p;){let h=Math.ceil((y+p)/2);d(h)?y=h:p=h-1}m=y}return m<=0?{bought:0,spent:c.fromInt(0)}:Ps(e,t,m)}var Zs,Ht,tk,wx,Vu,Ie,Vs,g0,Al,bm,Ur,y0,Lx,mm,Le,I0,_x,Bn,bn,sn,to,w0,Tm,Mx,Cx,Tx,kx,E0,x0,L0,Ax,$u,qu,Gu,Sm,nk,Im,Fu,Zt,Du,Ox,ym,O0,vm,Fx,Ju,Mm,v0,fo=De(()=>{It();Et();zt();zn();To();Co();Cn();ri();hs();mp();Cd();Zs=c.fromAny("Infinity"),Ht=1e3,tk=c.fromInt(1e3),wx=3,Vu="",Ie={STARTER_COVE:"starter_cove",AUTOMATION:Ze,DNA:Gt},Vs=!1,g0=new Map,Al=new Map,bm=!1,Ur=new Map,y0=null;Lx=308;mm=1024;Le={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},I0=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],_x={[Ie.STARTER_COVE]:I0},Bn="img/misc/locked.webp",bn="img/misc/mysterious.webp",sn="Hidden Upgrade",to="Locked Upgrade",w0=new Set([Le.COIN_VALUE_II,Le.XP_VALUE_II,Le.MP_VALUE_I,Le.MAGNET,Le.ENDLESS_XP]),Tm=new Set([Le.COIN_VALUE_III,Le.XP_VALUE_III,Le.MP_VALUE_II,Le.FASTER_COINS_III,Le.ENDLESS_MP]),Mx=new Set([Le.UNLOCK_XP,Le.UNLOCK_FORGE,Le.UNLOCK_INFUSE,Le.UNLOCK_SURGE,...w0,...Tm]),Cx=new Set([Le.FASTER_COINS_II,Le.COIN_VALUE_I,Le.BOOK_VALUE_I,Le.XP_VALUE_I]),Tx=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),kx="ccc:merchantMet",E0="ccc:shop:reveals",x0="ccc:shop:permaUnlocks",L0="ccc:shop:permaMyst",Ax={locked:0,mysterious:1,unlocked:2},$u=new Map,qu=new Map,Gu=new Map,Sm=new Map,nk=cr(Le.BOOK_VALUE_I),Im=c,Fu=e=>Im.fromAny(e??0),Zt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Fu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Im.fromInt(1).add(r.mulDecimal(n))}catch{let i=Ee(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return ue(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Fu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Im.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Fu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Fu(i);if(o>0){let l=Ee(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return ue(u)}}catch{}try{let l=Ve(s),a=o*l;return ue(a)}catch{return c.fromInt(1)}}}};Du=Math.log(10);Ox={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Wu(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Wu(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};ym=(()=>{try{let e=Ve(Zs);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),O0=new ArrayBuffer(8),vm=new Float64Array(O0),Fx=new BigInt64Array(O0);Ju=[{area:Ie.STARTER_COVE,id:1,tie:Le.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(.1)},{area:Ie.STARTER_COVE,id:2,tie:Le.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:yn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Jr()}catch{}}},{area:Ie.STARTER_COVE,id:3,tie:Le.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(.1)},{area:Ie.STARTER_COVE,id:4,tie:Le.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(.5),onLevelChange(){try{nn()}catch{}}},{area:Ie.STARTER_COVE,id:5,tie:Le.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>Hu(e)>0?2:1,onLevelChange({newLevel:e}){Ka(e)}},{area:Ie.STARTER_COVE,id:6,tie:Le.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addFlatPerLevel(2)},{area:Ie.STARTER_COVE,id:7,tie:Le.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:yn,onLevelChange({newLevel:e}){if((e??0)>=1)try{um()}catch{}}},{area:Ie.STARTER_COVE,id:8,tie:Le.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${j(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(10),onLevelChange(){try{nn()}catch{}}},{area:Ie.STARTER_COVE,id:9,tie:Le.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:10,tie:Le.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:11,tie:Le.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=Hu(e),n=Pe(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>Hu(e)},{area:Ie.STARTER_COVE,id:12,tie:Le.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach certain upgrade levels for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Ht,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return vn(this,e)},nextCostAfter(e,t){return vn(this,t)},computeLockState:yn,effectSummary(e){let t=mt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=gt(n,o);return`XP value bonus: ${Pe(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:13,tie:Le.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:yn,onLevelChange({newLevel:e}){if((e??0)>=1)try{fm()}catch{}}},{area:Ie.STARTER_COVE,id:14,tie:Le.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${j(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(1e3)},{area:Ie.STARTER_COVE,id:15,tie:Le.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:16,tie:Le.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:17,tie:Le.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ft(this,e)},nextCostAfter(e,t){return Ft(this,t)},computeLockState:yn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Pe(t)}x`},effectMultiplier:Zt.addPctPerLevel(1)},{area:Ie.STARTER_COVE,id:18,tie:Le.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Ht,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return vn(this,e)},nextCostAfter(e,t){return vn(this,t)},computeLockState:yn,effectSummary(e){let t=mt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=gt(n,o);return`MP value bonus: ${Pe(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:19,tie:Le.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:yn,onLevelChange({newLevel:e}){if((e??0)>=1)try{dm()}catch{}}},{area:Ie.STARTER_COVE,id:20,tie:Le.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Ht,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return vn(this,e)},nextCostAfter(e,t){return vn(this,t)},computeLockState(e){let t=Zn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=Sn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:bn,titleOverride:sn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:to,descOverride:"Locked"}},onLevelChange(){try{nn()}catch{}},effectSummary(e){let t=mt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=gt(n,o);return`Coin value bonus: ${Pe(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:21,tie:Le.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Ht,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return vn(this,e)},nextCostAfter(e,t){return vn(this,t)},computeLockState(e){let t=Zn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=Sn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:bn,titleOverride:sn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:to,descOverride:"Locked"}},onLevelChange(){try{nn()}catch{}},effectSummary(e){let t=mt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=gt(n,o);return`Coin value bonus: ${Pe(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},{area:Ie.STARTER_COVE,id:22,tie:Le.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Ht,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return vn(this,e)},nextCostAfter(e,t){return vn(this,t)},computeLockState(e){let t=Zn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=Sn();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:bn,titleOverride:sn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:to,descOverride:"Locked"}},onLevelChange(){try{nn()}catch{}},effectSummary(e){let t=mt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Wo(this,t,this.area),r=gt(n,o);return`Coin value bonus: ${Pe(r)}x`},effectMultiplier:Zt.powPerLevel(1.1)},...Ng,...Jy];for(let e of Ju){let t=cr(e.tie??e.tieKey);t&&!Sm.has(t)&&Sm.set(t,e),e.baseCost=ar(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return vn(this,n)},e.nextCostAfter=function(n,o){return vn(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=Zt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=mt(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Wo(this,o,this.area),s=gt(r,i);if(typeof this.bonusLine=="function")return this.bonusLine(n,s);let l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Pe(s)}x`})),e.numUpgEvolutions=Qs(e.numUpgEvolutions),e.upgType==="HM"?Zu(e,e.numUpgEvolutions):(e.lvlCapBn=ar(e.lvlCap??1/0,1/0),e.lvlCap=_m(e.lvlCapBn),e.lvlCapFmtHtml=Dr(e.lvlCapBn),e.lvlCapFmtText=Ks(e.lvlCapBn)),e.bulkMeta=Dx(e),ea(e)}Mm=new Map;v0=new Map;typeof window<"u"&&(b0(b()),window.addEventListener("saveSlot:change",()=>{b0(b()),oo()}),window.addEventListener("surge:level:change",()=>{oo()}));Hg()});var pb={};vt(pb,{applyAllCurrencyOverridesForActiveSlot:()=>Hl,applyStatMultiplierOverride:()=>Kn,getDebugCurrencyMultiplierOverride:()=>Fl,getDebugStatMultiplierOverride:()=>c1,setDebugCurrencyMultiplierOverride:()=>ob,setDebugPanelAccess:()=>X1,setDebugStatMultiplierOverride:()=>Un});function Gl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function Jx(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function In(e){typeof e=="function"&&$m.push(e)}function af(){return{sections:new Set,subsections:new Set}}function Qx(){let e=document.getElementById(Dl);if(!e)return af();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function e1(e){let{sections:t,subsections:n}=z0??af();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function Z0(){$m.forEach(e=>{try{e?.()}catch{}}),$m=[],Vm.length=0}function $t(e){!e||typeof e.refresh!="function"||Vm.push(e)}function dt(e){Vm.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function t1(){if(typeof window>"u")return;let e=y=>{let{key:p,slot:h}=y?.detail??{},g=h??b();dt(v=>v.type==="currency"&&v.key===p&&v.slot===g)};window.addEventListener("currency:change",e,{passive:!0}),In(()=>window.removeEventListener("currency:change",e));let t=y=>{let{key:p,slot:h}=y?.detail??{},g=h??b();dt(v=>v.type==="currency-mult"&&v.key===p&&v.slot===g)};window.addEventListener("currency:multiplier",t,{passive:!0}),In(()=>window.removeEventListener("currency:multiplier",t));let n=y=>{let{slot:p,changeType:h,unlocked:g}=y?.detail??{},v=p??b();dt(w=>w.type==="xp"&&w.slot===v),dt(w=>w.type==="stat-mult"&&w.key==="xp"&&w.slot===v),(h==="unlock"||typeof g=="boolean")&&dt(w=>w.type==="unlock"&&(w.slot==null||w.slot===v))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),In(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=y=>{let{changeType:p,slot:h}=y?.detail??{},g=h??b();dt(v=>v.type==="mutation"&&v.slot===g),dt(v=>v.type==="stat-mult"&&v.key==="mutation"&&v.slot===g),p==="unlock"&&dt(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("mutation:change",o,{passive:!0}),In(()=>window.removeEventListener("mutation:change",o));let r=()=>{let y=b();dt(p=>p.type==="upgrade"&&p.slot===y),dt(p=>p.type==="currency-mult"&&p.slot===y),dt(p=>p.type==="stat-mult"&&p.slot===y)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),In(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let y=b();dt(p=>p.slot===y)};window.addEventListener("saveSlot:change",i,{passive:!0}),In(()=>window.removeEventListener("saveSlot:change",i));let s=y=>{let{slot:p,key:h}=y?.detail??{},g=p??b();dt(v=>v.type==="unlock"&&(v.slot==null||v.slot===g)&&(v.key==null||v.key===h))};window.addEventListener("unlock:change",s,{passive:!0}),In(()=>window.removeEventListener("unlock:change",s));let l=y=>{let{slot:p}=y?.detail??{},h=p??b();dt(g=>g.type==="workshop-level"&&g.slot===h)};window.addEventListener("workshop:change",l,{passive:!0}),In(()=>window.removeEventListener("workshop:change",l));let a=y=>{let{slot:p}=y?.detail??{},h=p??b();dt(g=>g.type==="surge-level"&&g.slot===h)};window.addEventListener("surge:level:change",a,{passive:!0}),In(()=>window.removeEventListener("surge:level:change",a));let u=y=>{let{slot:p}=y?.detail??{},h=p??b();dt(g=>g.type==="tsunami-nerf"&&(g.slot==null||g.slot===h))};window.addEventListener("surge:nerf:change",u,{passive:!0}),In(()=>window.removeEventListener("surge:nerf:change",u));let f=y=>{let{slot:p}=y?.detail??{},h=p??b();dt(g=>g.type==="lab-level"&&(g.slot==null||g.slot===h)),dt(g=>g.type==="stat-mult"&&g.key==="rp"&&(g.slot==null||g.slot===h))};window.addEventListener("lab:level:change",f,{passive:!0}),In(()=>window.removeEventListener("lab:level:change",f));let d=y=>{let{id:p,level:h}=y?.detail??{},g=b();dt(v=>v.type==="lab-node-level"&&v.slot===g&&v.id===p),p===1&&dt(v=>v.type==="tsunami-nerf"&&(v.slot==null||v.slot===g)),p===4&&dt(v=>v.type==="unlock"&&(v.slot==null||v.slot===g))};window.addEventListener("lab:node:change",d,{passive:!0}),In(()=>window.removeEventListener("lab:node:change",d));let m=y=>{let{id:p,rp:h}=y?.detail??{},g=b();dt(v=>v.type==="lab-node-rp"&&v.slot===g&&v.id===p)};window.addEventListener("lab:node:rp",m,{passive:!0}),In(()=>window.removeEventListener("lab:node:rp",m))}function lf(){return[{key:Ie.STARTER_COVE,title:"The Cove",currencies:[{key:Re.COINS,label:"Coins"},{key:Re.BOOKS,label:"Books"},{key:Re.GOLD,label:"Gold"},{key:Re.MAGIC,label:"Magic"},{key:Re.GEARS,label:"Gears"},{key:Re.WAVES,label:"Waves"},{key:Re.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function J0(){if(document.getElementById(Qu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Qu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Qu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Qu,document.head.appendChild(n)}function Gm(){let e=document.getElementById(W0);e&&e.remove()}function n1(){return Ri&&Je&&b()!=null&&!Gl()&&Jx()}function o1(e){e?.detail?.visible&&Bo(),ff()}function tf(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${K0++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Fn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${j0++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Nt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function Ym(e,t=b()){let n=t??b();return n==null?null:`${St.CURRENCY[e]}:${n}`}function Bl(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=R?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Ma(n,e)}catch{return c.fromInt(0)}}function r1(e,t,n=b()){let o=n??b(),r=Bl(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=Ym(e,o),s=i&&So(i);s&&sa(i);let l=r;try{xn(o),l=Vi(e,t,{previous:r})??r,i&&ct(i)}catch{}finally{s&&Bi(i)}return dt(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function ro(e,t){return`${e??"null"}::${t}`}function Wm(e,t){return $l.get(ro(e,t))??null}function i1(e,t=b()){let n=t??b();return!e||n==null?null:`${St.MULTIPLIER[e]}:${n}`}function s1(e,t=b()){let n=ro(t,e);$l.delete(n),ra.delete(n),dt(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function zm(e,t){let n=!cf(t,e),o=ro(e,t),r=Ul.get(o);if(!n&&r)return r;let i=a1(t,e);return i?(Ul.set(o,i),i):(n&&Ul.delete(o),null)}function Q0(e,t){dt(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function eb(e,t=b()){let n=Pi(e,t);if(Ul.delete(ro(t,e)),Ti.delete(ro(t,e)),!(!n||typeof localStorage>"u")&&!So(n)){try{localStorage.removeItem(n)}catch{}Q0(e,t)}}function cf(e,t=b()){return So(Pi(e,t))}function tb(e,t){return cf(t,e)?zm(e,t):null}function Dn(e,t=b()){let n=Oi(e);return uf(e,t,n)??n}function Pi(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${zx}:${e}:${n}`}function Oi(e){try{if(e==="xp"){let t=Sc();if(t)return t}else if(e==="mutation"){let t=pf?.();if(t)return t;let n=df();if(n)return n}else if(e==="spawnRate"){let t=ps(Ie.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return Mc()}catch{}return c.fromInt(1)}function a1(e,t=b()){let n=Pi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function l1(e,t,n){let o=Pi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=So(o),s=i&&oa?oa:localStorage.setItem.bind(localStorage);i&&!oa&&sa(o),s(o,r.toStorage?.()??String(r)),i&&!oa&&Bi(o)}catch{}}function Km(e,t=b()){if(t==null)return;let n=Wm(t,e);if(!n||t!==b())return;let o=ro(t,e);if(!of.has(o)){of.add(o);try{let r=R?.[e]?.mult?.get?.();Nt(r,n)||R?.[e]?.mult?.set?.(n)}catch{}finally{of.delete(o)}}}function nb(){if(!(H0||typeof window>"u")){H0=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=ro(r,t);if(!r||!$l.has(i)||of.has(i))return;let s=ra.get(i),l=Wm(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,m=l.mulBigNumInteger(f);$l.set(i,m)}}catch{}ra.set(i,o)}else o&&ra.set(i,o);Km(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{Hl()},{passive:!0})}catch{}}}function Hl(){let e=b();e!=null&&Object.values(Re).forEach(t=>{Km(t,e)})}function ob(e,t,n=b()){if(!e||n==null)return null;nb();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=ro(n,e);if($l.set(r,o),!ra.has(r)){let i=R?.[e]?.mult?.get?.();ra.set(r,i)}return Km(e,n),o}function Fl(e,t=b()){return!e||t==null?null:Wm(t,e)}function Un(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Ul.set(ro(n,e),o),Ti.set(ro(n,e),Oi(e)),l1(e,n,o),Q0(e,n),o}function c1(e,t=b()){return!e||t==null?null:zm(t,e)}function Kn(e,t,n=b()){let o=Oi(e),r=uf(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Nt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=ro(n,e),l=Ti.get(s),a=cf(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function uf(e,t,n){let o=zm(t,e),r=ro(t,e);if(!o)return Ti.delete(r),null;let i=Ti.get(r),s=cf(e,t);if(!i)Ti.set(r,n);else if(!Nt(i,n))return s?(Ti.set(r,n),o):(eb(e,t),null);return o}function u1(){if(!(q0||typeof localStorage>"u")){q0=!0;try{oa=localStorage.setItem.bind(localStorage),G0=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ia.has(e))return oa(e,t)},localStorage.removeItem=e=>{if(!ia.has(e))return G0(e)}}catch{}}}function So(e){return e!=null&&ia.has(e)}function Bi(e){e&&(u1(),ia.add(e))}function sa(e){e&&ia.delete(e)}function f1(e){return e?So(e)?(sa(e),!1):(Bi(e),!0):!1}function d1(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=So(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(f1(e),typeof t=="function")try{t(So(e))}catch{}o()}),o(),{button:n,refresh:o}}function p1(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>So(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>So(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?sa(u):Bi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function m1(){let e=document.getElementById(Dl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function h1(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{So(r)&&(o.push(r),sa(r))});try{return t?.()}finally{o.forEach(r=>Bi(r))}}function g1(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function jm(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function Hm(e,t){e.classList.toggle("debug-invalid",!t)}function et(){let e=b();try{xn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function rb(e=b()){return e==null?null:`${Kx}:${e}`}function ib(e=b()){let t=rb(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function sb(e,t=b()){let n=rb(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,qm);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function y1(e,t=b()){let n=ib(t);return n.unshift(e),n.length>qm&&(n.length=qm),sb(n,t),n}function tt(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};y1(o,t),Zm()}function Zm(){if(!na)return;let e=ib();if(e.length===0){na.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",na.appendChild(t);return}na.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function ab(e=b()){return e==null?null:`${ul}:${e}`}function lb(e,t=b()){let n=ab(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function cb(e=b()){let t=ab(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function v1(e){if(e){if(Object.values(Re).includes(e.type)){try{e.type===Re.BOOKS?R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount):R[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function b1(){let e=b();if(e==null)return{completed:0};let t=cb(e),n=0;return Object.entries(tu).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,v1(r.reward))}),lb(t,e),{completed:n}}function S1(){let e=b();if(e==null)return{restored:0};let t=cb(e),n=0;return Object.entries(tu).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),lb(t,e),{restored:n}}function an(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,m=!1,y=r?d1(r,{onToggle:i}):null,p=g=>{if(f){d=g;return}d=null,u.value=typeof s=="function"?s(g):g1(g)};l.appendChild(u),y&&l.appendChild(y.button);let h=()=>{let g=jm(u.value);if(!g){Hm(u,!1);return}Hm(u,!0);let v=r&&So(r);v&&sa(r);try{n(g,{input:u,setValue:p})}finally{v&&Bi(r),y&&y.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",h),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),m=!0,h(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,m||h(),m=!1,d!=null){let g=d;d=null,p(g)}}),p(t),y&&y.refresh(),{row:l,input:u,setValue:p,isEditing:()=>f}}function I1({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let h=document.createElement("span");h.className="debug-unlock-desc",h.textContent=`- ${t}`,f.appendChild(h)}s.appendChild(l),s.appendChild(f);let m=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",h=>{l.contains(h.target)||m()});let y=!1,p=()=>{let h=!1;try{h=typeof n=="function"?!!n():!1}catch{}return a.checked=h,y=h,h};return a.addEventListener("change",()=>{let h=y,g=a.checked;try{g?o?.():r?.()}catch{}et();let v=p();h!==v&&tt(`Toggled ${e} [GOLD]${h?"True":"False"}[/GOLD] \u2192 [GOLD]${v?"True":"False"}[/GOLD]`)}),p(),$t({type:"unlock",slot:i,refresh:p}),s}function w1(e){try{if(e instanceof c||typeof e?.toScientific=="function")return j(e);let t=Number(e);return Number.isFinite(t)?j(t):String(e??"\u2014")}catch{return"\u2014"}}function E1({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:m})=>{if(d.type==="select"){u[d.key]=m.value;return}let y=jm(m.value),p=y instanceof c;if(Hm(m,p),!p){f=!0;return}u[d.key]=y}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=w1(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:m,label:y})=>{let p=document.createElement("option");p.value=m,p.textContent=y??m,f.defaultValue!=null&&f.defaultValue===m&&(p.selected=!0),d.appendChild(p)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function qr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return rt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Jr()}catch{}let f=ki.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ct(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),m=ki.level(n);localStorage.setItem(m,d),ct(m,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),m=ki.progress(n);localStorage.setItem(m,d),ct(m,d)}catch{}try{Qi({forceReload:!0})}catch{}try{vc({changeType:"debug-panel",slot:n})}catch{}try{dt()}catch{}}function Gr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return ht()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,m=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&m!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{ql(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Qt()}catch{}try{Br()}catch{}let f=Ai.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ct(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),m=Ai.level(n);localStorage.setItem(m,d),ct(m,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),m=Ai.progress(n);localStorage.setItem(m,d),ct(m,d)}catch{}try{Qt({forceReload:!0})}catch{}try{Jm({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{dt()}catch{}}function x1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=Ym(r.key,n),s=Bl(r.key,n),l=an(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=Bl(r.key,f),{next:m}=r1(r.key,a,f);u(m),Nt(d,m)||(et(),tt(`Modified ${r.label} (${o}) ${j(d)} \u2192 ${j(m)}`))},{storageKey:i,onLockChange:()=>l.setValue(Bl(r.key,b()))});$t({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=Bl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function L1(e,t){let n=b();if(n==null){let P=document.createElement("div");P.className="debug-panel-empty",P.textContent="Select a save slot to edit stats.",e.appendChild(P);return}let o="spawnRate",r=Pi(o,n),i=an("Coin Spawn Rate",Dn(o,n),(P,{setValue:G})=>{let M=b();if(M==null)return;let U=Dn(o,M);try{Un(o,P,M)}catch{}let T=Dn(o,M);G(T),Nt(U,T)||(et(),tt(`Modified Spawn Rate (${a}) ${j(U)} \u2192 ${j(T)}`))},{storageKey:r,onLockChange:P=>{let G=b();if(G!=null){if(P){if(tb(G,o))return;try{Un(o,Oi(o),G)}catch{}}else uf(o,G,Oi(o));i.setValue(Dn(o,G))}}});$t({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Dn(o,n);i.setValue(P)}}),$t({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Dn(o,n);i.setValue(P)}}),e.appendChild(i.row);let s=rt(),l=ht(),a=t?.title??t?.key??"Unknown Area",u=ki.level(n),f=an("XP Level",s.xpLevel,(P,{setValue:G})=>{let M=rt().xpLevel;qr({level:P});let U=rt();G(U.xpLevel),Nt(M,U.xpLevel)||(et(),tt(`Modified XP Level (${a}) ${j(M)} \u2192 ${j(U.xpLevel)}`))},{storageKey:u});$t({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(rt().xpLevel)}}),e.appendChild(f.row);let d=ki.progress(n),m=an("XP Progress",s.progress,(P,{setValue:G})=>{let M=rt(),U=M?.xpLevel?.clone?.()??M?.xpLevel,T=M?.progress?.clone?.()??M?.progress;qr({progress:P});let _=rt();G(_.progress),f.setValue(_.xpLevel),(!Nt(T,_.progress)||!Nt(U,_.xpLevel))&&(et(),tt(`Modified XP Progress (${a}) ${j(T)} \u2192 ${j(_.progress)}`))},{storageKey:d});$t({type:"xp",slot:n,refresh:()=>{n===b()&&m.setValue(rt().progress)}}),e.appendChild(m.row);let y=Ai.level(n),p=an("MP Level",l.level,(P,{setValue:G})=>{let M=ht().level;Gr({level:P});let U=ht();G(U.level),Nt(M,U.level)||(et(),tt(`Modified MP Level (${a}) ${j(M)} \u2192 ${j(U.level)}`))},{storageKey:y});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&p.setValue(ht().level)}}),e.appendChild(p.row);let h=Ai.progress(n),g=an("MP Progress",l.progress,(P,{setValue:G})=>{let M=ht(),U=M?.level?.clone?.()??M?.level,T=M?.progress?.clone?.()??M?.progress;Gr({progress:P});let _=ht();G(_.progress),p.setValue(_.level),(!Nt(T,_.progress)||!Nt(U,_.level))&&(et(),tt(`Modified MP Progress (${a}) ${j(T)} \u2192 ${j(_.progress)}`))},{storageKey:h});$t({type:"mutation",slot:n,refresh:()=>{n===b()&&g.setValue(ht().progress)}}),e.appendChild(g.row);let v=yi(n);if(v){let P=0;try{let M=localStorage.getItem(v),U=c.fromAny(M||"0");if(U.isInfinite())P=1/0;else try{P=Number(U.toScientific(20))}catch{P=0}}catch{}let G=an("Workshop Level",P,(M,{setValue:U})=>{let T=Number(M);if(M instanceof c)if(M.isInfinite())T=1/0;else try{T=Number(M.toScientific(20))}catch{T=NaN}if(Number.isNaN(T)||T<0)return;let _=T===1/0?"Infinity":String(Math.floor(T));try{localStorage.setItem(v,_),et(),tt(`Modified Workshop Level (The Cove) ${j(P)} \u2192 ${_}`),P=T}catch{}U(T)},{storageKey:v,onLockChange:()=>{let M=0;try{let U=localStorage.getItem(v),T=c.fromAny(U||"0");T.isInfinite()?M=1/0:M=Number(T.toScientific(20))}catch{}G.setValue(M)}});e.appendChild(G.row),$t({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let M=0;try{let U=localStorage.getItem(v),T=c.fromAny(U||"0");T.isInfinite()?M=1/0:M=Number(T.toScientific(20))}catch{}G.setValue(M)}})}let w=Gs(n);if(w){let P=0;try{let M=localStorage.getItem(w);M==="Infinity"?P=1/0:P=c.fromAny(M||"0")}catch{P=c.fromInt(0)}let G=an("Surge Level",P,(M,{setValue:U})=>{let T="0",_=0;M instanceof c?M.isInfinite()?(T="Infinity",_=1/0):(T=M.toPlainIntegerString(),_=M):M===1/0||typeof M=="string"&&/infinity/i.test(M)?(T="Infinity",_=1/0):(T=String(M),_=M);try{localStorage.setItem(w,T),et();let Y=_===1/0?"Infinity":j(_),Q=P===1/0||P instanceof c&&P.isInfinite()?"Infinity":j(P);tt(`Modified Surge Level (The Cove) ${Q} \u2192 ${Y}`),_===1/0?P=1/0:_ instanceof c?P=_:P=c.fromAny(_);let ie=!1;P===1/0?ie=!0:P instanceof c?typeof P.cmp=="function"&&P.cmp(8)>=0&&(ie=!0):typeof P=="number"&&P>=8&&(ie=!0),ie&&(pi(0),pn()||Zo(!0))}catch{}U(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let Y=P;if(Y!==1/0&&Y instanceof c)try{Y=BigInt(Y.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:Y}}))}catch{}},{storageKey:w,onLockChange:M=>{let U=c.fromInt(0);try{let T=localStorage.getItem(w);T==="Infinity"?U=1/0:U=c.fromAny(T||"0")}catch{}G.setValue(U)}});$t({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let M=c.fromInt(0);try{let U=localStorage.getItem(w);U==="Infinity"?M=1/0:M=c.fromAny(U||"0")}catch{}G.setValue(M)}}),e.appendChild(G.row)}let L=jt(),C=an("Lab Level",L,(P,{setValue:G})=>{let M;try{M=P instanceof c?P:c.fromAny(P),M.isNegative&&M.isNegative()&&(M=c.fromInt(0))}catch{G(jt());return}let U=jt();ai(M),et(),Nt(U,M)||tt(`Modified Lab Level (The Cove) ${j(U)} \u2192 ${j(M)}`),G(M)},{storageKey:Sd(n)});$t({type:"lab-level",slot:n,refresh:()=>{n===b()&&C.setValue(jt())}}),e.appendChild(C.row);let A=()=>{let P=Mn(),G=Mo(),M=P+G;return M>1&&(M=1),M},q=an("Tsunami Exponent",A().toFixed(2),(P,{setValue:G})=>{let M=Number(P);if(P instanceof c?P.isInfinite()?M=1/0:M=Number(P.toScientific(10)):typeof P=="string"&&/infinity/i.test(P)&&(M=1/0),Number.isNaN(M)){G(A().toFixed(2));return}let U=Mo(),T=M-U;T>1&&(T=1),T<0&&(T=0),T=Math.round(T*100)/100;let _=Mn();pi(T),et(),Math.abs(_-T)>1e-4&&tt(`Modified Tsunami Exponent (The Cove) Base:${_.toFixed(2)} \u2192 ${T.toFixed(2)} (Effective: ${M.toFixed(2)})`),G(A().toFixed(2))},{storageKey:Dd(n),format:P=>{let G=Number(P);return Number.isFinite(G)?G.toFixed(2):String(P)}});$t({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let P=A();q.setValue(P.toFixed(2))}}),e.appendChild(q.row)}function Dm(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Ct(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=Tn(t.key,i.id??i.tie),u=Ci(t.key,i.id??i.tie,n),f=an(l,a,(d,{setValue:m})=>{if(b()==null)return;let p=Tn(t.key,i.id??i.tie);try{ir(t.key,i.id??i.tie,d,!1)}catch{}let h=Tn(t.key,i.id??i.tie);m(h),Nt(p,h)||(et(),tt(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${j(p)} \u2192 Lv${j(h)}`))},{idLabel:s,storageKey:u});$t({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=Tn(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function _1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=R?.[r.key]?.mult,l=Fl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${St.MULTIPLIER[r.key]}:${n}`,u=an(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let m=b();if(m==null)return;let y=Fl(r.key,m)??i?.get?.()??c.fromInt(1);try{ob(r.key,f,m)}catch{}Hl();let h=Fl(r.key,m)??i?.get?.()??c.fromInt(1);d(h),Nt(y,h)||(et(),tt(`Modified ${r.label} Multiplier (${o}) ${j(y)} \u2192 ${j(h)}`))},{storageKey:a});$t({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=Fl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function M1(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Re).forEach(o=>{let r=R?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Nt(i,t))return;r.set(t),n+=1}catch{}}),n}function C1(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Re).forEach(o=>{let r=R?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function T1(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=rt()}catch{}try{r=ht()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Nt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Nt(o?.progress,t);(!i||!s)&&(qr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Nt(r?.level,t),s=r?.progress?.isInfinite?.()||Nt(r?.progress,t);(!i||!s)&&(Gr({level:t,progress:t}),n+=1)}}catch{}try{let i=yi(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Gs(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{dt()}catch{}return n}function k1(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=rt()}catch{}try{r=ht()}catch{}try{o?.unlocked&&(qr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Gr({level:t,progress:t}),n+=1)}catch{}try{let i=yi(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Gs(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{dt()}catch{}return n}function ub(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!rt()?.unlocked}catch{return!1}},onEnable:()=>{try{Jr()}catch{}try{Qi({forceReload:!0})}catch{}},onDisable:()=>{try{es({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{ql(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{ql(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return bp()}catch{return!1}},onEnable:()=>{try{wi()}catch{}},onDisable:()=>{try{gu()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return Sp()}catch{return!1}},onEnable:()=>{try{hu()}catch{}},onDisable:()=>{try{yu()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return lp()}catch{return!1}},onEnable:()=>{try{Qc(!0)}catch{}},onDisable:()=>{try{Qc(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!pn()}catch{return!1}},onEnable:()=>{try{Zo(!0)}catch{}},onDisable:()=>{try{Zo(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return it(4)>=1}catch{return!1}},onEnable:()=>{try{zo(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{zo(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function fb(e){let t=b();if(t==null)return 0;let n=0;ub(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{dt()}catch{}return n}function A1(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;lf().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Mi(o.key,r,e),t+=1}catch{}})});try{wi()}catch{}try{hu()}catch{}let n=fb(!0);return{unlocks:t,toggles:n}}function N1(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;lf().forEach(o=>{Ct(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Nm(o.key,r,e),t+=1}catch{}})});try{gu()}catch{}try{yu()}catch{}let n=fb(!1);return{locks:t,toggles:n}}function R1(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(Ym(a,n)),r(i1(a,n))},s=a=>r(Pi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(ki.level(n)),r(ki.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(Ai.level(n)),r(Ai.progress(n)))};return e==="all"?(Object.values(Re).forEach(i),l("xp"),l("mutation"),sf.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Re).forEach(i),Array.from(o)):e==="allUnlockedStats"?(rt()?.unlocked&&l("xp"),ht()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Re).forEach(i),rt()?.unlocked&&l("xp"),ht()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function nf(e){try{R?.[e]?.set?.(c.fromInt(0))}catch{}try{s1(e)}catch{}try{cc(e,c.fromInt(1))}catch{}}function O1(e){if(e==="all"){Object.values(Re).forEach(i=>nf(i));let o=c.fromInt(0);return qr({level:o,progress:o}),Gr({level:o,progress:o}),sf.forEach(({key:i})=>{try{Un(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Re).length+sf.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Re).forEach(i=>{nf(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(rt()?.unlocked){qr({level:o,progress:o});try{Un("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(ht()?.unlocked){Gr({level:o,progress:o});try{Un("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Re).forEach(l=>{nf(l),o+=1});let r=c.fromInt(0),i=0;try{if(rt()?.unlocked){qr({level:r,progress:r});try{Un("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(ht()?.unlocked){Gr({level:r,progress:r});try{Un("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return nf(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{eb(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){qr({level:n,progress:n});try{Un("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Gr({level:n,progress:n});try{Un("mutation",c.fromInt(1))}catch{}return"MP"}try{Un(t,c.fromInt(1))}catch{}return`stat ${t}`}function P1(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";sf.forEach(r=>{if(r.key==="spawnRate")return;let i=Pi(r.key,n),s=an(`${r.label} Multiplier`,Dn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Dn(r.key,u);try{Un(r.key,l,u)}catch{}let d=Dn(r.key,u);a(d),Nt(f,d)||(et(),tt(`Modified ${r.label} Multiplier (${o}) ${j(f)} \u2192 ${j(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if(tb(a,r.key))return;try{Un(r.key,Oi(r.key),a)}catch{}}else uf(r.key,a,Oi(r.key));s.setValue(Dn(r.key,a))}}});$t({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Dn(r.key,n);s.setValue(l)}}),$t({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Dn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&$t({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Dn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function B1(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Dt||Dt.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Dt.forEach(n=>{let o=Fn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=Qa(t,n.id),s=an("Level",it(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let m=it(n.id);zo(n.id,d),et(),m!==d&&tt(`Modified Node ${n.id} Level (The Cove) ${m} \u2192 ${d}`),f(d)},{storageKey:i});$t({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(it(n.id))}}),r.appendChild(s.row);let l=el(t,n.id),a=an("Current RP",uo(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(uo(n.id));return}let m=uo(n.id);vs(n.id,d),et(),Nt(m,d)||tt(`Modified Node ${n.id} RP (The Cove) ${j(m)} \u2192 ${j(d)}`),f(d)},{storageKey:l});$t({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(uo(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function F1(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)},{label:"Pending DNA (Experiment)",inputs:[{key:"labLevel",label:"Lab Level"},{key:"xpLevel",label:"XP Level"},{key:"isSurge9",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 9? No"},{value:"Yes",label:"Surge 9? Yes"}]}],compute:({labLevel:n,xpLevel:o,isSurge9:r})=>window.resetSystem?.computePendingDnaFromInputs?.(n,o,r==="Yes")}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>bc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>ld(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Qm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>qs(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>Cr(n)},{label:"Lab Level RP Boost",inputs:[{key:"level",label:"Lab Level"},{key:"isSurge12",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 12? No"},{value:"Yes",label:"Surge 12? Yes"}]}],compute:({level:n,isSurge12:o})=>{let r=0;if(n instanceof c){if(n.isInfinite())return c.fromAny("Infinity");try{r=Number(n.toScientific(10))}catch{r=0}}else r=Number(n);if(!Number.isFinite(r))return c.fromInt(1);if(o==="Yes"){let s=Mt(),l=5*s,a=2+s/2,u=Math.log10(a),f=r*u+l;return ue(f)}let i=r*Math.log10(2);return ue(i)}}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>Rm(n,o,r)},{label:"Currency Generation Percentage",inputs:[{key:"tsunamiExp",label:"Tsunami Exponent"}],compute:({tsunamiExp:n})=>{let o=Number(n);if(n instanceof c&&(o=n.isInfinite()?1/0:Number(n.toScientific(10))),!Number.isFinite(o))return"\u2014";let r=o*1.5-.5,i=Math.pow(100,r);return Pe(i)+"%"}}]}].forEach(n=>{let o=Fn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=E1({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function U1(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}Hl(),lf().forEach(o=>{let r=Fn(o.title,i=>{let s=Fn("Currencies",p=>{x1(p,o)}),l=Fn("Stats",p=>{L1(p,o)}),a=Fn("Multipliers",p=>{let h=Fn("Currencies",v=>{_1(v,o)}),g=Fn("Stats",v=>{P1(v,o)});p.appendChild(h),p.appendChild(g)}),u=Fn("Upgrades",p=>{Dm(p,o)}),f=null,d=null,m=null;o.key===Ie.STARTER_COVE&&(f=Fn("Automation Upgrades",p=>{Dm(p,{key:Ie.AUTOMATION,title:"Automation"})}),d=Fn("DNA Upgrades",p=>{Dm(p,{key:Ie.DNA,title:"DNA"})}),m=Fn("Lab Nodes",p=>{B1(p)}));let y=Fn("Calculators",p=>{F1(p)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),m&&i.appendChild(m),i.appendChild(y)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function X0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ie),r=[];return o.forEach(i=>{Ct(i).forEach(l=>{e&&Ao(i,l.id).locked||r.push({areaKey:i,upg:l})})}),Nl(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;ir(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function V0(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Ie),r=[];o.forEach(s=>{Ct(s).forEach(a=>{e&&Ao(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{Nl(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Lr(s,l.id,"0"),ir(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function Y0(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Ct(Ze);Nl(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;ir(Ze,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(as),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Ie).forEach(l=>{if(l===Ze)return;Ct(l).forEach(u=>{s.has(u.costType)&&(Lr(l,u.id,n),o++)})}),Lr(Ze,co,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function D1(e){e.innerHTML="";let t=b();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=b1();et(),tt(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=S1();et(),tt(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=M1();et(),tt(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=T1();et(),tt(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=C1();et(),tt(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=k1();et(),tt(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let g=X0(!0);et(),tt(`Maxed ${g} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let g=V0(!0);et(),tt(`Reset ${g} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let g=X0(!1);et(),tt(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=V0(!1);et(),tt(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=Y0(!0);et(),tt(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=Y0(!1);et(),tt(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:v}=A1();et(),tt(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:v}=N1();et(),tt(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${v} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{sb([],t),Zm(),et(),tt("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=b();if(g!=null)try{localStorage.setItem(jx(g),String(Zx)),Jo(!0),et(),tt("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let v=jm(g);if(!v||typeof v.isZero=="function"&&v.isZero()||typeof v.isNegative=="function"&&v.isNegative())return;let w,L=!1;qt()?w=Ls(v):(w=Yc(v),L=!0),vi(w);let C=v.mulSmall?v.mulSmall(1e3):v.mulBigNumInteger(c.fromInt(1e3));Tr(w,C,L),et(),tt(`Performed OP Time Warp for ${j(v)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle debug-misc-button",v.textContent=g.label,v.addEventListener("click",g.onClick),o.appendChild(v)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",lf().forEach(g=>{let v=document.createElement("optgroup");v.label=g.title||g.key,g.currencies.forEach(w=>{let L=document.createElement("option");L.value=`currency:${w.key}`,L.textContent=`${g.title||g.key} \u2192 ${w.label}`,v.appendChild(L)}),g.stats.forEach(w=>{let L=document.createElement("option");L.value=`stat:${w.key}`,L.textContent=`${g.title||g.key} \u2192 ${w.label}`,v.appendChild(L)}),s.appendChild(v)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${ef}"]`)||(ef=Pl),s.value=ef;let d=()=>R1(s.value||Pl,b()),m=p1(d);s.addEventListener("change",()=>{ef=s.value||Pl,m.refresh()}),m.refresh(),r.appendChild(s),r.appendChild(m.button);let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle reset-check",y.textContent="\u2705",y.addEventListener("click",()=>{let g=s.value||Pl,v=d(),w=m.isLocked(),L=(C=!0)=>{let A=h1(v,()=>O1(g))??{label:g,count:0};if(w&&v.forEach(q=>Bi(q)),m.refresh(),et(),C){let{label:q,count:P}=A;tt(`Reset ${P===1?"value and multiplier":"values and multipliers"} for ${q} to defaults.`)}};L(!0),setTimeout(()=>L(!1),100)}),r.appendChild(y),e.appendChild(r);let p=document.createElement("div");p.className="debug-panel-row";let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle debug-danger-button",h.textContent="Wipe Slot & Refresh",h.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let v=document.querySelector(".menu-root"),w=document.getElementById("game-root");v&&(v.hidden=!1,v.style.display="",v.style.visibility=""),w&&(w.hidden=!0,w.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),p.appendChild(h),e.appendChild(p)}function $1(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{Qi()}catch{}let n=ub(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(I1(o))})}function db(){if(!Ri||Gl())return;Z0(),J0(),K0=0,j0=0;let e=document.getElementById(Dl);e&&e.remove();let t=document.createElement("div");t.id=Dl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Bo({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Bo()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let m=document.createElement("div");m.className="debug-panel-info-line",d&&m.classList.add("debug-panel-info-mobile-hidden"),m.textContent=f,a.appendChild(m)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(tf("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{U1(f)})),t.appendChild(tf("Unlocks: modify specific unlock flags","debug-unlocks",f=>{$1(f)})),t.appendChild(tf("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),na=d,Zm(),In(()=>{na=null})})),t.appendChild(tf("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{D1(f)})),e1(t),document.body.appendChild(t),rf>0)try{t.scrollTop=rf}catch{}t1(),Ni=!0}function Xm(){if(!(!Ri||Gl())){if(b()==null){Bo();return}Ni||db()}}function Bo({preserveExpansionState:e=!1}={}){z0=e?Qx():af();let t=document.getElementById(Dl);if(t){try{rf=t.scrollTop??0}catch{rf=0}t.remove()}Z0(),Ni=!1}function q1(){if(!Ri||Gl()||b()==null){Bo();return}Ni?Bo({preserveExpansionState:!0}):Xm()}function G1(){Bo(),Gm()}function ff(){if(!n1()){Gm(),Bo();return}J0(),Gm();let e=document.createElement("button");e.id=W0,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{q1()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function H1(e){if(Ri=!!e,!Ri){G1();return}ff()}function X1(e){H1(e)}var Qu,Dl,W0,Pl,Ni,Ri,$m,z0,rf,ef,K0,j0,Vm,na,$l,ra,of,Ul,Ti,ia,q0,oa,G0,zx,Kx,qm,jx,Zx,Fm,ki,Um,Ai,sf,H0,ns=De(()=>{Et();zt();It();zn();To();po();fo();vu();Ns();gs();Co();Cn();hs();ri();Zd();li();xr();Wc();Qu="debug-panel-style",Dl="debug-panel",W0="debug-panel-toggle",Pl=`currency:${Re.COINS}`,Ni=!1,Ri=!1,$m=[],z0=af(),rf=0,ef=Pl,K0=0,j0=0,Vm=[],na=null,$l=new Map,ra=new Map,of=new Set,Ul=new Map,Ti=new Map,ia=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=ia);q0=!1,oa=null,G0=null,zx="ccc:debug:stat-mult",Kx="ccc:actionLog",qm=100,jx=e=>`ccc:warp:charges:${e}`,Zx=24;Fm="ccc:xp",ki={unlock:e=>`${Fm}:unlocked:${e}`,level:e=>`${Fm}:level:${e}`,progress:e=>`${Fm}:progress:${e}`},Um="ccc:mutation",Ai={unlock:e=>`${Um}:unlocked:${e}`,level:e=>`${Um}:level:${e}`,progress:e=>`${Um}:progress:${e}`},sf=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];H0=!1;Hl();nb();document.addEventListener("keydown",e=>{if(!(!Ri||Gl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){Ni?(m1(),Bo()):Xm(),e.preventDefault();return}Ni?Bo({preserveExpansionState:!0}):Xm(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{ff()});window.addEventListener("menu:visibilitychange",o1);window.addEventListener("saveSlot:change",()=>{ff(),Ni&&db()})});var yb={};vt(yb,{addExternalMutationGainMultiplierProvider:()=>fi,addMutationPower:()=>Ms,broadcastMutationChange:()=>Jm,computeMutationMultiplierForLevel:()=>qs,computeMutationRequirementForLevel:()=>Qm,getMutationCoinSprite:()=>pm,getMutationGainMultiplier:()=>pf,getMutationMultiplier:()=>df,getMutationState:()=>ht,getTotalCumulativeMp:()=>mi,initMutationSystem:()=>Qt,isMutationUnlocked:()=>Ro,onMutationChange:()=>_i,setMutationUnlockedForDebug:()=>ql,unlockMutationSystem:()=>Br});function mf(e){try{return e?.toStorage?.()}catch{return null}}function $i(){try{nn()}catch{}}function gb(e){let t=e;if(!t.isZero?.()){let n=Di.size>0?Array.from(Di):typeof Yl=="function"?[Yl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof Qe?t=r.clone?.()??r:r!=null&&(t=Qe.fromAny(r))}catch{}}return t}function W1(){if(typeof eh=="function"){try{eh()}catch{}eh=null}if(typeof th=="function"){try{th()}catch{}th=null}}function Wl(e){if(e instanceof Qe)try{return e.clone?.()??Qe.fromAny(e)}catch{return yt()}try{return Qe.fromAny(e??0)}catch{return yt()}}function z1(e){if(!e||typeof e!="object")return yt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?Qe.fromInt(100):Qe.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function gf(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ee(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function lh(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let m=Math.pow(1.12,l-10);if(!Number.isFinite(m)||(f+=Y1*(m-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=gf(e);if(!Number.isFinite(n))return Qe.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return Qe.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return Qe.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return Qe.fromAny("Infinity");let i=ue(r);return z1(i)}function Hr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=lh(D.level);D.requirement=n}function K1(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=Ee(e),l=Ee(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function ih(){return $n.container&&$n.container.isConnected?!0:($n.container=document.querySelector("[data-mp-hud].mp-counter"),$n.container?($n.bar=$n.container.querySelector(".mp-bar"),$n.fill=$n.container.querySelector(".mp-bar__fill"),$n.levelValue=$n.container.querySelector(".mp-level-value"),$n.progress=$n.container.querySelector("[data-mp-progress]"),!0):!1)}function Fi(e){try{return j(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function fr(){if(!ih())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=$n;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Fi(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Fi(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Ki();return}e.removeAttribute("hidden");let i=D.requirement,s=K1(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Fi(D.level)),r){let a=Fi(D.progress),u=Fi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Fi(D.progress).replace(/<[^>]*>/g,""),u=Fi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Ki()}function dr(e="update",t={}){let n=ht(),o={...n,slot:D.slot??b(),changeType:e,...t};if(rh.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function ch(){let e=D.slot;if(e==null&&(e=b(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(Xl(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Ui(e),D.level.toStorage())}catch{}try{localStorage.setItem(aa(e),D.progress.toStorage())}catch{}ct(Xl(e)),ct(Ui(e)),ct(aa(e));let t=(()=>{let u=D.unlocked,f=D.level,d=D.progress;try{u=localStorage.getItem(Xl(e))==="1"}catch{}try{let m=localStorage.getItem(Ui(e));m&&(f=Qe.fromAny(m))}catch{}try{let m=localStorage.getItem(aa(e));m&&(d=Qe.fromAny(m))}catch{}return{unlocked:u,level:f,progress:d}})(),n=mf(t.level),o=mf(t.progress),r=mf(D.level),i=mf(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&hf(t,{skipPersist:!0})}function sh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function j1(){if(!D.unlocked)return;let e=D.slot??b();if(e!=null&&sh(Ui(e))){Hr();return}Hr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(la()),Hr(),t=D.requirement,!t||typeof t!="object"){D.progress=yt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=yt())}function hf(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=Wl(e.level),D.progress=Wl(e.progress),D.unlocked||(D.level=yt(),D.progress=yt()),Hr(),t||ch(),fr(),dr("load"),$i()}function nh(e){let t=e??b();if(t==null){hf({unlocked:!1,level:yt(),progress:yt()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=yt(),r=yt();try{n=localStorage.getItem(Xl(t))==="1"}catch{}try{let i=localStorage.getItem(Ui(t));i&&(o=Qe.fromAny(i))}catch{}try{let i=localStorage.getItem(aa(t));i&&(r=Qe.fromAny(i))}catch{}hf({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function Z1(){for(;Vl.length;){let e=Vl.pop();try{e?.()}catch{}}}function oh(e){mb!==e&&(Z1(),mb=e,e!=null&&(Vl.push(kt(Xl(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=yt(),D.progress=yt()),Hr(),fr(),dr("storage"),$i())}})),Vl.push(kt(Ui(e),{onChange(t){if(t)try{let n=Qe.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Hr(),fr(),dr("storage"),$i())}catch{}}})),Vl.push(kt(aa(e),{onChange(t){if(t)try{let n=Qe.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Hr(),fr(),dr("storage"))}catch{}}}))))}function Qt({forceReload:e=!1}={}){if(W1(),hb){let n=b();return(n!==D.slot||e)&&nh(n),oh(n),ih(),fr(),ht()}hb=!0,ih();let t=b();return D.slot=t,nh(t),oh(t),fr(),$i(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();D.slot=n,nh(n),oh(n),fr(),$i(),dr("slot")}),ht()}function ht(){return{unlocked:D.unlocked,level:Wl(D.level),progress:Wl(D.progress),requirement:Wl(D.requirement)}}function Ro(){return!!D.unlocked}function Br(){return Qt(),D.unlocked?!1:(D.unlocked=!0,Hr(),ch(),fr(),dr("unlock"),$i(),!0)}function ql(e){Qt();let t=!!e;hf({unlocked:t,level:t?D.level:yt(),progress:t?D.progress:yt()})}function Ms(e){Qt();let t=D.slot??b();if(t!=null&&sh(aa(t))||!D.unlocked)return ht();let n=t!=null&&sh(Ui(t));if(D.level&&D.level.isInfinite?.()){let f=D.level.clone?.()??D.level,d=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=Qe.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=Qe.fromAny("Infinity")}catch{}let m;try{m=e instanceof Qe?e:Qe.fromAny(e??0)}catch{m=yt()}return m=gb(m),m=Kn("mutation",m),dr("progress",{delta:m.clone?.()??m,levelsGained:yt(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof Qe?e:Qe.fromAny(e??0)}catch{o=yt()}if(o=gb(o),o=Kn("mutation",o),o.isZero?.())return ht();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=Qe.fromAny("Infinity")}catch{}try{D.progress=Qe.fromAny("Infinity")}catch{D.progress=yt()}try{D.requirement=Qe.fromAny("Infinity")}catch{}}else j1();ch(),fr();let a=D.level.sub(i);return a.isZero?.()||$i(),dr("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function Jm(e={}){Qt();let t=e.changeType??"manual";return dr(t,e)}function qs(e){let t;if(e instanceof Qe)try{t=e.clone?.()??e}catch{t=yt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=yt()}else try{t=c.fromAny(e??0)}catch{t=yt()}if(t&&t.isInfinite?.())try{return Qe.fromAny("Infinity")}catch{return la()}let n=gf(t);if(!Number.isFinite(n))try{return Qe.fromAny("Infinity")}catch{return la()}if(n<=0)return la();let o=n*V1;return ue(o)}function Qm(e){let t;try{t=e instanceof Qe?e:Qe.fromAny(e??0)}catch{t=yt()}try{return lh(t)}catch{return yt()}}function df(){if(Qt(),!D.unlocked)return la();try{return qs(D.level)}catch{return la()}}function pf(){let e=c.fromInt(1);if(Di.size>0||Yl){let t=Di.size>0?Array.from(Di):typeof Yl=="function"?[Yl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof Qe?e=o.clone?.()??o:o!=null&&(e=Qe.fromAny(o))}catch{}}return e}function pm(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=gf(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function _i(e){return typeof e!="function"?()=>{}:(rh.add(e),()=>{rh.delete(e)})}function fi(e){return typeof e!="function"?()=>{}:(Di.add(e),()=>{Di.delete(e)})}function mi(){if(Qt(),!D.unlocked)return yt();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=gf(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=lh(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var ah,Xl,Ui,aa,Qe,yt,la,V1,Y1,D,$n,rh,Vl,mb,hb,eh,th,Di,Yl,To=De(()=>{Et();It();ns();zt();Et();Zf();zn();ah="ccc:mutation",Xl=e=>`${ah}:unlocked:${e}`,Ui=e=>`${ah}:level:${e}`,aa=e=>`${ah}:progress:${e}`,Qe=c,yt=()=>Qe.fromInt(0),la=()=>Qe.fromInt(1),V1=Math.log10(2),Y1=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:yt(),progress:yt(),requirement:yt(),slot:null},$n={container:null,bar:null,fill:null,levelValue:null,progress:null},rh=new Set,Vl=[],mb=null,hb=!1,eh=null,th=null,Di=new Set,Yl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Qt,unlockMutationSystem:Br,addMutationPower:Ms,getMutationState:ht,getMutationMultiplier:df,isMutationUnlocked:Ro,getTotalCumulativeMp:mi,addExternalMutationGainMultiplierProvider:fi,getMutationGainMultiplier:pf}))});var zl,vb,bb,uh,fh,dh,Sb=De(()=>{zl=`precision highp float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,vb=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\n\nvoid main() {\n    /* Wave animation settings */\n    float speed = 1.2;\n    float time = uTime * speed;\n    \n    /* Combine sine waves for a more natural look */\n    /* vUv.x is 0..1 across the screen width */\n    float wave1 = sin(vUv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n\n    /* Define the shoreline height (baseline) */\n    /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */\n    /* We want to discard pixels below this threshold */\n    float threshold = 0.428 + wave; \n\n    if (threshold > vUv.y) {\n        discard;\n    }\n\n    /* Recalculate gradient based on the new "bottom" */\n    /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */\n    float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0);\n    \n    vec3 col = mix(uColorShallow, uColorDeep, gradientY);\n    \n    /* Add a subtle "foam" or highlight at the edge */\n    float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold);\n    col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4);\n    \n    gl_FragColor = vec4(col, 1.0);\n}`,bb=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uWaveMap; \nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\nuniform vec3 uColorWaveDeep;  \nuniform vec3 uColorWave;      \n\n/* Simple noise for foam breakup */\nfloat hash(vec2 p) {\n    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\n}\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f*f*(3.0-2.0*f);\n    return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),\n               mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y);\n}\n\nvoid main() {\n    vec2 uv = vUv;\n    \n    /* Sample the simulation (physics) */\n    /* Wave Logic */\n    vec2 waveUV = uv - vec2(0.0, 0.0285);\n    float intensity = texture2D(uWaveMap, waveUV).r;\n    \n    /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */\n    float shadowOffset = 8.0 / uResolution.y; \n    float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r;\n    \n    /* Discard only if BOTH are empty */\n    if (0.01 > intensity && 0.01 > shadowIntensity) discard;\n    \n    /* Directional Noise: Streaky vertical noise for rushing water effect */\n    /* Stretch heavily along Y-axis to simulate speed/motion blur */\n    float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0));\n    \n    /* Define Zones based on Intensity */\n    /* Body (Medium Intensity): Darker/turbulent blue with noise */\n    /* Edge (High Intensity): Bright white foam */\n    \n    float foamThreshold = 0.5;\n    float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity);\n    \n    /* Base Colors */\n    vec3 bodyColor = uColorWaveDeep;\n    vec3 foamColor = uColorWave;\n    \n    /* Mix Colors */\n    vec3 finalColor = mix(bodyColor, foamColor, foamMix);\n    \n    /* Add streaks to the body part */\n    if (0.9 > foamMix) {\n        finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix);\n    }\n    \n    /* Hard Edge & Opacity */\n    /* Ensure the front (bottom) remains sharp, back trails off */\n    \n    /* Calculate Alpha based on Intensity */\n    /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */\n    /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */\n    /* Low Intensity (Top/Tail): Fades to 0.0 */\n    \n    float finalAlpha = smoothstep(0.02, 0.15, intensity);\n    \n    /* Screen Fade */\n    /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */\n    \n    /* Dynamic Shoreline Fade */\n    /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */\n    /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */\n    float speed = 1.2;\n    float time = uTime * speed;\n    float wave1 = sin(uv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n    float threshold = 0.428 + wave;\n    \n    /* Fade out quickly after exiting the water body (below threshold) */\n    /* Fade starts slightly higher than the threshold to soften the transition */\n    /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */\n    float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y);\n    \n    float screenFade = shoreFade;\n    \n    /* --- Composite Shadow & Wave --- */\n    float waveAlpha = finalAlpha * screenFade;\n    \n    /* Shadow Alpha */\n    float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity);\n    /* Shadow is weaker (40% opacity) */\n    float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade;\n    \n    /* Mix: Wave over Shadow */\n    /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */\n    float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha);\n    \n    /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */\n    /* Shadow is black (RGB=0), so second term is 0 */\n    vec3 outRGB = finalColor * waveAlpha; \n    \n    gl_FragColor = vec4(outRGB, outAlpha);\n}`,uh=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,fh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,dh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var Eb={};vt(Eb,{WaterSystem:()=>yf,waterSystem:()=>vf});function wb(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function ca(e,t,n){let o=wb(e,e.VERTEX_SHADER,t),r=wb(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var J1,Ib,Q1,eL,yf,vf,ph=De(()=>{Sb();J1=[.2,.5,.9],Ib=[.2,.9,1],Q1=[1,1,1],eL=[.45,.8,1];yf=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:ca(s,zl,bb),simProgram:ca(s,zl,dh),brushProgram:ca(s,uh,fh),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=ca(this.glBg,zl,vb),this.bgSimProgram=ca(this.glBg,zl,dh),this.bgBrushProgram=ca(this.glBg,uh,fh)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,m=a/this.height,y=new Float32Array([u-d,f-m,0,0,1,u+d,f-m,1,0,1,u-d,f+m,0,1,1,u+d,f+m,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,y,t.DYNAMIC_DRAW);let p=t.getAttribLocation(n,"aPosition"),h=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(p),t.vertexAttribPointer(p,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let m=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=m.readFBO,f.writeFBO=m.writeFBO,f.readTexture=m.readTex,f.writeTexture=m.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),J1),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),Ib),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),Ib),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),Q1),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),eL),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let m=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(m),d.vertexAttribPointer(m,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},vf=new yf});var Tb={};vt(Tb,{createSpawner:()=>lL});function Cb(e){if(!e||typeof e!="object"){ua=!1,qi=0n;return}ua=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;qi=n&&n!=="Infinity"?BigInt(n):0n}catch{qi=0n}}function nL(e){let t=1-e;return 1-t*t*t}function rL(e){if(!e)return null;let t=xb.get(e);return t||(t=new Image,t.src=e,xb.set(e,t)),t}function lL({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=Je?tL:1e4,initialBurst:d=1,coinTtlMs:m=1e99,waveSoundSrc:y="sounds/wave_spawn.ogg",waveSoundDesktopVolume:p=.45,waveSoundMobileVolume:h=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:v=!1}={}){let w=o,L={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function C(){return!!(L.pf&&L.w&&L.c)}C()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let A=7,q=[],P=[],G=!1;if(L.c)for(let I=0;I<A;I++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+I*10}`,L.c.appendChild(k);let O=k.getContext("2d",{alpha:!0});q.push(k),P.push(O)}let M=null,U=null;L.c&&(M=document.createElement("canvas"),M.style.position="absolute",M.style.inset="0",M.style.pointerEvents="none",M.style.zIndex="100",L.c.appendChild(M),U=M.getContext("2d",{alpha:!0}));let T={collectBatch:null,getMagnetUnit:null};function _(I){T={...T,...I}}let Y={pfRect:null,wRect:null,safeBottom:0,pfW:0};function Q(){if(!C())return!1;let I=L.pf.getBoundingClientRect(),k=L.w.getBoundingClientRect(),O=L.hud?L.hud.getBoundingClientRect().height:0;Y={pfRect:I,wRect:k,safeBottom:I.height-O,pfW:I.width};let N=window.devicePixelRatio||1;return q.forEach((B,de)=>{if(B){B.width=I.width*N,B.height=I.height*N,B.style.width=I.width+"px",B.style.height=I.height+"px";let pe=P[de];pe&&(pe.setTransform(1,0,0,1,0,0),pe.scale(N,N),pe.imageSmoothingEnabled=!0,pe.imageSmoothingQuality="high")}}),G=!0,M&&(M.width=I.width*N,M.height=I.height*N,M.style.width=I.width+"px",M.style.height=I.height+"px",U&&(U.setTransform(1,0,0,1,0,0),U.scale(N,N))),!0}Q();let ie="ResizeObserver"in window?new ResizeObserver(()=>Q()):null;ie&&L.pf&&ie.observe(L.pf),document.addEventListener("visibilitychange",()=>{document.hidden||Q()});let me=(I,k,O)=>Math.max(k,Math.min(O,I)),ve=Math.max(2e3,f*3),Oe=12,Te=[],F=[],W=0,$=[],H=[];function J(){let I=document.createElement("div");I.className="coin",I.style.position="absolute",I.style.pointerEvents="auto",I.style.borderRadius="50%",I.style.willChange="transform",I.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=w,k.style.objectFit="contain",k.style.borderRadius="50%",I.appendChild(k),v&&(I.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),I}let se=()=>Te.length?Te.pop():J();function ce(I){I.style.transition="",I.style.transform="",I.style.opacity="1",I.classList.remove("coin--collected");for(let k=0;k<=6;k++)I.classList.remove(`coin--size-${k}`);I.style.removeProperty("--ccc-start"),delete I.dataset.dieAt,delete I.dataset.mutationLevel,delete I.dataset.collected,I.style.willChange="transform",I.parentNode&&I.remove(),Te.length<ve&&Te.push(I)}function x(I,k=-1){if(I.isRemoved)return;I.isRemoved=!0;let O=k;(O===-1||F[O]!==I)&&(I.index!==void 0&&F[I.index]===I?O=I.index:O=F.indexOf(I)),O!==-1&&(F[O]=null,W++),I.el?(ce(I.el),I.el=null):H.push({layer:I.sizeIndex||0,x:I.x,y:I.y,size:I.size||r})}function X(I){let k=I._coinObj;if(k){let O=-1;k.index!==void 0&&F[k.index]===k?O=k.index:O=F.indexOf(k),O!==-1&&(F[O]=null,W++),I._coinObj=null}}let K=new URL(y,document.baseURI).href,fe=0;function ee(){let I=performance.now();if(I-fe<g)return;fe=I,ft(K,{volume:Je?h:p,type:"music"})}function re(){if(!C())return null;if((!Y.pfRect||!Y.wRect)&&Q(),f!==1/0&&F.length-W>=f){let Lt=-1;if(Me(2))for(let Pt=0;Pt<F.length;Pt++){let wo=F[Pt];if(wo&&wo.sizeIndex<4){Lt=Pt;break}}else for(let Pt=0;Pt<F.length;Pt++)if(F[Pt]){Lt=Pt;break}if(Lt===-1)return null;let Ot=F[Lt];Ot&&x(Ot,Lt)}let I=Y.pfW,k=Y.wRect.top-Y.pfRect.top,O=Math.max(0,k),N=0;if(Me(2)){let Lt=Math.random();for(let Ot=6;Ot>=1;Ot--)if(Lt<sL[Ot]){N=Ot;break}}N>=4&&Ml&&Ml()&&(N=3);let B=Lb[N],de=Oe+(N>=3?15*(N-2):0),pe=de,we=Math.max(pe,I-B-de),_e=pe+Math.random()*(we-pe),Ke=Math.random()*100-50,He;if(B>=Y.pfW)He=(Y.pfW-B)/2;else{let Lt=Y.pfW-B-de;pe>=Lt?He=(Y.pfW-B)/2:He=me(_e+Ke,pe,Lt)}let $e=Math.min(Y.wRect.height,Y.pfRect.height*.3),Ce=Math.max($e+80,120),Ne=Math.max(Ce+40,Y.safeBottom-B-6),Se=me(Ce+Math.random()*(Ne-Ce),Ce,Ne),Ye={x0:_e,y0:O,x1:He,y1:Se,jitterMs:0},ot=Y.pfRect.left-Y.wRect.left,Xe=aL[N],Rt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),lt=.85+Math.random()*.3,wt=Rt*(Xe.w/100)*lt,Vt=Rt*(Xe.h/100)*lt,Yt=_e+B/2+ot,Gn=O-k;return{wave:{x:Yt,y:Gn,width:wt,height:Vt},coin:Ye,sizeIndex:N}}function he(I){if(!I.length||!C())return;let k=document.createDocumentFragment(),O=[],N=performance.now(),B=!1;for(let{wave:de,coin:pe,sizeIndex:we}of I){if(de&&(B=!0,vf)){let Ne=we>=4;vf.addWave(de.x,de.y,de.width,de.height,Ne)}let _e=Lb[we],Ke=1;if(Me(8)){let Ne=Mn();we>=4&&(Ne=1);let Se=Math.pow(25,Ne);Ke=Math.pow(Se,we)}else Ke=iL[we];let He=we>=4,$e=se();$e.style.width=`${_e}px`,$e.style.height=`${_e}px`,$e.className=`coin coin--size-${we}`,$e.firstChild&&($e.firstChild.src=w),$e.style.transform=`translate3d(${pe.x0}px, ${pe.y0}px, 0) rotate(-10deg) scale(0.96)`,$e.style.opacity="0",ua?$e.dataset.mutationLevel=qi.toString():$e.dataset.mutationLevel="0";let Ce={mutationLevel:ua?qi.toString():"0",el:$e,src:w,x:pe.x0,y:pe.y0,rot:-10,scale:.96,startX:pe.x0,startY:pe.y0,endX:pe.x1,endY:pe.y1,startTime:N+pe.jitterMs,duration:i,dieAt:N+m,jitterMs:pe.jitterMs,isRemoved:!1,settled:!1,size:_e,sizeIndex:we,valueMultiplier:Ke,forceDom:He,soundSrc:Mb[we]?`sounds/coin_pickup${Mb[we]}`:null,bMinX:Math.min(pe.x0,pe.x1)-_e,bMaxX:Math.max(pe.x0,pe.x1)+_e,bMinY:Math.min(pe.y0,pe.y1)-_e,bMaxY:Math.max(pe.y0,pe.y1)+_e};$e._coinObj=Ce,Ce.index=F.length,F.push(Ce),O.push(Ce),k.appendChild($e)}L.c.appendChild(k),O.length>0&&(O[0].el&&O[0].el.offsetHeight,requestAnimationFrame(()=>{for(let de of O)de.el&&(de.el.style.transition=`transform ${i}ms ${oL} ${de.jitterMs}ms`,de.el.style.transform=`translate3d(${de.endX}px, ${de.endY}px, 0) rotate(0deg) scale(1)`,de.el.style.opacity="1")})),B&&requestAnimationFrame(()=>{ee()})}function Be(I=1){if(!C())return;(!Y.pfRect||!Y.wRect)&&Q();let k=[];for(let O=0;O<I;O++){let N=re();N&&k.push(N)}k.length&&he(k)}function ne(I,k){if(I.settled||I.isRemoved)return{x:I.x,y:I.y,rot:0,scale:1};let O=k-I.startTime;if(O<0)return{x:I.startX,y:I.startY,rot:-10,scale:.96};let N=O/I.duration;if(N>=1)return{x:I.endX,y:I.endY,rot:0,scale:1};let B=nL(N),de=I.startX+(I.endX-I.startX)*B,pe=I.startY+(I.endY-I.startY)*B,we=-10+10*B,_e=.96+.04*B;return{x:de,y:pe,rot:we,scale:_e}}function ye(I,k){let O=rL(k.src);if(O&&O.complete&&O.naturalWidth>0){let N=k.size||r;I.drawImage(O,k.x,k.y,N,N)}}function Ue(){if(P.length)if(G){P.forEach((k,O)=>{q[O]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,q[O].width,q[O].height),k.restore(),v&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let I=F.length;for(let k=0;k<I;k++){let O=F[k];if(O&&O&&O.settled&&!O.isRemoved&&!O.el){let N=O.sizeIndex||0;P[N]&&ye(P[N],O)}}v&&P.forEach(k=>k.restore()),G=!1,$.length=0,H.length=0}else{if(H.length>0){v&&P.forEach(k=>{k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2});let I=F.length;for(let k=0;k<H.length;k++){let O=H[k],N=P[O.layer];if(!N)continue;let B=8,de=O.x-B,pe=O.y-B,we=O.size+B*2;N.save(),N.beginPath(),N.rect(de,pe,we,we),N.clip(),N.clearRect(de,pe,we,we);let _e=de,Ke=de+we,He=pe,$e=pe+we;for(let Ce=0;Ce<I;Ce++){let Ne=F[Ce];if(!Ne||!Ne.settled||Ne.isRemoved||Ne.el||(Ne.sizeIndex||0)!==O.layer)continue;let Se=Ne.size||r,je=Ne.x,Ye=Ne.x+Se,ot=Ne.y,Xe=Ne.y+Se;Ye>_e&&je<Ke&&Xe>He&&ot<$e&&ye(N,Ne)}N.restore()}v&&P.forEach(k=>k.restore()),H.length=0}if($.length>0){v&&P.forEach(I=>{I.save(),I.shadowColor="rgba(0,0,0,0.35)",I.shadowBlur=2,I.shadowOffsetY=2});for(let I=0;I<$.length;I++){let k=$[I];if(!k.isRemoved&&k.settled&&!k.el){let O=k.sizeIndex||0;P[O]&&ye(P[O],k)}}v&&P.forEach(I=>I.restore()),$.length=0}}}let ke=a,Fe=null,ae=performance.now(),te=0;function xe(I){(!Y.pfRect||!Y.wRect)&&Q();let k=(I-ae)/1e3;ae=I,k>.1&&(k=.1);for(let N=F.length-1;N>=0;N--){let B=F[N];if(!B||!B)continue;if(I>=B.dieAt){x(B,N);continue}if(B.sizeIndex===5&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=I-1e3,B.nextLightningInterval=0),I-B.lastLightningTime>B.nextLightningInterval)){B.lastLightningTime=I,B.nextLightningInterval=200+Math.random()*100;for(let we=0;we<3;we++)$o(B,I)}if(B.sizeIndex===6&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=I-1e3,B.nextLightningInterval=0),I-B.lastLightningTime>B.nextLightningInterval&&(B.lastLightningTime=I,B.nextLightningInterval=200+Math.random()*100,T.collectBatch))){let we=ne(B,I),_e=we.x+B.size/2,Ke=we.y+B.size/2,He=[],$e=B.size/2*(B.size/2),Ce=F.length;for(let Ne=0;Ne<Ce;Ne++){let Se=F[Ne];if(!Se||Se===B||Se.isRemoved||Se.settled===!1||Se.sizeIndex>3)continue;let je=Se.x+(Se.size||r)/2,Ye=Se.y+(Se.size||r)/2,ot=je-_e,Xe=Ye-Ke;ot*ot+Xe*Xe>$e&&He.push(Se)}if(He.length>0){for(let Ye=He.length-1;Ye>0;Ye--){let ot=Math.floor(Math.random()*(Ye+1));[He[Ye],He[ot]]=[He[ot],He[Ye]]}let Ne=He.slice(0,3),Se=[],je=!1;for(let Ye of Ne){let ot=Ye.size||r,Xe=Ye.x+ot/2,Rt=Ye.y+ot/2;pr(B,Xe,Rt),Do(Xe,Rt,ot),Se.push({coin:Ye}),je||(ft("sounds/lightning_strike.ogg",{volume:.25}),je=!0)}Se.length>0&&T.collectBatch(Se)}}if(B.settled)continue;let de=I-B.startTime;if(de<0)continue;if(de/B.duration>=1){B.settled=!0,B.x=B.endX,B.y=B.endY,B.rot=0,B.scale=1,B.el&&!B.forceDom?(ce(B.el),B.el=null,$.push(B)):B.el&&(B.el.style.transition="none",B.el.style.transform=`translate3d(${B.x}px, ${B.y}px, 0) rotate(0deg) scale(1)`);continue}}te+=ke*k;let O=Math.floor(te);if(O>0){te-=O;let N=Math.min(O,u);if(N>0){let B=performance.now(),de=[],pe=5;for(let we=0;we<N&&!(performance.now()-B>pe);we++){let _e=re();_e&&de.push(_e)}de.length&&he(de)}}if(Ue(),W>50){let N=0;for(let B=0;B<F.length;B++){let de=F[B];de!==null&&(de.index=N,F[N++]=de)}F.length=N,W=0}Ae(k),Fe=requestAnimationFrame(xe)}function E(){if(!Fe){if(!C()){console.warn("[Spawner] start() called but required nodes are missing.");return}Q(),d>0&&Fe===null&&Be(d),ae=performance.now(),Fe=requestAnimationFrame(xe)}}function z(){Fe&&(cancelAnimationFrame(Fe),Fe=null)}function Z(I){ke=Math.max(0,Number(I)||0)}function oe(){te=0,ae=performance.now()}function ge(I){let k=Me(2)&&!!I;for(let O=F.length-1;O>=0;O--){let N=F[O];if(N&&N){if(k&&N.sizeIndex>=4){N.mutationLevel=ua?qi.toString():"0",N.el&&(N.el.dataset.mutationLevel=N.mutationLevel);continue}x(F[O],O)}}oe()}function le(I){I&&(w=I)}function We(I){let k=I._coinObj;if(!k)return I.style.transform||"translate3d(0,0,0)";let{x:O,y:N,rot:B,scale:de}=ne(k,performance.now());return`translate3d(${O}px, ${N}px, 0) rotate(${B}deg) scale(${de})`}function nt(I){if(I.el)return I.el;if(I.isRemoved)return null;let k=se(),O=I.size||r;return k.style.width=`${O}px`,k.style.height=`${O}px`,k.className=`coin coin--size-${I.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${I.x}px, ${I.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=I.src),k.style.opacity="1",k.dataset.mutationLevel=I.mutationLevel,k._coinObj=I,I.el=k,L.c.appendChild(k),H.push({layer:I.sizeIndex||0,x:I.x,y:I.y,size:I.size||r}),k}function be(I,k,O,N){let B=O;N&&(B=Math.max(O,260));let de=O*O,pe=[],we=F.length,_e=I-B,Ke=I+B,He=k-B,$e=k+B,Ce=performance.now();for(let Ne=0;Ne<we;Ne++){let Se=F[Ne];if(!Se||Se.bMaxX<_e||Se.bMinX>Ke||Se.bMaxY<He||Se.bMinY>$e)continue;let je=Se.size||r,Ye,ot;if(Se.settled)Ye=Se.x+je/2,ot=Se.y+je/2;else{let wt=ne(Se,Ce);Ye=wt.x+je/2,ot=wt.y+je/2}if(Ye<_e||Ye>Ke||ot<He||ot>$e)continue;let Xe=Ye-I,Rt=ot-k,lt=de;if(N&&(Se.sizeIndex||0)>0){let wt=je/2;lt=wt*wt}Xe*Xe+Rt*Rt<=lt&&(Se.isRemoved||pe.push(Se))}return pe}function Ge(I,k,O,N,B,de){let pe=B;de&&(pe=Math.max(B,260));let we=B*B,_e=[],Ke=F.length,He=Math.min(I,O)-pe,$e=Math.max(I,O)+pe,Ce=Math.min(k,N)-pe,Ne=Math.max(k,N)+pe,Se=O-I,je=N-k,Ye=Se*Se+je*je,ot=we*Ye,Xe=performance.now();for(let Rt=0;Rt<Ke;Rt++){let lt=F[Rt];if(!lt||lt.bMaxX<He||lt.bMinX>$e||lt.bMaxY<Ce||lt.bMinY>Ne)continue;let wt=lt.size||r,Vt,Yt;if(lt.settled)Vt=lt.x+wt/2,Yt=lt.y+wt/2;else{let un=ne(lt,Xe);Vt=un.x+wt/2,Yt=un.y+wt/2}if(Vt<He||Vt>$e||Yt<Ce||Yt>Ne)continue;let Gn=Vt-I,Lt=Yt-k,Ot=Gn*Se+Lt*je,Pt=we;if(de&&(lt.sizeIndex||0)>0){let un=wt/2;Pt=un*un}let wo=!1;if(Ot<=0)Gn*Gn+Lt*Lt<=Pt&&(wo=!0);else if(Ot>=Ye){let un=Vt-O,Sa=Yt-N;un*un+Sa*Sa<=Pt&&(wo=!0)}else{let un=Gn*je-Lt*Se;un*un<=Pt*Ye&&(wo=!0)}wo&&!lt.isRemoved&&_e.push(lt)}return _e}function Xt(I){x(I)}function pt(I,k,O){let N=O*O,B=[],de=F.length,pe=I-O,we=I+O,_e=k-O,Ke=k+O,He=performance.now();for(let $e=0;$e<de;$e++){let Ce=F[$e];if(!Ce||Ce.bMaxX<pe||Ce.bMinX>we||Ce.bMaxY<_e||Ce.bMinY>Ke)continue;let Ne=Ce.size||r,Se,je;if(Ce.settled)Se=Ce.x+Ne/2,je=Ce.y+Ne/2;else{let Xe=ne(Ce,He);Se=Xe.x+Ne/2,je=Xe.y+Ne/2}if(Se<pe||Se>we||je<_e||je>Ke)continue;let Ye=Se-I,ot=je-k;Ye*Ye+ot*ot<=N&&(!Ce.el&&!Ce.isRemoved&&nt(Ce),Ce.el&&B.push(Ce.el))}return B}function cn(I,k,O,N,B){let de=B*B,pe=[],we=F.length,_e=Math.min(I,O)-B,Ke=Math.max(I,O)+B,He=Math.min(k,N)-B,$e=Math.max(k,N)+B,Ce=O-I,Ne=N-k,Se=Ce*Ce+Ne*Ne,je=de*Se,Ye=performance.now();for(let ot=0;ot<we;ot++){let Xe=F[ot];if(!Xe||Xe.bMaxX<_e||Xe.bMinX>Ke||Xe.bMaxY<He||Xe.bMinY>$e)continue;let Rt=Xe.size||r,lt,wt;if(Xe.settled)lt=Xe.x+Rt/2,wt=Xe.y+Rt/2;else{let Ot=ne(Xe,Ye);lt=Ot.x+Rt/2,wt=Ot.y+Rt/2}if(lt<_e||lt>Ke||wt<He||wt>$e)continue;let Vt=lt-I,Yt=wt-k,Gn=Vt*Ce+Yt*Ne,Lt=!1;if(Gn<=0)Vt*Vt+Yt*Yt<=de&&(Lt=!0);else if(Gn>=Se){let Ot=lt-O,Pt=wt-N;Ot*Ot+Pt*Pt<=de&&(Lt=!0)}else{let Ot=Vt*Ne-Yt*Ce;Ot*Ot<=je&&(Lt=!0)}Lt&&(!Xe.el&&!Xe.isRemoved&&nt(Xe),Xe.el&&pe.push(Xe.el))}return pe}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;Fe||E()}});function qn(){C()&&Be(1)}let Ut=[],wn=[];function Yr(I,k){if(!I||!k)return;let O=I.size||r,N=k.size||r,B=I.x+O/2,de=I.y+O/2,pe=k.x+N/2,we=k.y+N/2;Ut.push({x1:B,y1:de,x2:pe,y2:we,age:0,life:.15})}function Do(I,k,O){if(!L.pf)return;let N=document.createElement("div");N.className="coin-stain";let B=O*1.2;N.style.width=`${B}px`,N.style.height=`${B}px`,N.style.left=`${I-B/2}px`,N.style.top=`${k-B/2}px`,L.pf.appendChild(N),setTimeout(()=>{N.style.opacity="0",setTimeout(()=>{N.parentNode&&N.remove()},1e3)},2500)}function $o(I,k){let O=Math.random()*Math.PI*2,N=(I.size||r)/2,B=N*_b,de=Math.cos(O)*B,pe=Math.sin(O)*B,we=N*(.7+Math.random()*.6),_e=Math.cos(O)*(B+we),Ke=Math.sin(O)*(B+we);Ut.push({parentCoin:I,relX1:de,relY1:pe,relX2:_e,relY2:Ke,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let He=3+Math.floor(Math.random()*3);for(let $e=0;$e<He;$e++){let Ce=.3+Math.random()*.5,Ne=de+(_e-de)*Ce,Se=pe+(Ke-pe)*Ce,je=O+(Math.random()*1.2-.6),Ye=we*(.4+Math.random()*.4),ot=Ne+Math.cos(je)*Ye,Xe=Se+Math.sin(je)*Ye;Ut.push({parentCoin:I,relX1:Ne,relY1:Se,relX2:ot,relY2:Xe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ft("sounds/lightning_zap.ogg",{volume:.25})}function pr(I,k,O){if(!I)return;let N=I.size||r,B=performance.now(),de=ne(I,B),pe=de.x+N/2,we=de.y+N/2,_e=k-pe,Ke=O-we,He=Math.atan2(Ke,_e),$e=Math.sqrt(_e*_e+Ke*Ke),Ce=N/2*_b,Ne=Math.cos(He)*Ce,Se=Math.sin(He)*Ce;Ut.push({parentCoin:I,relX1:Ne,relY1:Se,x2:k,y2:O,age:0,life:.25,width:6,jaggedScale:25});let je=pe+Ne,Ye=we+Se,ot=6+Math.floor(Math.random()*5);for(let Xe=0;Xe<ot;Xe++){let Rt=.1+Math.random()*.8,lt=je+(k-je)*Rt,wt=Ye+(O-Ye)*Rt,Vt=He+(Math.random()*1.6-.8),Yt=$e*(.1+Math.random()*.3),Gn=lt+Math.cos(Vt)*Yt,Lt=wt+Math.sin(Vt)*Yt;if(Ut.push({x1:lt,y1:wt,x2:Gn,y2:Lt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Pt=lt+(Gn-lt)*.5,wo=wt+(Lt-wt)*.5,un=Vt+(Math.random()*1-.5),Sa=Yt*.5;Ut.push({x1:Pt,y1:wo,x2:Pt+Math.cos(un)*Sa,y2:wo+Math.sin(un)*Sa,age:0,life:.25,width:1.5,jaggedScale:10})}}}function Ae(I){if(!U||!M)return;U.clearRect(0,0,M.width,M.height);let k=performance.now();U.lineCap="round",U.lineJoin="round";for(let O=Ut.length-1;O>=0;O--){let N=Ut[O];if(N.age+=I,N.age>=N.life){Ut.splice(O,1);continue}let B=N.x1,de=N.y1,pe=N.x2,we=N.y2;if(N.parentCoin){let He=ne(N.parentCoin,k),$e=He.x+(N.parentCoin.size||r)/2,Ce=He.y+(N.parentCoin.size||r)/2;B=$e+N.relX1,de=Ce+N.relY1,N.relX2!==void 0&&(pe=$e+N.relX2,we=Ce+N.relY2)}let _e=1-N.age/N.life;U.strokeStyle=`rgba(200, 240, 255, ${_e})`,U.lineWidth=N.width||3,U.shadowColor="rgba(220, 245, 255, 0.9)",U.shadowBlur=20;let Ke=6;U.beginPath(),U.moveTo(B,de);for(let He=1;He<=Ke;He++){let $e=He/Ke,Ce=B+(pe-B)*$e,Ne=de+(we-de)*$e;if(He===Ke)U.lineTo(pe,we);else{let Se=-(we-de),je=pe-B,Ye=Math.sqrt(Se*Se+je*je),ot=N.jaggedScale||40;if(Ye>0){let Xe=(Math.random()-.5)*ot*(1-Math.abs($e-.5));U.lineTo(Ce+Se/Ye*Xe,Ne+je/Ye*Xe)}else U.lineTo(Ce,Ne)}}U.stroke(),U.shadowBlur=0}for(let O=wn.length-1;O>=0;O--){let N=wn[O];if(N.age+=I,N.age>=N.life){wn.splice(O,1);continue}N.x+=N.vx*I,N.y+=N.vy*I;let B=1-N.age/N.life;U.fillStyle=N.color,U.globalAlpha=B,U.beginPath(),U.arc(N.x,N.y,N.size,0,Math.PI*2),U.fill(),U.globalAlpha=1}}return{start:E,stop:z,setRate:Z,clearBacklog:oe,clearPlayfield:ge,setCoinSprite:le,getCoinTransform:We,findCoinsInRadius:pt,findCoinsInPath:cn,findCoinTargetsInRadius:be,findCoinTargetsInPath:Ge,ensureCoinVisual:nt,removeCoinTarget:Xt,detachCoin:X,recycleCoin:ce,playEntranceWave:qn,setDependencies:_,hasBigCoins:()=>Me(2)&&F.some(I=>I&&I.sizeIndex>=4)}}var ua,qi,tL,xb,oL,Lb,_b,iL,sL,Mb,aL,kb=De(()=>{dc();To();po();Cn();En();ph();Co();ua=!1,qi=0n,tL=2500,xb=new Map;try{Cb(ht())}catch{ua=!1,qi=0n}try{_i(e=>{Cb(e)})}catch{}oL="cubic-bezier(0.215, 0.61, 0.355, 1)";Lb=[40,55,80,125,200,320,512],_b=.78,iL=[1,25,625,15625,390625,9765625,244140625],sL=[0,.1,.01,.001,1e-4,1e-5,1e-6],Mb=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],aL=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var Ub={};vt(Ub,{afterSlotWrite:()=>vh,beforeSlotWrite:()=>yh});function Pb(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function dL(e,t=uL){!e||e<=0||Kl.set(e,Pb()+t)}function Nb(e){if(!e||e<=0)return!1;let t=Kl.get(e);return t==null?!1:t<=Pb()?(Kl.delete(e),!1):!0}function pL(){Kl.clear()}function Sf(){try{return typeof localStorage<"u"}catch{return!1}}function gh(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function Bb(e){let t=new Map;if(!Sf())return jl.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Wi))continue;let r=gh(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return jl.set(e,t),t}function Fb(e){return!Number.isFinite(e)||e<=0?null:jl.has(e)?jl.get(e):Bb(e)}function yh(e){if(!Sf()||bf>0)return;let t=String(e);if(!t.startsWith(Wi))return;let n=gh(t);if(n==null)return;let o=Fb(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(bf===0){bf+=1;try{xn(n)}finally{bf-=1}}Bb(n);return}}}catch{}}function vh(e,t){let n=String(e);if(!n.startsWith(Wi))return;let o=gh(n);if(o==null)return;let r=Fb(o)||new Map;r.set(n,String(t??"")),jl.set(o,r)}function mL(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function hL(){let e=new Map;if(!Sf())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Wi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=Xf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function gL(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function yL(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=Vf(e);if(n.length===0){o&&(Nb(e)||xn(e),ac(e,null));return}let r=mL(n);o&&r!==o&&!Nb(e)&&xn(e),r!==o&&ac(e,r)}function da(){if(!Sf())return;let e=hL();gL(e).forEach(n=>{let o=e.get(n)??[];yL(n,o)})}function vL(){if(mh!=null)return;mh=(typeof window<"u"?window:globalThis).setTimeout(()=>{mh=null,da()},fL)}function bL(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){dL(o),vL();return}Kl.delete(o),da()}}function SL(){typeof window>"u"||Ab==null&&(Ab=window.setInterval(da,cL))}function IL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function fa(){let e=IL();if(!e)return;if(!zi()){(e.dataset.poopShopApplied===hh||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==Rb||e.dataset.poopShopApplied!==hh)&&(e.style.backgroundImage=Rb,e.dataset.poopShopApplied=hh)}function wL(){typeof window>"u"||Ob==null&&(fa(),Ob=window.setInterval(fa,50),window.addEventListener("saveSlot:change",fa),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&fa()}catch{fa()}}))}function EL(){typeof window>"u"||(da(),SL(),wL(),window.addEventListener("saveSlot:change",()=>da()),window.addEventListener("saveIntegrity:storageMutation",bL,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(pL(),da(),fa())}))}var cL,uL,fL,Ab,mh,Kl,jl,bf,Rb,hh,Ob,bh=De(()=>{It();cL=1e4,uL=750,fL=50,Ab=null,mh=null,Kl=new Map;jl=new Map,bf=0;Rb="linear-gradient(180deg,#a9793d,#7b5534)",hh="1",Ob=null;EL()});var zb={};vt(zb,{initPopups:()=>CL,teardownpopups:()=>TL});function Sh(){return Io||(Io=document.createElement("div"),Io.className="currency-popups",Io.setAttribute("aria-live","polite"),Io.setAttribute("aria-atomic","false"),document.body.appendChild(Io),Io)}function Gi(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function Ih(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function $b(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):j(n);t&&(t.innerHTML=r)}function LL(e,t=qb){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Zl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function _L(e,t,n){Sh();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function wh(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(Kt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(Kt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Re).includes(e)&&Hn(e,o))return}let r=xL[e],i=Object.assign({duration:qb,accumulate:!0},r||{},n);if(!i.icon)return;let s=Gi(t);if(!s||Ih(s))return;let l=i.accumulate!==!1?Zl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,$b(l);return}let a=_L(e,i,s);a.meta=i,$b(a),Zl.set(e,a);let u=Sh(),f=Db.indexOf(e),d=null;if(f>=0){let m=Array.from(u.children);for(let y of m){let p=y.dataset.type;if(Db.indexOf(p)>f){d=y;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),LL(a,i.duration)}function ML(){let e={};for(let t of Object.values(Re))e[t]=_a(t);return e}function Gb(){try{let e=ML();Object.entries(e).forEach(([t,n])=>{let o=Gi(n)||c.fromInt(0);Xr.set(t,o.clone?.()??o)}),Xr.has("mp")||Xr.set("mp",c.fromInt(0))}catch{Xr.clear()}}function Hb(){Zl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Zl.clear()}function Xb(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Gi(t.value)||c.fromInt(0),r=Xr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Gi(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&wh(n,s),Xr.set(n,o.clone?.()??o)}function Vb(e){let t=e?.detail;if(!t)return;let n=Gi(t.xpAdded);n&&!Ih(n)&&wh("xp",n)}function Yb(e){let t=e?.detail;if(!t)return;let n=Gi(t.delta);n&&!Ih(n)&&wh("mp",n);let o=Gi(t.progress);o&&Xr.set("mp",o.clone?.()??o)}function Wb(){Hb(),Gb()}function CL(){If||(If=!0,Sh(),Gb(),window.addEventListener("currency:change",Xb),window.addEventListener("xp:change",Vb),window.addEventListener("mutation:change",Yb),window.addEventListener("saveSlot:change",Wb))}function TL(){If&&(window.removeEventListener("currency:change",Xb),window.removeEventListener("xp:change",Vb),window.removeEventListener("mutation:change",Yb),window.removeEventListener("saveSlot:change",Wb),Hb(),Xr.clear(),Io&&Io.remove(),Io=null,If=!1)}var qb,Db,xL,Io,If,Xr,Zl,Kb=De(()=>{Et();zt();It();qb=6767,Db=["coins","xp","books","gold","mp","magic","gears","dna"],xL={[Re.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Re.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Re.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Re.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Re.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Re.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},Io=null,If=!1,Xr=new Map,Zl=new Map});var oS={};vt(oS,{flushBackupSnapshot:()=>nS,getSuspendMetadata:()=>YL,installSuspendSafeguards:()=>VL,markProgressDirty:()=>Fo,restoreFromBackupIfNeeded:()=>XL});function Jl(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function ya(){if(typeof localStorage>"u")return!1;try{let e=`${io}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function Qb(){if(!Jl())throw new Error("IndexedDB unavailable");return pa||(pa=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(kL,AL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(ga)||r.createObjectStore(ga)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}pa=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw pa=null,e}),pa)}function PL(){if(!ya())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(io))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function BL(e){try{let t=await Qb();return await new Promise((n,o)=>{let r=!1,i=t.transaction(ga,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(ga).put(e,Jb);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function FL(){try{let e=await Qb();return await new Promise((t,n)=>{let o=!1,r=e.transaction(ga,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(ga).get(Jb);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function UL(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function Eh(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function DL(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function qL(e){return!(typeof e!="string"||e.length===0||$L.test(e))}function xh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(io)||n.startsWith(NL)||n.startsWith(RL))return;let o=DL(n);if(o!=null)try{let r={key:n,slot:o,trusted:qL(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function GL(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=Eh(),a=String(i),u=this===localStorage&&a.startsWith(io);if(u)try{yh(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Fo("setItem");try{vh(a,s)}catch{}}this===localStorage&&a.startsWith(io)&&xh(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=Eh(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(io)&&(Fo("removeItem"),xh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=Eh(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Fo("clear"),xh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function eS(e="idle"){ha=e||ha,Vr=!0,!ma&&(ma=setTimeout(()=>{if(ma=null,!Vr)return;let t=ha;Vr=!1,nS(t)},OL))}function tS(){ma&&(clearTimeout(ma),ma=null)}function Fo(e="dirty"){try{eS(e)}catch{}}async function Lh(e="manual"){if(!ya()||!Jl())return!1;let t=PL();if(!t)return!1;t.reason=e,Ef=!1;let n=await BL(t);return n||(Vr=!0,eS("retry")),n}async function nS(e="manual",{immediate:t=!1}={}){return!ya()||!Jl()?!1:t?(tS(),Vr=!1,Ef=!0,Lh(e)):(Vr=!0,ha=e||ha,Lh(e))}function wf(e){!Jl()||!ya()||(tS(),Vr=!1,Ef=!0,Lh(e))}function HL(){if(!ya())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(io))return!0}}catch{}return!1}async function XL(){if(Zb||(Zb=!0,!ya()||!Jl()))return!1;let e=!1;try{if(!HL())e=!0;else{let o=localStorage.getItem(`${io}saveSlot`);if(o){let r=`${io}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await FL();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Fo("restored"),n}function VL(){if(jb||(jb=!0,typeof window>"u"))return;UL(),GL();let e=()=>{document.hidden?wf("visibility-hidden"):Fo("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>wf("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>wf("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>wf("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Fo("pageshow"))}catch{}try{window.addEventListener("focus",()=>Fo("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(io)||Fo("storage-event"))})}catch{}Fo("boot")}function YL(){return{pendingImmediateFlush:Ef,dirty:Vr,lastDirtyReason:ha}}var io,kL,AL,ga,Jb,NL,RL,OL,pa,ma,Vr,ha,jb,Zb,Ef,$L,rS=De(()=>{bh();io="ccc:",kL="ccc:safety",AL=1,ga="snapshots",Jb="latest",NL=`${io}slotSig`,RL=`${io}slotMod`,OL=1e3,pa=null,ma=null,Vr=!1,ha="init",jb=!1,Zb=!1,Ef=!1;$L=/\bat <anonymous>:\d+:\d+\b/});var iS={};vt(iS,{initGlobalOverlayEsc:()=>KL});function zL(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i,closeAll:s}of WL){let l=document.querySelectorAll(o);if(l.length>0){if(i){t=!0;continue}if(s)l.forEach(a=>{let u=a.querySelector(r||".shop-close");u&&(u.click(),n=!0)});else{let u=l[l.length-1].querySelector(r||".shop-close");u&&(u.click(),n=!0)}}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function KL(){window.addEventListener("keydown",zL,!0)}var WL,sS=De(()=>{WL=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close",closeAll:!0}]});var aS={};vt(aS,{ensureGameDom:()=>jL});function jL(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var lS=De(()=>{});var cS={};vt(cS,{SHOW_FPS:()=>ZL,initFpsTracker:()=>JL});function JL(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var ZL,uS=De(()=>{ZL=!0});var pS={};vt(pS,{initNotifications:()=>n_,showNotification:()=>dS,unpauseNotifications:()=>e_});function QL(){return va||(va=document.createElement("div"),va.className="notification-container",document.body.appendChild(va),va)}function e_(){fS=!1,Mh()}async function Mh(){if(_h||fS||xf.length===0)return;_h=!0;let{text:e,iconSrc:t,duration:n}=xf.shift();await t_(e,t,n),_h=!1,xf.length>0&&Mh()}function t_(e,t,n){return new Promise(o=>{let r=QL(),i=document.createElement("div");if(i.className="notification",t){let l=document.createElement("img");l.src=t,l.className="notification-icon",l.alt="",i.appendChild(l)}let s=document.createElement("div");s.className="notification-text",s.innerHTML=e,i.appendChild(s),r.appendChild(i),ft("sounds/notif_ding.ogg",{volume:.5}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.classList.add("is-visible")})}),setTimeout(()=>{i.classList.remove("is-visible"),i.classList.add("is-leaving");let l=()=>{i.remove(),o()};i.addEventListener("transitionend",l,{once:!0}),setTimeout(()=>{i.isConnected&&(i.remove(),o())},600)},n)})}function dS(e,t,n=5e3){xf.push({text:e,iconSrc:t,duration:n}),Mh()}function n_(){typeof window>"u"||window.addEventListener("lab:node:change",e=>{let{id:t,level:n}=e.detail||{};if(!t||n==null)return;let o=kn.get(t);if(!o)return;let r=o.maxLevel;if(n<r||Ky())return;let i=o.title||"Node";dS(`${i}<br>Maxed!`,"img/"+o.icon)})}var va,xf,_h,fS,mS=De(()=>{xr();En();Ns();va=null,xf=[],_h=!1,fS=!0});function i_(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function s_(){if(!Je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function TS(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=Je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function ba(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function kS(e,t,n,o=500){!e||e.__done||(e.__done=!0,e.__label&&(n?e.__label.textContent=n:e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(async()=>{if(typeof t=="function")try{t()}catch(i){console.error(i)}await DS(),e.style.opacity="0";let r=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",r,{once:!0}),setTimeout(r,450)},o))}async function Ah(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function a_(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function l_(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(En(),tc));await o(n)}catch{}try{t?.(n)}catch{}return n})}function c_(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function u_({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...a_(e,s),...l_(t,s),...n?c_(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function f_(e){if(Xi===e)return;ln&&(ln.stop(),ln=null),Xi=e;let t=document.querySelector(".menu-root");switch(e){case Uo.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Xi===Uo.STARTER_COVE&&(ln=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}),typeof Cf=="function"&&Cf())},300)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Uh=="function"&&Uh(n,80),Hi){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(Hi.init("water-background",i),_f){try{_f()}catch{}_f=null}if(Mf){try{Mf()}catch{}Mf=null}typeof Bh=="function"&&(_f=Bh(s=>Hi.update(s))),typeof Fh=="function"&&(Mf=Fh((s,l)=>Hi.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,Hi&&requestAnimationFrame(()=>Hi.resize()),RS()),typeof Rh=="function")try{Rh()}catch{}if(typeof Oh=="function")try{Oh()}catch{}if(!en){en=AS({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=en;let i=()=>{if(!(!en||typeof en.setCoinSprite!="function"))try{en.setCoinSprite(FS?.())}catch{}};i(),US?.(i);let s=NS({spawner:en});en&&typeof en.setDependencies=="function"&&en.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=OS(),u=PS(a);if(en&&u?.coinsPerSecondMult){let f=1*u.coinsPerSecondMult;if(typeof Ph=="function"){let d=Ph("spawnRate",f);try{d&&typeof d.toScientific=="function"?f=Number(d.toScientific(6)):f=Number(d)}catch{}}Number.isFinite(f)&&en.setRate(f)}}catch{}};if(l(),typeof kh=="function")try{kh()}catch{}kh=BS(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof Nh=="function")try{Nh()}catch{}setTimeout(()=>{Xi===Uo.STARTER_COVE&&en&&en.start()},300);break}case Uo.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),en&&en.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===Uo.MENU}}))}catch{}}var o_,Je,hS,AS,NS,RS,gS,yS,vS,bS,SS,IS,wS,ES,OS,PS,Nh,BS,r_,xS,LS,_S,Ch,Th,Rh,Oh,FS,US,Lf,Ph,MS,Bh,Fh,CS,Uh,Hi,_f,Mf,Cf,Uo,Xi,ln,en,kh,Tf,DS,po=De(()=>{En();o_=!0,Je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();Je&&document.documentElement.classList.add("is-mobile");_f=null,Mf=null,Cf=null;s_();Uo={MENU:0,STARTER_COVE:1},Xi=Uo.MENU,ln=null,en=null,kh=null,Tf=()=>new Promise(e=>requestAnimationFrame(e)),DS=async()=>{await Tf(),await Tf()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(K=>{e=K}),n=TS("Loading assets...",e);await Tf();let{initAudio:o}=await Promise.resolve().then(()=>(En(),tc));o();let r=Promise.all([Promise.resolve().then(()=>(Kf(),rg)),Promise.resolve().then(()=>(kb(),Tb)),Promise.resolve().then(()=>(Za(),_v)),Promise.resolve().then(()=>(vu(),pv)),Promise.resolve().then(()=>(It(),eg)),Promise.resolve().then(()=>(bh(),Ub)),Promise.resolve().then(()=>(fo(),$0)),Promise.resolve().then(()=>(dc(),sg)),Promise.resolve().then(()=>(zn(),wg)),Promise.resolve().then(()=>(Co(),h0)),Promise.resolve().then(()=>(To(),yb)),Promise.resolve().then(()=>(Kb(),zb)),Promise.resolve().then(()=>(rS(),oS)),Promise.resolve().then(()=>(rs(),Tg)),Promise.resolve().then(()=>(sS(),iS)),Promise.resolve().then(()=>(ns(),pb)),Promise.resolve().then(()=>(ni(),Ag)),Promise.resolve().then(()=>(Wc(),Ly)),Promise.resolve().then(()=>(gs(),wy)),Promise.resolve().then(()=>(hs(),zg)),Promise.resolve().then(()=>(lS(),aS)),Promise.resolve().then(()=>(Cn(),my)),Promise.resolve().then(()=>(ph(),Eb)),Promise.resolve().then(()=>(li(),Ug)),Promise.resolve().then(()=>(uS(),cS)),Promise.resolve().then(()=>(mS(),pS))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(K,fe)=>`img/mutations/m${fe+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/gold_val_dna.webp","img/sc_upg_icons/magic_val_dna.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/wave_val_dna.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_dna.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg","sounds/notif_ding.ogg"],fonts:!0},s=0,l=u_(i,K=>{s=K,ba(n,K)}),[a,u,f,d,m,y,p,h,g,v,w,L,C,A,q,P,G,M,U,T,_,Y,Q,ie,me,ve]=await r;({initSlots:hS}=a),{createSpawner:AS}=u,{initCoinPickup:NS}=f,{initHudButtons:RS}=d,{bank:bS,getHasOpenedSaveSlot:SS,setHasOpenedSaveSlot:IS,ensureStorageDefaults:wS,notifyGameSessionStarted:CS,ensureMultiplierDefaults:ES}=m,{getCurrentAreaKey:OS,computeUpgradeEffects:PS,onUpgradesChanged:BS}=p,{registerPreloadedAudio:r_}=h,{initXpSystem:Nh}=g,{initResetSystem:Rh}=v,{initMutationSystem:Oh,getMutationCoinSprite:FS,onMutationChange:US}=w,{initPopups:xS}=L,{installSuspendSafeguards:LS,restoreFromBackupIfNeeded:_S,markProgressDirty:Ch,flushBackupSnapshot:Th}=C,{installGhostTapGuard:gS,initGlobalGhostTap:yS}=A,{initGlobalOverlayEsc:vS}=q,{setDebugPanelAccess:Lf,applyStatMultiplierOverride:Ph}=P,{startGameLoop:MS,registerTick:Bh,registerFrame:Fh}=G;let{initOfflineTracker:Oe,processOfflineProgress:Te}=M,{initWorkshopSystem:F}=U,{initAutomationEffects:W}=T;({ensureGameDom:Uh}=_);let{initSurgeEffects:$}=Y;({waterSystem:Hi}=Q);let{initLabLogic:H}=ie,{initFpsTracker:J}=me,{initNotifications:se,unpauseNotifications:ce,showNotification:x}=ve;Cf=ce,window.bank=bS,window.unpauseNotifications=Cf,window.showNotification=x,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(ln){try{ln.stop()}catch{}ln=null}}),window.addEventListener("audio:restartMusic",()=>{if(ln){try{ln.stop()}catch{}ln=null}Xi===Uo.STARTER_COVE&&(ln=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",K=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return K.preventDefault(),K.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let K=document.hidden;Af(K),ln&&ln.element&&(K?ln.element.pause():ln.element.play().catch(()=>{}))}),gS?.(),yS?.(),vS?.(),LS?.(),typeof Lf=="function"&&(Lf(o_),window.setDebugPanelAccess=Lf);try{await _S?.()}catch{}await Promise.race([l,t]),await DS(),document.documentElement.classList.remove("booting"),await Tf(),kS(n),await Promise.all([Ah("img/currencies/coin/coin_plus_base.webp"),Ah("img/stats/xp/xp_plus_base.webp"),Ah("img/stats/mp/mp_plus_base.webp")]);try{typeof m.clearActiveSlot=="function"?m.clearActiveSlot():m&&m.KEYS&&m.KEYS.SAVE_SLOT&&localStorage.removeItem(m.KEYS.SAVE_SLOT)}catch{}MS(),Oe(()=>Xi===Uo.STARTER_COVE);try{F()}catch(K){console.error("Workshop init failed",K)}try{W()}catch(K){console.error("Automation init failed",K)}try{$()}catch(K){console.error("Surge effects init failed",K)}try{H()}catch(K){console.error("Lab system init failed",K)}try{J()}catch(K){console.error("FPS tracker init failed",K)}i_(),wS(),Ch?.("ensure-defaults"),xS(),se();let X=document.getElementById("panel-title");if(SS()?(document.body.classList.add("has-opened"),X&&(X.style.opacity="0")):X&&(X.style.opacity="1"),hS(async()=>{if(Xi===Uo.STARTER_COVE)return;IS(!0),document.body.classList.add("has-opened"),X&&(X.style.opacity="0");let K=TS("Loading game..."),fe=()=>new Promise(ee=>setTimeout(ee,120));ba(K,.2),await fe(),ES(),ba(K,.4),await fe(),Te(),ba(K,.65),await fe(),CS?.(),ba(K,.9),await fe(),Ch?.("slot-entered"),ba(K,1),kS(K,()=>{f_(Uo.STARTER_COVE),setTimeout(()=>{window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave()},300)},"Finished loading game",200)}),typeof window<"u"&&Th)try{window.cccRequestBackup=()=>Th("manual",{immediate:!0})}catch{}})});po();})();
