(()=>{var Ab=Object.defineProperty;var $e=(e,t)=>()=>(e&&(t=e(e=0)),t);var bt=(e,t)=>{for(var n in t)Ab(e,n,{get:t[n],enumerable:!0})};var Al={};bt(Al,{initAudio:()=>Nb,loadAudio:()=>Qm,playAudio:()=>ft,registerPreloadedBuffer:()=>Ob,setAudioSuspended:()=>nf,setMusicUnderwater:()=>$r});function tf(){if(Vt)return Vt;let e=window.AudioContext||window.webkitAudioContext;return e?(Vt=new e,oa=Vt.createGain(),oa.connect(Vt.destination),oa.gain.value=1,kl=Vt.createGain(),kl.gain.value=1,kl.connect(oa),vo=Vt.createBiquadFilter(),vo.type="lowpass",vo.frequency.value=22050,vo.Q.value=1,vo.connect(kl),Vt):null}function Nb(){tf()}function Rb(){Vt&&Vt.state==="suspended"&&Vt.resume().catch(()=>{})}async function Qm(e){let t=tf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(ra.has(n))return ra.get(n);if(Tl.has(n))return Tl.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return ra.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{Tl.delete(n)}})();return Tl.set(n,o),o}function ft(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=tf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=ra.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let d=s.createGain();return d.gain.value=t,u.connect(d),i==="music"?d.connect(vo):d.connect(oa),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:d,element:null}}else Qm(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function Ob(e,t){let n=new URL(e,document.baseURI).href;ra.set(n,t)}function nf(e){Vt&&(e?Vt.state==="running"&&Vt.suspend().catch(()=>{}):Vt.state==="suspended"&&Vt.resume().catch(()=>{}))}function $r(e){if(!vo)return;let t=e?600:22050;try{let n=Vt.currentTime;vo.frequency.cancelScheduledValues(n),vo.frequency.setValueAtTime(t,n)}catch{vo.frequency.value=t}}var Vt,oa,kl,vo,ra,Tl,Fn=$e(()=>{Vt=null,oa=null,kl=null,vo=null,ra=new Map,Tl=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,Rb,{capture:!0,passive:!0})})});var c,Ct=$e(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",d=i+s;d.startsWith("-")?(u="-",d=d.slice(1)):d.startsWith("+")&&(d=d.slice(1));let f=d.replace(/^0+/,"")||"0",p=BigInt(u+f);return new e(p,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let f=i.slice(u+1)||"0";try{a=BigInt(f)}catch{a=0n}}let d=Number(l);return Number.isFinite(d)||(d=e.MAX_E),new e(BigInt(r),{base:d,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,d=Number(u),f=l;return Number.isSafeInteger(d)||(f+=u,d=0),new e(i,{base:d,offset:f},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let d=Math.min(n,18);o=u.toFixed(d).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,this.e-(n|0),this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}}});function nh(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return th.format(t)}catch{return String(e)}}function ia(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function of(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+nh(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+th.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,d=rf.get(u)||"",p=o-u+1,g=4-p,m=p+g;n.length<m+1&&(n+="0".repeat(m+1-n.length));let y=n.slice(0,m);(n.charCodeAt(m)||48)>=53&&(y=ia(y));let b,E;return y.length>m?(b=y.slice(0,p+1),E="0".repeat(g)):(b=y.slice(0,p),E=y.slice(p)),t+`${b}${g?"."+E:""}${d}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=ia(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+of(String(o))}function Bb(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+of(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let d=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(d=ia(d)),l){let R=d.slice(0,1)+"."+d.slice(1),T=i==="-"?"-":"";return t+R+"e"+of(s,T)}let p=Math.floor(a/3)*3,g=rf.get(p)||"",y=a-p+1,h=4-y,b,E;return d.length>4?(b=d.slice(0,y+1),E="0".repeat(h)):(b=d.slice(0,y),E=d.slice(y)),t+(i==="-"?"-":"")+b+(h?"."+E:"")+g}function eh(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=ia(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+Bb(l)}function J(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return eh(e.toScientific(3));if(t<6)return nh(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=rf.get(n);if(!o)return eh(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=ia(u));let f,p;return u.length>l?(f=u.slice(0,i+1),p="0".repeat(s)):(f=u.slice(0,i),p=u.slice(i)),`${f}${s?"."+p:""}${o}`}var Pb,rf,th,Kt=$e(()=>{Ct();Pb=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],rf=new Map(Pb),th=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var ph={};bt(ph,{CURRENCIES:()=>Ce,KEYS:()=>yt,STORAGE_PREFIX:()=>Oi,bank:()=>O,clearActiveSlot:()=>zb,clearAllStorage:()=>Jb,ensureCurrencyDefaults:()=>yf,ensureMultiplierDefaults:()=>vf,ensureStorageDefaults:()=>Zb,getActiveSlot:()=>v,getCurrency:()=>la,getCurrencyMultiplierBN:()=>dh,getHasOpenedSaveSlot:()=>jb,getLastSaveTime:()=>pf,getLastSaveTimeKey:()=>Bl,getSlotModifiedFlagKey:()=>Kb,getSlotSignature:()=>gf,getSlotSignatureKey:()=>hf,hasModifiedSave:()=>Pi,isCurrencyLocked:()=>Un,isStorageKeyLocked:()=>ln,markSaveSlotModified:()=>vn,notifyGameSessionStarted:()=>Vb,onCurrencyChange:()=>Pl,peekCurrency:()=>ca,primeStorageWatcherSnapshot:()=>rt,setActiveSlot:()=>mf,setCurrency:()=>Ni,setCurrencyMultiplierBN:()=>Dl,setHasOpenedSaveSlot:()=>Ul,setSlotSignature:()=>Fl,updateLastSaveTime:()=>uh,watchStorageKey:()=>_t});function lf(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function cf(e){let t=lf(e);return t==null?null:`${Fb}:${t}`}function uf(e){let t=lf(e);return t==null?null:`${Ub}:${t}`}function ah(e={}){Nl.size!==0&&Nl.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Pl(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return Nl.add(o),()=>{Nl.delete(o)}}function $b(){if(sa!=null||Ro.size===0)return;sa=(typeof window<"u"?window:globalThis).setInterval(Gb,Db)}function lh(){if(Ro.size!==0||sa==null)return;(typeof window<"u"?window:globalThis).clearInterval(sa),sa=null}function ch(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function qb(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function Gb(){if(Ro.size===0){lh();return}Ro.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=ch(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!qb(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function _t(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Ro.get(e);return s||(s=new Set,Ro.set(e,s)),s.add(i),$b(),()=>{let l=Ro.get(e);l&&(l.delete(i),l.size===0&&(Ro.delete(e),lh()))}}function rt(e,t){if(!e)return;let n=Ro.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=ch(r,o),r.initialized=!0)})}function ff(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function Hb(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function Xb(){sf.forEach(e=>{try{e?.()}catch{}}),sf.clear()}function rh(e){if(e!==oh&&(Xb(),oh=e??null,e!=null))for(let t of Object.values(Ce)){let n=`${yt.CURRENCY[t]}:${e}`,o=_t(n,{parse:Hb,equals:ff,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};ah(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});sf.set(n,o)}}function Yb(){typeof window>"u"||(rh(v()),window.addEventListener("saveSlot:change",()=>{rh(v())}))}function Vb(){df=!0}function Bl(e=v()){return e==null?null:`${lr}lastSaveTime:${e}`}function uh(){if(!df||document.hidden)return;let e=v();if(e==null)return;let t=Date.now();try{localStorage.setItem(Bl(e),String(t))}catch{}}function pf(){let e=v();if(e==null)return 0;try{let t=localStorage.getItem(Bl(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function Wb(){typeof window>"u"||(ih||(ih=setInterval(uh,1e3)),window.addEventListener("beforeunload",()=>{if(!df)return;let e=v();if(e!=null)try{localStorage.setItem(Bl(e),String(Date.now()))}catch{}}))}function v(){if(sr!==void 0)return sr;let e=localStorage.getItem(yt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return sr=n,n}function mf(e){let t=Math.max(1,parseInt(e,10)||1);sr=t,localStorage.setItem(yt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function zb(){sr=null,localStorage.removeItem(yt.SAVE_SLOT)}function aa(e,t=v()){return t==null?null:`${e}:${t}`}function fh(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function ln(e){return fh(e)}function hf(e=v()){return cf(e)}function Kb(e=v()){return uf(e)}function gf(e=v()){if(typeof localStorage>"u")return null;let t=cf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function Fl(e,t){if(typeof localStorage>"u")return;let n=cf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function Pi(e=v()){if(typeof localStorage>"u")return!1;let t=uf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function vn(e=v()){if(typeof localStorage>"u")return;let t=lf(e);if(t==null||Pi(t))return;let n=uf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function jb(){return localStorage.getItem(yt.HAS_OPENED_SAVE_SLOT)==="true"}function Ul(e){localStorage.setItem(yt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function Zb(){localStorage.getItem(yt.HAS_OPENED_SAVE_SLOT)===null&&Ul(!1)}function yf(){let e=v();if(e!=null)for(let t of Object.values(Ce)){let n=`${yt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function vf(){let e=v();if(e!=null)for(let t of Object.values(Ce)){let n=`${yt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))Ol(t);else{let o=ar(c.fromInt(1));Ri(t,o)}}}function la(e){let t=aa(yt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Ni(e,t,{delta:n=null,previous:o=null}={}){let r=v(),i=aa(yt.CURRENCY[e],r),s=o??la(e),l=c.fromInt(0);if(!i||Un(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let d=null;try{d=localStorage.getItem(i)}catch{}let f=d??u,p=a;try{d!=null&&(p=c.fromAny(d),p.isNegative?.()&&(p=c.fromInt(0)))}catch{}rt(i,f);let g=!ff(s,p),y=(b=>{if(b==null)return null;try{let E=b instanceof c?b.clone?.()??b:c.fromAny(b);if(typeof E.cmp=="function")return E.cmp(l)>0?E:null;if(!E.isZero?.())return E}catch{}return null})(n),h=null;if(g)try{h=p.sub?.(s)}catch{}if((!h||h.isZero?.()||typeof h.cmp=="function"&&h.cmp(l)<=0)&&(h=y),g||h){let b={key:e,value:p,slot:r,delta:h??void 0};ah(b);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:b}))}catch{}}return p}function ar(e){return e.mulScaledIntFloor(1n,-af)}function Rl(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,af)}function Ol(e){let t=aa(yt.MULTIPLIER[e]);if(!t)return ar(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(qr)){let r=ar(c.fromInt(1));return Ri(e,r),r}let o=n.slice(qr.length);try{return c.fromAny(o)}catch{let r=ar(c.fromInt(1));return Ri(e,r),r}}function Ri(e,t,n=v()){let o=aa(yt.MULTIPLIER[e],n);if(!o||Un(e,n))return;let r=ar(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(qr))try{r=c.fromAny(i.slice(qr.length))}catch{}let s=c.fromAny(t),l=qr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,d=s;try{let f=u?.startsWith?.(qr)?u.slice(qr.length):null;f!=null&&(d=c.fromAny(f))}catch{}try{rt(o,u)}catch{}if(!ff(r,d))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:Rl(d),slot:n}}))}catch{}}function dh(e){return Rl(Ol(e))}function Un(e,t=v()){let n=aa(yt.CURRENCY[e],t);return fh(n)}function Dl(e,t){let n=c.fromAny(t),o=ar(n);return Ri(e,o,v()),n}function ca(e,t){let n=localStorage.getItem(`${yt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Jb(){Object.values(yt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function sh(e){let t=n=>{try{let o=c.fromAny(n);return typeof J=="function"?J(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return la(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Ni(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Ni(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Ni(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof J=="function"?J(r):r.toString()},t.mult={get(){return dh(e)},set(n){return Dl(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=Ol(e).mulBigNumInteger(o);return r.isZero()&&(r=ar(c.fromInt(1))),Ri(e,r),Rl(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),af)}catch{o={numer:1n,scale:0}}let r=Ol(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=ar(c.fromInt(1))),Ri(e,r);let i=Rl(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var lr,Oi,Fb,Ub,af,qr,Db,Ro,sa,Nl,sf,oh,ih,df,yt,Ce,sr,O,St=$e(()=>{Ct();Kt();lr="ccc:",Oi=lr,Fb=`${lr}slotSig`,Ub=`${lr}slotMod`,af=18,qr="XM:",Db=140,Ro=new Map,sa=null,Nl=new Set;sf=new Map,oh=null;ih=null,df=!1;Wb();yt={HAS_OPENED_SAVE_SLOT:`${lr}hasOpenedSaveSlot`,SAVE_SLOT:`${lr}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Ce={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===yt.SAVE_SLOT){if(e.newValue===null)sr=null;else{let t=parseInt(e.newValue,10);sr=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:sr}}))}catch{}}});for(let e of Object.values(Ce))yt.CURRENCY[e]=`${lr}${e}`,yt.MULTIPLIER[e]=`${lr}mult:${e}`;Yb();O=new Proxy({},{get(e,t){if(Object.values(Ce).includes(t))return sh(t);if(typeof t=="string"&&Ce[t.toUpperCase?.()])return sh(Ce[t.toUpperCase()])}});if(typeof window<"u"){window.bank=O;for(let e of Object.values(Ce))window[e]=O[e]}});function hh(){return bo}function $l(e){bo=!!e,document.body.classList.toggle("slots-delete-mode",bo);let t=document.getElementById("manage-saves");t&&(t.textContent=bo?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",bo),n.setAttribute("aria-pressed",bo?"true":"false")})}function Qb(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function eS(){if(mh)return;mh=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),$l(!bo)}),window.addEventListener("keydown",r=>{bo&&r.key==="Escape"&&$l(!1)});let n=r=>{!bo||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!bo)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(Qb(s),v()===s)try{localStorage.removeItem(yt.SAVE_SLOT)}catch{}bf(),$l(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),$l(!1)}var bo,mh,gh=$e(()=>{St();Sf();bo=!1,mh=!1;document.addEventListener("DOMContentLoaded",()=>{try{eS()}catch{}})});var yh={};bt(yh,{initSlots:()=>oS,refreshSlotsView:()=>bf});function tS(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function nS(e){if(!tS(e))return"No Save Data";try{let t=ca(e,"coins");return J(t)}catch{return"0"}}function If(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=nS(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function oS(e){let t=document.querySelectorAll(".slot-card");If(),t.forEach((n,o)=>{let r=o+1,i=s=>{mf(r),yf(),vf(),Ul(!0),typeof e=="function"&&e(r,s),If()};n.addEventListener("click",s=>{hh()||(s.preventDefault(),i(s))})})}function bf(){If()}var Sf=$e(()=>{Ct();Kt();gh();St()});var bh={};bt(bh,{registerPreloadedAudio:()=>rS,takePreloadedAudio:()=>iS});function rS(e,t){let n=vh(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}ql.set(n,t)}}function iS(e){let t=vh(e);if(!ql.has(t))return null;let n=ql.get(t);return ql.delete(t),n}var ql,vh,Gl=$e(()=>{ql=new Map,vh=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function Bi(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var wf=$e(()=>{});var Ph={};bt(Ph,{addExternalCoinMultiplierProvider:()=>Po,addExternalXpGainMultiplierProvider:()=>dr,addXp:()=>Gi,broadcastXpChange:()=>zl,computeCoinMultiplierForXpLevel:()=>Rf,getXpGainMultiplier:()=>jl,getXpLevelStorageKey:()=>sS,getXpRequirementForXpLevel:()=>Kl,getXpState:()=>Qe,initXpSystem:()=>$i,isXpSystemUnlocked:()=>un,onXpChange:()=>Vl,refreshCoinMultiplierFromXpLevel:()=>Zt,resetXpProgress:()=>qi,setExternalBookRewardProvider:()=>Zl,setExternalCoinMultiplierProvider:()=>Rh,setExternalXpGainMultiplierProvider:()=>Oh,unlockXpSystem:()=>Yr});function sS(e=v()){let t=e??v();return t==null?null:Gr(t)}function cS(e){if(e===0n)return 0;let t=e.toString(),n=t.length,o=Math.min(n,15),r=Number(t.slice(0,o)),i=n-o;if(!Number.isFinite(r))return Number.POSITIVE_INFINITY;let s=r*Math.pow(10,i);return Number.isFinite(s)?s:Number.POSITIVE_INFINITY}function cn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function Hl(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function Ch(e){if(!e||typeof e!="object")return 0;if(cn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function uS(e){return!e||typeof e!="object"?0:cn(e)||typeof e.cmp=="function"&&e.cmp(_h)>=0?Number.POSITIVE_INFINITY:Ch(e)}function Ih(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(lS,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(ha())??c.fromInt(0):n}function fS(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(Lh,18)}function dS(e){if(cn(e)||typeof e.cmp=="function"&&e.cmp(_h)>=0)return mt.clone?.()??mt;let t=e.floorToInteger(),n=e.sub(t),o=Ch(n);if(!Number.isFinite(o))return mt.clone?.()??mt;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return mt.clone?.()??mt;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function Mh(e){if(!e||typeof e!="object")return mt.clone?.()??mt;let n=fS(e),o=dS(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return mt.clone?.()??mt;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function kh(){let e=cn(H.xpLevel),t=cn(H.progress);if(!e&&!t)return!1;let n=mt.clone?.()??mt;if(H.xpLevel=n.clone?.()??n,H.progress=n.clone?.()??n,wt=n.clone?.()??n,O?.books)try{typeof O.books.set=="function"?O.books.set(n.clone?.()??n):typeof O.books.add=="function"&&O.books.add(n.clone?.()??n)}catch{}return!0}function da(e={}){ma.size!==0&&ma.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Vl(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return ma.add(n),()=>{ma.delete(n)}}function Ot(){return c.fromInt(0)}function ha(){return c.fromInt(1)}function Fi(e){if(!e)return Ot();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ot()}}function Xl(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function pS(){for(;Tf.length>0;){let e=Tf.pop();try{e?.()}catch{}}}function Eh(e){if(e==null)return Ot();try{return c.fromAny(e)}catch{return Ot()}}function Lf(e){if(!xf){xf=!0;try{let t=Af??v(),n={unlocked:H.unlocked,xpLevel:Fi(H.xpLevel),progress:Fi(H.progress),requirement:Fi(wt)};jt(!0),eo(),Sn(!0);let o={unlocked:H.unlocked,xpLevel:Fi(H.xpLevel),progress:Fi(H.progress),requirement:Fi(wt)},r=n.unlocked!==o.unlocked,i=!Xl(n.xpLevel,o.xpLevel),s=!Xl(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ot();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ot()}catch{l=Ot()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||ma.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(da(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{xf=!1}}}function _f(e){if(e===Af||(pS(),Af=e??null,e==null))return;let t=(n,o)=>{let r=_t(n,o);typeof r=="function"&&Tf.push(r)};t(ua(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>Lf("unlock")}),t(Gr(e),{parse:Eh,equals:Xl,onChange:()=>Lf("xpLevel")}),t(Di(e),{parse:Eh,equals:Xl,onChange:()=>Lf("progress")})}function Th(){if(wh){_f(v());return}wh=!0,_f(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{_f(v()),jt(!0),eo(),Sn(!0)})}function Cf(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function ga(e){if(!e||typeof e!="object")return Number.NEGATIVE_INFINITY;if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return Number.POSITIVE_INFINITY;if(e.isZero?.()||typeof e.isZero=="function"&&e.isZero())return Number.NEGATIVE_INFINITY;let t=e.sig,n=typeof e.e=="number"?e.e:Number(e.e??0),o=typeof e._eOffset=="bigint"?cS(e._eOffset):Number(e._eOffset??0);if(!Number.isFinite(n))return n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(!Number.isFinite(o))return o>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let r=n+o;if(!Number.isFinite(r))return r>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;let i=0;if(typeof t=="bigint"){let l=t.toString().replace(/^0+/,"");if(!l)return Number.NEGATIVE_INFINITY;let a=l.length,u=Math.min(a,15),d=l.slice(0,u),f=Number.parseFloat(d);Number.isFinite(f)&&f>0?i=Math.log10(f)+(a-u):i=a-1}else try{let s=typeof e.toScientific=="function"?e.toScientific(12):String(e);if(!s||s==="0")return Number.NEGATIVE_INFINITY;if(s==="Infinity")return Number.POSITIVE_INFINITY;let l=s.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(l){let a=parseFloat(l[1]),u=parseInt(l[2],10)||0;if(!(a>0)||!Number.isFinite(a))return Number.NEGATIVE_INFINITY;i=Math.log10(a)+u}else{let a=Number(s);if(!Number.isFinite(a)||a<=0)return Number.NEGATIVE_INFINITY;i=Math.log10(a)}}catch{return Number.NEGATIVE_INFINITY}return r+i}function mS(e){let t=e<Sh?e:Sh;if(t<=Ui)return;let n=Ui,o=cr.get(n.toString());for(o||(o=c.fromInt(10),cr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),cr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){Ui=n;return}}Ui=n}function hS(e){if(!Number.isFinite(e)||e>=c.MAX_E)return mt.clone?.()??mt;let t=Math.floor(e),n=e-t;Number.isFinite(n)||(n=0);let o=Math.pow(10,n);(!Number.isFinite(o)||o<=0)&&(o=1),o>=10&&(o/=10,t+=1);let r;try{r=Number.isFinite(t)?t.toLocaleString("en",{useGrouping:!1}):String(t)}catch{r=String(t)}let i=`${o.toPrecision(18)}e${r}`;try{return c.fromScientific(i).floorToInteger()}catch{return mt.clone?.()??mt}}function gS(e){let t=Ui>0n?Ui:0n,n=cr.get(t.toString());if(!n||cn(n))return mt.clone?.()??mt;let o=c.fromAny(t.toString()),r=ga(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);Hl(s)||(i=i.add?.(s.mulDecimal(Lh,18))??i);let l=Ih(e),a=Ih(o),u=l.sub?.(a)??c.fromInt(0);Hl(u)||(i=i.add?.(u.mulDecimal(aS,18))??i);let d=uS(i);return Number.isFinite(d)?hS(d):mt.clone?.()??mt}function yS(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=cn(t),o=cn(e);if(n)return o?1:0;if(Hl(t)||Hl(e))return 0;let s=ga(e),l=ga(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Ah(){return bn.container&&bn.container.isConnected?!0:(bn.container=document.querySelector(".xp-counter[data-xp-hud]"),bn.container?(bn.bar=bn.container.querySelector(".xp-bar"),bn.fill=bn.container.querySelector(".xp-bar__fill"),bn.xpLevelValue=bn.container.querySelector(".xp-level-value"),bn.progress=bn.container.querySelector("[data-xp-progress]"),!0):!1)}function Nh(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=cr.get("0");return a.clone?.()??a}if(r.bigInt!=null){mS(i);let a=i.toString(),u=cr.get(a);if(u)return u.clone?.()??u}let s=gS(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?mt.clone?.()??mt:(r.bigInt!=null&&cr.set(r.bigInt.toString(),s),s.clone?.()??s)}function Oo(){wt=Nh(H.xpLevel)}function Yl(){H.xpLevel=Ot(),H.progress=Ot(),Oo(),Sn(!0)}function xh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function Wl(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function Sn(e=!1){let t=O?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=Wl(H.xpLevel),o=n.bigInt,r=!n.finite,i=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null;if(!e&&(r&&$n||!r&&o!=null&&!$n&&!qn&&Dn!=null&&o===Dn||!r&&o==null&&qn&&i&&Gn&&i===Gn))return;if(r){try{t.set(mt)}catch{}Dn=null,$n=!0,qn=!1,Gn=null;return}let s;if(o!=null&&o<=kf){let d=c.fromInt(1),f=Number(o);for(let g=0;g<f;g+=1)d=d.mulDecimal("1.1",18);let p;try{p=c.fromAny(o.toString())}catch{p=c.fromInt(f)}typeof d.add=="function"?d=d.add(p):typeof p.add=="function"&&(d=p.add(d)),s=d.clone?.()??d}else s=Mh(H.xpLevel);let l=s.clone?.()??s,a=ur.size>0?Array.from(ur):typeof Hr=="function"?[Hr]:[];for(let d of a)if(typeof d=="function")try{let f=d({baseMultiplier:l.clone?.()??l,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});f instanceof c?l=f.clone?.()??f:f!=null&&(l=c.fromAny(f))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Dn=null,$n=!0,qn=!1,Gn=null):o!=null&&o<=kf?(Dn=o,$n=!1,qn=!1,Gn=null):(Dn=null,$n=!1,qn=!0,Gn=i)}function jt(e=!1){let t=v();if(t==null)return fa=null,Ef=!1,H.unlocked=!1,Yl(),H;if(!e&&Ef&&t===fa)return H;fa=t,Ef=!0;try{let n=localStorage.getItem(ua(t));H.unlocked=n==="1"}catch{H.unlocked=!1}try{H.xpLevel=c.fromAny(localStorage.getItem(Gr(t))??"0")}catch{H.xpLevel=Ot()}try{H.progress=c.fromAny(localStorage.getItem(Di(t))??"0")}catch{H.progress=Ot()}return(cn(H.xpLevel)||cn(H.progress))&&(H.unlocked=!0),H.unlocked?(kh(),Oo(),Sn(!0),Th(),H):(Yl(),H)}function pa(){let e=v();if(e==null)return;let t={unlocked:H.unlocked?"1":"0",level:H.xpLevel.toStorage(),progress:H.progress.toStorage()};try{localStorage.setItem(ua(e),t.unlocked)}catch{}try{localStorage.setItem(Gr(e),t.level)}catch{}try{localStorage.setItem(Di(e),t.progress)}catch{}let n=(()=>{let r=H.unlocked,i=H.xpLevel,s=H.progress;try{r=localStorage.getItem(ua(e))==="1"}catch{}try{let l=localStorage.getItem(Gr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(Di(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();rt(ua(e),n.unlocked?"1":"0"),rt(Gr(e),n.level?.toStorage?.()??t.level),rt(Di(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==H.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(H.unlocked=n.unlocked,H.xpLevel=n.level,H.progress=n.progress,Oo(),Sn(!0),eo())}function vS(){Sn(!0);let e=ha();if(typeof Mf=="function")try{let n=Mf({baseReward:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{O?.books?.addWithMultiplier?O.books.addWithMultiplier(e):O?.books?.add&&O.books.add(e)}catch{}let t=Wl(H.xpLevel);t.finite?t.bigInt!=null?(Dn=t.bigInt,$n=!1,qn=!1,Gn=null):(Dn=null,$n=!1,qn=!0,Gn=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Dn=null,$n=!0,qn=!1,Gn=null)}function eo(){if(!Ah())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=bn;if(!e)return;if(!H.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=J(wt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Cf(J(wt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}Bi();return}e.removeAttribute("hidden");let i=wt,s=yS(H.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=J(H.xpLevel)),r){let a=J(H.progress),u=J(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Cf(J(H.progress)),u=Cf(J(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}Bi()}function $i({forceReload:e=!1}={}){return Ah(),jt(e),Oo(),eo(),Th(),Qe()}function Yr(){if(jt(),H.unlocked)return eo(),!1;Yl(),H.unlocked=!0,pa(),eo(),Sn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Qe()}))}catch{}return!0}function qi({keepUnlock:e=!0}={}){jt();let t=H.unlocked;return Yl(),H.unlocked=e?t||H.unlocked:!1,pa(),eo(),Sn(!0),Qe()}function Gi(e,{silent:t=!1}={}){jt();let n=fa??v();if(n!=null&&xh(Di(n)))return{unlocked:H.unlocked,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,progress:H.progress,requirement:wt,slot:n};if(!H.unlocked)return{unlocked:!1,xpLevelsGained:Ot(),xpAdded:Ot(),xpLevel:H.xpLevel,requirement:wt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ot()}if(!o.isZero?.()){let f=fr.size>0?Array.from(fr):typeof Xr=="function"?[Xr]:[];for(let p of f)if(typeof p=="function")try{let g=p({baseGain:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});g instanceof c?o=g.clone?.()??g:g!=null&&(o=c.fromAny(g))}catch{}}if(o=Xn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return eo(),{unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,requirement:wt};H.progress=H.progress.add(o),Oo();let r=n!=null&&xh(Gr(n)),i=cn(H.progress),s=cn(H.xpLevel),l=cn(o);if(i||s||l){let f=mt.clone?.()??mt;r||(H.xpLevel=f.clone?.()??f),H.progress=f.clone?.()??f,Oo(),kh(),pa(),eo(),Sn(!0);let p={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:wt.clone?.()??wt,slot:n};if(da(p),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:p}))}catch{}return p}let a=Ot();if(H.progress.cmp(wt)<0){pa(),eo();let f={unlocked:!0,xpLevelsGained:Ot(),xpAdded:o,xpLevel:H.xpLevel,progress:H.progress,requirement:wt,slot:n};if(da(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}if(!r){let f=ga(H.progress),p=.08118668602542883,g=ga(wt);if(f-g>2){let h=H.xpLevel,b=f-g,E=Math.floor(b/p);if(E>500){let L=BigInt(Math.max(0,E-5));if(L>0n){let R=c.fromAny(L.toString());if(H.xpLevel=H.xpLevel.add(R),a=a.add(R),Oo(),O?.books?.add)try{let T=R.clone();O.books.add(T)}catch{}}}}let m=0,y=500;for(;H.progress.cmp?.(wt)>=0&&m<y&&(H.progress=H.progress.sub(wt),H.xpLevel=H.xpLevel.add(ha()),a=a.add(ha()),vS(),Oo(),!cn(wt));)m+=1;m>=y&&H.progress.cmp(wt)>=0&&Oo()}pa(),eo();let u=Wl(H.xpLevel);u.finite?u.bigInt!=null?(Dn=u.bigInt,$n=!1,qn=!1,Gn=null):(Dn=null,$n=!1,qn=!0,Gn=typeof H.xpLevel?.toStorage=="function"?H.xpLevel.toStorage():null):(Dn=null,$n=!0,qn=!1,Gn=null);let d={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:wt.clone?.()??wt,slot:n};if(da(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}function Qe(){return jt(),{unlocked:H.unlocked,xpLevel:H.xpLevel.clone?.()??H.xpLevel,progress:H.progress.clone?.()??H.progress,requirement:wt.clone?.()??wt}}function zl(e={}){jt();let t=fa??v(),n={...Qe(),slot:t,...e};if(da(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function un(){return jt(),!!H.unlocked}function Kl(e){return Nh(e)}function jl(){jt();let e=ha(),t=fr.size>0?Array.from(fr):typeof Xr=="function"?[Xr]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:H.xpLevel.clone?.()??H.xpLevel,xpUnlocked:H.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function Rf(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=Wl(t),o=n.bigInt;if(!n.finite)return mt.clone?.()??mt;let i;if(o!=null&&o<=kf){let a=c.fromInt(1),u=Number(o);for(let f=0;f<u;f+=1)a=a.mulDecimal("1.1",18);let d;try{d=c.fromAny(o.toString())}catch{d=c.fromInt(u)}typeof a.add=="function"?a=a.add(d):typeof d.add=="function"&&(a=d.add(a)),i=a.clone?.()??a}else i=Mh(t);let s=i.clone?.()??i,l=ur.size>0?Array.from(ur):typeof Hr=="function"?[Hr]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!H.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function Rh(e){Hr=typeof e=="function"?e:null,ur.clear(),Hr&&ur.add(Hr),jt(),Sn(!0)}function Zt(){jt(),Sn(!0)}function Oh(e){Xr=typeof e=="function"?e:null,fr.clear(),Xr&&fr.add(Xr)}function Po(e){return typeof e!="function"?()=>{}:(ur.add(e),jt(),Sn(!0),()=>{ur.delete(e),jt(),Sn(!0)})}function dr(e){return typeof e!="function"?()=>{}:(fr.add(e),jt(),()=>{fr.delete(e)})}function Zl(e){Mf=typeof e=="function"?e:null}var Nf,ua,Gr,Di,fa,Ef,wt,cr,Ui,mt,Dn,$n,qn,Gn,Hr,Xr,ur,fr,Mf,Sh,c1,u1,kf,Lh,aS,lS,_h,H,ma,bn,Tf,wh,Af,xf,Hn=$e(()=>{Ct();St();Hi();Kt();wf();Nf="ccc:xp",ua=e=>`${Nf}:unlocked:${e}`,Gr=e=>`${Nf}:level:${e}`,Di=e=>`${Nf}:progress:${e}`;fa=null,Ef=!1,wt=c.fromInt(10),cr=new Map;cr.set("0",wt);Ui=0n,mt=c.fromAny("Infinity"),Dn=null,$n=!1,qn=!1,Gn=null,Hr=null,Xr=null,ur=new Set,fr=new Set,Mf=null,Sh=5000n,c1=Math.log10(11/10),u1=Math.log10(5/2),kf=200n,Lh="0.04139268515822507",aS="0.3979400086720376",lS="0.1",_h=c.fromScientific(String(c.MAX_E));H={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};ma=new Set;bn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};Tf=[],wh=!1,Af=null,xf=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:$i,unlockXpSystem:Yr,addXp:Gi,getXpState:Qe,broadcastXpChange:zl,isXpSystemUnlocked:un,getXpRequirementForXpLevel:Kl,getXpGainMultiplier:jl,setExternalCoinMultiplierProvider:Rh,addExternalCoinMultiplierProvider:Po,refreshCoinMultiplierFromXpLevel:Zt,setExternalXpGainMultiplierProvider:Oh,addExternalXpGainMultiplierProvider:dr,setExternalBookRewardProvider:Zl,resetXpProgress:qi}))});var Gh={};bt(Gh,{GHOST_TAP_TIMEOUT_MS:()=>bS,clearGhostTapTarget:()=>ya,consumeGhostTapGuard:()=>qh,initGlobalGhostTap:()=>kS,installGhostTapGuard:()=>MS,markGhostTapTarget:()=>$h,setGhostTapSelector:()=>TS,shouldSkipGhostTap:()=>to,suppressNextGhostTap:()=>So});function Fo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Bf(){return typeof document>"u"?null:document}function wS(e){if(!Bf())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(Pf)}function ya(e){e&&(e[Jl]=0)}function $h(e,t=0,n=null){if(!e)return;let o=Fo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[Jl]=o+r:e[Jl]=0,IS=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&So(i)}function qh(e){if(typeof window>"u")return!1;let t=window[Xi];return typeof t!="number"?!1:Fo()<=t?!0:(window[Xi]=null,!1)}function to(e){if(!e)return!1;let t=Number(e[Jl]||0);return!Number.isFinite(t)||t<=0?!1:Fo()<=t?(ya(e),!0):(ya(e),!1)}function So(e=0){if(typeof window>"u")return;let t=Fo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[Xi]=null;return}let o=t+n,r=typeof window[Xi]=="number"?window[Xi]:0;window[Xi]=Math.max(r,o)}function ES(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(ec=pr=Fo(),Bo=0))}function xS(e){ec=pr=Fo(),Bo=0}function LS(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Fo();pr>0&&(Bo=t-pr),ec=t}function _S(){let e=Fo();pr>0&&(Bo=e-pr),ec=e}function CS(e){if(!e.isTrusted)return;let t=Fo(),n=pr>0?t-pr:-1,o=wS(e.target);if(to(o)){Bo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(qh(o)){o&&ya(o),Bo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Bo||n)>=Dh){ya(o),Bo=0,e.preventDefault(),e.stopImmediatePropagation();return}Bo=0}function MS(e={}){if(Bh)return;let t=Bf();!t||typeof window>"u"||(Bh=!0,Of="PointerEvent"in window,Fh=!Of&&"ontouchstart"in window,e.selector&&(Pf=`${e.selector}, ${Ql}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(Dh=e.longPressMs),t.addEventListener("click",CS,!0),Of?(t.addEventListener("pointerdown",ES,{capture:!0,passive:!1}),t.addEventListener("pointerup",LS,{capture:!0,passive:!0})):Fh&&(t.addEventListener("touchstart",xS,{capture:!0,passive:!1}),t.addEventListener("touchend",_S,{capture:!0,passive:!0})))}function Uh(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Ql);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&($h(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function kS(){let e=Bf();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",Uh,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",Uh,{capture:!1,passive:!1})}function TS(e){e&&(Pf=`${e}, ${Ql}`)}var bS,Jl,Xi,Ql,SS,Bh,Pf,Of,Fh,IS,ec,pr,Bo,Dh,Yi=$e(()=>{bS=0,Jl=Symbol("ccc:ghostTap:skipUntil"),Xi="__cccGhostTapSkipUntil",Ql='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',SS=80,Bh=!1,Pf=Ql,Of=!1,Fh=!1,IS=null,ec=0,pr=0,Bo=0,Dh=SS});var Ff,Hh=$e(()=>{Ff={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var Xh={};bt(Xh,{RateAccumulator:()=>ba,pauseGameLoop:()=>Gf,registerFrame:()=>PS,registerTick:()=>Io,resumeGameLoop:()=>Hf,startGameLoop:()=>RS,stopGameLoop:()=>OS});function $f(e){e||(e=performance.now());let t=e;if(qf){Vr=t,zr=requestAnimationFrame($f);return}Vr||(Vr=t);let n=(t-Vr)/1e3;Vr=t,n>60&&(n=60),n<0&&(n=0),Wr+=n;let o=0,r=250;for(;Wr>=va;){if(o>=r){Wr=Wr%va;break}Uf.forEach(i=>{try{i(va)}catch(s){console.error("Error in game tick listener:",s)}}),Wr-=va,o++}if(Df.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),Vi===0||Wi===0)Vi=Date.now(),Wi=t;else{let i=t-Wi;if(i>NS){let s=Date.now(),l=s-Vi;l<-1e3?vn():l>i+1e4&&vn(),Vi=s,Wi=t}}zr=requestAnimationFrame($f)}function Gf(){qf=!0}function Hf(){qf=!1,Vr=performance.now(),Wr=0,Vi=0,Wi=0}function RS(){zr||(Vr=performance.now(),Wr=0,Vi=0,Wi=0,zr=requestAnimationFrame($f))}function OS(){zr&&(cancelAnimationFrame(zr),zr=null)}function Io(e){return typeof e!="function"?()=>{}:(Uf.add(e),()=>{Uf.delete(e)})}function PS(e){return typeof e!="function"?()=>{}:(Df.add(e),()=>{Df.delete(e)})}var AS,va,Uf,Df,zr,qf,Vr,Wr,Vi,Wi,NS,ba,Kr=$e(()=>{St();AS=20,va=1/AS,Uf=new Set,Df=new Set,zr=null,qf=!1,Vr=0,Wr=0,Vi=0,Wi=0,NS=2e3;ba=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*va;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ke,jr,Sa,Ia,wa,Ea,no,zi,BS,Yh,Zr=$e(()=>{Ct();Ke="automation",jr=1,Sa=2,Ia=3,wa=4,Ea=5,no=6,zi={[Sa]:"coins",[Ia]:"books",[wa]:"gold",[Ea]:"magic"},BS=[{area:Ke,id:jr,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ke,id:Sa,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ke,id:Ia,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ke,id:wa,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ke,id:Ea,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ke,id:no,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}}],Yh=BS.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});var Qh={};bt(Qh,{getGearsProductionRate:()=>rc,getGenerationLevelKey:()=>ei,getGenerationUpgradeCost:()=>mr,initWorkshopSystem:()=>Jh,initWorkshopTab:()=>Zf,performFreeGenerationUpgrade:()=>ic,updateWorkshopTab:()=>oo});function ji(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*HS}function ei(e){return`ccc:workshop:genLevel:${e}`}function _a(){let e=v();if(!e)return c.zero();let t=localStorage.getItem(ei(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function Ma(e){let t=v();if(!t)return!1;let n=ei(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function ka(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let f=e.toPlainIntegerString();t=parseFloat(f)}catch{return 1/0}if(t<=0)return Yf;if(t<=Jr)return Yf+t*Wh;nc===null&&(nc=Yf+Jr*Wh);let n=t-Jr;if(t<=xa)return nc+n+ji(n,Ki);if(oc===null){let f=xa-Jr;oc=nc+f+ji(f,Ki)}let o=t-xa,r=t-Jr,i=xa-Jr,s=o+(ji(r,Ki)-ji(i,Ki)),l=$S/DS,a=.5*l*o*o;if(t<=tc)return oc+s+a;if(Wf===null){let f=tc-xa,p=tc-Jr,g=f+(ji(p,Ki)-ji(i,Ki)),m=.5*l*f*f;Wf=oc+g+m}let u=qS*(t-tc);if(u>709)return 1/0;let d=Wf*Math.exp(u);return!Number.isFinite(d)||d>179e306?1/0:d}function mr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=ka(t);return Te(n)}function jf(e){let t,n=e;if(e instanceof c||(n=c.fromAny(e)),n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let r=n.mulDecimal(Vf);if(n.cmp(9e15)<=0){let s=Number(n.toString())*Vf;t=Te(s)}else{let i=n.mulDecimal(Vf);if(i.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let s=Number(i.toScientific(10));s===1/0?t=c.fromAny("Infinity"):t=Te(s)}catch{t=c.fromAny("Infinity")}}}let o=O?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(o)}function VS(){let e=mr(et);if(O.coins.value.cmp(e)<0)return;let t=et.add(1);Ma(t)&&(et=t,O.coins.sub(e),oo(),Qt())}function WS(){if(!$t())return;let n=jf(et).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&O.gears&&O.gears.add(n),et.cmp(20)<0){let r=Number(et.toPlainIntegerString()),s=Math.pow(2,r)/20,l=Math.floor(s),a=s-l;if(Qr+=a,Qr>=1){let u=Math.floor(Qr);Qr-=u,O.gears&&O.gears.add(u)}}else Qr=0}function Kf(){O.gears&&O.gears.set(0),Ma(c.zero())&&(et=c.zero()),Qr=0,oo()}function Kh(e){if(!e)return;let t=Ca.get(e);if(!t){let s=e.getBoundingClientRect();t={gears:[],width:s.width,height:s.height,needsDistribution:!s.width||!s.height},Ca.set(e,t)}let n=e.getBoundingClientRect();n.width>0&&n.height>0&&(t.width=n.width,t.height=n.height);let o=0;et.cmp(Xf)>0?o=Xf:o=Number(et.toPlainIntegerString());let r=Math.min(Math.floor(o),Xf),i=t.gears;for(;i.length<r;){let s=document.createElement("img");s.src=jh,s.classList.add("workshop-bg-gear"),s.alt="",s.setAttribute("aria-hidden","true");let l=32+Math.random()*48,a=0,u=0;t.width>0&&t.height>0?(a=Math.random()*(t.width-l),u=Math.random()*(t.height-l),a<0&&(a=0),u<0&&(u=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,f=Math.cos(d)*zh,p=Math.sin(d)*zh,g=Math.random()*360,m=(Math.random()<.5?-1:1)*(XS+Math.random()*YS);s.style.width=`${l}px`,s.style.transform=`translate3d(${a}px, ${u}px, 0) rotate(${g}deg)`,s.style.willChange="transform",e.appendChild(s),i.push({element:s,x:a,y:u,dx:f,dy:p,rotation:g,rotationSpeed:m,size:l})}for(;i.length>r;){let s=i.pop();s.element.parentNode&&s.element.parentNode.removeChild(s.element)}}function zS(e){let t="Click the big red button below to open the Automation Shop";je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${FS}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${jh}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will double the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${US}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{VS()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),jS()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{sc("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(Jt&&Jt.isConnected){let a=Jt.querySelector(".workshop-side-left"),u=Jt.querySelector(".workshop-side-right"),d=f=>{if(!f)return;let p=Ca.get(f);if(p){let g=f.getBoundingClientRect();if(p.width=g.width,p.height=g.height,p.needsDistribution&&p.width>0&&p.height>0){p.needsDistribution=!1;for(let m of p.gears)m.x=Math.random()*(p.width-m.size),m.x<0&&(m.x=0),m.y=Math.random()*(p.height-m.size),m.y<0&&(m.y=0),m.element.style.transform=`translate3d(${m.x}px, ${m.y}px, 0) rotate(${m.rotation}deg)`}}};d(a),d(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Zh():KS()},{root:null,threshold:0}).observe(e),Jt=e}function oo(){if(!Jt)return;let e=Jt.querySelector('[data-workshop="gears-amount"]'),t=Jt.querySelector('[data-workshop="gears-rate"]'),n=Jt.querySelector('[data-workshop="upgrade-cost"]'),o=Jt.querySelector('[data-workshop="upgrade-gen"]'),r=jf(et),i=mr(et);if(e&&(e.innerHTML=O.gears.fmt(O.gears.value)),t&&(t.innerHTML=J(r)),n){let l="Coins";try{l=!i.isInfinite()&&i.cmp(1)===0?"Coin":"Coins"}catch{}n.innerHTML=`${J(i)} ${l}`}if(o){let l=O.coins.value.cmp(i)>=0;o.disabled=!l;let a=Mt(Ke,no),u=!1;if(a>0){let d=v(),f=d!=null?`:${d}`:"",p=`ccc:autobuy:${Ke}:${no}${f}`;u=localStorage.getItem(p)!=="0"}u?o.classList.add("is-automated"):o.classList.remove("is-automated")}let s="";if(et.isInfinite()?s="Infinity":s=et.floorToInteger().toStorage(),s!==zf){zf=s;let l=Jt.querySelector(".workshop-side-left"),a=Jt.querySelector(".workshop-side-right");l&&Kh(l),a&&Kh(a)}}function KS(){Zi&&(cancelAnimationFrame(Zi),Zi=null)}function Zh(){if(Zi)return;La=0;let e=t=>{if(Jt&&Jt.isConnected){let n=Jt.querySelector('[data-workshop="gears-amount"]');n&&(n.innerHTML=O.gears.fmt(O.gears.value)),La||(La=t);let o=(t-La)/1e3;La=t,o>.1&&(o=.1);for(let[r,i]of Ca){if(!r.isConnected)continue;let{gears:s,width:l,height:a}=i;if(!(!l||!a))for(let u of s)u.x+=u.dx*o,u.y+=u.dy*o,u.x<0?(u.x=0,u.dx=-u.dx):u.x+u.size>l&&(u.x=l-u.size,u.dx=-u.dx),u.y<0?(u.y=0,u.dy=-u.dy):u.y+u.size>a&&(u.y=a-u.size,u.dy=-u.dy),u.rotation+=u.rotationSpeed*o,u.element.style.transform=`translate3d(${u.x}px, ${u.y}px, 0) rotate(${u.rotation}deg)`}}Zi=requestAnimationFrame(e)};Zi=requestAnimationFrame(e)}function Jh(){Vh||(Vh=!0,et=_a(),Io(WS),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{et=_a(),Qr=0,$t()||Kf(),oo()}),window.addEventListener("currency:change",e=>{e.detail.key===Ce.COINS&&oo()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Ce.GEARS&&oo()}),window.addEventListener("debug:change",()=>{et=_a(),oo()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&($t()||Kf())})))}function Zf(e){Jh(),!e.__workshopInit&&(e.__workshopInit=!0,et=_a(),Ca.clear(),zf=-1,zS(e),typeof IntersectionObserver>"u"&&Zh(),$t()||Kf(),oo())}function rc(){let e=_a();return jf(e)}function ic(){let e=O.coins.value.isInfinite(),n=mr(et).isInfinite();if(e&&n&&!et.isInfinite())return et=c.fromAny("Infinity"),Ma(et),oo(),!0;if(O.coins.value.isZero())return!1;let o=qe(O.coins.value);if(!Number.isFinite(o))if(O.coins.value.inf)o=1/0;else return!1;if(ka(et)>o||et.cmp(9e15)>0)return!1;let r=Number(et.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);ka(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(et)>0&&Ma(a)?(et=a,oo(),!0):!1}function jS(){if(O.coins.value.isInfinite()){ic()&&Qt();return}let e=qe(O.coins.value);if(!Number.isFinite(e)&&O.coins.value.isZero()||ka(et)>e||et.cmp(9e15)>0)return;let t=Number(et.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);ka(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(et.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(mr(c.fromInt(u)));if(l.cmp(O.coins.value)>0){let u=mr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(et)>0&&Ma(a)&&(et=a,O.coins.sub(l),oo(),Qt())}var jh,FS,US,Xf,Jt,Vh,Qr,et,zf,Zi,Yf,Vf,Jr,xa,tc,Wh,Ki,DS,$S,qS,GS,HS,nc,oc,Wf,Ca,zh,XS,YS,La,Ji=$e(()=>{Ct();Kt();St();Kr();ti();wo();fn();Eo();Zr();jh="img/currencies/gear/gear.webp",FS="img/currencies/gear/gear_plus_base.webp",US="img/currencies/coin/coin.webp",Xf=100,Jt=null,Vh=!1,Qr=0,et=c.zero(),zf=-1,Zi=null,Yf=12,Vf=.3010299956639812,Jr=1e6,xa=1e9,tc=1e12,Wh=1,Ki=.001,DS=1e3,$S=Math.log10(1.00001),qS=23e-11,GS=Math.log(10),HS=1/GS;nc=null,oc=null,Wf=null;Ca=new Map,zh=67,XS=67,YS=67;La=0});function Uo(e){return Ta.nodes[e]||(Ta.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),Ta.nodes[e]}function ZS(e,t){let n=Uo(t);try{let o=localStorage.getItem(ac(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(lc(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(og(e,t));n.active=i==="1";let s=localStorage.getItem(rg(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function eg(){let e=v();Ta.nodes={},e!=null&&It.forEach(t=>ZS(e,t.id))}function tg(){let e=v();e!=null&&It.forEach(t=>{let n=Ta.nodes[t.id];if(n)try{localStorage.setItem(lc(e,t.id),n.rp.toStorage())}catch{}})}function Pt(e){return Uo(e).level}function hr(e,t){let n=v();if(n==null)return;let o=Uo(e);o.level=t;try{localStorage.setItem(ac(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}}function ro(e){return Uo(e).rp}function Qi(e,t){let n=Uo(e);n.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:n.rp}}))}catch{}}function Do(e){return Uo(e).active}function Na(e,t){let n=v();if(n==null)return;t&&It.forEach(r=>{r.id!==e&&Do(r.id)&&Na(r.id,!1)});let o=Uo(e);o.active=!!t;try{localStorage.setItem(og(n,e),o.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:o.active}}))}catch{}}function ng(e,t){let n=v();if(n==null)return;let o=Uo(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(rg(n,e),o.discovered?"1":"0")}catch{}}}function gr(e){let t=It.find(o=>o.id===e);if(!t)return!1;if(Uo(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return ng(e,!0),!0;for(let o of t.parentIds){let r=It.find(s=>s.id===o);if(!r)continue;if(Pt(o)<r.maxLevel)return!1}return ng(e,!0),!0}function Aa(e){let t=It.find(u=>u.id===e);if(!t)return c.fromAny("Infinity");let n=Pt(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=Math.log10(t.scale),i=Math.log10(t.baseRpReq)+n*o,s=Math.floor(i),l=i-s,a=Math.pow(10,l);return new c(BigInt(Math.round(a*1e14)),{base:s,offset:-14n})}function In(){let e=Pt(1);return e<=0?0:e*.01}function ig(){return Pt(4)>=1}function sg(e=[]){if(v()!=null){try{oi(0)}catch{}It.forEach(n=>{e.includes(n.id)||(hr(n.id,0),Qi(n.id,c.fromInt(0)),Na(n.id,!1))})}}function ag(e){let t=es();if(t.isZero?.())return;let o=t.mulDecimal(e.toString(),18);It.forEach(r=>{if(gr(r.id)&&Do(r.id)){let i=ro(r.id),s=Aa(r.id);if(Pt(r.id)>=r.maxLevel)return;let l=i.add(o);for(;;){let a=Aa(r.id);if(l.cmp(a)<0||Pt(r.id)>=r.maxLevel)break;l=l.sub(a);let u=Pt(r.id);hr(r.id,u+1)}Qi(r.id,l)}})}function Jf(){let e=It.find(o=>o.id===2);if(!e)return c.fromInt(1);let t=Pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.5,t);return c.fromAny(n)}function Qf(){let e=It.find(o=>o.id===3);if(!e)return c.fromInt(1);let t=Pt(e.id);if(t<=0)return c.fromInt(1);let n=Math.pow(1.5,t);return c.fromAny(n)}function lg(){Po(({baseMultiplier:e})=>{let t=Jf();return e.mulDecimal(t.toScientific())}),dr(({baseGain:e})=>{let t=Qf();return e.mulDecimal(t.toScientific())}),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&Zt()})}var ac,lc,og,rg,It,Ta,ni=$e(()=>{Ct();St();ri();Hn();ac=(e,t)=>`ccc:lab:node:level:${t}:${e}`,lc=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,og=(e,t)=>`ccc:lab:node:active:${t}:${e}`,rg=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,It=[{id:1,title:"Tsunami Exponent Restoration",desc:"Increases the Tsunami exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[]},{id:2,title:"Experimental Coin Value",desc:"Multiplies Coin value by 1.5x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp"},{id:3,title:"Experimental XP Value",desc:"Multiplies XP value by 1.5x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp"},{id:4,title:"Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3]}],Ta={nodes:{}};typeof window<"u"&&(window.addEventListener("saveSlot:change",eg),setInterval(tg,1e3),window.addEventListener("beforeunload",tg),eg());window.RESEARCH_NODES=It;window.isResearchNodeVisible=gr});var mg={};bt(mg,{getBookProductionRate:()=>br,getSurge6WealthMultipliers:()=>cc,getTsunamiNerf:()=>Ft,getTsunamiNerfKey:()=>td,getTsunamiSequenceSeen:()=>wn,initSurgeEffects:()=>eI,isSurgeActive:()=>ht,setTsunamiNerf:()=>ns,setTsunamiSequenceSeen:()=>vr});function td(e){return ed(e)}function wn(){let e=v();if(e==null)return!1;try{return localStorage.getItem(pg(e))==="1"}catch{return!1}}function vr(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(pg(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Ft(){return yr}function ns(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=v();if(n!=null){let o=ed(n);if(ln(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}yr=t,ts();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function ht(e){return io===1/0||typeof io=="string"&&io==="Infinity"||io===Number.POSITIVE_INFINITY?!0:typeof io=="bigint"?io>=BigInt(e):typeof io=="number"?io>=e:!1}function Ra(e){if(!ht(8))return e;let t=qe(e);if(!Number.isFinite(t))return e;let o=Ft()+In();return o>1&&(o=1),Te(t*o)}function ts(){let e=En();io=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(ht(8)){let o=Ft()+In();o>1&&(o=1);let r=Math.log10(cg);$o=Te(r*o)}else $o=c.fromInt(cg);else $o=c.fromInt(1)}function cc(){if(!ht(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(p,g=0)=>{if(!p){if(g<=0)return c.fromInt(1);let L=Math.log10(g)/3;if(L<=0)return c.fromInt(1);let R=L*Math.log10(2);return Te(R)}if(p.isInfinite?.())return c.fromAny("Infinity");let m=qe(p),y=m;if(Number.isFinite(m)){if(m<15&&g>0)try{let E=Number(p.toPlainIntegerString());if(Number.isFinite(E)){let L=E+g;L>0&&(y=Math.log10(L))}}catch{}}else if(g>0)y=Math.log10(g);else return c.fromInt(1);let h=y/6;if(h<=0)return c.fromInt(1);let b=h*Math.log10(2);return Te(b)},t=e(O.coins?.value),n=O.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(O.gold?.value),s=e(O.magic?.value),l=t,a=r,u=i,d=s;ht(8)&&(l=Ra(t),a=Ra(r),u=Ra(i),d=Ra(s));let f=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return f=f.mulBigNumInteger?f.mulBigNumInteger(u):f,f=f.mulBigNumInteger?f.mulBigNumInteger(d):f,{coins:l,books:a,gold:u,magic:d,total:f}}function br(){if(!ht(3))return c.fromInt(0);let t=Qe().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(ug),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=Te(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*ug;n=Te(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),O.books?.mult){let o=O.books.mult.get();n=n.mulBigNumInteger(o)}return ht(8)&&(n=Ra(n)),n}function JS(e){if(!ht(3))return;fg||(fg=new ba("books",O));let t=br();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);O.books&&O.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,O.books&&O.books.add(c.fromInt(o))}}}function dg(e){if(e==null)return;let t=localStorage.getItem(ed(e));t!==null?(yr=Number(t),(Number.isNaN(yr)||!Number.isFinite(yr))&&(yr=ht(8)?0:1)):ht(8)?yr=0:yr=1}function QS(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function eI(){let e=v();ts(),dg(e),ts(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=io,n=ht(8);ts();let o=io,r=ht(8);!n&&r?(ns(0),wn()||vr(!0)):r?QS(t,o)>0&&(ns(0),wn()||vr(!0)):n&&!r&&ns(1)}),window.addEventListener("lab:node:change",()=>{ts()}),window.addEventListener("saveSlot:change",()=>{dg(v()),ts()})),Po(({baseMultiplier:t})=>$o.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger($o)),dr(({baseGain:t})=>$o.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger($o)),ii(({baseGain:t})=>$o.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger($o)),ii(({baseGain:t})=>{if(!ht(4))return t;let n=c.fromInt(4444e9);if(ht(8)){let r=Ft()+In();r>1&&(r=1);let i=Math.log10(4444e9);n=Te(i*r)}return t.mulBigNumInteger(n)}),Po(({baseMultiplier:t})=>{if(!ht(6))return t;let n=cc();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),Zl(({baseReward:t})=>ht(3)?c.fromInt(0):t),Io(JS)}var cg,ug,ed,pg,$o,io,fg,yr,so=$e(()=>{Ct();St();Hn();xo();wo();Kr();fn();ni();cg=10,ug=.08685889638,ed=e=>`ccc:surge:tsunamiNerf:${e}`,pg=e=>`ccc:unlock:tsunami:${e}`;$o=c.fromInt(1),io=0n,fg=null,yr=0});var bg={};bt(bg,{getLabCost:()=>yg,getLabLevel:()=>qt,getLabLevelFromCoins:()=>vg,getLabLevelKey:()=>od,getRpMult:()=>es,getRpMultBase:()=>dc,hasVisitedLab:()=>ss,initLabLogic:()=>tI,initLabTab:()=>sd,setLabLevel:()=>oi,setLabVisited:()=>gg,updateLabLevel:()=>rd,updateLabTab:()=>ad});function ss(){let e=v();if(e==null)return!1;try{return localStorage.getItem(hg(e))==="1"}catch{return!1}}function gg(e){let t=v();if(t==null)return;let n=!!e;try{localStorage.setItem(hg(t),n?"1":"0")}catch{}}function qt(){let e=v();if(e==null)return c.fromInt(0);if(O.coins.value.isInfinite())return c.fromAny("Infinity");try{let t=localStorage.getItem(fc(e));return t?c.fromAny(t):c.fromInt(0)}catch{return c.fromInt(0)}}function oi(e){let t=v();if(t!=null)try{let n=c.fromAny(e),o=qt();if(n.cmp(o)===0)return;localStorage.setItem(fc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function yg(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function vg(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),d=s-20n+BigInt(u);return d<0n?c.fromInt(0):c.fromInt(d)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function rd(){let e=v();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(fc(e)))return;let t=O.coins.value,n=qt();if(t.isInfinite()){n.isInfinite()||oi(c.fromAny("Infinity"));return}let o=vg(t);o.cmp(n)>0&&oi(o)}function tI(){Io(rd),Io(ag),lg()}function id(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function nI(e){if(!e||typeof e!="object")return 0;if(id(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function rI(e){if(id(e)||typeof e.cmp=="function"&&e.cmp(oI)>=0)return is.clone?.()??is;let t=e.floorToInteger(),n=e.sub(t),o=nI(n);if(!Number.isFinite(o))return is.clone?.()??is;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return is.clone?.()??is;let f=BigInt(u)+l-BigInt(i),g=f%BigInt(250),m=Number(g),y=f-g;return new c(a,{base:m,offset:y})}function dc(){let e=qt();if(id(e))return c.fromAny("Infinity");let n=e.mulDecimal("0.3010299956639812",18);return rI(n)}function es(){let e=dc();return typeof Xn=="function"?Xn("rp",e):e}function sd(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",Oa&&Oa.destroy(),Oa=new nd(e))}function ad(){gg(!0),Oa&&Oa.resize()}var Sr,os,rs,hg,fc,od,is,oI,Oa,uc,nd,ri=$e(()=>{St();Eo();Ct();Kt();so();Kr();Hi();ni();ti();fn();Sr=1e308,os=1e300,rs=1e-300,hg=e=>`ccc:lab:visited:${e}`,fc=e=>`ccc:lab:level:${e}`;od=e=>fc(e);is=c.fromAny("Infinity"),oI=c.fromScientific(String(c.MAX_E));Oa=null;uc=512*.95,nd=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${J(qt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),rd()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>Sr&&(this.camX=Sr),this.camX<-Sr&&(this.camX=-Sr),this.camY>Sr&&(this.camY=Sr),this.camY<-Sr&&(this.camY=-Sr),this.zoom>os&&(this.zoom=os),this.zoom<rs&&(this.zoom=rs)}update(t){this.checkBounds();let n=qt(),o=yg(n.add(1)),r=Ft(),i=In(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${J(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${J(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let f=this.bursts.length-1;f>=0;f--){let p=this.bursts[f];p.time+=t;for(let g of p.particles)g.x+=g.vx*t,g.y+=g.vy*t,g.vx*=.95,g.vy*=.95;p.time>=p.life&&this.bursts.splice(f,1)}let a=500/this.zoom,u=0,d=0;if(this.keys.KeyW&&(d-=1),this.keys.KeyS&&(d+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||d!==0){let f=Math.sqrt(u*u+d*d);u/=f,d/=f,this.camX+=u*a*t,this.camY+=d*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,d=Math.floor(Math.log10(u)),f=Math.pow(10,d),p=(x,B)=>{if(B<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*B})`,t.lineWidth=1,t.beginPath();let M=Math.floor((this.camX-n/2/r)/x)*x,_=Math.ceil((this.camX+n/2/r)/x)*x;if((_-M)/x>1e3)return;for(let fe=M;fe<=_&&!(fe+x<=fe);fe+=x){let K=(fe-this.camX)*r+n/2;t.moveTo(K,0),t.lineTo(K,o)}let X=Math.floor((this.camY-o/2/r)/x)*x,Q=Math.ceil((this.camY+o/2/r)/x)*x;for(let fe=X;fe<=Q&&!(fe+x<=fe);fe+=x){let K=(fe-this.camY)*r+o/2;t.moveTo(0,K),t.lineTo(n,K)}t.stroke()},g=f*r,m=Math.max(0,Math.min(1,(g-15)/25));p(f,m),p(f*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let y=(0-this.camY)*r+o/2;y>=-10&&y<=o+10&&(t.moveTo(0,y),t.lineTo(n,y));let h=(0-this.camX)*r+n/2;h>=-10&&h<=n+10&&(t.moveTo(h,0),t.lineTo(h,o)),t.stroke();let b=[],E=new Map;for(let x of It)gr(x.id)&&(b.push(x),E.set(x.id,this.getNodePosition(x)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let x of b)if(x.parentIds&&x.parentIds.length>0)for(let B of x.parentIds){let M=It.find(_=>_.id===B);if(M&&E.has(M.id)){let _=E.get(M.id),X=E.get(x.id),Q=(_.x-this.camX)*r+n/2,fe=(_.y-this.camY)*r+o/2,K=(X.x-this.camX)*r+n/2,ee=(X.y-this.camY)*r+o/2;t.moveTo(Q,fe),t.lineTo(K,ee)}}t.stroke();let L=uc,R=L*r,F=L*1.6*r;for(let x of b){let B=E.get(x.id),M=(B.x-this.camX)*r+n/2,_=(B.y-this.camY)*r+o/2,X=Pt(x.id),Q=X>=x.maxLevel,fe=!0;if(M+F/2<0||M-F/2>n||_+F*.8<0||_-F/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,M-F/2,_-F/2,F,F),Q?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,M-F/2,_-F/2,F,F):Do(x.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,M-F/2,_-F/2,F,F);let ee=this.nodeImages[x.id];if(ee||(ee=new Image,ee.src="img/"+x.icon,this.nodeImages[x.id]=ee),ee.complete&&ee.naturalWidth!==0&&t.drawImage(ee,M-R/2,_-R/2,R,R),fe){let ve=Aa(x.id),he=0;if(Q)he=1;else if(ve.isInfinite?.()||typeof ve.cmp=="function"&&ve.cmp(c.fromAny("Infinity"))===0)he=0;else{let W=ro(x.id);if(W.isZero?.())he=0;else try{if(ve.isZero?.())he=1;else{let me=W.div(ve).toScientific(5);he=Number(me)}}catch{he=0}}he=Math.max(0,Math.min(1,he));let Y=F*.96,te=F*.18,$=M-Y/2,G=_+F/2+F*.05;t.fillStyle="#111",t.fillRect($,G,Y,te);let j=t.createLinearGradient($,G,$,G+te);j.addColorStop(0,"#2a5298"),j.addColorStop(1,"#1e3c72"),t.fillStyle=j,t.fillRect($,G,Y*he,te),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect($,G,Y,te),t.fillStyle="#fff",t.font=`bold ${te*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,te*.08);let le=`Level ${X}`;Q&&(le=x.maxLevel===1?"UNLOCKED":"MAXED");let ue=t.measureText(le),C=G+te/2+(ue.actualBoundingBoxAscent-ue.actualBoundingBoxDescent)/2;t.strokeText(le,$+Y/2,C),t.fillText(le,$+Y/2,C)}}let U=35,q=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let x of this.bursts){let B=(x.x-this.camX)*this.zoom+n/2,M=(x.y-this.camY)*this.zoom+o/2;for(let _=0;_<q.length;_++){let X=q[_],Q=x.time-X.delay;if(Q>0&&Q<X.dur){let fe=Q/X.dur,K=1-Math.pow(1-fe,3),ee=U*K,ve=Math.max(0,1-Math.pow(fe,2)),he=1+_*.5,Y=t.createRadialGradient(B,M,ee*.6,B,M,ee);Y.addColorStop(0,"rgba(255, 200, 50, 0)"),Y.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,ve*.15*he)})`),Y.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,ve*.2*he)})`),Y.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=Y,t.beginPath(),t.arc(B,M,ee,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let _ of x.particles)if(x.time<_.life){let X=1-x.time/_.life,Q=B+_.x,fe=M+_.y;t.fillStyle=`rgba(255, 255, 150, ${X})`,t.beginPath(),t.arc(Q,fe,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=uc/2*1.6;for(let u of It){if(!gr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=It.find(p=>p.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.textContent=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let d=document.createElement("div");d.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let p=Do(t);Na(t,!p),this.updateNodeOverlay()};let f=document.createElement("button");f.className="shop-close",f.textContent="Close",f.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},d.append(f,this.overlayToggleBtn),o.append(r,i,l,d),this.overlay.appendChild(o),document.body.appendChild(this.overlay),ld(r,o,()=>!!this.overlay,()=>f.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=It.find(l=>l.id===this.activeOverlayId);if(!t||!gr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=Pt(t.id),o=ro(t.id),r=Aa(t.id),i=Do(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.textContent=`Level ${n} / ${t.maxLevel}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(t.id===2){this.overlayBonus.style.display="";let l=Jf();this.overlayBonus.textContent=`Coin value bonus: ${lt(l)}x`}else if(t.id===3){this.overlayBonus.style.display="";let l=Qf();this.overlayBonus.textContent=`XP value bonus: ${lt(l)}x`}else if(t.id===4)this.overlayBonus.style.display="none";else{this.overlayBonus.style.display="";let l=n*.01;this.overlayBonus.textContent=`Tsunami exponent bonus: +${l.toFixed(2)}`}if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?J(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?J(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${J(o)} / ${J(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=uc/2*1.6;for(let u of It){if(!gr(u.id))continue;let d=this.getNodePosition(u),f=s-d.x,p=l-d.y;if(Math.sqrt(f*f+p*p)<=a){if(Pt(u.id)>=u.maxLevel)return;let y=Do(u.id);Na(u.id,!y),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,d=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=d/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=uc/2*1.6;for(let u of It){if(!gr(u.id))continue;let d=this.getNodePosition(u),f=i-d.x,p=s-d.y;if(Math.sqrt(f*f+p*p)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<rs&&(i=rs),i>os&&(i=os);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,d=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=d-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<rs&&(i=rs),i>os&&(i=os);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,d=this.camX+(a-this.width/2)/r,f=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=d-(a-this.width/2)/i,this.camY=f-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var wg={};bt(wg,{calculateOfflineRewards:()=>as,calculatePreAutomationRewards:()=>mc,formatTimeCompact:()=>pc,grantOfflineRewards:()=>si,initOfflineTracker:()=>aI,processOfflineProgress:()=>Ig,showOfflinePanel:()=>Ir});function pc(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let h=t.div(l).floorToInteger(),b=h.mulBigNumInteger(l),E=t.sub(b),L=0;try{let R=E.div(c.fromInt(i)).floorToInteger();L=Number(R.toPlainIntegerString())}catch{L=0}return L===0?`${J(h)}y`:`${J(h)}y ${L}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let d=Math.floor(u/60),f=u%60;if(d<60)return f===0?`${d}m`:`${d}m ${f}s`;let p=Math.floor(d/60),g=d%60;if(p<24)return g===0?`${p}h`:`${p}h ${g}m`;let m=Math.floor(p/24),y=p%24;return y===0?`${m}d`:`${m}d ${y}h`}function Ir(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${pc(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let m=document.createElement("div");m.className="offline-pre-auto-note",m.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(m)}let u=document.createElement("div");u.className="offline-scroll-container";let d=document.createElement("div");d.className="offline-list",iI.forEach(m=>{let y=m.key,h=e[y];if(!h||typeof h.isZero=="function"&&h.isZero())return;if(y==="research_levels"){Array.isArray(h)&&h.forEach(U=>{let q=document.createElement("div");q.className="offline-row";let x=document.createElement("span");x.className="offline-plus",x.style.color="#004F96",x.textContent="+";let B=document.createElement("img");B.className="offline-icon",B.src=m.icon,B.alt="RP";let M=document.createElement("span");M.className="offline-text",M.style.color="#004F96";let _=c.fromInt(U.levels),X=_.cmp(c.fromInt(1))===0?"Level":"Levels";M.textContent=`${J(_)} ${X} of ${U.name}`,q.appendChild(x),q.appendChild(B),q.appendChild(M),d.appendChild(q)});return}let b=document.createElement("div");b.className="offline-row";let E=document.createElement("span");E.className="offline-plus",E.classList.add(`text-${y}`),E.textContent="+";let L=document.createElement("img");L.className="offline-icon",L.src=m.icon,L.alt=y;let R=document.createElement("span");R.className="offline-text",R.classList.add(`text-${y}`);let T=!1;h instanceof c?T=!h.isInfinite()&&h.cmp(c.fromInt(1))===0:T=Number(h)===1;let F=T?m.singular:m.plural;R.innerHTML=`${J(h)} ${F}`,b.appendChild(E),b.appendChild(L),b.appendChild(R),d.appendChild(b)}),u.appendChild(d),a.appendChild(u);let f=document.createElement("div");f.className="offline-actions";let p=document.createElement("button");p.type="button",p.className="offline-close-btn",p.textContent="Close";let g=()=>{r.remove()};return p.addEventListener("click",g),r.addEventListener("click",m=>{m.target===r&&g()}),f.appendChild(p),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(f),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{ls(i,a,".offline-scroll-container")}),r}function sI(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function as(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=es?es():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),d=It.filter(g=>Do(g.id)),f=[],p={};for(let g of d){let m=Pt(g.id),y=ro(g.id).add(u),h=0,b=g.maxLevel;for(;m<b;){let E=sI(g,m);if(E.isInfinite&&E.isInfinite()||y.cmp(E)<0)break;y=y.sub(E),m++,h++}h>0&&f.push({name:g.title,levels:h}),p[g.id]={level:m,rp:y}}f.length>0&&(o.research_levels=f),Object.keys(p).length>0&&(o.research_progress=p)}let s=(rc?rc():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||Un("gears",t)||(o.gears=s);let l=br?br():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||Un("books",t)||(o.books=u)}let a=Mt(Ke,jr)||0;if(a>0){let u=1;ht(2)&&(u=10);let d=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!d.isZero()){let f=gc(),p=f.coins.mulBigNumInteger(d),g=f.xp.mulBigNumInteger(d),m=f.mp.mulBigNumInteger(d);p.isZero()||Un("coins",t)||(o.coins=p),g.isZero()||ln(`ccc:xp:progress:${t}`)||(o.xp=g),m.isZero()||ln(`ccc:mutation:progress:${t}`)||(o.mp=m)}}return o}function si(e){if(v()!=null){if(e.xp)try{let n=Gi(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=us(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(hr(r,o.level),Qi(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||O[n]&&typeof O[n].add=="function"&&O[n].add(e[n])}}function mc(e){let t=v();if(t==null)return{};let n=c.fromAny(e),o={},r=Yn(),i=c.fromInt(1);try{let l=cs(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Xn=="function"){let l=Xn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=gc(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),d=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||ln(`ccc:xp:progress:${t}`)||(o.xp=u),d.isZero()||ln(`ccc:mutation:progress:${t}`)||(o.mp=d)}return o}function Ig(){let e=v();if(e==null)return;let t=pf(),n=Date.now();if(t<=0)return;if(n<t-1e4){vn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!$t()){let l=mc(r),a=Object.keys(l).length>0;return a&&(si(l),Ir(l,o,!0)),a}let i=as(r),s=Object.keys(i).length>0;return s&&(si(i),Ir(i,o)),s}function aI(e,t){Sg||(Sg=!0,document.addEventListener("visibilitychange",()=>{v()!=null&&(e&&!e()||(document.hidden?Gf():(Hf(),Ig()&&typeof t=="function"&&t())))}))}var Sg,iI,hc=$e(()=>{St();Ji();wo();Kr();St();Ct();Kt();ti();Eo();fn();ri();ni();Zr();Pa();Hn();xo();so();Hi();Sg=!1;iI=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Ir});function fd(e){let t=24,n=Date.now();try{let o=localStorage.getItem(cd(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(ud(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(cd(e),"24"),localStorage.setItem(ud(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function xg(e,t,n){try{localStorage.setItem(cd(e),String(t)),localStorage.setItem(ud(e),String(n))}catch{}}function Lg(){let e=v();if(e==null)return;let{charges:t,lastCharge:n}=fd(e);if(t>=fs)return;let o=Date.now(),r=o-n;if(r>=yc){let i=Math.floor(r/yc);t+=i,t>=fs?(t=fs,n=o):n+=i*yc,xg(e,t,n),wr&&wr.classList.contains("is-active")&&qo(!0)}}function cI(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function uI(){let e=v();if(e==null)return;Lg();let{charges:t,lastCharge:n}=fd(e);t<=0||(t>=fs&&(n=Date.now()-50),t--,xg(e,t,n),qo(!0),Ba&&clearInterval(Ba),Ba=setInterval(()=>{qo()},1e3),ft(lI,{volume:.5}),cI(),setTimeout(()=>{let o=as(Eg);si(o),Ir(o,Eg*1e3)},7250))}function qo(e=!1){if(!wr||!wr.classList.contains("is-active"))return;let t=v();if(t==null)return;e||Lg();let{charges:n,lastCharge:o}=fd(t),r=wr.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${fs}</span>`);let i=wr.querySelector(".warp-timer");if(i)if(n>=fs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+yc,u=Math.max(0,a-l);i.textContent=`Next warp in ${pc(u)}`}let s=wr.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function _g(e){if(!e||e.__warpInit)return;e.__warpInit=!0,wr=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",uI),Ba||(Ba=setInterval(()=>{qo()},1e3)),qo()}var cd,ud,fs,yc,Eg,lI,wr,Ba,dd=$e(()=>{St();hc();Fn();cd=e=>`ccc:warp:charges:${e}`,ud=e=>`ccc:warp:lastCharge:${e}`,fs=24,yc=3600*1e3,Eg=150,lI="sounds/warp.ogg",wr=null,Ba=null});function Bg(){try{return localStorage.getItem(xr(Id))==="1"}catch{return!1}}function Ed(){try{return localStorage.getItem(xr(Fg))==="1"}catch{return!1}}function Ic(e){let t=v();if(t==null)return;let n=`${Fg}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),fI()}catch{}}function wc(){return Ed()?"Jeff":"Merchant"}function fI(){let e=wc();Ve&&Ve.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function Fa(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=h=>{if(!(n&&o)){if(h?.type==="click"&&h.isTrusted&&to(e)){h.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(h)).catch(b=>console.error(b)),n&&y()}},l=()=>{r=!1,i=null},a=h=>{r&&l(),s(h)},u=h=>{h.pointerType!=="mouse"&&(typeof h.button=="number"&&h.button!==0||(r=!0,i=typeof h.pointerId=="number"?h.pointerId:null,So(160)))},d=h=>{r&&(i!=null&&typeof h.pointerId=="number"&&h.pointerId!==i||l())},f=()=>{r&&l()},p=h=>{r=!0,So(160)},g=h=>{r&&l()},m=()=>{r&&l()},y=()=>{e.removeEventListener("click",a),Ug?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",f)):gI&&(e.removeEventListener("touchstart",p),window.removeEventListener("touchend",g),window.removeEventListener("touchcancel",m))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function vc(e){return mI[e]??0}function Cg(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function yI(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function Da(e,t){let n=ai.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;ps.set(e,r),n.unlocked=r;let i=xn.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&xn.buttons[e]?.classList.contains("is-active")&&Lc("dialogue")}function pd(){let e=!1;try{e=!!gs?.()}catch{}Da("reset",e)}function md(){let e=!1;try{e=!!$t?.()}catch{}Da("workshop",e)}function Ag(){let e=!1;try{typeof Lo=="function"&&(e=Lo())}catch{}Da("warp",e)}function vI(){let e=v();if(e==null)return!1;try{return typeof wn=="function"&&wn()?!0:localStorage.getItem(Dg(e))==="1"}catch{return!1}}function vd(){Da("lab",vI())}function bI(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function SI(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof un=="function"&&un()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Qe=="function"?Qe():null;t&&typeof t=="object"&&(e.xpLevel=bI(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof _r=="function"&&_r()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof $t=="function"&&$t()}catch{e.hasInfuseReset=!1}return e}function II(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?gd:yd,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?gd:yd),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?xd:""),i.icon=o?.icon??(r==="mysterious"?Er:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?Go:pI),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function wI(){if(Mg)return;Mg=!0;let e=EI;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==v()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=v();if(t!=null){let n=`${hI}:${t}`;_t(n,{onChange:e})}}function EI(){Ho()}function xI(e,t){let n=Ld(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,$g(n),LI(t.reward),!0)}function LI(e){if(e){if(e.type==="coins"){try{O.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{O.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{O.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function _I(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function Ld(){try{return JSON.parse(localStorage.getItem(xr(Ua))||"{}")}catch{return{}}}function $g(e){let t=xr(Ua);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{rt(t,n)}catch{}}catch{}}function CI(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function MI(){let e=bd;if(bd=null,typeof e=="function")try{e()}catch{}}function kI(e,t={}){t?.rawChanged&&Ho()}function hd(e){if(e===Ng)return;if(MI(),Ng=e??null,e==null){Ho();return}let t=`${Ua}:${e}`;bd=_t(t,{parse:CI,onChange:kI});try{rt(t)}catch{}Ho()}function TI(){if(kg){hd(v());return}kg=!0,hd(v()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{hd(v())})}function Cr(){Promise.resolve().then(()=>(Fn(),Al)).then(({loadAudio:e})=>{e(qg)})}function AI(){if(ds)return;ds=ft(qg,{volume:je?.15:.3,loop:!0})}function Yo(){ds&&(ds.stop&&ds.stop(),ds=null)}function NI(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let E=0;E<t.length;E++){let L=t[E];L==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=L):L===">"&&l?(s+=L,i.push({type:"tag",content:s}),s="",l=!1):s+=L}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,d=!1,f=!1,p="";Xo=!0,AI();let g=E=>{f&&(E.preventDefault(),d=!0)},m=E=>{f&&(E.key==="Enter"||E.key===" ")&&(d=!0)},y=o.length?o:[e];requestAnimationFrame(()=>{f=!0,y.forEach(E=>E.addEventListener("click",g,{once:!0})),document.addEventListener("keydown",m,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let h=()=>{y.forEach(E=>E.removeEventListener("click",g)),document.removeEventListener("keydown",m),e.classList.remove("is-typing"),Yo(),Xo=!1},b=()=>{if(d){e.innerHTML=t,h(),r();return}if(a>=i.length){h(),r();return}let E=i[a];E.type==="tag"?(p+=E.content,e.innerHTML=p,a++,b()):(p+=E.content[u],e.innerHTML=p,u++,u>=E.content.length&&(a++,u=0),setTimeout(b,n))};b()})}function RI(e={}){if(!Ve)return;Cr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||Go}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Er}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,Ve.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||Go,r.textContent=e.message||xd,requestAnimationFrame(()=>t.classList.add("is-visible")),Ve.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),Yo(),Xo=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=d=>{d.key==="Escape"&&(d.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",d=>{n.contains(d.target)||(d.preventDefault(),_n(160),l())});let u=d=>{(!d||d.pointerType!=="mouse")&&_n(160),l()};Fa(i,()=>{u()},{once:!0}),i.focus?.()}function OI(e,t){Cr();let n=t.scriptId;String(e)==="6"&&typeof ss=="function"&&!ss()&&(n=7),$r(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${wc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ms}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,Ve.appendChild(o);let r=h=>{h.key==="Escape"&&o.isConnected&&f()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),Ve.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,d=()=>{$r(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),Ve.classList.remove("firstchat-active"),Yo(),Xo=!1,o.remove()},f=()=>{u||(u=!0,d(),Ho())};o.addEventListener("pointerdown",h=>{l.contains(h.target)||(h.preventDefault(),h.pointerType!=="mouse"&&_n(160),f())});let p=new Lr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(h,b)=>{t.scriptId===4&&h==="c4b"&&Ic(!0)},onEnd:h=>{if(!u){if(u=!0,h&&h.noReward){Ho(),d();return}xI(e,t),Ho(),d()}}}),m=!!Ld()[e]?.claimed,y=structuredClone(Ff[n]);m&&y.nodes.m2b&&y.nodes.c2a&&t.scriptId===1&&(y.nodes.m2b.say="I've already given you Coins, goodbye.",y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),m&&t.scriptId===2&&y.nodes.m3a&&(y.nodes.m3a.say="I've already given you Books, goodbye.",y.nodes.c2a&&(y.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===3&&y.nodes.m5a&&(y.nodes.m5a.say="I've already given you Gold, goodbye.",y.nodes.c5a&&(y.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m&&t.scriptId===4&&y.nodes.m7a&&(y.nodes.m7a.say="I've already given you Magic, goodbye.",y.nodes.c7a&&(y.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p.load(y),p.start()}function PI(){if(document.getElementById(Og))return;let e=document.createElement("style");e.id=Og,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function BI(){let e=Ve?.querySelector(".merchant-content");if(!e||e.__customScroll||!gt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),gt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){PI();let _=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;gt.style.timelineScope=_,e.style.scrollTimelineName=_,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=_,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let d=null,f=()=>{let M=(e.scrollTop||0)>0;d!==M&&(d=M,gt?.classList.toggle("has-scroll-shadow",M))},p=()=>{let M=Ve.querySelector(".merchant-grabber"),_=Ve.querySelector(".merchant-header"),X=Ve.querySelector(".merchant-actions"),Q=(M?.offsetHeight||0)+(_?.offsetHeight||0)|0,fe=(X?.offsetHeight||0)|0;t.style.top=Q+"px",t.style.bottom=fe+"px"},g={},m=()=>{let{scrollHeight:M,clientHeight:_,scrollTop:X}=e,Q=t.clientHeight||e.clientHeight||1;if(g.scrollHeight===M&&g.clientHeight===_&&g.barH===Q&&(u||g.scrollTop===X))return;g={scrollHeight:M,clientHeight:_,scrollTop:X,barH:Q};let fe=_/Math.max(1,M),K=Math.max(28,Math.round(Q*fe)),ee=Math.max(1,M-_),ve=Math.max(0,Q-K);if(n.style.height=K+"px",u)n.style.setProperty("--thumb-y",`${ve}px`),n.style.setProperty("--thumb-x","0px");else{let he=Math.round(X/ee*ve);n.style.transform=`translateY(${he}px)`}t.style.display=M<=_+1?"none":""},y=()=>{p(),m(),f()},h=()=>{o&&(gt.classList.add("is-scrolling"),l&&clearTimeout(l))},b=M=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{gt.classList.remove("is-scrolling")},M))},E=()=>{m(),f(),o&&h(),s||b(r)},L=()=>b(r);e.addEventListener("scroll",E,{passive:!0}),s&&e.addEventListener("scrollend",L,{passive:!0});let R=new ResizeObserver(y);R.observe(e),window.addEventListener("resize",y),requestAnimationFrame(y);let T=!1,F=0,U=0,q=M=>{T=!0,F=M.clientY,U=e.scrollTop,n.classList.add("dragging"),h();try{n.setPointerCapture(M.pointerId)}catch{}M.preventDefault()},x=M=>{if(!T)return;let _=t.clientHeight||1,X=n.clientHeight||1,Q=Math.max(1,_-X),fe=Math.max(1,e.scrollHeight-e.clientHeight),ee=(M.clientY-F)/Q*fe;e.scrollTop=U+ee},B=M=>{if(T){T=!1,n.classList.remove("dragging"),b(i);try{n.releasePointerCapture(M.pointerId)}catch{}}};n.addEventListener("pointerdown",q),window.addEventListener("pointermove",x,{passive:!0}),window.addEventListener("pointerup",B),window.addEventListener("pointercancel",B),t.addEventListener("pointerdown",M=>{if(M.target===n)return;let _=t.getBoundingClientRect(),X=M.clientY-_.top,Q=t.clientHeight||1,fe=n.clientHeight||1,K=Math.max(0,Q-fe),ee=Math.max(0,Math.min(X-fe/2,K)),ve=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=ee/Math.max(1,K)*ve,h(),b(r)}),e.__customScroll={bar:t,thumb:n,ro:R,updateAll:y},y()}function FI(){if(Ve)return;Ve=document.createElement("div"),Ve.className="merchant-overlay",Ve.id="merchant-overlay",Ve.setAttribute("inert",""),gt=document.createElement("div"),gt.className="merchant-sheet",gt.setAttribute("role","dialog"),gt.setAttribute("aria-modal","false"),gt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab",pd(),md(),Ag(),vd(),ai.forEach(g=>{g.key==="dialogue"&&ps.set("dialogue",!0);let m=ps.get(g.key),y=m??!!g.unlocked,h=document.createElement("button");h.type="button",h.className="merchant-tab",h.dataset.tab=g.key;let b=g.lockedLabel||"???";h.textContent=y?g.label:b,y?h.title=g.label||"Tab":(h.classList.add("is-locked"),h.disabled=!0,h.title="???"),g.unlocked=y,ps.set(g.key,y),Fa(h,E=>{if(h.disabled){E?.preventDefault?.();return}Lc(g.key)}),o.appendChild(h),xn.buttons[g.key]=h}),xn.panels.dialogue=i,xn.panels.reset=s,xn.panels.workshop=l,xn.panels.warp=a,xn.panels.lab=u,xn.tablist=o,r.append(i,s,l,a,u),n.append(o,r),pd(),md();try{Vo()}catch{}try{_d(s)}catch{}try{Fe()}catch{}try{Zf(l)}catch{}try{_g(a)}catch{}try{sd(u)}catch{}if(!Tg&&typeof window<"u"){let g=m=>{let{key:y,slot:h}=m?.detail??{};h!=null&&h!==v()||((y==="forge"||!y)&&pd(),(y==="infuse"||!y)&&md(),(y==="surge_completed"||!y)&&Ag(),(y==="lab"||y==="tsunami"||!y)&&vd())};window.addEventListener("unlock:change",g,{passive:!0}),window.addEventListener("saveSlot:change",g,{passive:!0}),Tg=!0}let d=document.createElement("div");d.className="merchant-actions";let f=document.createElement("button");f.type="button",f.className="merchant-close",f.textContent="Close",bc=f,d.appendChild(f);let p=document.createElement("div");p.className="merchant-firstchat merchant-firstchat--initial",p.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ms}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,gt.append(e,t,n,d,p),Ve.appendChild(gt),document.body.appendChild(Ve),UI(),BI(),Rg||(Rg=!0,Fa(f,()=>{xc()},{once:!1}),document.addEventListener("keydown",GI),e.addEventListener("pointerdown",HI),e.addEventListener("touchstart",m=>m.preventDefault(),{passive:!1}),Ve.addEventListener("pointerdown",Cr,{once:!0}))}function UI(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,wI(),Ho()}function DI(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?OI(n.id,n.meta):n.isMysterious&&RI(n.lockInfo)}}function Ho(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=SI(),o=Ld(),r=!1,i=new Set;Object.entries(Ec).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",d=vc(u),f=II(l,n),p=f.status,g=vc(p);if(g>d)a.status=p,p==="mysterious"?a.lockSnapshot=Cg(f):p==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(g<d){if(u==="unlocked")f=yI(l),p="unlocked",g=vc(p);else if(u==="mysterious"){let M=a.lockSnapshot||Cg(f)||{};f={status:"mysterious",unlocked:!1,title:M.title??f.title??"???",blurb:M.blurb??f.blurb??gd,tooltip:M.tooltip??f.tooltip??"Hidden Dialogue",message:M.message??f.message??xd,icon:M.icon??f.icon??Er,headerTitle:M.headerTitle??f.headerTitle??Go,ariaLabel:M.ariaLabel??f.ariaLabel??"Hidden merchant dialogue"},p="mysterious",g=vc(p)}}let m=p==="unlocked",y=p==="mysterious",h=p==="locked",b=!!a.claimed,E=m&&!!(l.once&&b),L=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!L){L=document.createElement("button"),L.type="button",L.className="dlg-card",L.dataset.dlgId=String(s);let M=document.createElement("div");M.className="dlg-title";let _=document.createElement("div");_.className="dlg-blurb";let X=document.createElement("div");X.className="dlg-reward",L.append(M,_,X),t.appendChild(L),Fa(L,DI)}L._dlgCtx={id:s,meta:l,lockInfo:f,unlocked:m,isMysterious:y},L.dataset.dlgStatus=p,L.disabled!==!!h&&(L.disabled=!!h),L.classList.toggle("is-locked",h),L.classList.toggle("is-mysterious",y),L.classList.toggle("is-complete",!!E),L.classList.toggle("has-again",!!E),h?(L.getAttribute("aria-disabled")!=="true"&&L.setAttribute("aria-disabled","true"),L.getAttribute("tabindex")!=="-1"&&L.setAttribute("tabindex","-1")):(L.hasAttribute("aria-disabled")&&L.removeAttribute("aria-disabled"),L.hasAttribute("tabindex")&&L.removeAttribute("tabindex"));let R=L.querySelector(".dlg-title"),T=m?l.title:f.title??"???";R.textContent!==T&&(R.textContent=T);let F=L.querySelector(".dlg-blurb"),U=m?l.blurb:f.blurb??"";F.textContent!==U&&(F.textContent=U);let q=L.querySelector(".dlg-reward");if(m&&l.reward){let M=dI[l.reward.type];if(M){q.classList.contains("has-reward")||(q.classList.add("has-reward"),q.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),q.style.getPropertyValue("--reward-icon")!==`url('${M}')`&&q.style.setProperty("--reward-icon",`url('${M}')`);let _=q.querySelector(".amt"),X=String(l.reward.amount);_&&_.textContent!==X&&(_.textContent=X);let Q=q.querySelector(".currency-name");if(Q){let K=String(l.reward.type||""),ee=K.charAt(0).toUpperCase()+K.slice(1);Q.textContent!==ee&&(Q.textContent=ee)}let fe=`Reward: ${l.reward.amount} ${l.reward.type}`;q.getAttribute("aria-label")!==fe&&q.setAttribute("aria-label",fe)}else{q.classList.remove("has-reward");let _=_I(l.reward);q.textContent!==_&&(q.textContent=_),q.style.display!==""&&(q.style.display=""),q.removeAttribute("aria-label")}q.style.display==="none"&&(q.style.display="")}else q.textContent!==""&&(q.textContent=""),q.style.display!=="none"&&(q.style.display="none");let x=m?`${l.title}${E?" (completed)":""}`:f.ariaLabel||(y?"Hidden merchant dialogue":"Locked merchant dialogue");if(L.getAttribute("aria-label")!==x&&L.setAttribute("aria-label",x),f.tooltip)L.title!==f.tooltip&&(L.title=f.tooltip);else if(m){let M="Left-click: Start Dialogue";L.title!==M&&(L.title=M)}else L.hasAttribute("title")&&L.removeAttribute("title");let B=L.querySelector(".dlg-again");E?B||(B=document.createElement("div"),B.className="dlg-again",B.textContent="Ask Again?",L.appendChild(B)):B&&B.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&$g(o)}function $I(){let e=Ve.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");$r(!0);let i=new Lr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{$r(!1);try{localStorage.setItem(xr(Id),"1")}catch{}try{window.dispatchEvent(new Event(wd))}catch{}e.classList.remove("is-visible"),Ve.classList.remove("firstchat-active")}});i.load(Ff[0]),i.start()}function qI(){if(!Ve)return;let e=Ve.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),Ve.classList.remove("firstchat-active")}function Gg(){if(FI(),hs)return;let e=document.activeElement;e instanceof HTMLElement&&!Ve.contains(e)?Sc=e:Sc=null,hs=!0;let t=v(),n=!1;if(t!=null){let r=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(r)==="1"){try{localStorage.removeItem(r)}catch{}try{localStorage.setItem(Dg(t),"1")}catch{}vd();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(xr(Id))==="1"}catch{o=!1}o||Ve.classList.add("firstchat-instant"),gt.style.transition="none",gt.style.transform="",Ve.removeAttribute("inert"),gt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ve.classList.contains("firstchat-instant")||(gt.style.transition=""),Ve.classList.add("is-open"),_n(140),bc&&typeof bc.focus=="function")try{bc.focus({preventScroll:!0})}catch{}let r="dialogue";try{r=localStorage.getItem(xr(Pg))||"dialogue"}catch{}n&&(r="dialogue"),Lc(r),Yo(),o||(Ve.querySelector(".merchant-firstchat")?.classList.add("is-visible"),Ve.classList.add("firstchat-active"),$I())})})}function xc(){if(!hs)return;if($r(!1),je){try{So(100)}catch{}try{_n(80)}catch{}}hs=!1,gt.style.transition="",gt.style.transform="",Ve.classList.remove("is-open"),Ve.classList.remove("firstchat-instant"),qI();let e=document.activeElement;if(e&&Ve.contains(e)){let t=Sc;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}Ve.setAttribute("inert",""),Sc=null,Yo(),Xo=!1}function GI(e){if(hs&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<ai.length;i++)ps.get(ai[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<ai.length&&(e.preventDefault(),Lc(ai[r].key))}}function HI(e){if(!hs)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;Ln={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},gt.style.transition="none",window.addEventListener("pointermove",Hg,{passive:!0}),window.addEventListener("pointerup",Xg),window.addEventListener("pointercancel",Yg)}function Hg(e){if(!Ln||Ln.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-Ln.startY);Ln.lastY=t,Ln.moved=n,gt.style.transform=`translateY(${n}px)`}function Xg(){if(!Ln||Ln.canceled){Sd();return}let e=Math.max(1,performance.now()-Ln.startT),t=Ln.moved;t/e>.55&&t>40||t>140?(So(160),gt.style.transition="transform 140ms ease-out",gt.style.transform="translateY(100%)",setTimeout(()=>{xc()},150)):(gt.style.transition="transform 180ms ease",gt.style.transform="translateY(0)"),Sd()}function Yg(){Ln&&(Ln.canceled=!0,gt.style.transition="transform 180ms ease",gt.style.transform="translateY(0)",Sd())}function Sd(){window.removeEventListener("pointermove",Hg),window.removeEventListener("pointerup",Xg),window.removeEventListener("pointercancel",Yg),Ln=null}function Lc(e){let t=ai.find(o=>o.key===e),n=ps.get(e);(!t||!n)&&(e="dialogue");for(let o in xn.buttons)xn.buttons[o].classList.toggle("is-active",o===e);for(let o in xn.panels)xn.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{Ho()}catch{}if(e==="warp")try{qo()}catch{}if(e==="lab"){typeof ss=="function"&&!ss()&&XI();try{ad()}catch{}}try{localStorage.setItem(xr(Pg),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=Ve?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function $a(e=[]){e.forEach(t=>Da(t,!0))}function Vg(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ms}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Cr();let u=g=>{g.key==="Escape"&&(g.stopImmediatePropagation(),g.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let d=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{f()},5e3)},15e3)},1e3)},f=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ms}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let g=r.querySelector("#tsunami-dlg-line-2"),m=r.querySelector("#tsunami-dlg-choices-2"),y=r.querySelector(".merchant-firstchat__row"),h=r.querySelector(".merchant-firstchat__card"),b={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},E=new Lr({textEl:g,choicesEl:m,skipTargets:[g,y,h],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),Yo(),Xo=!1,r.remove(),t&&t()},5e3)}});E.load(b),E.start()},p=new Lr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",Yo(),Xo=!1,n&&n.hideCursor&&n.hideCursor(),d()}});p.load(o),p.start()}function XI(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${wc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ms}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Cr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Lr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{Yo(),Xo=!1,e.remove()}});s.load(i),s.start()}function Wg(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${wc()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${ms}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Cr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Lr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{Yo(),Xo=!1,t.remove(),e&&e()}});l.load(s),l.start()}var ms,Id,Pg,Ua,wd,xr,Fg,ai,ps,dI,Er,Go,pI,gd,yd,xd,mI,hI,Ug,gI,Mg,kg,Tg,Dg,Ng,bd,Ec,Ve,gt,bc,hs,Ln,Sc,Rg,xn,qg,ds,Xo,Lr,Og,_c=$e(()=>{St();Ct();Hh();Hn();wo();Ji();dd();ri();so();ti();Yi();Eo();Fn();ms="img/misc/merchant.webp",Id="ccc:merchantMet",Pg="ccc:merchantTab",Ua="ccc:merchant:dlgState",wd="ccc:merchant:met",xr=e=>`${e}:${v()}`;Fg="ccc:unlock:jeff";ai=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"}],ps=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1]]),dI={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Er="img/misc/mysterious.webp",Go="Hidden Dialogue",pI="Locked Dialogue",gd="Hidden Dialogue",yd="Locked",xd="Locked Dialogue",mI={locked:0,mysterious:1,unlocked:2},hI="ccc:reset:forge:completed",Ug=typeof window<"u"&&"PointerEvent"in window,gI=!Ug&&typeof window<"u"&&"ontouchstart"in window;Mg=!1,kg=!1,Tg=!1;Dg=e=>`ccc:unlock:lab:${e}`;Ng=null,bd=null;Ec={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Er,headerTitle:Go,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:yd,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Er,headerTitle:Go,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof Lo=="function"&&Lo()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Er,headerTitle:Go,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof wn=="function"&&wn())return!0;let t=typeof En=="function"?En():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof Lo=="function"&&Lo()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Er,headerTitle:Go,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Er,headerTitle:Go,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};TI();Ve=null,gt=null,bc=null,hs=!1,Ln=null,Sc=null,Rg=!1,xn={buttons:{},panels:{},tablist:null},qg="sounds/merchant_typing.ogg",ds=null,Xo=!1;Lr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await NI(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=Fa(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};Og="ccc-scroll-timeline-styles"});var Kg={};bt(Kg,{getAutobuyerToggle:()=>li,initAutomationEffects:()=>KI,setAutobuyerToggle:()=>Mr,updateAutomation:()=>zg});function Md(e){Mc!==e&&(ys.clear(),Mc=e)}function li(e,t){let n=v();Md(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(ys.has(r))return ys.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return ys.set(r,i),i}function Mr(e,t,n){let o=v();Md(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);ys.set(i,s);try{localStorage.setItem(i,s)}catch{}}function YI(e){zg(e),zI(e)}function VI(){if(Cc)return Cc;let e=Ut(xe.STARTER_COVE),t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Cc=t,Cc}function WI(e){if(!(!e||e.length===0)){for(let t of e)if(li(xe.STARTER_COVE,t.id)!=="0"){let o=Mt(xe.STARTER_COVE,t.id),r=t.lvlCap??1/0;o<r&&Td(xe.STARTER_COVE,t.id)}}}function zI(e){let t=v();Md(t);let n=VI();for(let[r,i]of Object.entries(zi)){let s=Number(r);Mt(Ke,s)>0&&n[i]&&WI(n[i])}Mt(Ke,no)>0&&(Cd++,Cd>=5&&(Cd=0,li(Ke,no)!=="0"&&ic()))}function zg(e){let n=Mt(Ke,jr);if(n<=0){qa=0;return}qa+=e;let o=1/n;if(qa>=o){let r=Math.floor(qa/o);if(r>0){let i=r;if(ht(2))if(ht(8)){let s=Ft();i*=Math.pow(10,s)}else i*=10;kd(i),qa-=r*o}}}function KI(){Io(YI),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Mc&&(ys.clear(),Mc=t)})}var qa,Cd,ys,Mc,Cc,kc=$e(()=>{Kr();fn();Pa();Zr();Ji();St();so();qa=0,Cd=0,ys=new Map,Mc=null;Cc=null});function ny(e){if(!e||!e.costType)return!1;let t=ew[e.costType];return!t||Mt(Ke,t)<=0?!1:li(e.area,e.id)!=="0"}function Ad(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function Ac(e,t){return t==="standard"&&Ad(e)===QI}function Jg(e){let t=Ut(e),n={};for(let o of t){let r=Cn(e,o.id),i=Mt(e,o.id),s=Wo(e,o.id),l=s.iconOverride??Uc(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,d=!!s.locked,f=o.upgType==="HM"?!!Xa(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:d,lockState:s,useLockedBase:!!s.useLockedBase||d,baseIconOverride:o.baseIconOverride||s.baseIconOverride||null,hmReady:f}}return n}function oy(e){return Qg[e]||Qg.standard}function _n(e=140){if(!je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function Rc(e){return String(e??"").replace(/<[^>]*>/g,"")}function Tc(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function Qt(){ft(nw,{volume:je?ry:iy})}function sy(){let e=je?ry*2:iy*2;ft(ow,{volume:e})}function rw(e){return`<img alt="" src="${Zg[e]||Zg.coins}" class="currency-ico">`}function sw(){if(document.getElementById(ey))return;let e=document.createElement("style");e.id=ey,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function ls(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,d=150,f=120,p="onscrollend"in window,m=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(m){sw();let ee=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=ee,s.style.scrollTimelineName=ee,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=ee,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let y=null,h=()=>{let ee=((i?s.scrollTop:s.scrollLeft)||0)>0;y!==ee&&(y=ee,t?.classList.toggle("has-scroll-shadow",ee))},b=()=>{if(!s.isConnected||!t.isConnected)return;let K=s.getBoundingClientRect(),ee=t.getBoundingClientRect();if(i){let ve=Math.max(0,K.top-ee.top),he=Math.max(0,ee.bottom-K.bottom);l.style.top=ve+"px",l.style.bottom=he+"px",l.style.left="",l.style.right=""}else{let ve=Math.max(0,K.left-ee.left),he=Math.max(0,ee.right-K.right);l.style.left=ve+"px",l.style.right=he+"px",l.style.top="",l.style.bottom="",l.style.height=""}},E={},L=()=>{let K=i?s.scrollHeight:s.scrollWidth,ee=i?s.clientHeight:s.clientWidth,ve=i?s.scrollTop:s.scrollLeft,he=i?l.clientHeight||ee:l.clientWidth||ee;if(E.scrollSize===K&&E.clientSize===ee&&E.barSize===he&&(m||E.scrollPos===ve))return;E={scrollSize:K,clientSize:ee,scrollPos:ve,barSize:he};let Y=ee/Math.max(1,K),te=Math.max(28,Math.round(he*Y)),$=Math.max(1,K-ee),G=Math.max(0,he-te);if(i?(a.style.height=te+"px",a.style.width="100%"):(a.style.width=te+"px",a.style.height="100%"),m)i?(a.style.setProperty("--thumb-y",`${G}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${G}px`),a.style.setProperty("--thumb-y","0px"));else{let le=Math.round(ve/$*G);i?a.style.transform=`translateY(${le}px)`:a.style.transform=`translateX(${le}px)`}let j=K>ee+1;l.style.display=j?"":"none",t?.classList.toggle("has-active-scrollbar",j)},R=()=>{b(),L(),h()};typeof MutationObserver<"u"&&new MutationObserver(()=>R()).observe(s,{childList:!0,subtree:!0,characterData:!0});let T=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},F=K=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},K))},U=()=>{L(),h(),u&&T(),p||F(d)},q=()=>F(d);s.addEventListener("scroll",U,{passive:!0}),p&&s.addEventListener("scrollend",q,{passive:!0}),new ResizeObserver(R).observe(s),window.addEventListener("resize",R),requestAnimationFrame(R);let B=!1,M=0,_=0,X=K=>{B=!0,M=i?K.clientY:K.clientX,_=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),T();try{a.setPointerCapture(K.pointerId)}catch{}K.preventDefault()},Q=K=>{if(!B)return;let ee=i?l.clientHeight:l.clientWidth,ve=i?a.clientHeight:a.clientWidth,he=Math.max(1,ee-ve),Y=i?s.scrollHeight:s.scrollWidth,te=i?s.clientHeight:s.clientWidth,$=Math.max(1,Y-te),j=(i?K.clientY:K.clientX)-M,le=_+j/he*$;i?s.scrollTop=le:s.scrollLeft=le},fe=K=>{if(B){B=!1,a.classList.remove("dragging"),F(f);try{a.releasePointerCapture(K.pointerId)}catch{}}};a.addEventListener("pointerdown",X),window.addEventListener("pointermove",Q,{passive:!0}),window.addEventListener("pointerup",fe),window.addEventListener("pointercancel",fe),l.addEventListener("pointerdown",K=>{if(K.target===a)return;let ee=l.getBoundingClientRect(),ve=i?K.clientY-ee.top:K.clientX-ee.left,he=i?a.clientHeight:a.clientWidth,Y=i?l.clientHeight:l.clientWidth,te=Math.max(0,Y-he),$=Math.max(0,Math.min(ve-he/2,te)),G=i?s.scrollHeight:s.scrollWidth,j=i?s.clientHeight:s.clientWidth,le=Math.max(1,G-j),ue=$/Math.max(1,te)*le;i?s.scrollTop=ue:s.scrollLeft=ue,T(),F(d)}),R()}function ty(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let d=BigInt(a)-BigInt(u);return d>0n?c.fromAny(d.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function aw(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let f=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(f)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=O[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let f=e?.upgType==="HM",p=Number.isFinite(i)&&r>=i;return f&&!p||!Number.isFinite(i)?c.fromAny("Infinity"):ty(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let f=c.fromAny(e.costAtLevel(r)),p=c.fromAny(e.costAtLevel(r+1)),g=Math.min(Number.isFinite(i)?i:r+32,r+32),m=c.fromAny(e.costAtLevel(g));if(f.cmp(p)===0&&f.cmp(m)===0){let h=ty(e,o,r),b=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(h.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,E=0,L=Math.max(0,b);for(;E<L;){let R=Math.floor((E+L+1)/2),T=c.fromInt(R);(typeof f.mulBigNumInteger=="function"?f.mulBigNumInteger(T):c.fromAny(f??0).mulBigNumInteger(T)).cmp(a)<=0?E=R:L=R-1}return c.fromInt(E)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:d}=ci(e,o,a,u,{fastOnly:!0});return d??c.fromInt(0)}function sc(e="standard"){(Pc[e]||Pc.standard).open()}function ay(e=!1){Object.values(Pc).forEach(t=>t.close(e))}function kr(e=!1){Object.values(Pc).forEach(t=>t.update(e))}function lw(){if(en)return;en=document.createElement("div"),en.className="upg-overlay",it=document.createElement("div"),it.className="upg-sheet",it.setAttribute("role","dialog"),it.setAttribute("aria-modal","false"),it.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",it.append(e,t,n,o,r),en.appendChild(it),document.body.appendChild(en),en.addEventListener("pointerdown",u=>{je&&u.pointerType!=="mouse"&&u.target===en&&(u.preventDefault(),u.stopPropagation())},!0),en.addEventListener("click",u=>{je&&u.target===en&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Bc)return;let d=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:d,lastY:d,moved:0},it.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let d=u.clientY;if(typeof d!="number")return;let f=Math.max(0,d-i.startY);i.lastY=d,i.moved=f,it.style.transform=`translateY(${f}px)`}function a(u){if(!i)return;let d=i.moved>140;if(it.style.transition="transform 160ms ease",it.style.transform=d?"translateY(100%)":"translateY(0)",d){if(je&&(!u||u.pointerType!=="mouse"))try{_n(120)}catch{}setTimeout(ly,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function ly(){if(je)try{_n(160)}catch{}if(typeof Nc=="function"){let e=Nc;Nc=null;try{e()}catch{}}Bc=!1,!(!en||!it)&&(it.style.transition="",it.style.transform="",en.classList.remove("is-open"),en.style.pointerEvents="none")}function cw(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let d=document.createElement("li"),f=document.createElement("span");f.className="hm-milestone-text",u&&typeof u=="object"?(f.textContent=u.text??"",u.achieved&&d.classList.add("hm-milestone-achieved")):f.textContent=u,d.appendChild(f),i.appendChild(d)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function uw(e,t="standard"){lw(),Bc=!0;let n=!0,o=oy(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Bc=!1;return}let l=e.upgType==="HM",a=e.tie===we.ENDLESS_XP;function u(m,y,h="div"){let b=y.split(" ").filter(R=>R.length>0),E=null,L=[];for(let R=0;R<m.children.length;R++){let T=m.children[R];h&&T.tagName.toLowerCase()!==h.toLowerCase()||b.every(F=>T.classList.contains(F))&&(E?L.push(T):E=T)}return L.forEach(R=>R.remove()),E||(E=document.createElement(h),E.className=y,m.appendChild(E)),E}let d=m=>{let y=document.createElement("div");return y.className="upg-line",y.innerHTML=m,y},f=!0,p=()=>{let m=o.getUiModel(e.id);if(!m)return;let y=m.lockState||o.getLockState(e.id),h=!!y?.locked,b=h&&(y?.hidden||y?.hideEffect||y?.hideCost),E=!!m.unlockUpgrade&&!b;it.classList.toggle("is-locked-hidden",b);let L=it.querySelector(".upg-header"),R=u(L,"upg-title");R.textContent!==(m.displayTitle||m.upg.title)&&(R.textContent=m.displayTitle||m.upg.title);let T=!!m.hmReadyToEvolve,F=T?!1:m.lvlBn?.isInfinite?.()?!0:Number.isFinite(m.upg.lvlCap)?m.lvl>=m.upg.lvlCap:!1,U=u(L,"upg-level"),q=m.lvlCapFmtHtml??m.upg.lvlCapFmtHtml??J(m.lvlCapBn),x=m.lvlCapFmtText??m.upg.lvlCapFmtText??Rc(q),B=T?`Level ${m.lvlFmtHtml} / ${q} (EVOLVE READY)`:F?`Level ${m.lvlFmtHtml} / ${q} (MAXED)`:`Level ${m.lvlFmtHtml} / ${q}`,M=Rc(B);U.innerHTML!==B&&(U.innerHTML=B),U.getAttribute("aria-label")!==M&&U.setAttribute("aria-label",M),U.hidden=b,b||U.removeAttribute("aria-hidden"),it.classList.toggle("is-maxed",F),it.classList.toggle("hm-evolve-ready",T),it.classList.toggle("is-unlock-upgrade",E),it.classList.toggle("is-hm-upgrade",l&&!b),it.classList.toggle("is-endless-xp",a),it.classList.toggle("is-magnet-upgrade",e.tie===we.MAGNET),it.classList.toggle("is-no-effect",!m.effect);let _=L.querySelector(".auto-toggle-wrapper"),X=t==="automation"?zi[e.id]:null,Q=t==="automation"&&e.id===no,fe=!!X,K=t==="standard"?tw[e.costType]:null,ee=0;K?ee=Mt(Ke,K):(fe||Q)&&(ee=Mt(Ke,e.id));let he=ee>0&&(fe||K||Q)&&!b;_||(_=document.createElement("div"),_.className="auto-toggle-wrapper hm-view-milestones-row",L.appendChild(_));let Y=_.querySelector("button");if(Y||(Y=document.createElement("button"),Y.type="button",Y.style.padding="10px 14px",Y.style.fontSize="16px",Y.style.width="auto",Y.style.minWidth="180px",Y.addEventListener("click",ie=>{typeof Y._onClick=="function"&&Y._onClick(ie)}),_.appendChild(Y)),he){Y.style.visibility="",Y.style.pointerEvents="auto";let ie=v(),Se=ie!=null?`:${ie}`:"",Ne=!0;if(fe){let _e=`ccc:autobuy:master:${X}${Se}`,Re=Ut(xe.STARTER_COVE),se=!1;for(let ne of Re)if(ne.costType===X){let Ie=`ccc:autobuy:${ne.area}:${ne.id}${Se}`;if(li(ne.area,ne.id)!=="0"){se=!0;break}}Ne=se}else Ne=li(e.area,e.id)!=="0";Ne?(Y.className="shop-delve",Y.textContent="Automation: ON",Y.style.backgroundColor=""):(Y.className="shop-close",Y.textContent="Automation: OFF",Y.style.backgroundColor=""),Y._onClick=_e=>{_e.preventDefault(),_e.stopPropagation(),je&&_n(50);let se=!Ne?"1":"0";fe?(localStorage.setItem(`ccc:autobuy:master:${X}${Se}`,se),Ut(xe.STARTER_COVE).forEach(Ie=>{Ie.costType===X&&Mr(Ie.area,Ie.id,se)})):Mr(e.area,e.id,se),p()}}else Y.style.visibility="hidden",Y.style.pointerEvents="none",Y.className="shop-delve",Y.textContent="Automation: ON",Y._onClick=null;let te=it.querySelector(".upg-content");f&&(te.scrollTop=0,f=!1);let $=u(te,"upg-desc centered");$.classList.toggle("lock-desc",b);let G=(m.displayDesc||m.upg.desc||"").trim();T?($.classList.add("hm-evolve-note"),$.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&($.textContent="Evolve this upgrade to multiply its effect by 1000x")):G?($.classList.remove("hm-evolve-note"),$.textContent!==G&&($.textContent=G),$.hidden=!1):$.hidden=!0;let j=u(te,"upg-info"),le=null,ue=ie=>{le?le.nextElementSibling!==ie&&j.insertBefore(ie,le.nextSibling):j.firstElementChild!==ie&&j.prepend(ie),le=ie};if(h&&y?.reason&&!b){let ie=(m.displayDesc||"").trim(),Se=String(y.reason??"").trim();if(ie!==Se){let Ne=j.querySelector(".lock-wrapper");if(!Ne){Ne=document.createElement("div"),Ne.className="lock-wrapper";let se=document.createElement("div");se.className="upg-line lock-note",Ne.append(se)}let _e=Array.from(Ne.children);for(let se of _e)se.tagName==="DIV"&&!se.className&&se.style.height==="12px"&&se.remove();let Re=Ne.querySelector(".lock-note");Re.textContent!==y.reason&&(Re.textContent=y.reason),ue(Ne)}else{let Ne=j.querySelector(".lock-wrapper");Ne&&Ne.remove()}}else{let ie=j.querySelector(".lock-wrapper");ie&&ie.remove()}if(m.effect&&!(h&&y?.hideEffect)){let ie=j.querySelector(".effect-wrapper");if(!ie){ie=document.createElement("div"),ie.className="effect-wrapper";let Re=document.createElement("div");Re.className="upg-line",ie.append(Re)}let Se=Array.from(ie.children);for(let Re of Se)Re.tagName==="DIV"&&!Re.className&&Re.style.height==="12px"&&Re.remove();let Ne=ie.querySelector(".upg-line"),_e=`<span class="bonus-line">${m.effect}</span>`;Ne.innerHTML!==_e&&(Ne.innerHTML=_e),ue(ie)}else{let ie=j.querySelector(".effect-wrapper");ie&&ie.remove()}let C=rw(m.upg.costType),W=m.nextPrice instanceof c?m.nextPrice:c.fromAny(m.nextPrice||0),ce=F||T;if(!m.unlockUpgrade&&!ce&&(!h||!y?.hideCost)){let ie=u(j,"upg-costs");ue(ie);let Se=Tc(m.upg.costType,W),Ne=`Cost: ${C} ${O[m.upg.costType].fmt(W)} ${Se}`,_e=u(ie,"cost-line","div");if(_e.className.includes("upg-line")||(_e.className="upg-line cost-line"),_e.innerHTML!==Ne&&(_e.innerHTML=Ne),l){let Ie=u(ie,"milestone-line","div");Ie.className.includes("upg-line")||(Ie.className="upg-line milestone-line");let w="\u2014",V="",z=ny(m.upg);try{if(m.hmNextMilestone&&m.hmNextMilestone.cmp(m.lvlBn)>0)if(z){let ae=m.hmNextMilestone.sub(c.fromInt(1)),Ge=0;try{let be=ae.toPlainIntegerString?.();be&&be!=="Infinity"?Ge=Number(be):Ge=Number(ae.toString())}catch{Ge=0}let tt=c.fromInt(0);try{tt=c.fromAny(m.upg.costAtLevel(Ge))}catch{}w=O[m.upg.costType].fmt(tt),V=Tc(m.upg.costType,tt)}else{let ae=m.hmNextMilestone.sub(m.lvlBn),Ge=ae.toPlainIntegerString?.(),tt=Math.max(0,Math.floor(Number(Ge&&Ge!=="Infinity"?Ge:Number(ae.toString()||0)))),{spent:be}=ci(m.upg,m.lvlBn,c.fromAny("Infinity"),tt);w=O[m.upg.costType].fmt(be),V=Tc(m.upg.costType,be)}}catch{}let ge=`${z?"Cost at next milestone:":"Cost to next milestone:"} ${C} ${w} ${V}`;Ie.innerHTML!==ge&&(Ie.innerHTML=ge)}else{let Ie=ie.querySelector(".milestone-line");Ie&&Ie.remove()}let Re=Tc(m.upg.costType,m.have),se=`You have: ${C} ${O[m.upg.costType].fmt(m.have)} ${Re}`,ne=u(ie,"have-line","div");ne.className.includes("upg-line")||(ne.className="upg-line have-line"),ne.innerHTML!==se&&(ne.innerHTML=se)}else{let ie=j.querySelector(".upg-costs");ie&&ie.remove()}let me=it.querySelector(".upg-milestones"),Z=me.querySelector(".hm-view-milestones-row");if(!Z){Z=document.createElement("div"),Z.className="hm-view-milestones-row";let ie=document.createElement("button");ie.type="button",ie.className="shop-delve hm-view-milestones",ie.textContent="View Milestones",ie.addEventListener("click",Se=>{ie._onClick&&ie._onClick(Se)}),Z.appendChild(ie),me.appendChild(Z)}let re=Z.querySelector("button");l&&!b?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ie=Array.isArray(m.hmMilestones)?m.hmMilestones:[],Se=Math.max(0,Math.floor(Number(m.hmEvolutions??0))),Ne=(()=>{try{return BigInt(Gt)*BigInt(Se)}catch{return 0n}})(),_e=ie.sort((Re,se)=>Number(Re?.level||0)-Number(se?.level||0)).map(Re=>{let se=Math.max(0,Math.floor(Number(Re?.level||0))),ne=(()=>{if(m.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(se)+Ne).toString())}catch{return c.fromAny(se+Gt*Se)}})(),Ie=ne?.isInfinite?.()?"Infinity":J(ne),w=lt(Re?.multiplier??Re?.mult??Re?.value??1),V=`${Re?.target??Re?.type??"self"}`.toLowerCase(),z=(()=>{if(m.lvlBn?.isInfinite?.())return!0;try{return m.lvlBn?.cmp?.(ne)>=0}catch{}return!1})(),oe=`Level ${Ie}: Multiplies this upgrade\u2019s effect by ${w}x`;return V==="xp"&&(oe=`Level ${Ie}: Multiplies XP value by ${w}x`),(V==="coin"||V==="coins")&&(oe=`Level ${Ie}: Multiplies Coin value by ${w}x`),V==="mp"&&(oe=`Level ${Ie}: Multiplies MP value by ${w}x`),{text:oe,achieved:z}});cw(_e)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ye=it.querySelector(".upg-actions"),Le=ye.querySelector(".shop-close");if(Le||(Le=document.createElement("button"),Le.type="button",Le.className="shop-close",Le.textContent="Close",Le.addEventListener("click",()=>{n=!1,ly()}),ye.appendChild(Le)),h||F)ye.querySelectorAll("button:not(.shop-close)").forEach(ie=>ie.remove()),document.activeElement&&document.activeElement!==Le&&!ye.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Le.focus();else{let ie=m.have.cmp(W)>=0,Se=(se,ne,Ie,w,V=!1)=>{let z=ye.querySelector(`.${se.split(" ").join(".")}`);if(!z){z=document.createElement("button"),z.type="button",z.className=se,z.textContent=ne;let oe=()=>{typeof z._onClick=="function"&&z._onClick()};"PointerEvent"in window?z.addEventListener("pointerdown",ae=>{ae.pointerType==="mouse"||typeof ae.button=="number"&&ae.button!==0||(oe(),ae.preventDefault())},{passive:!1}):z.addEventListener("touchstart",ae=>{oe(),ae.preventDefault()},{passive:!1}),z.addEventListener("click",()=>{je||oe()});let ge=ye.children;w>=ge.length?ye.appendChild(z):ye.insertBefore(z,ge[w])}return z._onClick=Ie,z.textContent!==ne&&(z.textContent=ne),z.disabled!==V&&(z.disabled=V),z};if(T){ye.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(se=>se.remove()),Se("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:se}=o.evolve(e.id);se&&(sy(),kr(),p())},1,!1);return}if(m.unlockUpgrade){ye.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(se=>se.remove()),Se("shop-delve btn-unlock","Unlock",()=>{let{bought:se}=o.buyOne(e.id);if(!(se instanceof c?se:c.fromAny(se??0)).isZero?.()){if(Qt(),Ac(e,t))try{$a(["reset"])}catch{}kr(),p()}},1,!ie);return}if(ye.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(se=>se.remove()),Se("shop-delve btn-buy-one","Buy",()=>{let se=o.getUiModel(e.id);if(se.have.cmp(se.nextPrice instanceof c?se.nextPrice:c.fromAny(se.nextPrice||0))<0)return;let{bought:ne}=o.buyOne(e.id);(ne instanceof c?ne:c.fromAny(ne??0)).isZero?.()||(Qt(),kr(),p())},1,!ie),(Number.isFinite(m.upg.lvlCap)?m.upg.lvlCap:1/0)===1){let se=ye.querySelector(".btn-buy-max");se&&se.remove();let ne=ye.querySelector(".btn-buy-cheap");ne&&ne.remove()}else{Se("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:w}=o.buyMax(e.id);(w instanceof c?w:c.fromAny(w??0)).isZero?.()||(Qt(),kr(),p())},2,!ie);let ne=[1,3,4,5,6].includes(Ad(m.upg));if(!l&&!ne)Se("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let V=o.buyCheap;if(!V)return;let{bought:z}=V(e.id);(z instanceof c?z:c.fromAny(z??0)).isZero?.()||(Qt(),kr(),p())},3,!ie);else{let Ie=ye.querySelector(".btn-buy-cheap");Ie&&Ie.remove()}}if(l)Se("shop-delve btn-buy-next","Buy Next",()=>{let ne=o.getUiModel(e.id);if(ne.hmReadyToEvolve)return;let Ie=ne.hmNextMilestone;if(!Ie||!ne.lvlBn||Ie.cmp(ne.lvlBn)<=0){let{bought:be}=o.buyMax(e.id);if((be instanceof c?be:c.fromAny(be??0)).isZero?.())return;Qt(),kr(),p();return}let w=0;try{let be=Ie.sub(ne.lvlBn).toPlainIntegerString?.();w=Math.max(0,Math.floor(Number(be&&be!=="Infinity"?be:Ie.sub(ne.lvlBn).toString())))}catch{}let V=O[ne.upg.costType]?.value,z=V instanceof c?V:c.fromAny(V??0),ge=ci(ne.upg,ne.lvlBn,z,w).count,ae=!1;try{let be=ge?.toPlainIntegerString?.();ae=be&&be!=="Infinity"?Number(be)>=w:Number(ge??0)>=w}catch{}let Ge=ae?o.buyNext(e.id,w):o.buyMax(e.id);(Ge.bought instanceof c?Ge.bought:c.fromAny(Ge.bought??0)).isZero?.()||(Qt(),kr(),p())},3,m.have.cmp(c.fromInt(1))<0);else{let se=ye.querySelector(".btn-buy-next");se&&se.remove()}}},g=()=>{n&&p()};o.events.forEach(m=>window.addEventListener(m,g)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",g),p(),en.classList.add("is-open"),en.classList.toggle("is-automation-upgrade",t==="automation"),en.style.pointerEvents="auto",_n(140),it.style.transition="none",it.style.transform="translateY(100%)",it.offsetHeight,requestAnimationFrame(()=>{it.style.transition="",it.style.transform=""}),Nc=()=>{n=!1,o.events.forEach(m=>window.removeEventListener(m,g)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",g)}}function ld(e,t,n,o){let r=null;function i(d){if(!n())return;let f=typeof d.clientY=="number"?d.clientY:d.touches?.[0]?.clientY||0;r={startY:f,lastY:f,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(d){if(!r||r.canceled)return;let f=d.clientY;if(typeof f!="number")return;let p=Math.max(0,f-r.startY);r.lastY=f,r.moved=p,t.style.transform=`translateY(${p}px)`}function l(){if(!r||r.canceled)return u();let d=Math.max(1,performance.now()-r.startT),f=r.moved;f/d>.55&&f>40||f>140?(So(100),_n(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",d=>d.preventDefault(),{passive:!1})}var jg,jI,ZI,JI,Zg,QI,ew,tw,Qg,nw,ow,ry,iy,iw,ey,Oc,Pc,en,it,Bc,Nc,ti=$e(()=>{St();Ct();Kt();Eo();_c();Gl();Fn();fn();Yi();Zr();kc();jg={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp"},jI="img/misc/locked_base.webp",ZI="img/misc/maxed.webp",JI="img/misc/green_border.webp",Zg={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp"},QI=7,ew={coins:Sa,books:Ia,gold:wa,magic:Ea};tw={coins:Sa,books:Ia,gold:wa,magic:Ea};Qg={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Jg(Yn()),getUiModel:e=>Xa(Yn(),e),buyOne:e=>Ga(Yn(),e),buyMax:e=>Fc(Yn(),e),buyCheap:e=>Rd(Yn(),e),buyNext:(e,t)=>Ha(Yn(),e,t),getLockState:e=>Wo(Yn(),e),evolve:e=>Nd(Yn(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",wd,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Jg(Ke),getUiModel:e=>Xa(Ke,e),buyOne:e=>Ga(Ke,e),buyMax:e=>Fc(Ke,e),buyNext:(e,t)=>Ha(Ke,e,t),getLockState:e=>Wo(Ke,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof v=="function"?v():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||kr(!0)});nw="sounds/purchase_upg.ogg",ow="sounds/evolve_upg.ogg",ry=.12,iy=.3;iw="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",ey="ccc-scroll-timeline-styles";Oc=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return oy(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!Bg(),o=v();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let W=document.createElement("div");W.className="shop-tile";let ce=document.createElement("img");ce.className="base",ce.alt="";let me=document.createElement("img");me.className="icon",me.alt="",me.addEventListener("error",()=>{me.src=iw}),W.appendChild(ce),W.appendChild(me),i.appendChild(W),t.appendChild(i),i.addEventListener("click",Z=>{let re=Z.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){Z.preventDefault(),Z.stopImmediatePropagation();return}if(to(re)){Z.preventDefault(),Z.stopImmediatePropagation();return}if(Z.shiftKey||Z.ctrlKey){if(Z.preventDefault(),Z.stopImmediatePropagation(),!re.upgMeta)return;let ye=re.upgMeta.id,Le=re.upgMeta.upgType==="HM",ie=[1,3,4,5,6].includes(Ad(re.upgMeta));if(Z.shiftKey){if(!ie&&this.adapter.buyCheap){let{bought:_e}=this.adapter.buyCheap(ye);(_e instanceof c?_e:c.fromAny(_e??0)).isZero?.()||(Qt(),this.update());return}let{bought:Se}=this.adapter.buyMax(ye);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Qt(),Ac(re.upgMeta,this.mode))try{$a(["reset"])}catch{}this.update()}return}if(Z.ctrlKey){if(Le){let _e=this.adapter.getUiModel(ye);if(_e&&!_e.hmReadyToEvolve){let Re=_e.hmNextMilestone;if(Re&&_e.lvlBn&&Re.cmp(_e.lvlBn)>0){let se=0;try{let oe=Re.sub(_e.lvlBn).toPlainIntegerString?.();se=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Re.sub(_e.lvlBn).toString())))}catch{}let ne=O[_e.upg.costType]?.value,Ie=ne instanceof c?ne:c.fromAny(ne??0),V=ci(_e.upg,_e.lvlBn,Ie,se).count,z=!1;try{let oe=V?.toPlainIntegerString?.();z=oe&&oe!=="Infinity"?Number(oe)>=se:Number(V??0)>=se}catch{}if(z){let oe=this.adapter.buyNext(ye,se);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(Qt(),this.update());return}}}}let{bought:Se}=this.adapter.buyMax(ye);if(!(Se instanceof c?Se:c.fromAny(Se??0)).isZero?.()){if(Qt(),Ac(re.upgMeta,this.mode))try{$a(["reset"])}catch{}this.update()}return}}re.upgMeta&&uw(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",Z=>{if(je)return;let re=Z.currentTarget;if(re.dataset.locked==="1"||(Z.preventDefault(),Z.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:Se}=this.adapter.evolve(re.upgMeta.id);Se&&(sy(),this.update());return}let{bought:Le}=this.adapter.buyMax(re.upgMeta.id);if(!(Le instanceof c?Le:c.fromAny(Le??0)).isZero?.()){if(Qt(),Ac(re.upgMeta,this.mode))try{$a(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),d=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",d),i.disabled=d,d?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=d?"1":"0",i.dataset.mysterious=u?"1":"0";let p=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",p);let g=s?c.fromInt(0):aw(r.meta,r.levelNumeric,r.level),m=g instanceof c?g:c.fromAny(g),y=J(r.level),h=Rc(y),b=J(m),E=Rc(b),L=!m.isZero?.(),R=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,T=Number.isFinite(R)?Math.max(0,Math.floor(R)):1/0,F=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,U=p?!1:r.level?.isInfinite?.()?!0:Number.isFinite(T)&&Number.isFinite(F)?F>=T:!1,q=Number.isFinite(T)&&T===1,x=!!r.meta?.unlockUpgrade,B=!s&&x&&!U,M=!s&&x&&!B&&U,_,X,Q=!1,fe=!1;if(s){_="",X="";let W=u?(r.lockState?.reason||"").trim():"",ce=W?`${r.title} (Locked, ${W})`:`${r.title} (Locked)`;i.setAttribute("aria-label",ce)}else{if(B||M)_=B?"Unlockable":"Unlocked",X=_,fe=!0;else if(!s&&q&&!x)U?(_="Owned",X="Owned"):L?(_="Purchasable",X="Purchasable"):(_="Not Owned",X="Not Owned"),fe=!0;else{let W=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,ce=String(h||"").replace(/,/g,""),me=/|Infinity/i.test(ce),Z=Number.isFinite(W)?W>=1e3:me||/^\d{4,}$/.test(ce);Q=L&&Z,Q?(_=`<span class="badge-lvl">${y}</span><span class="badge-plus">(+${b})</span>`,X=`${h} (+${E})`):(_=L?`${y} (+${b})`:y,X=L?`${h} (+${E})`:h)}i.setAttribute("aria-label",`${r.title}, ${X}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let K=i.firstElementChild,ee=K.querySelector(".base"),ve=K.querySelector(".icon"),he=r.meta?.costType||"coins",te=r.useLockedBase||s?jI:r.baseIconOverride||jg[he]||jg.coins;ee.src!==te&&(ee.src=te);let $=r.icon;if(!$)ve.hidden||(ve.hidden=!0);else{ve.hidden&&(ve.hidden=!1);let W=$;ve._lastSrc!==W&&(ve.src=W,ve._lastSrc=W)}let G=K.querySelector(".maxed-overlay"),j=!s&&ny(r.meta),le=!s&&U;if(le||!s&&!U&&!p&&j){G||(G=document.createElement("img"),G.className="maxed-overlay",G.alt="",K.insertBefore(G,ve));let W=le?ZI:JI;G.src!==W&&(G.src=W)}else G&&G.remove();let C=K.querySelector(".level-badge");s?C&&C.remove():(C||(C=document.createElement("span"),C.className="level-badge",K.appendChild(C)),C.className="level-badge",fe&&C.classList.add("text-badge"),Q&&C.classList.add("two-line"),(L||B)&&C.classList.add("can-buy"),U&&C.classList.add("is-maxed"),_===X?C.textContent!==_&&(C.textContent=_):C.innerHTML!==_&&(C.innerHTML=_))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),ls(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&to(a)||(Cr(),Gg())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{je&&_n(80),this.close()},{passive:!0}),ld(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=v();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&Wg(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,je)try{setTimeout(()=>So(240),120)}catch{}_n(10),ls(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}},Pc={standard:new Oc("standard"),automation:new Oc("automation")};en=null,it=null,Bc=!1,Nc=null});var fy={};bt(fy,{applyHudLayout:()=>zo,initHudButtons:()=>dw,isMapUnlocked:()=>Fd,isShopUnlocked:()=>Bd,lockMap:()=>Gc,lockShop:()=>qc,unlockMap:()=>$c,unlockShop:()=>ui});function Pd(e){let t=v();return t==null?e:`${e}:${t}`}function vs(e){let t=Pd(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function Bd(){return Ud(),vs(ao.SHOP)}function Fd(){return Ud(),vs(ao.MAP)}function Dc(e,t){let n=t?"1":"0",o=Pd(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:v()}}))}catch{}}function Ud(){for(let e of Object.values(ao)){let t=Pd(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function _o(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function Od(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",Pi())}function fw(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function zo(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=fw(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(g=>e.querySelector(`.game-btn[data-btn="${g}"]`)).filter(Boolean),a=[...e.children].filter(g=>!l.includes(g)),u=[...l,...a];if(u.length&&u.some((g,m)=>e.children[m]!==g)){let g=document.createDocumentFragment();u.forEach(m=>g.appendChild(m)),e.appendChild(g)}let p=[...e.querySelectorAll(".game-btn")].filter(g=>!g.hidden);if(e.classList.remove("is-2","is-3","is-4"),p.forEach(g=>{g.style.gridColumn="",g.style.gridRow="",g.classList.remove("span-2"),g.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${p.length}`),!o){let g=getComputedStyle(e),m=parseFloat(g.columnGap||g.gap||"0")||0,y=e.clientWidth,h=Math.max(180,Math.floor((y-3*m)/4));if(p.length===2){e.style.gridTemplateColumns=`1fr ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3";return}if(p.length===3){e.style.gridTemplateColumns=`1fr ${h}px ${h}px ${h}px 1fr`,p[0].style.gridColumn="2",p[1].style.gridColumn="3",p[2].style.gridColumn="4";return}}if(o&&p.length===3){let g=e.querySelector('[data-btn="help"]:not([hidden])'),m=e.querySelector('[data-btn="stats"]:not([hidden])'),y=e.querySelector('[data-btn="shop"]:not([hidden])');g&&m&&y&&(g.style.gridColumn="1",g.style.gridRow="1",m.style.gridColumn="2",m.style.gridRow="1",y.style.gridColumn="1 / -1",y.style.gridRow="2")}}function dw(){if(Ud(),_o("help",!0),_o("stats",!0),_o("shop",vs(ao.SHOP)),_o("map",vs(ao.MAP)),Od(),zo(),cy||(cy=!0,window.addEventListener("resize",zo),window.addEventListener("orientationchange",zo),window.addEventListener("saveSlot:change",()=>{_o("shop",vs(ao.SHOP)),_o("map",vs(ao.MAP)),Od(),zo()}),window.addEventListener("saveSlot:modified",e=>{let t=v(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||Od()})),!uy){uy=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&sc()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&to(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function ui(){Dc(ao.SHOP,!0),_o("shop",!0),zo()}function $c(){Dc(ao.MAP,!0),_o("map",!0),zo()}function qc(){Dc(ao.SHOP,!1),_o("shop",!1),zo()}function Gc(){Dc(ao.MAP,!1),_o("map",!1),zo()}var ao,cy,uy,Hc=$e(()=>{ti();St();Yi();ao={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};cy=!1,uy=!1});function dy(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(W=>W.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,d=4,f=new Float32Array(t*d);for(let C=0;C<t;C++)f[C*d+2]=1/0;let p=new Int16Array(t),g=t;for(let C=0;C<t;C++)p[C]=t-1-C;let m=-1,y=document.createElement("canvas");y.className="cursor-trail-canvas",Object.assign(y.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(y);let h=y.getContext("2d",{alpha:!0,desynchronized:!0}),b=document.createElement("canvas");b.width=a,b.height=a;let E=b.getContext("2d");E.shadowColor="#FFEB3B",E.shadowBlur=l,E.fillStyle="#FFEB3B",E.beginPath(),E.arc(u,u,s,0,Math.PI*2),E.fill();let L=!1,R=null,T=null,F={left:0,top:0,width:0,height:0},U=1,q=!1,x=0,B=0,M=!1,_=null,X=[],Q=()=>{if(q)return;let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;F={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}},fe=()=>{if(q)return;Q();let C=Math.min(window.devicePixelRatio||1,2);U=F.width>0?Math.min(C,512/F.width):C,y.width=F.width*U,y.height=F.height*U,h.scale(U,U),_=null},K=null;typeof ResizeObserver<"u"&&(K=new ResizeObserver(()=>{fe()}),K.observe(e));let ee=(C,W)=>{if(g<=0)return;let ce=p[--g];ce>m&&(m=ce);let me=ce*d;f[me]=C,f[me+1]=W,f[me+2]=0,f[me+3]=n},ve=(C,W,ce)=>{if(R===null||T===null)ce.count<r&&(ee(C,W),ce.count++);else{let me=C-R,Z=W-T,re=Math.hypot(me,Z);if(re>=o){let ye=Math.floor(re/o);for(let Le=1;Le<=ye&&!(ce.count>=r);Le++){let ie=Le*o/re;ee(R+me*ie,T+Z*ie),ce.count++}}ce.count<r&&(ee(C,W),ce.count++)}R=C,T=W},he=C=>{if(q)return;x||(B=0,x=requestAnimationFrame(te)),F.width||Q();let W=0,ce=0,me=(Z,re)=>Z>=0&&Z<=F.width&&re>=0&&re<=F.height;if(C.getCoalescedEvents){let Z=C.getCoalescedEvents();if(Z.length>0)for(let re of Z){let ye=re.clientX-W,Le=re.clientY-ce;X.push({x:ye,y:Le,inside:me(ye,Le)})}else{let re=C.clientX-W,ye=C.clientY-ce;X.push({x:re,y:ye,inside:me(re,ye)})}}else{let Z=C.clientX-W,re=C.clientY-ce;X.push({x:Z,y:re,inside:me(Z,re)})}},Y=()=>{L=!1,R=null,T=null,X.length=0},te=()=>{if(q)return;let C=performance.now();B||(B=C);let W=C-B;B=C,W>100&&(W=100);let ce={count:0};if(X.length>0){for(let Ne of X)Ne.inside?(L=!0,ve(Ne.x,Ne.y,ce)):(L=!1,R=null,T=null);let Se=X[X.length-1];Se.inside&&(R!==Se.x||T!==Se.y)&&(ee(Se.x,Se.y),R=Se.x,T=Se.y),X.length=0}else L&&R!==null&&T!==null&&ee(R,T);let me=t-g;if(me===0&&!M){x=0;return}_?h.clearRect(_.x,_.y,_.w,_.h):h.clearRect(0,0,F.width,F.height),M=!1;let Z=1/0,re=1/0,ye=-1/0,Le=-1/0,ie=-1;if(me>0)for(let Se=0;Se<=m;Se++){let Ne=Se*d,_e=f[Ne+2];if(_e>=f[Ne+3])continue;if(_e+=W,f[Ne+2]=_e,_e>=f[Ne+3]){p[g++]=Se;continue}ie=Se;let Re=f[Ne+3],se=_e/Re,ne=1-se,Ie=1-.4*se;M=!0,h.globalAlpha=ne;let w=a*Ie,V=w/2,z=f[Ne],oe=f[Ne+1],ge=Math.round(z-V),ae=Math.round(oe-V),Ge=Math.round(w);h.drawImage(b,ge,ae,Ge,Ge),ge<Z&&(Z=ge),ae<re&&(re=ae);let tt=ge+Ge,be=ae+Ge;tt>ye&&(ye=tt),be>Le&&(Le=be)}m=ie,Z!==1/0?(Z-=2,re-=2,ye+=2,Le+=2,_={x:Z,y:re,w:ye-Z,h:Le-re}):_=null,x=requestAnimationFrame(te)};window.addEventListener("resize",fe),window.addEventListener("scroll",Q,{passive:!0}),window.addEventListener("focus",Q,{passive:!0}),document.addEventListener("visibilitychange",Q,{passive:!0});let $={passive:!0},G=C=>{Q(),he(C)},j=C=>{Q(),he(C)};e.addEventListener("pointermove",he,$),e.addEventListener("pointerdown",j,$),e.addEventListener("pointerenter",G,$),e.addEventListener("pointerleave",Y,$),e.addEventListener("pointercancel",Y,$),fe(),x=requestAnimationFrame(te);let le=setInterval(Q,1e3);return{destroy:()=>{q=!0,x&&cancelAnimationFrame(x),le&&clearInterval(le),K&&(K.disconnect(),K=null);try{window.removeEventListener("resize",fe)}catch{}try{window.removeEventListener("scroll",Q)}catch{}try{window.removeEventListener("focus",Q)}catch{}try{document.removeEventListener("visibilitychange",Q)}catch{}try{e.removeEventListener("pointermove",he),e.removeEventListener("pointerdown",j),e.removeEventListener("pointerenter",G),e.removeEventListener("pointerleave",Y),e.removeEventListener("pointercancel",Y)}catch{}y.remove()}}}var py=$e(()=>{});var xy={};bt(xy,{clearPendingGains:()=>zd,getPassiveCoinReward:()=>gc,initCoinPickup:()=>Iw,setCoinMultiplier:()=>gw,triggerPassiveCollect:()=>kd});function my(e){if(!e||typeof e!="object"){Va=!1,Xc=!1,Yc="0",pi.clear();return}Va=!!e.unlocked,Xc=!!e.level?.isInfinite?.();try{Yc=e.level?.toPlainIntegerString?.()??"0"}catch{Yc="0"}Va?Xc&&pi.clear():pi.clear()}function pw(){if(typeof fi=="function")try{fi()}catch{}try{my(ct())}catch{Va=!1,pi.clear()}try{fi=mi(e=>{my(e)})}catch{fi=null}}function gw(e){hw=e;try{O.coins?.mult?.set&&O.coins.mult.set(e)}catch{}}function Gd(){try{let e=Wc();e instanceof c?Ss=e.clone?.()??e:e!=null?Ss=c.fromAny(e):Ss=c.fromInt(1)}catch{Ss=c.fromInt(1)}}function yw(){hy||(hy=!0,Gd(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",Gd),typeof window<"u"&&window.addEventListener("saveSlot:change",Gd))}function vw(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Vd.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function Yd(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*bw:0}function Sw({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,d=0,f=0,p=0,g=null,m=null,y=Yd(),h=0,b=0,E=0,L=!1,R=null,T=null,F=()=>{if(L)return;let $=document.documentElement.clientWidth,G=document.documentElement.clientHeight;R={left:0,top:0,width:$,height:G,right:$,bottom:G,x:0,y:0}},U=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",g=null,m=null},q=()=>{if(!l||b<=0){U();return}let $=b*2;s.style.width=`${$}px`,s.style.height=`${$}px`,s.style.transform=`translate3d(${f-b}px, ${p-b}px, 0)`,s.classList.add("is-visible")},x=()=>{if(!(!l||b<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let $=b+Hd,G=[];if(typeof i.findCoinTargetsInPath=="function"&&g!==null&&m!==null?G=i.findCoinTargetsInPath(g,m,f,p,$):G=i.findCoinTargetsInRadius(f,p,$),g=f,m=p,G&&G.length>0)if(typeof r=="function"){let j=[];for(let le=0;le<G.length;le++){let ue=G[le],C={coin:ue};ue.el&&i.getCoinTransform&&(C.opts={transform:i.getCoinTransform(ue.el)}),j.push(C)}r(j)}else for(let j=0;j<G.length;j++){let le=G[j],ue=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(ue){let C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform||"";o(ue,{transform:C})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let $=b+Hd,G=i.findCoinsInRadius(f,p,$);if(g=f,m=p,G&&G.length>0){let j=[];for(let le=0;le<G.length;le++){let ue=G[le],C=i.getCoinTransform?i.getCoinTransform(ue):ue.style.transform;j.push({el:ue,opts:{transform:C}})}typeof r=="function"&&r(j)}}else{let $=t.children,G=b+Hd,j=[];for(let le=$.length-1;le>=0;le--){let ue=$[le];if(ue.dataset.collected==="1"||!ue.matches(n))continue;let C=ue.getBoundingClientRect(),W=C.left+C.width/2,ce=C.top+C.height/2,me=W-u,Z=ce-d;Math.hypot(me,Z)<=G&&j.push(ue)}if(!j.length)return;if(typeof r=="function"){let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push({el:C,opts:{transform:W.transform}})}r(le)}else{let le=[];for(let ue=0;ue<j.length;ue++){let C=j[ue],W=window.getComputedStyle(C);le.push(W.transform)}for(let ue=0;ue<j.length;ue++)o(j[ue],{transform:le[ue]})}}},B=()=>{E=0,q(),!(!l||b<=0||L)&&(x(),M())},M=()=>{!l||b<=0||E||L||(E=requestAnimationFrame(B))},_=$=>{if(!$||L||typeof $.clientX!="number"||typeof $.clientY!="number")return;a=!0,u=$.clientX,d=$.clientY,R||F();let G=R;f=u,p=d,l=f>=0&&f<=G.width&&p>=0&&p<=G.height,M()},X=()=>{l=!1,U(),g=null,m=null},Q=()=>{g=null,m=null},fe=()=>{h=zc(),b=h*y,q(),M()},K=()=>{if(!(L||!a)){if(F(),R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()}},ee=()=>{if(y=Yd(),b=h*y,F(),a&&R){let $=R;f=u-$.left,p=d-$.top,l=f>=0&&f<=$.width&&p>=0&&p<=$.height}M()},ve=$=>{F(),_($)},he=$=>{Q(),ve($)},Y=()=>{L=!0,E&&(cancelAnimationFrame(E),E=0),T&&clearInterval(T);try{window.removeEventListener("scroll",K)}catch{}try{window.removeEventListener("resize",ee)}catch{}try{window.removeEventListener("saveSlot:change",fe)}catch{}try{document.removeEventListener("ccc:upgrades:changed",fe)}catch{}try{e.removeEventListener("pointermove",_)}catch{}try{e.removeEventListener("pointerdown",ve)}catch{}try{e.removeEventListener("pointerenter",he)}catch{}try{e.removeEventListener("pointerleave",X)}catch{}try{e.removeEventListener("pointercancel",X)}catch{}try{window.removeEventListener("blur",Q)}catch{}try{s.remove()}catch{}},te={passive:!0};return e.addEventListener("pointermove",_,te),e.addEventListener("pointerdown",ve,te),e.addEventListener("pointerenter",he,te),e.addEventListener("pointerleave",X,te),e.addEventListener("pointercancel",X,te),window.addEventListener("resize",ee),window.addEventListener("scroll",K,{passive:!0}),window.addEventListener("focus",F,{passive:!0}),window.addEventListener("blur",Q,{passive:!0}),document.addEventListener("visibilitychange",()=>{F(),document.hidden&&Q()},{passive:!0}),window.addEventListener("saveSlot:change",fe),document.addEventListener("ccc:upgrades:changed",fe),T=setInterval(F,1e3),fe(),{destroy:Y}}function zd(){Wa=null,za=null,Ka=null}function Ey(e){let t=Vd.clone?.()??c.fromInt(1),n=Iy(t),o=lo(gy),i=wy(e??Yc);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Co=="function"&&Co()?lo(Ss):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function gc(){let{coinGain:e,xpGain:t,mpGain:n}=Ey(null);return{coins:e,xp:t,mp:n}}function kd(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=Ey(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=Un(Ce.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{Mn=Mn?.add?Mn.add(r):lo(r)}catch{Mn=lo(r)}Ya(),a||yy(r);let u=typeof un=="function"?un():!0,d=typeof i?.isZero=="function"?i.isZero():!1;u&&!d&&vy(i),s.isZero?.()||by(s)}function Iw({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){Dd?.destroy&&Dd.destroy();let a=document.querySelector(t),u=document.querySelector(n),d=document.querySelector(o);if(!a||!u||!d)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!d}),{destroy(){}};pw(),yw(),a.style.touchAction="none";let f=null,p=null;Mn=O.coins.value,Xd=()=>{let C=J(Mn);C.includes("<span")?d.innerHTML=C:d.textContent=C},Sy(),Ya();let g=C=>{C?.detail&&C.detail.key==="coins"&&(Mn=C.detail.value,Ya())};window.addEventListener("currency:change",g);let m=C=>{if(!(!C?.detail||C.detail.key!=="coins"))try{let{mult:W}=C.detail;W instanceof c?Vn=W.clone?.()??W:W!=null?Vn=c.fromAny(W):Vn=c.fromInt(1),di=!!Vn?.isInfinite?.()}catch{Vn=null,di=!1}};window.addEventListener("currency:multiplier",m);let y=v();if(y==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let h=`ccc:unlock:shop:${y}`,b=`ccc:unlock:shop:progress:${y}`,E=localStorage.getItem("ccc:unlock:shop:progress"),L=localStorage.getItem("ccc:unlock:shop");E!=null&&localStorage.getItem(b)==null&&localStorage.setItem(b,E),L!=null&&localStorage.getItem(h)==null&&localStorage.setItem(h,L),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let C=parseInt(localStorage.getItem(b)||"0",10);if(localStorage.setItem(b,String(C)),C>=10&&localStorage.getItem(h)!=="1"){try{ui()}catch{}localStorage.setItem(h,"1")}}let R=new URL(i,document.baseURI).href,T=C=>C instanceof HTMLElement?C._coinObj?!C._coinObj.isRemoved&&C.dataset.collected!=="1":C.dataset.collected!=="1"&&C.matches(r):!1;function F(C){try{C.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(F);let U=je?.12:.3,q=0;function x(C=R){if(C===R){let W=performance.now();if(W-q<40)return;q=W}ft(C,{volume:U})}function B(C,W={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(C);let ce=()=>{C&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(C):C.remove())};if(l||je){ce();return}let me="translate3d(0,0,0)";W.transform?W.transform!=="none"&&(me=W.transform):me=C.style.transform||"translate3d(0,0,0)",C.style.setProperty("--ccc-start",me),C.classList.add("coin--collected");let Z=!1,re=()=>{Z||(Z=!0,C.removeEventListener("animationend",re),ce())};C.addEventListener("animationend",re),setTimeout(re,600)}function M(C){if(!C||!C.length)return;let W=R,ce=-1,me=!1;for(let se of C){let ne=se.coin||se.el&&se.el._coinObj;ne&&(ne.sizeIndex!==void 0?ne.sizeIndex>ce&&(ce=ne.sizeIndex,ne.soundSrc&&(W=ne.soundSrc,me=!0)):ne.soundSrc&&!me&&(W=ne.soundSrc,me=!0))}x(W);let Z=null,re=null,ye=null,Le=0,ie=Un(Ce.COINS),Se=typeof un=="function"?un():!0,Ne=typeof Co=="function"&&Co(),_e=15,Re=0;for(let se of C){let ne=se.el,Ie=se.coin;if(!Ie&&ne&&ne._coinObj&&(Ie=ne._coinObj),ne&&!T(ne)||Ie&&Ie.isRemoved)continue;Le++,ne&&(ne.dataset.collected="1"),Re<_e?(!ne&&Ie&&e&&e.ensureCoinVisual&&(ne=e.ensureCoinVisual(Ie),ne&&(ne.dataset.collected="1")),ne?(B(ne,se.opts||{}),Re++):Ie&&e&&e.removeCoinTarget&&e.removeCoinTarget(Ie)):Ie&&e&&e.removeCoinTarget?e.removeCoinTarget(Ie):ne&&(e&&e.detachCoin&&e.detachCoin(ne),e&&e.recycleCoin?e.recycleCoin(ne):ne.remove());let w=ne?vw(ne):Vd,V=Ie?.mutationLevel??(ne?.dataset?.mutationLevel||null),z=Iy(w),oe=lo(gy),ge=lo(Ss);if(Ie&&Ie.valueMultiplier&&Ie.valueMultiplier>1){try{z=z.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(Ie.valueMultiplier)}catch{}try{ge=ge.mulDecimalFloor(Ie.valueMultiplier)}catch{}}let ae=wy(V);if(ae){try{z=z.mulBigNumInteger(ae)}catch{}try{oe=oe.mulBigNumInteger(ae)}catch{}}ie||(Z=Is(Z,z)),Se&&(re=Is(re,oe)),Ne&&(ye=Is(ye,ge))}if(Le!==0){if(Z&&!Z.isZero?.()){try{Mn=Mn?.add?Mn.add(Z):lo(Z)}catch{Mn=lo(Z)}yy(Z),Ya()}if(re&&!re.isZero?.()&&vy(re),ye&&!ye.isZero?.()&&by(ye),localStorage.getItem(h)!=="1"){let ne=parseInt(localStorage.getItem(b)||"0",10)+Le;if(localStorage.setItem(b,String(ne)),ne>=10){try{ui()}catch{}localStorage.setItem(h,"1")}}}}function _(C,W={}){return M([{el:C,opts:W}]),!0}f=Sw({playfield:a,coinsLayer:u,coinSelector:r,collectFn:_,collectBatchFn:M,spawner:e}),p=dy(a);let X=C=>{if(C.target===u)return;let W=C.target.closest(r);if(W&&T(W)){let ce={};e&&typeof e.getCoinTransform=="function"&&(ce.transform=e.getCoinTransform(W)),_(W,ce)}};u.addEventListener("pointerdown",X,{passive:!0}),je||u.addEventListener("mouseover",X,{passive:!0});let Q=25,fe=null,K=()=>{let C=document.documentElement.clientWidth,W=document.documentElement.clientHeight;fe={left:0,top:0,width:C,height:W,right:C,bottom:W,x:0,y:0}};window.addEventListener("resize",K),window.addEventListener("scroll",K,{passive:!0}),K();let ee=null,ve=null,he=()=>{ee=null,ve=null};a.addEventListener("pointerleave",he,{passive:!0}),a.addEventListener("pointerenter",he,{passive:!0}),window.addEventListener("blur",he,{passive:!0});function Y(C,W){if(e&&typeof e.findCoinTargetsInRadius=="function"){fe||K();let ce=C,me=W,Z=[];if(typeof e.findCoinTargetsInPath=="function"&&ee!==null&&ve!==null?Z=e.findCoinTargetsInPath(ee,ve,ce,me,Q,!0):Z=e.findCoinTargetsInRadius(ce,me,Q,!0),ee=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye=0;ye<Z.length;ye++){let Le=Z[ye],ie={coin:Le};Le.el&&e.getCoinTransform&&(ie.opts={transform:e.getCoinTransform(Le.el)}),re.push(ie)}M(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){fe||K();let ce=C,me=W,Z=e.findCoinsInRadius(ce,me,Q);if(ee=ce,ve=me,Z&&Z.length>0){let re=[];for(let ye of Z){let Le=e.getCoinTransform?e.getCoinTransform(ye):ye.style.transform;re.push({el:ye,opts:{transform:Le}})}M(re)}}else{let ce=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],me=new Set;for(let Z=0;Z<ce.length;Z++){let re=C+ce[Z][0],ye=W+ce[Z][1],Le=document.elementsFromPoint(re,ye);for(let ie=0;ie<Le.length;ie++){let Se=Le[ie];T(Se)&&!me.has(Se)&&me.add(Se)}}if(me.size>0){let Z=[];me.forEach(re=>Z.push({el:re})),M(Z)}}}let te=null,$=!1;function G(C,W){te={x:C,y:W},$||($=!0,requestAnimationFrame(()=>{te&&(Y(te.x,te.y),te=null),$=!1}))}a.addEventListener("pointerdown",C=>{G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointermove",C=>{C.pointerType!=="mouse"&&G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("pointerup",C=>{C.pointerType!=="mouse"&&G(C.clientX,C.clientY)},{passive:!0}),a.addEventListener("mousemove",C=>{G(C.clientX,C.clientY)},{passive:!0});function j(C){}let le=setInterval(K,1e3),ue=()=>{if(clearInterval(le),Vc(),Xd=()=>{},typeof window<"u"&&(window.removeEventListener("resize",K),window.removeEventListener("beforeunload",Vc),window.removeEventListener("currency:multiplier",m),window.removeEventListener("currency:change",g),window.removeEventListener("blur",he)),typeof fi=="function"){try{fi()}catch{}fi=null}if(f?.destroy){try{f.destroy()}catch{}f=null}if(p?.destroy){try{p.destroy()}catch{}p=null}try{u.removeEventListener("pointerdown",X),je||u.removeEventListener("mouseover",X)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(C=>a.replaceWith(a.cloneNode(!0)))}catch{}};return Dd={destroy:ue},{get count(){return Mn},set count(C){Mn=c.fromAny?c.fromAny(C):c.fromInt(Number(C)||0),Ya()},setMobileVolume:j,destroy:ue,collectBatch:M,getMagnetUnitPx:Yd}}var Va,Xc,Yc,fi,Dd,gy,Vd,mw,bs,pi,hw,Ss,hy,Wa,za,Ka,$d,Mn,Xd,qd,Ya,bw,Hd,lo,Is,Vc,Wd,yy,vy,by,Vn,di,Sy,Iy,wy,Pa=$e(()=>{St();Ct();Kt();Hc();Hn();Eo();xo();fn();py();Fn();Va=!1,Xc=!1,Yc="0",fi=null;Dd=null,gy=c.fromInt(1),Vd=c.fromInt(1),mw=c.fromInt(1);try{bs=c.fromAny("Infinity")}catch{bs=null}pi=new Map,hw="1",Ss=c.fromInt(1),hy=!1,Wa=null,za=null,Ka=null,$d=!1,Mn=null,Xd=()=>{},qd=!1,Ya=()=>{qd||(qd=!0,requestAnimationFrame(()=>{qd=!1,Xd()}))};bw=.05,Hd=8;lo=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Is=(e,t)=>{if(!t)return e;if(!e)return lo(t);try{return e.add(t)}catch{try{return lo(e).add(t)}catch{return lo(t)}}},Vc=()=>{let e=Wa;if(Wa=null,e&&!e.isZero?.())try{O.coins.add(e)}catch{}let t=za;if(za=null,t&&!t.isZero?.())try{Gi(t)}catch{}let n=Ka;if(Ka=null,n&&!n.isZero?.())try{us(n)}catch{}},Wd=()=>{$d||($d=!0,requestAnimationFrame(()=>{$d=!1,Vc()}))},yy=e=>{Wa=Is(Wa,e),Wd()},vy=e=>{za=Is(za,e),Wd()},by=e=>{Ka=Is(Ka,e),Wd()};typeof window<"u"&&window.addEventListener("beforeunload",Vc,{passive:!0});Vn=null,di=!1,Sy=()=>{try{let e=O?.coins?.mult;if(!e||typeof e.get!="function"){Vn=null,di=!1;return}let t=e.get();if(!t){Vn=c.fromInt(1),di=!1;return}Vn=t.clone?.()??c.fromAny(t),di=!!Vn?.isInfinite?.()}catch{Vn=null,di=!1}},Iy=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}Vn||Sy();let n=Vn;if(!n)try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(di||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return O?.coins?.mult?.applyTo?O.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},wy=e=>{if(!Va)return null;if(Xc){if(bs)try{return bs.clone?.()??bs}catch{return bs}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=pi.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{pi.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=ws(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(mw)===0,s=r.clone?.()??r;if(pi.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function _y(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let i=Number(e.toString());isNaN(i)||(t=i),(e==="Infinity"||i===1/0)&&(n=!0)}catch{}let o=[],r=[];for(let i of Ly){let s=i;if(n){s={...i,description:[...i.description]};let l=Ft(),a=In(),u=l+a;if(u>1&&(u=1),i.id===1){let d=Math.pow(10,u),f=J(c.fromAny(d));Math.abs(d-Math.round(d))>.001?(f=d.toFixed(2),f.endsWith(".00")&&(f=f.slice(0,-3))):d<1e3&&(f=String(Math.round(d))),s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===2){let d=Math.pow(10,u),f=J(c.fromAny(d));Math.abs(d-Math.round(d))>.001?(f=d.toFixed(2),f.endsWith(".00")&&(f=f.slice(0,-3))):d<1e3&&(f=String(Math.round(d))),s.description[1]=s.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${f}x</span>`)}else if(i.id===4){let d=Math.log10(4444e9),f=Te(d*u),p=J(f);s.description[0]=s.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${p}x</span>`)}}i.surgeLevel<=t?o.push(s):r.push(s)}return[...o,...r.slice(0,2)]}var Ly,Kd,Cy=$e(()=>{Kt();Ct();fn();so();ni();Ly=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${J(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]}],Kd=Ly.filter(e=>e.affectedByTsunami).map(e=>e.id)});function My(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=ft("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function d(w,V){w.style.position="absolute",w.style.left="50%";let z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ge=!!o.mpHTML;V==="coin"?(w.style.top="77%",w.style.transform=`translateX(-50%) ${z}`):oe&&ge?(w.style.top="72.5%",V==="mp"?w.style.transform=`translateX(calc(-100% - 44px)) ${z}`:w.style.transform=`translateX(44px) ${z}`):(V==="mp"?w.style.top="66%":V==="xp"&&(w.style.top="72%"),w.style.transform=`translateX(-50%) ${z}`),w.style.transformOrigin="center center";let ae=w.firstElementChild;ae&&(ae.removeAttribute("hidden"),ae.style.display="flex")}if(o.coinHTML){let w=document.createElement("div");w.innerHTML=o.coinHTML,d(w,"coin"),u.appendChild(w)}if(o.xpHTML){let w=document.createElement("div");w.innerHTML=o.xpHTML,d(w,"xp"),u.appendChild(w)}if(o.mpHTML){let w=document.createElement("div");w.innerHTML=o.mpHTML,d(w,"mp"),u.appendChild(w)}e.appendChild(u);let f=document.createElement("canvas");f.id="tsunami-fg-canvas",f.style.position="absolute",f.style.inset="0",f.style.width="100%",f.style.height="100%",f.style.zIndex="2147483646",f.style.pointerEvents="none",e.appendChild(f);let p=new Image;p.src="img/misc/merchant.webp";let g=!1;p.onload=()=>{g=!0},p.onerror=w=>{console.error("Tsunami: Merchant load failed",w)};let m,y,h=[],b=[],E=0;function L(){h=[],b=[];let w=y*.65,V=w+y*.15,oe=300*(Math.min(m,y)*5e-4),ge=m*.8,ae=ge-oe*.6,Ge=ge+oe*.6;for(let at=0;at<100;at++){let sn=Math.random()*m,Tt=V+Math.random()*(y-V);b.push({x:sn,y:Tt})}let tt=(at,sn,Tt)=>{if(at>m*.1&&at<m*.9){let yn=y-w,go=w+yn*.15;if(sn>go)return!1}else if(Tt==="tree"){let yn=y-w,go=w+yn*.5;if(sn>go)return!1}return!(Tt==="tree"&&at>ae&&at<Ge)},be=(at,sn,Tt,yn,go)=>{for(let rr=0;rr<sn;rr++){let Ao,No,ir=!1,S=0;for(;!ir&&S<50;){go?Ao=go():Ao=Math.random()*m;let k=y,P=Math.random();if(No=w+20+P*P*(k-w-20),tt(Ao,No,at)&&(ir=!0,at==="tree")){for(let A of h)if(A.type==="tree"){let N=A.x-Ao,pe=A.y-No;if(Math.sqrt(N*N+pe*pe)<Math.max(m*.08,100)){ir=!1;break}}}S++}if(ir){let P=.6+(No-w)/(y-w)*.6,A=(Tt+Math.random()*yn)*P;h.push({type:at,x:Ao,y:No,scale:A})}}},Be=3+Math.floor(Math.random()*3);be("tree",Be,.8,.4,()=>Math.random()*(m*.1)),be("tree",Be,.8,.4,()=>m*.9+Math.random()*(m*.1));let Ht=5+Math.floor(Math.random()*3);be("tree",Ht,.8,.4,()=>m*.1+Math.random()*(m*.8)),be("rock",20,.6,.4),be("shell",30,.3,.3),h.sort((at,sn)=>at.y-sn.y)}let R=a.getContext("2d",{alpha:!1}),T=f.getContext("2d",{alpha:!0});function F(){let w=window.devicePixelRatio||1;m=window.innerWidth,y=window.innerHeight,a.width=m*w,a.height=y*w,a.style.width=m+"px",a.style.height=y+"px",f.width=m*w,f.height=y*w,f.style.width=m+"px",f.style.height=y+"px",R.scale(w,w),T.scale(w,w),L(),E=-50}window.addEventListener("resize",F),F();let U=Date.now(),q=!0,x,B=!1,M={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},_={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},X=!1,Q=[],fe=0,K=!1,ee=0,ve=5e3,he=!1,Y=0,te=[],$=6;for(let w=0;w<$;w++)te.push({offset:Math.random()*1e3,speedBase:.001+w*5e-4,amplitudeBase:10+w*5});let G=[],j=400;function le(w,V,z){return w*(1-z)+V*z}function ue(w){let V=parseInt(w.slice(1),16);return{r:V>>16&255,g:V>>8&255,b:V&255}}function C(w,V,z){let oe=ue(w),ge=ue(V),ae=Math.round(le(oe.r,ge.r,z)),Ge=Math.round(le(oe.g,ge.g,z)),tt=Math.round(le(oe.b,ge.b,z));return`rgb(${ae},${Ge},${tt})`}function W(w,V,z){let oe=[],ge=w,ae=V,Ge=20;for(;ae<z;){let tt=ge+(Math.random()-.5)*60,be=ae+Ge+Math.random()*30;oe.push({x1:ge,y1:ae,x2:tt,y2:be}),ge=tt,ae=be}return oe}function ce(w,V,z,oe,ge,ae){w.beginPath(),w.moveTo(V+ae,z),w.lineTo(V+oe-ae,z),w.quadraticCurveTo(V+oe,z,V+oe,z+ae),w.lineTo(V+oe,z+ge-ae),w.quadraticCurveTo(V+oe,z+ge,V+oe-ae,z+ge),w.lineTo(V+ae,z+ge),w.quadraticCurveTo(V,z+ge,V,z+ge-ae),w.lineTo(V,z+ae),w.quadraticCurveTo(V,z,V+ae,z),w.closePath()}function me(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(10,-40,-5,-80),w.lineTo(5,-80),w.quadraticCurveTo(20,-40,10,0),w.fillStyle=ge.rock,w.fill(),w.translate(0,-80),w.fillStyle=ge.leaf;for(let ae=0;ae<7;ae++)w.save(),w.rotate(ae/7*Math.PI*2-Math.PI/2),w.beginPath(),w.moveTo(0,0),w.quadraticCurveTo(30,-10,60,0),w.quadraticCurveTo(30,10,0,0),w.fill(),w.restore();w.restore()}function Z(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.fillStyle=ge.rock,w.beginPath(),w.moveTo(-20,0),w.bezierCurveTo(-20,-15,-10,-25,0,-25),w.bezierCurveTo(10,-25,20,-15,20,0),w.fill(),w.fillStyle="rgba(0,0,0,0.2)",w.beginPath(),w.ellipse(0,0,20,5,0,0,Math.PI*2),w.fill(),w.restore()}function re(w,V,z,oe,ge){w.save(),w.translate(V,z),w.scale(oe,oe),w.fillStyle=ge.shell,w.beginPath(),w.arc(0,0,10,Math.PI,0),w.lineTo(0,0),w.fill(),w.strokeStyle=ge.sandDark,w.lineWidth=1,w.beginPath();for(let ae=1;ae<5;ae++){let Ge=Math.PI+ae/5*Math.PI;w.moveTo(0,0),w.lineTo(Math.cos(Ge)*10,Math.sin(Ge)*10)}w.stroke(),w.restore()}function ye(w,V,z,oe,ge){w.fillStyle=ge.sandDark,w.fillRect(-50,oe,V+100,z-oe),w.fillStyle=ge.sandDark,w.save(),w.fillStyle=ge.sandLight,w.globalAlpha=.3,w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,oe),w.bezierCurveTo(V*.3,oe-20,V*.7,oe+20,V+50,oe),w.lineTo(V+50,z+100),w.fill(),w.globalAlpha=.6;let ae=oe+z*.05;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,ae),w.bezierCurveTo(V*.4,ae+40,V*.6,ae-10,V+50,ae+20),w.lineTo(V+50,z+100),w.fill(),w.globalAlpha=1;let Ge=oe+z*.15;w.beginPath(),w.moveTo(-50,z+100),w.lineTo(-50,Ge),w.bezierCurveTo(V*.2,Ge-10,V*.8,Ge+30,V+50,Ge+10),w.lineTo(V+50,z+100),w.fill(),w.fillStyle=ge.sandDark,w.globalAlpha=.1,b.forEach(tt=>{w.fillRect(tt.x,tt.y,2,2)}),w.restore()}function Le(w,V,z,oe=null){let ge=oe||1,ae=!!oe&&oe>5;X&&!ae&&!he&&ft("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),Q.push({x:ae?V/2:Math.random()*V,y:ae?z/2:Math.random()*z,radius:0,maxRadius:ae?Math.max(V,z)*1.5:(100+Math.random()*400)*ge,speed:ae?40:(5+Math.random()*15)*ge,opacity:1,hue:225+Math.random()*15,life:1})}function ie(w,V,z,oe=.5,ge=!0){let ae=.1+oe*.7,Ge=Math.floor(1+oe*4);if(ge&&!he){for(let tt=0;tt<Ge;tt++)if(Q.length<50&&Math.random()<ae){let be=1+oe*2;Le(w,V,z,be)}}w.save(),w.globalCompositeOperation="lighter";for(let tt=Q.length-1;tt>=0;tt--){let be=Q[tt];if(be.radius+=be.speed,be.opacity-=.015,be.life-=.015,be.opacity<=0||be.radius>be.maxRadius){Q.splice(tt,1);continue}let Be=w.createRadialGradient(be.x,be.y,0,be.x,be.y,be.radius),Ht=be.opacity;Be.addColorStop(0,`hsla(${be.hue}, 100%, 80%, ${Ht})`),Be.addColorStop(.3,`hsla(${be.hue}, 100%, 40%, ${Ht*.9})`),Be.addColorStop(.7,`hsla(${be.hue}, 100%, 15%, ${Ht*.6})`),Be.addColorStop(1,`hsla(${be.hue}, 100%, 5%, 0)`),w.fillStyle=Be,w.beginPath(),w.arc(be.x,be.y,be.radius,0,Math.PI*2),w.fill()}w.restore()}function Se(){if(!q)return;let w=Date.now(),V=w-U;Math.min(V/t,1)>=1&&!B&&(B=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ge=6e3,ae=5e4,Ge=5e4,tt=5e3,be=4e4,Be=0;V<ge?Be=0:V<ae?Be=(V-ge)/(ae-ge):Be=1;let Ht=0;V>be&&(Ht=Math.max(0,(V-be)/(ae-be))),V>ae&&(Ht=1),Ht>.1&&!i&&(i=ft("sounds/tsu_rumble.ogg",{volume:.8}));let at={skyTop:C(M.skyTop,_.skyTop,Be),skyBottom:C(M.skyBottom,_.skyBottom,Be),sun:C(M.sun,_.sun,Be),waterDeep:C(M.waterDeep,_.waterDeep,Be),waterMid:C(M.waterMid,_.waterMid,Be),waterPeak:C(M.waterPeak,_.waterPeak,Be),foam:C(M.foam,_.foam,Be),sandLight:C(M.sandLight,_.sandLight,Be),sandDark:C(M.sandDark,_.sandDark,Be),rock:C(M.rock,_.rock,Be),leaf:C(M.leaf,_.leaf,Be),shell:C(M.shell,_.shell,Be)},sn=0,Tt=0;if(Be>.5||he){let S=(Be-.5)*2*5+Ht*25;Y>0&&(S+=50),sn=(Math.random()-.5)*S,Tt=(Math.random()-.5)*S}T.clearRect(0,0,m,y),R.save(),R.translate(sn,Tt),T.save(),T.translate(sn,Tt);let yn=R.createLinearGradient(0,0,0,y);if(yn.addColorStop(0,at.skyTop),yn.addColorStop(1,at.skyBottom),R.fillStyle=yn,R.fillRect(-50,-50,m+100,y+100),Be<1){let S=y*.15+Be*50;R.beginPath(),R.arc(m*.7,S,40,0,Math.PI*2),R.fillStyle=at.sun,R.globalAlpha=1-Be,R.shadowColor=at.sun,R.shadowBlur=20,R.fill(),R.globalAlpha=1,R.shadowBlur=0}let go=y*.65;if(g&&Be<1){R.save();let S=Math.min(m,y)*5e-4,k=300*S,P=300*S,A=m*.8,N=P*.15,pe=go-P/2+N;R.translate(A,pe),R.rotate(.1),R.drawImage(p,-k/2,-P/2,k,P),R.restore()}if(ye(R,m,y,go,at),h.forEach(S=>{S.type==="tree"?me(R,S.x,S.y,S.scale,at):S.type==="rock"?Z(R,S.x,S.y,S.scale,at):S.type==="shell"&&re(R,S.x,S.y,S.scale,at)}),Be>.3){let S=(Be-.3)/.7,k=Math.floor(j*S);if(T.strokeStyle=`rgba(120, 180, 255, ${.1+S*.3})`,T.lineWidth=1+S,T.beginPath(),G.length<k)for(let A=0;A<10;A++)G.push({x:Math.random()*m*1.5,y:E,speed:20+Math.random()*20,len:10+Math.random()*20});let P=10+S*20;for(let A=0;A<G.length;A++){let N=G[A];N.y+=N.speed,N.x-=P,T.moveTo(N.x,N.y),T.lineTo(N.x-P*.5,N.y+N.len),(N.y>y||N.x<-100)&&(A<k?(N.x=Math.random()*m*1.5,N.y=E):(G.splice(A,1),A--))}T.stroke()}let rr=.3;if(Be>rr){let S=(Be-rr)/(1-rr),k=le(0,y*1.5,S*S);T.fillStyle=at.waterDeep,T.beginPath(),T.moveTo(-50,y+100),T.lineTo(-50,y-k*.3),T.bezierCurveTo(m*.3,y-k*.4,m*.6,y-k*1.2,m+50,y-k*.8),T.lineTo(m+50,y+100),T.fill()}let Ao=le(0,y*.5,Be),No=le(0,y*1.5,Ht*Ht),ir=y*.85-Ao-No;if(te.forEach((S,k)=>{let P;k===$-1?P=at.waterPeak:k%2===0?P=at.waterDeep:P=at.waterMid,T.fillStyle=P,T.beginPath();let A=S.amplitudeBase*(1+Be*2+Ht*5),N=.003+Be*.005,pe=S.speedBase*(1+Be*5+Ht*10),de=V*pe+S.offset,ke=k*15*(1-Ht),Oe=ir+ke;T.moveTo(-50,y+100),T.lineTo(-50,Oe);for(let Pe=-50;Pe<=m+50;Pe+=15){let Ae=Oe+Math.sin(Pe*N+de)*A+Math.cos(Pe*N*2.3+de)*(A*.5);T.lineTo(Pe,Ae)}if(T.lineTo(m+50,y+100),T.fill(),k===$-1||Be>.6&&k>$-3){T.save(),T.globalAlpha=.1+Be*.3,T.fillStyle=at.foam,T.beginPath();for(let Pe=-50;Pe<=m+50;Pe+=10){let Ae=Oe+Math.sin(Pe*N+de)*A+Math.cos(Pe*N*2.3+de)*(A*.5);Math.random()>.5&&(Ae-=5),Pe===-50?T.moveTo(Pe,Ae):T.lineTo(Pe,Ae)}T.lineTo(m+50,y+100),T.lineTo(-50,y+100),T.fill(),T.restore()}}),V<oe){let S=1;V>1e3&&(S=1-(V-1e3)/(oe-1e3)),T.fillStyle=`rgba(0, 0, 0, ${S})`,T.fillRect(-50,-50,m+100,y+100)}if(V>Ge){let S=Math.min(1,(V-Ge)/tt);T.fillStyle=`rgba(0, 0, 0, ${S})`,T.fillRect(-50,-50,m+100,y+100)}if(X){let S=w-fe,k=12e3,P=0,A=!0;S<k?P=S/k:(P=1,he||(he=!0,Le(T,m,y,25),Y=60,l||(l=!0,ft("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),K&&(A=!1),ie(T,m,y,P,A)}if(K){let S=w-ee,k=Math.min(1,S/ve);T.fillStyle=`rgba(0, 0, 0, ${k})`,T.fillRect(-50,-50,m+100,y+100)}if(Y>0){let S=Y/60,k=S*S;T.fillStyle=`rgba(255, 255, 255, ${k})`,T.fillRect(-50,-50,m+100,y+100),Y--}R.restore(),T.restore(),x=requestAnimationFrame(Se)}function Ne(){q=!1,e.style.cursor="",x&&cancelAnimationFrame(x),window.removeEventListener("resize",F),a.parentNode&&a.parentNode.removeChild(a),f.parentNode&&f.parentNode.removeChild(f),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function _e(){X=!0,fe=Date.now(),he=!1,Y=0,s||(s=ft("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Re(){K=!0,ee=Date.now(),s&&s.stop()}function se(){e.style.cursor=""}function ne(){e.style.cursor="none"}function Ie(){s&&(s.stop(),s=null)}return Se(),{cleanup:Ne,triggerBeacons:_e,triggerFinalFade:Re,showCursor:se,hideCursor:ne,stopHumLoop:Ie}}var ky=$e(()=>{Fn()});var fv={};bt(fv,{canPerformForgeReset:()=>iv,canPerformInfuseReset:()=>sv,computeForgeGoldFromInputs:()=>Yy,computeInfuseMagicFromInputs:()=>Vy,computePendingForgeGold:()=>rv,computeSurgeWavesFromInputs:()=>Wy,getCurrentSurgeLevel:()=>En,getForgeDebugOverrideState:()=>jy,getInfuseDebugOverrideState:()=>Jy,getSurgeBarLevelKey:()=>xs,getSurgeDebugOverrideState:()=>tv,hasDoneExperimentReset:()=>ov,hasDoneForgeReset:()=>_r,hasDoneInfuseReset:()=>$t,hasDoneSurgeReset:()=>Lo,initResetPanel:()=>_d,initResetSystem:()=>Vo,isExperimentUnlocked:()=>tl,isForgeUnlocked:()=>gs,isInfuseUnlocked:()=>au,isSurgeUnlocked:()=>Ls,onForgeUpgradeUnlocked:()=>_p,onInfuseUpgradeUnlocked:()=>Cp,onSurgeUpgradeUnlocked:()=>Mp,performForgeReset:()=>wp,performInfuseReset:()=>Ep,performSurgeReset:()=>xp,recomputePendingMagic:()=>Tn,setExperimentResetCompleted:()=>mp,setForgeDebugOverride:()=>Zy,setForgeResetCompleted:()=>fp,setInfuseDebugOverride:()=>ev,setInfuseResetCompleted:()=>dp,setInfuseUnlockedForDebug:()=>Qy,setSurgeResetCompleted:()=>pp,setSurgeUnlockedForDebug:()=>nv,shouldBlockBigCoins:()=>Qa,updateResetPanel:()=>Fe});function rp(e){return!Tw.includes(e)}function Aw(){ft(_w,{volume:.4})}function Nw(){ft(Cw,{volume:.45})}function Rw(){ft(Mw,{volume:.5})}function Ow(){ft(kw,{volume:.5})}function Qa(){return qy}function Gy(){let e=An(),t=O.waves?.value??ut(),n=0n;try{n=nl(e)}catch{}let o=I.pendingWaves,r=Lp(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),qy=i&&!wn()}function Ja(){Qd=null}function nu(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function ou(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function ep(){let e=I.slot??v();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function Fw(e=null){try{if(e){let t=e instanceof Et?e:Et.fromAny(e??1);return t.isInfinite?.()?Et.fromAny("Infinity"):I.pendingGold.mulBigNumInteger(t)}return O.gold?.mult?.applyTo?.(I.pendingGold)??I.pendingGold}catch{return I.pendingGold}}function Uw(){for(;Wn.length;){let e=Wn.pop();try{e?.()}catch{}}}function Zd(){!Ry&&typeof Pl=="function"&&(Ry=Pl((e={})=>{e?.key&&e.key!==Ce.COINS&&e.key!==Ce.WAVES||e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(e?.key===Ce.WAVES?(lu(),Fe()):(dn(),Tn(),kn()))})),!Oy&&typeof Vl=="function"&&(Oy=Vl((e={})=>{e?.slot!=null&&I.slot!=null&&e.slot!==I.slot||(dn(),kn(),Mo(),Fe())}))}function up(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=qe(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function el(){try{let e=Qe();if(e&&e.xpLevel)return e.xpLevel}catch{}return ut()}function Hy(e,t){if(!e||typeof e!="object")return ut();let n=qe(e);if(!Number.isFinite(n)&&n>0)return Et.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return ut();let r=Te(o*Math.log10(2)),i=Math.max(0,up(t)),s=Math.max(0,(i-30)/5),l=s<=0?Ty():Te(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?Ty():Te(a*Math.log10(1.15)),d=Et.fromInt(10);d=d.mulBigNumInteger(r),d=d.mulBigNumInteger(l),d=d.mulBigNumInteger(u);let f=d.floorToInteger();return f.isZero?.()?ut():f}function Dw(e,t){if(!e)return ut();let n=qe(e);if(!Number.isFinite(n)&&n>0)return Et.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let g=qe(t);Number.isFinite(g)&&(a=Math.max(0,g-4))}let u=o*i,d=Math.floor(o)*s,f=a*l,p=r+u+d+f;return Number.isFinite(p)?Te(p).floorToInteger():Et.fromAny("Infinity")}function Xy(e,t,n=null){let o=Dw(e,t);if(n){let r=n instanceof Et?n:Et.fromAny(n??1);return r.isInfinite?.()?Et.fromAny("Infinity"):o.mulBigNumInteger(r)}return O.magic?.mult?.applyTo?.(o)??o}function Yy(e,t){return Hy(e,t)}function Vy(e,t){return Xy(e,t)}function Wy(e,t,n,o,r){return zy(e,t,n,o,r)}function zy(e,t,n,o,r){let i=up(e);if(i<201)return ut();let s=(i-201)/35,l=qe(t),a=qe(n),u=qe(o),d=qe(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||d===Number.POSITIVE_INFINITY)return Et.fromAny("Infinity");let f=0;Number.isFinite(l)&&l>24&&(f+=(l-24)*Kc),Number.isFinite(a)&&a>13&&(f+=(a-13)*Kc),Number.isFinite(u)&&u>5&&(f+=(u-5)*Kc),Number.isFinite(d)&&d>12&&(f+=(d-12)*Kc);let p=1+f+s;return Number.isFinite(p)?Te(p).floorToInteger():Et.fromAny("Infinity")}function Ky(){return Math.max(0,up(el()))}function An(){if(I.slot!=null)return I.slot;let e=v();return I.slot=e,e}function fp(e){let t=An();if(t!=null){I.hasDoneForgeReset=!!e;try{localStorage.setItem(ip(t),I.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function dp(e){let t=An();if(t!=null){I.hasDoneInfuseReset=!!e;try{localStorage.setItem(sp(t),I.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function pp(e){let t=An();if(t!=null){I.hasDoneSurgeReset=!!e;try{localStorage.setItem(ap(t),I.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function mp(e){let t=An();if(t!=null){I.hasDoneExperimentReset=!!e;try{localStorage.setItem(cp(t),I.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function su(e=v()){if(e==null)return null;try{let t=localStorage.getItem(ja(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function jy(e=v()){return su(e)}function Zy(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(I.forgeDebugOverride!==n){if(I.forgeDebugOverride=n,n==null)try{localStorage.removeItem(ja(t))}catch{}else try{localStorage.setItem(ja(t),n?"1":"0")}catch{}rt(ja(t)),nu(),Fe()}}function hp(e=v()){if(e==null)return null;try{let t=localStorage.getItem(Za(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function Jy(e=v()){return hp(e)}function Qy(e){gp(e)}function ev(e,t=v()){if(t==null)return;let n=e==null?null:!!e;if(I.infuseDebugOverride!==n){if(I.infuseDebugOverride=n,n==null)try{localStorage.removeItem(Za(t))}catch{}else try{localStorage.setItem(Za(t),n?"1":"0")}catch{}rt(Za(t)),ou(),Fe()}}function gp(e){let t=An();if(t==null)return;let n=!!e;if(I.infuseUnlocked!==n){I.infuseUnlocked=n;try{localStorage.setItem(eu(t),I.infuseUnlocked?"1":"0")}catch{}rt(eu(t)),ou()}}function ru(e){let t=An();if(t==null)return;let n=!!e;if(I.forgeUnlocked!==n){I.forgeUnlocked=n;try{localStorage.setItem(Qc(t),I.forgeUnlocked?"1":"0")}catch{}rt(Qc(t)),nu()}}function yp(e=v()){if(e==null)return null;try{let t=localStorage.getItem($y(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function tv(e=v()){return yp(e)}function nv(e){vp(e)}function vp(e){let t=An();if(t==null)return;let n=!!e;if(I.surgeUnlocked!==n){I.surgeUnlocked=n;try{localStorage.setItem(tu(t),I.surgeUnlocked?"1":"0")}catch{}rt(tu(t)),ep()}}function tp(e){if(e==null){I.forgeUnlocked=!1,I.forgeDebugOverride=null,I.hasDoneForgeReset=!1,I.infuseUnlocked=!1,I.infuseDebugOverride=null,I.hasDoneInfuseReset=!1,I.surgeUnlocked=!1,I.surgeDebugOverride=null,I.hasDoneSurgeReset=!1,I.hasDoneExperimentReset=!1,I.flagsPrimed=!1;return}try{I.forgeUnlocked=localStorage.getItem(Qc(e))==="1"}catch{I.forgeUnlocked=!1}I.forgeDebugOverride=su(e);try{I.hasDoneForgeReset=localStorage.getItem(ip(e))==="1"}catch{I.hasDoneForgeReset=!1}try{I.infuseUnlocked=localStorage.getItem(eu(e))==="1"}catch{I.infuseUnlocked=!1}try{I.hasDoneInfuseReset=localStorage.getItem(sp(e))==="1"}catch{I.hasDoneInfuseReset=!1}I.infuseDebugOverride=hp(e);try{I.surgeUnlocked=localStorage.getItem(tu(e))==="1"}catch{I.surgeUnlocked=!1}I.surgeDebugOverride=yp(e);try{I.hasDoneSurgeReset=localStorage.getItem(ap(e))==="1"}catch{I.hasDoneSurgeReset=!1}try{I.hasDoneExperimentReset=localStorage.getItem(cp(e))==="1"}catch{I.hasDoneExperimentReset=!1}I.flagsPrimed=!0}function uo(){let e=v();if(e==null){I.flagsPrimed=!1;return}I.slot!==e&&(I.slot=e,Ja(),I.flagsPrimed=!1),I.flagsPrimed||tp(e)}function Py(e){Ay!==e&&(Uw(),Ay=e,e!=null&&(Wn.push(_t(Qc(e),{onChange(t){let n=t==="1";I.forgeUnlocked!==n&&(I.forgeUnlocked=n,nu(),Fe())}})),Wn.push(_t(ip(e),{onChange(t){let n=t==="1";I.hasDoneForgeReset!==n&&(I.hasDoneForgeReset=n,Fe())}})),Wn.push(_t(ja(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.forgeDebugOverride!==n&&(I.forgeDebugOverride=n,nu(),Fe())}})),Wn.push(_t(eu(e),{onChange(t){let n=t==="1";I.infuseUnlocked!==n&&(I.infuseUnlocked=n,ou(),Fe())}})),Wn.push(_t(sp(e),{onChange(t){let n=t==="1";I.hasDoneInfuseReset!==n&&(I.hasDoneInfuseReset=n,Fe())}})),Wn.push(_t(Za(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.infuseDebugOverride!==n&&(I.infuseDebugOverride=n,ou(),Fe())}})),Wn.push(_t(tu(e),{onChange(t){let n=t==="1";I.surgeUnlocked!==n&&(I.surgeUnlocked=n,ep(),Fe())}})),Wn.push(_t($y(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),I.surgeDebugOverride!==n&&(I.surgeDebugOverride=n,ep(),Fe())}})),Wn.push(_t(ap(e),{onChange(t){let n=t==="1";I.hasDoneSurgeReset!==n&&(I.hasDoneSurgeReset=n,Fe())}})),Wn.push(_t(cp(e),{onChange(t){let n=t==="1";I.hasDoneExperimentReset!==n&&(I.hasDoneExperimentReset=n,Fe())}}))))}function $w(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function dn(e=!1){let t=O.coins?.value??ut(),n=el(),o=$w(t,n);!e&&Qd===o||(Qd=o,bp()?I.pendingGold=Hy(t,n):I.pendingGold=ut(),Fe())}function Tn(e=null){let t=O.coins?.value??ut(),n=ol();Sp()?I.pendingMagic=Xy(t,n,e):I.pendingMagic=ut(),kn(),Fe()}function kn(){if(!Ls()){I.pendingWaves=ut(),Mo();return}let e=el(),t=O.coins?.value??ut(),n=O.gold?.value??ut(),o=O.magic?.value??ut(),r=ol();I.pendingWaves=zy(e,t,n,o,r),Lo()||I.pendingWaves.cmp(Et.fromInt(10))>0&&(I.pendingWaves=Et.fromInt(10)),Mo(),Gy()}function Mo(){if(!tl()){I.pendingDna=ut();return}let e=qt?qt():ut(),t=el();try{let n=e.mulDecimal("0.30103",18),r=t.div(c.fromInt(20)).mulDecimal("0.30103",18),i=n.add(r),s=0;i.isInfinite()?s=1/0:s=Number(i.toScientific(10)),I.pendingDna=Te(s).floorToInteger()}catch{try{I.pendingDna=ut()}catch{I.pendingDna=ut()}}}function np(){let e=su();return e!=null?!!e:I.forgeUnlocked||Mt(xe.STARTER_COVE,we.UNLOCK_FORGE)>=1}function bp(){try{let e=el();if(e&&typeof e.cmp=="function")return e.cmp(Pw)>=0}catch{}return!1}function Sp(){try{let e=ct();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(Bw)>=0}catch{}return!1}function gs(){uo();let e=su();return e!=null?!!e:!!I.forgeUnlocked||np()}function au(){uo();let e=hp();return e!=null?!!e:!!I.infuseUnlocked}function Ls(){uo();let e=yp();return e!=null?!!e:!!I.surgeUnlocked}function tl(){return ig()}function En(){let e=An();return e==null?0n:nl(e)}function _r(){return uo(),!!I.hasDoneForgeReset}function $t(){return uo(),!!I.hasDoneInfuseReset}function Lo(){return uo(),!!I.hasDoneSurgeReset}function ov(){return uo(),!!I.hasDoneExperimentReset}function rv(){return dn(),I.pendingGold.clone?.()??I.pendingGold}function iv(){return!(!gs()||!bp()||I.pendingGold.isZero?.())}function sv(){return!(!au()||!Sp()||I.pendingMagic.isZero?.())}function qw({resetGold:e=!1,resetMagic:t=!1}={}){let n=Ut(xe.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===we.UNLOCK_XP||r===we.UNLOCK_FORGE||r===we.UNLOCK_INFUSE||r===we.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||Ko(xe.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Ip({resetGold:e=!1,resetMagic:t=!1}={}){try{O.coins.set(0)}catch{}try{O.books.set(0)}catch{}try{qi({keepUnlock:!0})}catch{}try{zd()}catch{}qw({resetGold:e,resetMagic:t})}function wp(){if(!iv())return!1;let e=I.pendingGold.clone?.()??I.pendingGold;try{let t=O.gold?.mult?.applyTo?.(e)??e;O.gold?.add&&O.gold.add(t)}catch{}if(Ip({resetGold:!1}),dn(),ru(!0),I.hasDoneForgeReset||fp(!0),Wt(),Tr(),rp("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return Fe(),!0}function Ep(){if(!sv())return!1;let e=I.pendingMagic.clone?.()??I.pendingMagic;try{O.magic?.add&&O.magic.add(e)}catch{}Ip({resetGold:!0});try{O.gold.set(0)}catch{}try{let t=v(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),Wt({forceReload:!0})}catch{}if(dn(),Tn(),rp("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return gp(!0),I.hasDoneInfuseReset||dp(!0),Fe(),!0}function iu(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=An();try{O.waves?.add&&e&&!e.isZero?.()&&O.waves.add(e)}catch{}Ip({resetGold:!0,resetMagic:!0});try{O.gold.set(0)}catch{}try{O.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),Wt({forceReload:!0})}catch{}if(lu(),vp(!0),I.hasDoneSurgeReset||pp(!0),dn(),Tn(),kn(),t&&(n||Rw(),n||Xw()),rp("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}Fe()}function av(){if(!tl()||(qt?qt():ut()).cmp(10)<0)return!1;let t=I.pendingDna.clone?.()??I.pendingDna;if(t.cmp(Jd)<0)return!1;try{O.DNA?.add&&O.DNA.add(t)}catch{}return iu(ut(),{playEffects:!1}),Ow(),sg([4]),I.hasDoneExperimentReset||mp(!0),dn(),Tn(),kn(),Mo(),Fe(),!0}function Gw(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{ay(!0)}catch{}try{xc()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,vr(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=My(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Vg(e,()=>{setTimeout(Hw,0)},i)},r);Jc=i.cleanup}function Hw(){Jc&&(Jc(),Jc=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),iu(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=v();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function xp(){if(!Ls()||Ky()<201)return!1;let e=I.pendingWaves.clone?.()??I.pendingWaves;if(e.isZero?.())return!1;let t=An(),n=O.waves?.value??ut(),o=nl(t),r=Lp(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!wn()?(Gw(),iu(e,{playEffects:!1}),!0):(iu(e,{playEffects:!0}),!0)}function Xw(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function nl(e){let t=0n;try{let n=localStorage.getItem(lp(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function Yw(e){let t=lp(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function By(e){if(!(e instanceof Et)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function lv(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=By(n),l=By(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let d=new c(10n,{base:0,offset:u}),f=d.sub(r).div(c.fromInt(9));n.cmp(f)>=0&&(n=n.sub(f),o=u,i=!0,r=d)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function lu(){let e=An();if(e==null||!Ls()||jd||Yw(e))return;let t=O.waves?.value??ut(),n=nl(e);if(n===1/0)return;let o=lv(n,t);if(o.changed){n=o.level;try{localStorage.setItem(lp(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}jd=!0;try{O.waves.set(o.remainingWaves)}finally{jd=!1}Fe(),o.safety>=100&&setTimeout(lu,0)}Gy()}function Es(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Et.fromInt(e)}catch{}try{return J(t)}catch{return e?.toString?.()??"0"}}function Vw(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${ww}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${Ew}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${xw}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${Lw}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Fy}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Uy}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Zc}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Dy}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,I.panel=e,I.elements.forge.card=e.querySelector("#reset-card-forge"),I.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),I.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),I.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),I.elements.infuse.card=e.querySelector("#reset-card-infuse"),I.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),I.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),I.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),I.elements.surge.card=e.querySelector("#reset-card-surge"),I.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),I.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),I.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),I.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),I.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),I.elements.surge.headerVal=e.querySelector("[data-surge-level]"),I.elements.surge.header=e.querySelector(".surge-header"),I.elements.experiment.card=e.querySelector("#reset-card-experiment"),I.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),I.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");I.elements.surge.milestones&&t&&ls(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),I.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(I.layerButtons).forEach(([n,o])=>{if(!o)return;let r=null,i=s=>{if(s&&s.isTrusted&&to(o))return;let l=I.elements[n]?.card;if(l){let a=l.closest(".merchant-content");n==="forge"&&a?a.scrollTo({top:0,behavior:"smooth"}):l.scrollIntoView({behavior:"smooth",block:"start"})}};o.addEventListener("click",s=>{if(r&&r!=="mouse"){r=null;return}r=null,i(s)})}),I.elements.forge.btn&&I.elements.forge.btn.addEventListener("click",()=>{wp()&&(Aw(),Fe())}),I.elements.infuse.btn&&I.elements.infuse.btn.addEventListener("click",()=>{Ep()&&(Nw(),Fe())}),I.elements.surge.btn&&I.elements.surge.btn.addEventListener("click",()=>{xp()&&Fe()}),I.elements.experiment.btn&&I.elements.experiment.btn.addEventListener("click",()=>{av()&&Fe()}),Fe()}function _d(e){!e||e.__resetInit||(e.__resetInit=!0,Vw(e))}function co(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=Es(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let d=e.querySelector(".merchant-reset__action-icon img");d&&!d.src.includes(n)&&(d.src=n)}}function cv({goldMult:e=null}={}){let t=I.elements.forge;if(!(!t.card||!t.btn)){if(!gs()){co(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(uo(),t.card.classList.toggle("is-forge-complete",!!I.hasDoneForgeReset),t.status)if(I.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!bp()){co(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}co(t.btn,{disabled:!1},Fy,Fw(e))}}function uv(){let e=I.elements.infuse;if(!(!e.card||!e.btn)){if(!au()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="none"&&(I.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.infuse&&I.layerButtons.infuse.style.display!=="flex"&&(I.layerButtons.infuse.style.display="flex"),uo(),e.card.classList.toggle("is-complete",!!I.hasDoneInfuseReset),e.status)if(I.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!Sp()){co(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}co(e.btn,{disabled:!1},Uy,I.pendingMagic)}}function Lp(e,t,n){let o=t.add(n);return lv(e,o).level}function op(){let e=I.elements.surge;if(!e.card||!e.btn)return;if(!Ls()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="none"&&(I.layerButtons.surge.style.display="none");return}e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.surge&&I.layerButtons.surge.style.display!=="flex"&&(I.layerButtons.surge.style.display="flex"),uo();let t=An(),n=O.waves?.value??ut(),o=0n;try{o=nl(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':Es(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=I.pendingWaves;if(u&&!u.isZero?.()){let d=Lp(o,n,u),f=!1;if(d===1/0)f=!0;else try{f=d>o}catch{}if(f){let p=d===1/0?'<span class="surge-infinity-symbol">\u221E</span>':Es(d);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${p}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${Zc}">${Es(n)} / <img src="${Zc}">${Es(r)}</span>`),e.milestones){let s=_y(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let d=BigInt(a.surgeLevel)<=o,f=d?"is-reached":"",p=a.description.map(F=>F.includes("Invokes the Tsunami")&&!d?`<div class="tsunami-text">- ${F}</div>`:`<div>- ${F}</div>`).join("");if(d&&a.surgeLevel===3){let F=br?br():Et.fromInt(0);p+=`<div style="color:#02e815">- Current Books/sec: ${J(F)}</div>`}if(d&&a.surgeLevel===6){let F=cc();p=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${lt(F.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${lt(F.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${lt(F.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${lt(F.magic)}x</span></div>`}let g=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(g=!0);let m=Ft(),y=In(),h=m+y;h>1&&(h=1);let b=!1;d&&g&&h<1&&Kd.includes(a.id)&&(b=!0);let E=b?" is-nerfed":"",L=l[u];if(!L)L=document.createElement("div"),L.className=`surge-milestone-item ${f}${E}`,L.dataset.isReached=String(d),L.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(L);else{L.className!==`surge-milestone-item ${f}${E}`&&(L.className=`surge-milestone-item ${f}${E}`);let F=String(d);L.dataset.isReached!==F&&(L.dataset.isReached=F)}let R=L.querySelector(".surge-milestone-desc");R&&R.innerHTML!==p&&(R.innerHTML=p);let T=L.querySelector(".surge-milestone-nerf-arrow");if(T){let F=!1;g&&h<1&&Kd.includes(a.id)&&(F=!0);let U=F?"":"none";T.style.display!==U&&(T.style.display=U)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();I.lastRenderedSurgeLevel!==o&&(I.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],d=e.milestones.children;u===d[d.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!I.hasDoneSurgeReset),e.status)if(I.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(Ky()<201){co(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(I.pendingWaves.isZero?.()){co(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}co(e.btn,{disabled:!1},Zc,I.pendingWaves)}function Ww(){let e=I.elements.experiment;if(!e.card||!e.btn)return;if(!tl()){e.card.style.display!=="none"&&(e.card.style.display="none"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="none"&&(I.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),I.layerButtons.experiment&&I.layerButtons.experiment.style.display!=="flex"&&(I.layerButtons.experiment.style.display="flex"),uo(),e.card.classList.toggle("is-complete",!!I.hasDoneExperimentReset),e.status)if(I.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let o='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==o&&(e.status.innerHTML=o)}if((qt?qt():ut()).cmp(10)<0){co(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}if(I.pendingDna.cmp(Jd)<0){co(e.btn,{disabled:!0,msg:`Reach ${Es(Jd)} pending DNA to perform an Experiment reset`});return}co(e.btn,{disabled:!1},Dy,I.pendingDna)}function Fe({goldMult:e=null}={}){I.panel&&(cv({goldMult:e}),uv(),op(),Ww())}function _p(){Vo(),ru(!0),Fe()}function Cp(){Vo(),gp(!0),Fe()}function Mp(){Vo(),vp(!0),Fe()}function zw(){if(!I.panel)return;let e=I.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!I.panel.classList.contains("is-active")||!I.elements.surge.barFill)return;let t=I.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",op(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",op()},{once:!0}))}function Kw(){typeof window>"u"||(window.addEventListener("surge:level:change",()=>{zw()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(dn(),Tn(),kn()),e.detail?.key==="waves"&&(lu(),Fe()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(kn(),Fe())}),window.addEventListener("surge:bookResidue",()=>{if(I.panel&&I.panel.offsetParent!==null){let e=I.elements.surge.card;e&&e.style.display!=="none"&&Fe()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Ce.GOLD){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;dn(!0);let n=t.mult instanceof c?t.mult:Et.fromAny(t.mult??1);I.panel&&cv({goldMult:n});return}if(t.key===Ce.MAGIC){if(t.slot!=null&&I.slot!=null&&t.slot!==I.slot)return;let n=t.mult instanceof c?t.mult:Et.fromAny(t.mult??1);Tn(n),I.panel&&uv();return}}}),window.addEventListener("xp:change",()=>{dn(),kn(),Mo(),Fe()}),window.addEventListener("mutation:change",()=>{Tn(),kn(),Fe()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&I.slot!=null&&e.detail.slot!==I.slot||(Ja(),dn(!0),Tn(),kn(),Mo(),Fe())}),window.addEventListener("lab:level:change",()=>{Mo(),Fe()}),window.addEventListener("lab:node:change",()=>{Fe()}))}function Vo(){if(Ny){I.slot=v(),Ja(),Zd(),dn(!0),Tn(),kn(),Mo();return}try{Wt()}catch{return}Ny=!0;let e=v();if(I.slot=e,Ja(),tp(e),I.hasDoneForgeReset&&!Co())try{Tr()}catch{}if(!I.forgeUnlocked&&np()&&ru(!0),Py(e),Zd(),Kw(),dn(!0),Tn(),kn(),Mo(),jc){try{jc()}catch{}jc=null}jc=mi(()=>{let t=kp();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=v();if(I.slot=t,Ja(),tp(t),I.hasDoneForgeReset&&!Co())try{Tr()}catch{}!I.forgeUnlocked&&np()&&ru(!0),Py(t),Zd(),dn(!0),Tn(),kn(),Mo(),Fe()})}var Et,Kc,ut,Ty,Fy,Uy,Dy,ww,Ew,xw,Lw,Zc,_w,Cw,Mw,kw,Tw,Jd,Qc,ip,ja,eu,sp,Za,tu,$y,ap,xs,lp,cp,Pw,Bw,jd,qy,I,Wn,Ay,Ny,jc,Qd,Ry,Oy,Jc,wo=$e(()=>{Ct();St();Kt();Hn();fn();xo();Yi();Pa();Cy();ti();Fn();so();ni();ri();_c();ky();Et=c,Kc=Math.log10(1.1),ut=()=>Et.fromInt(0),Ty=()=>Et.fromInt(1),Fy="img/currencies/gold/gold.webp",Uy="img/currencies/magic/magic.webp",Dy="img/currencies/dna/dna.webp",ww="img/misc/forge.webp",Ew="img/misc/infuse.webp",xw="img/misc/surge.webp",Lw="img/misc/experiment.webp",Zc="img/currencies/wave/wave.webp",_w="sounds/forge_reset.ogg",Cw="sounds/infuse_reset.ogg",Mw="sounds/surge_reset.ogg",kw="sounds/experiment_reset.ogg",Tw=[],Jd=Et.fromAny("99999999999999");Qc=e=>`ccc:reset:forge:${e}`,ip=e=>`ccc:reset:forge:completed:${e}`,ja=e=>`ccc:debug:forgeUnlocked:${e}`,eu=e=>`ccc:reset:infuse:${e}`,sp=e=>`ccc:reset:infuse:completed:${e}`,Za=e=>`ccc:debug:infuseUnlocked:${e}`,tu=e=>`ccc:reset:surge:${e}`,$y=e=>`ccc:debug:surgeUnlocked:${e}`,ap=e=>`ccc:reset:surge:completed:${e}`,xs=e=>`ccc:reset:surge:barLevel:${e}`,lp=xs,cp=e=>`ccc:reset:experiment:completed:${e}`,Pw=Et.fromInt(31),Bw=Et.fromInt(7),jd=!1,qy=!1;I={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:ut(),pendingMagic:ut(),pendingWaves:ut(),pendingDna:ut(),panel:null,elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},Wn=[],Ay=null,Ny=!1,jc=null,Qd=null,Ry=null,Oy=null;Jc=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:Vo,performForgeReset:wp,performInfuseReset:Ep,performSurgeReset:xp,performExperimentReset:av,computePendingForgeGold:rv,computeForgeGoldFromInputs:Yy,computeInfuseMagicFromInputs:Vy,computeSurgeWavesFromInputs:Wy,getForgeDebugOverrideState:jy,hasDoneForgeReset:_r,isForgeUnlocked:gs,setForgeDebugOverride:Zy,setForgeResetCompleted:fp,updateResetPanel:Fe,isInfuseUnlocked:au,setInfuseDebugOverride:ev,getInfuseDebugOverrideState:Jy,recomputePendingMagic:Tn,setInfuseUnlockedForDebug:Qy,setInfuseResetCompleted:dp,hasDoneInfuseReset:$t,isSurgeUnlocked:Ls,setSurgeUnlockedForDebug:nv,getSurgeDebugOverrideState:tv,setSurgeResetCompleted:pp,hasDoneSurgeReset:Lo,getCurrentSurgeLevel:En,shouldBlockBigCoins:Qa,hasDoneExperimentReset:ov,setExperimentResetCompleted:mp,isExperimentUnlocked:tl}))});function Tp(){rl=null}function dv(){rl=null;try{cu.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{Zt()}catch{}}function pv(e){return typeof e=="function"&&cu.push(e),()=>{cu=cu.filter(t=>t!==e)}}function Zw(e){let t=dt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return Te(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function Jw(){try{return!!un()}catch{return!1}}function il(e){let t=O?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(Jw())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=Mt(xe.STARTER_COVE,we.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=Zw(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function _s(e=xe.STARTER_COVE){if(rl)return rl;let t=Ut(e),n={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let o of t){if(!o.effectType)continue;let r=Cn(e,o.id),i=Ue(r),s=null;if(typeof o.effectMultiplier=="function"?(s=o.effectMultiplier(i),!(s instanceof c)&&typeof s!="number"&&(s=c.fromAny(s??1))):s=c.fromInt(1),o.upgType==="HM"){let{selfMult:l,xpMult:a,coinMult:u,mpMult:d}=Ar(o,r,e);n.xpValue=Lt(n.xpValue,a),n.coinValue=Lt(n.coinValue,u),n.mpValue=Lt(n.mpValue,d),s=Lt(s,l)}if(o.effectType==="coin_spawn"){let l=1;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=1}else l=Number(s);n.coinSpawn*=l}else if(o.effectType==="coin_value")n.coinValue=Lt(n.coinValue,s);else if(o.effectType==="xp_value")n.xpValue=Lt(n.xpValue,s);else if(o.effectType==="mp_value")n.mpValue=Lt(n.mpValue,s);else if(o.effectType==="book_value")n.bookValue=Lt(n.bookValue,s);else if(o.effectType==="magnet_radius"){let l=0;if(s instanceof c)try{l=Number(s.toScientific())}catch{l=0}else l=Number(s);Number.isFinite(l)&&(n.magnetRadius+=l)}}return rl=n,n}function cs(e){let t=_s(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:jw*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue}}function Wc(){try{let{mpValue:e}=_s(xe.STARTER_COVE);return e}catch{return c.fromInt(1)}}function zc(){try{let{magnetRadius:e}=_s(xe.STARTER_COVE);return e||0}catch{return 0}}function mv(){try{Vo()}catch{}try{Po(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=_s(xe.STARTER_COVE);return Lt(n,o)})}catch{}try{dr(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=_s(xe.STARTER_COVE);return Lt(n,o)})}catch{}try{ii(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=_s(xe.STARTER_COVE);return Lt(n,o)})}catch{}il(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{try{il()}catch{}try{Zt()}catch{}})}var jw,rl,cu,hv=$e(()=>{Ct();St();wo();Hn();xo();fn();jw=1,rl=null,cu=[]});var $v={};bt($v,{AREA_KEYS:()=>xe,HM_EVOLUTION_INTERVAL:()=>Gt,MAX_LEVEL_DELTA:()=>Os,REGISTRY:()=>_u,UPGRADE_TIES:()=>we,approxLog10BigNum:()=>qe,batchUpgradeOperations:()=>al,bigNumFromLog10:()=>Te,buyCheap:()=>Rd,buyMax:()=>Fc,buyOne:()=>Ga,buyTowards:()=>Ha,clearPermanentUpgradeUnlock:()=>Kp,computeDefaultUpgradeCost:()=>jp,computeHmMultipliers:()=>Ar,computeUpgradeEffects:()=>cs,costToBuyOne:()=>xE,ensureLevelBigNum:()=>dt,estimateFlatBulk:()=>Gp,estimateGeometricBulk:()=>vE,evaluateBulkPurchase:()=>ci,evolveUpgrade:()=>Nd,formatMultForUi:()=>lt,getCurrentAreaKey:()=>Yn,getHmEvolutions:()=>Yp,getHmNextMilestoneLevel:()=>LE,getIconUrl:()=>Uc,getLevel:()=>Cn,getLevelNumber:()=>Mt,getMagnetLevel:()=>zc,getMpValueMultiplierBn:()=>Wc,getUpgrade:()=>Us,getUpgradeLockState:()=>Wo,getUpgradeStorageKey:()=>gi,getUpgradesForArea:()=>Ut,levelBigNumToNumber:()=>Ue,markUpgradePermanentlyUnlocked:()=>hi,normalizeBigNum:()=>_E,normalizedUpgradeLevel:()=>yu,onUpgradesChanged:()=>pv,peekNextPrice:()=>Dv,performFreeAutobuy:()=>Td,safeMultiplyBigNum:()=>Lt,setLevel:()=>Ko,syncBookCurrencyMultiplierFromUpgrade:()=>il,upgradeUiModel:()=>Xa});function uu(){Nr.size!==0&&(Nr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{rt(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Nr.clear())}function eE(){if(!(typeof window>"u")&&!yv){yv=setInterval(uu,2e3);try{window.addEventListener("beforeunload",uu)}catch{}try{window.addEventListener("pagehide",uu)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&uu()})}catch{}}}function al(e){if(ks)return e();ks=!0;try{return e()}finally{ks=!1,sl.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{As(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),sl.clear(),gv.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{wE(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),gv.clear(),Bp&&(Bp=!1,fo())}}function tE(e){try{let t=Fs(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function Sv(e,t){if(!tE(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=qe(n);return Number.isFinite(o)&&o>=nE}catch{return!1}}function Ts(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>Ap)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>Ap/2||i.length>Ap/2)return"Infinity"}return n}function qe(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let p=Number(e.sig);if(p>0){let g=Math.log10(p),m=e.e||0,y=Number(e._eOffset||0n);return g+m+y}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let d;if(u.length<=15){let p=Number(u);if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)}else{let p=Number(u.slice(0,15));if(!Number.isFinite(p)||p<=0)return Number.NEGATIVE_INFINITY;d=Math.log10(p)+(u.length-15)}let f=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return d+f}function Te(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function du(e){return lE[e]??0}function Np(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function Ps(e,t){let n=Jo(e||t?.area);if(!n)return null;let o=Qo(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=jn(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function ll(e,t){let n=Jo(e||t?.area);if(!n)return null;let o=jn(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function Cs(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function Dp(e=v()){let t=String(e??"default");if(mu.has(t))return mu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Ev}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),mu.set(t,n),n}function $p(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),mu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Ev}:${n}`,JSON.stringify(e))}catch{}}function Eu(e=v()){let t=String(e??"default");if(hu.has(t))return hu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${xv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),hu.set(t,n),n}function xu(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),hu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${xv}:${n}`,JSON.stringify(e))}catch{}}function Wp(e=v()){let t=String(e??"default");if(gu.has(t))return gu.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${Lv}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),gu.set(t,n),n}function zp(e,t=v()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),gu.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${Lv}:${n}`,JSON.stringify(e))}catch{}}function qp(e,t,n=v()){let o=Ps(e,t);if(!o)return;let r=ll(e,t),i=Wp(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],zp(i,n))}function _v(e,t,n=v()){let o=Ps(e,t);if(!o)return!1;let r=ll(e,t),i=Wp(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],zp(i,n),!0):!1}function hi(e,t,n=v()){let o=Ps(e,t);if(!o)return;let r=ll(e,t),i=Eu(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],xu(i,n))}function Kp(e,t,n=v()){let o=Ps(e,t);if(!o)return;let r=Eu(n);r.upgrades[o]&&(delete r.upgrades[o],xu(r,n));let i=Dp(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},$p(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&er(e,s,n),fo()}function Su(e,t,n=v()){let o=Ps(e,t);if(!o)return!1;let r=ll(e,t),i=Eu(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],xu(i,n),!0):!1}function pn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=Qo(t?.tie??t?.tieKey),o=e?.areaKey||xe.STARTER_COVE;if(!n||!rE.has(n))return{locked:!0,iconOverride:Nn,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?Mt(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:Cv()}catch{}function s(){if(Mv())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:mn,titleOverride:tn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===we.UNLOCK_XP)return s();if(n===we.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:Nn,useLockedBase:!0};let a=!1;try{let u=hn();a=Ue(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:mn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:tn,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_INFUSE){if(!_r())return{locked:!0,iconOverride:Nn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Kn,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=hn();a=Ue(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:mn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:tn,descOverride:u,reason:u}}return{locked:!1}}if(n===we.UNLOCK_SURGE){if(!$t())return{locked:!0,iconOverride:Nn,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:Kn,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=hn();a=Ue(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:mn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:tn,descOverride:u,reason:u}}return{locked:!1}}if(Vp.has(n)){if($t()||Su(o,t)){try{hi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let d=hn();a=Ue(d)>=101}catch{}if(!a)return{locked:!0,iconOverride:Nn,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{qp(o,t)}catch{}return{locked:!0,iconOverride:mn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:tn,descOverride:u,reason:u}}if(_r()||Su(o,t)){try{hi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:Nn,useLockedBase:!0};if(_v(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:mn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:tn,descOverride:a,reason:a}}let l=!1;try{let a=hn();l=Ue(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:Nn,useLockedBase:!0,titleOverride:Kn,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{qp(o,t)}catch{}return{locked:!0,iconOverride:mn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function Jo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function Qo(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function cE(e,t){let n=Qo(t?.tie??t?.tieKey);if(n&&iE.has(n))return!0;let o=jn(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=Jo(l);if(a&&sE.has(`${a}:${i}`))return!0}return!1}function Cv(){try{return!!un()}catch{return!1}}function Mv(e=v()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${aE}:${t}`)==="1"}catch{return!1}}function hn(){try{let e=typeof Qe=="function"?Qe():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function yu(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function Rp(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function jn(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function dt(e){try{if(e=Ts(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return Te(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=qe(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Ue(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=qe(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let f=Number(r);return Number.isFinite(f)?f:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let f=Math.floor(Math.log10(a));Number.isFinite(f)&&f>0&&(a/=Math.pow(10,f),u+=f)}else if(a<1){let f=Math.ceil(Math.log10(1/a));Number.isFinite(f)&&f>0&&(a*=Math.pow(10,f),u-=f)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let d=a*Math.pow(10,u);return Number.isFinite(d)?d:u>0?Number.MAX_VALUE:0}catch{let o=qe(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function uE(e,t){let n=dt(e),o=dt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(qe(n))+1,i=Math.floor(qe(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function kv(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function Bs(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function Iu(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:Bs(e.numUpgEvolutions)}function jp(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Ue(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let d=Math.max(0,Math.floor(r/Gt));Number.isFinite(d)&&(i.numUpgEvolutions=d)}let s=Rv(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:qe(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:kv(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,zn(i,r)}function Tv(e){let t=Bs(e),n=Gt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Rr(o),capFmtText:Ns(o)}}function Av(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(qe(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Ue(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Gt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Gt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Ue(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Gt)+1)}}function dE(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function Zp(e,t=bu){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=Jo(t||e?.area||bu);return oE[n]||Iv}function Lt(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function Lu(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=Tv(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Ar(e,t,n=bu){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=Zp(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let d=Av(t,Number(u?.level??u?.lvl??0));if(!(d>0))continue;let f=dE(u.multiplier??u.mult??u.value??1,d),p=`${u.target??u.type??"self"}`.toLowerCase();p==="xp"?i=Lt(i,f):p==="coin"||p==="coins"?s=Lt(s,f):p==="mp"?l=Lt(l,f):r=Lt(r,f)}let a=Iu(e);if(a>0){let u=Qw*a,d=Te(u);r=Lt(r,d)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function Nv(e,t,n=bu){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=Zp(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=Av(t,s),a=null;try{let u=BigInt(s),d=BigInt(Math.max(0,l)),f=u+BigInt(Gt)*d;f>0n&&(a=c.fromAny(f.toString()))}catch{}if(!a){let u=c.fromAny(Gt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Gt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Gt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function Rv(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=fE[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function Fs(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let f=Number(i);Number.isFinite(f)&&f>0&&(r=f)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let f=Math.pow(10,s);Number.isFinite(f)&&f>0&&(r=f)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let f=Math.exp(l);Number.isFinite(f)&&f>0&&(r=f)}if(!r){let f=Number(o.ratioMinus1);Number.isFinite(f)&&f>0&&(r=f+1)}let a=null;if(!r){let f=Rv(e);f&&(r=f.ratio,f.ratioLog10!=null&&(s=f.ratioLog10),a=f.preset)}if(r>1){r=Number(r),i=kv(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=qe(n),d=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=d;try{let f=c.fromAny(e.costAtLevel?.(0)??0),p=c.fromAny(e.costAtLevel?.(1)??0),g=c.fromAny(e.costAtLevel?.(32)??0);f.cmp(p)===0&&f.cmp(g)===0&&(d.ratio=1,d.ratioMinus1=0,d.ratioLog10=0,d.ratioLn=0,d.ratioStr="1")}catch{}return d}catch{return null}}function zn(e,t){let n=Fs(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=Te(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return Te(n.baseLog10+o*n.ratioLog10).floorToInteger()}function pE(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function jo(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=Fs(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Ms+t*o.ratioLn)/Ms;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Ms+t*o.ratioLn,i=o.ratioLn*n,s=pE(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Ms}function vu(e,t,n){if(!(n>0))return c.fromInt(0);let o=Fs(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=jo(e,t,l);a=a.add(Te(u))}if(s>0){let u=t+l,d=c.fromAny(e.costAtLevel(u));for(let f=0;f<s;f+=1)a=a.add(d),f+1<s&&(d=d.mulDecimalFloor(o.ratioStr))}return a}let i=jo(e,t,n);return Te(i)}function mE(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/Ms;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/Ms:e>0?e:0}function Pv(e){if(!(e>0)||!Number.isFinite(e))return e;if(Pp[0]=e,Pp[0]<=0)return 0;hE[0]-=1n;let t=Pp[0];return t>0?t:0}function gE(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=Pv(e);return n<e?n:e>1?e/2:0}function pu(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function cl(e,t,n,o=Os,r={}){let i=Fs(e),s=c.fromInt(0),a=!!(r||{}).fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Ue(t))),d=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,f=typeof o=="number"?o:Ue(o),p=Number.isFinite(d)?Math.max(0,d-u):Op,g=Number.isFinite(f)?Math.max(0,Math.floor(f)):Op;if(g=Math.min(g,Op,p),!(g>0)){let te=p<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:te,numericCount:0}}let m=100-u;if(Number.isFinite(u)&&m>0){let te=Math.min(g,m),$=c.fromAny(e.costAtLevel(u)),G=s,j=0;for(;j<te;){$=c.fromAny(e.costAtLevel(u+j));let ye=G.add($);if(ye.cmp(n)>0)break;G=ye,j+=1}let le=u+j,ue=Number.isFinite(d)&&le>=d,C=pu(j);if(j<te||ue||g<=j){let ye=ue?s:c.fromAny(e.costAtLevel(le));return{count:C,spent:G,nextPrice:ye,numericCount:j}}let W=(()=>{try{return Zo(t??u,u).add(C)}catch{return u+j}})(),ce=cl(e,W,n.sub(G),g-j,r),me=ce?.count instanceof c?ce.count:pu(ce?.numericCount??0),Z=C.add(me),re=(ce?.spent??s).add(G);return{count:Z,spent:re,nextPrice:ce?.nextPrice??s,numericCount:j+(ce?.numericCount??0)}}let y=qe(n),h=i.ratioLog10,b=i.ratioMinus1,E=c.fromAny(e.costAtLevel(u)),L=i.baseLog10+u*h;if(b>0&&(!Number.isFinite(y)||Math.abs(y)>1e6&&Math.abs(L)>1e6)){let te=c.fromAny(e.costAtLevel(u));if(n.cmp(te)<0)return{count:s,spent:s,nextPrice:te,numericCount:0};let $=Number.isFinite(g)?Math.max(1,Math.floor(g)):Number.MAX_VALUE,G=1,j=1;for(;j<$;){let me=jo(e,u,j);if(Te(me).cmp(n)<=0){let re=j*2;if(!Number.isFinite(re)||re<=j){j=$;break}G=j,j=Math.min(re,$)}else break}let le=0;for(;G<j&&le<256;){let me=Math.max(G+1,Math.floor((G+j+1)/2)),Z=jo(e,u,me);Te(Z).cmp(n)<=0?G=me:j=me-1,le++}let ue=Math.max(1,G),C=pu(ue),W=s,ce=s;if(!a)if(W=vu(e,u,ue),Number.isFinite(d)){let me=Math.max(0,Math.floor(d-Math.min(u,d)));ue>=me?ce=s:ce=Te(L+ue*h)}else ce=Te(L+ue*h);return{count:C,spent:W,nextPrice:ce,numericCount:ue}}if(n.cmp(E)<0)return{count:s,spent:s,nextPrice:E,numericCount:0};let T=!1,F=null,U=null;try{F=c.fromAny(e.costAtLevel(u+1))}catch{}try{let te=Math.min(Number.isFinite(d)?Math.max(u+1,Math.floor(d)):u+32,u+32);U=c.fromAny(e.costAtLevel(te))}catch{}!T&&!(i.ratioMinus1>0)&&(T=!0),F&&U&&(T=F.cmp(E)===0&&U.cmp(E)===0),!T&&!(i.ratioMinus1>0)&&(T=!0);let q=Number.isFinite(g)?Math.max(0,Math.floor(g)):Number.MAX_VALUE;if(T){let te=Zo(e.lvlCapBn??"Infinity","Infinity"),$=Zo(t??0,0),G=te.isInfinite?.()?c.fromAny("Infinity"):te.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=Gp(E,n,G);return{count:le,spent:ue,nextPrice:C,numericCount:j}}if(!(h>0)||!(b>0)){let te=Zo(e.lvlCapBn??"Infinity","Infinity"),$=Zo(t??0,0),G=te.isInfinite?.()?c.fromAny("Infinity"):te.sub($).floorToInteger(),{count:j,countBn:le,spent:ue,nextPrice:C}=Gp(E,n,G);return{count:le,spent:ue,nextPrice:C,numericCount:j}}let x=Math.log10(b);if(!Number.isFinite(x))return{count:s,spent:s,nextPrice:E,numericCount:0};let M=mE(y+x-L)/h;(!Number.isFinite(M)||M<0)&&(M=0);let _=Math.floor(Math.min(q,M));Number.isFinite(_)||(_=q),_<=0&&(_=1);let X=1e-7,Q=jo(e,u,_),fe=0,K=2048;for(;_>0&&(!Number.isFinite(Q)||Q>y+X)&&fe<K;){let te=Number.isFinite(Q)?Math.max(1,Math.ceil((Q-y)/Math.max(h,1e-12))):Math.max(1,Math.floor(_/2)),$=Math.max(0,Math.floor(_-te));if($<_)_=$;else{let G=Pv(_);if(!(G<_))break;_=G}Q=_>0?jo(e,u,_):Number.NEGATIVE_INFINITY,fe+=1}if(_<=0||!Number.isFinite(_))if(n.cmp(E)>=0)_=1,Q=qe(E);else return{count:s,spent:s,nextPrice:E,numericCount:0};if(_<q){let te=C=>{let W=C*2;return Number.isFinite(W)?W:Number.MAX_VALUE},$=_,G=Math.min(q,Math.max(_+1,te(_))),j=jo(e,u,G);for(;$<G&&Number.isFinite(j)&&j<=y+X&&G<q;)$=G,G=Math.min(q,te(G)),j=jo(e,u,G);let le=$,ue=G;for(let C=0;C<256&&le<ue;C+=1){let W=Math.floor((le+ue+1)/2),ce=jo(e,u,W);Number.isFinite(ce)&&ce<=y+X?(le=W,Q=ce):ue=W-1}_=le}let ee=null;if(!a){ee=vu(e,u,_);let te=0;for(;ee.cmp(n)>0&&_>0&&te<K;){let $=gE(_);if(!($<_))break;_=$,ee=vu(e,u,_),te+=1}if(_<=0)return{count:s,spent:s,nextPrice:E,numericCount:0};if(_<q&&te<K)for(;_<q&&te<K;){let $=u+_,G;try{if(Number.isFinite($)&&$<Number.MAX_SAFE_INTEGER/2)G=c.fromAny(e.costAtLevel($));else{let le=L+_*h;G=Te(le).floorToInteger()}}catch{break}let j=ee.add(G);if(j.cmp(n)>0)break;ee=j,_+=1,te+=1}}let ve=s,he=!a&&Number.isFinite(u)&&Number.isFinite(_)&&u<Number.MAX_SAFE_INTEGER/2&&_<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(d)){let te=Math.max(0,Math.floor(d-Math.min(u,d)));if(_>=te)ve=s;else if(he){let $=Math.floor(u+_);ve=c.fromAny(e.costAtLevel($))}else{let $=L+_*h;ve=Te($)}}else if(he){let te=Math.floor(u+_);ve=c.fromAny(e.costAtLevel(te))}else{let te=L+_*h;ve=Te(te)}return{count:pu(_),spent:ee,nextPrice:ve,numericCount:_}}function yE(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=qe(t),r=qe(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function Gp(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let d=BigInt(o)/BigInt(r),f=c.fromAny(d.toString());!n.isInfinite?.()&&f.cmp(n)>0&&(f=n);let p=e.mulBigNumInteger(f);return{count:Hp(f),countBn:f,spent:p,nextPrice:e}}let i=qe(t),s=qe(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=Te(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:Hp(l),countBn:l,spent:a,nextPrice:u}}function vE(e,t,n,o){if(!n||o<=0)return{count:0};let r=qe(t),i=qe(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let y=0;y<64&&a<u;y+=1){let h=Math.max(0,Math.floor((a+u+1)/2));i+h*n.ratioLog-n.logDenom<=r?a=h:u=h-1}let d=Math.min(a,o);if(d<=0)return{count:0};let f=i+d*n.ratioLog-n.logDenom;if(f>r)return{count:0};let p=i+d*n.ratioLog,g=Te(f),m=Te(p);return{count:d,spent:g,nextPrice:m,spentLog:f,nextPriceLog:p}}function Zo(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function Hp(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Rr(e){return J(e instanceof c?e:c.fromAny(e??0))}function lt(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=qe(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return J(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):J(c.fromAny(t))}catch{return"1"}}function Ns(e){return Rr(e).replace(/<[^>]*>/g,"")}function wu(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function Rs(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=wu(n??t??0),s=wu(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Ue(i),newLevel:Number.isFinite(o)?o:Ue(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Bt(e,t){return zn(e,t)}function Bv(e,t=v()){return t==null?null:`ccc:upgrades:${e}:${t}`}function gi(e,t,n=v()){if(n==null)return null;let o=Jo(e),r=Jp(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function bE(){vv.forEach(e=>{try{e?.()}catch{}}),vv.clear()}function bv(e){bE()}function SE(e,t){if(typeof localStorage>"u")return;let n=Bv(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=gi(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}}),console.log(`[UpgradeMigration] Migrated ${i} upgrades for area ${e} slot ${t}`)}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function IE(e,t,n){SE(e,n);let o=gi(e,t,n);if(!o)return null;if(ks&&sl.has(o))try{let r=sl.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Nr.has(o))try{let r=Nr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function As(e,t,n,o=v(),r={}){let i=gi(e,t,o);if(i){if(ks){sl.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Nr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Nr.has(i)&&Nr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{rt(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function wE(e,t,n=v()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&As(e,o.id,o,n)})}function Jp(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return jn(t.id);let n=jn(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=Qo(n);if(o){let r=Fp.get(o);if(r){let i=Jo(e);if(!i||Jo(r.area)===i)return jn(r.id)}}}return n}function Fv(e,t,n=v()){let o=n==null?"null":String(n),r=Jp(e,t);return`${o}:${e}:${jn(r)}`}function po(e,t){let n=Jp(e,t),o=jn(n),r=v(),i=Fv(e,o,r),s=Xp.get(i);if(s)return s;let l=Us(e,o),a=IE(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,As(e,o,a,r)}let d=a.lvl,f=a.nextCost,p=a.nextCostLvl;a.lvl=Ts(a.lvl),a.nextCost=Ts(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=Ts(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==d||a.nextCost!==f||a.nextCostLvl!==p)&&(u=!0);let g=0;l?.upgType==="HM"&&(g=Bs(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),Lu(l,g));let m=dt(a.lvl),y=Ue(m);try{let R=l?.lvlCapBn??c.fromAny("Infinity");if(!R.isInfinite?.()&&m.cmp(R)>0){let T=R.clone?.()??R;y=Ue(T);let F=T.toStorage();a.lvl=F,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=F,As(e,o,a,r)}}catch{}let h=null;try{h=m?.toStorage?.()??dt(y).toStorage()}catch{}h&&a.lvl!==h&&(a.lvl=h,u=!0);let b=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,E=!b||b!==h,L=null;if(!E&&a.nextCost!=null)try{L=c.fromAny(a.nextCost)}catch{L=null,E=!0}if(!L||E){if(l)try{L=c.fromAny(l.costAtLevel(y))}catch{L=c.fromInt(0)}else L=c.fromInt(0);try{a.nextCost=L.toStorage(),h?a.nextCostLvl=h:delete a.nextCostLvl,u=!0}catch{}}if(u)try{As(e,o,a,r)}catch{}if(l?.upgType==="HM"&&m?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let R=c.fromAny("Infinity");l.lvlCapBn=R,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Rr(R),l.lvlCapFmtText=Ns(R)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:y,lvlBn:m,nextCostBn:L,slot:r,hmEvolutions:g},Xp.set(i,s),s}function Or(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??v();if(!n||o==null)return;let r=jn(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??dt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Ue(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??dt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=dt(e.lvl??0).toStorage()}i.lvl=Ts(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=Ts(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=Bs(e.hmEvolutions)),As(n,r,i,o,t),e.slot=o}function er(e,t,n=v()){Xp.delete(Fv(e,t,n))}function Mt(e,t){return po(e,t).lvl}function Yp(e,t){return po(e,t).hmEvolutions??0}function Uv(e,t){if(!t)return{locked:!1};let n=Cv(),o=n?hn():c.fromInt(0),r=n?Ue(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let d=cE(e,t),f="Unlock the XP system to reveal this upgrade",p=Mv();if(d)if(p)i={locked:!0,iconOverride:mn,titleOverride:tn,descOverride:f,reason:f,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let g='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:Nn,titleOverride:Kn,descOverride:g,reason:g,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:Nn,titleOverride:Kn,descOverride:f,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=Rp({locked:!1},i);if(typeof t.computeLockState=="function")try{let d={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,baseLocked:s.locked,getUpgradeLevel(p){return Mt(e,p)}},f=t.computeLockState(d);s=Rp(s,f)}catch{}let l=v(),a=Ps(e,t),u=a?Su(e,t,l):!1;if(a){let d=Dp(l),f=Eu(l),p=Wp(l),g=a.replace(/_/g,"-"),m=ll(e,t),y=!1;Cs(d,g,a)&&(y=!0),m&&Cs(d,m,a)&&(y=!0),y&&$p(d,l);let h=!1;Cs(f,g,a)&&(h=!0),m&&Cs(f,m,a)&&(h=!0),h&&xu(f,l);let b=!1;Cs(p,g,a)&&(b=!0),m&&Cs(p,m,a)&&(b=!0),b&&zp(p,l)}if(s.locked){let d=!!s.hidden;s.iconOverride||(s.iconOverride=Nn),d?s.titleOverride||(s.titleOverride=tn):(!s.titleOverride||s.titleOverride===tn)&&(s.titleOverride=Kn),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:d&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Nn||s.iconOverride===mn)&&delete s.iconOverride,(s.titleOverride===tn||s.titleOverride===Kn)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=Nn),a){let d=Dp(l),f=d.upgrades[a]||{},p=Qo(t?.tie??t?.tieKey),g=p&&wv.has(p),m=p&&Vp.has(p),y=f.status||"locked";if(Su(e,t,l))y="unlocked";else if(_v(e,t,l)&&y==="locked"){let x=!1;try{x=Ue(hn())>=31}catch{}let B=!1;try{B=Ue(hn())>=101}catch{}g&&!x||m&&!B?y="locked":y="mysterious"}let h=du(y),b=Np(s),E=du(b),L=()=>{s.locked=!0;let x=f.snapshot;x&&typeof x=="object"&&(s=Rp(s,x)),s.iconOverride=mn,s.titleOverride=tn;let B=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=B,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};h>E&&(y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):y==="mysterious"&&L(),b=Np(s),E=du(b));let R=!1,T=f&&typeof f=="object"&&typeof f.status=="string"?f.status:"locked",F=g,U=!1;try{U=Ue(hn())>=31}catch{}let q=!1;try{q=Ue(hn())>=101}catch{}if((F&&!U&&T==="mysterious"||m&&!q&&T==="mysterious")&&(T="locked"),(!f||typeof f!="object"||Object.keys(f).length!==1||f.status!==T)&&(d.upgrades[a]={status:T},R=!0),E>h){if(f.status=b,d.upgrades[a]={status:f.status},R=!0,y=b,h=E,b==="unlocked")hi(e,t,l);else if(b==="mysterious"){let x=!1;try{x=Ue(hn())>=31}catch{}(!g||x)&&qp(e,t,l)}}y==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===Nn||s.iconOverride===mn)&&delete s.iconOverride,(s.titleOverride===tn||s.titleOverride===Kn)&&delete s.titleOverride,delete s.descOverride,delete s.reason,f.status!=="unlocked"&&(d.upgrades[a]={status:"unlocked"},R=!0),hi(e,t,l)):y==="mysterious"&&b!=="mysterious"&&(L(),b=Np(s),E=du(b)),R&&$p(d,l)}return s}function ul(e,t){return!!Uv(e,t).locked}function Qp(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:Iu(e),{capBn:r,cap:i}=Tv(o);try{return t?.cmp?.(r)>=0}catch{}let s=Ue(t);return Number.isFinite(s)&&s>=i}function Cn(e,t){let n=po(e,t);return n.lvlBn?.clone?n.lvlBn.clone():dt(n.lvl??0)}function Dv(e,t){let n=po(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??dt(n.lvl??0),i=Ue(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function Ko(e,t,n,o=!0,r={}){let i=po(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,Lu(s,0));let a=s?.lvlCap??1/0,u=i.lvl,d=wu(i.lvlBn??dt(i.lvl??0)),f=dt(n);f.isInfinite?.()&&(f=c.fromAny("Infinity"));let p=f;try{s&&Sv(s,p)&&(p=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let m=dt(a);p.cmp(m)>0&&(p=m)}if(o&&Number.isFinite(a)){let m=dt(a);p.cmp(m)>0&&(p=m)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(p)===0)return i.lvl;let g=Ue(p);if(!s)return i.lvl=g,i.lvlBn=p,i.nextCostBn=c.fromInt(0),Or(i),er(e,t),fo(),i.lvl;i.lvl=g,i.lvlBn=p;try{i.nextCostBn=c.fromAny(s.costAtLevel(g))}catch{i.nextCostBn=c.fromInt(0)}return Or(i,{deferSave:r?.deferSave}),er(e,t),Rs(s,u,d,i.lvl,i.lvlBn),fo(),i.lvl}function Ut(e){return _u.filter(t=>t.area===e)}function Us(e,t){let n=Jo(e),o=jn(t),r=Qo(typeof o=="string"?o:t);return _u.find(i=>n&&Jo(i.area)!==n?!1:!!(jn(i.id)===o||r&&i.tieKey===r))||null}function Wo(e,t){let n=typeof t=="object"&&t?t:Us(e,t);return Uv(e,n)}function EE(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function Uc(e){return e?EE(e.icon):""}function xE(e,t){let n=Us(e,t),o=Cn(e,t),r=Ue(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Ga(e,t){let n=po(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(ul(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??dt(r),s=wu(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(Sv(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Ue(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Or(n),er(e,t),fo(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,d=u?O[u]:null,f=c.fromInt(0);if(d&&!a.isZero?.()){let g=d.value;if((g instanceof c?g:c.fromAny(g??0)).cmp(a)<0)return{bought:0,spent:0};f=a.clone?.()??c.fromAny(a),d.sub(f)}else{if(!a.isZero?.())return{bought:0,spent:0};f=c.fromInt(0)}let p=i.add(c.fromInt(1));return n.lvlBn=p,n.lvl=Ue(p),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(f,n.lvl):o.costAtLevel(n.lvl)),Or(n),er(e,t),Rs(o,r,s,n.lvl,n.lvlBn),fo(),{bought:1,spent:f}}function Nd(e,t){let n=po(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??dt(n.lvl);if(!Qp(o,r,n.hmEvolutions))return{evolved:!1};let i=Bs(n.hmEvolutions)+1;n.hmEvolutions=i,Lu(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Or(n),er(e,t),Rs(o,n.lvl,r,n.lvl,r),fo(),{evolved:!0}}function Fc(e,t){let n=po(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(ul(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??dt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=O[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Ga(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let b=i.clone?.()??dt(i),E=Ue(b),L=b.toStorage?.(),R;if(o.upgType==="HM"){if(R=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let F=c.fromAny("Infinity");o.lvlCapBn=F,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Rr(F),o.lvlCapFmtText=Ns(F)}}else{let F=o.lvlCapBn?.clone?.()??Zo(o.lvlCap??1/0,1/0);R=F?.clone?.()??F}let T=R.sub(b);if(T.isZero?.()){let F=uE(R,b);F.isZero?.()||(T=F)}if(T.isZero?.()){let F=R.toStorage?.();if(L&&F&&L!==F)if(R.isInfinite?.())try{T=c.fromAny("Infinity")}catch{T=c.fromInt(1)}else T=c.fromInt(1)}return n.lvlBn=R.clone?.()??R,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Ue(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),O[o.costType].set(u),Or(n),er(e,t),Rs(o,E,b,n.lvl,n.lvlBn),fo(),{bought:T,spent:c.fromInt(0)}}let d=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(d)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(s)?Math.max(0,s-r):Os;if(!(f>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=cl(o,i,u,f),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=p.spent??c.fromInt(0),y=u.sub(m);O[o.costType].set(y);let h=i.add(g);return n.lvlBn=h,n.lvl=Ue(h),p.nextPrice?n.nextCostBn=p.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Or(n),er(e,t),Rs(o,r,i,n.lvl,n.lvlBn),fo(),{bought:g,spent:m}}function Ha(e,t,n){let o=po(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(ul(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??dt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=O[r.costType]?.value,d=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(d.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let f=Number.isFinite(l)?Math.max(0,l-i):void 0,p=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Ue(n):void 0,g=Number.isFinite(f)?Number.isFinite(p)?Math.min(f,p):f:p,m=cl(r,s,d,g),y=m.count instanceof c?m.count:c.fromAny(m.count??0);if(y.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let h=m.spent??c.fromInt(0),b=d.sub(h);O[r.costType].set(b);let E=s.add(y);return o.lvlBn=E,o.lvl=Ue(E),m.nextPrice?o.nextCostBn=m.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Or(o),er(e,t),Rs(r,i,s,o.lvl,o.lvlBn),fo(),{bought:y,spent:h}}function ci(e,t,n,o=Os,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=cl(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function fo(){if(ks){Bp=!0,Tp();return}Tp(),dv()}function Yn(){return document.getElementById("game-root")?.classList?.contains("area-cove"),xe.STARTER_COVE}function Xa(e,t){let n=Us(e,t);if(!n)return null;let o=Cn(e,t),r=Ue(o),i=Rr(o),s=Ns(o),l=n.lvlCapBn??Zo(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Rr(l),u=n.lvlCapFmtText??Ns(l),d=r<n.lvlCap?Dv(e,t):c.fromInt(0),f=Rr(d),p=O[n.costType]?.value,g=p instanceof c?p:c.fromAny(p??0),m=Wo(e,t),y=!!m.locked,h=m.titleOverride??n.title,b=m.descOverride??n.desc;if(e===Ke&&jn(t)===jr){let T=En(),F=!1;if(T===1/0||typeof T=="string"&&T==="Infinity"?F=!0:typeof T=="bigint"?F=T>=2n:typeof T=="number"&&(F=T>=2),F&&b){let U=10,q=!1,x=En();if(x===1/0||typeof x=="string"&&x==="Infinity"||x===Number.POSITIVE_INFINITY?q=!0:typeof x=="bigint"?q=x>=8n:typeof x=="number"&&(q=x>=8),q){let B=Ft();U=Math.pow(10,B)}if(Math.abs(U-1)>1e-4){let B="10";U!==10&&(B=lt(U)),b=b.replace("Generates the equivalent of picking up a Coin on an interval",`Generates the equivalent of picking up ${B} Coins (Surge 2!) on an interval`)}}}let E=Zp(n,e),L="";typeof n.effectSummary=="function"&&!(y&&m.hideEffect)&&(L=n.effectSummary(r),typeof L=="string"&&(L=L.trim()));let R=m.iconOverride??Uc(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:d,nextPriceFmt:f,have:g,haveFmt:O[n.costType]?.fmt(g)??String(g),effect:L,iconUrl:R,lockState:m,locked:y,areaKey:e,hmMilestones:E,displayTitle:h,displayDesc:b,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?Yp(e,t):0,hmReadyToEvolve:n.upgType==="HM"?Qp(n,o,Yp(e,t)):!1,hmNextMilestone:n.upgType==="HM"?Nv(n,o,e):null}}function LE(e,t){let n=Us(e,t);if(!n||n.upgType!=="HM")return null;let o=Cn(e,t);return Nv(n,o,e)}function _E(e){return Te(qe(e??0))}function Td(e,t){let n=po(e,t),o=n.upg;if(!o)return{bought:0};let r=Bv(e,n.slot);if(ln(r))return{bought:0};let i=gi(e,t,n.slot);if(ln(i))return{bought:0};if(ul(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??dt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&Qp(o,l,n.hmEvolutions))return{bought:0};let d=O[o.costType]?.value,f=d instanceof c?d.clone?.()??c.fromAny(d):c.fromAny(d??0);if(f.isZero?.())return{bought:0};let p=cl(o,l,f,Os),g=p.count instanceof c?p.count:c.fromAny(p.count??0);if(g.isZero?.())return{bought:0};let m=l.add(g);return eE(),Ko(e,t,m,!0,{deferSave:!0}),{bought:g}}function Rd(e,t){let n=po(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(ul(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??dt(n.lvl),i=Ue(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=O[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=ci(o,r,a,c.fromAny("Infinity")),d=u.numericCount;if(d<=0)return{bought:0,spent:c.fromInt(0)};let f=g=>{if(g<=0)return!0;let m=vu(o,i,g-1),y=a.sub(m),h=i+g-1,b=c.fromAny(o.costAtLevel(h)),E=y.div(10);return b.cmp(E)<=0},p=0;if(d<2e3){let g=u.spent,m=d;for(;m>0;){let y=i+m-1,h=c.fromAny(o.costAtLevel(y)),b=g.sub(h),L=a.sub(b).div(10);if(h.cmp(L)<=0){p=m;break}g=b,m--}}else{let g=0,m=d;for(;g<m;){let y=Math.ceil((g+m)/2);f(y)?g=y:m=y-1}p=g}return p<=0?{bought:0,spent:c.fromInt(0)}:Ha(e,t,p)}var Os,Gt,dM,Qw,bu,xe,ks,gv,sl,Bp,Nr,yv,nE,Ap,we,Iv,oE,Nn,mn,tn,Kn,wv,Vp,rE,iE,sE,aE,Ev,xv,Lv,lE,mu,hu,gu,Fp,pM,Up,fu,zt,Ms,fE,Op,Ov,Pp,hE,_u,Xp,vv,fn=$e(()=>{St();Ct();Kt();Hn();xo();wo();so();Zr();hv();Os=c.fromAny("Infinity"),Gt=1e3,dM=c.fromInt(1e3),Qw=3,bu="",xe={STARTER_COVE:"starter_cove",AUTOMATION:Ke},ks=!1,gv=new Map,sl=new Map,Bp=!1,Nr=new Map,yv=null;nE=308;Ap=1024;we={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},Iv=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],oE={[xe.STARTER_COVE]:Iv},Nn="img/misc/locked.webp",mn="img/misc/mysterious.webp",tn="Hidden Upgrade",Kn="Locked Upgrade",wv=new Set([we.COIN_VALUE_II,we.XP_VALUE_II,we.MP_VALUE_I,we.MAGNET,we.ENDLESS_XP]),Vp=new Set([we.COIN_VALUE_III,we.XP_VALUE_III,we.MP_VALUE_II,we.FASTER_COINS_III,we.ENDLESS_MP]),rE=new Set([we.UNLOCK_XP,we.UNLOCK_FORGE,we.UNLOCK_INFUSE,we.UNLOCK_SURGE,...wv,...Vp]),iE=new Set([we.FASTER_COINS_II,we.COIN_VALUE_I,we.BOOK_VALUE_I,we.XP_VALUE_I]),sE=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),aE="ccc:merchantMet",Ev="ccc:shop:reveals",xv="ccc:shop:permaUnlocks",Lv="ccc:shop:permaMyst",lE={locked:0,mysterious:1,unlocked:2},mu=new Map,hu=new Map,gu=new Map,Fp=new Map,pM=Qo(we.BOOK_VALUE_I),Up=c,fu=e=>Up.fromAny(e??0),zt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=fu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Up.fromInt(1).add(r.mulDecimal(n))}catch{let i=qe(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return Te(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=fu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Up.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(fu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=fu(i);if(o>0){let l=qe(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let d=Math.pow(n,a);if(Number.isFinite(d))return d}return Te(u)}}catch{}try{let l=Ue(s),a=o*l;return Te(a)}catch{return c.fromInt(1)}}}};Ms=Math.log(10);fE={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=Iu(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=Iu(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};Op=(()=>{try{let e=Ue(Os);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),Ov=new ArrayBuffer(8),Pp=new Float64Array(Ov),hE=new BigInt64Array(Ov);_u=[{area:xe.STARTER_COVE,id:1,tie:we.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:2,tie:we.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"img/stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{Yr()}catch{}}},{area:xe.STARTER_COVE,id:3,tie:we.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(.1)},{area:xe.STARTER_COVE,id:4,tie:we.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(.5),onLevelChange(){try{Zt()}catch{}}},{area:xe.STARTER_COVE,id:5,tie:we.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>yu(e)>0?2:1,onLevelChange({newLevel:e}){il(e)}},{area:xe.STARTER_COVE,id:6,tie:we.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${lt(t)}x`},effectMultiplier:zt.addFlatPerLevel(2)},{area:xe.STARTER_COVE,id:7,tie:we.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"img/stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,onLevelChange({newLevel:e}){if((e??0)>=1)try{_p()}catch{}}},{area:xe.STARTER_COVE,id:8,tie:we.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${J(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(10),onLevelChange(){try{Zt()}catch{}}},{area:xe.STARTER_COVE,id:9,tie:we.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:10,tie:we.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:11,tie:we.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=yu(e),n=lt(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>yu(e)},{area:xe.STARTER_COVE,id:12,tie:we.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach a certain upgrade level for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Gt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState:pn,effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ar(this,t,this.area),r=Lt(n,o);return`XP value bonus: ${lt(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:13,tie:we.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"img/misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Cp()}catch{}}},{area:xe.STARTER_COVE,id:14,tie:we.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${J(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(1e3)},{area:xe.STARTER_COVE,id:15,tie:we.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:16,tie:we.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:17,tie:we.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Bt(this,e)},nextCostAfter(e,t){return Bt(this,t)},computeLockState:pn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${lt(t)}x`},effectMultiplier:zt.addPctPerLevel(1)},{area:xe.STARTER_COVE,id:18,tie:we.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Gt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState:pn,effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ar(this,t,this.area),r=Lt(n,o);return`MP value bonus: ${lt(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:19,tie:we.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"img/misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:pn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Mp()}catch{}}},{area:xe.STARTER_COVE,id:20,tie:we.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Gt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState(e){let t=En(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=hn();o=Ue(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:mn,titleOverride:tn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked"}},onLevelChange(){try{Zt()}catch{}},effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ar(this,t,this.area),r=Lt(n,o);return`Coin value bonus: ${lt(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:21,tie:we.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Gt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState(e){let t=En(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=hn();o=Ue(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:mn,titleOverride:tn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked"}},onLevelChange(){try{Zt()}catch{}},effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ar(this,t,this.area),r=Lt(n,o);return`Coin value bonus: ${lt(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},{area:xe.STARTER_COVE,id:22,tie:we.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Gt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return zn(this,e)},nextCostAfter(e,t){return zn(this,t)},computeLockState(e){let t=En(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=hn();o=Ue(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:mn,titleOverride:tn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:Kn,descOverride:"Locked"}},onLevelChange(){try{Zt()}catch{}},effectSummary(e){let t=dt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ar(this,t,this.area),r=Lt(n,o);return`Coin value bonus: ${lt(r)}x`},effectMultiplier:zt.powPerLevel(1.1)},...Yh];for(let e of _u){let t=Qo(e.tie??e.tieKey);t&&!Fp.has(t)&&Fp.set(t,e),e.baseCost=Zo(e.baseCost??0,0),e.baseCostBn=e.baseCost,e.numUpgEvolutions=Bs(e.numUpgEvolutions),e.upgType==="HM"?Lu(e,e.numUpgEvolutions):(e.lvlCapBn=Zo(e.lvlCap??1/0,1/0),e.lvlCap=Hp(e.lvlCapBn),e.lvlCapFmtHtml=Rr(e.lvlCapBn),e.lvlCapFmtText=Ns(e.lvlCapBn)),e.bulkMeta=yE(e),Fs(e)}Xp=new Map;vv=new Map;typeof window<"u"&&(bv(v()),window.addEventListener("saveSlot:change",()=>{bv(v()),fo()}));mv()});var m0={};bt(m0,{applyAllCurrencyOverridesForActiveSlot:()=>bl,applyStatMultiplierOverride:()=>Xn,getDebugCurrencyMultiplierOverride:()=>pl,getDebugStatMultiplierOverride:()=>GE,setDebugCurrencyMultiplierOverride:()=>r0,setDebugPanelAccess:()=>Ex,setDebugStatMultiplierOverride:()=>Rn});function vl(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function AE(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function gn(e){typeof e=="function"&&nm.push(e)}function Ou(){return{sections:new Set,subsections:new Set}}function NE(){let e=document.getElementById(hl);if(!e)return Ou();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function RE(e){let{sections:t,subsections:n}=Kv??Ou();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function Jv(){nm.forEach(e=>{try{e?.()}catch{}}),nm=[],am.length=0}function Dt(e){!e||typeof e.refresh!="function"||am.push(e)}function st(e){am.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function OE(){if(typeof window>"u")return;let e=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();st(b=>b.type==="currency"&&b.key===m&&b.slot===h)};window.addEventListener("currency:change",e,{passive:!0}),gn(()=>window.removeEventListener("currency:change",e));let t=g=>{let{key:m,slot:y}=g?.detail??{},h=y??v();st(b=>b.type==="currency-mult"&&b.key===m&&b.slot===h)};window.addEventListener("currency:multiplier",t,{passive:!0}),gn(()=>window.removeEventListener("currency:multiplier",t));let n=g=>{let{slot:m,changeType:y,unlocked:h}=g?.detail??{},b=m??v();st(E=>E.type==="xp"&&E.slot===b),st(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===b),(y==="unlock"||typeof h=="boolean")&&st(E=>E.type==="unlock"&&(E.slot==null||E.slot===b))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),gn(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=g=>{let{changeType:m,slot:y}=g?.detail??{},h=y??v();st(b=>b.type==="mutation"&&b.slot===h),st(b=>b.type==="stat-mult"&&b.key==="mutation"&&b.slot===h),m==="unlock"&&st(b=>b.type==="unlock"&&(b.slot==null||b.slot===h))};window.addEventListener("mutation:change",o,{passive:!0}),gn(()=>window.removeEventListener("mutation:change",o));let r=()=>{let g=v();st(m=>m.type==="upgrade"&&m.slot===g),st(m=>m.type==="currency-mult"&&m.slot===g),st(m=>m.type==="stat-mult"&&m.slot===g)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),gn(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let g=v();st(m=>m.slot===g)};window.addEventListener("saveSlot:change",i,{passive:!0}),gn(()=>window.removeEventListener("saveSlot:change",i));let s=g=>{let{slot:m,key:y}=g?.detail??{},h=m??v();st(b=>b.type==="unlock"&&(b.slot==null||b.slot===h)&&(b.key==null||b.key===y))};window.addEventListener("unlock:change",s,{passive:!0}),gn(()=>window.removeEventListener("unlock:change",s));let l=g=>{let{slot:m}=g?.detail??{},y=m??v();st(h=>h.type==="workshop-level"&&h.slot===y)};window.addEventListener("workshop:change",l,{passive:!0}),gn(()=>window.removeEventListener("workshop:change",l));let a=g=>{let{slot:m}=g?.detail??{},y=m??v();st(h=>h.type==="surge-level"&&h.slot===y)};window.addEventListener("surge:level:change",a,{passive:!0}),gn(()=>window.removeEventListener("surge:level:change",a));let u=g=>{let{slot:m}=g?.detail??{},y=m??v();st(h=>h.type==="tsunami-nerf"&&(h.slot==null||h.slot===y))};window.addEventListener("surge:nerf:change",u,{passive:!0}),gn(()=>window.removeEventListener("surge:nerf:change",u));let d=g=>{let{slot:m}=g?.detail??{},y=m??v();st(h=>h.type==="lab-level"&&(h.slot==null||h.slot===y)),st(h=>h.type==="stat-mult"&&h.key==="rp"&&(h.slot==null||h.slot===y))};window.addEventListener("lab:level:change",d,{passive:!0}),gn(()=>window.removeEventListener("lab:level:change",d));let f=g=>{let{id:m,level:y}=g?.detail??{},h=v();st(b=>b.type==="lab-node-level"&&b.slot===h&&b.id===m),m===1&&st(b=>b.type==="tsunami-nerf"&&(b.slot==null||b.slot===h)),m===4&&st(b=>b.type==="unlock"&&(b.slot==null||b.slot===h))};window.addEventListener("lab:node:change",f,{passive:!0}),gn(()=>window.removeEventListener("lab:node:change",f));let p=g=>{let{id:m,rp:y}=g?.detail??{},h=v();st(b=>b.type==="lab-node-rp"&&b.slot===h&&b.id===m)};window.addEventListener("lab:node:rp",p,{passive:!0}),gn(()=>window.removeEventListener("lab:node:rp",p))}function Pu(){return[{key:xe.STARTER_COVE,title:"The Cove",currencies:[{key:Ce.COINS,label:"Coins"},{key:Ce.BOOKS,label:"Books"},{key:Ce.GOLD,label:"Gold"},{key:Ce.MAGIC,label:"Magic"},{key:Ce.GEARS,label:"Gears"},{key:Ce.WAVES,label:"Waves"},{key:Ce.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function Qv(){if(document.getElementById(Cu))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=Cu;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=Cu,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=Cu,document.head.appendChild(n)}function rm(){let e=document.getElementById(zv);e&&e.remove()}function PE(){return Ii&&je&&v()!=null&&!vl()&&AE()}function BE(e){e?.detail?.visible&&ko(),Uu()}function ku(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${jv++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function Zn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${Zv++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let d=r.classList.toggle("expanded");s.classList.toggle("active",d)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function kt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function lm(e,t=v()){let n=t??v();return n==null?null:`${yt.CURRENCY[e]}:${n}`}function dl(e,t=v()){let n=t??v();if(n==null)return c.fromInt(0);let o=O?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return ca(n,e)}catch{return c.fromInt(0)}}function FE(e,t,n=v()){let o=n??v(),r=dl(e,o);if(o==null||o!==v())return{previous:r,next:r};let i=lm(e,o),s=i&&mo(i);s&&Hs(i);let l=r;try{vn(o),l=Ni(e,t,{previous:r})??r,i&&rt(i)}catch{}finally{s&&xi(i)}return st(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function Jn(e,t){return`${e??"null"}::${t}`}function cm(e,t){return gl.get(Jn(e,t))??null}function UE(e,t=v()){let n=t??v();return!e||n==null?null:`${yt.MULTIPLIER[e]}:${n}`}function DE(e,t=v()){let n=Jn(t,e);gl.delete(n),qs.delete(n),st(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function um(e,t){let n=!Bu(t,e),o=Jn(e,t),r=ml.get(o);if(!n&&r)return r;let i=$E(t,e);return i?(ml.set(o,i),i):(n&&ml.delete(o),null)}function e0(e,t){st(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function t0(e,t=v()){let n=Ei(e,t);if(ml.delete(Jn(t,e)),yi.delete(Jn(t,e)),!(!n||typeof localStorage>"u")&&!mo(n)){try{localStorage.removeItem(n)}catch{}e0(e,t)}}function Bu(e,t=v()){return mo(Ei(e,t))}function n0(e,t){return Bu(t,e)?um(e,t):null}function On(e,t=v()){let n=wi(e);return Fu(e,t,n)??n}function Ei(e,t=v()){if(!e)return null;let n=t??v();return n==null?null:`${CE}:${e}:${n}`}function wi(e){try{if(e==="xp"){let t=jl();if(t)return t}else if(e==="mutation"){let t=$u?.();if(t)return t;let n=Du();if(n)return n}else if(e==="spawnRate"){let t=cs(xe.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return dc()}catch{}return c.fromInt(1)}function $E(e,t=v()){let n=Ei(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function qE(e,t,n){let o=Ei(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=mo(o),s=i&&$s?$s:localStorage.setItem.bind(localStorage);i&&!$s&&Hs(o),s(o,r.toStorage?.()??String(r)),i&&!$s&&xi(o)}catch{}}function fm(e,t=v()){if(t==null)return;let n=cm(t,e);if(!n||t!==v())return;let o=Jn(t,e);if(!Au.has(o)){Au.add(o);try{let r=O?.[e]?.mult?.get?.();kt(r,n)||O?.[e]?.mult?.set?.(n)}catch{}finally{Au.delete(o)}}}function o0(){if(!(Hv||typeof window>"u")){Hv=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??v(),i=Jn(r,t);if(!r||!gl.has(i)||Au.has(i))return;let s=qs.get(i),l=cm(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let d=u.div(a),f=d.sig===1n&&d.e===0&&d._eOffset===0n?1:null,p=l.mulBigNumInteger(d);gl.set(i,p)}}catch{}qs.set(i,o)}else o&&qs.set(i,o);fm(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{bl()},{passive:!0})}catch{}}}function bl(){let e=v();e!=null&&Object.values(Ce).forEach(t=>{fm(t,e)})}function r0(e,t,n=v()){if(!e||n==null)return null;o0();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=Jn(n,e);if(gl.set(r,o),!qs.has(r)){let i=O?.[e]?.mult?.get?.();qs.set(r,i)}return fm(e,n),o}function pl(e,t=v()){return!e||t==null?null:cm(t,e)}function Rn(e,t,n=v()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return ml.set(Jn(n,e),o),yi.set(Jn(n,e),wi(e)),qE(e,n,o),e0(e,n),o}function GE(e,t=v()){return!e||t==null?null:um(t,e)}function Xn(e,t,n=v()){let o=wi(e),r=Fu(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(kt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=Jn(n,e),l=yi.get(s),a=Bu(e,n)&&l?l:o,u=null;try{let d=c.fromAny(r),f=c.fromAny(a);f.isZero()||(u=d.div(f))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function Fu(e,t,n){let o=um(t,e),r=Jn(t,e);if(!o)return yi.delete(r),null;let i=yi.get(r),s=Bu(e,t);if(!i)yi.set(r,n);else if(!kt(i,n))return s?(yi.set(r,n),o):(t0(e,t),null);return o}function HE(){if(!(qv||typeof localStorage>"u")){qv=!0;try{$s=localStorage.setItem.bind(localStorage),Gv=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!Gs.has(e))return $s(e,t)},localStorage.removeItem=e=>{if(!Gs.has(e))return Gv(e)}}catch{}}}function mo(e){return e!=null&&Gs.has(e)}function xi(e){e&&(HE(),Gs.add(e))}function Hs(e){e&&Gs.delete(e)}function XE(e){return e?mo(e)?(Hs(e),!1):(xi(e),!0):!1}function YE(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=mo(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(XE(e),typeof t=="function")try{t(mo(e))}catch{}o()}),o(),{button:n,refresh:o}}function VE(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>mo(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>mo(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?Hs(u):xi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function WE(){let e=document.getElementById(hl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function zE(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{mo(r)&&(o.push(r),Hs(r))});try{return t?.()}finally{o.forEach(r=>xi(r))}}function KE(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function dm(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function im(e,t){e.classList.toggle("debug-invalid",!t)}function Ze(){let e=v();try{vn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function i0(e=v()){return e==null?null:`${ME}:${e}`}function s0(e=v()){let t=i0(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function a0(e,t=v()){let n=i0(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,om);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function jE(e,t=v()){let n=s0(t);return n.unshift(e),n.length>om&&(n.length=om),a0(n,t),n}function Je(e){let t=v();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};jE(o,t),pm()}function pm(){if(!Ds)return;let e=s0();if(e.length===0){Ds.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",Ds.appendChild(t);return}Ds.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function l0(e=v()){return e==null?null:`${Ua}:${e}`}function c0(e,t=v()){let n=l0(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function u0(e=v()){let t=l0(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function ZE(e){if(e){if(Object.values(Ce).includes(e.type)){try{e.type===Ce.BOOKS?O.books.addWithMultiplier?.(e.amount)??O.books.add(e.amount):O[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function JE(){let e=v();if(e==null)return{completed:0};let t=u0(e),n=0;return Object.entries(Ec).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,ZE(r.reward))}),c0(t,e),{completed:n}}function QE(){let e=v();if(e==null)return{restored:0};let t=u0(e),n=0;return Object.entries(Ec).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),c0(t,e),{restored:n}}function nn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let h=document.createElement("span");h.className="debug-panel-id",h.textContent=`(ID: ${o})`,a.appendChild(h)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let d=!1,f=null,p=!1,g=r?YE(r,{onToggle:i}):null,m=h=>{if(d){f=h;return}f=null,u.value=typeof s=="function"?s(h):KE(h)};l.appendChild(u),g&&l.appendChild(g.button);let y=()=>{let h=dm(u.value);if(!h){im(u,!1);return}im(u,!0);let b=r&&mo(r);b&&Hs(r);try{n(h,{input:u,setValue:m})}finally{b&&xi(r),g&&g.refresh()}};return u.addEventListener("focus",()=>{d=!0}),u.addEventListener("change",y),u.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),p=!0,y(),u.blur())}),u.addEventListener("blur",()=>{if(d=!1,p||y(),p=!1,f!=null){let h=f;f=null,m(h)}}),m(t),g&&g.refresh(),{row:l,input:u,setValue:m,isEditing:()=>d}}function ex({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let d=document.createElement("div");d.className="debug-unlock-text";let f=document.createElement("span");if(f.className="debug-unlock-title",f.textContent=e,d.appendChild(f),t){let y=document.createElement("span");y.className="debug-unlock-desc",y.textContent=`- ${t}`,d.appendChild(y)}s.appendChild(l),s.appendChild(d);let p=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",y=>{l.contains(y.target)||p()});let g=!1,m=()=>{let y=!1;try{y=typeof n=="function"?!!n():!1}catch{}return a.checked=y,g=y,y};return a.addEventListener("change",()=>{let y=g,h=a.checked;try{h?o?.():r?.()}catch{}Ze();let b=m();y!==b&&Je(`Toggled ${e} [GOLD]${y?"True":"False"}[/GOLD] \u2192 [GOLD]${b?"True":"False"}[/GOLD]`)}),m(),Dt({type:"unlock",slot:i,refresh:m}),s}function tx(e){try{if(e instanceof c||typeof e?.toScientific=="function")return J(e);let t=Number(e);return Number.isFinite(t)?J(t):String(e??"\u2014")}catch{return"\u2014"}}function nx({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},d=!1;if(l.forEach(({config:f,el:p})=>{if(f.type==="select"){u[f.key]=p.value;return}let g=dm(p.value),m=g instanceof c;if(im(p,m),!m){d=!0;return}u[f.key]=g}),d||typeof n!="function"){s.textContent="\u2014";return}try{let f=n(u);s.innerHTML=tx(f)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let d=Object.assign({type:"text",defaultValue:""},u);if(d.key)if(d.type==="select"){let f=document.createElement("select");f.className="debug-panel-input",(d.options||[]).forEach(({value:p,label:g})=>{let m=document.createElement("option");m.value=p,m.textContent=g??p,d.defaultValue!=null&&d.defaultValue===p&&(m.selected=!0),f.appendChild(m)}),f.addEventListener("change",a),i.appendChild(f),l.push({config:d,el:f})}else{let f=document.createElement("input");f.type="text",f.className="debug-panel-input",f.placeholder=d.label||"",f.value=d.defaultValue??"",f.addEventListener("input",a),f.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a())}),i.appendChild(f),l.push({config:d,el:f})}}),a(),o}function Pr({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return Qe()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{Yr()}catch{}let d=vi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),s!=null)try{let f=s.toStorage?.()??c.fromAny(s).toStorage(),p=vi.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(l!=null)try{let f=l.toStorage?.()??c.fromAny(l).toStorage(),p=vi.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{$i({forceReload:!0})}catch{}try{zl({changeType:"debug-panel",slot:n})}catch{}try{st()}catch{}}function Br({level:e,progress:t}){let n=v();if(n==null)return;let o=(()=>{try{return ct()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=f=>{if(f==null)return null;try{return f instanceof c?f.clone?.()??f:c.fromAny(f)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let f=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,p=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!f&&p!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{yl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{Wt()}catch{}try{Tr()}catch{}let d=bi.unlock(n);try{localStorage.setItem(d,"1")}catch{}if(rt(d,"1"),e!=null)try{let f=e.toStorage?.()??c.fromAny(e).toStorage(),p=bi.level(n);localStorage.setItem(p,f),rt(p,f)}catch{}if(t!=null)try{let f=t.toStorage?.()??c.fromAny(t).toStorage(),p=bi.progress(n);localStorage.setItem(p,f),rt(p,f)}catch{}try{Wt({forceReload:!0})}catch{}try{mm({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{st()}catch{}}function ox(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=lm(r.key,n),s=dl(r.key,n),l=nn(r.label,s,(a,{setValue:u})=>{let d=v();if(d==null)return;let f=dl(r.key,d),{next:p}=FE(r.key,a,d);u(p),kt(f,p)||(Ze(),Je(`Modified ${r.label} (${o}) ${J(f)} \u2192 ${J(p)}`))},{storageKey:i,onLockChange:()=>l.setValue(dl(r.key,v()))});Dt({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let a=dl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function rx(e,t){let n=v();if(n==null){let U=document.createElement("div");U.className="debug-panel-empty",U.textContent="Select a save slot to edit stats.",e.appendChild(U);return}let o="spawnRate",r=Ei(o,n),i=nn("Coin Spawn Rate",On(o,n),(U,{setValue:q})=>{let x=v();if(x==null)return;let B=On(o,x);try{Rn(o,U,x)}catch{}let M=On(o,x);q(M),kt(B,M)||(Ze(),Je(`Modified Spawn Rate (${a}) ${J(B)} \u2192 ${J(M)}`))},{storageKey:r,onLockChange:U=>{let q=v();if(q!=null){if(U){if(n0(q,o))return;try{Rn(o,wi(o),q)}catch{}}else Fu(o,q,wi(o));i.setValue(On(o,q))}}});Dt({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==v())return;let U=On(o,n);i.setValue(U)}}),Dt({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==v())return;let U=On(o,n);i.setValue(U)}}),e.appendChild(i.row);let s=Qe(),l=ct(),a=t?.title??t?.key??"Unknown Area",u=vi.level(n),d=nn("XP Level",s.xpLevel,(U,{setValue:q})=>{let x=Qe().xpLevel;Pr({level:U});let B=Qe();q(B.xpLevel),kt(x,B.xpLevel)||(Ze(),Je(`Modified XP Level (${a}) ${J(x)} \u2192 ${J(B.xpLevel)}`))},{storageKey:u});Dt({type:"xp",slot:n,refresh:()=>{n===v()&&d.setValue(Qe().xpLevel)}}),e.appendChild(d.row);let f=vi.progress(n),p=nn("XP Progress",s.progress,(U,{setValue:q})=>{let x=Qe(),B=x?.xpLevel?.clone?.()??x?.xpLevel,M=x?.progress?.clone?.()??x?.progress;Pr({progress:U});let _=Qe();q(_.progress),d.setValue(_.xpLevel),(!kt(M,_.progress)||!kt(B,_.xpLevel))&&(Ze(),Je(`Modified XP Progress (${a}) ${J(M)} \u2192 ${J(_.progress)}`))},{storageKey:f});Dt({type:"xp",slot:n,refresh:()=>{n===v()&&p.setValue(Qe().progress)}}),e.appendChild(p.row);let g=bi.level(n),m=nn("MP Level",l.level,(U,{setValue:q})=>{let x=ct().level;Br({level:U});let B=ct();q(B.level),kt(x,B.level)||(Ze(),Je(`Modified MP Level (${a}) ${J(x)} \u2192 ${J(B.level)}`))},{storageKey:g});Dt({type:"mutation",slot:n,refresh:()=>{n===v()&&m.setValue(ct().level)}}),e.appendChild(m.row);let y=bi.progress(n),h=nn("MP Progress",l.progress,(U,{setValue:q})=>{let x=ct(),B=x?.level?.clone?.()??x?.level,M=x?.progress?.clone?.()??x?.progress;Br({progress:U});let _=ct();q(_.progress),m.setValue(_.level),(!kt(M,_.progress)||!kt(B,_.level))&&(Ze(),Je(`Modified MP Progress (${a}) ${J(M)} \u2192 ${J(_.progress)}`))},{storageKey:y});Dt({type:"mutation",slot:n,refresh:()=>{n===v()&&h.setValue(ct().progress)}}),e.appendChild(h.row);let b=ei(n);if(b){let U=0;try{let x=localStorage.getItem(b),B=c.fromAny(x||"0");if(B.isInfinite())U=1/0;else try{U=Number(B.toScientific(20))}catch{U=0}}catch{}let q=nn("Workshop Level",U,(x,{setValue:B})=>{let M=Number(x);if(console.log("[DebugPanel] Workshop Level Commit. Value type:",typeof x,"IsBigNum:",x instanceof c,"Value:",x),x instanceof c)if(x.isInfinite())M=1/0;else try{M=Number(x.toScientific(20))}catch{M=NaN}if(Number.isNaN(M)||M<0)return;let _=M===1/0?"Infinity":String(Math.floor(M));try{localStorage.setItem(b,_),Ze(),Je(`Modified Workshop Level (The Cove) ${J(U)} \u2192 ${_}`),U=M}catch{}B(M)},{storageKey:b,onLockChange:()=>{let x=0;try{let B=localStorage.getItem(b),M=c.fromAny(B||"0");M.isInfinite()?x=1/0:x=Number(M.toScientific(20))}catch{}q.setValue(x)}});e.appendChild(q.row),Dt({type:"workshop-level",slot:n,refresh:()=>{if(n!==v())return;let x=0;try{let B=localStorage.getItem(b),M=c.fromAny(B||"0");M.isInfinite()?x=1/0:x=Number(M.toScientific(20))}catch{}q.setValue(x)}})}let E=xs(n);if(E){let U=0;try{let x=localStorage.getItem(E);x==="Infinity"?U=1/0:U=c.fromAny(x||"0")}catch{U=c.fromInt(0)}let q=nn("Surge Level",U,(x,{setValue:B})=>{let M="0",_=0;x instanceof c?x.isInfinite()?(M="Infinity",_=1/0):(M=x.toPlainIntegerString(),_=x):x===1/0||typeof x=="string"&&/infinity/i.test(x)?(M="Infinity",_=1/0):(M=String(x),_=x);try{localStorage.setItem(E,M),Ze();let X=_===1/0?"Infinity":J(_),Q=U===1/0||U instanceof c&&U.isInfinite()?"Infinity":J(U);Je(`Modified Surge Level (The Cove) ${Q} \u2192 ${X}`),_===1/0?U=1/0:_ instanceof c?U=_:U=c.fromAny(_)}catch{}B(_);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let X=U;if(X!==1/0&&X instanceof c)try{X=BigInt(X.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:X}}))}catch{}},{storageKey:E,onLockChange:x=>{let B=c.fromInt(0);try{let M=localStorage.getItem(E);M==="Infinity"?B=1/0:B=c.fromAny(M||"0")}catch{}q.setValue(B)}});Dt({type:"surge-level",slot:n,refresh:()=>{if(n!==v())return;let x=c.fromInt(0);try{let B=localStorage.getItem(E);B==="Infinity"?x=1/0:x=c.fromAny(B||"0")}catch{}q.setValue(x)}}),e.appendChild(q.row)}let L=qt(),R=nn("Lab Level",L,(U,{setValue:q})=>{let x;try{x=U instanceof c?U:c.fromAny(U),x.isNegative&&x.isNegative()&&(x=c.fromInt(0))}catch{q(qt());return}let B=qt();oi(x),Ze(),kt(B,x)||Je(`Modified Lab Level (The Cove) ${J(B)} \u2192 ${J(x)}`),q(x)},{storageKey:od(n)});Dt({type:"lab-level",slot:n,refresh:()=>{n===v()&&R.setValue(qt())}}),e.appendChild(R.row);let T=()=>{let U=Ft(),q=In(),x=U+q;return x>1&&(x=1),x},F=nn("Tsunami Exponent",T().toFixed(2),(U,{setValue:q})=>{let x=Number(U);if(U instanceof c?U.isInfinite()?x=1/0:x=Number(U.toScientific(10)):typeof U=="string"&&/infinity/i.test(U)&&(x=1/0),Number.isNaN(x)){q(T().toFixed(2));return}let B=In(),M=x-B;M>1&&(M=1),M<0&&(M=0),M=Math.round(M*100)/100;let _=Ft();ns(M),Ze(),Math.abs(_-M)>1e-4&&Je(`Modified Tsunami Exponent (The Cove) Base:${_.toFixed(2)} \u2192 ${M.toFixed(2)} (Effective: ${x.toFixed(2)})`),q(T().toFixed(2))},{storageKey:td(n),format:U=>{let q=Number(U);return Number.isFinite(q)?q.toFixed(2):String(U)}});Dt({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==v())return;let U=T();F.setValue(U.toFixed(2))}}),e.appendChild(F.row)}function Xv(e,t){let n=v();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Ut(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=Cn(t.key,i.id??i.tie),u=gi(t.key,i.id??i.tie,n),d=nn(l,a,(f,{setValue:p})=>{if(v()==null)return;let m=Cn(t.key,i.id??i.tie);try{Ko(t.key,i.id??i.tie,f,!1)}catch{}let y=Cn(t.key,i.id??i.tie);p(y),kt(m,y)||(Ze(),Je(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${J(m)} \u2192 Lv${J(y)}`))},{idLabel:s,storageKey:u});Dt({type:"upgrade",slot:n,refresh:()=>{if(n!==v())return;let f=Cn(t.key,i.id??i.tie);d.setValue(f)}}),e.appendChild(d.row)})}function ix(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=O?.[r.key]?.mult,l=pl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${yt.MULTIPLIER[r.key]}:${n}`,u=nn(`${r.label} Multiplier`,l,(d,{setValue:f})=>{let p=v();if(p==null)return;let g=pl(r.key,p)??i?.get?.()??c.fromInt(1);try{r0(r.key,d,p)}catch{}bl();let y=pl(r.key,p)??i?.get?.()??c.fromInt(1);f(y),kt(g,y)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${J(g)} \u2192 ${J(y)}`))},{storageKey:a});Dt({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let f=pl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(f)}}),e.appendChild(u.row)})}function sx(){if(v()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Ce).forEach(o=>{let r=O?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||kt(i,t))return;r.set(t),n+=1}catch{}}),n}function ax(){if(v()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Ce).forEach(o=>{let r=O?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function lx(){let e=v();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=Qe()}catch{}try{r=ct()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||kt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||kt(o?.progress,t);(!i||!s)&&(Pr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||kt(r?.level,t),s=r?.progress?.isInfinite?.()||kt(r?.progress,t);(!i||!s)&&(Br({level:t,progress:t}),n+=1)}}catch{}try{let i=ei(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=xs(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{st()}catch{}return n}function cx(){let e=v();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=Qe()}catch{}try{r=ct()}catch{}try{o?.unlocked&&(Pr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Br({level:t,progress:t}),n+=1)}catch{}try{let i=ei(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=xs(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{st()}catch{}return n}function f0(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Qe()?.unlocked}catch{return!1}},onEnable:()=>{try{Yr()}catch{}try{$i({forceReload:!0})}catch{}},onDisable:()=>{try{qi({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{yl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{yl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return Bd()}catch{return!1}},onEnable:()=>{try{ui()}catch{}},onDisable:()=>{try{qc()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return Fd()}catch{return!1}},onEnable:()=>{try{$c()}catch{}},onDisable:()=>{try{Gc()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return Ed()}catch{return!1}},onEnable:()=>{try{Ic(!0)}catch{}},onDisable:()=>{try{Ic(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!wn()}catch{return!1}},onEnable:()=>{try{vr(!0)}catch{}},onDisable:()=>{try{vr(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return Pt(4)>=1}catch{return!1}},onEnable:()=>{try{hr(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{hr(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function d0(e){let t=v();if(t==null)return 0;let n=0;f0(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{st()}catch{}return n}function ux(){let e=v();if(e==null)return{unlocks:0,toggles:0};let t=0;Pu().forEach(o=>{Ut(o.key).forEach(r=>{if(r?.unlockUpgrade)try{hi(o.key,r,e),t+=1}catch{}})});try{ui()}catch{}try{$c()}catch{}let n=d0(!0);return{unlocks:t,toggles:n}}function fx(){let e=v();if(e==null)return{locks:0,toggles:0};let t=0;Pu().forEach(o=>{Ut(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Kp(o.key,r,e),t+=1}catch{}})});try{qc()}catch{}try{Gc()}catch{}let n=d0(!1);return{locks:t,toggles:n}}function dx(e,t=v()){let n=t??v();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(lm(a,n)),r(UE(a,n))},s=a=>r(Ei(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(vi.level(n)),r(vi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(bi.level(n)),r(bi.progress(n)))};return e==="all"?(Object.values(Ce).forEach(i),l("xp"),l("mutation"),Ru.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Ce).forEach(i),Array.from(o)):e==="allUnlockedStats"?(Qe()?.unlocked&&l("xp"),ct()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Ce).forEach(i),Qe()?.unlocked&&l("xp"),ct()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function Tu(e){try{O?.[e]?.set?.(c.fromInt(0))}catch{}try{DE(e)}catch{}try{Dl(e,c.fromInt(1))}catch{}}function px(e){if(e==="all"){Object.values(Ce).forEach(i=>Tu(i));let o=c.fromInt(0);return Pr({level:o,progress:o}),Br({level:o,progress:o}),Ru.forEach(({key:i})=>{try{Rn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Ce).length+Ru.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Ce).forEach(i=>{Tu(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(Qe()?.unlocked){Pr({level:o,progress:o});try{Rn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(ct()?.unlocked){Br({level:o,progress:o});try{Rn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Ce).forEach(l=>{Tu(l),o+=1});let r=c.fromInt(0),i=0;try{if(Qe()?.unlocked){Pr({level:r,progress:r});try{Rn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(ct()?.unlocked){Br({level:r,progress:r});try{Rn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return Tu(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{t0(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Pr({level:n,progress:n});try{Rn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Br({level:n,progress:n});try{Rn("mutation",c.fromInt(1))}catch{}return"MP"}try{Rn(t,c.fromInt(1))}catch{}return`stat ${t}`}function mx(e,t){let n=v();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";Ru.forEach(r=>{if(r.key==="spawnRate")return;let i=Ei(r.key,n),s=nn(`${r.label} Multiplier`,On(r.key,n),(l,{setValue:a})=>{let u=v();if(u==null)return;let d=On(r.key,u);try{Rn(r.key,l,u)}catch{}let f=On(r.key,u);a(f),kt(d,f)||(Ze(),Je(`Modified ${r.label} Multiplier (${o}) ${J(d)} \u2192 ${J(f)}`))},{storageKey:i,onLockChange:l=>{let a=v();if(a!=null){if(l){if(n0(a,r.key))return;try{Rn(r.key,wi(r.key),a)}catch{}}else Fu(r.key,a,wi(r.key));s.setValue(On(r.key,a))}}});Dt({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=On(r.key,n);s.setValue(l)}}),Dt({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=On(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Dt({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==v())return;let l=On(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function hx(e){let t=v();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!It||It.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}It.forEach(n=>{let o=Zn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=ac(t,n.id),s=nn("Level",Pt(n.id),(u,{setValue:d})=>{let f=Number(u);if(u instanceof c&&(f=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(f)||f<0)return;f>n.maxLevel&&(f=n.maxLevel),f=Math.floor(f);let p=Pt(n.id);hr(n.id,f),Ze(),p!==f&&Je(`Modified Node ${n.id} Level (The Cove) ${p} \u2192 ${f}`),d(f)},{storageKey:i});Dt({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===v()&&s.setValue(Pt(n.id))}}),r.appendChild(s.row);let l=lc(t,n.id),a=nn("Current RP",ro(n.id),(u,{setValue:d})=>{let f;try{f=u instanceof c?u:c.fromAny(u),f.isNegative&&f.isNegative()&&(f=c.fromInt(0))}catch{d(ro(n.id));return}let p=ro(n.id);Qi(n.id,f),Ze(),kt(p,f)||Je(`Modified Node ${n.id} RP (The Cove) ${J(p)} \u2192 ${J(f)}`),d(f)},{storageKey:l});Dt({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===v()&&a.setValue(ro(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function gx(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Kl(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>Rf(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>hm(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>ws(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>mr(n)}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>jp(n,o,r)}]}].forEach(n=>{let o=Zn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=nx({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function yx(e){if(e.innerHTML="",v()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}bl(),Pu().forEach(o=>{let r=Zn(o.title,i=>{let s=Zn("Currencies",g=>{ox(g,o)}),l=Zn("Stats",g=>{rx(g,o)}),a=Zn("Multipliers",g=>{let m=Zn("Currencies",h=>{ix(h,o)}),y=Zn("Stats",h=>{mx(h,o)});g.appendChild(m),g.appendChild(y)}),u=Zn("Upgrades",g=>{Xv(g,o)}),d=null,f=null;o.key===xe.STARTER_COVE&&(d=Zn("Automation Upgrades",g=>{Xv(g,{key:xe.AUTOMATION,title:"Automation"})}),f=Zn("Lab Nodes",g=>{hx(g)}));let p=Zn("Calculators",g=>{gx(g)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),d&&i.appendChild(d),f&&i.appendChild(f),i.appendChild(p)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function Yv(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];return o.forEach(i=>{Ut(i).forEach(l=>{e&&Wo(i,l.id).locked||r.push({areaKey:i,upg:l})})}),al(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;Ko(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function Vv(e=!1){if(v()==null)return 0;let n=0,o=Object.values(xe),r=[];o.forEach(s=>{Ut(s).forEach(a=>{e&&Wo(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{al(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Mr(s,l.id,"0"),Ko(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function Wv(e){let t=v();if(t==null)return 0;let n=e?"1":"0",o=0,r=Ut(Ke);al(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;Ko(Ke,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(zi),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(xe).forEach(l=>{if(l===Ke)return;Ut(l).forEach(u=>{s.has(u.costType)&&(Mr(l,u.id,n),o++)})}),Mr(Ke,no,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function vx(e){e.innerHTML="";let t=v();if(t==null){let h=document.createElement("div");h.className="debug-panel-empty",h.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(h);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:h}=JE();Ze(),Je(`Completed all dialogues (${h} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:h}=QE();Ze(),Je(`Restored dialogues to unclaimed state (${h} ${h===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let h=sx();Ze(),Je(`Set all currencies to Infinity (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let h=lx();Ze(),Je(`Set all stats to Infinity (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let h=ax();Ze(),Je(`Set all currencies to 0 (${h} ${h===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let h=cx();Ze(),Je(`Set all unlocked stats to 0 (${h} ${h===1?"stat":"stats"} updated).`)}},{label:"All [UL] Upgs Maxed",onClick:()=>{let h=Yv(!0);Ze(),Je(`Maxed ${h} unlocked upgrades.`)}},{label:"All [UL] Upgs 0",onClick:()=>{let h=Vv(!0);Ze(),Je(`Reset ${h} unlocked upgrades to 0.`)}},{label:"All Upgs Maxed",onClick:()=>{let h=Yv(!1);Ze(),Je(`Maxed all ${h} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let h=Vv(!1);Ze(),Je(`Reset all ${h} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let h=Wv(!0);Ze(),Je(`Enabled automation for ${h} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let h=Wv(!1);Ze(),Je(`Disabled automation for ${h} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:h,toggles:b}=ux();Ze(),Je(`Unlocked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:h,toggles:b}=fx();Ze(),Je(`Locked all unlock-type upgrades (${h} entries) and unlock flags (${b} toggled).`)}},{label:"Wipe Action Log",onClick:()=>{a0([],t),pm(),Ze(),Je("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let h=v();if(h!=null)try{localStorage.setItem(kE(h),String(TE)),qo(!0),Ze(),Je("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let h=window.prompt("Enter amount of seconds to warp:");if(h==null)return;let b=dm(h);if(!b||typeof b.isZero=="function"&&b.isZero()||typeof b.isNegative=="function"&&b.isNegative())return;let E,L=!1;$t()?E=as(b):(E=mc(b),L=!0),si(E);let R=b.mulSmall?b.mulSmall(1e3):b.mulBigNumInteger(c.fromInt(1e3));Ir(E,R,L),Ze(),Je(`Performed OP Time Warp for ${J(b)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(h=>{let b=document.createElement("button");b.type="button",b.className="debug-panel-toggle debug-misc-button",b.textContent=h.label,b.addEventListener("click",h.onClick),o.appendChild(b)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",Pu().forEach(h=>{let b=document.createElement("optgroup");b.label=h.title||h.key,h.currencies.forEach(E=>{let L=document.createElement("option");L.value=`currency:${E.key}`,L.textContent=`${h.title||h.key} \u2192 ${E.label}`,b.appendChild(L)}),h.stats.forEach(E=>{let L=document.createElement("option");L.value=`stat:${E.key}`,L.textContent=`${h.title||h.key} \u2192 ${E.label}`,b.appendChild(L)}),s.appendChild(b)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let d=document.createElement("option");d.value="all",d.textContent="All",s.appendChild(d),s.querySelector(`option[value="${Mu}"]`)||(Mu=fl),s.value=Mu;let f=()=>dx(s.value||fl,v()),p=VE(f);s.addEventListener("change",()=>{Mu=s.value||fl,p.refresh()}),p.refresh(),r.appendChild(s),r.appendChild(p.button);let g=document.createElement("button");g.type="button",g.className="debug-panel-toggle reset-check",g.textContent="\u2705",g.addEventListener("click",()=>{let h=s.value||fl,b=f(),E=p.isLocked(),L=(R=!0)=>{let T=zE(b,()=>px(h))??{label:h,count:0};if(E&&b.forEach(F=>xi(F)),p.refresh(),Ze(),R){let{label:F,count:U}=T;Je(`Reset ${U===1?"value and multiplier":"values and multipliers"} for ${F} to defaults.`)}};L(!0),setTimeout(()=>L(!1),100)}),r.appendChild(g),e.appendChild(r);let m=document.createElement("div");m.className="debug-panel-row";let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-danger-button",y.textContent="Wipe Slot & Refresh",y.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let b=document.querySelector(".menu-root"),E=document.getElementById("game-root");b&&(b.hidden=!1,b.style.display="",b.style.visibility=""),E&&(E.hidden=!0,E.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),m.appendChild(y),e.appendChild(m)}function bx(e){e.innerHTML="";let t=v();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{$i()}catch{}let n=f0(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(ex(o))})}function p0(){if(!Ii||vl())return;Jv(),Qv(),jv=0,Zv=0;let e=document.getElementById(hl);e&&e.remove();let t=document.createElement("div");t.id=hl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>ko({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>ko()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:d,hideOnMobile:f})=>{let p=document.createElement("div");p.className="debug-panel-info-line",f&&p.classList.add("debug-panel-info-mobile-hidden"),p.textContent=d,a.appendChild(p)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(ku("Areas: main currency/stat/upgrade management for each area","debug-areas",d=>{yx(d)})),t.appendChild(ku("Unlocks: modify specific unlock flags","debug-unlocks",d=>{bx(d)})),t.appendChild(ku("Action Log: keep track of everything you do","debug-action-log",d=>{let f=document.createElement("div");f.id="action-log-entries",f.className="debug-panel-action-log",f.style.maxHeight="240px",f.style.overflowY="auto",d.appendChild(f),Ds=f,pm(),gn(()=>{Ds=null})})),t.appendChild(ku("Miscellaneous: helpful miscellaneous functions","debug-misc",d=>{vx(d)})),RE(t),document.body.appendChild(t),Nu>0)try{t.scrollTop=Nu}catch{}OE(),Si=!0}function sm(){if(!(!Ii||vl())){if(v()==null){ko();return}Si||p0()}}function ko({preserveExpansionState:e=!1}={}){Kv=e?NE():Ou();let t=document.getElementById(hl);if(t){try{Nu=t.scrollTop??0}catch{Nu=0}t.remove()}Jv(),Si=!1}function Sx(){if(!Ii||vl()||v()==null){ko();return}Si?ko({preserveExpansionState:!0}):sm()}function Ix(){ko(),rm()}function Uu(){if(!PE()){rm(),ko();return}Qv(),rm();let e=document.createElement("button");e.id=zv,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{Sx()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function wx(e){if(Ii=!!e,!Ii){Ix();return}Uu()}function Ex(e){wx(e)}var Cu,hl,zv,fl,Si,Ii,nm,Kv,Nu,Mu,jv,Zv,am,Ds,gl,qs,Au,ml,yi,Gs,qv,$s,Gv,CE,ME,om,kE,TE,em,vi,tm,bi,Ru,Hv,Hi=$e(()=>{Ct();Kt();St();Hn();xo();Eo();fn();Hc();_c();Ji();wo();so();kc();Zr();dd();ri();ni();hc();Cu="debug-panel-style",hl="debug-panel",zv="debug-panel-toggle",fl=`currency:${Ce.COINS}`,Si=!1,Ii=!1,nm=[],Kv=Ou(),Nu=0,Mu=fl,jv=0,Zv=0,am=[],Ds=null,gl=new Map,qs=new Map,Au=new Set,ml=new Map,yi=new Map,Gs=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=Gs);qv=!1,$s=null,Gv=null,CE="ccc:debug:stat-mult",ME="ccc:actionLog",om=100,kE=e=>`ccc:warp:charges:${e}`,TE=24;em="ccc:xp",vi={unlock:e=>`${em}:unlocked:${e}`,level:e=>`${em}:level:${e}`,progress:e=>`${em}:progress:${e}`},tm="ccc:mutation",bi={unlock:e=>`${tm}:unlocked:${e}`,level:e=>`${tm}:level:${e}`,progress:e=>`${tm}:progress:${e}`},Ru=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];Hv=!1;bl();o0();document.addEventListener("keydown",e=>{if(!(!Ii||vl())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&v()!=null){if(e.shiftKey){Si?(WE(),ko()):sm(),e.preventDefault();return}Si?ko({preserveExpansionState:!0}):sm(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Uu()});window.addEventListener("menu:visibilitychange",BE);window.addEventListener("saveSlot:change",()=>{Uu(),Si&&p0()})});var v0={};bt(v0,{addExternalMutationGainMultiplierProvider:()=>ii,addMutationPower:()=>us,broadcastMutationChange:()=>mm,computeMutationMultiplierForLevel:()=>ws,computeMutationRequirementForLevel:()=>hm,getMutationCoinSprite:()=>kp,getMutationGainMultiplier:()=>$u,getMutationMultiplier:()=>Du,getMutationState:()=>ct,getTotalCumulativeMp:()=>ol,initMutationSystem:()=>Wt,isMutationUnlocked:()=>Co,onMutationChange:()=>mi,setMutationUnlockedForDebug:()=>yl,unlockMutationSystem:()=>Tr});function qu(e){try{return e?.toStorage?.()}catch{return null}}function Mi(){try{Zt()}catch{}}function y0(e){let t=e;if(!t.isZero?.()){let n=Ci.size>0?Array.from(Ci):typeof wl=="function"?[wl]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof We?t=r.clone?.()??r:r!=null&&(t=We.fromAny(r))}catch{}}return t}function _x(){if(typeof gm=="function"){try{gm()}catch{}gm=null}if(typeof ym=="function"){try{ym()}catch{}ym=null}}function El(e){if(e instanceof We)try{return e.clone?.()??We.fromAny(e)}catch{return pt()}try{return We.fromAny(e??0)}catch{return pt()}}function Cx(e){if(!e||typeof e!="object")return pt();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?We.fromInt(100):We.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function Hu(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=qe(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function xm(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let d=1;if(l>10){let p=Math.pow(1.12,l-10);if(!Number.isFinite(p)||(d+=Lx*(p-1),!Number.isFinite(d)))return Number.POSITIVE_INFINITY}let f=u*d;return Number.isFinite(f)?f:Number.POSITIVE_INFINITY}let n=Hu(e);if(!Number.isFinite(n))return We.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return We.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),d=Math.pow(l/u,1/a),f=o-9;r=u*Math.pow(d,f)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return We.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return We.fromAny("Infinity");let i=Te(r);return Cx(i)}function Fr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=xm(D.level);D.requirement=n}function Mx(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=qe(e),l=qe(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Im(){return Pn.container&&Pn.container.isConnected?!0:(Pn.container=document.querySelector("[data-mp-hud].mp-counter"),Pn.container?(Pn.bar=Pn.container.querySelector(".mp-bar"),Pn.fill=Pn.container.querySelector(".mp-bar__fill"),Pn.levelValue=Pn.container.querySelector(".mp-level-value"),Pn.progress=Pn.container.querySelector("[data-mp-progress]"),!0):!1)}function Li(e){try{return J(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function tr(){if(!Im())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Pn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Li(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Li(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}Bi();return}e.removeAttribute("hidden");let i=D.requirement,s=Mx(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Li(D.level)),r){let a=Li(D.progress),u=Li(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Li(D.progress).replace(/<[^>]*>/g,""),u=Li(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}Bi()}function nr(e="update",t={}){let n=ct(),o={...n,slot:D.slot??v(),changeType:e,...t};if(Sm.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function Lm(){let e=D.slot;if(e==null&&(e=v(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(Sl(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(_i(e),D.level.toStorage())}catch{}try{localStorage.setItem(Xs(e),D.progress.toStorage())}catch{}rt(Sl(e)),rt(_i(e)),rt(Xs(e));let t=(()=>{let u=D.unlocked,d=D.level,f=D.progress;try{u=localStorage.getItem(Sl(e))==="1"}catch{}try{let p=localStorage.getItem(_i(e));p&&(d=We.fromAny(p))}catch{}try{let p=localStorage.getItem(Xs(e));p&&(f=We.fromAny(p))}catch{}return{unlocked:u,level:d,progress:f}})(),n=qu(t.level),o=qu(t.progress),r=qu(D.level),i=qu(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&Gu(t,{skipPersist:!0})}function wm(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function kx(){if(!D.unlocked)return;let e=D.slot??v();if(e!=null&&wm(_i(e))){Fr();return}Fr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(Ys()),Fr(),t=D.requirement,!t||typeof t!="object"){D.progress=pt();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=pt())}function Gu(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=El(e.level),D.progress=El(e.progress),D.unlocked||(D.level=pt(),D.progress=pt()),Fr(),t||Lm(),tr(),nr("load"),Mi()}function vm(e){let t=e??v();if(t==null){Gu({unlocked:!1,level:pt(),progress:pt()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=pt(),r=pt();try{n=localStorage.getItem(Sl(t))==="1"}catch{}try{let i=localStorage.getItem(_i(t));i&&(o=We.fromAny(i))}catch{}try{let i=localStorage.getItem(Xs(t));i&&(r=We.fromAny(i))}catch{}Gu({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function Tx(){for(;Il.length;){let e=Il.pop();try{e?.()}catch{}}}function bm(e){h0!==e&&(Tx(),h0=e,e!=null&&(Il.push(_t(Sl(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=pt(),D.progress=pt()),Fr(),tr(),nr("storage"),Mi())}})),Il.push(_t(_i(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Fr(),tr(),nr("storage"),Mi())}catch{}}})),Il.push(_t(Xs(e),{onChange(t){if(t)try{let n=We.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Fr(),tr(),nr("storage"))}catch{}}}))))}function Wt({forceReload:e=!1}={}){if(_x(),g0){let n=v();return(n!==D.slot||e)&&vm(n),bm(n),Im(),tr(),ct()}g0=!0,Im();let t=v();return D.slot=t,vm(t),bm(t),tr(),Mi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=v();D.slot=n,vm(n),bm(n),tr(),Mi(),nr("slot")}),ct()}function ct(){return{unlocked:D.unlocked,level:El(D.level),progress:El(D.progress),requirement:El(D.requirement)}}function Co(){return!!D.unlocked}function Tr(){return Wt(),D.unlocked?!1:(D.unlocked=!0,Fr(),Lm(),tr(),nr("unlock"),Mi(),!0)}function yl(e){Wt();let t=!!e;Gu({unlocked:t,level:t?D.level:pt(),progress:t?D.progress:pt()})}function us(e){Wt();let t=D.slot??v();if(t!=null&&wm(Xs(t))||!D.unlocked)return ct();let n=t!=null&&wm(_i(t));if(D.level&&D.level.isInfinite?.()){let d=D.level.clone?.()??D.level,f=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=We.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=We.fromAny("Infinity")}catch{}let p;try{p=e instanceof We?e:We.fromAny(e??0)}catch{p=pt()}return p=y0(p),p=Xn("mutation",p),nr("progress",{delta:p.clone?.()??p,levelsGained:pt(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:d.clone?.()??d,previousProgress:f.clone?.()??f})}let o;try{o=e instanceof We?e:We.fromAny(e??0)}catch{o=pt()}if(o=y0(o),o=Xn("mutation",o),o.isZero?.())return ct();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=We.fromAny("Infinity")}catch{}try{D.progress=We.fromAny("Infinity")}catch{D.progress=pt()}try{D.requirement=We.fromAny("Infinity")}catch{}}else kx();Lm(),tr();let a=D.level.sub(i);return a.isZero?.()||Mi(),nr("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function mm(e={}){Wt();let t=e.changeType??"manual";return nr(t,e)}function ws(e){let t;if(e instanceof We)try{t=e.clone?.()??e}catch{t=pt()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=pt()}else try{t=c.fromAny(e??0)}catch{t=pt()}if(t&&t.isInfinite?.())try{return We.fromAny("Infinity")}catch{return Ys()}let n=Hu(t);if(!Number.isFinite(n))try{return We.fromAny("Infinity")}catch{return Ys()}if(n<=0)return Ys();let o=n*xx;return Te(o)}function hm(e){let t;try{t=e instanceof We?e:We.fromAny(e??0)}catch{t=pt()}try{return xm(t)}catch{return pt()}}function Du(){if(Wt(),!D.unlocked)return Ys();try{return ws(D.level)}catch{return Ys()}}function $u(){let e=c.fromInt(1);if(Ci.size>0||wl){let t=Ci.size>0?Array.from(Ci):typeof wl=="function"?[wl]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof We?e=o.clone?.()??o:o!=null&&(e=We.fromAny(o))}catch{}}return e}function kp(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=Hu(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function mi(e){return typeof e!="function"?()=>{}:(Sm.add(e),()=>{Sm.delete(e)})}function ii(e){return typeof e!="function"?()=>{}:(Ci.add(e),()=>{Ci.delete(e)})}function ol(){if(Wt(),!D.unlocked)return pt();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=Hu(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=xm(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Em,Sl,_i,Xs,We,pt,Ys,xx,Lx,D,Pn,Sm,Il,h0,g0,gm,ym,Ci,wl,xo=$e(()=>{Ct();St();Hi();Kt();fn();wf();Hn();Em="ccc:mutation",Sl=e=>`${Em}:unlocked:${e}`,_i=e=>`${Em}:level:${e}`,Xs=e=>`${Em}:progress:${e}`,We=c,pt=()=>We.fromInt(0),Ys=()=>We.fromInt(1),xx=Math.log10(2),Lx=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:pt(),progress:pt(),requirement:pt(),slot:null},Pn={container:null,bar:null,fill:null,levelValue:null,progress:null},Sm=new Set,Il=[],h0=null,g0=!1,gm=null,ym=null,Ci=new Set,wl=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:Wt,unlockMutationSystem:Tr,addMutationPower:us,getMutationState:ct,getMutationMultiplier:Du,isMutationUnlocked:Co,getTotalCumulativeMp:ol,addExternalMutationGainMultiplierProvider:ii,getMutationGainMultiplier:$u}))});var xl,b0,S0,_m,Cm,Mm,I0=$e(()=>{xl=`attribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,b0='precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform vec3 uColorDeep; uniform vec3 uColorShallow; void main() { /* Wave animation settings */ float speed = 1.2; float time = uTime * speed; /* Combine sine waves for a more natural look */ /* vUv.x is 0..1 across the screen width */ float wave1 = sin(vUv.x * 8.0 - time) * 0.0285; float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; /* Define the shoreline height (baseline) */ /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */ /* We want to discard pixels below this threshold */ float threshold = 0.428 + wave; if (vUv.y < threshold) { discard; } /* Recalculate gradient based on the new "bottom" */ /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */ float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0); vec3 col = mix(uColorShallow, uColorDeep, gradientY); /* Add a subtle "foam" or highlight at the edge */ float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold); col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4); gl_FragColor = vec4(col, 1.0); }',S0="precision mediump float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution; uniform sampler2D uWaveMap; uniform vec3 uColorDeep; uniform vec3 uColorShallow; uniform vec3 uColorWaveDeep; uniform vec3 uColorWave; /* Simple noise for foam breakup */ float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123); } float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f*f*(3.0-2.0*f); return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x), mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y); } void main() { vec2 uv = vUv; /* Sample the simulation (physics) */ /* Wave Logic */ vec2 waveUV = uv - vec2(0.0, 0.0285); float intensity = texture2D(uWaveMap, waveUV).r; /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */ float shadowOffset = 8.0 / uResolution.y; float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r; /* Discard only if BOTH are empty */ if (intensity < 0.01 && shadowIntensity < 0.01) discard; /* Directional Noise: Streaky vertical noise for rushing water effect */ /* Stretch heavily along Y-axis to simulate speed/motion blur */ float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0)); /* Define Zones based on Intensity */ /* Body (Medium Intensity): Darker/turbulent blue with noise */ /* Edge (High Intensity): Bright white foam */ float foamThreshold = 0.5; float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity); /* Base Colors */ vec3 bodyColor = uColorWaveDeep; vec3 foamColor = uColorWave; /* Mix Colors */ vec3 finalColor = mix(bodyColor, foamColor, foamMix); /* Add streaks to the body part */ if (foamMix < 0.9) { finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix); } /* Hard Edge & Opacity */ /* Ensure the front (bottom) remains sharp, back trails off */ /* Calculate Alpha based on Intensity */ /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */ /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */ /* Low Intensity (Top/Tail): Fades to 0.0 */ float finalAlpha = smoothstep(0.02, 0.15, intensity); /* Screen Fade */ /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */ /* Dynamic Shoreline Fade */ /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */ /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */ float speed = 1.2; float time = uTime * speed; float wave1 = sin(uv.x * 8.0 - time) * 0.0285; float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014; float wave = wave1 + wave2; float threshold = 0.428 + wave; /* Fade out quickly after exiting the water body (below threshold) */ /* Fade starts slightly higher than the threshold to soften the transition */ /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */ float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y); float screenFade = shoreFade; /* --- Composite Shadow & Wave --- */ float waveAlpha = finalAlpha * screenFade; /* Shadow Alpha */ float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity); /* Shadow is weaker (40% opacity) */ float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade; /* Mix: Wave over Shadow */ /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */ float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha); /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */ /* Shadow is black (RGB=0), so second term is 0 */ vec3 outRGB = finalColor * waveAlpha; gl_FragColor = vec4(outRGB, outAlpha); }",_m=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,Cm=`precision mediump float;\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Mm=`precision mediump float;\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var x0={};bt(x0,{WaterSystem:()=>Xu,waterSystem:()=>Yu});function E0(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function Vs(e,t,n){let o=E0(e,e.VERTEX_SHADER,t),r=E0(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var Ax,w0,Nx,Rx,Xu,Yu,km=$e(()=>{I0();Ax=[.2,.5,.9],w0=[.2,.9,1],Nx=[1,1,1],Rx=[.45,.8,1];Xu=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:Vs(s,xl,S0),simProgram:Vs(s,xl,Mm),brushProgram:Vs(s,_m,Cm),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=Vs(this.glBg,xl,b0),this.bgSimProgram=Vs(this.glBg,xl,Mm),this.bgBrushProgram=Vs(this.glBg,_m,Cm)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,d=-(s/this.height*2-1),f=l/this.width,p=a/this.height,g=new Float32Array([u-f,d-p,0,0,1,u+f,d-p,1,0,1,u-f,d+p,0,1,1,u+f,d+p,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,g,t.DYNAMIC_DRAW);let m=t.getAttribLocation(n,"aPosition"),y=t.getAttribLocation(n,"aUv"),h=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(y),t.vertexAttribPointer(y,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let d=r;for(;d>0;){let f=Math.min(d,s);l.push(f),d-=f}}l.forEach(d=>{let f=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,d);this.bgReadFBO=f.readFBO,this.bgWriteFBO=f.writeFBO,this.bgReadTexture=f.readTex,this.bgWriteTexture=f.writeTex}),this.fgLayers.forEach(d=>{l.forEach(f=>{let p=this.runSimStep(d.gl,d.simProgram,d.quadBuffer,d.readFBO,d.writeFBO,d.readTexture,d.writeTexture,f);d.readFBO=p.readFBO,d.writeFBO=p.writeFBO,d.readTexture=p.readTex,d.writeTexture=p.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),Ax),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),w0),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(d=>{let f=d.gl;f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,d.canvas.width,d.canvas.height),f.useProgram(d.program),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,d.readTexture),f.uniform1i(f.getUniformLocation(d.program,"uWaveMap"),0),f.uniform3fv(f.getUniformLocation(d.program,"uColorShallow"),w0),f.uniform3fv(f.getUniformLocation(d.program,"uColorWave"),Nx),f.uniform3fv(f.getUniformLocation(d.program,"uColorWaveDeep"),Rx),f.uniform1f(f.getUniformLocation(d.program,"uTime"),o),f.uniform2f(f.getUniformLocation(d.program,"uResolution"),d.canvas.width,d.canvas.height),f.bindBuffer(f.ARRAY_BUFFER,d.quadBuffer);let p=f.getAttribLocation(d.program,"position");f.enableVertexAttribArray(p),f.vertexAttribPointer(p,2,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLE_STRIP,0,4)})}},Yu=new Xu});var T0={};bt(T0,{createSpawner:()=>qx});function k0(e){if(!e||typeof e!="object"){Ws=!1,ki=0n;return}Ws=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;ki=n&&n!=="Infinity"?BigInt(n):0n}catch{ki=0n}}function Px(e){let t=1-e;return 1-t*t*t}function Fx(e){if(!e)return null;let t=L0.get(e);return t||(t=new Image,t.src=e,L0.set(e,t)),t}function qx({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:d=je?Ox:1e4,initialBurst:f=1,coinTtlMs:p=1e99,waveSoundSrc:g="sounds/wave_spawn.ogg",waveSoundDesktopVolume:m=.45,waveSoundMobileVolume:y=.2,waveSoundMinIntervalMs:h=160,enableDropShadow:b=!1}={}){let E=o,L={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function R(){return!!(L.pf&&L.w&&L.c)}R()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let T=7,F=[],U=[],q=!1;if(L.c)for(let S=0;S<T;S++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+S*10}`,L.c.appendChild(k);let P=k.getContext("2d",{alpha:!0});F.push(k),U.push(P)}let x=null,B=null;L.c&&(x=document.createElement("canvas"),x.style.position="absolute",x.style.inset="0",x.style.pointerEvents="none",x.style.zIndex="100",L.c.appendChild(x),B=x.getContext("2d",{alpha:!0}));let M={collectBatch:null,getMagnetUnit:null};function _(S){M={...M,...S}}let X={pfRect:null,wRect:null,safeBottom:0,pfW:0};function Q(){if(!R())return!1;let S=L.pf.getBoundingClientRect(),k=L.w.getBoundingClientRect(),P=L.hud?L.hud.getBoundingClientRect().height:0;X={pfRect:S,wRect:k,safeBottom:S.height-P,pfW:S.width};let A=window.devicePixelRatio||1;return F.forEach((N,pe)=>{if(N){N.width=S.width*A,N.height=S.height*A,N.style.width=S.width+"px",N.style.height=S.height+"px";let de=U[pe];de&&(de.setTransform(1,0,0,1,0,0),de.scale(A,A),de.imageSmoothingEnabled=!0,de.imageSmoothingQuality="high")}}),q=!0,x&&(x.width=S.width*A,x.height=S.height*A,x.style.width=S.width+"px",x.style.height=S.height+"px",B&&(B.setTransform(1,0,0,1,0,0),B.scale(A,A))),!0}Q();let fe="ResizeObserver"in window?new ResizeObserver(()=>Q()):null;fe&&L.pf&&fe.observe(L.pf),document.addEventListener("visibilitychange",()=>{document.hidden||Q()});let K=(S,k,P)=>Math.max(k,Math.min(P,S)),ee=Math.max(2e3,d*3),ve=12,he=[],Y=[],te=0,$=[];function G(){let S=document.createElement("div");S.className="coin",S.style.position="absolute",S.style.pointerEvents="auto",S.style.borderRadius="50%",S.style.willChange="transform",S.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=E,k.style.objectFit="contain",k.style.borderRadius="50%",S.appendChild(k),b&&(S.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),S}let j=()=>he.length?he.pop():G();function le(S){S.style.transition="",S.style.transform="",S.style.opacity="1",S.classList.remove("coin--collected");for(let k=0;k<=6;k++)S.classList.remove(`coin--size-${k}`);S.style.removeProperty("--ccc-start"),delete S.dataset.dieAt,delete S.dataset.mutationLevel,delete S.dataset.collected,S.style.willChange="transform",S.parentNode&&S.remove(),he.length<ee&&he.push(S)}function ue(S,k=-1){if(S.isRemoved)return;S.isRemoved=!0;let P=k;(P===-1||Y[P]!==S)&&(S.index!==void 0&&Y[S.index]===S?P=S.index:P=Y.indexOf(S)),P!==-1&&(Y[P]=null,te++),S.el?(le(S.el),S.el=null):q=!0}function C(S){let k=S._coinObj;if(k){let P=-1;k.index!==void 0&&Y[k.index]===k?P=k.index:P=Y.indexOf(k),P!==-1&&(Y[P]=null,te++),S._coinObj=null}}let W=new URL(g,document.baseURI).href,ce=0;function me(){let S=performance.now();if(S-ce<h)return;ce=S,ft(W,{volume:je?y:m,type:"music"})}function Z(){if(!R())return null;if((!X.pfRect||!X.wRect)&&Q(),d!==1/0&&Y.length-te>=d){let xt=-1;if(ht(2))for(let Rt=0;Rt<Y.length;Rt++){let yo=Y[Rt];if(yo&&yo.sizeIndex<4){xt=Rt;break}}else for(let Rt=0;Rt<Y.length;Rt++)if(Y[Rt]){xt=Rt;break}if(xt===-1)return null;let Nt=Y[xt];Nt&&ue(Nt,xt)}let S=X.pfW,k=X.wRect.top-X.pfRect.top,P=Math.max(0,k),A=0;if(ht(2)){let xt=Math.random();for(let Nt=6;Nt>=1;Nt--)if(xt<Dx[Nt]){A=Nt;break}}A>=4&&Qa&&Qa()&&(A=3);let N=_0[A],pe=ve+(A>=3?15*(A-2):0),de=pe,ke=Math.max(de,S-N-pe),Oe=de+Math.random()*(ke-de),Pe=Math.random()*100-50,Ae;if(N>=X.pfW)Ae=(X.pfW-N)/2;else{let xt=X.pfW-N-pe;de>=xt?Ae=(X.pfW-N)/2:Ae=K(Oe+Pe,de,xt)}let De=Math.min(X.wRect.height,X.pfRect.height*.3),Me=Math.max(De+80,120),Ye=Math.max(Me+40,X.safeBottom-N-6),Ee=K(Me+Math.random()*(Ye-Me),Me,Ye),Xe={x0:Oe,y0:P,x1:Ae,y1:Ee,jitterMs:0},nt=X.pfRect.left-X.wRect.left,He=$x[A],At=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),ot=.85+Math.random()*.3,vt=At*(He.w/100)*ot,Xt=At*(He.h/100)*ot,Yt=Oe+N/2+nt,Bn=P-k;return{wave:{x:Yt,y:Bn,width:vt,height:Xt},coin:Xe,sizeIndex:A}}function re(S){if(!S.length||!R())return;let k=document.createDocumentFragment(),P=[],A=performance.now(),N=!1;for(let{wave:pe,coin:de,sizeIndex:ke}of S){if(pe&&(N=!0,Yu)){let Ye=ke>=4;Yu.addWave(pe.x,pe.y,pe.width,pe.height,Ye)}let Oe=_0[ke],Pe=1;if(ht(8)){let Ye=Ft(),Ee=Math.pow(25,Ye);Pe=Math.pow(Ee,ke)}else Pe=Ux[ke];let Ae=ke>=4,De=j();De.style.width=`${Oe}px`,De.style.height=`${Oe}px`,De.className=`coin coin--size-${ke}`,De.firstChild&&(De.firstChild.src=E),De.style.transform=`translate3d(${de.x0}px, ${de.y0}px, 0) rotate(-10deg) scale(0.96)`,De.style.opacity="0",Ws?De.dataset.mutationLevel=ki.toString():De.dataset.mutationLevel="0";let Me={mutationLevel:Ws?ki.toString():"0",el:De,src:E,x:de.x0,y:de.y0,rot:-10,scale:.96,startX:de.x0,startY:de.y0,endX:de.x1,endY:de.y1,startTime:A+de.jitterMs,duration:i,dieAt:A+p,jitterMs:de.jitterMs,isRemoved:!1,settled:!1,size:Oe,sizeIndex:ke,valueMultiplier:Pe,forceDom:Ae,soundSrc:M0[ke]?`sounds/coin_pickup${M0[ke]}`:null,bMinX:Math.min(de.x0,de.x1)-Oe,bMaxX:Math.max(de.x0,de.x1)+Oe,bMinY:Math.min(de.y0,de.y1)-Oe,bMaxY:Math.max(de.y0,de.y1)+Oe};De._coinObj=Me,Me.index=Y.length,Y.push(Me),P.push(Me),k.appendChild(De)}L.c.appendChild(k),P.length>0&&requestAnimationFrame(()=>{for(let pe of P)pe.el&&(pe.el.style.transition=`transform ${i}ms ${Bx} ${pe.jitterMs}ms`,pe.el.style.transform=`translate3d(${pe.endX}px, ${pe.endY}px, 0) rotate(0deg) scale(1)`,pe.el.style.opacity="1")}),N&&requestAnimationFrame(()=>{me()})}function ye(S=1){if(!R())return;(!X.pfRect||!X.wRect)&&Q();let k=[];for(let P=0;P<S;P++){let A=Z();A&&k.push(A)}k.length&&re(k)}function Le(S,k){if(S.settled||S.isRemoved)return{x:S.x,y:S.y,rot:0,scale:1};let P=k-S.startTime;if(P<0)return{x:S.startX,y:S.startY,rot:-10,scale:.96};let A=P/S.duration;if(A>=1)return{x:S.endX,y:S.endY,rot:0,scale:1};let N=Px(A),pe=S.startX+(S.endX-S.startX)*N,de=S.startY+(S.endY-S.startY)*N,ke=-10+10*N,Oe=.96+.04*N;return{x:pe,y:de,rot:ke,scale:Oe}}function ie(S,k){let P=Fx(k.src);if(P&&P.complete&&P.naturalWidth>0){let A=k.size||r;S.drawImage(P,k.x,k.y,A,A)}}function Se(){if(U.length){if(q){U.forEach((k,P)=>{F[P]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,F[P].width,F[P].height),k.restore(),b&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let S=Y.length;for(let k=0;k<S;k++){let P=Y[k];if(P&&P&&P.settled&&!P.isRemoved&&!P.el){let A=P.sizeIndex||0;U[A]&&ie(U[A],P)}}b&&U.forEach(k=>k.restore()),q=!1,$.length=0}else if($.length>0){b&&U.forEach(S=>{S.save(),S.shadowColor="rgba(0,0,0,0.35)",S.shadowBlur=2,S.shadowOffsetY=2});for(let S=0;S<$.length;S++){let k=$[S];if(!k.isRemoved&&k.settled&&!k.el){let P=k.sizeIndex||0;U[P]&&ie(U[P],k)}}b&&U.forEach(S=>S.restore()),$.length=0}}}let Ne=a,_e=null,Re=performance.now(),se=0;function ne(S){(!X.pfRect||!X.wRect)&&Q();let k=(S-Re)/1e3;Re=S,k>.1&&(k=.1);for(let A=Y.length-1;A>=0;A--){let N=Y[A];if(!N||!N)continue;if(S>=N.dieAt){ue(N,A);continue}if(N.sizeIndex===5&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval)){N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100;for(let ke=0;ke<3;ke++)Ao(N,S)}if(N.sizeIndex===6&&!N.isRemoved&&(N.lastLightningTime||(N.lastLightningTime=S-1e3,N.nextLightningInterval=0),S-N.lastLightningTime>N.nextLightningInterval&&(N.lastLightningTime=S,N.nextLightningInterval=200+Math.random()*100,M.collectBatch))){let ke=Le(N,S),Oe=ke.x+N.size/2,Pe=ke.y+N.size/2,Ae=[],De=N.size/2*(N.size/2),Me=Y.length;for(let Ye=0;Ye<Me;Ye++){let Ee=Y[Ye];if(!Ee||Ee===N||Ee.isRemoved||Ee.settled===!1||Ee.sizeIndex>3)continue;let ze=Ee.x+(Ee.size||r)/2,Xe=Ee.y+(Ee.size||r)/2,nt=ze-Oe,He=Xe-Pe;nt*nt+He*He>De&&Ae.push(Ee)}if(Ae.length>0){for(let Xe=Ae.length-1;Xe>0;Xe--){let nt=Math.floor(Math.random()*(Xe+1));[Ae[Xe],Ae[nt]]=[Ae[nt],Ae[Xe]]}let Ye=Ae.slice(0,3),Ee=[],ze=!1;for(let Xe of Ye){let nt=Xe.size||r,He=Xe.x+nt/2,At=Xe.y+nt/2;No(N,He,At),rr(He,At,nt),Ee.push({coin:Xe}),ze||(ft("sounds/lightning_strike.ogg",{volume:.25}),ze=!0)}Ee.length>0&&M.collectBatch(Ee)}}if(N.settled)continue;let pe=S-N.startTime;if(pe<0)continue;if(pe/N.duration>=1){N.settled=!0,N.x=N.endX,N.y=N.endY,N.rot=0,N.scale=1,N.el&&!N.forceDom?(le(N.el),N.el=null,$.push(N)):N.el&&(N.el.style.transition="none",N.el.style.transform=`translate3d(${N.x}px, ${N.y}px, 0) rotate(0deg) scale(1)`);continue}}se+=Ne*k;let P=Math.floor(se);if(P>0){se-=P;let A=Math.min(P,u);if(A>0){let N=performance.now(),pe=[],de=5;for(let ke=0;ke<A&&!(performance.now()-N>de);ke++){let Oe=Z();Oe&&pe.push(Oe)}pe.length&&re(pe)}}if(Se(),te>50){let A=0;for(let N=0;N<Y.length;N++){let pe=Y[N];pe!==null&&(pe.index=A,Y[A++]=pe)}Y.length=A,te=0}ir(k),_e=requestAnimationFrame(ne)}function Ie(){if(!_e){if(!R()){console.warn("[Spawner] start() called but required nodes are missing.");return}Q(),f>0&&_e===null&&ye(f),Re=performance.now(),_e=requestAnimationFrame(ne)}}function w(){_e&&(cancelAnimationFrame(_e),_e=null)}function V(S){Ne=Math.max(0,Number(S)||0)}function z(){se=0,Re=performance.now()}function oe(S){let k=ht(2)&&!!S;for(let P=Y.length-1;P>=0;P--){let A=Y[P];if(A&&A){if(k&&A.sizeIndex>=4){A.mutationLevel=Ws?ki.toString():"0",A.el&&(A.el.dataset.mutationLevel=A.mutationLevel);continue}ue(Y[P],P)}}z()}function ge(S){S&&(E=S)}function ae(S){let k=S._coinObj;if(!k)return S.style.transform||"translate3d(0,0,0)";let{x:P,y:A,rot:N,scale:pe}=Le(k,performance.now());return`translate3d(${P}px, ${A}px, 0) rotate(${N}deg) scale(${pe})`}function Ge(S){if(S.el)return S.el;if(S.isRemoved)return null;let k=j(),P=S.size||r;return k.style.width=`${P}px`,k.style.height=`${P}px`,k.className=`coin coin--size-${S.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${S.x}px, ${S.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=S.src),k.style.opacity="1",k.dataset.mutationLevel=S.mutationLevel,k._coinObj=S,S.el=k,L.c.appendChild(k),q=!0,k}function tt(S,k,P,A){let N=P;A&&(N=Math.max(P,260));let pe=P*P,de=[],ke=Y.length,Oe=S-N,Pe=S+N,Ae=k-N,De=k+N,Me=performance.now();for(let Ye=0;Ye<ke;Ye++){let Ee=Y[Ye];if(!Ee||Ee.bMaxX<Oe||Ee.bMinX>Pe||Ee.bMaxY<Ae||Ee.bMinY>De)continue;let ze=Ee.size||r,Xe,nt;if(Ee.settled)Xe=Ee.x+ze/2,nt=Ee.y+ze/2;else{let vt=Le(Ee,Me);Xe=vt.x+ze/2,nt=vt.y+ze/2}if(Xe<Oe||Xe>Pe||nt<Ae||nt>De)continue;let He=Xe-S,At=nt-k,ot=pe;if(A&&(Ee.sizeIndex||0)>0){let vt=ze/2;ot=vt*vt}He*He+At*At<=ot&&(Ee.isRemoved||de.push(Ee))}return de}function be(S,k,P,A,N,pe){let de=N;pe&&(de=Math.max(N,260));let ke=N*N,Oe=[],Pe=Y.length,Ae=Math.min(S,P)-de,De=Math.max(S,P)+de,Me=Math.min(k,A)-de,Ye=Math.max(k,A)+de,Ee=P-S,ze=A-k,Xe=Ee*Ee+ze*ze,nt=ke*Xe,He=performance.now();for(let At=0;At<Pe;At++){let ot=Y[At];if(!ot||ot.bMaxX<Ae||ot.bMinX>De||ot.bMaxY<Me||ot.bMinY>Ye)continue;let vt=ot.size||r,Xt,Yt;if(ot.settled)Xt=ot.x+vt/2,Yt=ot.y+vt/2;else{let an=Le(ot,He);Xt=an.x+vt/2,Yt=an.y+vt/2}if(Xt<Ae||Xt>De||Yt<Me||Yt>Ye)continue;let Bn=Xt-S,xt=Yt-k,Nt=Bn*Ee+xt*ze,Rt=ke;if(pe&&(ot.sizeIndex||0)>0){let an=vt/2;Rt=an*an}let yo=!1;if(Nt<=0)Bn*Bn+xt*xt<=Rt&&(yo=!0);else if(Nt>=Xe){let an=Xt-P,na=Yt-A;an*an+na*na<=Rt&&(yo=!0)}else{let an=Bn*ze-xt*Ee;an*an<=Rt*Xe&&(yo=!0)}yo&&!ot.isRemoved&&Oe.push(ot)}return Oe}function Be(S){ue(S)}function Ht(S,k,P){let A=P*P,N=[],pe=Y.length,de=S-P,ke=S+P,Oe=k-P,Pe=k+P,Ae=performance.now();for(let De=0;De<pe;De++){let Me=Y[De];if(!Me||Me.bMaxX<de||Me.bMinX>ke||Me.bMaxY<Oe||Me.bMinY>Pe)continue;let Ye=Me.size||r,Ee,ze;if(Me.settled)Ee=Me.x+Ye/2,ze=Me.y+Ye/2;else{let He=Le(Me,Ae);Ee=He.x+Ye/2,ze=He.y+Ye/2}if(Ee<de||Ee>ke||ze<Oe||ze>Pe)continue;let Xe=Ee-S,nt=ze-k;Xe*Xe+nt*nt<=A&&(!Me.el&&!Me.isRemoved&&Ge(Me),Me.el&&N.push(Me.el))}return N}function at(S,k,P,A,N){let pe=N*N,de=[],ke=Y.length,Oe=Math.min(S,P)-N,Pe=Math.max(S,P)+N,Ae=Math.min(k,A)-N,De=Math.max(k,A)+N,Me=P-S,Ye=A-k,Ee=Me*Me+Ye*Ye,ze=pe*Ee,Xe=performance.now();for(let nt=0;nt<ke;nt++){let He=Y[nt];if(!He||He.bMaxX<Oe||He.bMinX>Pe||He.bMaxY<Ae||He.bMinY>De)continue;let At=He.size||r,ot,vt;if(He.settled)ot=He.x+At/2,vt=He.y+At/2;else{let Nt=Le(He,Xe);ot=Nt.x+At/2,vt=Nt.y+At/2}if(ot<Oe||ot>Pe||vt<Ae||vt>De)continue;let Xt=ot-S,Yt=vt-k,Bn=Xt*Me+Yt*Ye,xt=!1;if(Bn<=0)Xt*Xt+Yt*Yt<=pe&&(xt=!0);else if(Bn>=Ee){let Nt=ot-P,Rt=vt-A;Nt*Nt+Rt*Rt<=pe&&(xt=!0)}else{let Nt=Xt*Ye-Yt*Me;Nt*Nt<=ze&&(xt=!0)}xt&&(!He.el&&!He.isRemoved&&Ge(He),He.el&&de.push(He.el))}return de}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;_e||Ie()}});function sn(){R()&&ye(1)}let Tt=[],yn=[];function go(S,k){if(!S||!k)return;let P=S.size||r,A=k.size||r,N=S.x+P/2,pe=S.y+P/2,de=k.x+A/2,ke=k.y+A/2;Tt.push({x1:N,y1:pe,x2:de,y2:ke,age:0,life:.15})}function rr(S,k,P){if(!L.pf)return;let A=document.createElement("div");A.className="coin-stain";let N=P*1.2;A.style.width=`${N}px`,A.style.height=`${N}px`,A.style.left=`${S-N/2}px`,A.style.top=`${k-N/2}px`,L.pf.appendChild(A),setTimeout(()=>{A.style.opacity="0",setTimeout(()=>{A.parentNode&&A.remove()},1e3)},2500)}function Ao(S,k){let P=Math.random()*Math.PI*2,A=(S.size||r)/2,N=A*C0,pe=Math.cos(P)*N,de=Math.sin(P)*N,ke=A*(.7+Math.random()*.6),Oe=Math.cos(P)*(N+ke),Pe=Math.sin(P)*(N+ke);Tt.push({parentCoin:S,relX1:pe,relY1:de,relX2:Oe,relY2:Pe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let Ae=3+Math.floor(Math.random()*3);for(let De=0;De<Ae;De++){let Me=.3+Math.random()*.5,Ye=pe+(Oe-pe)*Me,Ee=de+(Pe-de)*Me,ze=P+(Math.random()*1.2-.6),Xe=ke*(.4+Math.random()*.4),nt=Ye+Math.cos(ze)*Xe,He=Ee+Math.sin(ze)*Xe;Tt.push({parentCoin:S,relX1:Ye,relY1:Ee,relX2:nt,relY2:He,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}ft("sounds/lightning_zap.ogg",{volume:.25})}function No(S,k,P){if(!S)return;let A=S.size||r,N=performance.now(),pe=Le(S,N),de=pe.x+A/2,ke=pe.y+A/2,Oe=k-de,Pe=P-ke,Ae=Math.atan2(Pe,Oe),De=Math.sqrt(Oe*Oe+Pe*Pe),Me=A/2*C0,Ye=Math.cos(Ae)*Me,Ee=Math.sin(Ae)*Me;Tt.push({parentCoin:S,relX1:Ye,relY1:Ee,x2:k,y2:P,age:0,life:.25,width:6,jaggedScale:25});let ze=de+Ye,Xe=ke+Ee,nt=6+Math.floor(Math.random()*5);for(let He=0;He<nt;He++){let At=.1+Math.random()*.8,ot=ze+(k-ze)*At,vt=Xe+(P-Xe)*At,Xt=Ae+(Math.random()*1.6-.8),Yt=De*(.1+Math.random()*.3),Bn=ot+Math.cos(Xt)*Yt,xt=vt+Math.sin(Xt)*Yt;if(Tt.push({x1:ot,y1:vt,x2:Bn,y2:xt,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Rt=ot+(Bn-ot)*.5,yo=vt+(xt-vt)*.5,an=Xt+(Math.random()*1-.5),na=Yt*.5;Tt.push({x1:Rt,y1:yo,x2:Rt+Math.cos(an)*na,y2:yo+Math.sin(an)*na,age:0,life:.25,width:1.5,jaggedScale:10})}}}function ir(S){if(!B||!x)return;B.clearRect(0,0,x.width,x.height);let k=performance.now();B.lineCap="round",B.lineJoin="round";for(let P=Tt.length-1;P>=0;P--){let A=Tt[P];if(A.age+=S,A.age>=A.life){Tt.splice(P,1);continue}let N=A.x1,pe=A.y1,de=A.x2,ke=A.y2;if(A.parentCoin){let Ae=Le(A.parentCoin,k),De=Ae.x+(A.parentCoin.size||r)/2,Me=Ae.y+(A.parentCoin.size||r)/2;N=De+A.relX1,pe=Me+A.relY1,A.relX2!==void 0&&(de=De+A.relX2,ke=Me+A.relY2)}let Oe=1-A.age/A.life;B.strokeStyle=`rgba(200, 240, 255, ${Oe})`,B.lineWidth=A.width||3,B.shadowColor="rgba(220, 245, 255, 0.9)",B.shadowBlur=20;let Pe=6;B.beginPath(),B.moveTo(N,pe);for(let Ae=1;Ae<=Pe;Ae++){let De=Ae/Pe,Me=N+(de-N)*De,Ye=pe+(ke-pe)*De;if(Ae===Pe)B.lineTo(de,ke);else{let Ee=-(ke-pe),ze=de-N,Xe=Math.sqrt(Ee*Ee+ze*ze),nt=A.jaggedScale||40;if(Xe>0){let He=(Math.random()-.5)*nt*(1-Math.abs(De-.5));B.lineTo(Me+Ee/Xe*He,Ye+ze/Xe*He)}else B.lineTo(Me,Ye)}}B.stroke(),B.shadowBlur=0}for(let P=yn.length-1;P>=0;P--){let A=yn[P];if(A.age+=S,A.age>=A.life){yn.splice(P,1);continue}A.x+=A.vx*S,A.y+=A.vy*S;let N=1-A.age/A.life;B.fillStyle=A.color,B.globalAlpha=N,B.beginPath(),B.arc(A.x,A.y,A.size,0,Math.PI*2),B.fill(),B.globalAlpha=1}}return{start:Ie,stop:w,setRate:V,clearBacklog:z,clearPlayfield:oe,setCoinSprite:ge,getCoinTransform:ae,findCoinsInRadius:Ht,findCoinsInPath:at,findCoinTargetsInRadius:tt,findCoinTargetsInPath:be,ensureCoinVisual:Ge,removeCoinTarget:Be,detachCoin:C,recycleCoin:le,playEntranceWave:sn,setDependencies:_,hasBigCoins:()=>ht(2)&&Y.some(S=>S&&S.sizeIndex>=4)}}var Ws,ki,Ox,L0,Bx,_0,C0,Ux,Dx,M0,$x,A0=$e(()=>{Gl();xo();Eo();so();Fn();km();wo();Ws=!1,ki=0n,Ox=2500,L0=new Map;try{k0(ct())}catch{Ws=!1,ki=0n}try{mi(e=>{k0(e)})}catch{}Bx="cubic-bezier(0.215, 0.61, 0.355, 1)";_0=[40,55,80,125,200,320,512],C0=.78,Ux=[1,25,625,15625,390625,9765625,244140625],Dx=[0,.1,.01,.001,1e-4,1e-5,1e-6],M0=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],$x=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var D0={};bt(D0,{afterSlotWrite:()=>Om,beforeSlotWrite:()=>Rm});function B0(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Yx(e,t=Hx){!e||e<=0||Ll.set(e,B0()+t)}function R0(e){if(!e||e<=0)return!1;let t=Ll.get(e);return t==null?!1:t<=B0()?(Ll.delete(e),!1):!0}function Vx(){Ll.clear()}function Wu(){try{return typeof localStorage<"u"}catch{return!1}}function Nm(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function F0(e){let t=new Map;if(!Wu())return _l.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(Oi))continue;let r=Nm(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return _l.set(e,t),t}function U0(e){return!Number.isFinite(e)||e<=0?null:_l.has(e)?_l.get(e):F0(e)}function Rm(e){if(!Wu()||Vu>0)return;let t=String(e);if(!t.startsWith(Oi))return;let n=Nm(t);if(n==null)return;let o=U0(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(Vu===0){Vu+=1;try{vn(n)}finally{Vu-=1}}F0(n);return}}}catch{}}function Om(e,t){let n=String(e);if(!n.startsWith(Oi))return;let o=Nm(n);if(o==null)return;let r=U0(o)||new Map;r.set(n,String(t??"")),_l.set(o,r)}function Wx(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function zx(){let e=new Map;if(!Wu())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(Oi))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=hf(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function Kx(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=v();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function jx(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=gf(e);if(n.length===0){o&&(R0(e)||vn(e),Fl(e,null));return}let r=Wx(n);o&&r!==o&&!R0(e)&&vn(e),r!==o&&Fl(e,r)}function Ks(){if(!Wu())return;let e=zx();Kx(e).forEach(n=>{let o=e.get(n)??[];jx(n,o)})}function Zx(){if(Tm!=null)return;Tm=(typeof window<"u"?window:globalThis).setTimeout(()=>{Tm=null,Ks()},Xx)}function Jx(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){Yx(o),Zx();return}Ll.delete(o),Ks()}}function Qx(){typeof window>"u"||N0==null&&(N0=window.setInterval(Ks,Gx))}function eL(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function zs(){let e=eL();if(!e)return;if(!Pi()){(e.dataset.poopShopApplied===Am||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==O0||e.dataset.poopShopApplied!==Am)&&(e.style.backgroundImage=O0,e.dataset.poopShopApplied=Am)}function tL(){typeof window>"u"||P0==null&&(zs(),P0=window.setInterval(zs,50),window.addEventListener("saveSlot:change",zs),window.addEventListener("saveSlot:modified",e=>{try{let t=v();e?.detail?.slot===t&&zs()}catch{zs()}}))}function nL(){typeof window>"u"||(Ks(),Qx(),tL(),window.addEventListener("saveSlot:change",()=>Ks()),window.addEventListener("saveIntegrity:storageMutation",Jx,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(Vx(),Ks(),zs())}))}var Gx,Hx,Xx,N0,Tm,Ll,_l,Vu,O0,Am,P0,Pm=$e(()=>{St();Gx=1e4,Hx=750,Xx=50,N0=null,Tm=null,Ll=new Map;_l=new Map,Vu=0;O0="linear-gradient(180deg,#a9793d,#7b5534)",Am="1",P0=null;nL()});var K0={};bt(K0,{initPopups:()=>aL,teardownpopups:()=>lL});function Bm(){return ho||(ho=document.createElement("div"),ho.className="currency-popups",ho.setAttribute("aria-live","polite"),ho.setAttribute("aria-atomic","false"),document.body.appendChild(ho),ho)}function Ti(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function Fm(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function q0(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):J(n);t&&(t.innerHTML=r)}function rL(e,t=G0){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{Cl.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function iL(e,t,n){Bm();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function Um(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=v();if(o!=null){if(["xp"].includes(e)){if(ln(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(ln(`ccc:mutation:progress:${o}`))return}else if(Object.values(Ce).includes(e)&&Un(e,o))return}let r=oL[e],i=Object.assign({duration:G0,accumulate:!0},r||{},n);if(!i.icon)return;let s=Ti(t);if(!s||Fm(s))return;let l=i.accumulate!==!1?Cl.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,q0(l);return}let a=iL(e,i,s);a.meta=i,q0(a),Cl.set(e,a);let u=Bm(),d=$0.indexOf(e),f=null;if(d>=0){let p=Array.from(u.children);for(let g of p){let m=g.dataset.type;if($0.indexOf(m)>d){f=g;break}}}f?u.insertBefore(a.element,f):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),rL(a,i.duration)}function sL(){let e={};for(let t of Object.values(Ce))e[t]=la(t);return e}function H0(){try{let e=sL();Object.entries(e).forEach(([t,n])=>{let o=Ti(n)||c.fromInt(0);Ur.set(t,o.clone?.()??o)}),Ur.has("mp")||Ur.set("mp",c.fromInt(0))}catch{Ur.clear()}}function X0(){Cl.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),Cl.clear()}function Y0(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Ti(t.value)||c.fromInt(0),r=Ur.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Ti(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&Um(n,s),Ur.set(n,o.clone?.()??o)}function V0(e){let t=e?.detail;if(!t)return;let n=Ti(t.xpAdded);n&&!Fm(n)&&Um("xp",n)}function W0(e){let t=e?.detail;if(!t)return;let n=Ti(t.delta);n&&!Fm(n)&&Um("mp",n);let o=Ti(t.progress);o&&Ur.set("mp",o.clone?.()??o)}function z0(){X0(),H0()}function aL(){zu||(zu=!0,Bm(),H0(),window.addEventListener("currency:change",Y0),window.addEventListener("xp:change",V0),window.addEventListener("mutation:change",W0),window.addEventListener("saveSlot:change",z0))}function lL(){zu&&(window.removeEventListener("currency:change",Y0),window.removeEventListener("xp:change",V0),window.removeEventListener("mutation:change",W0),window.removeEventListener("saveSlot:change",z0),X0(),Ur.clear(),ho&&ho.remove(),ho=null,zu=!1)}var G0,$0,oL,ho,zu,Ur,Cl,j0=$e(()=>{Ct();Kt();St();G0=6767,$0=["coins","xp","books","gold","mp","magic","gears","dna"],oL={[Ce.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Ce.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Ce.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Ce.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Ce.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Ce.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},ho=null,zu=!1,Ur=new Map,Cl=new Map});var rb={};bt(rb,{flushBackupSnapshot:()=>ob,getSuspendMetadata:()=>LL,installSuspendSafeguards:()=>xL,markProgressDirty:()=>To,restoreFromBackupIfNeeded:()=>EL});function Ml(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function ea(){if(typeof localStorage>"u")return!1;try{let e=`${Qn}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function eb(){if(!Ml())throw new Error("IndexedDB unavailable");return js||(js=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(cL,uL);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(Qs)||r.createObjectStore(Qs)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}js=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw js=null,e}),js)}function mL(){if(!ea())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(Qn))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function hL(e){try{let t=await eb();return await new Promise((n,o)=>{let r=!1,i=t.transaction(Qs,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(Qs).put(e,Q0);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function gL(){try{let e=await eb();return await new Promise((t,n)=>{let o=!1,r=e.transaction(Qs,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(Qs).get(Q0);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function yL(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function Dm(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function vL(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function SL(e){return!(typeof e!="string"||e.length===0||bL.test(e))}function $m(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(Qn)||n.startsWith(fL)||n.startsWith(dL))return;let o=vL(n);if(o!=null)try{let r={key:n,slot:o,trusted:SL(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function IL(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=Dm(),a=String(i),u=this===localStorage&&a.startsWith(Qn);if(u)try{Rm(a)}catch{}let d;try{d=t.apply(this,arguments)}finally{try{if(u){To("setItem");try{Om(a,s)}catch{}}this===localStorage&&a.startsWith(Qn)&&$m(a,l)}catch{}}return d}),typeof n=="function"&&(e.removeItem=function(i){let s=Dm(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(Qn)&&(To("removeItem"),$m(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=Dm(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(To("clear"),$m(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function tb(e="idle"){Js=e||Js,Dr=!0,!Zs&&(Zs=setTimeout(()=>{if(Zs=null,!Dr)return;let t=Js;Dr=!1,ob(t)},pL))}function nb(){Zs&&(clearTimeout(Zs),Zs=null)}function To(e="dirty"){try{tb(e)}catch{}}async function qm(e="manual"){if(!ea()||!Ml())return!1;let t=mL();if(!t)return!1;t.reason=e,ju=!1;let n=await hL(t);return n||(Dr=!0,tb("retry")),n}async function ob(e="manual",{immediate:t=!1}={}){return!ea()||!Ml()?!1:t?(nb(),Dr=!1,ju=!0,qm(e)):(Dr=!0,Js=e||Js,qm(e))}function Ku(e){!Ml()||!ea()||(nb(),Dr=!1,ju=!0,qm(e))}function wL(){if(!ea())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(Qn))return!0}}catch{}return!1}async function EL(){if(J0||(J0=!0,!ea()||!Ml()))return!1;let e=!1;try{if(!wL())e=!0;else{let o=localStorage.getItem(`${Qn}saveSlot`);if(o){let r=`${Qn}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await gL();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&To("restored"),n}function xL(){if(Z0||(Z0=!0,typeof window>"u"))return;yL(),IL();let e=()=>{document.hidden?Ku("visibility-hidden"):To("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>Ku("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>Ku("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>Ku("freeze"))}catch{}try{window.addEventListener("pageshow",()=>To("pageshow"))}catch{}try{window.addEventListener("focus",()=>To("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(Qn)||To("storage-event"))})}catch{}To("boot")}function LL(){return{pendingImmediateFlush:ju,dirty:Dr,lastDirtyReason:Js}}var Qn,cL,uL,Qs,Q0,fL,dL,pL,js,Zs,Dr,Js,Z0,J0,ju,bL,ib=$e(()=>{Pm();Qn="ccc:",cL="ccc:safety",uL=1,Qs="snapshots",Q0="latest",fL=`${Qn}slotSig`,dL=`${Qn}slotMod`,pL=1e3,js=null,Zs=null,Dr=!1,Js="init",Z0=!1,J0=!1,ju=!1;bL=/\bat <anonymous>:\d+:\d+\b/});var sb={};bt(sb,{initGlobalOverlayEsc:()=>ML});function CL(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i}of _L){let s=document.querySelectorAll(o);if(s.length>0){if(i){t=!0;continue}let a=s[s.length-1].querySelector(r||".shop-close");a&&(a.click(),n=!0)}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function ML(){window.addEventListener("keydown",CL,!0)}var _L,ab=$e(()=>{_L=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".automation-shop-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close"}]});var lb={};bt(lb,{ensureGameDom:()=>kL});function kL(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var cb=$e(()=>{});function NL(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function RL(){if(!je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function PL(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let d=document.createElement("div");d.textContent=je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(d.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),d.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),d.textContent="Loading skipped",d.style.textDecoration="none",d.style.cursor="default",t())}),o.appendChild(d)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function BL(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function FL(e){if(!e||e.__done)return;e.__done=!0;let t=500;e.__label&&(e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(()=>{e.style.opacity="0";let n=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,450)},t)}async function Ym(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function UL(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function DL(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Fn(),Al));await o(n)}catch{}try{t?.(n)}catch{}return n})}function $L(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function qL({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...UL(e,s),...DL(t,s),...n?$L(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function GL(e){if(ta===e)return;rn&&(rn.stop(),rn=null),ta=e;let t=document.querySelector(".menu-root");switch(e){case or.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{ta===or.STARTER_COVE&&(rn=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}))},25)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof Jm=="function"&&Jm(n,80),Ai){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(Ai.init("water-background",i),Ju){try{Ju()}catch{}Ju=null}if(Qu){try{Qu()}catch{}Qu=null}typeof jm=="function"&&(Ju=jm(s=>Ai.update(s))),typeof Zm=="function"&&(Qu=Zm((s,l)=>Ai.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,Ai&&requestAnimationFrame(()=>Ai.resize()),Lb()),typeof Wm=="function")try{Wm()}catch{}if(typeof zm=="function")try{zm()}catch{}if(!on){on=Eb({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=on;let i=()=>{if(!(!on||typeof on.setCoinSprite!="function"))try{on.setCoinSprite(kb?.())}catch{}};i(),Tb?.(i);let s=xb({spawner:on});on&&typeof on.setDependencies=="function"&&on.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=_b(),u=Cb(a);if(on&&u?.coinsPerSecondMult){let d=1*u.coinsPerSecondMult;if(typeof Km=="function"){let f=Km("spawnRate",d);try{f&&typeof f.toScientific=="function"?d=Number(f.toScientific(6)):d=Number(f)}catch{}}Number.isFinite(d)&&on.setRate(d)}}catch{}};if(l(),typeof Xm=="function")try{Xm()}catch{}Xm=Mb(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof Vm=="function")try{Vm()}catch{}on.start();break}case or.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),on&&on.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===or.MENU}}))}catch{}}var TL,je,ub,Eb,xb,Lb,fb,db,pb,mb,hb,gb,yb,_b,Cb,Vm,Mb,AL,vb,bb,Sb,Gm,Hm,Wm,zm,kb,Tb,Zu,Km,Ib,jm,Zm,wb,Jm,Ai,Ju,Qu,or,ta,rn,on,Xm,ef,OL,Eo=$e(()=>{Fn();TL=!0,je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia?window.matchMedia("(pointer: coarse)").matches:"ontouchstart"in window;return window.IS_MOBILE=e,e})();je&&document.documentElement.classList.add("is-mobile");Ju=null,Qu=null;RL();or={MENU:0,STARTER_COVE:1},ta=or.MENU,rn=null,on=null,Xm=null,ef=()=>new Promise(e=>requestAnimationFrame(e)),OL=async()=>{await ef(),await ef()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(G=>{e=G}),n=PL("Loading assets...",e);await ef();let{initAudio:o}=await Promise.resolve().then(()=>(Fn(),Al));o();let r=Promise.all([Promise.resolve().then(()=>(Sf(),yh)),Promise.resolve().then(()=>(A0(),T0)),Promise.resolve().then(()=>(Pa(),xy)),Promise.resolve().then(()=>(Hc(),fy)),Promise.resolve().then(()=>(St(),ph)),Promise.resolve().then(()=>(Pm(),D0)),Promise.resolve().then(()=>(fn(),$v)),Promise.resolve().then(()=>(Gl(),bh)),Promise.resolve().then(()=>(Hn(),Ph)),Promise.resolve().then(()=>(wo(),fv)),Promise.resolve().then(()=>(xo(),v0)),Promise.resolve().then(()=>(j0(),K0)),Promise.resolve().then(()=>(ib(),rb)),Promise.resolve().then(()=>(Yi(),Gh)),Promise.resolve().then(()=>(ab(),sb)),Promise.resolve().then(()=>(Hi(),m0)),Promise.resolve().then(()=>(Kr(),Xh)),Promise.resolve().then(()=>(hc(),wg)),Promise.resolve().then(()=>(Ji(),Qh)),Promise.resolve().then(()=>(kc(),Kg)),Promise.resolve().then(()=>(cb(),lb)),Promise.resolve().then(()=>(so(),mg)),Promise.resolve().then(()=>(km(),x0)),Promise.resolve().then(()=>(ri(),bg))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(G,j)=>`img/mutations/m${j+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg"],fonts:!0},s=0,l=qL(i,G=>{s=G,BL(n,G)}),[a,u,d,f,p,g,m,y,h,b,E,L,R,T,F,U,q,x,B,M,_,X,Q,fe]=await r;({initSlots:ub}=a),{createSpawner:Eb}=u,{initCoinPickup:xb}=d,{initHudButtons:Lb}=f,{bank:mb,getHasOpenedSaveSlot:hb,setHasOpenedSaveSlot:gb,ensureStorageDefaults:yb,notifyGameSessionStarted:wb}=p,{getCurrentAreaKey:_b,computeUpgradeEffects:Cb,onUpgradesChanged:Mb}=m,{registerPreloadedAudio:AL}=y,{initXpSystem:Vm}=h,{initResetSystem:Wm}=b,{initMutationSystem:zm,getMutationCoinSprite:kb,onMutationChange:Tb}=E,{initPopups:vb}=L,{installSuspendSafeguards:bb,restoreFromBackupIfNeeded:Sb,markProgressDirty:Gm,flushBackupSnapshot:Hm}=R,{installGhostTapGuard:fb,initGlobalGhostTap:db}=T,{initGlobalOverlayEsc:pb}=F,{setDebugPanelAccess:Zu,applyStatMultiplierOverride:Km}=U,{startGameLoop:Ib,registerTick:jm,registerFrame:Zm}=q;let{initOfflineTracker:K,processOfflineProgress:ee}=x,{initWorkshopSystem:ve}=B,{initAutomationEffects:he}=M;({ensureGameDom:Jm}=_);let{initSurgeEffects:Y}=X;({waterSystem:Ai}=Q);let{initLabLogic:te}=fe;window.bank=mb,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(rn){try{rn.stop()}catch{}rn=null}}),window.addEventListener("audio:restartMusic",()=>{if(rn){try{rn.stop()}catch{}rn=null}ta===or.STARTER_COVE&&(rn=ft("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",G=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return G.preventDefault(),G.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let G=document.hidden;nf(G),rn&&rn.element&&(G?rn.element.pause():rn.element.play().catch(()=>{}))}),fb?.(),db?.(),pb?.(),bb?.(),typeof Zu=="function"&&(Zu(TL),window.setDebugPanelAccess=Zu);try{await Sb?.()}catch{}await Promise.race([l,t]),await OL(),document.documentElement.classList.remove("booting"),await ef(),FL(n),await Promise.all([Ym("img/currencies/coin/coin_plus_base.webp"),Ym("img/stats/xp/xp_plus_base.webp"),Ym("img/stats/mp/mp_plus_base.webp")]);try{typeof p.clearActiveSlot=="function"?p.clearActiveSlot():p&&p.KEYS&&p.KEYS.SAVE_SLOT&&localStorage.removeItem(p.KEYS.SAVE_SLOT)}catch{}Ib(),K(()=>ta===or.STARTER_COVE);try{ve()}catch(G){console.error("Workshop init failed",G)}try{he()}catch(G){console.error("Automation init failed",G)}try{Y()}catch(G){console.error("Surge effects init failed",G)}try{te()}catch(G){console.error("Lab system init failed",G)}NL(),yb(),Gm?.("ensure-defaults"),vb();let $=document.getElementById("panel-title");if(hb()?(document.body.classList.add("has-opened"),$&&($.style.opacity="0")):$&&($.style.opacity="1"),ub(()=>{ta!==or.STARTER_COVE&&(gb(!0),document.body.classList.add("has-opened"),$&&($.style.opacity="0"),GL(or.STARTER_COVE),ee(),window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave(),wb?.(),Gm?.("slot-entered"))}),typeof window<"u"&&Hm)try{window.cccRequestBackup=()=>Hm("manual",{immediate:!0})}catch{}})});Eo();})();
