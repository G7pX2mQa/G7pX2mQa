(()=>{var wI=Object.defineProperty;var De=(e,t)=>()=>(e&&(t=e(e=0)),t);var It=(e,t)=>{for(var n in t)wI(e,n,{get:t[n],enumerable:!0})};var dc={};It(dc,{initAudio:()=>EI,loadAudio:()=>cg,playAudio:()=>pt,registerPreloadedBuffer:()=>LI,setAudioSuspended:()=>Vf,setMusicUnderwater:()=>Zr});function Xf(){if(zt)return zt;let e=window.AudioContext||window.webkitAudioContext;return e?(zt=new e,ka=zt.createGain(),ka.connect(zt.destination),ka.gain.value=1,uc=zt.createGain(),uc.gain.value=1,uc.connect(ka),Mo=zt.createBiquadFilter(),Mo.type="lowpass",Mo.frequency.value=22050,Mo.Q.value=1,Mo.connect(uc),zt):null}function EI(){Xf()}function xI(){zt&&zt.state==="suspended"&&zt.resume().catch(()=>{})}async function cg(e){let t=Xf();if(!t)return null;let n=new URL(e,document.baseURI).href;if(Aa.has(n))return Aa.get(n);if(fc.has(n))return fc.get(n);let o=(async()=>{try{let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch ${n}`);let i=await r.arrayBuffer(),s=await t.decodeAudioData(i);return Aa.set(n,s),s}catch(r){return console.warn("[audioManager] Load failed",e,r),null}finally{fc.delete(n)}})();return fc.set(n,o),o}function pt(e,{volume:t=1,detune:n=0,playbackRate:o=1,loop:r=!1,type:i="sfx"}={}){let s=Xf(),l=new URL(e,document.baseURI).href;if(s){s.state==="suspended"&&!document.hidden&&s.resume().catch(()=>{});let a=Aa.get(l);if(a){let u=s.createBufferSource();u.buffer=a,u.detune.value=n,u.playbackRate.value=o,u.loop=r;let f=s.createGain();return f.gain.value=t,u.connect(f),i==="music"?f.connect(Mo):f.connect(ka),u.start(0),{stop:()=>{try{u.stop()}catch{}},source:u,gainNode:f,element:null}}else cg(e)}try{let a=new Audio(l);return a.volume=t,typeof a.playbackRate<"u"&&(a.playbackRate=o),a.loop=r,a.play().catch(()=>{}),{stop:()=>{try{a.pause(),a.currentTime=0}catch{}},element:a}}catch(a){console.warn("[audioManager] Fallback play failed",a)}return null}function LI(e,t){let n=new URL(e,document.baseURI).href;Aa.set(n,t)}function Vf(e){zt&&(e?zt.state==="running"&&zt.suspend().catch(()=>{}):zt.state==="suspended"&&zt.resume().catch(()=>{}))}function Zr(e){if(!Mo)return;let t=e?600:22050;try{let n=zt.currentTime;Mo.frequency.cancelScheduledValues(n),Mo.frequency.setValueAtTime(t,n)}catch{Mo.frequency.value=t}}var zt,ka,uc,Mo,Aa,fc,Cn=De(()=>{zt=null,ka=null,uc=null,Mo=null,Aa=new Map,fc=new Map;typeof window<"u"&&["pointerdown","touchstart","click","keydown"].forEach(e=>{window.addEventListener(e,xI,{capture:!0,passive:!0})})});function Ee(e){if(!(e instanceof c))try{e=c.fromAny(e??0)}catch{return Number.NEGATIVE_INFINITY}if(!e||e.isZero?.())return Number.NEGATIVE_INFINITY;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;if(typeof e.sig=="bigint"){let m=Number(e.sig);if(m>0){let v=Math.log10(m),p=e.e||0,h=Number(e._eOffset||0n);return v+p+h}}let t;try{t=e.toStorage()}catch{return Number.NEGATIVE_INFINITY}let n=t.split(":"),o=n[2]??"0",r=n[3]??"0",i="0",s=r.indexOf("^");s>=0&&(i=r.slice(s+1)||"0",r=r.slice(0,s)||"0");let l=Number(r||"0"),a=Number(i||"0"),u=o.replace(/^0+/,"")||"0";if(u==="0")return Number.NEGATIVE_INFINITY;let f;if(u.length<=15){let m=Number(u);if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)}else{let m=Number(u.slice(0,15));if(!Number.isFinite(m)||m<=0)return Number.NEGATIVE_INFINITY;f=Math.log10(m)+(u.length-15)}let d=(Number.isFinite(l)?l:0)+(Number.isFinite(a)?a:0);return f+d}function ie(e){if(!Number.isFinite(e))return e>0?c.fromAny("Infinity"):c.fromInt(0);if(e<=-1e12)return c.fromInt(0);let t=c.DEFAULT_PRECISION,n=Math.floor(e),o=e-n;o<0&&(o+=1,n-=1);let r=Math.pow(10,o+(t-1)),i=BigInt(Math.max(1,Math.round(r))),s=n-(t-1);return new c(i,s,t)}function Yf(e){if(!Number.isFinite(e))return e>0?e:e===0?Math.log10(2):0;if(e>308)return e;if(e<-20)return Math.pow(10,e)/ug;let t=Math.pow(10,e);return Number.isFinite(t)?Math.log1p(t)/ug:e>0?e:0}var c,ug,xt=De(()=>{c=class e{static DEFAULT_PRECISION=18;static MAX_E=17976931348623157e292;static MAX_PLAIN_DIGITS=1e6;constructor(t,n,o=e.DEFAULT_PRECISION){if(this.p=o|0,this.sig=BigInt(t),this._eOffset=0n,n&&typeof n=="object"&&("base"in n||"offset"in n||"inf"in n)){let r=Number(n.base??0);if(!!n.inf||!Number.isFinite(r)||r>=e.MAX_E)this.e=e.MAX_E,this.inf=!0,this._eOffset=0n;else{this.e=Math.trunc(r),this.inf=!1;let s=n.offset??0;this._eOffset=typeof s=="bigint"?s:BigInt(s)}}else{let r=Number(n);!Number.isFinite(r)||r>=e.MAX_E?(this.e=e.MAX_E,this.inf=!0):(this.e=Math.trunc(r),this.inf=!1)}this.#c()}static zero(t=e.DEFAULT_PRECISION){return new e(0n,0,t)}static fromInt(t,n=e.DEFAULT_PRECISION){return new e(BigInt(t),0,n)}static fromScientific(t,n=e.DEFAULT_PRECISION){let o=String(t??"").trim();if(!o)throw new TypeError("Invalid BigNum input: "+t);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);let r=o.match(/^([+-]?\d+)(?:\.(\d+))?(?:e([+-]?\d+))?$/i);if(!r)return new e(BigInt(o),0,n);let[,i,s="",l]=r,a=l?parseInt(l,10):0;a-=s.length;let u="",f=i+s;f.startsWith("-")?(u="-",f=f.slice(1)):f.startsWith("+")&&(f=f.slice(1));let d=f.replace(/^0+/,"")||"0",m=BigInt(u+d);return new e(m,a,n)}static fromStorage(t,n=e.DEFAULT_PRECISION){if(!t)return null;if(typeof t!="string"&&(t=String(t)),t.startsWith("BN:")){let[,o,r,i]=t.split(":"),s=parseInt(o,10)||n,l=i,a=0n,u=i.indexOf("^");if(u>=0){l=i.slice(0,u);let d=i.slice(u+1)||"0";try{a=BigInt(d)}catch{a=0n}}let f=Number(l);return Number.isFinite(f)||(f=e.MAX_E),new e(BigInt(r),{base:f,offset:a},s)}return e.fromScientific(t,n)}static fromAny(t,n=e.DEFAULT_PRECISION){if(t instanceof e)return t;if(typeof t=="string"){let o=t.trim();if(o.startsWith("BN:"))return e.fromStorage(o,n);if(/^inf(?:inity)?$/i.test(o))return new e(1n,e.MAX_E,n);if(/^[+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/i.test(o))return e.fromScientific(o,n)}if(typeof t=="number")return Number.isFinite(t)?e.fromScientific(t.toString(),n):new e(1n,e.MAX_E,n);if(typeof t=="bigint")return e.fromInt(t,n);throw new TypeError("Unsupported BigNum input: "+t)}toStorage(){if(this.inf)return`BN:${this.p}:${this.sig.toString()}:${e.MAX_E}`;let t=this._eOffset!==0n?`^${this._eOffset.toString()}`:"";return`BN:${this.p}:${this.sig.toString()}:${this.e}${t}`}clone(){return new e(this.sig,{base:this.e,offset:this._eOffset,inf:this.inf},this.p)}isZero(){return!this.inf&&this.sig===0n}isInfinite(){return!!this.inf}isNegative(){return!1}sub(t){if(t=e.fromAny(t,this.p),this.inf)return t.inf?e.zero(this.p):this.clone();if(t.isZero())return this.clone();if(t.inf)return e.zero(this.p);if(this.cmp(t)<=0)return e.zero(this.p);let n=this.#r(t);if(n>=0){let o=n===0?t.sig:this.#a(t),r=this.sig-o;if(r>0n)return new e(r,this.#t(),this.p)}try{let o=this.toPlainIntegerString(),r=t.toPlainIntegerString();if(o==="Infinity")return this.clone();if(r==="Infinity")return e.zero(this.p);let i=BigInt(o)-BigInt(r);return i<=0n?e.zero(this.p):e.fromInt(i,this.p)}catch{return e.zero(this.p)}}#e(t){return t<=0?1n:10n**BigInt(t)}#t(){return{base:this.e,offset:this._eOffset,inf:this.inf}}#o(t){if(this.inf||!t)return;let n=this.e,o=n+t;this.e=Math.trunc(o);let r=this.e-n,i=BigInt(t-r);i&&(this._eOffset+=i)}#n(){return this.inf?this._eOffset>=0n?BigInt(Number.MAX_SAFE_INTEGER):-BigInt(Number.MAX_SAFE_INTEGER):BigInt(Math.trunc(this.e))+this._eOffset}#r(t){if(this.inf||t.inf)return this.inf&&t.inf?0:this.inf?1:-1;let n=this.#n(),o=t.#n();return n>o?1:n<o?-1:0}#l(t){if(this.inf||t.inf)return this.inf&&t.inf?0n:this.inf?BigInt(this.p+3):-BigInt(this.p+3);let n=this.#n()-t.#n(),o=n<0n?-n:n,r=BigInt(this.p+2);return o>r?n>0n?BigInt(this.p+3):-BigInt(this.p+3):n}#s(){if(this._eOffset===0n)return 0;let t=Number(this._eOffset);return!Number.isFinite(t)||!Number.isSafeInteger(t)?t>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t}#i(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#s();return Number.isFinite(t)?this.e+t:t}#c(){if(this.inf)return;if(this.sig===0n){this.e=0;return}let t=this.sig,n=this.p,r=t.toString().length-n;if(r>0){let i=this.#e(r),s=t/i;if(t%i*2n>=i&&(s+=1n),t=s,this.#o(r),this.e>=e.MAX_E){this.e=e.MAX_E,this.inf=!0;return}if(t.toString().length>n&&(t=t/10n,this.#o(1),this.e>=e.MAX_E)){this.e=e.MAX_E,this.inf=!0;return}}else if(r<0){let i=-r;t=t*this.#e(i),this.#o(-i)}this.sig=t}#a(t){let n=this.#l(t),o=n<0n?-n:n;if(o===0n)return t.sig;if(o>BigInt(this.p+2))return 0n;let r=Number(o),i=this.#e(r),s=t.sig/i;return t.sig%i*2n>=i&&(s+=1n),s}add(t){if(t=e.fromAny(t,this.p),this.inf||t.inf){let n=this.clone();return n.inf=this.inf||t.inf,n.e=e.MAX_E,n}return this.isZero()?t.clone():t.isZero()?this.clone():this.#r(t)>=0?new e(this.sig+this.#a(t),this.#t(),this.p):t.add(this)}iadd(t){let n=this.add(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulSmall(t){if(t<0)throw new Error("BigNum only supports non-negative values");return this.inf?this.clone():t===0?e.zero(this.p):t===1?this.clone():new e(this.sig*BigInt(t),this.#t(),this.p)}imulSmall(t){let n=this.mulSmall(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}mulBigNumInteger(t){let n=e.fromAny(t,this.p);if(this.inf||n.inf){let i=this.clone();return i.inf=this.inf||n.inf,i.e=e.MAX_E,i}if(this.isZero()||n.isZero())return e.zero(this.p);let o=this.e+n.e,r=this._eOffset+n._eOffset;return new e(this.sig*n.sig,{base:o,offset:r},this.p)}imulBigNumInteger(t){let n=this.mulBigNumInteger(t);return this.sig=n.sig,this.e=n.e,this._eOffset=n._eOffset,this.inf=n.inf,this}div(t){let n=e.fromAny(t,this.p);if(this.inf)return n.inf?new e(1n,0,this.p):this.clone();if(n.inf)return e.zero(this.p);if(n.isZero())return new e(1n,e.MAX_E,this.p);if(this.isZero())return e.zero(this.p);let o=this.#e(this.p),i=this.sig*o/n.sig,s=BigInt(this.e)-BigInt(n.e),l=this._eOffset-n._eOffset,a=BigInt(this.p),u=s-a,f=Number(u),d=l;return Number.isSafeInteger(f)||(d+=u,f=0),new e(i,{base:f,offset:d},this.p)}cmp(t){if(t=e.fromAny(t,this.p),this.inf||t.inf)return this.inf===t.inf?0:this.inf?1:-1;let n=this.isZero(),o=typeof t.isZero=="function"?t.isZero():!1;if(n||o)return n&&o?0:n?-1:1;let r=this.#r(t);return r!==0?r:this.sig===t.sig?0:this.sig>t.sig?1:-1}static _parseDecimalMultiplier(t,n=e.DEFAULT_PRECISION){let o=typeof t=="number"?String(t):String(t??"").trim();if(!o||o==="0")return{numer:0n,scale:0};if(/e/i.test(o)){let u=Number(o);if(!Number.isFinite(u)||u<0)throw new TypeError("Invalid multiplier: "+o);let f=Math.min(n,18);o=u.toFixed(f).replace(/\.?0+$/,"")}if(!/^\d+(\.\d+)?$/.test(o))throw new TypeError("Invalid multiplier: "+o);let[r,i=""]=o.split("."),s=i.slice(0,n),l=s.length;return{numer:BigInt(r+s),scale:l}}mulDecimal(t,n=e.DEFAULT_PRECISION){if(this.inf||this.isZero())return this.clone();let{numer:o,scale:r}=e._parseDecimalMultiplier(t,n);return o===0n?e.zero(this.p):this.mulScaledInt(o,r)}floorToInteger(){if(this.inf)return this.clone();if(this.isZero())return this.clone();let t=this.#i();if(!Number.isFinite(t))return this.clone();let n=t+this.p;if(n<=0)return e.zero(this.p);if(n>=this.p)return this.clone();let o=this.p-n,r=10n**BigInt(o),i=this.sig/r*r;return new e(i,this.#t(),this.p)}mulDecimalFloor(t,n=e.DEFAULT_PRECISION){return this.mulDecimal(t,n).floorToInteger()}mulScaledInt(t,n){if(this.inf||this.isZero())return this.clone();let o=BigInt(t);return o===0n?e.zero(this.p):new e(this.sig*o,{base:this.e-(n|0),offset:this._eOffset},this.p)}mulScaledIntFloor(t,n){return this.mulScaledInt(t,n).floorToInteger()}get decExp(){if(this.inf)return Number.POSITIVE_INFINITY;let t=this.#i();return Number.isFinite(t)?t+(this.p-1):t}toScientific(t=3){if(this.inf)return"Infinity";if(this.isZero())return"0";let n=this.sig.toString().padStart(this.p,"0"),o=n[0],r=n.slice(1,1+t).replace(/0+$/g,""),i=r?`${o}.${r}`:o,s=this.#s();if(Number.isFinite(s)){let a=this.e+s+(this.p-1);return`${i}e${a}`}else{let l=BigInt(this.e)+this._eOffset+BigInt(this.p-1);return`${i}e${l.toString()}`}}toPlainIntegerString(){if(this.inf)return"Infinity";if(this.isZero())return"0";let t=this.#i();if(!Number.isFinite(t))return t>0?"Infinity":"0";let n=t+this.p;if(n<=0)return"0";if(n>e.MAX_PLAIN_DIGITS)return"Infinity";let o=this.sig.toString().padStart(this.p,"0");if(n<=this.p)return o.slice(0,n).replace(/^0+/,"")||"0";let r=n-this.p;return(o+"0".repeat(r)).replace(/^0+/,"")||"0"}toString(){return this.toPlainIntegerString()}};ug=Math.log(10)});function pg(e){let t=Number(e);if(!Number.isFinite(t))return String(e);try{return dg.format(t)}catch{return String(e)}}function Na(e){let t=1,n=e.split("");for(let o=n.length-1;o>=0&&t;o--){let r=n[o].charCodeAt(0)-48+t;t=r>=10?1:0,n[o]=String.fromCharCode(48+r%10)}return t&&n.unshift("1"),n.join("")}function Wf(e,t=""){let n=(e||"").replace(/^0+/,"")||"0";if(n.length<4)return t+pg(n);if(n.length<=7){let u=Number(n);if(Number.isFinite(u)&&u<=1e6)return t+dg.format(u)}let o=n.length-1;if(o<=300){let u=Math.floor(o/3)*3,f=zf.get(u)||"",m=o-u+1,v=4-m,p=m+v;n.length<p+1&&(n+="0".repeat(p+1-n.length));let h=n.slice(0,p);(n.charCodeAt(p)||48)>=53&&(h=Na(h));let y,I;return h.length>p?(y=h.slice(0,m+1),I="0".repeat(v)):(y=h.slice(0,m),I=h.slice(m)),t+`${y}${v?"."+I:""}${f}`}let r=4;n.length<r+1&&(n+="0".repeat(r+1-n.length));let i=n.slice(0,r);(n.charCodeAt(r)||48)>=53&&(i=Na(i));let l=i.slice(0,1),a=i.slice(1);return t+`${l}.${a}e`+Wf(String(o))}function CI(e){e=String(e).trim();let t="";if((e[0]==="+"||e[0]==="-")&&(t=e[0]==="-"?"-":"",e=e.slice(1)),/^\d+$/.test(e))return t+Wf(e);let n=e.match(/^(\d+)(?:\.(\d+))?e([+-]?)(\d+)$/i);if(!n)return t+e;let[,o,r="",i,s]=n,l=!1,a=0;s.length>3?l=!0:(a=parseInt(s||"0",10)||0,l=a>=303);let u=(o+r).replace(/^0+/,"")||"0";u.length<5&&(u+="0".repeat(5-u.length));let f=u.slice(0,4);if((u.charCodeAt(4)||48)>=53&&(f=Na(f)),l){let M=f.slice(0,1)+"."+f.slice(1),A=i==="-"?"-":"";return t+M+"e"+Wf(s,A)}let m=Math.floor(a/3)*3,v=zf.get(m)||"",h=a-m+1,g=4-h,y,I;return f.length>4?(y=f.slice(0,h+1),I="0".repeat(g)):(y=f.slice(0,h),I=f.slice(h)),t+(i==="-"?"-":"")+y+(g?"."+I:"")+v}function fg(e){let t=e.toLowerCase().indexOf("e");if(t<0)return e;let o=e.slice(0,t).replace(".","");if(!/^\d+$/.test(o))return e;o.length<5&&(o+="0".repeat(5-o.length));let r=o.slice(0,4);(o.charCodeAt(4)||48)>=53&&(r=Na(r)),r.length>4&&(r=r.slice(0,4));let s=r.slice(0,1)+"."+r.slice(1),l=e.slice(t+1);return s+"e"+CI(l)}function K(e){if(!(e instanceof c))return String(e);if(e.isInfinite&&e.isInfinite())return'<span class="infinity-symbol">\u221E</span>';if(e.isZero())return"0";let t=e.decExp??e.e+(e.p-1);if(t>=303)return fg(e.toScientific(3));if(t<6)return pg(e.toPlainIntegerString());let n=Math.floor(t/3)*3,o=zf.get(n);if(!o)return fg(e.toScientific(3));let i=t-n+1,s=4-i,l=i+s,a=e.sig.toString().padStart(e.p,"0");a.length<l+1&&(a+="0".repeat(l+1-a.length));let u=a.slice(0,l);(a.charCodeAt(l)||48)>=53&&(u=Na(u));let d,m;return u.length>l?(d=u.slice(0,i+1),m="0".repeat(s)):(d=u.slice(0,i),m=u.slice(i)),`${d}${s?"."+m:""}${o}`}function Te(e){try{if(e&&(e instanceof c||e.toPlainIntegerString)){let n=Ee(e);if(Number.isFinite(n)&&n<3){let o=Math.pow(10,n);return String(o.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1")}return K(e)}let t=Number(e)||0;return Math.abs(t)<1e3?String(t.toFixed(3)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):K(c.fromAny(t))}catch{return"1"}}var _I,zf,dg,qt=De(()=>{xt();_I=[[300,"NoNg"],[297,"OcNg"],[294,"SpNg"],[291,"SxNg"],[288,"QnNg"],[285,"QdNg"],[282,"TNg"],[279,"DNg"],[276,"UNg"],[273,"Ng"],[270,"NoOg"],[267,"OcOg"],[264,"SpOg"],[261,"SxOg"],[258,"QnOg"],[255,"QdOg"],[252,"TOg"],[249,"DOg"],[246,"UOg"],[243,"Og"],[240,"NoSg"],[237,"OcSg"],[234,"SpSg"],[231,"SxSg"],[228,"QnSg"],[225,"QdSg"],[222,"TSg"],[219,"DSg"],[216,"USg"],[213,"Sg"],[210,"Nosg"],[207,"Ocsg"],[204,"Spsg"],[201,"Sxsg"],[198,"Qnsg"],[195,"Qdsg"],[192,"Tsg"],[189,"Dsg"],[186,"Usg"],[183,"sg"],[180,"NoQg"],[177,"OcQg"],[174,"SpQg"],[171,"SxQg"],[168,"QnQg"],[165,"QdQg"],[162,"TQg"],[159,"DQg"],[156,"UQg"],[153,"Qg"],[150,"Noqg"],[147,"Ocqg"],[144,"Spqg"],[141,"Sxqg"],[138,"Qnqg"],[135,"Qdqg"],[132,"Tqg"],[129,"Dqg"],[126,"Uqg"],[123,"qg"],[120,"NoTg"],[117,"OcTg"],[114,"SpTg"],[111,"SxTg"],[108,"QnTg"],[105,"QdTg"],[102,"TTg"],[99,"DTg"],[96,"UTg"],[93,"Tg"],[90,"NoVt"],[87,"OcVt"],[84,"SpVt"],[81,"SxVt"],[78,"QnVt"],[75,"QdVt"],[72,"TVt"],[69,"DVt"],[66,"UVt"],[63,"Vt"],[60,"NoDe"],[57,"OcDe"],[54,"SpDe"],[51,"SxDe"],[48,"QnDe"],[45,"QdDe"],[42,"TDe"],[39,"DDe"],[36,"UDe"],[33,"De"],[30,"No"],[27,"Oc"],[24,"Sp"],[21,"Sx"],[18,"Qn"],[15,"Qd"],[12,"T"],[9,"B"],[6,"M"]],zf=new Map(_I),dg=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0})});var xg={};It(xg,{CURRENCIES:()=>Re,KEYS:()=>wt,STORAGE_PREFIX:()=>es,bank:()=>R,clearActiveSlot:()=>DI,clearAllStorage:()=>HI,ensureCurrencyDefaults:()=>sd,ensureMultiplierDefaults:()=>ad,ensureStorageDefaults:()=>GI,getActiveSlot:()=>b,getCurrency:()=>Pa,getCurrencyMultiplierBN:()=>Eg,getHasOpenedSaveSlot:()=>qI,getLastSaveTime:()=>nd,getLastSaveTimeKey:()=>yc,getSlotModifiedFlagKey:()=>$I,getSlotSignature:()=>id,getSlotSignatureKey:()=>rd,hasModifiedSave:()=>ts,isCurrencyLocked:()=>mn,isStorageKeyLocked:()=>Kt,markSaveSlotModified:()=>Mn,notifyGameSessionStarted:()=>FI,onCurrencyChange:()=>gc,peekCurrency:()=>Ba,primeStorageWatcherSnapshot:()=>ct,setActiveSlot:()=>od,setCurrency:()=>Ji,setCurrencyMultiplierBN:()=>Sc,setHasOpenedSaveSlot:()=>bc,setSlotSignature:()=>vc,updateLastSaveTime:()=>Ig,watchStorageKey:()=>kt});function Zf(e){let t=parseInt(e,10);return Number.isFinite(t)&&t>0?t:null}function Jf(e){let t=Zf(e);return t==null?null:`${MI}:${t}`}function Qf(e){let t=Zf(e);return t==null?null:`${TI}:${t}`}function vg(e={}){pc.size!==0&&pc.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.key&&e.key&&t.key!==e.key)&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function gc(e,{key:t=null,slot:n=null}={}){if(typeof e!="function")return()=>{};let o={handler:e,key:t??null,slot:n??null};return pc.add(o),()=>{pc.delete(o)}}function AI(){if(Ra!=null||Ho.size===0)return;Ra=(typeof window<"u"?window:globalThis).setInterval(RI,kI)}function bg(){if(Ho.size!==0||Ra==null)return;(typeof window<"u"?window:globalThis).clearInterval(Ra),Ra=null}function Sg(e,t){if(!e||typeof e.parse!="function")return t;try{return e.parse(t)}catch{return t}}function NI(e,t,n){if(!e||typeof e.equals!="function")return Object.is(t,n);try{return e.equals(t,n)}catch{return Object.is(t,n)}}function RI(){if(Ho.size===0){bg();return}Ho.forEach((e,t)=>{if(!e||e.size===0)return;let n;try{n=localStorage.getItem(t)}catch{n=null}e.forEach(o=>{if(!o)return;let r=Sg(o,n);if(!o.initialized){if(o.lastRaw=n,o.lastValue=r,o.initialized=!0,o.emitCurrentValue)try{o.onChange?.(r,{key:t,raw:n,previous:void 0,previousRaw:void 0,initial:!0,rawChanged:!0,valueChanged:!0})}catch{}return}let i=n!==o.lastRaw,s=!NI(o,o.lastValue,r);if(!i&&!s)return;let l=o.lastValue,a=o.lastRaw;o.lastRaw=n,o.lastValue=r;try{o.onChange?.(r,{key:t,raw:n,previous:l,previousRaw:a,rawChanged:i,valueChanged:s})}catch{}})})}function kt(e,{parse:t,equals:n,onChange:o,emitCurrentValue:r=!1}={}){if(!e||typeof localStorage>"u")return()=>{};let i={parse:t,equals:n,onChange:o,emitCurrentValue:r,lastRaw:void 0,lastValue:void 0,initialized:!1},s=Ho.get(e);return s||(s=new Set,Ho.set(e,s)),s.add(i),AI(),()=>{let l=Ho.get(e);l&&(l.delete(i),l.size===0&&(Ho.delete(e),bg()))}}function ct(e,t){if(!e)return;let n=Ho.get(e);if(!n||n.size===0)return;let o=t;if(o===void 0)try{o=localStorage.getItem(e)}catch{o=null}n.forEach(r=>{r&&(r.lastRaw=o,r.lastValue=Sg(r,o),r.initialized=!0)})}function ed(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(e instanceof c&&typeof e.cmp=="function")try{return e.cmp(t)===0}catch{}if(t instanceof c&&typeof t.cmp=="function")try{return t.cmp(e)===0}catch{}if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return Object.is(e,t)}}function OI(e){if(e==null)return c.fromInt(0);try{return c.fromAny(e)}catch{return c.fromInt(0)}}function PI(){Kf.forEach(e=>{try{e?.()}catch{}}),Kf.clear()}function hg(e){if(e!==mg&&(PI(),mg=e??null,e!=null))for(let t of Object.values(Re)){let n=`${wt.CURRENCY[t]}:${e}`,o=kt(n,{parse:OI,equals:ed,onChange:(r,i)=>{if(!i?.valueChanged||typeof window>"u")return;let s={key:t,value:r,slot:e};vg(s);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:s}))}catch{}}});Kf.set(n,o)}}function BI(){typeof window>"u"||(hg(b()),window.addEventListener("saveSlot:change",()=>{hg(b())}))}function FI(){td=!0}function yc(e=b()){return e==null?null:`${Ir}lastSaveTime:${e}`}function Ig(){if(!td||document.hidden)return;let e=b();if(e==null)return;let t=Date.now();try{localStorage.setItem(yc(e),String(t))}catch{}}function nd(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(yc(e)),n=parseInt(t,10);return Number.isFinite(n)?n:0}catch{return 0}}function UI(){typeof window>"u"||(gg||(gg=setInterval(Ig,1e3)),window.addEventListener("beforeunload",()=>{if(!td)return;let e=b();if(e!=null)try{localStorage.setItem(yc(e),String(Date.now()))}catch{}}))}function b(){if(br!==void 0)return br;let e=localStorage.getItem(wt.SAVE_SLOT),t=parseInt(e,10),n=Number.isFinite(t)&&t>0?t:null;return br=n,n}function od(e){let t=Math.max(1,parseInt(e,10)||1);br=t,localStorage.setItem(wt.SAVE_SLOT,String(t));try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:t}}))}catch{}}function DI(){br=null,localStorage.removeItem(wt.SAVE_SLOT)}function Oa(e,t=b()){return t==null?null:`${e}:${t}`}function wg(e){try{return globalThis?.__cccLockedStorageKeys?.has?.(e)??!1}catch{return!1}}function Kt(e){return wg(e)}function rd(e=b()){return Jf(e)}function $I(e=b()){return Qf(e)}function id(e=b()){if(typeof localStorage>"u")return null;let t=Jf(e);if(!t)return null;try{return localStorage.getItem(t)}catch{return null}}function vc(e,t){if(typeof localStorage>"u")return;let n=Jf(e);if(n)try{t==null?localStorage.removeItem(n):localStorage.setItem(n,String(t))}catch{}}function ts(e=b()){if(typeof localStorage>"u")return!1;let t=Qf(e);if(!t)return!1;try{return localStorage.getItem(t)==="1"}catch{return!1}}function Mn(e=b()){if(typeof localStorage>"u")return;let t=Zf(e);if(t==null||ts(t))return;let n=Qf(t);if(n){try{localStorage.setItem(n,"1")}catch{return}try{window.dispatchEvent(new CustomEvent("saveSlot:modified",{detail:{slot:t}}))}catch{}}}function qI(){return localStorage.getItem(wt.HAS_OPENED_SAVE_SLOT)==="true"}function bc(e){localStorage.setItem(wt.HAS_OPENED_SAVE_SLOT,e?"true":"false")}function GI(){localStorage.getItem(wt.HAS_OPENED_SAVE_SLOT)===null&&bc(!1)}function sd(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${wt.CURRENCY[t]}:${e}`;localStorage.getItem(n)||localStorage.setItem(n,"0")}}function ad(){let e=b();if(e!=null)for(let t of Object.values(Re)){let n=`${wt.MULTIPLIER[t]}:${e}`;if(localStorage.getItem(n))hc(t);else{let o=Sr(c.fromInt(1));Qi(t,o)}}}function Pa(e){let t=Oa(wt.CURRENCY[e]);if(!t)return c.fromInt(0);let n=localStorage.getItem(t);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function Ji(e,t,{delta:n=null,previous:o=null}={}){let r=b(),i=Oa(wt.CURRENCY[e],r),s=o??Pa(e),l=c.fromInt(0);if(!i||mn(e,r))return s;let a;try{a=c.fromAny(t)}catch{a=c.fromInt(0)}a.isNegative?.()&&(a=c.fromInt(0));let u=a.toStorage();try{localStorage.setItem(i,u)}catch{}let f=null;try{f=localStorage.getItem(i)}catch{}let d=f??u,m=a;try{f!=null&&(m=c.fromAny(f),m.isNegative?.()&&(m=c.fromInt(0)))}catch{}ct(i,d);let v=!ed(s,m),h=(y=>{if(y==null)return null;try{let I=y instanceof c?y.clone?.()??y:c.fromAny(y);if(typeof I.cmp=="function")return I.cmp(l)>0?I:null;if(!I.isZero?.())return I}catch{}return null})(n),g=null;if(v)try{g=m.sub?.(s)}catch{}if((!g||g.isZero?.()||typeof g.cmp=="function"&&g.cmp(l)<=0)&&(g=h),v||g){let y={key:e,value:m,slot:r,delta:g??void 0};vg(y);try{window.dispatchEvent(new CustomEvent("currency:change",{detail:y}))}catch{}}return m}function Sr(e){return e.mulScaledIntFloor(1n,-jf)}function mc(e){let t=c.fromAny(e);return t.isInfinite()?t.clone():t.mulScaledIntFloor(1n,jf)}function hc(e){let t=Oa(wt.MULTIPLIER[e]);if(!t)return Sr(c.fromInt(1));let n=localStorage.getItem(t);if(!n||!n.startsWith(Jr)){let r=Sr(c.fromInt(1));return Qi(e,r),r}let o=n.slice(Jr.length);try{return c.fromAny(o)}catch{let r=Sr(c.fromInt(1));return Qi(e,r),r}}function Qi(e,t,n=b()){let o=Oa(wt.MULTIPLIER[e],n);if(!o||mn(e,n))return;let r=Sr(c.fromInt(1)),i=localStorage.getItem(o);if(i?.startsWith?.(Jr))try{r=c.fromAny(i.slice(Jr.length))}catch{}let s=c.fromAny(t),l=Jr+s.toStorage();try{localStorage.setItem(o,l)}catch{}let a=null;try{a=localStorage.getItem(o)}catch{}let u=a??l,f=s;try{let d=u?.startsWith?.(Jr)?u.slice(Jr.length):null;d!=null&&(f=c.fromAny(d))}catch{}try{ct(o,u)}catch{}if(!ed(r,f))try{window.dispatchEvent(new CustomEvent("currency:multiplier",{detail:{key:e,mult:mc(f),slot:n}}))}catch{}}function Eg(e){return mc(hc(e))}function mn(e,t=b()){let n=Oa(wt.CURRENCY[e],t);return wg(n)}function Sc(e,t){let n=c.fromAny(t),o=Sr(n);return Qi(e,o,b()),n}function Ba(e,t){let n=localStorage.getItem(`${wt.CURRENCY[t]}:${e}`);if(!n)return c.fromInt(0);try{return c.fromAny(n)}catch{return c.fromInt(0)}}function HI(){Object.values(wt).forEach(e=>{typeof e=="string"?localStorage.removeItem(e):typeof e=="object"&&Object.values(e).forEach(t=>localStorage.removeItem(t))})}function yg(e){let t=n=>{try{let o=c.fromAny(n);return typeof K=="function"?K(o):o.toString()}catch{return"NaN"}};return Object.defineProperty(t,"value",{get(){return Pa(e)}}),t.toString=function(){return this.value.toString()},t.add=function(o){let r=c.fromAny(o),i=this.value.add(r);return Ji(e,i,{delta:r,previous:this.value})},t.sub=function(o){let r=c.fromAny(o),s=this.value.sub(r);return s.isNegative?.()&&(s=c.fromInt(0)),Ji(e,s),s},t.set=function(o){let r=c.fromAny(o),i=null,s;try{s=this.value,s&&typeof s.sub=="function"&&(i=r.sub(s))}catch{}return Ji(e,r,{delta:i,previous:s})},t.fmt=function(o){let r=c.fromAny(o);return typeof K=="function"?K(r):r.toString()},t.mult={get(){return Eg(e)},set(n){return Sc(e,n)},multiplyByInt(n){let o=c.fromAny(n).floorToInteger(),r=hc(e).mulBigNumInteger(o);return r.isZero()&&(r=Sr(c.fromInt(1))),Qi(e,r),mc(r)},multiplyByDecimal(n){let o;try{o=c._parseDecimalMultiplier(String(n),jf)}catch{o={numer:1n,scale:0}}let r=hc(e).mulScaledIntFloor(o.numer,o.scale);r.isZero()&&(r=Sr(c.fromInt(1))),Qi(e,r);let i=mc(r);return i.isZero()?c.fromInt(1):i},multiplyByPercent(n){let o=Number(n)/100+1;return this.multiplyByDecimal(String(o))},applyTo(n){let o=this.get();if(o.isInfinite())return c.fromAny("Infinity");let r=c.fromAny(n,o.p);return r.isZero()||o.isZero()?r.clone():r.mulBigNumInteger(o)}},t.addWithMultiplier=function(o){let r=t.mult.applyTo(o);return t.add(r)},t}var Ir,es,MI,TI,jf,Jr,kI,Ho,Ra,pc,Kf,mg,gg,td,wt,Re,br,R,vt=De(()=>{xt();qt();Ir="ccc:",es=Ir,MI=`${Ir}slotSig`,TI=`${Ir}slotMod`,jf=18,Jr="XM:",kI=140,Ho=new Map,Ra=null,pc=new Set;Kf=new Map,mg=null;gg=null,td=!1;UI();wt={HAS_OPENED_SAVE_SLOT:`${Ir}hasOpenedSaveSlot`,SAVE_SLOT:`${Ir}saveSlot`,CURRENCY:{},MULTIPLIER:{}},Re={COINS:"coins",BOOKS:"books",GOLD:"gold",MAGIC:"magic",GEARS:"gears",WAVES:"waves",DNA:"dna"};typeof window<"u"&&window.addEventListener("storage",e=>{if(e.key===wt.SAVE_SLOT){if(e.newValue===null)br=null;else{let t=parseInt(e.newValue,10);br=Number.isFinite(t)&&t>0?t:null}try{window.dispatchEvent(new CustomEvent("saveSlot:change",{detail:{slot:br}}))}catch{}}});for(let e of Object.values(Re))wt.CURRENCY[e]=`${Ir}${e}`,wt.MULTIPLIER[e]=`${Ir}mult:${e}`;BI();R=new Proxy({},{get(e,t){if(Object.values(Re).includes(t))return yg(t);if(typeof t=="string"&&Re[t.toUpperCase?.()])return yg(Re[t.toUpperCase()])}});if(typeof window<"u"){window.bank=R;for(let e of Object.values(Re))window[e]=R[e]}});function _g(){return To}function Ic(e){To=!!e,document.body.classList.toggle("slots-delete-mode",To);let t=document.getElementById("manage-saves");t&&(t.textContent=To?"Done":"Manage save slots"),document.querySelectorAll(".slot-card").forEach(n=>{n.classList.toggle("is-deleting",To),n.setAttribute("aria-pressed",To?"true":"false")})}function XI(e){let t=new RegExp(`^ccc:.*:${e}$`),n=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);t.test(r)&&n.push(r)}n.forEach(o=>localStorage.removeItem(o))}function VI(){if(Lg)return;Lg=!0;let e=document.getElementById("manage-saves"),t=document.querySelector(".slots-grid");if(!e||!t)return;e.addEventListener("click",r=>{r.preventDefault(),Ic(!To)}),window.addEventListener("keydown",r=>{To&&r.key==="Escape"&&Ic(!1)});let n=r=>{!To||!r.target.closest(".slot-card")||(r.preventDefault(),r.stopPropagation())},o=r=>{if(!To)return;let i=r.target.closest(".slot-card");if(!i)return;r.preventDefault(),r.stopPropagation();let s=parseInt(i.dataset.slot,10);if((!Number.isFinite(s)||s<=0)&&(s=Array.from(document.querySelectorAll(".slot-card")).indexOf(i)+1),!(localStorage.getItem(`ccc:coins:${s}`)!==null)){alert(`Slot ${s} has no save data.`);return}if(confirm(`Delete save data in Slot ${s}? This cannot be undone.`)){if(XI(s),b()===s)try{localStorage.removeItem(wt.SAVE_SLOT)}catch{}ld(),Ic(!1)}};t.addEventListener("pointerdown",n,!0),t.addEventListener("click",o,!0),Ic(!1)}var To,Lg,Cg=De(()=>{vt();cd();To=!1,Lg=!1;document.addEventListener("DOMContentLoaded",()=>{try{VI()}catch{}})});var Mg={};It(Mg,{initSlots:()=>zI,refreshSlotsView:()=>ld});function YI(e){return localStorage.getItem(`ccc:coins:${e}`)!==null}function WI(e){if(!YI(e))return"No Save Data";try{let t=Ba(e,"coins");return K(t)}catch{return"0"}}function ud(){document.querySelectorAll(".slot-card").forEach((t,n)=>{let o=n+1,r=t.querySelector(".slot-title");if(r){let i=WI(o);r.innerHTML=`<img src="img/currencies/coin/coin.webp" class="coin-slot-icon-img" alt=""> ${i}`}t.dataset.slot=String(o)})}function zI(e){let t=document.querySelectorAll(".slot-card");ud(),t.forEach((n,o)=>{let r=o+1,i=s=>{od(r),sd(),ad(),bc(!0),typeof e=="function"&&e(r,s),ud()};n.addEventListener("click",s=>{_g()||(s.preventDefault(),i(s))})})}function ld(){ud()}var cd=De(()=>{xt();qt();Cg();vt()});var kg={};It(kg,{registerPreloadedAudio:()=>KI,takePreloadedAudio:()=>jI});function KI(e,t){let n=Tg(e);if(!(!n||!t)){t.pause?.();try{t.currentTime=0}catch{}wc.set(n,t)}}function jI(e){let t=Tg(e);if(!wc.has(t))return null;let n=wc.get(t);return wc.delete(t),n}var wc,Tg,Ec=De(()=>{wc=new Map,Tg=e=>{try{return new URL(e,document.baseURI).href}catch{return e}}});function ns(){if(typeof document>"u")return;let e=document.querySelector(".hud-top");if(!e)return;let t=document.querySelector("[data-xp-hud]"),n=document.querySelector("[data-mp-hud]"),o=!!(t&&!t.hasAttribute("hidden")),r=!!(n&&!n.hasAttribute("hidden"));e.classList.toggle("hud-top--xp-only",o&&!r),e.classList.toggle("hud-top--xp-mp",o&&r),!o&&!r&&e.classList.remove("hud-top--xp-only","hud-top--xp-mp")}var fd=De(()=>{});var Yg={};It(Yg,{addExternalCoinMultiplierProvider:()=>uo,addExternalXpGainMultiplierProvider:()=>Vo,addXp:()=>ls,broadcastXpChange:()=>Tc,computeCoinMultiplierForXpLevel:()=>wd,getXpGainMultiplier:()=>Ac,getXpLevelStorageKey:()=>ZI,getXpRequirementForXpLevel:()=>kc,getXpState:()=>Qe,initXpSystem:()=>ss,isXpSystemUnlocked:()=>gn,onXpChange:()=>Cc,refreshCoinMultiplierFromXpLevel:()=>jt,resetXpProgress:()=>as,setExternalBookRewardProvider:()=>Nc,setExternalCoinMultiplierProvider:()=>Xg,setExternalXpGainMultiplierProvider:()=>Vg,unlockXpSystem:()=>ni});function ZI(e=b()){let t=e??b();return t==null?null:Qr(t)}function hn(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function xc(e){return!e||typeof e!="object"||e.isZero?.()||typeof e.isZero=="function"&&e.isZero()}function Ug(e){if(!e||typeof e!="object")return 0;if(hn(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function ew(e){return!e||typeof e!="object"?0:hn(e)||typeof e.cmp=="function"&&e.cmp(Fg)>=0?Number.POSITIVE_INFINITY:Ug(e)}function Ng(e){if(!e||typeof e!="object")return c.fromInt(0);let t=e.mulDecimal(QI,1),n=t.floorToInteger();return typeof t.cmp=="function"&&t.cmp(n)===0?n.isZero?.()||typeof n.isZero=="function"&&n.isZero()?n:n.sub?.(Ga())??c.fromInt(0):n}function tw(e){return!e||typeof e!="object"?c.fromInt(0):e.mulDecimal(Bg,18)}function nw(e){if(hn(e)||typeof e.cmp=="function"&&e.cmp(Fg)>=0)return Ct.clone?.()??Ct;let t=e.floorToInteger(),n=e.sub(t),o=Ug(n);if(!Number.isFinite(o))return Ct.clone?.()??Ct;let r=Math.pow(10,o),i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return Ct.clone?.()??Ct;let d=BigInt(u)+l-BigInt(i),v=d%BigInt(250),p=Number(v),h=d-v;return new c(a,{base:p,offset:h})}function Dg(e){if(!e||typeof e!="object")return Ct.clone?.()??Ct;let n=tw(e),o=nw(n);if(o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite())return Ct.clone?.()??Ct;let i=e.clone?.()??(()=>{try{return c.fromAny(e??0)}catch{return c.fromInt(0)}})(),s=o.clone?.()??o;return typeof s.add=="function"?s=s.add(i):typeof i.add=="function"&&(s=i.add(s)),s}function $g(){let e=hn(V.xpLevel),t=hn(V.progress);if(!e&&!t)return!1;let n=Ct.clone?.()??Ct;if(V.xpLevel=n.clone?.()??n,V.progress=n.clone?.()??n,Lt=n.clone?.()??n,R?.books)try{typeof R.books.set=="function"?R.books.set(n.clone?.()??n):typeof R.books.add=="function"&&R.books.add(n.clone?.()??n)}catch{}return!0}function Da(e={}){qa.size!==0&&qa.forEach(t=>{if(!(!t||typeof t.handler!="function")&&!(t.slot!=null&&e.slot!=null&&t.slot!==e.slot))try{t.handler(e)}catch{}})}function Cc(e,{slot:t=null}={}){if(typeof e!="function")return()=>{};let n={handler:e,slot:t??null};return qa.add(n),()=>{qa.delete(n)}}function Ft(){return c.fromInt(0)}function Ga(){return c.fromInt(1)}function os(e){if(!e)return Ft();if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return Ft()}}function Lc(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function ow(){for(;bd.length>0;){let e=bd.pop();try{e?.()}catch{}}}function Og(e){if(e==null)return Ft();try{return c.fromAny(e)}catch{return Ft()}}function md(e){if(!pd){pd=!0;try{let t=Sd??b(),n={unlocked:V.unlocked,xpLevel:os(V.xpLevel),progress:os(V.progress),requirement:os(Lt)};rn(!0),co(),kn(!0);let o={unlocked:V.unlocked,xpLevel:os(V.xpLevel),progress:os(V.progress),requirement:os(Lt)},r=n.unlocked!==o.unlocked,i=!Lc(n.xpLevel,o.xpLevel),s=!Lc(n.progress,o.progress);if(!r&&!i&&!s)return;let l=Ft();if(i)try{l=o.xpLevel.sub?.(n.xpLevel)??Ft()}catch{l=Ft()}let a=null;if(!i&&s)try{a=o.progress.sub?.(n.progress)??null}catch{a=null}if(typeof window<"u"||qa.size>0){let u={unlocked:o.unlocked,xpLevelsGained:l?.clone?.()??l,xpAdded:a?.clone?.()??a,xpLevel:o.xpLevel?.clone?.()??o.xpLevel,progress:o.progress?.clone?.()??o.progress,requirement:o.requirement?.clone?.()??o.requirement,source:"storage",changeType:e,slot:t};if(Da(u),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:u}))}catch{}}}finally{pd=!1}}}function hd(e){if(e===Sd||(ow(),Sd=e??null,e==null))return;let t=(n,o)=>{let r=kt(n,o);typeof r=="function"&&bd.push(r)};t(Fa(e),{parse:n=>n==="1",equals:(n,o)=>n===o,onChange:()=>md("unlock")}),t(Qr(e),{parse:Og,equals:Lc,onChange:()=>md("xpLevel")}),t(is(e),{parse:Og,equals:Lc,onChange:()=>md("progress")})}function qg(){if(Rg){hd(b());return}Rg=!0,hd(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{hd(b()),rn(!0),co(),kn(!0)})}function gd(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"")}function rw(e){let t=e<Ag?e:Ag;if(t<=rs)return;let n=rs,o=wr.get(n.toString());for(o||(o=c.fromInt(10),wr.set(n.toString(),o));n<t;){let r=n+1n,i=o.mulScaledIntFloor(11n,1);if(r>1n&&(r-1n)%10n===0n&&(i=i.mulScaledIntFloor(25n,1)),wr.set(r.toString(),i),o=i,n=r,o.isInfinite?.()||typeof o.isInfinite=="function"&&o.isInfinite()){rs=n;return}}rs=n}function iw(e){let t=rs>0n?rs:0n,n=wr.get(t.toString());if(!n||hn(n))return Ct.clone?.()??Ct;let o=c.fromAny(t.toString()),r=Ee(n),i=c.fromInt(0);if(Number.isFinite(r)&&r>0)try{i=c.fromScientific(r.toString())}catch{i=c.fromInt(0)}let s=e.sub?.(o)??c.fromInt(0);xc(s)||(i=i.add?.(s.mulDecimal(Bg,18))??i);let l=Ng(e),a=Ng(o),u=l.sub?.(a)??c.fromInt(0);xc(u)||(i=i.add?.(u.mulDecimal(JI,18))??i);let f=ew(i);return Number.isFinite(f)?ie(f):Ct.clone?.()??Ct}function sw(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=hn(t),o=hn(e);if(n)return o?1:0;if(xc(t)||xc(e))return 0;let s=Ee(e),l=Ee(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Gg(){return Tn.container&&Tn.container.isConnected?!0:(Tn.container=document.querySelector(".xp-counter[data-xp-hud]"),Tn.container?(Tn.bar=Tn.container.querySelector(".xp-bar"),Tn.fill=Tn.container.querySelector(".xp-bar__fill"),Tn.xpLevelValue=Tn.container.querySelector(".xp-level-value"),Tn.progress=Tn.container.querySelector("[data-xp-progress]"),!0):!1)}function Hg(e){let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{t=c.fromInt(0)}if(t.isInfinite?.()||typeof t.isInfinite=="function"&&t.isInfinite())return c.fromAny("Infinity");let o="0";try{o=t.toPlainIntegerString?.()??t.toString?.()??"0"}catch{o="0"}let r={bigInt:null,finite:!0};if(o&&o!=="Infinity")try{r={bigInt:BigInt(o),finite:!0}}catch{r={bigInt:null,finite:!0}}else r={bigInt:null,finite:!0};let i=r.bigInt??0n;if(r.bigInt!=null&&i<=0n){let a=wr.get("0");return a.clone?.()??a}if(r.bigInt!=null){rw(i);let a=i.toString(),u=wr.get(a);if(u)return u.clone?.()??u}let s=iw(t);return s.isInfinite?.()||typeof s.isInfinite=="function"&&s.isInfinite()?Ct.clone?.()??Ct:(r.bigInt!=null&&wr.set(r.bigInt.toString(),s),s.clone?.()??s)}function Xo(){Lt=Hg(V.xpLevel)}function _c(){V.xpLevel=Ft(),V.progress=Ft(),Xo(),kn(!0)}function Pg(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function Mc(e){if(!e||typeof e!="object")return{bigInt:0n,finite:!1};if(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite())return{bigInt:null,finite:!1};let n="0";try{n=e.toPlainIntegerString?.()??e.toString?.()??"0"}catch{n="0"}if(n==="Infinity")return{bigInt:null,finite:!1};if(!n)return{bigInt:null,finite:!0};try{return{bigInt:BigInt(n),finite:!0}}catch{return{bigInt:null,finite:!0}}}function kn(e=!1){let t=R?.coins?.mult;if(!t||typeof t.set!="function"||typeof t.multiplyByDecimal!="function")return;let n=Mc(V.xpLevel),o=n.bigInt,r=!n.finite,i=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null;if(!e&&(r&&zn||!r&&o!=null&&!zn&&!Kn&&Wn!=null&&o===Wn||!r&&o==null&&Kn&&i&&jn&&i===jn))return;if(r){try{t.set(Ct)}catch{}Wn=null,zn=!0,Kn=!1,jn=null;return}let s;if(o!=null&&o<=vd){let f=c.fromInt(1),d=Number(o);for(let v=0;v<d;v+=1)f=f.mulDecimal("1.1",18);let m;try{m=c.fromAny(o.toString())}catch{m=c.fromInt(d)}typeof f.add=="function"?f=f.add(m):typeof m.add=="function"&&(f=m.add(f)),s=f.clone?.()??f}else s=Dg(V.xpLevel);let l=s.clone?.()??s,a=Er.size>0?Array.from(Er):typeof ei=="function"?[ei]:[];for(let f of a)if(typeof f=="function")try{let d=f({baseMultiplier:l.clone?.()??l,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});d instanceof c?l=d.clone?.()??d:d!=null&&(l=c.fromAny(d))}catch{}let u=l.isInfinite?.()||typeof l.isInfinite=="function"&&l.isInfinite();try{t.set(l.clone?.()??l)}catch{}u?(Wn=null,zn=!0,Kn=!1,jn=null):o!=null&&o<=vd?(Wn=o,zn=!1,Kn=!1,jn=null):(Wn=null,zn=!1,Kn=!0,jn=i)}function rn(e=!1){let t=b();if(t==null)return Ua=null,dd=!1,V.unlocked=!1,_c(),V;if(!e&&dd&&t===Ua)return V;Ua=t,dd=!0;try{let n=localStorage.getItem(Fa(t));V.unlocked=n==="1"}catch{V.unlocked=!1}try{V.xpLevel=c.fromAny(localStorage.getItem(Qr(t))??"0")}catch{V.xpLevel=Ft()}try{V.progress=c.fromAny(localStorage.getItem(is(t))??"0")}catch{V.progress=Ft()}return(hn(V.xpLevel)||hn(V.progress))&&(V.unlocked=!0),V.unlocked?($g(),Xo(),kn(!0),qg(),V):(_c(),V)}function $a(){let e=b();if(e==null)return;let t={unlocked:V.unlocked?"1":"0",level:V.xpLevel.toStorage(),progress:V.progress.toStorage()};try{localStorage.setItem(Fa(e),t.unlocked)}catch{}try{localStorage.setItem(Qr(e),t.level)}catch{}try{localStorage.setItem(is(e),t.progress)}catch{}let n=(()=>{let r=V.unlocked,i=V.xpLevel,s=V.progress;try{r=localStorage.getItem(Fa(e))==="1"}catch{}try{let l=localStorage.getItem(Qr(e));l&&(i=c.fromAny(l))}catch{}try{let l=localStorage.getItem(is(e));l&&(s=c.fromAny(l))}catch{}return{unlocked:r,level:i,progress:s}})();ct(Fa(e),n.unlocked?"1":"0"),ct(Qr(e),n.level?.toStorage?.()??t.level),ct(is(e),n.progress?.toStorage?.()??t.progress),(n.unlocked!==V.unlocked||(n.level?.toStorage?.()??null)!==t.level||(n.progress?.toStorage?.()??null)!==t.progress)&&(V.unlocked=n.unlocked,V.xpLevel=n.level,V.progress=n.progress,Xo(),kn(!0),co())}function aw(){kn(!0);let e=Ga();if(typeof yd=="function")try{let n=yd({baseReward:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});n instanceof c?e=n.clone?.()??n:n!=null&&(e=c.fromAny(n))}catch{}try{R?.books?.addWithMultiplier?R.books.addWithMultiplier(e):R?.books?.add&&R.books.add(e)}catch{}let t=Mc(V.xpLevel);t.finite?t.bigInt!=null?(Wn=t.bigInt,zn=!1,Kn=!1,jn=null):(Wn=null,zn=!1,Kn=!0,jn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(Wn=null,zn=!0,Kn=!1,jn=null)}function co(){if(!Gg())return;let{container:e,bar:t,fill:n,xpLevelValue:o,progress:r}=Tn;if(!e)return;if(!V.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--xp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=K(Lt);r.innerHTML=`<span class="xp-progress-current">0</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${a}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=gd(K(Lt));t.setAttribute("aria-valuetext",`0 / ${a||"10"} XP`)}ns();return}e.removeAttribute("hidden");let i=Lt,s=sw(V.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--xp-fill",l),n.style.width=l),o&&(o.innerHTML=K(V.xpLevel)),r){let a=K(V.progress),u=K(i);r.innerHTML=`<span class="xp-progress-current">${a}</span><span class="xp-progress-separator">/</span><span class="xp-progress-required">${u}</span><span class="xp-progress-suffix">XP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=gd(K(V.progress)),u=gd(K(i));t.setAttribute("aria-valuetext",`${a} / ${u} XP`)}ns()}function ss({forceReload:e=!1}={}){return Gg(),rn(e),Xo(),co(),qg(),Qe()}function ni(){if(rn(),V.unlocked)return co(),!1;_c(),V.unlocked=!0,$a(),co(),kn(!0);try{window.dispatchEvent(new CustomEvent("xp:unlock",{detail:Qe()}))}catch{}return!0}function as({keepUnlock:e=!0}={}){rn();let t=V.unlocked;return _c(),V.unlocked=e?t||V.unlocked:!1,$a(),co(),kn(!0),Qe()}function ls(e,{silent:t=!1}={}){rn();let n=Ua??b();if(n!=null&&Pg(is(n)))return{unlocked:V.unlocked,xpLevelsGained:Ft(),xpAdded:Ft(),xpLevel:V.xpLevel,progress:V.progress,requirement:Lt,slot:n};if(!V.unlocked)return{unlocked:!1,xpLevelsGained:Ft(),xpAdded:Ft(),xpLevel:V.xpLevel,requirement:Lt};let o;try{e instanceof c?o=e.clone?.()??c.fromAny(e??0):o=c.fromAny(e??0)}catch{o=Ft()}if(!o.isZero?.()){let d=xr.size>0?Array.from(xr):typeof ti=="function"?[ti]:[];for(let m of d)if(typeof m=="function")try{let v=m({baseGain:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});v instanceof c?o=v.clone?.()??v:v!=null&&(o=c.fromAny(v))}catch{}}if(o=Zn("xp",o),o.isZero?.()||typeof o.isZero=="function"&&o.isZero())return co(),{unlocked:!0,xpLevelsGained:Ft(),xpAdded:o,xpLevel:V.xpLevel,requirement:Lt};V.progress=V.progress.add(o),Xo();let r=n!=null&&Pg(Qr(n)),i=hn(V.progress),s=hn(V.xpLevel),l=hn(o);if(i||s||l){let d=Ct.clone?.()??Ct;r||(V.xpLevel=d.clone?.()??d),V.progress=d.clone?.()??d,Xo(),$g(),$a(),co(),kn(!0);let m={unlocked:!0,xpLevelsGained:Ft(),xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:Lt.clone?.()??Lt,slot:n};if(Da(m),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:m}))}catch{}return m}let a=Ft();if(V.progress.cmp(Lt)<0){$a(),co();let d={unlocked:!0,xpLevelsGained:Ft(),xpAdded:o,xpLevel:V.xpLevel,progress:V.progress,requirement:Lt,slot:n};if(Da(d),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:d}))}catch{}return d}if(!r){let d=Ee(V.progress),m=.08118668602542883,v=Ee(Lt);if(d-v>2){let g=V.xpLevel,y=d-v,I=Math.floor(y/m);if(I>10){let E=BigInt(Math.max(0,I-5));if(E>0n){let M=c.fromAny(E.toString());if(V.xpLevel=V.xpLevel.add(M),a=a.add(M),Xo(),R?.books?.add)try{let A=M.clone();R.books.add(A)}catch{}}}}let p=0,h=500;for(;V.progress.cmp?.(Lt)>=0&&p<h&&(V.progress=V.progress.sub(Lt),V.xpLevel=V.xpLevel.add(Ga()),a=a.add(Ga()),aw(),Xo(),!hn(Lt));)p+=1;p>=h&&V.progress.cmp(Lt)>=0&&Xo()}$a(),co();let u=Mc(V.xpLevel);u.finite?u.bigInt!=null?(Wn=u.bigInt,zn=!1,Kn=!1,jn=null):(Wn=null,zn=!1,Kn=!0,jn=typeof V.xpLevel?.toStorage=="function"?V.xpLevel.toStorage():null):(Wn=null,zn=!0,Kn=!1,jn=null);let f={unlocked:!0,xpLevelsGained:a.clone?.()??a,xpAdded:o.clone?.()??o,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:Lt.clone?.()??Lt,slot:n};if(Da(f),!t&&typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:f}))}catch{}return f}function Qe(){return rn(),{unlocked:V.unlocked,xpLevel:V.xpLevel.clone?.()??V.xpLevel,progress:V.progress.clone?.()??V.progress,requirement:Lt.clone?.()??Lt}}function Tc(e={}){rn();let t=Ua??b(),n={...Qe(),slot:t,...e};if(Da(n),typeof window<"u")try{window.dispatchEvent(new CustomEvent("xp:change",{detail:n}))}catch{}return n}function gn(){return rn(),!!V.unlocked}function kc(e){return Hg(e)}function Ac(){rn();let e=Ga(),t=xr.size>0?Array.from(xr):typeof ti=="function"?[ti]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,xpLevel:V.xpLevel.clone?.()??V.xpLevel,xpUnlocked:V.unlocked});o instanceof c?e=o.clone?.()??o:o!=null&&(e=c.fromAny(o))}catch{}return e}function wd(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{t=c.fromInt(0)}let n=Mc(t),o=n.bigInt;if(!n.finite)return Ct.clone?.()??Ct;let i;if(o!=null&&o<=vd){let a=c.fromInt(1),u=Number(o);for(let d=0;d<u;d+=1)a=a.mulDecimal("1.1",18);let f;try{f=c.fromAny(o.toString())}catch{f=c.fromInt(u)}typeof a.add=="function"?a=a.add(f):typeof f.add=="function"&&(a=f.add(a)),i=a.clone?.()??a}else i=Dg(t);let s=i.clone?.()??i,l=Er.size>0?Array.from(Er):typeof ei=="function"?[ei]:[];for(let a of l)if(typeof a=="function")try{let u=a({baseMultiplier:s.clone?.()??s,xpLevel:t.clone?.()??t,xpUnlocked:!!V.unlocked});u instanceof c?s=u.clone?.()??u:u!=null&&(s=c.fromAny(u))}catch{}return s.clone?.()??s}function Xg(e){ei=typeof e=="function"?e:null,Er.clear(),ei&&Er.add(ei),rn(),kn(!0)}function jt(){rn(),kn(!0)}function Vg(e){ti=typeof e=="function"?e:null,xr.clear(),ti&&xr.add(ti)}function uo(e){return typeof e!="function"?()=>{}:(Er.add(e),rn(),kn(!0),()=>{Er.delete(e),rn(),kn(!0)})}function Vo(e){return typeof e!="function"?()=>{}:(xr.add(e),rn(),()=>{xr.delete(e)})}function Nc(e){yd=typeof e=="function"?e:null}var Id,Fa,Qr,is,Ua,dd,Lt,wr,rs,Ct,Wn,zn,Kn,jn,ei,ti,Er,xr,yd,Ag,SC,IC,vd,Bg,JI,QI,Fg,V,qa,Tn,bd,Rg,Sd,pd,An=De(()=>{xt();vt();cs();qt();fd();Id="ccc:xp",Fa=e=>`${Id}:unlocked:${e}`,Qr=e=>`${Id}:level:${e}`,is=e=>`${Id}:progress:${e}`;Ua=null,dd=!1,Lt=c.fromInt(10),wr=new Map;wr.set("0",Lt);rs=0n,Ct=c.fromAny("Infinity"),Wn=null,zn=!1,Kn=!1,jn=null,ei=null,ti=null,Er=new Set,xr=new Set,yd=null,Ag=5000n,SC=Math.log10(11/10),IC=Math.log10(5/2),vd=200n,Bg="0.04139268515822507",JI="0.3979400086720376",QI="0.1",Fg=c.fromScientific(String(c.MAX_E));V={unlocked:!1,xpLevel:c.fromInt(0),progress:c.fromInt(0)};qa=new Set;Tn={container:null,bar:null,fill:null,xpLevelValue:null,progress:null};bd=[],Rg=!1,Sd=null,pd=!1;typeof window<"u"&&(window.xpSystem=window.xpSystem||{},Object.assign(window.xpSystem,{initXpSystem:ss,unlockXpSystem:ni,addXp:ls,getXpState:Qe,broadcastXpChange:Tc,isXpSystemUnlocked:gn,getXpRequirementForXpLevel:kc,getXpGainMultiplier:Ac,setExternalCoinMultiplierProvider:Xg,addExternalCoinMultiplierProvider:uo,refreshCoinMultiplierFromXpLevel:jt,setExternalXpGainMultiplierProvider:Vg,addExternalXpGainMultiplierProvider:Vo,setExternalBookRewardProvider:Nc,resetXpProgress:as}))});var Qg={};It(Qg,{GHOST_TAP_TIMEOUT_MS:()=>lw,clearGhostTapTarget:()=>Ha,consumeGhostTapGuard:()=>Jg,initGlobalGhostTap:()=>vw,installGhostTapGuard:()=>yw,markGhostTapTarget:()=>Zg,setGhostTapSelector:()=>bw,shouldSkipGhostTap:()=>fo,suppressNextGhostTap:()=>ko});function Wo(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Ld(){return typeof document>"u"?null:document}function fw(e){if(!Ld())return null;let n=typeof Element<"u"?Element:null;return!e||!n||(e instanceof n||(e=e.parentElement),!e||!e.closest)?null:e.closest(xd)}function Ha(e){e&&(e[Rc]=0)}function Zg(e,t=0,n=null){if(!e)return;let o=Wo(),r=Number.isFinite(t)?Math.max(0,Number(t)):0;r>0?e[Rc]=o+r:e[Rc]=0,uw=e;let i=n!==null?Number.isFinite(n)?Math.max(0,Number(n)):0:r;i>0&&ko(i)}function Jg(e){if(typeof window>"u")return!1;let t=window[us];return typeof t!="number"?!1:Wo()<=t?!0:(window[us]=null,!1)}function fo(e){if(!e)return!1;let t=Number(e[Rc]||0);return!Number.isFinite(t)||t<=0?!1:Wo()<=t?(Ha(e),!0):(Ha(e),!1)}function ko(e=0){if(typeof window>"u")return;let t=Wo(),n=Math.max(0,Number.isFinite(e)?e:0);if(n<=0){window[us]=null;return}let o=t+n,r=typeof window[us]=="number"?window[us]:0;window[us]=Math.max(r,o)}function dw(e){e.pointerType!=="mouse"&&(typeof e.button=="number"&&e.button!==0||(Pc=Lr=Wo(),Yo=0))}function pw(e){Pc=Lr=Wo(),Yo=0}function mw(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0)return;let t=Wo();Lr>0&&(Yo=t-Lr),Pc=t}function hw(){let e=Wo();Lr>0&&(Yo=e-Lr),Pc=e}function gw(e){if(!e.isTrusted)return;let t=Wo(),n=Lr>0?t-Lr:-1,o=fw(e.target);if(fo(o)){Yo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(Jg(o)){o&&Ha(o),Yo=0,e.preventDefault(),e.stopImmediatePropagation();return}if(n<0||!o)return;if((Yo||n)>=jg){Ha(o),Yo=0,e.preventDefault(),e.stopImmediatePropagation();return}Yo=0}function yw(e={}){if(Wg)return;let t=Ld();!t||typeof window>"u"||(Wg=!0,Ed="PointerEvent"in window,zg=!Ed&&"ontouchstart"in window,e.selector&&(xd=`${e.selector}, ${Oc}`),Number.isFinite(e.longPressMs)&&e.longPressMs>=0&&(jg=e.longPressMs),t.addEventListener("click",gw,!0),Ed?(t.addEventListener("pointerdown",dw,{capture:!0,passive:!1}),t.addEventListener("pointerup",mw,{capture:!0,passive:!0})):zg&&(t.addEventListener("touchstart",pw,{capture:!0,passive:!1}),t.addEventListener("touchend",hw,{capture:!0,passive:!0})))}function Kg(e){if(e.pointerType==="mouse"||typeof e.button=="number"&&e.button!==0||!e.isTrusted)return;let t=e.target;if(!t)return;let n=t.closest(Oc);n&&(n.closest(".shop-scroller")||n.closest(".automation-shop-scroller")||n.closest(".merchant-dialogue-list")&&!n.closest(".merchant-firstchat")||n.dataset.noGhost!=="true"&&(Zg(n,2e3,300),e.cancelable&&e.preventDefault(),n.click()))}function vw(){let e=Ld();if(!e||typeof window>"u")return;"PointerEvent"in window?e.addEventListener("pointerdown",Kg,{capture:!1,passive:!1}):"ontouchstart"in window&&e.addEventListener("touchstart",Kg,{capture:!1,passive:!1})}function bw(e){e&&(xd=`${e}, ${Oc}`)}var lw,Rc,us,Oc,cw,Wg,xd,Ed,zg,uw,Pc,Lr,Yo,jg,fs=De(()=>{lw=0,Rc=Symbol("ccc:ghostTap:skipUntil"),us="__cccGhostTapSkipUntil",Oc='[data-ghost-tap-target], button, [role="button"], [data-btn], .game-btn, .btn, .slot-card, a[href], input, select, textarea, summary',cw=80,Wg=!1,xd=Oc,Ed=!1,zg=!1,uw=null,Pc=0,Lr=0,Yo=0,jg=cw});var _d,ey=De(()=>{_d={0:{start:"n0",nodes:{n0:{type:"line",say:"So you want to delve deeper within my Shop, do you?",next:"c1"},r_who:{type:"line",say:"I am the Merchant.",next:"c2"},r_where:{type:"line",say:"The Cove.",next:"c2"},r_confused:{type:"line",say:"Okay.",next:"c3"},c1:{type:"choice",options:[{label:"Who are you?",to:"r_who"},{label:"Where am I?",to:"r_where"},{label:"I just clicked on this green button and now I\u2019m confused.",to:"r_confused"}]},c2:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Okay.",to:"r2_okay"}]},r2_what:{type:"line",say:"What?",next:"c3"},r2_okay:{type:"line",say:"Okay.",next:"c3"},c3:{type:"choice",options:[{label:"What?",to:"r2_what"},{label:"That\u2019s not helpful.",to:"r2_okay"},{label:"Goodbye.",to:"end"}]}}},1:{start:"n0",nodes:{n0:{type:"line",say:"Hello again.",next:"c0"},c0:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"Hello.",to:"m1b"},{label:"I am still very confused.",to:"m1c"}]},m1a:{type:"line",say:"Yes I did.",next:"c1a"},m1b:{type:"line",say:"Hello.",next:"c1b"},m1c:{type:"line",say:"Okay.",next:"c1e"},m1d:{type:"line",say:"Fine.",next:"c1d"},c1a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m1a"},{label:"Incorrect.",to:"m2a"},{label:"Okay I guess you\u2019re right.",to:"m2b"}]},c1b:{type:"choice",options:[{label:"You never answered my questions.",to:"m1a"},{label:"How are you?",to:"m1d"},{label:"Okay.",to:"m2b"}]},c1c:{type:"choice",options:[{label:"Yes.",to:"m2a"},{label:"Hmm\u2026",to:"m1c"},{label:"Okay.",to:"m2b"}]},c1d:{type:"choice",options:[{label:"That's nice.",to:"m2b"},{label:"Good.",to:"m2b"},{label:"Okay.",to:"m2b"}]},c1e:{type:"choice",options:[{label:"...",to:"m2b"},{label:"...",to:"m2b"},{label:"...",to:"m2b"}]},m2a:{type:"line",say:"No.",next:"c1c"},m2b:{type:"line",say:"Would you like some Coins? Free of charge. You look like you could use some right now.",next:"c2a"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"No.",to:"m3b"},{label:"Give me the coins now.",to:"end"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"Okay, no Coins for you then.",next:"c2b"},c2b:{type:"choice",options:[{label:"No wait, actually I want the coins. Give them to me now.",to:"end"},{label:"On second thought, maybe I do want the coins. Give them to me now.",to:"end"},{label:"Okay, bye, I don\u2019t need your filthy coins anyway.",to:"end_nr"}]}}},2:{start:"n0",nodes:{n0:{type:"line",say:"I see you\u2019ve unlocked the XP system.",next:"c0"},c0:{type:"choice",options:[{label:"What does it do?",to:"m1a"},{label:"What does that mean?",to:"m1b"},{label:"Yes I did that.",to:"m1c"}]},m1a:{type:"line",say:"Good things.",next:"c1a"},m1b:{type:"line",say:"It means something.",next:"c1b"},m1c:{type:"line",say:"And do you know how the XP system works?",next:"c1c"},m1d:{type:"line",say:"You'll be fine, you don't really need to know how it works anyway.",next:"c1d"},m1e:{type:"line",say:"No.",next:"c1d"},c1a:{type:"choice",options:[{label:"Why does this thing even exist?",to:"m2b"},{label:"What does that mean?",to:"m1b"},{label:"Okay.",to:"m3a"}]},c1b:{type:"choice",options:[{label:"Can you explain in more detail?",to:"m1e"},{label:"What?",to:"m2g"},{label:"Okay.",to:"m3a"}]},c1c:{type:"choice",options:[{label:"I have no idea.",to:"m1d"},{label:"I don\u2019t know the full details.",to:"m1d"},{label:"Yes.",to:"m3a"}]},c1d:{type:"choice",options:[{label:"...",to:"m3a"},{label:"...",to:"m3a"},{label:"...",to:"m3a"}]},m2b:{type:"line",say:"I dunno.",next:"c2b"},m2c:{type:"line",say:"Because I dunno.",next:"c2c"},m2d:{type:"line",say:"What?",next:"c2c"},m2e:{type:"line",say:"I\u2019ve already told you, so you can increase your Coin output.",next:"c2d"},m2f:{type:"line",say:"Are you sure you don\u2019t want free Books?",next:"c3a"},m2g:{type:"line",say:"What?",next:"c2c"},c2a:{type:"choice",options:[{label:"No.",to:"m2f"},{label:"Why are you giving me all this free stuff?",to:"m2e"},{label:"Yeah, sure.",to:"end"}]},c2b:{type:"choice",options:[{label:"What?",to:"m2d"},{label:"Why not?",to:"m2c"},{label:"\u2026",to:"m3a"}]},c2c:{type:"choice",options:[{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"},{label:"\u2026",to:"m3a"}]},c2d:{type:"choice",options:[{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"},{label:"\u2026",to:"m3b"}]},m3a:{type:"line",say:"Would you like some Books? Free of charge. They will help you accelerate your Coin output.",next:"c2a"},m3b:{type:"line",say:"Let me ask again, do you want free Books?",next:"c3b"},c3a:{type:"choice",options:[{label:"Okay, actually give me the free stuff.",to:"end"},{label:"Okay fine, I\u2019ll take those books off your hands.",to:"end"},{label:"I don\u2019t need your charity.",to:"end_nr"}]},c3b:{type:"choice",options:[{label:"Yes please.",to:"end"},{label:"Sure.",to:"end"},{label:"No.",to:"end_nr"}]}}},3:{start:"n0",nodes:{n0:{type:"line",say:"What do you want now?",next:"c0"},c0:{type:"choice",options:[{label:"I\u2019d like to ask some questions about how the forge works.",to:"m1a"},{label:"I\u2019d like to ask some questions about how mutations work.",to:"m1b"},{label:"Oh, um, I forgot.",to:"m1c"}]},m1a:{type:"line",say:"Sure, ask me anything about the Forge and I will answer.",next:"c1a"},m1b:{type:"line",say:"Sure, ask me anything about Mutations and I will answer.",next:"c1b"},m1c:{type:"line",say:"What do you mean you forgot??",next:"c3b"},c1a:{type:"choice",options:[{label:"Where did it come from?",to:"m2a"},{label:"How do I get more gold from it?",to:"m2b"},{label:"What is the benefit of forging my coins?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why do they exist?",to:"m2d"},{label:"What do mutations do for me?",to:"m2e"},{label:"Why are they important at all?",to:"m2f"}]},m2a:{type:"line",say:"I made it.",next:"c2a"},m2b:{type:"line",say:"Increase your Coins and XP Level to boost the output of the Forge.",next:"c2b"},m2c:{type:"line",say:"Trust me, it\u2019ll pay off in the future.",next:"c2c"},m2d:{type:"line",say:"They just do.",next:"c3a"},m2e:{type:"line",say:"Something.",next:"c2d"},m2f:{type:"line",say:"They just are.",next:"c3a"},c2a:{type:"choice",options:[{label:"Really?",to:"m3a"},{label:"Wow.",to:"m4a"},{label:"Okay.",to:"m4a"}]},c2b:{type:"choice",options:[{label:"What does \u201Cincrease\u201D mean?",to:"m3b"},{label:"Why does it work like that?",to:"m3c"},{label:"Okay.",to:"m4a"}]},c2c:{type:"choice",options:[{label:"That didn\u2019t really answer my question.",to:"m3d"},{label:"But how can you prove that?",to:"m3e"},{label:"Okay.",to:"m4a"}]},c2d:{type:"choice",options:[{label:"How will I know if a coin is mutated?",to:"m3f"},{label:"Not helpful but alright.",to:"m4a"},{label:"Okay.",to:"m4a"}]},m3a:{type:"line",say:"Nope. I lied.",next:"c3a"},m3b:{type:"line",say:"Number goes up. You know how this works.",next:"c3a"},m3c:{type:"line",say:"It just does.",next:"c3a"},m3d:{type:"line",say:"Yes it did.",next:"c3a"},m3e:{type:"line",say:"Trust in the process.",next:"c3a"},m3f:{type:"line",say:"Just look at it.",next:"c3a"},c3a:{type:"choice",options:[{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"},{label:"\u2026",to:"m4a"}]},c3b:{type:"choice",options:[{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"},{label:"\u2026",to:"m4b"}]},m4a:{type:"line",say:"Any more questions?",next:"c4a"},m4b:{type:"line",say:"Well you have to ask me something while you're here.",next:"c4a"},c4a:{type:"choice",options:[{label:"I\u2019d like to learn more about the forge.",to:"m1a"},{label:"I\u2019d like to learn more about mutations.",to:"m1b"},{label:"I think I\u2019m good.",to:"m5a"}]},m5a:{type:"line",say:"Here, have some Gold. I\u2019m not even going to let you decline my gift.",next:"c5a"},c5a:{type:"choice",options:[{label:"Oh, cool, thanks for the free stuff.",to:"end"},{label:"Okay, I\u2019ll put this gold to good use.",to:"end"},{label:"\u2026",to:"end"}]}}},4:{start:"n0",nodes:{n0:{type:"line",say:"I\u2019m sure you came to me to learn a few things about how my Magic works, is that correct?",next:"c0"},c0:{type:"choice",options:[{label:"Yes, I\u2019d like to know more about your magic.",to:"m1a"},{label:"Actually, I\u2019m more interested in how automation works.",to:"m1b"},{label:"Nah just give me free stuff.",to:"m1c"}]},m1a:{type:"line",say:"What would you like to know?",next:"c1a"},m1b:{type:"line",say:"What would you like to know?",next:"c1b"},m1c:{type:"line",say:"Wow. Just wow.",next:"c1c"},c1a:{type:"choice",options:[{label:"Why do you have magic powers?",to:"m2a"},{label:"Where did you get magic powers from?",to:"m2b"},{label:"If you have magic powers, why can\u2019t you just summon all the coins in the world?",to:"m2c"}]},c1b:{type:"choice",options:[{label:"Why does it exist?",to:"m2d"},{label:"What kinds of things can be automated?",to:"m2e"},{label:"How is automation different from doing things manually?",to:"m2f"}]},c1c:{type:"choice",options:[{label:"What?",to:"m2g"},{label:"Come on, where\u2019s the reward at?",to:"m2g"},{label:"Was it something I said?",to:"m2h"}]},m2a:{type:"line",say:"I just do.",next:"c2a"},m2b:{type:"line",say:"I've always had them.",next:"c2b"},m2c:{type:"line",say:"Because Coins are just built different like that.",next:"c2c"},m2d:{type:"line",say:"Because it\u2019s necessary to speed up Coin collection.",next:"c2d"},m2e:{type:"line",say:"Everything.",next:"c2e"},m2f:{type:"line",say:"It\u2019s just better. I don\u2019t have to explain why.",next:"c2f"},m2g:{type:"line",say:"Don\u2019t you want to chat with me for a bit? Don\u2019t you have some questions you want to ask me?",next:"c2g"},m2h:{type:"line",say:"Yes.",next:"c2h"},c2a:{type:"choice",options:[{label:"What?",to:"m3a"},{label:"Can you actually answer my question?",to:"m3b"},{label:"\u2026",to:"m6a"}]},c2b:{type:"choice",options:[{label:"How long have you had them?",to:"m3c"},{label:"What can your magic powers do?",to:"m3d"},{label:"Okay.",to:"m6a"}]},c2c:{type:"choice",options:[{label:"How so?",to:"m3e"},{label:"Your powers must be super weak then.",to:"m5a"},{label:"Understandable.",to:"m6a"}]},c2d:{type:"choice",options:[{label:"What if I just don\u2019t buy any automation?",to:"m3f"},{label:"How?",to:"m3g"},{label:"Okay.",to:"m6a"}]},c2e:{type:"choice",options:[{label:"Could I even automate talking to you?",to:"m3h"},{label:"So like, eventually everything would be progressing on its own?",to:"m3i"},{label:"Okay.",to:"m6a"}]},c2f:{type:"choice",options:[{label:"Why should I buy automation if you can\u2019t even explain why it\u2019s better than doing things manually?",to:"m3j"},{label:"But I wanted an explanation.",to:"m5a"},{label:"Okay.",to:"m6a"}]},c2g:{type:"choice",options:[{label:"No.",to:"m7b"},{label:"Not really.",to:"m7b"},{label:"My bad.",to:"m5a"}]},c2h:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"Sorry, I just was in a hurry to get free stuff so I could get back to collecting coins.",to:"m7a"}]},m3a:{type:"line",say:"What?",next:"c2a"},m3b:{type:"line",say:"I just did answer your question.",next:"c3a"},m3c:{type:"line",say:"At least 3.",next:"c3b"},m3d:{type:"line",say:"My Magic can do a few things.",next:"c3c"},m3e:{type:"line",say:"They\u2019re just built different.",next:"c5a"},m3f:{type:"line",say:"Don\u2019t.",next:"c5a"},m3g:{type:"line",say:"Common sense.",next:"c5a"},m3h:{type:"line",say:"Wow, that\u2019s kind of hurtful. Also no.",next:"c5a"},m3i:{type:"line",say:"Yes.",next:"c3d"},m3j:{type:"line",say:"Because I said so, and I am always right.",next:"c5a"},c3a:{type:"choice",options:[{label:"No you didn\u2019t.",to:"m4a"},{label:"Why are you like this?",to:"m4b"},{label:"\u2026",to:"m6a"}]},c3b:{type:"choice",options:[{label:"3\u2026 what?",to:"m4c"},{label:"Ah, I completely understand.",to:"m6a"},{label:"Okay.",to:"m6a"}]},c3c:{type:"choice",options:[{label:"Like\u2026?",to:"m4d"},{label:"Understandable.",to:"m6a"},{label:"\u2026",to:"m6a"}]},c3d:{type:"choice",options:[{label:"Wouldn\u2019t that get boring?",to:"m4e"},{label:"That sounds nice.",to:"m6a"},{label:"Okay.",to:"m6a"}]},m4a:{type:"line",say:"Yes I did.",next:"c3a"},m4b:{type:"line",say:"Like what?",next:"c4a"},m4c:{type:"line",say:"3.",next:"c5a"},m4d:{type:"line",say:"Okay you caught me, I\u2019m actually a fraud, my Magic is fake, nothing is real, the Coins are made of plastic, the sky's a dome, my name\u2019s not even Merchant it\u2019s Jeff.",next:"c4b"},m4e:{type:"line",say:"No.",next:"c5a"},c4a:{type:"choice",options:[{label:"Are you trying to be annoying on purpose?",to:"m5b"},{label:"You\u2019re not being helpful.",to:"m5a"},{label:"Nothing, nevermind\u2026",to:"m6a"}]},c4b:{type:"choice",options:[{label:"???",to:"m6a"},{label:"???",to:"m6a"},{label:"???",to:"m6a"}]},m5a:{type:"line",say:"Okay.",next:"c5a"},m5b:{type:"line",say:"No.",next:"c5a"},c5a:{type:"choice",options:[{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"},{label:"\u2026",to:"m6a"}]},m6a:{type:"line",say:"Anything else you\u2019d like to know?",next:"c6a"},c6a:{type:"choice",options:[{label:"Tell me some more stuff about how your magic works.",to:"m1a"},{label:"Tell me some more stuff about how automation works.",to:"m1b"},{label:"Do you have any goodies for me?",to:"m7a"}]},m7a:{type:"line",say:"10 Magic, take it or leave it.",next:"c7a"},m7b:{type:"line",say:"Okay, now you\u2019re just being rude. Don\u2019t expect to get anything for free if you\u2019re rude.",next:"c7b"},c7a:{type:"choice",options:[{label:"Hmm, a bit too low for my taste.",to:"m7b"},{label:"I would\u2019ve liked more, but I\u2019ll take it.",to:"end"},{label:"I\u2019ll take it.",to:"end"}]},c7b:{type:"choice",options:[{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"},{label:"\u2026",to:"end_nr"}]}}},5:{start:"n0",nodes:{n0:{type:"line",say:"You have felt the Surge, haven't you?",next:"c0"},c0:{type:"choice",options:[{label:"Yes.",to:"m1a"},{label:"It was... intense.",to:"m1b"},{label:"What was that?",to:"m1c"}]},m1a:{type:"line",say:"Good.",next:"c1"},m1b:{type:"line",say:"Indeed.",next:"c1"},m1c:{type:"line",say:"Progress.",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"end"},{label:"...",to:"end"},{label:"...",to:"end"}]}}},6:{start:"n0",nodes:{n0:{type:"line",say:"Ah, you found the Lab.",next:"c0"},c0:{type:"choice",options:[{label:"It looks empty.",to:"m1a"},{label:"What is this place?",to:"m1b"},{label:"...",to:"m1c"}]},m1a:{type:"line",say:"For now.",next:"c1"},m1b:{type:"line",say:"A place for experiments.",next:"c1"},m1c:{type:"line",say:"Take a look around.",next:"c1"},c1:{type:"choice",options:[{label:"Okay.",to:"end"},{label:"Sure.",to:"end"},{label:"...",to:"end"}]}}},7:{start:"n0",nodes:{n0:{type:"line",say:"What are you doing?? Come to the Lab, quickly.",next:"c0"},c0:{type:"choice",options:[{label:"...",to:"end_nr"},{label:"...",to:"end_nr"},{label:"...",to:"end_nr"}]}}}}});var ty={};It(ty,{RateAccumulator:()=>Va,pauseGameLoop:()=>Ad,registerFrame:()=>xw,registerTick:()=>Ao,resumeGameLoop:()=>Nd,startGameLoop:()=>ww,stopGameLoop:()=>Ew});function Td(e){e||(e=performance.now());let t=e;if(kd){oi=t,ii=requestAnimationFrame(Td);return}oi||(oi=t);let n=(t-oi)/1e3;oi=t,n>60&&(n=60),n<0&&(n=0),ri+=n;let o=0,r=250;for(;ri>=Xa;){if(o>=r){ri=ri%Xa;break}Cd.forEach(i=>{try{i(Xa)}catch(s){console.error("Error in game tick listener:",s)}}),ri-=Xa,o++}if(Md.forEach(i=>{try{i(t/1e3,n)}catch(s){console.error("Error in game frame listener:",s)}}),ds===0||ps===0)ds=Date.now(),ps=t;else{let i=t-ps;if(i>Iw){let s=Date.now(),l=s-ds;l<-1e3?Mn():l>i+1e4&&Mn(),ds=s,ps=t}}ii=requestAnimationFrame(Td)}function Ad(){kd=!0}function Nd(){kd=!1,oi=performance.now(),ri=0,ds=0,ps=0}function ww(){ii||(oi=performance.now(),ri=0,ds=0,ps=0,ii=requestAnimationFrame(Td))}function Ew(){ii&&(cancelAnimationFrame(ii),ii=null)}function Ao(e){return typeof e!="function"?()=>{}:(Cd.add(e),()=>{Cd.delete(e)})}function xw(e){return typeof e!="function"?()=>{}:(Md.add(e),()=>{Md.delete(e)})}var Sw,Xa,Cd,Md,ii,kd,oi,ri,ds,ps,Iw,Va,si=De(()=>{vt();Sw=20,Xa=1/Sw,Cd=new Set,Md=new Set,ii=null,kd=!1,oi=0,ri=0,ds=0,ps=0,Iw=2e3;Va=class{constructor(t,n){this.currencyKey=t,this.bank=n||window.bank,this.buffer=0}addRate(t){let n=t*Xa;if(this.buffer+=n,this.buffer>=1){let o=Math.floor(this.buffer);this.buffer-=o,this.bank&&this.bank[this.currencyKey]&&this.bank[this.currencyKey].add(o)}}}});var Ze,ai,Ya,Wa,za,Ka,po,ja,ms,Lw,_w,Cw,Mw,Tw,ny,li=De(()=>{xt();Ze="automation",ai=1,Ya=2,Wa=3,za=4,Ka=5,po=6,ja=7,ms={[Ya]:"coins",[Wa]:"books",[za]:"gold",[Ka]:"magic",[ja]:"dna"},Lw="img/misc/mysterious.webp",_w="img/misc/locked.webp",Cw="Hidden Upgrade",Mw="Locked Upgrade",Tw=[{area:Ze,id:ai,title:"Effective Auto-Collect",desc:`Generates the equivalent of picking up a Coin on an interval\nEach level of this upgrade will reduce the generation interval\nAs a bonus, anything passively generated accumulates offline`,icon:"sc_upg_icons/effective_auto_collect.webp",lvlCap:20,baseCost:100,costType:"gears",upgType:"NM",scaling:{ratio:2},costAtLevel(e){let t=Math.max(0,Math.floor(Number(e)||0)),n=BigInt(100),o=2n**BigInt(t);return c.fromAny((n*o).toString())},effectSummary(e){let t=Math.max(0,Math.floor(Number(e)||0));return t===0?"Coin generation interval: None":`Coin generation interval: ${Math.round(1e3/t)}ms`}},{area:Ze,id:Ya,title:"Autobuy Coin Upgrades",desc:`Automatically buys Coin upgrades, but with a twist:\nAutobuys upgrades for free, as long as you can afford the cost\nThis is how all future autobuyers will work`,icon:"sc_upg_icons/autobuy_coin.webp",lvlCap:1,baseCost:1e6,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e6)},effectSummary(){return null}},{area:Ze,id:Wa,title:"Autobuy Book Upgrades",desc:"Automatically buys Book upgrades",icon:"sc_upg_icons/autobuy_book.webp",lvlCap:1,baseCost:1e9,costType:"gears",upgType:"NM",costAtLevel(){return c.fromInt(1e9)},effectSummary(){return null}},{area:Ze,id:za,title:"Autobuy Gold Upgrades",desc:"Automatically buys Gold upgrades",icon:"sc_upg_icons/autobuy_gold.webp",lvlCap:1,baseCost:1e12,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e12")},effectSummary(){return null}},{area:Ze,id:Ka,title:"Autobuy Magic Upgrades",desc:"Automatically buys Magic upgrades",icon:"sc_upg_icons/autobuy_magic.webp",lvlCap:1,baseCost:1e15,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e15")},effectSummary(){return null}},{area:Ze,id:po,title:"Autobuy Workshop Levels",desc:"Automatically buys Workshop Levels",icon:"sc_upg_icons/autobuy_workshop_level.webp",lvlCap:1,baseCost:1e18,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e18")},effectSummary(){return null}},{area:Ze,id:ja,title:"Autobuy DNA Upgrades",desc:"Automatically buys DNA upgrades",icon:"sc_upg_icons/autobuy_dna.webp",lvlCap:1,baseCost:1e27,costType:"gears",upgType:"NM",costAtLevel(){return c.fromAny("1e27")},effectSummary(){return null},computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=11||t===1/0)&&(n=!0):typeof t=="bigint"?t>=11n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=11)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};if(!e.surgeUnlocked)return{locked:!0,iconOverride:_w,titleOverride:Mw,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0};let o="Reach Surge 11 to reveal this upgrade";return{locked:!0,iconOverride:Lw,titleOverride:Cw,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}],ny=Tw.map(e=>({...e,icon:`img/${(e.icon||"").replace(/^img\//,"")}`}))});function ry(e){typeof e=="function"&&oy.push(e)}function Rd(){Za=null}function Fc(){Za=null;try{Bc.forEach(e=>e())}catch{}try{document.dispatchEvent(new CustomEvent("ccc:upgrades:changed"))}catch{}try{jt()}catch{}}function Od(e){return typeof e=="function"&&Bc.push(e),()=>{Bc=Bc.filter(t=>t!==e)}}function Aw(e){let t=gt(e);try{let n=t.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Math.max(0,Number(n));return ie(o*Math.log10(2)).floorToInteger()}}catch{}return c.fromAny("Infinity")}function Nw(){try{return!!gn()}catch{return!1}}function Ja(e){let t=R?.books?.mult;if(!t||typeof t.set!="function")return;let n=0;if(Nw())if(Number.isFinite(e))n=Math.max(0,Math.floor(e));else{let i=At(Se.STARTER_COVE,_e.BOOK_VALUE_I);n=Math.max(0,Number.isFinite(i)?i:0)}let r;try{r=Aw(n)}catch{r=c.fromInt(1)}try{t.set(r.clone?.()??r)}catch{}}function ui(e=Se.STARTER_COVE){if(Za)return Za;let t=Mt(e),n=[];if(e===Se.STARTER_COVE&&Se.DNA){let i=Mt(Se.DNA);n.push(...i)}let o=[...t,...n],r={coinValue:c.fromInt(1),xpValue:c.fromInt(1),mpValue:c.fromInt(1),goldValue:c.fromInt(1),magicValue:c.fromInt(1),waveValue:c.fromInt(1),bookValue:c.fromInt(1),coinSpawn:1,magnetRadius:0};for(let i of o){if(!i.effectType)continue;let s=i.area||e,l=Nn(s,i.id),a=Ve(l),u=null;if(typeof i.effectMultiplier=="function"?(u=i.effectMultiplier(a),!(u instanceof c)&&typeof u!="number"&&(u=c.fromAny(u??1))):u=c.fromInt(1),i.upgType==="HM"){let{selfMult:f,xpMult:d,coinMult:m,mpMult:v}=Ko(i,l,s);r.xpValue=bt(r.xpValue,d),r.coinValue=bt(r.coinValue,m),r.mpValue=bt(r.mpValue,v),u=bt(u,f)}if(i.effectType==="coin_spawn"){let f=1;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=1}else f=Number(u);r.coinSpawn*=f}else if(i.effectType==="coin_value")r.coinValue=bt(r.coinValue,u);else if(i.effectType==="xp_value")r.xpValue=bt(r.xpValue,u);else if(i.effectType==="mp_value")r.mpValue=bt(r.mpValue,u);else if(i.effectType==="gold_value")r.goldValue=bt(r.goldValue,u);else if(i.effectType==="magic_value")r.magicValue=bt(r.magicValue,u);else if(i.effectType==="wave_value")r.waveValue=bt(r.waveValue,u);else if(i.effectType==="book_value")r.bookValue=bt(r.bookValue,u);else if(i.effectType==="magnet_radius"){let f=0;if(u instanceof c)try{f=Number(u.toScientific())}catch{f=0}else f=Number(u);Number.isFinite(f)&&(r.magnetRadius+=f)}}for(let i of oy)try{let s=i();Number.isFinite(s)&&(r.coinSpawn*=s)}catch{}return Za=r,r}function hs(e){let t=ui(e);return{coinsPerSecondMult:t.coinSpawn,coinsPerSecondAbsolute:kw*t.coinSpawn,coinValueMultiplier:t.coinValue,xpGainMultiplier:t.xpValue,bookRewardMultiplier:t.bookValue,goldValueMultiplier:t.goldValue,magicValueMultiplier:t.magicValue}}function ci(){let{goldValue:e,magicValue:t,waveValue:n}=ui(Se.STARTER_COVE);try{R.gold?.mult?.set&&R.gold.mult.set(e)}catch{}try{if(R.magic?.mult?.set){let o=Pd(),r=bt(t,o);R.magic.mult.set(r)}}catch{}try{R.waves?.mult?.set&&R.waves.mult.set(n)}catch{}}function Uc(){try{let{mpValue:e}=ui(Se.STARTER_COVE);return e}catch{return c.fromInt(1)}}function Dc(){try{let{magnetRadius:e}=ui(Se.STARTER_COVE);return e||0}catch{return 0}}function iy(){try{zo()}catch{}ci(),Od(ci);try{uo(({baseMultiplier:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{coinValue:o}=ui(Se.STARTER_COVE);return bt(n,o)})}catch{}try{Vo(({baseGain:e,xpUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{xpValue:o}=ui(Se.STARTER_COVE);return bt(n,o)})}catch{}try{fi(({baseGain:e,mutationUnlocked:t})=>{if(!t)return e;let n=e instanceof c?e.clone?.()??e:c.fromAny(e??0),{mpValue:o}=ui(Se.STARTER_COVE);return bt(n,o)})}catch{}Ja(),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{try{Ja()}catch{}try{jt()}catch{}try{ci()}catch{}}),window.addEventListener("surge:level:change",()=>{try{ci()}catch{}}),window.addEventListener("surge:nerf:change",()=>{try{ci()}catch{}}))}var kw,Za,Bc,oy,$c=De(()=>{xt();vt();mo();An();go();ho();yn();kw=1,Za=null,Bc=[],oy=[]});var fy={};It(fy,{getLabCost:()=>cy,getLabLevel:()=>Zt,getLabLevelFromCoins:()=>uy,getLabLevelKey:()=>Fd,getRpMult:()=>Ss,getRpMultBase:()=>Hc,hasVisitedLab:()=>bs,initLabLogic:()=>Rw,initLabTab:()=>$d,setLabLevel:()=>pi,setLabVisited:()=>ly,updateLabLevel:()=>Ud,updateLabTab:()=>qd});function el(){let e=b();if(nl=e,e==null){jo=c.fromInt(0),di=!1;return}try{let t=localStorage.getItem(Gc(e));t?jo=c.fromAny(t):jo=c.fromInt(0)}catch{jo=c.fromInt(0)}try{di=localStorage.getItem(ay(e))==="1"}catch{di=!1}}function bs(){let e=b();return e==null?!1:((nl!==e||di===null)&&el(),di)}function ly(e){let t=b();if(t==null)return;let n=!!e;if(!(di===n&&nl===t)){di=n;try{localStorage.setItem(ay(t),n?"1":"0")}catch{}}}function Zt(){let e=b();return e==null?c.fromInt(0):R.coins.value.isInfinite()?c.fromAny("Infinity"):((nl!==e||jo===null)&&el(),jo)}function pi(e){let t=b();if(t!=null)try{let n=c.fromAny(e);if((nl!==t||jo===null)&&el(),n.cmp(jo)===0)return;jo=n,localStorage.setItem(Gc(t),n.toStorage()),window.dispatchEvent(new CustomEvent("lab:level:change",{detail:{slot:t,level:n}}))}catch{}}function cy(e){let t=c.fromAny(e);if(t.isInfinite())return c.fromAny("Infinity");try{if(t.cmp(1e15)<0){let s=20+Number(t.toPlainIntegerString());return new c(1n,{base:s,offset:0n})}if(t.cmp(c.fromScientific("1e1000000"))>0)return c.fromAny("Infinity");let n=t.toPlainIntegerString();if(n==="Infinity")return c.fromAny("Infinity");let r=20n+BigInt(n);return new c(1n,{base:0,offset:r})}catch(n){return console.error("Error calculating lab cost",n),c.fromAny("Infinity")}}function uy(e){if(!e||e.isZero()||e.isNegative())return c.fromInt(0);if(e.isInfinite())return c.fromAny("Infinity");let t;if(e._eOffset!==0n){let s=BigInt(e.e)+e._eOffset,l=Number(e.sig),a=Math.log10(l),u=Math.floor(a),f=s-20n+BigInt(u);return f<0n?c.fromInt(0):c.fromInt(f)}let n=e.e,o=Number(e.sig),r=Math.log10(o),i=n+r-20;return i<0?c.fromInt(0):c.fromInt(Math.floor(i))}function Ud(){let e=b();if(e!=null&&typeof window<"u"&&window.__cccLockedStorageKeys?.has(Gc(e)))return;let t=R.coins.value,n=Zt();if(t.isInfinite()){n.isInfinite()||pi(c.fromAny("Infinity"));return}let o=uy(t);o.cmp(n)>0&&pi(o)}function Rw(){el(),typeof window<"u"&&window.addEventListener("saveSlot:change",el),Ao(Ud),Ao(dy),py()}function Dd(e){return!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))}function Ow(e){if(!e||typeof e!="object")return 0;if(Dd(e))return Number.POSITIVE_INFINITY;let t=typeof e.toScientific=="function"?e.toScientific(18):String(e);if(!t||t==="Infinity")return Number.POSITIVE_INFINITY;let n=t.match(/^([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)$/i);if(n){let r=parseFloat(n[1]),i=parseInt(n[2],10);return!Number.isFinite(r)||!Number.isFinite(i)||i>=309?Number.POSITIVE_INFINITY:r*Math.pow(10,i)}let o=Number(t);return Number.isFinite(o)?o:Number.POSITIVE_INFINITY}function sy(e){if(Dd(e)||typeof e.cmp=="function"&&e.cmp(Pw)>=0)return vs.clone?.()??vs;let t=e.floorToInteger(),n=e.sub(t),o=Ow(n);if(!Number.isFinite(o))return vs.clone?.()??vs;let r=Math.pow(10,o);r=Number(r.toPrecision(15));let i=18,s=10n**BigInt(i),l=0n;r>=10&&(r/=10,l=1n);let a=BigInt(Math.round(r*Number(s))),u=t.toPlainIntegerString();if(u==="Infinity")return vs.clone?.()??vs;let d=BigInt(u)+l-BigInt(i),v=d%BigInt(250),p=Number(v),h=d-v;return new c(a,{base:p,offset:h})}function Hc(){let e=Zt();if(Dd(e))return c.fromAny("Infinity");if(se(12)){let o=ut(),r=5*o,i=2+o/2,s=Math.log10(i).toFixed(18),a=e.mulDecimal(s,18).add(c.fromAny(String(r)));return sy(a)}let n=e.mulDecimal("0.3010299956639812",18);return sy(n)}function Ss(){let e=Hc();return typeof Zn=="function"?Zn("rp",e):e}function $d(e){e&&(e.innerHTML="",e.style.position="relative",e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",Qa&&Qa.destroy(),Qa=new Bd(e))}function qd(){ly(!0),Qa&&Qa.resize()}var _r,gs,ys,ay,Gc,jo,di,nl,Fd,vs,Pw,Qa,qc,Bd,hi=De(()=>{vt();vo();xt();qt();yn();si();cs();Jo();gi();ho();_r=1e308,gs=1e300,ys=1e-300,ay=e=>`ccc:lab:visited:${e}`,Gc=e=>`ccc:lab:level:${e}`,jo=null,di=null,nl=null;Fd=e=>Gc(e);vs=c.fromAny("Infinity"),Pw=c.fromScientific(String(c.MAX_E));Qa=null;qc=512*.95,Bd=class{constructor(t){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.classList.add("lab-bg-canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.statsContainer=document.createElement("div"),this.statsContainer.style.position="absolute",this.statsContainer.style.top="0px",this.statsContainer.style.left="50%",this.statsContainer.style.transform="translateX(-50%)",this.statsContainer.style.zIndex="10",this.statsContainer.style.display="flex",this.statsContainer.style.flexDirection="column",this.statsContainer.style.alignItems="center",this.statsContainer.style.gap="0px",this.statsContainer.style.pointerEvents="none",this.statsContainer.style.width="100%",this.statsContainer.style.overflow="hidden",this.statsContainer.classList.add("lab-stats-container");let n=(s,l,a="1px")=>{s.style.fontFamily="var(--font-ui), system-ui, sans-serif",s.style.fontWeight="900",s.style.color="#fff",s.style.fontSize=l,s.style.webkitTextStroke=`${a} #000`,s.style.textShadow="0 1px 0 rgba(0,0,0,0.35)",s.style.letterSpacing="0.5px",s.style.lineHeight="1",s.style.textAlign="center",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis"},o=s=>{s.style.backgroundColor="#151b2b",s.style.background="linear-gradient(180deg, #253650, #151b2b)",s.style.border="3px solid #000",s.style.borderRadius="0",s.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.boxSizing="border-box",s.style.margin="0 auto"};this.levelBar=document.createElement("div"),this.levelBar.innerHTML=`Lab Level: ${K(Zt())}`,o(this.levelBar),n(this.levelBar,"26px","1px"),this.levelBar.style.padding="8px 12px",this.levelBar.style.height="42px",this.levelBar.style.width="var(--coin-bar-w)",this.statsContainer.appendChild(this.levelBar),this.coinsBar=document.createElement("div"),this.coinsBar.innerHTML="Coins needed to increment Lab Level: 0",o(this.coinsBar),n(this.coinsBar,"16px","0.9px"),this.coinsBar.style.padding="6px 12px",this.coinsBar.style.height="32px",this.coinsBar.style.width="calc(var(--coin-bar-w) * 0.9)",this.coinsBar.style.pointerEvents="auto",this.coinsBar.style.cursor="pointer",this.coinsBar.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),Ud()}),this.statsContainer.appendChild(this.coinsBar),this.nerfBar=document.createElement("div"),this.nerfBar.textContent="Tsunami Exponent: ^0.00",o(this.nerfBar),n(this.nerfBar,"14px","0.8px"),this.nerfBar.style.padding="4px 12px",this.nerfBar.style.height="26px",this.nerfBar.style.width="calc(var(--coin-bar-w) * 0.8)",this.statsContainer.appendChild(this.nerfBar),this.container.appendChild(this.statsContainer),this.returnBtn=document.createElement("button"),this.returnBtn.textContent="Return to (0,0)",this.returnBtn.style.position="absolute",this.returnBtn.style.top="50%",this.returnBtn.style.left="50%",this.returnBtn.style.transform="translate(-50%, -50%)",this.returnBtn.style.zIndex="10",this.returnBtn.style.display="none",this.returnBtn.style.padding="10px 20px",this.returnBtn.style.fontSize="16px",this.returnBtn.style.cursor="pointer",this.returnBtn.style.backgroundColor="#151b2b",this.returnBtn.style.background="linear-gradient(180deg, #253650, #151b2b)",this.returnBtn.style.color="#fff",this.returnBtn.style.border="2px solid #000",this.returnBtn.style.borderRadius="4px",this.returnBtn.addEventListener("click",()=>{this.camX=0,this.camY=0,this.zoom=.15,this.returnBtn.style.display="none"}),this.container.appendChild(this.returnBtn),this.helpText=document.createElement("div"),this.helpText.style.position="absolute",this.helpText.style.bottom="8px",this.helpText.style.left="12px",this.helpText.style.pointerEvents="none",this.helpText.style.zIndex="10",this.helpText.style.fontFamily="var(--font-ui), system-ui, sans-serif",this.helpText.style.fontSize="14px",this.helpText.style.lineHeight="1.5",this.helpText.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";let r=Je?[["Node Details:","Tap"],["Move Camera:","Tap and hold"],["Zoom In/Out:","Pinch screen"]]:[["Node Details:","Left click"],["Toggle Node:","Right click"],["Move Camera:","Left click and drag or WASD"],["Zoom In/Out:","Scroll"]],i="";for(let[s,l]of r)i+=`<div><span style="color: #fff; font-weight: 400;">${s}</span><span style="color: #ccc; margin-left: 6px;">${l}</span></div>`;this.helpText.innerHTML=i,this.container.appendChild(this.helpText),this.camX=0,this.camY=0,this.zoom=.15,this.bursts=[],this.baseImage=new Image,this.baseImage.src="img/stats/rp/rp_base.webp",this.activeBorderImage=new Image,this.activeBorderImage.src="img/misc/green_border.webp",this.maxedBorderImage=new Image,this.maxedBorderImage.src="img/misc/maxed.webp",this.nodeImages={},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastMouse={x:0,y:0},this.dragDistance=0,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.lastTime=0,this.frameId=null,this.pinchDist=null,this.lastTouch=null,this.binds=[],this.setupInput(),this.observer=new IntersectionObserver(s=>{s[0].isIntersecting?this.start():this.stop()},{threshold:0}),this.observer.observe(t),requestAnimationFrame(()=>this.resize()),this.lastRenderedLevel=null}addBind(t,n,o,r){t.addEventListener(n,o,r),this.binds.push({target:t,type:n,handler:o})}setupInput(){this.addBind(this.canvas,"contextmenu",t=>t.preventDefault()),this.addBind(this.canvas,"mousedown",this.onMouseDown.bind(this)),this.addBind(window,"mousemove",this.onMouseMove.bind(this)),this.addBind(window,"mouseup",this.onMouseUp.bind(this)),this.addBind(this.canvas,"wheel",this.onWheel.bind(this),{passive:!1}),this.addBind(this.canvas,"touchstart",this.onTouchStart.bind(this),{passive:!1}),this.addBind(this.canvas,"touchmove",this.onTouchMove.bind(this),{passive:!1}),this.addBind(this.canvas,"touchend",this.onTouchEnd.bind(this)),this.addBind(window,"keydown",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}),this.addBind(window,"keyup",t=>{this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1)}),this.addBind(window,"resize",this.resize.bind(this))}destroy(){this.stop(),this.observer.disconnect();for(let t of this.binds)t.target.removeEventListener(t.type,t.handler);this.canvas.remove(),this.returnBtn.remove(),this.helpText.remove(),this.statsContainer.remove(),this.overlay&&this.overlay.remove()}resize(){if(!this.container.isConnected)return;let t=this.container.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=t.width,this.height=t.height,this.canvas.width=Math.floor(this.width*n),this.canvas.height=Math.floor(this.height*n),this.ctx.scale(n,n),this.render()}start(){this.frameId||(this.lastTime=performance.now(),this.loop())}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}loop(){let t=performance.now(),n=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.update(n),this.render(),this.frameId=requestAnimationFrame(()=>this.loop())}checkBounds(){let t=Math.abs(this.camX)>1e10||Math.abs(this.camY)>1e10,n=this.zoom>1e10||this.zoom<1e-10;t||n?this.returnBtn.style.display="block":this.returnBtn.style.display="none",this.camX>_r&&(this.camX=_r),this.camX<-_r&&(this.camX=-_r),this.camY>_r&&(this.camY=_r),this.camY<-_r&&(this.camY=-_r),this.zoom>gs&&(this.zoom=gs),this.zoom<ys&&(this.zoom=ys)}update(t){this.checkBounds();let n=Zt(),o=cy(n.add(1)),r=Rn(),i=Jn(),s=r+i;s>1&&(s=1),(!this.lastRenderedLevel||n.cmp(this.lastRenderedLevel)!==0||!this.lastCost||o.cmp(this.lastCost)!==0)&&(this.levelBar.innerHTML=`Lab Level: ${K(n)}`,this.coinsBar.innerHTML=`Coins needed to increment Lab Level: ${K(o)}`,this.lastRenderedLevel=n,this.lastCost=o),s!==this.lastRenderedNerf&&(this.nerfBar.textContent=`Tsunami Exponent: ^${s.toFixed(2)}`,this.lastRenderedNerf=s);for(let d=this.bursts.length-1;d>=0;d--){let m=this.bursts[d];m.time+=t;for(let v of m.particles)v.x+=v.vx*t,v.y+=v.vy*t,v.vx*=.95,v.vy*=.95;m.time>=m.life&&this.bursts.splice(d,1)}let a=500/this.zoom,u=0,f=0;if(this.keys.KeyW&&(f-=1),this.keys.KeyS&&(f+=1),this.keys.KeyA&&(u-=1),this.keys.KeyD&&(u+=1),u!==0||f!==0){let d=Math.sqrt(u*u+f*f);u/=d,f/=d,this.camX+=u*a*t,this.camY+=f*a*t}this.activeOverlayId!=null&&this.updateNodeOverlay()}getNodePosition(t){return{x:t.x,y:t.y}}render(){let t=this.ctx,n=this.width,o=this.height,r=this.zoom;t.fillStyle="#080d18",t.fillRect(0,0,n,o);let i=100,s=Math.log10(r),l=Math.floor(-s+.3),u=100/r,f=Math.floor(Math.log10(u)),d=Math.pow(10,f),m=(L,F)=>{if(F<=0)return;t.strokeStyle=`rgba(60, 100, 160, ${.15*F})`,t.lineWidth=1,t.beginPath();let T=Math.floor((this.camX-n/2/r)/L)*L,C=Math.ceil((this.camX+n/2/r)/L)*L;if((C-T)/L>1e3)return;for(let ae=T;ae<=C&&!(ae+L<=ae);ae+=L){let he=(ae-this.camX)*r+n/2;t.moveTo(he,0),t.lineTo(he,o)}let Y=Math.floor((this.camY-o/2/r)/L)*L,Q=Math.ceil((this.camY+o/2/r)/L)*L;for(let ae=Y;ae<=Q&&!(ae+L<=ae);ae+=L){let he=(ae-this.camY)*r+o/2;t.moveTo(0,he),t.lineTo(n,he)}t.stroke()},v=d*r,p=Math.max(0,Math.min(1,(v-15)/25));m(d,p),m(d*10,1),t.strokeStyle="rgba(60, 100, 160, 0.5)",t.lineWidth=2,t.beginPath();let h=(0-this.camY)*r+o/2;h>=-10&&h<=o+10&&(t.moveTo(0,h),t.lineTo(n,h));let g=(0-this.camX)*r+n/2;g>=-10&&g<=n+10&&(t.moveTo(g,0),t.lineTo(g,o)),t.stroke();let y=[],I=new Map;for(let L of Nt)Cr(L.id)&&(y.push(L),I.set(L.id,this.getNodePosition(L)));t.strokeStyle="#2a5298",t.lineWidth=20*r,t.lineCap="round",t.beginPath();for(let L of y)if(L.parentIds&&L.parentIds.length>0)for(let F of L.parentIds){let T=Nt.find(C=>C.id===F);if(T&&I.has(T.id)){let C=I.get(T.id),Y=I.get(L.id),Q=(C.x-this.camX)*r+n/2,ae=(C.y-this.camY)*r+o/2,he=(Y.x-this.camX)*r+n/2,be=(Y.y-this.camY)*r+o/2;t.moveTo(Q,ae),t.lineTo(he,be)}}t.stroke();let E=qc,M=E*r,G=E*1.6*r;for(let L of y){let F=I.get(L.id),T=(F.x-this.camX)*r+n/2,C=(F.y-this.camY)*r+o/2,Y=it(L.id),Q=Y>=L.maxLevel,ae=!0;if(T+G/2<0||T-G/2>n||C+G*.8<0||C-G/2>o)continue;this.baseImage.complete&&this.baseImage.naturalWidth!==0&&t.drawImage(this.baseImage,T-G/2,C-G/2,G,G),Q?this.maxedBorderImage.complete&&this.maxedBorderImage.naturalWidth!==0&&t.drawImage(this.maxedBorderImage,T-G/2,C-G/2,G,G):Zo(L.id)&&this.activeBorderImage.complete&&this.activeBorderImage.naturalWidth!==0&&t.drawImage(this.activeBorderImage,T-G/2,C-G/2,G,G);let be=this.nodeImages[L.id];if(be||(be=new Image,be.src="img/"+L.icon,this.nodeImages[L.id]=be),be.complete&&be.naturalWidth!==0&&t.drawImage(be,T-M/2,C-M/2,M,M),ae){let Oe=tl(L.id),ke=0;if(Q)ke=1;else if(Oe.isInfinite?.()||typeof Oe.cmp=="function"&&Oe.cmp(c.fromAny("Infinity"))===0)ke=0;else{let H=yo(L.id);if(H.isZero?.())ke=0;else try{if(Oe.isZero?.())ke=1;else{let de=H.div(Oe).toScientific(5);ke=Number(de)}}catch{ke=0}}ke=Math.max(0,Math.min(1,ke));let U=G*.96,W=G*.18,q=T-U/2,X=C+G/2+G*.05;t.fillStyle="#111",t.fillRect(q,X,U,W);let J=t.createLinearGradient(q,X,q,X+W);J.addColorStop(0,"#2a5298"),J.addColorStop(1,"#1e3c72"),t.fillStyle=J,t.fillRect(q,X,U*ke,W),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*r),t.strokeRect(q,X,U,W),t.fillStyle="#fff",t.font=`bold ${W*.7}px system-ui`,t.textAlign="center",t.textBaseline="alphabetic",t.strokeStyle="#000",t.lineWidth=Math.max(.5,W*.08);let le="";{let H=K(c.fromAny(Y));H.indexOf("<")>=0&&(H="\u221E"),le=`Level ${H}`}Q&&(le=L.maxLevel===1?"UNLOCKED":"MAXED");let fe=t.measureText(le),_=X+W/2+(fe.actualBoundingBoxAscent-fe.actualBoundingBoxDescent)/2;t.strokeText(le,q+U/2,_),t.fillText(le,q+U/2,_)}}let P=35,$=[{delay:0,dur:.5},{delay:.05,dur:.55},{delay:.1,dur:.6}];for(let L of this.bursts){let F=(L.x-this.camX)*this.zoom+n/2,T=(L.y-this.camY)*this.zoom+o/2;for(let C=0;C<$.length;C++){let Y=$[C],Q=L.time-Y.delay;if(Q>0&&Q<Y.dur){let ae=Q/Y.dur,he=1-Math.pow(1-ae,3),be=P*he,Oe=Math.max(0,1-Math.pow(ae,2)),ke=1+C*.5,U=t.createRadialGradient(F,T,be*.6,F,T,be);U.addColorStop(0,"rgba(255, 200, 50, 0)"),U.addColorStop(.7,`rgba(255, 170, 20, ${Math.min(1,Oe*.15*ke)})`),U.addColorStop(.9,`rgba(255, 240, 80, ${Math.min(1,Oe*.2*ke)})`),U.addColorStop(1,"rgba(255, 200, 50, 0)"),t.fillStyle=U,t.beginPath(),t.arc(F,T,be,0,Math.PI*2),t.fill()}}t.shadowBlur=8,t.shadowColor="#ffff00";for(let C of L.particles)if(L.time<C.life){let Y=1-L.time/C.life,Q=F+C.x,ae=T+C.y;t.fillStyle=`rgba(255, 255, 150, ${Y})`,t.beginPath(),t.arc(Q,ae,2,0,Math.PI*2),t.fill()}t.shadowBlur=0}}addBurst(t,n){let o=[];for(let i=0;i<10;i++){let s=Math.random()*Math.PI*2,l=30+Math.random()*40;o.push({x:0,y:0,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:.4+Math.random()*.3})}this.bursts.push({x:t,y:n,time:0,life:.7,particles:o})}addBurstFromScreen(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom;this.addBurst(s,l)}handleClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=qc/2*1.6;for(let u of Nt){if(!Cr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){this.openNodeOverlay(u.id);return}}}openNodeOverlay(t){let n=Nt.find(m=>m.id===t);if(!n)return;this.activeOverlayId=t,this.overlay&&this.overlay.remove(),this.overlay=document.createElement("div"),this.overlay.className="upg-overlay",this.overlay.style.zIndex="4005";let o=document.createElement("div");o.className="upg-sheet",o.style.gridTemplateRows="auto auto 1fr auto";let r=document.createElement("div");r.className="upg-grabber",r.innerHTML='<div class="grab-handle"></div>';let i=document.createElement("div");i.className="upg-header";let s=document.createElement("div");s.className="upg-title",s.textContent=n.title,this.overlayLevel=document.createElement("div"),this.overlayLevel.className="upg-level",i.append(s,this.overlayLevel);let l=document.createElement("div");l.className="upg-content";let a=document.createElement("div");a.className="upg-desc centered",a.innerHTML=n.desc;let u=document.createElement("div");u.className="upg-info",this.overlayBonus=document.createElement("div"),this.overlayBonus.className="upg-line",this.overlayActiveStatus=document.createElement("div"),this.overlayActiveStatus.className="upg-line",this.overlayProgress=document.createElement("div"),this.overlayProgress.className="upg-line",this.overlayProgress.style.color="#aaa",u.append(this.overlayBonus,this.overlayActiveStatus,this.overlayProgress),l.append(a,u);let f=document.createElement("div");f.className="upg-actions",this.overlayToggleBtn=document.createElement("button"),this.overlayToggleBtn.className="shop-delve",this.overlayToggleBtn.textContent="Toggle",this.overlayToggleBtn.onclick=()=>{let m=Zo(t);mi(t,!m),this.updateNodeOverlay()};let d=document.createElement("button");d.className="shop-close",d.textContent="Close",d.onclick=()=>{this.activeOverlayId=null,this.overlay&&(this.overlay.classList.remove("is-open"),setTimeout(()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},300))},f.append(d,this.overlayToggleBtn),o.append(r,i,l,f),this.overlay.appendChild(o),document.body.appendChild(this.overlay),Gd(r,o,()=>!!this.overlay,()=>d.click()),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add("is-open")}),this.updateNodeOverlay()}updateNodeOverlay(){if(this.activeOverlayId==null||!this.overlay)return;let t=Nt.find(l=>l.id===this.activeOverlayId);if(!t||!Cr(t.id)){this.overlay&&this.overlay.remove(),this.activeOverlayId=null,this.overlay=null;return}let n=it(t.id),o=yo(t.id),r=tl(t.id),i=Zo(t.id),s=n>=t.maxLevel;if(s){let l="(MAXED)";this.overlayLevel.innerHTML=`Level ${K(c.fromAny(n))} / ${K(c.fromAny(t.maxLevel))} ${l}`,this.overlayActiveStatus.style.display="none",this.overlayProgress.style.display="none",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="none")}else this.overlayLevel.innerHTML=`Level ${K(c.fromAny(n))} / ${K(c.fromAny(t.maxLevel))}`,this.overlayActiveStatus.style.display="",this.overlayProgress.style.display="",this.overlayToggleBtn&&(this.overlayToggleBtn.style.display="");if(typeof t.bonusLine=="function"){let l=t.bonusLine(n);l?(this.overlayBonus.style.display="",this.overlayBonus.innerHTML=l):this.overlayBonus.style.display="none"}else this.overlayBonus.style.display="none";if(!s){this.overlayActiveStatus.textContent=`Currently active: ${i?"Yes":"No"}`,this.overlayActiveStatus.style.color=i?"#4f4":"#f44",this.overlayActiveStatus.style.webkitTextFillColor=i?"#4f4":"#f44";let l=o.cmp(1e9)>0?K(o):o.toString(),a=r.isInfinite?.()?"Infinity":r.cmp(1e9)>0?K(r):r.toString();this.overlayProgress.innerHTML=`RP to next level: ${K(o)} / ${K(r)}`}}handleRightClick(t,n){let o=this.canvas.getBoundingClientRect(),r=t-o.left,i=n-o.top,s=this.camX+(r-this.width/2)/this.zoom,l=this.camY+(i-this.height/2)/this.zoom,a=qc/2*1.6;for(let u of Nt){if(!Cr(u.id))continue;let f=this.getNodePosition(u),d=s-f.x,m=l-f.y;if(Math.sqrt(d*d+m*m)<=a){if(it(u.id)>=u.maxLevel)return;let h=Zo(u.id);mi(u.id,!h),this.activeOverlayId===u.id&&this.updateNodeOverlay();return}}}onMouseDown(t){if(t.button===2){this.handleRightClick(t.clientX,t.clientY);return}t.button===0&&(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastMouse={x:t.clientX,y:t.clientY},this.addBurstFromScreen(t.clientX,t.clientY))}onMouseMove(t){if(this.isDragging){let u=t.clientX-this.lastMouse.x,f=t.clientY-this.lastMouse.y;this.lastMouse={x:t.clientX,y:t.clientY},this.camX-=u/this.zoom,this.camY-=f/this.zoom,this.canvas.style.cursor="grabbing";return}this.lastMouse={x:t.clientX,y:t.clientY};let n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top,i=this.camX+(o-this.width/2)/this.zoom,s=this.camY+(r-this.height/2)/this.zoom,l=!1,a=qc/2*1.6;for(let u of Nt){if(!Cr(u.id))continue;let f=this.getNodePosition(u),d=i-f.x,m=s-f.y;if(Math.sqrt(d*d+m*m)<=a){l=!0;break}}this.canvas.style.cursor=l?"pointer":"default"}onMouseUp(t){if(!this.isDragging)return;this.isDragging=!1,this.canvas.style.cursor="default",Math.sqrt(Math.pow(t.clientX-this.dragStart.x,2)+Math.pow(t.clientY-this.dragStart.y,2))<10&&this.handleClick(t.clientX,t.clientY),this.onMouseMove(t)}onWheel(t){t.preventDefault();let o=-t.deltaY*.001,r=this.zoom,i=r*(1+o);i<ys&&(i=ys),i>gs&&(i=gs);let s=this.canvas.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top,u=this.camX+(l-this.width/2)/r,f=this.camY+(a-this.height/2)/r;this.zoom=i,this.camX=u-(l-this.width/2)/i,this.camY=f-(a-this.height/2)/i}getTouchDist(t){let n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(t){return{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2}}onTouchStart(t){t.preventDefault(),t.touches.length===1?(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dragStart={x:t.touches[0].clientX,y:t.touches[0].clientY},this.addBurstFromScreen(t.touches[0].clientX,t.touches[0].clientY)):t.touches.length===2&&(this.isDragging=!1,this.pinchDist=this.getTouchDist(t.touches))}onTouchMove(t){if(t.preventDefault(),t.touches.length===1&&this.isDragging){let n=t.touches[0].clientX-this.lastTouch.x,o=t.touches[0].clientY-this.lastTouch.y;this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY},this.camX-=n/this.zoom,this.camY-=o/this.zoom}else if(t.touches.length===2){let n=this.getTouchDist(t.touches);if(this.pinchDist>0){let o=n/this.pinchDist,r=this.zoom,i=r*o;i<ys&&(i=ys),i>gs&&(i=gs);let s=this.getTouchCenter(t.touches),l=this.canvas.getBoundingClientRect(),a=s.x-l.left,u=s.y-l.top,f=this.camX+(a-this.width/2)/r,d=this.camY+(u-this.height/2)/r;this.zoom=i,this.camX=f-(a-this.width/2)/i,this.camY=d-(u-this.height/2)/i,this.pinchDist=n}}}onTouchEnd(t){t.touches.length===0?(this.isDragging&&Math.sqrt(Math.pow(this.lastTouch.x-this.dragStart.x,2)+Math.pow(this.lastTouch.y-this.dragStart.y,2))<10&&this.handleClick(this.lastTouch.x,this.lastTouch.y),this.isDragging=!1):t.touches.length===1&&(this.isDragging=!0,this.lastTouch={x:t.touches[0].clientX,y:t.touches[0].clientY})}}});var vy={};It(vy,{addExternalEacAmountMultiplierProvider:()=>Vd,addExternalEacMultiplierProvider:()=>Bw,getAutobuyerToggle:()=>yi,getEacAmountMultiplier:()=>Yc,initAutomationEffects:()=>qw,setAutobuyerToggle:()=>Mr,setTsunamiBonusProvider:()=>Xd,updateAutomation:()=>yy});function Xd(e){my=e}function Bw(e){typeof e=="function"&&hy.push(e)}function Vd(e){typeof e=="function"&&gy.push(e)}function Yc(){let e=1;if(se(2))if(se(8)){let t=Rn(),n=my(),o=t+n;o>1&&(o=1),e*=Math.pow(10,o)}else e*=10;for(let t of gy)try{let n=t();Number.isFinite(n)&&(e*=n)}catch{}return e}function Yd(e){Vc!==e&&(Is.clear(),Vc=e)}function yi(e,t){let n=b();Yd(n);let o=n!=null?`:${n}`:"",r=`ccc:autobuy:${e}:${t}${o}`;if(Is.has(r))return Is.get(r);let i="1";try{let s=localStorage.getItem(r);s!==null&&(i=s)}catch{}return Is.set(r,i),i}function Mr(e,t,n){let o=b();Yd(o);let r=o!=null?`:${o}`:"",i=`ccc:autobuy:${e}:${t}${r}`,s=String(n);Is.set(i,s);try{localStorage.setItem(i,s)}catch{}}function Fw(e){yy(e),$w(e)}function Uw(){if(Xc)return Xc;let e=[...Mt(Se.STARTER_COVE),...Mt(Se.DNA)],t={};for(let n of e){let o=n.costType;t[o]||(t[o]=[]),t[o].push(n)}return Xc=t,Xc}function Dw(e){if(!(!e||e.length===0))for(let t of e){let n=t.area||Se.STARTER_COVE;if(yi(n,t.id)!=="0"){let r=At(n,t.id),i=t.lvlCap??1/0;r<i&&zd(n,t.id)}}}function $w(e){let t=b();Yd(t);let n=Uw();for(let[r,i]of Object.entries(ms)){let s=Number(r);At(Ze,s)>0&&n[i]&&Dw(n[i])}At(Ze,po)>0&&(Hd++,Hd>=5&&(Hd=0,yi(Ze,po)!=="0"&&Wc()))}function yy(e){let n=At(Ze,ai);for(let r of hy)try{let i=r();Number.isFinite(i)&&(n*=i)}catch{}if(n<=0){ol=0;return}ol+=e;let o=1/n;if(ol>=o){let r=Math.floor(ol/o);if(r>0){let i=r;i*=Yc(),Wd(i),ol-=r*o}}}function qw(){Ao(Fw),typeof window<"u"&&window.addEventListener("saveSlot:change",e=>{let t=e.detail?.slot;t&&t!==Vc&&(Is.clear(),Vc=t)})}var ol,Hd,my,hy,gy,Is,Vc,Xc,ws=De(()=>{si();ho();rl();li();Es();vt();yn();ol=0,Hd=0,my=()=>0;hy=[];gy=[];Is=new Map,Vc=null;Xc=null});function Kd(){let e=b();if(xy=e,e==null){il=!1;return}try{il=localStorage.getItem(Gw(e))==="1"}catch{il=!1}}function Qo(e){return xs.nodes[e]||(xs.nodes[e]={rp:c.fromInt(0),level:0,active:!1,discovered:!1}),xs.nodes[e]}function Hw(e,t){let n=Qo(t);try{let o=localStorage.getItem(sl(e,t));n.level=o?parseInt(o,10):0;let r=localStorage.getItem(al(e,t));n.rp=r?c.fromAny(r):c.fromInt(0);let i=localStorage.getItem(wy(e,t));n.active=i==="1";let s=localStorage.getItem(Ey(e,t));n.discovered=s==="1"}catch{n.level=0,n.rp=c.fromInt(0),n.active=!1,n.discovered=!1}}function by(){Kd();let e=b();xs.nodes={},Qn=null,e!=null&&Nt.forEach(t=>{Hw(e,t.id),xs.nodes[t.id].active&&(Qn=t.id)})}function Sy(){let e=b();e!=null&&Nt.forEach(t=>{let n=xs.nodes[t.id];if(n)try{localStorage.setItem(al(e,t.id),n.rp.toStorage())}catch{}})}function it(e){return Qo(e).level}function bo(e,t){let n=b();if(n==null||Kt(sl(n,e)))return!1;let o=Qo(e);if(o.level===t)return!0;o.level=t;try{localStorage.setItem(sl(n,e),t.toString()),window.dispatchEvent(new CustomEvent("lab:node:change",{detail:{id:e,level:t}}))}catch{}return!0}function yo(e){return Qo(e).rp}function vi(e,t){let n=b();if(n!=null&&Kt(al(n,e)))return;let o=Qo(e);o.rp=c.fromAny(t);try{window.dispatchEvent(new CustomEvent("lab:node:rp",{detail:{id:e,rp:o.rp}}))}catch{}}function Zo(e){return Qo(e).active}function mi(e,t){let n=b();if(n==null)return;let o=!!t;o?(Qn!==null&&Qn!==e&&mi(Qn,!1),Qn=e):Qn===e&&(Qn=null);let r=Qo(e);if(r.active!==o){r.active=o;try{localStorage.setItem(wy(n,e),r.active?"1":"0"),window.dispatchEvent(new CustomEvent("lab:node:active",{detail:{id:e,active:r.active}}))}catch{}}}function Iy(e,t){let n=b();if(n==null)return;let o=Qo(e);if(o.discovered!==!!t){o.discovered=!!t;try{localStorage.setItem(Ey(n,e),o.discovered?"1":"0")}catch{}}}function Cr(e){let t=On.get(e);if(!t)return!1;if(Qo(e).discovered)return!0;if(!t.parentIds||t.parentIds.length===0)return Iy(e,!0),!0;if((e===5||e===6)&&((xy!==b()||il===null)&&Kd(),!il))return!1;for(let o of t.parentIds){let r=On.get(o);if(!r)continue;if(it(o)<r.maxLevel)return!1}return Iy(e,!0),!0}function tl(e){let t=On.get(e);if(!t)return c.fromAny("Infinity");let n=it(e);if(n>=t.maxLevel)return c.fromAny("Infinity");let o=c.fromAny(t.scale),r=Ee(o),i=c.fromAny(t.baseRpReq),l=Ee(i)+n*r;return ie(l)}function Jn(){let e=0,t=it(1);t>0&&(e+=t*.01);let n=it(10);return n>0&&(e+=n*.01),e}function Ly(){return it(4)>=1}function _y(e=[]){if(b()!=null){try{pi(0)}catch{}Qn!==null&&mi(Qn,!1),Nt.forEach(n=>{e.includes(n.id)||(bo(n.id,0),vi(n.id,c.fromInt(0)))})}}function dy(e){let t=Ss();if(t.isZero?.()||Qn===null)return;let n=On.get(Qn);if(!n||!Cr(n.id))return;let r=t.mulDecimal(e.toString(),18),i=yo(n.id);if(it(n.id)>=n.maxLevel)return;let s=i.add(r),l=it(n.id);if(l<n.maxLevel||!Number.isFinite(n.maxLevel)){let a=tl(n.id),u=Ee(s),f=Ee(a);if(u-f>2){let d=0n,m=c.zero(),v=c.fromAny(n.scale),p=v.sub(1),h=!1;if((p.isZero()||Math.abs(Number(v.toScientific())-1)<1e-9)&&(h=!0),h){let y=s.div(a).floorToInteger().toPlainIntegerString();(y==="Infinity"||y.length>15)&&(y="9007199254740991");try{d=BigInt(y)}catch{d=0n}if(Number.isFinite(n.maxLevel)){let I=BigInt(n.maxLevel)-BigInt(l);d>I&&(d=I)}d>0n&&(m=a.mulScaledInt(d,0))}else if(p.isZero()===!1&&(p.sig>0n||p.isInfinite())){let g=Ee(v),y=Ee(p),I=u-f+y,E=Math.floor(I/g);if(E>5){let M=BigInt(Math.max(0,E-5));if(Number.isFinite(n.maxLevel)){let A=BigInt(n.maxLevel)-BigInt(l);M>A&&(M=A)}if(M>0n){d=M;let A=Number(d)*g,P=ie(A).sub(1).div(p);m=a.mulBigNumInteger(P)}}}if(d>0n){s=s.sub(m);let g=l+Number(d);bo(n.id,g)}}}for(;;){let a=tl(n.id);if(s.cmp(a)<0||it(n.id)>=n.maxLevel)break;s=s.sub(a);let u=it(n.id),f=u+1;if(f<=u||!bo(n.id,f))break}vi(n.id,s)}function Ty(){let e=On.get(2);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*Cy)}function ky(){let e=On.get(3);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*Cy)}function bi(){let e=On.get(5);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*My)}function jd(){let e=On.get(6);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*My)}function Vw(){let e=On.get(7);if(!e)return c.fromInt(1);let t=it(e.id);return t<=0?c.fromInt(1):ie(t*Xw)}function Ay(){let e=On.get(8);return e?1+it(e.id)*.1:1}function Ny(){let e=On.get(9);return e?1+it(e.id)*.1:1}function py(){uo(({baseMultiplier:e})=>{let t=Ty();return e.mulDecimal(t.toScientific())}),Vo(({baseGain:e})=>{let t=ky();return e.mulDecimal(t.toScientific())}),ry(()=>Ay()),Vd(()=>Ny()),Xd(()=>Jn()),typeof window<"u"&&window.addEventListener("lab:node:change",({detail:e})=>{e&&e.id===2&&jt(),e&&e.id===8&&Fc()})}var sl,al,wy,Ey,Gw,Nt,On,il,xy,xs,Qn,Cy,My,Xw,Jo=De(()=>{xt();vt();hi();qt();An();$c();ws();sl=(e,t)=>`ccc:lab:node:level:${t}:${e}`,al=(e,t)=>`ccc:lab:node:rp:${t}:${e}`,wy=(e,t)=>`ccc:lab:node:active:${t}:${e}`,Ey=(e,t)=>`ccc:lab:node:discovered:${t}:${e}`,Gw=e=>`ccc:reset:experiment:completed:${e}`,Nt=[{id:1,title:"Node 1: Tsunami Exponent Buff",desc:"Increases the Tsunami Exponent by +0.01 per level",baseRpReq:10,scale:2,maxLevel:10,x:0,y:0,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`},{id:2,title:"Node 2: Experimental Coin Value",desc:"Multiplies Coin value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:-1e3,y:1e3,icon:"lab_icons/coin_val0.webp",bonusLine:e=>`Coin value bonus: ${Te(Ty())}x`},{id:3,title:"Node 3: Experimental XP Value",desc:"Multiplies XP value by 2x per level",baseRpReq:1e3,scale:2,maxLevel:10,parentIds:[1],x:1e3,y:1e3,icon:"sc_upg_icons/xp_val1.webp",bonusLine:e=>`XP value bonus: ${Te(ky())}x`},{id:4,title:"Node 4: Unlock Experiment",desc:"Unlocks the Experiment reset",baseRpReq:1e6,scale:1,maxLevel:1,x:0,y:-1e3,icon:"misc/experiment.webp",parentIds:[2,3],bonusLine:()=>""},{id:5,title:"Node 5: Experimental Gold Value",desc:"Multiplies Gold value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:-1e3,y:-1e3,icon:"lab_icons/gold_val0.webp",parentIds:[4],bonusLine:e=>`Gold value bonus: ${Te(bi())}x`},{id:6,title:"Node 6: Experimental Magic Value",desc:"Multiplies Magic value by 3x per level",baseRpReq:1e6,scale:2,maxLevel:10,x:1e3,y:-1e3,icon:"lab_icons/magic_val0.webp",parentIds:[4],bonusLine:e=>`Magic value bonus: ${Te(jd())}x`},{id:7,title:"Node 7: Experimental Wave Value",desc:"Multiplies Wave value by 1.1x per level",baseRpReq:1e8,scale:2,maxLevel:10,x:0,y:1e3,icon:"lab_icons/wave_val0.webp",parentIds:[5,6],bonusLine:e=>`Wave value bonus: ${Te(Vw())}x`},{id:8,title:"Node 8: Experimental Spawn Rate",desc:"Increases Coin Spawn Rate by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:-1e3,y:0,icon:"sc_upg_icons/faster_coins1.webp",parentIds:[7],bonusLine:e=>`Coin Spawn Rate bonus: ${Te(Ay())}x`},{id:9,title:"Node 9: Experimental EAC Value",desc:"Increases Effective Auto-Collect value by +10% per level",baseRpReq:1e10,scale:2,maxLevel:10,x:1e3,y:0,icon:"sc_upg_icons/effective_auto_collect.webp",parentIds:[7],bonusLine:e=>`EAC value bonus: ${Te(Ny())}x`},{id:10,title:"Node 10: Tsunami Exponent Buff II",desc:`Increases the Tsunami Exponent by +0.01 per level\nThis node scales <strong>10x</strong> RP each level`,baseRpReq:1e13,scale:10,maxLevel:10,x:0,y:-2e3,icon:"lab_icons/tsunami_exponent_buff.webp",parentIds:[8,9],bonusLine:e=>`Tsunami Exponent bonus: +${(e*.01).toFixed(2)}`}],On=new Map(Nt.map(e=>[e.id,e])),il=null,xy=null,xs={nodes:{}},Qn=null;typeof window<"u"&&(window.addEventListener("saveSlot:change",by),setInterval(Sy,1e3),window.addEventListener("beforeunload",Sy),window.addEventListener("unlock:change",({detail:e})=>{e&&e.key==="experiment_completed"&&Kd()}),by());Cy=Math.log10(2),My=Math.log10(3),Xw=Math.log10(1.1);window.RESEARCH_NODES=Nt;window.isResearchNodeVisible=Cr});function ep(){Zd||(Zd=setTimeout(()=>{Zd=null,Ww()},1e3))}function Ww(){let e=b();if(e!=null&&Ls())try{localStorage.setItem(Oy(e),Qt.toFixed(6))}catch{}}function zw(){let e=b();if(e==null)return 0;try{let t=localStorage.getItem(Oy(e));if(t){let n=parseFloat(t);return Number.isFinite(n)?n:0}}catch{}return 0}function Ry(){jc=!1,Ls()?Qt=zw():Qt=0,Tr=0,cl=0,Jd=0,ul()}function ul(){Qd.forEach(e=>{try{e(Qt)}catch{}})}function Py(){if(!zc()||jc)return;let e=performance.now();if(Tr=0,cl=0,e-Jd>=1e3){let t=Kc(),n=!1;Qt<t?(Qt+=Yw,n=!0,Qt>t&&(Qt=t)):Qt>t&&(Qt=t,n=!0),n&&(ul(),Ls()&&ep()),Jd=e}}function By(e){if(!zc()||jc)return;let t=Kc(),n=!1;if(Qt>t&&(Qt=t,n=!0),Ls()){n&&(ul(),ep());return}if(Tr<ll)for(cl+=e;cl>=1;)cl-=1,Tr<ll&&(Tr+=1,Tr>=ll&&(Qt=0,n=!0));n&&ul()}function tp(){if(!zc())return 0;let e=Qt,t=0;return Tr<ll&&(t=Math.max(0,1-Tr/ll)),e*t}function Fy(e,t,n){typeof e=="function"&&(zc=e),typeof t=="function"&&(Kc=t),typeof n=="function"&&(Ls=n),typeof window<"u"&&(window.addEventListener("saveSlot:change",Ry),Ry())}function np(e){jc=!!e}function Uy(e){Qt=Number(e)||0,ul(),Ls()&&ep()}function Zc(){return Qt}function Dy(){return Kc()}function $y(e){Qd.add(e)}function qy(e){Qd.delete(e)}var ll,Oy,Yw,Qt,Tr,cl,zc,Kc,Ls,Jd,jc,Qd,Zd,Jc=De(()=>{vt();ll=60,Oy=e=>`ccc:combo:value:${e}`,Yw=.001,Qt=0,Tr=0,cl=0,zc=()=>!1,Kc=()=>1,Ls=()=>!1,Jd=0,jc=!1,Qd=new Set,Zd=null});var Wy={};It(Wy,{getBookProductionRate:()=>Ar,getComboUiString:()=>sp,getEffectiveTsunamiNerf:()=>ut,getEffectiveTsunamiNerfWithCombo:()=>ip,getSurge15Divisor:()=>fl,getSurge15Multiplier:()=>Qc,getSurge6WealthMultipliers:()=>eu,getSurgeMagicMultiplier:()=>Pd,getTsunamiNerf:()=>Rn,getTsunamiNerfKey:()=>rp,getTsunamiSequenceSeen:()=>vn,initSurgeEffects:()=>Zw,isSurgeActive:()=>se,setTsunamiNerf:()=>Ii,setTsunamiSequenceSeen:()=>tr});function rp(e){return op(e)}function vn(){let e=b();if(e==null)return!1;try{return localStorage.getItem(Yy(e))==="1"}catch{return!1}}function tr(e){let t=b();if(t==null)return;let n=!!e;try{localStorage.setItem(Yy(t),n?"1":"0"),typeof window<"u"&&window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"tsunami",slot:t}}))}catch{}}function Rn(){return kr}function ut(){let t=Rn()+Jn();return t>1&&(t=1),t}function ip(){let e=ut();if(se(14)){let t=tp();e+=t,e>1&&(e=1)}return e}function sp(){if(!se(14))return"";let e=tp();if(e<=0)return"";let t=Te(e);t==="0"&&(t="0.000");let n=` (+^${t})`,r=Rn()+Jn();r>1&&(r=1);let i=1-r;return e>=i-1e-6&&i>0&&(n=`<span style="color: #02e815">${n}</span>`),n}function Ii(e){let t=Number(e);Number.isNaN(t)&&(t=0),(!Number.isFinite(t)||t>1)&&(t=1),t<0&&(t=0);let n=b();if(n!=null){let o=op(n);if(Kt(o))return;try{localStorage.setItem(o,t.toFixed(2))}catch{}}kr=t,_s();try{window.dispatchEvent(new CustomEvent("surge:nerf:change",{detail:{value:t}}))}catch{}}function se(e){return So===1/0||typeof So=="string"&&So==="Infinity"||So===Number.POSITIVE_INFINITY?!0:typeof So=="bigint"?So>=BigInt(e):typeof So=="number"?So>=e:!1}function Si(e){if(!se(8))return e;let t=Ee(e);if(!Number.isFinite(t))return e;let n=ut();return ie(t*n)}function _s(){let e=bn();So=e;let t=!1;if(e===1/0?t=!0:typeof e=="bigint"&&(t=e>=1n),t)if(se(8)){let n=ut(),o=Math.log10(Gy);er=ie(o*n)}else er=c.fromInt(Gy);else er=c.fromInt(1)}function Qc(e=!1){if(!e&&!se(15))return c.fromInt(1);let t=R.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=Ee(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return ie(l)})(t);return se(8)?Si(o):o}function fl(e=!1){if(!e&&!se(15))return c.fromInt(1);let t=R.dna?.value;if(!t)return c.fromInt(1);let o=(r=>{if(!r)return c.fromInt(1);if(r.isInfinite?.())return c.fromAny("Infinity");let i=Ee(r);if(!Number.isFinite(i)||i<=0)return c.fromInt(1);let s=i/2;if(s<=0)return c.fromInt(1);let l=s*Math.log10(2);return ie(l)})(t);return se(8)?Si(o):o}function eu(){if(!se(6))return{coins:c.fromInt(1),books:c.fromInt(1),gold:c.fromInt(1),magic:c.fromInt(1),total:c.fromInt(1)};let e=(m,v=0)=>{if(!m){if(v<=0)return c.fromInt(1);let E=Math.log10(v)/3;if(E<=0)return c.fromInt(1);let M=E*Math.log10(2);return ie(M)}if(m.isInfinite?.())return c.fromAny("Infinity");let p=Ee(m),h=p;if(Number.isFinite(p)){if(p<15&&v>0)try{let I=Number(m.toPlainIntegerString());if(Number.isFinite(I)){let E=I+v;E>0&&(h=Math.log10(E))}}catch{}}else if(v>0)h=Math.log10(v);else return c.fromInt(1);let g=h/6;if(g<=0)return c.fromInt(1);let y=g*Math.log10(2);return ie(y)},t=e(R.coins?.value),n=R.books?.value,o=0;typeof window<"u"&&typeof window.__bookResidue=="number"&&(o=window.__bookResidue);let r=e(n,o),i=e(R.gold?.value),s=e(R.magic?.value),l=t,a=r,u=i,f=s;se(8)&&(l=Si(t),a=Si(r),u=Si(i),f=Si(s));let d=l.mulBigNumInteger?l.mulBigNumInteger(a):l;return d=d.mulBigNumInteger?d.mulBigNumInteger(u):d,d=d.mulBigNumInteger?d.mulBigNumInteger(f):d,{coins:l,books:a,gold:u,magic:f,total:d}}function Ar(){if(!se(3))return c.fromInt(0);let t=Qe().xpLevel,n;if(t.isInfinite?.())n=c.fromAny("Infinity");else if(t.cmp(1e16)>0){let o=t.mulDecimal(String(Hy),18);if(o.cmp(Number.MAX_VALUE)>=0)n=c.fromAny("Infinity");else try{let r=Number(o.toScientific());r===1/0||!Number.isFinite(r)?n=c.fromAny("Infinity"):n=ie(r)}catch{n=c.fromAny("Infinity")}}else{let r=Number(t.toPlainIntegerString())*Hy;n=ie(r)}if(n.cmp(1)<0&&(n=c.fromInt(1)),R.books?.mult){let o=R.books.mult.get();n=n.mulBigNumInteger(o)}return se(8)&&(n=Si(n)),n}function Kw(e){if(se(14)&&By(e),se(3)){Xy||(Xy=new Va("books",R));let t=Ar();if(t.cmp(1e9)>0||t.isInfinite?.()){let n=t.mulDecimal(String(e),18);R.books&&R.books.add(n)}else{let n=Number(t.toScientific());if(window.__bookResidue||(window.__bookResidue=0),window.__bookResidue+=n*e,window.__bookResidue>0)try{window.dispatchEvent(new CustomEvent("surge:bookResidue"))}catch{}if(window.__bookResidue>=1){let o=Math.floor(window.__bookResidue);window.__bookResidue-=o,R.books&&R.books.add(c.fromInt(o))}}}if(se(13)){let o=2*(ut()*1.5-.5)-2,r=ie(o),i=R.coins?.value,s=Qe(),l=Cs(i,s.xpLevel),a=R.gold?.mult?.applyTo?.(l)??l,u=bi();a=a.mulDecimal(u.toScientific());let d=a.mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.gold&&R.gold.add(d)}if(se(16)){let o=2*(ut()*1.5-.5)-2,r=ie(o),i=R.coins?.value,s=nr(),u=Ms(i,s).mulDecimal(r.toScientific()).mulDecimal(String(e),18);R.magic&&R.magic.add(u)}}function Vy(e){if(e==null)return;let t=localStorage.getItem(op(e));t!==null?(kr=Number(t),(Number.isNaN(kr)||!Number.isFinite(kr))&&(kr=se(8)?0:1)):se(8)?kr=0:kr=1}function jw(e,t){let n=e===1/0||typeof e=="string"&&e==="Infinity"||e===Number.POSITIVE_INFINITY,o=t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY;if(n&&o)return 0;if(o)return 1;if(n)return-1;let r=BigInt(0),i=BigInt(0);try{r=typeof e=="bigint"?e:BigInt(e)}catch{}try{i=typeof t=="bigint"?t:BigInt(t)}catch{}return i>r?1:i<r?-1:0}function Zw(){Fy(()=>se(14)&&Rn()+Jn()<1,()=>1-ut());let e=b();_s(),Vy(e),_s(),typeof window<"u"&&(window.addEventListener("surge:level:change",()=>{let t=So,n=se(8);_s();let o=So,r=se(8);!n&&r?(Ii(0),vn()||tr(!0)):r?jw(t,o)>0&&(Ii(0),vn()||tr(!0)):n&&!r&&Ii(1)}),window.addEventListener("lab:node:change",()=>{_s()}),window.addEventListener("saveSlot:change",()=>{Vy(b()),_s()}),window.addEventListener("currency:change",t=>{if(t.detail?.key==="dna"){try{jt()}catch{}try{ci()}catch{}}})),uo(({baseMultiplier:t})=>er.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(er)),Vo(({baseGain:t})=>er.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(er)),Vo(({baseGain:t})=>se(19)?t.mulSmall(2):t),fi(({baseGain:t})=>er.cmp(c.fromInt(1))===0?t:t.mulBigNumInteger(er)),fi(({baseGain:t})=>{if(!se(4))return t;let n=c.fromInt(4444e9);if(se(8)){let o=ut(),r=Math.log10(4444e9);n=ie(r*o)}return t.mulBigNumInteger(n)}),uo(({baseMultiplier:t})=>{if(!se(6))return t;let n=eu();return n.total.cmp(1)<=0?t:t.mulBigNumInteger(n.total)}),uo(({baseMultiplier:t})=>{if(!se(15))return t;let n=t,o=Qc();o.cmp(1)>0&&(n=n.mulBigNumInteger(o));let r=fl();return r.cmp(1)>0&&(n=n.div(r)),n}),uo(({baseMultiplier:t})=>{let n=0;if(se(17)&&(n-=5),se(18)&&(n+=15),n===0)return t;if(se(8)){let r=ut();n*=r}let o=ie(n);return t.mulBigNumInteger(o)}),Nc(({baseReward:t})=>se(3)?c.fromInt(0):t),Ao(Kw)}function Pd(){let e=0;if(se(17)&&(e+=15),se(18)&&(e-=5),se(8)){let n=ut();e*=n}let t=c.fromInt(1);if(e!==0&&(t=ie(e)),se(15)){let n=fl();n.cmp(1)>0&&(t=t.div(n))}return t}var Gy,Hy,op,Yy,er,So,Xy,kr,yn=De(()=>{xt();vt();An();$c();go();mo();si();xt();Jo();Jc();qt();Gy=10,Hy=.08685889638,op=e=>`ccc:surge:tsunamiNerf:${e}`,Yy=e=>`ccc:unlock:tsunami:${e}`;er=c.fromInt(1),So=0n,Xy=null,kr=0});var tv={};It(tv,{getGearsProductionRate:()=>iu,getGenerationLevelKey:()=>xi,getGenerationUpgradeCost:()=>Nr,initWorkshopSystem:()=>ev,initWorkshopTab:()=>pp,performFreeGenerationUpgrade:()=>Wc,updateWorkshopTab:()=>Io});function ks(e,t){if(e<=0)return 0;let n=1+t*e;return(n*Math.log(n)-t*e)/t*aE}function xi(e){return`ccc:workshop:genLevel:${e}`}function ml(){let e=b();if(!e)return c.zero();let t=localStorage.getItem(xi(e));if(!t)return c.zero();try{return t.startsWith("BN:")||/infinity/i.test(t)?c.fromStorage(t):c.fromAny(t)}catch{return c.zero()}}function gl(e){let t=b();if(!t)return!1;let n=xi(t),o;e instanceof c?o=e.toStorage():o=String(e);try{localStorage.setItem(n,o),typeof window<"u"&&window.dispatchEvent(new CustomEvent("workshop:change",{detail:{slot:t,level:e}}))}catch{}let r=null;try{r=localStorage.getItem(n)}catch{}return r===o}function yl(e){if(e.isInfinite()||e.cmp(9e15)>0)return 1/0;let t=0;try{let d=e.toPlainIntegerString();t=parseFloat(d)}catch{return 1/0}if(t<=0)return lp;if(t<=wi)return lp+t*Ky;nu===null&&(nu=lp+wi*Ky);let n=t-wi;if(t<=dl)return nu+n+ks(n,Ts);if(ou===null){let d=dl-wi;ou=nu+d+ks(d,Ts)}let o=t-dl,r=t-wi,i=dl-wi,s=o+(ks(r,Ts)-ks(i,Ts)),l=rE/oE,a=.5*l*o*o;if(t<=tu)return ou+s+a;if(cp===null){let d=tu-dl,m=tu-wi,v=d+(ks(m,Ts)-ks(i,Ts)),p=.5*l*d*d;cp=ou+v+p}let u=iE*(t-tu);if(u>709)return 1/0;let f=cp*Math.exp(u);return!Number.isFinite(f)||f>179e306?1/0:f}function Nr(e){let t=e;if(e instanceof c||(t=c.fromAny(e)),t.isInfinite())return c.fromAny("Infinity");let n=yl(t);return ie(n)}function dp(e){let t,n=e;e instanceof c||(n=c.fromAny(e));let o=se(11)?nE:se(7)?tE:eE;if(n.isZero())t=c.fromInt(1);else if(n.isInfinite())t=c.fromAny("Infinity");else{let i=n.mulDecimal(o);if(n.cmp(9e15)<=0){let l=Number(n.toString())*o;t=ie(l)}else{let s=n.mulDecimal(o);if(s.cmp(Number.MAX_VALUE)>=0)t=c.fromAny("Infinity");else try{let l=Number(s.toScientific(10));l===1/0?t=c.fromAny("Infinity"):t=ie(l)}catch{t=c.fromAny("Infinity")}}}let r=R?.gears?.mult?.get?.()??c.fromInt(1);return t.mulBigNumInteger(r)}function uE(){let e=Nr(st);if(R.coins.value.cmp(e)<0)return;let t=st.add(1);gl(t)&&(st=t,R.coins.sub(e),Io(),sn())}function fE(){if(!Gt())return;let n=dp(st).mulDecimal("0.05").floorToInteger();if(!n.isZero()&&R.gears&&R.gears.add(n),st.cmp(20)<0){let r=Number(st.toPlainIntegerString()),s=Math.pow(se(11)?4:se(7)?3:2,r)/20,l=Math.floor(s),a=s-l;if(Ei+=a,Ei>=1){let u=Math.floor(Ei);Ei-=u,R.gears&&R.gears.add(u)}}else Ei=0}function fp(){R.gears&&R.gears.set(0),gl(c.zero())&&(st=c.zero()),Ei=0,Io()}function Zy(e){if(!e)return;let t=hl.get(e),n=e.querySelector("canvas.workshop-gear-canvas");n||(n=document.createElement("canvas"),n.classList.add("workshop-gear-canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="0",e.appendChild(n));let o=e.getBoundingClientRect(),r=window.devicePixelRatio||1;if(t?t.canvas||(t.canvas=n,t.ctx=n.getContext("2d",{alpha:!0}),t.ctx.scale(r,r)):(t={gears:[],width:o.width,height:o.height,needsDistribution:!o.width||!o.height,canvas:n,ctx:n.getContext("2d",{alpha:!0})},n.width=Math.round(o.width*r),n.height=Math.round(o.height*r),t.ctx.scale(r,r),hl.set(e,t)),o.width>0&&o.height>0){t.width=o.width,t.height=o.height;let a=Math.round(o.width*r),u=Math.round(o.height*r);(t.canvas.width!==a||t.canvas.height!==u)&&(t.canvas.width=a,t.canvas.height=u,t.ctx.scale(r,r))}let i=0;st.cmp(ap)>0?i=ap:i=Number(st.toPlainIntegerString());let s=Math.min(Math.floor(i),ap),l=t.gears;for(;l.length<s;){let a=32+Math.random()*48,u=0,f=0;t.width>0&&t.height>0?(u=Math.random()*(t.width-a),f=Math.random()*(t.height-a),u<0&&(u=0),f<0&&(f=0)):t.needsDistribution=!0;let d=Math.random()*Math.PI*2,m=Math.cos(d)*jy,v=Math.sin(d)*jy,p=Math.random()*360,h=(Math.random()<.5?-1:1)*(lE+Math.random()*cE);l.push({x:u,y:f,dx:m,dy:v,rotation:p,rotationSpeed:h,size:a})}for(;l.length>s;)l.pop()}function dE(e){let t="Click the big red button below to open the Automation Shop";Je&&(t=Math.max(window.innerWidth,window.innerHeight)>=900?"Tap the big red button below to open the Automation Shop":"Tap the big red button below (scroll if needed) to open the Automation Shop"),e.innerHTML=`<div class="merchant-workshop"><div class="workshop-side-col workshop-side-left"></div><div class="workshop-center-col"><div class="workshop-info-panel"><div class="workshop-gear-hud"><img src="${Jw}" class="workshop-gear-plus" alt="Gears"><div class="workshop-gear-bar"><span data-workshop="gears-amount" class="workshop-gear-amount">0</span></div></div><div class="workshop-rate-display"> (+<img src="${Jy}" class="workshop-rate-icon" alt=""><span><span data-workshop="gears-rate">0</span>/sec)</span></div><div class="workshop-description"> Spend Coins to increase your Workshop Level<br> Each increase of your Workshop Level will <span data-workshop="production-verb">double</span> the rate of Gear production<br> ${t}<br> Spend Gears in the Automation Shop to unlock powerful automation upgrades<br> Automation upgrades will never be reset by any reset layer </div></div><div class="workshop-doubler-panel"><button class="workshop-upgrade-btn" data-workshop="upgrade-gen"><span class="workshop-upgrade-title">Increase Workshop Level</span><span class="workshop-upgrade-cost"> Cost: <img src="${Qw}" class="workshop-upgrade-cost-icon" alt="Coins"><span data-workshop="upgrade-cost">1T</span></span></button></div><button class="btn-automation-shop">Automation</button></div><div class="workshop-side-col workshop-side-right"></div></div>`;let n=e.querySelector(".workshop-side-left"),o=e.querySelector(".workshop-side-right"),r=e.querySelector('[data-workshop="upgrade-gen"]');r.addEventListener("click",()=>{uE()}),r.addEventListener("contextmenu",l=>{l.preventDefault(),mE()});let i=e.querySelector(".btn-automation-shop");i.addEventListener("click",()=>{Ns("automation")});let s=()=>{let l=document.querySelector('.hud-bottom [data-btn="stats"]');if(l&&i){let a=l.getBoundingClientRect();i.style.width=`${a.width}px`,i.style.height=`${a.height}px`,i.style.minWidth="0",i.style.maxWidth="none"}if(en&&en.isConnected){let a=en.querySelector(".workshop-side-left"),u=en.querySelector(".workshop-side-right"),f=d=>{if(!d)return;let m=hl.get(d);if(m){let v=d.getBoundingClientRect(),p=window.devicePixelRatio||1;m.width=v.width,m.height=v.height;let h=Math.round(v.width*p),g=Math.round(v.height*p);if(m.canvas&&(m.canvas.width!==h||m.canvas.height!==g)&&(m.canvas.width=h,m.canvas.height=g,m.ctx.scale(p,p)),m.needsDistribution&&m.width>0&&m.height>0){m.needsDistribution=!1;for(let y of m.gears)y.x=Math.random()*(m.width-y.size),y.x<0&&(y.x=0),y.y=Math.random()*(m.height-y.size),y.y<0&&(y.y=0)}}};f(a),f(u)}};if(typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),n&&l.observe(n),o&&l.observe(o),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s);typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{for(let u of a)u.isIntersecting?Qy():pE()},{root:null,threshold:0}).observe(e),en=e}function Io(){if(!en)return;let e=en.querySelector('[data-workshop="production-verb"]');if(e){let a=se(11)?"quadruple":se(7)?"triple":"double";e.textContent!==a&&(e.textContent=a)}let t=en.querySelector('[data-workshop="gears-amount"]'),n=en.querySelector('[data-workshop="gears-rate"]'),o=en.querySelector('[data-workshop="upgrade-cost"]'),r=en.querySelector('[data-workshop="upgrade-gen"]'),i=dp(st),s=Nr(st);if(t&&(t.innerHTML=R.gears.fmt(R.gears.value)),n&&(n.innerHTML=K(i)),o){let a="Coins";try{a=!s.isInfinite()&&s.cmp(1)===0?"Coin":"Coins"}catch{}o.innerHTML=`${K(s)} ${a}`}if(r){let a=R.coins.value.cmp(s)>=0;r.disabled=!a;let u=At(Ze,po),f=!1;if(u>0){let d=b(),m=d!=null?`:${d}`:"",v=`ccc:autobuy:${Ze}:${po}${m}`;f=localStorage.getItem(v)!=="0"}f?r.classList.add("is-automated"):r.classList.remove("is-automated")}let l="";if(st.isInfinite()?l="Infinity":l=st.floorToInteger().toStorage(),l!==up){up=l;let a=en.querySelector(".workshop-side-left"),u=en.querySelector(".workshop-side-right");a&&Zy(a),u&&Zy(u)}}function pE(){As&&(cancelAnimationFrame(As),As=null)}function Qy(){if(As)return;pl=0;let e=t=>{if(en&&en.isConnected){let n=en.querySelector('[data-workshop="gears-amount"]');n&&!mp()&&(n.innerHTML=R.gears.fmt(R.gears.value)),pl||(pl=t);let o=(t-pl)/1e3;pl=t,o>.1&&(o=.1);for(let[r,i]of hl){if(!r.isConnected)continue;let{gears:s,width:l,height:a,ctx:u}=i;if(!(!l||!a||!u)&&(u.clearRect(0,0,l,a),!(!ru.complete||ru.naturalWidth===0)))for(let f of s){f.x+=f.dx*o,f.y+=f.dy*o,f.x<0?(f.x=0,f.dx=-f.dx):f.x+f.size>l&&(f.x=l-f.size,f.dx=-f.dx),f.y<0?(f.y=0,f.dy=-f.dy):f.y+f.size>a&&(f.y=a-f.size,f.dy=-f.dy),f.rotation+=f.rotationSpeed*o;let d=f.x+f.size/2,m=f.y+f.size/2;u.save(),u.translate(d,m),u.rotate(f.rotation*Math.PI/180),u.drawImage(ru,-f.size/2,-f.size/2,f.size,f.size),u.restore()}}}As=requestAnimationFrame(e)};As=requestAnimationFrame(e)}function ev(){zy||(zy=!0,st=ml(),Ao(fE),typeof window<"u"&&(window.addEventListener("saveSlot:change",()=>{st=ml(),Ei=0,Gt()||fp(),Io()}),window.addEventListener("currency:change",e=>{e.detail.key===Re.COINS&&Io()}),window.addEventListener("currency:multiplier",e=>{e.detail.key===Re.GEARS&&Io()}),window.addEventListener("debug:change",()=>{st=ml(),Io()}),window.addEventListener("unlock:change",e=>{(e.detail||{}).key==="infuse"&&(Gt()||fp())})))}function pp(e){ev(),!e.__workshopInit&&(e.__workshopInit=!0,st=ml(),hl.clear(),up=-1,dE(e),typeof IntersectionObserver>"u"&&Qy(),Gt()||fp(),Io())}function iu(){let e=ml();return dp(e)}function Wc(){let e=R.coins.value.isInfinite(),n=Nr(st).isInfinite();if(e&&n&&!st.isInfinite())return st=c.fromAny("Infinity"),gl(st),Io(),!0;if(R.coins.value.isZero())return!1;let o=Ee(R.coins.value);if(!Number.isFinite(o))if(R.coins.value.inf)o=1/0;else return!1;if(yl(st)>o||st.cmp(9e15)>0)return!1;let r=Number(st.toPlainIntegerString()),i=9e15;o===1/0&&(i=9e15);let s=r;for(;r<=i;){let u=Math.floor((r+i)/2);yl(c.fromInt(u))<=o?(s=u,r=u+1):i=u-1}let l=s+1,a=c.fromInt(l);return a.cmp(st)>0&&gl(a)?(st=a,Io(),!0):!1}function mE(){if(R.coins.value.isInfinite()){Wc()&&sn();return}let e=Ee(R.coins.value);if(!Number.isFinite(e)&&R.coins.value.isZero()||yl(st)>e||st.cmp(9e15)>0)return;let t=Number(st.toPlainIntegerString()),n=9e15;e===1/0&&(n=9e15);let o=t;for(;t<=n;){let u=Math.floor((t+n)/2);yl(c.fromInt(u))<=e?(o=u,t=u+1):n=u-1}let r=o+1,i=Number(st.toPlainIntegerString()),s=Math.max(i,r-100),l=c.zero();for(let u=s;u<r;u++)l=l.add(Nr(c.fromInt(u)));if(l.cmp(R.coins.value)>0){let u=Nr(c.fromInt(r-1));l=l.sub(u),r--}let a=c.fromInt(r);a.cmp(st)>0&&gl(a)&&(st=a,R.coins.sub(l),Io(),sn())}var Jy,Jw,ru,Qw,ap,en,zy,Ei,st,up,As,lp,eE,tE,nE,wi,dl,tu,Ky,Ts,oE,rE,iE,sE,aE,nu,ou,cp,hl,jy,lE,cE,pl,Es=De(()=>{xt();qt();vt();si();gi();mo();ho();vo();li();yn();Jy="img/currencies/gear/gear.webp",Jw="img/currencies/gear/gear_plus_base.webp",ru=new Image;ru.src=Jy;Qw="img/currencies/coin/coin.webp",ap=100,en=null,zy=!1,Ei=0,st=c.zero(),up=-1,As=null,lp=12,eE=.3010299956639812,tE=.47712125471966244,nE=.6020599913279624,wi=1e6,dl=1e9,tu=1e12,Ky=1,Ts=.001,oE=1e3,rE=Math.log10(1.00001),iE=23e-11,sE=Math.log(10),aE=1/sE;nu=null,ou=null,cp=null;hl=new Map,jy=67,lE=67,cE=67;pl=0});var rv={};It(rv,{calculateOfflineRewards:()=>Rs,calculatePreAutomationRewards:()=>au,formatTimeCompact:()=>su,grantOfflineRewards:()=>Li,initOfflineTracker:()=>yE,processOfflineProgress:()=>ov,showOfflinePanel:()=>Rr});function su(e){let t=c.fromAny(e),i=24*(60*(60*1e3)),s=365*i,l=c.fromInt(s);if(t.cmp(l)>=0){let g=t.div(l).floorToInteger(),y=g.mulBigNumInteger(l),I=t.sub(y),E=0;try{let M=I.div(c.fromInt(i)).floorToInteger();E=Number(M.toPlainIntegerString())}catch{E=0}return E===0?`${K(g)}y`:`${K(g)}y ${E}d`}let a=0;try{e instanceof c?a=Number(e.toPlainIntegerString())/1e3:a=Number(e)/1e3}catch{a=0}let u=Math.floor(a);if(u<60)return`${u}s`;let f=Math.floor(u/60),d=u%60;if(f<60)return d===0?`${f}m`:`${f}m ${d}s`;let m=Math.floor(f/60),v=f%60;if(m<24)return v===0?`${m}h`:`${m}h ${v}m`;let p=Math.floor(m/24),h=m%24;return h===0?`${p}d`:`${p}d ${h}h`}function Rr(e,t,n=!1){if(window.__tsunamiActive)return;let o=document.querySelector(".offline-overlay");o&&o.remove();let r=document.createElement("div");r.className="offline-overlay";let i=document.createElement("div");i.className="offline-panel";let s=document.createElement("div");s.className="offline-header",s.textContent=n?"Pre-Automation Offline Gift":"Offline Progress";let l=document.createElement("div");l.className="offline-subheader",l.textContent=`You were gone for ${su(t)}`;let a=document.createElement("div");if(a.className="offline-content-wrapper",n){let p=document.createElement("div");p.className="offline-pre-auto-note",p.textContent="Until you unlock proper automation, Coins have to be collected manually. As a gift to not discourage idle play before unlocking automation, provided below are the rewards from Coins that would have spawned if you were active in the game.",a.appendChild(p)}let u=document.createElement("div");u.className="offline-scroll-container";let f=document.createElement("div");f.className="offline-list",hE.forEach(p=>{let h=p.key,g=e[h];if(!g||typeof g.isZero=="function"&&g.isZero())return;if(h==="research_levels"){Array.isArray(g)&&g.forEach(P=>{let $=document.createElement("div");$.className="offline-row";let L=document.createElement("span");L.className="offline-plus",L.style.color="#004F96",L.textContent="+";let F=document.createElement("img");F.className="offline-icon",F.src=p.icon,F.alt="RP";let T=document.createElement("span");T.className="offline-text",T.style.color="#004F96";let C=c.fromInt(P.levels),Y=C.cmp(c.fromInt(1))===0?"Level":"Levels";T.textContent=`${K(C)} ${Y} of ${P.name}`,$.appendChild(L),$.appendChild(F),$.appendChild(T),f.appendChild($)});return}let y=document.createElement("div");y.className="offline-row";let I=document.createElement("span");I.className="offline-plus",I.classList.add(`text-${h}`),I.textContent="+";let E=document.createElement("img");E.className="offline-icon",E.src=p.icon,E.alt=h;let M=document.createElement("span");M.className="offline-text",M.classList.add(`text-${h}`);let A=!1;g instanceof c?A=!g.isInfinite()&&g.cmp(c.fromInt(1))===0:A=Number(g)===1;let G=A?p.singular:p.plural;M.innerHTML=`${K(g)} ${G}`,y.appendChild(I),y.appendChild(E),y.appendChild(M),f.appendChild(y)}),u.appendChild(f),a.appendChild(u);let d=document.createElement("div");d.className="offline-actions";let m=document.createElement("button");m.type="button",m.className="offline-close-btn",m.textContent="Close";let v=()=>{r.remove()};return m.addEventListener("click",v),r.addEventListener("click",p=>{p.target===r&&v()}),d.appendChild(m),i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(d),r.appendChild(i),document.body.appendChild(r),requestAnimationFrame(()=>{Os(i,a,".offline-scroll-container")}),r}function gE(e,t){if(t>=e.maxLevel)return c.fromAny("Infinity");let n=Math.log10(e.scale),r=Math.log10(e.baseRpReq)+t*n,i=Math.floor(r),s=r-i,l=Math.pow(10,s);return new c(BigInt(Math.round(l*1e14)),{base:i,offset:-14n})}function Rs(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=Ss?Ss():c.fromInt(0);if(r&&!r.isZero()){let u=r.mulBigNumInteger(n),f=Nt.filter(v=>Zo(v.id)),d=[],m={};for(let v of f){let p=it(v.id),h=yo(v.id).add(u),g=0,y=v.maxLevel;for(;p<y;){let I=gE(v,p);if(I.isInfinite&&I.isInfinite()||h.cmp(I)<0)break;h=h.sub(I),p++,g++}g>0&&d.push({name:v.title,levels:g}),m[v.id]={level:p,rp:h}}d.length>0&&(o.research_levels=d),Object.keys(m).length>0&&(o.research_progress=m)}let s=(iu?iu():c.fromInt(0)).mulBigNumInteger(n).floorToInteger();s.isZero()||mn("gears",t)||(o.gears=s);let l=Ar?Ar():c.fromInt(0);if(!l.isZero()){let u=l.mulBigNumInteger(n).floorToInteger();u.isZero()||mn("books",t)||(o.books=u)}if(se(13)||se(16)){let d=2*(ut()*1.5-.5)-2,v=ie(d).mulDecimal(String(e));if(se(13)){let p=R.coins?.value,h=Qe(),g=Cs(p,h.xpLevel),y=R.gold?.mult?.applyTo?.(g)??g,I=bi();y=y.mulDecimal(I.toScientific());let E=y.mulDecimal(v.toScientific());E.cmp(0)>0&&!mn("gold",t)&&(o.gold=E)}if(se(16)){let p=R.coins?.value,h=nr(),y=Ms(p,h).mulDecimal(v.toScientific());y.cmp(0)>0&&!mn("magic",t)&&(o.magic=y)}}let a=At(Ze,ai)||0;if(a>0){let u=1;se(2)&&(u=10);let f=c.fromInt(a).mulBigNumInteger(n).mulBigNumInteger(c.fromInt(u)).floorToInteger();if(!f.isZero()){let d=cu(),m=d.coins.mulBigNumInteger(f),v=d.xp.mulBigNumInteger(f),p=d.mp.mulBigNumInteger(f);m.isZero()||mn("coins",t)||(o.coins=m),v.isZero()||Kt(`ccc:xp:progress:${t}`)||(o.xp=v),p.isZero()||Kt(`ccc:mutation:progress:${t}`)||(o.mp=p)}}return o}function Li(e){if(b()!=null){if(e.xp)try{let n=ls(e.xp);n&&(n.xpLevelsGained&&!n.xpLevelsGained.isZero()&&(e.xp_levels=n.xpLevelsGained),n.xpAdded&&(e.xp=n.xpAdded))}catch{}if(e.mp)try{let n=Ps(e.mp);n&&(n.levelsGained&&!n.levelsGained.isZero()&&(e.mp_levels=n.levelsGained),n.delta&&(e.mp=n.delta))}catch{}if(e.research_progress)for(let[n,o]of Object.entries(e.research_progress)){let r=parseInt(n,10);isNaN(r)||(bo(r,o.level),vi(r,o.rp))}for(let n of Object.keys(e))n==="xp"||n==="mp"||n==="xp_levels"||n==="mp_levels"||n==="research_levels"||n==="research_progress"||R[n]&&typeof R[n].add=="function"&&R[n].add(e[n])}}function au(e){let t=b();if(t==null)return{};let n=c.fromAny(e),o={},r=eo(),i=c.fromInt(1);try{let l=hs(r);l&&l.coinsPerSecondMult&&(i=c.fromAny(l.coinsPerSecondMult))}catch(l){console.error("Offline rewards calc error:",l),i=c.fromInt(1)}if(typeof Zn=="function"){let l=Zn("spawnRate",i);try{i=c.fromAny(l)}catch{}}let s=i.mulBigNumInteger(n).floorToInteger();if(!s.isZero()){let l=cu(),a=l.coins.mulBigNumInteger(s),u=l.xp.mulBigNumInteger(s),f=l.mp.mulBigNumInteger(s);a.isZero()||(o.coins=a),u.isZero()||Kt(`ccc:xp:progress:${t}`)||(o.xp=u),f.isZero()||Kt(`ccc:mutation:progress:${t}`)||(o.mp=f)}return o}function ov(){let e=b();if(e==null)return;let t=nd(),n=Date.now();if(t<=0)return;if(n<t-1e4){Mn(e);return}let o=n-t;if(o<1e3)return;let r=o/1e3;if(!Gt()){let l=au(r),a=Object.keys(l).length>0;return a&&(Li(l),Rr(l,o,!0)),a}let i=Rs(r),s=Object.keys(i).length>0;return s&&(Li(i),Rr(i,o)),s}function yE(e,t){nv||(nv=!0,document.addEventListener("visibilitychange",()=>{b()!=null&&(e&&!e()||(document.hidden?Ad():(Nd(),ov()&&typeof t=="function"&&t())))}))}var nv,hE,lu=De(()=>{vt();Es();mo();si();vt();xt();qt();gi();vo();ho();hi();Jo();li();rl();An();go();yn();cs();An();go();mo();Jo();xt();nv=!1;hE=[{key:"coins",icon:"img/currencies/coin/coin.webp",singular:"Coin",plural:"Coins"},{key:"xp",icon:"img/stats/xp/xp.webp",singular:"XP",plural:"XP"},{key:"xp_levels",icon:"img/stats/xp/xp.webp",singular:"XP Level",plural:"XP Levels"},{key:"books",icon:"img/currencies/book/book.webp",singular:"Book",plural:"Books"},{key:"gold",icon:"img/currencies/gold/gold.webp",singular:"Gold",plural:"Gold"},{key:"mp",icon:"img/stats/mp/mp.webp",singular:"MP",plural:"MP"},{key:"mp_levels",icon:"img/stats/mp/mp.webp",singular:"Mutation Level",plural:"Mutation Levels"},{key:"magic",icon:"img/currencies/magic/magic.webp",singular:"Magic",plural:"Magic"},{key:"gears",icon:"img/currencies/gear/gear.webp",singular:"Gear",plural:"Gears"},{key:"waves",icon:"img/currencies/gear/gear.webp",singular:"Wave",plural:"Waves"},{key:"DNA",icon:"img/currencies/dna/dna.webp",singular:"DNA",plural:"DNA"},{key:"research_levels",icon:"img/stats/rp/rp.webp",singular:"Level",plural:"Levels"}];window.createOfflinePanel=Rr});function yp(e){let t=24,n=Date.now();try{let o=localStorage.getItem(hp(e));o!==null&&(t=parseInt(o,10));let r=localStorage.getItem(gp(e));if(r!==null)n=parseInt(r,10);else if(o===null)try{localStorage.setItem(hp(e),"24"),localStorage.setItem(gp(e),String(n))}catch{}}catch{}return{charges:t,lastCharge:n}}function sv(e,t,n){try{localStorage.setItem(hp(e),String(t)),localStorage.setItem(gp(e),String(n))}catch{}}function av(){let e=b();if(e==null)return;let{charges:t,lastCharge:n}=yp(e);if(t>=Bs)return;let o=Date.now(),r=o-n;if(r>=uu){let i=Math.floor(r/uu);t+=i,t>=Bs?(t=Bs,n=o):n+=i*uu,sv(e,t,n),Or&&Or.classList.contains("is-active")&&or(!0)}}function bE(){let e=document.createElement("div");e.className="warp-overlay",document.body.appendChild(e),setTimeout(()=>{e.classList.add("stage-2")},3e3),setTimeout(()=>{e.remove()},7250)}function SE(){let e=b();if(e==null)return;av();let{charges:t,lastCharge:n}=yp(e);t<=0||(t>=Bs&&(n=Date.now()-50),t--,sv(e,t,n),or(!0),vl&&clearInterval(vl),vl=setInterval(()=>{or()},1e3),pt(vE,{volume:.5}),bE(),setTimeout(()=>{let o=Rs(iv);Li(o),Rr(o,iv*1e3)},7250))}function or(e=!1){if(!Or||!Or.classList.contains("is-active"))return;let t=b();if(t==null)return;e||av();let{charges:n,lastCharge:o}=yp(t),r=Or.querySelector(".warp-counter");r&&(r.innerHTML=`Warps remaining: <span class="text-cyan">${n} / ${Bs}</span>`);let i=Or.querySelector(".warp-timer");if(i)if(n>=Bs)i.style.visibility="hidden";else{i.style.visibility="visible";let l=Date.now(),a=o+uu,u=Math.max(0,a-l);i.textContent=`Next warp in ${su(u)}`}let s=Or.querySelector(".warp-btn");s&&(s.disabled=n<=0)}function lv(e){if(!e||e.__warpInit)return;e.__warpInit=!0,Or=e,e.innerHTML=`<div class="warp-tab"><h3 class="warp-title">Warp</h3><div class="warp-desc"><p>Click the Warp button below to instantly gain <span class="text-cyan">2m 30s</span> of offline progress when you want to speed something up</p><p>Warp length will never be increased because it's intended to be a small boost</p><p>Use your Warps wisely as they only recharge once every hour</p></div><div class="warp-status"><div class="warp-timer">Next warp in: 60m</div><div class="warp-counter">Warps remaining: <span class="text-cyan">24 / 24</span></div></div><button type="button" class="warp-btn">Warp</button></div>`,e.querySelector(".warp-btn").addEventListener("click",SE),vl||(vl=setInterval(()=>{or()},1e3)),or()}var hp,gp,Bs,uu,iv,vE,Or,vl,vp=De(()=>{vt();lu();Cn();hp=e=>`ccc:warp:charges:${e}`,gp=e=>`ccc:warp:lastCharge:${e}`,Bs=24,uu=3600*1e3,iv=150,vE="sounds/warp.ogg",Or=null,vl=null});function fv(e){uv=e}function fu(){let e=b();if(e==null)return!1;try{if(localStorage.getItem(`ccc:unlock:channel:${e}`)==="1")return!0}catch{}return!!uv(20)}function dv(e){cv||(IE=e,e.innerHTML='<div style="padding: 20px; text-align: center; color: #888;">Channel Tab (Empty)</div>',cv=!0)}var cv,IE,uv,bp=De(()=>{vt();cv=!1,IE=null,uv=()=>!1});function wv(){try{return localStorage.getItem(Br(Tp))==="1"}catch{return!1}}function Ap(){try{return localStorage.getItem(Br(Ev))==="1"}catch{return!1}}function hu(e){let t=b();if(t==null)return;let n=`${Ev}:${t}`,o=!!e;try{localStorage.setItem(n,o?"1":"0"),wE()}catch{}}function gu(){return Ap()?"Jeff":"Merchant"}function wE(){let e=gu();ze&&ze.querySelectorAll(".merchant-firstchat:not(.merchant-firstchat--initial) .merchant-firstchat__header .name").forEach(n=>{n&&(n.textContent==="Merchant"||n.textContent==="Jeff")&&(n.textContent=e)})}function bl(e,t,{once:n=!1}={}){if(!e||typeof t!="function")return()=>{};let o=!1,r=!1,i=null,s=g=>{if(!(n&&o)){if(g?.type==="click"&&g.isTrusted&&fo(e)){g.preventDefault?.();return}o=n?!0:o,Promise.resolve(t(g)).catch(y=>console.error(y)),n&&h()}},l=()=>{r=!1,i=null},a=g=>{r&&l(),s(g)},u=g=>{g.pointerType!=="mouse"&&(typeof g.button=="number"&&g.button!==0||(r=!0,i=typeof g.pointerId=="number"?g.pointerId:null,ko(160)))},f=g=>{r&&(i!=null&&typeof g.pointerId=="number"&&g.pointerId!==i||l())},d=()=>{r&&l()},m=g=>{r=!0,ko(160)},v=g=>{r&&l()},p=()=>{r&&l()},h=()=>{e.removeEventListener("click",a),xv?(e.removeEventListener("pointerdown",u),window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",d)):CE&&(e.removeEventListener("touchstart",m),window.removeEventListener("touchend",v),window.removeEventListener("touchcancel",p))};return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}}function du(e){return LE[e]??0}function pv(e){return!e||typeof e!="object"?null:{title:e.title??null,blurb:e.blurb??null,tooltip:e.tooltip??null,message:e.message??null,icon:e.icon??null,headerTitle:e.headerTitle??null,ariaLabel:e.ariaLabel??null}}function ME(e){return{status:"unlocked",unlocked:!0,title:e.title,blurb:e.blurb,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:e.title||"Merchant dialogue"}}function $s(e,t){let n=_i.find(s=>s.key===e);if(!n)return;let o=n.lockedLabel||"???",r=!!t;Us.set(e,r),n.unlocked=r;let i=an.buttons[e];i&&(i.disabled=!r,i.classList.toggle("is-locked",!r),i.textContent=r?n.label:o,i.title=r?n.label||"Tab":"???"),!r&&an.buttons[e]?.classList.contains("is-active")&&Su("dialogue")}function Sp(){let e=!1;try{e=!!Gs?.()}catch{}$s("reset",e)}function Ip(){let e=!1;try{e=!!Gt?.()}catch{}$s("workshop",e)}function yv(){let e=!1;try{typeof No=="function"&&(e=No())}catch{}$s("warp",e)}function TE(){let e=b();if(e==null)return!1;try{return typeof vn=="function"&&vn()?!0:localStorage.getItem(Lv(e))==="1"}catch{return!1}}function _p(){$s("lab",TE())}function wp(){$s("channel",fu())}function kE(e){if(e&&typeof e=="object"){if(typeof e.toPlainIntegerString=="function")try{let n=e.toPlainIntegerString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}if(typeof e.toString=="function")try{let n=e.toString();if(n!=null){let o=Number.parseInt(n,10);if(Number.isFinite(o))return o}}catch{}}let t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function AE(){let e={xpUnlocked:!1,xpLevel:0,hasForgeReset:!1};try{e.xpUnlocked=typeof gn=="function"&&gn()}catch{e.xpUnlocked=!1}if(e.xpUnlocked)try{let t=typeof Qe=="function"?Qe():null;t&&typeof t=="object"&&(e.xpLevel=kE(t.xpLevel))}catch{e.xpLevel=0}try{e.hasForgeReset=typeof Ur=="function"&&Ur()}catch{e.hasForgeReset=!1}try{e.hasInfuseReset=typeof Gt=="function"&&Gt()}catch{e.hasInfuseReset=!1}return e}function NE(e,t){let n;try{n=typeof e.unlock=="function"?e.unlock(t):!0}catch{n=!1}let o=n&&typeof n=="object"?n:null,r="locked";if(n===!0)r="unlocked";else if(o){let s=String(o.status??"").toLowerCase();s==="unlocked"||o.unlocked===!0?r="unlocked":s==="mysterious"?r="mysterious":r="locked"}else(n===!1||n==null)&&(r="locked");let i={status:r,unlocked:r==="unlocked",title:r==="unlocked"?e.title:"???",blurb:r==="unlocked"?e.blurb:r==="mysterious"?xp:Lp,tooltip:"",message:"",icon:null,headerTitle:null,ariaLabel:""};return r==="unlocked"?(i.ariaLabel=e.title||"Merchant dialogue",i):(i.title=o?.title??"???",i.blurb=o?.requirement??o?.message??o?.tooltip??(r==="mysterious"?xp:Lp),i.tooltip=o?.tooltip??(r==="locked"?"Locked Dialogue":"Hidden Dialogue"),i.message=o?.message??(r==="mysterious"?Np:""),i.icon=o?.icon??(r==="mysterious"?Pr:null),i.headerTitle=o?.headerTitle??(r==="mysterious"?rr:xE),i.ariaLabel=o?.ariaLabel??(r==="mysterious"?"Hidden merchant dialogue":"Locked merchant dialogue"),i)}function RE(){if(mv)return;mv=!0;let e=OE;typeof window<"u"&&(window.addEventListener("xp:change",e),window.addEventListener("xp:unlock",e),window.addEventListener("forge:completed",n=>{let o=n?.detail?.slot;o!=null&&o!==b()||e()}),window.addEventListener("unlock:change",e),window.addEventListener("debug:change",e),window.addEventListener("surge:level:change",e)),document.addEventListener("ccc:upgrades:changed",e);let t=b();if(t!=null){let n=`${_E}:${t}`;kt(n,{onChange:e})}}function OE(){ir()}function PE(e,t){let n=Rp(),o=String(e),r=n[o]||{};return t.once&&r.claimed?!1:(r.claimed=!0,n[o]=r,_v(n),BE(t.reward),!0)}function BE(e){if(e){if(e.type==="coins"){try{R.coins.add(e.amount)}catch(t){console.warn("Failed to grant coin reward:",e,t)}return}if(e.type==="books"){try{R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount)}catch(t){console.warn("Failed to grant book reward:",e,t)}return}if(e.type==="gold"){try{R.gold.add(e.amount)}catch(t){console.warn("Failed to grant gold reward:",e,t)}return}if(e.type==="magic"){try{R.magic.add(e.amount)}catch(t){console.warn("Failed to grant magic reward:",e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function FE(e){return e?e.type==="coins"?`Reward: ${e.amount} coins`:e.type==="books"?`Reward: ${e.amount} Books`:e.type==="gold"?`Reward: ${e.amount} Gold`:"Reward available":""}function Rp(){try{return JSON.parse(localStorage.getItem(Br(Sl))||"{}")}catch{return{}}}function _v(e){let t=Br(Sl);try{let n=JSON.stringify(e);localStorage.setItem(t,n);try{ct(t,n)}catch{}}catch{}}function UE(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function DE(){let e=Cp;if(Cp=null,typeof e=="function")try{e()}catch{}}function $E(e,t={}){t?.rawChanged&&ir()}function Ep(e){if(e===vv)return;if(DE(),vv=e??null,e==null){ir();return}let t=`${Sl}:${e}`;Cp=kt(t,{parse:UE,onChange:$E});try{ct(t)}catch{}ir()}function qE(){if(hv){Ep(b());return}hv=!0,Ep(b()),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{Ep(b())})}function Dr(){Promise.resolve().then(()=>(Cn(),dc)).then(({loadAudio:e})=>{e(Cv)})}function GE(){if(Fs)return;Fs=pt(Cv,{volume:Je?.15:.3,loop:!0})}function ar(){Fs&&(Fs.stop&&Fs.stop(),Fs=null)}function HE(e,t,n=22,o=[]){return new Promise(r=>{let i=[],s="",l=!1;for(let I=0;I<t.length;I++){let E=t[I];E==="<"?(s&&(i.push({type:"text",content:s}),s=""),l=!0,s+=E):E===">"&&l?(s+=E,i.push({type:"tag",content:s}),s="",l=!1):s+=E}s&&i.push({type:l?"tag":"text",content:s});let a=0,u=0,f=!1,d=!1,m="";sr=!0,GE();let v=I=>{d&&(I.preventDefault(),f=!0)},p=I=>{d&&(I.key==="Enter"||I.key===" ")&&(f=!0)},h=o.length?o:[e];requestAnimationFrame(()=>{d=!0,h.forEach(I=>I.addEventListener("click",v,{once:!0})),document.addEventListener("keydown",p,{once:!0})}),e.classList.add("is-typing"),e.innerHTML="";let g=()=>{h.forEach(I=>I.removeEventListener("click",v)),document.removeEventListener("keydown",p),e.classList.remove("is-typing"),ar(),sr=!1},y=()=>{if(f){e.innerHTML=t,g(),r();return}if(a>=i.length){g(),r();return}let I=i[a];I.type==="tag"?(m+=I.content,e.innerHTML=m,a++,y()):(m+=I.content[u],e.innerHTML=m,u++,u>=I.content.length&&(a++,u=0),setTimeout(y,n))};y()})}function XE(e={}){if(!ze)return;Dr();let t=document.createElement("div");t.className="merchant-firstchat merchant-lockinfo",t.setAttribute("data-dismissible","1"),t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${e.ariaLabel||rr}"><div class="merchant-firstchat__header"><div class="name"></div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row merchant-lockinfo__row"><img class="merchant-firstchat__icon" src="${e.icon||Pr}" alt=""><div class="merchant-firstchat__text merchant-lockinfo__message"></div></div><div class="merchant-firstchat__actions merchant-lockinfo__actions"><button type="button" class="merchant-firstchat__continue merchant-lockinfo__close">Close</button></div></div>`,ze.appendChild(t);let n=t.querySelector(".merchant-firstchat__card"),o=t.querySelector(".merchant-firstchat__header .name"),r=t.querySelector(".merchant-lockinfo__message"),i=t.querySelector(".merchant-lockinfo__close");o.textContent=e.headerTitle||rr,r.textContent=e.message||Np,requestAnimationFrame(()=>t.classList.add("is-visible")),ze.classList.add("firstchat-active");let s=!1,l=()=>{s||(s=!0,t.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),ar(),sr=!1,document.removeEventListener("keydown",a,!0),setTimeout(()=>t.remove(),160))},a=f=>{f.key==="Escape"&&(f.preventDefault(),l())};document.addEventListener("keydown",a,!0),t.addEventListener("pointerdown",f=>{n.contains(f.target)||(f.preventDefault(),Bn(160),l())});let u=f=>{(!f||f.pointerType!=="mouse")&&Bn(160),l()};bl(i,()=>{u()},{once:!0}),i.focus?.()}function VE(e,t){Dr();let n=t.scriptId;String(e)==="6"&&typeof bs=="function"&&!bs()&&(n=7),Zr(!0);let o=document.createElement("div");o.className="merchant-firstchat",o.setAttribute("data-dismissible","1"),o.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="${t.title}"><div class="merchant-firstchat__header"><div class="name">${gu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text">\u2026</div></div><div class="merchant-firstchat__choices"></div></div>`,ze.appendChild(o);let r=g=>{g.key==="Escape"&&o.isConnected&&d()};document.addEventListener("keydown",r,{capture:!0}),requestAnimationFrame(()=>o.classList.add("is-visible")),ze.classList.add("firstchat-active");let i=o.querySelector(".merchant-firstchat__text"),s=o.querySelector(".merchant-firstchat__row"),l=o.querySelector(".merchant-firstchat__card"),a=o.querySelector(".merchant-firstchat__choices"),u=!1,f=()=>{Zr(!1),document.removeEventListener("keydown",r,{capture:!0}),o.classList.remove("is-visible"),ze.classList.remove("firstchat-active"),ar(),sr=!1,o.remove()},d=()=>{u||(u=!0,f(),ir())};o.addEventListener("pointerdown",g=>{l.contains(g.target)||(g.preventDefault(),g.pointerType!=="mouse"&&Bn(160),d())});let m=new Fr({textEl:i,choicesEl:a,skipTargets:[i,s,l],onChoice:(g,y)=>{t.scriptId===4&&g==="c4b"&&hu(!0)},onEnd:g=>{if(!u){if(u=!0,g&&g.noReward){ir(),f();return}PE(e,t),ir(),f()}}}),p=!!Rp()[e]?.claimed,h=structuredClone(_d[n]);p&&h.nodes.m2b&&h.nodes.c2a&&t.scriptId===1&&(h.nodes.m2b.say="I've already given you Coins, goodbye.",h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}]),p&&t.scriptId===2&&h.nodes.m3a&&(h.nodes.m3a.say="I've already given you Books, goodbye.",h.nodes.c2a&&(h.nodes.c2a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===3&&h.nodes.m5a&&(h.nodes.m5a.say="I've already given you Gold, goodbye.",h.nodes.c5a&&(h.nodes.c5a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),p&&t.scriptId===4&&h.nodes.m7a&&(h.nodes.m7a.say="I've already given you Magic, goodbye.",h.nodes.c7a&&(h.nodes.c7a.options=[{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"},{label:"Goodbye.",to:"end_nr"}])),m.load(h),m.start()}function YE(){if(document.getElementById(Sv))return;let e=document.createElement("style");e.id=Sv,e.textContent=`\n      @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n      }\n  `,document.head.appendChild(e)}function WE(){let e=ze?.querySelector(".merchant-content");if(!e||e.__customScroll||!mt)return;let t=document.createElement("div");t.className="merchant-scrollbar";let n=document.createElement("div");n.className="merchant-scrollbar__thumb",t.appendChild(n),mt.appendChild(t);let o=window.matchMedia?.("(hover: none) and (pointer: coarse)")?.matches,r=150,i=120,s="onscrollend"in window,l=null,u=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(u){YE();let C=`--merchant-scroll-${Math.random().toString(36).slice(2,8)}`;mt.style.timelineScope=C,e.style.scrollTimelineName=C,e.style.scrollTimelineAxis="block",n.style.animationName="scroll-thumb-move",n.style.animationTimeline=C,n.style.animationDuration="1ms",n.style.animationTimingFunction="linear",n.style.animationFillMode="both"}let f=null,d=()=>{let T=(e.scrollTop||0)>0;f!==T&&(f=T,mt?.classList.toggle("has-scroll-shadow",T))},m=()=>{let T=ze.querySelector(".merchant-grabber"),C=ze.querySelector(".merchant-header"),Y=ze.querySelector(".merchant-actions"),Q=(T?.offsetHeight||0)+(C?.offsetHeight||0)|0,ae=(Y?.offsetHeight||0)|0;t.style.top=Q+"px",t.style.bottom=ae+"px"},v={},p=()=>{let{scrollHeight:T,clientHeight:C,scrollTop:Y}=e,Q=t.clientHeight||e.clientHeight||1;if(v.scrollHeight===T&&v.clientHeight===C&&v.barH===Q&&(u||v.scrollTop===Y))return;v={scrollHeight:T,clientHeight:C,scrollTop:Y,barH:Q};let ae=C/Math.max(1,T),he=Math.max(28,Math.round(Q*ae)),be=Math.max(1,T-C),Oe=Math.max(0,Q-he);if(n.style.height=he+"px",u)n.style.setProperty("--thumb-y",`${Oe}px`),n.style.setProperty("--thumb-x","0px");else{let ke=Math.round(Y/be*Oe);n.style.transform=`translateY(${ke}px)`}t.style.display=T<=C+1?"none":""},h=()=>{m(),p(),d()},g=()=>{o&&(mt.classList.add("is-scrolling"),l&&clearTimeout(l))},y=T=>{o&&(l&&clearTimeout(l),l=setTimeout(()=>{mt.classList.remove("is-scrolling")},T))},I=()=>{p(),d(),o&&g(),s||y(r)},E=()=>y(r);e.addEventListener("scroll",I,{passive:!0}),s&&e.addEventListener("scrollend",E,{passive:!0});let M=new ResizeObserver(h);M.observe(e),window.addEventListener("resize",h),requestAnimationFrame(h);let A=!1,G=0,P=0,$=T=>{A=!0,G=T.clientY,P=e.scrollTop,n.classList.add("dragging"),g();try{n.setPointerCapture(T.pointerId)}catch{}T.preventDefault()},L=T=>{if(!A)return;let C=t.clientHeight||1,Y=n.clientHeight||1,Q=Math.max(1,C-Y),ae=Math.max(1,e.scrollHeight-e.clientHeight),be=(T.clientY-G)/Q*ae;e.scrollTop=P+be},F=T=>{if(A){A=!1,n.classList.remove("dragging"),y(i);try{n.releasePointerCapture(T.pointerId)}catch{}}};n.addEventListener("pointerdown",$),window.addEventListener("pointermove",L,{passive:!0}),window.addEventListener("pointerup",F),window.addEventListener("pointercancel",F),t.addEventListener("pointerdown",T=>{if(T.target===n)return;let C=t.getBoundingClientRect(),Y=T.clientY-C.top,Q=t.clientHeight||1,ae=n.clientHeight||1,he=Math.max(0,Q-ae),be=Math.max(0,Math.min(Y-ae/2,he)),Oe=Math.max(1,e.scrollHeight-e.clientHeight);e.scrollTop=be/Math.max(1,he)*Oe,g(),y(r)}),e.__customScroll={bar:t,thumb:n,ro:M,updateAll:h},h()}function vu(){if(ze)return;ze=document.createElement("div"),ze.className="merchant-overlay",ze.id="merchant-overlay",ze.setAttribute("inert",""),mt=document.createElement("div"),mt.className="merchant-sheet",mt.setAttribute("role","dialog"),mt.setAttribute("aria-modal","false"),mt.setAttribute("aria-label","Merchant");let e=document.createElement("div");e.className="merchant-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="merchant-header",t.innerHTML='<div class="merchant-title">Merchant</div><div class="merchant-line" aria-hidden="true"></div>';let n=document.createElement("div");n.className="merchant-content";let o=document.createElement("div");o.className="merchant-tabs",o.setAttribute("role","tablist");let r=document.createElement("div");r.className="merchant-panels";let i=document.createElement("section");i.className="merchant-panel is-active",i.id="merchant-panel-dialogue";let s=document.createElement("section");s.className="merchant-panel",s.id="merchant-panel-reset";let l=document.createElement("section");l.className="merchant-panel",l.id="merchant-panel-workshop";let a=document.createElement("section");a.className="merchant-panel",a.id="merchant-panel-warp";let u=document.createElement("section");u.className="merchant-panel",u.id="merchant-panel-lab";let f=document.createElement("section");f.className="merchant-panel",f.id="merchant-panel-channel",Sp(),Ip(),yv(),_p(),wp(),_i.forEach(p=>{p.key==="dialogue"&&Us.set("dialogue",!0);let h=Us.get(p.key),g=h??!!p.unlocked,y=document.createElement("button");y.type="button",y.className="merchant-tab",y.dataset.tab=p.key;let I=p.lockedLabel||"???";y.textContent=g?p.label:I,g?y.title=p.label||"Tab":(y.classList.add("is-locked"),y.disabled=!0,y.title="???"),p.unlocked=g,Us.set(p.key,g),bl(y,E=>{if(y.disabled){E?.preventDefault?.();return}Su(p.key)}),o.appendChild(y),an.buttons[p.key]=y}),an.panels.dialogue=i,an.panels.reset=s,an.panels.workshop=l,an.panels.warp=a,an.panels.lab=u,an.panels.channel=f,an.tablist=o,r.append(i,s,l,a,u,f),n.append(o,r),Sp(),Ip();try{zo()}catch{}try{Op(s)}catch{}try{qe()}catch{}try{pp(l)}catch{}try{lv(a)}catch{}try{$d(u)}catch{}try{dv(f)}catch{}if(!gv&&typeof window<"u"){let p=h=>{let{key:g,slot:y}=h?.detail??{};y!=null&&y!==b()||((g==="forge"||!g)&&Sp(),(g==="infuse"||!g)&&Ip(),(g==="surge_completed"||!g)&&yv(),(g==="lab"||g==="tsunami"||!g)&&_p(),(g==="channel"||!g)&&wp())};window.addEventListener("unlock:change",p,{passive:!0}),window.addEventListener("saveSlot:change",p,{passive:!0}),window.addEventListener("surge:level:change",()=>wp(),{passive:!0}),gv=!0}let d=document.createElement("div");d.className="merchant-actions";let m=document.createElement("button");m.type="button",m.className="merchant-close",m.textContent="Close",pu=m,d.appendChild(m);let v=document.createElement("div");v.className="merchant-firstchat merchant-firstchat--initial",v.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="First chat"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="merchant-first-line">\u2026</div></div><div class="merchant-firstchat__choices" id="merchant-first-choices"></div></div>`,mt.append(e,t,n,d,v),ze.appendChild(mt),document.body.appendChild(ze),zE(),WE(),bv||(bv=!0,bl(m,()=>{bu()},{once:!1}),document.addEventListener("keydown",JE),e.addEventListener("pointerdown",QE),e.addEventListener("touchstart",h=>h.preventDefault(),{passive:!1}),ze.addEventListener("pointerdown",Dr,{once:!0}))}function zE(){let e=document.getElementById("merchant-panel-dialogue");if(!e||e.__dlgInit)return;e.__dlgInit=!0;let t=document.createElement("div");t.className="merchant-dialogue-list",e.appendChild(t),e.__dlgList=t,RE(),ir()}function KE(e){let t=e.currentTarget;if(!t)return;let n=t._dlgCtx;if(n){if(t.classList.contains("is-locked")&&!n.isMysterious){e?.preventDefault?.();return}n.unlocked?VE(n.id,n.meta):n.isMysterious&&XE(n.lockInfo)}}function ir(){let e=document.getElementById("merchant-panel-dialogue");if(!e)return;let t=e.__dlgList;if(!t)return;let n=AE(),o=Rp(),r=!1,i=new Set;Object.entries(yu).forEach(([s,l])=>{i.add(String(s));let a=o[s]||{},u=a.status||"locked",f=du(u),d=NE(l,n),m=d.status,v=du(m);if(v>f)a.status=m,m==="mysterious"?a.lockSnapshot=pv(d):m==="unlocked"&&delete a.lockSnapshot,o[s]=a,r=!0;else if(v<f){if(u==="unlocked")d=ME(l),m="unlocked",v=du(m);else if(u==="mysterious"){let T=a.lockSnapshot||pv(d)||{};d={status:"mysterious",unlocked:!1,title:T.title??d.title??"???",blurb:T.blurb??d.blurb??xp,tooltip:T.tooltip??d.tooltip??"Hidden Dialogue",message:T.message??d.message??Np,icon:T.icon??d.icon??Pr,headerTitle:T.headerTitle??d.headerTitle??rr,ariaLabel:T.ariaLabel??d.ariaLabel??"Hidden merchant dialogue"},m="mysterious",v=du(m)}}let p=m==="unlocked",h=m==="mysterious",g=m==="locked",y=!!a.claimed,I=p&&!!(l.once&&y),E=t.querySelector(`.dlg-card[data-dlg-id="${s}"]`);if(!E){E=document.createElement("button"),E.type="button",E.className="dlg-card",E.dataset.dlgId=String(s);let T=document.createElement("div");T.className="dlg-title";let C=document.createElement("div");C.className="dlg-blurb";let Y=document.createElement("div");Y.className="dlg-reward",E.append(T,C,Y),t.appendChild(E),bl(E,KE)}E._dlgCtx={id:s,meta:l,lockInfo:d,unlocked:p,isMysterious:h},E.dataset.dlgStatus=m,E.disabled!==!!g&&(E.disabled=!!g),E.classList.toggle("is-locked",g),E.classList.toggle("is-mysterious",h),E.classList.toggle("is-complete",!!I),E.classList.toggle("has-again",!!I),g?(E.getAttribute("aria-disabled")!=="true"&&E.setAttribute("aria-disabled","true"),E.getAttribute("tabindex")!=="-1"&&E.setAttribute("tabindex","-1")):(E.hasAttribute("aria-disabled")&&E.removeAttribute("aria-disabled"),E.hasAttribute("tabindex")&&E.removeAttribute("tabindex"));let M=E.querySelector(".dlg-title"),A=p?l.title:d.title??"???";M.textContent!==A&&(M.textContent=A);let G=E.querySelector(".dlg-blurb"),P=p?l.blurb:d.blurb??"";G.textContent!==P&&(G.textContent=P);let $=E.querySelector(".dlg-reward");if(p&&l.reward){let T=EE[l.reward.type];if(T){$.classList.contains("has-reward")||($.classList.add("has-reward"),$.innerHTML='<span class="reward-label">Reward:</span><span class="reward-chunk"><span class="reward-icon" aria-hidden="true"></span><span class="amt"></span><span class="currency-name"></span></span>'),$.style.getPropertyValue("--reward-icon")!==`url('${T}')`&&$.style.setProperty("--reward-icon",`url('${T}')`);let C=$.querySelector(".amt"),Y=String(l.reward.amount);C&&C.textContent!==Y&&(C.textContent=Y);let Q=$.querySelector(".currency-name");if(Q){let he=String(l.reward.type||""),be=he.charAt(0).toUpperCase()+he.slice(1);Q.textContent!==be&&(Q.textContent=be)}let ae=`Reward: ${l.reward.amount} ${l.reward.type}`;$.getAttribute("aria-label")!==ae&&$.setAttribute("aria-label",ae)}else{$.classList.remove("has-reward");let C=FE(l.reward);$.textContent!==C&&($.textContent=C),$.style.display!==""&&($.style.display=""),$.removeAttribute("aria-label")}$.style.display==="none"&&($.style.display="")}else $.textContent!==""&&($.textContent=""),$.style.display!=="none"&&($.style.display="none");let L=p?`${l.title}${I?" (completed)":""}`:d.ariaLabel||(h?"Hidden merchant dialogue":"Locked merchant dialogue");if(E.getAttribute("aria-label")!==L&&E.setAttribute("aria-label",L),d.tooltip)E.title!==d.tooltip&&(E.title=d.tooltip);else if(p){let T="Left-click: Start Dialogue";E.title!==T&&(E.title=T)}else E.hasAttribute("title")&&E.removeAttribute("title");let F=E.querySelector(".dlg-again");I?F||(F=document.createElement("div"),F.className="dlg-again",F.textContent="Ask Again?",E.appendChild(F)):F&&F.remove()}),Array.from(t.children).forEach(s=>{s.dataset.dlgId&&!i.has(s.dataset.dlgId)&&s.remove()}),r&&_v(o)}function jE(){let e=ze.querySelector(".merchant-firstchat"),t=e.querySelector("#merchant-first-line"),n=e.querySelector(".merchant-firstchat__row"),o=e.querySelector(".merchant-firstchat__card"),r=e.querySelector("#merchant-first-choices");Zr(!0);let i=new Fr({textEl:t,choicesEl:r,skipTargets:[t,n,o],onEnd:()=>{Zr(!1);try{localStorage.setItem(Br(Tp),"1")}catch{}try{window.dispatchEvent(new Event(kp))}catch{}e.classList.remove("is-visible"),ze.classList.remove("firstchat-active")}});i.load(_d[0]),i.start()}function ZE(){if(!ze)return;let e=ze.querySelector(".merchant-firstchat--initial");if(!e)return;e.classList.remove("is-visible");let t=e.querySelector("#merchant-first-line");t&&(t.classList.remove("is-typing"),t.textContent="\u2026");let n=e.querySelector("#merchant-first-choices");n&&(n.classList.remove("is-visible"),n.style.opacity="0",n.style.transform="translateY(6px)",n.style.pointerEvents="none",n.style.minHeight="",n.innerHTML=""),ze.classList.remove("firstchat-active")}function Mv(){if(vu(),Ci)return;let e=document.activeElement;e instanceof HTMLElement&&!ze.contains(e)?mu=e:mu=null,Ci=!0;let t=b(),n=!1;if(t!=null){let i=`ccc:tsunami:labPending:${t}`;if(localStorage.getItem(i)==="1"){try{localStorage.removeItem(i)}catch{}try{localStorage.setItem(Lv(t),"1")}catch{}_p();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"lab",slot:t}}))}catch{}n=!0}}let o=!1;try{o=localStorage.getItem(Br(Tp))==="1"}catch{o=!1}o||ze.classList.add("firstchat-instant");let r="dialogue";try{r=localStorage.getItem(Br(Iv))||"dialogue"}catch{}n&&(r="dialogue"),Su(r),ar(),o||(ze.querySelector(".merchant-firstchat")?.classList.add("is-visible"),ze.classList.add("firstchat-active"),jE()),mt.style.transition="none",mt.style.transform="",ze.removeAttribute("inert"),mt.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ze.classList.contains("firstchat-instant")||(mt.style.transition=""),ze.classList.add("is-open"),Bn(140),pu&&typeof pu.focus=="function")try{pu.focus({preventScroll:!0})}catch{}})})}function bu(){if(!Ci)return;if(Zr(!1),Je){try{ko(100)}catch{}try{Bn(80)}catch{}}Ci=!1,mt.style.transition="",mt.style.transform="",ze.classList.remove("is-open"),ze.classList.remove("firstchat-instant"),ZE();let e=document.activeElement;if(e&&ze.contains(e)){let t=mu;if((!t||!t.isConnected)&&(t=document.querySelector('[data-btn="shop"], .btn-shop')),t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{}}ze.setAttribute("inert",""),mu=null,ar(),sr=!1}function JE(e){if(Ci&&!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName)&&/^[0-9]$/.test(e.key)){let t=parseInt(e.key,10),n=t===0?9:t-1,o=-1;for(let i=0;i<_i.length;i++)Us.get(_i[i].key)&&(o=i);o===-1&&(o=0);let r=n;r>o&&(r=o),r>=0&&r<_i.length&&(e.preventDefault(),Pv(),Su(_i[r].key))}}function QE(e){if(!Ci)return;let t=typeof e.clientY=="number"?e.clientY:e.touches&&e.touches[0]?e.touches[0].clientY:0;Pn={startY:t,lastY:t,startT:performance.now(),moved:0,canceled:!1},mt.style.transition="none",window.addEventListener("pointermove",Tv,{passive:!0}),window.addEventListener("pointerup",kv),window.addEventListener("pointercancel",Av)}function Tv(e){if(!Pn||Pn.canceled)return;let t=e.clientY;if(typeof t!="number")return;let n=Math.max(0,t-Pn.startY);Pn.lastY=t,Pn.moved=n,mt.style.transform=`translateY(${n}px)`}function kv(){if(!Pn||Pn.canceled){Mp();return}let e=Math.max(1,performance.now()-Pn.startT),t=Pn.moved;t/e>.55&&t>40||t>140?(ko(160),mt.style.transition="transform 140ms ease-out",mt.style.transform="translateY(100%)",setTimeout(()=>{bu()},150)):(mt.style.transition="transform 180ms ease",mt.style.transform="translateY(0)"),Mp()}function Av(){Pn&&(Pn.canceled=!0,mt.style.transition="transform 180ms ease",mt.style.transform="translateY(0)",Mp())}function Mp(){window.removeEventListener("pointermove",Tv),window.removeEventListener("pointerup",kv),window.removeEventListener("pointercancel",Av),Pn=null}function Su(e){let t=_i.find(o=>o.key===e),n=Us.get(e);(!t||!n)&&(e="dialogue"),mt&&(e==="lab"?mt.classList.add("is-lab-active"):mt.classList.remove("is-lab-active"));for(let o in an.buttons)an.buttons[o].classList.toggle("is-active",o===e);for(let o in an.panels)an.panels[o].classList.toggle("is-active",o===e);if(e==="dialogue")try{ir()}catch{}if(e==="warp")try{or()}catch{}if(e==="lab"){typeof bs=="function"&&!bs()&&ex();try{qd()}catch{}}if(e==="channel")try{}catch{}try{localStorage.setItem(Br(Iv),e)}catch{}requestAnimationFrame(()=>{requestAnimationFrame(()=>{let o=ze?.querySelector(".merchant-content");o&&o.__customScroll&&typeof o.__customScroll.updateAll=="function"&&o.__customScroll.updateAll()})})}function Nv(){if(!Ci)return!1;let e=an.buttons.lab;return e&&e.classList.contains("is-active")}function Il(e=[]){e.forEach(t=>$s(t,!0))}function Rv(e,t,n){let o={start:"n1",nodes:{n1:{type:"line",say:"O Great Tsunami\u2026",next:"c1"},c1:{type:"choice",options:[{label:"...",to:"n2"}]},n2:{type:"line",say:"Cover this Cove in your wet embrace\u2026",next:"c2"},c2:{type:"choice",options:[{label:"...",to:"n3"}]},n3:{type:"line",say:"We have thirsted for far too long\u2026",next:"c3"},c3:{type:"choice",options:[{label:"...",to:"n4"}]},n4:{type:"line",say:"Awaken what once was lost\u2026",next:"c4"},c4:{type:"choice",options:[{label:"...",to:"n5"}]},n5:{type:"line",say:"You will have my deepest gratitude\u2026",next:"c5"},c5:{type:"choice",options:[{label:"...",to:"end"}]}}},r=document.createElement("div");r.className="merchant-firstchat is-visible",r.style.zIndex="2147483647",r.style.userSelect="none",r.style.webkitUserSelect="none",r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices"></div></div>`,e.appendChild(r);let i=r.querySelector("#tsunami-dlg-line"),s=r.querySelector("#tsunami-dlg-choices"),l=r.querySelector(".merchant-firstchat__row"),a=r.querySelector(".merchant-firstchat__card");Dr();let u=v=>{v.key==="Escape"&&(v.stopImmediatePropagation(),v.preventDefault())};document.addEventListener("keydown",u,{capture:!0});let f=()=>{setTimeout(()=>{n&&n.triggerBeacons&&n.triggerBeacons(),setTimeout(()=>{n&&n.triggerFinalFade&&n.triggerFinalFade(),setTimeout(()=>{d()},5e3)},15e3)},1e3)},d=()=>{n&&n.showCursor&&n.showCursor(),r.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Tsunami Dialogue"><div class="merchant-firstchat__header"><div class="name">Merchant</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="tsunami-dlg-line-2" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="tsunami-dlg-choices-2"></div></div>`;let v=r.querySelector("#tsunami-dlg-line-2"),p=r.querySelector("#tsunami-dlg-choices-2"),h=r.querySelector(".merchant-firstchat__row"),g=r.querySelector(".merchant-firstchat__card"),y={start:"final",nodes:{final:{type:"line",say:'I am sure the <span style="color:#00e5ff">Player</span> will have some questions when they wake up, but I will deal with that when I must.',next:"end"},end:{type:"choice",options:[{label:"...",to:"end"}]}}},I=new Fr({textEl:v,choicesEl:p,skipTargets:[v,h,g],onEnd:()=>{r.innerHTML="",n&&n.hideCursor&&n.hideCursor(),setTimeout(()=>{document.removeEventListener("keydown",u,{capture:!0}),ar(),sr=!1,r.remove(),t&&t()},5e3)}});I.load(y),I.start()},m=new Fr({textEl:i,choicesEl:s,skipTargets:[i,l,a],onEnd:()=>{r.innerHTML="",ar(),sr=!1,n&&n.hideCursor&&n.hideCursor(),f()}});m.load(o),m.start()}function ex(){let e=document.createElement("div");e.className="merchant-firstchat is-visible",e.style.zIndex="2147483647",e.style.position="fixed",e.style.inset="0",e.style.userSelect="none",e.style.webkitUserSelect="none",e.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Lab Introduction"><div class="merchant-firstchat__header"><div class="name">${gu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="lab-intro-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="lab-intro-choices"></div></div>`,document.body.appendChild(e);let t=e.querySelector("#lab-intro-line"),n=e.querySelector("#lab-intro-choices"),o=e.querySelector(".merchant-firstchat__row"),r=e.querySelector(".merchant-firstchat__card");Dr();let i={start:"n1",nodes:{n1:{type:"line",say:`Hey, <span style="color:#00e5ff">Player</span>, welcome to the Lab. I'll keep it brief: Research nodes, increase your Lab Level to research nodes faster, and you'll be making tons of Coins. Your Surge milestones were sacrificed temporarily to the Tsunami but that's not important, get to researching!`,next:"c1"},c1:{type:"choice",options:[{label:"I don't understand.",to:"end_nr"},{label:"Tsunami sacrifice?",to:"end_nr"},{label:"???",to:"end_nr"}]}}},s=new Fr({textEl:t,choicesEl:n,skipTargets:[t,o,r],onEnd:()=>{ar(),sr=!1,e.remove()}});s.load(i),s.start()}function Ov(e){let t=document.createElement("div");t.className="merchant-firstchat is-visible",t.style.zIndex="2147483647",t.style.position="fixed",t.style.inset="0",t.style.userSelect="none",t.style.webkitUserSelect="none",t.innerHTML=`<div class="merchant-firstchat__card" role="dialog" aria-label="Urgent Message"><div class="merchant-firstchat__header"><div class="name">${gu()}</div><div class="rule" aria-hidden="true"></div></div><div class="merchant-firstchat__row"><img class="merchant-firstchat__icon" src="${Ds}" alt=""><div class="merchant-firstchat__text" id="post-tsunami-line" style="user-select: none; -webkit-user-select: none;">\u2026</div></div><div class="merchant-firstchat__choices" id="post-tsunami-choices"></div></div>`,document.body.appendChild(t);let n=t.querySelector("#post-tsunami-line"),o=t.querySelector("#post-tsunami-choices"),r=t.querySelector(".merchant-firstchat__row"),i=t.querySelector(".merchant-firstchat__card");Dr();let s={start:"n1",nodes:{n1:{type:"line",say:'<span style="color:#00e5ff">Player</span>, quickly, come to the Lab.',next:"c1"},c1:{type:"choice",options:[{label:"What?",to:"end"},{label:"The Lab?",to:"end"},{label:"???",to:"end"}]}}},l=new Fr({textEl:n,choicesEl:o,skipTargets:[n,r,i],onEnd:()=>{ar(),sr=!1,t.remove(),e&&e()}});l.load(s),l.start()}var Ds,Tp,Iv,Sl,kp,Br,Ev,_i,Us,EE,Pr,rr,xE,xp,Lp,Np,LE,_E,xv,CE,mv,hv,gv,Lv,vv,Cp,yu,ze,mt,pu,Ci,Pn,mu,bv,an,Cv,Fs,sr,Fr,Sv,qs=De(()=>{vt();xt();ey();An();mo();Es();vp();hi();bp();yn();gi();fs();vo();Cn();Ds="img/misc/merchant.webp",Tp="ccc:merchantMet",Iv="ccc:merchantTab",Sl="ccc:merchant:dlgState",kp="ccc:merchant:met",Br=e=>`${e}:${b()}`;Ev="ccc:unlock:jeff";_i=[{key:"dialogue",label:"Dialogue",unlocked:!0},{key:"reset",label:"Reset",unlocked:!1,lockedLabel:"???"},{key:"workshop",label:"Workshop",unlocked:!1,lockedLabel:"???"},{key:"warp",label:"Warp",unlocked:!1,lockedLabel:"???"},{key:"lab",label:"Lab",unlocked:!1,lockedLabel:"???"},{key:"channel",label:"Channel",unlocked:!1,lockedLabel:"???"}],Us=new Map([["dialogue",!0],["reset",!1],["workshop",!1],["warp",!1],["lab",!1],["channel",!1]]),EE={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp"},Pr="img/misc/mysterious.webp",rr="Hidden Dialogue",xE="Locked Dialogue",xp="Hidden Dialogue",Lp="Locked",Np="Locked Dialogue",LE={locked:0,mysterious:1,unlocked:2},_E="ccc:reset:forge:completed",xv=typeof window<"u"&&"PointerEvent"in window,CE=!xv&&typeof window<"u"&&"ontouchstart"in window;mv=!1,hv=!1,gv=!1;Lv=e=>`ccc:unlock:lab:${e}`;fv(e=>{let t=typeof bn=="function"?bn():0n;return t===1/0||typeof t=="string"&&t==="Infinity"||t===Number.POSITIVE_INFINITY?!0:typeof t=="bigint"?t>=BigInt(e):typeof t=="number"?t>=e:!1});vv=null,Cp=null;yu={1:{title:"A Generous Gift",blurb:"The Merchant is feeling extra nice today",scriptId:1,reward:{type:"coins",amount:100},unlock:e=>!0,once:!0},2:{title:"A New Experience",blurb:"Discuss the XP system with the Merchant",scriptId:2,reward:{type:"books",amount:5},once:!0,unlock:e=>e?.xpUnlocked?!0:{status:"mysterious",requirement:"Unlock the XP system to reveal this dialogue",message:"Unlock the XP system to reveal this dialogue",icon:Pr,headerTitle:rr,ariaLabel:"Hidden merchant dialogue, unlock the XP system to reveal this dialogue"}},3:{title:"A Golden Opportunity",blurb:"Ask the Merchant a few questions about the Forge",scriptId:3,reward:{type:"gold",amount:10},once:!0,unlock:e=>e?.hasForgeReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<31?{status:"locked",title:"???",blurb:Lp,tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Forge reset to reveal this dialogue",message:"Do a Forge reset to reveal this dialogue",icon:Pr,headerTitle:rr,ariaLabel:"Hidden merchant dialogue, do a Forge reset to reveal this dialogue"}},5:{title:"A Strange Surge",blurb:"Discuss the Surge with the Merchant",scriptId:5,reward:{type:"coins",amount:2},once:!0,unlock:e=>typeof No=="function"&&No()?!0:!e?.xpUnlocked||(e?.xpLevel??0)<201?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do a Surge reset to reveal this dialogue",message:"Do a Surge reset to reveal this dialogue",icon:Pr,headerTitle:rr,ariaLabel:"Hidden merchant dialogue, do a Surge reset to reveal this dialogue"}},6:{title:"The Empty Lab",blurb:"Ask about the Lab",scriptId:6,reward:{type:"coins",amount:2},once:!0,unlock:e=>{if(typeof vn=="function"&&vn())return!0;let t=typeof bn=="function"?bn():0n,n=!1;return t===1/0?n=!0:typeof t=="bigint"?n=t>=8n:typeof t=="number"&&(n=t>=8),n?!0:typeof No=="function"&&No()?{status:"mysterious",requirement:"Reach Surge 8 to reveal this dialogue",message:"Reach Surge 8 to reveal this dialogue",icon:Pr,headerTitle:rr,ariaLabel:"Hidden merchant dialogue, reach Surge 8 to reveal this dialogue"}:{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}}},4:{title:"A Magic Touch",blurb:"Learn about the Merchant\u2019s magical powers",scriptId:4,reward:{type:"magic",amount:10},once:!0,unlock:e=>e?.hasInfuseReset?!0:!e?.xpUnlocked||(e?.xpLevel??0)<101?{status:"locked",title:"???",blurb:"Locked",tooltip:"Locked Dialogue",ariaLabel:"Locked Dialogue"}:{status:"mysterious",requirement:"Do an Infuse reset to reveal this dialogue",message:"Do an Infuse reset to reveal this dialogue",icon:Pr,headerTitle:rr,ariaLabel:"Hidden merchant dialogue, do an Infuse reset to reveal this dialogue"}}};qE();ze=null,mt=null,pu=null,Ci=!1,Pn=null,mu=null,bv=!1,an={buttons:{},panels:{},tablist:null},Cv="sounds/merchant_typing.ogg",Fs=null,sr=!1;Fr=class{constructor({textEl:t,choicesEl:n,skipTargets:o,onEnd:r,onChoice:i}){this.textEl=t,this.choicesEl=n,this.skipTargets=o,this.onEnd=r||(()=>{}),this.onChoice=i,this.nodes={},this.current=null,this.deferNextChoices=!1,this._reservedH=0}load(t){this.nodes=t.nodes||{},this.startId=t.start}async start(){this.startId&&await this.goto(this.startId)}async goto(t){let n=this.nodes[t];if(n){if(this.current=t,n.type==="line"){let o=this.nodes[n.next];if(!this.deferNextChoices&&o&&o.type==="choice"?this._renderChoices(o.options||[],!0):this._hideChoices(),await HE(this.textEl,n.say,n.msPerChar??22,this.skipTargets),o&&o.type==="choice"){if(this.current=n.next,this.deferNextChoices){this.deferNextChoices=!1,this._renderChoices(o.options||[],!1),this.choicesEl.style.minHeight="";return}this._revealPreparedChoices();return}return this.choicesEl.style.minHeight="",n.next==="end"||n.end===!0?this.onEnd():n.next?this.goto(n.next):void 0}n.type==="choice"&&this._renderChoices(n.options||[],!1)}}_hideChoices(){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide()}_renderChoices(t,n=!1){this.choicesEl.innerHTML="";for(let o of t){let r=document.createElement("button");r.type="button",r.className="choice",r.textContent=o.label;let i=bl(r,async s=>{if(s?.stopPropagation?.(),this.onChoice?.(this.current,o),this._reservedH=this.choicesEl.offsetHeight|0,this.choicesEl.style.minHeight=this._reservedH+"px",this._hideChoices(),this.choicesEl.innerHTML="",this.deferNextChoices=!0,o.to==="end")return this.onEnd({noReward:!1});if(o.to==="end_nr")return this.onEnd({noReward:!0});await this.goto(o.to)},{once:!0});this.choicesEl.appendChild(r)}if(n){this.choicesEl.classList.remove("is-visible"),this._applyInlineChoiceHide();return}this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_revealPreparedChoices(){this._clearInlineChoiceHide(),requestAnimationFrame(()=>this.choicesEl.classList.add("is-visible"))}_applyInlineChoiceHide(){this.choicesEl.style.opacity="0",this.choicesEl.style.transform="translateY(6px)",this.choicesEl.style.pointerEvents="none"}_clearInlineChoiceHide(){this.choicesEl.style.opacity="",this.choicesEl.style.transform="",this.choicesEl.style.pointerEvents=""}};Sv="ccc-scroll-timeline-styles"});var Ht,Pp,Bp,Bv,Fp=De(()=>{qt();Ht="dna",Pp="img/misc/mysterious.webp",Bp="Hidden Upgrade",Bv=[{area:Ht,id:1,title:"DNA Coin Value",desc:"Multiplies Coin value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/coin_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"coin_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Coin value bonus: ${Te(t)}x`},{area:Ht,id:2,title:"DNA XP Value",desc:"Multiplies XP value by 1.1x per level",lvlCap:1e3,baseCost:1e3,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/xp_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"xp_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`XP value bonus: ${Te(t)}x`},{area:Ht,id:3,title:"DNA Gold Value",desc:"Multiplies Gold value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/gold_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"gold_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Gold value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Pp,titleOverride:Bp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Ht,id:4,title:"DNA Magic Value",desc:"Multiplies Magic value by 1.1x per level",lvlCap:1e3,baseCost:1e12,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/magic_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"magic_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Magic value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=10||t===1/0)&&(n=!0):typeof t=="bigint"?t>=10n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=10)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 10 to reveal this upgrade";return{locked:!0,iconOverride:Pp,titleOverride:Bp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}},{area:Ht,id:5,title:"DNA Wave Value",desc:"Multiplies Wave value by 1.1x per level",lvlCap:1e3,baseCost:1e39,costType:"dna",upgType:"HM",scalingPreset:"HM",icon:"sc_upg_icons/wave_val_dna.webp",baseIconOverride:"currencies/dna/dna_base.webp",effectType:"wave_value",_dnaEffectVal:1.1,_costScaling:"HM",bonusLine:(e,t)=>`Wave value bonus: ${Te(t)}x`,computeLockState(e){let t=e.surgeLevel,n=!1;if(typeof t=="number"?(t>=19||t===1/0)&&(n=!0):typeof t=="bigint"?t>=19n&&(n=!0):typeof t=="string"?(t==="Infinity"||parseFloat(t)===1/0||!isNaN(parseFloat(t))&&parseFloat(t)>=19)&&(n=!0):t&&typeof t.isInfinite=="function"&&t.isInfinite()&&(n=!0),n)return{locked:!1};let o="Reach Surge 19 to reveal this upgrade";return{locked:!0,iconOverride:Pp,titleOverride:Bp,descOverride:o,reason:o,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}}]});function mp(){return wl.size>0}function Gv(e){if(!e||!e.costType)return!1;let t=ix[e.costType];return!t||At(Ze,t)<=0?!1:yi(e.area,e.id)!=="0"}function Dp(e){if(!e)return null;let t=typeof e.id<"u"?e.id:e;if(typeof t=="number")return Number.isFinite(t)?Math.trunc(t):null;if(typeof t=="string"){let n=Number.parseInt(t.trim(),10);return Number.isFinite(n)?n:null}return null}function wu(e,t){return t==="standard"&&Dp(e)===rx}function Up(e){let t=Mt(e),n={};for(let o of t){let r=Nn(e,o.id),i=At(e,o.id),s=Ro(e,o.id),l=s.iconOverride??Cu(o),a=s.titleOverride??o.title,u=s.descOverride??o.desc,f=!!s.locked,d=o.upgType==="HM"?!!Vs(e,o.id)?.hmReadyToEvolve:!1;n[o.id]={id:o.id,icon:l,title:a,desc:u,level:r,levelNumeric:i,area:o.area,meta:o,locked:f,lockState:s,useLockedBase:!!s.useLockedBase||f,baseIconOverride:_u(o.baseIconOverride||s.baseIconOverride),hmReady:d}}return n}function Hv(e){return Dv[e]||Dv.standard}function Bn(e=140){if(!Je)return;let t=document.getElementById("ccc-tap-shield");if(!t){t=document.createElement("div"),t.id="ccc-tap-shield",Object.assign(t.style,{position:"fixed",inset:"0",zIndex:"2147483647",pointerEvents:"auto",background:"transparent"});let n=o=>{o.stopPropagation(),o.preventDefault()};["pointerdown","pointerup","click","touchstart","touchend","mousedown","mouseup"].forEach(o=>t.addEventListener(o,n,{capture:!0,passive:!1}))}document.body.appendChild(t),clearTimeout(t.__t),t.__t=setTimeout(()=>t.remove(),e)}function xu(e){return String(e??"").replace(/<[^>]*>/g,"")}function Iu(e,t){if(e==="gold")return"Gold";if(e==="magic")return"Magic";if(e==="dna")return"DNA";let n=!1;if(t&&typeof t.cmp=="function")n=!t.isInfinite()&&t.cmp(1)===0;else try{let o=c.fromAny(t);n=!o.isInfinite()&&o.cmp(1)===0}catch{n=t==1||t==="1"}return e==="coins"?n?"Coin":"Coins":e==="books"?n?"Book":"Books":e==="gears"?n?"Gear":"Gears":e?e.charAt(0).toUpperCase()+e.slice(1):""}function sn(){pt(ax,{volume:Je?Xv:Vv})}function Yv(){let e=Je?Xv*2:Vv*2;pt(lx,{volume:e})}function cx(e){return`<img alt="" src="${Uv[e]||Uv.coins}" class="currency-ico">`}function fx(){if(document.getElementById($v))return;let e=document.createElement("style");e.id=$v,e.textContent=`\n    @keyframes scroll-thumb-move {\n      0% { transform: translate(0, 0); }\n      100% { transform: translate(var(--thumb-x, 0), var(--thumb-y, 0)); }\n    }\n  `,document.head.appendChild(e)}function Os(e,t,n=".shop-scroller",o={}){let{orientation:r="vertical"}=o,i=r==="vertical",s=e?.querySelector(n);if(!s||s.__customScroll)return;let l=document.createElement("div");l.className=`shop-scrollbar${i?"":" is-horizontal"}`;let a=document.createElement("div");a.className="shop-scrollbar__thumb",l.appendChild(a),t.appendChild(l),s.__customScroll={bar:l,thumb:a};let u=window.matchMedia("(hover: none) and (pointer: coarse)").matches,f=150,d=120,m="onscrollend"in window,p=CSS.supports("timeline-scope","none")&&CSS.supports("animation-timeline","scroll()");if(p){fx();let W=`--custom-scroll-${Math.random().toString(36).slice(2,8)}`;t.style.timelineScope=W,s.style.scrollTimelineName=W,s.style.scrollTimelineAxis=i?"block":"inline",a.style.animationName="scroll-thumb-move",a.style.animationTimeline=W,a.style.animationDuration="1ms",a.style.animationTimingFunction="linear",a.style.animationFillMode="both"}let h={scrollSize:0,clientSize:0,barSize:0,thumbSize:0,maxScroll:1,range:0,visibleRatio:1},g=null,y=!1,I=null,E=()=>{if(!s.isConnected||!t.isConnected)return;let U=s.getBoundingClientRect(),W=t.getBoundingClientRect();if(i){let q=Math.max(0,U.top-W.top),X=Math.max(0,W.bottom-U.bottom);l.style.top=q+"px",l.style.bottom=X+"px",l.style.left="",l.style.right=""}else{let q=Math.max(0,U.left-W.left),X=Math.max(0,W.right-U.right);l.style.left=q+"px",l.style.right=X+"px",l.style.top="",l.style.bottom="",l.style.height=""}},M=()=>{let U=i?s.scrollHeight:s.scrollWidth,W=i?s.clientHeight:s.clientWidth,q=i?l.clientHeight||W:l.clientWidth||W,X=W/Math.max(1,U),J=Math.max(28,Math.round(q*X)),le=Math.max(1,U-W),fe=Math.max(0,q-J);h={scrollSize:U,clientSize:W,barSize:q,thumbSize:J,maxScroll:le,range:fe,visibleRatio:X},i?(a.style.height=J+"px",a.style.width="100%"):(a.style.width=J+"px",a.style.height="100%"),p&&(i?(a.style.setProperty("--thumb-y",`${fe}px`),a.style.setProperty("--thumb-x","0px")):(a.style.setProperty("--thumb-x",`${fe}px`),a.style.setProperty("--thumb-y","0px")));let _=U>W+1;l.style.display=_?"":"none",t?.classList.toggle("has-active-scrollbar",_),A()},A=()=>{y=!1;let U=i?s.scrollTop:s.scrollLeft,W=(U||0)>0;if(g!==W&&(g=W,t?.classList.toggle("has-scroll-shadow",W)),!p){let{maxScroll:q,range:X}=h,J=Math.round(U/q*X);i?a.style.transform=`translateY(${J}px)`:a.style.transform=`translateX(${J}px)`}u&&L()},G=()=>{E(),M()};s.__customScroll&&(s.__customScroll.update=G);let P,$=()=>{clearTimeout(P),P=setTimeout(G,100)};typeof MutationObserver<"u"&&new MutationObserver(()=>$()).observe(s,{childList:!0,subtree:!0,characterData:!0});let L=()=>{u&&(t.classList.add("is-scrolling"),clearTimeout(s.__fadeTimer))},F=U=>{u&&(clearTimeout(s.__fadeTimer),s.__fadeTimer=setTimeout(()=>{t.classList.remove("is-scrolling")},U))},T=()=>{wl.has(s)||wl.add(s),clearTimeout(I),I=setTimeout(()=>{wl.has(s)&&(wl.delete(s),window.dispatchEvent(new CustomEvent("menu:scrollStop")))},150),y||(y=!0,window.requestAnimationFrame(A)),m||F(f)},C=()=>F(f);s.addEventListener("scroll",T,{passive:!0}),m&&s.addEventListener("scrollend",C,{passive:!0}),new ResizeObserver(()=>{G()}).observe(s),window.addEventListener("resize",G),requestAnimationFrame(G);let Q=!1,ae=0,he=0,be=U=>{Q=!0,ae=i?U.clientY:U.clientX,he=i?s.scrollTop:s.scrollLeft,a.classList.add("dragging"),L();try{a.setPointerCapture(U.pointerId)}catch{}U.preventDefault()},Oe=U=>{if(!Q)return;let{range:W,maxScroll:q}=h;if(W<=0)return;let J=(i?U.clientY:U.clientX)-ae,le=he+J/W*q;i?s.scrollTop=le:s.scrollLeft=le},ke=U=>{if(Q){Q=!1,a.classList.remove("dragging"),F(d);try{a.releasePointerCapture(U.pointerId)}catch{}}};a.addEventListener("pointerdown",be),window.addEventListener("pointermove",Oe,{passive:!0}),window.addEventListener("pointerup",ke),window.addEventListener("pointercancel",ke),l.addEventListener("pointerdown",U=>{if(U.target===a)return;let W=l.getBoundingClientRect(),q=i?U.clientY-W.top:U.clientX-W.left,{thumbSize:X,range:J,maxScroll:le}=h,_=Math.max(0,Math.min(q-X/2,J))/Math.max(1,J)*le;i?s.scrollTop=_:s.scrollLeft=_,L(),F(f)}),G()}function qv(e,t,n){if(!e)return c.fromInt(0);let o=e.lvlCapBn?.clone?.()??(Number.isFinite(e.lvlCap)?c.fromAny(e.lvlCap):null);if(!o)return c.fromInt(0);if(o.isInfinite?.())return c.fromAny("Infinity");let r;try{r=t instanceof c?t:c.fromAny(t??n??0)}catch{let a=Math.max(0,Math.floor(Number(n)||0));r=c.fromInt(a)}if(r.isInfinite?.())return c.fromInt(0);try{let a=o.toPlainIntegerString?.(),u=r.toPlainIntegerString?.();if(a==="Infinity")return c.fromAny("Infinity");if(a&&u&&a!=="Infinity"&&u!=="Infinity"){let f=BigInt(a)-BigInt(u);return f>0n?c.fromAny(f.toString()):c.fromInt(0)}}catch{}let i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0;if(!Number.isFinite(i))return c.fromAny("Infinity");let s=Math.max(0,Math.floor(Number(n)||0)),l=Math.max(0,i-s);return c.fromInt(l)}function dx(e,t,n){let o;try{o=n instanceof c?n:c.fromAny(n??t??0)}catch{let d=Math.max(0,Math.floor(Number(t)||0));o=c.fromInt(d)}if(o.isInfinite?.())return c.fromInt(0);let r=Math.max(0,Math.floor(Number(t)||0)),i=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):1/0,l=R[e.costType]?.value,a=l instanceof c?l:c.fromAny(l??0);if(a.isZero?.())return c.fromInt(0);if(a.isInfinite?.()){let d=e?.upgType==="HM",m=Number.isFinite(i)&&r>=i;return d&&!m||!Number.isFinite(i)?c.fromAny("Infinity"):qv(e,o,t)}if(Number.isFinite(i)&&r>=i)return c.fromInt(0);try{if(typeof e.costAtLevel=="function"){let d=c.fromAny(e.costAtLevel(r)),m=c.fromAny(e.costAtLevel(r+1)),v=Math.min(Number.isFinite(i)?i:r+32,r+32),p=c.fromAny(e.costAtLevel(v));if(d.cmp(m)===0&&d.cmp(p)===0){let g=qv(e,o,r),y=Number.isFinite(e.lvlCap)?Math.min(Math.max(0,Math.floor(Number(g.toString()))),Number.MAX_SAFE_INTEGER-2):Number.MAX_SAFE_INTEGER,I=0,E=Math.max(0,y);for(;I<E;){let M=Math.floor((I+E+1)/2),A=c.fromInt(M);(typeof d.mulBigNumInteger=="function"?d.mulBigNumInteger(A):c.fromAny(d??0).mulBigNumInteger(A)).cmp(a)<=0?I=M:E=M-1}return c.fromInt(I)}}}catch{}let u=Number.isFinite(i)?Math.max(0,i-r):void 0,{count:f}=Mi(e,o,a,u,{fastOnly:!0});return f??c.fromInt(0)}function Ns(e="standard"){(_l[e]||_l.standard).open()}function Wv(e=!1){Object.values(_l).forEach(t=>t.close(e))}function Pv(){if(Object.entries(_l).forEach(([e,t])=>{e!=="standard"&&t.close()}),Cl&&zv!=="standard"){$p();let e=document.querySelector(".hm-milestones-overlay");e&&e.remove()}}function lr(e=!1){Object.values(_l).forEach(t=>t.update(e))}function px(){if(ln)return;ln=document.createElement("div"),ln.className="upg-overlay",ft=document.createElement("div"),ft.className="upg-sheet",ft.setAttribute("role","dialog"),ft.setAttribute("aria-modal","false"),ft.setAttribute("aria-label","Upgrade");let e=document.createElement("div");e.className="upg-grabber",e.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let t=document.createElement("header");t.className="upg-header";let n=document.createElement("div");n.className="upg-content";let o=document.createElement("div");o.className="upg-milestones";let r=document.createElement("div");r.className="upg-actions",ft.append(e,t,n,o,r),ln.appendChild(ft),document.body.appendChild(ln),ln.addEventListener("pointerdown",u=>{Je&&u.pointerType!=="mouse"&&u.target===ln&&(u.preventDefault(),u.stopPropagation())},!0),ln.addEventListener("click",u=>{Je&&u.target===ln&&(u.preventDefault(),u.stopImmediatePropagation())},!0);let i=null;function s(u){if(!Cl)return;let f=typeof u.clientY=="number"?u.clientY:u.touches?.[0]?.clientY||0;i={startY:f,lastY:f,moved:0},ft.style.transition="none",window.addEventListener("pointermove",l),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}function l(u){if(!i)return;let f=u.clientY;if(typeof f!="number")return;let d=Math.max(0,f-i.startY);i.lastY=f,i.moved=d,ft.style.transform=`translateY(${d}px)`}function a(u){if(!i)return;let f=i.moved>140;if(ft.style.transition="transform 160ms ease",ft.style.transform=f?"translateY(100%)":"translateY(0)",f){if(Je&&(!u||u.pointerType!=="mouse"))try{Bn(120)}catch{}setTimeout($p,160)}i=null,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)}e.addEventListener("pointerdown",s,{passive:!0})}function $p(){if(Je)try{Bn(160)}catch{}if(typeof Eu=="function"){let e=Eu;Eu=null;try{e()}catch{}}Cl=!1,!(!ln||!ft)&&(ft.style.transition="",ft.style.transform="",ln.classList.remove("is-open"),ln.style.pointerEvents="none")}function mx(e){let t=document.querySelector(".hm-milestones-overlay");t&&t.remove();let n=document.createElement("div");n.className="hm-milestones-overlay",n.setAttribute("role","dialog");let o=document.createElement("div");o.className="hm-milestones-dialog";let r=document.createElement("h3");r.className="hm-milestones-title",r.textContent="Milestones";let i=document.createElement("ul");i.className="hm-milestones-list";for(let u of e){let f=document.createElement("li"),d=document.createElement("span");d.className="hm-milestone-text",u&&typeof u=="object"?(d.textContent=u.text??"",u.achieved&&f.classList.add("hm-milestone-achieved")):d.textContent=u,f.appendChild(d),i.appendChild(f)}let s=document.createElement("button");s.type="button",s.className="hm-milestones-close",s.textContent="Close";let l=()=>{n.remove(),document.removeEventListener("keydown",a)},a=u=>{u.key==="Escape"&&(u.preventDefault(),l())};n.addEventListener("click",u=>{u.target===n&&l()}),s.addEventListener("click",l),document.addEventListener("keydown",a),o.append(r,i,s),n.appendChild(o),document.body.appendChild(n),typeof s.focus=="function"&&s.focus({preventScroll:!0})}function hx(e,t="standard"){px(),Cl=!0,zv=t;let n=!0,o=Hv(t),r=o.getLockState(e.id)||{},i=!!r.locked,s=i&&(r.hidden||r.hideEffect||r.hideCost||typeof r.iconOverride=="string"&&r.iconOverride.includes("mysterious"));if(i&&!s){Cl=!1;return}let l=e.upgType==="HM",a=e.tie===_e.ENDLESS_XP;function u(p,h,g="div"){let y=h.split(" ").filter(M=>M.length>0),I=null,E=[];for(let M=0;M<p.children.length;M++){let A=p.children[M];g&&A.tagName.toLowerCase()!==g.toLowerCase()||y.every(G=>A.classList.contains(G))&&(I?E.push(A):I=A)}return E.forEach(M=>M.remove()),I||(I=document.createElement(g),I.className=h,p.appendChild(I)),I}let f=p=>{let h=document.createElement("div");return h.className="upg-line",h.innerHTML=p,h},d=!0,m=()=>{let p=o.getUiModel(e.id);if(!p)return;let h=p.lockState||o.getLockState(e.id),g=!!h?.locked,y=g&&(h?.hidden||h?.hideEffect||h?.hideCost),I=!!p.unlockUpgrade&&!y;ft.classList.toggle("is-locked-hidden",y);let E=ft.querySelector(".upg-header"),M=u(E,"upg-title");M.textContent!==(p.displayTitle||p.upg.title)&&(M.textContent=p.displayTitle||p.upg.title);let A=!!p.hmReadyToEvolve,G=A?!1:p.lvlBn?.isInfinite?.()?!0:Number.isFinite(p.upg.lvlCap)?p.lvl>=p.upg.lvlCap:!1,P=u(E,"upg-level"),$=p.lvlCapFmtHtml??p.upg.lvlCapFmtHtml??K(p.lvlCapBn),L=p.lvlCapFmtText??p.upg.lvlCapFmtText??xu($),F=A?`Level ${p.lvlFmtHtml} / ${$} (EVOLVE READY)`:G?`Level ${p.lvlFmtHtml} / ${$} (MAXED)`:`Level ${p.lvlFmtHtml} / ${$}`,T=xu(F);P.innerHTML!==F&&(P.innerHTML=F),P.getAttribute("aria-label")!==T&&P.setAttribute("aria-label",T),P.hidden=y,y||P.removeAttribute("aria-hidden"),ft.classList.toggle("is-maxed",G),ft.classList.toggle("hm-evolve-ready",A),ft.classList.toggle("is-unlock-upgrade",I),ft.classList.toggle("is-hm-upgrade",l&&!y),ft.classList.toggle("is-endless-xp",a),ft.classList.toggle("is-magnet-upgrade",e.tie===_e.MAGNET),ft.classList.toggle("is-no-effect",!p.effect);let C=E.querySelector(".auto-toggle-wrapper"),Y=t==="automation"?ms[e.id]:null,Q=t==="automation"&&e.id===po,ae=!!Y,he=t==="standard"||t==="dna"?sx[e.costType]:null,be=0;he?be=At(Ze,he):(ae||Q)&&(be=At(Ze,e.id));let ke=be>0&&(ae||he||Q)&&!y;C||(C=document.createElement("div"),C.className="auto-toggle-wrapper hm-view-milestones-row",E.appendChild(C));let U=C.querySelector("button");if(U||(U=document.createElement("button"),U.type="button",U.style.padding="10px 14px",U.style.fontSize="16px",U.style.width="auto",U.style.minWidth="180px",U.addEventListener("click",ne=>{typeof U._onClick=="function"&&U._onClick(ne)}),C.appendChild(U)),ke){U.style.visibility="",U.style.pointerEvents="auto";let ne=b(),ve=ne!=null?`:${ne}`:"",Ue=!0;if(ae){let Ae=`ccc:autobuy:master:${Y}${ve}`,Fe=[...Mt(Se.STARTER_COVE),...Mt(Ht)],ce=!1;for(let te of Fe)if(te.costType===Y){let xe=`ccc:autobuy:${te.area}:${te.id}${ve}`;if(yi(te.area,te.id)!=="0"){ce=!0;break}}Ue=ce}else Ue=yi(e.area,e.id)!=="0";Ue?(U.className="shop-delve",U.textContent="Automation: ON",U.style.backgroundColor=""):(U.className="shop-close",U.textContent="Automation: OFF",U.style.backgroundColor=""),U._onClick=Ae=>{Ae.preventDefault(),Ae.stopPropagation(),Je&&Bn(50);let ce=!Ue?"1":"0";ae?(localStorage.setItem(`ccc:autobuy:master:${Y}${ve}`,ce),[...Mt(Se.STARTER_COVE),...Mt(Ht)].forEach(xe=>{xe.costType===Y&&Mr(xe.area,xe.id,ce)})):Mr(e.area,e.id,ce),m()}}else U.style.visibility="hidden",U.style.pointerEvents="none",U.className="shop-delve",U.textContent="Automation: ON",U._onClick=null;let W=ft.querySelector(".upg-content");d&&(W.scrollTop=0,d=!1);let q=u(W,"upg-desc centered");q.classList.toggle("lock-desc",y);let X=(p.displayDesc||p.upg.desc||"").trim();A?(q.classList.add("hm-evolve-note"),q.textContent!=="Evolve this upgrade to multiply its effect by 1000x"&&(q.textContent="Evolve this upgrade to multiply its effect by 1000x")):X?(q.classList.remove("hm-evolve-note"),q.textContent!==X&&(q.textContent=X),q.hidden=!1):q.hidden=!0;let J=u(W,"upg-info"),le=null,fe=ne=>{le?le.nextElementSibling!==ne&&J.insertBefore(ne,le.nextSibling):J.firstElementChild!==ne&&J.prepend(ne),le=ne};if(g&&h?.reason&&!y){let ne=(p.displayDesc||"").trim(),ve=String(h.reason??"").trim();if(ne!==ve){let Ue=J.querySelector(".lock-wrapper");if(!Ue){Ue=document.createElement("div"),Ue.className="lock-wrapper";let ce=document.createElement("div");ce.className="upg-line lock-note",Ue.append(ce)}let Ae=Array.from(Ue.children);for(let ce of Ae)ce.tagName==="DIV"&&!ce.className&&ce.style.height==="12px"&&ce.remove();let Fe=Ue.querySelector(".lock-note");Fe.textContent!==h.reason&&(Fe.textContent=h.reason),fe(Ue)}else{let Ue=J.querySelector(".lock-wrapper");Ue&&Ue.remove()}}else{let ne=J.querySelector(".lock-wrapper");ne&&ne.remove()}if(p.effect&&!(g&&h?.hideEffect)){let ne=J.querySelector(".effect-wrapper");if(!ne){ne=document.createElement("div"),ne.className="effect-wrapper";let Fe=document.createElement("div");Fe.className="upg-line",ne.append(Fe)}let ve=Array.from(ne.children);for(let Fe of ve)Fe.tagName==="DIV"&&!Fe.className&&Fe.style.height==="12px"&&Fe.remove();let Ue=ne.querySelector(".upg-line"),Ae=`<span class="bonus-line">${p.effect}</span>`;Ue.innerHTML!==Ae&&(Ue.innerHTML=Ae),fe(ne)}else{let ne=J.querySelector(".effect-wrapper");ne&&ne.remove()}let _=cx(p.upg.costType),H=p.nextPrice instanceof c?p.nextPrice:c.fromAny(p.nextPrice||0),z=G||A;if(!p.unlockUpgrade&&!z&&(!g||!h?.hideCost)){let ne=u(J,"upg-costs");fe(ne);let ve=Iu(p.upg.costType,H),Ue=`Cost: ${_} ${R[p.upg.costType].fmt(H)} ${ve}`,Ae=u(ne,"cost-line","div");if(Ae.className.includes("upg-line")||(Ae.className="upg-line cost-line"),Ae.innerHTML!==Ue&&(Ae.innerHTML=Ue),l){let xe=u(ne,"milestone-line","div");xe.className.includes("upg-line")||(xe.className="upg-line milestone-line");let x="\u2014",j="",Z=Gv(p.upg);try{if(p.hmNextMilestone&&p.hmNextMilestone.cmp(p.lvlBn)>0)if(Z){let ue=p.hmNextMilestone.sub(c.fromInt(1)),We=0;try{let Ie=ue.toPlainIntegerString?.();Ie&&Ie!=="Infinity"?We=Number(Ie):We=Number(ue.toString())}catch{We=0}let ot=c.fromInt(0);try{ot=c.fromAny(p.upg.costAtLevel(We))}catch{}x=R[p.upg.costType].fmt(ot),j=Iu(p.upg.costType,ot)}else{let ue=p.hmNextMilestone.sub(p.lvlBn),We=ue.toPlainIntegerString?.(),ot=Math.max(0,Math.floor(Number(We&&We!=="Infinity"?We:Number(ue.toString()||0)))),{spent:Ie}=Mi(p.upg,p.lvlBn,c.fromAny("Infinity"),ot);x=R[p.upg.costType].fmt(Ie),j=Iu(p.upg.costType,Ie)}}catch{}let ye=`${Z?"Cost at next milestone:":"Cost to next milestone:"} ${_} ${x} ${j}`;xe.innerHTML!==ye&&(xe.innerHTML=ye)}else{let xe=ne.querySelector(".milestone-line");xe&&xe.remove()}let Fe=Iu(p.upg.costType,p.have),ce=`You have: ${_} ${R[p.upg.costType].fmt(p.have)} ${Fe}`,te=u(ne,"have-line","div");te.className.includes("upg-line")||(te.className="upg-line have-line"),te.innerHTML!==ce&&(te.innerHTML=ce)}else{let ne=J.querySelector(".upg-costs");ne&&ne.remove()}let de=ft.querySelector(".upg-milestones"),ee=de.querySelector(".hm-view-milestones-row");if(!ee){ee=document.createElement("div"),ee.className="hm-view-milestones-row";let ne=document.createElement("button");ne.type="button",ne.className="shop-delve hm-view-milestones",ne.textContent="View Milestones",ne.addEventListener("click",ve=>{ne._onClick&&ne._onClick(ve)}),ee.appendChild(ne),de.appendChild(ee)}let re=ee.querySelector("button");l&&!y?(re.style.visibility="",re.style.pointerEvents="auto",re._onClick=()=>{let ne=Array.isArray(p.hmMilestones)?p.hmMilestones:[],ve=Math.max(0,Math.floor(Number(p.hmEvolutions??0))),Ue=(()=>{try{return BigInt(Xt)*BigInt(ve)}catch{return 0n}})(),Ae=ne.sort((Fe,ce)=>Number(Fe?.level||0)-Number(ce?.level||0)).map(Fe=>{let ce=Math.max(0,Math.floor(Number(Fe?.level||0))),te=(()=>{if(p.lvlBn?.isInfinite?.())return c.fromAny("Infinity");try{return c.fromAny((BigInt(ce)+Ue).toString())}catch{return c.fromAny(ce+Xt*ve)}})(),xe=te?.isInfinite?.()?"Infinity":K(te),x=Te(Fe?.multiplier??Fe?.mult??Fe?.value??1),j=`${Fe?.target??Fe?.type??"self"}`.toLowerCase(),Z=(()=>{if(p.lvlBn?.isInfinite?.())return!0;try{return p.lvlBn?.cmp?.(te)>=0}catch{}return!1})(),oe=`Level ${xe}: Multiplies this upgrade\u2019s effect by ${x}x`;return j==="xp"&&(oe=`Level ${xe}: Multiplies XP value by ${x}x`),(j==="coin"||j==="coins")&&(oe=`Level ${xe}: Multiplies Coin value by ${x}x`),j==="mp"&&(oe=`Level ${xe}: Multiplies MP value by ${x}x`),{text:oe,achieved:Z}});mx(Ae)}):(re.style.visibility="hidden",re.style.pointerEvents="none",re._onClick=null);let ge=ft.querySelector(".upg-actions"),Be=ge.querySelector(".shop-close");if(Be||(Be=document.createElement("button"),Be.type="button",Be.className="shop-close",Be.textContent="Close",Be.addEventListener("click",()=>{n=!1,$p()}),ge.appendChild(Be)),g||G)ge.querySelectorAll("button:not(.shop-close)").forEach(ne=>ne.remove()),document.activeElement&&document.activeElement!==Be&&!ge.contains(document.activeElement)&&!document.activeElement.closest(".debug-panel")&&Be.focus();else{let ne=p.have.cmp(H)>=0,ve=(ce,te,xe,x,j=!1)=>{let Z=ge.querySelector(`.${ce.split(" ").join(".")}`);if(!Z){Z=document.createElement("button"),Z.type="button",Z.className=ce,Z.textContent=te;let oe=()=>{typeof Z._onClick=="function"&&Z._onClick()};"PointerEvent"in window?Z.addEventListener("pointerdown",ue=>{ue.pointerType==="mouse"||typeof ue.button=="number"&&ue.button!==0||(oe(),ue.preventDefault())},{passive:!1}):Z.addEventListener("touchstart",ue=>{oe(),ue.preventDefault()},{passive:!1}),Z.addEventListener("click",()=>{Je||oe()});let ye=ge.children;x>=ye.length?ge.appendChild(Z):ge.insertBefore(Z,ye[x])}return Z._onClick=xe,Z.textContent!==te&&(Z.textContent=te),Z.disabled!==j&&(Z.disabled=j),Z};if(A){ge.querySelectorAll("button:not(.shop-close):not(.hm-evolve-btn)").forEach(ce=>ce.remove()),ve("shop-delve hm-evolve-btn","Evolve",()=>{let{evolved:ce}=o.evolve(e.id);ce&&(Yv(),lr(),m())},1,!1);return}if(p.unlockUpgrade){ge.querySelectorAll("button:not(.shop-close):not(.btn-unlock)").forEach(ce=>ce.remove()),ve("shop-delve btn-unlock","Unlock",()=>{let{bought:ce}=o.buyOne(e.id);if(!(ce instanceof c?ce:c.fromAny(ce??0)).isZero?.()){if(sn(),wu(e,t))try{Il(["reset"])}catch{}lr(),m()}},1,!ne);return}if(ge.querySelectorAll(".hm-evolve-btn, .btn-unlock").forEach(ce=>ce.remove()),ve("shop-delve btn-buy-one","Buy",()=>{let ce=o.getUiModel(e.id);if(ce.have.cmp(ce.nextPrice instanceof c?ce.nextPrice:c.fromAny(ce.nextPrice||0))<0)return;let{bought:te}=o.buyOne(e.id);(te instanceof c?te:c.fromAny(te??0)).isZero?.()||(sn(),lr(),m())},1,!ne),(Number.isFinite(p.upg.lvlCap)?p.upg.lvlCap:1/0)===1){let ce=ge.querySelector(".btn-buy-max");ce&&ce.remove();let te=ge.querySelector(".btn-buy-cheap");te&&te.remove()}else{ve("shop-delve btn-buy-max","Buy Max",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let{bought:x}=o.buyMax(e.id);(x instanceof c?x:c.fromAny(x??0)).isZero?.()||(sn(),lr(),m())},2,!ne);let te=[1,3,4,5,6].includes(Dp(p.upg));if(!l&&!te)ve("shop-delve btn-buy-cheap","Buy Cheap",()=>{if(o.getUiModel(e.id).have.cmp(c.fromInt(1))<0)return;let j=o.buyCheap;if(!j)return;let{bought:Z}=j(e.id);(Z instanceof c?Z:c.fromAny(Z??0)).isZero?.()||(sn(),lr(),m())},3,!ne);else{let xe=ge.querySelector(".btn-buy-cheap");xe&&xe.remove()}}if(l)ve("shop-delve btn-buy-next","Buy Next",()=>{let te=o.getUiModel(e.id);if(te.hmReadyToEvolve)return;let xe=te.hmNextMilestone;if(!xe||!te.lvlBn||xe.cmp(te.lvlBn)<=0){let{bought:Ie}=o.buyMax(e.id);if((Ie instanceof c?Ie:c.fromAny(Ie??0)).isZero?.())return;sn(),lr(),m();return}let x=0;try{let Ie=xe.sub(te.lvlBn).toPlainIntegerString?.();x=Math.max(0,Math.floor(Number(Ie&&Ie!=="Infinity"?Ie:xe.sub(te.lvlBn).toString())))}catch{}let j=R[te.upg.costType]?.value,Z=j instanceof c?j:c.fromAny(j??0),ye=Mi(te.upg,te.lvlBn,Z,x).count,ue=!1;try{let Ie=ye?.toPlainIntegerString?.();ue=Ie&&Ie!=="Infinity"?Number(Ie)>=x:Number(ye??0)>=x}catch{}let We=ue?o.buyNext(e.id,x):o.buyMax(e.id);(We.bought instanceof c?We.bought:c.fromAny(We.bought??0)).isZero?.()||(sn(),lr(),m())},3,p.have.cmp(c.fromInt(1))<0);else{let ce=ge.querySelector(".btn-buy-next");ce&&ce.remove()}}},v=()=>{n&&m()};o.events.forEach(p=>window.addEventListener(p,v)),t==="standard"&&document.addEventListener("ccc:upgrades:changed",v),m(),ln.classList.add("is-open"),ln.classList.toggle("is-automation-upgrade",t==="automation"),ln.style.pointerEvents="auto",Bn(140),ft.style.transition="none",ft.style.transform="translateY(100%)",ft.offsetHeight,requestAnimationFrame(()=>{ft.style.transition="",ft.style.transform=""}),Eu=()=>{n=!1,o.events.forEach(p=>window.removeEventListener(p,v)),t==="standard"&&document.removeEventListener("ccc:upgrades:changed",v)}}function Gd(e,t,n,o){let r=null;function i(f){if(!n())return;let d=typeof f.clientY=="number"?f.clientY:f.touches?.[0]?.clientY||0;r={startY:d,lastY:d,startT:performance.now(),moved:0,canceled:!1},t.style.transition="none",window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l)}function s(f){if(!r||r.canceled)return;let d=f.clientY;if(typeof d!="number")return;let m=Math.max(0,d-r.startY);r.lastY=d,r.moved=m,t.style.transform=`translateY(${m}px)`}function l(){if(!r||r.canceled)return u();let f=Math.max(1,performance.now()-r.startT),d=r.moved;d/f>.55&&d>40||d>140?(ko(100),Bn(80),t.style.transition="transform 140ms ease-out",t.style.transform="translateY(100%)",o()):(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)"),u()}function a(){r&&(r.canceled=!0,t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",u())}function u(){window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),r=null}e.addEventListener("pointerdown",i),e.addEventListener("touchstart",f=>f.preventDefault(),{passive:!1})}var wl,Fv,tx,nx,ox,Uv,rx,ix,sx,Dv,ax,lx,Xv,Vv,ux,$v,El,_l,ln,ft,Cl,Eu,zv,gi=De(()=>{vt();xt();qt();vo();qs();Ec();Cn();ho();fs();li();ws();Fp();wl=new Set;Fv={coins:"img/currencies/coin/coin_base.webp",books:"img/currencies/book/book_base.webp",gold:"img/currencies/gold/gold_base.webp",magic:"img/currencies/magic/magic_base.webp",gears:"img/currencies/gear/gear_base.webp",dna:"img/currencies/dna/dna_base.webp"},tx="img/misc/locked_base.webp",nx="img/misc/maxed.webp",ox="img/misc/green_border.webp",Uv={coins:"img/currencies/coin/coin.webp",books:"img/currencies/book/book.webp",gold:"img/currencies/gold/gold.webp",magic:"img/currencies/magic/magic.webp",gears:"img/currencies/gear/gear.webp",dna:"img/currencies/dna/dna.webp"},rx=7,ix={coins:Ya,books:Wa,gold:za,magic:Ka,dna:ja};sx={coins:Ya,books:Wa,gold:za,magic:Ka,dna:ja};Dv={standard:{title:"Shop",delveButtonVisible:!0,getUiData:()=>Up(eo()),getUiModel:e=>Vs(eo(),e),buyOne:e=>Hs(eo(),e),buyMax:e=>xl(eo(),e),buyCheap:e=>Ll(eo(),e),buyNext:(e,t)=>Xs(eo(),e,t),getLockState:e=>Ro(eo(),e),evolve:e=>Lu(eo(),e),events:["ccc:upgrades:changed","currency:change","xp:change","xp:unlock",kp,"forge:completed","unlock:change"]},automation:{title:"Automation Shop",delveButtonVisible:!1,getUiData:()=>Up(Ze),getUiModel:e=>Vs(Ze,e),buyOne:e=>Hs(Ze,e),buyMax:e=>xl(Ze,e),buyCheap:e=>Ll(Ze,e),buyNext:(e,t)=>Xs(Ze,e,t),getLockState:e=>Ro(Ze,e),evolve:()=>({evolved:!1}),events:["ccc:upgrades:changed","currency:change"]},dna:{title:"DNA Upgrades",delveButtonVisible:!1,getUiData:()=>Up(Ht),getUiModel:e=>Vs(Ht,e),buyOne:e=>Hs(Ht,e),buyMax:e=>xl(Ht,e),buyCheap:e=>Ll(Ht,e),buyNext:(e,t)=>Xs(Ht,e,t),getLockState:e=>Ro(Ht,e),evolve:e=>Lu(Ht,e),events:["ccc:upgrades:changed","currency:change"]}};typeof window<"u"&&window.addEventListener("debug:change",e=>{let t=typeof b=="function"?b():null,n=e?.detail?.slot??t;t!=null&&n!=null&&t!==n||lr(!0)});ax="sounds/purchase_upg.ogg",lx="sounds/evolve_upg.ogg",Xv=.12,Vv=.3;ux="data:image/webp;base64,UklGRhIAAABXRUJQVlA4IBgAAAAwAQCdASoIAAIAAAAcJaQAA3AA",$v="ccc-scroll-timeline-styles";El=class{constructor(t){this.mode=t,this.overlayEl=null,this.sheetEl=null,this.isOpen=!1,this.eventsBound=!1,this.closeTimer=null,this.postOpenPointer=!1,this.upgrades={},this.delveBtnEl=null,this.updateHandler=this.update.bind(this)}get adapter(){return Hv(this.mode)}get delveButtonVisible(){return this.adapter.delveButtonVisible}updateDelveGlow(){if(!this.delveBtnEl||this.mode!=="standard")return;let n=!wv(),o=b();o!=null&&localStorage.getItem(`ccc:tsunami:labPending:${o}`)==="1"&&(n=!0),this.delveBtnEl.classList.toggle("is-new",n)}buildUpgradesData(){this.upgrades=this.adapter.getUiData()}render(){let t=this.overlayEl?.querySelector(".shop-grid");if(!t)return;let n=new Set;for(let o in this.upgrades){let r=this.upgrades[o];n.add(String(r.id));let i=t.querySelector(`.shop-upgrade[data-upg-id="${r.id}"]`);if(!i){i=document.createElement("button"),i.className="shop-upgrade",i.setAttribute("data-upgid",r.id),i.type="button",i.setAttribute("role","gridcell"),i.dataset.upgId=String(r.id);let H=document.createElement("div");H.className="shop-tile";let z=document.createElement("img");z.className="base",z.alt="";let de=document.createElement("img");de.className="icon",de.alt="",de.addEventListener("error",()=>{de.src=ux}),H.appendChild(z),H.appendChild(de),i.appendChild(H),t.appendChild(i),i.addEventListener("click",ee=>{let re=ee.currentTarget;if(re.disabled||re.dataset.lockedPlain==="1"){ee.preventDefault(),ee.stopImmediatePropagation();return}if(fo(re)){ee.preventDefault(),ee.stopImmediatePropagation();return}if(ee.shiftKey||ee.ctrlKey){if(ee.preventDefault(),ee.stopImmediatePropagation(),!re.upgMeta)return;let ge=re.upgMeta.id,Be=re.upgMeta.upgType==="HM",ne=[1,3,4,5,6].includes(Dp(re.upgMeta));if(ee.shiftKey){if((Be||!ne)&&this.adapter.buyCheap){let{bought:Ae}=this.adapter.buyCheap(ge);(Ae instanceof c?Ae:c.fromAny(Ae??0)).isZero?.()||(sn(),this.update());return}let{bought:ve}=this.adapter.buyMax(ge);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(sn(),wu(re.upgMeta,this.mode))try{Il(["reset"])}catch{}this.update()}return}if(ee.ctrlKey){if(Be){let Ae=this.adapter.getUiModel(ge);if(Ae&&!Ae.hmReadyToEvolve){let Fe=Ae.hmNextMilestone;if(Fe&&Ae.lvlBn&&Fe.cmp(Ae.lvlBn)>0){let ce=0;try{let oe=Fe.sub(Ae.lvlBn).toPlainIntegerString?.();ce=Math.max(0,Math.floor(Number(oe&&oe!=="Infinity"?oe:Fe.sub(Ae.lvlBn).toString())))}catch{}let te=R[Ae.upg.costType]?.value,xe=te instanceof c?te:c.fromAny(te??0),j=Mi(Ae.upg,Ae.lvlBn,xe,ce).count,Z=!1;try{let oe=j?.toPlainIntegerString?.();Z=oe&&oe!=="Infinity"?Number(oe)>=ce:Number(j??0)>=ce}catch{}if(Z){let oe=this.adapter.buyNext(ge,ce);(oe.bought instanceof c?oe.bought:c.fromAny(oe.bought??0)).isZero?.()||(sn(),this.update());return}}}}let{bought:ve}=this.adapter.buyMax(ge);if(!(ve instanceof c?ve:c.fromAny(ve??0)).isZero?.()){if(sn(),wu(re.upgMeta,this.mode))try{Il(["reset"])}catch{}this.update()}return}}re.upgMeta&&hx(re.upgMeta,this.mode)}),i.addEventListener("contextmenu",ee=>{if(Je)return;let re=ee.currentTarget;if(re.dataset.locked==="1"||(ee.preventDefault(),ee.stopPropagation(),!re.upgMeta))return;if(this.adapter.getUiModel(re.upgMeta.id)?.hmReadyToEvolve){let{evolved:ve}=this.adapter.evolve(re.upgMeta.id);ve&&(Yv(),this.update());return}let{bought:Be}=this.adapter.buyMax(re.upgMeta.id);if(!(Be instanceof c?Be:c.fromAny(Be??0)).isZero?.()){if(sn(),wu(re.upgMeta,this.mode))try{Il(["reset"])}catch{}this.update()}})}i.upgMeta=r.meta;let s=!!r.locked,l=r.lockState?.iconOverride,a=typeof l=="string"&&l.includes("mysterious"),u=s&&(r.lockState?.hidden||a),f=s&&!u;i.classList.toggle("is-locked",s),i.classList.toggle("is-locked-plain",f),i.disabled=f,f?(i.setAttribute("aria-disabled","true"),i.setAttribute("tabindex","-1")):(i.removeAttribute("aria-disabled"),i.removeAttribute("tabindex")),i.dataset.locked=s?"1":"0",i.dataset.lockedPlain=f?"1":"0",i.dataset.mysterious=u?"1":"0";let m=r.meta?.upgType==="HM"&&r.hmReady;i.classList.toggle("hm-evolve-ready",m);let v=s?c.fromInt(0):dx(r.meta,r.levelNumeric,r.level),p=v instanceof c?v:c.fromAny(v),h=K(r.level),g=xu(h),y=K(p),I=xu(y),E=!p.isZero?.(),M=Number.isFinite(r.lvlCap)?r.lvlCap:Number.isFinite(r.meta?.lvlCap)?r.meta.lvlCap:1/0,A=Number.isFinite(M)?Math.max(0,Math.floor(M)):1/0,G=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,P=m?!1:r.level?.isInfinite?.()?!0:Number.isFinite(A)&&Number.isFinite(G)?G>=A:!1,$=Number.isFinite(A)&&A===1,L=!!r.meta?.unlockUpgrade,F=!s&&L&&!P,T=!s&&L&&!F&&P,C,Y,Q=!1,ae=!1;if(s){C="",Y="";let H=u?(r.lockState?.reason||"").trim():"",z=H?`${r.title} (Locked, ${H})`:`${r.title} (Locked)`;i.setAttribute("aria-label",z)}else{if(F||T)C=F?"Unlockable":"Unlocked",Y=C,ae=!0;else if(!s&&$&&!L)P?(C="Owned",Y="Owned"):E?(C="Purchasable",Y="Purchasable"):(C="Not Owned",Y="Not Owned"),ae=!0;else{let H=Number.isFinite(r.levelNumeric)?r.levelNumeric:NaN,z=String(g||"").replace(/,/g,""),de=/|Infinity/i.test(z),ee=Number.isFinite(H)?H>=1e3:de||/^\d{4,}$/.test(z);Q=E&&ee,Q?(C=`<span class="badge-lvl">${h}</span><span class="badge-plus">(+${y})</span>`,Y=`${g} (+${I})`):(C=E?`${h} (+${y})`:h,Y=E?`${g} (+${I})`:g)}i.setAttribute("aria-label",`${r.title}, ${Y}`)}s?i.title=u?"Hidden Upgrade":"Locked Upgrade":r.meta?.unlockUpgrade?i.title="Left-click: Details \u2022 Right-click: Unlock":i.title="Left-click: Details \u2022 Right-click: Buy Max";let he=i.firstElementChild,be=he.querySelector(".base"),Oe=he.querySelector(".icon"),ke=r.meta?.costType||"coins",W=r.useLockedBase||s?tx:r.baseIconOverride||Fv[ke]||Fv.coins;be.src!==W&&(be.src=W);let q=r.icon;if(!q)Oe.hidden||(Oe.hidden=!0);else{Oe.hidden&&(Oe.hidden=!1);let H=q;Oe._lastSrc!==H&&(Oe.src=H,Oe._lastSrc=H)}let X=he.querySelector(".maxed-overlay"),J=!s&&Gv(r.meta),le=!s&&P;if(le||!s&&!P&&!m&&J){X||(X=document.createElement("img"),X.className="maxed-overlay",X.alt="",he.insertBefore(X,Oe));let H=le?nx:ox;X.src!==H&&(X.src=H)}else X&&X.remove();let _=he.querySelector(".level-badge");s?_&&_.remove():(_||(_=document.createElement("span"),_.className="level-badge",he.appendChild(_)),_.className="level-badge",ae&&_.classList.add("text-badge"),Q&&_.classList.add("two-line"),(E||F)&&_.classList.add("can-buy"),P&&_.classList.add("is-maxed"),C===Y?_.textContent!==C&&(_.textContent=C):_.innerHTML!==C&&(_.innerHTML=C))}Array.from(t.children).forEach(o=>{o.dataset.upgId&&!n.has(o.dataset.upgId)&&o.remove()})}ensureOverlay(){if(this.overlayEl)return;this.overlayEl=document.createElement("div"),this.overlayEl.className="shop-overlay",this.mode==="automation"?(this.overlayEl.classList.add("automation-shop-overlay"),this.overlayEl.id="automation-shop-overlay"):this.mode==="dna"?(this.overlayEl.classList.add("dna-shop-overlay"),this.overlayEl.id="dna-shop-overlay"):this.overlayEl.id="shop-overlay",this.sheetEl=document.createElement("div"),this.sheetEl.className="shop-sheet",this.sheetEl.setAttribute("role","dialog");let t=document.createElement("div");t.className="shop-grabber",t.innerHTML='<div class="grab-handle" aria-hidden="true"></div>';let n=document.createElement("div");n.className="shop-content";let o=document.createElement("header");o.className="shop-header",o.innerHTML=`<div class="shop-title">${this.adapter.title}</div><div class="shop-line" aria-hidden="true"></div>`;let r=document.createElement("div");r.className="shop-grid",this.mode==="standard"&&(r.id="shop-grid"),r.setAttribute("role","grid");let i=document.createElement("div");i.className="shop-scroller",i.appendChild(r),n.append(o,i),Os(this.overlayEl,this.sheetEl,".shop-scroller");let s=document.createElement("div");s.className="shop-actions";let l=document.createElement("button");if(l.type="button",l.className="shop-close",l.textContent="Close",s.appendChild(l),this.delveButtonVisible){let a=document.createElement("button");a.type="button",a.className="shop-delve",a.textContent="Delve",a.addEventListener("click",u=>{u&&u.isTrusted&&fo(a)||(Dr(),Mv())}),this.delveBtnEl=a,this.updateDelveGlow(),s.append(a)}this.sheetEl.append(t,n,s),this.overlayEl.appendChild(this.sheetEl),document.body.appendChild(this.overlayEl),this.overlayEl.addEventListener("pointerdown",a=>{a.pointerType!=="mouse"&&(this.postOpenPointer=!0)},{capture:!0,passive:!0}),this.overlayEl.addEventListener("touchstart",a=>{this.postOpenPointer=!0},{capture:!0,passive:!0}),this.overlayEl.addEventListener("click",a=>{if(Je&&!this.postOpenPointer){a.preventDefault(),a.stopImmediatePropagation();return}},{capture:!0}),l.addEventListener("click",()=>{Je&&Bn(80),this.close()},{passive:!0}),Gd(t,this.sheetEl,()=>this.isOpen,()=>{this.isOpen=!1,this.closeTimer=setTimeout(()=>{this.closeTimer=null,this.close(!0)},150)}),this.update(!0)}open(){if(this.ensureOverlay(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.eventsBound||(this.adapter.events.forEach(t=>window.addEventListener(t,this.updateHandler)),this.mode==="standard"&&document.addEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!0),this.update(!0),!this.isOpen){if(this.isOpen=!0,this.mode==="standard"){let t=b();t!=null&&localStorage.getItem(`ccc:tsunami:dialoguePending:${t}`)==="1"&&Ov(()=>{try{localStorage.removeItem(`ccc:tsunami:dialoguePending:${t}`)}catch{}try{localStorage.setItem(`ccc:tsunami:labPending:${t}`,"1")}catch{}this.update(!0)})}this.sheetEl.style.transition="none",this.sheetEl.style.transform="translateY(100%)",this.overlayEl.style.pointerEvents="auto",this.sheetEl.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(this.sheetEl.style.transition="",this.sheetEl.style.transform="",this.overlayEl.classList.add("is-open"),this.postOpenPointer=!1,Je)try{setTimeout(()=>ko(240),120)}catch{}Bn(10),Os(this.overlayEl,this.sheetEl);let t=this.overlayEl.querySelector(".shop-upgrade")||this.overlayEl.querySelector(".shop-grid");t&&t.focus()})})}}close(t=!1){let n=t===!0,o=this.overlayEl?.classList?.contains("is-open");if(!n&&!this.isOpen&&!o){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null);return}this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),this.isOpen=!1,this.sheetEl&&(this.sheetEl.style.transition="",this.sheetEl.style.transform=""),this.overlayEl&&(this.overlayEl.classList.remove("is-open"),this.overlayEl.style.pointerEvents="none"),this.postOpenPointer=!1,this.eventsBound&&(this.adapter.events.forEach(r=>window.removeEventListener(r,this.updateHandler)),this.mode==="standard"&&document.removeEventListener("ccc:upgrades:changed",this.updateHandler),this.eventsBound=!1)}update(t=!1){!t&&!this.isOpen||!t&&mp()||(this.buildUpgradesData(),this.render(),this.updateDelveGlow())}};typeof window<"u"&&window.addEventListener("menu:scrollStop",()=>{lr(!0)});_l={standard:new El("standard"),automation:new El("automation"),dna:new El("dna")};ln=null,ft=null,Cl=!1,Eu=null,zv="standard"});var Zv={};It(Zv,{applyHudLayout:()=>cr,initHudButtons:()=>yx,isMapUnlocked:()=>Xp,isShopUnlocked:()=>Hp,lockMap:()=>Au,lockShop:()=>ku,unlockMap:()=>Tu,unlockShop:()=>Ti});function Gp(e){let t=b();return t==null?e:`${e}:${t}`}function Ys(e){let t=Gp(e),n=localStorage.getItem(t);return n!=null?n==="1":localStorage.getItem(e)==="1"}function Hp(){return Vp(),Ys(wo.SHOP)}function Xp(){return Vp(),Ys(wo.MAP)}function Mu(e,t){let n=t?"1":"0",o=Gp(e);localStorage.setItem(o,n),o!==e&&localStorage.getItem(e)!=null&&localStorage.setItem(e,n);try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:e,slot:b()}}))}catch{}}function Vp(){for(let e of Object.values(wo)){let t=Gp(e);localStorage.getItem(t)!=null||localStorage.setItem(t,"0")}}function Oo(e,t){let n=document.querySelector(`.hud-bottom [data-btn="${e}"]`);n&&(n.hidden=!t)}function qp(){let e=document.querySelector('.hud-bottom [data-btn="shop"]');e&&e.classList.toggle("btn-shop--modified",ts())}function gx(){let e=window.matchMedia("(pointer: coarse)").matches,t=window.innerHeight>=window.innerWidth;return e&&t}function cr(){let e=document.querySelector(".hud-bottom");if(!e)return;let t=e.querySelector('[data-btn="map"]'),n=!!(t&&!t.hidden),o=gx(),l=(o&&n?["help","stats","shop","map"]:["help","shop","stats","map"]).map(v=>e.querySelector(`.game-btn[data-btn="${v}"]`)).filter(Boolean),a=[...e.children].filter(v=>!l.includes(v)),u=[...l,...a];if(u.length&&u.some((v,p)=>e.children[p]!==v)){let v=document.createDocumentFragment();u.forEach(p=>v.appendChild(p)),e.appendChild(v)}let m=[...e.querySelectorAll(".game-btn")].filter(v=>!v.hidden);if(e.classList.remove("is-2","is-3","is-4"),m.forEach(v=>{v.style.gridColumn="",v.style.gridRow="",v.classList.remove("span-2"),v.style.order=""}),e.style.gridTemplateColumns="",e.classList.add(`is-${m.length}`),!o){let v=getComputedStyle(e),p=parseFloat(v.columnGap||v.gap||"0")||0,h=e.clientWidth,g=Math.max(180,Math.floor((h-3*p)/4));if(m.length===2){e.style.gridTemplateColumns=`1fr ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3";return}if(m.length===3){e.style.gridTemplateColumns=`1fr ${g}px ${g}px ${g}px 1fr`,m[0].style.gridColumn="2",m[1].style.gridColumn="3",m[2].style.gridColumn="4";return}}if(o&&m.length===3){let v=e.querySelector('[data-btn="help"]:not([hidden])'),p=e.querySelector('[data-btn="stats"]:not([hidden])'),h=e.querySelector('[data-btn="shop"]:not([hidden])');v&&p&&h&&(v.style.gridColumn="1",v.style.gridRow="1",p.style.gridColumn="2",p.style.gridRow="1",h.style.gridColumn="1 / -1",h.style.gridRow="2")}}function yx(){if(Vp(),Oo("help",!0),Oo("stats",!0),Oo("shop",Ys(wo.SHOP)),Oo("map",Ys(wo.MAP)),qp(),cr(),typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>vu(),{timeout:5e3}):setTimeout(()=>vu(),100),Kv||(Kv=!0,window.addEventListener("resize",cr),window.addEventListener("orientationchange",cr),window.addEventListener("saveSlot:change",()=>{Oo("shop",Ys(wo.SHOP)),Oo("map",Ys(wo.MAP)),qp(),cr()}),window.addEventListener("saveSlot:modified",e=>{let t=b(),n=e?.detail?.slot;n!=null&&t!=null&&n!==t||qp()})),!jv){jv=!0;let e=document.querySelector(".hud-bottom");if(e){let t=o=>{if(!o)return;o.getAttribute("data-btn")==="shop"&&Ns()},n=o=>{let r=o.target.closest(".game-btn");!r||r.getAttribute("data-btn")!=="shop"||o.isTrusted&&fo(r)||t(r)};e.addEventListener("click",n,{passive:!0})}}}function Ti(){Mu(wo.SHOP,!0),Oo("shop",!0),cr()}function Tu(){Mu(wo.MAP,!0),Oo("map",!0),cr()}function ku(){Mu(wo.SHOP,!1),Oo("shop",!1),cr()}function Au(){Mu(wo.MAP,!1),Oo("map",!1),cr()}var wo,Kv,jv,Nu=De(()=>{gi();qs();vt();fs();wo={SHOP:"ccc:unlock:shop",MAP:"ccc:unlock:map"};Kv=!1,jv=!1});function Jv(e){if(!e||typeof window>"u")return{destroy(){}};e.querySelector(".cursor-trail-canvas")&&e.querySelectorAll(".cursor-trail-canvas").forEach(H=>H.remove());let t=1e4,n=500,o=4,r=2e3,s=16/2,l=8,a=32,u=a/2,f=4,d=new Float32Array(t*f);for(let _=0;_<t;_++)d[_*f+2]=1/0;let m=new Int16Array(t),v=t;for(let _=0;_<t;_++)m[_]=t-1-_;let p=-1,h=document.createElement("canvas");h.className="cursor-trail-canvas",Object.assign(h.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"5",touchAction:"none"}),e.appendChild(h);let g=h.getContext("2d",{alpha:!0,desynchronized:!0}),y=document.createElement("canvas");y.width=a,y.height=a;let I=y.getContext("2d");I.shadowColor="#FFEB3B",I.shadowBlur=l,I.fillStyle="#FFEB3B",I.beginPath(),I.arc(u,u,s,0,Math.PI*2),I.fill();let E=!1,M=null,A=null,G={left:0,top:0,width:0,height:0},P=1,$=!1,L=0,F=0,T=!1,C=null,Y=[],Q=()=>{if($)return;let _=document.documentElement.clientWidth,H=document.documentElement.clientHeight;G={left:0,top:0,width:_,height:H,right:_,bottom:H,x:0,y:0}},ae=()=>{if($)return;Q();let _=Math.min(window.devicePixelRatio||1,2);P=G.width>0?Math.min(_,512/G.width):_,h.width=G.width*P,h.height=G.height*P,g.scale(P,P),C=null},he=null;typeof ResizeObserver<"u"&&(he=new ResizeObserver(()=>{ae()}),he.observe(e));let be=(_,H)=>{if(v<=0)return;let z=m[--v];z>p&&(p=z);let de=z*f;d[de]=_,d[de+1]=H,d[de+2]=0,d[de+3]=n},Oe=(_,H,z)=>{if(M===null||A===null)z.count<r&&(be(_,H),z.count++);else{let de=_-M,ee=H-A,re=Math.hypot(de,ee);if(re>=o){let ge=Math.floor(re/o);for(let Be=1;Be<=ge&&!(z.count>=r);Be++){let ne=Be*o/re;be(M+de*ne,A+ee*ne),z.count++}}z.count<r&&(be(_,H),z.count++)}M=_,A=H},ke=_=>{if($)return;L||(F=0,L=requestAnimationFrame(W)),G.width||Q();let H=0,z=0,de=(ee,re)=>ee>=0&&ee<=G.width&&re>=0&&re<=G.height;if(_.getCoalescedEvents){let ee=_.getCoalescedEvents();if(ee.length>0)for(let re of ee){let ge=re.clientX-H,Be=re.clientY-z;Y.push({x:ge,y:Be,inside:de(ge,Be)})}else{let re=_.clientX-H,ge=_.clientY-z;Y.push({x:re,y:ge,inside:de(re,ge)})}}else{let ee=_.clientX-H,re=_.clientY-z;Y.push({x:ee,y:re,inside:de(ee,re)})}},U=()=>{E=!1,M=null,A=null,Y.length=0},W=()=>{if($)return;let _=performance.now();F||(F=_);let H=_-F;F=_,H>100&&(H=100);let z={count:0};if(Y.length>0){for(let Ue of Y)Ue.inside?(E=!0,Oe(Ue.x,Ue.y,z)):(E=!1,M=null,A=null);let ve=Y[Y.length-1];ve.inside&&(M!==ve.x||A!==ve.y)&&(be(ve.x,ve.y),M=ve.x,A=ve.y),Y.length=0}else E&&M!==null&&A!==null&&be(M,A);let de=t-v;if(de===0&&!T){L=0;return}C?g.clearRect(C.x,C.y,C.w,C.h):g.clearRect(0,0,G.width,G.height),T=!1;let ee=1/0,re=1/0,ge=-1/0,Be=-1/0,ne=-1;if(de>0)for(let ve=0;ve<=p;ve++){let Ue=ve*f,Ae=d[Ue+2];if(Ae>=d[Ue+3])continue;if(Ae+=H,d[Ue+2]=Ae,Ae>=d[Ue+3]){m[v++]=ve;continue}ne=ve;let Fe=d[Ue+3],ce=Ae/Fe,te=1-ce,xe=1-.4*ce;T=!0,g.globalAlpha=te;let x=a*xe,j=x/2,Z=d[Ue],oe=d[Ue+1],ye=Math.round(Z-j),ue=Math.round(oe-j),We=Math.round(x);g.drawImage(y,ye,ue,We,We),ye<ee&&(ee=ye),ue<re&&(re=ue);let ot=ye+We,Ie=ue+We;ot>ge&&(ge=ot),Ie>Be&&(Be=Ie)}p=ne,ee!==1/0?(ee-=2,re-=2,ge+=2,Be+=2,C={x:ee,y:re,w:ge-ee,h:Be-re}):C=null,L=requestAnimationFrame(W)};window.addEventListener("resize",ae),window.addEventListener("scroll",Q,{passive:!0}),window.addEventListener("focus",Q,{passive:!0}),document.addEventListener("visibilitychange",Q,{passive:!0});let q={passive:!0},X=_=>{Q(),ke(_)},J=_=>{Q(),ke(_)};e.addEventListener("pointermove",ke,q),e.addEventListener("pointerdown",J,q),e.addEventListener("pointerenter",X,q),e.addEventListener("pointerleave",U,q),e.addEventListener("pointercancel",U,q),ae(),L=requestAnimationFrame(W);let le=setInterval(Q,1e3);return{destroy:()=>{$=!0,L&&cancelAnimationFrame(L),le&&clearInterval(le),he&&(he.disconnect(),he=null);try{window.removeEventListener("resize",ae)}catch{}try{window.removeEventListener("scroll",Q)}catch{}try{window.removeEventListener("focus",Q)}catch{}try{document.removeEventListener("visibilitychange",Q)}catch{}try{e.removeEventListener("pointermove",ke),e.removeEventListener("pointerdown",J),e.removeEventListener("pointerenter",X),e.removeEventListener("pointerleave",U),e.removeEventListener("pointercancel",U)}catch{}h.remove()}}}var Qv=De(()=>{});var u0={};It(u0,{clearPendingGains:()=>tm,getPassiveCoinReward:()=>cu,initCoinPickup:()=>_x,setCoinMultiplier:()=>Ix,triggerPassiveCollect:()=>Wd});function e0(e){if(!e||typeof e!="object"){Tl=!1,Ru=!1,Ou="0",Ni.clear();return}Tl=!!e.unlocked,Ru=!!e.level?.isInfinite?.();try{Ou=e.level?.toPlainIntegerString?.()??"0"}catch{Ou="0"}Tl?Ru&&Ni.clear():Ni.clear()}function vx(){if(typeof ki=="function")try{ki()}catch{}try{e0(yt())}catch{Tl=!1,Ni.clear()}try{ki=Ri(e=>{e0(e)})}catch{ki=null}}function Ix(e){Sx=e;try{R.coins?.mult?.set&&R.coins.mult.set(e)}catch{}}function Kp(){try{let e=Uc();e instanceof c?zs=e.clone?.()??e:e!=null?zs=c.fromAny(e):zs=c.fromInt(1)}catch{zs=c.fromInt(1)}}function wx(){t0||(t0=!0,Kp(),typeof document<"u"&&document.addEventListener("ccc:upgrades:changed",Kp),typeof window<"u"&&window.addEventListener("saveSlot:change",Kp))}function Ex(e){if(e?.dataset?.bn)try{return c.fromAny(e.dataset.bn)}catch{}if(e?.dataset?.value)try{return c.fromAny(e.dataset.value)}catch{}try{return Qp.clone?.()??c.fromInt(1)}catch{return c.fromInt(1)}}function Jp(){if(typeof window>"u"||typeof document>"u")return 0;let e=document.documentElement,t=Math.max(0,window.innerWidth||e?.clientWidth||0),n=Math.max(0,window.innerHeight||e?.clientHeight||0);return t>0&&n>0?Math.min(t,n)*xx:0}function Lx({playfield:e,coinsLayer:t,coinSelector:n,collectFn:o,collectBatchFn:r,spawner:i}){if(!e||!t||typeof o!="function")return{destroy(){}};if(typeof window>"u"||typeof document>"u")return{destroy(){}};let s=document.createElement("div");s.className="magnet-indicator",s.setAttribute("aria-hidden","true"),e.appendChild(s);let l=!1,a=!1,u=0,f=0,d=0,m=0,v=null,p=null,h=Jp(),g=0,y=0,I=0,E=!1,M=null,A=null,G=()=>{if(E)return;let q=document.documentElement.clientWidth,X=document.documentElement.clientHeight;M={left:0,top:0,width:q,height:X,right:q,bottom:X,x:0,y:0}},P=()=>{s.classList.remove("is-visible"),s.style.transform="translate3d(-9999px, -9999px, 0)",v=null,p=null},$=()=>{if(!l||y<=0){P();return}let q=y*2;s.style.width=`${q}px`,s.style.height=`${q}px`,s.style.transform=`translate3d(${d-y}px, ${m-y}px, 0)`,s.classList.add("is-visible")},L=()=>{if(!(!l||y<=0))if(i&&typeof i.findCoinTargetsInRadius=="function"){let q=y+jp,X=[];if(typeof i.findCoinTargetsInPath=="function"&&v!==null&&p!==null?X=i.findCoinTargetsInPath(v,p,d,m,q):X=i.findCoinTargetsInRadius(d,m,q),v=d,p=m,X&&X.length>0)if(typeof r=="function"){let J=[];for(let le=0;le<X.length;le++){let fe=X[le],_={coin:fe};fe.el&&i.getCoinTransform&&(_.opts={transform:i.getCoinTransform(fe.el)}),J.push(_)}r(J)}else for(let J=0;J<X.length;J++){let le=X[J],fe=i.ensureCoinVisual?i.ensureCoinVisual(le):le.el;if(fe){let _=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform||"";o(fe,{transform:_})}}}else if(i&&typeof i.findCoinsInRadius=="function"){let q=y+jp,X=i.findCoinsInRadius(d,m,q);if(v=d,p=m,X&&X.length>0){let J=[];for(let le=0;le<X.length;le++){let fe=X[le],_=i.getCoinTransform?i.getCoinTransform(fe):fe.style.transform;J.push({el:fe,opts:{transform:_}})}typeof r=="function"&&r(J)}}else{let q=t.children,X=y+jp,J=[];for(let le=q.length-1;le>=0;le--){let fe=q[le];if(fe.dataset.collected==="1"||!fe.matches(n))continue;let _=fe.getBoundingClientRect(),H=_.left+_.width/2,z=_.top+_.height/2,de=H-u,ee=z-f;Math.hypot(de,ee)<=X&&J.push(fe)}if(!J.length)return;if(typeof r=="function"){let le=[];for(let fe=0;fe<J.length;fe++){let _=J[fe],H=window.getComputedStyle(_);le.push({el:_,opts:{transform:H.transform}})}r(le)}else{let le=[];for(let fe=0;fe<J.length;fe++){let _=J[fe],H=window.getComputedStyle(_);le.push(H.transform)}for(let fe=0;fe<J.length;fe++)o(J[fe],{transform:le[fe]})}}},F=()=>{I=0,$(),!(!l||y<=0||E)&&(L(),T())},T=()=>{!l||y<=0||I||E||(I=requestAnimationFrame(F))},C=q=>{if(!q||E||typeof q.clientX!="number"||typeof q.clientY!="number")return;a=!0,u=q.clientX,f=q.clientY,M||G();let X=M;d=u,m=f,l=d>=0&&d<=X.width&&m>=0&&m<=X.height,T()},Y=()=>{l=!1,P(),v=null,p=null},Q=()=>{v=null,p=null},ae=()=>{g=Dc(),y=g*h,$(),T()},he=()=>{if(!(E||!a)){if(G(),M){let q=M;d=u-q.left,m=f-q.top,l=d>=0&&d<=q.width&&m>=0&&m<=q.height}T()}},be=()=>{if(h=Jp(),y=g*h,G(),a&&M){let q=M;d=u-q.left,m=f-q.top,l=d>=0&&d<=q.width&&m>=0&&m<=q.height}T()},Oe=q=>{G(),C(q)},ke=q=>{Q(),Oe(q)},U=()=>{E=!0,I&&(cancelAnimationFrame(I),I=0),A&&clearInterval(A);try{window.removeEventListener("scroll",he)}catch{}try{window.removeEventListener("resize",be)}catch{}try{window.removeEventListener("saveSlot:change",ae)}catch{}try{document.removeEventListener("ccc:upgrades:changed",ae)}catch{}try{e.removeEventListener("pointermove",C)}catch{}try{e.removeEventListener("pointerdown",Oe)}catch{}try{e.removeEventListener("pointerenter",ke)}catch{}try{e.removeEventListener("pointerleave",Y)}catch{}try{e.removeEventListener("pointercancel",Y)}catch{}try{window.removeEventListener("blur",Q)}catch{}try{s.remove()}catch{}},W={passive:!0};return e.addEventListener("pointermove",C,W),e.addEventListener("pointerdown",Oe,W),e.addEventListener("pointerenter",ke,W),e.addEventListener("pointerleave",Y,W),e.addEventListener("pointercancel",Y,W),window.addEventListener("resize",be),window.addEventListener("scroll",he,{passive:!0}),window.addEventListener("focus",G,{passive:!0}),window.addEventListener("blur",Q,{passive:!0}),document.addEventListener("visibilitychange",()=>{G(),document.hidden&&Q()},{passive:!0}),window.addEventListener("saveSlot:change",ae),document.addEventListener("ccc:upgrades:changed",ae),A=setInterval(G,1e3),ae(),{destroy:U}}function tm(){kl=null,Al=null,Nl=null}function c0(e){let t=Qp.clone?.()??c.fromInt(1),n=a0(t),o=Eo(n0),i=l0(e??Ou);if(i){try{n=n.mulBigNumInteger(i)}catch{}try{o=o.mulBigNumInteger(i)}catch{}}let s=typeof Po=="function"&&Po()?Eo(zs):c.fromInt(0);return{coinGain:n,xpGain:o,mpGain:s}}function cu(){let{coinGain:e,xpGain:t,mpGain:n}=c0(null);return{coins:e,xp:t,mp:n}}function Wd(e=1){if(e<=0)return;let{coinGain:t,xpGain:n,mpGain:o}=c0(null),r=t.mulBigNumInteger(c.fromAny(e)),i=n.mulBigNumInteger(c.fromAny(e)),s=o.mulBigNumInteger(c.fromAny(e)),l=mn(Re.COINS),a=typeof r?.isZero=="function"?r.isZero():!1;if(!a&&!l)try{Fn=Fn?.add?Fn.add(r):Eo(r)}catch{Fn=Eo(r)}Ml(),a||o0(r);let u=typeof gn=="function"?gn():!0,f=typeof i?.isZero=="function"?i.isZero():!1;u&&!f&&r0(i),s.isZero?.()||i0(s)}function _x({spawner:e,playfieldSelector:t=".area-cove .playfield",coinsLayerSelector:n=".area-cove .coins-layer",hudAmountSelector:o=".hud-top .coin-amount",coinSelector:r=".coin, [data-coin], .coin-sprite",soundSrc:i="sounds/coin_pickup.ogg",storageKey:s="ccc:coins",disableAnimation:l=!1}={}){Yp?.destroy&&Yp.destroy();let a=document.querySelector(t),u=document.querySelector(n),f=document.querySelector(o);if(!a||!u||!f)return console.warn("[coinPickup] missing required nodes",{pf:!!a,cl:!!u,amt:!!f}),{destroy(){}};vx(),wx(),a.style.touchAction="none";let d=null,m=null;Fn=R.coins.value,Zp=()=>{let _=K(Fn),H=sp(),z=_+H;z.includes("<span")?f.innerHTML=z:f.textContent=z},s0(),Ml();let v=_=>{_?.detail&&_.detail.key==="coins"&&(Fn=_.detail.value,Ml())};window.addEventListener("currency:change",v);let p=_=>{if(!(!_?.detail||_.detail.key!=="coins"))try{let{mult:H}=_.detail;H instanceof c?to=H.clone?.()??H:H!=null?to=c.fromAny(H):to=c.fromInt(1),Ai=!!to?.isInfinite?.()}catch{to=null,Ai=!1}};window.addEventListener("currency:multiplier",p);let h=b();if(h==null)return console.warn("[coinPickup] init called before a save slot is selected."),{destroy(){}};let g=`ccc:unlock:shop:${h}`,y=`ccc:unlock:shop:progress:${h}`,I=localStorage.getItem("ccc:unlock:shop:progress"),E=localStorage.getItem("ccc:unlock:shop");I!=null&&localStorage.getItem(y)==null&&localStorage.setItem(y,I),E!=null&&localStorage.getItem(g)==null&&localStorage.setItem(g,E),localStorage.removeItem("ccc:unlock:shop:progress"),localStorage.removeItem("ccc:unlock:shop");{let _=parseInt(localStorage.getItem(y)||"0",10);if(localStorage.setItem(y,String(_)),_>=10&&localStorage.getItem(g)!=="1"){try{Ti()}catch{}localStorage.setItem(g,"1")}}let M=new URL(i,document.baseURI).href,A=_=>_ instanceof HTMLElement?_._coinObj?!_._coinObj.isRemoved&&_.dataset.collected!=="1":_.dataset.collected!=="1"&&_.matches(r):!1;function G(_){try{_.style.pointerEvents="auto"}catch{}}u.querySelectorAll(r).forEach(G);let P=Je?.12:.3,$=0;function L(_=M){if(_===M){let H=performance.now();if(H-$<40)return;$=H}pt(_,{volume:P})}function F(_,H={}){e&&typeof e.detachCoin=="function"&&e.detachCoin(_);let z=()=>{_&&(e&&typeof e.recycleCoin=="function"?e.recycleCoin(_):_.remove())};if(l||Je){z();return}let de="translate3d(0,0,0)";H.transform?H.transform!=="none"&&(de=H.transform):de=_.style.transform||"translate3d(0,0,0)",_.style.setProperty("--ccc-start",de),_.classList.add("coin--collected");let ee=!1,re=()=>{ee||(ee=!0,_.removeEventListener("animationend",re),z())};_.addEventListener("animationend",re),setTimeout(re,600)}function T(_){if(!_||!_.length)return;let H=M,z=-1,de=!1;for(let ce of _){let te=ce.coin||ce.el&&ce.el._coinObj;te&&(te.sizeIndex!==void 0?te.sizeIndex>z&&(z=te.sizeIndex,te.soundSrc&&(H=te.soundSrc,de=!0)):te.soundSrc&&!de&&(H=te.soundSrc,de=!0))}L(H);let ee=null,re=null,ge=null,Be=0,ne=mn(Re.COINS),ve=typeof gn=="function"?gn():!0,Ue=typeof Po=="function"&&Po(),Ae=15,Fe=0;for(let ce of _){let te=ce.el,xe=ce.coin;if(!xe&&te&&te._coinObj&&(xe=te._coinObj),te&&!A(te)||xe&&xe.isRemoved)continue;Be++,te&&(te.dataset.collected="1"),Fe<Ae?(!te&&xe&&e&&e.ensureCoinVisual&&(te=e.ensureCoinVisual(xe),te&&(te.dataset.collected="1")),te?(F(te,ce.opts||{}),Fe++):xe&&e&&e.removeCoinTarget&&e.removeCoinTarget(xe)):xe&&e&&e.removeCoinTarget?e.removeCoinTarget(xe):te&&(e&&e.detachCoin&&e.detachCoin(te),e&&e.recycleCoin?e.recycleCoin(te):te.remove());let x=te?Ex(te):Qp,j=xe?.mutationLevel??(te?.dataset?.mutationLevel||null),Z=a0(x),oe=Eo(n0),ye=Eo(zs);if(xe&&xe.valueMultiplier&&xe.valueMultiplier>1){try{Z=Z.mulDecimalFloor(xe.valueMultiplier)}catch{}try{oe=oe.mulDecimalFloor(xe.valueMultiplier)}catch{}try{ye=ye.mulDecimalFloor(xe.valueMultiplier)}catch{}}let ue=l0(j);if(ue){try{Z=Z.mulBigNumInteger(ue)}catch{}try{oe=oe.mulBigNumInteger(ue)}catch{}}ne||(ee=Ks(ee,Z)),ve&&(re=Ks(re,oe)),Ue&&(ge=Ks(ge,ye))}if(Be!==0){if(Py(),ee&&!ee.isZero?.()){try{Fn=Fn?.add?Fn.add(ee):Eo(ee)}catch{Fn=Eo(ee)}o0(ee),Ml()}if(re&&!re.isZero?.()&&r0(re),ge&&!ge.isZero?.()&&i0(ge),localStorage.getItem(g)!=="1"){let te=parseInt(localStorage.getItem(y)||"0",10)+Be;if(localStorage.setItem(y,String(te)),te>=10){try{Ti()}catch{}localStorage.setItem(g,"1")}}}}function C(_,H={}){return T([{el:_,opts:H}]),!0}d=Lx({playfield:a,coinsLayer:u,coinSelector:r,collectFn:C,collectBatchFn:T,spawner:e}),m=Jv(a);let Y=_=>{if(_.target===u)return;let H=_.target.closest(r);if(H&&A(H)){let z={};e&&typeof e.getCoinTransform=="function"&&(z.transform=e.getCoinTransform(H)),C(H,z)}};u.addEventListener("pointerdown",Y,{passive:!0}),Je||u.addEventListener("mouseover",Y,{passive:!0});let Q=25,ae=null,he=()=>{let _=document.documentElement.clientWidth,H=document.documentElement.clientHeight;ae={left:0,top:0,width:_,height:H,right:_,bottom:H,x:0,y:0}};window.addEventListener("resize",he),window.addEventListener("scroll",he,{passive:!0}),he();let be=null,Oe=null,ke=()=>{be=null,Oe=null};a.addEventListener("pointerleave",ke,{passive:!0}),a.addEventListener("pointerenter",ke,{passive:!0}),window.addEventListener("blur",ke,{passive:!0});function U(_,H){if(e&&typeof e.findCoinTargetsInRadius=="function"){ae||he();let z=_,de=H,ee=[];if(typeof e.findCoinTargetsInPath=="function"&&be!==null&&Oe!==null?ee=e.findCoinTargetsInPath(be,Oe,z,de,Q,!0):ee=e.findCoinTargetsInRadius(z,de,Q,!0),be=z,Oe=de,ee&&ee.length>0){let re=[];for(let ge=0;ge<ee.length;ge++){let Be=ee[ge],ne={coin:Be};Be.el&&e.getCoinTransform&&(ne.opts={transform:e.getCoinTransform(Be.el)}),re.push(ne)}T(re)}}else if(e&&typeof e.findCoinsInRadius=="function"){ae||he();let z=_,de=H,ee=e.findCoinsInRadius(z,de,Q);if(be=z,Oe=de,ee&&ee.length>0){let re=[];for(let ge of ee){let Be=e.getCoinTransform?e.getCoinTransform(ge):ge.style.transform;re.push({el:ge,opts:{transform:Be}})}T(re)}}else{let z=[[0,0],[18,0],[-18,0],[0,18],[0,-18]],de=new Set;for(let ee=0;ee<z.length;ee++){let re=_+z[ee][0],ge=H+z[ee][1],Be=document.elementsFromPoint(re,ge);for(let ne=0;ne<Be.length;ne++){let ve=Be[ne];A(ve)&&!de.has(ve)&&de.add(ve)}}if(de.size>0){let ee=[];de.forEach(re=>ee.push({el:re})),T(ee)}}}let W=null,q=!1;function X(_,H){W={x:_,y:H},q||(q=!0,requestAnimationFrame(()=>{W&&(U(W.x,W.y),W=null),q=!1}))}a.addEventListener("pointerdown",_=>{X(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("pointermove",_=>{_.pointerType!=="mouse"&&X(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("pointerup",_=>{_.pointerType!=="mouse"&&X(_.clientX,_.clientY)},{passive:!0}),a.addEventListener("mousemove",_=>{X(_.clientX,_.clientY)},{passive:!0});function J(_){}let le=setInterval(he,1e3),fe=()=>{if(clearInterval(le),Pu(),Zp=()=>{},typeof window<"u"&&(window.removeEventListener("resize",he),window.removeEventListener("beforeunload",Pu),window.removeEventListener("currency:multiplier",p),window.removeEventListener("currency:change",v),window.removeEventListener("blur",ke)),typeof ki=="function"){try{ki()}catch{}ki=null}if(d?.destroy){try{d.destroy()}catch{}d=null}if(m?.destroy){try{m.destroy()}catch{}m=null}try{u.removeEventListener("pointerdown",Y),Je||u.removeEventListener("mouseover",Y)}catch{}try{["pointerdown","pointermove","pointerup","mousemove"].forEach(_=>a.replaceWith(a.cloneNode(!0)))}catch{}};return Yp={destroy:fe},{get count(){return Fn},set count(_){Fn=c.fromAny?c.fromAny(_):c.fromInt(Number(_)||0),Ml()},setMobileVolume:J,destroy:fe,collectBatch:T,getMagnetUnitPx:Jp}}var Tl,Ru,Ou,ki,Yp,n0,Qp,bx,Ws,Ni,Sx,zs,t0,kl,Al,Nl,Wp,Fn,Zp,zp,Ml,xx,jp,Eo,Ks,Pu,em,o0,r0,i0,to,Ai,s0,a0,l0,rl=De(()=>{vt();xt();qt();Nu();An();vo();go();ho();Qv();Cn();Jc();yn();Tl=!1,Ru=!1,Ou="0",ki=null;Yp=null,n0=c.fromInt(1),Qp=c.fromInt(1),bx=c.fromInt(1);try{Ws=c.fromAny("Infinity")}catch{Ws=null}Ni=new Map,Sx="1",zs=c.fromInt(1),t0=!1,kl=null,Al=null,Nl=null,Wp=!1,Fn=null,Zp=()=>{},zp=!1,Ml=()=>{zp||(zp=!0,requestAnimationFrame(()=>{zp=!1,Zp()}))};xx=.05,jp=8;Eo=e=>{if(!e)return c.fromInt(0);if(typeof e.clone=="function")try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return c.fromInt(0)}},Ks=(e,t)=>{if(!t)return e;if(!e)return Eo(t);try{return e.add(t)}catch{try{return Eo(e).add(t)}catch{return Eo(t)}}},Pu=()=>{let e=kl;if(kl=null,e&&!e.isZero?.())try{R.coins.add(e)}catch{}let t=Al;if(Al=null,t&&!t.isZero?.())try{ls(t)}catch{}let n=Nl;if(Nl=null,n&&!n.isZero?.())try{Ps(n)}catch{}},em=()=>{Wp||(Wp=!0,requestAnimationFrame(()=>{Wp=!1,Pu()}))},o0=e=>{kl=Ks(kl,e),em()},r0=e=>{Al=Ks(Al,e),em()},i0=e=>{Nl=Ks(Nl,e),em()};typeof window<"u"&&window.addEventListener("beforeunload",Pu,{passive:!0});to=null,Ai=!1,s0=()=>{try{let e=R?.coins?.mult;if(!e||typeof e.get!="function"){to=null,Ai=!1;return}let t=e.get();if(!t){to=c.fromInt(1),Ai=!1;return}to=t.clone?.()??c.fromAny(t),Ai=!!to?.isInfinite?.()}catch{to=null,Ai=!1}},a0=e=>{let t;try{t=e instanceof c?e.clone?.()??e:c.fromAny(e??0)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(e):c.fromInt(0)}catch{return c.fromInt(0)}}to||s0();let n=to;if(!n)try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}if(Ai||n.isInfinite?.())try{return c.fromAny("Infinity")}catch{return t.clone?.()??t}if(t.isZero?.())return t.clone?.()??t;try{return t.mulBigNumInteger(n)}catch{try{return R?.coins?.mult?.applyTo?R.coins.mult.applyTo(t):t.clone?.()??t}catch{return t.clone?.()??t}}},l0=e=>{if(!Tl)return null;if(Ru){if(Ws)try{return Ws.clone?.()??Ws}catch{return Ws}return null}if(!e)return null;let t=String(e).trim();if(!t)return null;let n=Ni.get(t);if(n)try{return n.clone?.()??c.fromAny(n)}catch{Ni.delete(t)}let o;try{o=c.fromAny(t)}catch{return null}let r;try{r=js(o)}catch{r=null}if(!r)return null;let i=r.cmp?.(bx)===0,s=r.clone?.()??r;if(Ni.set(t,s),i)return null;try{return s.clone?.()??s}catch{return s}}});function Cx(e){if(e==null)return 0;try{let t=localStorage.getItem(d0(e));return t?parseInt(t,10):0}catch{return 0}}function Mx(e,t){if(e!=null)try{localStorage.setItem(d0(e),t.toString())}catch{}}function Tx(e){if(e==null)return 0;try{let t=localStorage.getItem(p0(e));return t?parseInt(t,10):0}catch{return 0}}function kx(e,t){if(e!=null)try{localStorage.setItem(p0(e),t.toString())}catch{}}function Ax(e){if(e==null)return 0;try{let t=localStorage.getItem(m0(e));return t?parseInt(t,10):0}catch{return 0}}function Nx(e,t){if(e!=null)try{localStorage.setItem(m0(e),t.toString())}catch{}}function Rx(e){if(e==null)return 0;try{let t=localStorage.getItem(h0(e));return t?parseInt(t,10):0}catch{return 0}}function Ox(e,t){if(e!=null)try{localStorage.setItem(h0(e),t.toString())}catch{}}function g0(e){let t=0,n=!1;if(typeof e=="number")t=e,t>=8&&(n=!0);else if(typeof e=="bigint")e>Number.MAX_SAFE_INTEGER?t=Number.MAX_SAFE_INTEGER:t=Number(e),e>=8n&&(n=!0);else if(e===1/0)t=1/0,n=!0;else if(e&&typeof e.toString=="function")try{let p=Number(e.toString());isNaN(p)||(t=p),(e==="Infinity"||p===1/0)&&(n=!0)}catch{}let o=b(),r=Cx(o),i=r;i<1&&n&&(i=1),i<2&&it(4)>=1&&(i=2),i!==r&&(r=i,Mx(o,r));let s=Tx(o),l=s;l<1&&it(4)>=1&&(l=1),l!==s&&(s=l,kx(o,s));let a=Ax(o),u=a;u<1&&it(4)>=1&&(u=1),u!==a&&(a=u,Nx(o,a));let f=Rx(o),d=f;d<1&&it(4)>=1&&(d=1),d!==f&&(f=d,Ox(o,f));let m=[],v=[];for(let p of f0){let h=p;if(n){h={...p,description:[...p.description]};let g=Rn(),y=Jn(),I=g+y;if(I>1&&(I=1),p.id===1){let E=Math.pow(10,I),M=Te(E);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${M}x</span>`)}else if(p.id===2){let E=Math.pow(10,I),M=Te(E);h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${M}x</span>`)}else if(p.id===4){let E=Math.log10(4444e9),M=ie(E*I),A=K(M);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${A}x</span>`)}else if(p.id===14){let E=Math.log10(1414e16),M=ie(E*I),A=K(M);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?x<\/span>/,`<span style="color:#00e5ff">${A}x</span>`)}else if(p.id===17){let A=ie(15*I),G=ie(5*I),P=K(A),$=K(G);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`),h.description[2]=h.description[2].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`)}else if(p.id===18){let A=ie(15*I),G=ie(5*I),P=K(A),$=K(G);h.description[0]=h.description[0].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${P}x</span>`),h.description[1]=h.description[1].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`),h.description[2]=h.description[2].replace(/<span style="color:#00e5ff">.*?<\/span>/,`<span style="color:#00e5ff">${$}x</span>`)}}if(p.id===9&&(h===p&&(h={...p,description:[...p.description]}),r===0?h.description=["This milestone is hidden for now"]:r===1&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===10&&(h===p&&(h={...p,description:[...p.description]}),s===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===13){h===p&&(h={...p,description:[...p.description]});let y=ut()*1.5-.5,I=Math.pow(100,y),E=Te(I);h.description[0]=`Activates generator: Passively generates <span style="color:#00e5ff">${E}%</span> of pending Gold every second`}if(p.id===14&&(h===p&&(h={...p,description:[...p.description]}),a===0&&(h.description=["This milestone is hidden until you research Lab Node 4"])),p.id===15)if(h===p&&(h={...p,description:[...p.description]}),f===0)h.description=["This milestone is hidden until you research Lab Node 4"];else{let g=Qc(!0),y=Te(g);h.description[0]=`Unspent DNA boosts Coins: <span style="color:#00e5ff">${y}x</span>`;let I=fl(!0),E=Te(I);h.description.push(`Unspent DNA also divides the value of Coins and the value of Magic by <span style="color:#00e5ff">${E}x</span>`)}if(p.id===16){h===p&&(h={...p,description:[...p.description]});let y=ut()*1.5-.5,I=Math.pow(100,y),E=Te(I);h.description[0]=`Activates generator: Passively generates <span style="color:#00e5ff">${E}%</span> of pending Magic every second`}p.surgeLevel<=t?m.push(h):v.push(h)}return[...m,...v.slice(0,2)]}var f0,nm,d0,p0,m0,h0,y0=De(()=>{qt();xt();xt();yn();Jo();vt();f0=[{id:1,surgeLevel:1,affectedByTsunami:!0,description:['Multiplies Coin, XP, and MP value by <span style="color:#00e5ff">10x</span>',"Unlocks the Warp tab"]},{id:2,surgeLevel:2,affectedByTsunami:!0,description:["Allows some Coins to spawn with a larger size, yielding collection multipliers; the largest Coins won't despawn even when others do",'Improves Effective Auto-Collect by <span style="color:#00e5ff">10x</span>']},{id:3,surgeLevel:3,affectedByTsunami:!0,description:["Generates Books based on XP Level instead of earning a flat amount of Books on level up","Unlocks a new Book upgrade"]},{id:4,surgeLevel:4,affectedByTsunami:!0,description:[`Multiplies MP value by <span style="color:#00e5ff">${K(c.fromInt(4444e9))}x</span>`]},{id:5,surgeLevel:5,description:["Unlocks a new Gold upgrade"]},{id:6,surgeLevel:6,affectedByTsunami:!0,description:["Unspent Coins boost Coins","Unspent Books boost Coins","Unspent Gold boosts Coins","Unspent Magic boosts Coins"]},{id:7,surgeLevel:7,description:["Unlocks a new Magic upgrade","Makes each Workshop Level triple Gear production instead of doubling it"]},{id:8,surgeLevel:8,description:["Invokes the Tsunami"]},{id:9,surgeLevel:9,affectedByTsunami:!0,description:["Significantly boosts DNA gained from the Experiment reset"]},{id:10,surgeLevel:10,description:["Unlocks new DNA upgrades"]},{id:11,surgeLevel:11,description:["Unlocks a new automation upgrade","Makes each Workshop Level quadruple Gear production instead of tripling it"]},{id:12,surgeLevel:12,affectedByTsunami:!0,description:["Adequately boosts the effect Lab Level has on RP multiplier"]},{id:13,surgeLevel:13,affectedByTsunami:!0,description:['Activates generator: Passively generates <span style="color:#00e5ff">0.1%</span> of pending Gold every second']},{id:14,surgeLevel:14,affectedByTsunami:!0,description:[`Multiplies DNA value by <span style="color:#00e5ff">${K(c.fromInt(1414e16))}x</span>`,"Unlocks Combo: Collecting Coins increases a Combo which alleviates the exponent effect on larger Coins (beware, Combo decays)","Combo effect is shown in the Coin Counter"]},{id:15,surgeLevel:15,affectedByTsunami:!0,description:['Unspent DNA boosts Coins: <span style="color:#00e5ff">1x</span>']},{id:16,surgeLevel:16,affectedByTsunami:!0,description:['Activates generator: Passively generates <span style="color:#00e5ff">0.1%</span> of pending Magic every second']},{id:17,surgeLevel:17,affectedByTsunami:!0,description:[`Multiplies Magic value by <span style="color:#00e5ff">${K(c.fromInt(1e15))}x</span>`,`Divides Coin value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,`Divides DNA value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,"Halves Wave value (immune to exponent)"]},{id:18,surgeLevel:18,affectedByTsunami:!0,description:[`Multiplies Coin value by <span style="color:#00e5ff">${K(c.fromInt(1e15))}x</span>`,`Divides Magic value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,`Divides DNA value by <span style="color:#00e5ff">${K(c.fromInt(1e5))}x</span>`,"Halves Wave value (immune to exponent)"]},{id:19,surgeLevel:19,description:["Unlocks a new DNA upgrade","Doubles XP value (immune to exponent)"]}],nm=f0.filter(e=>e.affectedByTsunami).map(e=>e.id),d0=e=>`ccc:surge:milestone9:state:${e}`,p0=e=>`ccc:surge:milestone10:state:${e}`,m0=e=>`ccc:surge:milestone14:state:${e}`,h0=e=>`ccc:surge:milestone15:state:${e}`});function v0(e,t,n,o={}){e.style.cursor="none";let r=null,i=null,s=null,l=!1;r=pt("sounds/tsu_storm_ambience.ogg",{volume:.8});let a=document.createElement("canvas");a.id="tsunami-bg-canvas",a.style.position="absolute",a.style.inset="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="2147483644",e.appendChild(a);let u=document.createElement("div");u.id="tsunami-ui-container",u.style.position="absolute",u.style.inset="0",u.style.zIndex="2147483645",u.style.pointerEvents="none",u.style.color="#fff",u.style.textShadow="0 1px 2px rgba(0,0,0,0.8)";function f(x,j){x.style.position="absolute",x.style.left="50%";let Z="perspective(600px) rotateX(50deg) rotateZ(180deg)",oe=!!o.xpHTML,ye=!!o.mpHTML;j==="coin"?(x.style.top="77%",x.style.transform=`translateX(-50%) ${Z}`):oe&&ye?(x.style.top="72.5%",j==="mp"?x.style.transform=`translateX(calc(-100% - 44px)) ${Z}`:x.style.transform=`translateX(44px) ${Z}`):(j==="mp"?x.style.top="66%":j==="xp"&&(x.style.top="72%"),x.style.transform=`translateX(-50%) ${Z}`),x.style.transformOrigin="center center";let ue=x.firstElementChild;ue&&(ue.removeAttribute("hidden"),ue.style.display="flex")}if(o.coinHTML){let x=document.createElement("div");x.innerHTML=o.coinHTML,f(x,"coin"),u.appendChild(x)}if(o.xpHTML){let x=document.createElement("div");x.innerHTML=o.xpHTML,f(x,"xp"),u.appendChild(x)}if(o.mpHTML){let x=document.createElement("div");x.innerHTML=o.mpHTML,f(x,"mp"),u.appendChild(x)}e.appendChild(u);let d=document.createElement("canvas");d.id="tsunami-fg-canvas",d.style.position="absolute",d.style.inset="0",d.style.width="100%",d.style.height="100%",d.style.zIndex="2147483646",d.style.pointerEvents="none",e.appendChild(d);let m=new Image;m.src="img/misc/merchant.webp";let v=!1;m.onload=()=>{v=!0},m.onerror=x=>{console.error("Tsunami: Merchant load failed",x)};let p,h,g=[],y=[],I=0;function E(){g=[],y=[];let x=h*.65,j=x+h*.15,oe=300*(Math.min(p,h)*5e-4),ye=p*.8,ue=ye-oe*.6,We=ye+oe*.6;for(let ht=0;ht<100;ht++){let dn=Math.random()*p,Vn=j+Math.random()*(h-j);y.push({x:dn,y:Vn})}let ot=(ht,dn,Vn)=>{if(ht>p*.1&&ht<p*.9){let $t=h-x,_n=x+$t*.15;if(dn>_n)return!1}else if(Vn==="tree"){let $t=h-x,_n=x+$t*.5;if(dn>_n)return!1}return!(Vn==="tree"&&ht>ue&&ht<We)},Ie=(ht,dn,Vn,$t,_n)=>{for(let jr=0;jr<dn;jr++){let qo,Go,vr=!1,Ne=0;for(;!vr&&Ne<50;){_n?qo=_n():qo=Math.random()*p;let w=h,k=Math.random();if(Go=x+20+k*k*(w-x-20),ot(qo,Go,ht)&&(vr=!0,ht==="tree")){for(let O of g)if(O.type==="tree"){let N=O.x-qo,B=O.y-Go;if(Math.sqrt(N*N+B*B)<Math.max(p*.08,100)){vr=!1;break}}}Ne++}if(vr){let k=.6+(Go-x)/(h-x)*.6,O=(Vn+Math.random()*$t)*k;g.push({type:ht,x:qo,y:Go,scale:O})}}},Ge=3+Math.floor(Math.random()*3);Ie("tree",Ge,.8,.4,()=>Math.random()*(p*.1)),Ie("tree",Ge,.8,.4,()=>p*.9+Math.random()*(p*.1));let Vt=5+Math.floor(Math.random()*3);Ie("tree",Vt,.8,.4,()=>p*.1+Math.random()*(p*.8)),Ie("rock",20,.6,.4),Ie("shell",30,.3,.3),g.sort((ht,dn)=>ht.y-dn.y)}let M=a.getContext("2d",{alpha:!1}),A=d.getContext("2d",{alpha:!0});function G(){let x=window.devicePixelRatio||1;p=window.innerWidth,h=window.innerHeight,a.width=p*x,a.height=h*x,a.style.width=p+"px",a.style.height=h+"px",d.width=p*x,d.height=h*x,d.style.width=p+"px",d.style.height=h+"px",M.scale(x,x),A.scale(x,x),E(),I=-50}window.addEventListener("resize",G),G();let P=Date.now(),$=!0,L,F=!1,T={skyTop:"#4fa8ff",skyBottom:"#b8e1ff",sun:"#ffeb3b",waterDeep:"#005b96",waterMid:"#0077be",waterPeak:"#005b96",foam:"#005b96",sandLight:"#f1dcb1",sandDark:"#debe7c",rock:"#5d4037",leaf:"#4caf50",shell:"#fff0f5"},C={skyTop:"#000510",skyBottom:"#000815",sun:"#2a2a2a",waterDeep:"#050e2e",waterMid:"#08183d",waterPeak:"#102a5c",foam:"#102a5c",sandLight:"#2c2a20",sandDark:"#1a1810",rock:"#1a1a1a",leaf:"#1b2e1b",shell:"#3b3035"},Y=!1,Q=[],ae=0,he=!1,be=0,Oe=5e3,ke=!1,U=0,W=[],q=6;for(let x=0;x<q;x++)W.push({offset:Math.random()*1e3,speedBase:.001+x*5e-4,amplitudeBase:10+x*5});let X=[],J=400;function le(x,j,Z){return x*(1-Z)+j*Z}function fe(x){let j=parseInt(x.slice(1),16);return{r:j>>16&255,g:j>>8&255,b:j&255}}function _(x,j,Z){let oe=fe(x),ye=fe(j),ue=Math.round(le(oe.r,ye.r,Z)),We=Math.round(le(oe.g,ye.g,Z)),ot=Math.round(le(oe.b,ye.b,Z));return`rgb(${ue},${We},${ot})`}function H(x,j,Z){let oe=[],ye=x,ue=j,We=20;for(;ue<Z;){let ot=ye+(Math.random()-.5)*60,Ie=ue+We+Math.random()*30;oe.push({x1:ye,y1:ue,x2:ot,y2:Ie}),ye=ot,ue=Ie}return oe}function z(x,j,Z,oe,ye,ue){x.beginPath(),x.moveTo(j+ue,Z),x.lineTo(j+oe-ue,Z),x.quadraticCurveTo(j+oe,Z,j+oe,Z+ue),x.lineTo(j+oe,Z+ye-ue),x.quadraticCurveTo(j+oe,Z+ye,j+oe-ue,Z+ye),x.lineTo(j+ue,Z+ye),x.quadraticCurveTo(j,Z+ye,j,Z+ye-ue),x.lineTo(j,Z+ue),x.quadraticCurveTo(j,Z,j+ue,Z),x.closePath()}function de(x,j,Z,oe,ye){x.save(),x.translate(j,Z),x.scale(oe,oe),x.beginPath(),x.moveTo(0,0),x.quadraticCurveTo(10,-40,-5,-80),x.lineTo(5,-80),x.quadraticCurveTo(20,-40,10,0),x.fillStyle=ye.rock,x.fill(),x.translate(0,-80),x.fillStyle=ye.leaf;for(let ue=0;ue<7;ue++)x.save(),x.rotate(ue/7*Math.PI*2-Math.PI/2),x.beginPath(),x.moveTo(0,0),x.quadraticCurveTo(30,-10,60,0),x.quadraticCurveTo(30,10,0,0),x.fill(),x.restore();x.restore()}function ee(x,j,Z,oe,ye){x.save(),x.translate(j,Z),x.scale(oe,oe),x.fillStyle=ye.rock,x.beginPath(),x.moveTo(-20,0),x.bezierCurveTo(-20,-15,-10,-25,0,-25),x.bezierCurveTo(10,-25,20,-15,20,0),x.fill(),x.fillStyle="rgba(0,0,0,0.2)",x.beginPath(),x.ellipse(0,0,20,5,0,0,Math.PI*2),x.fill(),x.restore()}function re(x,j,Z,oe,ye){x.save(),x.translate(j,Z),x.scale(oe,oe),x.fillStyle=ye.shell,x.beginPath(),x.arc(0,0,10,Math.PI,0),x.lineTo(0,0),x.fill(),x.strokeStyle=ye.sandDark,x.lineWidth=1,x.beginPath();for(let ue=1;ue<5;ue++){let We=Math.PI+ue/5*Math.PI;x.moveTo(0,0),x.lineTo(Math.cos(We)*10,Math.sin(We)*10)}x.stroke(),x.restore()}function ge(x,j,Z,oe,ye){x.fillStyle=ye.sandDark,x.fillRect(-50,oe,j+100,Z-oe),x.fillStyle=ye.sandDark,x.save(),x.fillStyle=ye.sandLight,x.globalAlpha=.3,x.beginPath(),x.moveTo(-50,Z+100),x.lineTo(-50,oe),x.bezierCurveTo(j*.3,oe-20,j*.7,oe+20,j+50,oe),x.lineTo(j+50,Z+100),x.fill(),x.globalAlpha=.6;let ue=oe+Z*.05;x.beginPath(),x.moveTo(-50,Z+100),x.lineTo(-50,ue),x.bezierCurveTo(j*.4,ue+40,j*.6,ue-10,j+50,ue+20),x.lineTo(j+50,Z+100),x.fill(),x.globalAlpha=1;let We=oe+Z*.15;x.beginPath(),x.moveTo(-50,Z+100),x.lineTo(-50,We),x.bezierCurveTo(j*.2,We-10,j*.8,We+30,j+50,We+10),x.lineTo(j+50,Z+100),x.fill(),x.fillStyle=ye.sandDark,x.globalAlpha=.1,y.forEach(ot=>{x.fillRect(ot.x,ot.y,2,2)}),x.restore()}function Be(x,j,Z,oe=null){let ye=oe||1,ue=!!oe&&oe>5;Y&&!ue&&!ke&&pt("sounds/tsu_beacon_spawn.ogg",{volume:.3+Math.random()*.2}),Q.push({x:ue?j/2:Math.random()*j,y:ue?Z/2:Math.random()*Z,radius:0,maxRadius:ue?Math.max(j,Z)*1.5:(100+Math.random()*400)*ye,speed:ue?40:(5+Math.random()*15)*ye,opacity:1,hue:225+Math.random()*15,life:1})}function ne(x,j,Z,oe=.5,ye=!0){let ue=.1+oe*.7,We=Math.floor(1+oe*4);if(ye&&!ke){for(let ot=0;ot<We;ot++)if(Q.length<50&&Math.random()<ue){let Ie=1+oe*2;Be(x,j,Z,Ie)}}x.save(),x.globalCompositeOperation="lighter";for(let ot=Q.length-1;ot>=0;ot--){let Ie=Q[ot];if(Ie.radius+=Ie.speed,Ie.opacity-=.015,Ie.life-=.015,Ie.opacity<=0||Ie.radius>Ie.maxRadius){Q.splice(ot,1);continue}let Ge=x.createRadialGradient(Ie.x,Ie.y,0,Ie.x,Ie.y,Ie.radius),Vt=Ie.opacity;Ge.addColorStop(0,`hsla(${Ie.hue}, 100%, 80%, ${Vt})`),Ge.addColorStop(.3,`hsla(${Ie.hue}, 100%, 40%, ${Vt*.9})`),Ge.addColorStop(.7,`hsla(${Ie.hue}, 100%, 15%, ${Vt*.6})`),Ge.addColorStop(1,`hsla(${Ie.hue}, 100%, 5%, 0)`),x.fillStyle=Ge,x.beginPath(),x.arc(Ie.x,Ie.y,Ie.radius,0,Math.PI*2),x.fill()}x.restore()}function ve(){if(!$)return;let x=Date.now(),j=x-P;Math.min(j/t,1)>=1&&!F&&(F=!0,r&&r.stop(),i&&i.stop(),n&&n());let oe=5e3,ye=6e3,ue=5e4,We=5e4,ot=5e3,Ie=4e4,Ge=0;j<ye?Ge=0:j<ue?Ge=(j-ye)/(ue-ye):Ge=1;let Vt=0;j>Ie&&(Vt=Math.max(0,(j-Ie)/(ue-Ie))),j>ue&&(Vt=1),Vt>.1&&!i&&(i=pt("sounds/tsu_rumble.ogg",{volume:.8}));let ht={skyTop:_(T.skyTop,C.skyTop,Ge),skyBottom:_(T.skyBottom,C.skyBottom,Ge),sun:_(T.sun,C.sun,Ge),waterDeep:_(T.waterDeep,C.waterDeep,Ge),waterMid:_(T.waterMid,C.waterMid,Ge),waterPeak:_(T.waterPeak,C.waterPeak,Ge),foam:_(T.foam,C.foam,Ge),sandLight:_(T.sandLight,C.sandLight,Ge),sandDark:_(T.sandDark,C.sandDark,Ge),rock:_(T.rock,C.rock,Ge),leaf:_(T.leaf,C.leaf,Ge),shell:_(T.shell,C.shell,Ge)},dn=0,Vn=0;if(Ge>.5||ke){let Ne=(Ge-.5)*2*5+Vt*25;U>0&&(Ne+=50),dn=(Math.random()-.5)*Ne,Vn=(Math.random()-.5)*Ne}A.clearRect(0,0,p,h),M.save(),M.translate(dn,Vn),A.save(),A.translate(dn,Vn);let $t=M.createLinearGradient(0,0,0,h);if($t.addColorStop(0,ht.skyTop),$t.addColorStop(1,ht.skyBottom),M.fillStyle=$t,M.fillRect(-50,-50,p+100,h+100),Ge<1){let Ne=h*.15+Ge*50;M.beginPath(),M.arc(p*.7,Ne,40,0,Math.PI*2),M.fillStyle=ht.sun,M.globalAlpha=1-Ge,M.shadowColor=ht.sun,M.shadowBlur=20,M.fill(),M.globalAlpha=1,M.shadowBlur=0}let _n=h*.65;if(v&&Ge<1){M.save();let Ne=Math.min(p,h)*5e-4,w=300*Ne,k=300*Ne,O=p*.8,N=k*.15,B=_n-k/2+N;M.translate(O,B),M.rotate(.1),M.drawImage(m,-w/2,-k/2,w,k),M.restore()}if(ge(M,p,h,_n,ht),g.forEach(Ne=>{Ne.type==="tree"?de(M,Ne.x,Ne.y,Ne.scale,ht):Ne.type==="rock"?ee(M,Ne.x,Ne.y,Ne.scale,ht):Ne.type==="shell"&&re(M,Ne.x,Ne.y,Ne.scale,ht)}),Ge>.3){let Ne=(Ge-.3)/.7,w=Math.floor(J*Ne);if(A.strokeStyle=`rgba(120, 180, 255, ${.1+Ne*.3})`,A.lineWidth=1+Ne,A.beginPath(),X.length<w)for(let O=0;O<10;O++)X.push({x:Math.random()*p*1.5,y:I,speed:20+Math.random()*20,len:10+Math.random()*20});let k=10+Ne*20;for(let O=0;O<X.length;O++){let N=X[O];N.y+=N.speed,N.x-=k,A.moveTo(N.x,N.y),A.lineTo(N.x-k*.5,N.y+N.len),(N.y>h||N.x<-100)&&(O<w?(N.x=Math.random()*p*1.5,N.y=I):(X.splice(O,1),O--))}A.stroke()}let jr=.3;if(Ge>jr){let Ne=(Ge-jr)/(1-jr),w=le(0,h*1.5,Ne*Ne);A.fillStyle=ht.waterDeep,A.beginPath(),A.moveTo(-50,h+100),A.lineTo(-50,h-w*.3),A.bezierCurveTo(p*.3,h-w*.4,p*.6,h-w*1.2,p+50,h-w*.8),A.lineTo(p+50,h+100),A.fill()}let qo=le(0,h*.5,Ge),Go=le(0,h*1.5,Vt*Vt),vr=h*.85-qo-Go;if(W.forEach((Ne,w)=>{let k;w===q-1?k=ht.waterPeak:w%2===0?k=ht.waterDeep:k=ht.waterMid,A.fillStyle=k,A.beginPath();let O=Ne.amplitudeBase*(1+Ge*2+Vt*5),N=.003+Ge*.005,B=Ne.speedBase*(1+Ge*5+Vt*10),pe=j*B+Ne.offset,me=w*15*(1-Vt),Le=vr+me;A.moveTo(-50,h+100),A.lineTo(-50,Le);for(let Ce=-50;Ce<=p+50;Ce+=15){let Ke=Le+Math.sin(Ce*N+pe)*O+Math.cos(Ce*N*2.3+pe)*(O*.5);A.lineTo(Ce,Ke)}if(A.lineTo(p+50,h+100),A.fill(),w===q-1||Ge>.6&&w>q-3){A.save(),A.globalAlpha=.1+Ge*.3,A.fillStyle=ht.foam,A.beginPath();for(let Ce=-50;Ce<=p+50;Ce+=10){let Ke=Le+Math.sin(Ce*N+pe)*O+Math.cos(Ce*N*2.3+pe)*(O*.5);Math.random()>.5&&(Ke-=5),Ce===-50?A.moveTo(Ce,Ke):A.lineTo(Ce,Ke)}A.lineTo(p+50,h+100),A.lineTo(-50,h+100),A.fill(),A.restore()}}),j<oe){let Ne=1;j>1e3&&(Ne=1-(j-1e3)/(oe-1e3)),A.fillStyle=`rgba(0, 0, 0, ${Ne})`,A.fillRect(-50,-50,p+100,h+100)}if(j>We){let Ne=Math.min(1,(j-We)/ot);A.fillStyle=`rgba(0, 0, 0, ${Ne})`,A.fillRect(-50,-50,p+100,h+100)}if(Y){let Ne=x-ae,w=12e3,k=0,O=!0;Ne<w?k=Ne/w:(k=1,ke||(ke=!0,Be(A,p,h,25),U=60,l||(l=!0,pt("sounds/tsu_explosion.ogg",{volume:1}),s&&s.stop()))),he&&(O=!1),ne(A,p,h,k,O)}if(he){let Ne=x-be,w=Math.min(1,Ne/Oe);A.fillStyle=`rgba(0, 0, 0, ${w})`,A.fillRect(-50,-50,p+100,h+100)}if(U>0){let Ne=U/60,w=Ne*Ne;A.fillStyle=`rgba(255, 255, 255, ${w})`,A.fillRect(-50,-50,p+100,h+100),U--}M.restore(),A.restore(),L=requestAnimationFrame(ve)}function Ue(){$=!1,e.style.cursor="",L&&cancelAnimationFrame(L),window.removeEventListener("resize",G),a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),r&&r.stop(),i&&i.stop(),s&&s.stop()}function Ae(){Y=!0,ae=Date.now(),ke=!1,U=0,s||(s=pt("sounds/tsu_beacon_hum.ogg",{loop:!0,volume:.6}))}function Fe(){he=!0,be=Date.now(),s&&s.stop()}function ce(){e.style.cursor=""}function te(){e.style.cursor="none"}function xe(){s&&(s.stop(),s=null)}return ve(),{cleanup:Ue,triggerBeacons:Ae,triggerFinalFade:Fe,showCursor:ce,hideCursor:te,stopHumLoop:xe}}var b0=De(()=>{Cn()});var Q0={};It(Q0,{canPerformForgeReset:()=>z0,canPerformInfuseReset:()=>K0,computeForgeGoldFromInputs:()=>Cs,computeInfuseMagicFromInputs:()=>Ms,computePendingDnaFromInputs:()=>B0,computePendingForgeGold:()=>W0,computeSurgeWavesFromInputs:()=>P0,getCurrentSurgeLevel:()=>bn,getForgeDebugOverrideState:()=>D0,getInfuseDebugOverrideState:()=>q0,getSurgeBarLevelKey:()=>Zs,getSurgeDebugOverrideState:()=>X0,hasDoneExperimentReset:()=>Y0,hasDoneForgeReset:()=>Ur,hasDoneInfuseReset:()=>Gt,hasDoneSurgeReset:()=>No,initResetPanel:()=>Op,initResetSystem:()=>zo,isExperimentUnlocked:()=>$l,isForgeUnlocked:()=>Gs,isInfuseUnlocked:()=>zu,isSurgeUnlocked:()=>qr,onForgeUpgradeUnlocked:()=>Om,onInfuseUpgradeUnlocked:()=>Pm,onSurgeUpgradeUnlocked:()=>Bm,performForgeReset:()=>Mm,performInfuseReset:()=>Tm,performSurgeReset:()=>km,recomputePendingMagic:()=>Sn,setExperimentResetCompleted:()=>Sm,setForgeDebugOverride:()=>$0,setForgeResetCompleted:()=>ym,setInfuseDebugOverride:()=>H0,setInfuseResetCompleted:()=>vm,setInfuseUnlockedForDebug:()=>G0,setSurgeResetCompleted:()=>bm,setSurgeUnlockedForDebug:()=>V0,shouldBlockBigCoins:()=>Ul,updateResetPanel:()=>qe});function cm(e){return!Hx.includes(e)}function Xx(){pt(Dx,{volume:.4})}function Vx(){pt($x,{volume:.45})}function Yx(){pt(qx,{volume:.5})}function Wx(){pt(Gx,{volume:.8})}function Ul(){return A0}function N0(){let e=Dn(),t=R.waves?.value??at(),n=0n;try{n=ql(e)}catch{}let o=S.pendingWaves,r=Rm(n,t,o),i=!1;r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),A0=i&&!vn()}function Bl(){im=null}function Hu(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"forge",slot:e}}))}catch{}}function Xu(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:e}}))}catch{}}function sm(){let e=S.slot??b();try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge",slot:e}}))}catch{}}function hm(e=null){try{let t=bi(),n=S.pendingGold.clone?.()??S.pendingGold;if(e){let o=e instanceof Tt?e:Tt.fromAny(e??1);if(o.isInfinite?.())return Tt.fromAny("Infinity");n=n.mulBigNumInteger(o)}else n=R.gold?.mult?.applyTo?.(n)??n;return n.mulDecimal(t.toScientific())}catch{return S.pendingGold}}function jx(){for(;no.length;){let e=no.pop();try{e?.()}catch{}}}function rm(){!E0&&typeof gc=="function"&&(E0=gc((e={})=>{e?.key&&e.key!==Re.COINS&&e.key!==Re.WAVES||e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(e?.key===Re.WAVES?(Ku(),qe()):(In(),Sn(),Un()))})),!x0&&typeof Cc=="function"&&(x0=Cc((e={})=>{e?.slot!=null&&S.slot!=null&&e.slot!==S.slot||(In(),Un(),Bo(),qe())}))}function gm(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ee(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Dl(){try{let e=Qe();if(e&&e.xpLevel)return e.xpLevel}catch{}return at()}function R0(e,t){if(!e||typeof e!="object")return at();let n=Ee(e);if(!Number.isFinite(n)&&n>0)return Tt.fromAny("Infinity");let o=Math.max(0,n-5);if(!Number.isFinite(o))return at();let r=ie(o*Math.log10(2)),i=Math.max(0,gm(t)),s=Math.max(0,(i-30)/5),l=s<=0?S0():ie(s*Math.log10(1.4)),a=Math.floor(o),u=a<=0?S0():ie(a*Math.log10(1.15)),f=Tt.fromInt(10);f=f.mulBigNumInteger(r),f=f.mulBigNumInteger(l),f=f.mulBigNumInteger(u);let d=f.floorToInteger();return d.isZero?.()?at():d}function Zx(e,t){if(!e)return at();let n=Ee(e);if(!Number.isFinite(n)&&n>0)return Tt.fromAny("Infinity");let o=Math.max(0,n-12),r=.811078,i=.176091,s=.012837,l=.30103,a=0;if(t&&!t.isZero?.()){let v=Ee(t);Number.isFinite(v)&&(a=Math.max(0,v-4))}let u=o*i,f=Math.floor(o)*s,d=a*l,m=r+u+f+d;return Number.isFinite(m)?ie(m).floorToInteger():Tt.fromAny("Infinity")}function O0(e,t,n=null){let o=Zx(e,t),r=jd(),i;if(n){let s=n instanceof Tt?n:Tt.fromAny(n??1);if(s.isInfinite?.())return Tt.fromAny("Infinity");i=o.mulBigNumInteger(s)}else i=R.magic?.mult?.applyTo?.(o)??o;return i.mulDecimal(r.toScientific())}function Cs(e,t){return R0(e,t)}function Ms(e,t){return O0(e,t)}function P0(e,t,n,o,r){return F0(e,t,n,o,r)}function B0(e,t,n=null){e||(e=at()),t||(t=at());let o=.30103,r=0;if(n!==null?!!n:se(9)){let l=ut();o=Math.log10(2+l*.5),r=30*l}if(se(14))if(se(8)){let l=ut(),a=Math.log10(1414e16);r+=a*l}else r+=Math.log10(1414e16);if(se(17))if(se(8)){let l=ut();r-=5*l}else r-=5;if(se(18))if(se(8)){let l=ut();r-=5*l}else r-=5;let s=o.toFixed(18);try{let l=e.mulDecimal(s,18),u=t.div(c.fromInt(20)).mulDecimal(s,18),f=l.add(u);r>0&&(f=f.add(c.fromAny(r)));let d=0;return f.isInfinite()?d=1/0:d=Number(f.toScientific(10)),ie(d).floorToInteger()}catch{return at()}}function F0(e,t,n,o,r){let i=gm(e);if(i<201)return at();let s=(i-201)/35,l=Ee(t),a=Ee(n),u=Ee(o),f=Ee(r);if(l===Number.POSITIVE_INFINITY||a===Number.POSITIVE_INFINITY||u===Number.POSITIVE_INFINITY||f===Number.POSITIVE_INFINITY)return Tt.fromAny("Infinity");let d=0;Number.isFinite(l)&&l>24&&(d+=(l-24)*Bu),Number.isFinite(a)&&a>13&&(d+=(a-13)*Bu),Number.isFinite(u)&&u>5&&(d+=(u-5)*Bu),Number.isFinite(f)&&f>12&&(d+=(f-12)*Bu);let m=1+d+s;if(se(17)&&(m-=Math.log10(2)),se(18)&&(m-=Math.log10(2)),!Number.isFinite(m))return Tt.fromAny("Infinity");let v=ie(m).floorToInteger();return R.waves?.mult?.applyTo?.(v)??v}function U0(){return Math.max(0,gm(Dl()))}function Dn(){if(S.slot!=null)return S.slot;let e=b();return S.slot=e,e}function ym(e){let t=Dn();if(t!=null){S.hasDoneForgeReset=!!e;try{localStorage.setItem(um(t),S.hasDoneForgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("forge:completed",{detail:{slot:t}}))}catch{}}}function vm(e){let t=Dn();if(t!=null){S.hasDoneInfuseReset=!!e;try{localStorage.setItem(fm(t),S.hasDoneInfuseReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"infuse",slot:t}}))}catch{}}}function bm(e){let t=Dn();if(t!=null){S.hasDoneSurgeReset=!!e;try{localStorage.setItem(dm(t),S.hasDoneSurgeReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"surge_completed",slot:t}}))}catch{}}}function Sm(e){let t=Dn();if(t!=null){S.hasDoneExperimentReset=!!e;try{localStorage.setItem(mm(t),S.hasDoneExperimentReset?"1":"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"experiment_completed",slot:t}}))}catch{}}}function Wu(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Ol(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function D0(e=b()){return Wu(e)}function $0(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.forgeDebugOverride!==n){if(S.forgeDebugOverride=n,n==null)try{localStorage.removeItem(Ol(t))}catch{}else try{localStorage.setItem(Ol(t),n?"1":"0")}catch{}ct(Ol(t)),Hu(),qe()}}function Im(e=b()){if(e==null)return null;try{let t=localStorage.getItem(Pl(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function q0(e=b()){return Im(e)}function G0(e){wm(e)}function H0(e,t=b()){if(t==null)return;let n=e==null?null:!!e;if(S.infuseDebugOverride!==n){if(S.infuseDebugOverride=n,n==null)try{localStorage.removeItem(Pl(t))}catch{}else try{localStorage.setItem(Pl(t),n?"1":"0")}catch{}ct(Pl(t)),Xu(),qe()}}function wm(e){let t=Dn();if(t==null)return;let n=!!e;if(S.infuseUnlocked!==n){S.infuseUnlocked=n;try{localStorage.setItem(qu(t),S.infuseUnlocked?"1":"0")}catch{}ct(qu(t)),Xu()}}function Vu(e){let t=Dn();if(t==null)return;let n=!!e;if(S.forgeUnlocked!==n){S.forgeUnlocked=n;try{localStorage.setItem($u(t),S.forgeUnlocked?"1":"0")}catch{}ct($u(t)),Hu()}}function Em(e=b()){if(e==null)return null;try{let t=localStorage.getItem(k0(e));if(t==="1")return!0;if(t==="0")return!1}catch{}return null}function X0(e=b()){return Em(e)}function V0(e){xm(e)}function xm(e){let t=Dn();if(t==null)return;let n=!!e;if(S.surgeUnlocked!==n){S.surgeUnlocked=n;try{localStorage.setItem(Gu(t),S.surgeUnlocked?"1":"0")}catch{}ct(Gu(t)),sm()}}function am(e){if(e==null){S.forgeUnlocked=!1,S.forgeDebugOverride=null,S.hasDoneForgeReset=!1,S.infuseUnlocked=!1,S.infuseDebugOverride=null,S.hasDoneInfuseReset=!1,S.surgeUnlocked=!1,S.surgeDebugOverride=null,S.hasDoneSurgeReset=!1,S.hasDoneExperimentReset=!1,S.flagsPrimed=!1;return}try{S.forgeUnlocked=localStorage.getItem($u(e))==="1"}catch{S.forgeUnlocked=!1}S.forgeDebugOverride=Wu(e);try{S.hasDoneForgeReset=localStorage.getItem(um(e))==="1"}catch{S.hasDoneForgeReset=!1}try{S.infuseUnlocked=localStorage.getItem(qu(e))==="1"}catch{S.infuseUnlocked=!1}try{S.hasDoneInfuseReset=localStorage.getItem(fm(e))==="1"}catch{S.hasDoneInfuseReset=!1}S.infuseDebugOverride=Im(e);try{S.surgeUnlocked=localStorage.getItem(Gu(e))==="1"}catch{S.surgeUnlocked=!1}S.surgeDebugOverride=Em(e);try{S.hasDoneSurgeReset=localStorage.getItem(dm(e))==="1"}catch{S.hasDoneSurgeReset=!1}try{S.hasDoneExperimentReset=localStorage.getItem(mm(e))==="1"}catch{S.hasDoneExperimentReset=!1}S.flagsPrimed=!0}function xo(){let e=b();if(e==null){S.flagsPrimed=!1;return}S.slot!==e&&(S.slot=e,Bl(),S.flagsPrimed=!1),S.flagsPrimed||am(e)}function L0(e){I0!==e&&(jx(),I0=e,e!=null&&(no.push(kt($u(e),{onChange(t){let n=t==="1";S.forgeUnlocked!==n&&(S.forgeUnlocked=n,Hu(),qe())}})),no.push(kt(um(e),{onChange(t){let n=t==="1";S.hasDoneForgeReset!==n&&(S.hasDoneForgeReset=n,qe())}})),no.push(kt(Ol(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.forgeDebugOverride!==n&&(S.forgeDebugOverride=n,Hu(),qe())}})),no.push(kt(qu(e),{onChange(t){let n=t==="1";S.infuseUnlocked!==n&&(S.infuseUnlocked=n,Xu(),qe())}})),no.push(kt(fm(e),{onChange(t){let n=t==="1";S.hasDoneInfuseReset!==n&&(S.hasDoneInfuseReset=n,qe())}})),no.push(kt(Pl(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.infuseDebugOverride!==n&&(S.infuseDebugOverride=n,Xu(),qe())}})),no.push(kt(Gu(e),{onChange(t){let n=t==="1";S.surgeUnlocked!==n&&(S.surgeUnlocked=n,sm(),qe())}})),no.push(kt(k0(e),{onChange(t){let n=null;t==="1"?n=!0:t==="0"&&(n=!1),S.surgeDebugOverride!==n&&(S.surgeDebugOverride=n,sm(),qe())}})),no.push(kt(dm(e),{onChange(t){let n=t==="1";S.hasDoneSurgeReset!==n&&(S.hasDoneSurgeReset=n,qe())}})),no.push(kt(mm(e),{onChange(t){let n=t==="1";S.hasDoneExperimentReset!==n&&(S.hasDoneExperimentReset=n,qe())}}))))}function Jx(e,t){let n=e?.toStorage?.()??e?.toString?.()??String(e??""),o=t?.toStorage?.()??t?.toString?.()??String(t??"");return`${n}|${o}`}function In(e=!1){let t=R.coins?.value??at(),n=Dl(),o=Jx(t,n);!e&&im===o||(im=o,Lm()?S.pendingGold=R0(t,n):S.pendingGold=at(),qe())}function Sn(e=null){let t=R.coins?.value??at(),n=nr();_m()?S.pendingMagic=O0(t,n,e):S.pendingMagic=at(),Un(),qe()}function Un(){if(!qr()){S.pendingWaves=at(),Bo();return}let e=Dl(),t=R.coins?.value??at(),n=R.gold?.value??at(),o=R.magic?.value??at(),r=nr();S.pendingWaves=F0(e,t,n,o,r),No()||S.pendingWaves.cmp(Tt.fromInt(10))>0&&(S.pendingWaves=Tt.fromInt(10)),Bo(),N0()}function Bo(){if(!$l()){S.pendingDna=at();return}let e=.30103,t=0;if(se(9)){let i=ut();e=Math.log10(2+i*.5),t=30*i}if(se(14))if(se(8)){let i=ut(),s=Math.log10(1414e4);t+=s*i}else t+=Math.log10(1414e4);if(se(17))if(se(8)){let i=ut();t-=5*i}else t-=5;if(se(18))if(se(8)){let i=ut();t-=5*i}else t-=5;let n=e.toFixed(18),o=Zt?Zt():at(),r=Dl();try{let i=o.mulDecimal(n,18),l=r.div(c.fromInt(20)).mulDecimal(n,18),a=i.add(l);t>0&&(a=a.add(c.fromAny(t)));let u=0;a.isInfinite()?u=1/0:u=Number(a.toScientific(10)),S.pendingDna=ie(u).floorToInteger()}catch{try{S.pendingDna=at()}catch{S.pendingDna=at()}}}function lm(){let e=Wu();return e!=null?!!e:S.forgeUnlocked||At(Se.STARTER_COVE,_e.UNLOCK_FORGE)>=1}function Lm(){try{let e=Dl();if(e&&typeof e.cmp=="function")return e.cmp(zx)>=0}catch{}return!1}function _m(){try{let e=yt();if(e&&e.level&&typeof e.level.cmp=="function")return e.level.cmp(Kx)>=0}catch{}return!1}function Gs(){xo();let e=Wu();return e!=null?!!e:!!S.forgeUnlocked||lm()}function zu(){xo();let e=Im();return e!=null?!!e:!!S.infuseUnlocked}function qr(){xo();let e=Em();return e!=null?!!e:!!S.surgeUnlocked}function $l(){return Ly()}function bn(){let e=Dn();return e==null?0n:ql(e)}function Ur(){return xo(),!!S.hasDoneForgeReset}function Gt(){return xo(),!!S.hasDoneInfuseReset}function No(){return xo(),!!S.hasDoneSurgeReset}function Y0(){return xo(),!!S.hasDoneExperimentReset}function W0(){return In(),S.pendingGold.clone?.()??S.pendingGold}function z0(){return!(!Gs()||!Lm()||S.pendingGold.isZero?.())}function K0(){return!(!zu()||!_m()||S.pendingMagic.isZero?.())}function Qx({resetGold:e=!1,resetMagic:t=!1}={}){let n=Mt(Se.STARTER_COVE);for(let o of n){if(!o)continue;let r=o.tieKey||o.tie;r===_e.UNLOCK_XP||r===_e.UNLOCK_FORGE||r===_e.UNLOCK_INFUSE||r===_e.UNLOCK_SURGE||o.costType==="gold"&&!e||o.costType==="magic"&&!t||ur(Se.STARTER_COVE,o.id,0,!0,{resetHmEvolutions:!0})}}function Cm({resetGold:e=!1,resetMagic:t=!1}={}){try{R.coins.set(0)}catch{}try{R.books.set(0)}catch{}try{as({keepUnlock:!0})}catch{}try{tm()}catch{}Qx({resetGold:e,resetMagic:t})}function Mm(){if(!z0())return!1;let e=hm();try{R.gold?.add&&R.gold.add(e)}catch{}if(Cm({resetGold:!1}),In(),Vu(!0),S.hasDoneForgeReset||ym(!0),tn(),$r(),cm("forge"))try{window.spawner?.clearPlayfield?.("forge")}catch{}return qe(),!0}function Tm(){if(!K0())return!1;let e=S.pendingMagic.clone?.()??S.pendingMagic;try{R.magic?.add&&R.magic.add(e)}catch{}Cm({resetGold:!0});try{R.gold.set(0)}catch{}try{let t=b(),n=r=>`ccc:mutation:level:${r}`,o=r=>`ccc:mutation:progress:${r}`;localStorage.setItem(n(t),"0"),localStorage.setItem(o(t),"0"),tn({forceReload:!0})}catch{}if(In(),Sn(),cm("infuse"))try{window.spawner?.clearPlayfield?.("infuse")}catch{}return wm(!0),S.hasDoneInfuseReset||vm(!0),qe(),!0}function Yu(e,{playEffects:t=!0,skipVisuals:n=!1}={}){let o=Dn();try{R.waves?.add&&e&&!e.isZero?.()&&R.waves.add(e)}catch{}Cm({resetGold:!0,resetMagic:!0});try{R.gold.set(0)}catch{}try{R.magic.set(0)}catch{}try{let r=s=>`ccc:mutation:level:${s}`,i=s=>`ccc:mutation:progress:${s}`;localStorage.setItem(r(o),"0"),localStorage.setItem(i(o),"0"),tn({forceReload:!0})}catch{}if(Ku(),xm(!0),S.hasDoneSurgeReset||bm(!0),In(),Sn(),Un(),t&&(n||Yx(),n||n1()),cm("surge"))try{window.spawner?.clearPlayfield?.("surge")}catch{}qe()}function j0(){if(!$l()||(Zt?Zt():at()).cmp(10)<0)return!1;let t=S.pendingDna.clone?.()??S.pendingDna;try{R.DNA?.add&&R.DNA.add(t)}catch{}return Yu(at(),{playEffects:!1}),Wx(),_y([4]),S.hasDoneExperimentReset||Sm(!0),In(),Sn(),Un(),Bo(),qe(),!0}function e1(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:stopMusic")),window.spawner&&typeof window.spawner.stop=="function"&&window.spawner.stop();try{Wv(!0)}catch{}try{bu()}catch{}let e=document.createElement("div");e.id="tsunami-sequence-overlay",e.style.position="fixed",e.style.inset="0",e.style.backgroundColor="black",e.style.zIndex="2147483645",e.style.pointerEvents="all",document.body.appendChild(e),window.__tsunamiActive=!0,tr(!0);let t=document.querySelector(".coin-counter"),n=document.querySelector(".xp-counter"),o=document.querySelector(".mp-counter"),r={coinHTML:t?t.outerHTML:"",xpHTML:n?n.outerHTML:"",mpHTML:o?o.outerHTML:""},i=v0(e,6e4,()=>{i&&i.showCursor&&i.showCursor(),Rv(e,()=>{setTimeout(t1,0)},i)},r);Du=i.cleanup}function t1(){Du&&(Du(),Du=null);let e=document.getElementById("tsunami-sequence-overlay");e&&e.remove(),Yu(c.fromInt(0),{playEffects:!1}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("audio:restartMusic")),window.spawner&&typeof window.spawner.start=="function"&&window.spawner.start(),window.__tsunamiActive=!1;let t=b();if(t!=null)try{localStorage.setItem(`ccc:tsunami:dialoguePending:${t}`,"1")}catch{}}function km(){if(!qr()||U0()<201)return!1;let e=S.pendingWaves.clone?.()??S.pendingWaves;if(e.isZero?.())return!1;let t=Dn(),n=R.waves?.value??at(),o=ql(t),r=Rm(o,n,e),i=!1;return r===1/0?i=!0:typeof r=="bigint"?i=r>=8n:typeof r=="number"&&(i=r>=8),i&&!vn()?(e1(),Yu(e,{playEffects:!1}),!0):(Yu(e,{playEffects:!0}),!0)}function n1(){if(typeof document>"u")return;let e=document.querySelector(".surge-wipe-overlay");e&&e.remove();let t=document.createElement("div");t.className="surge-wipe-overlay";let n=document.createElement("div");n.className="surge-wipe-wave",t.appendChild(n),document.body.appendChild(t),n.offsetWidth,n.classList.add("animate"),n.addEventListener("animationend",()=>{t.remove()},{once:!0}),setTimeout(()=>{document.body.contains(t)&&t.remove()},2e3)}function ql(e){let t=0n;try{let n=localStorage.getItem(pm(e));if(n){if(n==="Infinity")return 1/0;t=BigInt(n)}}catch{}return t===1/0?1/0:t<0n?0n:t}function o1(e){let t=pm(e);return typeof window<"u"&&window.__cccLockedStorageKeys instanceof Set?window.__cccLockedStorageKeys.has(t):!1}function _0(e){if(!(e instanceof Tt)||e.isZero?.()||e.isInfinite?.())return-1n;let t=BigInt(e.e||0);e._eOffset&&(t+=e._eOffset);let n=e.sig.toString(),o=BigInt(n.length-1);return t+o}function Z0(e,t){if(e===1/0||typeof e=="string"&&e==="Infinity")return{level:1/0,remainingWaves:t,changed:!1,safety:0};let n=t.clone?t.clone():t;if(n.isInfinite?.())return{level:1/0,remainingWaves:n,changed:!0,safety:0};let o=e,r=new c(10n,{base:0,offset:o}),i=!1,s=_0(n),l=_0(r);if(s!=-1n&&l!=-1n&&s>l+5n)try{let u=s>0n?s-1n:0n;if(u>o){let f=new c(10n,{base:0,offset:u}),d=f.sub(r).div(c.fromInt(9));n.cmp(d)>=0&&(n=n.sub(d),o=u,i=!0,r=f)}}catch{}let a=0;for(;a<100&&!(n.cmp(r)<0);)n=n.sub(r),o+=1n,i=!0,r=r.mulBigNumInteger(c.fromInt(10)),a++;return{level:o,remainingWaves:n,changed:i,safety:a}}function Ku(){let e=Dn();if(e==null||!qr()||om||o1(e))return;let t=R.waves?.value??at(),n=ql(e);if(n===1/0)return;let o=Z0(n,t);if(o.changed){n=o.level;try{localStorage.setItem(pm(e),n.toString())}catch{}try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:n}}))}catch{}om=!0;try{R.waves.set(o.remainingWaves)}finally{om=!1}qe(),o.safety>=100&&setTimeout(Ku,0)}N0()}function Rl(e){if(e===1/0||e&&(e==="Infinity"||typeof e.isInfinite=="function"&&e.isInfinite()))return'<span class="infinity-symbol">\u221E</span>';let t=e;if(typeof e=="bigint")try{t=Tt.fromInt(e)}catch{}try{return K(t)}catch{return e?.toString?.()??"0"}}function r1(){let n={red:"#d93629",blue:"#4ba7d8"},o=[];for(let a=0;a<8;a++){let u=a/8*120,f=a/8*Math.PI*2,d=50+30*Math.sin(f),m=50+30*Math.sin(f+Math.PI);o.push(`<line x1="${u.toFixed(1)}" y1="${d.toFixed(1)}" x2="${u.toFixed(1)}" y2="${m.toFixed(1)}" stroke="#ffffff" stroke-width="2" />`)}let r=20,i=(a,u,f,d)=>{let m="";for(let v=0;v<=r;v++){let p=v/r,h=a+p*(u-a),g=h/(Math.PI*2)*120,y=50+30*Math.sin(h+d);m+=(v===0?"M":"L")+` ${g.toFixed(1)} ${y.toFixed(1)}`}return`<path d="${m}" stroke="${f}" stroke-width="6" fill="none" stroke-linecap="butt" />`},s=.2;o.push(i(-s,Math.PI/2+s,n.blue,Math.PI)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.blue,Math.PI)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.red,0)),o.push(i(-s,Math.PI/2+s,n.red,0)),o.push(i(3*Math.PI/2-s,2*Math.PI+s,n.red,0)),o.push(i(Math.PI/2-s,3*Math.PI/2+s,n.blue,Math.PI));let l=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" width="120" height="100" preserveAspectRatio="none">${o.join("")}</svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}function i1(e){e.innerHTML=`<div class="merchant-reset"><aside class="merchant-reset__sidebar"><button type="button" class="merchant-reset__layer" data-reset-layer="forge"><img src="${Px}" alt=""><span>Forge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="infuse" style="display:none"><img src="${Bx}" alt=""><span>Infuse</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="surge" style="display:none"><img src="${Fx}" alt=""><span>Surge</span></button><button type="button" class="merchant-reset__layer" data-reset-layer="experiment" style="display:none"><img src="${Ux}" alt=""><span>Experiment</span></button></aside><div class="merchant-reset__list"><div class="merchant-reset__card merchant-reset__main" id="reset-card-forge"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Forge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="forge"> Resets Coins, Books, XP, Coin upgrades, and Book upgrades for Gold<br> Increase pending Gold amount by increasing Coins and XP Level<br> The button below shows how much Gold you will get upon reset </p></div><div class="merchant-reset__status" data-reset-status="forge"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="forge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${C0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="forge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-infuse" id="reset-card-infuse" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Infuse</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="infuse"> Resets everything Forge does as well as Gold, MP, and Gold upgrades for Magic<br> Increase pending Magic amount by increasing Coins and MP </p></div><div class="merchant-reset__status" data-reset-status="infuse"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="infuse"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${M0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="infuse">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-surge" id="reset-card-surge" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Surge</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="surge"> Resets everything Infuse does as well as Magic and Magic upgrades for Waves<br> Increase pending Wave amount by increasing Coins, XP Level, Gold, MP, and Magic<br> Waves cannot be spent on upgrades, rather they are only useful for filling a bar<br> Each time you fill this bar below, obtain powerful bonuses from Surge milestones<br> Multiple milestones may be obtained in one reset, but Wave requirement scales 10x each fill </p></div><div class="merchant-reset__status" data-reset-status="surge"></div><div class="merchant-reset__bar-container"><div class="merchant-reset__bar-wrapper"><div class="merchant-reset__bar-fill" data-reset-bar-fill="surge"></div><span class="merchant-reset__bar-text" data-reset-bar-text="surge">0 / 10</span></div></div><div class="surge-header">You are at Surge <span class="surge-level-display" data-surge-level>0</span></div><div class="surge-milestone-wrapper"><div class="surge-milestone-container" data-reset-milestones="surge"></div></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="surge"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${Uu}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="surge">0</span></button></div></div></div><div class="merchant-reset__card merchant-reset__main is-experiment" id="reset-card-experiment" style="display:none"><div class="merchant-reset__layout"><header class="merchant-reset__header"><div class="merchant-reset__titles"><h3>Experiment</h3></div></header><div class="merchant-reset__content"><div class="merchant-reset__titles"><p data-reset-desc="experiment"> Resets everything Surge does as well as the entire Lab for DNA<br> Increase pending DNA amount by increasing Lab Level and XP Level<br> ${Je?"Tap":"Click"} the button below to access DNA upgrades </p></div><div class="merchant-reset__status" data-reset-status="experiment"></div><div class="dna-btn-container"></div></div><div class="merchant-reset__actions"><button type="button" class="merchant-reset__action" data-reset-action="experiment"><span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${T0}" alt=""></span><span class="merchant-reset__action-amount" data-reset-pending="experiment">0</span></button></div></div></div></div><div class="merchant-reset__spacer"></div></div>`,S.panel=e,S.elements.forge.card=e.querySelector("#reset-card-forge"),S.elements.forge.status=e.querySelector('[data-reset-status="forge"]'),S.elements.forge.btn=e.querySelector('[data-reset-action="forge"]'),S.elements.forge.pending=e.querySelector('[data-reset-pending="forge"]'),S.elements.infuse.card=e.querySelector("#reset-card-infuse"),S.elements.infuse.status=e.querySelector('[data-reset-status="infuse"]'),S.elements.infuse.btn=e.querySelector('[data-reset-action="infuse"]'),S.elements.infuse.pending=e.querySelector('[data-reset-pending="infuse"]'),S.elements.surge.card=e.querySelector("#reset-card-surge"),S.elements.surge.status=e.querySelector('[data-reset-status="surge"]'),S.elements.surge.btn=e.querySelector('[data-reset-action="surge"]'),S.elements.surge.barFill=e.querySelector('[data-reset-bar-fill="surge"]'),S.elements.surge.barText=e.querySelector('[data-reset-bar-text="surge"]'),S.elements.surge.milestones=e.querySelector('[data-reset-milestones="surge"]'),S.elements.surge.headerVal=e.querySelector("[data-surge-level]"),S.elements.surge.header=e.querySelector(".surge-header"),S.elements.experiment.card=e.querySelector("#reset-card-experiment"),S.elements.experiment.status=e.querySelector('[data-reset-status="experiment"]'),S.elements.experiment.btn=e.querySelector('[data-reset-action="experiment"]');let t=e.querySelector(".surge-milestone-wrapper");if(S.elements.surge.milestones&&t&&Os(e,t,'[data-reset-milestones="surge"]',{orientation:"horizontal"}),typeof IntersectionObserver<"u"){let o=new IntersectionObserver(r=>{r.forEach(i=>{let s=i.target,l=i.isIntersecting;s===S.elements.forge.card?(S.visible.forge=l,l&&Am()):s===S.elements.infuse.card?(S.visible.infuse=l,l&&Nm()):s===S.elements.surge.card?(S.visible.surge=l,l&&Fl()):s===S.elements.experiment.card?(S.visible.experiment=l,l&&J0()):s===S.elements.surge.milestones&&(S.visible.surgeMilestones=l,l&&Fl())})},{threshold:0});S.elements.forge.card&&o.observe(S.elements.forge.card),S.elements.infuse.card&&o.observe(S.elements.infuse.card),S.elements.surge.card&&o.observe(S.elements.surge.card),S.elements.experiment.card&&o.observe(S.elements.experiment.card),S.elements.surge.milestones&&o.observe(S.elements.surge.milestones)}else S.visible.forge=!0,S.visible.infuse=!0,S.visible.surge=!0,S.visible.experiment=!0,S.visible.surgeMilestones=!0;S.layerButtons={forge:e.querySelector('[data-reset-layer="forge"]'),infuse:e.querySelector('[data-reset-layer="infuse"]'),surge:e.querySelector('[data-reset-layer="surge"]'),experiment:e.querySelector('[data-reset-layer="experiment"]')},Object.entries(S.layerButtons).forEach(([o,r])=>{if(!r)return;let i=null,s=l=>{if(l&&l.isTrusted&&fo(r))return;let a=S.elements[o]?.card;if(a){let u=a.closest(".merchant-content");o==="forge"&&u?u.scrollTo({top:0,behavior:"smooth"}):a.scrollIntoView({behavior:"smooth",block:"start"})}};r.addEventListener("click",l=>{if(i&&i!=="mouse"){i=null;return}i=null,s(l)})}),S.elements.forge.btn&&S.elements.forge.btn.addEventListener("click",()=>{Mm()&&(Xx(),qe())}),S.elements.infuse.btn&&S.elements.infuse.btn.addEventListener("click",()=>{Tm()&&(Vx(),qe())}),S.elements.surge.btn&&S.elements.surge.btn.addEventListener("click",()=>{km()&&qe()}),S.elements.experiment.btn&&S.elements.experiment.btn.addEventListener("click",()=>{j0()&&qe()});let n=e.querySelector(".dna-btn-container");if(n){n.innerHTML='<button class="btn-dna-shop"><div class="dna-btn-bg"></div><div class="dna-label">DNA</div></button>';let o=n.querySelector(".btn-dna-shop"),r=o.querySelector(".dna-btn-bg"),i=r1();r&&(r.style.backgroundImage=`url("${i}")`,r.style.backgroundSize="120px 100%"),o.addEventListener("click",()=>{Ns("dna")});let s=()=>{if(!o.offsetParent)return;let l=document.querySelector(".hud-bottom [data-btn=stats]");if(l&&o){let a=l.getBoundingClientRect(),u=`${a.width}px`,f=`${a.height}px`;o.style.width!==u&&(o.style.width=u),o.style.height!==f&&(o.style.height=f),o.style.minWidth!=="0"&&(o.style.minWidth="0"),o.style.maxWidth!=="none"&&(o.style.maxWidth="none")}};if(typeof IntersectionObserver<"u"&&new IntersectionObserver(a=>{a.forEach(u=>{u.isIntersecting?(r&&r.style.animationPlayState!=="running"&&(r.style.animationPlayState="running"),s()):r&&r.style.animationPlayState!=="paused"&&(r.style.animationPlayState="paused")})},{threshold:.1}).observe(e),typeof ResizeObserver<"u"){let l=new ResizeObserver(s),a=document.querySelector(".hud-bottom");a&&l.observe(a),window.addEventListener("resize",s),requestAnimationFrame(s)}else window.addEventListener("resize",s),requestAnimationFrame(s)}qe()}function Op(e){!e||e.__resetInit||(e.__resetInit=!0,i1(e))}function Fo(e,t,n,o){if(!e)return;let{disabled:r,msg:i}=t;e.disabled!==r&&(e.disabled=r);let s=i?"msg":"action",l=e.dataset.mode;if(s==="msg"){(l!=="msg"||e.textContent!==i)&&(e.innerHTML=`<span class="merchant-reset__req-msg">${i}</span>`,e.dataset.mode="msg");return}let a=Rl(o);if(l!=="action")e.innerHTML=`<span class="merchant-reset__action-plus">+</span><span class="merchant-reset__action-icon"><img src="${n}" alt=""></span><span class="merchant-reset__action-amount">${a}</span>`,e.dataset.mode="action";else{let u=e.querySelector(".merchant-reset__action-amount");u&&u.innerHTML!==a&&(u.innerHTML=a);let f=e.querySelector(".merchant-reset__action-icon img");f&&!f.src.includes(n)&&(f.src=n)}}function Am({goldMult:e=null}={}){let t=S.elements.forge;if(!(!t.card||!t.btn)){if(!Gs()){if(!S.visible.forge)return;Fo(t.btn,{disabled:!0,msg:"Unlock the Forge upgrade to access resets"});return}if(S.visible.forge){if(xo(),t.card.classList.toggle("is-forge-complete",!!S.hasDoneForgeReset),t.status)if(S.hasDoneForgeReset)t.status.innerHTML!==""&&(t.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Forging for the first time will unlock new Shop upgrades, a new Merchant dialogue, and <strong style="color:#ffb347; text-shadow: 0 3px 6px rgba(0,0,0,0.55); ">Mutations</strong><br> Mutated Coins yield more Coin and XP value than normal </span>'.trim();t.status.innerHTML.includes("Mutations")||(t.status.innerHTML=n)}if(!Lm()){Fo(t.btn,{disabled:!0,msg:"Reach XP Level 31 to perform a Forge reset"});return}Fo(t.btn,{disabled:!1},C0,hm(e))}}}function Nm(){let e=S.elements.infuse;if(!(!e.card||!e.btn)){if(!zu()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="none"&&(S.layerButtons.infuse.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.infuse&&S.layerButtons.infuse.style.display!=="flex"&&(S.layerButtons.infuse.style.display="flex"),!!S.visible.infuse){if(xo(),e.card.classList.toggle("is-complete",!!S.hasDoneInfuseReset),e.status)if(S.hasDoneInfuseReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let t='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Infusing for the first time will unlock new Shop upgrades, a new Merchant dialogue, and a new tab: <strong style="color:#c68cff">Workshop</strong><br> This new tab will allow you to passively generate Gears<br> Spend Gears on new upgrades in the Shop to automate various things </span>'.trim();e.status.innerHTML.includes("Workshop")||(e.status.innerHTML=t)}if(!_m()){Fo(e.btn,{disabled:!0,msg:"Reach Mutation Level 7 to perform an Infuse reset"});return}Fo(e.btn,{disabled:!1},M0,S.pendingMagic)}}}function Rm(e,t,n){let o=t.add(n);return Z0(e,o).level}function Fl(){let e=S.elements.surge;if(!e.card||!e.btn)return;if(!qr()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="none"&&(S.layerButtons.surge.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.surge&&S.layerButtons.surge.style.display!=="flex"&&(S.layerButtons.surge.style.display="flex"),!S.visible.surge)return;xo();let t=Dn(),n=R.waves?.value??at(),o=0n;try{o=ql(t)}catch{}let r;o===1/0?r=c.fromAny("Infinity"):r=new c(10n,{base:0,offset:o});let i=0;if(n?.isInfinite?.())i=100;else if(n&&r&&!r.isZero?.())if(r.isInfinite?.())i=0;else try{let s=n.div(r),l=Number(s.toScientific?.()??"0");i=Math.min(100,Math.max(0,l*100))}catch{i=0}if(e.barFill&&(e.barFill.style.width=`${i}%`),e.header){let s=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity",l=s?'<span class="surge-infinity-symbol">\u221E</span>':Rl(o),a=`You are at Surge <span class="surge-level-display" data-surge-level>${l}</span>`;if(!s){let u=S.pendingWaves;if(u&&!u.isZero?.()){let f=Rm(o,n,u),d=!1;if(f===1/0)d=!0;else try{d=f>o}catch{}if(d){let m=f===1/0?'<span class="surge-infinity-symbol">\u221E</span>':Rl(f);a=`Your Surge will increase from <span class="surge-level-display">${l}</span> to <span class="surge-level-display">${m}</span>`}}}e.header.innerHTML!==a&&(e.header.innerHTML=a,e.headerVal=e.header.querySelector("[data-surge-level]"))}else if(e.headerVal){let l=o===1/0||typeof o.isInfinite=="function"&&o.isInfinite()||String(o)==="Infinity"?'<span class="surge-infinity-symbol">\u221E</span>':o.toString();e.headerVal.innerHTML!==l&&(e.headerVal.innerHTML=l)}if(e.barText&&(e.barText.innerHTML=`<span class="wave-bar-nums"><img src="${Uu}">${Rl(n)} / <img src="${Uu}">${Rl(r)}</span>`),e.milestones&&S.visible.surgeMilestones){let s=g0(o),l=Array.from(e.milestones.children);for(s.forEach((a,u)=>{let f=BigInt(a.surgeLevel)<=o,d=f?"is-reached":"",m=a.description.map(M=>M.includes("Invokes the Tsunami")&&!f?`<div class="tsunami-text">- ${M}</div>`:`<div>- ${M}</div>`).join("");if(f&&a.surgeLevel===3){let M=Ar?Ar():Tt.fromInt(0);m+=`<div style="color:#02e815">- Current Books/sec: ${K(M.floorToInteger())}</div>`}if(f&&a.surgeLevel===6){let M=eu();m=`<div>- Unspent Coins boost Coins: <span style="color:#00e5ff">${Te(M.coins)}x</span></div><div>- Unspent Books boost Coins: <span style="color:#00e5ff">${Te(M.books)}x</span></div><div>- Unspent Gold boosts Coins: <span style="color:#00e5ff">${Te(M.gold)}x</span></div><div>- Unspent Magic boosts Coins: <span style="color:#00e5ff">${Te(M.magic)}x</span></div>`}if(f&&a.surgeLevel===13){let G=2*(ut()*1.5-.5)-2,P=ie(G),L=hm().mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Gold/sec: ${K(L.floorToInteger())}</div>`}if(f&&a.surgeLevel===16){let G=2*(ut()*1.5-.5)-2,P=ie(G),$=S.pendingMagic.mulDecimal(P.toScientific());m+=`<div style="color:#02e815">- Current Magic/sec: ${K($.floorToInteger())}</div>`}let v=!1;(o===1/0||typeof o=="string"&&o==="Infinity"||typeof o.isInfinite=="function"&&o.isInfinite()||typeof o=="bigint"&&o>=8n||typeof o=="number"&&o>=8)&&(v=!0);let p=ut(),h=!1;f&&v&&p<1&&nm.includes(a.id)&&(h=!0);let g=h?" is-nerfed":"",y=l[u];if(!y)y=document.createElement("div"),y.className=`surge-milestone-item ${d}${g}`,y.dataset.isReached=String(f),y.innerHTML=`<div class="surge-milestone-nerf-arrow" style="display:none"></div><div class="surge-milestone-title">Surge ${a.surgeLevel}</div><div class="surge-milestone-desc"></div><div class="surge-milestone-title" style="visibility:hidden">Surge ${a.surgeLevel}</div>`,e.milestones.appendChild(y);else{y.className!==`surge-milestone-item ${d}${g}`&&(y.className=`surge-milestone-item ${d}${g}`);let M=String(f);y.dataset.isReached!==M&&(y.dataset.isReached=M)}let I=y.querySelector(".surge-milestone-desc");I&&I.innerHTML!==m&&(I.innerHTML=m);let E=y.querySelector(".surge-milestone-nerf-arrow");if(E){let M=!1;v&&p<1&&nm.includes(a.id)&&(M=!0);let A=M?"":"none";E.style.display!==A&&(E.style.display=A)}});e.milestones.children.length>s.length;)e.milestones.lastChild.remove();requestAnimationFrame(()=>{e.milestones&&e.milestones.__customScroll&&typeof e.milestones.__customScroll.update=="function"&&e.milestones.__customScroll.update()}),S.lastRenderedSurgeLevel!==o&&(S.lastRenderedSurgeLevel=o,e.milestones&&(e.milestones.dataset.scrolled="0")),e.milestones.dataset.scrolled!=="1"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!e.milestones||e.milestones.offsetParent===null)return;let a=e.milestones.querySelectorAll('.surge-milestone-item[data-is-reached="true"]');if(a.length>0){let u=a[a.length-1],f=e.milestones.children;u===f[f.length-1]?e.milestones.scrollTo({left:e.milestones.scrollWidth,behavior:"smooth"}):e.milestones.scrollTo({left:u.offsetLeft-12,behavior:"smooth"}),e.milestones.dataset.scrolled="1"}})})}if(e.card.classList.toggle("is-complete",!!S.hasDoneSurgeReset),e.status)if(S.hasDoneSurgeReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let s='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Surging for the first time will unlock a new Merchant dialogue and a new tab: <span style="color:#00e5ff"><strong>Warp</strong></span><br> Warps may speed up gameplay a bit, so definitely check them out<br> You can only get 10 Waves on your first Surge, so you should do it immediately </span>'.trim();e.status.innerHTML.includes("Warp")||(e.status.innerHTML=s)}if(U0()<201){Fo(e.btn,{disabled:!0,msg:"Reach XP Level 201 to perform a Surge reset"});return}if(S.pendingWaves.isZero?.()){Fo(e.btn,{disabled:!0,msg:"Collect more coins/resources to earn Waves from a Surge reset"});return}Fo(e.btn,{disabled:!1},Uu,S.pendingWaves)}function J0(){let e=S.elements.experiment;if(!e.card||!e.btn)return;if(!$l()){e.card.style.display!=="none"&&(e.card.style.display="none"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="none"&&(S.layerButtons.experiment.style.display="none");return}if(e.card.style.display!=="flex"&&(e.card.style.display="flex"),S.layerButtons.experiment&&S.layerButtons.experiment.style.display!=="flex"&&(S.layerButtons.experiment.style.display="flex"),!S.visible.experiment)return;if(xo(),e.card.classList.toggle("is-complete",!!S.hasDoneExperimentReset),e.status)if(S.hasDoneExperimentReset)e.status.innerHTML!==""&&(e.status.innerHTML="");else{let n='<span style="color:#02e815; text-shadow: 0 3px 6px rgba(0,0,0,0.55);"> Experimenting for the first time will unlock new Lab nodes </span>'.trim();e.status.innerHTML!==n&&(e.status.innerHTML=n)}if((Zt?Zt():at()).cmp(10)<0){Fo(e.btn,{disabled:!0,msg:"Reach Lab Level 10 to perform an Experiment reset"});return}Fo(e.btn,{disabled:!1},T0,S.pendingDna)}function qe({goldMult:e=null}={}){S.panel&&(Am({goldMult:e}),Nm(),Fl(),J0())}function Om(){zo(),Vu(!0),qe()}function Pm(){zo(),wm(!0),qe()}function Bm(){zo(),xm(!0),qe()}function s1(){if(!S.panel)return;let e=S.panel.closest(".merchant-overlay");if(!e||!e.classList.contains("is-open")||!S.panel.classList.contains("is-active")||!S.elements.surge.barFill)return;let t=S.elements.surge.barFill,n=t.parentElement;n&&(n.classList.remove("surge-bar-pulse"),t.style.transition="none",t.style.width="100%",t.offsetWidth,n.classList.add("surge-bar-pulse"),t.style.transition="width 0.5s ease-out",Fl(),n.addEventListener("animationend",()=>{n.classList.remove("surge-bar-pulse"),t.style.transition="",Fl()},{once:!0}))}function a1(){typeof window>"u"||(window.addEventListener("menu:scrollStop",()=>{qe()}),window.addEventListener("surge:level:change",()=>{s1()}),window.addEventListener("currency:change",e=>{e.detail?.key==="coins"&&(In(),Sn(),Un()),e.detail?.key==="waves"&&(Ku(),qe()),(e.detail?.key==="gold"||e.detail?.key==="magic"||e.detail?.key==="books")&&(Un(),qe())}),window.addEventListener("surge:bookResidue",()=>{if(S.panel&&S.panel.offsetParent!==null){let e=S.elements.surge.card;e&&e.style.display!=="none"&&qe()}}),window.addEventListener("currency:multiplier",e=>{let t=e?.detail;if(t){if(t.key===Re.GOLD){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;In(!0);let n=t.mult instanceof c?t.mult:Tt.fromAny(t.mult??1);S.panel&&Am({goldMult:n});return}if(t.key===Re.MAGIC){if(t.slot!=null&&S.slot!=null&&t.slot!==S.slot)return;let n=t.mult instanceof c?t.mult:Tt.fromAny(t.mult??1);Sn(n),S.panel&&Nm();return}}}),window.addEventListener("xp:change",()=>{In(),Un(),Bo(),qe()}),window.addEventListener("mutation:change",()=>{Sn(),Un(),qe()}),window.addEventListener("debug:change",e=>{e?.detail?.slot!=null&&S.slot!=null&&e.detail.slot!==S.slot||(Bl(),In(!0),Sn(),Un(),Bo(),qe())}),window.addEventListener("lab:level:change",()=>{Bo(),qe()}),window.addEventListener("lab:node:change",()=>{Sn(),qe()}))}function zo(){if(w0){S.slot=b(),Bl(),rm(),In(!0),Sn(),Un(),Bo();return}try{tn()}catch{return}w0=!0;let e=b();if(S.slot=e,Bl(),am(e),S.hasDoneForgeReset&&!Po())try{$r()}catch{}if(!S.forgeUnlocked&&lm()&&Vu(!0),L0(e),rm(),a1(),In(!0),Sn(),Un(),Bo(),Fu){try{Fu()}catch{}Fu=null}Fu=Ri(()=>{let t=Fm();if(typeof window<"u"&&window.spawner&&typeof window.spawner.setCoinSprite=="function")try{window.spawner.setCoinSprite(t)}catch{}}),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let t=b();if(S.slot=t,Bl(),am(t),S.hasDoneForgeReset&&!Po())try{$r()}catch{}!S.forgeUnlocked&&lm()&&Vu(!0),L0(t),rm(),In(!0),Sn(),Un(),Bo(),qe()})}var Tt,Bu,at,S0,C0,M0,T0,Px,Bx,Fx,Ux,Uu,Dx,$x,qx,Gx,Hx,$u,um,Ol,qu,fm,Pl,Gu,k0,dm,Zs,pm,mm,zx,Kx,om,A0,S,no,I0,w0,Fu,im,E0,x0,Du,mo=De(()=>{xt();vo();vt();qt();An();ho();go();fs();rl();y0();gi();Cn();yn();Jo();hi();qs();b0();Tt=c,Bu=Math.log10(1.1),at=()=>Tt.fromInt(0),S0=()=>Tt.fromInt(1),C0="img/currencies/gold/gold.webp",M0="img/currencies/magic/magic.webp",T0="img/currencies/dna/dna.webp",Px="img/misc/forge.webp",Bx="img/misc/infuse.webp",Fx="img/misc/surge.webp",Ux="img/misc/experiment.webp",Uu="img/currencies/wave/wave.webp",Dx="sounds/forge_reset.ogg",$x="sounds/infuse_reset.ogg",qx="sounds/surge_reset.ogg",Gx="sounds/experiment_reset.ogg",Hx=[];$u=e=>`ccc:reset:forge:${e}`,um=e=>`ccc:reset:forge:completed:${e}`,Ol=e=>`ccc:debug:forgeUnlocked:${e}`,qu=e=>`ccc:reset:infuse:${e}`,fm=e=>`ccc:reset:infuse:completed:${e}`,Pl=e=>`ccc:debug:infuseUnlocked:${e}`,Gu=e=>`ccc:reset:surge:${e}`,k0=e=>`ccc:debug:surgeUnlocked:${e}`,dm=e=>`ccc:reset:surge:completed:${e}`,Zs=e=>`ccc:reset:surge:barLevel:${e}`,pm=Zs,mm=e=>`ccc:reset:experiment:completed:${e}`,zx=Tt.fromInt(31),Kx=Tt.fromInt(7),om=!1,A0=!1;S={slot:null,forgeUnlocked:!1,forgeDebugOverride:null,hasDoneForgeReset:!1,infuseUnlocked:!1,infuseDebugOverride:null,hasDoneInfuseReset:!1,surgeUnlocked:!1,surgeDebugOverride:null,hasDoneSurgeReset:!1,hasDoneExperimentReset:!1,pendingGold:at(),pendingMagic:at(),pendingWaves:at(),pendingDna:at(),panel:null,visible:{forge:!1,infuse:!1,surge:!1,experiment:!1,surgeMilestones:!1},elements:{forge:{card:null,status:null,btn:null},infuse:{card:null,status:null,btn:null},surge:{card:null,status:null,btn:null,bar:null,barFill:null,barText:null,milestones:null,headerVal:null},experiment:{card:null,status:null,btn:null}},layerButtons:{},flagsPrimed:!1,lastRenderedSurgeLevel:null},no=[],I0=null,w0=!1,Fu=null,im=null,E0=null,x0=null;Du=null;typeof window<"u"&&(window.resetSystem=window.resetSystem||{},Object.assign(window.resetSystem,{initResetSystem:zo,performForgeReset:Mm,performInfuseReset:Tm,performSurgeReset:km,performExperimentReset:j0,computePendingForgeGold:W0,computeForgeGoldFromInputs:Cs,computeInfuseMagicFromInputs:Ms,computeSurgeWavesFromInputs:P0,computePendingDnaFromInputs:B0,getForgeDebugOverrideState:D0,hasDoneForgeReset:Ur,isForgeUnlocked:Gs,setForgeDebugOverride:$0,setForgeResetCompleted:ym,updateResetPanel:qe,isInfuseUnlocked:zu,setInfuseDebugOverride:H0,getInfuseDebugOverrideState:q0,recomputePendingMagic:Sn,setInfuseUnlockedForDebug:G0,setInfuseResetCompleted:vm,hasDoneInfuseReset:Gt,isSurgeUnlocked:qr,setSurgeUnlockedForDebug:V0,getSurgeDebugOverrideState:X0,setSurgeResetCompleted:bm,hasDoneSurgeReset:No,getCurrentSurgeLevel:bn,shouldBlockBigCoins:Ul,hasDoneExperimentReset:Y0,setExperimentResetCompleted:Sm,isExperimentUnlocked:$l}))});var xb={};It(xb,{AREA_KEYS:()=>Se,HM_EVOLUTION_INTERVAL:()=>Xt,MAX_LEVEL_DELTA:()=>sa,REGISTRY:()=>pf,UPGRADE_TIES:()=>_e,approxLog10BigNum:()=>Ee,batchUpgradeOperations:()=>Hl,bigNumFromLog10:()=>ie,buyCheap:()=>Ll,buyMax:()=>xl,buyOne:()=>Hs,buyTowards:()=>Xs,clearPermanentUpgradeUnlock:()=>nh,computeDefaultUpgradeCost:()=>oh,computeHmMultipliers:()=>Ko,computeUpgradeEffects:()=>hs,costToBuyOne:()=>A1,ensureLevelBigNum:()=>gt,estimateFlatBulk:()=>Km,estimateGeometricBulk:()=>_1,evaluateBulkPurchase:()=>Mi,evolveUpgrade:()=>Lu,formatMultForUi:()=>Te,getCurrentAreaKey:()=>eo,getHmEvolutions:()=>Jm,getHmNextMilestoneLevel:()=>N1,getIconUrl:()=>Cu,getLevel:()=>Nn,getLevelNumber:()=>At,getMagnetLevel:()=>Dc,getMpValueMultiplierBn:()=>Uc,getUpgrade:()=>ua,getUpgradeLockState:()=>Ro,getUpgradeStorageKey:()=>Pi,getUpgradesForArea:()=>Mt,levelBigNumToNumber:()=>Ve,log10OnePlusPow10:()=>Yf,markUpgradePermanentlyUnlocked:()=>Oi,normalizeBigNum:()=>R1,normalizeUpgradeIconPath:()=>_u,normalizedUpgradeLevel:()=>of,onUpgradesChanged:()=>Od,peekNextPrice:()=>Eb,performFreeAutobuy:()=>zd,safeMultiplyBigNum:()=>bt,setLevel:()=>ur,syncBookCurrencyMultiplierFromUpgrade:()=>Ja,upgradeUiModel:()=>Vs});function ju(){Gr.size!==0&&(Gr.forEach(({areaKey:e,upgId:t,state:n,slot:o},r)=>{try{let i=JSON.stringify(n);localStorage.setItem(r,i);try{ct(r,i)}catch{}}catch(i){console.warn("Failed to save deferred upgrade state",e,t,i)}}),Gr.clear())}function c1(){if(!(typeof window>"u")&&!tb){tb=setInterval(ju,2e3);try{window.addEventListener("beforeunload",ju)}catch{}try{window.addEventListener("pagehide",ju)}catch{}try{document.addEventListener("visibilitychange",()=>{document.hidden&&ju()})}catch{}}}function Hl(e){if(ea)return e();ea=!0;try{return e()}finally{ea=!1,Gl.forEach(({areaKey:t,upgId:n,state:o,slot:r})=>{try{na(t,n,o,r)}catch(i){console.warn("Deferred upgrade save failed",i)}}),Gl.clear(),eb.forEach(({areaKey:t,stateArr:n,slot:o})=>{try{k1(t,n,o)}catch(r){console.warn("Deferred area save failed",r)}}),eb.clear(),Hm&&(Hm=!1,io())}}function u1(e){try{let t=ca(e);if(!t)return!1;if(t.ratioMinus1>0)return!0;let n=c.fromAny(e.costAtLevel?.(0)??0),o=c.fromAny(e.costAtLevel?.(1)??0),r=c.fromAny(e.costAtLevel?.(32)??0);return!(n.cmp(o)===0&&n.cmp(r)===0)}catch{return!1}}function rb(e,t){if(!u1(e))return!1;try{let n=t?.clone?t:c.fromAny(t??0);if(n.isInfinite?.())return!0;let o=Ee(n);return Number.isFinite(o)&&o>=f1}catch{return!1}}function ta(e,{allowEmpty:t=!1}={}){if(typeof e!="string")return e;let n=e.trim();if(!n)return t?"":"0";if(n.length>Um)return"Infinity";if(n.startsWith("BN:")){let o=n.slice(n.lastIndexOf(":")+1),r=o.indexOf("^"),i=r>=0?o.slice(0,r):o;if(o.length>Um/2||i.length>Um/2)return"Infinity"}return n}function Ju(e){return y1[e]??0}function Dm(e){return!e||e.locked===!1?"unlocked":e.hidden?"mysterious":"locked"}function aa(e,t){let n=pr(e||t?.area);if(!n)return null;let o=mr(t?.tie??t?.tieKey);if(o)return`${n}:${o}`;let r=ro(t?.id),i="";if(typeof r=="number"){if(!Number.isFinite(r))return null;i=String(Math.trunc(r))}else if(typeof r=="string"){let s=r.trim();if(!s)return null;i=s}else return null;return`${n}:${i}`}function Xl(e,t){let n=pr(e||t?.area);if(!n)return null;let o=ro(t?.id);if(o==null)return null;if(typeof o=="number")return Number.isFinite(o)?`${n}:${Math.trunc(o)}`:null;let r=String(o).trim();return r?`${n}:${r}`:null}function Js(e,t,n){return!e||!e.upgrades||typeof e.upgrades!="object"||!t||!n||t===n||e.upgrades[n]||!e.upgrades[t]?!1:(e.upgrades[n]=e.upgrades[t],delete e.upgrades[t],!0)}function Ym(e=b()){let t=String(e??"default");if(ef.has(t))return ef.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${ab}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),ef.set(t,n),n}function Wm(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),ef.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${ab}:${n}`,JSON.stringify(e))}catch{}}function uf(e=b()){let t=String(e??"default");if(tf.has(t))return tf.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${lb}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),tf.set(t,n),n}function ff(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),tf.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${lb}:${n}`,JSON.stringify(e))}catch{}}function eh(e=b()){let t=String(e??"default");if(nf.has(t))return nf.get(t);let n={upgrades:{}};if(typeof localStorage<"u")try{let o=localStorage.getItem(`${cb}:${t}`);if(o){let r=JSON.parse(o);r&&typeof r=="object"&&(n={upgrades:r.upgrades&&typeof r.upgrades=="object"?r.upgrades:{}})}}catch{}return(!n||typeof n!="object")&&(n={upgrades:{}}),(!n.upgrades||typeof n.upgrades!="object")&&(n.upgrades={}),nf.set(t,n),n}function th(e,t=b()){let n=String(t??"default");if((!e||typeof e!="object")&&(e={upgrades:{}}),(!e.upgrades||typeof e.upgrades!="object")&&(e.upgrades={}),nf.set(n,e),!(typeof localStorage>"u"))try{localStorage.setItem(`${cb}:${n}`,JSON.stringify(e))}catch{}}function zm(e,t,n=b()){let o=aa(e,t);if(!o)return;let r=Xl(e,t),i=eh(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],th(i,n))}function ub(e,t,n=b()){let o=aa(e,t);if(!o)return!1;let r=Xl(e,t),i=eh(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],th(i,n),!0):!1}function Oi(e,t,n=b()){let o=aa(e,t);if(!o)return;let r=Xl(e,t),i=uf(n);i.upgrades[o]||(i.upgrades[o]=!0,r&&i.upgrades[r]&&delete i.upgrades[r],ff(i,n))}function nh(e,t,n=b()){let o=aa(e,t);if(!o)return;let r=uf(n);r.upgrades[o]&&(delete r.upgrades[o],ff(r,n));let i=Ym(n);(!i.upgrades[o]||i.upgrades[o].status!=="locked")&&(i.upgrades[o]={status:"locked"},Wm(i,n));let s=typeof t?.id<"u"?t.id:t;s!=null&&hr(e,s,n),io()}function af(e,t,n=b()){let o=aa(e,t);if(!o)return!1;let r=Xl(e,t),i=uf(n);return i.upgrades[o]?!0:r&&i.upgrades[r]?(i.upgrades[o]=i.upgrades[r],delete i.upgrades[r],ff(i,n),!0):!1}function wn(e){let t=e&&e.upg?e.upg:this&&typeof this=="object"?this:null,n=mr(t?.tie??t?.tieKey),o=e?.areaKey||Se.STARTER_COVE;if(!n||!p1.has(n))return{locked:!0,iconOverride:$n,useLockedBase:!0};let r=0;try{r=t&&typeof t.id<"u"?At(o,t.id):0}catch{}if(r>=1)return{locked:!1,hidden:!1,useLockedBase:!1};let i=!1;try{i=e&&typeof e.xpUnlocked<"u"?!!e.xpUnlocked:fb()}catch{}function s(){if(db())return{locked:!1,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!1};let a="Explore the Delve menu to reveal this upgrade";return{locked:!0,iconOverride:xn,titleOverride:cn,descOverride:a,reason:a,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}if(n===_e.UNLOCK_XP)return s();if(n===_e.UNLOCK_FORGE){if(!i)return{locked:!0,iconOverride:$n,useLockedBase:!0};let a=!1;try{let u=Ln();a=Ve(u)>=31}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 31 to reveal this upgrade";return{locked:!0,iconOverride:xn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:cn,descOverride:u,reason:u}}return{locked:!1}}if(n===_e.UNLOCK_INFUSE){if(!Ur())return{locked:!0,iconOverride:$n,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:oo,descOverride:"Do a Forge reset to reveal this upgrade",reason:"Do a Forge reset to reveal this upgrade"};let a=!1;try{let u=Ln();a=Ve(u)>=101}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 101 to reveal this upgrade";return{locked:!0,iconOverride:xn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:cn,descOverride:u,reason:u}}return{locked:!1}}if(n===_e.UNLOCK_SURGE){if(!Gt())return{locked:!0,iconOverride:$n,useLockedBase:!0,hidden:!1,hideCost:!0,hideEffect:!0,titleOverride:oo,descOverride:"Do an Infuse reset to reveal this upgrade",reason:"Do an Infuse reset to reveal this upgrade"};let a=!1;try{let u=Ln();a=Ve(u)>=201}catch{}if(!a){let u=t?.revealRequirement||"Reach XP Level 201 to reveal this upgrade";return{locked:!0,iconOverride:xn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:cn,descOverride:u,reason:u}}return{locked:!1}}if(Qm.has(n)){if(Gt()||af(o,t)){try{Oi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}let a=!1;try{let f=Ln();a=Ve(f)>=101}catch{}if(!a)return{locked:!0,iconOverride:$n,useLockedBase:!0,titleOverride:oo,descOverride:"Locked",reason:"Locked",hidden:!1,hideCost:!1,hideEffect:!1};let u="Do an Infuse reset to reveal this upgrade";try{zm(o,t)}catch{}return{locked:!0,iconOverride:xn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:cn,descOverride:u,reason:u}}if(Ur()||af(o,t)){try{Oi(o,t)}catch{}return{locked:!1,hidden:!1,useLockedBase:!1}}if(!i)return{locked:!0,iconOverride:$n,useLockedBase:!0};if(ub(o,t)){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:xn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:cn,descOverride:a,reason:a}}let l=!1;try{let a=Ln();l=Ve(a)>=31}catch{}if(!l){let a="Do a Forge reset to reveal this upgrade";return{locked:!0,iconOverride:$n,useLockedBase:!0,titleOverride:oo,descOverride:a,reason:a,hidden:!1,hideCost:!1,hideEffect:!1}}try{zm(o,t)}catch{}return{locked:!0,iconOverride:xn,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}function pr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function mr(e){if(typeof e=="string"){let t=e.trim();if(t)return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}return""}function v1(e,t){let n=mr(t?.tie??t?.tieKey);if(n&&m1.has(n))return!0;let o=ro(t?.id),r=typeof o=="number"?o:Number.parseInt(o,10),i=Number.isFinite(r)?String(r):o!=null?String(o):"";if(!i)return!1;let s=[];e!=null&&s.push(e),t?.area!=null&&s.push(t.area);for(let l of s){let a=pr(l);if(a&&h1.has(`${a}:${i}`))return!0}return!1}function fb(){try{return!!gn()}catch{return!1}}function db(e=b()){let t=String(e??"default");if(typeof localStorage>"u")return!1;try{return localStorage.getItem(`${g1}:${t}`)==="1"}catch{return!1}}function Ln(){try{let e=typeof Qe=="function"?Qe():null;if(e?.xpLevel instanceof c)return e.xpLevel.clone?.()??e.xpLevel;if(e?.xpLevel!=null)return c.fromAny(e.xpLevel)}catch{}return c.fromInt(0)}function of(e){if(typeof e=="number"&&Number.isFinite(e))return Math.max(0,Math.floor(e));if(typeof e=="bigint"){if(e<0n)return 0;let t=BigInt(Number.MAX_SAFE_INTEGER),n=e>t?t:e;return Number(n)}if(e instanceof c)try{let t=e.toPlainIntegerString?.();if(t&&t!=="Infinity"){let n=Number.parseInt(t,10);if(Number.isFinite(n))return Math.max(0,n)}}catch{}return 0}function $m(e,t){let n=Object.assign({locked:!1},e||{});if(!t||typeof t!="object")return n;let o=["locked","iconOverride","titleOverride","descOverride","reason","hideCost","hideEffect","hidden","useLockedBase"];for(let r of o)t[r]!==void 0&&(n[r]=t[r]);return n}function ro(e){if(typeof e=="number")return Number.isFinite(e)?Math.trunc(e):e;if(typeof e=="string"){let t=e.trim();if(!t)return t;if(/^[+-]?\d+$/.test(t)){let n=Number.parseInt(t,10);if(Number.isFinite(n))return n}return t}return e}function gt(e){try{if(e=ta(e,{allowEmpty:!0}),typeof e=="string"){let i=e.trim();if(!i)return c.fromInt(0);if(/^inf(?:inity)?$/i.test(i))return c.fromAny("Infinity");if(!i.startsWith("BN:")&&/^[+-]?\d+$/.test(i)){let s=i.replace(/^[+-]/,"").replace(/^0+(?=\d)/,"");if(!s)return c.fromInt(0);if(s.length>c.MAX_PLAIN_DIGITS)return c.fromAny("Infinity");if(s.length>32)return ie(s.length-1)}}let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return t.clone?.()??t;let n=Ee(t);if(!Number.isFinite(n))return n>0?c.fromAny("Infinity"):c.fromInt(0);if(n+1>c.MAX_PLAIN_DIGITS||n>32)return t.clone?.()??t;let o=t.toPlainIntegerString?.();if(o==="Infinity")return c.fromAny("Infinity");if(!o)return c.fromInt(0);let r=o.replace(/^0+(?=\d)/,"");return r?c.fromAny(r):c.fromInt(0)}catch{let t=Math.max(0,Math.floor(Number(e)||0));return c.fromInt(t)}}function Ve(e){let t;try{t=e instanceof c?e:c.fromAny(e??0)}catch{return 0}if(t.isInfinite?.())return Number.POSITIVE_INFINITY;let n=Ee(t);if(!Number.isFinite(n))return n>0?Number.MAX_VALUE:0;if(n>308)return Number.MAX_VALUE;if(n<-324)return 0;if(n>20){let o=Math.pow(10,n);return Number.isFinite(o)?o:Number.MAX_VALUE}try{let o=t.toPlainIntegerString?.();if(!o||o==="Infinity")return o==="Infinity"?Number.MAX_VALUE:0;let r=o.replace(/^0+/,"");if(!r)return 0;if(r.length<=15){let d=Number(r);return Number.isFinite(d)?d:0}let i=r.slice(0,15),s=Number(i),l=i.length;if(!Number.isFinite(s)||s<=0)return 0;let a=s/Math.pow(10,l-1),u=r.length-1;if(a<=0||!Number.isFinite(a))return 0;if(a>=10){let d=Math.floor(Math.log10(a));Number.isFinite(d)&&d>0&&(a/=Math.pow(10,d),u+=d)}else if(a<1){let d=Math.ceil(Math.log10(1/a));Number.isFinite(d)&&d>0&&(a*=Math.pow(10,d),u-=d)}if(u>308)return Number.MAX_VALUE;if(u<-324)return 0;let f=a*Math.pow(10,u);return Number.isFinite(f)?f:u>0?Number.MAX_VALUE:0}catch{let o=Ee(t);if(!Number.isFinite(o)||o>308)return Number.MAX_VALUE;if(o<-324)return 0;let r=Math.pow(10,o);return Number.isFinite(r)?r:Number.MAX_VALUE}}function b1(e,t){let n=gt(e),o=gt(t);if(n.isInfinite?.())return o.isInfinite?.()?c.fromInt(0):c.fromAny("Infinity");if(o.isInfinite?.())return c.fromInt(0);try{let r=Math.floor(Ee(n))+1,i=Math.floor(Ee(o))+1;if(!Number.isFinite(r)||r>120||!Number.isFinite(i))return!Number.isFinite(i)||r<=i?c.fromInt(0):c.fromAny("Infinity");let s=n.toPlainIntegerString?.(),l=o.toPlainIntegerString?.();if(!s||!l)return c.fromInt(0);if(s==="Infinity")return c.fromAny("Infinity");if(l==="Infinity")return c.fromInt(0);if(s===l)return c.fromInt(0);let a=BigInt(s)-BigInt(l);return a<=0n?c.fromInt(0):c.fromAny(a.toString())}catch{return c.fromInt(0)}}function pb(e){if(!Number.isFinite(e)||e<=0)return"1";let t=e.toFixed(12);return t=t.replace(/0+$/,""),t.endsWith(".")&&(t+="0"),t}function la(e){let t=Number(e);return Number.isFinite(t)&&t>0?Math.max(0,Math.floor(t)):0}function lf(e){if(!e)return 0;let t=Number(e.activeEvolutions);return Number.isFinite(t)&&t>=0?t:la(e.numUpgEvolutions)}function oh(e,t,n="NM"){let o;try{o=c.fromAny(e??0)}catch{o=c.fromInt(0)}let r=Ve(t),i={upgType:n,numUpgEvolutions:0};if(`${n??""}`.toUpperCase()==="HM"){let f=Math.max(0,Math.floor(r/Xt));Number.isFinite(f)&&(i.numUpgEvolutions=f)}let s=yb(i),l=s?.ratio>0?s.ratio:1;l===1/0&&s?.ratioLog10==null;let a=s&&s.ratioLog10!=null?s.ratioLog10:Math.log10(Math.max(l,1)),u={baseBn:o,baseLog10:Ee(o),ratio:l,ratioMinus1:Math.max(0,l-1),ratioLog10:a,ratioLn:a*Math.LN10,ratioStr:pb(Math.max(l,1)),defaultPreset:s?.preset};return i.scaling=u,En(i,r)}function mb(e){let t=la(e),n=Xt*(t+1),o=c.fromAny(n);return{cap:n,capBn:o,capFmtHtml:Hr(o),capFmtText:ra(o)}}function hb(e,t){if(!e||typeof t!="number")return 0;let n=Math.floor(Ee(e))+1;if(!Number.isFinite(n))return 0;if(n>120){let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Xt)+1)}try{let o=e.toPlainIntegerString?.();if(!o||o==="Infinity")return 0;let r=BigInt(o),i=BigInt(Math.max(0,Math.floor(t))),s=BigInt(Xt);if(r<i)return 0;let a=(r-i)/s;return Number(a+1n)}catch{let o=Ve(e);if(!Number.isFinite(o)||o<t)return 0;let r=o-t;return Math.max(0,Math.floor(r/Xt)+1)}}function I1(e,t){if(!(t>0))return c.fromInt(1);let n;try{n=c.fromAny(e??1)}catch{n=c.fromInt(1)}let o=Math.max(0,Math.floor(t));if(!Number.isFinite(o))return c.fromAny("Infinity");if(o<=1)return n.clone?.()??n;let r=(a,u)=>{try{return a.mulBigNumInteger(u)}catch{}try{return a.mulDecimal(u.toScientific?.(12)??String(e??"1"),18)}catch{}try{return u.mulDecimal(a.toScientific?.(12)??String(e??"1"),18)}catch{}return c.fromAny("Infinity")};if(o<=8){let a=n.clone?.()??n;for(let u=1;u<o;u+=1)a=r(a,n);return a}let i=c.fromInt(1),s=n.clone?.()??n,l=o;for(;l>0;)l%2===1&&(i=r(i,s)),l=Math.floor(l/2),l>0&&(s=r(s,s));return i}function rh(e,t=sf){if(Array.isArray(e?.hmMilestones))return e.hmMilestones;let n=pr(t||e?.area||sf);return d1[n]||ib}function bt(e,t){let n=e instanceof c?e:c.fromAny(e??1),o=t instanceof c?t:null;if(!o)try{o=c.fromAny(t??1)}catch{return n}try{return n.mulBigNumInteger(o)}catch{}try{return n.mulDecimal(o.toScientific?.(12)??String(t??"1"),18)}catch{}return n}function df(e,t=0){if(!e||e.upgType!=="HM")return;delete e.scaling;let{cap:n,capBn:o,capFmtHtml:r,capFmtText:i}=mb(t);e.activeEvolutions=t,e.lvlCap=n,e.lvlCapBn=o,e.lvlCapFmtHtml=r,e.lvlCapFmtText=i}function Ko(e,t,n=sf){if(!e||e.upgType!=="HM")return{selfMult:c.fromInt(1),xpMult:c.fromInt(1),coinMult:c.fromInt(1),mpMult:c.fromInt(1)};let o=rh(e,n),r=c.fromInt(1),i=c.fromInt(1),s=c.fromInt(1),l=c.fromInt(1);for(let u of o){let f=hb(t,Number(u?.level??u?.lvl??0));if(!(f>0))continue;let d=I1(u.multiplier??u.mult??u.value??1,f),m=`${u.target??u.type??"self"}`.toLowerCase();m==="xp"?i=bt(i,d):m==="coin"||m==="coins"?s=bt(s,d):m==="mp"?l=bt(l,d):r=bt(r,d)}let a=lf(e);if(a>0){let u=l1*a,f=ie(u);r=bt(r,f)}return{selfMult:r,xpMult:i,coinMult:s,mpMult:l}}function gb(e,t,n=sf){if(!e||e.upgType!=="HM")return null;if(t?.isInfinite?.())return c.fromAny("Infinity");let o=rh(e,n);if(!o.length)return null;let r=null;for(let i of o){let s=Math.max(0,Math.floor(Number(i?.level??i?.lvl??0))),l=hb(t,s),a=null;try{let u=BigInt(s),f=BigInt(Math.max(0,l)),d=u+BigInt(Xt)*f;d>0n&&(a=c.fromAny(d.toString()))}catch{}if(!a){let u=c.fromAny(Xt*Math.max(0,l));try{a=u.add(c.fromAny(s))}catch{a=c.fromAny(s+Xt*l)}}if(a){if(t?.cmp?.(a)>=0)try{a=a.add(c.fromAny(Xt))}catch{}(!r||r.cmp(a)>0)&&(r=a)}}return r}function yb(e){if(!e)return null;let t=n=>{let o=`${n??""}`.toUpperCase();if(!o)return null;let r=S1[o];if(typeof r!="function")return null;let i=r(e);if(typeof i=="object"&&i!==null)return i.ratioLog10!=null||i.ratio>0?{ratio:i.ratio??1,ratioLog10:i.ratioLog10,preset:o}:null;let s=i;return!Number.isFinite(s)&&s!==1/0||s<=0?null:{ratio:s,preset:o}};return t(e.scalingPreset)||t(e.upgType)||t("STANDARD")}function ca(e){if(!e)return null;if(e.scaling&&e.scaling.baseBn)return e.scaling;try{let n=c.fromAny(e.baseCost??e.baseCostBn??0),o=e.scaling??{},r=Number(o.ratio);(!(r>0)||!Number.isFinite(r)&&r!==1/0)&&(r=null);let i=typeof o.ratioStr=="string"?o.ratioStr.trim():"";if(!r&&i){let d=Number(i);Number.isFinite(d)&&d>0&&(r=d)}let s=Number(o.ratioLog10);if(Number.isFinite(s)||(s=null),!r&&s!=null){let d=Math.pow(10,s);Number.isFinite(d)&&d>0&&(r=d)}let l=Number(o.ratioLn);if(Number.isFinite(l)||(l=null),!r&&l!=null){let d=Math.exp(l);Number.isFinite(d)&&d>0&&(r=d)}if(!r){let d=Number(o.ratioMinus1);Number.isFinite(d)&&d>0&&(r=d+1)}let a=null;if(!r){let d=yb(e);d&&(r=d.ratio,d.ratioLog10!=null&&(s=d.ratioLog10),a=d.preset)}if(r>1){r=Number(r),i=pb(r),s==null||r===1/0&&Number.isFinite(s)?s==null&&(s=Math.log10(r)):Number.isFinite(r)&&(s=Math.log10(r)),Number.isFinite(s)?l=s*Math.LN10:l=Math.log(r);var t=Math.max(1e-12,r-1)}else{r=1,i="1",s=0,l=0;var t=0}let u=Ee(n),f=Object.assign({},o,{baseBn:n,baseLog10:u,ratio:r,ratioMinus1:t,ratioLog10:s,ratioLn:l,ratioStr:i,defaultPreset:a??o.defaultPreset});e.scaling=f;try{let d=c.fromAny(e.costAtLevel?.(0)??0),m=c.fromAny(e.costAtLevel?.(1)??0),v=c.fromAny(e.costAtLevel?.(32)??0);d.cmp(m)===0&&d.cmp(v)===0&&(f.ratio=1,f.ratioMinus1=0,f.ratioLog10=0,f.ratioLn=0,f.ratioStr="1")}catch{}return f}catch{return null}}function En(e,t){let n=ca(e);if(!n)return c.fromInt(0);let o=Math.max(0,Math.floor(Number(t)||0));if(o===0)return c.fromAny(n.baseBn);if(o<=100){let r=c.fromAny(n.baseBn);for(let i=0;i<o;i+=1)r=r.mulDecimal(n.ratioStr);return r.floorToInteger()}if(o<1e4){let r=Math.max(0,o-10),i=ie(n.baseLog10+r*n.ratioLog10);for(let s=r;s<o;s+=1)i=i.mulDecimal(n.ratioStr);return i.floorToInteger()}return ie(n.baseLog10+o*n.ratioLog10).floorToInteger()}function w1(e){if(!Number.isFinite(e))return e;if(e<1e-6||e<50)return Math.log(Math.expm1(e));let t=Math.exp(-e);return e+Math.log1p(-t)}function fr(e,t,n){if(!(n>0))return Number.NEGATIVE_INFINITY;let o=ca(e);if(!o)return Number.NEGATIVE_INFINITY;if(!Number.isFinite(o.ratioLn))return n>1?Number.POSITIVE_INFINITY:(o.baseLog10*Qu+t*o.ratioLn)/Qu;if(!(o.ratioMinus1>0))return Number.POSITIVE_INFINITY;let r=o.baseLog10*Qu+t*o.ratioLn,i=o.ratioLn*n,s=w1(i);if(!Number.isFinite(s))return Number.POSITIVE_INFINITY;let l=Math.log(o.ratioMinus1);return(r+s-l)/Qu}function rf(e,t,n){if(!(n>0))return c.fromInt(0);let o=ca(e);if(!o)return c.fromInt(0);let r=t+n;if(r<=100){let s=c.fromAny(e.costAtLevel(t)),l=c.fromInt(0);for(let a=0;a<n;a+=1)l=l.add(s),a+1<n&&(s=s.mulDecimalFloor(o.ratioStr));return l}if(r<1e4){let s=Math.min(10,n),l=n-s,a=c.fromInt(0);if(l>0){let u=fr(e,t,l);a=a.add(ie(u))}if(s>0){let u=t+l,f=c.fromAny(e.costAtLevel(u));for(let d=0;d<s;d+=1)a=a.add(f),d+1<s&&(f=f.mulDecimalFloor(o.ratioStr))}return a}let i=fr(e,t,n);return ie(i)}function bb(e){if(!(e>0)||!Number.isFinite(e))return e;if(Gm[0]=e,Gm[0]<=0)return 0;E1[0]-=1n;let t=Gm[0];return t>0?t:0}function x1(e){if(!(e>0))return 0;let t=Math.floor(e-1);if(t<e)return t;let n=bb(e);return n<e?n:e>1?e/2:0}function Qs(e){if(!(e>0)||!Number.isFinite(e))return c.fromInt(0);let t=Math.floor(e);if(!(t>0))return c.fromInt(0);if(t<=Number.MAX_SAFE_INTEGER)return c.fromInt(t);let n;try{n=t.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:0})}catch{n=t.toString()}return!n||!/\d/.test(n)?c.fromInt(0):c.fromAny(n)}function oa(e,t,n,o=sa,r={}){let i=ca(e),s=c.fromInt(0),l=r||{},a=!!l.fastOnly;if(n=n instanceof c?n:c.fromAny(n??0),!i)return{count:s,spent:s,nextPrice:s,numericCount:0};let u=Math.max(0,Math.floor(Ve(t))),f=Number.isFinite(e.lvlCap)?Math.max(0,Math.floor(e.lvlCap)):Number.POSITIVE_INFINITY,d=typeof o=="number"?o:Ve(o),m=Number.isFinite(f)?Math.max(0,f-u):qm,v=Number.isFinite(d)?Math.max(0,Math.floor(d)):qm;if(v=Math.min(v,qm,m),!(v>0)){let W=m<=0?s:c.fromAny(e.costAtLevel(u));return{count:s,spent:s,nextPrice:W,numericCount:0}}let p=100-u;if(Number.isFinite(u)&&p>0){let W=Math.min(v,p);if(l.fastOnly&&i&&Number.isFinite(i.ratioLog10)&&Number.isFinite(i.baseLog10)){let ge=Ee(n),Be=u+W,ne=i.baseLog10+Be*i.ratioLog10;if(ge>ne+5){let ve=Qs(W),Ue=u+W,Ae=oa(e,Ue,n,v-W,r),Fe=Ae?.count instanceof c?Ae.count:Qs(Ae?.numericCount??0);return{count:ve.add(Fe),spent:s,nextPrice:Ae?.nextPrice??s,numericCount:W+(Ae?.numericCount??0)}}}let q=c.fromAny(e.costAtLevel(u)),X=s,J=0;for(;J<W;){q=c.fromAny(e.costAtLevel(u+J));let ge=X.add(q);if(ge.cmp(n)>0)break;X=ge,J+=1}let le=u+J,fe=Number.isFinite(f)&&le>=f,_=Qs(J);if(J<W||fe||v<=J){let ge=fe?s:c.fromAny(e.costAtLevel(le));return{count:_,spent:X,nextPrice:ge,numericCount:J}}let H=(()=>{try{return dr(t??u,u).add(_)}catch{return u+J}})(),z=oa(e,H,n.sub(X),v-J,r),de=z?.count instanceof c?z.count:Qs(z?.numericCount??0),ee=_.add(de),re=(z?.spent??s).add(X);return{count:ee,spent:re,nextPrice:z?.nextPrice??s,numericCount:J+(z?.numericCount??0)}}let h=Ee(n),g=i.ratioLog10,y=i.ratioMinus1,I=c.fromAny(e.costAtLevel(u)),E=i.baseLog10+u*g;if(y>0&&(!Number.isFinite(h)||Math.abs(h)>1e6&&Math.abs(E)>1e6)){let W=c.fromAny(e.costAtLevel(u));if(n.cmp(W)<0)return{count:s,spent:s,nextPrice:W,numericCount:0};let q=Number.isFinite(v)?Math.max(1,Math.floor(v)):Number.MAX_VALUE,X=1,J=1;for(;J<q;){let de=fr(e,u,J);if(ie(de).cmp(n)<=0){let re=J*2;if(!Number.isFinite(re)||re<=J){J=q;break}X=J,J=Math.min(re,q)}else break}let le=0;for(;X<J&&le<256;){let de=Math.max(X+1,Math.floor((X+J+1)/2)),ee=fr(e,u,de);ie(ee).cmp(n)<=0?X=de:J=de-1,le++}let fe=Math.max(1,X),_=Qs(fe),H=s,z=s;if(!a)if(H=rf(e,u,fe),Number.isFinite(f)){let de=Math.max(0,Math.floor(f-Math.min(u,f)));fe>=de?z=s:z=ie(E+fe*g)}else z=ie(E+fe*g);return{count:_,spent:H,nextPrice:z,numericCount:fe}}if(n.cmp(I)<0)return{count:s,spent:s,nextPrice:I,numericCount:0};let A=!1,G=null,P=null;try{G=c.fromAny(e.costAtLevel(u+1))}catch{}try{let W=Math.min(Number.isFinite(f)?Math.max(u+1,Math.floor(f)):u+32,u+32);P=c.fromAny(e.costAtLevel(W))}catch{}!A&&!(i.ratioMinus1>0)&&(A=!0),G&&P&&(A=G.cmp(I)===0&&P.cmp(I)===0),!A&&!(i.ratioMinus1>0)&&(A=!0);let $=Number.isFinite(v)?Math.max(0,Math.floor(v)):Number.MAX_VALUE;if(A){let W=dr(e.lvlCapBn??"Infinity","Infinity"),q=dr(t??0,0),X=W.isInfinite?.()?c.fromAny("Infinity"):W.sub(q).floorToInteger(),{count:J,countBn:le,spent:fe,nextPrice:_}=Km(I,n,X);return{count:le,spent:fe,nextPrice:_,numericCount:J}}if(!(g>0)||!(y>0)){let W=dr(e.lvlCapBn??"Infinity","Infinity"),q=dr(t??0,0),X=W.isInfinite?.()?c.fromAny("Infinity"):W.sub(q).floorToInteger(),{count:J,countBn:le,spent:fe,nextPrice:_}=Km(I,n,X);return{count:le,spent:fe,nextPrice:_,numericCount:J}}let L=Math.log10(y);if(!Number.isFinite(L))return{count:s,spent:s,nextPrice:I,numericCount:0};let T=Yf(h+L-E)/g;(!Number.isFinite(T)||T<0)&&(T=0);let C=Math.floor(Math.min($,T));Number.isFinite(C)||(C=$),C<=0&&(C=1);let Y=1e-7,Q=fr(e,u,C),ae=0,he=2048;for(;C>0&&(!Number.isFinite(Q)||Q>h+Y)&&ae<he;){let W=Number.isFinite(Q)?Math.max(1,Math.ceil((Q-h)/Math.max(g,1e-12))):Math.max(1,Math.floor(C/2)),q=Math.max(0,Math.floor(C-W));if(q<C)C=q;else{let X=bb(C);if(!(X<C))break;C=X}Q=C>0?fr(e,u,C):Number.NEGATIVE_INFINITY,ae+=1}if(C<=0||!Number.isFinite(C))if(n.cmp(I)>=0)C=1,Q=Ee(I);else return{count:s,spent:s,nextPrice:I,numericCount:0};if(C<$){let W=_=>{let H=_*2;return Number.isFinite(H)?H:Number.MAX_VALUE},q=C,X=Math.min($,Math.max(C+1,W(C))),J=fr(e,u,X);for(;q<X&&Number.isFinite(J)&&J<=h+Y&&X<$;)q=X,X=Math.min($,W(X)),J=fr(e,u,X);let le=q,fe=X;for(let _=0;_<256&&le<fe;_+=1){let H=Math.floor((le+fe+1)/2),z=fr(e,u,H);Number.isFinite(z)&&z<=h+Y?(le=H,Q=z):fe=H-1}C=le}let be=null;if(!a){be=rf(e,u,C);let W=0;for(;be.cmp(n)>0&&C>0&&W<he;){let q=x1(C);if(!(q<C))break;C=q,be=rf(e,u,C),W+=1}if(C<=0)return{count:s,spent:s,nextPrice:I,numericCount:0};if(C<$&&W<he)for(;C<$&&W<he;){let q=u+C,X;try{if(Number.isFinite(q)&&q<Number.MAX_SAFE_INTEGER/2)X=c.fromAny(e.costAtLevel(q));else{let le=E+C*g;X=ie(le).floorToInteger()}}catch{break}let J=be.add(X);if(J.cmp(n)>0)break;be=J,C+=1,W+=1}}let Oe=s,ke=!a&&Number.isFinite(u)&&Number.isFinite(C)&&u<Number.MAX_SAFE_INTEGER/2&&C<Number.MAX_SAFE_INTEGER/2;if(!a)if(Number.isFinite(f)){let W=Math.max(0,Math.floor(f-Math.min(u,f)));if(C>=W)Oe=s;else if(ke){let q=Math.floor(u+C);Oe=c.fromAny(e.costAtLevel(q))}else{let q=E+C*g;Oe=ie(q)}}else if(ke){let W=Math.floor(u+C);Oe=c.fromAny(e.costAtLevel(W))}else{let W=E+C*g;Oe=ie(W)}return{count:Qs(C),spent:be,nextPrice:Oe,numericCount:C}}function L1(e){try{let t=c.fromAny(e.costAtLevel(0)),n=c.fromAny(typeof e.nextCostAfter=="function"?e.nextCostAfter(t,1):e.costAtLevel(1)),o=Ee(t),r=Ee(n);if(!Number.isFinite(o)||!Number.isFinite(r))return null;let i=r-o;if(!Number.isFinite(i)||i<=0)return null;let s=Math.pow(10,i);if(!Number.isFinite(s)||s<=1)return null;let l=s-1;return!(l>0)||!Number.isFinite(l)?null:{ratio:s,ratioLog:i,logDenom:Math.log10(l)}}catch{return null}}function Km(e,t,n){if(e instanceof c||(e=c.fromAny(e??0)),t instanceof c||(t=c.fromAny(t??0)),n instanceof c||(n=c.fromAny(n??0)),e.isZero?.())return{count:0};if(t.isZero?.())return{count:0};let o=t.toPlainIntegerString?.(),r=e.toPlainIntegerString?.();if(o&&o!=="Infinity"&&r&&r!=="Infinity"){let f=BigInt(o)/BigInt(r),d=c.fromAny(f.toString());!n.isInfinite?.()&&d.cmp(n)>0&&(d=n);let m=e.mulBigNumInteger(d);return{count:jm(d),countBn:d,spent:m,nextPrice:e}}let i=Ee(t),s=Ee(e);if(!Number.isFinite(i)||!Number.isFinite(s)||i<s)return{count:0};let l=ie(i-s).floorToInteger();!n.isInfinite?.()&&l.cmp(n)>0&&(l=n);let a=e.mulBigNumInteger(l),u=e;return{count:jm(l),countBn:l,spent:a,nextPrice:u}}function _1(e,t,n,o){if(!n||o<=0)return{count:0};let r=Ee(t),i=Ee(e);if(!Number.isFinite(r)||!Number.isFinite(i))return{count:0};if(r<i)return{count:0};let s=r-i+n.logDenom;if(!Number.isFinite(s)||s<=0)return{count:0};let l=Math.floor(s/n.ratioLog);if(!Number.isFinite(l)||l<=0)return{count:0};if(l=Math.min(l,o),l<=0)return{count:0};let a=0,u=l;for(let h=0;h<64&&a<u;h+=1){let g=Math.max(0,Math.floor((a+u+1)/2));i+g*n.ratioLog-n.logDenom<=r?a=g:u=g-1}let f=Math.min(a,o);if(f<=0)return{count:0};let d=i+f*n.ratioLog-n.logDenom;if(d>r)return{count:0};let m=i+f*n.ratioLog,v=ie(d),p=ie(m);return{count:f,spent:v,nextPrice:p,spentLog:d,nextPriceLog:m}}function dr(e,t){try{return c.fromAny(e??t??0)}catch{return c.fromAny(t??0)}}function jm(e){if(!(e instanceof c)||e.isInfinite?.())return 1/0;try{let t=e.toPlainIntegerString();if(t==="Infinity")return 1/0;if(!t)return 0;if(t.length>15)return Number.MAX_SAFE_INTEGER;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):Number.MAX_SAFE_INTEGER}catch{return Number.MAX_SAFE_INTEGER}}function Hr(e){return K(e instanceof c?e:c.fromAny(e??0))}function ra(e){return Hr(e).replace(/<[^>]*>/g,"")}function cf(e){if(e instanceof c)try{return e.clone?.()??c.fromAny(e)}catch{return c.fromInt(0)}try{return c.fromAny(e??0)}catch{return c.fromInt(0)}}function ia(e,t,n,o,r){if(!e||typeof e.onLevelChange!="function")return;let i=cf(n??t??0),s=cf(r??o??0),l={upgrade:e,oldLevel:Number.isFinite(t)?t:Ve(i),newLevel:Number.isFinite(o)?o:Ve(s),oldLevelBn:i,newLevelBn:s};try{e.onLevelChange(l)}catch{}}function Ut(e,t){return En(e,t)}function Sb(e,t=b()){return t==null?null:`ccc:upgrades:${e}:${t}`}function Pi(e,t,n=b()){if(n==null)return null;let o=pr(e),r=ih(e,t);return!o||r==null?null:`ccc:upgrades:${o}:${r}:${n}`}function C1(){nb.forEach(e=>{try{e?.()}catch{}}),nb.clear()}function ob(e){C1()}function M1(e,t){if(typeof localStorage>"u")return;let n=Sb(e,t),o=localStorage.getItem(n);if(o){try{let r=JSON.parse(o);if(Array.isArray(r)){let i=0;r.forEach(s=>{if(s&&s.id!=null){let l=Pi(e,s.id,t);l&&localStorage.getItem(l)===null&&(localStorage.setItem(l,JSON.stringify(s)),i++)}})}}catch(r){console.warn("Failed to migrate legacy upgrade storage",r)}try{localStorage.removeItem(n),localStorage.removeItem(`${n}:backup`)}catch{}}}function T1(e,t,n){M1(e,n);let o=Pi(e,t,n);if(!o)return null;if(ea&&Gl.has(o))try{let r=Gl.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}if(Gr.has(o))try{let r=Gr.get(o);if(r?.state)return JSON.parse(JSON.stringify(r.state))}catch{}try{let r=localStorage.getItem(o);return r?JSON.parse(r):null}catch{return null}}function na(e,t,n,o=b(),r={}){let i=Pi(e,t,o);if(i){if(ea){Gl.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}if(r&&r.deferSave){Gr.set(i,{areaKey:e,upgId:t,state:n,slot:o});return}Gr.has(i)&&Gr.delete(i);try{let s=JSON.stringify(n);localStorage.setItem(i,s);try{ct(i,s)}catch{}}catch(s){console.warn("Failed to save upgrade state",e,t,s)}}}function k1(e,t,n=b()){Array.isArray(t)&&t.forEach(o=>{o&&o.id!=null&&na(e,o.id,o,n)})}function ih(e,t){if(t&&typeof t=="object"&&typeof t.id<"u")return ro(t.id);let n=ro(t);if(typeof n=="number"||n==null)return n;if(typeof n=="string"){let o=mr(n);if(o){let r=Xm.get(o);if(r){let i=pr(e);if(!i||pr(r.area)===i)return ro(r.id)}}}return n}function Ib(e,t,n=b()){let o=n==null?"null":String(n),r=ih(e,t);return`${o}:${e}:${ro(r)}`}function Lo(e,t){let n=ih(e,t),o=ro(n),r=b(),i=Ib(e,o,r),s=Zm.get(i);if(s)return s;let l=ua(e,o),a=T1(e,o,r),u=!1;if(a)a.id!==o&&(a.id=o,u=!0);else{if(a={id:o,lvl:c.fromInt(0).toStorage()},l)try{a.nextCost=c.fromAny(l.costAtLevel(0)).toStorage()}catch{a.nextCost=c.fromInt(0).toStorage()}a.nextCostLvl=a.lvl,na(e,o,a,r)}let f=a.lvl,d=a.nextCost,m=a.nextCostLvl;a.lvl=ta(a.lvl),a.nextCost=ta(a.nextCost,{allowEmpty:!0}),a.nextCostLvl=ta(a.nextCostLvl,{allowEmpty:!0}),(a.lvl!==f||a.nextCost!==d||a.nextCostLvl!==m)&&(u=!0);let v=0;l?.upgType==="HM"&&(v=la(a.hmEvolutions??a.evolutions??a.evol??l.numUpgEvolutions),df(l,v));let p=gt(a.lvl),h=Ve(p);try{let M=l?.lvlCapBn??c.fromAny("Infinity");if(!M.isInfinite?.()&&p.cmp(M)>0){let A=M.clone?.()??M;h=Ve(A);let G=A.toStorage();a.lvl=G,a.nextCost=c.fromInt(0).toStorage(),a.nextCostLvl=G,na(e,o,a,r)}}catch{}let g=null;try{g=p?.toStorage?.()??gt(h).toStorage()}catch{}g&&a.lvl!==g&&(a.lvl=g,u=!0);let y=typeof a.nextCostLvl=="string"?a.nextCostLvl:null,I=!y||y!==g,E=null;if(!E||I){if(l)try{E=c.fromAny(l.costAtLevel(h))}catch{E=c.fromInt(0)}else E=c.fromInt(0);try{a.nextCost=E.toStorage(),g?a.nextCostLvl=g:delete a.nextCostLvl,u=!0}catch{}}if(u)try{na(e,o,a,r)}catch{}if(l?.upgType==="HM"&&p?.isInfinite?.()&&!l.lvlCapBn?.isInfinite?.()){let M=c.fromAny("Infinity");l.lvlCapBn=M,l.lvlCap=Number.POSITIVE_INFINITY,l.lvlCapFmtHtml=Hr(M),l.lvlCapFmtText=ra(M)}return s={areaKey:e,upgId:o,upg:l,rec:a,arr:[],lvl:h,lvlBn:p,nextCostBn:E,slot:r,hmEvolutions:v},Zm.set(i,s),s}function Xr(e,t={}){if(!e)return;let{areaKey:n}=e,o=e.slot??b();if(!n||o==null)return;let r=ro(e.upgId??e.rec?.id),i=e.rec;i||(i={id:r},e.rec=i);try{let l=e.upg?.lvlCapBn??c.fromAny("Infinity"),a=e.lvlBn?.clone?.()??gt(e.lvlBn??e.lvl);!l.isInfinite?.()&&a.cmp(l)>0&&(a=l.clone?.()??l,e.lvlBn=a,e.lvl=Ve(a))}catch{}try{i.lvl=e.lvlBn?.toStorage?.()??gt(e.lvlBn??e.lvl).toStorage()}catch{i.lvl=gt(e.lvl??0).toStorage()}i.lvl=ta(i.lvl);let s=i.lvl;if(e.nextCostBn!=null){try{i.nextCost=c.fromAny(e.nextCostBn).toStorage()}catch{try{i.nextCost=c.fromAny(e.nextCostBn??0).toStorage()}catch{i.nextCost=c.fromInt(0).toStorage()}}i.nextCost=ta(i.nextCost,{allowEmpty:!0}),i.nextCostLvl=s}else delete i.nextCostLvl;e.hmEvolutions!=null&&(i.hmEvolutions=la(e.hmEvolutions)),na(n,r,i,o,t),e.slot=o}function hr(e,t,n=b()){Zm.delete(Ib(e,t,n))}function At(e,t){return Lo(e,t).lvl}function Jm(e,t){return Lo(e,t).hmEvolutions??0}function wb(e,t){if(!t)return{locked:!1};let n=fb(),o=n?Ln():c.fromInt(0),r=n?Ve(o):0,i={locked:!1};if(t.requiresUnlockXp&&!n){let f=v1(e,t),d="Unlock the XP system to reveal this upgrade",m=db();if(f)if(m)i={locked:!0,iconOverride:xn,titleOverride:cn,descOverride:d,reason:d,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0};else{let v='Meet the Merchant to reveal "Unlock XP"';i={locked:!0,iconOverride:$n,titleOverride:oo,descOverride:v,reason:v,hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}else i={locked:!0,iconOverride:$n,titleOverride:oo,descOverride:d,reason:'Purchase "Unlock XP" to reveal this upgrade',hidden:!1,hideCost:!1,hideEffect:!1,useLockedBase:!0}}let s=$m({locked:!1},i);if(typeof t.computeLockState=="function")try{let f={areaKey:e,upg:t,xpUnlocked:n,xpLevelBn:o,xpLevel:r,surgeLevel:bn(),surgeUnlocked:qr(),baseLocked:s.locked,getUpgradeLevel(m){return At(e,m)}},d=t.computeLockState(f);s=$m(s,d)}catch{}let l=b(),a=aa(e,t),u=a?af(e,t,l):!1;if(a){let f=Ym(l),d=uf(l),m=eh(l),v=a.replace(/_/g,"-"),p=Xl(e,t),h=!1;Js(f,v,a)&&(h=!0),p&&Js(f,p,a)&&(h=!0),h&&Wm(f,l);let g=!1;Js(d,v,a)&&(g=!0),p&&Js(d,p,a)&&(g=!0),g&&ff(d,l);let y=!1;Js(m,v,a)&&(y=!0),p&&Js(m,p,a)&&(y=!0),y&&th(m,l)}if(s.locked){let f=!!s.hidden;s.iconOverride||(s.iconOverride=$n),f?s.titleOverride||(s.titleOverride=cn):(!s.titleOverride||s.titleOverride===cn)&&(s.titleOverride=oo),s.useLockedBase==null&&(s.useLockedBase=!0),!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.descOverride||(s.reason?s.descOverride=`${s.reason}`:t?.revealRequirement?s.descOverride=t.revealRequirement:f&&(s.descOverride="This upgrade is currently hidden."))}else s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===$n||s.iconOverride===xn)&&delete s.iconOverride,(s.titleOverride===cn||s.titleOverride===oo)&&delete s.titleOverride,delete s.descOverride,delete s.reason;if(s.locked&&t.requiresUnlockXp&&!n&&!s.iconOverride&&(s.iconOverride=$n),a){let f=Ym(l),d=f.upgrades[a]||{},m=mr(t?.tie??t?.tieKey),v=m&&sb.has(m),p=m&&Qm.has(m),h=d.status||"locked";if(af(e,t,l))h="unlocked";else if(ub(e,t,l)&&h==="locked"){let L=!1;try{L=Ve(Ln())>=31}catch{}let F=!1;try{F=Ve(Ln())>=101}catch{}v&&!L||p&&!F?h="locked":h="mysterious"}let g=Ju(h),y=Dm(s),I=Ju(y),E=()=>{s.locked=!0;let L=d.snapshot;L&&typeof L=="object"&&(s=$m(s,L)),s.iconOverride=xn,s.titleOverride=cn;let F=t?.revealRequirement||s.reason||s.descOverride||"This upgrade is currently hidden.";s.descOverride=F,!s.reason&&t?.revealRequirement&&(s.reason=t.revealRequirement),s.hidden=!0,s.hideCost=!0,s.hideEffect=!0,s.useLockedBase=!0};g>I&&(h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1):h==="mysterious"&&E(),y=Dm(s),I=Ju(y));let M=!1,A=d&&typeof d=="object"&&typeof d.status=="string"?d.status:"locked",G=v,P=!1;try{P=Ve(Ln())>=31}catch{}let $=!1;try{$=Ve(Ln())>=101}catch{}if((G&&!P&&A==="mysterious"||p&&!$&&A==="mysterious")&&(A="locked"),(!d||typeof d!="object"||Object.keys(d).length!==1||d.status!==A)&&(f.upgrades[a]={status:A},M=!0),I>g){if(d.status=y,f.upgrades[a]={status:d.status},M=!0,h=y,g=I,y==="unlocked")Oi(e,t,l);else if(y==="mysterious"){let L=!1;try{L=Ve(Ln())>=31}catch{}(!v||L)&&zm(e,t,l)}}h==="unlocked"?(s.locked=!1,s.hidden=!1,s.hideCost=!1,s.hideEffect=!1,s.useLockedBase=!1,(s.iconOverride===$n||s.iconOverride===xn)&&delete s.iconOverride,(s.titleOverride===cn||s.titleOverride===oo)&&delete s.titleOverride,delete s.descOverride,delete s.reason,d.status!=="unlocked"&&(f.upgrades[a]={status:"unlocked"},M=!0),Oi(e,t,l)):h==="mysterious"&&y!=="mysterious"&&(E(),y=Dm(s),I=Ju(y)),M&&Wm(f,l)}return s}function Vl(e,t){return!!wb(e,t).locked}function sh(e,t,n=null){if(!e||e.upgType!=="HM"||t?.isInfinite?.())return!1;let o=Number.isFinite(n)?n:lf(e),{capBn:r,cap:i}=mb(o);try{return t?.cmp?.(r)>=0}catch{}let s=Ve(t);return Number.isFinite(s)&&s>=i}function Nn(e,t){let n=Lo(e,t);return n.lvlBn?.clone?n.lvlBn.clone():gt(n.lvl??0)}function Eb(e,t){let n=Lo(e,t),o=n.upg;if(!o)return c.fromInt(0);if(n.nextCostBn&&!n.nextCostBn.isZero?.())return n.nextCostBn.clone?.()??c.fromAny(n.nextCostBn);let r=n.lvlBn??gt(n.lvl??0),i=Ve(r);try{return c.fromAny(o.costAtLevel(i))}catch{return c.fromInt(0)}}function ur(e,t,n,o=!0,r={}){let i=Lo(e,t),s=i.upg,{resetHmEvolutions:l=!1}=r??{};l&&s?.upgType==="HM"&&(i.hmEvolutions=0,df(s,0));let a=s?.lvlCap??1/0,u=i.lvl,f=cf(i.lvlBn??gt(i.lvl??0)),d=gt(n);d.isInfinite?.()&&(d=c.fromAny("Infinity"));let m=d;try{s&&rb(s,m)&&(m=c.fromAny("Infinity"))}catch{}if(o&&Number.isFinite(a)){let p=gt(a);m.cmp(p)>0&&(m=p)}if(o&&Number.isFinite(a)){let p=gt(a);m.cmp(p)>0&&(m=p)}if(i.lvlBn?.cmp&&i.lvlBn.cmp(m)===0)return i.lvl;let v=Ve(m);if(!s)return i.lvl=v,i.lvlBn=m,i.nextCostBn=c.fromInt(0),Xr(i),hr(e,t),io(),i.lvl;i.lvl=v,i.lvlBn=m;try{i.nextCostBn=c.fromAny(s.costAtLevel(v))}catch{i.nextCostBn=c.fromInt(0)}return Xr(i,{deferSave:r?.deferSave}),hr(e,t),ia(s,u,f,i.lvl,i.lvlBn),io(),i.lvl}function Mt(e){return pf.filter(t=>t.area===e)}function ua(e,t){let n=pr(e),o=ro(t),r=mr(typeof o=="string"?o:t);return pf.find(i=>n&&pr(i.area)!==n?!1:!!(ro(i.id)===o||r&&i.tieKey===r))||null}function Ro(e,t){let n=typeof t=="object"&&t?t:ua(e,t);return wb(e,n)}function _u(e){let t=String(e??"").trim();if(!t)return"";if(/^(?:https?:|data:|blob:)/i.test(t)||t.startsWith("//"))return t;let o=(a=>a.replace(/\\+/g,"/"))(t);if(o.startsWith("/"))return o.replace(/\/{2,}/g,"/");for(o=o.replace(/^\.\/+/u,"");o.startsWith("../");)o=o.slice(3);let r=o.split("/").map(a=>a.trim()).filter(a=>a&&a!==".");if(!r.length)return"";let i=[];for(let a of r){if(a===".."){i.pop();continue}i.push(a)}if(!i.length)return"";let s=new Set(["stats","currencies","misc"]);for(let a=0;a<i.length;a+=1){let u=i[a].toLowerCase();if(u==="img"){i.splice(a,1),a-=1;continue}if(u==="sc_upgrade_icons"||u==="sc_upg_icons")for(i[a]="sc_upg_icons";i[a+1]&&/^(?:sc_upgrade_icons|sc_upg_icons)$/i.test(i[a+1]);)i.splice(a+1,1)}if(!i.length)return"";i.length>1&&i[0].toLowerCase()==="sc_upg_icons"&&s.has(i[1].toLowerCase())&&i.shift(),i.length===1&&i.unshift("sc_upg_icons");let l=i.join("/");return l?`img/${l}`:""}function Cu(e){return e?_u(e.icon):""}function A1(e,t){let n=ua(e,t),o=Nn(e,t),r=Ve(o);return!n||r>=n.lvlCap?0:n.costAtLevel(r)}function Hs(e,t){let n=Lo(e,t),o=n.upg;if(!o)return{bought:0,spent:0};if(Vl(e,o))return{bought:0,spent:0};let r=n.lvl,i=n.lvlBn??gt(r),s=cf(i);if(r>=o.lvlCap)return{bought:0,spent:0};if(rb(o,i))return n.lvlBn=c.fromAny("Infinity"),n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),Xr(n),hr(e,t),io(),{bought:0,spent:0};let l=n.nextCostBn??c.fromAny(o.costAtLevel(r)),a=l instanceof c?l:c.fromAny(l??0),u=o.costType,f=u?R[u]:null,d=c.fromInt(0);if(f&&!a.isZero?.()){let v=f.value;if((v instanceof c?v:c.fromAny(v??0)).cmp(a)<0)return{bought:0,spent:0};d=a.clone?.()??c.fromAny(a),f.sub(d)}else{if(!a.isZero?.())return{bought:0,spent:0};d=c.fromInt(0)}let m=i.add(c.fromInt(1));return n.lvlBn=m,n.lvl=Ve(m),n.nextCostBn=c.fromAny(typeof o.nextCostAfter=="function"?o.nextCostAfter(d,n.lvl):o.costAtLevel(n.lvl)),Xr(n),hr(e,t),ia(o,r,s,n.lvl,n.lvlBn),io(),{bought:1,spent:d}}function Lu(e,t){let n=Lo(e,t),o=n.upg;if(!o||o.upgType!=="HM")return{evolved:!1};let r=n.lvlBn??gt(n.lvl);if(!sh(o,r,n.hmEvolutions))return{evolved:!1};let i=la(n.hmEvolutions)+1;n.hmEvolutions=i,df(o,i);try{n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl))}catch{n.nextCostBn=c.fromAny("Infinity")}return Xr(n),hr(e,t),ia(o,n.lvl,r,n.lvl,r),io(),{evolved:!0}}function xl(e,t){let n=Lo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Vl(e,o))return{bought:c.fromInt(0),spent:c.fromInt(0)};let r=n.lvl,i=n.lvlBn??gt(r),s=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(s)&&r>=s)return{bought:0,spent:c.fromInt(0)};let a=R[o.costType]?.value,u=a instanceof c?a.clone?.()??c.fromAny(a):c.fromAny(a??0);if(o.unlockUpgrade&&(n.nextCostBn?.clone?.()??c.fromInt(0)).isZero?.())return Hs(e,t);if(u.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};if(u.isInfinite?.()){let y=i.clone?.()??gt(i),I=Ve(y),E=y.toStorage?.(),M;if(o.upgType==="HM"){if(M=c.fromAny("Infinity"),!o.lvlCapBn?.isInfinite?.()){let G=c.fromAny("Infinity");o.lvlCapBn=G,o.lvlCap=Number.POSITIVE_INFINITY,o.lvlCapFmtHtml=Hr(G),o.lvlCapFmtText=ra(G)}}else{let G=o.lvlCapBn?.clone?.()??dr(o.lvlCap??1/0,1/0);M=G?.clone?.()??G}let A=M.sub(y);if(A.isZero?.()){let G=b1(M,y);G.isZero?.()||(A=G)}if(A.isZero?.()){let G=M.toStorage?.();if(E&&G&&E!==G)if(M.isInfinite?.())try{A=c.fromAny("Infinity")}catch{A=c.fromInt(1)}else A=c.fromInt(1)}return n.lvlBn=M.clone?.()??M,o.upgType==="NM"&&Number.isFinite(o.lvlCap)?n.lvl=o.lvlCap:n.lvl=Ve(n.lvlBn),n.nextCostBn=c.fromAny("Infinity"),R[o.costType].set(u),Xr(n),hr(e,t),ia(o,I,y,n.lvl,n.lvlBn),io(),{bought:A,spent:c.fromInt(0)}}let f=n.nextCostBn?.clone?.()??c.fromAny(o.costAtLevel(r));if(u.cmp(f)<0)return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(s)?Math.max(0,s-r):sa;if(!(d>0))return{bought:c.fromInt(0),spent:c.fromInt(0)};let m=oa(o,i,u,d),v=m.count instanceof c?m.count:c.fromAny(m.count??0);if(v.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let p=m.spent??c.fromInt(0),h=u.sub(p);R[o.costType].set(h);let g=i.add(v);return n.lvlBn=g,n.lvl=Ve(g),m.nextPrice?n.nextCostBn=m.nextPrice:Number.isFinite(n.lvl)?n.nextCostBn=c.fromAny(o.costAtLevel(n.lvl)):n.nextCostBn=c.fromAny("Infinity"),Xr(n),hr(e,t),ia(o,r,i,n.lvl,n.lvlBn),io(),{bought:v,spent:p}}function Xs(e,t,n){let o=Lo(e,t),r=o.upg;if(!r)return{bought:0,spent:c.fromInt(0)};if(Vl(e,r))return{bought:c.fromInt(0),spent:c.fromInt(0)};let i=o.lvl,s=o.lvlBn??gt(i),l=Number.isFinite(r.lvlCap)?Math.max(0,Math.floor(r.lvlCap)):1/0;if(Number.isFinite(l)&&i>=l)return{bought:0,spent:c.fromInt(0)};let u=R[r.costType]?.value,f=u instanceof c?u.clone?.()??c.fromAny(u):c.fromAny(u??0);if(f.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let d=Number.isFinite(l)?Math.max(0,l-i):void 0,m=Number.isFinite(n)?Math.max(0,Math.floor(n)):n instanceof c?Ve(n):void 0,v=Number.isFinite(d)?Number.isFinite(m)?Math.min(d,m):d:m,p=oa(r,s,f,v),h=p.count instanceof c?p.count:c.fromAny(p.count??0);if(h.isZero?.())return{bought:c.fromInt(0),spent:c.fromInt(0)};let g=p.spent??c.fromInt(0),y=f.sub(g);R[r.costType].set(y);let I=s.add(h);return o.lvlBn=I,o.lvl=Ve(I),p.nextPrice?o.nextCostBn=p.nextPrice:Number.isFinite(o.lvl)?o.nextCostBn=c.fromAny(r.costAtLevel(o.lvl)):o.nextCostBn=c.fromAny("Infinity"),Xr(o),hr(e,t),ia(r,i,s,o.lvl,o.lvlBn),io(),{bought:h,spent:g}}function Mi(e,t,n,o=sa,r={}){let i=n instanceof c?n:c.fromAny(n??0),s=oa(e,t,i,o,r);return{count:s.count,spent:s.spent??c.fromInt(0),nextPrice:s.nextPrice??c.fromInt(0),numericCount:s.numericCount??0}}function io(){if(ea){Hm=!0,Rd();return}Rd(),Fc()}function eo(){return document.getElementById("game-root")?.classList?.contains("area-cove"),Se.STARTER_COVE}function Vs(e,t){let n=ua(e,t);if(!n)return null;let o=Nn(e,t),r=Ve(o),i=Hr(o),s=ra(o),l=n.lvlCapBn??dr(n.lvlCap??1/0,1/0),a=n.lvlCapFmtHtml??Hr(l),u=n.lvlCapFmtText??ra(l),f=r<n.lvlCap?Eb(e,t):c.fromInt(0),d=Hr(f),m=R[n.costType]?.value,v=m instanceof c?m:c.fromAny(m??0),p=Ro(e,t),h=!!p.locked,g=p.titleOverride??n.title,y=p.descOverride??n.desc;if(e===Ze&&ro(t)===ai){let A=Yc();if(Math.abs(A-1)>1e-4&&y){let G=Te(A);y=y.replace("Generates the equivalent of picking up a Coin on an interval","Generates the equivalent of picking up "+G+" Coins on an interval")}}let I=rh(n,e),E="";typeof n.effectSummary=="function"&&!(h&&p.hideEffect)&&(E=n.effectSummary(r),typeof E=="string"&&(E=E.trim()));let M=p.iconOverride??Cu(n);return{upg:n,lvl:r,lvlBn:o,lvlFmtHtml:i,lvlFmtText:s,lvlCapBn:l,lvlCapFmtHtml:a,lvlCapFmtText:u,nextPrice:f,nextPriceFmt:d,have:v,haveFmt:R[n.costType]?.fmt(v)??String(v),effect:E,iconUrl:M,lockState:p,locked:h,areaKey:e,hmMilestones:I,displayTitle:g,displayDesc:y,unlockUpgrade:!!n.unlockUpgrade,hmEvolutions:n.upgType==="HM"?Jm(e,t):0,hmReadyToEvolve:n.upgType==="HM"?sh(n,o,Jm(e,t)):!1,hmNextMilestone:n.upgType==="HM"?gb(n,o,e):null}}function N1(e,t){let n=ua(e,t);if(!n||n.upgType!=="HM")return null;let o=Nn(e,t);return gb(n,o,e)}function R1(e){return ie(Ee(e??0))}function zd(e,t){let n=Lo(e,t),o=n.upg;if(!o)return{bought:0};let r=Sb(e,n.slot);if(Kt(r))return{bought:0};let i=Pi(e,t,n.slot);if(Kt(i))return{bought:0};if(Vl(e,o))return{bought:0};let s=n.lvl,l=n.lvlBn??gt(s),a=Number.isFinite(o.lvlCap)?Math.max(0,Math.floor(o.lvlCap)):1/0;if(Number.isFinite(a)&&s>=a)return{bought:0};if(o.upgType==="HM"&&sh(o,l,n.hmEvolutions))return{bought:0};let f=R[o.costType]?.value,d=f instanceof c?f.clone?.()??c.fromAny(f):c.fromAny(f??0);if(d.isZero?.())return{bought:0};let m=oa(o,l,d,sa),v=m.count instanceof c?m.count:c.fromAny(m.count??0);if(v.isZero?.())return{bought:0};let p=l.add(v);return c1(),ur(e,t,p,!0,{deferSave:!0}),{bought:v}}function Ll(e,t){let n=Lo(e,t),o=n.upg;if(!o)return{bought:0,spent:c.fromInt(0)};if(Vl(e,o))return{bought:0,spent:c.fromInt(0)};let r=n.lvlBn??gt(n.lvl),i=Ve(r),s=Number.isFinite(o.lvlCap)?o.lvlCap:1/0;if(Number.isFinite(s)&&i>=s)return{bought:0,spent:c.fromInt(0)};let l=R[o.costType],a=l?.value instanceof c?l.value.clone():c.fromAny(l?.value??0);if(a.isZero())return{bought:0,spent:c.fromInt(0)};let u=Mi(o,r,a,c.fromAny("Infinity")),f=u.numericCount;if(f<=0)return{bought:0,spent:c.fromInt(0)};let d=v=>{if(v<=0)return!0;let p=rf(o,i,v-1),h=a.sub(p),g=i+v-1,y=c.fromAny(o.costAtLevel(g)),I=h.div(10);return y.cmp(I)<=0},m=0;if(f<2e3){let v=u.spent,p=f;for(;p>0;){let h=i+p-1,g=c.fromAny(o.costAtLevel(h)),y=v.sub(g),E=a.sub(y).div(10);if(g.cmp(E)<=0){m=p;break}v=y,p--}}else{let v=0,p=f;for(;v<p;){let h=Math.ceil((v+p)/2);d(h)?v=h:p=h-1}m=v}return m<=0?{bought:0,spent:c.fromInt(0)}:Xs(e,t,m)}var sa,Xt,iA,l1,sf,Se,ea,eb,Gl,Hm,Gr,tb,f1,Um,_e,ib,d1,$n,xn,cn,oo,sb,Qm,p1,m1,h1,g1,ab,lb,cb,y1,ef,tf,nf,Xm,sA,Vm,Zu,Jt,Qu,S1,qm,vb,Gm,E1,pf,Zm,nb,ho=De(()=>{vt();xt();qt();An();go();mo();yn();li();ws();Fp();$c();sa=c.fromAny("Infinity"),Xt=1e3,iA=c.fromInt(1e3),l1=3,sf="",Se={STARTER_COVE:"starter_cove",AUTOMATION:Ze,DNA:Ht},ea=!1,eb=new Map,Gl=new Map,Hm=!1,Gr=new Map,tb=null;f1=308;Um=1024;_e={FASTER_COINS:"coin_1",UNLOCK_XP:"none_1",FASTER_COINS_II:"book_1",COIN_VALUE_I:"book_2",BOOK_VALUE_I:"book_3",XP_VALUE_I:"coin_2",UNLOCK_FORGE:"none_2",COIN_VALUE_II:"gold_1",XP_VALUE_II:"gold_2",MP_VALUE_I:"gold_3",MAGNET:"gold_4",ENDLESS_XP:"coin_3",UNLOCK_INFUSE:"none_3",COIN_VALUE_III:"magic_1",XP_VALUE_III:"magic_2",MP_VALUE_II:"magic_3",FASTER_COINS_III:"magic_4",ENDLESS_MP:"coin_4",UNLOCK_SURGE:"none_4",ENDLESS_COINS:"book_4",ENDLESS_COINS_II:"gold_5",ENDLESS_COINS_III:"magic_5"},ib=[{level:10,multiplier:1.5,target:"self"},{level:25,multiplier:2,target:"self"},{level:50,multiplier:5,target:"mp"},{level:100,multiplier:10,target:"xp"},{level:200,multiplier:15,target:"coin"},{level:400,multiplier:25,target:"self"},{level:800,multiplier:100,target:"self"}],d1={[Se.STARTER_COVE]:ib},$n="img/misc/locked.webp",xn="img/misc/mysterious.webp",cn="Hidden Upgrade",oo="Locked Upgrade",sb=new Set([_e.COIN_VALUE_II,_e.XP_VALUE_II,_e.MP_VALUE_I,_e.MAGNET,_e.ENDLESS_XP]),Qm=new Set([_e.COIN_VALUE_III,_e.XP_VALUE_III,_e.MP_VALUE_II,_e.FASTER_COINS_III,_e.ENDLESS_MP]),p1=new Set([_e.UNLOCK_XP,_e.UNLOCK_FORGE,_e.UNLOCK_INFUSE,_e.UNLOCK_SURGE,...sb,...Qm]),m1=new Set([_e.FASTER_COINS_II,_e.COIN_VALUE_I,_e.BOOK_VALUE_I,_e.XP_VALUE_I]),h1=new Set(["starter_cove:3","starter_cove:4","starter_cove:5","starter_cove:6"]),g1="ccc:merchantMet",ab="ccc:shop:reveals",lb="ccc:shop:permaUnlocks",cb="ccc:shop:permaMyst",y1={locked:0,mysterious:1,unlocked:2},ef=new Map,tf=new Map,nf=new Map,Xm=new Map,sA=mr(_e.BOOK_VALUE_I),Vm=c,Zu=e=>Vm.fromAny(e??0),Jt={addPctPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Zu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Vm.fromInt(1).add(r.mulDecimal(n))}catch{let i=Ee(r);if(Number.isFinite(i)){let s=i+Math.log10(Math.abs(t||0));return ie(s)}return c.fromAny("Infinity")}}},addFlatPerLevel(e){let t=Number(e),n=String(t);return o=>{let r=Zu(o);try{let i=r.toPlainIntegerString?.();if(i&&i!=="Infinity"&&i.length<=15){let s=Math.max(0,Number(i));return 1+t*s}}catch{}try{return Vm.fromInt(1).add(r.mulDecimal(n))}catch{return 1}}},powPerLevel(e){let t=Number(e),n=Number.isFinite(t)?t:Number(Zu(e).toScientific(6)),o=Math.log10(n),r=1e305;return i=>{let s=Zu(i);if(o>0){let l=Ee(s);if(Number.isFinite(l)){let a=Math.log10(r/o);if(l>=a)return c.fromAny("Infinity")}else if(l>0)return c.fromAny("Infinity")}try{let l=s.toPlainIntegerString?.();if(l&&l!=="Infinity"&&l.length<=7){let a=Math.max(0,Number(l)),u=o*a;if(u<308){let f=Math.pow(n,a);if(Number.isFinite(f))return f}return ie(u)}}catch{}try{let l=Ve(s),a=o*l;return ie(a)}catch{return c.fromInt(1)}}}};Qu=Math.log(10);S1={STANDARD(e){if(`${e?.upgType??""}`.toUpperCase()==="HM"){let n=lf(e),o=1e3;if(n>o){let r=n-o,i=.1*o,s=1.001,l=.1*(s/(s-1))*(Math.pow(s,r)-1);return 1.5+i+l}return 1.5+.1*n}return 1.2},HM(e){let t=lf(e),n=1.5+.1*t,o=1e6;if(t>o){let r=t-o,l=5*Math.exp(18e-8*r),a=1/0;return l<308&&(a=Math.pow(10,l)),{ratio:a,ratioLog10:l}}return n},NM(){return 1.2}};qm=(()=>{try{let e=Ve(sa);return Number.isFinite(e)?e<=0?0:Math.floor(e):Number.POSITIVE_INFINITY}catch{return Number.MAX_SAFE_INTEGER}})(),vb=new ArrayBuffer(8),Gm=new Float64Array(vb),E1=new BigInt64Array(vb);pf=[{area:Se.STARTER_COVE,id:1,tie:_e.FASTER_COINS,title:"Faster Coins",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:10,baseCost:10,costType:"coins",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins1.webp",costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:2,tie:_e.UNLOCK_XP,title:"Unlock XP",desc:`Unlocks the XP system and a new Merchant dialogue\nXP system: Collect Coins for XP to level up and gain Books\nEach XP Level also boosts Coin value by a decent amount`,lvlCap:1,upgType:"NM",icon:"stats/xp/xp.webp",baseIconOverride:"stats/xp/xp_base.webp",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:wn,effectSummary(){return""},onLevelChange({newLevel:e,newLevelBn:t}){if(Number.isFinite(e)?e>=1:(t?.cmp?.(c.fromInt(1))??-1)>=0)try{ni()}catch{}}},{area:Se.STARTER_COVE,id:3,tie:_e.FASTER_COINS_II,title:"Faster Coins II",desc:"Increases Coin Spawn Rate by +10% per level",lvlCap:15,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_spawn",icon:"sc_upgrade_icons/faster_coins2.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(.1)},{area:Se.STARTER_COVE,id:4,tie:_e.COIN_VALUE_I,title:"Coin Value",desc:"Increases Coin value by +50% per level",lvlCap:100,baseCost:1,costType:"books",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(.5),onLevelChange(){try{jt()}catch{}}},{area:Se.STARTER_COVE,id:5,tie:_e.BOOK_VALUE_I,title:"Book Value",desc:"Doubles Books gained when increasing XP Level",lvlCap:1,baseCost:10,costType:"books",upgType:"NM",effectType:"book_value",icon:"sc_upgrade_icons/book_val1.webp",requiresUnlockXp:!0,costAtLevel(){return this.baseCostBn?.clone?.()??c.fromInt(1)},nextCostAfter(){return this.costAtLevel()},effectSummary(e){return"Book value bonus: 2x"},effectMultiplier:e=>of(e)>0?2:1,onLevelChange({newLevel:e}){Ja(e)}},{area:Se.STARTER_COVE,id:6,tie:_e.XP_VALUE_I,title:"XP Value",desc:"Increases XP value by +200% per level",lvlCap:10,baseCost:1e3,costType:"coins",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:Jt.addFlatPerLevel(2)},{area:Se.STARTER_COVE,id:7,tie:_e.UNLOCK_FORGE,title:"Unlock Forge",desc:"Unlocks the Reset tab and the Forge reset in the Delve menu",lvlCap:1,upgType:"NM",icon:"misc/forge.webp",baseIconOverride:"stats/mp/mp_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 31 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:wn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Om()}catch{}}},{area:Se.STARTER_COVE,id:8,tie:_e.COIN_VALUE_II,title:"Coin Value II",desc:`Increases Coin value by +${K(c.fromInt(1e3))}% per level`,lvlCap:100,baseCost:1,costType:"gold",upgType:"NM",effectType:"coin_value",icon:"sc_upgrade_icons/coin_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(10),onLevelChange(){try{jt()}catch{}}},{area:Se.STARTER_COVE,id:9,tie:_e.XP_VALUE_II,title:"XP Value II",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"gold",upgType:"NM",effectType:"xp_value",icon:"sc_upgrade_icons/xp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:10,tie:_e.MP_VALUE_I,title:"MP Value",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"gold",upgType:"NM",effectType:"mp_value",icon:"sc_upgrade_icons/mp_val1.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:11,tie:_e.MAGNET,title:"Magnet",desc:`Increases Magnet radius by +1 Unit per level\nMagnet: Increases the distance from which you can collect Coins`,lvlCap:5,baseCost:100,costType:"gold",upgType:"NM",effectType:"magnet_radius",icon:"sc_upgrade_icons/magnet.webp",requiresUnlockXp:!0,scaling:{ratio:5},costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=of(e),n=Te(t);return`Magnet radius: ${n} ${n==="1"?"Unit":"Units"}`},effectMultiplier:e=>of(e)},{area:Se.STARTER_COVE,id:12,tie:_e.ENDLESS_XP,title:"Endless XP",desc:`The first Milestone-type upgrade\nMilestones: Reach certain upgrade levels for powerful buffs\nMultiplies XP value by 1.1x per level`,lvlCap:Xt,baseCost:1e6,costType:"coins",upgType:"HM",effectType:"xp_value",icon:"sc_upg_icons/xp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return En(this,e)},nextCostAfter(e,t){return En(this,t)},computeLockState:wn,effectSummary(e){let t=gt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ko(this,t,this.area),r=bt(n,o);return`XP value bonus: ${Te(r)}x`},effectMultiplier:Jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:13,tie:_e.UNLOCK_INFUSE,title:"Unlock Infuse",desc:"Unlocks the Infuse reset",lvlCap:1,upgType:"NM",icon:"misc/infuse.webp",baseIconOverride:"misc/infuse_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 101 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:wn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Pm()}catch{}}},{area:Se.STARTER_COVE,id:14,tie:_e.COIN_VALUE_III,title:"Coin Value III",desc:`Increases Coin value by +${K(c.fromInt(1e5))}% per level`,lvlCap:100,baseCost:1,costType:"magic",upgType:"NM",effectType:"coin_value",icon:"sc_upg_icons/coin_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin value bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(1e3)},{area:Se.STARTER_COVE,id:15,tie:_e.XP_VALUE_III,title:"XP Value III",desc:"Increases XP value by +100% per level",lvlCap:100,baseCost:3,costType:"magic",upgType:"NM",effectType:"xp_value",icon:"sc_upg_icons/xp_val3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=this.effectMultiplier(e);return`XP value bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:16,tie:_e.MP_VALUE_II,title:"MP Value II",desc:"Increases MP value by +100% per level",lvlCap:100,baseCost:25,costType:"magic",upgType:"NM",effectType:"mp_value",icon:"sc_upg_icons/mp_val2.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=this.effectMultiplier(e);return`MP value bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:17,tie:_e.FASTER_COINS_III,title:"Faster Coins III",desc:"Doubles Coin Spawn Rate",lvlCap:1,baseCost:100,costType:"magic",upgType:"NM",effectType:"coin_spawn",icon:"sc_upg_icons/faster_coins3.webp",requiresUnlockXp:!0,costAtLevel(e){return Ut(this,e)},nextCostAfter(e,t){return Ut(this,t)},computeLockState:wn,effectSummary(e){let t=this.effectMultiplier(e);return`Coin Spawn Rate bonus: ${Te(t)}x`},effectMultiplier:Jt.addPctPerLevel(1)},{area:Se.STARTER_COVE,id:18,tie:_e.ENDLESS_MP,title:"Endless MP",desc:"Multiplies MP value by 1.1x per level",lvlCap:Xt,baseCost:1e12,costType:"coins",upgType:"HM",effectType:"mp_value",icon:"sc_upg_icons/mp_val_hm.webp",requiresUnlockXp:!0,scalingPreset:"HM",costAtLevel(e){return En(this,e)},nextCostAfter(e,t){return En(this,t)},computeLockState:wn,effectSummary(e){let t=gt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ko(this,t,this.area),r=bt(n,o);return`MP value bonus: ${Te(r)}x`},effectMultiplier:Jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:19,tie:_e.UNLOCK_SURGE,title:"Unlock Surge",desc:"Unlocks the Surge reset",lvlCap:1,upgType:"NM",icon:"",baseIconOverride:"misc/surge_plus_base.webp",requiresUnlockXp:!0,revealRequirement:"Reach XP Level 201 to reveal this upgrade",unlockUpgrade:!0,costAtLevel(){return c.fromInt(0)},nextCostAfter(){return c.fromInt(0)},computeLockState:wn,onLevelChange({newLevel:e}){if((e??0)>=1)try{Bm()}catch{}}},{area:Se.STARTER_COVE,id:20,tie:_e.ENDLESS_COINS,title:"Endless Coins",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Xt,baseCost:1e17,costType:"books",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm1.webp",scalingPreset:"HM",costAtLevel(e){return En(this,e)},nextCostAfter(e,t){return En(this,t)},computeLockState(e){let t=bn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=3n:typeof t=="number"&&(n=t>=3),n)return{locked:!1};let o=!1;try{let r=Ln();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 3 to reveal this upgrade";return{locked:!0,iconOverride:xn,titleOverride:cn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:oo,descOverride:"Locked"}},onLevelChange(){try{jt()}catch{}},effectSummary(e){let t=gt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ko(this,t,this.area),r=bt(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:Jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:21,tie:_e.ENDLESS_COINS_II,title:"Endless Coins II",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Xt,baseCost:1e11,costType:"gold",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm2.webp",scalingPreset:"HM",costAtLevel(e){return En(this,e)},nextCostAfter(e,t){return En(this,t)},computeLockState(e){let t=bn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=5n:typeof t=="number"&&(n=t>=5),n)return{locked:!1};let o=!1;try{let r=Ln();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 5 to reveal this upgrade";return{locked:!0,iconOverride:xn,titleOverride:cn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:oo,descOverride:"Locked"}},onLevelChange(){try{jt()}catch{}},effectSummary(e){let t=gt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ko(this,t,this.area),r=bt(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:Jt.powPerLevel(1.1)},{area:Se.STARTER_COVE,id:22,tie:_e.ENDLESS_COINS_III,title:"Endless Coins III",desc:"Multiplies Coin value by 1.1x per level",lvlCap:Xt,baseCost:1e14,costType:"magic",upgType:"HM",effectType:"coin_value",icon:"sc_upg_icons/coin_val_hm3.webp",scalingPreset:"HM",costAtLevel(e){return En(this,e)},nextCostAfter(e,t){return En(this,t)},computeLockState(e){let t=bn(),n=!1;if(t===1/0||typeof t=="string"&&t==="Infinity"?n=!0:typeof t=="bigint"?n=t>=7n:typeof t=="number"&&(n=t>=7),n)return{locked:!1};let o=!1;try{let r=Ln();o=Ve(r)>=201}catch{}if(o){let r="Reach Surge 7 to reveal this upgrade";return{locked:!0,iconOverride:xn,titleOverride:cn,descOverride:r,reason:r,hidden:!0,hideCost:!0,hideEffect:!0,useLockedBase:!0}}return{locked:!0,hidden:!1,hideCost:!0,hideEffect:!0,useLockedBase:!0,titleOverride:oo,descOverride:"Locked"}},onLevelChange(){try{jt()}catch{}},effectSummary(e){let t=gt(e),n;try{n=this.effectMultiplier(t)}catch{n=1}let{selfMult:o}=Ko(this,t,this.area),r=bt(n,o);return`Coin value bonus: ${Te(r)}x`},effectMultiplier:Jt.powPerLevel(1.1)},...ny,...Bv];for(let e of pf){let t=mr(e.tie??e.tieKey);t&&!Xm.has(t)&&Xm.set(t,e),e.baseCost=dr(e.baseCost??0,0),e.baseCostBn=e.baseCost,e._dnaEffectVal&&(e._costScaling==="HM"&&(e.costAtLevel=function(n){return En(this,n)},e.nextCostAfter=function(n,o){return En(this,o)}),typeof e.effectMultiplier!="function"&&(e.effectMultiplier=Jt.powPerLevel(e._dnaEffectVal)),typeof e.effectSummary!="function"&&(e.effectSummary=function(n){let o=gt(n),r;try{r=this.effectMultiplier(o)}catch{r=1}let{selfMult:i}=Ko(this,o,this.area),s=bt(r,i);if(typeof this.bonusLine=="function")return this.bonusLine(n,s);let l="Bonus";return this.effectType==="coin_value"&&(l="Coin value bonus"),this.effectType==="xp_value"&&(l="XP value bonus"),`${l}: ${Te(s)}x`})),e.numUpgEvolutions=la(e.numUpgEvolutions),e.upgType==="HM"?df(e,e.numUpgEvolutions):(e.lvlCapBn=dr(e.lvlCap??1/0,1/0),e.lvlCap=jm(e.lvlCapBn),e.lvlCapFmtHtml=Hr(e.lvlCapBn),e.lvlCapFmtText=ra(e.lvlCapBn)),e.bulkMeta=L1(e),ca(e)}Zm=new Map;nb=new Map;typeof window<"u"&&(ob(b()),window.addEventListener("saveSlot:change",()=>{ob(b()),io()}),window.addEventListener("surge:level:change",()=>{io()}));iy()});var Kb={};It(Kb,{applyAllCurrencyOverridesForActiveSlot:()=>ec,applyStatMultiplierOverride:()=>Zn,getDebugCurrencyMultiplierOverride:()=>zl,getDebugStatMultiplierOverride:()=>K1,setDebugCurrencyMultiplierOverride:()=>Db,setDebugPanelAccess:()=>NL,setDebugStatMultiplierOverride:()=>Gn});function Ql(){let e=document.querySelector(".menu-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"}function U1(){let e=document.getElementById("game-root");if(!e)return!1;let t=window.getComputedStyle?.(e);return t?t.display!=="none"&&t.visibility!=="hidden"&&!e.hidden:e.style.display!=="none"&&e.style.visibility!=="hidden"&&!e.hidden}function un(e){typeof e=="function"&&uh.push(e)}function If(){return{sections:new Set,subsections:new Set}}function D1(){let e=document.getElementById(jl);if(!e)return If();let t=new Set;e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;o.classList.contains("expanded")&&t.add(r)});let n=new Set;return e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;o.classList.contains("expanded")&&n.add(r)}),{sections:t,subsections:n}}function $1(e){let{sections:t,subsections:n}=kb??If();e.querySelectorAll(".debug-panel-section-toggle").forEach(o=>{let r=o.dataset.sectionKey??o.textContent;if(!t.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(o=>{let r=o.dataset.subsectionKey??o.textContent;if(!n.has(r))return;let i=o.nextElementSibling;o.classList.add("expanded"),i&&i.classList.add("active")})}function Rb(){uh.forEach(e=>{try{e?.()}catch{}}),uh=[],hh.length=0}function Dt(e){!e||typeof e.refresh!="function"||hh.push(e)}function dt(e){hh.forEach(t=>{if(!(typeof e=="function"&&!e(t)))try{t.refresh()}catch{}})}function q1(){if(typeof window>"u")return;let e=p=>{let{key:h,slot:g}=p?.detail??{},y=g??b();dt(I=>I.type==="currency"&&I.key===h&&I.slot===y)};window.addEventListener("currency:change",e,{passive:!0}),un(()=>window.removeEventListener("currency:change",e));let t=p=>{let{key:h,slot:g}=p?.detail??{},y=g??b();dt(I=>I.type==="currency-mult"&&I.key===h&&I.slot===y)};window.addEventListener("currency:multiplier",t,{passive:!0}),un(()=>window.removeEventListener("currency:multiplier",t));let n=p=>{let{slot:h,changeType:g,unlocked:y}=p?.detail??{},I=h??b();dt(E=>E.type==="xp"&&E.slot===I),dt(E=>E.type==="stat-mult"&&E.key==="xp"&&E.slot===I),(g==="unlock"||typeof y=="boolean")&&dt(E=>E.type==="unlock"&&(E.slot==null||E.slot===I))};window.addEventListener("xp:change",n,{passive:!0}),window.addEventListener("xp:unlock",n,{passive:!0}),un(()=>{window.removeEventListener("xp:change",n),window.removeEventListener("xp:unlock",n)});let o=p=>{let{changeType:h,slot:g}=p?.detail??{},y=g??b();dt(I=>I.type==="mutation"&&I.slot===y),dt(I=>I.type==="stat-mult"&&I.key==="mutation"&&I.slot===y),h==="unlock"&&dt(I=>I.type==="unlock"&&(I.slot==null||I.slot===y))};window.addEventListener("mutation:change",o,{passive:!0}),un(()=>window.removeEventListener("mutation:change",o));let r=()=>{let p=b();dt(h=>h.type==="upgrade"&&h.slot===p),dt(h=>h.type==="currency-mult"&&h.slot===p),dt(h=>h.type==="stat-mult"&&h.slot===p)};document.addEventListener("ccc:upgrades:changed",r,{passive:!0}),un(()=>document.removeEventListener("ccc:upgrades:changed",r));let i=()=>{let p=b();dt(h=>h.slot===p)};window.addEventListener("saveSlot:change",i,{passive:!0}),un(()=>window.removeEventListener("saveSlot:change",i));let s=p=>{let{slot:h,key:g}=p?.detail??{},y=h??b();dt(I=>I.type==="unlock"&&(I.slot==null||I.slot===y)&&(I.key==null||I.key===g))};window.addEventListener("unlock:change",s,{passive:!0}),un(()=>window.removeEventListener("unlock:change",s));let l=p=>{let{slot:h}=p?.detail??{},g=h??b();dt(y=>y.type==="workshop-level"&&y.slot===g)};window.addEventListener("workshop:change",l,{passive:!0}),un(()=>window.removeEventListener("workshop:change",l));let a=p=>{let{slot:h}=p?.detail??{},g=h??b();dt(y=>y.type==="surge-level"&&y.slot===g)};window.addEventListener("surge:level:change",a,{passive:!0}),un(()=>window.removeEventListener("surge:level:change",a));let u=p=>{let{slot:h}=p?.detail??{},g=h??b();dt(y=>y.type==="tsunami-nerf"&&(y.slot==null||y.slot===g))};window.addEventListener("surge:nerf:change",u,{passive:!0}),un(()=>window.removeEventListener("surge:nerf:change",u));let f=p=>{let{slot:h}=p?.detail??{},g=h??b();dt(y=>y.type==="lab-level"&&(y.slot==null||y.slot===g)),dt(y=>y.type==="stat-mult"&&y.key==="rp"&&(y.slot==null||y.slot===g))};window.addEventListener("lab:level:change",f,{passive:!0}),un(()=>window.removeEventListener("lab:level:change",f));let d=p=>{let{id:h,level:g}=p?.detail??{},y=b();dt(I=>I.type==="lab-node-level"&&I.slot===y&&I.id===h),h===1&&dt(I=>I.type==="tsunami-nerf"&&(I.slot==null||I.slot===y)),h===4&&dt(I=>I.type==="unlock"&&(I.slot==null||I.slot===y))};window.addEventListener("lab:node:change",d,{passive:!0}),un(()=>window.removeEventListener("lab:node:change",d));let m=p=>{let{id:h,rp:g}=p?.detail??{},y=b();dt(I=>I.type==="lab-node-rp"&&I.slot===y&&I.id===h)};window.addEventListener("lab:node:rp",m,{passive:!0}),un(()=>window.removeEventListener("lab:node:rp",m));let v=p=>{let h=b();dt(g=>g.type==="combo"&&g.slot===h)};$y(v),un(()=>qy(v))}function wf(){return[{key:Se.STARTER_COVE,title:"The Cove",currencies:[{key:Re.COINS,label:"Coins"},{key:Re.BOOKS,label:"Books"},{key:Re.GOLD,label:"Gold"},{key:Re.MAGIC,label:"Magic"},{key:Re.GEARS,label:"Gears"},{key:Re.WAVES,label:"Waves"},{key:Re.DNA,label:"DNA"}],stats:[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"}]}]}function Ob(){if(document.getElementById(mf))return;let e=document.querySelector('link[href$="css/misc/debug.css"]');if(e){e.id=mf;return}if(document.querySelector('link[href$="styles.css"]')){let o=document.createElement("meta");o.id=mf,o.setAttribute("data-debug-panel-styles","bundled"),document.head.appendChild(o);return}let n=document.createElement("link");n.rel="stylesheet",n.href="css/misc/debug.css",n.id=mf,document.head.appendChild(n)}function dh(){let e=document.getElementById(Tb);e&&e.remove()}function G1(){return $i&&Je&&b()!=null&&!Ql()&&U1()}function H1(e){e?.detail?.visible&&Uo(),Lf()}function gf(e,t,n){let o=document.createElement("div");o.className="debug-panel-section";let r=document.createElement("button");r.className="debug-panel-section-toggle",r.type="button",r.textContent=e;let i=t||`${e}-${Ab++}`;r.dataset.sectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-section-content",s.id=t,s.dataset.sectionKey=i,n(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),o}function qn(e,t,{defaultExpanded:n=!1}={}){let o=document.createElement("div");o.className="debug-panel-subsection";let r=document.createElement("button");r.type="button",r.className="debug-panel-subsection-toggle",r.textContent=e;let i=`${e}-${Nb++}`;r.dataset.subsectionKey=i,o.appendChild(r);let s=document.createElement("div");s.className="debug-panel-subsection-content",s.dataset.subsectionKey=i,t(s),o.appendChild(s);let l=null,a=u=>{let f=r.classList.toggle("expanded");s.classList.toggle("active",f)};return r.addEventListener("click",u=>{if(l&&l!=="mouse"){l=null;return}l=null,a(u)}),n&&(r.classList.add("expanded"),s.classList.add("active")),o}function Rt(e,t){if(e===t)return!0;if(e==null||t==null)return e==null&&t==null;if(typeof e?.cmp=="function")try{return e.cmp(t)===0}catch{}if(typeof t?.cmp=="function")try{return t.cmp(e)===0}catch{}try{return Object.is(String(e),String(t))}catch{return!1}}function gh(e,t=b()){let n=t??b();return n==null?null:`${wt.CURRENCY[e]}:${n}`}function Wl(e,t=b()){let n=t??b();if(n==null)return c.fromInt(0);let o=R?.[e];if(o)try{return o.value??c.fromInt(0)}catch{}try{return Ba(n,e)}catch{return c.fromInt(0)}}function X1(e,t,n=b()){let o=n??b(),r=Wl(e,o);if(o==null||o!==b())return{previous:r,next:r};let i=gh(e,o),s=i&&ao(i);s&&ha(i);let l=r;try{Mn(o),l=Ji(e,t,{previous:r})??r,i&&ct(i)}catch{}finally{s&&Hi(i)}return dt(a=>a.type==="currency"&&a.key===e&&a.slot===o),{previous:r,next:l}}function so(e,t){return`${e??"null"}::${t}`}function yh(e,t){return Zl.get(so(e,t))??null}function V1(e,t=b()){let n=t??b();return!e||n==null?null:`${wt.MULTIPLIER[e]}:${n}`}function Y1(e,t=b()){let n=so(t,e);Zl.delete(n),pa.delete(n),dt(o=>o.type==="currency-mult"&&o.key===e&&o.slot===t)}function vh(e,t){let n=!Ef(t,e),o=so(e,t),r=Kl.get(o);if(!n&&r)return r;let i=W1(t,e);return i?(Kl.set(o,i),i):(n&&Kl.delete(o),null)}function Pb(e,t){dt(n=>n.type==="stat-mult"&&n.key===e&&n.slot===t)}function Bb(e,t=b()){let n=Gi(e,t);if(Kl.delete(so(t,e)),Bi.delete(so(t,e)),!(!n||typeof localStorage>"u")&&!ao(n)){try{localStorage.removeItem(n)}catch{}Pb(e,t)}}function Ef(e,t=b()){return ao(Gi(e,t))}function Fb(e,t){return Ef(t,e)?vh(e,t):null}function Hn(e,t=b()){let n=qi(e);return xf(e,t,n)??n}function Gi(e,t=b()){if(!e)return null;let n=t??b();return n==null?null:`${O1}:${e}:${n}`}function qi(e){try{if(e==="xp"){let t=Ac();if(t)return t}else if(e==="mutation"){let t=Cf?.();if(t)return t;let n=_f();if(n)return n}else if(e==="spawnRate"){let t=hs(Se.STARTER_COVE);if(t?.coinsPerSecondMult)return c.fromAny(t.coinsPerSecondMult)}else if(e==="rp")return Hc()}catch{}return c.fromInt(1)}function W1(e,t=b()){let n=Gi(e,t);if(!n||typeof localStorage>"u")return null;let o=localStorage.getItem(n);if(!o)return null;try{return c.fromAny(o)}catch{return null}}function z1(e,t,n){let o=Gi(e,t);if(!(!o||typeof localStorage>"u"))try{let r=n instanceof c?n:c.fromAny(n??1),i=ao(o),s=i&&da?da:localStorage.setItem.bind(localStorage);i&&!da&&ha(o),s(o,r.toStorage?.()??String(r)),i&&!da&&Hi(o)}catch{}}function bh(e,t=b()){if(t==null)return;let n=yh(t,e);if(!n||t!==b())return;let o=so(t,e);if(!vf.has(o)){vf.add(o);try{let r=R?.[e]?.mult?.get?.();Rt(r,n)||R?.[e]?.mult?.set?.(n)}catch{}finally{vf.delete(o)}}}function Ub(){if(!(Cb||typeof window>"u")){Cb=!0;try{window.addEventListener("currency:multiplier",e=>{let{key:t,slot:n,mult:o}=e?.detail??{},r=n??b(),i=so(r,t);if(!r||!Zl.has(i)||vf.has(i))return;let s=pa.get(i),l=yh(r,t);if(s&&l&&o){try{let a=c.fromAny(s),u=c.fromAny(o);if(!a.isZero()){let f=u.div(a),d=f.sig===1n&&f.e===0&&f._eOffset===0n?1:null,m=l.mulBigNumInteger(f);Zl.set(i,m)}}catch{}pa.set(i,o)}else o&&pa.set(i,o);bh(t,r)},{passive:!0}),window.addEventListener("saveSlot:change",()=>{ec()},{passive:!0})}catch{}}}function ec(){let e=b();e!=null&&Object.values(Re).forEach(t=>{bh(t,e)})}function Db(e,t,n=b()){if(!e||n==null)return null;Ub();let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}let r=so(n,e);if(Zl.set(r,o),!pa.has(r)){let i=R?.[e]?.mult?.get?.();pa.set(r,i)}return bh(e,n),o}function zl(e,t=b()){return!e||t==null?null:yh(t,e)}function Gn(e,t,n=b()){if(!e||n==null)return null;let o;try{o=t instanceof c?t.clone?.()??t:c.fromAny(t??1)}catch{o=c.fromInt(1)}return Kl.set(so(n,e),o),Bi.set(so(n,e),qi(e)),z1(e,n,o),Pb(e,n),o}function K1(e,t=b()){return!e||t==null?null:vh(t,e)}function Zn(e,t,n=b()){let o=qi(e),r=xf(e,n,o);if(!r)return t;let i;try{i=t instanceof c?t.clone?.()??t:c.fromAny(t??0)}catch{return t}try{if(Rt(i,o))return r}catch{}try{if(i.isZero?.())return i}catch{return i}let s=so(n,e),l=Bi.get(s),a=Ef(e,n)&&l?l:o,u=null;try{let f=c.fromAny(r),d=c.fromAny(a);d.isZero()||(u=f.div(d))}catch{u=null}if(u)try{return i.mulBigNumInteger(u)}catch{}return i}function xf(e,t,n){let o=vh(t,e),r=so(t,e);if(!o)return Bi.delete(r),null;let i=Bi.get(r),s=Ef(e,t);if(!i)Bi.set(r,n);else if(!Rt(i,n))return s?(Bi.set(r,n),o):(Bb(e,t),null);return o}function j1(){if(!(Lb||typeof localStorage>"u")){Lb=!0;try{da=localStorage.setItem.bind(localStorage),_b=localStorage.removeItem.bind(localStorage),localStorage.setItem=(e,t)=>{if(!ma.has(e))return da(e,t)},localStorage.removeItem=e=>{if(!ma.has(e))return _b(e)}}catch{}}}function ao(e){return e!=null&&ma.has(e)}function Hi(e){e&&(j1(),ma.add(e))}function ha(e){e&&ma.delete(e)}function Z1(e){return e?ao(e)?(ha(e),!1):(Hi(e),!0):!1}function J1(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>{let r=ao(e);n.textContent=r?"L":"UL",n.classList.toggle("locked",r)};return n.addEventListener("click",()=>{if(Z1(e),typeof t=="function")try{t(ao(e))}catch{}o()}),o(),{button:n,refresh:o}}function Q1(e,{onToggle:t}={}){let n=document.createElement("button");n.type="button",n.className="debug-lock-button";let o=()=>Array.from(new Set((e?.()??[]).filter(Boolean))),r=()=>{let l=o();return l.length>0&&l.every(a=>ao(a))},i=()=>{let l=o();return l.length>0&&l.some(a=>ao(a))},s=()=>{let l=o(),a=i();n.textContent=a?"L":"UL",n.classList.toggle("locked",a),n.disabled=l.length===0};return n.addEventListener("click",()=>{let l=o();if(l.length===0)return;let a=r();if(l.forEach(u=>{a?ha(u):Hi(u)}),typeof t=="function")try{t(r())}catch{}s()}),s(),{button:n,refresh:s,isLocked:r}}function eL(){let e=document.getElementById(jl);e&&(e.querySelectorAll(".debug-panel-section-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}),e.querySelectorAll(".debug-panel-subsection-toggle").forEach(t=>{t.classList.remove("expanded");let n=t.nextElementSibling;n&&n.classList.remove("active")}))}function tL(e,t){let n=Array.from(new Set((e??[]).filter(Boolean))),o=[];n.forEach(r=>{ao(r)&&(o.push(r),ha(r))});try{return t?.()}finally{o.forEach(r=>Hi(r))}}function nL(e){try{let t=e instanceof c?e:c.fromAny(e??0);if(t.isInfinite?.())return`BN:${Number.parseInt(t?.p,10)||c.DEFAULT_PRECISION}:1:${c.MAX_E}`;let n=t.toStorage?.(),[,o=`${c.DEFAULT_PRECISION}`,r="0",i="0"]=(n||"").split(":"),s=Number.parseInt(o,10)||c.DEFAULT_PRECISION;if(t.isZero?.())return`BN:${s}:${"0".repeat(s)}:-17`;let l=r.padStart(s,"0");return`BN:${s}:${l}:${i}`}catch{return String(e??"")}}function Sh(e){let t=String(e??"").trim();if(!t)return c.fromInt(0);t.startsWith(".")?t="0"+t:t.startsWith("-.")&&(t="-0"+t.substring(1));try{return/^inf(?:inity)?$/i.test(t)?c.fromAny("Infinity"):c.fromAny(t)}catch{return null}}function ph(e,t){e.classList.toggle("debug-invalid",!t)}function et(){let e=b();try{Mn(e)}catch{}try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:e}}))}catch{}}function $b(e=b()){return e==null?null:`${P1}:${e}`}function qb(e=b()){let t=$b(e);if(!t)return[];let n=null;try{n=localStorage.getItem(t)}catch{}if(!n)return[];try{let o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function Gb(e,t=b()){let n=$b(t);if(!n||typeof localStorage>"u")return;let o=(Array.isArray(e)?e:[]).slice(0,fh);try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function oL(e,t=b()){let n=qb(t);return n.unshift(e),n.length>fh&&(n.length=fh),Gb(n,t),n}function nt(e){let t=b();if(t==null)return;let n=new Date,o={time:n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),message:e,timestamp:n.getTime()};oL(o,t),Ih()}function Ih(){if(!fa)return;let e=qb();if(e.length===0){fa.innerHTML="";let t=document.createElement("div");t.className="action-log-empty",t.textContent="Actions you perform in the Debug Panel will be logged permanently in this action log.",fa.appendChild(t);return}fa.innerHTML=e.map(t=>{let n=String(t.time??"").replace(/^0(\d)/,"$1"),o=t.message?.replace?.(/\[GOLD\](.*?)\[\/GOLD\]/g,'<span class="action-log-gold">$1</span>')??"";return o=o.replace(/\b(?:Level|Lv)\s?(\d+)\b/g,'<span class="action-log-level">Lv$1</span>'),o=o.replace(/(\d[\d,.]*(?:e[+-]?\d+)*(?:[KMBTQa-zA-Z]*))/g,r=>/\d/.test(r)?`<span class="action-log-number">${r}</span>`:r),o=o.replace(/<span[^>]*class="[^"]*infinity-symbol[^"]*"[^>]*>\u221E<\/span>/g,'<span class="action-log-number">inf</span>'),o=o.replace(/\u221E/g,'<span class="action-log-number">inf</span>'),`<div class="action-log-entry"><span class="action-log-time">${n}:</span><span class="action-log-message">${o}</span></div>`}).join("")}function Hb(e=b()){return e==null?null:`${Sl}:${e}`}function Xb(e,t=b()){let n=Hb(t);if(n)try{let o=JSON.stringify(e||{});localStorage.setItem(n,o)}catch{}}function Vb(e=b()){let t=Hb(e);if(!t)return{};try{let n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch{return{}}}function rL(e){if(e){if(Object.values(Re).includes(e.type)){try{e.type===Re.BOOKS?R.books.addWithMultiplier?.(e.amount)??R.books.add(e.amount):R[e.type].add(e.amount)}catch(t){console.warn(`Failed to grant ${e.type} reward:`,e,t)}return}try{window.dispatchEvent(new CustomEvent("merchantReward",{detail:e}))}catch{}}}function iL(){let e=b();if(e==null)return{completed:0};let t=Vb(e),n=0;return Object.entries(yu).forEach(([o,r])=>{let i=String(o),s=t[i]||{},l=!!s.claimed,a=Object.assign({},s,{status:"unlocked",claimed:!0});t[i]=a,l||(n+=1,rL(r.reward))}),Xb(t,e),{completed:n}}function sL(){let e=b();if(e==null)return{restored:0};let t=Vb(e),n=0;return Object.entries(yu).forEach(([o])=>{let r=String(o),i=t[r]||{};i.claimed&&(n+=1),t[r]=Object.assign({},i,{claimed:!1})}),Xb(t,e),{restored:n}}function nn(e,t,n,{idLabel:o,storageKey:r,onLockChange:i,format:s}={}){let l=document.createElement("div");l.className="debug-panel-row";let a=document.createElement("label");if(a.textContent=e,o!=null){a.append(" ");let g=document.createElement("span");g.className="debug-panel-id",g.textContent=`(ID: ${o})`,a.appendChild(g)}l.appendChild(a);let u=document.createElement("input");u.type="text",u.className="debug-panel-input";let f=!1,d=null,m=!1,v=r?J1(r,{onToggle:i}):null,p=g=>{if(f){d=g;return}d=null,u.value=typeof s=="function"?s(g):nL(g)};l.appendChild(u),v&&l.appendChild(v.button);let h=()=>{let g=Sh(u.value);if(!g){ph(u,!1);return}ph(u,!0);let y=r&&ao(r);y&&ha(r);try{n(g,{input:u,setValue:p})}finally{y&&Hi(r),v&&v.refresh()}};return u.addEventListener("focus",()=>{f=!0}),u.addEventListener("change",h),u.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),m=!0,h(),u.blur())}),u.addEventListener("blur",()=>{if(f=!1,m||h(),m=!1,d!=null){let g=d;d=null,p(g)}}),p(t),v&&v.refresh(),{row:l,input:u,setValue:p,isEditing:()=>f}}function aL({labelText:e,description:t,isUnlocked:n,onEnable:o,onDisable:r,slot:i}){let s=document.createElement("div");s.className="debug-panel-row debug-unlock-row";let l=document.createElement("label");l.className="flag-toggle",l.setAttribute("aria-label",e);let a=document.createElement("input");a.type="checkbox";let u=document.createElement("span");u.className="flag-slider",l.appendChild(a),l.appendChild(u);let f=document.createElement("div");f.className="debug-unlock-text";let d=document.createElement("span");if(d.className="debug-unlock-title",d.textContent=e,f.appendChild(d),t){let h=document.createElement("span");h.className="debug-unlock-desc",h.textContent=`- ${t}`,f.appendChild(h)}s.appendChild(l),s.appendChild(f);let m=()=>{a.checked=!a.checked,a.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",h=>{l.contains(h.target)||m()});let v=!1,p=()=>{let h=!1;try{h=typeof n=="function"?!!n():!1}catch{}return a.checked=h,v=h,h};return a.addEventListener("change",()=>{let h=v,g=a.checked;try{g?o?.():r?.()}catch{}et();let y=p();h!==y&&nt(`Toggled ${e} [GOLD]${h?"True":"False"}[/GOLD] \u2192 [GOLD]${y?"True":"False"}[/GOLD]`)}),p(),Dt({type:"unlock",slot:i,refresh:p}),s}function lL(e){try{if(e instanceof c||typeof e?.toScientific=="function")return K(e);let t=Number(e);return Number.isFinite(t)?K(t):String(e??"\u2014")}catch{return"\u2014"}}function cL({labelText:e,inputs:t=[],compute:n}){let o=document.createElement("div");o.className="debug-panel-row debug-calculator-row";let r=document.createElement("label");r.textContent=e,o.appendChild(r);let i=document.createElement("div");i.className="debug-calculator-inputs",o.appendChild(i);let s=document.createElement("div");s.className="debug-calculator-output",s.textContent="\u2014",o.appendChild(s);let l=[],a=()=>{let u={},f=!1;if(l.forEach(({config:d,el:m})=>{if(d.type==="select"){u[d.key]=m.value;return}let v=Sh(m.value),p=v instanceof c;if(ph(m,p),!p){f=!0;return}u[d.key]=v}),f||typeof n!="function"){s.textContent="\u2014";return}try{let d=n(u);s.innerHTML=lL(d)}catch{s.textContent="\u2014"}};return t.forEach(u=>{let f=Object.assign({type:"text",defaultValue:""},u);if(f.key)if(f.type==="select"){let d=document.createElement("select");d.className="debug-panel-input",(f.options||[]).forEach(({value:m,label:v})=>{let p=document.createElement("option");p.value=m,p.textContent=v??m,f.defaultValue!=null&&f.defaultValue===m&&(p.selected=!0),d.appendChild(p)}),d.addEventListener("change",a),i.appendChild(d),l.push({config:f,el:d})}else{let d=document.createElement("input");d.type="text",d.className="debug-panel-input",d.placeholder=f.label||"",d.value=f.defaultValue??"",d.addEventListener("input",a),d.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),a())}),i.appendChild(d),l.push({config:f,el:d})}}),a(),o}function Vr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return Qe()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.xpLevel??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?e!=null&&(l=r.clone?.()??r):u&&!a&&t!=null&&(s=r.clone?.()??r));try{ni()}catch{}let f=Fi.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ct(f,"1"),s!=null)try{let d=s.toStorage?.()??c.fromAny(s).toStorage(),m=Fi.level(n);localStorage.setItem(m,d),ct(m,d)}catch{}if(l!=null)try{let d=l.toStorage?.()??c.fromAny(l).toStorage(),m=Fi.progress(n);localStorage.setItem(m,d),ct(m,d)}catch{}try{ss({forceReload:!0})}catch{}try{Tc({changeType:"debug-panel",slot:n})}catch{}try{dt()}catch{}}function Yr({level:e,progress:t}){let n=b();if(n==null)return;let o=(()=>{try{return yt()}catch{return null}})(),r=(()=>{try{return c.fromInt(0)}catch{return null}})(),i=d=>{if(d==null)return null;try{return d instanceof c?d.clone?.()??d:c.fromAny(d)}catch{return null}},s=i(e)??o?.level??null,l=i(t)??o?.progress??null,a=!s?.isInfinite?.(),u=!l?.isInfinite?.();(e!=null||t!=null)&&r&&(a&&!u?l=r.clone?.()??r:u&&!a&&(s=r.clone?.()??r));try{let d=typeof window.resetSystem?.isForgeUnlocked=="function"?window.resetSystem.isForgeUnlocked():!1,m=typeof window.resetSystem?.getForgeDebugOverrideState=="function"?window.resetSystem.getForgeDebugOverrideState():null;!d&&m!==!0&&window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{typeof window.resetSystem?.hasDoneForgeReset=="function"&&!window.resetSystem.hasDoneForgeReset()&&window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Jl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{tn()}catch{}try{$r()}catch{}let f=Ui.unlock(n);try{localStorage.setItem(f,"1")}catch{}if(ct(f,"1"),e!=null)try{let d=e.toStorage?.()??c.fromAny(e).toStorage(),m=Ui.level(n);localStorage.setItem(m,d),ct(m,d)}catch{}if(t!=null)try{let d=t.toStorage?.()??c.fromAny(t).toStorage(),m=Ui.progress(n);localStorage.setItem(m,d),ct(m,d)}catch{}try{tn({forceReload:!0})}catch{}try{wh({changeType:"debug-panel",slot:n})}catch{}try{window.resetSystem?.recomputePendingMagic?.()}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{dt()}catch{}}function uL(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency values.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=gh(r.key,n),s=Wl(r.key,n),l=nn(r.label,s,(a,{setValue:u})=>{let f=b();if(f==null)return;let d=Wl(r.key,f),{next:m}=X1(r.key,a,f);u(m),Rt(d,m)||(et(),nt(`Modified ${r.label} (${o}) ${K(d)} \u2192 ${K(m)}`))},{storageKey:i,onLockChange:()=>l.setValue(Wl(r.key,b()))});Dt({type:"currency",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let a=Wl(r.key,n);l.setValue(a)}}),e.appendChild(l.row)})}function fL(e,t){let n=b();if(n==null){let P=document.createElement("div");P.className="debug-panel-empty",P.textContent="Select a save slot to edit stats.",e.appendChild(P);return}let o="spawnRate",r=Gi(o,n),i=nn("Coin Spawn Rate",Hn(o,n),(P,{setValue:$})=>{let L=b();if(L==null)return;let F=Hn(o,L);try{Gn(o,P,L)}catch{}let T=Hn(o,L);$(T),Rt(F,T)||(et(),nt(`Modified Spawn Rate (${a}) ${K(F)} \u2192 ${K(T)}`))},{storageKey:r,onLockChange:P=>{let $=b();if($!=null){if(P){if(Fb($,o))return;try{Gn(o,qi(o),$)}catch{}}else xf(o,$,qi(o));i.setValue(Hn(o,$))}}});Dt({type:"stat-mult",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Hn(o,n);i.setValue(P)}}),Dt({type:"upgrade",key:o,slot:n,refresh:()=>{if(n!==b())return;let P=Hn(o,n);i.setValue(P)}}),e.appendChild(i.row);let s=Qe(),l=yt(),a=t?.title??t?.key??"Unknown Area",u=Fi.level(n),f=nn("XP Level",s.xpLevel,(P,{setValue:$})=>{let L=Qe().xpLevel;Vr({level:P});let F=Qe();$(F.xpLevel),Rt(L,F.xpLevel)||(et(),nt(`Modified XP Level (${a}) ${K(L)} \u2192 ${K(F.xpLevel)}`))},{storageKey:u});Dt({type:"xp",slot:n,refresh:()=>{n===b()&&f.setValue(Qe().xpLevel)}}),e.appendChild(f.row);let d=Fi.progress(n),m=nn("XP Progress",s.progress,(P,{setValue:$})=>{let L=Qe(),F=L?.xpLevel?.clone?.()??L?.xpLevel,T=L?.progress?.clone?.()??L?.progress;Vr({progress:P});let C=Qe();$(C.progress),f.setValue(C.xpLevel),(!Rt(T,C.progress)||!Rt(F,C.xpLevel))&&(et(),nt(`Modified XP Progress (${a}) ${K(T)} \u2192 ${K(C.progress)}`))},{storageKey:d});Dt({type:"xp",slot:n,refresh:()=>{n===b()&&m.setValue(Qe().progress)}}),e.appendChild(m.row);let v=Ui.level(n),p=nn("MP Level",l.level,(P,{setValue:$})=>{let L=yt().level;Yr({level:P});let F=yt();$(F.level),Rt(L,F.level)||(et(),nt(`Modified MP Level (${a}) ${K(L)} \u2192 ${K(F.level)}`))},{storageKey:v});Dt({type:"mutation",slot:n,refresh:()=>{n===b()&&p.setValue(yt().level)}}),e.appendChild(p.row);let h=Ui.progress(n),g=nn("MP Progress",l.progress,(P,{setValue:$})=>{let L=yt(),F=L?.level?.clone?.()??L?.level,T=L?.progress?.clone?.()??L?.progress;Yr({progress:P});let C=yt();$(C.progress),p.setValue(C.level),(!Rt(T,C.progress)||!Rt(F,C.level))&&(et(),nt(`Modified MP Progress (${a}) ${K(T)} \u2192 ${K(C.progress)}`))},{storageKey:h});Dt({type:"mutation",slot:n,refresh:()=>{n===b()&&g.setValue(yt().progress)}}),e.appendChild(g.row);let y=xi(n);if(y){let P=0;try{let L=localStorage.getItem(y),F=c.fromAny(L||"0");if(F.isInfinite())P=1/0;else try{P=Number(F.toScientific(20))}catch{P=0}}catch{}let $=nn("Workshop Level",P,(L,{setValue:F})=>{let T=Number(L);if(L instanceof c)if(L.isInfinite())T=1/0;else try{T=Number(L.toScientific(20))}catch{T=NaN}if(Number.isNaN(T)||T<0)return;let C=T===1/0?"Infinity":String(Math.floor(T));try{localStorage.setItem(y,C),et(),nt(`Modified Workshop Level (The Cove) ${K(P)} \u2192 ${C}`),P=T}catch{}F(T)},{storageKey:y,onLockChange:()=>{let L=0;try{let F=localStorage.getItem(y),T=c.fromAny(F||"0");T.isInfinite()?L=1/0:L=Number(T.toScientific(20))}catch{}$.setValue(L)}});e.appendChild($.row),Dt({type:"workshop-level",slot:n,refresh:()=>{if(n!==b())return;let L=0;try{let F=localStorage.getItem(y),T=c.fromAny(F||"0");T.isInfinite()?L=1/0:L=Number(T.toScientific(20))}catch{}$.setValue(L)}})}let I=Zs(n);if(I){let P=0;try{let L=localStorage.getItem(I);L==="Infinity"?P=1/0:P=c.fromAny(L||"0")}catch{P=c.fromInt(0)}let $=nn("Surge Level",P,(L,{setValue:F})=>{let T="0",C=0;L instanceof c?L.isInfinite()?(T="Infinity",C=1/0):(T=L.toPlainIntegerString(),C=L):L===1/0||typeof L=="string"&&/infinity/i.test(L)?(T="Infinity",C=1/0):(T=String(L),C=L);try{localStorage.setItem(I,T),et();let Y=C===1/0?"Infinity":K(C),Q=P===1/0||P instanceof c&&P.isInfinite()?"Infinity":K(P);nt(`Modified Surge Level (The Cove) ${Q} \u2192 ${Y}`),C===1/0?P=1/0:C instanceof c?P=C:P=c.fromAny(C);let ae=!1;P===1/0?ae=!0:P instanceof c?typeof P.cmp=="function"&&P.cmp(8)>=0&&(ae=!0):typeof P=="number"&&P>=8&&(ae=!0),ae&&(Ii(0),vn()||tr(!0))}catch{}F(C);try{window.resetSystem?.updateResetPanel?.()}catch{}try{let Y=P;if(Y!==1/0&&Y instanceof c)try{Y=BigInt(Y.toPlainIntegerString())}catch{}window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:n,level:Y}}))}catch{}},{storageKey:I,onLockChange:L=>{let F=c.fromInt(0);try{let T=localStorage.getItem(I);T==="Infinity"?F=1/0:F=c.fromAny(T||"0")}catch{}$.setValue(F)}});Dt({type:"surge-level",slot:n,refresh:()=>{if(n!==b())return;let L=c.fromInt(0);try{let F=localStorage.getItem(I);F==="Infinity"?L=1/0:L=c.fromAny(F||"0")}catch{}$.setValue(L)}}),e.appendChild($.row)}let E=Zt(),M=nn("Lab Level",E,(P,{setValue:$})=>{let L;try{L=P instanceof c?P:c.fromAny(P),L.isNegative&&L.isNegative()&&(L=c.fromInt(0))}catch{$(Zt());return}let F=Zt();pi(L),et(),Rt(F,L)||nt(`Modified Lab Level (The Cove) ${K(F)} \u2192 ${K(L)}`),$(L)},{storageKey:Fd(n)});Dt({type:"lab-level",slot:n,refresh:()=>{n===b()&&M.setValue(Zt())}}),e.appendChild(M.row);let A=()=>{let P=Rn(),$=Jn(),L=P+$;return L>1&&(L=1),L},G=nn("Tsunami Exponent",A().toFixed(2),(P,{setValue:$})=>{let L=Number(P);if(P instanceof c?P.isInfinite()?L=1/0:L=Number(P.toScientific(10)):typeof P=="string"&&/infinity/i.test(P)&&(L=1/0),Number.isNaN(L)){$(A().toFixed(2));return}let F=Jn(),T=L-F;T>1&&(T=1),T<0&&(T=0),T=Math.round(T*100)/100;let C=Rn();Ii(T),et(),Math.abs(C-T)>1e-4&&nt(`Modified Tsunami Exponent (The Cove) Base:${C.toFixed(2)} \u2192 ${T.toFixed(2)} (Effective: ${L.toFixed(2)})`),$(A().toFixed(2))},{storageKey:rp(n),format:P=>{let $=Number(P);return Number.isFinite($)?$.toFixed(2):String(P)}});if(Dt({type:"tsunami-nerf",slot:n,refresh:()=>{if(n!==b())return;let P=A();G.setValue(P.toFixed(2))}}),e.appendChild(G.row),t.key===Se.STARTER_COVE){let P=`ccc:debug:comboLock:${n}`,$=nn("Combo",Zc(),(L,{setValue:F})=>{let T=0;if(L===1/0||L instanceof c&&L.isInfinite())T=Dy();else{try{T=L instanceof c?Number(L.toScientific(10)):Number(L)}catch{T=Number(L)}Number.isNaN(T)&&(T=0)}Uy(T),F(Zc()),et()},{storageKey:P,onLockChange:L=>np(L),format:L=>{let F=Number(L);return Number.isFinite(F)&&Math.abs(F)<1e9?F.toFixed(3):K(L)}});np(ao(P)),Dt({type:"combo",slot:n,refresh:()=>{n===b()&&$.setValue(Zc())}}),e.appendChild($.row)}}function ch(e,t){let n=b();if(n==null){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="Select a save slot to edit upgrades.",e.appendChild(i);return}let o=Mt(t.key);if(!o||o.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No upgrades found for this area yet.",e.appendChild(i);return}let r=t?.title??t?.key??"Unknown Area";o.forEach(i=>{let s=i.id??i.tie??i.tieKey,l=i.title||`Upgrade ${s??""}`.trim(),a=Nn(t.key,i.id??i.tie),u=Pi(t.key,i.id??i.tie,n),f=nn(l,a,(d,{setValue:m})=>{if(b()==null)return;let p=Nn(t.key,i.id??i.tie);try{ur(t.key,i.id??i.tie,d,!1)}catch{}let h=Nn(t.key,i.id??i.tie);m(h),Rt(p,h)||(et(),nt(`Modified ${l} (${r} - ID: ${s??"Unknown"}) Lv${K(p)} \u2192 Lv${K(h)}`))},{idLabel:s,storageKey:u});Dt({type:"upgrade",slot:n,refresh:()=>{if(n!==b())return;let d=Nn(t.key,i.id??i.tie);f.setValue(d)}}),e.appendChild(f.row)})}function dL(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit currency multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";t.currencies.forEach(r=>{let i=R?.[r.key]?.mult,l=zl(r.key,n)??i?.get?.()??c.fromInt(1),a=`${wt.MULTIPLIER[r.key]}:${n}`,u=nn(`${r.label} Multiplier`,l,(f,{setValue:d})=>{let m=b();if(m==null)return;let v=zl(r.key,m)??i?.get?.()??c.fromInt(1);try{Db(r.key,f,m)}catch{}ec();let h=zl(r.key,m)??i?.get?.()??c.fromInt(1);d(h),Rt(v,h)||(et(),nt(`Modified ${r.label} Multiplier (${o}) ${K(v)} \u2192 ${K(h)}`))},{storageKey:a});Dt({type:"currency-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let d=zl(r.key,n)??i?.get?.()??c.fromInt(1);u.setValue(d)}}),e.appendChild(u.row)})}function pL(){if(b()==null)return 0;let t=c.fromAny("Infinity"),n=0;return Object.values(Re).forEach(o=>{let r=R?.[o];if(r)try{let i=r.value??r.get?.();if(i?.isInfinite?.()||Rt(i,t))return;r.set(t),n+=1}catch{}}),n}function mL(){if(b()==null)return 0;let t=c.fromInt(0),n=0;return Object.values(Re).forEach(o=>{let r=R?.[o];if(r)try{r.set?.(t),n+=1}catch{}}),n}function hL(){let e=b();if(e==null)return 0;let t=c.fromAny("Infinity"),n=0,o,r;try{o=Qe()}catch{}try{r=yt()}catch{}try{if(o?.unlocked){let i=o?.xpLevel?.isInfinite?.()||Rt(o?.xpLevel,t),s=o?.progress?.isInfinite?.()||Rt(o?.progress,t);(!i||!s)&&(Vr({level:t,progress:t}),n+=1)}}catch{}try{if(r?.unlocked){let i=r?.level?.isInfinite?.()||Rt(r?.level,t),s=r?.progress?.isInfinite?.()||Rt(r?.progress,t);(!i||!s)&&(Yr({level:t,progress:t}),n+=1)}}catch{}try{let i=xi(e);if(i){let s=localStorage.getItem(i);parseFloat(s||"0")!==1/0&&(localStorage.setItem(i,"Infinity"),n+=1)}}catch{}try{let i=Zs(e);if(i&&localStorage.getItem(i)!=="Infinity"){localStorage.setItem(i,"Infinity"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:1/0}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{dt()}catch{}return n}function gL(){let e=b();if(e==null)return 0;let t=c.fromInt(0),n=0,o,r;try{o=Qe()}catch{}try{r=yt()}catch{}try{o?.unlocked&&(Vr({level:t,progress:t}),n+=1)}catch{}try{r?.unlocked&&(Yr({level:t,progress:t}),n+=1)}catch{}try{let i=xi(e);i&&localStorage.getItem(i)!=="0"&&(localStorage.setItem(i,"0"),n+=1)}catch{}try{let i=Zs(e);if(i&&localStorage.getItem(i)!=="0"){localStorage.setItem(i,"0"),n+=1;try{window.dispatchEvent(new CustomEvent("surge:level:change",{detail:{slot:e,level:0n}}))}catch{}}}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}try{dt()}catch{}return n}function Yb(e){return[{labelText:"Unlock XP",description:"If true, unlocks the XP system",isUnlocked:()=>{try{return!!Qe()?.unlocked}catch{return!1}},onEnable:()=>{try{ni()}catch{}try{ss({forceReload:!0})}catch{}},onDisable:()=>{try{as({keepUnlock:!1})}catch{}try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Channel",description:"If true, unlocks the Channel tab",isUnlocked:()=>{try{return!!fu()}catch{return!1}},onEnable:()=>{let t=b();if(t!=null){try{localStorage.setItem(`ccc:unlock:channel:${t}`,"1")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"channel",slot:t}}))}catch{}}},onDisable:()=>{let t=b();if(t!=null){try{localStorage.setItem(`ccc:unlock:channel:${t}`,"0")}catch{}try{window.dispatchEvent(new CustomEvent("unlock:change",{detail:{key:"channel",slot:t}}))}catch{}}},slot:e},{labelText:"Unlock Warp",description:"If true, unlocks the Warp tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneSurgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Workshop",description:"If true, unlocks the Workshop tab",isUnlocked:()=>{try{return window.resetSystem?.hasDoneInfuseReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock MP",description:"If true, unlocks the MP system",isUnlocked:()=>{try{return window.resetSystem?.hasDoneForgeReset?.()??!1}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!0)}catch{}try{Jl(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeResetCompleted?.(!1)}catch{}try{Jl(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Forge",description:"If true, unlocks the Forge reset and Reset tab",isUnlocked:()=>{try{let t=window.resetSystem?.getForgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isForgeUnlocked?.()}catch{return!1}return!1},onEnable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setForgeDebugOverride?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}}},{labelText:"Unlock Infuse",description:"If true, unlocks the Infuse reset",isUnlocked:()=>{try{let t=window.resetSystem?.getInfuseDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isInfuseUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setInfuseUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Surge",description:"If true, unlocks the Surge reset",isUnlocked:()=>{try{let t=window.resetSystem?.getSurgeDebugOverrideState?.();if(t!=null)return t}catch{}try{return!!window.resetSystem?.isSurgeUnlocked?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setSurgeUnlockedForDebug?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Shop",description:"If true, makes the Shop button visible",isUnlocked:()=>{try{return Hp()}catch{return!1}},onEnable:()=>{try{Ti()}catch{}},onDisable:()=>{try{ku()}catch{}},slot:e},{labelText:"Unlock Map",description:"If true, makes the Map button visible",isUnlocked:()=>{try{return Xp()}catch{return!1}},onEnable:()=>{try{Tu()}catch{}},onDisable:()=>{try{Au()}catch{}},slot:e},{labelText:"Unlock Jeff",description:"If true, changes the Merchant's name to Jeff",isUnlocked:()=>{try{return Ap()}catch{return!1}},onEnable:()=>{try{hu(!0)}catch{}},onDisable:()=>{try{hu(!1)}catch{}},slot:e},{labelText:"Unlock Tsunami",description:"If true, marks the Tsunami sequence as seen",isUnlocked:()=>{try{return!!vn()}catch{return!1}},onEnable:()=>{try{tr(!0)}catch{}},onDisable:()=>{try{tr(!1)}catch{}},slot:e},{labelText:"Unlock Experiment",description:"If true, Lab node 4 is maxed",isUnlocked:()=>{try{return it(4)>=1}catch{return!1}},onEnable:()=>{try{bo(4,1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{bo(4,0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e},{labelText:"Unlock Past N4",description:"If true, unlocks Lab nodes past node 4",isUnlocked:()=>{try{return!!window.resetSystem?.hasDoneExperimentReset?.()}catch{return!1}},onEnable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!0)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},onDisable:()=>{try{window.resetSystem?.setExperimentResetCompleted?.(!1)}catch{}try{window.resetSystem?.updateResetPanel?.()}catch{}},slot:e}]}function Wb(e){let t=b();if(t==null)return 0;let n=0;Yb(t).forEach(o=>{let r=!1;try{r=typeof o.isUnlocked=="function"?!!o.isUnlocked():!1}catch{}if(r!==e)try{e?o.onEnable?.():o.onDisable?.(),n+=1}catch{}});try{dt()}catch{}return n}function yL(){let e=b();if(e==null)return{unlocks:0,toggles:0};let t=0;wf().forEach(o=>{Mt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{Oi(o.key,r,e),t+=1}catch{}})});try{Ti()}catch{}try{Tu()}catch{}let n=Wb(!0);return{unlocks:t,toggles:n}}function vL(){let e=b();if(e==null)return{locks:0,toggles:0};let t=0;wf().forEach(o=>{Mt(o.key).forEach(r=>{if(r?.unlockUpgrade)try{nh(o.key,r,e),t+=1}catch{}})});try{ku()}catch{}try{Au()}catch{}let n=Wb(!1);return{locks:t,toggles:n}}function bL(e,t=b()){let n=t??b();if(n==null)return[];let o=new Set,r=a=>{a&&o.add(a)},i=a=>{r(gh(a,n)),r(V1(a,n))},s=a=>r(Gi(a,n)),l=a=>{s(a),(a==="xp"||a==="xpLevel"||a==="xpProgress")&&(r(Fi.level(n)),r(Fi.progress(n))),(a==="mutation"||a==="mp"||a==="mpLevel"||a==="mpProgress")&&(r(Ui.level(n)),r(Ui.progress(n)))};return e==="all"?(Object.values(Re).forEach(i),l("xp"),l("mutation"),Sf.forEach(({key:a})=>s(a)),Array.from(o)):e==="allCurrencies"?(Object.values(Re).forEach(i),Array.from(o)):e==="allUnlockedStats"?(Qe()?.unlocked&&l("xp"),yt()?.unlocked&&l("mutation"),Array.from(o)):e==="allUnlocked"?(Object.values(Re).forEach(i),Qe()?.unlocked&&l("xp"),yt()?.unlocked&&l("mutation"),Array.from(o)):e.startsWith("currency:")?(i(e.slice(9)),Array.from(o)):e.startsWith("statmult:")?(s(e.slice(9)),Array.from(o)):(e.startsWith("stat:")&&l(e.slice(5)),Array.from(o))}function yf(e){try{R?.[e]?.set?.(c.fromInt(0))}catch{}try{Y1(e)}catch{}try{Sc(e,c.fromInt(1))}catch{}}function SL(e){if(e==="all"){Object.values(Re).forEach(i=>yf(i));let o=c.fromInt(0);return Vr({level:o,progress:o}),Yr({level:o,progress:o}),Sf.forEach(({key:i})=>{try{Gn(i,c.fromInt(1))}catch{}}),{label:"[GOLD]all[/GOLD] currency/stats",count:Object.values(Re).length+Sf.length+2}}if(e==="allCurrencies"){let o=0;return Object.values(Re).forEach(i=>{yf(i),o+=1}),{label:o===1?"1 currency":`${o} currencies`,count:o}}if(e==="allUnlockedStats"){let o=c.fromInt(0),r=0;try{if(Qe()?.unlocked){Vr({level:o,progress:o});try{Gn("xp",c.fromInt(1))}catch{}r+=1}}catch{}try{if(yt()?.unlocked){Yr({level:o,progress:o});try{Gn("mutation",c.fromInt(1))}catch{}r+=1}}catch{}return{label:r===1?"1 unlocked stat":`${r} unlocked stats`,count:r}}if(e==="allUnlocked"){let o=0;Object.values(Re).forEach(l=>{yf(l),o+=1});let r=c.fromInt(0),i=0;try{if(Qe()?.unlocked){Vr({level:r,progress:r});try{Gn("xp",c.fromInt(1))}catch{}i+=1}}catch{}try{if(yt()?.unlocked){Yr({level:r,progress:r});try{Gn("mutation",c.fromInt(1))}catch{}i+=1}}catch{}let s=[];return i===1?s.push("1 unlocked stat"):s.push(`${i} unlocked stats`),s.push(o===1?"1 currency":`${o} currencies`),{label:s.join(" and "),count:i+o}}if(e.startsWith("currency:")){let o=e.slice(9);return yf(o),{label:`${o}`,count:1}}if(e.startsWith("statmult:")){let o=e.slice(9);try{Bb(o)}catch{}return{label:`${o} multiplier`,count:1}}if(!e.startsWith("stat:"))return{label:`unknown target ${e}`,count:0};let t=e.slice(5),n=c.fromInt(0);if(t==="xp"||t==="xpLevel"||t==="xpProgress"){Vr({level:n,progress:n});try{Gn("xp",c.fromInt(1))}catch{}return{label:"XP",count:1}}if(t==="mutation"||t==="mp"||t==="mpLevel"||t==="mpProgress"){Yr({level:n,progress:n});try{Gn("mutation",c.fromInt(1))}catch{}return"MP"}try{Gn(t,c.fromInt(1))}catch{}return`stat ${t}`}function IL(e,t){let n=b();if(n==null){let r=document.createElement("div");r.className="debug-panel-empty",r.textContent="Select a save slot to edit stat multipliers.",e.appendChild(r);return}let o=t?.title??t?.key??"Unknown Area";Sf.forEach(r=>{if(r.key==="spawnRate")return;let i=Gi(r.key,n),s=nn(`${r.label} Multiplier`,Hn(r.key,n),(l,{setValue:a})=>{let u=b();if(u==null)return;let f=Hn(r.key,u);try{Gn(r.key,l,u)}catch{}let d=Hn(r.key,u);a(d),Rt(f,d)||(et(),nt(`Modified ${r.label} Multiplier (${o}) ${K(f)} \u2192 ${K(d)}`))},{storageKey:i,onLockChange:l=>{let a=b();if(a!=null){if(l){if(Fb(a,r.key))return;try{Gn(r.key,qi(r.key),a)}catch{}}else xf(r.key,a,qi(r.key));s.setValue(Hn(r.key,a))}}});Dt({type:"stat-mult",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Hn(r.key,n);s.setValue(l)}}),Dt({type:"upgrade",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Hn(r.key,n);s.setValue(l)}}),r.key==="mutation"&&Dt({type:"mutation",key:r.key,slot:n,refresh:()=>{if(n!==b())return;let l=Hn(r.key,n);s.setValue(l)}}),e.appendChild(s.row)})}function wL(e){let t=b();if(t==null){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="Select a save slot to edit lab nodes.",e.appendChild(n);return}if(!Nt||Nt.length===0){let n=document.createElement("div");n.className="debug-panel-empty",n.textContent="No lab nodes found.",e.appendChild(n);return}Nt.forEach(n=>{let o=qn(`${n.title||`Node ${n.id}`} (ID: ${n.id})`,r=>{let i=sl(t,n.id),s=nn("Level",it(n.id),(u,{setValue:f})=>{let d=Number(u);if(u instanceof c&&(d=u.isInfinite()?1/0:Number(u.toScientific(10))),Number.isNaN(d)||d<0)return;d>n.maxLevel&&(d=n.maxLevel),d=Math.floor(d);let m=it(n.id);bo(n.id,d),et(),m!==d&&nt(`Modified Node ${n.id} Level (The Cove) ${m} \u2192 ${d}`),f(d)},{storageKey:i});Dt({type:"lab-node-level",slot:t,id:n.id,refresh:()=>{t===b()&&s.setValue(it(n.id))}}),r.appendChild(s.row);let l=al(t,n.id),a=nn("Current RP",yo(n.id),(u,{setValue:f})=>{let d;try{d=u instanceof c?u:c.fromAny(u),d.isNegative&&d.isNegative()&&(d=c.fromInt(0))}catch{f(yo(n.id));return}let m=yo(n.id);vi(n.id,d),et(),Rt(m,d)||nt(`Modified Node ${n.id} RP (The Cove) ${K(m)} \u2192 ${K(d)}`),f(d)},{storageKey:l});Dt({type:"lab-node-rp",slot:t,id:n.id,refresh:()=>{t===b()&&a.setValue(yo(n.id))}}),r.appendChild(a.row)});e.appendChild(o)})}function EL(e){[{title:"Currencies",rows:[{label:"Pending Gold (Forge)",inputs:[{key:"coins",label:"Coins"},{key:"xpLevel",label:"XP Level"}],compute:({coins:n,xpLevel:o})=>window.resetSystem?.computeForgeGoldFromInputs?.(n,o)},{label:"Pending Magic (Infuse)",inputs:[{key:"coins",label:"Coins"},{key:"mp",label:"Cumulative MP"}],compute:({coins:n,mp:o})=>window.resetSystem?.computeInfuseMagicFromInputs?.(n,o)},{label:"Pending Waves (Surge)",inputs:[{key:"xpLevel",label:"XP Level"},{key:"coins",label:"Coins"},{key:"gold",label:"Gold"},{key:"magic",label:"Magic"},{key:"mp",label:"Cumulative MP"}],compute:({xpLevel:n,coins:o,gold:r,magic:i,mp:s})=>window.resetSystem?.computeSurgeWavesFromInputs?.(n,o,r,i,s)},{label:"Pending DNA (Experiment)",inputs:[{key:"labLevel",label:"Lab Level"},{key:"xpLevel",label:"XP Level"},{key:"isSurge9",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 9? No"},{value:"Yes",label:"Surge 9? Yes"}]}],compute:({labLevel:n,xpLevel:o,isSurge9:r})=>window.resetSystem?.computePendingDnaFromInputs?.(n,o,r==="Yes")}]},{title:"Stats",rows:[{label:"XP Requirement",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>kc(n)},{label:"XP Level Coin Multiplier",inputs:[{key:"xpLevel",label:"XP Level"}],compute:({xpLevel:n})=>wd(n)},{label:"MP Requirement",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>Eh(n)},{label:"MP Level Coin/XP Multiplier",inputs:[{key:"mpLevel",label:"MP Level"}],compute:({mpLevel:n})=>js(n)},{label:"Workshop Level Cost",inputs:[{key:"level",label:"Level"}],compute:({level:n})=>Nr(n)},{label:"Lab Level RP Boost",inputs:[{key:"level",label:"Lab Level"},{key:"isSurge12",type:"select",defaultValue:"No",options:[{value:"No",label:"Surge 12? No"},{value:"Yes",label:"Surge 12? Yes"}]}],compute:({level:n,isSurge12:o})=>{let r=0;if(n instanceof c){if(n.isInfinite())return c.fromAny("Infinity");try{r=Number(n.toScientific(10))}catch{r=0}}else r=Number(n);if(!Number.isFinite(r))return c.fromInt(1);if(o==="Yes"){let s=ut(),l=5*s,a=2+s/2,u=Math.log10(a),f=r*u+l;return ie(f)}let i=r*Math.log10(2);return ie(i)}}]},{title:"Other",rows:[{label:"Default Upgrade Level Cost",inputs:[{key:"baseCost",label:"Base Cost"},{key:"level",label:"Current Upgrade Level"},{key:"mode",type:"select",defaultValue:"NM",options:[{value:"NM",label:"No Milestones"},{value:"HM",label:"Has Milestones"}]}],compute:({baseCost:n,level:o,mode:r})=>oh(n,o,r)},{label:"Currency Generation Percentage",inputs:[{key:"tsunamiExp",label:"Tsunami Exponent"}],compute:({tsunamiExp:n})=>{let o=Number(n);if(n instanceof c&&(o=n.isInfinite()?1/0:Number(n.toScientific(10))),!Number.isFinite(o))return"\u2014";let r=o*1.5-.5,i=Math.pow(100,r);return Te(i)+"%"}}]}].forEach(n=>{let o=qn(n.title,r=>{if(!n.rows||n.rows.length===0){let i=document.createElement("div");i.className="debug-panel-empty",i.textContent="No calculators available yet.",r.appendChild(i);return}n.rows.forEach(i=>{let s=cL({labelText:i.label,inputs:i.inputs,compute:i.compute});r.appendChild(s)})});e.appendChild(o)})}function xL(e){if(e.innerHTML="",b()==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Areas are available once a save slot is selected.",e.appendChild(o);return}ec(),wf().forEach(o=>{let r=qn(o.title,i=>{let s=qn("Currencies",p=>{uL(p,o)}),l=qn("Stats",p=>{fL(p,o)}),a=qn("Multipliers",p=>{let h=qn("Currencies",y=>{dL(y,o)}),g=qn("Stats",y=>{IL(y,o)});p.appendChild(h),p.appendChild(g)}),u=qn("Upgrades",p=>{ch(p,o)}),f=null,d=null,m=null;o.key===Se.STARTER_COVE&&(f=qn("Automation Upgrades",p=>{ch(p,{key:Se.AUTOMATION,title:"Automation"})}),d=qn("DNA Upgrades",p=>{ch(p,{key:Se.DNA,title:"DNA"})}),m=qn("Lab Nodes",p=>{wL(p)}));let v=qn("Calculators",p=>{EL(p)});i.appendChild(s),i.appendChild(l),i.appendChild(a),i.appendChild(u),f&&i.appendChild(f),d&&i.appendChild(d),m&&i.appendChild(m),i.appendChild(v)});r.classList.add("debug-panel-area"),e.appendChild(r)})}function LL(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Se),r=[];return o.forEach(i=>{Mt(i).forEach(l=>{e&&Ro(i,l.id).locked||r.push({areaKey:i,upg:l})})}),Hl(()=>{r.forEach(({areaKey:i,upg:s})=>{try{let l=s.lvlCap;ur(i,s.id,l),n++}catch(l){console.warn("Failed to max upgrade",s,l)}})}),n}function _L(e=!1){if(b()==null)return 0;let n=0,o=Object.values(Se),r=[];o.forEach(s=>{Mt(s).forEach(a=>{e&&Ro(s,a.id).locked||r.push({areaKey:s,upg:a})})});let i=()=>{Hl(()=>{r.forEach(({areaKey:s,upg:l})=>{try{Mr(s,l.id,"0"),ur(s,l.id,0)}catch(a){console.warn("Failed to zero upgrade",l,a)}})})};return i(),setTimeout(i,500),r.length}function Mb(e){let t=b();if(t==null)return 0;let n=e?"1":"0",o=0,r=Mt(Ze);Hl(()=>{r.forEach(l=>{try{let a=e?l.lvlCap:0;ur(Ze,l.id,a),o++}catch(a){console.warn("Failed to set automation level",l,a)}})});let i=Object.values(ms),s=new Set(i);i.forEach(l=>{let a=`ccc:autobuy:master:${l}:${t}`;localStorage.setItem(a,n)}),Object.values(Se).forEach(l=>{if(l===Ze)return;Mt(l).forEach(u=>{s.has(u.costType)&&(Mr(l,u.id,n),o++)})}),Mr(Ze,po,n),o++;try{window.dispatchEvent(new CustomEvent("debug:change",{detail:{slot:t}}))}catch{}return o}function CL(e){e.innerHTML="";let t=b();if(t==null){let g=document.createElement("div");g.className="debug-panel-empty",g.textContent="Miscellaneous tools are available once a save slot is selected.",e.appendChild(g);return}let n=[{label:"Complete Dialogues",onClick:()=>{let{completed:g}=iL();et(),nt(`Completed all dialogues (${g} newly claimed).`)}},{label:"Restore Dialogues",onClick:()=>{let{restored:g}=sL();et(),nt(`Restored dialogues to unclaimed state (${g} ${g===1?"entry":"entries"} reset).`)}},{label:"All Currencies Inf",onClick:()=>{let g=pL();et(),nt(`Set all currencies to Infinity (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats Inf",onClick:()=>{let g=hL();et(),nt(`Set all stats to Infinity (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"All Currencies 0",onClick:()=>{let g=mL();et(),nt(`Set all currencies to 0 (${g} ${g===1?"currency":"currencies"} updated).`)}},{label:"All Stats 0",onClick:()=>{let g=gL();et(),nt(`Set all unlocked stats to 0 (${g} ${g===1?"stat":"stats"} updated).`)}},{label:"Max All Upgs",onClick:()=>{let g=LL(!1);et(),nt(`Maxed all ${g} upgrades.`)}},{label:"All Upgs 0",onClick:()=>{let g=_L(!1);et(),nt(`Reset all ${g} upgrades to 0.`)}},{label:"Enable All Auto",onClick:()=>{let g=Mb(!0);et(),nt(`Enabled automation for ${g} upgrades.`)}},{label:"Disable All Auto",onClick:()=>{let g=Mb(!1);et(),nt(`Disabled automation for ${g} upgrades.`)}},{label:"Unlock All Unlocks",onClick:()=>{let{unlocks:g,toggles:y}=yL();et(),nt(`Unlocked all unlock-type upgrades (${g} entries) and unlock flags (${y} toggled).`)}},{label:"Lock All Unlocks",onClick:()=>{let{locks:g,toggles:y}=vL();et(),nt(`Locked all unlock-type upgrades (${g} entries) and unlock flags (${y} toggled).`)}},{label:"Max All Lab Nodes",onClick:()=>{let g=0;Nt.forEach(y=>{Number.isFinite(y.maxLevel)&&(bo(y.id,y.maxLevel),g++)}),et(),nt(`Maxed ${g} Lab Nodes.`)}},{label:"All Lab Nodes 0",onClick:()=>{let g=0;Nt.forEach(y=>{bo(y.id,0),vi(y.id,0),Zo(y.id)&&mi(y.id,!1),g++}),et(),nt(`Reset ${g} Lab Nodes to 0 (Level & RP).`)}},{label:"Wipe Action Log",onClick:()=>{Gb([],t),Ih(),et(),nt("Action log wiped and reset.")}},{label:"Restock Warps",onClick:()=>{let g=b();if(g!=null)try{localStorage.setItem(B1(g),String(F1)),or(!0),et(),nt("Restocked Warps to full.")}catch{}}},{label:"OP Time Warp",onClick:()=>{let g=window.prompt("Enter amount of seconds to warp:");if(g==null)return;let y=Sh(g);if(!y||typeof y.isZero=="function"&&y.isZero()||typeof y.isNegative=="function"&&y.isNegative())return;let I,E=!1;Gt()?I=Rs(y):(I=au(y),E=!0),Li(I);let M=y.mulSmall?y.mulSmall(1e3):y.mulBigNumInteger(c.fromInt(1e3));Rr(I,M,E),et(),nt(`Performed OP Time Warp for ${K(y)} seconds.`)}}],o=document.createElement("div");o.className="debug-misc-button-list",n.forEach(g=>{let y=document.createElement("button");y.type="button",y.className="debug-panel-toggle debug-misc-button",y.textContent=g.label,y.addEventListener("click",g.onClick),o.appendChild(y)}),e.appendChild(o);let r=document.createElement("div");r.className="debug-panel-row";let i=document.createElement("label");i.textContent="Reset Values & Multis For:",r.appendChild(i);let s=document.createElement("select");s.className="debug-panel-input debug-reset-values-select",wf().forEach(g=>{let y=document.createElement("optgroup");y.label=g.title||g.key,g.currencies.forEach(I=>{let E=document.createElement("option");E.value=`currency:${I.key}`,E.textContent=`${g.title||g.key} \u2192 ${I.label}`,y.appendChild(E)}),g.stats.forEach(I=>{let E=document.createElement("option");E.value=`stat:${I.key}`,E.textContent=`${g.title||g.key} \u2192 ${I.label}`,y.appendChild(E)}),s.appendChild(y)});let l=document.createElement("option");l.value="allCurrencies",l.textContent="All Currencies",s.appendChild(l);let a=document.createElement("option");a.value="allUnlockedStats",a.textContent="All Unlocked Stats",s.appendChild(a);let u=document.createElement("option");u.value="allUnlocked",u.textContent="All Unlocked Stats & Currs",s.appendChild(u);let f=document.createElement("option");f.value="all",f.textContent="All",s.appendChild(f),s.querySelector(`option[value="${hf}"]`)||(hf=Yl),s.value=hf;let d=()=>bL(s.value||Yl,b()),m=Q1(d);s.addEventListener("change",()=>{hf=s.value||Yl,m.refresh()}),m.refresh(),r.appendChild(s),r.appendChild(m.button);let v=document.createElement("button");v.type="button",v.className="debug-panel-toggle reset-check",v.textContent="\u2705",v.addEventListener("click",()=>{let g=s.value||Yl,y=d(),I=m.isLocked(),E=(M=!0)=>{let A=tL(y,()=>SL(g))??{label:g,count:0};if(I&&y.forEach(G=>Hi(G)),m.refresh(),et(),M){let{label:G,count:P}=A;nt(`Reset ${P===1?"value and multiplier":"values and multipliers"} for ${G} to defaults.`)}};E(!0),setTimeout(()=>E(!1),100)}),r.appendChild(v),e.appendChild(r);let p=document.createElement("div");p.className="debug-panel-row";let h=document.createElement("button");h.type="button",h.className="debug-panel-toggle debug-danger-button",h.textContent="Wipe Slot & Refresh",h.addEventListener("click",()=>{if(window.confirm?.("Are you sure you want to wipe current slot data and refresh the page? This cannot be undone.")){try{localStorage.setItem("ccc:pendingSlotWipe",String(t))}catch{}try{localStorage.removeItem("ccc:saveSlot")}catch{}try{let y=document.querySelector(".menu-root"),I=document.getElementById("game-root");y&&(y.hidden=!1,y.style.display="",y.style.visibility=""),I&&(I.hidden=!0,I.style.display="none")}catch{}try{setTimeout(()=>{try{window.location.reload()}catch{}},16)}catch{try{window.location.reload()}catch{}}}}),p.appendChild(h),e.appendChild(p)}function ML(e){e.innerHTML="";let t=b();if(t==null){let o=document.createElement("div");o.className="debug-panel-empty",o.textContent="Unlocks are available once a save slot is selected.",e.appendChild(o);return}try{ss()}catch{}let n=Yb(t);n.sort((o,r)=>{let i=o.labelText??"",s=r.labelText??"";return i.localeCompare(s,void 0,{sensitivity:"base"})}),n.forEach(o=>{e.appendChild(aL(o))})}function zb(){if(!$i||Ql())return;Rb(),Ob(),Ab=0,Nb=0;let e=document.getElementById(jl);e&&e.remove();let t=document.createElement("div");t.id=jl,t.className="debug-panel";let n=document.createElement("div");n.className="debug-panel-header";let o=document.createElement("div"),r=document.createElement("div");r.className="debug-panel-title",r.textContent="Debug Panel";let i=document.createElement("div");i.className="debug-panel-close-buttons";let s=document.createElement("button");s.className="debug-panel-close",s.type="button",s.setAttribute("aria-label","Close Debug Panel"),s.textContent="Close",s.addEventListener("click",()=>Uo({preserveExpansionState:!0}));let l=document.createElement("button");l.className="debug-panel-close debug-panel-close-collapse",l.type="button",l.setAttribute("aria-label","Close Debug Panel and Collapse Sections"),l.textContent="Close & Collapse",l.addEventListener("click",()=>Uo()),i.appendChild(s),i.appendChild(l),o.appendChild(r);let a=document.createElement("div");if(a.className="debug-panel-info",[{text:"C: Close and preserve panels",hideOnMobile:!0},{text:"Shift+C: Close and collapse panels",hideOnMobile:!0},{text:"Input fields can take a normal, scientific, or BN number as input"},{text:'Input value "inf" sets a value to infinity or an upgrade to its level cap'},{text:"Toggle UL/L (Unlocked/Locked) on a value to freeze it from accruing normally"}].forEach(({text:f,hideOnMobile:d})=>{let m=document.createElement("div");m.className="debug-panel-info-line",d&&m.classList.add("debug-panel-info-mobile-hidden"),m.textContent=f,a.appendChild(m)}),o.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),t.appendChild(gf("Areas: main currency/stat/upgrade management for each area","debug-areas",f=>{xL(f)})),t.appendChild(gf("Unlocks: modify specific unlock flags","debug-unlocks",f=>{ML(f)})),t.appendChild(gf("Action Log: keep track of everything you do","debug-action-log",f=>{let d=document.createElement("div");d.id="action-log-entries",d.className="debug-panel-action-log",d.style.maxHeight="240px",d.style.overflowY="auto",f.appendChild(d),fa=d,Ih(),un(()=>{fa=null})})),t.appendChild(gf("Miscellaneous: helpful miscellaneous functions","debug-misc",f=>{CL(f)})),$1(t),document.body.appendChild(t),bf>0)try{t.scrollTop=bf}catch{}q1(),Di=!0}function mh(){if(!(!$i||Ql())){if(b()==null){Uo();return}Di||zb()}}function Uo({preserveExpansionState:e=!1}={}){kb=e?D1():If();let t=document.getElementById(jl);if(t){try{bf=t.scrollTop??0}catch{bf=0}t.remove()}Rb(),Di=!1}function TL(){if(!$i||Ql()||b()==null){Uo();return}Di?Uo({preserveExpansionState:!0}):mh()}function kL(){Uo(),dh()}function Lf(){if(!G1()){dh(),Uo();return}Ob(),dh();let e=document.createElement("button");e.id=Tb,e.className="debug-panel-toggle-button",e.type="button",e.textContent="Debug Panel";let t=null,n=o=>{TL()};e.addEventListener("click",o=>{if(t&&t!=="mouse"){t=null;return}t=null,n(o)}),document.body.appendChild(e)}function AL(e){if($i=!!e,!$i){kL();return}Lf()}function NL(e){AL(e)}var mf,jl,Tb,Yl,Di,$i,uh,kb,bf,hf,Ab,Nb,hh,fa,Zl,pa,vf,Kl,Bi,ma,Lb,da,_b,O1,P1,fh,B1,F1,ah,Fi,lh,Ui,Sf,Cb,cs=De(()=>{xt();qt();vt();An();go();vo();ho();Nu();qs();Es();mo();yn();ws();li();vp();hi();bp();Jo();lu();Jc();mf="debug-panel-style",jl="debug-panel",Tb="debug-panel-toggle",Yl=`currency:${Re.COINS}`,Di=!1,$i=!1,uh=[],kb=If(),bf=0,hf=Yl,Ab=0,Nb=0,hh=[],fa=null,Zl=new Map,pa=new Map,vf=new Set,Kl=new Map,Bi=new Map,ma=new Set;typeof window<"u"&&(window.__cccLockedStorageKeys=ma);Lb=!1,da=null,_b=null,O1="ccc:debug:stat-mult",P1="ccc:actionLog",fh=100,B1=e=>`ccc:warp:charges:${e}`,F1=24;ah="ccc:xp",Fi={unlock:e=>`${ah}:unlocked:${e}`,level:e=>`${ah}:level:${e}`,progress:e=>`${ah}:progress:${e}`},lh="ccc:mutation",Ui={unlock:e=>`${lh}:unlocked:${e}`,level:e=>`${lh}:level:${e}`,progress:e=>`${lh}:progress:${e}`},Sf=[{key:"spawnRate",label:"Spawn Rate"},{key:"xp",label:"XP"},{key:"mutation",label:"MP"},{key:"rp",label:"RP"}];Cb=!1;ec();Ub();document.addEventListener("keydown",e=>{if(!(!$i||Ql())&&e.key?.toLowerCase()==="c"&&!e.ctrlKey&&b()!=null){if(e.shiftKey){Di?(eL(),Uo()):mh(),e.preventDefault();return}Di?Uo({preserveExpansionState:!0}):mh(),e.preventDefault()}});document.addEventListener("DOMContentLoaded",()=>{Lf()});window.addEventListener("menu:visibilitychange",H1);window.addEventListener("saveSlot:change",()=>{Lf(),Di&&zb()})});var Qb={};It(Qb,{addExternalMutationGainMultiplierProvider:()=>fi,addMutationPower:()=>Ps,broadcastMutationChange:()=>wh,computeMutationMultiplierForLevel:()=>js,computeMutationRequirementForLevel:()=>Eh,getMutationCoinSprite:()=>Fm,getMutationGainMultiplier:()=>Cf,getMutationMultiplier:()=>_f,getMutationState:()=>yt,getTotalCumulativeMp:()=>nr,initMutationSystem:()=>tn,isMutationUnlocked:()=>Po,onMutationChange:()=>Ri,setMutationUnlockedForDebug:()=>Jl,unlockMutationSystem:()=>$r});function Mf(e){try{return e?.toStorage?.()}catch{return null}}function Wi(){try{jt()}catch{}}function Jb(e){let t=e;if(!t.isZero?.()){let n=Yi.size>0?Array.from(Yi):typeof oc=="function"?[oc]:[];for(let o of n)if(typeof o=="function")try{let r=o({baseGain:t.clone?.()??t,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});r instanceof tt?t=r.clone?.()??r:r!=null&&(t=tt.fromAny(r))}catch{}}return t}function PL(){if(typeof xh=="function"){try{xh()}catch{}xh=null}if(typeof Lh=="function"){try{Lh()}catch{}Lh=null}}function rc(e){if(e instanceof tt)try{return e.clone?.()??tt.fromAny(e)}catch{return St()}try{return tt.fromAny(e??0)}catch{return St()}}function BL(e){if(!e||typeof e!="object")return St();if(e.isInfinite?.())return e.clone?.()??e;let t=typeof e.toScientific=="function"?e.toScientific(18):"";if(!t||t==="Infinity")return e.clone?.()??e;let n=t.match(/^(\d+(?:\.\d+)?)e([+-]?\d+)$/i);if(!n)return e.clone?.()??e;if(parseInt(n[2],10)+1<=18){let i=e.floorToInteger?.()??e.clone?.()??e,s=i.toPlainIntegerString?.();if(!s||s==="Infinity")return i;try{let l=BigInt(s)/100n*100n;return l<=0n?tt.fromInt(100):tt.fromAny(l.toString())}catch{return i}}return e.clone?.()??e}function kf(e){if(!e||typeof e!="object")return 0;if(e.isInfinite?.())return Number.POSITIVE_INFINITY;try{let n=e.toPlainIntegerString?.();if(n&&n!=="Infinity"&&n.length<=15){let o=Number(n);if(Number.isFinite(o))return o}}catch{}let t=Ee(e);return!Number.isFinite(t)||t>308?Number.POSITIVE_INFINITY:Math.pow(10,t)}function Nh(e){function t(s){let l=Math.max(0,s+1),a=Math.max(0,l-10),u=-.0022175354763501742*l*l+.20449967884058884*l+2.016778189084622+.20418426693226513*Math.pow(a,1.6418337930413576);if(!Number.isFinite(u))return Number.POSITIVE_INFINITY;let f=1;if(l>10){let m=Math.pow(1.12,l-10);if(!Number.isFinite(m)||(f+=OL*(m-1),!Number.isFinite(f)))return Number.POSITIVE_INFINITY}let d=u*f;return Number.isFinite(d)?d:Number.POSITIVE_INFINITY}let n=kf(e);if(!Number.isFinite(n))return tt.fromAny("Infinity");let o=Math.max(0,n);if(o>=100)return tt.fromAny("Infinity");let r;if(o<=9)r=t(o);else if(o<=49){let s=t(9),l=500000.0000001,a=40,u=Math.max(1,s),f=Math.pow(l/u,1/a),d=o-9;r=u*Math.pow(f,d)}else{let s=o-49,l=297/2499,a=6-l,u=l*s*s+a;if(!Number.isFinite(u))return tt.fromAny("Infinity");r=Math.pow(10,u)*1.00001}if(!Number.isFinite(r)||r<=0)return tt.fromAny("Infinity");let i=ie(r);return BL(i)}function Wr(){let e=D.level;if(!!(e&&typeof e=="object"&&(e.isInfinite?.()||typeof e.isInfinite=="function"&&e.isInfinite()))){try{let o=c.fromAny("Infinity");D.requirement=o.clone?.()??o,D.progress=o.clone?.()??o}catch{(!D.requirement||typeof D.requirement!="object")&&(D.requirement=c.fromInt(0)),(!D.progress||typeof D.progress!="object")&&(D.progress=c.fromInt(0))}return}let n=Nh(D.level);D.requirement=n}function FL(e,t){if(!t||typeof t!="object"||!e||typeof e!="object")return 0;let n=t.isInfinite?.(),o=e.isInfinite?.();if(n)return o?1:0;if(t.isZero?.()||e.isZero?.())return 0;let s=Ee(e),l=Ee(t);if(!Number.isFinite(s)||!Number.isFinite(l))return s>=l?1:0;let a=s-l,u=Math.pow(10,a);return Number.isFinite(u)?u<=0?0:u>=1?1:u:a>=0?1:0}function Th(){return Xn.container&&Xn.container.isConnected?!0:(Xn.container=document.querySelector("[data-mp-hud].mp-counter"),Xn.container?(Xn.bar=Xn.container.querySelector(".mp-bar"),Xn.fill=Xn.container.querySelector(".mp-bar__fill"),Xn.levelValue=Xn.container.querySelector(".mp-level-value"),Xn.progress=Xn.container.querySelector("[data-mp-progress]"),!0):!1)}function Xi(e){try{return K(e)}catch{try{return e.toPlainIntegerString?.()??String(e)}catch{return"0"}}}function gr(){if(!Th())return;let{container:e,bar:t,fill:n,levelValue:o,progress:r}=Xn;if(!e)return;if(!D.unlocked){if(e.setAttribute("hidden",""),n&&(n.style.setProperty("--mp-fill","0%"),n.style.width="0%"),o&&(o.textContent="0"),r){let a=Xi(D.requirement);r.innerHTML=`0<span class="mp-progress-separator">/</span><span class="mp-progress-required">${a}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow","0");let a=Xi(D.requirement).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`0 / ${a||"10"} MP`)}ns();return}e.removeAttribute("hidden");let i=D.requirement,s=FL(D.progress,i),l=`${(s*100).toFixed(2)}%`;if(n&&(n.style.setProperty("--mp-fill",l),n.style.width=l),o&&(o.innerHTML=Xi(D.level)),r){let a=Xi(D.progress),u=Xi(i);r.innerHTML=`<span class="mp-progress-current">${a}</span><span class="mp-progress-separator">/</span><span class="mp-progress-required">${u}</span><span class="mp-progress-suffix">MP</span>`}if(t){t.setAttribute("aria-valuenow",(s*100).toFixed(2));let a=Xi(D.progress).replace(/<[^>]*>/g,""),u=Xi(i).replace(/<[^>]*>/g,"");t.setAttribute("aria-valuetext",`${a} / ${u} MP`)}ns()}function yr(e="update",t={}){let n=yt(),o={...n,slot:D.slot??b(),changeType:e,...t};if(Mh.forEach(r=>{try{r(n,e)}catch{}}),typeof window<"u")try{window.dispatchEvent(new CustomEvent("mutation:change",{detail:o}))}catch{}return o}function Rh(){let e=D.slot;if(e==null&&(e=b(),e!=null&&(D.slot=e)),e==null)return;try{localStorage.setItem(tc(e),D.unlocked?"1":"0")}catch{}try{localStorage.setItem(Vi(e),D.level.toStorage())}catch{}try{localStorage.setItem(ga(e),D.progress.toStorage())}catch{}ct(tc(e)),ct(Vi(e)),ct(ga(e));let t=(()=>{let u=D.unlocked,f=D.level,d=D.progress;try{u=localStorage.getItem(tc(e))==="1"}catch{}try{let m=localStorage.getItem(Vi(e));m&&(f=tt.fromAny(m))}catch{}try{let m=localStorage.getItem(ga(e));m&&(d=tt.fromAny(m))}catch{}return{unlocked:u,level:f,progress:d}})(),n=Mf(t.level),o=Mf(t.progress),r=Mf(D.level),i=Mf(D.progress),s=t.unlocked!==D.unlocked,l=n!=null&&r!=null&&n!==r,a=o!=null&&i!=null&&o!==i;(s||l||a)&&Tf(t,{skipPersist:!0})}function kh(e){return typeof window<"u"&&window.__cccLockedStorageKeys?window.__cccLockedStorageKeys.has(e):!1}function UL(){if(!D.unlocked)return;let e=D.slot??b();if(e!=null&&kh(Vi(e))){Wr();return}Wr();let t=D.requirement;if(!t||typeof t!="object"||t.isInfinite?.())return;let n=0,o=1e5;for(;D.progress.cmp?.(t)>=0&&n<o;){if(D.progress=D.progress.sub(t),D.level=D.level.add(ya()),Wr(),t=D.requirement,!t||typeof t!="object"){D.progress=St();break}if(t.isInfinite?.())break;n+=1}n>=o&&(D.progress=St())}function Tf(e,{skipPersist:t=!1}={}){D.unlocked=!!e.unlocked,D.level=rc(e.level),D.progress=rc(e.progress),D.unlocked||(D.level=St(),D.progress=St()),Wr(),t||Rh(),gr(),yr("load"),Wi()}function _h(e){let t=e??b();if(t==null){Tf({unlocked:!1,level:St(),progress:St()},{skipPersist:!0}),D.slot=null;return}let n=!1,o=St(),r=St();try{n=localStorage.getItem(tc(t))==="1"}catch{}try{let i=localStorage.getItem(Vi(t));i&&(o=tt.fromAny(i))}catch{}try{let i=localStorage.getItem(ga(t));i&&(r=tt.fromAny(i))}catch{}Tf({unlocked:n,level:o,progress:r},{skipPersist:!0}),D.slot=t}function DL(){for(;nc.length;){let e=nc.pop();try{e?.()}catch{}}}function Ch(e){jb!==e&&(DL(),jb=e,e!=null&&(nc.push(kt(tc(e),{onChange(t){let n=t==="1";D.unlocked!==n&&(D.unlocked=n,n||(D.level=St(),D.progress=St()),Wr(),gr(),yr("storage"),Wi())}})),nc.push(kt(Vi(e),{onChange(t){if(t)try{let n=tt.fromAny(t);D.level.cmp?.(n)!==0&&(D.level=n,Wr(),gr(),yr("storage"),Wi())}catch{}}})),nc.push(kt(ga(e),{onChange(t){if(t)try{let n=tt.fromAny(t);D.progress.cmp?.(n)!==0&&(D.progress=n,Wr(),gr(),yr("storage"))}catch{}}}))))}function tn({forceReload:e=!1}={}){if(PL(),Zb){let n=b();return(n!==D.slot||e)&&_h(n),Ch(n),Th(),gr(),yt()}Zb=!0,Th();let t=b();return D.slot=t,_h(t),Ch(t),gr(),Wi(),typeof window<"u"&&window.addEventListener("saveSlot:change",()=>{let n=b();D.slot=n,_h(n),Ch(n),gr(),Wi(),yr("slot")}),yt()}function yt(){return{unlocked:D.unlocked,level:rc(D.level),progress:rc(D.progress),requirement:rc(D.requirement)}}function Po(){return!!D.unlocked}function $r(){return tn(),D.unlocked?!1:(D.unlocked=!0,Wr(),Rh(),gr(),yr("unlock"),Wi(),!0)}function Jl(e){tn();let t=!!e;Tf({unlocked:t,level:t?D.level:St(),progress:t?D.progress:St()})}function Ps(e){tn();let t=D.slot??b();if(t!=null&&kh(ga(t))||!D.unlocked)return yt();let n=t!=null&&kh(Vi(t));if(D.level&&D.level.isInfinite?.()){let f=D.level.clone?.()??D.level,d=D.progress.clone?.()??D.progress;if(!D.progress?.isInfinite?.())try{D.progress=tt.fromAny("Infinity")}catch{}if(!D.requirement?.isInfinite?.())try{D.requirement=tt.fromAny("Infinity")}catch{}let m;try{m=e instanceof tt?e:tt.fromAny(e??0)}catch{m=St()}return m=Jb(m),m=Zn("mutation",m),yr("progress",{delta:m.clone?.()??m,levelsGained:St(),level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:f.clone?.()??f,previousProgress:d.clone?.()??d})}let o;try{o=e instanceof tt?e:tt.fromAny(e??0)}catch{o=St()}if(o=Jb(o),o=Zn("mutation",o),o.isZero?.())return yt();let r=o.clone?.()??o,i=D.level.clone?.()??D.level,s=D.progress.clone?.()??D.progress;if(D.progress=D.progress.add(r),D.progress.isInfinite?.()){if(!n)try{D.level=tt.fromAny("Infinity")}catch{}try{D.progress=tt.fromAny("Infinity")}catch{D.progress=St()}try{D.requirement=tt.fromAny("Infinity")}catch{}}else UL();Rh(),gr();let a=D.level.sub(i);return a.isZero?.()||Wi(),yr("progress",{delta:r.clone?.()??r,levelsGained:a.clone?.()??a,level:D.level.clone?.()??D.level,progress:D.progress.clone?.()??D.progress,requirement:D.requirement.clone?.()??D.requirement,previousLevel:i.clone?.()??i,previousProgress:s.clone?.()??s})}function wh(e={}){tn();let t=e.changeType??"manual";return yr(t,e)}function js(e){let t;if(e instanceof tt)try{t=e.clone?.()??e}catch{t=St()}else if(typeof e=="bigint")try{t=c.fromAny(e.toString())}catch{t=St()}else try{t=c.fromAny(e??0)}catch{t=St()}if(t&&t.isInfinite?.())try{return tt.fromAny("Infinity")}catch{return ya()}let n=kf(t);if(!Number.isFinite(n))try{return tt.fromAny("Infinity")}catch{return ya()}if(n<=0)return ya();let o=n*RL;return ie(o)}function Eh(e){let t;try{t=e instanceof tt?e:tt.fromAny(e??0)}catch{t=St()}try{return Nh(t)}catch{return St()}}function _f(){if(tn(),!D.unlocked)return ya();try{return js(D.level)}catch{return ya()}}function Cf(){let e=c.fromInt(1);if(Yi.size>0||oc){let t=Yi.size>0?Array.from(Yi):typeof oc=="function"?[oc]:[];for(let n of t)if(typeof n=="function")try{let o=n({baseGain:e.clone?.()??e,mutationLevel:D.level.clone?.()??D.level,mutationUnlocked:D.unlocked});o instanceof tt?e=o.clone?.()??o:o!=null&&(e=tt.fromAny(o))}catch{}}return e}function Fm(){if(!D.unlocked||D.level.isZero?.())return"img/currencies/coin/coin.webp";let e=kf(D.level);return Number.isFinite(e)?`img/mutations/m${Math.max(1,Math.min(25,Math.floor(e)))}.webp`:"img/mutations/m25.webp"}function Ri(e){return typeof e!="function"?()=>{}:(Mh.add(e),()=>{Mh.delete(e)})}function fi(e){return typeof e!="function"?()=>{}:(Yi.add(e),()=>{Yi.delete(e)})}function nr(){if(tn(),!D.unlocked)return St();if(D.level.isInfinite?.()||D.progress.isInfinite?.())return c.fromAny("Infinity");let e=kf(D.level);if(Number.isFinite(e)&&e>100)return D.progress.clone?.()??D.progress;let t=D.progress.clone?.()??D.progress;if(Number.isFinite(e)){let n=e;for(let o=0;o<n;o++){let r=Nh(c.fromInt(o));if(r.isInfinite?.())return c.fromAny("Infinity");t=t.add(r)}}return t}var Ah,tc,Vi,ga,tt,St,ya,RL,OL,D,Xn,Mh,nc,jb,Zb,xh,Lh,Yi,oc,go=De(()=>{xt();vt();cs();qt();xt();fd();An();Ah="ccc:mutation",tc=e=>`${Ah}:unlocked:${e}`,Vi=e=>`${Ah}:level:${e}`,ga=e=>`${Ah}:progress:${e}`,tt=c,St=()=>tt.fromInt(0),ya=()=>tt.fromInt(1),RL=Math.log10(2),OL=9/(Math.pow(1.12,50)-1);D={unlocked:!1,level:St(),progress:St(),requirement:St(),slot:null},Xn={container:null,bar:null,fill:null,levelValue:null,progress:null},Mh=new Set,nc=[],jb=null,Zb=!1,xh=null,Lh=null,Yi=new Set,oc=null;typeof window<"u"&&(window.mutationSystem=window.mutationSystem||{},Object.assign(window.mutationSystem,{initMutationSystem:tn,unlockMutationSystem:$r,addMutationPower:Ps,getMutationState:yt,getMutationMultiplier:_f,isMutationUnlocked:Po,getTotalCumulativeMp:nr,addExternalMutationGainMultiplierProvider:fi,getMutationGainMultiplier:Cf}))});var ic,eS,tS,Oh,Ph,Bh,nS=De(()=>{ic=`precision highp float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main() {\n    vUv = position * 0.5 + 0.5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}`,eS=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\n\nvoid main() {\n    /* Wave animation settings */\n    float speed = 1.2;\n    float time = uTime * speed;\n    \n    /* Combine sine waves for a more natural look */\n    /* vUv.x is 0..1 across the screen width */\n    float wave1 = sin(vUv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(vUv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n\n    /* Define the shoreline height (baseline) */\n    /* vUv.y=0 is bottom of canvas, vUv.y=1 is top */\n    /* We want to discard pixels below this threshold */\n    float threshold = 0.428 + wave; \n\n    if (threshold > vUv.y) {\n        discard;\n    }\n\n    /* Recalculate gradient based on the new "bottom" */\n    /* Map vUv.y from [threshold, 1.0] to [0.0, 1.0] */\n    float gradientY = clamp((vUv.y - threshold) / (1.0 - threshold), 0.0, 1.0);\n    \n    vec3 col = mix(uColorShallow, uColorDeep, gradientY);\n    \n    /* Add a subtle "foam" or highlight at the edge */\n    float edge = 1.0 - smoothstep(0.0, 0.028, vUv.y - threshold);\n    col = mix(col, vec3(1.0, 1.0, 1.0), edge * 0.4);\n    \n    gl_FragColor = vec4(col, 1.0);\n}`,tS=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uWaveMap; \nuniform vec3 uColorDeep;\nuniform vec3 uColorShallow;\nuniform vec3 uColorWaveDeep;  \nuniform vec3 uColorWave;      \n\n/* Simple noise for foam breakup */\nfloat hash(vec2 p) {\n    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\n}\nfloat noise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    vec2 u = f*f*(3.0-2.0*f);\n    return mix(mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),\n               mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x), u.y);\n}\n\nvoid main() {\n    vec2 uv = vUv;\n    \n    /* Sample the simulation (physics) */\n    /* Wave Logic */\n    vec2 waveUV = uv - vec2(0.0, 0.0285);\n    float intensity = texture2D(uWaveMap, waveUV).r;\n    \n    /* Shadow Logic: Look UP for the casting object (Standard drop shadow falls down) */\n    float shadowOffset = 8.0 / uResolution.y; \n    float shadowIntensity = texture2D(uWaveMap, waveUV + vec2(0.0, shadowOffset)).r;\n    \n    /* Discard only if BOTH are empty */\n    if (0.01 > intensity && 0.01 > shadowIntensity) discard;\n    \n    /* Directional Noise: Streaky vertical noise for rushing water effect */\n    /* Stretch heavily along Y-axis to simulate speed/motion blur */\n    float streakyNoise = noise(vec2(uv.x * 60.0, uv.y * 4.0 + uTime * 4.0));\n    \n    /* Define Zones based on Intensity */\n    /* Body (Medium Intensity): Darker/turbulent blue with noise */\n    /* Edge (High Intensity): Bright white foam */\n    \n    float foamThreshold = 0.5;\n    float foamMix = smoothstep(foamThreshold, foamThreshold + 0.2, intensity);\n    \n    /* Base Colors */\n    vec3 bodyColor = uColorWaveDeep;\n    vec3 foamColor = uColorWave;\n    \n    /* Mix Colors */\n    vec3 finalColor = mix(bodyColor, foamColor, foamMix);\n    \n    /* Add streaks to the body part */\n    if (0.9 > foamMix) {\n        finalColor += (streakyNoise - 0.5) * 0.15 * (1.0 - foamMix);\n    }\n    \n    /* Hard Edge & Opacity */\n    /* Ensure the front (bottom) remains sharp, back trails off */\n    \n    /* Calculate Alpha based on Intensity */\n    /* High Intensity (Front/Bottom): Alpha 1.0 (Fully Opaque) */\n    /* Medium Intensity (Body): Alpha 1.0 (Fully Opaque) */\n    /* Low Intensity (Top/Tail): Fades to 0.0 */\n    \n    float finalAlpha = smoothstep(0.02, 0.15, intensity);\n    \n    /* Screen Fade */\n    /* OLD: float screenFade = smoothstep(0.0, 0.1, uv.y) * (1.0 - smoothstep(0.9, 1.0, uv.y)); */\n    \n    /* Dynamic Shoreline Fade */\n    /* Replicate the wave calculation from BACKGROUND_FRAGMENT_SHADER */\n    /* Note: speed must match BACKGROUND_FRAGMENT_SHADER (1.2) */\n    float speed = 1.2;\n    float time = uTime * speed;\n    float wave1 = sin(uv.x * 8.0 - time) * 0.0285;\n    float wave2 = sin(uv.x * 15.0 - time * 0.6) * 0.014;\n    float wave = wave1 + wave2;\n    float threshold = 0.428 + wave;\n    \n    /* Fade out quickly after exiting the water body (below threshold) */\n    /* Fade starts slightly higher than the threshold to soften the transition */\n    /* We want full opacity at 'threshold + 0.15' and 0.0 opacity at '0.0' */\n    float shoreFade = smoothstep(0.0, threshold + 0.05, uv.y);\n    \n    float screenFade = shoreFade;\n    \n    /* --- Composite Shadow & Wave --- */\n    float waveAlpha = finalAlpha * screenFade;\n    \n    /* Shadow Alpha */\n    float shadowBaseAlpha = smoothstep(0.02, 0.15, shadowIntensity);\n    /* Shadow is weaker (40% opacity) */\n    float shadowAlpha = shadowBaseAlpha * 0.4 * screenFade;\n    \n    /* Mix: Wave over Shadow */\n    /* OutAlpha = WaveAlpha + ShadowAlpha * (1 - WaveAlpha) */\n    float outAlpha = waveAlpha + shadowAlpha * (1.0 - waveAlpha);\n    \n    /* OutRGB = WaveRGB * WaveAlpha + ShadowRGB * ShadowAlpha * (1 - WaveAlpha) */\n    /* Shadow is black (RGB=0), so second term is 0 */\n    vec3 outRGB = finalColor * waveAlpha; \n    \n    gl_FragColor = vec4(outRGB, outAlpha);\n}`,Oh=`attribute vec2 aPosition;\nattribute vec2 aUv;\nattribute float aAlpha; \n\nvarying vec2 vUv;\nvarying float vAlpha;\n\nvoid main() {\n    vUv = aUv;\n    vAlpha = aAlpha;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}`,Ph=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vUv;\nvarying float vAlpha;\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n    vec2 q = abs(p) - b;\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0) - r;\n}\n\nvoid main() {\n    vec2 p = vUv - 0.5;\n    \n    /* Shape: Rounded Box (Pill) */\n    vec2 b = vec2(0.35, 0.15);\n    float r = 0.05;\n    float d = sdRoundedBox(p, b, r);\n    \n    float shape = 1.0 - smoothstep(0.0, 0.02, d);\n    shape = clamp(shape, 0.0, 1.0);\n\n    /* Intensity Gradient: White Foam at Bottom (Leading Edge), Blue Body at Top */\n    /* vUv.y: 0=Bottom, 1=Top */\n    /* We want foam only at the very bottom, rapidly fading to blue body */\n    /* Note: Inverted smoothstep (edge0 > edge1) is used here to flip the gradient direction */\n    /* Reducing 0.45 to 0.42 shrinks the foam cap height */\n    float foam = smoothstep(0.45, 0.24, vUv.y);\n    \n    /* Body Gradient: Fade out towards the tail */\n    /* Starts fading around 0.4 (just after foam ends) and hits 0.0 at the top */\n    float bodyFade = smoothstep(0.4, 0.7, vUv.y);\n    float bodyBase = mix(0.45, 0.0, bodyFade);\n\n    /* Map gradient: Bottom=1.0 (Foam), Body=bodyBase */\n    float intensity = mix(bodyBase, 1.0, foam);\n\n    gl_FragColor = vec4(shape * intensity * vAlpha, 0.0, 0.0, 1.0);\n}`,Bh=`#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uLastFrame;\nuniform vec2 uResolution;\nuniform float uDt;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uResolution;\n    \n    /* Flow Downwards */\n    /* Speed: 16.0 pixels per frame (at sim res) -> 960.0 pixels per second */\n    vec2 flow = vec2(0.0, (685.0 * uDt) / uResolution.y); \n    \n    vec2 sourceUv = uv + flow;\n\n    if (sourceUv.y > 1.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    \n    vec4 center = texture2D(uLastFrame, sourceUv);\n    \n    /* Decay */\n    /* Correct decay for variable timestep */\n    /* 0.99 per 1/60th second -> pow(0.99, dt * 60.0) */\n    float decay = pow(0.99, uDt * 60.0);\n    \n    gl_FragColor = center * decay;\n}`});var iS={};It(iS,{WaterSystem:()=>Af,waterSystem:()=>Nf});function rS(e,t,n){let o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(o);throw console.error("Shader compile error:",r),console.error("Source start:",n.substring(0,100)),e.deleteShader(o),new Error("Shader compile error: "+r)}return o}function va(e,t,n){let o=rS(e,e.VERTEX_SHADER,t),r=rS(e,e.FRAGMENT_SHADER,n);if(!o||!r)return null;let i=e.createProgram();if(e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){let s=e.getProgramInfoLog(i);throw console.error("Program link error:",s),new Error("Program link error: "+s)}return i}var $L,oS,qL,GL,Af,Nf,Fh=De(()=>{nS();$L=[.2,.5,.9],oS=[.2,.9,1],qL=[1,1,1],GL=[.45,.8,1];Af=class{constructor(){this.bgCanvas=null,this.glBg=null,this.fgLayers=[],this.bgProgram=null,this.bgSimProgram=null,this.bgBrushProgram=null,this.width=0,this.height=0,this.simRes=512,this.bgReadFBO=null,this.bgWriteFBO=null,this.bgReadTexture=null,this.bgWriteTexture=null,this.quadBufferBg=null,this.bgBrushBuffer=null,this._boundResize=null}init(t,n){this.fgLayers=[],this.bgCanvas=document.getElementById(t);let o=Array.isArray(n)?n:[n];if(this.bgCanvas){if(this.glBg=this.bgCanvas.getContext("webgl",{alpha:!0,depth:!1})||this.bgCanvas.getContext("experimental-webgl"),!this.glBg){console.error("WaterSystem: WebGL not supported for BG");return}this.initBgShaders(),this.initBgBuffers(),this.initBgSimulation(),o.forEach(r=>{let i=document.getElementById(r);if(!i)return;i.style.display="block";let s=i.getContext("webgl",{alpha:!0,depth:!1})||i.getContext("experimental-webgl");if(!s){console.error(`WaterSystem: WebGL not supported for layer ${r}`);return}let l={canvas:i,gl:s,program:va(s,ic,tS),simProgram:va(s,ic,Bh),brushProgram:va(s,Oh,Ph),quadBuffer:null,brushBuffer:null,readFBO:null,writeFBO:null,readTexture:null,writeTexture:null},a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);l.quadBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,l.quadBuffer),s.bufferData(s.ARRAY_BUFFER,a,s.STATIC_DRAW),l.brushBuffer=s.createBuffer();let u=this.createSimResources(s);l.readFBO=u.readFBO,l.writeFBO=u.writeFBO,l.readTexture=u.readTex,l.writeTexture=u.writeTex,this.fgLayers.push(l)}),this.resize(),this._boundResize||(this._boundResize=()=>this.resize(),window.addEventListener("resize",this._boundResize))}}initBgShaders(){this.bgProgram=va(this.glBg,ic,eS),this.bgSimProgram=va(this.glBg,ic,Bh),this.bgBrushProgram=va(this.glBg,Oh,Ph)}initBgBuffers(){let t=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=this.glBg;this.quadBufferBg=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quadBufferBg),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),this.bgBrushBuffer=n.createBuffer()}initBgSimulation(){let t=this.createSimResources(this.glBg);this.bgReadFBO=t.readFBO,this.bgWriteFBO=t.writeFBO,this.bgReadTexture=t.readTex,this.bgWriteTexture=t.writeTex}createSimResources(t){let n=this.simRes,o=this.simRes;t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear");let r=()=>{let u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,o,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),u},i=r(),s=r(),l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);let a=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindFramebuffer(t.FRAMEBUFFER,null),{readFBO:l,writeFBO:a,readTex:i,writeTex:s}}resize(){let t=window.devicePixelRatio||1;if(this.bgCanvas&&this.glBg){let n=this.bgCanvas.getBoundingClientRect();this.bgCanvas.width=n.width*t,this.bgCanvas.height=n.height*t,this.glBg.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height)}if(this.fgLayers.length>0){let n=this.fgLayers[0].canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.fgLayers.forEach(o=>{let r=o.canvas.getBoundingClientRect();o.canvas.width=r.width*t,o.canvas.height=r.height*t,o.gl.viewport(0,0,o.canvas.width,o.canvas.height)})}}applyBrush(t,n,o,r,i,s,l,a){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,this.simRes,this.simRes),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);let u=i/this.width*2-1,f=-(s/this.height*2-1),d=l/this.width,m=a/this.height,v=new Float32Array([u-d,f-m,0,0,1,u+d,f-m,1,0,1,u-d,f+m,0,1,1,u+d,f+m,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,v,t.DYNAMIC_DRAW);let p=t.getAttribLocation(n,"aPosition"),h=t.getAttribLocation(n,"aUv"),g=t.getAttribLocation(n,"aAlpha");t.enableVertexAttribArray(p),t.vertexAttribPointer(p,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,20,16),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,null)}addWave(t,n,o,r,i=!1){if(!this.glBg||this.fgLayers.length===0)return;this.applyBrush(this.glBg,this.bgBrushProgram,this.bgBrushBuffer,this.bgReadFBO,t,n,o,r);let s=i?this.fgLayers.length-1:Math.floor(Math.random()*this.fgLayers.length),l=this.fgLayers[s];this.applyBrush(l.gl,l.brushProgram,l.brushBuffer,l.readFBO,t,n,o,r)}runSimStep(t,n,o,r,i,s,l,a){t.useProgram(n),t.viewport(0,0,this.simRes,this.simRes),t.bindFramebuffer(t.FRAMEBUFFER,i),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.uniform1i(t.getUniformLocation(n,"uLastFrame"),0),t.uniform2f(t.getUniformLocation(n,"uResolution"),this.simRes,this.simRes),t.uniform1f(t.getUniformLocation(n,"uDt"),a),t.bindBuffer(t.ARRAY_BUFFER,o);let u=t.getAttribLocation(n,"position");return t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),{readFBO:i,writeFBO:r,readTex:l,writeTex:s}}update(t){}spawnRandomWave(){if(!this.width)return;let t=Math.random()*this.width,n=0,o=.3+Math.random()*.2,r=this.width*o,i=r*.5;this.addWave(t,n,r,i)}render(t,n){if(!this.glBg)return;let o=t*2,r=Math.min(n,.1),i=.04,s=.016,l=[];if(r<i)l.push(r);else{let f=r;for(;f>0;){let d=Math.min(f,s);l.push(d),f-=d}}l.forEach(f=>{let d=this.runSimStep(this.glBg,this.bgSimProgram,this.quadBufferBg,this.bgReadFBO,this.bgWriteFBO,this.bgReadTexture,this.bgWriteTexture,f);this.bgReadFBO=d.readFBO,this.bgWriteFBO=d.writeFBO,this.bgReadTexture=d.readTex,this.bgWriteTexture=d.writeTex}),this.fgLayers.forEach(f=>{l.forEach(d=>{let m=this.runSimStep(f.gl,f.simProgram,f.quadBuffer,f.readFBO,f.writeFBO,f.readTexture,f.writeTexture,d);f.readFBO=m.readFBO,f.writeFBO=m.writeFBO,f.readTexture=m.readTex,f.writeTexture=m.writeTex})});let a=this.glBg;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.bgCanvas.width,this.bgCanvas.height),a.useProgram(this.bgProgram),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorDeep"),$L),a.uniform3fv(a.getUniformLocation(this.bgProgram,"uColorShallow"),oS),a.uniform1f(a.getUniformLocation(this.bgProgram,"uTime"),o),a.uniform2f(a.getUniformLocation(this.bgProgram,"uResolution"),this.bgCanvas.width,this.bgCanvas.height),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.bgReadTexture),a.uniform1i(a.getUniformLocation(this.bgProgram,"uWaveMap"),0),a.bindBuffer(a.ARRAY_BUFFER,this.quadBufferBg);let u=a.getAttribLocation(this.bgProgram,"position");a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this.fgLayers.forEach(f=>{let d=f.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,f.canvas.width,f.canvas.height),d.useProgram(f.program),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.readTexture),d.uniform1i(d.getUniformLocation(f.program,"uWaveMap"),0),d.uniform3fv(d.getUniformLocation(f.program,"uColorShallow"),oS),d.uniform3fv(d.getUniformLocation(f.program,"uColorWave"),qL),d.uniform3fv(d.getUniformLocation(f.program,"uColorWaveDeep"),GL),d.uniform1f(d.getUniformLocation(f.program,"uTime"),o),d.uniform2f(d.getUniformLocation(f.program,"uResolution"),f.canvas.width,f.canvas.height),d.bindBuffer(d.ARRAY_BUFFER,f.quadBuffer);let m=d.getAttribLocation(f.program,"position");d.enableVertexAttribArray(m),d.vertexAttribPointer(m,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)})}},Nf=new Af});var fS={};It(fS,{createSpawner:()=>jL});function uS(e){if(!e||typeof e!="object"){ba=!1,zi=0n;return}ba=!!e.unlocked;try{let t=e.level,n=typeof t?.toPlainIntegerString=="function"?t.toPlainIntegerString():null;zi=n&&n!=="Infinity"?BigInt(n):0n}catch{zi=0n}}function XL(e){let t=1-e;return 1-t*t*t}function YL(e){if(!e)return null;let t=sS.get(e);return t||(t=new Image,t.src=e,sS.set(e,t)),t}function jL({playfieldSelector:e=".area-cove .playfield",waterSelector:t="#water-background",coinsHost:n=".coins-layer",coinSrc:o="img/coin/coin.webp",coinSize:r=40,animationDurationMs:i=1500,surgeLifetimeMs:s=1400,surgeWidthVw:l=22,coinsPerSecond:a=1,perFrameBudget:u=24,maxActiveCoins:f=Je?HL:1e4,initialBurst:d=1,coinTtlMs:m=1e99,waveSoundSrc:v="sounds/wave_spawn.ogg",waveSoundDesktopVolume:p=.45,waveSoundMobileVolume:h=.2,waveSoundMinIntervalMs:g=160,enableDropShadow:y=!1}={}){let I=o,E={pf:document.querySelector(e),w:document.querySelector(t),c:document.querySelector(n),hud:document.getElementById("hud-bottom")};function M(){return!!(E.pf&&E.w&&E.c)}M()||console.warn("[Spawner] Missing required nodes. Check your selectors:",{playfieldSelector:e,waterSelector:t,coinsHost:n});let A=7,G=[],P=[],$=!1;if(E.c)for(let w=0;w<A;w++){let k=document.createElement("canvas");k.style.position="absolute",k.style.inset="0",k.style.pointerEvents="none",k.style.zIndex=`${10+w*10}`,E.c.appendChild(k);let O=k.getContext("2d",{alpha:!0});G.push(k),P.push(O)}let L=null,F=null;E.c&&(L=document.createElement("canvas"),L.style.position="absolute",L.style.inset="0",L.style.pointerEvents="none",L.style.zIndex="100",E.c.appendChild(L),F=L.getContext("2d",{alpha:!0}));let T={collectBatch:null,getMagnetUnit:null};function C(w){T={...T,...w}}let Y={pfRect:null,wRect:null,safeBottom:0,pfW:0};function Q(){if(!M())return!1;let w=E.pf.getBoundingClientRect(),k=E.w.getBoundingClientRect(),O=E.hud?E.hud.getBoundingClientRect().height:0;Y={pfRect:w,wRect:k,safeBottom:w.height-O,pfW:w.width};let N=window.devicePixelRatio||1;return G.forEach((B,pe)=>{if(B){B.width=w.width*N,B.height=w.height*N,B.style.width=w.width+"px",B.style.height=w.height+"px";let me=P[pe];me&&(me.setTransform(1,0,0,1,0,0),me.scale(N,N),me.imageSmoothingEnabled=!0,me.imageSmoothingQuality="high")}}),$=!0,L&&(L.width=w.width*N,L.height=w.height*N,L.style.width=w.width+"px",L.style.height=w.height+"px",F&&(F.setTransform(1,0,0,1,0,0),F.scale(N,N))),!0}Q();let ae="ResizeObserver"in window?new ResizeObserver(()=>Q()):null;ae&&E.pf&&ae.observe(E.pf),document.addEventListener("visibilitychange",()=>{document.hidden||Q()});let he=(w,k,O)=>Math.max(k,Math.min(O,w)),be=Math.max(2e3,f*3),Oe=12,ke=[],U=[],W=0,q=[],X=[];function J(){let w=document.createElement("div");w.className="coin",w.style.position="absolute",w.style.pointerEvents="auto",w.style.borderRadius="50%",w.style.willChange="transform",w.style.contain="layout style size";let k=document.createElement("img");return k.className="coin-inner",k.draggable=!1,k.alt="",k.style.width="100%",k.style.height="100%",k.src=I,k.style.objectFit="contain",k.style.borderRadius="50%",w.appendChild(k),y&&(w.style.filter="drop-shadow(0 2px 2px rgba(0,0,0,.35))"),w}let le=()=>ke.length?ke.pop():J();function fe(w){w.style.transition="",w.style.transform="",w.style.opacity="1",w.classList.remove("coin--collected");for(let k=0;k<=6;k++)w.classList.remove(`coin--size-${k}`);w.style.removeProperty("--ccc-start"),delete w.dataset.dieAt,delete w.dataset.mutationLevel,delete w.dataset.collected,w.style.willChange="transform",w.parentNode&&w.remove(),ke.length<be&&ke.push(w)}function _(w,k=-1){if(w.isRemoved)return;w.isRemoved=!0;let O=k;(O===-1||U[O]!==w)&&(w.index!==void 0&&U[w.index]===w?O=w.index:O=U.indexOf(w)),O!==-1&&(U[O]=null,W++),w.el?(fe(w.el),w.el=null):X.push({layer:w.sizeIndex||0,x:w.x,y:w.y,size:w.size||r})}function H(w){let k=w._coinObj;if(k){let O=-1;k.index!==void 0&&U[k.index]===k?O=k.index:O=U.indexOf(k),O!==-1&&(U[O]=null,W++),w._coinObj=null}}let z=new URL(v,document.baseURI).href,de=0;function ee(){let w=performance.now();if(w-de<g)return;de=w,pt(z,{volume:Je?h:p,type:"music"})}function re(){if(!M())return null;if((!Y.pfRect||!Y.wRect)&&Q(),f!==1/0&&U.length-W>=f){let _t=-1;if(se(2))for(let Bt=0;Bt<U.length;Bt++){let Co=U[Bt];if(Co&&Co.sizeIndex<4){_t=Bt;break}}else for(let Bt=0;Bt<U.length;Bt++)if(U[Bt]){_t=Bt;break}if(_t===-1)return null;let Pt=U[_t];Pt&&_(Pt,_t)}let w=Y.pfW,k=Y.wRect.top-Y.pfRect.top,O=Math.max(0,k),N=0;if(se(2)){let _t=Math.random();for(let Pt=6;Pt>=1;Pt--)if(_t<zL[Pt]){N=Pt;break}}N>=4&&Ul&&Ul()&&(N=3);let B=aS[N],pe=Oe+(N>=3?15*(N-2):0),me=pe,Le=Math.max(me,w-B-pe),Ce=me+Math.random()*(Le-me),Ke=Math.random()*100-50,He;if(B>=Y.pfW)He=(Y.pfW-B)/2;else{let _t=Y.pfW-B-pe;me>=_t?He=(Y.pfW-B)/2:He=he(Ce+Ke,me,_t)}let $e=Math.min(Y.wRect.height,Y.pfRect.height*.3),Me=Math.max($e+80,120),Pe=Math.max(Me+40,Y.safeBottom-B-6),we=he(Me+Math.random()*(Pe-Me),Me,Pe),Ye={x0:Ce,y0:O,x1:He,y1:we,jitterMs:0},rt=Y.pfRect.left-Y.wRect.left,Xe=KL[N],Ot=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),lt=.85+Math.random()*.3,Et=Ot*(Xe.w/100)*lt,Yt=Ot*(Xe.h/100)*lt,Wt=Ce+B/2+rt,Yn=O-k;return{wave:{x:Wt,y:Yn,width:Et,height:Yt},coin:Ye,sizeIndex:N}}function ge(w){if(!w.length||!M())return;let k=document.createDocumentFragment(),O=[],N=performance.now(),B=!1;for(let{wave:pe,coin:me,sizeIndex:Le}of w){if(pe&&(B=!0,Nf)){let Pe=Le>=4;Nf.addWave(pe.x,pe.y,pe.width,pe.height,Pe)}let Ce=aS[Le],Ke=1;if(se(8)){let Pe=ip(),we=Math.pow(25,Pe);Ke=Math.pow(we,Le)}else Ke=WL[Le];let He=Le>=4,$e=le();$e.style.width=`${Ce}px`,$e.style.height=`${Ce}px`,$e.className=`coin coin--size-${Le}`,$e.firstChild&&($e.firstChild.src=I),$e.style.transform=`translate3d(${me.x0}px, ${me.y0}px, 0) rotate(-10deg) scale(0.96)`,$e.style.opacity="0",ba?$e.dataset.mutationLevel=zi.toString():$e.dataset.mutationLevel="0";let Me={mutationLevel:ba?zi.toString():"0",el:$e,src:I,x:me.x0,y:me.y0,rot:-10,scale:.96,startX:me.x0,startY:me.y0,endX:me.x1,endY:me.y1,startTime:N+me.jitterMs,duration:i,dieAt:N+m,jitterMs:me.jitterMs,isRemoved:!1,settled:!1,size:Ce,sizeIndex:Le,valueMultiplier:Ke,forceDom:He,soundSrc:cS[Le]?`sounds/coin_pickup${cS[Le]}`:null,bMinX:Math.min(me.x0,me.x1)-Ce,bMaxX:Math.max(me.x0,me.x1)+Ce,bMinY:Math.min(me.y0,me.y1)-Ce,bMaxY:Math.max(me.y0,me.y1)+Ce};$e._coinObj=Me,Me.index=U.length,U.push(Me),O.push(Me),k.appendChild($e)}E.c.appendChild(k),O.length>0&&(O[0].el&&O[0].el.offsetHeight,requestAnimationFrame(()=>{for(let pe of O)pe.el&&(pe.el.style.transition=`transform ${i}ms ${VL} ${pe.jitterMs}ms`,pe.el.style.transform=`translate3d(${pe.endX}px, ${pe.endY}px, 0) rotate(0deg) scale(1)`,pe.el.style.opacity="1")})),B&&requestAnimationFrame(()=>{ee()})}function Be(w=1){if(!M())return;(!Y.pfRect||!Y.wRect)&&Q();let k=[];for(let O=0;O<w;O++){let N=re();N&&k.push(N)}k.length&&ge(k)}function ne(w,k){if(w.settled||w.isRemoved)return{x:w.x,y:w.y,rot:0,scale:1};let O=k-w.startTime;if(O<0)return{x:w.startX,y:w.startY,rot:-10,scale:.96};let N=O/w.duration;if(N>=1)return{x:w.endX,y:w.endY,rot:0,scale:1};let B=XL(N),pe=w.startX+(w.endX-w.startX)*B,me=w.startY+(w.endY-w.startY)*B,Le=-10+10*B,Ce=.96+.04*B;return{x:pe,y:me,rot:Le,scale:Ce}}function ve(w,k){let O=YL(k.src);if(O&&O.complete&&O.naturalWidth>0){let N=k.size||r;w.drawImage(O,k.x,k.y,N,N)}}function Ue(){if(P.length)if($){P.forEach((k,O)=>{G[O]&&(k.save(),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,G[O].width,G[O].height),k.restore(),y&&(k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2))});let w=U.length;for(let k=0;k<w;k++){let O=U[k];if(O&&O&&O.settled&&!O.isRemoved&&!O.el){let N=O.sizeIndex||0;P[N]&&ve(P[N],O)}}y&&P.forEach(k=>k.restore()),$=!1,q.length=0,X.length=0}else{if(X.length>0){y&&P.forEach(k=>{k.save(),k.shadowColor="rgba(0,0,0,0.35)",k.shadowBlur=2,k.shadowOffsetY=2});let w=U.length;for(let k=0;k<X.length;k++){let O=X[k],N=P[O.layer];if(!N)continue;let B=8,pe=O.x-B,me=O.y-B,Le=O.size+B*2;N.save(),N.beginPath(),N.rect(pe,me,Le,Le),N.clip(),N.clearRect(pe,me,Le,Le);let Ce=pe,Ke=pe+Le,He=me,$e=me+Le;for(let Me=0;Me<w;Me++){let Pe=U[Me];if(!Pe||!Pe.settled||Pe.isRemoved||Pe.el||(Pe.sizeIndex||0)!==O.layer)continue;let we=Pe.size||r,je=Pe.x,Ye=Pe.x+we,rt=Pe.y,Xe=Pe.y+we;Ye>Ce&&je<Ke&&Xe>He&&rt<$e&&ve(N,Pe)}N.restore()}y&&P.forEach(k=>k.restore()),X.length=0}if(q.length>0){y&&P.forEach(w=>{w.save(),w.shadowColor="rgba(0,0,0,0.35)",w.shadowBlur=2,w.shadowOffsetY=2});for(let w=0;w<q.length;w++){let k=q[w];if(!k.isRemoved&&k.settled&&!k.el){let O=k.sizeIndex||0;P[O]&&ve(P[O],k)}}y&&P.forEach(w=>w.restore()),q.length=0}}}let Ae=a,Fe=null,ce=performance.now(),te=0;function xe(w){(!Y.pfRect||!Y.wRect)&&Q();let k=(w-ce)/1e3;ce=w,k>.1&&(k=.1);for(let N=U.length-1;N>=0;N--){let B=U[N];if(!B||!B)continue;if(w>=B.dieAt){_(B,N);continue}if(B.sizeIndex===5&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=w-1e3,B.nextLightningInterval=0),w-B.lastLightningTime>B.nextLightningInterval)){B.lastLightningTime=w,B.nextLightningInterval=200+Math.random()*100;for(let Le=0;Le<3;Le++)Go(B,w)}if(B.sizeIndex===6&&!B.isRemoved&&(B.lastLightningTime||(B.lastLightningTime=w-1e3,B.nextLightningInterval=0),w-B.lastLightningTime>B.nextLightningInterval&&(B.lastLightningTime=w,B.nextLightningInterval=200+Math.random()*100,T.collectBatch))){let Le=ne(B,w),Ce=Le.x+B.size/2,Ke=Le.y+B.size/2,He=[],$e=B.size/2*(B.size/2),Me=U.length;for(let Pe=0;Pe<Me;Pe++){let we=U[Pe];if(!we||we===B||we.isRemoved||we.settled===!1||we.sizeIndex>3)continue;let je=we.x+(we.size||r)/2,Ye=we.y+(we.size||r)/2,rt=je-Ce,Xe=Ye-Ke;rt*rt+Xe*Xe>$e&&He.push(we)}if(He.length>0){for(let Ye=He.length-1;Ye>0;Ye--){let rt=Math.floor(Math.random()*(Ye+1));[He[Ye],He[rt]]=[He[rt],He[Ye]]}let Pe=He.slice(0,3),we=[],je=!1;for(let Ye of Pe){let rt=Ye.size||r,Xe=Ye.x+rt/2,Ot=Ye.y+rt/2;vr(B,Xe,Ot),qo(Xe,Ot,rt),we.push({coin:Ye}),je||(pt("sounds/lightning_strike.ogg",{volume:.25}),je=!0)}we.length>0&&T.collectBatch(we)}}if(B.settled)continue;let pe=w-B.startTime;if(pe<0)continue;if(pe/B.duration>=1){B.settled=!0,B.x=B.endX,B.y=B.endY,B.rot=0,B.scale=1,B.el&&!B.forceDom?(fe(B.el),B.el=null,q.push(B)):B.el&&(B.el.style.transition="none",B.el.style.transform=`translate3d(${B.x}px, ${B.y}px, 0) rotate(0deg) scale(1)`);continue}}te+=Ae*k;let O=Math.floor(te);if(O>0){te-=O;let N=Math.min(O,u);if(N>0){let B=performance.now(),pe=[],me=5;for(let Le=0;Le<N&&!(performance.now()-B>me);Le++){let Ce=re();Ce&&pe.push(Ce)}pe.length&&ge(pe)}}if(Ue(),W>50){let N=0;for(let B=0;B<U.length;B++){let pe=U[B];pe!==null&&(pe.index=N,U[N++]=pe)}U.length=N,W=0}Ne(k),Fe=requestAnimationFrame(xe)}function x(){if(!Fe){if(!M()){console.warn("[Spawner] start() called but required nodes are missing.");return}Q(),d>0&&Fe===null&&Be(d),ce=performance.now(),Fe=requestAnimationFrame(xe)}}function j(){Fe&&(cancelAnimationFrame(Fe),Fe=null)}function Z(w){Ae=Math.max(0,Number(w)||0)}function oe(){te=0,ce=performance.now()}function ye(w){let k=se(2)&&!!w;for(let O=U.length-1;O>=0;O--){let N=U[O];if(N&&N){if(k&&N.sizeIndex>=4){N.mutationLevel=ba?zi.toString():"0",N.el&&(N.el.dataset.mutationLevel=N.mutationLevel);continue}_(U[O],O)}}oe()}function ue(w){w&&(I=w)}function We(w){let k=w._coinObj;if(!k)return w.style.transform||"translate3d(0,0,0)";let{x:O,y:N,rot:B,scale:pe}=ne(k,performance.now());return`translate3d(${O}px, ${N}px, 0) rotate(${B}deg) scale(${pe})`}function ot(w){if(w.el)return w.el;if(w.isRemoved)return null;let k=le(),O=w.size||r;return k.style.width=`${O}px`,k.style.height=`${O}px`,k.className=`coin coin--size-${w.sizeIndex||0}`,k.style.transition="",k.style.transform=`translate3d(${w.x}px, ${w.y}px, 0) rotate(0deg) scale(1)`,k.firstChild&&(k.firstChild.src=w.src),k.style.opacity="1",k.dataset.mutationLevel=w.mutationLevel,k._coinObj=w,w.el=k,E.c.appendChild(k),X.push({layer:w.sizeIndex||0,x:w.x,y:w.y,size:w.size||r}),k}function Ie(w,k,O,N){let B=O;N&&(B=Math.max(O,260));let pe=O*O,me=[],Le=U.length,Ce=w-B,Ke=w+B,He=k-B,$e=k+B,Me=performance.now();for(let Pe=0;Pe<Le;Pe++){let we=U[Pe];if(!we||we.bMaxX<Ce||we.bMinX>Ke||we.bMaxY<He||we.bMinY>$e)continue;let je=we.size||r,Ye,rt;if(we.settled)Ye=we.x+je/2,rt=we.y+je/2;else{let Et=ne(we,Me);Ye=Et.x+je/2,rt=Et.y+je/2}if(Ye<Ce||Ye>Ke||rt<He||rt>$e)continue;let Xe=Ye-w,Ot=rt-k,lt=pe;if(N&&(we.sizeIndex||0)>0){let Et=je/2;lt=Et*Et}Xe*Xe+Ot*Ot<=lt&&(we.isRemoved||me.push(we))}return me}function Ge(w,k,O,N,B,pe){let me=B;pe&&(me=Math.max(B,260));let Le=B*B,Ce=[],Ke=U.length,He=Math.min(w,O)-me,$e=Math.max(w,O)+me,Me=Math.min(k,N)-me,Pe=Math.max(k,N)+me,we=O-w,je=N-k,Ye=we*we+je*je,rt=Le*Ye,Xe=performance.now();for(let Ot=0;Ot<Ke;Ot++){let lt=U[Ot];if(!lt||lt.bMaxX<He||lt.bMinX>$e||lt.bMaxY<Me||lt.bMinY>Pe)continue;let Et=lt.size||r,Yt,Wt;if(lt.settled)Yt=lt.x+Et/2,Wt=lt.y+Et/2;else{let pn=ne(lt,Xe);Yt=pn.x+Et/2,Wt=pn.y+Et/2}if(Yt<He||Yt>$e||Wt<Me||Wt>Pe)continue;let Yn=Yt-w,_t=Wt-k,Pt=Yn*we+_t*je,Bt=Le;if(pe&&(lt.sizeIndex||0)>0){let pn=Et/2;Bt=pn*pn}let Co=!1;if(Pt<=0)Yn*Yn+_t*_t<=Bt&&(Co=!0);else if(Pt>=Ye){let pn=Yt-O,Ta=Wt-N;pn*pn+Ta*Ta<=Bt&&(Co=!0)}else{let pn=Yn*je-_t*we;pn*pn<=Bt*Ye&&(Co=!0)}Co&&!lt.isRemoved&&Ce.push(lt)}return Ce}function Vt(w){_(w)}function ht(w,k,O){let N=O*O,B=[],pe=U.length,me=w-O,Le=w+O,Ce=k-O,Ke=k+O,He=performance.now();for(let $e=0;$e<pe;$e++){let Me=U[$e];if(!Me||Me.bMaxX<me||Me.bMinX>Le||Me.bMaxY<Ce||Me.bMinY>Ke)continue;let Pe=Me.size||r,we,je;if(Me.settled)we=Me.x+Pe/2,je=Me.y+Pe/2;else{let Xe=ne(Me,He);we=Xe.x+Pe/2,je=Xe.y+Pe/2}if(we<me||we>Le||je<Ce||je>Ke)continue;let Ye=we-w,rt=je-k;Ye*Ye+rt*rt<=N&&(!Me.el&&!Me.isRemoved&&ot(Me),Me.el&&B.push(Me.el))}return B}function dn(w,k,O,N,B){let pe=B*B,me=[],Le=U.length,Ce=Math.min(w,O)-B,Ke=Math.max(w,O)+B,He=Math.min(k,N)-B,$e=Math.max(k,N)+B,Me=O-w,Pe=N-k,we=Me*Me+Pe*Pe,je=pe*we,Ye=performance.now();for(let rt=0;rt<Le;rt++){let Xe=U[rt];if(!Xe||Xe.bMaxX<Ce||Xe.bMinX>Ke||Xe.bMaxY<He||Xe.bMinY>$e)continue;let Ot=Xe.size||r,lt,Et;if(Xe.settled)lt=Xe.x+Ot/2,Et=Xe.y+Ot/2;else{let Pt=ne(Xe,Ye);lt=Pt.x+Ot/2,Et=Pt.y+Ot/2}if(lt<Ce||lt>Ke||Et<He||Et>$e)continue;let Yt=lt-w,Wt=Et-k,Yn=Yt*Me+Wt*Pe,_t=!1;if(Yn<=0)Yt*Yt+Wt*Wt<=pe&&(_t=!0);else if(Yn>=we){let Pt=lt-O,Bt=Et-N;Pt*Pt+Bt*Bt<=pe&&(_t=!0)}else{let Pt=Yt*Pe-Wt*Me;Pt*Pt<=je&&(_t=!0)}_t&&(!Xe.el&&!Xe.isRemoved&&ot(Xe),Xe.el&&me.push(Xe.el))}return me}document.addEventListener("visibilitychange",()=>{if(!document.hidden){if(typeof window<"u"&&window.__tsunamiActive)return;Fe||x()}});function Vn(){M()&&Be(1)}let $t=[],_n=[];function jr(w,k){if(!w||!k)return;let O=w.size||r,N=k.size||r,B=w.x+O/2,pe=w.y+O/2,me=k.x+N/2,Le=k.y+N/2;$t.push({x1:B,y1:pe,x2:me,y2:Le,age:0,life:.15})}function qo(w,k,O){if(!E.pf)return;let N=document.createElement("div");N.className="coin-stain";let B=O*1.2;N.style.width=`${B}px`,N.style.height=`${B}px`,N.style.left=`${w-B/2}px`,N.style.top=`${k-B/2}px`,E.pf.appendChild(N),setTimeout(()=>{N.style.opacity="0",setTimeout(()=>{N.parentNode&&N.remove()},1e3)},2500)}function Go(w,k){let O=Math.random()*Math.PI*2,N=(w.size||r)/2,B=N*lS,pe=Math.cos(O)*B,me=Math.sin(O)*B,Le=N*(.7+Math.random()*.6),Ce=Math.cos(O)*(B+Le),Ke=Math.sin(O)*(B+Le);$t.push({parentCoin:w,relX1:pe,relY1:me,relX2:Ce,relY2:Ke,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:20,width:5});let He=3+Math.floor(Math.random()*3);for(let $e=0;$e<He;$e++){let Me=.3+Math.random()*.5,Pe=pe+(Ce-pe)*Me,we=me+(Ke-me)*Me,je=O+(Math.random()*1.2-.6),Ye=Le*(.4+Math.random()*.4),rt=Pe+Math.cos(je)*Ye,Xe=we+Math.sin(je)*Ye;$t.push({parentCoin:w,relX1:Pe,relY1:we,relX2:rt,relY2:Xe,x1:0,y1:0,x2:0,y2:0,age:0,life:.2,jaggedScale:10,width:2.5})}pt("sounds/lightning_zap.ogg",{volume:.25})}function vr(w,k,O){if(!w)return;let N=w.size||r,B=performance.now(),pe=ne(w,B),me=pe.x+N/2,Le=pe.y+N/2,Ce=k-me,Ke=O-Le,He=Math.atan2(Ke,Ce),$e=Math.sqrt(Ce*Ce+Ke*Ke),Me=N/2*lS,Pe=Math.cos(He)*Me,we=Math.sin(He)*Me;$t.push({parentCoin:w,relX1:Pe,relY1:we,x2:k,y2:O,age:0,life:.25,width:6,jaggedScale:25});let je=me+Pe,Ye=Le+we,rt=6+Math.floor(Math.random()*5);for(let Xe=0;Xe<rt;Xe++){let Ot=.1+Math.random()*.8,lt=je+(k-je)*Ot,Et=Ye+(O-Ye)*Ot,Yt=He+(Math.random()*1.6-.8),Wt=$e*(.1+Math.random()*.3),Yn=lt+Math.cos(Yt)*Wt,_t=Et+Math.sin(Yt)*Wt;if($t.push({x1:lt,y1:Et,x2:Yn,y2:_t,age:0,life:.25,width:2,jaggedScale:15}),Math.random()<.4){let Bt=lt+(Yn-lt)*.5,Co=Et+(_t-Et)*.5,pn=Yt+(Math.random()*1-.5),Ta=Wt*.5;$t.push({x1:Bt,y1:Co,x2:Bt+Math.cos(pn)*Ta,y2:Co+Math.sin(pn)*Ta,age:0,life:.25,width:1.5,jaggedScale:10})}}}function Ne(w){if(!F||!L)return;F.clearRect(0,0,L.width,L.height);let k=performance.now();F.lineCap="round",F.lineJoin="round";for(let O=$t.length-1;O>=0;O--){let N=$t[O];if(N.age+=w,N.age>=N.life){$t.splice(O,1);continue}let B=N.x1,pe=N.y1,me=N.x2,Le=N.y2;if(N.parentCoin){let He=ne(N.parentCoin,k),$e=He.x+(N.parentCoin.size||r)/2,Me=He.y+(N.parentCoin.size||r)/2;B=$e+N.relX1,pe=Me+N.relY1,N.relX2!==void 0&&(me=$e+N.relX2,Le=Me+N.relY2)}let Ce=1-N.age/N.life;F.strokeStyle=`rgba(200, 240, 255, ${Ce})`,F.lineWidth=N.width||3,F.shadowColor="rgba(220, 245, 255, 0.9)",F.shadowBlur=20;let Ke=6;F.beginPath(),F.moveTo(B,pe);for(let He=1;He<=Ke;He++){let $e=He/Ke,Me=B+(me-B)*$e,Pe=pe+(Le-pe)*$e;if(He===Ke)F.lineTo(me,Le);else{let we=-(Le-pe),je=me-B,Ye=Math.sqrt(we*we+je*je),rt=N.jaggedScale||40;if(Ye>0){let Xe=(Math.random()-.5)*rt*(1-Math.abs($e-.5));F.lineTo(Me+we/Ye*Xe,Pe+je/Ye*Xe)}else F.lineTo(Me,Pe)}}F.stroke(),F.shadowBlur=0}for(let O=_n.length-1;O>=0;O--){let N=_n[O];if(N.age+=w,N.age>=N.life){_n.splice(O,1);continue}N.x+=N.vx*w,N.y+=N.vy*w;let B=1-N.age/N.life;F.fillStyle=N.color,F.globalAlpha=B,F.beginPath(),F.arc(N.x,N.y,N.size,0,Math.PI*2),F.fill(),F.globalAlpha=1}}return{start:x,stop:j,setRate:Z,clearBacklog:oe,clearPlayfield:ye,setCoinSprite:ue,getCoinTransform:We,findCoinsInRadius:ht,findCoinsInPath:dn,findCoinTargetsInRadius:Ie,findCoinTargetsInPath:Ge,ensureCoinVisual:ot,removeCoinTarget:Vt,detachCoin:H,recycleCoin:fe,playEntranceWave:Vn,setDependencies:C,hasBigCoins:()=>se(2)&&U.some(w=>w&&w.sizeIndex>=4)}}var ba,zi,HL,sS,VL,aS,lS,WL,zL,cS,KL,dS=De(()=>{Ec();go();vo();yn();Cn();Fh();mo();ba=!1,zi=0n,HL=2500,sS=new Map;try{uS(yt())}catch{ba=!1,zi=0n}try{Ri(e=>{uS(e)})}catch{}VL="cubic-bezier(0.215, 0.61, 0.355, 1)";aS=[40,55,80,125,200,320,512],lS=.78,WL=[1,25,625,15625,390625,9765625,244140625],zL=[0,.1,.01,.001,1e-4,1e-5,1e-6],cS=["","_size1.ogg","_size2.ogg","_size3.ogg","_size4.ogg","_size5.ogg","_size6.ogg"],KL=[{w:22,h:12},{w:28,h:15},{w:36,h:19},{w:48,h:25},{w:64,h:34},{w:85,h:45},{w:120,h:65}]});var SS={};It(SS,{afterSlotWrite:()=>Gh,beforeSlotWrite:()=>qh});function yS(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function e_(e,t=JL){!e||e<=0||sc.set(e,yS()+t)}function mS(e){if(!e||e<=0)return!1;let t=sc.get(e);return t==null?!1:t<=yS()?(sc.delete(e),!1):!0}function t_(){sc.clear()}function Of(){try{return typeof localStorage<"u"}catch{return!1}}function $h(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=Number.parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function vS(e){let t=new Map;if(!Of())return ac.set(e,t),t;try{for(let n=0;n<localStorage.length;n+=1){let o=localStorage.key(n);if(!o||!o.startsWith(es))continue;let r=$h(o);if(r==null||r!==e)continue;let i="";try{i=localStorage.getItem(o)??""}catch{i=""}t.set(o,i)}}catch{}return ac.set(e,t),t}function bS(e){return!Number.isFinite(e)||e<=0?null:ac.has(e)?ac.get(e):vS(e)}function qh(e){if(!Of()||Rf>0)return;let t=String(e);if(!t.startsWith(es))return;let n=$h(t);if(n==null)return;let o=bS(n);if(o)try{for(let[r,i]of o.entries()){let s="";try{s=localStorage.getItem(r)??""}catch{s=""}if(s!==i){if(Rf===0){Rf+=1;try{Mn(n)}finally{Rf-=1}}vS(n);return}}}catch{}}function Gh(e,t){let n=String(e);if(!n.startsWith(es))return;let o=$h(n);if(o==null)return;let r=bS(o)||new Map;r.set(n,String(t??"")),ac.set(o,r)}function n_(e=[]){let t=0;for(let n of e){for(let o=0;o<n.length;o+=1)t=(t<<5)-t+n.charCodeAt(o)>>>0;t=t+2654435761>>>0}return`${e.length}|${t.toString(16)}`}function o_(){let e=new Map;if(!Of())return e;try{for(let t=0;t<localStorage.length;t+=1){let n=localStorage.key(t);if(!n||!n.startsWith(es))continue;let o=n.match(/:(\d+)$/);if(!o)continue;let r=parseInt(o[1],10);if(!Number.isFinite(r)||r<=0)continue;let i=rd(r);if(n===i){e.has(r)||e.set(r,[]);continue}let s="";try{s=localStorage.getItem(n)??""}catch{}e.has(r)||e.set(r,[]),e.get(r).push(`${n}=${s}`)}}catch{}return e.forEach(t=>t.sort()),e}function r_(e){let t=new Set;e&&e.forEach((o,r)=>t.add(r));let n=b();return Number.isFinite(n)&&n>0&&t.add(n),typeof document<"u"&&document.querySelectorAll(".slot-card").forEach((o,r)=>t.add(r+1)),[...t].filter(o=>Number.isFinite(o)&&o>0)}function i_(e,t){if(!e||e<=0)return;let n=Array.isArray(t)?t:[],o=id(e);if(n.length===0){o&&(mS(e)||Mn(e),vc(e,null));return}let r=n_(n);o&&r!==o&&!mS(e)&&Mn(e),r!==o&&vc(e,r)}function Ia(){if(!Of())return;let e=o_();r_(e).forEach(n=>{let o=e.get(n)??[];i_(n,o)})}function s_(){if(Uh!=null)return;Uh=(typeof window<"u"?window:globalThis).setTimeout(()=>{Uh=null,Ia()},QL)}function a_(e){let t=e?.detail;if(!t)return;let n=typeof t.slot=="number"?t.slot:Number.parseInt(t.slot,10),o=Number.isFinite(n)?n:null;if(!(!Number.isFinite(o)||o<=0)){if(t.trusted){e_(o),s_();return}sc.delete(o),Ia()}}function l_(){typeof window>"u"||pS==null&&(pS=window.setInterval(Ia,ZL))}function c_(){return typeof document>"u"?null:document.querySelector('.hud-bottom .game-btn[data-btn="shop"]')}function Sa(){let e=c_();if(!e)return;if(!ts()){(e.dataset.poopShopApplied===Dh||e.style.backgroundImage||e.style.background)&&(e.style.backgroundImage="",e.style.background="",delete e.dataset.poopShopApplied);return}((e.style.backgroundImage||e.style.background)!==hS||e.dataset.poopShopApplied!==Dh)&&(e.style.backgroundImage=hS,e.dataset.poopShopApplied=Dh)}function u_(){typeof window>"u"||gS==null&&(Sa(),gS=window.setInterval(Sa,50),window.addEventListener("saveSlot:change",Sa),window.addEventListener("saveSlot:modified",e=>{try{let t=b();e?.detail?.slot===t&&Sa()}catch{Sa()}}))}function f_(){typeof window>"u"||(Ia(),l_(),u_(),window.addEventListener("saveSlot:change",()=>Ia()),window.addEventListener("saveIntegrity:storageMutation",a_,{passive:!0}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden||(t_(),Ia(),Sa())}))}var ZL,JL,QL,pS,Uh,sc,ac,Rf,hS,Dh,gS,Hh=De(()=>{vt();ZL=1e4,JL=750,QL=50,pS=null,Uh=null,sc=new Map;ac=new Map,Rf=0;hS="linear-gradient(180deg,#a9793d,#7b5534)",Dh="1",gS=null;f_()});var kS={};It(kS,{initPopups:()=>g_,teardownpopups:()=>y_});function Xh(){return _o||(_o=document.createElement("div"),_o.className="currency-popups",_o.setAttribute("aria-live","polite"),_o.setAttribute("aria-atomic","false"),document.body.appendChild(_o),_o)}function Ki(e){if(e==null)return null;if(e instanceof c)return e.clone?.()??e;if(typeof e.clone=="function"&&e.sig!=null)try{return e.clone()}catch{}try{return c.fromAny(e)}catch{return null}}function Vh(e){if(!e)return!0;if(typeof e.isZero=="function")try{return e.isZero()}catch{return!1}return!1}function wS(e){if(!e)return;let{amountEl:t,amount:n,meta:o}=e,r=o.formatAmount?o.formatAmount(n):K(n);t&&(t.innerHTML=r)}function p_(e,t=ES){e&&(e.timeoutId||(e.timeoutId=window.setTimeout(()=>{lc.delete(e.type),e.element.classList.remove("is-visible"),e.element.classList.add("is-leaving");let n=()=>{e.element.removeEventListener("transitionend",n),e.element.remove()};e.element.addEventListener("transitionend",n,{once:!0}),window.setTimeout(n,480)},t)))}function m_(e,t,n){Xh();let o=document.createElement("div");o.className="currency-popup",o.setAttribute("role","status");let r=document.createElement("span");r.className="currency-popup__plus",r.textContent="+";let i=document.createElement("img");i.className="currency-popup__icon",i.src=t.icon,i.alt=t.iconAlt||"";let s=document.createElement("span");s.className="currency-popup__text";let l=document.createElement("span");return l.className="currency-popup__amount",s.append(l),o.append(r,i,s),o.dataset.type=e,{type:e,meta:t,element:o,amountEl:l,amount:n.clone?.()??n,timeoutId:null}}function Yh(e,t,n={}){if(typeof window<"u"&&window.__tsunamiActive)return;let o=b();if(o!=null){if(["xp"].includes(e)){if(Kt(`ccc:xp:progress:${o}`))return}else if(["mp"].includes(e)){if(Kt(`ccc:mutation:progress:${o}`))return}else if(Object.values(Re).includes(e)&&mn(e,o))return}let r=d_[e],i=Object.assign({duration:ES,accumulate:!0},r||{},n);if(!i.icon)return;let s=Ki(t);if(!s||Vh(s))return;let l=i.accumulate!==!1?lc.get(e):null;if(l){l.amount=l.amount.add(s),l.meta=i,wS(l);return}let a=m_(e,i,s);a.meta=i,wS(a),lc.set(e,a);let u=Xh(),f=IS.indexOf(e),d=null;if(f>=0){let m=Array.from(u.children);for(let v of m){let p=v.dataset.type;if(IS.indexOf(p)>f){d=v;break}}}d?u.insertBefore(a.element,d):u.appendChild(a.element),requestAnimationFrame(()=>a.element.classList.add("is-visible")),p_(a,i.duration)}function h_(){let e={};for(let t of Object.values(Re))e[t]=Pa(t);return e}function xS(){try{let e=h_();Object.entries(e).forEach(([t,n])=>{let o=Ki(n)||c.fromInt(0);zr.set(t,o.clone?.()??o)}),zr.has("mp")||zr.set("mp",c.fromInt(0))}catch{zr.clear()}}function LS(){lc.forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.element.remove()}),lc.clear()}function _S(e){let t=e?.detail;if(!t?.key)return;let n=t.key,o=Ki(t.value)||c.fromInt(0),r=zr.get(n)||c.fromInt(0),i=c.fromInt(0),s=null,l=t.delta!=null?Ki(t.delta):null;l&&typeof l.cmp=="function"&&l.cmp(i)>0?s=l:typeof o.cmp=="function"&&o.cmp(r)>0&&(s=o.sub(r)),s&&!(typeof s.isZero=="function"&&s.isZero())&&Yh(n,s),zr.set(n,o.clone?.()??o)}function CS(e){let t=e?.detail;if(!t)return;let n=Ki(t.xpAdded);n&&!Vh(n)&&Yh("xp",n)}function MS(e){let t=e?.detail;if(!t)return;let n=Ki(t.delta);n&&!Vh(n)&&Yh("mp",n);let o=Ki(t.progress);o&&zr.set("mp",o.clone?.()??o)}function TS(){LS(),xS()}function g_(){Pf||(Pf=!0,Xh(),xS(),window.addEventListener("currency:change",_S),window.addEventListener("xp:change",CS),window.addEventListener("mutation:change",MS),window.addEventListener("saveSlot:change",TS))}function y_(){Pf&&(window.removeEventListener("currency:change",_S),window.removeEventListener("xp:change",CS),window.removeEventListener("mutation:change",MS),window.removeEventListener("saveSlot:change",TS),LS(),zr.clear(),_o&&_o.remove(),_o=null,Pf=!1)}var ES,IS,d_,_o,Pf,zr,lc,AS=De(()=>{xt();qt();vt();ES=6767,IS=["coins","xp","books","gold","mp","magic","gears","dna"],d_={[Re.COINS]:{icon:"img/currencies/coin/coin.webp",iconAlt:"Coin"},xp:{icon:"img/stats/xp/xp.webp",iconAlt:"XP"},[Re.BOOKS]:{icon:"img/currencies/book/book.webp",iconAlt:"Book"},[Re.GOLD]:{icon:"img/currencies/gold/gold.webp",iconAlt:"Gold"},mp:{icon:"img/stats/mp/mp.webp",iconAlt:"Mutation Power"},[Re.MAGIC]:{icon:"img/currencies/magic/magic.webp",iconAlt:"Magic"},[Re.GEARS]:{icon:"img/currencies/gear/gear.webp",iconAlt:"Gears"},[Re.DNA]:{icon:"img/currencies/dna/dna.webp",iconAlt:"DNA"}},_o=null,Pf=!1,zr=new Map,lc=new Map});var DS={};It(DS,{flushBackupSnapshot:()=>US,getSuspendMetadata:()=>O_,installSuspendSafeguards:()=>R_,markProgressDirty:()=>Do,restoreFromBackupIfNeeded:()=>N_});function cc(){if(typeof indexedDB>"u")return!1;try{return typeof indexedDB.open=="function"}catch{return!1}}function _a(){if(typeof localStorage>"u")return!1;try{let e=`${lo}__test__`;return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}async function PS(){if(!cc())throw new Error("IndexedDB unavailable");return wa||(wa=new Promise((e,t)=>{let n=!1;try{let o=indexedDB.open(v_,b_);o.onupgradeneeded=()=>{try{let r=o.result;r.objectStoreNames.contains(La)||r.createObjectStore(La)}catch(r){console.warn("Failed to upgrade suspend safeguard DB",r)}},o.onsuccess=()=>{n=!0;let r=o.result;r.onversionchange=()=>{try{r.close()}catch{}wa=null},e(r)},o.onerror=()=>{n||t(o.error||new Error("Failed to open suspend safeguard DB"))},o.onblocked=()=>{}}catch(o){t(o)}}).catch(e=>{throw wa=null,e}),wa)}function E_(){if(!_a())return null;let e={},t=!1;try{for(let n=0;n<localStorage.length;n++){let o=localStorage.key(n);if(!o||!o.startsWith(lo))continue;let r=null;try{r=localStorage.getItem(o)}catch{r=null}r!=null&&(e[o]=r,t=!0)}}catch(n){return console.warn("Failed to read localStorage for snapshot",n),null}return{data:e,savedAt:Date.now(),hasData:t}}async function x_(e){try{let t=await PS();return await new Promise((n,o)=>{let r=!1,i=t.transaction(La,"readwrite");i.oncomplete=()=>{r||(r=!0,n(!0))},i.onabort=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction aborted")))},i.onerror=()=>{r||(r=!0,o(i.error||new Error("Snapshot transaction error")))};let l=i.objectStore(La).put(e,OS);l.onerror=()=>{r||(r=!0,o(l.error||new Error("Snapshot write failed")))}}),!0}catch(t){return console.warn("Failed to persist suspend snapshot",t),!1}}async function L_(){try{let e=await PS();return await new Promise((t,n)=>{let o=!1,r=e.transaction(La,"readonly");r.oncomplete=()=>{o||(o=!0,t(null))},r.onabort=()=>{o||(o=!0,n(r.error||new Error("Snapshot read aborted")))},r.onerror=()=>{o||(o=!0,n(r.error||new Error("Snapshot read error")))};let s=r.objectStore(La).get(OS);s.onsuccess=()=>{o||(o=!0,t(s.result||null))},s.onerror=()=>{o||(o=!0,n(s.error||new Error("Snapshot get failed")))}})}catch(e){return console.warn("Failed to load suspend snapshot",e),null}}function __(){try{navigator?.storage?.persist&&navigator.storage.persist().catch(()=>{})}catch{}}function Wh(){try{throw new Error("ccc-storage-write")}catch(e){return e?.stack||""}}function C_(e){if(!e)return null;let t=/:(\d+)$/.exec(String(e));if(!t)return null;let n=parseInt(t[1],10);return Number.isFinite(n)&&n>0?n:null}function T_(e){return!(typeof e!="string"||e.length===0||M_.test(e))}function zh(e,t){if(typeof window>"u"||!e)return;let n=String(e);if(!n.startsWith(lo)||n.startsWith(S_)||n.startsWith(I_))return;let o=C_(n);if(o!=null)try{let r={key:n,slot:o,trusted:T_(t)};window.dispatchEvent(new CustomEvent("saveIntegrity:storageMutation",{detail:r}))}catch{}}function k_(){if(!(typeof localStorage>"u"))try{let e=Object.getPrototypeOf(localStorage);if(!e||e.__cccStoragePatched)return;let t=e.setItem,n=e.removeItem,o=e.clear;typeof t=="function"&&(e.setItem=function(i,s){let l=Wh(),a=String(i),u=this===localStorage&&a.startsWith(lo);if(u)try{qh(a)}catch{}let f;try{f=t.apply(this,arguments)}finally{try{if(u){Do("setItem");try{Gh(a,s)}catch{}}this===localStorage&&a.startsWith(lo)&&zh(a,l)}catch{}}return f}),typeof n=="function"&&(e.removeItem=function(i){let s=Wh(),l;try{l=n.apply(this,arguments)}finally{try{this===localStorage&&String(i).startsWith(lo)&&(Do("removeItem"),zh(i,s))}catch{}}return l}),typeof o=="function"&&(e.clear=function(){let i=Wh(),s;try{s=o.apply(this,arguments)}finally{try{this===localStorage&&(Do("clear"),zh(null,i))}catch{}}return s}),Object.defineProperty(e,"__cccStoragePatched",{value:!0,enumerable:!1,configurable:!1,writable:!1})}catch(e){console.warn("Failed to patch Storage prototype for suspend safeguards",e)}}function BS(e="idle"){xa=e||xa,Kr=!0,!Ea&&(Ea=setTimeout(()=>{if(Ea=null,!Kr)return;let t=xa;Kr=!1,US(t)},w_))}function FS(){Ea&&(clearTimeout(Ea),Ea=null)}function Do(e="dirty"){try{BS(e)}catch{}}async function Kh(e="manual"){if(!_a()||!cc())return!1;let t=E_();if(!t)return!1;t.reason=e,Ff=!1;let n=await x_(t);return n||(Kr=!0,BS("retry")),n}async function US(e="manual",{immediate:t=!1}={}){return!_a()||!cc()?!1:t?(FS(),Kr=!1,Ff=!0,Kh(e)):(Kr=!0,xa=e||xa,Kh(e))}function Bf(e){!cc()||!_a()||(FS(),Kr=!1,Ff=!0,Kh(e))}function A_(){if(!_a())return!1;try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(lo))return!0}}catch{}return!1}async function N_(){if(RS||(RS=!0,!_a()||!cc()))return!1;let e=!1;try{if(!A_())e=!0;else{let o=localStorage.getItem(`${lo}saveSlot`);if(o){let r=`${lo}coins:${o}`;localStorage.getItem(r)==null&&(e=!0)}}}catch{e=!1}if(!e)return!1;let t=await L_();if(!t?.data)return!1;let n=!1;try{for(let[o,r]of Object.entries(t.data))r!=null&&localStorage.getItem(o)===null&&(localStorage.setItem(o,r),n=!0)}catch(o){console.warn("Failed to restore snapshot into localStorage",o)}return n&&Do("restored"),n}function R_(){if(NS||(NS=!0,typeof window>"u"))return;__(),k_();let e=()=>{document.hidden?Bf("visibility-hidden"):Do("visibility-visible")};try{document.addEventListener("visibilitychange",e,{passive:!0})}catch{}try{window.addEventListener("pagehide",()=>Bf("pagehide"),{capture:!0})}catch{}try{window.addEventListener("beforeunload",()=>Bf("beforeunload"))}catch{}try{document.addEventListener("freeze",()=>Bf("freeze"))}catch{}try{window.addEventListener("pageshow",()=>Do("pageshow"))}catch{}try{window.addEventListener("focus",()=>Do("focus"))}catch{}try{window.addEventListener("storage",t=>{t&&t.storageArea===localStorage&&(t.key&&!String(t.key).startsWith(lo)||Do("storage-event"))})}catch{}Do("boot")}function O_(){return{pendingImmediateFlush:Ff,dirty:Kr,lastDirtyReason:xa}}var lo,v_,b_,La,OS,S_,I_,w_,wa,Ea,Kr,xa,NS,RS,Ff,M_,$S=De(()=>{Hh();lo="ccc:",v_="ccc:safety",b_=1,La="snapshots",OS="latest",S_=`${lo}slotSig`,I_=`${lo}slotMod`,w_=1e3,wa=null,Ea=null,Kr=!1,xa="init",NS=!1,RS=!1,Ff=!1;M_=/\bat <anonymous>:\d+:\d+\b/});var qS={};It(qS,{initGlobalOverlayEsc:()=>F_});function B_(e){if(e.key!=="Escape")return;let t=!1,n=!1;for(let{sel:o,btn:r,yield:i,closeAll:s}of P_){let l=document.querySelectorAll(o);if(l.length>0){if(i){t=!0;continue}if(s)l.forEach(a=>{let u=a.querySelector(r||".shop-close");u&&(u.click(),n=!0)});else{let u=l[l.length-1].querySelector(r||".shop-close");u&&(u.click(),n=!0)}}}(n||t)&&(e.preventDefault(),t||(e.stopPropagation(),e.stopImmediatePropagation()))}function F_(){window.addEventListener("keydown",B_,!0)}var P_,GS=De(()=>{P_=[{sel:".offline-overlay",btn:".offline-close-btn"},{sel:".hm-milestones-overlay",btn:".hm-milestones-close"},{sel:".merchant-firstchat.is-visible",btn:null,yield:!0},{sel:".upg-overlay.is-open",btn:".shop-close"},{sel:".merchant-overlay.is-open",btn:".merchant-close"},{sel:".shop-overlay.is-open",btn:".shop-close",closeAll:!0}]});var HS={};It(HS,{ensureGameDom:()=>U_});function U_(e,t){if(document.getElementById("game-root"))return;let n=document.createElement("main");n.id="game-root",n.className="area area-cove",n.hidden=!0;let o="";for(let r=0;r<e;r++){let i=t+r;o+=`<canvas id="water-fg-${r}" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: ${i};"></canvas>\n`}n.innerHTML=`<div class="hud-top"><div class="coin-counter"><img src="img/currencies/coin/coin_plus_base.webp" alt="" class="coin-plus"/><div class="coin-bar"><span class="coin-amount">0</span></div></div><div class="xp-counter" data-xp-hud hidden><img src="img/stats/xp/xp_plus_base.webp" alt="" class="xp-plus"/><div class="xp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 XP"><div class="xp-bar__fill" style="width: 0%"></div><div class="xp-bar__frame"><div class="xp-bar__level"> Level<span class="xp-level-value">0</span></div><div class="xp-bar__divider" aria-hidden="true"></div><div class="xp-bar__progress" data-xp-progress> 0<span class="xp-progress-separator">/</span>10<span class="xp-progress-suffix">XP</span></div></div></div></div><div class="mp-counter" data-mp-hud hidden><img src="img/stats/mp/mp_plus_base.webp" alt="" class="mp-plus"/><div class="mp-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 / 10 MP"><div class="mp-bar__fill" style="width: 0%"></div><div class="mp-bar__frame"><div class="mp-bar__level"> Mutation<span class="mp-level-value">0</span></div><div class="mp-bar__divider" aria-hidden="true"></div><div class="mp-bar__progress" data-mp-progress> 0<span class="mp-progress-separator">/</span>10<span class="mp-progress-suffix">MP</span></div></div></div></div></div><section class="playfield" aria-label="Starter Cove Sand"><div class="waves" id="waves"></div><canvas id="water-background" class="water-base" style="position: absolute; top: 0; left: 0; width: 100%; height: 35%; pointer-events: none; z-index: 1;"></canvas><div class="coins-layer" id="coins-layer"></div> ${o.trim()} </section><nav class="hud-bottom" id="hud-bottom"><button class="game-btn btn-help" data-btn="help"><span>Help</span></button><button class="game-btn btn-shop" data-btn="shop"><span>Shop</span></button><button class="game-btn btn-stats" data-btn="stats"><span>Stats &amp; Settings</span></button><button class="game-btn btn-map" data-btn="map"><span>Map</span></button></nav>`,document.body.appendChild(n)}var XS=De(()=>{});var VS={};It(VS,{SHOW_FPS:()=>D_,initFpsTracker:()=>$_});function $_(){let e=document.createElement("div");e.id="fps-tracker",Object.assign(e.style,{position:"fixed",top:"0",left:"0",zIndex:"2147483647",background:"#000",color:"#fff",fontFamily:"monospace",padding:"4px",fontSize:"12px",pointerEvents:"none"}),document.body.appendChild(e);let t=0,n=performance.now();function o(r){t++;let i=r-n;if(i>=250){let s=Math.round(t*1e3/i);e.textContent=`FPS: ${s}`,t=0,n=r}requestAnimationFrame(o)}requestAnimationFrame(o)}var D_,YS=De(()=>{D_=!0});var KS={};It(KS,{initNotifications:()=>X_,showNotification:()=>zS,unpauseNotifications:()=>G_});function q_(){return Ca||(Ca=document.createElement("div"),Ca.className="notification-container",document.body.appendChild(Ca),Ca)}function G_(){WS=!1,Zh()}async function Zh(){if(jh||WS||Uf.length===0)return;jh=!0;let{text:e,iconSrc:t,duration:n}=Uf.shift();await H_(e,t,n),jh=!1,Uf.length>0&&Zh()}function H_(e,t,n){return new Promise(o=>{let r=q_(),i=document.createElement("div");if(i.className="notification",t){let l=document.createElement("img");l.src=t,l.className="notification-icon",l.alt="",i.appendChild(l)}let s=document.createElement("div");s.className="notification-text",s.innerHTML=e,i.appendChild(s),r.appendChild(i),pt("sounds/notif_ding.ogg",{volume:.5}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.classList.add("is-visible")})}),setTimeout(()=>{i.classList.remove("is-visible"),i.classList.add("is-leaving");let l=()=>{i.remove(),o()};i.addEventListener("transitionend",l,{once:!0}),setTimeout(()=>{i.isConnected&&(i.remove(),o())},600)},n)})}function zS(e,t,n=5e3){Uf.push({text:e,iconSrc:t,duration:n}),Zh()}function X_(){typeof window>"u"||window.addEventListener("lab:node:change",e=>{let{id:t,level:n}=e.detail||{};if(!t||n==null)return;let o=On.get(t);if(!o)return;let r=o.maxLevel;if(n<r||Nv())return;let i=o.title||"Node";zS(`${i}<br>Maxed!`,"img/"+o.icon)})}var Ca,Uf,jh,WS,jS=De(()=>{Jo();Cn();qs();Ca=null,Uf=[],jh=!1,WS=!0});function W_(){let e;try{e=localStorage.getItem("ccc:pendingSlotWipe")}catch{e=null}if(!e)return;let n=`:${Number(e)}`,o=[];try{let r=localStorage;for(let i=0;i<r.length;i++){let s=r.key(i);s&&s.startsWith("ccc:")&&s.endsWith(n)&&o.push(s)}o.forEach(i=>{try{localStorage.removeItem(i)}catch{}});try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}catch{try{localStorage.removeItem("ccc:pendingSlotWipe")}catch{}}}function z_(){if(!Je)return;let e=0,t=350;document.addEventListener("touchend",n=>{let o=performance.now();o-e<=t&&n.preventDefault(),e=o},{passive:!1}),document.addEventListener("gesturestart",n=>{n.preventDefault()},{passive:!1}),document.addEventListener("dblclick",n=>{n.preventDefault()},{passive:!1})}function fI(e="Loading assets...",t){let n=document.getElementById("boot-loader");n||(n=document.createElement("div"),n.id="boot-loader",n.className="loading-screen",document.body.appendChild(n)),n.innerHTML="",Object.assign(n.style,{position:"fixed",inset:"0",background:"#000",color:"#fff",display:"grid",placeItems:"center",zIndex:"2147483647",opacity:"1",transition:"opacity 0.4s ease"});let o=document.createElement("div");o.style.textAlign="center",o.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, sans-serif";let r=document.createElement("div");r.textContent=e,Object.assign(r.style,{fontSize:"clamp(16px, 2.4vw, 22px)",letterSpacing:".04em",opacity:".92"});let i=document.createElement("div");Object.assign(i.style,{width:"min(420px, 70vw)",height:"10px",background:"rgba(255,255,255,.15)",borderRadius:"999px",margin:"12px auto 6px",overflow:"hidden"});let s=document.createElement("div");Object.assign(s.style,{width:"0%",height:"100%",background:"#fff",transform:"translateZ(0)",transition:"width .15s linear"});let l=document.createElement("div");l.textContent="0%",Object.assign(l.style,{fontSize:"12px",opacity:".85"}),i.appendChild(s),o.append(r,i,l),n.appendChild(o);let a=document.createElement("div");a.textContent="If progress bar is stuck, try reloading the page.",Object.assign(a.style,{marginTop:"16px",fontSize:"14px",opacity:"0",transition:"opacity 0.5s ease",color:"rgba(255,255,255,0.65)"}),o.appendChild(a);let u=setTimeout(()=>{n.__done||(a.style.opacity="1")},25e3);if(typeof t=="function"){let f=document.createElement("div");f.textContent=Je?"Tap here to skip loading now and load assets during gameplay":"Click here to skip loading now and load assets during gameplay",Object.assign(f.style,{marginTop:"24px",fontSize:"14px",color:"#888",textDecoration:"underline",cursor:"pointer",opacity:"0.9"}),f.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),!n.__skipped&&(n.__skipped=!0,n.__pct&&(n.__pct.textContent="Loading skipped"),n.__label&&(n.__label.textContent="Loading skipped"),f.textContent="Loading skipped",f.style.textDecoration="none",f.style.cursor="default",t())}),o.appendChild(f)}return n.__mountedAt=performance.now(),n.__done=!1,n.__wrap=o,n.__bar=i,n.__fill=s,n.__pct=l,n.__label=r,n.__stuckMsg=a,n.__stuckTimeout=u,n}function Ma(e,t){if(!e||!e.__fill||!e.__pct||e.__skipped)return;let n=Math.max(0,Math.min(1,t||0)),o=Math.round(n*100);e.__fill.style.width=o+"%",e.__pct.textContent=o+"%"}function dI(e,t,n,o=500){!e||e.__done||(e.__done=!0,e.__label&&(n?e.__label.textContent=n:e.__label.textContent=e.__skipped?"Loading Skipped":"Finished loading assets"),e.offsetHeight,setTimeout(async()=>{if(typeof t=="function")try{t()}catch(i){console.error(i)}await II(),e.style.opacity="0";let r=()=>{e.remove(),document.documentElement.classList.remove("booting")};e.addEventListener("transitionend",r,{once:!0}),setTimeout(r,450)},o))}async function tg(e){let t=new Image;t.src=e;try{t.decode&&await t.decode()}catch{}await new Promise(n=>{let o=document.createElement("img");o.src=e,o.alt="",o.style.cssText="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;",document.body.appendChild(o),requestAnimationFrame(()=>{o.remove(),n()})})}function K_(e,t){return e.map(n=>new Promise(o=>{let r=new Image,i=()=>{try{t?.(n)}catch{}o(n)};r.onload=i,r.onerror=i,r.src=n}))}function j_(e,t){return e.map(async n=>{try{let{loadAudio:o}=await Promise.resolve().then(()=>(Cn(),dc));await o(n)}catch{}try{t?.(n)}catch{}return n})}function Z_(e){return document.fonts&&document.fonts.ready?[document.fonts.ready.then(()=>{try{e?.("fonts")}catch{}})]:[Promise.resolve().then(()=>{try{e?.("fonts")}catch{}})]}async function J_({images:e=[],audio:t=[],fonts:n=!0},o){let r=e.length+t.length+(n?1:0);if(r===0){o?.(1);return}let i=0,s=()=>{i++,o?.(i/r)},l=[...K_(e,s),...j_(t,s),...n?Z_(s):[]];await Promise.all(l.map(a=>a.catch(()=>null)))}function Q_(e){if(Zi===e)return;fn&&(fn.stop(),fn=null),Zi=e;let t=document.querySelector(".menu-root");switch(e){case $o.STARTER_COVE:{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{Zi===$o.STARTER_COVE&&(fn=pt("sounds/The_Cove.ogg",{loop:!0,type:"music"}),typeof Gf=="function"&&Gf())},300)})}),t&&(t.style.display="none"),document.body.classList.remove("menu-bg");let n=5;if(typeof lg=="function"&&lg(n,80),ji){let i=Array.from({length:n},(s,l)=>`water-fg-${l}`);if(ji.init("water-background",i),$f){try{$f()}catch{}$f=null}if(qf){try{qf()}catch{}qf=null}typeof sg=="function"&&($f=sg(s=>ji.update(s))),typeof ag=="function"&&(qf=ag((s,l)=>ji.render(s,l)))}let r=document.getElementById("game-root");if(r&&(r.hidden=!1,ji&&requestAnimationFrame(()=>ji.resize()),hI()),typeof og=="function")try{og()}catch{}if(typeof rg=="function")try{rg()}catch{}if(!on){on=pI({coinSrc:"img/currencies/coin/coin.webp",coinSize:40,initialRate:1,surgeLifetimeMs:1800,surgeWidthVw:22,initialBurst:0}),window.spawner=on;let i=()=>{if(!(!on||typeof on.setCoinSprite!="function"))try{on.setCoinSprite(bI?.())}catch{}};i(),SI?.(i);let s=mI({spawner:on});on&&typeof on.setDependencies=="function"&&on.setDependencies({collectBatch:s.collectBatch,getMagnetUnit:s.getMagnetUnitPx});let l=()=>{try{let a=gI(),u=yI(a);if(on&&u?.coinsPerSecondMult){let f=1*u.coinsPerSecondMult;if(typeof ig=="function"){let d=ig("spawnRate",f);try{d&&typeof d.toScientific=="function"?f=Number(d.toScientific(6)):f=Number(d)}catch{}}Number.isFinite(f)&&on.setRate(f)}}catch{}};if(l(),typeof eg=="function")try{eg()}catch{}eg=vI(l),typeof window<"u"&&window.addEventListener("debug:change",l)}if(typeof ng=="function")try{ng()}catch{}setTimeout(()=>{Zi===$o.STARTER_COVE&&on&&on.start()},300);break}case $o.MENU:{t&&(t.style.display="",t.removeAttribute("aria-hidden"));let n=document.getElementById("game-root");n&&(n.hidden=!0),on&&on.stop();break}}try{window.dispatchEvent(new CustomEvent("menu:visibilitychange",{detail:{visible:e===$o.MENU}}))}catch{}}var V_,Je,ZS,pI,mI,hI,JS,QS,eI,tI,nI,oI,rI,iI,gI,yI,ng,vI,Y_,sI,aI,lI,Jh,Qh,og,rg,bI,SI,Df,ig,cI,sg,ag,uI,lg,ji,$f,qf,Gf,$o,Zi,fn,on,eg,Hf,II,vo=De(()=>{Cn();V_=!0,Je=(()=>{if(typeof window>"u")return!1;if(typeof window.IS_MOBILE<"u")return!!window.IS_MOBILE;let e=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||window.navigator&&window.navigator.maxTouchPoints>0;return window.IS_MOBILE=e,e})();Je&&document.documentElement.classList.add("is-mobile");$f=null,qf=null,Gf=null;z_();$o={MENU:0,STARTER_COVE:1},Zi=$o.MENU,fn=null,on=null,eg=null,Hf=()=>new Promise(e=>requestAnimationFrame(e)),II=async()=>{await Hf(),await Hf()};document.addEventListener("DOMContentLoaded",async()=>{let e,t=new Promise(z=>{e=z}),n=fI("Loading assets...",e);await Hf();let{initAudio:o}=await Promise.resolve().then(()=>(Cn(),dc));o();let r=Promise.all([Promise.resolve().then(()=>(cd(),Mg)),Promise.resolve().then(()=>(dS(),fS)),Promise.resolve().then(()=>(rl(),u0)),Promise.resolve().then(()=>(Nu(),Zv)),Promise.resolve().then(()=>(vt(),xg)),Promise.resolve().then(()=>(Hh(),SS)),Promise.resolve().then(()=>(ho(),xb)),Promise.resolve().then(()=>(Ec(),kg)),Promise.resolve().then(()=>(An(),Yg)),Promise.resolve().then(()=>(mo(),Q0)),Promise.resolve().then(()=>(go(),Qb)),Promise.resolve().then(()=>(AS(),kS)),Promise.resolve().then(()=>($S(),DS)),Promise.resolve().then(()=>(fs(),Qg)),Promise.resolve().then(()=>(GS(),qS)),Promise.resolve().then(()=>(cs(),Kb)),Promise.resolve().then(()=>(si(),ty)),Promise.resolve().then(()=>(lu(),rv)),Promise.resolve().then(()=>(Es(),tv)),Promise.resolve().then(()=>(ws(),vy)),Promise.resolve().then(()=>(XS(),HS)),Promise.resolve().then(()=>(yn(),Wy)),Promise.resolve().then(()=>(Fh(),iS)),Promise.resolve().then(()=>(hi(),fy)),Promise.resolve().then(()=>(YS(),VS)),Promise.resolve().then(()=>(jS(),KS))]),i={images:["img/currencies/book/book.webp","img/currencies/book/book_base.webp","img/currencies/book/book_plus_base.webp","img/currencies/coin/coin.webp","img/currencies/coin/coin_base.webp","img/currencies/coin/coin_plus_base.webp","img/currencies/dna/dna.webp","img/currencies/dna/dna_base.webp","img/currencies/dna/dna_plus_base.webp","img/currencies/gear/gear.webp","img/currencies/gear/gear_base.webp","img/currencies/gear/gear_plus_base.webp","img/currencies/gold/gold.webp","img/currencies/gold/gold_base.webp","img/currencies/gold/gold_plus_base.webp","img/currencies/magic/magic.webp","img/currencies/magic/magic_base.webp","img/currencies/magic/magic_plus_base.webp","img/currencies/wave/wave.webp","img/currencies/wave/wave_base.webp","img/currencies/wave/wave_plus_base.webp","img/misc/experiment.webp","img/misc/experiment_plus_base.webp","img/misc/forge.webp","img/misc/forge_plus_base.webp","img/misc/infuse.webp","img/misc/infuse_plus_base.webp","img/misc/infuse_base.webp","img/misc/surge.webp","img/misc/surge_plus_base.webp","img/misc/green_border.webp","img/misc/locked.webp","img/misc/locked_base.webp","img/misc/maxed.webp","img/misc/merchant.webp","img/misc/mysterious.webp",...Array.from({length:25},(z,de)=>`img/mutations/m${de+1}.webp`),"img/sc_upg_icons/book_val1.webp","img/sc_upg_icons/coin_val1.webp","img/sc_upg_icons/coin_val2.webp","img/sc_upg_icons/coin_val3.webp","img/sc_upg_icons/coin_val_dna.webp","img/sc_upg_icons/coin_val_hm1.webp","img/sc_upg_icons/coin_val_hm2.webp","img/sc_upg_icons/coin_val_hm3.webp","img/sc_upg_icons/faster_coins1.webp","img/sc_upg_icons/faster_coins2.webp","img/sc_upg_icons/faster_coins3.webp","img/sc_upg_icons/gold_val_dna.webp","img/sc_upg_icons/magic_val_dna.webp","img/sc_upg_icons/magnet.webp","img/sc_upg_icons/mp_val1.webp","img/sc_upg_icons/mp_val2.webp","img/sc_upg_icons/wave_val_dna.webp","img/sc_upg_icons/xp_val1.webp","img/sc_upg_icons/xp_val2.webp","img/sc_upg_icons/xp_val3.webp","img/sc_upg_icons/xp_val_dna.webp","img/sc_upg_icons/xp_val_hm.webp","img/sc_upg_icons/mp_val_hm.webp","img/sc_upg_icons/effective_auto_collect.webp","img/sc_upg_icons/autobuy_coin.webp","img/sc_upg_icons/autobuy_book.webp","img/sc_upg_icons/autobuy_dna.webp","img/sc_upg_icons/autobuy_gold.webp","img/sc_upg_icons/autobuy_magic.webp","img/sc_upg_icons/autobuy_workshop_level.webp","img/lab_icons/tsunami_exponent_buff.webp","img/lab_icons/coin_val0.webp","img/lab_icons/gold_val0.webp","img/lab_icons/magic_val0.webp","img/lab_icons/wave_val0.webp","img/stats/mp/mp.webp","img/stats/mp/mp_base.webp","img/stats/mp/mp_plus_base.webp","img/stats/xp/xp.webp","img/stats/xp/xp_base.webp","img/stats/xp/xp_plus_base.webp","img/stats/rp/rp.webp","img/stats/rp/rp_base.webp"],audio:["sounds/coin_pickup.ogg","sounds/wave_spawn.ogg","sounds/merchant_typing.ogg","sounds/purchase_upg.ogg","sounds/forge_reset.ogg","sounds/infuse_reset.ogg","sounds/surge_reset.ogg","sounds/experiment_reset.ogg","sounds/evolve_upg.ogg","sounds/warp.ogg","sounds/coin_pickup_size1.ogg","sounds/coin_pickup_size2.ogg","sounds/coin_pickup_size3.ogg","sounds/coin_pickup_size4.ogg","sounds/coin_pickup_size5.ogg","sounds/coin_pickup_size6.ogg","sounds/lightning_strike.ogg","sounds/lightning_zap.ogg","sounds/The_Cove.ogg","sounds/tsu_storm_ambience.ogg","sounds/tsu_rumble.ogg","sounds/tsu_beacon_spawn.ogg","sounds/tsu_beacon_hum.ogg","sounds/tsu_explosion.ogg","sounds/notif_ding.ogg"],fonts:!0},s=0,l=J_(i,z=>{s=z,Ma(n,z)}),[a,u,f,d,m,v,p,h,g,y,I,E,M,A,G,P,$,L,F,T,C,Y,Q,ae,he,be]=await r;({initSlots:ZS}=a),{createSpawner:pI}=u,{initCoinPickup:mI}=f,{initHudButtons:hI}=d,{bank:tI,getHasOpenedSaveSlot:nI,setHasOpenedSaveSlot:oI,ensureStorageDefaults:rI,notifyGameSessionStarted:uI,ensureMultiplierDefaults:iI}=m,{getCurrentAreaKey:gI,computeUpgradeEffects:yI,onUpgradesChanged:vI}=p,{registerPreloadedAudio:Y_}=h,{initXpSystem:ng}=g,{initResetSystem:og}=y,{initMutationSystem:rg,getMutationCoinSprite:bI,onMutationChange:SI}=I,{initPopups:sI}=E,{installSuspendSafeguards:aI,restoreFromBackupIfNeeded:lI,markProgressDirty:Jh,flushBackupSnapshot:Qh}=M,{installGhostTapGuard:JS,initGlobalGhostTap:QS}=A,{initGlobalOverlayEsc:eI}=G,{setDebugPanelAccess:Df,applyStatMultiplierOverride:ig}=P,{startGameLoop:cI,registerTick:sg,registerFrame:ag}=$;let{initOfflineTracker:Oe,processOfflineProgress:ke}=L,{initWorkshopSystem:U}=F,{initAutomationEffects:W}=T;({ensureGameDom:lg}=C);let{initSurgeEffects:q}=Y;({waterSystem:ji}=Q);let{initLabLogic:X}=ae,{initFpsTracker:J}=he,{initNotifications:le,unpauseNotifications:fe,showNotification:_}=be;Gf=fe,window.bank=tI,window.unpauseNotifications=Gf,window.showNotification=_,typeof window<"u"&&(window.addEventListener("audio:stopMusic",()=>{if(fn){try{fn.stop()}catch{}fn=null}}),window.addEventListener("audio:restartMusic",()=>{if(fn){try{fn.stop()}catch{}fn=null}Zi===$o.STARTER_COVE&&(fn=pt("sounds/The_Cove.ogg",{loop:!0,type:"music"}))})),window.addEventListener("beforeunload",z=>{if(window.spawner&&typeof window.spawner.hasBigCoins=="function"&&window.spawner.hasBigCoins())return z.preventDefault(),z.returnValue="",""}),document.addEventListener("visibilitychange",()=>{let z=document.hidden;Vf(z),fn&&fn.element&&(z?fn.element.pause():fn.element.play().catch(()=>{}))}),JS?.(),QS?.(),eI?.(),aI?.(),typeof Df=="function"&&(Df(V_),window.setDebugPanelAccess=Df);try{await lI?.()}catch{}await Promise.race([l,t]),await II(),document.documentElement.classList.remove("booting"),await Hf(),dI(n),await Promise.all([tg("img/currencies/coin/coin_plus_base.webp"),tg("img/stats/xp/xp_plus_base.webp"),tg("img/stats/mp/mp_plus_base.webp")]);try{typeof m.clearActiveSlot=="function"?m.clearActiveSlot():m&&m.KEYS&&m.KEYS.SAVE_SLOT&&localStorage.removeItem(m.KEYS.SAVE_SLOT)}catch{}cI(),Oe(()=>Zi===$o.STARTER_COVE);try{U()}catch(z){console.error("Workshop init failed",z)}try{W()}catch(z){console.error("Automation init failed",z)}try{q()}catch(z){console.error("Surge effects init failed",z)}try{X()}catch(z){console.error("Lab system init failed",z)}try{J()}catch(z){console.error("FPS tracker init failed",z)}W_(),rI(),Jh?.("ensure-defaults"),sI(),le();let H=document.getElementById("panel-title");if(nI()?(document.body.classList.add("has-opened"),H&&(H.style.opacity="0")):H&&(H.style.opacity="1"),ZS(async()=>{if(Zi===$o.STARTER_COVE)return;oI(!0),document.body.classList.add("has-opened"),H&&(H.style.opacity="0");let z=fI("Loading game..."),de=()=>new Promise(ee=>setTimeout(ee,120));Ma(z,.2),await de(),iI(),Ma(z,.4),await de(),ke(),Ma(z,.65),await de(),uI?.(),Ma(z,.9),await de(),Jh?.("slot-entered"),Ma(z,1),dI(z,()=>{Q_($o.STARTER_COVE),setTimeout(()=>{window.spawner&&typeof window.spawner.playEntranceWave=="function"&&window.spawner.playEntranceWave()},300)},"Finished loading game",200)}),typeof window<"u"&&Qh)try{window.cccRequestBackup=()=>Qh("manual",{immediate:!0})}catch{}})});vo();})();
