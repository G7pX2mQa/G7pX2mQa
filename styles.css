:root {
  /* Colors */
  --bg-1: #0a0f1a;
  --bg-2: #0f1b2e;
  --panel: #0f1420cc;
  --card: #141a27;
  --card-hover: #182133;
  --text-1: #e8edf7;
  --text-2: #c2cbe0;
  --accent: #58b8ff;
  --accent-2: #7de4c7;
  --ring: #6fb6ff55;

  /* Animated background base */
  --bg-3: hsl(188 60% 50%);

  /* Density & speed */
  --coin-step: clamp(72px, 6.5vw, 120px); /* spacing: bigger = fewer tiles */
  --coin-speed: 3s;

  /* Sizing & spacing */
  --radius-lg: 18px;
  --radius-md: 12px;
  --radius-sm: 8px;
  --space-1: .25rem;
  --space-2: .5rem;
  --space-3: .75rem;
  --space-4: 1rem;
  --space-5: 1.5rem;
  --space-6: 2rem;
  --space-8: 3rem;

  /* Shadows */
  --shadow-1: 0 8px 24px rgba(0,0,0,.35);
  --shadow-2: 0 2px 0 rgba(255,255,255,.03) inset;

  /* Typography */
  --font-ui: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  --h1: clamp(1.6rem, 3vw, 2.4rem);
  --h2: clamp(1.1rem, 2vw, 1.3rem);
  --body: 1rem;
  --tiny: .8rem;
}
* { box-sizing: border-box; }

/* === General Page Styling === */
body {
  margin: 0;
  font-family: var(--font-ui);
  color: var(--text-1);
  background: var(--bg-3);
  line-height: 1.45;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  height: 100svh;
  overflow: hidden;
}

h1, h2, h3, p { margin: 0; }

button {
  font: inherit;
  color: inherit;
  background: none;
  border: 0;
  padding: 0;
  cursor: pointer;
}
button:focus-visible {
  outline: 0;
  box-shadow: none;
}

html, body {
  height: 100%;
  touch-action: none;
  -ms-touch-action: none;
  overscroll-behavior: none;
}

/* Phones & short viewports: allow scroll */
@media (max-width: 900px), (max-height: 600px) {
  html, body {
    height: auto;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }
  .menu-root {
    height: auto;
    min-height: 100svh;
    align-content: start;
    row-gap: var(--space-4);
  }
}

/* === Animated coin pattern background ============================
   Light-gray tiny coins, fewer per screen, all same speed, drifting up-right.
   Color is baked into the SVG so it cannot fall back to black.
================================================================== */

body.menu-bg {
  background: var(--bg-3);
  position: relative;
  min-height: 100svh;
  overflow-x: hidden;
  isolation: isolate;
}

@supports (background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'></svg>")) {
  body.menu-bg::before {
    content: "";
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    background-repeat: repeat;
    background-size: var(--coin-step) var(--coin-step);
    will-change: background-position;

    background-image:
	  url("data:image/svg+xml;utf8,\
	    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
		<circle cx='32' cy='32' r='14' fill='none' stroke='%23a0a6ac' stroke-width='1.2' opacity='0.75'/>\
		<circle cx='32' cy='32' r='10.8' fill='none' stroke='%23a0a6ac' stroke-width='0.9' opacity='0.85'/>\
	  </svg>");
    /* subtle darken so gray reads on all displays */
    filter: brightness(0.5);

    animation: ccc-drift var(--coin-speed) linear infinite;
  }
}


/* Diagonal up-right drift (x increases, y decreases) */
@keyframes ccc-drift {
  from { background-position: 0 0; }
  to   { background-position: var(--coin-step) calc(var(--coin-step) * -1); }
}

/* Reduce motion: stop the drift */
@media (prefers-reduced-motion: reduce) {
  body.menu-bg::before { animation: none; }
}

/* Keep UI above background */
.menu-root,
.menu-header,
.menu-panel { position: relative; z-index: 1; }

@media (pointer: coarse) {
  * {
  -webkit-user-select: none;  /* Safari / iOS */
  -moz-user-select: none;     /* Firefox */
  -ms-user-select: none;      /* Old IE */
  user-select: none;
  -webkit-touch-callout: none; /* Disable tap & hold context menu on iOS */
  -webkit-tap-highlight-color: transparent; /* Remove grey tap highlight */
  -webkit-user-drag: none;
  }
}
/* ---- Boot loading screen ---- */
.loading-screen {
  position: fixed;
  inset: 0;
  background: #000;
  color: #fff;
  display: grid;
  place-items: center;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  z-index: 2147483647; /* above everything */
  opacity: 1;
  transition: opacity .25s ease;
}

.loading-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

.loading-screen__text {
  font-size: clamp(16px, 2.4vw, 22px);
  letter-spacing: .04em;
  opacity: .92;
}

/* ===== Title & Basic ===== */
.game-title {
  font-size: var(--h1);
  letter-spacing: 0.5px;
  color: #ffeb3b; /* your bright yellow */
  -webkit-text-stroke: 2px black; /* crisp desktop outline */
  text-stroke: 2px black;
  user-select: none;
}

/* Touch / coarse pointer devices (mobile + tablets like iPads) */
@media (pointer: coarse) {
  .game-title {
    -webkit-text-stroke: 0; /* remove harsh stroke */
    text-stroke: 0;
    text-shadow:
      1px 1px 0 black,
      -1px 1px 0 black,
      1px -1px 0 black,
      -1px -1px 0 black; /* clean simulated outline */
  }
}

/* Desktop: 3 across */
.slots-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: var(--space-4);
}

/* Phones (narrow): stack by default */
@media (max-width: 1024px) {
  .slots-grid { grid-template-columns: 1fr; }
}

/* Short viewports: 2 columns to reduce height */
@media (max-height: 640px) and (min-width: 380px) {
  .slots-grid { grid-template-columns: repeat(2, 1fr); }
}

/* Card */
.slot-card {
  text-align: left;
  background: linear-gradient(180deg, rgba(15, 22, 38, 0.75), rgba(14, 20, 32, 0.75));
  border: 1px solid rgba(34, 43, 61, 0.6);
  border-radius: 16px;
  padding: clamp(var(--space-5), 2vw, var(--space-6));
  box-shadow: var(--shadow-2);
  transition: transform .15s ease, background .15s ease, border-color .15s ease;
  outline-offset: 2px;
  min-height: clamp(96px, 16vh, 140px);
}

/* Remove aspect ratio on narrow/short screens */
@media (max-width: 900px), (max-height: 700px) {
  .slot-card { aspect-ratio: auto; }
}

/* Extra compact for very short screens */
@media (max-height: 560px) {
  .slot-card {
    min-height: clamp(84px, 14vh, 120px);
    padding: var(--space-4);
  }
}

.slot-card:hover {
  background: var(--card-hover);
  transform: translateY(-2px);
  border-color: #2a3852;
}
.slot-card:active { transform: translateY(0); }

.slot-badge {
  display: inline-flex;
  align-items: center;
  gap: .5ch;
  padding: .25rem .55rem;
  border-radius: 999px;
  background: #0d1522;
  border: 1px solid #22314a;
  color: var(--text-2);
  font-size: var(--tiny);
  margin-bottom: var(--space-3);
}

.slot-title { font-weight: 600; margin-bottom: var(--space-1); }
.slot-meta  { color: var(--text-2); font-size: .9rem; }

/* ===== Title & Coin Styling ===== */
.menu-header h1 {
  font-size: clamp(2rem, 7.5vw, 6.5rem);
  font-weight: 700;
  color: #E5E317;
  letter-spacing: 0.5px;
  line-height: 1.2;
}

/* ===== Coins: desktop-first, tuned for mobile via breakpoints ===== */
.coin-o {
  --coin-size: 0.6em;
  display: inline-block;
  width: var(--coin-size);
  height: var(--coin-size);
  background: url("/img/currencies/coin/coin.png") center/contain no-repeat;
  transform: translateY(0.46em);
  vertical-align: baseline;
  margin-left: 0em;
  margin-right: 0em;
  filter: drop-shadow(0 2px 2px rgba(0,0,0,.35));
}


/* prevent wrapping artifacts near the coin */
.coin-o::before,
.coin-o::after {
  content: "\2060"; /* WORD JOINER prevents awkward breaks */
}

/* ===== Mobile / Short viewports ===== */
@media (max-width: 900px), (max-height: 420px) {
  .menu-header h1 { line-height: 1.08; }

  .coin-o {
    transform: none;
    vertical-align: -0.4em;
    --coin-size: 0.6em;
    margin-left: 0em;
    margin-right: 0em;
  }
}

/* Ultra-narrow portrait */
@media (max-width: 414px) {
  .menu-header h1 {
    white-space: nowrap;
    font-size: clamp(1.55rem, 6.2vw, 2.2rem);
    letter-spacing: 0.25px;
  }

  .coin-o {
    --coin-size: 0.58em;
    vertical-align: -0.35em;
    margin-left: 0em;
    margin-right: 0em;
  }
}

/* Target mobile landscape with coarse pointer and short height (phones) */
@media (orientation: landscape) and (max-height: 480px) and (pointer: coarse) {
  .menu-header .coin-o {
    vertical-align: -0.34em;
    --coin-size: 0.58em;
  }
}

/* ===== Panel header (title + actions) ===== */
.panel-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: var(--space-3);
  margin-bottom: var(--space-2);
}

/* small tweak to nudge the manage button up slightly (balances optical centers) */
.panel-actions{ 
  display:flex; 
  align-items:center; 
  gap: var(--space-3);
  /* move actions up a tiny bit to better align with the title baseline */
  transform: translateY(-0.08rem);
}

/* ===== Buttons ===== */
.btn{
  --btn-bg: #0f1626;
  --btn-border: #22314a;
  --btn-bg-hover: #141d30;
  --btn-border-hover: #2a3b58;

  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-height: 40px;
  padding: 0 .9rem;
  border-radius: 10px;
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  color: var(--text-1);
  font-weight: 600;
  letter-spacing: .2px;
  transition: background .15s ease, border-color .15s ease, transform .1s ease;
}
.btn:hover{ background: var(--btn-bg-hover); border-color: var(--btn-border-hover); }
.btn:active{ transform: translateY(1px); }

.btn-ghost{ opacity:.9; }
.btn-ghost:hover{ opacity:1; }

/* Mobile: stack actions under the title, make button full-width */
@media (max-width: 900px){
  .panel-header{ flex-direction: column; align-items: stretch; gap: var(--space-3); }
  .panel-actions .btn{ width: 100%; }
}

/* For iPad */
@media (hover: none) and (pointer: coarse) {
  .menu-header .coin-o {
    transform: translateY(0); /* neutralize the desktop push-down */
  }
}

/* Portrait: lighter nudge */
@media (hover: none) and (pointer: coarse)
  and (min-width: 744px) and (min-height: 744px)
  and (max-width: 1366px) and (max-height: 1366px)
  and (orientation: portrait) {
  .menu-header .coin-o {
    vertical-align: -0.34em;
  }
}

/* Landscape: stronger nudge */
@media (hover: none) and (pointer: coarse)
  and (min-width: 744px) and (min-height: 744px)
  and (max-width: 1366px) and (max-height: 1366px)
  and (orientation: landscape) {
  .menu-header .coin-o {
    vertical-align: -0.40em;
  }
}

.menu-panel {
  /* subtle glass look over moving background */
  background: linear-gradient(
    180deg,
    rgba(14, 22, 34, 0.68),
    rgba(10, 16, 26, 0.62)
  );
  border: 1px solid rgba(34, 43, 61, 0.50);
  backdrop-filter: saturate(1.05) blur(6px);
  -webkit-backdrop-filter: saturate(1.05) blur(6px); /* iOS */
}

/* keep cards solid/opaque in case any earlier rule used alpha */
.menu-panel .slot-card {
  background: linear-gradient(180deg, #0f1626, #0e1420);
  border-color: rgba(34, 43, 61, 0.60);
}

/* iPad/tablet landscape: fixes some issue with some thing */
@media (hover: none) and (pointer: coarse) and (orientation: landscape) and (min-aspect-ratio: 4/3) {
  .menu-header .coin-o { vertical-align: -0.40em; transform: translateY(0); }
}

/* Phone landscape only (exclude iPads & tablets) */
@media (orientation: landscape) and (max-height: 550px) and (pointer: coarse) {
  .menu-header .coin-o {
    vertical-align: -0.33em;
    --coin-size: 0.58em;
    transform: translateY(0);
  }
}

/* Default: hide Manage button until has-opened; hide title visually to prevent flash */
.menu-panel .panel-actions { display: none; }
.panel-title,
#panel-title { opacity: 0; }

/* When the persisted flag is present on <html> or <body> */
:is(html.has-opened, body.has-opened) {
  /* show Manage button */
  .menu-panel .panel-actions { display: block; }

  /* remove title from layout and keep it invisible */
  .panel-title,
  #panel-title { display: none; opacity: 0; }

  /* left-align header and remove upward nudge on actions */
  .panel-header { justify-content: flex-start; gap: var(--space-3); }
  .panel-actions { transform: none; }
}

/* Mobile adjustments: keep header compact and button auto-sized */
@media (max-width: 900px) {
  :is(html.has-opened, body.has-opened) .panel-header { flex-direction: row; align-items: center; }
  :is(html.has-opened, body.has-opened) .panel-actions .btn { width: auto; }
}
/* ===== Page background ===== */
.menu-bg {
  position: relative;
  isolation: isolate;
  background: radial-gradient(1200px 800px at 50% 0%, var(--menu-cyan) 0%, var(--menu-cyan-2) 100%);
}

/* Animated coin silhouette overlay */
.menu-bg::before {
  content: "";
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;

  /* Inline SVG coin ring pattern */
  --coin-svg: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'>\
  <g fill='none' stroke='%23ffffff' stroke-width='2'>\
    <circle cx='32' cy='32' r='18'/>\
    <circle cx='32' cy='32' r='14'/>\
  </g>\
</svg>");

  background-image: var(--coin-svg);
  background-repeat: repeat;
  background-size: var(--coin-pattern-size) var(--coin-pattern-size);
  opacity: var(--coin-pattern-opacity);
  filter: grayscale(100%) brightness(60%) opacity(var(--coin-pattern-opacity));
  animation: coinDrift var(--coin-pattern-speed) linear infinite;
}

@keyframes coinDrift {
  0% { background-position: 0 0; }
  100% { background-position: 200% 200%; }
}

@media (prefers-reduced-motion: reduce) {
  .menu-bg::before { animation: none; }
}

/* ===== Root layout ===== */
.menu-root {
  height: 100svh;
  display: grid;
  grid-template-rows: min-content min-content;
  justify-items: center;
  align-items: start;
  align-content: center;
  row-gap: var(--space-5);
  padding-top: calc(env(safe-area-inset-top, 0px) + var(--space-4));
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + var(--space-4));
  padding-left: max(env(safe-area-inset-left, 0px), var(--space-6), 3vw);
  padding-right: max(env(safe-area-inset-right, 0px), var(--space-6), 3vw);
}

.menu-header { text-align: center; }

/* ===== Panel base ===== */
.menu-panel {
  position: relative;
  width: 100%;
  max-width: 980px;
  background: var(--panel);
  border: 1px solid #1e2a3d;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-1);
  backdrop-filter: blur(6px);
  padding: clamp(var(--space-5), 2.2vw, var(--space-8));
  display: grid;
  grid-auto-rows: min-content;
  row-gap: var(--space-4);
  max-height: calc(
    100svh - env(safe-area-inset-top, 0px)
    - env(safe-area-inset-bottom, 0px)
    - 2 * var(--space-4)
    - 3.5rem
  );
  overflow: visible;
}

.panel-title {
  font-size: var(--h2);
  color: var(--text-2);
  text-transform: uppercase;
  letter-spacing: .4px;
  margin-bottom: var(--space-2);
}

/* ===== Desktop visuals ===== */
@media (min-width: 1024px) {
  .menu-panel {
    max-width: 1200px;
    background: linear-gradient(180deg, #111827f5, #0b1220f5);
    border: 1px solid #2a3852;
    box-shadow:
      0 14px 32px rgba(0, 0, 0, .5),
      inset 0 1px 0 rgba(255, 255, 255, .06);
  }
}

/* ===== Mobile / short screens ===== */
@media (max-width: 900px), (max-height: 600px) {
  html, body {
    height: auto;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }
  .menu-root {
    height: auto;
    min-height: 100dvh;
    row-gap: var(--space-4);
  }
  .menu-panel {
    max-height: none;
    padding-bottom: calc(var(--space-8) + env(safe-area-inset-bottom, 0px));
  }
}

/* Keep all menu content above animated background */
.menu-root,
.menu-header,
.menu-panel { position: relative; z-index: 1; }.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  margin: -1px !important;
  padding: 0 !important;
  border: 0 !important;
  clip: rect(0 0 0 0) !important;
  overflow: hidden !important;
  white-space: nowrap !important;
}/* css/game/background.css */
.area[hidden] { display: none !important; }

/* === Starter Cove (Area 1) ===================================== */

.area-cove {
  position: fixed;
  inset: 0;
  display: grid;
  grid-template-rows: 1fr;
  height: 100svh;
  overflow: hidden;
  z-index: 0;
}

/* Base playfield (color + very soft broad dunes) */
.area-cove .playfield {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  touch-action: none;

  background-image:
    radial-gradient(1200px 800px at 30% 35%, hsl(40 35% 70% / 0.25), transparent 60%),
    radial-gradient(1400px 900px at 75% 65%, hsl(40 40% 82% / 0.22), transparent 65%),
    linear-gradient(to bottom, hsl(40 70% 82%), hsl(40 60% 68%));
  background-size: 1200px 800px, 1400px 900px, 100% 100%;
  background-repeat: no-repeat, no-repeat, no-repeat;
}

/* --- Grain overlay (visible speckle) ---------------------------- */
.area-cove .playfield::before {
  content: "";
  position: absolute; inset: 0;
  pointer-events: none; z-index: 0;

  /* coarse visible clumps + fine sparkle; both tile seamlessly */
  background-image:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.22' numOctaves='3' seed='7' stitchTiles='stitch'/%3E%3CfeGaussianBlur stdDeviation='0.7'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='table' tableValues='0 0.45'/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='256' height='256'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' seed='11' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='table' tableValues='0 0.15'/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-size: 512px 512px, 256px 256px;
  background-repeat: repeat, repeat;
  mix-blend-mode: multiply;
  opacity: 0.9;
}

/* --- Depth dunes (highlights + shadows; no seams) --------------- */
.area-cove .playfield::after {
  content: "";
  position: absolute; inset: 0;
  pointer-events: none; z-index: 1;

  /* layer 1: shadows (multiply)
     layer 2: highlights (screen) with gamma to push brights */
  background-image:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1024' height='1024'%3E%3Cfilter id='s'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.012' numOctaves='4' seed='23' stitchTiles='stitch'/%3E%3CfeGaussianBlur stdDeviation='1.2'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='table' tableValues='0 0.35'/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23s)'/%3E%3C/svg%3E"),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1024' height='1024'%3E%3Cfilter id='h'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.015' numOctaves='3' seed='31' stitchTiles='stitch'/%3E%3CfeGaussianBlur stdDeviation='1.2'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3CfeComponentTransfer%3E%3CfeFuncR type='gamma' amplitude='1' exponent='0.6' offset='0'/%3E%3CfeFuncG type='gamma' amplitude='1' exponent='0.6' offset='0'/%3E%3CfeFuncB type='gamma' amplitude='1' exponent='0.6' offset='0'/%3E%3CfeFuncA type='table' tableValues='0 0.40'/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23h)'/%3E%3C/svg%3E");

  background-size: 1024px 1024px, 1024px 1024px;  /* dune scale */
  background-repeat: repeat, repeat;
  background-blend-mode: multiply, screen;        /* shadows + highlights */
  opacity: 0.65;                                  /* overall intensity */
}

/* larger tiles on ultrawide for slower repetition */
@media (min-width: 1600px) {
  .area-cove .playfield::after { background-size: 1280px 1280px, 1280px 1280px; }
}

/* ===== Disable text/image selection and long-press highlight in playfield ===== */
@media (pointer: coarse) {
* {
  -webkit-user-select: none;  /* Safari / iOS */
  -moz-user-select: none;     /* Firefox */
  -ms-user-select: none;      /* Old IE */
  -webkit-touch-callout: none; /* Disable tap & hold context menu on iOS */
  -webkit-tap-highlight-color: transparent; /* Remove grey tap highlight */
  -webkit-user-drag: none;
  }
}/* css/ui/hud.css */

/* Bottom HUD */
.hud-bottom {
position: absolute;
left: 0;
right: 0;
bottom: 0;
z-index: 999;
display: grid;
gap: 10px;
padding: 10px;
padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
grid-template-columns: repeat(4, 1fr);
grid-auto-rows: clamp(64px, 10svh, 110px);
align-items: end;
align-content: end;
background: none;
}

/* Base button appearance: rectangular w/ black outline, slight rounding */
.game-btn {
  -webkit-tap-highlight-color: transparent;
  appearance: none;
  border: 4px solid #000;
  border-radius: 8px;
  padding: 0;
  margin: 0;
  width: 100%;
  height: 100%;
  display: grid;
  place-items: center;
  cursor: pointer;
  touch-action: manipulation;
  outline: none;
  font-weight: 900;
  font-size: clamp(18px, 3.5vw, 32px);
  color: #fff;
  transition: transform 120ms ease, filter 120ms ease;
  user-select: none;
}

.game-btn:active {
transform: translateY(1px) scale(0.997);
}

/* Hide via attribute */
.game-btn[hidden] { display: none !important; }

.btn-help  { background: linear-gradient(180deg,#f7d64b,#e8b800); }
.btn-shop  { background: linear-gradient(180deg,#62b447,#2a8a2b); }
.btn-stats { background: linear-gradient(180deg,#e04a3f,#b92b20); }
.btn-map   { background: linear-gradient(180deg,#39e6df,#00aabb); }

/* Desktop: crisp 1px stroke for text (where supported), plus light shadow */
.game-btn {
-webkit-text-stroke: 1px #000; /* desktop outline */
text-stroke: 1px #000;
text-shadow: 0 1px 0 rgba(0,0,0,0.35); /* small helper shadow for browsers without stroke */
}

/* Touch devices: smoother fake stroke for the coin counter only */
@media (pointer: coarse) {
   .coin-amount, .game-btn {
    -webkit-text-stroke: 0 !important;
    text-stroke: 0 !important;
    -webkit-text-fill-color: #fff;
    text-shadow:
      0 0.5px 0 #000, 0 -0.5px 0 #000,
      0.5px 0 0 #000, -0.5px 0 0 #000,
      0.5px 0.5px 0 #000, 0.5px -0.5px 0 #000,
      -0.5px 0.5px 0 #000, -0.5px -0.5px 0 #000,
      0 1px 0 rgba(0,0,0,0.28);
  }
}



/* Portrait / phone: 2x2 layout, keep gaps, adjust sizes */
@media (hover: none) and (pointer: coarse) and (max-aspect-ratio: 1/1) {
.hud-bottom {
grid-template-columns: repeat(2, 1fr);
grid-auto-rows: minmax(72px, 1fr);
gap: 8px;
padding: 8px;
padding-bottom: calc(env(safe-area-inset-bottom) + 8px);
height: min(40svh, 360px);
}
.game-btn {
font-size: clamp(16px, 6.4vw, 30px);
}
}

/* Corner rounding: keep outermost corners rounded, inner seams remain sharp */
.hud-bottom > .game-btn:first-child  { border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
.hud-bottom > .game-btn:last-child   { border-top-right-radius: 10px; border-bottom-right-radius: 10px; }

@media (max-aspect-ratio: 1/1) {
/* 2x2 layout corners */
.hud-bottom > .game-btn:nth-child(1) { border-top-left-radius: 10px; }
.hud-bottom > .game-btn:nth-child(2) { border-top-right-radius: 10px; }
.hud-bottom > .game-btn:nth-child(3) { border-bottom-left-radius: 10px; }
.hud-bottom > .game-btn:nth-child(4) { border-bottom-right-radius: 10px; }
}

/* Portrait fine-tuning */
@media (pointer: coarse) and (max-aspect-ratio: 1/1) {
.hud-bottom {
height: min(20svh, 160px);
grid-auto-rows: minmax(48px, 1fr);
gap: 6px;
padding: 6px;
padding-bottom: calc(env(safe-area-inset-bottom) + 6px);
}

.game-btn {
font-size: clamp(15px, 4.8vw, 24px);
line-height: 1.1;
}
}

.hud-bottom { container-type: inline-size; }
.hud-bottom .game-btn { white-space: nowrap; }
.hud-bottom .game-btn[data-btn="stats"] {
  font-size: clamp(18px, 2.5cqw, 32px);
}

/* ===== Layout helpers driven by JS ===== */

/* Mobile portrait 2x2: when 3 buttons (Help, Settings, Shop), let Shop span full width */
@media (max-aspect-ratio: 1/1) {
.hud-bottom .game-btn[data-btn="shop"].span-2 {
grid-column: 1 / -1; /* takes both columns */
}
}

/* (No extra CSS needed for the desktop 2-button centering;
  JS sets grid-template-columns inline and positions the two items.) */

/* Landscape fine-tuning for small-height devices */
@media (pointer: coarse) and (orientation: landscape) and (max-height: 480px) {
.hud-bottom {
height: auto;
grid-template-columns: repeat(4, 1fr);
grid-auto-rows: clamp(44px, 12vh, 60px);
gap: 8px;
padding: 8px;
padding-bottom: calc(env(safe-area-inset-bottom) + 6px);
}
.game-btn {
font-size: clamp(14px, 2.2vw, 22px);
white-space: nowrap;
-webkit-text-stroke: 0;
text-stroke: 0;
text-shadow:
1px 0   0 #000,
-1px 0   0 #000,
0   1px 0 #000,
0  -1px 0 #000,
0   0.5px 0 rgba(0,0,0,0.2);
}
.hud-bottom [data-btn="stats"] {
font-size: clamp(13px, 2.0vw, 20px);
}
}

/* ===== Top HUD: Coin Counter + Other stuff ===== */
.hud-top{
position: fixed;
top: calc(env(safe-area-inset-top) + 12px);
left: 0;
right: 0;
z-index: 1000;
display: grid;
justify-content: center;
align-items: center;
grid-auto-flow: row;
grid-template-columns: auto;
gap: clamp(4px, 0.9svh, 10px);
pointer-events: none;
}

.hud-top > * {
  justify-self: center;
}

.hud-top--xp-only {
  grid-template-columns: auto;
}

.hud-top--xp-only > [data-xp-hud] {
  justify-self: center;
}

.hud-top--xp-only .xp-counter {
  justify-content: center;
}

.hud-top--xp-mp {
  grid-template-columns: auto;
}

@media (min-width: 960px) {
  .hud-top.hud-top--xp-mp {
    grid-template-columns: auto auto;
    grid-template-rows: auto auto;
    column-gap: 36px;
  }
  .hud-top.hud-top--xp-mp > :nth-child(1) {
    grid-column: 1 / -1;
  }
  .hud-top.hud-top--xp-mp > :nth-child(2) {
    grid-column: 1;
    grid-row: 2;
    justify-self: end;
  }
  .hud-top.hud-top--xp-mp > :nth-child(3) {
    grid-column: 2;
    grid-row: 2;
    justify-self: start;
  }
  .hud-top.hud-top--xp-mp > [data-xp-hud] {
    margin-right: 18px;
  }
  .hud-top.hud-top--xp-mp > [data-mp-hud] {
    margin-left: 18px;
  }

  .hud-top.hud-top--xp-only {
    grid-template-columns: auto;
  }
  .hud-top.hud-top--xp-only > :nth-child(1) {
    grid-column: 1 / -1;
  }
  .hud-top.hud-top--xp-only > [data-xp-hud] {
    grid-column: 1 / -1;
    grid-row: 2;
  }
}

/* ===== Defaults (desktop / general) ===== */
:root{
--coin-h: clamp(48px, 6svh, 72px);
--coin-plus-extra: 20px;
--coin-plus-size: calc(var(--coin-h) + var(--coin-plus-extra));

--coin-bar-w: clamp(200px, 36vw, 520px);
--coin-outline: 4px;

--bar-underlap: 0.50;
--hud-x-nudge: 0px;

--bar-y-nudge: 9px;
}

.coin-counter{
position: relative;
width: var(--coin-bar-w);
height: max(var(--coin-plus-size), var(--coin-h));
pointer-events: auto;
}

.coin-plus{
position:absolute;
top:50%;
left: calc((var(--bar-underlap) - 1) * var(--coin-plus-size));
transform: translateY(-50%);
z-index:2;
height: var(--coin-plus-size);
width:  var(--coin-plus-size);
object-fit: contain;
border: none;
pointer-events: none;
user-select: none;
}

.coin-bar{
position:relative;
z-index:1;
height: var(--coin-h);
width: 100%;
border: var(--coin-outline) solid #000;
border-radius: 0;
background: linear-gradient(180deg,#ffd34c,#ffb800);

display:flex;
align-items:center;
justify-content:center;
padding: 0 16px;
box-sizing: border-box;
overflow: hidden;

transform: translateY(var(--bar-y-nudge));
}

.coin-bar::after{
content:"";
position:absolute;
inset:2px;
border-radius:0;
box-shadow:
inset 0 6px 10px rgba(255,255,255,.18),
inset 0 -6px 10px rgba(0,0,0,.15);
pointer-events:none;
}

.coin-amount{
position: relative;
z-index: 1;
font-weight: 900;
font-size: clamp(18px, 3.6vw, 32px);
color: #fff;
letter-spacing: .5px;
-webkit-text-stroke: 1px #000; text-stroke: 1px #000;
text-shadow: 0 1px 0 rgba(0,0,0,.35);
line-height: 1;
font-variant-numeric: tabular-nums lining-nums;
font-feature-settings: "tnum" 1, "lnum" 1;
}

@media (hover: none) and (pointer: coarse) {
  .coin-counter, .coin-plus, .xp-counter, .xp-plus {
    filter: none !important;
  }
}

@media (pointer: coarse) and (orientation: portrait) and (max-width: 600px){
.hud-top{
--pp-gutter: max(7vw, 24px);
--pp-reserve: max(
var(--pp-gutter),
calc((1 - var(--bar-underlap)) * var(--coin-plus-size) + 10px)
);
padding-left:  max(env(safe-area-inset-left),  var(--pp-reserve));
padding-right: max(env(safe-area-inset-right), var(--pp-reserve));
}
:root{
--coin-bar-w: clamp(240px, 65vw, 320px);
--coin-plus-extra: 4px;
--bar-underlap: 0.48;
--bar-y-nudge: 2px; 
}
}

@media (pointer: coarse) and (orientation: landscape){
:root{
--coin-bar-w: clamp(220px, 38vw, 560px);
}
}

@media (pointer: coarse) and (orientation: portrait) and (min-width: 768px) and (max-width: 1024px){
:root{
--coin-bar-w: min(72vw, 560px);
}
}

@media (pointer: coarse){
  .hud-top .coin-amount{
    -webkit-text-stroke: 0 !important;
    text-stroke: 0 !important;
    -webkit-text-fill-color: #fff;
    text-shadow:
      0   0.5px 0 #000,  0  -0.5px 0 #000,
      0.5px 0   0 #000, -0.5px 0   0 #000,
      0.5px 0.5px 0 #000,  0.5px -0.5px 0 #000,
     -0.5px 0.5px 0 #000, -0.5px -0.5px 0 #000,
      0 1px 0 rgba(0,0,0,0.28) !important;
  }
}

.xp-counter{
  position: relative;
  --xp-bar-h: clamp(34px, 5.2svh, 46px);
  --xp-plus-size: clamp(52px, 7.4svh, 76px);
  --xp-bar-outline: 3px;
  --xp-bar-underlap: 0.44;
  width: min(var(--coin-bar-w), clamp(200px, 44vw, 440px));
  height: max(var(--xp-plus-size), var(--xp-bar-h));
  display: flex;
  align-items: center;
  justify-content: flex-end;
  margin-top: -2px;
  pointer-events: none;
}

.xp-counter[hidden]{
  display: none !important;
}

.mp-counter{
  position: relative;
  --mp-bar-h: clamp(34px, 5.2svh, 46px);
  --mp-plus-size: clamp(52px, 7.4svh, 76px);
  --mp-bar-outline: 3px;
  --mp-bar-underlap: 0.44;
  width: min(var(--coin-bar-w), clamp(200px, 44vw, 440px));
  height: max(var(--mp-plus-size), var(--mp-bar-h));
  display: flex;
  align-items: center;
  justify-content: flex-end;
  margin-top: -2px;
  pointer-events: none;
}

.mp-counter[hidden]{
  display: none !important;
}

.mp-plus{
  position: absolute;
  top: 50%;
  left: calc((var(--mp-bar-underlap) - 1) * var(--mp-plus-size));
  transform: translateY(-50%);
  width: var(--mp-plus-size);
  height: auto;
  object-fit: contain;
  pointer-events: none;
  z-index: 2;
}

.mp-bar{
  position: relative;
  z-index: 1;
  flex: 1;
  width: 100%;
  height: var(--mp-bar-h);
  border: var(--mp-bar-outline) solid #2a0b00;
  border-radius: 0;
  background: linear-gradient(180deg, rgba(60,24,0,0.92), rgba(45,18,0,0.78));
  box-shadow:
    inset 0 6px 10px rgba(255,192,128,0.18),
    inset 0 -6px 14px rgba(0,0,0,0.52);
  overflow: hidden;
  pointer-events: none;
}

.mp-bar__fill{
  position: absolute;
  inset: 0;
  width: var(--mp-fill, 0%);
  background: linear-gradient(90deg,
    rgba(255,170,0,1) 0%,
    rgba(255,120,0,1) 50%,
    rgba(200,60,0,1) 100%
  );
  transition: width 160ms ease-out;
}

.mp-bar__fill::after{
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.46), rgba(255,255,255,0));
  opacity: 0.55;
  mix-blend-mode: screen;
}

.mp-bar__frame{
  position: relative;
  z-index: 1;
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: clamp(4px, 0.5svh, 6px);
  padding: clamp(3px, 0.9svh, 5px) clamp(10px, 2.4vw, 16px);
  font-size: clamp(10px, 1.6vw, 14px);
  font-weight: 700;
  color: #fff3e5;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0,0,0,0.75);
  pointer-events: none;
  box-sizing: border-box;
}

.mp-bar__level{
  display: inline-flex;
  align-items: baseline;
  gap: 0.3em;
  letter-spacing: 0;
  line-height: 0.75;
}

.mp-level-value{
  font-size: clamp(12px, 2.0vw, 15px);
}

.mp-bar__progress{
  display: inline-flex;
  align-items: baseline;
  justify-content: center;
  gap: 3px;
  font-size: clamp(12px, 2.0vw, 15px);
  white-space: nowrap;
  letter-spacing: 0.02em;
  line-height: 0.75;
}

.mp-progress-suffix{
  font-weight: 600;
  letter-spacing: 0.08em;
}

.mp-progress-separator{
  opacity: 0.8;
}

@media (pointer: coarse) and (orientation: portrait){
  .mp-counter{
    --mp-bar-h: clamp(32px, 8vw, 44px);
    --mp-plus-size: clamp(48px, 15vw, 70px);
    --mp-bar-underlap: 0.46;
    width: min(var(--coin-bar-w), clamp(200px, 82vw, 360px));
  }
}

@media (pointer: coarse) and (orientation: portrait) and (max-width: 600px) {
  .mp-counter {
    --mp-plus-size: var(--coin-plus-size);
  }
  .mp-plus {
    transform: translateY(-50%);
    left: calc((var(--mp-bar-underlap) - 1) * var(--mp-plus-size));
  }
}

.xp-plus{
  position: absolute;
  top: 50%;
  left: calc((var(--xp-bar-underlap) - 1) * var(--xp-plus-size));
  transform: translateY(-50%);
  width: var(--xp-plus-size);
  height: auto;
  object-fit: contain;
  pointer-events: none;
  z-index: 2;
}

.xp-bar{
  position: relative;
  z-index: 1;
  flex: 1;
  width: 100%;
  height: var(--xp-bar-h);
  border: var(--xp-bar-outline) solid #01060f;
  border-radius: 0;
  background: linear-gradient(180deg, rgba(12,26,46,0.92), rgba(16,32,58,0.78));
  box-shadow:
    inset 0 6px 10px rgba(255,255,255,0.14),
    inset 0 -6px 14px rgba(0,0,0,0.45);
  overflow: hidden;
  pointer-events: none;
}

.xp-bar__fill{
  position: absolute;
  inset: 0;
  width: var(--xp-fill, 0%);
background: linear-gradient(90deg,
  rgba(0,240,255,1) 0%,
  rgba(0,150,255,1) 50%,
  rgba(0,70,210,1) 100%
);

  transition: width 160ms ease-out;
}

.xp-bar__fill::after{
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.52), rgba(255,255,255,0));
  opacity: 0.6;
  mix-blend-mode: screen;
}

.xp-bar__frame{
  position: relative;
  z-index: 1;
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: clamp(4px, 0.5svh, 6px);
  padding: clamp(3px, 0.9svh, 5px) clamp(10px, 2.4vw, 16px);
  font-size: clamp(10px, 1.6vw, 14px);
  font-weight: 700;
  color: #f2f7ff;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0,0,0,0.75);
  pointer-events: none;
  box-sizing: border-box;
}

@media (pointer: fine) {
  .xp-counter,
  .xp-bar,
  .xp-bar__frame {
    pointer-events: auto;
  }

  .xp-bar__frame,
  .xp-bar__frame *,
  .xp-bar__progress,
  .xp-bar__progress *,
  .xp-bar__level,
  .xp-bar__level * {
    user-select: text;
  }
  
  .xp-plus {
	  user-select: none;
  }
}

.xp-bar__level{
  display: inline-flex;
  align-items: baseline;
  gap: 0.3em;
  letter-spacing: 0;
  line-height: 0.75;
}

.xp-level-label,
.xp-level-value{
  font-size: clamp(12px, 2.0vw, 15px);
}

.xp-bar__divider{
  display: none;
}

.xp-bar__progress{
  display: inline-flex;
  align-items: baseline;
  justify-content: center;
  gap: 3px;
  font-size: clamp(12px, 2.0vw, 15px);
  white-space: nowrap;
  letter-spacing: 0.02em;
  line-height: 0.75;
}

.xp-progress-suffix{
  font-weight: 600;
  letter-spacing: 0.08em;
}

.xp-progress-separator{
  opacity: 0.8;
}

@media (pointer: fine) {
  .mp-counter,
  .mp-bar,
  .mp-bar__frame {
    pointer-events: auto;
  }

  .mp-bar__frame,
  .mp-bar__frame *,
  .mp-bar__progress,
  .mp-bar__progress *,
  .mp-bar__level,
  .mp-bar__level * {
    user-select: text;
  }

  .mp-plus {
    user-select: none;
  }
}

@media (pointer: coarse) and (orientation: portrait){
  .xp-counter{
    --xp-bar-h: clamp(32px, 8vw, 44px);
    --xp-plus-size: clamp(48px, 15vw, 70px);
    --xp-bar-underlap: 0.46;
    width: min(var(--coin-bar-w), clamp(200px, 82vw, 360px));
  }
}

@media (pointer: coarse) and (orientation: portrait) and (max-width: 600px) {
  .xp-counter {
    --xp-plus-size: var(--coin-plus-size);
  }
  .xp-plus {
    transform: translateY(-50%);
    left: calc((var(--xp-bar-underlap) - 1) * var(--xp-plus-size));
  }
}

.infinity-symbol {
  position: relative;
  color: #fff200;
  font-weight: 900;
  -webkit-text-fill-color: currentColor;
}

.coin-amount .infinity-symbol {
  top: -0.11em;
}
/* ===== Waves & Water Layers ===== */

/* Ensure all positioned children stack inside the playfield */
.area-cove .playfield {
  position: relative;
}

/* Layer order: sand (default) < coins (2) < water-base (3) < surges (4) */

/* Coins — behind water & surges */
.area-cove .playfield .coins-layer {
  position: absolute;
  inset: 0;
  z-index: 2;
  pointer-events: none;
}

/* Static water band (visible at the top) */
.area-cove .playfield .water-base {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: min(22svh, 22%);
  z-index: 3;

  background: linear-gradient(
    to bottom,
    hsl(194 66% 59%) 0%,
    hsl(191 64% 56%) 35%,
    hsl(188 60% 54% / 0.5) 65%,
    transparent 100%
  );

  -webkit-mask-image: linear-gradient(to bottom, #000 70%, transparent 100%);
          mask-image: linear-gradient(to bottom, #000 70%, transparent 100%);

  animation: water-drift 10s linear infinite;
}

/* Surges (big waves) — wash over water & coins */
.area-cove .playfield .surges {
  position: absolute;
  inset: 0;
  z-index: 4;
  pointer-events: none;
}

/* Small continuous horizontal movement for water */
@keyframes water-drift {
  0%   { background-position: 0 0; }
  100% { background-position: 480px 0; }
}

/* ===== Surge Animation ===== */

.wave-surge {
  position: absolute;
  height: clamp(34px, 10svh, 120px);
  border-radius: 999px;
  opacity: 1;
  transform-origin: 50% 0%;
  background: radial-gradient(
    85% 70% at 50% 60%,
    rgba(61,178,204,0.45) 0 55%,
    rgba(61,178,204,0.18) 70%,
    rgba(61,178,204,0) 78%
  );
  filter: blur(0.2px);
  --surge-duration: 2600ms;
  --surge-distance: clamp(100px, 16svh, 240px);
  --surge-fade-delay: 500ms;
  --surge-fade-duration: 300ms;
  transform: translateY(-8px) scaleX(.92); /* match 0% of surge-move */
  transition: none;
}

.wave-surge::before,
.wave-surge::after{ transition: none; }

/* White foam crest */
/* Foam crest — moved forward toward the leading (downward) edge */
.wave-surge::after{
  content:"";
  position:absolute;
  /* push the foam down: bigger top inset, smaller bottom inset */
  inset: 26% 12% 14% 12%;     /* was ~16% 12% 30% 12% */
  border-radius: inherit;

  /* center of the foam shifted lower (74%) so the highlight sits forward */
  background:
    radial-gradient(84% 68% at 58% 74%,
      rgba(255,255,255,.98) 0 46%,
      rgba(255,255,255,.70) 60%,
      rgba(255,255,255,0)   82%),
    /* subtle cool tint right under the crest adds thickness */
    radial-gradient(120% 90% at 50% 84%,
      rgba(51,152,180,.22) 0 40%,
      transparent 70%);

  transform: translateY(2%);  /* slight forward nudge */
  animation: foam-breathe 1.6s ease-in-out infinite alternate; /* keep your existing wobble */
  will-change: transform;
}


/* Movement starts immediately; fade begins 0.5s in */
.wave-surge.run {
  animation-name: surge-move, surge-fadeout;
  animation-duration: var(--surge-duration), var(--surge-fade-duration);
  animation-delay: 0ms, var(--surge-fade-delay);
  animation-timing-function: cubic-bezier(.25,.6,.2,1), linear;
  animation-fill-mode: forwards, forwards;
}

/* Downward movement */
@keyframes surge-move {
  0%   { transform: translateY(-8px) scaleX(.92); opacity: 1; }
  100% { transform: translateY(var(--surge-distance)) scaleX(1.06); opacity: 1; }
}

/* Fast fade after 0.5s delay */
@keyframes surge-fadeout {
  0%   { opacity: 1; }
  100% { opacity: 0; }
}

/* ===== Coin Animation ===== */

@keyframes coin-from-wave {
  0% {
    transform: translate3d(var(--x0), var(--y0), 0) rotate(-10deg) scale(.96);
    opacity: .9;
  }
  66% {
    transform: translate3d(var(--x1), var(--y1), 0) rotate(-2deg) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate3d(var(--x1), var(--y1), 0) rotate(0deg) scale(1);
  }
}
/* css/game/coin.css */
@keyframes cccCoinCollect {
  0%   { transform: var(--ccc-start, translate3d(0,0,0)) scale(1);   opacity: 1;    filter: brightness(1); }
  70%  { transform: var(--ccc-start, translate3d(0,0,0)) scale(1.35) translateY(-12px); opacity: .35; }
  100% { transform: var(--ccc-start, translate3d(0,0,0)) scale(1.5)  translateY(-14px); opacity: 0; }
}

.coin--collected {
  pointer-events: none !important;
  animation: cccCoinCollect 220ms cubic-bezier(.2,.9,.35,1) forwards !important;
  will-change: transform, opacity;
}

.area-cove .magnet-indicator {
  position: absolute;
  pointer-events: none;
  border: 2px solid rgb(80 145 255);
  border-radius: 50%;
  box-shadow:
    0 0 20px 4px rgb(95 165 255 / 0.95),
    inset 0 0 36px rgb(85 155 255 / 0.78);
  mix-blend-mode: normal;
  opacity: 0;
  transform: translate3d(-9999px, -9999px, 0);
  transition: opacity 90ms ease-out;
  z-index: 6;
}

.area-cove .magnet-indicator.is-visible {
  opacity: 0.9;
}
/* css/ui/shop.css */

:root {
  --shop-bg: hsla(215, 32%, 7%, 0.75);
  --shop-card: hsl(220 18% 14% / 1);
  --shop-border: hsl(210 18% 28% / 1);
  --shop-shadow: 0 20px 60px hsl(0 0% 0% / .45);
  --shop-radius: 20px;
  --shop-anim: 220ms cubic-bezier(.2, .8, .2, 1);
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

.shop-overlay {
  position: fixed;
  inset: 0;
  z-index: 4000;              /* Above HUD */
  pointer-events: none;       /* disabled until open */
  user-select: none;
}

.shop-overlay.is-open {
  pointer-events: auto;
}

.shop-sheet {
  position: absolute;
  inset: 0;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  display: grid;
  grid-template-rows: auto 1fr auto;
  transform: translateY(100%);
  transition: transform var(--shop-anim);
  box-shadow: var(--shop-shadow);
}

.shop-overlay:not(.is-open) .shop-sheet,
.upg-overlay:not(.is-open) .upg-sheet {
  box-shadow: none;
}

/* When open -> slide in */
.shop-overlay.is-open .shop-sheet {
  transform: translateY(0);
}

/* Top grabber strip */
.shop-grabber {
  padding-top: calc(8px + var(--safe-top));
  padding-bottom: 12px;
  display: grid;
  place-items: center;
  touch-action: none;         /* enables smooth pointer tracking */
  -webkit-user-select: none;
  user-select: none;
  background: var(--shop-bg);
  position: relative;
  z-index: 6;
}

.shop-grabber .grab-handle {
  width: 56px;
  height: 6px;
  border-radius: 999px;
  background: hsl(0 0% 100% / .35);
  box-shadow: inset 0 1px 0 hsl(0 0% 100% / .25);
}

.shop-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  padding: 12px 16px calc(12px + var(--safe-bottom));
  flex-wrap: wrap;
  background: var(--shop-bg);
}

.shop-actions .shop-close {
  min-width: 180px;
  height: 44px;
  border-radius: 0;
  border: 1px solid hsla(0, 80%, 40%, 0.45);
  background: hsla(0, 80%, 40%, 0.15);
  color: #fff;
  font-weight: 600;
  letter-spacing: .2px;
  cursor: pointer;
  touch-action: manipulation;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}
.shop-actions .shop-close:hover {
  background: hsla(0, 80%, 40%, 0.22);
}
.shop-actions .shop-close:active {
  transform: translateY(1px);
  background: hsla(0, 80%, 40%, 0.28);
}

.shop-actions .shop-delve {
  min-width: 180px;
  height: 44px;
  border-radius: 0;
  border: 1px solid hsla(150, 60%, 35%, 0.45);
  background: hsla(150, 60%, 35%, 0.15);
  color: #fff;
  font-weight: 600;
  letter-spacing: .2px;
  cursor: pointer;
  touch-action: manipulation;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}
.shop-actions .shop-delve:hover {
  background: hsla(150, 60%, 35%, 0.22);
}
.shop-actions .shop-delve:active {
  transform: translateY(1px);
  background: hsla(150, 60%, 35%, 0.28);
}

.shop-actions .shop-delve.is-new {
  box-shadow: 0 0 0 0 hsla(150, 70%, 60%, 0.45);
  animation: shop-delve-pulse 1.6s ease-in-out infinite;
}

@keyframes shop-delve-pulse {
  0%,
  100% {
    box-shadow: 0 0 0 0 hsla(150, 70%, 60%, 0.45);
  }
  50% {
    box-shadow: 0 0 13px 3px hsla(150, 70%, 62%, 0.75);
  }
}
.shop-actions .shop-delve:hover {
  background: hsla(150, 60%, 35%, 0.22);
}
.shop-actions .shop-delve:active {
  transform: translateY(1px);
  background: hsla(150, 60%, 35%, 0.28);
}

@media (max-width: 480px) and (orientation: portrait) {
  .shop-actions .shop-close,
  .shop-actions .shop-delve {
    min-width: 140px;
  }
}

@media (prefers-reduced-motion: reduce) {
  .shop-sheet { transition: none; }
  .upg-sheet { transition: none; }
  .shop-upgrade.hm-evolve-ready .shop-tile { animation: none; }
}

/* === SHOP GRID === */

/* Default (desktop / general) */
.shop-sheet {
  --shop-tile: clamp(84px, 24vw, 128px);
  --shop-gap:  clamp(8px, 2.5vw, 16px);
  --shop-fade-size: clamp(18px, 5vw, 40px);
  --shop-scroller-pad: 12px;
}

.shop-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(var(--shop-tile), 1fr));
  gap: clamp(8px, 2vw, 16px);
  width: 100%;
  max-width: none;
  margin-inline: auto;
  padding: 4px;
  justify-content: center;
}

.shop-upgrade {
  background: none;
  border: 0;
  padding: 0;
  cursor: pointer;
  outline-offset: 4px;
}

.shop-upgrade.is-locked {
  opacity: 0.78;
  user-select: none;
}

.shop-upgrade.is-locked-plain,
.shop-upgrade[data-locked-plain='1'],
.shop-upgrade:disabled {
  cursor: not-allowed;
}

.shop-upgrade .shop-tile { cursor: inherit; }

.shop-upgrade.is-locked-plain .shop-tile,
.shop-upgrade[data-locked-plain='1'] .shop-tile,
.shop-upgrade:disabled .shop-tile {
  cursor: not-allowed;
}

.shop-upgrade.is-locked .shop-tile .level-badge {
  background: rgba(0, 0, 0, 0.72);
  color: #d9d9d9;
}

.shop-tile {
  position: relative;
  width: var(--shop-tile);
  height: var(--shop-tile);
  display: block;
  margin: 0 auto;
}

.shop-tile img.base,
.shop-tile img.maxed-overlay {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  pointer-events: none;
}

.shop-tile img.base {
  z-index: 1;
}

.shop-tile img.maxed-overlay {
  z-index: 2;
}

.shop-tile img.icon {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 68%;
  height: 68%;
  object-fit: contain;
  pointer-events: none;
  z-index: 3;
}

.shop-tile .level-badge {
  position: absolute;
  left: 50%;
  bottom: 8%;
  transform: translateX(-50%);
  min-width: 22px;
  height: 22px;
  padding: 0 6px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  line-height: 1;
  font-weight: 700;
  color: #fff;
  background: rgba(0, 0, 0, 0.55);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.18);
  pointer-events: none;
  z-index: 3;
}

.shop-tile .level-badge.two-line{
  height: auto;
  min-height: 22px;
  padding: 2px 6px;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1.05;
}

/* === Mobile-specific tweaks === */
@media (hover: none) and (pointer: coarse) {
  .shop-sheet {
    /* use more of the width on phones */
    --grid-pad: clamp(2px, 2.5vw, 8px);           /* was clamp(8px, 4vw, 14px) */
    --gap: clamp(8px, 3.5vw, 14px);               /* keep similar column gap */
    --cols: 3;
    --shop-scroller-pad: clamp(2px, 2.5vw, 8px);  /* was clamp(8px, 4vw, 14px) */

    /* exact-fit tile: 3 icons + gaps fill the viewport more tightly */
    --tile-fit: calc(
      (100vw - env(safe-area-inset-left) - env(safe-area-inset-right)
        - (2 * var(--shop-scroller-pad))
        - (2 * var(--grid-pad))
        - ((var(--cols) - 1) * var(--gap))
      ) / var(--cols)
    );

    /* let tiles grow a bit bigger so 3-per-row hugs the sides more */
    --shop-tile: clamp(72px, var(--tile-fit), 124px); /* was 110px max */
  }

  .shop-grid {
    padding-inline: var(--grid-pad);
    gap: var(--gap);
    box-sizing: border-box;
  }

  .shop-scroller {
    overflow-x: clip;
    padding-inline: var(--shop-scroller-pad);
  }
}


/* === Shop header === */
.shop-content {
  position: relative;
  display: flex;
  flex-direction: column;
  padding: 0;
  min-height: 0;
  background: var(--shop-bg);
}

/* Sticky SHOP + full-width line (no darker band) */
.shop-header {
  position: sticky;
  top: 0;
  z-index: 10;

  /* Remove the colored strip — let the blur show through */
  background: transparent;

  /* Keep blur inherited from .shop-sheet */
  backdrop-filter: inherit;
  -webkit-backdrop-filter: inherit;

  display: block;
  width: 100%;
  padding: 10px 12px 8px;
  isolation: isolate;
}

.shop-title { margin: 0 0 8px 0; font-weight: 700; text-align: center; position: relative; z-index: 2; }

.shop-line {
  height: 2px;
  width: 100%;
  background: var(--shop-border);  /* the line itself is the clip edge */
  position: relative;
  z-index: 2;
}

.shop-header::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  top: calc(100% - 1px);
  height: var(--shop-fade-size);
  background: linear-gradient(180deg, var(--shop-bg), hsla(215, 32%, 7%, 0));
  opacity: 0;
  pointer-events: none;
  transition: opacity 160ms ease;
  z-index: 1;
}

.shop-scroller {
  overflow-y: auto;
  flex: 1 1 auto;
  min-height: 0;
  padding: 12px var(--shop-scroller-pad) 16px;
  scrollbar-gutter: stable both-edges;   /* no re-centering when scrollbar appears */
  -webkit-overflow-scrolling: touch;
}

/* Dark scrollbar styling */
/* Firefox */
.shop-scroller {
  scrollbar-width: thin;
  scrollbar-color: hsl(0 0% 100% / .22) hsl(220 18% 7% / .55);
}
/* Chromium/WebKit */
.shop-scroller::-webkit-scrollbar { width: 12px; }
.shop-scroller::-webkit-scrollbar-track {
  background: hsl(220 18% 7% / .55);
  border-left: 1px solid var(--shop-border);
}
.shop-scroller::-webkit-scrollbar-thumb {
  background: hsl(0 0% 100% / .22);
  border-radius: 10px;
}
.shop-scroller::-webkit-scrollbar-thumb:hover {
  background: hsl(0 0% 100% / .32);
}

/* Hide native scrollbars cross-browser (we’ll draw our own) */
.shop-scroller {
  scrollbar-width: none;              /* Firefox */
}
.shop-scroller::-webkit-scrollbar {    /* Chromium/WebKit (incl. iOS) */
  width: 0;
  height: 0;
  display: none;
}

.shop-sheet.has-scroll-shadow .shop-header::after {
  opacity: 1;
}

.shop-sheet.has-scroll-shadow .shop-scroller {
  -webkit-mask-image: linear-gradient(180deg, transparent 0%, #000 var(--shop-fade-size), #000 100%);
  mask-image: linear-gradient(180deg, transparent 0%, #000 var(--shop-fade-size), #000 100%);
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
}

/* Overlay scrollbar (same look on desktop + mobile) */
.shop-scrollbar {
  position: absolute;                 /* lives inside .shop-sheet */
  right: 6px;
  /* top/bottom are set from JS so it respects grabber/header/actions */
  width: 8px;
  border-radius: 6px;
  background: transparent;            /* no track fill */
  pointer-events: none;               /* won’t block clicks/scroll */
  z-index: 4;                         /* above grid/header */
}
.shop-scrollbar__thumb {
  width: 100%;
  min-height: 28px;                   /* readable minimum */
  border-radius: 6px;
  background: hsl(0 0% 100% / .28);
  box-shadow: inset 0 0 0 1px hsl(0 0% 100% / .12);
  transform: translateY(0);           /* JS updates this */
  transition: background .15s ease;
}
.shop-scrollbar__thumb:hover {        /* desktop hover only; harmless on mobile */
  background: hsl(0 0% 100% / .36);
}

/* allow interaction (we previously set pointer-events:none) */
.shop-scrollbar { pointer-events: auto; }

/* nice cursors when dragging */
.shop-scrollbar__thumb { cursor: grab; }
.shop-scrollbar__thumb.dragging { cursor: grabbing; }

/* Mobile: hide custom scrollbar until actively scrolling or dragging */
@media (hover: none) and (pointer: coarse) {
  .shop-scrollbar {
    opacity: 0;
    pointer-events: none;              /* don’t steal touches when hidden */
    transition: opacity .2s ease;
  }
  .shop-sheet.is-scrolling .shop-scrollbar,
  .shop-scrollbar__thumb.dragging {
    opacity: 1;
    pointer-events: auto;              /* interactive when visible */
  }
}


/* =========================================================
   Upgrades submenu
   ========================================================= */

.upg-overlay {
  position: fixed;
  inset: 0;
  z-index: 10000;
  pointer-events: none;
}
.upg-overlay.is-open { pointer-events: auto; }
.upg-overlay.is-open .upg-sheet { transform: translateY(0); }

.upg-sheet {
  position: absolute;
  left: 0; right: 0; bottom: 0; top: 0;
  display: grid;
  grid-template-rows: auto 1fr auto;   /* header | content | actions */
  background: rgba(12,16,20,.92);
  backdrop-filter: blur(6px);
  transform: translateY(100%);
  transition: transform 180ms ease;
  box-shadow: 0 -14px 40px rgba(0,0,0,.45);
  border-top-left-radius: 14px;
  border-top-right-radius: 14px;
}

.upg-overlay img {
  -webkit-user-select: none;
  user-select: none;
  -webkit-user-drag: none;
}

.upg-sheet.is-unlock-upgrade {
  grid-template-rows: auto auto 1fr auto;
}

.upg-grabber { display: grid; place-items: center; padding: 8px 0 4px; }
.upg-grabber .grab-handle {
  width: 52px; height: 5px; border-radius: 4px;
  background: rgba(255,255,255,.35);
}

.upg-header {
  padding: 10px 18px 0;
  text-align: center;
  color: #fff;
}
.upg-title { font-size: clamp(44px, 6vw, 72px); font-weight: 700; }
.upg-level { font-size: clamp(18px, 2.6vw, 28px); opacity: .92; }

.upg-content{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding-bottom:2vh;
  will-change: transform;
}

.upg-sheet:not(.is-maxed) .upg-content { 
  transform: translateY(-12vh);
  padding-top: 2vh;
}

.upg-sheet.is-maxed .upg-content{
  transform: translateY(-20vh);
  padding-top: 0.5vh;
  padding-bottom: 3vh;
}

.upg-sheet.is-unlock-short .upg-content {
  transform: none;
}

.upg-sheet.is-locked-hidden .upg-content{
  transform: translateY(-24vh);
  padding-top: 2vh;
  padding-bottom: 2vh;
  justify-content: flex-start;
}

.upg-sheet.is-unlock-upgrade .upg-content {
  transform: none;
  padding-top: 1.5vh;
  padding-bottom: 2vh;
}

.upg-desc.centered{
  text-align:center;
  font-size: clamp(32px, 4.6vw, 50px);
  margin-top: 4px;
  white-space: pre-line;
}

.upg-desc.centered.lock-desc{
  margin-top: 0;
}

.upg-info{
  display:grid;
  gap:14px;
  margin:14px 0 4px;
  text-align:center;
  color:#fff;
}

.upg-sheet.is-locked-hidden .upg-info{
  margin-top: 50px;
}

.upg-costs{ gap:2px; margin-top:2px; }

.upg-line{
  font-size: clamp(32px, 4.6vw, 50px);
  line-height:1.25;
}

.upg-line.lock-note{
  font-size: clamp(26px, 3.6vw, 40px);
  color: #ffcc6f;
  font-weight: 600;
}

.upg-line .coin-ico{
  width: 0.9em; height: 0.9em; 
  vertical-align: -0.14em;
  margin-right: -0.1em;
}

.upg-actions{
  display:flex !important;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
  gap:.8vw;
  padding:1vh 0;
}

.upg-actions .shop-close,
.upg-actions .shop-delve{
  flex:0 1 24vw;
  height:clamp(76px,10vh,126px);
  font-size:clamp(24px,2.8vw,36px);
  border-radius:0;
  color:#fff;
  font-weight:600;
  letter-spacing:.2px;
  cursor:pointer;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}

.upg-actions .shop-close{
  border:1px solid hsl(0 80% 40% / .45);
  background:hsl(0 80% 40% / .15);
}
.upg-actions .shop-delve{
  border:1px solid hsl(150 60% 35% / .45);
  background:hsl(150 60% 35% / .15);
}
.upg-actions .shop-delve.hm-evolve-btn,
.upg-actions .shop-delve.hm-view-milestones {
  border-color: hsl(30 90% 55% / 0.65);
  background: hsl(30 90% 50% / 0.15);
  color: #ffe6c7;
}
.upg-actions .shop-delve.hm-evolve-btn:hover,
.upg-actions .shop-delve.hm-view-milestones:hover { background:hsl(30 90% 50% / .22); }
.upg-actions .shop-delve.hm-evolve-btn:active,
.upg-actions .shop-delve.hm-view-milestones:active { transform:translateY(1px); background:hsl(30 90% 50% / .28); }
.upg-actions .shop-delve:hover{ background:hsl(150 60% 35% / .22); }
.upg-actions .shop-delve:active{ transform:translateY(1px); background:hsl(150 60% 35% / .28); }
.upg-actions .shop-close:hover { background: hsla(0, 80%, 40%, 0.22); }
.upg-actions .shop-close:active { transform: translateY(1px); background: hsla(0, 80%, 40%, 0.28); }

@media (max-width:520px){
  .upg-title{ font-size:clamp(26px,6vw,40px); }
  .upg-line { font-size:clamp(18px,4.8vw,24px); }
  .upg-actions .shop-close,
  .upg-actions .shop-delve{
    flex-basis: clamp(140px,44vw,240px);
    height:clamp(50px,9vh,80px);
    font-size:clamp(16px,4.2vw,22px);
  }
}

.shop-tile .level-badge.can-buy {
  color: hsl(150, 70%, 60%);
  text-shadow: 0 0 10px hsla(150, 60%, 45%, 0.6);
}

.shop-tile .level-badge.is-maxed {
  color: hsl(330, 80%, 75%);
  text-shadow: 0 0 10px hsla(330, 70%, 45%, 0.65);
}

.shop-tile .shop-upgrade.hm-evolve-ready .level-badge,
.shop-upgrade.hm-evolve-ready .level-badge {
  color: hsl(30, 90%, 70%);
  text-shadow: 0 0 10px hsla(30, 90%, 55%, 0.65);
}

.shop-upgrade.hm-evolve-ready .shop-tile {
  border-radius: 50%;
  box-shadow: 0 0 16px hsla(30, 90%, 55%, 0.65);
  animation: hm-evolve-glow 1.6s ease-in-out infinite;
}

.upg-sheet.hm-evolve-ready .upg-level {
  color: hsl(30, 90%, 75%);
  text-shadow: 0 0 12px hsla(30, 90%, 55%, 0.75);
}

.upg-desc.centered,
.upg-line {
  color: hsl(0 0% 100%);
  mix-blend-mode: normal;
  -webkit-text-fill-color: hsl(0 0% 100%);
  -webkit-text-stroke: 0 transparent;
  opacity: 1;
}

  .upg-content{
    overflow-y: auto;
    min-height: 0;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  @media (hover: none) and (pointer: coarse) {
  :root{
    --upg-title-size: clamp(32px, 5vmin, 52px);
    --upg-desc-size:  clamp(22px, 3.4vmin, 30px);
    --upg-line-size:  clamp(22px, 3.4vmin, 30px);
  }

  .upg-header .upg-title{ font-size: var(--upg-title-size); }
  .upg-desc.centered{     font-size: var(--upg-desc-size);  }
  .upg-line{              font-size: var(--upg-line-size);   }

  .upg-actions{
    padding-bottom: calc(8px + env(safe-area-inset-bottom));
   }
}

@media (hover: none) and (pointer: coarse) and (min-width: 700px) {
  :root{
    --upg-title-size: clamp(42px, 7vmin, 70px);
    --upg-desc-size:  clamp(30px, 5vmin, 50px);
    --upg-line-size:  clamp(30px, 5vmin, 50px);
  }

  .upg-info{ gap: 18px; }
}


@media (hover: none) and (pointer: coarse) and (orientation: portrait) and (min-width: 700px) {
  .upg-sheet:not(.is-maxed) .upg-content {
    transform: translateY(-18vh);
    padding-top: 3vh;
  }

  .upg-sheet.is-maxed .upg-content {
    transform: translateY(-26vh);
    padding-top: 1vh;
  }

  .upg-sheet.is-locked-hidden .upg-content {
    transform: translateY(-30vh);
    padding-top: 0.5vh;
  }
  
  .upg-sheet.is-unlock-short .upg-content {
    transform: translateY(10vh);
  }
}

@media (hover: none) and (pointer: coarse) and (max-width: 600px) {
  :root{
    --upg-title-size: clamp(28px, 6vmin, 44px);
    --upg-desc-size:  clamp(16px, 2.8vmin, 22px);
    --upg-line-size:  clamp(18px, 3.2vmin, 24px);
  }
}

.hm-evolve-note,
.upg-desc.centered.hm-evolve-note {
  display: flex;
  width: 100%;
  margin-inline: auto;
  align-items: center;
  justify-content: center;
  padding-block: clamp(48px, 8vh, 116px);
  color: hsl(30, 94%, 68%) !important;
  -webkit-text-fill-color: hsl(30, 94%, 68%) !important;
  font-weight: 800;
  text-align: center;
  line-height: 1.2;
  text-shadow: 0 0 12px hsla(30, 90%, 55%, 0.75);
}

@keyframes hm-evolve-glow {
  0%,
  100% {
    box-shadow:
      0 0 18px 2px hsla(30, 90%, 55%, 0.65),
      0 0 36px 6px hsla(30, 90%, 55%, 0.35);
  }
  50% {
    box-shadow:
      0 0 26px 6px hsla(30, 90%, 60%, 0.9),
      0 0 48px 12px hsla(30, 90%, 60%, 0.55);
  }
}

.hm-view-milestones-row {
  display: flex;
  justify-content: center;
  margin: 8px 0;
}

.hm-view-milestones {
  border:1px solid hsl(30 90% 55% / 0.65);
  background: hsl(30 90% 50% / 0.15);
  color: #ffe6c7;
  padding: 10px 14px;
}
.hm-view-milestones:hover { background:hsl(30 90% 50% / .22); }
.hm-view-milestones:active { transform:translateY(1px); background:hsl(30 90% 50% / .28); }

.hm-milestones-overlay {
  position: fixed;
  inset: 0;
  z-index: 11000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(12px, 3vw, 24px);
  background: hsla(214, 45%, 6%, 0.55);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.hm-milestones-dialog {
  width: min(520px, 90vw);
  max-height: min(calc(80vh + var(--safe-bottom)), 720px);
  overflow: auto;
  background: linear-gradient(150deg, rgba(15, 22, 38, 0.96), rgba(18, 26, 42, 0.94));
  border: 1px solid hsl(30 90% 55% / 0.5);
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.55);
  border-radius: 14px;
  padding: clamp(14px, 2.4vw, 20px);
  padding-bottom: calc(clamp(14px, 2.4vw, 20px) + var(--safe-bottom));
  color: #f7f2e9;
  font-family: var(--font-ui, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif);
}

.hm-milestones-title {
  margin: 0 0 12px;
  font-size: clamp(20px, 3vw, 26px);
  letter-spacing: 0.4px;
  color: #ffdcb3;
  text-align: center;
}

.hm-milestones-list {
  list-style: none;
  padding: 0;
  margin: 0 0 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.hm-milestones-list li {
  padding: 10px 12px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
  font-size: clamp(15px, 2.6vw, 18px);
  line-height: 1.35;
  text-align: center;
}

.hm-milestone-text {
  position: relative;
  display: inline-flex;
  padding: 2px 6px;
  border-radius: 6px;
}

.hm-milestones-list li.hm-milestone-achieved {
  position: relative;
  opacity: 0.7;
}

.hm-milestones-list li.hm-milestone-achieved .hm-milestone-text::after {
  content: '';
  position: absolute;
  left: 1%;
  right: 1%;
  top: 55%;
  height: 1.5px;
  background: currentColor;
  opacity: 0.85;
  transform: translateY(-50%);
  pointer-events: none;
  border-radius: 999px;
}

@media (hover: none) and (pointer: coarse) {
  .hm-milestones-list li.hm-milestone-achieved .hm-milestone-text {
    text-decoration: line-through;
  }

  .hm-milestones-list li.hm-milestone-achieved .hm-milestone-text::after {
    content: none;
  }
}

.hm-milestones-close {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 18px;
  width: 100%;
  font-size: 16px;
  font-weight: 700;
  color: #1b120c;
  background: linear-gradient(135deg, #ffdfba, #ffbf6f);
  border: 0;
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
  cursor: pointer;
  transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
}

.hm-milestones-close:hover { filter: brightness(1.05); }
.hm-milestones-close:active { transform: translateY(1px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }

.upg-sheet.is-hm-upgrade {
  grid-template-rows: auto minmax(0, 1fr) auto;
}

.upg-sheet.is-hm-upgrade .upg-content {
  align-items: stretch;
  justify-content: flex-start;
  padding: 12px 18px 16px;
  transform: none;
  gap: 12px;
  overflow-y: auto;
  min-height: 0;
}

.upg-sheet.is-hm-upgrade.hm-evolve-ready .upg-content {
  justify-content: flex-start;
  padding-top: clamp(10px, 4vh, 60px);
  padding-bottom: clamp(10px, 3vh, 32px);
  gap: clamp(12px, 3vh, 24px);
}

.upg-sheet.is-hm-upgrade .upg-info {
  width: 100%;
  text-align: center;
  gap: 10px;
}

.upg-sheet.is-hm-upgrade .upg-desc.centered {
  text-align: center;
  font-size: clamp(32px, 4.6vw, 50px);
  line-height: 1.2;
}

.upg-sheet.is-hm-upgrade.is-endless-xp .upg-desc.centered {
  font-size: clamp(26px, 3.7vw, 40px);
}

.upg-sheet.is-hm-upgrade .hm-view-milestones-row {
  width: 100%;
  margin-top: 4px;
}

.upg-sheet.is-hm-upgrade .upg-line {
  font-size: clamp(32px, 4.6vmin, 50px);
}

.upg-sheet.is-hm-upgrade.is-endless-xp .upg-line {
  font-size: clamp(26px, 3.7vw, 40px);
}
.hm-view-milestones:hover { background:hsl(30 90% 50% / .22); }
.hm-view-milestones:active { transform:translateY(1px); background:hsl(30 90% 50% / .28); }

@media (max-width: 640px) {
  .upg-sheet.is-hm-upgrade .upg-desc.centered {
    font-size: clamp(26px, 4vw, 42px);
  }

  .upg-sheet.is-hm-upgrade.is-endless-xp .upg-desc.centered {
    font-size: clamp(22px, 3.4vw, 34px);
  }

  .upg-sheet.is-hm-upgrade .upg-line {
    font-size: clamp(26px, 4vmin, 42px);
  }

  .upg-sheet.is-hm-upgrade.is-endless-xp .upg-line {
    font-size: clamp(22px, 3.4vw, 34px);
  }
}
.hm-view-milestones:hover { background:hsl(30 90% 50% / .22); }
.hm-view-milestones:active { transform:translateY(1px); background:hsl(30 90% 50% / .28); }

@media (hover: none) and (pointer: coarse) and (orientation: landscape) and (max-height: 520px) {

  .upg-sheet:not(.is-maxed) .upg-content,
  .upg-sheet.is-maxed .upg-content{
    transform: none;
    padding-top: 0.5vh;
    padding-bottom: 0.5vh;
  }

  .upg-header { padding: 6px 12px 0; }
  .upg-desc.centered {
    margin: 0.25rem 0 0.35rem;
    line-height: 1.1;
  }

  .upg-info{
    gap: 0.25rem;
    margin: 0.3rem 0 0.2rem;
  }

  .upg-line{
    line-height: 1.1;
    margin: 0.15rem 0;
  }

  .bonus-line{ margin-block: 0.15rem; }

  .upg-actions{
    gap: 0.4rem;
    padding-top: 4px;
    padding-bottom: calc(6px + env(safe-area-inset-bottom));
  }

  .upg-actions .shop-close,
  .upg-actions .shop-delve{
    height: clamp(40px, 12vh, 54px);
    font-size: clamp(13px, 2vmin, 17px);
  }
}

@media (hover: none) and (pointer: coarse) and (orientation: portrait) and (min-width: 700px) {
  .upg-level {
    font-size: clamp(20px, 3vmin, 35px);
  }
}

@media (hover: none) and (pointer: coarse) and (orientation: landscape) and (min-width: 700px) {
  .upg-sheet:not(.is-maxed) .upg-content {
    transform: translateY(-8vh);
    padding-top: 2vh;
  }

  .upg-sheet.is-maxed .upg-content {
    transform: translateY(-14vh);
    padding-top: 1vh;
  }

  .upg-sheet.is-locked-hidden .upg-content {
    transform: translateY(-16vh);
    padding-top: 0.5vh;
  }
  
  .upg-sheet.is-unlock-upgrade .upg-content {
    transform: none;
    padding-top: 2vh;
  }
}

.bonus-line .infinity-symbol {
  display: inline-block;
  transform: translateY(0.03em);
  text-shadow: 0 0.08em 0.18em rgba(0, 0, 0, 0.4);
  -webkit-text-fill-color: currentColor;
}

@media (max-height: 850px) and (hover: hover) and (pointer: fine) {
  .upg-sheet:not(.is-maxed) .upg-content,
  .upg-sheet.is-maxed .upg-content,
  .upg-sheet.is-locked-hidden .upg-content,
  .upg-sheet.is-unlock-short .upg-content,
  .upg-sheet.is-unlock-upgrade .upg-content {
    transform: none !important;
    padding-top: 1.2rem !important;
    padding-bottom: 1.2rem !important;
    justify-content: flex-start !important;
  }

  .upg-actions {
    padding-top: 4px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    gap: 0.6rem;
  }

  .upg-actions .shop-close,
  .upg-actions .shop-delve {
    height: clamp(52px, 12vh, 86px);
    font-size: clamp(18px, 3vw, 26px);
  }
}
/* css/ui/delve/merchant.css */
:root {
  --merchant-bg: hsl(220 32% 7% / 1);
  --merchant-card: hsl(220 26% 12% / 1);
  --merchant-border: hsl(215 28% 26% / 1);
  --merchant-shadow: 0 28px 80px hsl(215 60% 2% / 0.65);
  --merchant-radius: 20px;
  --merchant-anim: 220ms cubic-bezier(.2, .8, .2, 1);
}

.merchant-overlay {
  position: fixed;
  inset: 0;
  z-index: 4001;
  pointer-events: none;
  user-select: none;
}
.merchant-overlay.is-open { pointer-events: auto; }

.merchant-sheet {
  position: absolute;
  inset: 0;
  background: var(--merchant-bg);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  display: grid;
  grid-template-rows: auto auto 1fr auto;
  transform: translateY(100%);
  transition: transform var(--merchant-anim);
  box-shadow: var(--merchant-shadow);
  --merchant-fade-size: clamp(18px, 5vw, 40px);
}
.merchant-overlay.is-open .merchant-sheet { transform: translateY(0); }

/* When the very first chat is running, pin the sheet in place immediately */
.merchant-overlay.firstchat-instant .merchant-sheet {
  transition: none !important;
  transform: translateY(0) !important;
}

.shop-grabber, .merchant-grabber {
  padding-top: calc(8px + var(--safe-top));
  padding-bottom: 12px;
  display: grid;
  place-items: center;
  touch-action: none;
  -webkit-user-select: none;
  user-select: none;
  position: relative;
  z-index: 6;
}

.merchant-grabber {
  background: var(--merchant-bg);
}

@media (pointer: fine) {
  .merchant-reset,
  .merchant-reset__status {
    -webkit-user-select: text;
    user-select: text;
  }

  .merchant-dialogue-list .dlg-title,
  .merchant-dialogue-list .dlg-blurb,
  .merchant-dialogue-list .dlg-reward,
  .merchant-dialogue-list .dlg-again {
    -webkit-user-select: text;
    user-select: text;
  }

  .merchant-reset img,
  .merchant-dialogue-list .coin-icon,
  .merchant-dialogue-list .book-icon,
  .merchant-reset__action {
    -webkit-user-select: none;
    user-select: none;
  }
}

.shop-grabber .grab-handle,
.merchant-grabber .grab-handle {
  width: 56px;
  height: 6px;
  border-radius: 999px;
  background: hsl(0 0% 100% / .35);
  box-shadow: inset 0 1px 0 hsl(0 0% 100% / .25);
}

/* Content + header */
.merchant-content {
  overflow-y: auto;
  padding: 0;
  scrollbar-gutter: stable both-edges;
  background: var(--merchant-bg);

  /* smooth scrolling on iOS */
  -webkit-overflow-scrolling: touch;

  /* we’ll draw our own overlay scrollbar */
  scrollbar-width: none;              /* Firefox */
}

.merchant-sheet.has-scroll-shadow .merchant-content {
  -webkit-mask-image: linear-gradient(180deg, transparent 0%, #000 var(--merchant-fade-size), #000 100%);
  mask-image: linear-gradient(180deg, transparent 0%, #000 var(--merchant-fade-size), #000 100%);
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
}

.merchant-sheet.has-scroll-shadow .merchant-header::after {
  opacity: 1;
}

.merchant-content::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;                      /* Chromium/WebKit */
}

/* Chromium/WebKit (incl. iOS) */
.merchant-content::-webkit-scrollbar {
  width: 12px;
}

.merchant-content::-webkit-scrollbar-track {
  background: hsl(220 30% 10% / .85);
  border-left: 1px solid var(--merchant-border);
}

.merchant-content::-webkit-scrollbar-thumb {
  background: hsl(0 0% 100% / .22);
  border-radius: 10px;
}

.merchant-content::-webkit-scrollbar-thumb:hover {
  background: hsl(0 0% 100% / .32);
}

/* Overlay scrollbar for Merchant (same look as Shop) */
.merchant-scrollbar {
  position: absolute;                 /* lives inside .merchant-sheet */
  right: 6px;
  /* top/bottom are set from JS so it respects grabber/header/actions */
  width: 8px;
  border-radius: 6px;
  background: transparent;            /* no track fill */
  pointer-events: auto;
  z-index: 4;                         /* above content/header */
}

.merchant-scrollbar__thumb {
  width: 100%;
  min-height: 28px;                   /* readable minimum */
  border-radius: 6px;
  background: hsl(0 0% 100% / .28);
  box-shadow: inset 0 0 0 1px hsl(0 0% 100% / .12);
  transform: translateY(0);           /* JS updates this */
  transition: background .15s ease;
  cursor: grab;
}

.merchant-scrollbar__thumb:hover {
  /* desktop hover; harmless on mobile */
  background: hsl(0 0% 100% / .36);
}

.merchant-scrollbar__thumb.dragging {
  cursor: grabbing;
}

/* Mobile: hide custom scrollbar until actively scrolling or dragging */
@media (hover: none) and (pointer: coarse) {
  .merchant-scrollbar {
    opacity: 0;
    pointer-events: none;              /* don’t steal touches when hidden */
    transition: opacity .2s ease;
  }

  .merchant-sheet.is-scrolling .merchant-scrollbar,
  .merchant-scrollbar__thumb.dragging {
    opacity: 1;
    pointer-events: auto;              /* interactive when visible */
  }
}

.merchant-header {
  position: sticky;
  top: 0;
  z-index: 10;
  padding: 10px 12px 8px;
  background: var(--merchant-bg);
  backdrop-filter: inherit;
  -webkit-backdrop-filter: inherit;
  isolation: isolate;
}
.merchant-title {
  margin: 0 0 8px;
  font-weight: 700;
  text-align: center;
  color: white;
  position: relative;
  z-index: 2;
}

.merchant-line  {
  height: 2px;
  width: 100%;
  background: var(--merchant-border);
  position: relative;
  z-index: 2;
}

.merchant-header::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  top: calc(100% - 1px);
  height: var(--merchant-fade-size);
  background: linear-gradient(180deg, var(--merchant-bg), hsl(220 32% 7% / 0));
  opacity: 0;
  pointer-events: none;
  transition: opacity 160ms ease;
  z-index: 1;
}

/* Dialog row */
.merchant-dialog { padding: 12px; display: grid; }
.merchant-bubble {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 12px;
  align-items: start;
  background: var(--merchant-card);
  border: 1px solid var(--merchant-border);
  border-radius: var(--merchant-radius);
  padding: 14px;
}
/* Regular Merchant dialogue bubble icon */
.merchant-icon {
  width: clamp(60px, 12vw, 96px);
  height: clamp(60px, 12vw, 96px);
  object-fit: contain;
  display: block;
}

.merchant-text {
  color: hsl(0 0% 100% / .9);
  font: 500 1rem/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}

/* Merchant actions (footer) */
.merchant-actions {
  display: flex; justify-content: center; align-items: center; gap: 12px;
  padding: 12px 16px calc(12px + var(--safe-bottom));
  background: var(--merchant-bg);
}
.merchant-actions .merchant-close {
  min-width: 180px;
  height: 44px;
  border-radius: 0;
  border: 1px solid hsla(0, 80%, 40%, 0.45);
  background: hsla(0, 80%, 40%, 0.15);
  color: #fff;
  font-weight: 600;
  letter-spacing: .2px;
  cursor: pointer;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}
.merchant-actions .merchant-close:hover {
  background: hsla(0, 80%, 40%, 0.22);
}
.merchant-actions .merchant-close:active {
  transform: translateY(1px);
  background: hsla(0, 80%, 40%, 0.28);
}

/* First-time chat overlay (full-sheet scrim + centered card, no animation) */
.merchant-firstchat {
  position: absolute;
  inset: 0;
  display: none;               /* stays hidden until .is-visible */
  place-items: center;
  z-index: 50;                 /* above other sheet content */
  pointer-events: none;        /* we'll re-enable on the card */
  isolation: isolate;          /* keep blur from affecting the card */
}

/* When visible: show and absorb clicks */
.merchant-firstchat.is-visible {
  display: grid;
  pointer-events: auto;        /* absorb clicks so background is inert */
}

/* The blurred/dimmed scrim */
.merchant-firstchat::before {
  content: "";
  position: absolute;
  inset: 0;
  backdrop-filter: blur(12px) brightness(0.6);
  -webkit-backdrop-filter: blur(12px) brightness(0.6);
  background: rgba(0, 0, 0, 0.50);
}

.merchant-firstchat--initial::before {
  background: #000;
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
}

/* While first-chat is up, hide the sheet content and footer controls */
.merchant-overlay.firstchat-active .merchant-content,
.merchant-overlay.firstchat-active .merchant-actions {
  visibility: hidden;
}


/* The card sits above the blur and stays crisp */
.merchant-firstchat__card {
  position: relative;          /* create a new stacking context over ::before */
  width: min(720px, 92vw);
  background: var(--merchant-card);
  border: 1px solid var(--merchant-border);
  box-shadow: var(--merchant-shadow);
  padding: 16px;
  pointer-events: auto;        /* clickable while the scrim eats background clicks */
}

/* Header + rule (unchanged, included here for completeness) */
.merchant-firstchat__header .name {
  font-weight: 700; color: white; margin-bottom: 8px; text-align: left;
}

.merchant-firstchat__header .rule {
  height: 2px; width: 100%; background: var(--merchant-border); margin-bottom: 12px;
}

/* Row layout (icon left, text right) */
.merchant-firstchat__row {
  display: grid; grid-template-columns: auto 1fr; gap: 12px; align-items: start;
}
.merchant-firstchat__icon {
  width: clamp(60px, 12vw, 96px);
  height: clamp(60px, 12vw, 96px);
  object-fit: contain;
}
.merchant-firstchat__text { color: hsl(0 0% 100% / .9); }

/* Actions */
.merchant-firstchat__actions { display: flex; justify-content: flex-end; margin-top: 14px; }
.merchant-firstchat__continue {
  min-width: 140px; height: 38px;
  border: 1px solid hsla(150, 60%, 35%, 0.45);
  background: hsla(150, 60%, 35%, 0.15);
  color: #fff; font-weight: 600; letter-spacing: .2px; cursor: pointer;
}

/* Make the text feel interactive while it’s typing (tap/click to skip) */
.merchant-firstchat__text.is-typing {
  cursor: pointer;
}

.merchant-firstchat__choices {
  display: grid;
  gap: clamp(6px, 1.2vw, 10px);
  margin-top: 12px;
  opacity: 0;
  transform: translateY(6px);
  transition: opacity 140ms ease, transform 140ms ease;
  pointer-events: none;                 /* <— prevent early clicks */
}
.merchant-firstchat__choices.is-visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;                 /* <— clickable only when visible */
}

.merchant-firstchat__choices .choice {
  min-height: 38px;
  padding: 8px 12px;
  text-align: left;
  border-radius: 8px;
  border: 1px solid var(--merchant-border);
  background: hsl(0 0% 100% / .06);
  color: #fff;
  font-weight: 600;
  letter-spacing: .2px;
  cursor: pointer;
  transition: background 120ms ease, transform 90ms ease;
}
.merchant-firstchat__choices .choice:hover {
  background: hsl(0 0% 100% / .10);
}
.merchant-firstchat__choices .choice:active {
  transform: translateY(1px);
}

.merchant-lockinfo .merchant-firstchat__card {
  max-width: clamp(320px, 62vw, 420px);
}

.merchant-lockinfo__row {
  align-items: flex-start;
  gap: clamp(12px, 3vw, 18px);
}

.merchant-lockinfo__message {
  line-height: 1.45;
}

.merchant-lockinfo__actions {
  margin-top: 18px;
}

.merchant-lockinfo__close{
  min-width:130px;
  height:44px;
  border-radius:0;
  border:1px solid hsla(0,80%,40%,0.45);
  background:hsla(0,80%,40%,0.15);
  color:#fff; font-weight:600; letter-spacing:.2px; cursor:pointer;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}
.merchant-lockinfo__close:hover { background: hsla(0,80%,40%,0.22); }
.merchant-lockinfo__close:active{ transform: translateY(1px); background: hsla(0,80%,40%,0.28); }

@media (max-height: 500px) and (orientation: landscape) {
  .merchant-firstchat {
    align-items: flex-start; 
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 16px 0;
  }

  .merchant-firstchat__card {
    margin: auto;
    max-height: unset;
  }
}

.merchant-dialogue-list {
  display: grid;
  gap: 10px;
  padding-right: 2px;
}

.merchant-dialogue-list::-webkit-scrollbar { width: 0; height: 0; }

/* Dialogue entry cards */
.dlg-card {
  position: relative;              /* allow absolute-positioned right label */
  display: grid;
  grid-template-columns: 1fr;      /* left column only; right label is absolute */
  grid-auto-rows: min-content;
  gap: 4px;
  align-items: start;
  text-align: left;
  padding: clamp(8px,1.2vw,12px) clamp(10px,2vw,14px);
  border-radius: 12px;
  border: 2px solid var(--merchant-border, rgba(255,255,255,.12));
  color: #fff;
  cursor: pointer;
  transition: background 120ms ease, transform 90ms ease, opacity 120ms ease;
}
.dlg-card:not(.is-complete):hover { background: rgba(255,255,255,.18); }
.dlg-card:active { transform: none; }
.dlg-card.is-locked,
.dlg-card:disabled {
  opacity: .45;
  cursor: not-allowed;
  background: #1f1f1f;
}

.dlg-card.is-locked:hover {
  background: #272831;
}

.dlg-card.is-mysterious {
  opacity: .45;
  background: #1f1f1f;
  border-style: solid;
}

.dlg-card.is-mysterious:hover { background: #272831; }
.dlg-card:not(.is-complete):not(.is-mysterious):not(.is-locked) { background: rgba(255,255,255,0.12); }
.dlg-card.is-complete { background: rgba(255,255,255,0.03); }
.dlg-card.is-complete:hover { background: rgba(255,255,255,0.06); }
.dlg-card:not(.is-locked):not(.is-mysterious):not(.is-complete):hover {
  background: rgba(255,255,255,.15);
  transition: background 120ms ease;
}


.dlg-card.has-again {
  padding-right: calc(clamp(10px,2vw,14px) + 110px);
}

/* Left column content */
.dlg-title { font-weight: 700; letter-spacing: .2px; }
.dlg-blurb { opacity: .75; font-size: .95em; }

/* Reward line */
.dlg-reward {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  font-size: .95em;
  opacity: .85;
  justify-self: start;
  align-self: start;
  width: max-content;
  position: relative;
}

.dlg-reward .reward-label { opacity: .85; margin-right: 3px; }

.dlg-reward .coin { display: inline-flex; align-items: center; gap: 2px; }
.dlg-reward .coin-icon {
  width: 0.85em;
  height: 0.85em;
  flex: 0 0 0.85em;
  background: url('/img/currencies/coin/coin.png') center / contain no-repeat;
  position: relative;
  top: 1px;
}

.dlg-reward .book { display: inline-flex; align-items: center; gap: 2px; }
.dlg-reward .book-icon {
  width: 0.85em;
  height: 0.85em;
  flex: 0 0 0.85em;
  background: url('/img/currencies/coin/coin.png') center / contain no-repeat;
  position: relative;
  top: 1px;
}

.dlg-card.is-complete .dlg-title,
.dlg-card.is-complete .dlg-blurb,
.dlg-card.is-complete .dlg-reward {
  color: rgba(255,255,255,.55);
  opacity: .9;
}

/* Strike-through only across the reward content width */
.dlg-card.is-complete .dlg-reward::after {
  content: "";
  position: absolute;
  left: 0;
  top: 55%;
  width: calc(100% + 1px);
  height: 2px;
  background: #888888;
  transform: translateY(-50%);
  pointer-events: none;
  border-radius: 1px;         /* softer edges */
}

/* Replay hint (“Ask Again?”) */
.dlg-again {
  position: absolute;
  right: clamp(10px,2vw,14px);
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255,255,255,.5);
  font-weight: 400;
  font-size: .95em;
  white-space: nowrap;
  pointer-events: none;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  letter-spacing: 0;
}
.dlg-again::before {
  content: '↻';
  opacity: .75;
  font-weight: 400;
}

@media (max-height: 500px) and (orientation: landscape) {
  .merchant-dialogue-list { max-height: 46vh; }
}

@media (pointer: coarse) {
  .dlg-reward .coin-icon,
  .dlg-reward .book-icon {
    top: 0;
  }
}

.merchant-tabs {
  display: flex;
  gap: 8px;
  padding: 10px 12px 0;
}

.merchant-tab {
  padding: 6px 12px;
  border-radius: 10px;
  border: 1px solid var(--merchant-border);
  background: hsl(0 0% 100% / .04);
  color: #fff;
  font-weight: 600;
  letter-spacing: .2px;
  cursor: pointer;
  transition: background 120ms ease, transform 90ms ease, opacity 120ms ease;
}
.merchant-tab:hover { background: hsl(0 0% 100% / .08); }
.merchant-tab:active { transform: translateY(1px); }

.merchant-tab.is-active {
  background: hsl(0 0% 100% / .12);
  box-shadow: inset 0 -2px 0 hsl(0 0% 100% / .18);
}

.merchant-tab.is-locked {
  opacity: .45;
  cursor: not-allowed;
}

/* Panels */
.merchant-panels { padding: 12px; }
.merchant-panel { display: none; }
.merchant-panel.is-active { display: block; }

.merchant-reset {
  display: grid;
  grid-template-columns:
    minmax(140px, 160px)
    minmax(0, 1fr)
    minmax(140px, 160px);
  gap: 16px;
  align-items: stretch;
}


.merchant-reset__sidebar {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.merchant-reset__layer {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border: 0;
  border-radius: 12px;
  background: rgba(255,255,255,0.04);
  color: #f5f8ff;
  font-weight: 600;
  cursor: pointer;
  transition: background 120ms ease;
}

.merchant-reset__layer img {
  width: 36px;
  height: 36px;
  object-fit: contain;
}

.merchant-reset__layer.is-active {
  background: linear-gradient(180deg, rgba(255,169,0,0.4), rgba(255,115,0,0.25));
  box-shadow: inset 0 0 0 2px rgba(255,179,0,0.35);
}

.merchant-reset__main {
  background:
    linear-gradient(180deg,
      hsl(36 88% 55% / 0.96),
      hsl(26 70% 34% / 0.98));
  border-radius: 18px;
  padding: 20px 22px 22px;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
  gap: 20px;
  min-height: 260px;
  box-shadow:
    0 18px 40px hsl(215 75% 2% / 0.85),
    inset 0 1px 0 rgba(255,255,255,0.10);
  border: 1px solid hsl(35 84% 55% / 0.85);
}

.merchant-reset__layout {
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 20px;
  width: 100%;
  height: 100%;
}

.merchant-reset__main.is-forge-complete {
  justify-content: flex-start;
  padding: 14px 18px 16px;
  min-height: 150px;
  gap: 10px;
}


.merchant-reset__content {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  text-align: center;
}

.merchant-reset__main.is-forge-complete .merchant-reset__content {
  justify-content: flex-start;
  gap: 10px;
}

.merchant-reset__main.is-forge-complete .merchant-reset__layout {
  height: auto;
  grid-template-rows: auto auto auto;
  gap: 8px;                  /* tighter gap between header / body / button */
}

.merchant-reset__actions {
  display: flex;
  justify-content: center;
  width: 100%;
}

.merchant-reset__header {
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: center;
  text-align: center;
}

.merchant-reset__icon {
  width: 64px;
  height: 64px;
  object-fit: contain;
}

.merchant-reset__titles h3 {
  margin: 0;
  font-size: 1.5rem;
  color: #ffffff;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.55);
}

.merchant-reset__titles p {
  margin: 4px 0 0;
  color: #e6f5ff;
  font-size: 0.95rem;
  line-height: 1.4;
  align-self: center;
}

.merchant-reset__main.is-forge-complete .merchant-reset__titles p {
  margin-top: 16px;
}

.merchant-reset__body {
  display: flex;
  flex-direction: column;
  gap: 16px;
  align-items: center;
  text-align: center;
  justify-content: flex-start;
  width: 100%;
}

/* Forge only: tighter body spacing so the button sits closer */
.merchant-reset__main.is-forge-complete .merchant-reset__body {
  gap: 4px;
}


.merchant-reset__status {
  color: #f0f8ff;
  font-size: 0.96rem;
  line-height: 1.55;
  min-height: 44px;
  max-width: 540px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  margin-inline: auto;        /* center the description without shifting siblings */
}

.merchant-reset__status:empty {
  visibility: hidden;
  min-height: 44px;
}

.merchant-reset__main.is-forge-complete .merchant-reset__status,
.merchant-reset__main.is-forge-complete .merchant-reset__status:empty {
  min-height: 0;
}


.merchant-reset__status:empty {
  visibility: hidden;
  min-height: 44px;
}

.merchant-reset__status strong {
  font-weight: 800;
}

.merchant-reset__action {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  align-self: center;
  min-width: min(430px, 100%);
  padding: 12px 26px;
  font-size: 1.35rem;
  font-weight: 800;
  letter-spacing: 0.04em;
  border-radius: 999px;
  border: 0;
  background: linear-gradient(180deg, hsl(36 95% 60%), hsl(28 85% 47%));
  box-shadow:
    0 6px 0 hsl(24 90% 20%),
    0 0 0 3px hsl(24 96% 10% / 0.9);
  color: #ffffff;
  cursor: pointer;
  position: relative;
  user-select: none;
}

/* pieces inside + icon amount */
.merchant-reset__action-plus {
  font-size: 1.1em;
  margin-right: 0;
  position: relative;
  top: -1px;
  left: 2px;
}

.merchant-reset__action-icon {
  width: 32px;
  height: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
  top: 1.5px; /* nudge icon down slightly */
}

.merchant-reset__action-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.merchant-reset__action-amount {
  min-width: 0;
}

.merchant-reset__req-msg {
  font-size: 1.05rem;
  font-weight: 700;
  padding: 6px 4px;
  text-align: center;
  color: #fff;
  text-shadow:
    0 0.5px 0 #000,
    0 1px 2px rgba(0,0,0,0.45);
}

/* text stroke / outline, mobile-safe like currency popups */
.merchant-reset__action-plus,
.merchant-reset__action-amount {
  text-shadow:
    0 0.5px 0 #000,
    0 -0.5px 0 #000,
    0.5px 0 0 #000,
    -0.5px 0 0 #000,
    0.5px 0.5px 0 #000,
    -0.5px 0.5px 0 #000,
    0.5px -0.5px 0 #000,
    -0.5px -0.5px 0 #000,
    0 1px 0 rgba(0,0,0,0.55);
}

@keyframes forgeFirePulse {
  0% {
    box-shadow:
      0 0 10px 2px hsl(28 100% 60% / 0.3),
      0 6px 0 hsl(24 90% 20%),
      0 0 0 3px hsl(24 96% 10% / 0.9);
  }
  50% {
    box-shadow:
      0 0 18px 5px hsl(28 100% 65% / 0.55),
      0 6px 0 hsl(24 90% 20%),
      0 0 0 3px hsl(24 96% 12% / 1);
  }
  100% {
    box-shadow:
      0 0 10px 2px hsl(28 100% 60% / 0.3),
      0 6px 0 hsl(24 90% 20%),
      0 0 0 3px hsl(24 96% 10% / 0.9);
  }
}

.merchant-reset__action:not(:disabled):hover,
.merchant-reset__action:not(:disabled):focus-visible {
  background: linear-gradient(
    180deg,
    hsl(36 95% 63%),
    hsl(28 85% 48%)
  );

  animation: forgeFirePulse 1.1s infinite ease-in-out;
}

.merchant-reset__action.disabled,
.merchant-reset__action:disabled {
    cursor: not-allowed !important;
}

@media (max-width: 900px) {
  .merchant-reset {
    grid-template-columns: 1fr;
  }

  .merchant-reset__sidebar {
    flex-direction: row;
    overflow-x: auto;
  }

  .merchant-reset__layer {
    min-width: 140px;
    justify-content: center;
  }
}
/* css/ui/popups.css */

.currency-popups {
  position: fixed;
  top: 30vh; /* centered vertically, slightly above midpoint */
  right: calc(env(safe-area-inset-right) + 16px);
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  pointer-events: none;
  z-index: 1600;
  font-family: var(--font-ui, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif);
}

.currency-popup {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  color: #fff;
  font-size: clamp(1.5rem, 2.6vw, 1.9rem);
  font-weight: 800;
  line-height: 1;
  opacity: 0;
  transform: translateX(16px);
  transition: opacity 180ms ease, transform 180ms ease;
  white-space: nowrap;
  pointer-events: none;
}

.currency-popup.is-visible { opacity: 1; transform: translateX(0); }
.currency-popup.is-leaving { opacity: 0; transform: translateX(16px); }

.currency-popup__plus,
.currency-popup__amount {
  text-shadow:
    0 0.5px 0 #000,
    0 -0.5px 0 #000,
    0.5px 0 0 #000,
    -0.5px 0 0 #000,
    0.5px 0.5px 0 #000,
    -0.5px 0.5px 0 #000,
    0.5px -0.5px 0 #000,
    -0.5px -0.5px 0 #000,
    0 1px 0 rgba(0,0,0,0.55);
}

.currency-popup__plus {
  font-size: 1.1em;
  margin-right: -2px;
  position: relative;
  top: -2px;
}

.currency-popup__icon {
  width: clamp(20px, 2.2vw, 26px);
  height: clamp(20px, 2.2vw, 26px);
  flex: 0 0 auto;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,0.45));
  position: relative;
  top: 1.5px;
  margin-right: 2px;
}

.currency-popup__text {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-weight: 800;
}

.currency-popup__amount { display: inline-block; min-width: 0; }

@media (pointer: fine) {
  .currency-popup__plus,
  .currency-popup__amount {
    -webkit-text-fill-color: #fff;
    -webkit-text-stroke: 1px rgba(0,0,0,0.95);
    text-stroke: 1x rgba(0,0,0,0.95);
    text-shadow: 0 1px 0 rgba(0,0,0,0.25);
  }
}

@media (pointer: coarse) {
  .currency-popups {
    top: 30vh;
    right: calc(env(safe-area-inset-right) + 12px);
    gap: 8px;
  }
  .currency-popup {
    font-size: clamp(1rem, 4.2vw, 1.3rem);
    gap: 5px;
  }
  .currency-popup__icon {
    width: clamp(18px, 5vw, 22px);
    height: clamp(18px, 5vw, 22px);
  }
  .currency-popup__plus {
    top: 1px;
  }
  .currency-popup__amount {
    position: relative;
    top: 1px;
  }
}
@media (pointer: coarse) and (min-width: 1000px), (pointer: coarse) and (orientation: portrait) and (min-width: 600px) {
  .currency-popup__amount {
    top: 2px;
  }
}